{"pr_number": 8030, "pr_title": "Issue #7957: Add annotation type definition for OneTopLevelClass", "pr_createdAt": "2020-04-04T08:49:40Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8030", "timeline": [{"oid": "146bf72b1f49656d6608f97906f9be4f0ce7c4f3", "url": "https://github.com/checkstyle/checkstyle/commit/146bf72b1f49656d6608f97906f9be4f0ce7c4f3", "message": "Issue #7957: Add annotation type definition", "committedDate": "2020-04-04T09:17:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1MTgwMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403451801", "bodyText": "I see no need for that many annotation variables", "author": "strkkk", "createdAt": "2020-04-04T10:05:23Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/design/onetoplevelclass/InputOneTopLevelClassAnnotation.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package com.puppycrawl.tools.checkstyle.checks.design.onetoplevelclass;\n+\n+@interface InputOneTopLevelClassAnnotation {\n+   String author();\n+   String date();\n+   int currentRevision() default 1;\n+   String lastModified() default \"N/A\";\n+   String lastModifiedBy() default \"N/A\";\n+   // Note use of array\n+   String[] reviewers();", "originalCommit": "146bf72b1f49656d6608f97906f9be4f0ce7c4f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxMTQyNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403711424", "bodyText": "Reduced to 1 or 2 fields per definition", "author": "wltan", "createdAt": "2020-04-05T14:43:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1MTgwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1MTgxNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403451816", "bodyText": "same for types above", "author": "strkkk", "createdAt": "2020-04-04T10:05:37Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/design/onetoplevelclass/InputOneTopLevelClassAnnotation2.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package com.puppycrawl.tools.checkstyle.checks.design.onetoplevelclass;\n+\n+@interface InputOneTopLevelClassAnnotation2 {\n+   String author();\n+   String date();\n+   int currentRevision() default 1;\n+   String lastModified() default \"N/A\";\n+   String lastModifiedBy() default \"N/A\";\n+   // Note use of array\n+   String[] reviewers();\n+}\n+\n+@interface InputOneTopLevelClassAnnotation2A {\n+   String author();\n+   String date();\n+   int currentRevision() default 1;\n+   String lastModified() default \"N/A\";\n+   String lastModifiedBy() default \"N/A\";\n+   // Note use of array\n+   String[] reviewers();\n+}\n+\n+@interface InputOneTopLevelClassAnnotation2B {\n+   String author();\n+   String date();\n+   int currentRevision() default 1;\n+   String lastModified() default \"N/A\";\n+   String lastModifiedBy() default \"N/A\";\n+   // Note use of array\n+   String[] reviewers();", "originalCommit": "146bf72b1f49656d6608f97906f9be4f0ce7c4f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxMTQ1OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403711458", "bodyText": "Also fixed", "author": "wltan", "createdAt": "2020-04-05T14:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1MTgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1MjAxMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403452011", "bodyText": "Please also add tests\n\nwith annotations before annotation definitions (Retention policy, Target and other), like in report.\nWith mixed class / annotation / enum /interface (some existing test input ut can be extended)\nI remember there is some special treat for public type definitions, it should be here as well", "author": "strkkk", "createdAt": "2020-04-04T10:07:50Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheckTest.java", "diffHunk": "@@ -138,6 +146,17 @@ public void testFileWithThreeTopLevelEnum() throws Exception {\n         verify(checkConfig, getPath(\"InputOneTopLevelClassEnum2.java\"), expected);\n     }\n \n+    @Test\n+    public void testFileWithThreeTopLevelAnnotation() throws Exception {", "originalCommit": "146bf72b1f49656d6608f97906f9be4f0ce7c4f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxMjAyMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403712022", "bodyText": "Fixed the tests to cover the 3 points mentioned", "author": "wltan", "createdAt": "2020-04-05T14:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ1MjAxMQ=="}], "type": "inlineReview"}, {"oid": "7fa8c06dc325d1beb8e3acb8c023b20bb6789ec6", "url": "https://github.com/checkstyle/checkstyle/commit/7fa8c06dc325d1beb8e3acb8c023b20bb6789ec6", "message": "Issue #7957: Add annotation type definition", "committedDate": "2020-04-05T14:19:07Z", "type": "forcePushed"}, {"oid": "6813c832bce72512be34bcac25ab5af6409952f8", "url": "https://github.com/checkstyle/checkstyle/commit/6813c832bce72512be34bcac25ab5af6409952f8", "message": "Issue #7957: Add annotation type definition", "committedDate": "2020-04-05T14:51:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDYzNw==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403714637", "bodyText": "same should be added in line 35 as well.", "author": "strkkk", "createdAt": "2020-04-05T15:09:01Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheck.java", "diffHunk": "@@ -27,8 +27,8 @@\n \n /**\n  * <p>\n- * Checks that each top-level class, interface\n- * or enum resides in a source file of its own.\n+ * Checks that each top-level class, interface, enum\n+ * or annotation resides in a source file of its own.", "originalCommit": "6813c832bce72512be34bcac25ab5af6409952f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzgyMTk5NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403821994", "bodyText": "Fixed", "author": "wltan", "createdAt": "2020-04-06T04:20:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDYzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDgyOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403714829", "bodyText": "move to previous line", "author": "strkkk", "createdAt": "2020-04-05T15:09:57Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/design/onetoplevelclass/InputOneTopLevelClassDeclarationOrder.java", "diffHunk": "@@ -16,3 +16,8 @@\n         protected final int maxTotalConcurrentTasks = 0;\n     }\n }\n+\n+@interface InputDeclarationOrderAnnotation\n+{", "originalCommit": "6813c832bce72512be34bcac25ab5af6409952f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNTU1Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403715552", "bodyText": "I assume this is about the braces placement?\nThis is extended from an existing input file whose style is already like that, should I change the other braces as well? It'll be a bit inconsistent otherwise.", "author": "wltan", "createdAt": "2020-04-05T15:15:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDgyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzczNjM0Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403736346", "bodyText": "Ok, I didn't see definitions above. Let it be consistent.", "author": "strkkk", "createdAt": "2020-04-05T18:01:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDgyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDkzNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403714934", "bodyText": "please add // violation comments in test inputs on lines where violation is reported", "author": "strkkk", "createdAt": "2020-04-05T15:11:01Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/design/onetoplevelclass/InputOneTopLevelClassAnnotation.java", "diffHunk": "@@ -0,0 +1,5 @@\n+package com.puppycrawl.tools.checkstyle.checks.design.onetoplevelclass;\n+\n+@interface InputOneTopLevelClassAnnotation {", "originalCommit": "6813c832bce72512be34bcac25ab5af6409952f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzgyMjE2MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403822161", "bodyText": "Fixed", "author": "wltan", "createdAt": "2020-04-06T04:21:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDk1Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403714957", "bodyText": "same here", "author": "strkkk", "createdAt": "2020-04-05T15:11:11Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/design/onetoplevelclass/InputOneTopLevelClassAnnotation2.java", "diffHunk": "@@ -0,0 +1,25 @@\n+package com.puppycrawl.tools.checkstyle.checks.design.onetoplevelclass;\n+\n+import javax.annotation.CheckForNull;\n+import javax.annotation.meta.TypeQualifierDefault;\n+import java.lang.annotation.ElementType;\n+import java.lang.annotation.Retention;\n+import java.lang.annotation.RetentionPolicy;\n+\n+@interface InputOneTopLevelClassAnnotation2A {", "originalCommit": "6813c832bce72512be34bcac25ab5af6409952f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzgyMjE2NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403822165", "bodyText": "Fixed", "author": "wltan", "createdAt": "2020-04-06T04:21:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDk1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDk2OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403714969", "bodyText": "same here", "author": "strkkk", "createdAt": "2020-04-05T15:11:21Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/design/onetoplevelclass/InputOneTopLevelClassDeclarationOrder.java", "diffHunk": "@@ -16,3 +16,8 @@\n         protected final int maxTotalConcurrentTasks = 0;\n     }\n }\n+\n+@interface InputDeclarationOrderAnnotation", "originalCommit": "6813c832bce72512be34bcac25ab5af6409952f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzgyMjE3OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r403822179", "bodyText": "Fixed", "author": "wltan", "createdAt": "2020-04-06T04:21:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcxNDk2OQ=="}], "type": "inlineReview"}, {"oid": "5ae501142030222ae660a333c501b3cebde279a9", "url": "https://github.com/checkstyle/checkstyle/commit/5ae501142030222ae660a333c501b3cebde279a9", "message": "Issue #7957: Add annotation type definition", "committedDate": "2020-04-06T04:17:59Z", "type": "forcePushed"}, {"oid": "397d96dd917f3e43ed960b84ee1f8cd39b663f66", "url": "https://github.com/checkstyle/checkstyle/commit/397d96dd917f3e43ed960b84ee1f8cd39b663f66", "message": "Issue #7957: Add annotation type definition", "committedDate": "2020-04-06T06:56:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxNTQ0NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r407215444", "bodyText": "Javadoc was not updated.", "author": "rnveach", "createdAt": "2020-04-12T15:41:14Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/design/OneTopLevelClassCheck.java", "diffHunk": "@@ -146,7 +146,8 @@ else if (!isPublic(currentNode)) {\n     private static boolean isTypeDef(DetailAST node) {\n         return node.getType() == TokenTypes.CLASS_DEF\n                 || node.getType() == TokenTypes.ENUM_DEF\n-                || node.getType() == TokenTypes.INTERFACE_DEF;\n+                || node.getType() == TokenTypes.INTERFACE_DEF\n+                || node.getType() == TokenTypes.ANNOTATION_DEF;", "originalCommit": "397d96dd917f3e43ed960b84ee1f8cd39b663f66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzMxMjcxMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8030#discussion_r407312711", "bodyText": "Fixed.\nAnnotation types were added to the Google UTs as well.", "author": "wltan", "createdAt": "2020-04-13T04:26:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzIxNTQ0NA=="}], "type": "inlineReview"}, {"oid": "c72aa61a3aa36449e037d96f745ba3bb0648a90d", "url": "https://github.com/checkstyle/checkstyle/commit/c72aa61a3aa36449e037d96f745ba3bb0648a90d", "message": "Issue #7957: Add annotation type definition for OneTopLevelClass", "committedDate": "2020-04-13T04:17:53Z", "type": "forcePushed"}, {"oid": "b657f14ccc3c0f077548c712713d3c80c3437d76", "url": "https://github.com/checkstyle/checkstyle/commit/b657f14ccc3c0f077548c712713d3c80c3437d76", "message": "Issue #7957: Add annotation type definition for OneTopLevelClass", "committedDate": "2020-04-21T04:36:56Z", "type": "forcePushed"}, {"oid": "63fa77a88cb592f0be6843051406e929f4227777", "url": "https://github.com/checkstyle/checkstyle/commit/63fa77a88cb592f0be6843051406e929f4227777", "message": "Issue #7957: Add annotation type definition for OneTopLevelClass", "committedDate": "2020-04-21T06:34:10Z", "type": "forcePushed"}, {"oid": "7f810e2dc9cb2d3ccf97851bf9b71d10c3f63c76", "url": "https://github.com/checkstyle/checkstyle/commit/7f810e2dc9cb2d3ccf97851bf9b71d10c3f63c76", "message": "Issue #7957: Add annotation type definition for OneTopLevelClass", "committedDate": "2020-04-21T07:59:54Z", "type": "commit"}, {"oid": "7f810e2dc9cb2d3ccf97851bf9b71d10c3f63c76", "url": "https://github.com/checkstyle/checkstyle/commit/7f810e2dc9cb2d3ccf97851bf9b71d10c3f63c76", "message": "Issue #7957: Add annotation type definition for OneTopLevelClass", "committedDate": "2020-04-21T07:59:54Z", "type": "forcePushed"}]}