{"pr_number": 7899, "pr_title": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "pr_createdAt": "2020-03-19T05:11:48Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7899", "timeline": [{"oid": "759f0db7f48a56bdef86eaa9416fbc9411cc8701", "url": "https://github.com/checkstyle/checkstyle/commit/759f0db7f48a56bdef86eaa9416fbc9411cc8701", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-19T06:14:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMzIxOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r395733219", "bodyText": "Please ensure we have cases where there will be a violation and the violation shows the correct information.", "author": "rnveach", "createdAt": "2020-03-20T15:57:53Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/checks/indentation/IndentationCheckTest.java", "diffHunk": "@@ -1759,6 +1759,16 @@ public void testLambda2() throws Exception {\n         verifyWarns(checkConfig, getPath(\"InputIndentationLambda2.java\"), expected);\n     }\n \n+    @Test\n+    public void testLambda3() throws Exception {\n+        final DefaultConfiguration checkConfig = createModuleConfig(IndentationCheck.class);\n+        checkConfig.addAttribute(\"tabWidth\", \"4\");\n+        checkConfig.addAttribute(\"basicOffset\", \"4\");\n+        checkConfig.addAttribute(\"lineWrappingIndentation\", \"8\");\n+        final String[] expected = CommonUtil.EMPTY_STRING_ARRAY;\n+        verifyWarns(checkConfig, getPath(\"InputIndentationLambda3.java\"), expected);", "originalCommit": "759f0db7f48a56bdef86eaa9416fbc9411cc8701", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwMjkyOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r396102929", "bodyText": "Already done.", "author": "liach", "createdAt": "2020-03-22T14:57:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMzIxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5MDc2Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r396390767", "bodyText": "What happened to the file with no violations? We should have both good cases and bad cases. Also ensure that the case from the issue is part of the UTs.", "author": "rnveach", "createdAt": "2020-03-23T11:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMzIxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4NjkxOA==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r397586918", "bodyText": "Added back, waiting for ci for now.", "author": "liach", "createdAt": "2020-03-25T03:16:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMzIxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAxMzIxMw==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r398013213", "bodyText": "Done, ci build now passes.", "author": "liach", "createdAt": "2020-03-25T16:54:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczMzIxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczNDQ0Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r395734443", "bodyText": "Change looks good but from #7675 (comment) :\n\nLambda does not start the line and should not have been the one reporting the problem if the indentation was wrong.\n\nWas my initial analysis wrong and we are already ensuring the AST we are checking does start the line? One way to check this would be to turn on forceStrictCondition.", "author": "rnveach", "createdAt": "2020-03-20T15:59:44Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/LambdaHandler.java", "diffHunk": "@@ -66,7 +66,7 @@ protected IndentLevel getIndentImpl() {\n         // If the start of the lambda is the first element on the line;\n         // assume line wrapping with respect to its parent.\n         final DetailAST firstChild = getMainAst().getFirstChild();\n-        if (getLineStart(firstChild) == firstChild.getColumnNo()) {\n+        if (getLineStart(firstChild) == expandedTabsColumnNo(firstChild)) {", "originalCommit": "759f0db7f48a56bdef86eaa9416fbc9411cc8701", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczNTcxMg==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r395735712", "bodyText": "Ignore this. The left is getting the start of the line and ensuring it matches.", "author": "rnveach", "createdAt": "2020-03-20T16:01:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczNDQ0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczNTg5NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7899#discussion_r395735895", "bodyText": "Imo your analysis is wrong. getLineStart returns a tab expanded column number while firstChild.getColumnNo counts tab as single-width.", "author": "liach", "createdAt": "2020-03-20T16:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTczNDQ0Mw=="}], "type": "inlineReview"}, {"oid": "30fc8a2d01521583958642fa937e7681e7fe9a98", "url": "https://github.com/checkstyle/checkstyle/commit/30fc8a2d01521583958642fa937e7681e7fe9a98", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-20T16:46:26Z", "type": "forcePushed"}, {"oid": "c5141fb76eb546f2fe6ff9356685292029d310c9", "url": "https://github.com/checkstyle/checkstyle/commit/c5141fb76eb546f2fe6ff9356685292029d310c9", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-20T16:56:22Z", "type": "forcePushed"}, {"oid": "e0e6419d86d14ef5cad8a4d02d4bd203eb4f0610", "url": "https://github.com/checkstyle/checkstyle/commit/e0e6419d86d14ef5cad8a4d02d4bd203eb4f0610", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-20T17:04:19Z", "type": "forcePushed"}, {"oid": "ba8b4bd8dc3b24692b88e92f6925127195cda472", "url": "https://github.com/checkstyle/checkstyle/commit/ba8b4bd8dc3b24692b88e92f6925127195cda472", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-25T03:15:38Z", "type": "forcePushed"}, {"oid": "fa8e0eedad4d36e5ebd458492a42d431628c53c8", "url": "https://github.com/checkstyle/checkstyle/commit/fa8e0eedad4d36e5ebd458492a42d431628c53c8", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-25T15:24:28Z", "type": "commit"}, {"oid": "fa8e0eedad4d36e5ebd458492a42d431628c53c8", "url": "https://github.com/checkstyle/checkstyle/commit/fa8e0eedad4d36e5ebd458492a42d431628c53c8", "message": "Issue #5969: Respect and expect tab width in column number check for lambda indentations", "committedDate": "2020-03-25T15:24:28Z", "type": "forcePushed"}]}