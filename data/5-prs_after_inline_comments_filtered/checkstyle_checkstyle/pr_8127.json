{"pr_number": 8127, "pr_title": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore si\u2026", "pr_createdAt": "2020-04-18T22:33:14Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8127", "timeline": [{"oid": "5baadf4bcc09790c942db98d323bd25861f3cb1c", "url": "https://github.com/checkstyle/checkstyle/commit/5baadf4bcc09790c942db98d323bd25861f3cb1c", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-18T23:50:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzMDIwMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r410830201", "bodyText": "please add a new line\n/**\n * Setter to control ...\n *\n * @param alwaysDemandTrailingComma ...\n */\nalso I wonder about instead of user's value, maybe restating whether to always check for a trailing comma", "author": "esilkensen", "createdAt": "2020-04-19T06:27:47Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/ArrayTrailingCommaCheck.java", "diffHunk": "@@ -143,6 +171,19 @@\n      */\n     public static final String MSG_KEY = \"array.trailing.comma\";\n \n+    /**\n+     * Control whether to always check for a trailing comma, even when an array is inline.\n+     */\n+    private boolean alwaysDemandTrailingComma;\n+\n+    /**\n+     * Setter to control whether to always check for a trailing comma, even when an array is inline.\n+     * @param alwaysDemandTrailingComma user's value", "originalCommit": "5baadf4bcc09790c942db98d323bd25861f3cb1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg1MzQxMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r410853413", "bodyText": "Done.", "author": "Gaurav-Punjabi", "createdAt": "2020-04-19T08:43:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzMDIwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzMTg0Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r410831842", "bodyText": "I wonder if it would be easier/harder to read if pulling out alwaysDemandTrailingComma, e.g.\n&& (alwaysDemandTrailingComma ||\n    (!TokenUtil.areOnSameLine(rcurly, previousSibling) &&\n     !TokenUtil.areOnSameLine(arrayInit, previousSibling)))", "author": "esilkensen", "createdAt": "2020-04-19T06:38:03Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/ArrayTrailingCommaCheck.java", "diffHunk": "@@ -164,8 +205,9 @@ public void visitToken(DetailAST arrayInit) {\n         final DetailAST previousSibling = rcurly.getPreviousSibling();\n \n         if (arrayInit.getChildCount() != 1\n-                && !TokenUtil.areOnSameLine(rcurly, previousSibling)\n-                && !TokenUtil.areOnSameLine(arrayInit, previousSibling)\n+                && (alwaysDemandTrailingComma || !TokenUtil.areOnSameLine(rcurly, previousSibling))\n+                && (alwaysDemandTrailingComma\n+                    || !TokenUtil.areOnSameLine(arrayInit, previousSibling))", "originalCommit": "5baadf4bcc09790c942db98d323bd25861f3cb1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDg1MzQxMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r410853411", "bodyText": "Done", "author": "Gaurav-Punjabi", "createdAt": "2020-04-19T08:43:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDgzMTg0Mg=="}], "type": "inlineReview"}, {"oid": "79f06abfc9665c14c41973fab97a5215dc9b5464", "url": "https://github.com/checkstyle/checkstyle/commit/79f06abfc9665c14c41973fab97a5215dc9b5464", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-19T08:42:58Z", "type": "forcePushed"}, {"oid": "406118d83588b21beb7c30851e691902f8afcb26", "url": "https://github.com/checkstyle/checkstyle/commit/406118d83588b21beb7c30851e691902f8afcb26", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-19T10:38:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MzE0NA==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411353144", "bodyText": "please add comment with config explanation (if other than default), e.g.\n/* Config:\n*  prop1 = true\n* prop2 = false\n*/", "author": "strkkk", "createdAt": "2020-04-20T12:54:28Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/coding/arraytrailingcomma/InputArrayTrailingCommaAlwaysDemandTrailingComma.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package com.puppycrawl.tools.checkstyle.checks.coding.arraytrailingcomma;\n+\n+public class InputArrayTrailingCommaAlwaysDemandTrailingComma {", "originalCommit": "406118d83588b21beb7c30851e691902f8afcb26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3NjI5MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411376291", "bodyText": "Done", "author": "Gaurav-Punjabi", "createdAt": "2020-04-20T13:27:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MzE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MzUxOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411353518", "bodyText": "no comma", "author": "strkkk", "createdAt": "2020-04-20T12:55:03Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/ArrayTrailingCommaCheck.java", "diffHunk": "@@ -132,6 +139,27 @@\n  *   ,};        // no violation\n  * </pre>\n  *\n+ * <p>To configure check to always validate trailing comma:</p>\n+ * <pre>\n+ * &lt;module name=\"ArrayTrailingComma\"&gt;\n+ *   &lt;property name=\"alwaysDemandTrailingComma\" value=\"true\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>Example:</p>\n+ * <pre>\n+ * int[] a = new int[] {1, 2}; // violation, array should contain trailing comma.\n+ * String[] b = new String[]{\"foo\", \"bar\",}; // ok\n+ * int[] c = {1", "originalCommit": "406118d83588b21beb7c30851e691902f8afcb26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3NjI2OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411376268", "bodyText": "Done", "author": "Gaurav-Punjabi", "createdAt": "2020-04-20T13:27:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1MzUxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1NDA3MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411354070", "bodyText": "what is difference between this example and one in line 152?\nalso, field name 'c' is in use already", "author": "strkkk", "createdAt": "2020-04-20T12:55:50Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/ArrayTrailingCommaCheck.java", "diffHunk": "@@ -132,6 +139,27 @@\n  *   ,};        // no violation\n  * </pre>\n  *\n+ * <p>To configure check to always validate trailing comma:</p>\n+ * <pre>\n+ * &lt;module name=\"ArrayTrailingComma\"&gt;\n+ *   &lt;property name=\"alwaysDemandTrailingComma\" value=\"true\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>Example:</p>\n+ * <pre>\n+ * int[] a = new int[] {1, 2}; // violation, array should contain trailing comma.\n+ * String[] b = new String[]{\"foo\", \"bar\",}; // ok\n+ * int[] c = {1\n+ *  2 // violation, array should contain trailing comma.\n+ * };\n+ * int[] d = {\n+ * 1}; // violation, array should contain trailing comma.\n+ * int[] c = {\n+ *     1,\n+ *     2 // violation, array should contain trailing comma.", "originalCommit": "406118d83588b21beb7c30851e691902f8afcb26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3NjIzMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411376232", "bodyText": "Oh yeah, removed one of of them \ud83d\udc4d\nThanks", "author": "Gaurav-Punjabi", "createdAt": "2020-04-20T13:27:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM1NDA3MA=="}], "type": "inlineReview"}, {"oid": "f60e7b8dcb78b8202e9e5ee2287e8f80718bacdd", "url": "https://github.com/checkstyle/checkstyle/commit/f60e7b8dcb78b8202e9e5ee2287e8f80718bacdd", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-20T13:27:33Z", "type": "forcePushed"}, {"oid": "39da3fd2e5f62e3d5f19bd8ee21b4531696f0553", "url": "https://github.com/checkstyle/checkstyle/commit/39da3fd2e5f62e3d5f19bd8ee21b4531696f0553", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-20T13:31:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3OTc1Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411379757", "bodyText": "please add examples with multidimensional arrays, and cases like\nhttps://gaurav-punjabi.github.io/checkstyle/3201/lombok-ast/xref/Users/gauravpunjabi/checkstyle-contribution/checkstyle-tester/repositories/lombok-ast/test/resources/idempotency/C005_ArrayInitialization.java.html#L14", "author": "strkkk", "createdAt": "2020-04-20T13:32:49Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/coding/arraytrailingcomma/InputArrayTrailingCommaAlwaysDemandTrailingComma.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.puppycrawl.tools.checkstyle.checks.coding.arraytrailingcomma;\n+\n+/**\n+ * Config:\n+ * alwaysDemandTrailingComma = true\n+ */\n+public class InputArrayTrailingCommaAlwaysDemandTrailingComma {\n+    public int[] test() {\n+        if (true) {\n+            return new int[]{0,};\n+        }\n+        return new int[]{0}; // violation\n+    }\n+\n+    public int[] test2() {\n+        if (true) {\n+            return new int[]{0, 1,};\n+        }\n+        return new int[]{0, 1}; // violation\n+    }\n+\n+    public void test3() {\n+        int[] a = new int[]\n+            {0}; // violation\n+        int[] b = new int[]\n+            {0, 1}; // violation\n+        int[] c = new int[]\n+            {0, 1,\n+                2, 3\n+            }; // violation\n+        int[] d = new int[]\n+            {\n+                1,\n+                2,\n+                3\n+            }; // violation\n+        int[] e = new int[]\n+            {\n+                1,\n+                5,\n+                6,\n+            };\n+        int[] f = {1,\n+            2\n+        }; // violation\n+        int[] g = {1,\n+            2,\n+        };\n+    }", "originalCommit": "39da3fd2e5f62e3d5f19bd8ee21b4531696f0553", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQxNDE1MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r411414151", "bodyText": "Done", "author": "Gaurav-Punjabi", "createdAt": "2020-04-20T14:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3OTc1Nw=="}], "type": "inlineReview"}, {"oid": "5938bad09b2d85d157bd9193543bee933c50b1c9", "url": "https://github.com/checkstyle/checkstyle/commit/5938bad09b2d85d157bd9193543bee933c50b1c9", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-20T14:14:10Z", "type": "forcePushed"}, {"oid": "e82908fd990afb97ae6f40fb9106564049cd5326", "url": "https://github.com/checkstyle/checkstyle/commit/e82908fd990afb97ae6f40fb9106564049cd5326", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-25T14:28:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU5OTM5OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r416599398", "bodyText": "please copy whole code block from default and show how it become different vs default behavior.", "author": "romani", "createdAt": "2020-04-28T13:10:34Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/coding/ArrayTrailingCommaCheck.java", "diffHunk": "@@ -132,6 +139,24 @@\n  *   ,};        // no violation\n  * </pre>\n  *\n+ * <p>To configure check to always validate trailing comma:</p>\n+ * <pre>\n+ * &lt;module name=\"ArrayTrailingComma\"&gt;\n+ *   &lt;property name=\"alwaysDemandTrailingComma\" value=\"true\"/&gt;\n+ * &lt;/module&gt;\n+ * </pre>\n+ * <p>Example:</p>\n+ * <pre>\n+ * int[] a = new int[] {1, 2}; // violation, array should contain trailing comma.", "originalCommit": "e82908fd990afb97ae6f40fb9106564049cd5326", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjYwNjAzNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8127#discussion_r416606034", "bodyText": "Done", "author": "Gaurav-Punjabi", "createdAt": "2020-04-28T13:19:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU5OTM5OA=="}], "type": "inlineReview"}, {"oid": "32317b3280e9c7ac7879ab0337e8fade5a62f378", "url": "https://github.com/checkstyle/checkstyle/commit/32317b3280e9c7ac7879ab0337e8fade5a62f378", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-28T13:19:33Z", "type": "forcePushed"}, {"oid": "92c498bb9460dcb602a45e53529e61730e85e30a", "url": "https://github.com/checkstyle/checkstyle/commit/92c498bb9460dcb602a45e53529e61730e85e30a", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-28T13:23:34Z", "type": "commit"}, {"oid": "92c498bb9460dcb602a45e53529e61730e85e30a", "url": "https://github.com/checkstyle/checkstyle/commit/92c498bb9460dcb602a45e53529e61730e85e30a", "message": "Issue #3201: Allow to configure if ArrayTrailingComma should ignore single-line array", "committedDate": "2020-04-28T13:23:34Z", "type": "forcePushed"}]}