{"pr_number": 7463, "pr_title": "Issue #7446: ensure all checks summaries in sync with checks.xml", "pr_createdAt": "2020-01-11T17:15:43Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7463", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNDc1OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365534759", "bodyText": "Utility methods should go after the method(s) that use them.", "author": "rnveach", "createdAt": "2020-01-11T18:16:28Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/XdocsPagesTest.java", "diffHunk": "@@ -258,6 +261,65 @@ private static boolean isPresent(String availableChecks, String checkName) {\n         return availableChecks.matches(linkPattern);\n     }\n \n+    private static Map<String, String> readSummaries() throws Exception {", "originalCommit": "2414a9f566bbc3d7b91ef45e90bc6a27dd7b83b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODg0MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365538840", "bodyText": "done", "author": "pbludov", "createdAt": "2020-01-11T19:51:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNDc1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNDg4MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365534880", "bodyText": "@romani Is there any reason filters don't have their own summary page?", "author": "rnveach", "createdAt": "2020-01-11T18:18:55Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/XdocsPagesTest.java", "diffHunk": "@@ -258,6 +261,65 @@ private static boolean isPresent(String availableChecks, String checkName) {\n         return availableChecks.matches(linkPattern);\n     }\n \n+    private static Map<String, String> readSummaries() throws Exception {\n+        final String fileName = AVAILABLE_CHECKS_PATH.getFileName().toString();\n+        final String input = new String(Files.readAllBytes(AVAILABLE_CHECKS_PATH), UTF_8);\n+        final Document document = XmlUtil.getRawXml(fileName, input, input);\n+        final NodeList rows = document.getElementsByTagName(\"tr\");\n+        final Map<String, String> result = new HashMap<>();\n+\n+        for (int position = 0; position < rows.getLength(); position++) {\n+            final Node row = rows.item(position);\n+            final Iterator<Node> cells = XmlUtil.findChildElementsByTag(row, \"td\").iterator();\n+            final String name = XmlUtil.sanitizeXml(cells.next().getTextContent());\n+            final String summary = XmlUtil.sanitizeXml(cells.next().getTextContent());\n+\n+            result.put(name, summary);\n+        }\n+\n+        return result;\n+    }\n+\n+    @Test\n+    public void testAllChecksPageInSyncWithChecksSummaries() throws Exception {\n+        final Pattern endOfSentence = Pattern.compile(\"(.*?\\\\.)\\\\s\", Pattern.DOTALL);\n+        final Map<String, String> summaries = readSummaries();\n+\n+        for (Path path : XdocUtil.getXdocsConfigFilePaths(XdocUtil.getXdocsFilePaths())) {\n+            final String fileName = path.getFileName().toString();\n+            if (\"config_reporting.xml\".equals(fileName)\n+                    || \"config_filefilters.xml\".equals(fileName)\n+                    || \"config_filters.xml\".equals(fileName)) {", "originalCommit": "2414a9f566bbc3d7b91ef45e90bc6a27dd7b83b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzOTc1NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365539754", "bodyText": "No good reason, but they already all at one page https://checkstyle.org/config_filters.html and one more page for file filters", "author": "romani", "createdAt": "2020-01-11T20:11:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNDg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNDkxMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365534911", "bodyText": "Assertions require the page that is being examined, and the check that is being looked at. This is extremely helpful in debugging a failure.\nSee https://github.com/checkstyle/checkstyle/blob/master/src/test/java/com/puppycrawl/tools/checkstyle/internal/XdocsPagesTest.java#L1587 as an example. All tests in this class should have assertions like this.", "author": "rnveach", "createdAt": "2020-01-11T18:19:48Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/XdocsPagesTest.java", "diffHunk": "@@ -258,6 +261,65 @@ private static boolean isPresent(String availableChecks, String checkName) {\n         return availableChecks.matches(linkPattern);\n     }\n \n+    private static Map<String, String> readSummaries() throws Exception {\n+        final String fileName = AVAILABLE_CHECKS_PATH.getFileName().toString();\n+        final String input = new String(Files.readAllBytes(AVAILABLE_CHECKS_PATH), UTF_8);\n+        final Document document = XmlUtil.getRawXml(fileName, input, input);\n+        final NodeList rows = document.getElementsByTagName(\"tr\");\n+        final Map<String, String> result = new HashMap<>();\n+\n+        for (int position = 0; position < rows.getLength(); position++) {\n+            final Node row = rows.item(position);\n+            final Iterator<Node> cells = XmlUtil.findChildElementsByTag(row, \"td\").iterator();\n+            final String name = XmlUtil.sanitizeXml(cells.next().getTextContent());\n+            final String summary = XmlUtil.sanitizeXml(cells.next().getTextContent());\n+\n+            result.put(name, summary);\n+        }\n+\n+        return result;\n+    }\n+\n+    @Test\n+    public void testAllChecksPageInSyncWithChecksSummaries() throws Exception {\n+        final Pattern endOfSentence = Pattern.compile(\"(.*?\\\\.)\\\\s\", Pattern.DOTALL);\n+        final Map<String, String> summaries = readSummaries();\n+\n+        for (Path path : XdocUtil.getXdocsConfigFilePaths(XdocUtil.getXdocsFilePaths())) {\n+            final String fileName = path.getFileName().toString();\n+            if (\"config_reporting.xml\".equals(fileName)\n+                    || \"config_filefilters.xml\".equals(fileName)\n+                    || \"config_filters.xml\".equals(fileName)) {\n+                continue;\n+            }\n+\n+            final String input = new String(Files.readAllBytes(path), UTF_8);\n+            final Document document = XmlUtil.getRawXml(fileName, input, input);\n+            final NodeList sources = document.getElementsByTagName(\"subsection\");\n+\n+            for (int position = 0; position < sources.getLength(); position++) {\n+                final Node section = sources.item(position);\n+                final String sectionName = XmlUtil.getNodeName(section);\n+                if (!\"Description\".equals(sectionName)) {\n+                    continue;\n+                }\n+\n+                final String checkName = XmlUtil.getNodeName(section.getParentNode());\n+                final Matcher matcher = endOfSentence.matcher(section.getTextContent());\n+                assertWithMessage(\n+                    \"XDocs description should start with a sentence that ends with a period\")", "originalCommit": "2414a9f566bbc3d7b91ef45e90bc6a27dd7b83b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODg0Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365538847", "bodyText": "done", "author": "pbludov", "createdAt": "2020-01-11T19:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNDkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNTAzNg==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365535036", "bodyText": "Please sync the assertion message. Also checkName is in the message twice.", "author": "rnveach", "createdAt": "2020-01-11T18:22:44Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/XdocsPagesTest.java", "diffHunk": "@@ -258,6 +261,65 @@ private static boolean isPresent(String availableChecks, String checkName) {\n         return availableChecks.matches(linkPattern);\n     }\n \n+    private static Map<String, String> readSummaries() throws Exception {\n+        final String fileName = AVAILABLE_CHECKS_PATH.getFileName().toString();\n+        final String input = new String(Files.readAllBytes(AVAILABLE_CHECKS_PATH), UTF_8);\n+        final Document document = XmlUtil.getRawXml(fileName, input, input);\n+        final NodeList rows = document.getElementsByTagName(\"tr\");\n+        final Map<String, String> result = new HashMap<>();\n+\n+        for (int position = 0; position < rows.getLength(); position++) {\n+            final Node row = rows.item(position);\n+            final Iterator<Node> cells = XmlUtil.findChildElementsByTag(row, \"td\").iterator();\n+            final String name = XmlUtil.sanitizeXml(cells.next().getTextContent());\n+            final String summary = XmlUtil.sanitizeXml(cells.next().getTextContent());\n+\n+            result.put(name, summary);\n+        }\n+\n+        return result;\n+    }\n+\n+    @Test\n+    public void testAllChecksPageInSyncWithChecksSummaries() throws Exception {\n+        final Pattern endOfSentence = Pattern.compile(\"(.*?\\\\.)\\\\s\", Pattern.DOTALL);\n+        final Map<String, String> summaries = readSummaries();\n+\n+        for (Path path : XdocUtil.getXdocsConfigFilePaths(XdocUtil.getXdocsFilePaths())) {\n+            final String fileName = path.getFileName().toString();\n+            if (\"config_reporting.xml\".equals(fileName)\n+                    || \"config_filefilters.xml\".equals(fileName)\n+                    || \"config_filters.xml\".equals(fileName)) {\n+                continue;\n+            }\n+\n+            final String input = new String(Files.readAllBytes(path), UTF_8);\n+            final Document document = XmlUtil.getRawXml(fileName, input, input);\n+            final NodeList sources = document.getElementsByTagName(\"subsection\");\n+\n+            for (int position = 0; position < sources.getLength(); position++) {\n+                final Node section = sources.item(position);\n+                final String sectionName = XmlUtil.getNodeName(section);\n+                if (!\"Description\".equals(sectionName)) {\n+                    continue;\n+                }\n+\n+                final String checkName = XmlUtil.getNodeName(section.getParentNode());\n+                final Matcher matcher = endOfSentence.matcher(section.getTextContent());\n+                assertWithMessage(\n+                    \"XDocs description should start with a sentence that ends with a period\")\n+                    .that(matcher.find());\n+                final String firstSentence = XmlUtil.sanitizeXml(matcher.group(1));\n+                assertWithMessage(\"Summary for check \" + checkName", "originalCommit": "2414a9f566bbc3d7b91ef45e90bc6a27dd7b83b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODg0OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365538849", "bodyText": "done", "author": "pbludov", "createdAt": "2020-01-11T19:52:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNTAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNTA5NQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365535095", "bodyText": "getNodeName\nReturns the value of the \"name\" attribute\n\nShouldn't this be something like getNodeNameAttributeText? Maybe something a little bit shorter, but I don't think the current name expressly says enough about what it is doing.", "author": "rnveach", "createdAt": "2020-01-11T18:24:24Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/utils/XmlUtil.java", "diffHunk": "@@ -132,4 +132,30 @@ else if (child.hasChildNodes()) {\n         return result;\n     }\n \n+    /**\n+     * Returns the value of the \"name\" attribute for the given node.\n+     *\n+     * @param node to retrieve the name\n+     * @return the node name\n+     */\n+    public static String getNodeName(Node node) {", "originalCommit": "2414a9f566bbc3d7b91ef45e90bc6a27dd7b83b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODg1NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365538854", "bodyText": "done", "author": "pbludov", "createdAt": "2020-01-11T19:52:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNTA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNTE1MA==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365535150", "bodyText": "The first sentence should be the summary, but you have it split into 2 and is a bit long.\nI think the first sentence should be something like \"This santizes the given string for safe use in XML documents.\" and then list what it specifically does as consecutive sentences.", "author": "rnveach", "createdAt": "2020-01-11T18:25:58Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/internal/utils/XmlUtil.java", "diffHunk": "@@ -132,4 +132,30 @@ else if (child.hasChildNodes()) {\n         return result;\n     }\n \n+    /**\n+     * Returns the value of the \"name\" attribute for the given node.\n+     *\n+     * @param node to retrieve the name\n+     * @return the node name\n+     */\n+    public static String getNodeName(Node node) {\n+        return node.getAttributes().getNamedItem(\"name\").getNodeValue();\n+    }\n+\n+    /**\n+     * Removes all whitespaces at the beginning and at the end of the string and\n+     * replaces repeated whitespaces in the middle of the string with a single space.\n+     * Replaces XML entities with escaped values.", "originalCommit": "2414a9f566bbc3d7b91ef45e90bc6a27dd7b83b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzODg2MQ==", "url": "https://github.com/checkstyle/checkstyle/pull/7463#discussion_r365538861", "bodyText": "done", "author": "pbludov", "createdAt": "2020-01-11T19:52:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTUzNTE1MA=="}], "type": "inlineReview"}, {"oid": "5a1ac2ff35ce26cd0440d3cdf800fb70e92d426a", "url": "https://github.com/checkstyle/checkstyle/commit/5a1ac2ff35ce26cd0440d3cdf800fb70e92d426a", "message": "Issue #7446: ensure all checks summaries in sync with checks.xml", "committedDate": "2020-01-11T19:51:07Z", "type": "commit"}, {"oid": "5a1ac2ff35ce26cd0440d3cdf800fb70e92d426a", "url": "https://github.com/checkstyle/checkstyle/commit/5a1ac2ff35ce26cd0440d3cdf800fb70e92d426a", "message": "Issue #7446: ensure all checks summaries in sync with checks.xml", "committedDate": "2020-01-11T19:51:07Z", "type": "forcePushed"}]}