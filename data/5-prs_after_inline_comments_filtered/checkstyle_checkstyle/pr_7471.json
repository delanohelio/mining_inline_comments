{"pr_number": 7471, "pr_title": "Issue #7458: 'ThreadLocal' variables should be cleaned up when no longer used", "pr_createdAt": "2020-01-13T22:18:33Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/7471", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366092663", "bodyText": "Isn't this considered a breaking change? Before this change, you could override destroy in an implementing class and not need to call the super class.\nLook at our own implementation checks like RegexpOnFilename.\nhttps://github.com/checkstyle/checkstyle/blob/master/src/main/java/com/puppycrawl/tools/checkstyle/checks/regexp/RegexpOnFilenameCheck.java#L247\nWe override init method but never call super init.", "author": "rnveach", "createdAt": "2020-01-14T00:01:27Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/api/AbstractCheck.java", "diffHunk": "@@ -125,7 +125,7 @@ public void init() {\n      * Destroy the check. It is being retired from service.\n      */\n     public void destroy() {\n-        // No code by default, should be overridden only by demand at subclasses\n+        context.remove();", "originalCommit": "ec49fdfc9295332f1a370a9e099ecc3b1c587ae1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5NDYyOA==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366094628", "bodyText": "this is not a breaking change ... bug as maximum, and even misc (as almost nobody notice any difference). We are not MT tool, this change is literally to make CI happy.", "author": "romani", "createdAt": "2020-01-14T00:08:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwMDA3Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366100072", "bodyText": "Then this will make things weirder when we do become a MT tool. Implementation of MT will not be marked as breaking compatibility but a new feature and then we are expecting users to just know that they should be calling the super destroy. It is going to be up to us now to remember to recheck all checks for this when we get to it.", "author": "rnveach", "createdAt": "2020-01-14T00:29:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjEwNjA2NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366106064", "bodyText": "it is ok, eventually it become clear and all Checks become fixed. This should not block us now.", "author": "romani", "createdAt": "2020-01-14T00:54:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUxNzQ0NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366517444", "bodyText": "I still think this makes it a breaking change, as well as bug.", "author": "rnveach", "createdAt": "2020-01-14T19:02:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjUyNDMyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366524326", "bodyText": "we can put on it breaking label if you wish .... I just try to not attract that much attention to this code change for plugin maintainers.", "author": "romani", "createdAt": "2020-01-14T19:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU0MzYxNw==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366543617", "bodyText": "If we declare this as a breaking change, then we need to determine which methods we would also do this for. As showed above for init, we don't call super for it. If we break for destroy, I feel we should break for all of them to make it easier to remember. I would think we would want to make this clear in xdoc/javadoc that they should be calling the super if they ever override the class' method.", "author": "rnveach", "createdAt": "2020-01-14T19:58:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU0NDc3NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366544774", "bodyText": "I just try to not attract that much attention to this code change for plugin maintainers\n\nHow about we ask a plugin maintainer if they consider this a breaking change?", "author": "rnveach", "createdAt": "2020-01-14T20:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjY4NTg4NA==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r366685884", "bodyText": "I do not know what for such methods .... I do not want to explain user how to use them. We will come back to this ones we start finalizing our API.\n\nif they consider this a breaking change?\n\nI do not know such plugins. I would make this issue as \"misc\".", "author": "romani", "createdAt": "2020-01-15T03:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA5ODA0Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r367098042", "bodyText": "Is it possible to make a check to verify that either this method is not overridden, or it is overridden and calls the base class method of the same name?", "author": "pbludov", "createdAt": "2020-01-15T20:45:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE5ODEyNw==", "url": "https://github.com/checkstyle/checkstyle/pull/7471#discussion_r367198127", "bodyText": "We can to something like this https://stackoverflow.com/a/34180574/1015848 in separate issue.", "author": "romani", "createdAt": "2020-01-16T02:00:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjA5MjY2Mw=="}], "type": "inlineReview"}, {"oid": "d89c8c99aa2594e645bd91d407e0acfb7c928bd7", "url": "https://github.com/checkstyle/checkstyle/commit/d89c8c99aa2594e645bd91d407e0acfb7c928bd7", "message": "Issue #7458: 'ThreadLocal' variables should be cleaned up when no longer used", "committedDate": "2020-01-16T17:10:15Z", "type": "commit"}]}