{"pr_number": 8038, "pr_title": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "pr_createdAt": "2020-04-05T16:52:00Z", "pr_url": "https://github.com/checkstyle/checkstyle/pull/8038", "timeline": [{"oid": "ae2d7235851cef20638eff1e5191dd396006c072", "url": "https://github.com/checkstyle/checkstyle/commit/ae2d7235851cef20638eff1e5191dd396006c072", "message": "minor: changed suppressionxpath generator for pr #8038", "committedDate": "2020-04-16T15:38:15Z", "type": "forcePushed"}, {"oid": "955b3106b6addaaa28cbd93ae609f3ff54473c35", "url": "https://github.com/checkstyle/checkstyle/commit/955b3106b6addaaa28cbd93ae609f3ff54473c35", "message": "minor: changed suppressionxpath generator for pr #8038", "committedDate": "2020-04-16T16:03:08Z", "type": "forcePushed"}, {"oid": "93ad72a98dba1fd266434b7c69924f213ed3eabf", "url": "https://github.com/checkstyle/checkstyle/commit/93ad72a98dba1fd266434b7c69924f213ed3eabf", "message": "minor: changed suppressionxpath generator for pr #8038", "committedDate": "2020-04-17T18:11:37Z", "type": "forcePushed"}, {"oid": "e357902219c62cf640c1d6452f1de11f59e48d84", "url": "https://github.com/checkstyle/checkstyle/commit/e357902219c62cf640c1d6452f1de11f59e48d84", "message": "minor: changed suppressionxpath generator for pr #8038", "committedDate": "2020-04-19T14:49:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjE3Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415086172", "bodyText": "extra space ? please restore.", "author": "romani", "createdAt": "2020-04-25T15:36:21Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/AbstractExpressionHandler.java", "diffHunk": "@@ -390,37 +389,51 @@ protected final void checkExpressionSubtree(\n         boolean firstLineMatches,\n         boolean allowNesting\n     ) {\n-        final LineSet subtreeLines = new LineSet();\n-        final int firstLine = getFirstLine(Integer.MAX_VALUE, tree);\n+        final DetailAstSet subtreeAst = new DetailAstSet();\n+        final int firstLine = getFirstLine(tree);\n         if (firstLineMatches && !allowNesting) {\n-            subtreeLines.addLineAndCol(firstLine,\n-                getLineStart(indentCheck.getLine(firstLine - 1)));\n+            final DetailAST firstAst = getFirstAst(tree, tree);\n+            subtreeAst.addAst(firstAst);\n         }\n-        findSubtreeLines(subtreeLines, tree, allowNesting);\n+        findSubtreeAst(subtreeAst, tree, allowNesting);\n \n-        checkLinesIndent(subtreeLines, indentLevel, firstLineMatches, firstLine);\n+        checkLinesIndent(subtreeAst, indentLevel, firstLineMatches, firstLine);\n     }\n \n     /**\n-     * Get the first line for a given expression.\n+     * Get the first line number for given expression.\n      *\n-     * @param startLine   the line we are starting from\n+     * @param tree      the expression to find the first line for\n+     * @return          the first line of expression\n+     */\n+    protected static int getFirstLine(DetailAST tree) {\n+        return getFirstAst(tree, tree).getLineNo();\n+    }\n+\n+    /**\n+     * Get the first ast for given expression.\n+     *\n+     * @param ast         the current ast that may have minimum line number\n      * @param tree        the expression to find the first line for\n      *\n-     * @return the first line of the expression\n+     * @return the first ast of the expression\n      */\n-    protected static int getFirstLine(int startLine, DetailAST tree) {\n-        int realStart = startLine;\n-        final int currLine = tree.getLineNo();\n-        if (currLine < realStart) {\n-            realStart = currLine;\n+    protected static DetailAST getFirstAst(DetailAST ast, DetailAST tree) {\n+        DetailAST realStart = ast;\n+\n+        if (tree.getLineNo() < realStart.getLineNo()) {\n+            realStart = tree;\n+        }\n+        if (tree.getLineNo() == realStart.getLineNo()\n+                && tree.getColumnNo() < realStart.getColumnNo()) {\n+            realStart = tree;\n         }\n \n         // check children\n         for (DetailAST node = tree.getFirstChild();\n-            node != null;\n-            node = node.getNextSibling()) {\n-            realStart = getFirstLine(realStart, node);\n+             node != null;\n+             node = node.getNextSibling()) {\n+            realStart = getFirstAst(realStart, node);", "originalCommit": "e0d6e9da646fee3947c469a165629aa245a8a577", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzMzQ2Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415133467", "bodyText": "OK, I have restored.", "author": "Abhishek-kumar09", "createdAt": "2020-04-25T20:02:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjE3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjQ0MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415086440", "bodyText": "please explain this change, we do not expect Input files to be changed.", "author": "romani", "createdAt": "2020-04-25T15:37:59Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/indentation/indentation/InputIndentationInvalidSwitchIndent.java", "diffHunk": "@@ -98,9 +98,9 @@ private void method1() { //indent:4 exp:4\n         switch (s) { //indent:8 exp:8\n \t    case 1: //indent:8 exp:12 warn\n \t    \tif (true) //indent:12 exp:16 warn\n-\t    \t\tbreak; //indent:16 exp:20 warn\n+                break; //indent:16 exp:20 warn\n \t    \telse //indent:12 exp:16 warn\n-\t    \t\tbreak; //indent:16 exp:20 warn\n+                break; //indent:16 exp:20 warn", "originalCommit": "e0d6e9da646fee3947c469a165629aa245a8a577", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyMTU5MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r436121590", "bodyText": "OK my bad, I have fixed it in my new commit.", "author": "Abhishek-kumar09", "createdAt": "2020-06-05T19:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjQ0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjUxNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415086516", "bodyText": "please restore indentation.", "author": "romani", "createdAt": "2020-04-25T15:38:18Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/xpath/XpathMapperTest.java", "diffHunk": "@@ -805,7 +805,7 @@ public void testQueryElementFollowingSibling() throws Exception {\n                 .findFirstToken(TokenTypes.METHOD_DEF)\n                 .getNextSibling();\n         final DetailAST[] expected = {expectedMethodDefNode,\n-                expectedMethodDefNode.getNextSibling()};\n+            expectedMethodDefNode.getNextSibling()};", "originalCommit": "e0d6e9da646fee3947c469a165629aa245a8a577", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEyMzIyMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415123221", "bodyText": "Here, I encounter problem, whenever I generate snapshot of changes by mvn --batch-mode -Pno-validations clean package -Passembly and check on this file no errors are encountered. This error is encourtered only during mvn clean verify at ant-phase-verification.", "author": "Abhishek-kumar09", "createdAt": "2020-04-25T19:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzMTMyOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415131329", "bodyText": "This problem is linked with #8038 (comment)\nremoving those changes doesn't require this change, those changes doesn't have effect on internal testcases it only affects mvn clean verify (ant-phase verify).", "author": "Abhishek-kumar09", "createdAt": "2020-04-25T19:49:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyMTkwOA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r436121908", "bodyText": "please restore indentation.\n\nDone.", "author": "Abhishek-kumar09", "createdAt": "2020-06-05T19:29:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NjUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NzQyMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415087421", "bodyText": "too much changes .... we need to select different Input file with low level of violations.\nWe just need to see that few xpath are generated.", "author": "romani", "createdAt": "2020-04-25T15:43:39Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/MainTest.java", "diffHunk": "@@ -1036,64 +1036,195 @@ public void testPrintSuppressionOnMoreThanOneFile(@SysErr Capturable systemErr,\n     public void testGenerateXpathSuppressionOptionOne(@SysErr Capturable systemErr,\n             @SysOut Capturable systemOut) throws IOException {\n         final String expected = addEndOfLine(\n-            \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\",\n+                \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\",\n                 \"<!DOCTYPE suppressions PUBLIC\",\n                 \"    \\\"-//Checkstyle//DTD SuppressionXpathFilter Experimental Configuration 1.2\"\n                     + \"//EN\\\"\",\n                 \"    \\\"https://checkstyle.org/dtds/suppressions_1_2_xpath_experimental.dtd\\\">\",\n                 \"<suppressions>\",\n                 \"<suppress-xpath\",\n                 \"       files=\\\"InputMainComplexityOverflow.java\\\"\",\n+                \"       checks=\\\"IndentationCheck\\\"\",", "originalCommit": "e357902219c62cf640c1d6452f1de11f59e48d84", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMzNTMxMg==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415335312", "bodyText": "My bad, since this xpath-generator is only for NpathComplexity Test, the generated x-path for indentation shouldn't be messed up with it. The test is testing this file against google_checks.xml configuration  (Input File) which has indentation level 4 in every if block, which is conflicting with the google_check under indentation rule. So I am modifying this file to change indentation level to 2, so that no x-path suppression for indentation get generated.\nInstead I am adding a new test to test indentation rules.", "author": "Abhishek-kumar09", "createdAt": "2020-04-26T15:28:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTA4NzQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzMDU2Mw==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r415130563", "bodyText": "Changes discussed here - #8038 (comment)\nOn removing this method I get correct indentation results and no errors with #8038 (comment) is encountered.\nThis method has somehow no results on nesting of arrayInit children and no changes are encountered on removing or keeping this method for any arrayInit test cases inside IndentationcheckTest.java. Infact generated snapshot checks also don't have any effect on nested array init in any possible way.\nAlso on the file mentioned at comment link above the generated snapshot is not producing such errors.\nkeeping this method generate pitest failures, so I had to remove that.\nSince it now violating with many online ci test cases, I think I have to restore this method and test further to remove pitest failures.", "author": "Abhishek-kumar09", "createdAt": "2020-04-25T19:45:39Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/ArrayInitHandler.java", "diffHunk": "@@ -79,11 +79,6 @@ protected DetailAST getRightCurly() {\n         return getMainAst().findFirstToken(TokenTypes.RCURLY);\n     }\n \n-    @Override\n-    protected boolean canChildrenBeNested() {", "originalCommit": "e357902219c62cf640c1d6452f1de11f59e48d84", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5fc78c690c51ef080ee0ce5145b57dd654ec44d5", "url": "https://github.com/checkstyle/checkstyle/commit/5fc78c690c51ef080ee0ce5145b57dd654ec44d5", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-04-26T17:58:07Z", "type": "forcePushed"}, {"oid": "05e76800fef18add8adc5d8a59c60f254e51f69e", "url": "https://github.com/checkstyle/checkstyle/commit/05e76800fef18add8adc5d8a59c60f254e51f69e", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-04-26T18:14:20Z", "type": "forcePushed"}, {"oid": "791613c0755ed4dcc45a53d0900b4808003c9e87", "url": "https://github.com/checkstyle/checkstyle/commit/791613c0755ed4dcc45a53d0900b4808003c9e87", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-04T20:28:26Z", "type": "forcePushed"}, {"oid": "345d7b2f0e970b8b8aca171a3d7efa394d4381ef", "url": "https://github.com/checkstyle/checkstyle/commit/345d7b2f0e970b8b8aca171a3d7efa394d4381ef", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-04T20:40:19Z", "type": "forcePushed"}, {"oid": "337e058666344618b469b39fb7878f598ca0cac4", "url": "https://github.com/checkstyle/checkstyle/commit/337e058666344618b469b39fb7878f598ca0cac4", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-04T21:35:02Z", "type": "forcePushed"}, {"oid": "dcb8cfcd211325c0a637ad52e7bf3c52586106fa", "url": "https://github.com/checkstyle/checkstyle/commit/dcb8cfcd211325c0a637ad52e7bf3c52586106fa", "message": "Pull #8038: Add mainTest cases for Xpath generation and modify inputfiles to support PR #8038", "committedDate": "2020-06-05T20:49:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTA4Mg==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r436161082", "bodyText": "I had to modify this input file for better test and mutation coverage due to changes in abstractExpressionHandler.java", "author": "Abhishek-kumar09", "createdAt": "2020-06-05T20:57:50Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/indentation/indentation/InputIndentationInvalidSwitchIndent.java", "diffHunk": "@@ -101,6 +101,10 @@ private void method1() { //indent:4 exp:4\n \t    \t\tbreak; //indent:16 exp:20 warn\n \t    \telse //indent:12 exp:16 warn\n \t    \t\tbreak; //indent:16 exp:20 warn\n+            case 4: //indent:12 exp:12", "originalCommit": "dcb8cfcd211325c0a637ad52e7bf3c52586106fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2OTI0Ng==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r439769246", "bodyText": "it is always ok to extend tests.", "author": "romani", "createdAt": "2020-06-13T21:07:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE2MTA4Mg=="}], "type": "inlineReview"}, {"oid": "3a3db75bd00d1ed1278d4d8107531637f6532023", "url": "https://github.com/checkstyle/checkstyle/commit/3a3db75bd00d1ed1278d4d8107531637f6532023", "message": "Pull #8038: Add mainTest cases for Xpath generation and modify inputfiles to support PR #8038", "committedDate": "2020-06-05T21:27:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3MDIyNg==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r439770226", "bodyText": "please explain a reason of this test and this extra commit. Why we need this test in MainTest ?\nif it is to resolve pitest mutation, please clearly state this in commit message.", "author": "romani", "createdAt": "2020-06-13T21:19:03Z", "path": "src/test/java/com/puppycrawl/tools/checkstyle/MainTest.java", "diffHunk": "@@ -1211,6 +1211,75 @@ public void testGenerateXpathSuppressionOptionTwo(@SysErr Capturable systemErr,\n         assertEquals(\"\", systemErr.getCapturedData(), \"Unexpected system error log\");\n     }\n \n+    @Test\n+    public void testGenerateXpathSuppressionOptionIndentation(@SysErr Capturable systemErr,\n+            @SysOut Capturable systemOut) throws IOException {\n+        final String expected = addEndOfLine(\n+            \"<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\",\n+            \"<!DOCTYPE suppressions PUBLIC\",\n+            \"    \\\"-//Checkstyle//DTD SuppressionXpathFilter Experimental Configuration 1.2//EN\\\"\",\n+            \"    \\\"https://checkstyle.org/dtds/suppressions_1_2_xpath_experimental.dtd\\\">\",\n+            \"<suppressions>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/\"\n+                + \"OBJBLOCK/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/MODIFIERS\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/\"\n+                + \"OBJBLOCK/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/\"\n+                + \"VARIABLE_DEF[./IDENT[@text='a']]\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/\"\n+                + \"OBJBLOCK/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/\"\n+                + \"LITERAL_FOR\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/\"\n+                + \"OBJBLOCK/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/\"\n+                + \"LITERAL_FOR/SLIST/EXPR/PLUS_ASSIGN/IDENT[@text='i']\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/\"\n+                + \"OBJBLOCK/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/\"\n+                + \"LITERAL_FOR/SLIST/RCURLY\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/OBJBLOCK\"\n+                + \"/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/LITERAL_IF\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/OBJBLOCK\"\n+                + \"/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/LITERAL_IF/SLIST/\"\n+                + \"LITERAL_RETURN\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/OBJBLOCK\"\n+                + \"/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/LITERAL_IF/SLIST/\"\n+                + \"RCURLY\\\"/>\",\n+            \"<suppress-xpath\",\n+            \"       files=\\\"InputMainGenerateXpathIndentation.java\\\"\",\n+            \"       checks=\\\"IndentationCheck\\\"\",\n+            \"       query=\\\"/CLASS_DEF[./IDENT[@text='InputMainGenerateXpathIndentation']]/OBJBLOCK\"\n+                + \"/METHOD_DEF[./IDENT[@text='generateIndentationXpath']]/SLIST/RCURLY\\\"/>\",\n+            \"</suppressions>\"\n+        );\n+\n+        Main.main(\"-c\", \"/google_checks.xml\", \"--generate-xpath-suppression\",\n+                getPath(\"InputMainGenerateXpathIndentation.java\"));", "originalCommit": "3a3db75bd00d1ed1278d4d8107531637f6532023", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTgxNjcwMw==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r439816703", "bodyText": "Actually,\n\n  \n    \n      checkstyle/src/test/java/com/puppycrawl/tools/checkstyle/MainTest.java\n    \n    \n         Line 1081\n      in\n      c42a0e1\n    \n    \n    \n    \n\n        \n          \n           public void testGenerateXpathSuppressionOptionOne(@SysErr Capturable systemErr, \n        \n    \n  \n\n\nThis method above got overpopulated due to generation of indentation x-path as google check was expecting 2 tab spaces instead of 4.\nThus I changed InputMainComplexityOverflow.java.\n\nWhy we need this test in MainTest ?\n\nAfter alterations there were no MainTest that was checking generated indentation x-path so I thought adding that.\n\nif it is to resolve pitest mutation, please clearly state this in commit message.\n\nI have checked the pitest mutation and maven verification; removing this test doesn't cause any change or mutation violations.\nSo I cant say that they are important or needed anymore.\nShould I remove that now.", "author": "Abhishek-kumar09", "createdAt": "2020-06-14T10:51:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3MDIyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg1NzYxOQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r439857619", "bodyText": "Please remove this commit, MainTest is only care of verification of Main.java file. All xpath in Indentation should be at XpathRegressionIndentationTest , if you think that something is missing at XpathRegressionIndentationTest please extend it.", "author": "romani", "createdAt": "2020-06-14T18:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc3MDIyNg=="}], "type": "inlineReview"}, {"oid": "3bc00e64d8c71296b7c1e86592168ebe21a8f53f", "url": "https://github.com/checkstyle/checkstyle/commit/3bc00e64d8c71296b7c1e86592168ebe21a8f53f", "message": "Pull #8038: Add mainTest cases for Xpath generation and modify inputfiles to support PR #8038", "committedDate": "2020-06-14T10:58:37Z", "type": "forcePushed"}, {"oid": "833352349390e1d1c1a0b254514dfb2774aa901a", "url": "https://github.com/checkstyle/checkstyle/commit/833352349390e1d1c1a0b254514dfb2774aa901a", "message": "Pull #8038: Add mainTest cases for Xpath generation and modify inputfiles to support PR #8038", "committedDate": "2020-06-14T15:33:48Z", "type": "forcePushed"}, {"oid": "63379da5ed1b0eb92596ff06fd841f47d1963a8f", "url": "https://github.com/checkstyle/checkstyle/commit/63379da5ed1b0eb92596ff06fd841f47d1963a8f", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-15T07:15:00Z", "type": "forcePushed"}, {"oid": "04743caea0c2e927abb644376d6aeea605206a9b", "url": "https://github.com/checkstyle/checkstyle/commit/04743caea0c2e927abb644376d6aeea605206a9b", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-15T07:20:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODU2OA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r440908568", "bodyText": "How is this related to the issue of logging violations by AST?", "author": "rnveach", "createdAt": "2020-06-16T14:46:03Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/AbstractExpressionHandler.java", "diffHunk": "@@ -251,26 +251,32 @@ protected boolean shouldIncreaseIndent() {\n     /**\n      * Check the indentation for a set of lines.\n      *\n-     * @param lines              the set of lines to check\n+     * @param astSet             the set of abstract syntax tree to check\n      * @param indentLevel        the indentation level\n      * @param firstLineMatches   whether or not the first line has to match\n      * @param firstLine          first line of whole expression\n+     * @param allowNesting       whether or not subtree nesting is allowed", "originalCommit": "04743caea0c2e927abb644376d6aeea605206a9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0NjQxMQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r441046411", "bodyText": "Here are three types of columnNumbers\n1. ast.columnNumber()\n2. getLineStart()\n3. expandedTabsCoumnNumber()\n\nEarlier we were mapping lineNumbers with the ColumnNumber so there was no chance of confusion... as different conditions requires different columnNumbers...\n\n  \n    \n      checkstyle/src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/AbstractExpressionHandler.java\n    \n    \n         Line 395\n      in\n      7b55584\n    \n    \n    \n    \n\n        \n          \n           if (firstLineMatches && !allowNesting) { \n        \n    \n  \n\n\n        if (firstLineMatches && !allowNesting) {\n            subtreeLines.addLineAndCol(firstLine,\n                getLineStart(indentCheck.getLine(firstLine - 1)));\n        }\n\ne.g. here if above if statement satisfies than we were adding column no. given by getLineStart() else we were adding column no. given by expandedTabsColumnNumber().\nBut Now with latest changes, we are mapping lines with AST, and an AST's column could be get by three types all may have different answers (see list above).\nSo I have passed allowNesting parameter here to check the condition in this method and fetch correct column number inside it.\nIt is been used here at line 274:\n final DetailAST startLineAst = astSet.firstLine();\n            final int endLine = astSet.lastLine();\n            int startCol = expandedTabsColumnNo(astSet.firstLine());\n\n            final int realStartCol =\n                getLineStart(indentCheck.getLine(startLineAst.getLineNo() - 1));\n\n274-------> if (firstLineMatches && !allowNesting) {\n                startCol = realStartCol;\n            }\n\n            if (realStartCol == startCol) {\n                checkLineIndent(startLineAst, indentLevel,\n                    firstLineMatches);\n            }", "author": "Abhishek-kumar09", "createdAt": "2020-06-16T18:11:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3NTEyNA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r443275124", "bodyText": "ast.columnNumber()\n\nWhen we are checking indentation, we should never be using directly this. We should always be expanding this as tabs change the position of the column number based on the tab width.\n\nallowNesting\n\nWhen are these 2 values not equal? It seems to me when they are not equal there is an issue of some kind.", "author": "rnveach", "createdAt": "2020-06-22T00:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0ODcxMA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r443648710", "bodyText": "When we are checking indentation, we should never be using directly this\n\nYes, It is never used.\n\nWhen are these 2 values not equal? It seems to me when they are not equal there is an issue of some kind.\n\nAn example for it.\nI have added an additional test-case for this, here", "author": "Abhishek-kumar09", "createdAt": "2020-06-22T15:35:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwODU2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwOTU3OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r440909579", "bodyText": "Naming is confusing. They are both called \"Line\" but one is an int and the other is an AST.\nstartLine => startLineAst.", "author": "rnveach", "createdAt": "2020-06-16T14:47:24Z", "path": "src/main/java/com/puppycrawl/tools/checkstyle/checks/indentation/AbstractExpressionHandler.java", "diffHunk": "@@ -251,26 +251,32 @@ protected boolean shouldIncreaseIndent() {\n     /**\n      * Check the indentation for a set of lines.\n      *\n-     * @param lines              the set of lines to check\n+     * @param astSet             the set of abstract syntax tree to check\n      * @param indentLevel        the indentation level\n      * @param firstLineMatches   whether or not the first line has to match\n      * @param firstLine          first line of whole expression\n+     * @param allowNesting       whether or not subtree nesting is allowed\n      */\n-    private void checkLinesIndent(LineSet lines,\n+    private void checkLinesIndent(DetailAstSet astSet,\n                                   IndentLevel indentLevel,\n                                   boolean firstLineMatches,\n-                                  int firstLine) {\n-        if (!lines.isEmpty()) {\n+                                  int firstLine,\n+                                  boolean allowNesting) {\n+        if (!astSet.isEmpty()) {\n             // check first line\n-            final int startLine = lines.firstLine();\n-            final int endLine = lines.lastLine();\n-            final int startCol = lines.firstLineCol();\n+            final DetailAST startLine = astSet.firstLine();\n+            final int endLine = astSet.lastLine();", "originalCommit": "04743caea0c2e927abb644376d6aeea605206a9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTA0Nzk3Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r441047977", "bodyText": "Done", "author": "Abhishek-kumar09", "createdAt": "2020-06-16T18:13:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkwOTU3OQ=="}], "type": "inlineReview"}, {"oid": "8cf2d0f0f6689c02cc2f75c248521ba666093960", "url": "https://github.com/checkstyle/checkstyle/commit/8cf2d0f0f6689c02cc2f75c248521ba666093960", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-16T18:11:56Z", "type": "commit"}, {"oid": "8cf2d0f0f6689c02cc2f75c248521ba666093960", "url": "https://github.com/checkstyle/checkstyle/commit/8cf2d0f0f6689c02cc2f75c248521ba666093960", "message": "Issue #7734: Update AbstractChecks to log DetailAST - Indentation", "committedDate": "2020-06-16T18:11:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0Nzg5MA==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r443647890", "bodyText": "When are these 2 values not equal? It seems to me when they are not equal there is an issue of some kind.\n\nHere getLineStart() gives 4 and expandedTabscolumnNumber() gives 16.\nIs it an Issue of some kind.", "author": "Abhishek-kumar09", "createdAt": "2020-06-22T15:34:48Z", "path": "src/test/resources/com/puppycrawl/tools/checkstyle/checks/indentation/indentation/InputIndentationInvalidSwitchIndent.java", "diffHunk": "@@ -101,6 +101,10 @@ private void method1() { //indent:4 exp:4\n \t    \t\tbreak; //indent:16 exp:20 warn\n \t    \telse //indent:12 exp:16 warn\n \t    \t\tbreak; //indent:16 exp:20 warn\n+            case 4: //indent:12 exp:12\n+                s++; //indent:16 exp:16\n+    /* hello */ case 5: //indent:4 exp:12 warn", "originalCommit": "8cf2d0f0f6689c02cc2f75c248521ba666093960", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzgyMzI0Nw==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r443823247", "bodyText": "@romani This does seem like an issue since 2 different methods which sound like they are doing the same thing return different values, especially if they should be used interchangablly. I don't remember how we said we would handle cases like this. I thought the comment indentation would be what we validate for the line but can't remember for sure.", "author": "rnveach", "createdAt": "2020-06-22T21:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0Nzg5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDMwOTE4OQ==", "url": "https://github.com/checkstyle/checkstyle/pull/8038#discussion_r444309189", "bodyText": "Indentation Check is waiting for long reimplementation. we have big pack of issues on it, expected behavior is not clear.", "author": "romani", "createdAt": "2020-06-23T15:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzY0Nzg5MA=="}], "type": "inlineReview"}]}