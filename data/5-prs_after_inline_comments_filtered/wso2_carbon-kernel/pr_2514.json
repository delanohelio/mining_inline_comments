{"pr_number": 2514, "pr_title": "Implement support for mapping and using Active Directory maintained immutable attributes", "pr_createdAt": "2020-01-06T11:59:40Z", "pr_url": "https://github.com/wso2/carbon-kernel/pull/2514", "timeline": [{"oid": "0e9b30d0c9fe6894537d8301e6a4e4ba077a3680", "url": "https://github.com/wso2/carbon-kernel/commit/0e9b30d0c9fe6894537d8301e6a4e4ba077a3680", "message": "Implement support for default attribute usage in Active Directory", "committedDate": "2020-01-08T08:53:22Z", "type": "commit"}, {"oid": "9b0fca329b7b9f24b7d10497641e05fe91b6310f", "url": "https://github.com/wso2/carbon-kernel/commit/9b0fca329b7b9f24b7d10497641e05fe91b6310f", "message": "Fix a typo", "committedDate": "2020-01-08T08:53:22Z", "type": "commit"}, {"oid": "ae276b402b061274b4881ade0df93e27a01d871f", "url": "https://github.com/wso2/carbon-kernel/commit/ae276b402b061274b4881ade0df93e27a01d871f", "message": "Extend the implementation for Unique ID User Stores", "committedDate": "2020-01-08T09:16:56Z", "type": "commit"}, {"oid": "c3c42dab4c843eb3735fa6bf7afb532c00e2c92c", "url": "https://github.com/wso2/carbon-kernel/commit/c3c42dab4c843eb3735fa6bf7afb532c00e2c92c", "message": "Resolve binary attribute value issues in AD", "committedDate": "2020-01-09T04:54:21Z", "type": "commit"}, {"oid": "c3c42dab4c843eb3735fa6bf7afb532c00e2c92c", "url": "https://github.com/wso2/carbon-kernel/commit/c3c42dab4c843eb3735fa6bf7afb532c00e2c92c", "message": "Resolve binary attribute value issues in AD", "committedDate": "2020-01-09T04:54:21Z", "type": "forcePushed"}, {"oid": "b064a8066bcfc16cd925feacbb8c1953269515c7", "url": "https://github.com/wso2/carbon-kernel/commit/b064a8066bcfc16cd925feacbb8c1953269515c7", "message": "Fix formatting issues and java doc comments", "committedDate": "2020-01-13T16:15:54Z", "type": "commit"}, {"oid": "d502ea69ab9abfa48eece2c6a0001d936a961d61", "url": "https://github.com/wso2/carbon-kernel/commit/d502ea69ab9abfa48eece2c6a0001d936a961d61", "message": "Add a doc comment to isBinaryUserAttribute()", "committedDate": "2020-01-13T16:24:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY2MjU1Mg==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r363662552", "bodyText": "Let's re-order the parameters as username,  attribute map (name ->value), profile. It should be consistent with doSetUserClaimValues()", "author": "pulasthi7", "createdAt": "2020-01-07T09:36:34Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -557,8 +557,52 @@ protected void doSetUserClaimValueWithID(String userID, String claimURI, String\n      * @param profileName The profile name, can be null. If null the default profile is considered.\n      * @throws UserStoreException An unexpected exception has occurred\n      */\n-    protected abstract void doSetUserClaimValues(String userName, Map<String, String> claims,\n-                                                 String profileName) throws UserStoreException;\n+    protected void doSetUserClaimValues(String userName, Map<String, String> claims,\n+                                                 String profileName) throws UserStoreException {\n+        if (profileName == null) {\n+            profileName = UserCoreConstants.DEFAULT_PROFILE;\n+        }\n+\n+        // resolving claims to user store attributes\n+        Map<String, String> claimAttributeValueMapForPersist = resolveClaimAttributeMap(userName, claims);\n+\n+        processAttributesBeforeUpdate(claimAttributeValueMapForPersist);\n+\n+        // persist the attribute values map\n+        persistUserStoreAttributeValues(claimAttributeValueMapForPersist, userName, profileName);\n+    }\n+\n+    private Map<String, String> resolveClaimAttributeMap(String userName, Map<String, String> claims) throws UserStoreException {\n+\n+        Map<String, String> claimAttributeValueMap = new HashMap<>();\n+        try {\n+            for (Map.Entry<String, String> claimEntry : claims.entrySet()) {\n+                String claimURI = claimEntry.getKey();\n+                String attributeName = getClaimAtrribute(claimURI, userName, null);\n+                claimAttributeValueMap.put(attributeName, claimEntry.getValue());\n+            }\n+        }  catch (org.wso2.carbon.user.api.UserStoreException e) {\n+            String errorMessage = \"Error occurred while getting claim attribute for user : \" + userName;\n+            if (log.isDebugEnabled()) {\n+                log.debug(errorMessage, e);\n+            }\n+            throw new UserStoreException(errorMessage, e);\n+        }\n+        return claimAttributeValueMap;\n+    }\n+\n+    /**\n+     * Persist a processed map of claim attribute values.\n+     *\n+     * @param processedClaimAttributeValueMapForPersist a processed map of user store attribute valeus\n+     * @param userName userName of the user\n+     * @param profileName The profile name, can be null. If null the default profile is considered.\n+     * @throws UserStoreException An unexpected exception has occurred\n+     */\n+    protected void persistUserStoreAttributeValues(Map<String, String> processedClaimAttributeValueMapForPersist,\n+                                                   String userName, String profileName) throws UserStoreException {", "originalCommit": "e83fcec8f9dbf31f770dce5da758d9dee3efb990", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkyODQ4OA==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365928488", "bodyText": "This is already resolved.\nMethod name was changed to doSetUserAttributes() as well in order to make it consistent with doSetUserAttribute() method.", "author": "gayashanbc", "createdAt": "2020-01-13T17:24:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY2MjU1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkwNDYwOA==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365904608", "bodyText": "include 'e' in the wrapped exception", "author": "pulasthi7", "createdAt": "2020-01-13T16:38:15Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -542,23 +619,76 @@ protected void doSetUserAttribute(String userName, String attributeName, String\n     protected void doSetUserClaimValueWithID(String userID, String claimURI, String claimValue, String profileName)\n             throws UserStoreException {\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(\"doSetUserClaimValueWithID operation is not implemented in: \" + this.getClass());\n+        try {\n+            String attributeName = getClaimAtrribute(claimURI, userID, null);\n+            Map<String, String> userStoreAttributeValueMap = new HashMap<>();\n+            userStoreAttributeValueMap.put(attributeName, claimValue);\n+            processAttributesBeforeUpdate(userStoreAttributeValueMap);\n+\n+            for (Map.Entry<String, String> entry : userStoreAttributeValueMap.entrySet()) {\n+                doSetUserAttributeWithID(userID, entry.getKey(), entry.getValue(), profileName);\n+            }\n+        } catch (org.wso2.carbon.user.api.UserStoreException e) {\n+            throw new UserStoreException(\n+                    \"Error occurred while getting the claim attribute for claimURI: \" + claimURI + \" of the user: \"\n+                            + userID);", "originalCommit": "d502ea69ab9abfa48eece2c6a0001d936a961d61", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkwNDkwNg==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365904906", "bodyText": "include 'e' in the wrapped exception", "author": "pulasthi7", "createdAt": "2020-01-13T16:38:47Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -503,21 +503,38 @@ protected void doDeleteUserWithID(String userID) throws UserStoreException {\n     }\n \n     /**\n-     * Set a single user claim value\n+     * Set a single user claim value.\n      *\n-     * @param userName    The user name\n-     * @param claimURI    The claim URI\n-     * @param claimValue  The value\n+     * @param userName    The user name.\n+     * @param claimURI    The claim URI.\n+     * @param claimValue  The value.\n      * @param profileName The profile name, can be null. If null the default profile is considered.\n-     * @throws UserStoreException An unexpected exception has occurred\n+     * @throws UserStoreException An unexpected exception has occurred.\n      */\n-    protected abstract void doSetUserClaimValue(String userName, String claimURI,\n-                                                String claimValue, String profileName) throws UserStoreException;\n+    protected void doSetUserClaimValue(String userName, String claimURI,\n+                                       String claimValue, String profileName) throws UserStoreException {\n+\n+        try {\n+            String attributeName = getClaimAtrribute(claimURI, userName, null);\n+            Map<String, String> userStoreAttributeValueMap = new HashMap<>();\n+\n+            userStoreAttributeValueMap.put(attributeName, claimValue);\n+            processAttributesBeforeUpdate(userStoreAttributeValueMap);\n+\n+            for (Map.Entry<String, String> entry : userStoreAttributeValueMap.entrySet()) {\n+                doSetUserAttribute(userName, entry.getKey(), entry.getValue(), profileName);\n+            }\n+        } catch (org.wso2.carbon.user.api.UserStoreException e) {\n+            throw new UserStoreException(\n+                    \"Error occurred while getting the claim attribute for claimURI: \" + claimURI + \" of the user: \"\n+                            + userName);", "originalCommit": "d502ea69ab9abfa48eece2c6a0001d936a961d61", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxMDE3Ng==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365910176", "bodyText": "Let's have this like 'Not implemented for AbstractUserStoreManager, may have implementations at subclasses'", "author": "pulasthi7", "createdAt": "2020-01-13T16:48:29Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -7346,6 +7484,28 @@ private void handleRoleAlreadyExistExceptionWithID(String roleName, String[] use\n         return finalValues;\n     }\n \n+    /**\n+     * Handles the processing of any special user store attribute values after retrieval.\n+     *\n+     * @param userAttributes un-processed map (user store attribute name -> attribute value) of user store\n+     *                       attribute values\n+     */\n+    protected void processAttributesAfterRetrieval(Map<String, String> userAttributes) {\n+\n+        // Not implemented.", "originalCommit": "d502ea69ab9abfa48eece2c6a0001d936a961d61", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxNjMwMw==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365916303", "bodyText": "Why was this required?", "author": "pulasthi7", "createdAt": "2020-01-13T16:59:38Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/LDAPConstants.java", "diffHunk": "@@ -34,12 +34,16 @@\n     public static final String LDAP_INITIAL_CONTEXT_FACTORY = \"LDAPInitialContextFactory\";\n     //Property that defines the status of the referral to be used:\n     public static final String PROPERTY_REFERRAL = \"Referral\";\n+    public static final String UID = \"uid\";\n+    public static final String CN = \"cn\";\n+    public static final String CN_CAPITALIZED = \"CN\";", "originalCommit": "d502ea69ab9abfa48eece2c6a0001d936a961d61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkyODkyOA==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365928928", "bodyText": "In the code review, it was suggested using the above constants as they have multiple usages.", "author": "gayashanbc", "createdAt": "2020-01-13T17:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxNjMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkyOTE5OQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365929199", "bodyText": "eg. Read Write LDAP, and Active Directory", "author": "gayashanbc", "createdAt": "2020-01-13T17:26:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxNjMwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTkxNjc4Mw==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r365916783", "bodyText": "remove unnecessary new lines", "author": "pulasthi7", "createdAt": "2020-01-13T17:00:31Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadOnlyLDAPUserStoreManager.java", "diffHunk": "@@ -4555,4 +4555,28 @@ public boolean isUniqueUserIdEnabled() {\n         return false;\n     }\n \n+    /**\n+     * Check whether the given attribute is configured as a binary attribute in the respective user store.\n+     *\n+     * @param attributeName Name of the attribute.\n+     * @return True for a binary attribute, else false.\n+     */\n+    protected boolean isBinaryUserAttribute(String attributeName) {\n+\n+        String ldapBinaryAttributesProperty = Optional.ofNullable(realmConfig\n+                .getUserStoreProperty(LDAPConstants.LDAP_ATTRIBUTES_BINARY)).orElse(\"\");\n+\n+        String[] ldapBinaryAttributes = StringUtils.split(ldapBinaryAttributesProperty, \",\");\n+\n+        if (ArrayUtils.isNotEmpty(ldapBinaryAttributes)) {\n+            if (log.isDebugEnabled()) {\n+                log.debug(\"LDAP binary attributes: \" + Arrays.toString(ldapBinaryAttributes));\n+            }\n+\n+            return ArrayUtils.contains(ldapBinaryAttributes, attributeName);\n+        }\n+", "originalCommit": "d502ea69ab9abfa48eece2c6a0001d936a961d61", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b401f5e31153e92104450e03d71b4ce377b6a0a5", "url": "https://github.com/wso2/carbon-kernel/commit/b401f5e31153e92104450e03d71b4ce377b6a0a5", "message": "Remove unnecessary new lines", "committedDate": "2020-01-14T05:45:37Z", "type": "commit"}, {"oid": "a3daf32d7fe4cfd7853ec5479e5706599222988e", "url": "https://github.com/wso2/carbon-kernel/commit/a3daf32d7fe4cfd7853ec5479e5706599222988e", "message": "Introduce userID variants of new process user attribute hooks", "committedDate": "2020-01-14T09:20:12Z", "type": "commit"}, {"oid": "8e380fb36faa20b7f01dbb5f475779c9159078b8", "url": "https://github.com/wso2/carbon-kernel/commit/8e380fb36faa20b7f01dbb5f475779c9159078b8", "message": "Fix checkstyle issues", "committedDate": "2020-01-14T09:24:20Z", "type": "commit"}, {"oid": "b0cbeadbee1ae14541d91728114398e7a3838f57", "url": "https://github.com/wso2/carbon-kernel/commit/b0cbeadbee1ae14541d91728114398e7a3838f57", "message": "Add 'UserIdSearchFilter' property to Unique ID user stores", "committedDate": "2020-01-14T09:48:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI1MjYxOA==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r366252618", "bodyText": "Use the constant in stringutils", "author": "pulasthi7", "createdAt": "2020-01-14T10:14:07Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ActiveDirectoryUserStoreManager.java", "diffHunk": "@@ -848,7 +847,8 @@ private static void setAdvancedProperty(String name, String displayName, String\n     }\n \n     @Override\n-    protected void processAttributesBeforeUpdate(Map<String, String> userStorePropertyValues) {\n+    protected void processAttributesBeforeUpdate(String userName, Map<String, String> userStorePropertyValues,\n+                                                 String profileName) {\n \n         String immutableAttributesProperty = Optional.ofNullable(realmConfig\n                 .getUserStoreProperty(UserStoreConfigConstants.immutableAttributes)).orElse(\"\");", "originalCommit": "b0cbeadbee1ae14541d91728114398e7a3838f57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI1Mjk0Nw==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r366252947", "bodyText": "Use the constant in stringutils", "author": "pulasthi7", "createdAt": "2020-01-14T10:14:45Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ActiveDirectoryUserStoreManager.java", "diffHunk": "@@ -861,15 +861,16 @@ protected void processAttributesBeforeUpdate(Map<String, String> userStoreProper\n \n         if (ArrayUtils.isNotEmpty(immutableAttributes)) {\n             if (logger.isDebugEnabled()) {\n-                logger.debug(\"Active Directory maintained default attributes: \" + Arrays.toString(immutableAttributes));\n+                logger.debug(\"Skipping Active Directory maintained default attributes: \" + Arrays.toString(immutableAttributes));\n             }\n \n             Arrays.stream(immutableAttributes).map(StringUtils::trim).forEach(userStorePropertyValues::remove);\n         }\n     }\n \n     @Override\n-    protected void processAttributesAfterRetrieval(Map<String, String> userStorePropertyValues) {\n+    protected void processAttributesAfterRetrieval(String userName, Map<String, String> userStorePropertyValues,\n+                                                   String profileName) {\n \n         String timestampAttributesProperty = Optional.ofNullable(realmConfig\n                 .getUserStoreProperty(UserStoreConfigConstants.timestampAttributes)).orElse(\"\");", "originalCommit": "b0cbeadbee1ae14541d91728114398e7a3838f57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjI1MzY4MQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r366253681", "bodyText": "Use a constant to UID", "author": "pulasthi7", "createdAt": "2020-01-14T10:16:18Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/ldap/ReadOnlyLDAPUserStoreManager.java", "diffHunk": "@@ -677,11 +678,11 @@ public boolean doAuthenticate(String userName, Object credential) throws UserSto\n                             // Active Directory attribute: objectGUID\n                             // RFC 4530 attribute: entryUUID\n                             final byte[] bytes = (byte[]) attObject;\n-                            if (bytes.length == 16 && name.endsWith(\"UID\")) {\n+                            if (bytes.length == 16 && name.toUpperCase().endsWith(\"UID\")) {", "originalCommit": "b0cbeadbee1ae14541d91728114398e7a3838f57", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb337ec79e67b99256f44d340beac76523e33ad7", "url": "https://github.com/wso2/carbon-kernel/commit/eb337ec79e67b99256f44d340beac76523e33ad7", "message": "Replace empty string constants with StringUtils.EMPTY", "committedDate": "2020-01-16T04:28:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzIyNzEzMQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r367227131", "bodyText": "shall we refactor this?  should start with a capital and end with \".\"? check-in other places as well", "author": "sarubi", "createdAt": "2020-01-16T04:35:52Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -542,23 +619,76 @@ protected void doSetUserAttribute(String userName, String attributeName, String\n     protected void doSetUserClaimValueWithID(String userID, String claimURI, String claimValue, String profileName)\n             throws UserStoreException {\n \n-        if (log.isDebugEnabled()) {\n-            log.debug(\"doSetUserClaimValueWithID operation is not implemented in: \" + this.getClass());\n+        try {\n+            String attributeName = getClaimAtrribute(claimURI, userID, null);\n+            Map<String, String> userStoreAttributeValueMap = new HashMap<>();\n+            userStoreAttributeValueMap.put(attributeName, claimValue);\n+            processAttributesBeforeUpdateWithID(userID, userStoreAttributeValueMap, profileName);\n+\n+            for (Map.Entry<String, String> entry : userStoreAttributeValueMap.entrySet()) {\n+                doSetUserAttributeWithID(userID, entry.getKey(), entry.getValue(), profileName);\n+            }\n+        } catch (org.wso2.carbon.user.api.UserStoreException e) {\n+            throw new UserStoreException(\n+                    \"Error occurred while getting the claim attribute for claimURI: \" + claimURI + \" of the user: \"\n+                            + userID, e);\n         }\n-        throw new NotImplementedException(\n-                \"doSetUserClaimValueWithID operation is not implemented in: \" + this.getClass());\n     }\n \n     /**\n-     * Set many user claim values\n+     * Set many user claim values.\n      *\n-     * @param userName    The user name\n-     * @param claims      Map of claim URIs against values\n+     * @param userName    The user name.\n+     * @param claims      Map of claim URIs against values.\n      * @param profileName The profile name, can be null. If null the default profile is considered.\n-     * @throws UserStoreException An unexpected exception has occurred\n+     * @throws UserStoreException An unexpected exception has occurred.\n      */\n-    protected abstract void doSetUserClaimValues(String userName, Map<String, String> claims,\n-                                                 String profileName) throws UserStoreException;\n+    protected void doSetUserClaimValues(String userName, Map<String, String> claims,\n+                                        String profileName) throws UserStoreException {\n+\n+        if (profileName == null) {\n+            profileName = UserCoreConstants.DEFAULT_PROFILE;\n+        }\n+\n+        // resolving claims to user store attributes", "originalCommit": "eb337ec79e67b99256f44d340beac76523e33ad7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzIyNzQwMQ==", "url": "https://github.com/wso2/carbon-kernel/pull/2514#discussion_r367227401", "bodyText": "start with a capital and end with \".\", refactor in the following methods as well", "author": "sarubi", "createdAt": "2020-01-16T04:37:09Z", "path": "core/org.wso2.carbon.user.core/src/main/java/org/wso2/carbon/user/core/common/AbstractUserStoreManager.java", "diffHunk": "@@ -7346,6 +7484,54 @@ private void handleRoleAlreadyExistExceptionWithID(String roleName, String[] use\n         return finalValues;\n     }\n \n+    /**\n+     * Handles the processing of any special user store attribute values after retrieval.\n+     *\n+     * @param userName       Username of the user.\n+     * @param userAttributes un-processed map (user store attribute name -> attribute value) of user store\n+     * @param profileName    Profile name of the user.\n+     */\n+    protected void processAttributesAfterRetrieval(String userName, Map<String, String> userAttributes,\n+                                                   String profileName) {\n+        // Not implemented for AbstractUserStoreManager, may have implementations at subclasses.\n+    }\n+\n+    /**\n+     * Handles the processing of any special user store attribute values before update.\n+     *\n+     * @param userName       Username of the user.\n+     * @param userAttributes un-processed map (user store attribute name -> attribute value) of user store", "originalCommit": "eb337ec79e67b99256f44d340beac76523e33ad7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de64fc1a2465763eb862df95c0fb8f18ea55cf7c", "url": "https://github.com/wso2/carbon-kernel/commit/de64fc1a2465763eb862df95c0fb8f18ea55cf7c", "message": "Fix comment format issues in AbstractUserStoreManager.java", "committedDate": "2020-01-16T04:50:23Z", "type": "commit"}, {"oid": "e220ad7154dfcf4c2a80bda1ffcdc1fd755f80f8", "url": "https://github.com/wso2/carbon-kernel/commit/e220ad7154dfcf4c2a80bda1ffcdc1fd755f80f8", "message": "Remove value encoding for UserIdSerchFilter in infer.json", "committedDate": "2020-01-17T06:33:21Z", "type": "commit"}]}