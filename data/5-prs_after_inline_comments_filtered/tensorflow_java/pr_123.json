{"pr_number": 123, "pr_title": "Add Activations", "pr_createdAt": "2020-10-01T19:01:28Z", "pr_url": "https://github.com/tensorflow/java/pull/123", "timeline": [{"oid": "ef0ce67a2e79628380729cf16fb0cd4d99cbe6a3", "url": "https://github.com/tensorflow/java/commit/ef0ce67a2e79628380729cf16fb0cd4d99cbe6a3", "message": "Initial checkin of Keras Optimzers and helper classes.\nFixed dependencies in pom.xml", "committedDate": "2020-07-28T20:26:34Z", "type": "commit"}, {"oid": "9c113a7e6dfcc98c0e57bede8dcb46de56125320", "url": "https://github.com/tensorflow/java/commit/9c113a7e6dfcc98c0e57bede8dcb46de56125320", "message": "Added static final NAME to replace hardcoded String in the create method. This allows the NAME to be used elsewhere instead of hardcoding the string.", "committedDate": "2020-08-20T12:12:27Z", "type": "commit"}, {"oid": "824d4872257a5a614a53c7dff579748b819c800e", "url": "https://github.com/tensorflow/java/commit/824d4872257a5a614a53c7dff579748b819c800e", "message": "Changed of method to use the DataType NAME attribute rather than hardcoding the string.\nadded methods isFloating(), isInteger(), isNUmeric(), isBoolean() and isString()", "committedDate": "2020-08-20T12:14:26Z", "type": "commit"}, {"oid": "07a83a5aef5a25f385aa762e3bb929e22c8052e3", "url": "https://github.com/tensorflow/java/commit/07a83a5aef5a25f385aa762e3bb929e22c8052e3", "message": "Added method WriteFieldWithInitializer to output a \"final static String OP_NAME\" to each generated operation.", "committedDate": "2020-08-20T12:17:40Z", "type": "commit"}, {"oid": "3d26831bab64cc4fdd2340403cafa229f0fb7099", "url": "https://github.com/tensorflow/java/commit/3d26831bab64cc4fdd2340403cafa229f0fb7099", "message": "Added tf.nn.softmaxCrossEntropyWitLogits() and tf.nn.raw.softmaxCrossEntropyWitLogits()\nAdded tf.nn.sparesSoftmaxCrossEntropyWithLogits() and\ntf.nn.raw.sparesSoftmaxCrossEntropyWithLogits()\n\nAdded tf.nn.sigmoidCrossEntropyWithLogits()", "committedDate": "2020-08-20T13:52:13Z", "type": "commit"}, {"oid": "11cda5fde99a6bec21fb04ed1465934ec1889485", "url": "https://github.com/tensorflow/java/commit/11cda5fde99a6bec21fb04ed1465934ec1889485", "message": "Moved SoftmaxCrossEntropyWithLogits and  SparseSoftmaxCrossEntropyWithLogits to org.tensorflow.op.nn.raw", "committedDate": "2020-08-20T13:58:05Z", "type": "commit"}, {"oid": "9c7dfaa92815bf85cbf97febcbb61e1aaf707142", "url": "https://github.com/tensorflow/java/commit/9c7dfaa92815bf85cbf97febcbb61e1aaf707142", "message": "Generated classes now have public static final String OP_NAME = \"XXXXXXXX\";", "committedDate": "2020-08-20T14:00:25Z", "type": "commit"}, {"oid": "84f49db3fb6c085befabfcb8356ab77589facf5d", "url": "https://github.com/tensorflow/java/commit/84f49db3fb6c085befabfcb8356ab77589facf5d", "message": "Generated classes now have public static final String OP_NAME = \"XXXXXXXX\";", "committedDate": "2020-08-20T14:03:38Z", "type": "commit"}, {"oid": "208b84a1a09d38ab9821d66572c1328326685c5a", "url": "https://github.com/tensorflow/java/commit/208b84a1a09d38ab9821d66572c1328326685c5a", "message": "fix dependencies for other Tensorflow Java modules", "committedDate": "2020-08-20T14:42:22Z", "type": "commit"}, {"oid": "39131619f3a4c970f5f62dacdbaa93ac3f9bf996", "url": "https://github.com/tensorflow/java/commit/39131619f3a4c970f5f62dacdbaa93ac3f9bf996", "message": "formatting fix", "committedDate": "2020-08-20T14:46:20Z", "type": "commit"}, {"oid": "b5a7c0f9f54acf1fb0f57003027aa0843ae67c82", "url": "https://github.com/tensorflow/java/commit/b5a7c0f9f54acf1fb0f57003027aa0843ae67c82", "message": "Fix ctors with name to properly pass the name to the the super ctor.", "committedDate": "2020-08-20T14:48:23Z", "type": "commit"}, {"oid": "fcba0a525d4712fca5210db71c141bc1bce87307", "url": "https://github.com/tensorflow/java/commit/fcba0a525d4712fca5210db71c141bc1bce87307", "message": "change asserts to IllegalArgumentException\nfix javadoc, fix casts", "committedDate": "2020-08-20T17:04:27Z", "type": "commit"}, {"oid": "960cfc3ca4e010fca3bd549df6d16a17fb0b22bc", "url": "https://github.com/tensorflow/java/commit/960cfc3ca4e010fca3bd549df6d16a17fb0b22bc", "message": "change asserts to IllegalArgumentException", "committedDate": "2020-08-20T17:05:22Z", "type": "commit"}, {"oid": "d37298a6b9dcb206cdff985b96e340f7f93a075c", "url": "https://github.com/tensorflow/java/commit/d37298a6b9dcb206cdff985b96e340f7f93a075c", "message": "Moved back to tests", "committedDate": "2020-08-20T17:06:58Z", "type": "commit"}, {"oid": "c68812cc9c8815b0ea186f273748078c4907fbaa", "url": "https://github.com/tensorflow/java/commit/c68812cc9c8815b0ea186f273748078c4907fbaa", "message": "Moved SoftmaxCrossEntropyWithLogits.java and SparseSoftmaxCrossEntropyWithLogits.java to nn.raw,\nadded new versions of these to NnOps", "committedDate": "2020-08-20T17:08:44Z", "type": "commit"}, {"oid": "6b8eb26edafc54a70d6c5a1bd9e21cacf3ac04e7", "url": "https://github.com/tensorflow/java/commit/6b8eb26edafc54a70d6c5a1bd9e21cacf3ac04e7", "message": "Deleted files that are not necessary yet", "committedDate": "2020-08-20T17:50:01Z", "type": "commit"}, {"oid": "6515c248ddd8f6911f267bee0972d44ca20f0038", "url": "https://github.com/tensorflow/java/commit/6515c248ddd8f6911f267bee0972d44ca20f0038", "message": "Added nn.raw group for softmaxCrossEntropyWithLogits() and sparseSoftmaxCrossEntropyWithLogits()", "committedDate": "2020-08-20T17:51:04Z", "type": "commit"}, {"oid": "76d0fe553559176a33040b4bdb8e07d8e033b08e", "url": "https://github.com/tensorflow/java/commit/76d0fe553559176a33040b4bdb8e07d8e033b08e", "message": "Added nn.raw group for softmaxCrossEntropyWithLogits() and sparseSoftmaxCrossEntropyWithLogits()", "committedDate": "2020-08-20T18:30:16Z", "type": "commit"}, {"oid": "d2201df3a78e82c79b142fc7d7c3a461afa63444", "url": "https://github.com/tensorflow/java/commit/d2201df3a78e82c79b142fc7d7c3a461afa63444", "message": "Merge branch 'master' into master", "committedDate": "2020-08-20T19:43:35Z", "type": "commit"}, {"oid": "ab379d1b49d90bb42c8654f2e0cf0c258e0d3406", "url": "https://github.com/tensorflow/java/commit/ab379d1b49d90bb42c8654f2e0cf0c258e0d3406", "message": "Refactor NN into individual operations under org.tensorflow.op.nn. Fix JavaDoc. Change from snake case to camel case.", "committedDate": "2020-09-03T14:21:27Z", "type": "commit"}, {"oid": "889d67e11ec7154605a0cb235097e30c53a5704a", "url": "https://github.com/tensorflow/java/commit/889d67e11ec7154605a0cb235097e30c53a5704a", "message": "Refactor NN into individual operations under org.tensorflow.op.nn. Fix JavaDoc. Change from snake case to camel case.", "committedDate": "2020-09-03T14:21:33Z", "type": "commit"}, {"oid": "515b799bf793fbb38a47b5aa92d948dad052187b", "url": "https://github.com/tensorflow/java/commit/515b799bf793fbb38a47b5aa92d948dad052187b", "message": "Reformatted code", "committedDate": "2020-09-03T14:34:57Z", "type": "commit"}, {"oid": "5a9fe3747b730cbfb28b544bcac3aeb2077499a2", "url": "https://github.com/tensorflow/java/commit/5a9fe3747b730cbfb28b544bcac3aeb2077499a2", "message": "Added sub scope", "committedDate": "2020-09-03T14:35:19Z", "type": "commit"}, {"oid": "8d21dd7266e48a4df36813ed3fb9dc1adee58915", "url": "https://github.com/tensorflow/java/commit/8d21dd7266e48a4df36813ed3fb9dc1adee58915", "message": "Miscellaneous fixes based on review comments.", "committedDate": "2020-09-03T16:30:10Z", "type": "commit"}, {"oid": "4c3cc78a999505240be35040b8865d86b955e1af", "url": "https://github.com/tensorflow/java/commit/4c3cc78a999505240be35040b8865d86b955e1af", "message": "Fixed op_generator.cc to remove a spurious new line in the generated Java files for some Ops. This also  resulted in new generated  source that are also committed.", "committedDate": "2020-09-03T22:52:11Z", "type": "commit"}, {"oid": "44f530f292fdba34164de696fb454b30108064d3", "url": "https://github.com/tensorflow/java/commit/44f530f292fdba34164de696fb454b30108064d3", "message": "Changed back to non-generic Operand until we resolve how to handle generics.", "committedDate": "2020-09-03T22:53:44Z", "type": "commit"}, {"oid": "b8d3ac2d001251c95bd55ed9cd902431108468bd", "url": "https://github.com/tensorflow/java/commit/b8d3ac2d001251c95bd55ed9cd902431108468bd", "message": "Regenerated due to creation of SoftmaxCrossEntropyWithLogits.java,  SigmoidCrossEntropyWithLogits.java, and SparseSoftmaxCrossEntropyWithLogits.java under package org.tensorflow.op.nn in", "committedDate": "2020-09-03T22:55:55Z", "type": "commit"}, {"oid": "c32fc5be951166ffde8d8763dcc99dd7e5879e86", "url": "https://github.com/tensorflow/java/commit/c32fc5be951166ffde8d8763dcc99dd7e5879e86", "message": "change snake case to camel case. format code", "committedDate": "2020-09-07T18:15:30Z", "type": "commit"}, {"oid": "171cd2f4f9878b00e35f3175b0a8c7954ef21f07", "url": "https://github.com/tensorflow/java/commit/171cd2f4f9878b00e35f3175b0a8c7954ef21f07", "message": "clean upd warning,  format code", "committedDate": "2020-09-07T18:38:12Z", "type": "commit"}, {"oid": "e9c3134742e9155e457be157515d67b5c0bb7ac4", "url": "https://github.com/tensorflow/java/commit/e9c3134742e9155e457be157515d67b5c0bb7ac4", "message": "Added Adamax, Ftrl, and Nadam Optimizers. Added Optimizers enum for easy inclusion of a default optimizer. Cleaned up JavaDoc", "committedDate": "2020-09-09T20:14:20Z", "type": "commit"}, {"oid": "5c30a72fa335f338727358b4299e4796a211403d", "url": "https://github.com/tensorflow/java/commit/5c30a72fa335f338727358b4299e4796a211403d", "message": "Removed optimize classes from tensorflow-keras, moved optimizer test cases to framework. Created Tests for GradientDescent and Momentum", "committedDate": "2020-09-09T20:17:16Z", "type": "commit"}, {"oid": "ebefc2ea54b2f3d53b8b8f92912175eac50330d0", "url": "https://github.com/tensorflow/java/commit/ebefc2ea54b2f3d53b8b8f92912175eac50330d0", "message": "Fixed generics", "committedDate": "2020-09-09T20:17:37Z", "type": "commit"}, {"oid": "7915e6309e9db7a536cda24eac8264578cdbfe31", "url": "https://github.com/tensorflow/java/commit/7915e6309e9db7a536cda24eac8264578cdbfe31", "message": "Fixed from Unit test results", "committedDate": "2020-09-09T23:03:09Z", "type": "commit"}, {"oid": "ec4f6790ff666a4c23f60e1b4764874d6167d392", "url": "https://github.com/tensorflow/java/commit/ec4f6790ff666a4c23f60e1b4764874d6167d392", "message": "added @SuppressWarnings(\"unchecked\") on Variable array", "committedDate": "2020-09-09T23:08:41Z", "type": "commit"}, {"oid": "c86d09b74a4a02b173604f206161ed37b804d0a9", "url": "https://github.com/tensorflow/java/commit/c86d09b74a4a02b173604f206161ed37b804d0a9", "message": "Merge pull request #1 from tensorflow/master\n\nSync Clarke fork", "committedDate": "2020-09-18T23:51:10Z", "type": "commit"}, {"oid": "1a670ec9eef5a2843dca1cd505d1c5589e3de6f8", "url": "https://github.com/tensorflow/java/commit/1a670ec9eef5a2843dca1cd505d1c5589e3de6f8", "message": "Added Support for evaluating TFloat16", "committedDate": "2020-09-30T19:27:47Z", "type": "commit"}, {"oid": "0cc9b9cde27e28afe16accfc785380e8ff39929d", "url": "https://github.com/tensorflow/java/commit/0cc9b9cde27e28afe16accfc785380e8ff39929d", "message": "Add Activations", "committedDate": "2020-10-01T18:34:59Z", "type": "commit"}, {"oid": "ca77a0b78e419447a994e3c919c39689575bb8f4", "url": "https://github.com/tensorflow/java/commit/ca77a0b78e419447a994e3c919c39689575bb8f4", "message": "Remove no-arg CTORs", "committedDate": "2020-10-01T18:37:17Z", "type": "commit"}, {"oid": "73091becbb882d55295fa16256c1133ed9c87be4", "url": "https://github.com/tensorflow/java/commit/73091becbb882d55295fa16256c1133ed9c87be4", "message": "Fix Unit Tests to include positive and negative numbers on input.", "committedDate": "2020-10-01T18:39:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4OTUxNg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498489516", "bodyText": "How does this emit negative zero? Could we catch that and emit a positive zero?", "author": "Craigacp", "createdAt": "2020-10-01T20:14:59Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(\n+ *              new float[] {-10f, -5f, 0.0f, 5f, 10f});\n+ *\n+ *     // With default parameters\n+ *     ReLU&lt;TFloat32&gt; relu = new ReLU&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = relu.call(input);\n+ *     // result is [0.f,  0.f,  0.f,  5.f, 10.f]\n+ *\n+ *     // With alpha = 0.5\n+ *     relu = new ReLU&lt;&gt;(tf, 0.5f, ReLU.MAX_VALUE_DEFAULT, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [-5.f , -2.5f,  0.f ,  5.f , 10.f]\n+ *\n+ *     // With maxValue = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, 5f, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [0.f, 0.f, 0.f, 5.f, 5.f]\n+ *\n+ *     // With threshold = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, ReLU.MAX_VALUE_DEFAULT, 5f);\n+ *     result = relu.call(input);\n+ *     // result is [-0.f, -0.f,  0.f,  0.f, 10.f]", "originalCommit": "73091becbb882d55295fa16256c1133ed9c87be4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUzMTc1Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498531756", "bodyText": "I am not sure who is the culprit here. It seems to be the result of the multiply operation of a negative number * zero always produces -0, maybe this is a Pyhtonism.\nHere is the same operation in just Numpy:\na = np.array([-10., -5., 0.0, 5., 10.], dtype=np.float32)\nc = np.greater(a, 5.)\nprint(c);\n[False False False False  True]\n\nc = np.cast['float32'](c)\nprint(c)\n[0. 0. 0. 0. 1.]\n\nd = a * c\nprint(d)\n[-0. -0.  0.  0. 10.]\n\nz = -1. * 0.\nprint(z)\n-0.0\n\n\nTensorFlow Python and TensorFlow Java produce the same -0 result.\nIf you don't want this behavior, we could add zero to the final result, because -0 + 0 = 0.", "author": "JimClarke5", "createdAt": "2020-10-01T21:52:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4OTUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyNzU3Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509827576", "bodyText": "@Craigacp , do you have any other comment about this?", "author": "karllessard", "createdAt": "2020-10-22T01:32:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4OTUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4NTg3Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r511485876", "bodyText": "If TF python is doing it then I guess it's fine.", "author": "Craigacp", "createdAt": "2020-10-24T15:50:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ4OTUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MzE0MA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498493140", "bodyText": "Does this work on a vector now the check has been removed?", "author": "Craigacp", "createdAt": "2020-10-01T20:22:44Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Softmax.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.ndarray.Shape;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.core.ReduceMax;\n+import org.tensorflow.op.core.ReduceSum;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Softmax converts a real vector to a vector of categorical probabilities.\n+ *\n+ * <p>The elements of the output vector are in range (0, 1) and sum to 1.\n+ *\n+ * <p>Each vector is handled independently. The <code>axis</code>>argument sets which axis of the\n+ * input the function is applied along.\n+ *\n+ * <p>Softmax is often used as the activation for the last layer of a classification network because\n+ * the result could be interpreted as a probability distribution.\n+ *\n+ * <p>The softmax of each vector x is computed as: <code>exp(x) / tf.reduce_sum(exp(x))</code>.\n+ *\n+ * <p>The input values in are the log-odds of the resulting probability.\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public class Softmax<T extends TNumber> extends Activation<T> {\n+\n+  private static final int AXIS_DEFAULT = -1;\n+\n+  private final int axis;\n+\n+  /**\n+   * Creates a softmax activation where the default axis is {@link #AXIS_DEFAULT} which indicates\n+   * the last dimension.\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public Softmax(Ops tf) {\n+    this(tf, AXIS_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a Softmax activation\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param axis The dimension softmax would be performed on.\n+   */\n+  public Softmax(Ops tf, int axis) {\n+    super(tf);\n+    this.axis = axis;\n+  }\n+\n+  /**\n+   * Gets the calculation operation for the activation.\n+   *\n+   * @param input the input tensor\n+   * @return The operand for the activation\n+   */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+    if (!input.asOutput().dataType().isFloating()) {\n+      throw new IllegalArgumentException(\n+          \"Must be a Floating Point DataType: \" + input.asOutput().dataType());\n+    }\n+    Shape shape = input.asOutput().shape();\n+    int numDimensions = shape.numDimensions();\n+    if (numDimensions == 2) {\n+      return tf.nn.softmax(input);\n+    } else {\n+      Operand<T> e =\n+          tf.math.exp(\n+              tf.math.sub(input, tf.reduceMax(input, tf.constant(axis), ReduceMax.keepDims(true))));\n+      Operand<T> s = tf.reduceSum(input, tf.constant(axis), ReduceSum.keepDims(true));\n+      return tf.math.div(e, s);", "originalCommit": "73091becbb882d55295fa16256c1133ed9c87be4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg2Nzk0NA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498867944", "bodyText": "Yes it works, I have added tests for 1D and 3D to make both path are covered.", "author": "JimClarke5", "createdAt": "2020-10-02T14:46:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5MzE0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5NDE5OQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498494199", "bodyText": "This should probably note that the linear activation function is the identity function.", "author": "Craigacp", "createdAt": "2020-10-01T20:25:09Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Linear.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Linear activation function.\n+ *", "originalCommit": "73091becbb882d55295fa16256c1133ed9c87be4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg2ODI4OQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498868289", "bodyText": "I have updated the JavaDoc to indicate that this is also known as Identity activation.", "author": "JimClarke5", "createdAt": "2020-10-02T14:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODQ5NDE5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUwMjU5Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498502593", "bodyText": "This should test that a negative or near zero value behaves appropriately rather than just the linear region.", "author": "Craigacp", "createdAt": "2020-10-01T20:43:42Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/SoftplusTest.java", "diffHunk": "@@ -0,0 +1,96 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.junit.jupiter.api.*;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.utils.TestSession;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TFloat32;\n+import org.tensorflow.types.TFloat64;\n+import org.tensorflow.types.TInt32;\n+\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+/** @author Jim Clarke */\n+public class SoftplusTest {\n+\n+  private final TestSession.Mode[] tfModes = {TestSession.Mode.EAGER, TestSession.Mode.GRAPH};\n+\n+  public SoftplusTest() {}\n+\n+  @BeforeAll\n+  public static void setUpClass() {}\n+\n+  @AfterAll\n+  public static void tearDownClass() {}\n+\n+  @BeforeEach\n+  public void setUp() {}\n+\n+  @AfterEach\n+  public void tearDown() {}\n+\n+  /** Test of Softplus call method */\n+  @Test\n+  public void testCall__Int() {\n+    int[] input = {1, -2, 3, -4, -1, 2, -3, 4};\n+\n+    for (TestSession.Mode tfMode : tfModes)\n+      assertThrows(\n+          java.lang.IllegalArgumentException.class,\n+          () -> {\n+            try (TestSession session = TestSession.createTestSession(tfMode)) {\n+              Ops tf = session.getTF();\n+              Softplus<TInt32> instance = new Softplus<>(tf);\n+              Operand<TInt32> result = instance.call(tf.constant(input));\n+            }\n+          });\n+  }\n+\n+  /** Test of Softplus call method */\n+  @Test\n+  public void testCall__Float() {\n+    float[] input = {1, 2, 3, 4, 5, 6, 7, 8};\n+    float[] expected = {\n+      1.3132616F, 2.126928F, 3.0485873F, 4.01815F, 5.0067153F, 6.0024757F, 7.0009117F, 8.000336F\n+    };\n+    for (TestSession.Mode tfMode : tfModes)\n+      try (TestSession session = TestSession.createTestSession(tfMode)) {\n+        Ops tf = session.getTF();\n+        Softplus<TFloat32> instance = new Softplus<>(tf);\n+        Operand<TFloat32> result = instance.call(tf.constant(input));\n+        session.evaluate(expected, result);\n+      }\n+  }\n+\n+  /** Test of Softplus call method */\n+  @Test\n+  public void testCall__Double() {\n+    double[] input = {1, 2, 3, 4, 5, 6, 7, 8};\n+    double[] expected = {\n+      1.3132616875182228, 2.1269280110429727, 3.048587351573742,", "originalCommit": "73091becbb882d55295fa16256c1133ed9c87be4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg2OTEyNw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498869127", "bodyText": "I have modified the input to use a combination of positive and negative values.", "author": "JimClarke5", "createdAt": "2020-10-02T14:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUwMjU5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUwMzM4Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498503382", "bodyText": "It would be nice to have a test for the 3-tensor and a vector input as they have different code paths.", "author": "Craigacp", "createdAt": "2020-10-01T20:45:26Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/SoftmaxTest.java", "diffHunk": "@@ -0,0 +1,112 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.junit.jupiter.api.*;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.utils.TestSession;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TFloat32;\n+import org.tensorflow.types.TFloat64;\n+import org.tensorflow.types.TInt32;\n+\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+/** @author Jim Clarke */\n+public class SoftmaxTest {\n+\n+  private final TestSession.Mode[] tfModes = {TestSession.Mode.EAGER, TestSession.Mode.GRAPH};\n+\n+  public SoftmaxTest() {}\n+\n+  @BeforeAll\n+  public static void setUpClass() {}\n+\n+  @AfterAll\n+  public static void tearDownClass() {}\n+\n+  @BeforeEach\n+  public void setUp() {}\n+\n+  @AfterEach\n+  public void tearDown() {}\n+\n+  /** Test of Softmax method, of class Activations. */\n+  @Test\n+  public void testIntThrowsIAE() {\n+    int[][] input = {{1, -2, 3, -4}, {-1, 2, -3, 4}};\n+    for (TestSession.Mode tfMode : tfModes)\n+      assertThrows(\n+          java.lang.IllegalArgumentException.class,\n+          () -> {\n+            try (TestSession session = TestSession.createTestSession(tfMode)) {\n+              Ops tf = session.getTF();\n+              Softmax<TInt32> instance = new Softmax<>(tf);\n+              Operand<TInt32> result = instance.call(tf.constant(input));\n+            }\n+          });\n+  }\n+\n+  /** Test of Softmax method, of class Activations. */\n+  @Test\n+  public void testSoftmax_Ops_Operand_Float() {\n+    float[][] input = {{1, 2, 3, 4}, {5, 6, 7, 8}};\n+    float[][] expected = {\n+      {0.032059f, 0.087144f, 0.236883f, 0.643914f},\n+      {0.032059f, 0.087144f, 0.236883f, 0.643914f}\n+    };\n+    for (TestSession.Mode tfMode : tfModes)\n+      try (TestSession session = TestSession.createTestSession(tfMode)) {\n+        Ops tf = session.getTF();\n+        Softmax<TFloat32> instance = new Softmax<>(tf);\n+        Operand<TFloat32> result = instance.call(tf.constant(input));\n+        session.evaluate(tf.constant(expected), result);\n+      }\n+  }\n+\n+  /** Test of Softmax method, of class Activations. */\n+  @Test\n+  public void testSoftmax_Ops_Operand_Double() {\n+    double[][] input = {{1, 2, 3, 4}, {5, 6, 7, 8}};", "originalCommit": "73091becbb882d55295fa16256c1133ed9c87be4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg2OTQxMw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498869413", "bodyText": "I have added a test for 3D input", "author": "JimClarke5", "createdAt": "2020-10-02T14:49:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODUwMzM4Mg=="}], "type": "inlineReview"}, {"oid": "946d1d5251c3f9b6b9219e68cea6134f7985224f", "url": "https://github.com/tensorflow/java/commit/946d1d5251c3f9b6b9219e68cea6134f7985224f", "message": "Modify JavaDoc indicating Linear activation is also known as Identity activation", "committedDate": "2020-10-02T14:42:34Z", "type": "commit"}, {"oid": "7c5cc4add70e70847e6852c6a3fce424b70d8925", "url": "https://github.com/tensorflow/java/commit/7c5cc4add70e70847e6852c6a3fce424b70d8925", "message": "Changed DEFAULT values from private to public", "committedDate": "2020-10-02T14:43:16Z", "type": "commit"}, {"oid": "e32fe44207a95105f8d3babbb157197df59bd5ef", "url": "https://github.com/tensorflow/java/commit/e32fe44207a95105f8d3babbb157197df59bd5ef", "message": "Fixed last sum to be over 'e' instead of 'input'", "committedDate": "2020-10-02T14:44:03Z", "type": "commit"}, {"oid": "013091422585ffab264f80f0ff4036d5a714f2a6", "url": "https://github.com/tensorflow/java/commit/013091422585ffab264f80f0ff4036d5a714f2a6", "message": "Added tests for various parameter constructs.", "committedDate": "2020-10-02T14:45:12Z", "type": "commit"}, {"oid": "c7d04774ea5e6a337f8f79c254deefb46d6270a6", "url": "https://github.com/tensorflow/java/commit/c7d04774ea5e6a337f8f79c254deefb46d6270a6", "message": "added tests for 1D and 3D input", "committedDate": "2020-10-02T14:45:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk2OTIzNw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498969237", "bodyText": "Still snake_case, looks like the find replace didn't get all of them.", "author": "Craigacp", "createdAt": "2020-10-02T18:00:04Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/ReLUTest.java", "diffHunk": "@@ -82,7 +82,7 @@ public void testCall__Long() {\n \n   /** Test of ReLU call method */\n   @Test\n-  public void testCall__Float16() {\n+  public void testCall_Float16() {", "originalCommit": "c7d04774ea5e6a337f8f79c254deefb46d6270a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA0NjUzMg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499046532", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-02T20:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk2OTIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk2OTM5Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r498969393", "bodyText": "Swap the snake_case for camelCase.", "author": "Craigacp", "createdAt": "2020-10-02T18:00:23Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/SoftmaxTest.java", "diffHunk": "@@ -109,4 +111,38 @@ public void testSoftmax_Ops_Operand_Double_Negative() {\n         session.evaluate(tf.constant(expected), result);\n       }\n   }\n+\n+  /** Test of Softmax method, of class Activations. */\n+  @Test\n+  public void testSoftmax_1D() {", "originalCommit": "c7d04774ea5e6a337f8f79c254deefb46d6270a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA0NjU5Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499046592", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-02T20:56:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk2OTM5Mw=="}], "type": "inlineReview"}, {"oid": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "url": "https://github.com/tensorflow/java/commit/de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "message": "Change snake case to camel case", "committedDate": "2020-10-02T20:55:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MDUwMQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499160501", "bodyText": "Is it ok for the caller to provide null in this constructor and then use setTf(Ops) later? How do we feel about using  nullability annotations?\nI'd argue that at minimum, for our public APIs, we should always document whether null is acceptable or not (unless utterly clear from the context), and that the annotations are an easier and more useful way of doing that. Here's someone who landed on using JSR 305 annotations and provides a careful explanation of why.", "author": "deansher", "createdAt": "2020-10-03T16:11:59Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Activation.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Abstract base class for Activations\n+ *\n+ * <p><b>Note:</b> The {@link #tf} attribute must be set prior to invoking the call method. See\n+ * {@link #setTF(Ops)} and the constructor {@link #Activation(Ops)}.\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public abstract class Activation<T extends TNumber> {\n+\n+  /** The TensorFlow Ops */\n+  protected Ops tf;\n+\n+  /**\n+   * Creates the abstract class for an Activation\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  protected Activation(Ops tf) {", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyMTUzMg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505121532", "bodyText": "We've already discussed about adding the @Nullable annotation but this is not part of the standard JDK and we need to bring additional dependencies, which we try to avoid as much as possible to avoid conflict with other version of that same dependency that might have been imported by the user.\nThat's being said, when we discussed about it, it was related to the Core API. I'm OK though to bring more dependencies in the framework if we need to.", "author": "karllessard", "createdAt": "2020-10-15T02:07:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MDUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU4MDExMw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509580113", "bodyText": "The present @Nullable is in a private Java api and will break after Java 8.", "author": "JimClarke5", "createdAt": "2020-10-21T18:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MDUwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMjIxNQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509802215", "bodyText": "Ok I suggest we keep the @Nullable introduction for the future, outside this PR", "author": "karllessard", "createdAt": "2020-10-22T00:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MDUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499161306", "bodyText": "Here, for example, is where it seems clear enough to me that input shouldn't be nullable, that I wouldn't care as much about documenting or annotating it. That said, my personal favorite would be to thoroughly annotate, which could be partly done through package-level defaults.", "author": "deansher", "createdAt": "2020-10-03T16:21:53Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Activation.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Abstract base class for Activations\n+ *\n+ * <p><b>Note:</b> The {@link #tf} attribute must be set prior to invoking the call method. See\n+ * {@link #setTF(Ops)} and the constructor {@link #Activation(Ops)}.\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public abstract class Activation<T extends TNumber> {\n+\n+  /** The TensorFlow Ops */\n+  protected Ops tf;\n+\n+  /**\n+   * Creates the abstract class for an Activation\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  protected Activation(Ops tf) {\n+    this.tf = tf;\n+  }\n+\n+  /**\n+   * Sets the TensorFlow Ops\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  protected void setTF(Ops tf) {\n+    this.tf = tf;\n+  }\n+\n+  /**\n+   * Gets the TensorFlow Ops\n+   *\n+   * @return the TensorFlow Ops\n+   */\n+  protected Ops getTF() {\n+    return this.tf;\n+  }\n+\n+  /**\n+   * Gets the calculation operation for the activation.\n+   *\n+   * @param input the input tensor\n+   * @return The operand for the activation\n+   */\n+  public abstract Operand<T> call(Operand<T> input);", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyMjYxOQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505122619", "bodyText": "I agree with annotating @Nullable fields in the framework, especially that other JVM languages like Kotlin handle nullable values in a very specific way. Should we do it in this PR or go through all our classes later?", "author": "karllessard", "createdAt": "2020-10-15T02:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzNTg5NQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r506435895", "bodyText": "My leaning would be to do it as a separate complete pass that results in a new invariant in the build, like tool X with configuration Y gives no warnings. Also, that would let us agree on conventions and then bootstrap following them throughout the framework API.", "author": "deansher", "createdAt": "2020-10-16T13:41:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU4MTQ4Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509581487", "bodyText": "OK", "author": "JimClarke5", "createdAt": "2020-10-21T18:54:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc1NjM3Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509756373", "bodyText": "BTW, we can use Lombok for that kind of stuff. It needs a dependency that's used only by the compiler, it's not required at runtime.", "author": "saudet", "createdAt": "2020-10-21T22:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyNzAyNg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509827026", "bodyText": "But like I was explaining, @Nullable has some other benefits, e.g. this is what Kotlin compiler uses to know if a value from an external Java library is nullable or not (since it handles these two differently).\nAnyway as I suggested previously, we should probably keep this for another PR.", "author": "karllessard", "createdAt": "2020-10-22T01:30:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyODM2OQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509828369", "bodyText": "Hum, from what I understand that's what Optional is for and that's in Java SE 8. Wouldn't that do? We can make it such that anything that isn't Optional can't be null. Anyway, something for a future PR, yes.", "author": "saudet", "createdAt": "2020-10-22T01:35:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTMwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTQwMA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499161400", "bodyText": "&gt -> &lt", "author": "deansher", "createdAt": "2020-10-03T16:23:29Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ELU.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TBool;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Exponential linear unit.\n+ *\n+ * <p>The exponential linear unit (ELU) with <code>alpha &gt; 0</code> is:\n+ *\n+ * <p><code>x</code> if <code>x &gt; 0</code> and <code>alpha * (exp(x) -\n+ * 1)</code> if <code>x &gt; 0</code>.", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU4MzE2Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509583163", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-21T18:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTQwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTY3Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499161673", "bodyText": "ELU -> Operand", "author": "deansher", "createdAt": "2020-10-03T16:27:07Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ELU.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TBool;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Exponential linear unit.\n+ *\n+ * <p>The exponential linear unit (ELU) with <code>alpha &gt; 0</code> is:\n+ *\n+ * <p><code>x</code> if <code>x &gt; 0</code> and <code>alpha * (exp(x) -\n+ * 1)</code> if <code>x &gt; 0</code>.\n+ *\n+ * <p>The ELU hyperparameter <code>alpha</code> controls the value to which an ELU saturates for\n+ * negative net inputs. ELUs diminish the vanishing gradient effect.\n+ *\n+ * <p>ELUs have negative values which pushes the mean of the activations closer to zero. Mean\n+ * activations that are closer to zero enable faster learning as they bring the gradient closer to\n+ * the natural gradient. ELUs saturate to a negative value when the argument gets smaller.\n+ * Saturation means a small derivative which decreases the variation and the information that is\n+ * propagated to the next layer.\n+ *\n+ * <p>Example Usage:\n+ *\n+ * <pre>\n+ *     ELU&lt;TFloat32&gt; input = ...;", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3OTU1Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499279557", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-04T19:20:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MTY3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MjkwNg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499162906", "bodyText": "This will come up a lot! Define a helper somewhere?", "author": "deansher", "createdAt": "2020-10-03T16:43:21Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Exponential.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Exponential activation function.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *   Operand&lt;TFloat32&gt; input = tf.constant(\n+ *          new float[] {-3.0f,-1.0f, 0.0f,1.0f,3.0f});\n+ *   Exponential&lt;TFloat32&gt; exp = new Exponential&lt;&gt;(tf);\n+ *   Operand&lt;TFloat32&gt; result = exp.call(input);\n+ *   // result is [0.04978707f,  0.36787945f,  1.f,  2.7182817f, 20.085537f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public class Exponential<T extends TNumber> extends Activation<T> {\n+\n+  /**\n+   * Creates an Exponential activation.\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public Exponential(Ops tf) {\n+    super(tf);\n+  }\n+\n+  /**\n+   * Calculates the Exponential activation.\n+   *\n+   * @param input the input tensor\n+   * @return an Operand for the exponential activation: <code>exp(x)</code>.\n+   * @throws IllegalArgumentException if the input is not a floating type\n+   */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+    if (!input.asOutput().dataType().isFloating()) {", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyMzY4MA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505123680", "bodyText": "Ultimately, we would have a TFloating family that can the be bound to the T parameter of that method (this family is present in PR #92 ).", "author": "karllessard", "createdAt": "2020-10-15T02:15:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MjkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjQzNzIwMA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r506437200", "bodyText": "Good point, so this is fine for now.", "author": "deansher", "createdAt": "2020-10-16T13:43:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MjkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwNjk0MA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r508106940", "bodyText": "I would even say that if you feel adding TFloating right now @JimClarke5 , go ahead, just extend TNumber from it and implement it in all floating point tensor types we have (TFloat32, TFloat16, ...). Then you can remove all these type checks at runtime by binding T to TFloating, i.e. Exponential<T extends TFloating> { ... }", "author": "karllessard", "createdAt": "2020-10-19T22:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MjkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTU5MjA3Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509592076", "bodyText": "@karllessard  Ok, did we want to also add TInteger while we're at it?", "author": "JimClarke5", "createdAt": "2020-10-21T19:03:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MjkwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwMjUyOA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509602528", "bodyText": "Added TFloating extends TNumber and modified TBfloat16, TFloat16, TFloat32, and TFloat64 to extend TFloating. Activation classes have been modified for TFloating where appropriate.", "author": "JimClarke5", "createdAt": "2020-10-21T19:17:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2MjkwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NDMxMw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499164313", "bodyText": "What would you think about moving both the declaration and the initialization of negativePart down to immediately before it is used? I realize that would require a change to keep input as the original input instead of reusing it for intermediate calculations, but personally I'd see that as a feature not a bug.", "author": "deansher", "createdAt": "2020-10-03T17:02:50Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(\n+ *              new float[] {-10f, -5f, 0.0f, 5f, 10f});\n+ *\n+ *     // With default parameters\n+ *     ReLU&lt;TFloat32&gt; relu = new ReLU&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = relu.call(input);\n+ *     // result is [0.f,  0.f,  0.f,  5.f, 10.f]\n+ *\n+ *     // With alpha = 0.5\n+ *     relu = new ReLU&lt;&gt;(tf, 0.5f, ReLU.MAX_VALUE_DEFAULT, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [-5.f , -2.5f,  0.f ,  5.f , 10.f]\n+ *\n+ *     // With maxValue = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, 5f, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [0.f, 0.f, 0.f, 5.f, 5.f]\n+ *\n+ *     // With threshold = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, ReLU.MAX_VALUE_DEFAULT, 5f);\n+ *     result = relu.call(input);\n+ *     // result is [-0.f, -0.f,  0.f,  0.f, 10.f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the result\n+ */\n+public class ReLU<T extends TNumber> extends Activation<T> {\n+\n+  public static final float ALPHA_DEFAULT = 0.0f;\n+  public static final float MAX_VALUE_DEFAULT = Float.NaN;\n+  public static final float THRESHOLD_DEFAULT = 0.0f;\n+\n+  private final float alpha;\n+  private final float maxValue;\n+  private final float threshold;\n+\n+  /**\n+   * Creates a new ReLU with alpha={@link #ALPHA_DEFAULT}, maxValue={@link #MAX_VALUE_DEFAULT},\n+   * threshold={@link #THRESHOLD_DEFAULT},\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public ReLU(Ops tf) {\n+    this(tf, ALPHA_DEFAULT, MAX_VALUE_DEFAULT, THRESHOLD_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a new ReLU\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param alpha governs the slope for values lower than the threshold.\n+   * @param maxValue sets the saturation threshold (the largest value the function will return).\n+   * @param threshold the threshold value of the activation function below which values will be\n+   *     damped or set to zero.\n+   */\n+  public ReLU(Ops tf, float alpha, float maxValue, float threshold) {\n+    super(tf);\n+    this.alpha = alpha;\n+    this.maxValue = maxValue;\n+    this.threshold = threshold;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+\n+    DataType<T> dataType = input.asOutput().dataType();\n+    Operand<T> negativePart = null;\n+    boolean clipMax = !Float.isNaN(maxValue);\n+    if (alpha != 0) {\n+      if (Float.isNaN(maxValue) && threshold == 0) {\n+        // TODO LeakyRelu is not in tf.nn ????\n+        return LeakyRelu.create(tf.scope(), input, LeakyRelu.alpha(alpha));\n+      }\n+      if (threshold != 0) {\n+        negativePart =", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NTU4MA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499165580", "bodyText": "Perhaps rename negativePart -> amountBelowThreshold? For one thing, negativePart is vague to me. For another, it's always positive.", "author": "deansher", "createdAt": "2020-10-03T17:19:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NDMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MDMwNw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499280307", "bodyText": "I am not sure if this is used here as a math term, but I found Wolfram MathWorld - Negative Part. Perhaps @Craigacp  and @karllessard  might want to comment.", "author": "JimClarke5", "createdAt": "2020-10-04T19:28:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NDMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyNzUyMw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499527523", "bodyText": "Good point, that Wolfram definition does show why negativePart was used in the first place. That said, I'd still advocate that in the presence of threshold, it's a confusing name.", "author": "deansher", "createdAt": "2020-10-05T11:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NDMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NTI2MQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499165261", "bodyText": "Could we adapt this part of the Keras documentation?\nalpha: A float that governs the slope for values lower than the threshold.\nmax_value: A float that sets the saturation threshold (the largest value the function will return).\nthreshold: A float giving the threshold value of the activation function below which values will be damped or set to zero.", "author": "deansher", "createdAt": "2020-10-03T17:14:52Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MDY5Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499280692", "bodyText": "I am not sure there is an advantage in Java to specify a \"A float\" in the JavaDoc comment, as it is already defined as a float in the method signature. I could see in Python why this may be necessary.", "author": "JimClarke5", "createdAt": "2020-10-04T19:32:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NTI2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyODEyNw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499528127", "bodyText": "For sure! But the text like \"the threshold value of the activation function below which values will be damped or set to zero\" may be helpful.", "author": "deansher", "createdAt": "2020-10-05T11:27:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NTI2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2Njk3Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499166976", "bodyText": "I'm finding it extremely difficult to think through the interactions of all these options. E.g. if we calculate negativePart before applying clipMax, and then we clip the input, and then we subtract a fraction of negativePart from the input, did we do the right thing? How about if there was also a threshold?\nPerhaps either there's some reasoning we could document up front, or somehow there's a way to order the computation and name the intermediate results so it's clearly correct?\nPerhaps the problem is that there are neither documentation, nor examples, nor tests that show how these parameters are supposed to interact.\nOr if all of this accurately mimics the Python implementation, perhaps we leave it for now while opening a ticket for some newbie like me to come back and tidy it up?", "author": "deansher", "createdAt": "2020-10-03T17:38:05Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(\n+ *              new float[] {-10f, -5f, 0.0f, 5f, 10f});\n+ *\n+ *     // With default parameters\n+ *     ReLU&lt;TFloat32&gt; relu = new ReLU&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = relu.call(input);\n+ *     // result is [0.f,  0.f,  0.f,  5.f, 10.f]\n+ *\n+ *     // With alpha = 0.5\n+ *     relu = new ReLU&lt;&gt;(tf, 0.5f, ReLU.MAX_VALUE_DEFAULT, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [-5.f , -2.5f,  0.f ,  5.f , 10.f]\n+ *\n+ *     // With maxValue = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, 5f, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [0.f, 0.f, 0.f, 5.f, 5.f]\n+ *\n+ *     // With threshold = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, ReLU.MAX_VALUE_DEFAULT, 5f);\n+ *     result = relu.call(input);\n+ *     // result is [-0.f, -0.f,  0.f,  0.f, 10.f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the result\n+ */\n+public class ReLU<T extends TNumber> extends Activation<T> {\n+\n+  public static final float ALPHA_DEFAULT = 0.0f;\n+  public static final float MAX_VALUE_DEFAULT = Float.NaN;\n+  public static final float THRESHOLD_DEFAULT = 0.0f;\n+\n+  private final float alpha;\n+  private final float maxValue;\n+  private final float threshold;\n+\n+  /**\n+   * Creates a new ReLU with alpha={@link #ALPHA_DEFAULT}, maxValue={@link #MAX_VALUE_DEFAULT},\n+   * threshold={@link #THRESHOLD_DEFAULT},\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public ReLU(Ops tf) {\n+    this(tf, ALPHA_DEFAULT, MAX_VALUE_DEFAULT, THRESHOLD_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a new ReLU\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param alpha governs the slope for values lower than the threshold.\n+   * @param maxValue sets the saturation threshold (the largest value the function will return).\n+   * @param threshold the threshold value of the activation function below which values will be\n+   *     damped or set to zero.\n+   */\n+  public ReLU(Ops tf, float alpha, float maxValue, float threshold) {\n+    super(tf);\n+    this.alpha = alpha;\n+    this.maxValue = maxValue;\n+    this.threshold = threshold;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+\n+    DataType<T> dataType = input.asOutput().dataType();\n+    Operand<T> negativePart = null;\n+    boolean clipMax = !Float.isNaN(maxValue);\n+    if (alpha != 0) {\n+      if (Float.isNaN(maxValue) && threshold == 0) {\n+        // TODO LeakyRelu is not in tf.nn ????\n+        return LeakyRelu.create(tf.scope(), input, LeakyRelu.alpha(alpha));\n+      }\n+      if (threshold != 0) {\n+        negativePart =\n+            tf.nn.relu(\n+                tf.math.add(tf.math.neg(input), tf.dtypes.cast(tf.constant(threshold), dataType)));\n+      } else {\n+        negativePart = tf.nn.relu(tf.math.neg(input));\n+      }\n+    }\n+\n+    if (threshold != 0) {\n+      // computes input for input > threshold else 0\n+      Greater greater = tf.math.greater(input, tf.dtypes.cast(tf.constant(threshold), dataType));\n+      input = tf.math.mul(input, tf.dtypes.cast(greater, dataType));\n+    } else if (maxValue == 6) {\n+      // if no threshold, then can use nn.relu6 native TF op for performance\n+      input = tf.nn.relu6(input);\n+      clipMax = false;\n+    } else {\n+      input = tf.nn.relu(input);\n+    }\n+    if (clipMax) {\n+      Operand<T> lmaxValue = tf.dtypes.cast(tf.constant(maxValue), dataType);\n+      Operand<T> zero = tf.dtypes.cast(tf.constant(0), dataType);\n+      input = tf.clipByValue(input, zero, lmaxValue);\n+    }\n+\n+    if (alpha != 0.) {\n+      input =\n+          tf.math.sub(\n+              input, tf.math.mul(tf.dtypes.cast(tf.constant(alpha), dataType), negativePart));", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MTM1Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499281352", "bodyText": "This was ported mainly line by line from the Python ReLU method in Keras backend. Java does not have operator overload, so it is a little more cumbersome code than the original python. For example, Python\nx -= alpha * negative_part\ntranslates to TF Java as:\ninput =\n          tf.math.sub(\n              input, tf.math.mul(tf.dtypes.cast(tf.constant(alpha), dataType), negativePart));\n\nThere may be some benefit to breaking this into individual statements, but TF Java in  Graph mode is very difficult to actually debug, so I don't see an advantage there. When I have to debug it, I use special code to print the values using a try(Tensor...) logic.  Perhaps though, we could leave the Python equation in as comments.", "author": "JimClarke5", "createdAt": "2020-10-04T19:40:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2Njk3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUzNTMxOA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499535318", "bodyText": "My difficulty with the code isn't with this sort of tactic. It's with the overall flow of the computation and the variable names used. Given that it's transliterated from the Python and that the same tests pass, seems good to leave it for another day.", "author": "deansher", "createdAt": "2020-10-05T11:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2Njk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NzAyMA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499167020", "bodyText": "Is zero still the right lower clip if there's a threshold?", "author": "deansher", "createdAt": "2020-10-03T17:38:52Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,143 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(\n+ *              new float[] {-10f, -5f, 0.0f, 5f, 10f});\n+ *\n+ *     // With default parameters\n+ *     ReLU&lt;TFloat32&gt; relu = new ReLU&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = relu.call(input);\n+ *     // result is [0.f,  0.f,  0.f,  5.f, 10.f]\n+ *\n+ *     // With alpha = 0.5\n+ *     relu = new ReLU&lt;&gt;(tf, 0.5f, ReLU.MAX_VALUE_DEFAULT, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [-5.f , -2.5f,  0.f ,  5.f , 10.f]\n+ *\n+ *     // With maxValue = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, 5f, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [0.f, 0.f, 0.f, 5.f, 5.f]\n+ *\n+ *     // With threshold = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, ReLU.MAX_VALUE_DEFAULT, 5f);\n+ *     result = relu.call(input);\n+ *     // result is [-0.f, -0.f,  0.f,  0.f, 10.f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the result\n+ */\n+public class ReLU<T extends TNumber> extends Activation<T> {\n+\n+  public static final float ALPHA_DEFAULT = 0.0f;\n+  public static final float MAX_VALUE_DEFAULT = Float.NaN;\n+  public static final float THRESHOLD_DEFAULT = 0.0f;\n+\n+  private final float alpha;\n+  private final float maxValue;\n+  private final float threshold;\n+\n+  /**\n+   * Creates a new ReLU with alpha={@link #ALPHA_DEFAULT}, maxValue={@link #MAX_VALUE_DEFAULT},\n+   * threshold={@link #THRESHOLD_DEFAULT},\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public ReLU(Ops tf) {\n+    this(tf, ALPHA_DEFAULT, MAX_VALUE_DEFAULT, THRESHOLD_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a new ReLU\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param alpha governs the slope for values lower than the threshold.\n+   * @param maxValue sets the saturation threshold (the largest value the function will return).\n+   * @param threshold the threshold value of the activation function below which values will be\n+   *     damped or set to zero.\n+   */\n+  public ReLU(Ops tf, float alpha, float maxValue, float threshold) {\n+    super(tf);\n+    this.alpha = alpha;\n+    this.maxValue = maxValue;\n+    this.threshold = threshold;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+\n+    DataType<T> dataType = input.asOutput().dataType();\n+    Operand<T> negativePart = null;\n+    boolean clipMax = !Float.isNaN(maxValue);\n+    if (alpha != 0) {\n+      if (Float.isNaN(maxValue) && threshold == 0) {\n+        // TODO LeakyRelu is not in tf.nn ????\n+        return LeakyRelu.create(tf.scope(), input, LeakyRelu.alpha(alpha));\n+      }\n+      if (threshold != 0) {\n+        negativePart =\n+            tf.nn.relu(\n+                tf.math.add(tf.math.neg(input), tf.dtypes.cast(tf.constant(threshold), dataType)));\n+      } else {\n+        negativePart = tf.nn.relu(tf.math.neg(input));\n+      }\n+    }\n+\n+    if (threshold != 0) {\n+      // computes input for input > threshold else 0\n+      Greater greater = tf.math.greater(input, tf.dtypes.cast(tf.constant(threshold), dataType));\n+      input = tf.math.mul(input, tf.dtypes.cast(greater, dataType));\n+    } else if (maxValue == 6) {\n+      // if no threshold, then can use nn.relu6 native TF op for performance\n+      input = tf.nn.relu6(input);\n+      clipMax = false;\n+    } else {\n+      input = tf.nn.relu(input);\n+    }\n+    if (clipMax) {\n+      Operand<T> lmaxValue = tf.dtypes.cast(tf.constant(maxValue), dataType);\n+      Operand<T> zero = tf.dtypes.cast(tf.constant(0), dataType);\n+      input = tf.clipByValue(input, zero, lmaxValue);", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwNTE4MA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509605180", "bodyText": "The numbers less than the threshold get converted to zero before the clipMax is applied.\nSo, there is no need to move the lower bound on the clipByValue operation.\nif (threshold != 0) {\n      // computes input for input > threshold else 0\n      Greater greater = tf.math.greater(input, tf.dtypes.cast(tf.constant(threshold), dataType));\n      input = tf.math.mul(input, tf.dtypes.cast(greater, dataType));", "author": "JimClarke5", "createdAt": "2020-10-21T19:21:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTE2NzAyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0NzQzMA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499247430", "bodyText": "(>, <) -> (&gt;, &lt;)", "author": "deansher", "createdAt": "2020-10-04T13:34:10Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/SELU.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Scaled Exponential Linear Unit (SELU).\n+ *\n+ * <p>The Scaled Exponential Linear Unit (SELU) activation function is defined as:\n+ *\n+ * <ul>\n+ *   <li><code>if x > 0: return scale * x</code>\n+ *   <li><code>if x < 0: return scale * alpha * (exp(x) - 1)</code>", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MjYyNQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499282625", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-04T19:54:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0NzQzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0ODA3Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499248072", "bodyText": "> -> &gt;", "author": "deansher", "createdAt": "2020-10-04T13:40:18Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/SELU.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Scaled Exponential Linear Unit (SELU).\n+ *\n+ * <p>The Scaled Exponential Linear Unit (SELU) activation function is defined as:\n+ *\n+ * <ul>\n+ *   <li><code>if x > 0: return scale * x</code>\n+ *   <li><code>if x < 0: return scale * alpha * (exp(x) - 1)</code>\n+ * </ul>\n+ *\n+ * <p>where <code>alpha</code> and <code>scale</code> are pre-defined constants (<code>\n+ * alpha=1.67326324</code> and <code>scale=1.05070098</code>).\n+ *\n+ * <p>Basically, the SELU activation function multiplies <code>scale</code> (> 1) with the output of", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4Mjc1Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499282752", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-04T19:55:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0ODA3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0ODYwMA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499248600", "bodyText": "(>, <) -> (&gt;, &lt;)", "author": "deansher", "createdAt": "2020-10-04T13:45:25Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Sigmoid.java", "diffHunk": "@@ -0,0 +1,69 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Sigmoid activation. <code>sigmoid(x) = 1 / (1 + exp(-x))</code>.\n+ *\n+ * <p>Applies the sigmoid activation function. For small values (<-5), <code>sigmoid</code> returns\n+ * a value close to zero, and for large values (>5) the result of the function gets close to 1.", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MjgxNg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499282816", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-04T19:56:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI0ODYwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1ODI2OQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499258269", "bodyText": "Sadly, the trailing period freaks out Maven's javadoc generation.", "author": "deansher", "createdAt": "2020-10-04T15:26:04Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ELU.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TBool;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Exponential linear unit.\n+ *\n+ * <p>The exponential linear unit (ELU) with <code>alpha &gt; 0</code> is:\n+ *\n+ * <p><code>x</code> if <code>x &gt; 0</code> and <code>alpha * (exp(x) -\n+ * 1)</code> if <code>x &gt; 0</code>.\n+ *\n+ * <p>The ELU hyperparameter <code>alpha</code> controls the value to which an ELU saturates for\n+ * negative net inputs. ELUs diminish the vanishing gradient effect.\n+ *\n+ * <p>ELUs have negative values which pushes the mean of the activations closer to zero. Mean\n+ * activations that are closer to zero enable faster learning as they bring the gradient closer to\n+ * the natural gradient. ELUs saturate to a negative value when the argument gets smaller.\n+ * Saturation means a small derivative which decreases the variation and the information that is\n+ * propagated to the next layer.\n+ *\n+ * <p>Example Usage:\n+ *\n+ * <pre>\n+ *     ELU&lt;TFloat32&gt; input = ...;\n+ *     ELU&lt;TFloat32&gt;elu = new ELU&lt;&gt;(tf, 2.0f);\n+ *     Operand&lt;TFloat32&gt; result = elu.call(input);\n+ * </pre>\n+ *\n+ * @param <T> the data type of the activation\n+ * @see <a href=\"https://arxiv.org/abs/1511.07289\">Clevert et al, 2016, Fast and Accurate Deep\n+ *     Network Learning by Exponential Linear Units (ELUs)</a>.", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MzA1Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499283052", "bodyText": "Removed trailing periods on @see", "author": "JimClarke5", "createdAt": "2020-10-04T19:59:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1ODI2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1ODM3Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499258377", "bodyText": "(>, <) -> (&gt;, &lt;)", "author": "deansher", "createdAt": "2020-10-04T15:27:07Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/HardSigmoid.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Hard sigmoid activation.\n+ *\n+ * <p>A faster approximation of the sigmoid activation.\n+ *\n+ * <p>Defined as:\n+ *\n+ * <ul>\n+ *   <li><code>if x < -2.5: return 0</code>\n+ *   <li><code>if x > 2.5: return 1</code>\n+ *   <li><code>if -2.5 <= x <= 2.5: return 0.2 * x + 0.5</code>\n+ * </ul>", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MzE2Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499283166", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-04T20:00:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1ODM3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1ODg2NQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499258865", "bodyText": "trailing period freaks out Maven's javadoc generation", "author": "deansher", "createdAt": "2020-10-04T15:32:35Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/SELU.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Scaled Exponential Linear Unit (SELU).\n+ *\n+ * <p>The Scaled Exponential Linear Unit (SELU) activation function is defined as:\n+ *\n+ * <ul>\n+ *   <li><code>if x > 0: return scale * x</code>\n+ *   <li><code>if x < 0: return scale * alpha * (exp(x) - 1)</code>\n+ * </ul>\n+ *\n+ * <p>where <code>alpha</code> and <code>scale</code> are pre-defined constants (<code>\n+ * alpha=1.67326324</code> and <code>scale=1.05070098</code>).\n+ *\n+ * <p>Basically, the SELU activation function multiplies <code>scale</code> (> 1) with the output of\n+ * the elu function to ensure a slope larger than one for positive inputs.\n+ *\n+ * <p>The values of <code>alpha</code> and <code>scale</code> are chosen so that the mean and\n+ * variance of the inputs are preserved between two consecutive layers as long as the weights are\n+ * initialized correctly (see {@link org.tensorflow.framework.initializers.LeCun} with Normal\n+ * Distribution) and the number of input units is \"large enough\"\n+ *\n+ * <p><b>Notes: </b> To be used together with the {@link\n+ * org.tensorflow.framework.initializers.LeCun} initializer with Normal Distribution.\n+ *\n+ * @param <T> the data type of the activation\n+ * @see <a href=\"https://arxiv.org/abs/1706.02515\">Klambauer et al., 2017</a>.", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MzQzMQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499283431", "bodyText": "Removed", "author": "JimClarke5", "createdAt": "2020-10-04T20:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1ODg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1OTg1Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499259857", "bodyText": "This is boilerplate for us. Although it could be greatly reduced with a helper for the isFloating check, I wonder whether it's worth creating a subclass FloatingActivation that does the isFloating check and invokes a protected Operand<T extends TNumber> callFloating(Operand<T extends TNumber> input)? (Where TNumber would be replaced by TFloating as we build out our type family support.)", "author": "deansher", "createdAt": "2020-10-04T15:42:22Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/SELU.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Scaled Exponential Linear Unit (SELU).\n+ *\n+ * <p>The Scaled Exponential Linear Unit (SELU) activation function is defined as:\n+ *\n+ * <ul>\n+ *   <li><code>if x > 0: return scale * x</code>\n+ *   <li><code>if x < 0: return scale * alpha * (exp(x) - 1)</code>\n+ * </ul>\n+ *\n+ * <p>where <code>alpha</code> and <code>scale</code> are pre-defined constants (<code>\n+ * alpha=1.67326324</code> and <code>scale=1.05070098</code>).\n+ *\n+ * <p>Basically, the SELU activation function multiplies <code>scale</code> (> 1) with the output of\n+ * the elu function to ensure a slope larger than one for positive inputs.\n+ *\n+ * <p>The values of <code>alpha</code> and <code>scale</code> are chosen so that the mean and\n+ * variance of the inputs are preserved between two consecutive layers as long as the weights are\n+ * initialized correctly (see {@link org.tensorflow.framework.initializers.LeCun} with Normal\n+ * Distribution) and the number of input units is \"large enough\"\n+ *\n+ * <p><b>Notes: </b> To be used together with the {@link\n+ * org.tensorflow.framework.initializers.LeCun} initializer with Normal Distribution.\n+ *\n+ * @param <T> the data type of the activation\n+ * @see <a href=\"https://arxiv.org/abs/1706.02515\">Klambauer et al., 2017</a>.\n+ */\n+public class SELU<T extends TNumber> extends Activation<T> {\n+\n+  /**\n+   * Creates a Scaled Exponential Linear Unit (SELU) activation.\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public SELU(Ops tf) {\n+    super(tf);\n+  }\n+\n+  /**\n+   * Gets the calculation operation for the activation.\n+   *\n+   * @param input the input tensor\n+   * @return The operand for the activation\n+   * @throws IllegalArgumentException if the data type is not a floating data type.\n+   */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYwNTcwNA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509605704", "bodyText": "This is no longer the case after implementing TFloating.", "author": "JimClarke5", "createdAt": "2020-10-21T19:22:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1OTg1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1OTk5MA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499259990", "bodyText": "extra right angle bracket", "author": "deansher", "createdAt": "2020-10-04T15:43:53Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Softmax.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.ndarray.Shape;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.core.ReduceMax;\n+import org.tensorflow.op.core.ReduceSum;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Softmax converts a real vector to a vector of categorical probabilities.\n+ *\n+ * <p>The elements of the output vector are in range (0, 1) and sum to 1.\n+ *\n+ * <p>Each vector is handled independently. The <code>axis</code>>argument sets which axis of the", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MzU1NQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499283555", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-04T20:04:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI1OTk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2MDk3Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499260977", "bodyText": "Perhaps worth defining an Operand.shape()?", "author": "deansher", "createdAt": "2020-10-04T15:54:07Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Softmax.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.ndarray.Shape;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.core.ReduceMax;\n+import org.tensorflow.op.core.ReduceSum;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Softmax converts a real vector to a vector of categorical probabilities.\n+ *\n+ * <p>The elements of the output vector are in range (0, 1) and sum to 1.\n+ *\n+ * <p>Each vector is handled independently. The <code>axis</code>>argument sets which axis of the\n+ * input the function is applied along.\n+ *\n+ * <p>Softmax is often used as the activation for the last layer of a classification network because\n+ * the result could be interpreted as a probability distribution.\n+ *\n+ * <p>The softmax of each vector x is computed as: <code>exp(x) / tf.sum(exp(x))</code>.\n+ *\n+ * <p>The input values in are the log-odds of the resulting probability.\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public class Softmax<T extends TNumber> extends Activation<T> {\n+\n+  private static final int AXIS_DEFAULT = -1;\n+\n+  private final int axis;\n+\n+  /**\n+   * Creates a softmax activation where the default axis is {@link #AXIS_DEFAULT} which indicates\n+   * the last dimension.\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public Softmax(Ops tf) {\n+    this(tf, AXIS_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a Softmax activation\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param axis The dimension softmax would be performed on.\n+   */\n+  public Softmax(Ops tf, int axis) {\n+    super(tf);\n+    this.axis = axis;\n+  }\n+\n+  /**\n+   * Gets the calculation operation for the activation.\n+   *\n+   * @param input the input tensor\n+   * @return The operand for the activation\n+   */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+    if (!input.asOutput().dataType().isFloating()) {\n+      throw new IllegalArgumentException(\n+          \"Must be a Floating Point DataType: \" + input.asOutput().dataType());\n+    }\n+    Shape shape = input.asOutput().shape();", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4Mzc2OQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499283769", "bodyText": "There are 2 shapes, which one, asOutput() or asTensor()?   They may be different at different times.", "author": "JimClarke5", "createdAt": "2020-10-04T20:06:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2MDk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUyOTM1Ng==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499529356", "bodyText": ":-) oh!", "author": "deansher", "createdAt": "2020-10-05T11:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2MDk3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyODI1NA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509828254", "bodyText": "I think it could be reasonable still to have a Operand.shape() operation... let's keep that anyway for another PR", "author": "karllessard", "createdAt": "2020-10-22T01:35:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2MDk3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2MTQ2Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499261467", "bodyText": "trailing period freaks out Maven's javadoc generation", "author": "deansher", "createdAt": "2020-10-04T16:00:17Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Swish.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Swish activation function. <code>swish(x) = x * sigmoid(x)</code>.\n+ *\n+ * <p>Swish activation function which returns <code>x*sigmoid(x)</code>. It is a smooth,\n+ * non-monotonic function that consistently matches or outperforms <code>ReLU</code> on deep\n+ * networks, it is unbounded above and bounded below.\n+ *\n+ * <p>Example Usage:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(new float[]\n+ *                                        {-20, -1.0, 0.0, 1.0, 20});\n+ *     Swish&lt;TFloat32&gt; swish = new Swish&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = swish.call(input);\n+ *     // result = [-4.1223075e-08f, -2.6894143e-01f,  0.0000000e+00f,\n+ *     //          7.3105860e-01f,  2.0000000e+01f ]\n+ *\n+ * </pre>\n+ *\n+ * @param <T> the data type of the activation\n+ * @see <a href=\"https://arxiv.org/abs/1710.05941\">Ramachandran et al., 2017</a>.", "originalCommit": "de0e610ad8a7d732da9a11c319e6d0495e66b9b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI4MzgwNw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499283807", "bodyText": "Removed", "author": "JimClarke5", "createdAt": "2020-10-04T20:07:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI2MTQ2Nw=="}], "type": "inlineReview"}, {"oid": "63c1f006ca2e16677790d5d203636e071a6e20b4", "url": "https://github.com/tensorflow/java/commit/63c1f006ca2e16677790d5d203636e071a6e20b4", "message": "JavaDoc fixes", "committedDate": "2020-10-04T20:07:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUzOTQ0NA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499539444", "bodyText": "I like how this eliminates a chunk of (comment) boilerplate! But it doesn't document the IllegalArgumentException on !isFloating. Might be additional motivation to add a FloatingActivation subclass?", "author": "deansher", "createdAt": "2020-10-05T11:48:57Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Tanh.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Hyperbolic tangent activation function.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(new float[]\n+ *                                        {-3.0f,-1.0f, 0.0f, 1.0f, 3.0f});\n+ *     Tanh&lt;TFloat32&gt; tanh = new Tanh&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = tanh.call(input);\n+ *     // result = [-0.9950547f, -0.7615942f,  0.f,  0.7615942f,  0.9950547f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public class Tanh<T extends TNumber> extends Activation<T> {\n+\n+  /**\n+   * Creates a Hyperbolic tangent activation.\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public Tanh(Ops tf) {\n+    super(tf);\n+  }\n+\n+  /** {@inheritDoc} */", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5MDM3Mg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r508090372", "bodyText": "Similar to my previous comment, when we will bind T to TFloating, no doc will be required as no exception will be thrown", "author": "karllessard", "createdAt": "2020-10-19T22:06:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTUzOTQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU0MDk0MQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499540941", "bodyText": "This test will be boilerplate. Perhaps create a helper class or superclass for tests of floating activations?", "author": "deansher", "createdAt": "2020-10-05T11:51:40Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/ELUTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.junit.jupiter.api.*;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.utils.TestSession;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TFloat32;\n+import org.tensorflow.types.TFloat64;\n+import org.tensorflow.types.TInt32;\n+\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+/** @author Jim Clarke */\n+public class ELUTest {\n+\n+  private final TestSession.Mode[] tfModes = {TestSession.Mode.EAGER, TestSession.Mode.GRAPH};\n+\n+  public ELUTest() {}\n+\n+  @BeforeAll\n+  public static void setUpClass() {}\n+\n+  @AfterAll\n+  public static void tearDownClass() {}\n+\n+  @BeforeEach\n+  public void setUp() {}\n+\n+  @AfterEach\n+  public void tearDown() {}\n+\n+  /** Test of ELU call method */\n+  @Test\n+  public void testCallInt() {", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzMTE1OA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r510231158", "bodyText": "This test is obsolete after implementing TFloating as it will no longer compile.", "author": "JimClarke5", "createdAt": "2020-10-22T14:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU0MDk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU0NTcxNQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r499545715", "bodyText": "Perhaps also consolidate this sort of test logic into a helper class? E.g.\nassertFloat32Output(tf -> new ELU<Float32>(tf),\n            {1f, -0.86466473f, 3f, -0.9816844f, -0.63212055f, 2f, -0.95021296f, 4f},\n            {1, -2, 3, -4, -1, 2, -3, 4})", "author": "deansher", "createdAt": "2020-10-05T12:00:25Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/ELUTest.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.junit.jupiter.api.*;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.utils.TestSession;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TFloat32;\n+import org.tensorflow.types.TFloat64;\n+import org.tensorflow.types.TInt32;\n+\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+/** @author Jim Clarke */\n+public class ELUTest {\n+\n+  private final TestSession.Mode[] tfModes = {TestSession.Mode.EAGER, TestSession.Mode.GRAPH};\n+\n+  public ELUTest() {}\n+\n+  @BeforeAll\n+  public static void setUpClass() {}\n+\n+  @AfterAll\n+  public static void tearDownClass() {}\n+\n+  @BeforeEach\n+  public void setUp() {}\n+\n+  @AfterEach\n+  public void tearDown() {}\n+\n+  /** Test of ELU call method */\n+  @Test\n+  public void testCallInt() {\n+    for (TestSession.Mode tfMode : tfModes)\n+      assertThrows(\n+          java.lang.IllegalArgumentException.class,\n+          () -> {\n+            try (TestSession session = TestSession.createTestSession(tfMode)) {\n+              Ops tf = session.getTF();\n+              Operand<TInt32> input = tf.constant(new int[] {1, 2, 3, 4, 5});\n+              ELU<TInt32> instance = new ELU<>(tf);\n+              Operand<TInt32> result = instance.call(input);\n+            }\n+          });\n+  }\n+\n+  /** Test of ELU call method */\n+  @Test\n+  public void testCallFloat() {", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyMTc4MQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505121781", "bodyText": "Probably a way to avoid these setTF/getTF would be to push created Ops instances on a stack somewhere... but this is out of scope of this PR for sure", "author": "karllessard", "createdAt": "2020-10-15T02:08:55Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Activation.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Abstract base class for Activations\n+ *\n+ * <p><b>Note:</b> The {@link #tf} attribute must be set prior to invoking the call method. See\n+ * {@link #setTF(Ops)} and the constructor {@link #Activation(Ops)}.\n+ *\n+ * @param <T> the data type of the activation\n+ */\n+public abstract class Activation<T extends TNumber> {\n+\n+  /** The TensorFlow Ops */\n+  protected Ops tf;\n+\n+  /**\n+   * Creates the abstract class for an Activation\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  protected Activation(Ops tf) {\n+    this.tf = tf;\n+  }\n+\n+  /**\n+   * Sets the TensorFlow Ops\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  protected void setTF(Ops tf) {\n+    this.tf = tf;\n+  }\n+\n+  /**\n+   * Gets the TensorFlow Ops\n+   *\n+   * @return the TensorFlow Ops\n+   */\n+  protected Ops getTF() {\n+    return this.tf;\n+  }", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyMzI1Nw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505123257", "bodyText": "Nit: no need of a else block if you return unconditionally in the if one", "author": "karllessard", "createdAt": "2020-10-15T02:14:13Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ELU.java", "diffHunk": "@@ -0,0 +1,103 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TBool;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Exponential linear unit.\n+ *\n+ * <p>The exponential linear unit (ELU) with <code>alpha &gt; 0</code> is:\n+ *\n+ * <p><code>x</code> if <code>x &gt; 0</code> and <code>alpha * (exp(x) -\n+ * 1)</code> if <code>x &lt; 0</code>.\n+ *\n+ * <p>The ELU hyperparameter <code>alpha</code> controls the value to which an ELU saturates for\n+ * negative net inputs. ELUs diminish the vanishing gradient effect.\n+ *\n+ * <p>ELUs have negative values which pushes the mean of the activations closer to zero. Mean\n+ * activations that are closer to zero enable faster learning as they bring the gradient closer to\n+ * the natural gradient. ELUs saturate to a negative value when the argument gets smaller.\n+ * Saturation means a small derivative which decreases the variation and the information that is\n+ * propagated to the next layer.\n+ *\n+ * <p>Example Usage:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = &#46;&#46;&#46;;\n+ *     ELU&lt;TFloat32&gt; elu = new ELU&lt;&gt;(tf, 2.0f);\n+ *     Operand&lt;TFloat32&gt; result = elu.call(input);\n+ * </pre>\n+ *\n+ * @param <T> the data type of the activation\n+ * @see <a href=\"https://arxiv.org/abs/1511.07289\">Clevert et al, 2016, Fast and Accurate Deep\n+ *     Network Learning by Exponential Linear Units (ELUs)</a>\n+ */\n+public class ELU<T extends TNumber> extends Activation<T> {\n+\n+  private static final double ALPHA_DEFAULT = 1.0;\n+\n+  /** A scalar, slope of negative section. */\n+  private final double alpha;\n+\n+  /**\n+   * Creates a new ELU with alpha={@link #ALPHA_DEFAULT}.\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public ELU(Ops tf) {\n+    this(tf, ALPHA_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a new ELU\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param alpha A scalar, slope of negative section. It controls the value to which an ELU\n+   *     saturates for negative net inputs.\n+   */\n+  public ELU(Ops tf, double alpha) {\n+    super(tf);\n+    this.alpha = alpha;\n+  }\n+\n+  /**\n+   * Gets the calculation operation for the activation.\n+   *\n+   * @param input the input tensor\n+   * @return The operand for the activation\n+   * @throws IllegalArgumentException if the data type is not a floating data type.\n+   */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+    if (!input.asOutput().dataType().isFloating()) {\n+      throw new IllegalArgumentException(\n+          \"Must be a Floating Point DataType: \" + input.asOutput().dataType());\n+    }\n+    Operand<T> result = tf.nn.elu(input);\n+    if (alpha == 1.0) {\n+      return result;\n+    } else {", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE4MTE0Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r510181143", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-22T13:54:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyMzI1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNjI0NQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505126245", "bodyText": "LeakyRelu is not add to tf.nn because it is set as not visible in the main API def proto. To add it to tf.nn, you can override its visibility by setting it to VISIBLE in our proto", "author": "karllessard", "createdAt": "2020-10-15T02:25:27Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(\n+ *              new float[] {-10f, -5f, 0.0f, 5f, 10f});\n+ *\n+ *     // With default parameters\n+ *     ReLU&lt;TFloat32&gt; relu = new ReLU&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = relu.call(input);\n+ *     // result is [0.f,  0.f,  0.f,  5.f, 10.f]\n+ *\n+ *     // With alpha = 0.5\n+ *     relu = new ReLU&lt;&gt;(tf, 0.5f, ReLU.MAX_VALUE_DEFAULT, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [-5.f , -2.5f,  0.f ,  5.f , 10.f]\n+ *\n+ *     // With maxValue = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, 5f, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [0.f, 0.f, 0.f, 5.f, 5.f]\n+ *\n+ *     // With threshold = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, ReLU.MAX_VALUE_DEFAULT, 5f);\n+ *     result = relu.call(input);\n+ *     // result is [-0.f, -0.f,  0.f,  0.f, 10.f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the result\n+ */\n+public class ReLU<T extends TNumber> extends Activation<T> {\n+\n+  public static final float ALPHA_DEFAULT = 0.0f;\n+  public static final float MAX_VALUE_DEFAULT = Float.NaN;\n+  public static final float THRESHOLD_DEFAULT = 0.0f;\n+\n+  private final float alpha;\n+  private final float maxValue;\n+  private final float threshold;\n+\n+  /**\n+   * Creates a new ReLU with alpha={@link #ALPHA_DEFAULT}, maxValue={@link #MAX_VALUE_DEFAULT},\n+   * threshold={@link #THRESHOLD_DEFAULT},\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public ReLU(Ops tf) {\n+    this(tf, ALPHA_DEFAULT, MAX_VALUE_DEFAULT, THRESHOLD_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a new ReLU\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param alpha governs the slope for values lower than the threshold.\n+   * @param maxValue sets the saturation threshold (the largest value the function will return).\n+   * @param threshold the threshold value of the activation function below which values will be\n+   *     damped or set to zero.\n+   */\n+  public ReLU(Ops tf, float alpha, float maxValue, float threshold) {\n+    super(tf);\n+    this.alpha = alpha;\n+    this.maxValue = maxValue;\n+    this.threshold = threshold;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+\n+    DataType<T> dataType = input.asOutput().dataType();\n+\n+    boolean clipMax = !Float.isNaN(maxValue);\n+    Operand<T> negativePart = null;\n+    if (alpha != 0) {\n+      if (Float.isNaN(maxValue) && threshold == 0) {\n+        // TODO LeakyRelu is not in tf.nn ????", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY1Mjk4OA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509652988", "bodyText": "@karllessard should we do this or just leave it as is for internal use? In Python it is available as tf.nn.leaky_relu.\nIf we want to add this, it may be better as a separate PR because of the generated classes being changed.", "author": "JimClarke5", "createdAt": "2020-10-21T20:14:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNjI0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMzQyOQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509803429", "bodyText": "I suggest we make it visible in this PR, even if the ops will be regenerated, only two files (NnOps and LeakyRelu) should end up being different", "author": "karllessard", "createdAt": "2020-10-22T00:04:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNjI0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ1MDc3OA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r510450778", "bodyText": "I have made the changes to add LeakyRelu to NnOps and generate tf.nn.leakyRelu()", "author": "JimClarke5", "createdAt": "2020-10-22T20:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNjI0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNzE2OQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r505127169", "bodyText": "I would try to avoid changing the value of a method parameter, better use a new variable.", "author": "karllessard", "createdAt": "2020-10-15T02:29:04Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/ReLU.java", "diffHunk": "@@ -0,0 +1,144 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.DataType;\n+import org.tensorflow.Operand;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.math.Greater;\n+import org.tensorflow.op.nn.LeakyRelu;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Rectified Linear Unit(ReLU) activation.\n+ *\n+ * <p>With default values, this returns the standard ReLU activation: <code>max(x, 0)</code>, the\n+ * element-wise maximum of 0 and the input tensor.\n+ *\n+ * <p>Modifying default parameters allows you to use non-zero thresholds, change the max value of\n+ * the activation, and to use a non-zero multiple of the input for values below the threshold.\n+ *\n+ * <p>For example:\n+ *\n+ * <pre>\n+ *     Operand&lt;TFloat32&gt; input = tf.constant(\n+ *              new float[] {-10f, -5f, 0.0f, 5f, 10f});\n+ *\n+ *     // With default parameters\n+ *     ReLU&lt;TFloat32&gt; relu = new ReLU&lt;&gt;(tf);\n+ *     Operand&lt;TFloat32&gt; result = relu.call(input);\n+ *     // result is [0.f,  0.f,  0.f,  5.f, 10.f]\n+ *\n+ *     // With alpha = 0.5\n+ *     relu = new ReLU&lt;&gt;(tf, 0.5f, ReLU.MAX_VALUE_DEFAULT, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [-5.f , -2.5f,  0.f ,  5.f , 10.f]\n+ *\n+ *     // With maxValue = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, 5f, ReLU.THRESHOLD_DEFAULT);\n+ *     result = relu.call(input);\n+ *     // result is [0.f, 0.f, 0.f, 5.f, 5.f]\n+ *\n+ *     // With threshold = 5\n+ *     relu = new ReLU&lt;&gt;(tf, ReLU.ALPHA_DEFAULT, ReLU.MAX_VALUE_DEFAULT, 5f);\n+ *     result = relu.call(input);\n+ *     // result is [-0.f, -0.f,  0.f,  0.f, 10.f]\n+ * </pre>\n+ *\n+ * @param <T> the data type of the result\n+ */\n+public class ReLU<T extends TNumber> extends Activation<T> {\n+\n+  public static final float ALPHA_DEFAULT = 0.0f;\n+  public static final float MAX_VALUE_DEFAULT = Float.NaN;\n+  public static final float THRESHOLD_DEFAULT = 0.0f;\n+\n+  private final float alpha;\n+  private final float maxValue;\n+  private final float threshold;\n+\n+  /**\n+   * Creates a new ReLU with alpha={@link #ALPHA_DEFAULT}, maxValue={@link #MAX_VALUE_DEFAULT},\n+   * threshold={@link #THRESHOLD_DEFAULT},\n+   *\n+   * @param tf the TensorFlow Ops\n+   */\n+  public ReLU(Ops tf) {\n+    this(tf, ALPHA_DEFAULT, MAX_VALUE_DEFAULT, THRESHOLD_DEFAULT);\n+  }\n+\n+  /**\n+   * Creates a new ReLU\n+   *\n+   * @param tf the TensorFlow Ops\n+   * @param alpha governs the slope for values lower than the threshold.\n+   * @param maxValue sets the saturation threshold (the largest value the function will return).\n+   * @param threshold the threshold value of the activation function below which values will be\n+   *     damped or set to zero.\n+   */\n+  public ReLU(Ops tf, float alpha, float maxValue, float threshold) {\n+    super(tf);\n+    this.alpha = alpha;\n+    this.maxValue = maxValue;\n+    this.threshold = threshold;\n+  }\n+\n+  /** {@inheritDoc} */\n+  @Override\n+  public Operand<T> call(Operand<T> input) {\n+\n+    DataType<T> dataType = input.asOutput().dataType();\n+\n+    boolean clipMax = !Float.isNaN(maxValue);\n+    Operand<T> negativePart = null;\n+    if (alpha != 0) {\n+      if (Float.isNaN(maxValue) && threshold == 0) {\n+        // TODO LeakyRelu is not in tf.nn ????\n+        return LeakyRelu.create(tf.scope(), input, LeakyRelu.alpha(alpha));\n+      }\n+      if (threshold != 0) {\n+        negativePart =\n+            tf.nn.relu(\n+                tf.math.add(tf.math.neg(input), tf.dtypes.cast(tf.constant(threshold), dataType)));\n+      } else {\n+        negativePart = tf.nn.relu(tf.math.neg(input));\n+      }\n+    }\n+\n+    if (threshold != 0) {\n+      // computes input for input > threshold else 0\n+      Greater greater = tf.math.greater(input, tf.dtypes.cast(tf.constant(threshold), dataType));\n+      input = tf.math.mul(input, tf.dtypes.cast(greater, dataType));", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxMDMwNA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509610304", "bodyText": "OK", "author": "JimClarke5", "createdAt": "2020-10-21T19:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEyNzE2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NjA2NQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r508086065", "bodyText": "missing space after </code>", "author": "karllessard", "createdAt": "2020-10-19T21:56:18Z", "path": "tensorflow-framework/src/main/java/org/tensorflow/framework/activations/Softmax.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.tensorflow.Operand;\n+import org.tensorflow.ndarray.Shape;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.op.core.ReduceMax;\n+import org.tensorflow.op.core.ReduceSum;\n+import org.tensorflow.types.family.TNumber;\n+\n+/**\n+ * Softmax converts a real vector to a vector of categorical probabilities.\n+ *\n+ * <p>The elements of the output vector are in range (0, 1) and sum to 1.\n+ *\n+ * <p>Each vector is handled independently. The <code>axis</code>argument sets which axis of the", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY1MjY5OA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509652698", "bodyText": "Fixed", "author": "JimClarke5", "createdAt": "2020-10-21T20:14:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA4NjA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE0NDM3OA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r508144378", "bodyText": "Where were the expected values computed? I would've thought we'd be using the examples provided in the Python API docs: https://www.tensorflow.org/api_docs/python/tf/keras/activations/swish", "author": "KartikChugh", "createdAt": "2020-10-20T00:52:26Z", "path": "tensorflow-framework/src/test/java/org/tensorflow/framework/activations/SwishTest.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/* Copyright 2020 The TensorFlow Authors. All Rights Reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\");\n+you may not use this file except in compliance with the License.\n+You may obtain a copy of the License at\n+\n+    http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software\n+distributed under the License is distributed on an \"AS IS\" BASIS,\n+WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+See the License for the specific language governing permissions and\n+limitations under the License.\n+=======================================================================*/\n+package org.tensorflow.framework.activations;\n+\n+import org.junit.jupiter.api.*;\n+import org.tensorflow.Operand;\n+import org.tensorflow.framework.utils.TestSession;\n+import org.tensorflow.op.Ops;\n+import org.tensorflow.types.TFloat32;\n+import org.tensorflow.types.TFloat64;\n+import org.tensorflow.types.TInt32;\n+\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+\n+/** @author Jim Clarke */\n+public class SwishTest {\n+  private final TestSession.Mode[] tfModes = {TestSession.Mode.EAGER, TestSession.Mode.GRAPH};\n+\n+  public SwishTest() {}\n+\n+  @BeforeAll\n+  public static void setUpClass() {}\n+\n+  @AfterAll\n+  public static void tearDownClass() {}\n+\n+  @BeforeEach\n+  public void setUp() {}\n+\n+  @AfterEach\n+  public void tearDown() {}\n+\n+  /** Test of Swish call method */\n+  @Test\n+  public void testCallInt() {\n+    int[] input = {1, -2, 3, -4, -1, 2, -3, 4};\n+    for (TestSession.Mode tfMode : tfModes)\n+      assertThrows(\n+          java.lang.IllegalArgumentException.class,\n+          () -> {\n+            try (TestSession session = TestSession.createTestSession(tfMode)) {\n+              Ops tf = session.getTF();\n+              Swish<TInt32> instance = new Swish<>(tf);\n+              Operand<TInt32> result = instance.call(tf.constant(input));\n+            }\n+          });\n+  }\n+\n+  /** Test of Swish call method */\n+  @Test\n+  public void testCallFloat() {\n+    float[] input = {1, -2, 3, -4, -5, 6, -7, 8};\n+    float[] expected = {", "originalCommit": "63c1f006ca2e16677790d5d203636e071a6e20b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxMjAyMQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509612021", "bodyText": "For activations, the expected values where determined by running the same inputs against Python TF. The Unit test cases in Python made heavy use of numpy and this is too much to duplicate in Java.", "author": "JimClarke5", "createdAt": "2020-10-21T19:33:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODE0NDM3OA=="}], "type": "inlineReview"}, {"oid": "2302cc508ab3d9c30d056f42909c06821c323edd", "url": "https://github.com/tensorflow/java/commit/2302cc508ab3d9c30d056f42909c06821c323edd", "message": "Add TFloating family", "committedDate": "2020-10-21T19:04:55Z", "type": "commit"}, {"oid": "4c44c62ce34e6756221cbffb493bc4859ed13294", "url": "https://github.com/tensorflow/java/commit/4c44c62ce34e6756221cbffb493bc4859ed13294", "message": "Add JavaDoc", "committedDate": "2020-10-21T19:09:05Z", "type": "commit"}, {"oid": "ef29af9debf37f56c383453b65d0f41acfc5d006", "url": "https://github.com/tensorflow/java/commit/ef29af9debf37f56c383453b65d0f41acfc5d006", "message": "Changed to TFloating where appropriate.\nMisc fixes to JavaDoc.\nIn ReLU, change to assign to new variable 'lInput' rather than change the 'input' parameter.", "committedDate": "2020-10-21T19:37:47Z", "type": "commit"}, {"oid": "75194368c33d8bbabf166bb6bc7a4723660a1c99", "url": "https://github.com/tensorflow/java/commit/75194368c33d8bbabf166bb6bc7a4723660a1c99", "message": "Remove the test of int arguments for those classes changed to TFloating type, as they would no longer compile.", "committedDate": "2020-10-21T19:42:15Z", "type": "commit"}, {"oid": "27c1126ad67c5bf83a87c690e5881460c5a0ae38", "url": "https://github.com/tensorflow/java/commit/27c1126ad67c5bf83a87c690e5881460c5a0ae38", "message": "Remove the test of int arguments for those classes changed to TFloating type, as they would no longer compile.", "committedDate": "2020-10-21T20:10:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMjYyNg==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509802626", "bodyText": "Provably that the TNumber import is not required anymore?", "author": "karllessard", "createdAt": "2020-10-22T00:01:48Z", "path": "tensorflow-core/tensorflow-core-api/src/main/java/org/tensorflow/types/TFloat64.java", "diffHunk": "@@ -29,10 +29,11 @@\n import org.tensorflow.ndarray.NdArray;\n import org.tensorflow.ndarray.StdArrays;\n import org.tensorflow.ndarray.impl.dense.DoubleDenseNdArray;\n+import org.tensorflow.types.family.TFloating;", "originalCommit": "27c1126ad67c5bf83a87c690e5881460c5a0ae38", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwODUwMw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509808503", "bodyText": "@karllessard I don\u2019t fully understand your comment. Did you mean TNumber is not required for most Activations or not required at all? TFloating works well with those activations that only work with floating point. But there is still use for TNumber when any number type is accepted.", "author": "JimClarke5", "createdAt": "2020-10-22T00:20:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMjYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyNTc1Mw==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509825753", "bodyText": "No, I just meant that in these type classes TFloat32, TFloat16, etc., the TNumber seems not to be used anymore since you replaced it by TFloating therefore there is no need to import it :)", "author": "karllessard", "createdAt": "2020-10-22T01:25:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMjYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgyNjIyOQ==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r509826229", "bodyText": "actually my comment should have been put on the line below... sorry, that is kind of things that happens when you review a PR on a iPad", "author": "karllessard", "createdAt": "2020-10-22T01:27:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMjYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDIzNzIyMA==", "url": "https://github.com/tensorflow/java/pull/123#discussion_r510237220", "bodyText": "Interesting the google-java-format did not remove the TNumber import, I had to remove them all by hand.", "author": "JimClarke5", "createdAt": "2020-10-22T15:04:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgwMjYyNg=="}], "type": "inlineReview"}, {"oid": "b83f94fcbe96f71e0dc006b42aeeb09c07a9ce72", "url": "https://github.com/tensorflow/java/commit/b83f94fcbe96f71e0dc006b42aeeb09c07a9ce72", "message": "Make LeakyRelu visible so that it is included in tf.nn.", "committedDate": "2020-10-22T13:56:59Z", "type": "commit"}, {"oid": "c59e9058d0c152bce63c0c30e60f4c37472c7cb0", "url": "https://github.com/tensorflow/java/commit/c59e9058d0c152bce63c0c30e60f4c37472c7cb0", "message": "Remove TNumber import", "committedDate": "2020-10-22T15:03:00Z", "type": "commit"}, {"oid": "ebbcc4fd9ca08ea1693424c480520278b05daa02", "url": "https://github.com/tensorflow/java/commit/ebbcc4fd9ca08ea1693424c480520278b05daa02", "message": "Add tf.nn.leakyRelu operation", "committedDate": "2020-10-22T19:27:33Z", "type": "commit"}]}