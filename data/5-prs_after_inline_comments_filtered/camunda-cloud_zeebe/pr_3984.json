{"pr_number": 3984, "pr_title": "chore(broker): expose health metrics of partition", "pr_createdAt": "2020-03-04T18:00:50Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/3984", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r387932042", "bodyText": "Can this call fail? E.g. Exception?", "author": "Zelldon", "createdAt": "2020-03-04T21:01:57Z", "path": "broker/src/main/java/io/zeebe/broker/system/partitions/ZeebePartition.java", "diffHunk": "@@ -601,18 +605,22 @@ public void onRecovered() {\n   private void updateHealthStatus(final HealthStatus newStatus) {\n     if (healthStatus != newStatus) {\n       healthStatus = newStatus;\n-      if (failureListener != null) {\n-        switch (newStatus) {\n-          case HEALTHY:\n+      switch (newStatus) {\n+        case HEALTHY:\n+          healthMetrics.setHealthy();\n+          if (failureListener != null) {\n             failureListener.onRecovered();\n-            break;\n-          case UNHEALTHY:\n+          }\n+          break;\n+        case UNHEALTHY:\n+          healthMetrics.setUnhealthy();\n+          if (failureListener != null) {\n             failureListener.onFailure();", "originalCommit": "26412730e86cbe791f3c86b95d2933ffb6b1a7df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE0NjU3Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r388146577", "bodyText": "Probably not. But in case it fails, what would be the expected behavior? If it is just for logging, it will be logged by the actor controller. Health monitor is also periodically probing these modules. So it will detect the failure of this module eventually.", "author": "deepthidevaki", "createdAt": "2020-03-05T08:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI3NDA3Ng==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r388274076", "bodyText": "So it will detect the failure of this module eventually.\n\nOk here I was unsure. I thought that we might miss an failure. E. g. we report healthy and the failureListener throws an exception that the actors might then have a problem but we are not seeing it?", "author": "Zelldon", "createdAt": "2020-03-05T12:53:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUxMDYwNA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r389510604", "bodyText": "If just the notification to failure listener fails, health monitor will detect the health status correctly in the next probe. Do you suggest to handle it any other way?", "author": "deepthidevaki", "createdAt": "2020-03-09T08:12:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUxMTM4MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r389511381", "bodyText": "How often the probe is done? Sorry I think I have not the complete picture currently.", "author": "Zelldon", "createdAt": "2020-03-09T08:15:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUxMjI4Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r389512287", "bodyText": "Currently hard coded to 60 seconds.", "author": "deepthidevaki", "createdAt": "2020-03-09T08:17:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTUxMzU1Mw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3984#discussion_r389513553", "bodyText": "Ok thanks yes should be fine", "author": "Zelldon", "createdAt": "2020-03-09T08:21:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzkzMjA0Mg=="}], "type": "inlineReview"}, {"oid": "38a271fc111066b3a3f0c6e41225a8b3eb50f0ae", "url": "https://github.com/camunda-cloud/zeebe/commit/38a271fc111066b3a3f0c6e41225a8b3eb50f0ae", "message": "chore(broker): expose health metrics of partition", "committedDate": "2020-03-09T08:24:18Z", "type": "commit"}, {"oid": "38a271fc111066b3a3f0c6e41225a8b3eb50f0ae", "url": "https://github.com/camunda-cloud/zeebe/commit/38a271fc111066b3a3f0c6e41225a8b3eb50f0ae", "message": "chore(broker): expose health metrics of partition", "committedDate": "2020-03-09T08:24:18Z", "type": "forcePushed"}]}