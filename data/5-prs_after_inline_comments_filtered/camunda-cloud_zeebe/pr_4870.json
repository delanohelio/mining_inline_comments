{"pr_number": 4870, "pr_title": "fix(broker): cancel metrics timer to avoid segfault", "pr_createdAt": "2020-07-02T20:56:38Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/4870", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ0Mjg3MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4870#discussion_r449442870", "bodyText": "Was that sometimes false?", "author": "npepinpe", "createdAt": "2020-07-03T08:12:34Z", "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/BrokerLeaderChangeTest.java", "diffHunk": "@@ -82,6 +84,32 @@ public void shouldChangeLeaderAfterLeaderDies() {\n     jobCompleter.close();\n   }\n \n+  @Test\n+  public void shouldBeAbleToBecomeLeaderAgain() {\n+    // given\n+    final var firstLeaderInfo = clusteringRule.getLeaderForPartition(1);\n+    final var firstLeaderNodeId = firstLeaderInfo.getNodeId();\n+    assertThat(clusteringRule.getCurrentLeaderForPartition(1).getNodeId())", "originalCommit": "d23a6ad61f4d57278d81fdc2707d5340abb09783", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2NTY2Mw==", "url": "https://github.com/camunda-cloud/zeebe/pull/4870#discussion_r449465663", "bodyText": "No was just to validate that it at the begining the first and then after the loop again - I had hope it makes the test more understanable :D but this failed :D", "author": "Zelldon", "createdAt": "2020-07-03T08:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ0Mjg3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ2NDMyNA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4870#discussion_r449464324", "bodyText": "Can we comment this? It took me a little a bit to figure out what we're doing - double loop to force leader change until the leader is back again to being the first one \ud83d\ude42 Clever though \ud83d\udc4d", "author": "npepinpe", "createdAt": "2020-07-03T08:55:18Z", "path": "qa/integration-tests/src/test/java/io/zeebe/broker/it/clustering/BrokerLeaderChangeTest.java", "diffHunk": "@@ -82,6 +84,32 @@ public void shouldChangeLeaderAfterLeaderDies() {\n     jobCompleter.close();\n   }\n \n+  @Test\n+  public void shouldBeAbleToBecomeLeaderAgain() {\n+    // given\n+    final var firstLeaderInfo = clusteringRule.getLeaderForPartition(1);\n+    final var firstLeaderNodeId = firstLeaderInfo.getNodeId();\n+    assertThat(clusteringRule.getCurrentLeaderForPartition(1).getNodeId())\n+        .isEqualTo(firstLeaderNodeId);\n+\n+    // when\n+    do {", "originalCommit": "d23a6ad61f4d57278d81fdc2707d5340abb09783", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f225a4d4a6b9b660abde5725040531b68ecbf379", "url": "https://github.com/camunda-cloud/zeebe/commit/f225a4d4a6b9b660abde5725040531b68ecbf379", "message": "fix(broker): cancel metrics timer to avoid segfault", "committedDate": "2020-07-03T11:23:55Z", "type": "commit"}, {"oid": "f225a4d4a6b9b660abde5725040531b68ecbf379", "url": "https://github.com/camunda-cloud/zeebe/commit/f225a4d4a6b9b660abde5725040531b68ecbf379", "message": "fix(broker): cancel metrics timer to avoid segfault", "committedDate": "2020-07-03T11:23:55Z", "type": "forcePushed"}]}