{"pr_number": 3978, "pr_title": "Respond NOT_FOUND when partition cannot be found", "pr_createdAt": "2020-03-04T14:23:24Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/3978", "timeline": [{"oid": "bc9106bad25eb5601e5d3d85221e65a60703f4f4", "url": "https://github.com/camunda-cloud/zeebe/commit/bc9106bad25eb5601e5d3d85221e65a60703f4f4", "message": "chore(it): remove test that dealt with nonexisting partition wrongly\n\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-04T15:19:54Z", "type": "forcePushed"}, {"oid": "5d2b13a6625178d0f04027c2c65812637661c42d", "url": "https://github.com/camunda-cloud/zeebe/commit/5d2b13a6625178d0f04027c2c65812637661c42d", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-04T16:20:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODEzMDM3Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388130377", "bodyText": "I suggest to have a more detailed message. Something like Expected to send request to partition '0', but partition '0' unknown in topology . https://github.com/zeebe-io/zeebe/wiki/Error-Guidelines", "author": "deepthidevaki", "createdAt": "2020-03-05T08:04:35Z", "path": "gateway/src/main/java/io/zeebe/gateway/cmd/PartitionNotFoundException.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.gateway.cmd;\n+\n+/**\n+ * Represents an exceptional error that occurs when a partition can not be found. For example this\n+ * can happen when the element instance key does not refer to a known partition.\n+ */\n+public class PartitionNotFoundException extends ClientException {\n+\n+  public PartitionNotFoundException(final int partitionId) {\n+    super(String.format(\"Unknown partition '%d'\", partitionId));", "originalCommit": "5d2b13a6625178d0f04027c2c65812637661c42d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f1fd9d503050cf4be295bf252ad25f96698aa8cd", "url": "https://github.com/camunda-cloud/zeebe/commit/f1fd9d503050cf4be295bf252ad25f96698aa8cd", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-05T08:39:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwOTY4Ng==", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388009686", "bodyText": "The thing about getting this back to a setVariables command (or any gRPC command from a client) is that there is no partition in the request (that the user explicitly knows about), so the error message doesn't point them toward the cause.\nSuggested text: super(String.format(\"This command refers to an element that doesn't exist. The request targeted an element on partition '%d', which cannot be found in the cluster. Check the command arguments.\", partitionId));", "author": "jwulf", "createdAt": "2020-03-05T00:12:16Z", "path": "gateway/src/main/java/io/zeebe/gateway/cmd/PartitionNotFoundException.java", "diffHunk": "@@ -0,0 +1,19 @@\n+/*\n+ * Copyright Camunda Services GmbH and/or licensed to Camunda Services GmbH under\n+ * one or more contributor license agreements. See the NOTICE file distributed\n+ * with this work for additional information regarding copyright ownership.\n+ * Licensed under the Zeebe Community License 1.0. You may not use this file\n+ * except in compliance with the Zeebe Community License 1.0.\n+ */\n+package io.zeebe.gateway.cmd;\n+\n+/**\n+ * Represents an exceptional error that occurs when a partition can not be found. For example this\n+ * can happen when the element instance key does not refer to a known partition.\n+ */\n+public class PartitionNotFoundException extends ClientException {\n+\n+  public PartitionNotFoundException(final int partitionId) {\n+    super(String.format(\"Unknown partition '%d'\", partitionId));", "originalCommit": "87829645f02a581f72aadcf855696d9c54630e2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODE1NTc3MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388155770", "bodyText": "If we can think of / or discover other cases where the user sees this error and this text is misleading, we can adjust.", "author": "jwulf", "createdAt": "2020-03-05T09:00:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwOTY4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgzMzQwOQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388833409", "bodyText": "@jwulf I've applied your comment to the code. Can you take another look?", "author": "korthout", "createdAt": "2020-03-06T10:43:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwOTY4Ng=="}], "type": "inlineReview"}, {"oid": "bb978a3687f040d80adfb97c9847ce365820f265", "url": "https://github.com/camunda-cloud/zeebe/commit/bb978a3687f040d80adfb97c9847ce365820f265", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-05T11:01:39Z", "type": "forcePushed"}, {"oid": "e3ed6d47913b4d6be46fb516cf820af44cc0b9cf", "url": "https://github.com/camunda-cloud/zeebe/commit/e3ed6d47913b4d6be46fb516cf820af44cc0b9cf", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-05T12:54:40Z", "type": "forcePushed"}, {"oid": "6cdf8ca9c06b9b890ebbe5f90e62e31958824e49", "url": "https://github.com/camunda-cloud/zeebe/commit/6cdf8ca9c06b9b890ebbe5f90e62e31958824e49", "message": "fix(gateway): respond NOT_FOUND when partition not found\n\nWhen a request from a client refers to an elementInstanceKey that does\nnot encapsulate a partition (or encapsulates a non-existing partition),\nthen the gateway now responds with NOT_FOUND.\n\nIt simply checks that the partitionId is part of the known partitions of\nthe topology.", "committedDate": "2020-03-06T09:25:55Z", "type": "commit"}, {"oid": "7dd410301ef60c700a7255a1209baec961d6f9b5", "url": "https://github.com/camunda-cloud/zeebe/commit/7dd410301ef60c700a7255a1209baec961d6f9b5", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-06T10:39:00Z", "type": "commit"}, {"oid": "7dd410301ef60c700a7255a1209baec961d6f9b5", "url": "https://github.com/camunda-cloud/zeebe/commit/7dd410301ef60c700a7255a1209baec961d6f9b5", "message": "chore(gateway): fix tests\n\n- fix test that expects a timeout\nPartitionId now needs to be a known partition. And now the timeout\nmessage is different, because a different part of the system now\nactually times out.\n\n- remove test that dealt with nonexisting partition wrongly\nIt was a feature, not a bug (according to this test). So I've removed\nit.", "committedDate": "2020-03-06T10:39:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODgzMjc4MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/3978#discussion_r388832780", "bodyText": "I reverted the removal of this method after discussing it with @npepinpe.\nThe method now only exists for a single test, but it was easier just to revert the removal of the method than to rewrite the test. A more thorough refactoring of the BrokerClient is needed anyways.", "author": "korthout", "createdAt": "2020-03-06T10:42:29Z", "path": "gateway/src/main/java/io/zeebe/gateway/impl/broker/BrokerClient.java", "diffHunk": "@@ -25,6 +25,8 @@\n       BrokerResponseConsumer<T> responseConsumer,\n       Consumer<Throwable> throwableConsumer);\n \n+  <T> ActorFuture<BrokerResponse<T>> sendRequest(BrokerRequest<T> request, Duration requestTimeout);", "originalCommit": "7dd410301ef60c700a7255a1209baec961d6f9b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "610502c23cfc704cef8aa89708ff16f8a94edf20", "url": "https://github.com/camunda-cloud/zeebe/commit/610502c23cfc704cef8aa89708ff16f8a94edf20", "message": "chore(gateway): improve partition not found error message", "committedDate": "2020-03-10T09:35:32Z", "type": "forcePushed"}, {"oid": "885a9a20824e49b0cce403b880d823d8245c3070", "url": "https://github.com/camunda-cloud/zeebe/commit/885a9a20824e49b0cce403b880d823d8245c3070", "message": "chore(gateway): improve partition not found error message", "committedDate": "2020-03-10T09:54:58Z", "type": "forcePushed"}, {"oid": "c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "url": "https://github.com/camunda-cloud/zeebe/commit/c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "message": "chore(gateway): improve partition not found error message", "committedDate": "2020-03-10T16:57:42Z", "type": "commit"}, {"oid": "c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "url": "https://github.com/camunda-cloud/zeebe/commit/c0144a9653af3b5a10b883e40f8ecd00e5e59c30", "message": "chore(gateway): improve partition not found error message", "committedDate": "2020-03-10T16:57:42Z", "type": "forcePushed"}, {"oid": "f53b4b038ff5310b2e87c9b96285a526405331f5", "url": "https://github.com/camunda-cloud/zeebe/commit/f53b4b038ff5310b2e87c9b96285a526405331f5", "message": "chore(gateway): fix test", "committedDate": "2020-03-10T17:19:11Z", "type": "commit"}]}