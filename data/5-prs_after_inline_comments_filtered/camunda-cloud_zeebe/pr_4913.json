{"pr_number": 4913, "pr_title": "chore(atomix): fix possible race conditions on closing messaging service", "pr_createdAt": "2020-07-08T19:45:48Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/4913", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNjY0NA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#discussion_r452136644", "bodyText": "Unfortunately I don't know how to add comments to lines which were not changed.\nMy question is: Do we also need to add/remove the future for the local connection case above?", "author": "pihme", "createdAt": "2020-07-09T11:01:23Z", "path": "atomix/cluster/src/main/java/io/atomix/cluster/messaging/impl/NettyMessagingService.java", "diffHunk": "@@ -462,12 +477,15 @@ private void initEventLoopGroup() {\n       return;\n     }\n \n+    // we need these to close them on stop", "originalCommit": "202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE1MTM1Mw==", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#discussion_r452151353", "bodyText": "No because they are executed anyway directly.", "author": "Zelldon", "createdAt": "2020-07-09T11:32:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzNjY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzOTA0Nw==", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#discussion_r452139047", "bodyText": "Maybe better:\nAssertions.assertThatCode(() -> toTest.method()).doesNotThrowAnyException(); or\n@Test(expected = Test.None.class /* no exception expected */)\npublic void test_printLine() {\n    Printer.printLine(\"line\");\n}", "author": "pihme", "createdAt": "2020-07-09T11:06:24Z", "path": "atomix/cluster/src/test/java/io/atomix/cluster/messaging/impl/NettyUnicastServiceTest.java", "diffHunk": "@@ -55,6 +56,18 @@ public void testUnicast() throws Exception {\n     await(5000);\n   }\n \n+  @Test\n+  public void shouldNotThrowExceptionWhenServiceStopped() throws Exception {\n+    // given\n+    service2.stop();\n+\n+    // when\n+    service2.unicast(address1, \"test\", \"Hello world!\".getBytes());\n+\n+    // then\n+    assertTrue(true);", "originalCommit": "202455f3a0c8ae4d5c2ccb4506f9de9d5dd56f63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0OTMzMA==", "url": "https://github.com/camunda-cloud/zeebe/pull/4913#discussion_r452149330", "bodyText": "Yeah I searched yesterday evening for that but was not able to find it idk maybe was to late. Thanks\nTried always assertThat and doesNotThrow \ud83d\ude05", "author": "Zelldon", "createdAt": "2020-07-09T11:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjEzOTA0Nw=="}], "type": "inlineReview"}, {"oid": "1ff531861752cf7e1f0681e68db30195e271b26a", "url": "https://github.com/camunda-cloud/zeebe/commit/1ff531861752cf7e1f0681e68db30195e271b26a", "message": "chore(atomix): fix possible race conditions on closing messaging service\n\n Requests which have been submitted in between might be not completed exceptionally when the service has stopped.\n Sending a message when the service is stopped will not thrown an exception.", "committedDate": "2020-07-09T11:39:13Z", "type": "commit"}, {"oid": "1ff531861752cf7e1f0681e68db30195e271b26a", "url": "https://github.com/camunda-cloud/zeebe/commit/1ff531861752cf7e1f0681e68db30195e271b26a", "message": "chore(atomix): fix possible race conditions on closing messaging service\n\n Requests which have been submitted in between might be not completed exceptionally when the service has stopped.\n Sending a message when the service is stopped will not thrown an exception.", "committedDate": "2020-07-09T11:39:13Z", "type": "forcePushed"}]}