{"pr_number": 5316, "pr_title": "Reject deployment with invalid workflows", "pr_createdAt": "2020-09-08T11:22:30Z", "pr_url": "https://github.com/camunda-cloud/zeebe/pull/5316", "timeline": [{"oid": "008e18b3cb56dc5996c442f40243b4ce129cb3a9", "url": "https://github.com/camunda-cloud/zeebe/commit/008e18b3cb56dc5996c442f40243b4ce129cb3a9", "message": "fix(broker): reject deployment with invalid workflows\n\n* validate the target expressions of variable mappings\n* validate static timer expressions\n* ignore error events that are not referenced in the workflow on validation and transformation\n* transform the workflow on validation to avoid missing validations, or unexpected failures on transforming", "committedDate": "2020-09-08T12:09:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI3MDA5MA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5316#discussion_r486270090", "bodyText": "This error message no longer adheres to our preferred error message template. Why do you want to change that?", "author": "korthout", "createdAt": "2020-09-10T11:41:43Z", "path": "engine/src/main/java/io/zeebe/engine/processing/common/ExpressionProcessor.java", "diffHunk": "@@ -130,10 +130,7 @@ public ExpressionProcessor(\n           return Either.right(Interval.parse(result.getString()));\n         } catch (final DateTimeParseException e) {\n           return Either.left(\n-              new Failure(\n-                  String.format(\n-                      \"Expected result of the expression '%s' to be parsed to a duration, but was '%s' and encountered error: %s\",\n-                      expression.getExpression(), result.getString(), e.getMessage())));\n+              new Failure(String.format(\"Invalid duration format '%s'\", result.getString())));", "originalCommit": "008e18b3cb56dc5996c442f40243b4ce129cb3a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjMyMzczNA==", "url": "https://github.com/camunda-cloud/zeebe/pull/5316#discussion_r486323734", "bodyText": "This comment goes for all error messages changed in this PR", "author": "korthout", "createdAt": "2020-09-10T13:11:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI3MDA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njc1ODA0MQ==", "url": "https://github.com/camunda-cloud/zeebe/pull/5316#discussion_r486758041", "bodyText": "The message template (\"Expected ... but was ...\") is applied to log statements or exceptions. Here, the message is used for the validation (i.e. the deployment rejection message) and for creating an incident. So, I think it is okay to have a different message.\nIn these two cases, the message feels a bit long and it doesn't provide more useful information.\n\"Expected result of the expression '\"foo\"' to be parsed to a duration, but was '\"foo\"' and encountered error: Text cannot be parsed to a Period\"\nvs.\n\"Invalid duration format '\"foo\"'\"", "author": "saig0", "createdAt": "2020-09-11T03:53:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI3MDA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzgzODk3Mg==", "url": "https://github.com/camunda-cloud/zeebe/pull/5316#discussion_r487838972", "bodyText": "Or, let's add the expression to the failure message.", "author": "saig0", "createdAt": "2020-09-14T11:24:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjI3MDA5MA=="}], "type": "inlineReview"}, {"oid": "1d888feb3d5f54315c361fe18c6445b8c48fb4fa", "url": "https://github.com/camunda-cloud/zeebe/commit/1d888feb3d5f54315c361fe18c6445b8c48fb4fa", "message": "fix(broker): reject deployment with invalid workflows\n\n* validate the target expressions of variable mappings\n* validate static timer expressions\n* ignore error events that are not referenced in the workflow on validation and transformation\n* transform the workflow on validation to avoid missing validations, or unexpected failures on transforming", "committedDate": "2020-09-14T14:52:57Z", "type": "commit"}, {"oid": "1d888feb3d5f54315c361fe18c6445b8c48fb4fa", "url": "https://github.com/camunda-cloud/zeebe/commit/1d888feb3d5f54315c361fe18c6445b8c48fb4fa", "message": "fix(broker): reject deployment with invalid workflows\n\n* validate the target expressions of variable mappings\n* validate static timer expressions\n* ignore error events that are not referenced in the workflow on validation and transformation\n* transform the workflow on validation to avoid missing validations, or unexpected failures on transforming", "committedDate": "2020-09-14T14:52:57Z", "type": "forcePushed"}]}