{"pr_number": 369, "pr_title": "Create TenantManager class and wire through listTenants operation.", "pr_createdAt": "2020-02-17T17:06:19Z", "pr_url": "https://github.com/firebase/firebase-admin-java/pull/369", "timeline": [{"oid": "3fef34293925814db2697577c3becb7f054c3ef0", "url": "https://github.com/firebase/firebase-admin-java/commit/3fef34293925814db2697577c3becb7f054c3ef0", "message": "Create TenantManager and wire through listTenants operation.", "committedDate": "2020-02-17T17:05:05Z", "type": "commit"}, {"oid": "2f62957f0e416db519d0de682a987a5e200b32c1", "url": "https://github.com/firebase/firebase-admin-java/commit/2f62957f0e416db519d0de682a987a5e200b32c1", "message": "Fix formatting of javadoc comment.", "committedDate": "2020-02-17T17:08:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MTcxMQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r380871711", "bodyText": "protected makes more sense here.", "author": "hiranya911", "createdAt": "2020-02-18T19:00:14Z", "path": "src/main/java/com/google/firebase/auth/AbstractFirebaseAuth.java", "diffHunk": "@@ -1074,7 +1072,7 @@ protected String execute() throws FirebaseAuthException {\n     };\n   }\n \n-  private <T> Supplier<T> threadSafeMemoize(final Supplier<T> supplier) {\n+  <T> Supplier<T> threadSafeMemoize(final Supplier<T> supplier) {", "originalCommit": "2f62957f0e416db519d0de682a987a5e200b32c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NzM3Mw==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r381057373", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-19T03:18:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MTcxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MjI5MQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r380872291", "bodyText": "final", "author": "hiranya911", "createdAt": "2020-02-18T19:01:22Z", "path": "src/main/java/com/google/firebase/auth/TenantManager.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.auth;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.core.ApiFuture;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.auth.ListTenantsPage.DefaultTenantSource;\n+import com.google.firebase.auth.ListTenantsPage.PageFactory;\n+import com.google.firebase.auth.ListTenantsPage.TenantSource;\n+import com.google.firebase.auth.Tenant.CreateRequest;\n+import com.google.firebase.auth.Tenant.UpdateRequest;\n+import com.google.firebase.internal.CallableOperation;\n+import com.google.firebase.internal.NonNull;\n+import com.google.firebase.internal.Nullable;\n+\n+/**\n+ * This class can be used to perform a variety of tenant-related operations, including creating,\n+ * updating, and listing tenants.\n+ *\n+ * <p>TODO(micahstairs): Implement the following methods: getAuthForTenant(), getTenant(),\n+ * deleteTenant(), createTenant(), and updateTenant().\n+ */\n+public class TenantManager {", "originalCommit": "2f62957f0e416db519d0de682a987a5e200b32c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NzMxNg==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r381057316", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-19T03:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MjI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MjQ5MQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r380872491", "bodyText": "Make the constructor package-protected", "author": "hiranya911", "createdAt": "2020-02-18T19:01:44Z", "path": "src/main/java/com/google/firebase/auth/TenantManager.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.auth;\n+\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.core.ApiFuture;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.auth.ListTenantsPage.DefaultTenantSource;\n+import com.google.firebase.auth.ListTenantsPage.PageFactory;\n+import com.google.firebase.auth.ListTenantsPage.TenantSource;\n+import com.google.firebase.auth.Tenant.CreateRequest;\n+import com.google.firebase.auth.Tenant.UpdateRequest;\n+import com.google.firebase.internal.CallableOperation;\n+import com.google.firebase.internal.NonNull;\n+import com.google.firebase.internal.Nullable;\n+\n+/**\n+ * This class can be used to perform a variety of tenant-related operations, including creating,\n+ * updating, and listing tenants.\n+ *\n+ * <p>TODO(micahstairs): Implement the following methods: getAuthForTenant(), getTenant(),\n+ * deleteTenant(), createTenant(), and updateTenant().\n+ */\n+public class TenantManager {\n+\n+  private final FirebaseApp firebaseApp;\n+  private final FirebaseUserManager userManager;\n+\n+  public TenantManager(FirebaseApp firebaseApp, FirebaseUserManager userManager) {", "originalCommit": "2f62957f0e416db519d0de682a987a5e200b32c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NzI4NA==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r381057284", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-19T03:18:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MjQ5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MzU1OQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r380873559", "bodyText": "We don't use defaults in DownloadAccountResponse. Why were they necessary here?", "author": "hiranya911", "createdAt": "2020-02-18T19:03:54Z", "path": "src/main/java/com/google/firebase/auth/internal/ListTenantsResponse.java", "diffHunk": "@@ -17,20 +17,24 @@\n package com.google.firebase.auth.internal;\n \n import com.google.api.client.util.Key;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.collect.ImmutableList;\n+import com.google.firebase.auth.ListTenantsPage;\n import com.google.firebase.auth.Tenant;\n import java.util.List;\n \n /**\n  * JSON data binding for ListTenantsResponse messages sent by Google identity toolkit service.\n  */\n-public class ListTenantsResponse {\n+public final class ListTenantsResponse {\n \n   @Key(\"tenants\")\n-  private List<Tenant> tenants;\n+  private List<Tenant> tenants = ImmutableList.of(); // Default to empty list.", "originalCommit": "2f62957f0e416db519d0de682a987a5e200b32c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1ODI3OA==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r381058278", "bodyText": "The reason we didn't have to use them in DownloadAccountResponse is because of what we do in ListUsersPage.DefaultUserSource.fetch() with the ListUsersResult class as an intermediate storage class. We handle the null case and empty list case there.\nBut in ListTenantsPage, we decided not to include ListTenantsResult.\nHaving these defaults set in ListTenantsResponse does feel clunky to me though. Perhaps I should re-add the ListTenantsResult class for consistency?", "author": "micahstairs", "createdAt": "2020-02-19T03:22:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MzU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ1ODQxNA==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r381458414", "bodyText": "Perhaps handle them in the getters?\npublic List<Tenant> getTenants() {\n  if (tenants != null) {\n    return tenants;\n  }\n\n  return ImmutableList.of();\n}", "author": "hiranya911", "createdAt": "2020-02-19T18:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3MzU1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3NTA0Nw==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r380875047", "bodyText": "Suggestion: Just to be in safe side, let's give your test tenants different IDs (say TENANT_ID_1 and TENANT_ID_2). Then change the signature of this method to accept both Tenant and String tenantId, so the caller can pass them in to verify.", "author": "hiranya911", "createdAt": "2020-02-18T19:06:56Z", "path": "src/test/java/com/google/firebase/auth/FirebaseUserManagerTest.java", "diffHunk": "@@ -1264,6 +1310,13 @@ private static void checkUserRecord(UserRecord userRecord) {\n     assertEquals(\"gold\", claims.get(\"package\"));\n   }\n \n+  private static void checkTenant(Tenant tenant) {", "originalCommit": "2f62957f0e416db519d0de682a987a5e200b32c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA1NzI2Mw==", "url": "https://github.com/firebase/firebase-admin-java/pull/369#discussion_r381057263", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-19T03:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3NTA0Nw=="}], "type": "inlineReview"}, {"oid": "9af10110167a0aa467130f17e02cec267ed076af", "url": "https://github.com/firebase/firebase-admin-java/commit/9af10110167a0aa467130f17e02cec267ed076af", "message": "Implement suggested changes.", "committedDate": "2020-02-19T03:08:39Z", "type": "commit"}, {"oid": "d3936d392a346896f3ef1fefbbf4414a52feff15", "url": "https://github.com/firebase/firebase-admin-java/commit/d3936d392a346896f3ef1fefbbf4414a52feff15", "message": "Handle ListTenantsResponse defaults in the getters.", "committedDate": "2020-02-20T02:56:10Z", "type": "commit"}]}