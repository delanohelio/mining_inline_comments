{"pr_number": 477, "pr_title": "Add initial classes for Remote Config API", "pr_createdAt": "2020-09-10T20:49:42Z", "pr_url": "https://github.com/firebase/firebase-admin-java/pull/477", "timeline": [{"oid": "498018e9419959a96d8afba152608ba1e8f81f2f", "url": "https://github.com/firebase/firebase-admin-java/commit/498018e9419959a96d8afba152608ba1e8f81f2f", "message": "Add initial classes for Remote Config API\nAdd unit tests", "committedDate": "2020-09-10T20:51:25Z", "type": "forcePushed"}, {"oid": "74c21d37e5f93e763a784c79eceb86873793861c", "url": "https://github.com/firebase/firebase-admin-java/commit/74c21d37e5f93e763a784c79eceb86873793861c", "message": "Add initial classes for Remote Config API\nAdd unit tests", "committedDate": "2020-09-10T20:53:34Z", "type": "forcePushed"}, {"oid": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "url": "https://github.com/firebase/firebase-admin-java/commit/07ec3047f51bbefef8560133a4ad0d0c614b9647", "message": "Add initial classes for Remote Config API\nAdd unit tests", "committedDate": "2020-09-10T21:55:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2NjUzNA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486666534", "bodyText": "REMOTE_CONFIG_URL", "author": "hiranya911", "createdAt": "2020-09-10T22:23:00Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2Njc0OA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486666748", "bodyText": "Do we need to set this header for this API?", "author": "hiranya911", "createdAt": "2020-09-10T22:23:34Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIwOTcyNQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487209725", "bodyText": "Including that header gives simpler to parse error messages. Please see below:\nWith the X-GOOG-API-FORMAT-VERSION header:\nError Response:{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"[VERSION_MISMATCH]: No If-Match header found on UpdateRemoteConfig call\",\n    \"status\": \"FAILED_PRECONDITION\"\n  }\n}\n\nWithout the header:\nError Response:{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"[VERSION_MISMATCH]: No If-Match header found on UpdateRemoteConfig call\",\n    \"errors\": [\n      {\n        \"message\": \"[VERSION_MISMATCH]: No If-Match header found on UpdateRemoteConfig call\",\n        \"domain\": \"global\",\n        \"reason\": \"failedPrecondition\"\n      }\n    ],\n    \"status\": \"FAILED_PRECONDITION\"\n  }\n}", "author": "lahirumaramba", "createdAt": "2020-09-11T18:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2Njc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2NDcyNQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487264725", "bodyText": "I don't quite see a difference that would affect us. Without the header it seems to include a nested errors section, but we can just ignore it, right?", "author": "hiranya911", "createdAt": "2020-09-11T20:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2Njc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEyMjk1OQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r488122959", "bodyText": "Good point. Removed this header.", "author": "lahirumaramba", "createdAt": "2020-09-14T18:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2Njc0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2NzAxNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486667017", "bodyText": "Add a comment describing why this is needed.", "author": "hiranya911", "createdAt": "2020-09-10T22:24:22Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2NzY0Ng==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486667646", "bodyText": "rcSendUrl is not a good name for this. May be just remoteConfigUrl.", "author": "hiranya911", "createdAt": "2020-09-10T22:25:55Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2ODU4Mw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486668583", "bodyText": "Redundant spacing", "author": "hiranya911", "createdAt": "2020-09-10T22:28:35Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;\n+  private final HttpRequestFactory requestFactory;\n+  private final HttpRequestFactory childRequestFactory;\n+  private final JsonFactory jsonFactory;\n+  private final ErrorHandlingHttpClient<FirebaseRemoteConfigException> httpClient;\n+\n+  private FirebaseRemoteConfigClientImpl(Builder builder) {\n+    checkArgument(!Strings.isNullOrEmpty(builder.projectId));\n+    this.rcSendUrl = String.format(RC_URL, builder.projectId);\n+    this.requestFactory = checkNotNull(builder.requestFactory);\n+    this.childRequestFactory = checkNotNull(builder.childRequestFactory);\n+    this.jsonFactory = checkNotNull(builder.jsonFactory);\n+    HttpResponseInterceptor responseInterceptor = builder.responseInterceptor;\n+    RemoteConfigErrorHandler errorHandler = new RemoteConfigErrorHandler(this.jsonFactory);\n+    this.httpClient = new ErrorHandlingHttpClient<>(requestFactory, jsonFactory, errorHandler)\n+            .setInterceptor(responseInterceptor);\n+  }\n+\n+  @VisibleForTesting\n+  String getRcSendUrl() {\n+    return rcSendUrl;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getRequestFactory() {\n+    return requestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getChildRequestFactory() {\n+    return childRequestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  JsonFactory getJsonFactory() {\n+    return jsonFactory;\n+  }\n+\n+  @Override\n+  public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+            .addAllHeaders(COMMON_HEADERS);\n+    IncomingHttpResponse response = httpClient.send(request);\n+    RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n+\n+    List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n+", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2ODYxNg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486668616", "bodyText": "Remove space", "author": "hiranya911", "createdAt": "2020-09-10T22:28:43Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;\n+  private final HttpRequestFactory requestFactory;\n+  private final HttpRequestFactory childRequestFactory;\n+  private final JsonFactory jsonFactory;\n+  private final ErrorHandlingHttpClient<FirebaseRemoteConfigException> httpClient;\n+\n+  private FirebaseRemoteConfigClientImpl(Builder builder) {\n+    checkArgument(!Strings.isNullOrEmpty(builder.projectId));\n+    this.rcSendUrl = String.format(RC_URL, builder.projectId);\n+    this.requestFactory = checkNotNull(builder.requestFactory);\n+    this.childRequestFactory = checkNotNull(builder.childRequestFactory);\n+    this.jsonFactory = checkNotNull(builder.jsonFactory);\n+    HttpResponseInterceptor responseInterceptor = builder.responseInterceptor;\n+    RemoteConfigErrorHandler errorHandler = new RemoteConfigErrorHandler(this.jsonFactory);\n+    this.httpClient = new ErrorHandlingHttpClient<>(requestFactory, jsonFactory, errorHandler)\n+            .setInterceptor(responseInterceptor);\n+  }\n+\n+  @VisibleForTesting\n+  String getRcSendUrl() {\n+    return rcSendUrl;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getRequestFactory() {\n+    return requestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getChildRequestFactory() {\n+    return childRequestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  JsonFactory getJsonFactory() {\n+    return jsonFactory;\n+  }\n+\n+  @Override\n+  public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+            .addAllHeaders(COMMON_HEADERS);\n+    IncomingHttpResponse response = httpClient.send(request);\n+    RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n+\n+    List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n+\n+    if (etagList == null || etagList.isEmpty()) {\n+      throw new FirebaseRemoteConfigException(\n+              ErrorCode.INTERNAL,\n+              \"ETag header is not available in the server response.\", null, null,\n+              RemoteConfigErrorCode.INTERNAL);\n+    }\n+\n+    String etag = etagList.get(0);\n+", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2OTM4Ng==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486669386", "bodyText": "This looks like some unexpected backend error condition. We probably shouldn't convert them into FirebaseException.That implies we expect the developer to handle them. I think we should throw a runtime exception and fail-fast.", "author": "hiranya911", "createdAt": "2020-09-10T22:30:57Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;\n+  private final HttpRequestFactory requestFactory;\n+  private final HttpRequestFactory childRequestFactory;\n+  private final JsonFactory jsonFactory;\n+  private final ErrorHandlingHttpClient<FirebaseRemoteConfigException> httpClient;\n+\n+  private FirebaseRemoteConfigClientImpl(Builder builder) {\n+    checkArgument(!Strings.isNullOrEmpty(builder.projectId));\n+    this.rcSendUrl = String.format(RC_URL, builder.projectId);\n+    this.requestFactory = checkNotNull(builder.requestFactory);\n+    this.childRequestFactory = checkNotNull(builder.childRequestFactory);\n+    this.jsonFactory = checkNotNull(builder.jsonFactory);\n+    HttpResponseInterceptor responseInterceptor = builder.responseInterceptor;\n+    RemoteConfigErrorHandler errorHandler = new RemoteConfigErrorHandler(this.jsonFactory);\n+    this.httpClient = new ErrorHandlingHttpClient<>(requestFactory, jsonFactory, errorHandler)\n+            .setInterceptor(responseInterceptor);\n+  }\n+\n+  @VisibleForTesting\n+  String getRcSendUrl() {\n+    return rcSendUrl;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getRequestFactory() {\n+    return requestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getChildRequestFactory() {\n+    return childRequestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  JsonFactory getJsonFactory() {\n+    return jsonFactory;\n+  }\n+\n+  @Override\n+  public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+            .addAllHeaders(COMMON_HEADERS);\n+    IncomingHttpResponse response = httpClient.send(request);\n+    RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n+\n+    List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n+\n+    if (etagList == null || etagList.isEmpty()) {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyNzU3MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487227570", "bodyText": "Good pint! Will update the code. Thanks!", "author": "lahirumaramba", "createdAt": "2020-09-11T18:49:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2OTM4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2OTYwNg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486669606", "bodyText": "Here too. Can't expect the developer to handle these.", "author": "hiranya911", "createdAt": "2020-09-10T22:31:38Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;\n+  private final HttpRequestFactory requestFactory;\n+  private final HttpRequestFactory childRequestFactory;\n+  private final JsonFactory jsonFactory;\n+  private final ErrorHandlingHttpClient<FirebaseRemoteConfigException> httpClient;\n+\n+  private FirebaseRemoteConfigClientImpl(Builder builder) {\n+    checkArgument(!Strings.isNullOrEmpty(builder.projectId));\n+    this.rcSendUrl = String.format(RC_URL, builder.projectId);\n+    this.requestFactory = checkNotNull(builder.requestFactory);\n+    this.childRequestFactory = checkNotNull(builder.childRequestFactory);\n+    this.jsonFactory = checkNotNull(builder.jsonFactory);\n+    HttpResponseInterceptor responseInterceptor = builder.responseInterceptor;\n+    RemoteConfigErrorHandler errorHandler = new RemoteConfigErrorHandler(this.jsonFactory);\n+    this.httpClient = new ErrorHandlingHttpClient<>(requestFactory, jsonFactory, errorHandler)\n+            .setInterceptor(responseInterceptor);\n+  }\n+\n+  @VisibleForTesting\n+  String getRcSendUrl() {\n+    return rcSendUrl;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getRequestFactory() {\n+    return requestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getChildRequestFactory() {\n+    return childRequestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  JsonFactory getJsonFactory() {\n+    return jsonFactory;\n+  }\n+\n+  @Override\n+  public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+            .addAllHeaders(COMMON_HEADERS);\n+    IncomingHttpResponse response = httpClient.send(request);\n+    RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n+\n+    List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n+\n+    if (etagList == null || etagList.isEmpty()) {\n+      throw new FirebaseRemoteConfigException(\n+              ErrorCode.INTERNAL,\n+              \"ETag header is not available in the server response.\", null, null,\n+              RemoteConfigErrorCode.INTERNAL);\n+    }\n+\n+    String etag = etagList.get(0);\n+\n+    if (Strings.isNullOrEmpty(etag)) {\n+      throw new FirebaseRemoteConfigException(", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3MDU0OQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486670549", "bodyText": "This is an FCM thing. Not relevant here.", "author": "hiranya911", "createdAt": "2020-09-10T22:34:09Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;\n+  private final HttpRequestFactory requestFactory;\n+  private final HttpRequestFactory childRequestFactory;\n+  private final JsonFactory jsonFactory;\n+  private final ErrorHandlingHttpClient<FirebaseRemoteConfigException> httpClient;\n+\n+  private FirebaseRemoteConfigClientImpl(Builder builder) {\n+    checkArgument(!Strings.isNullOrEmpty(builder.projectId));\n+    this.rcSendUrl = String.format(RC_URL, builder.projectId);\n+    this.requestFactory = checkNotNull(builder.requestFactory);\n+    this.childRequestFactory = checkNotNull(builder.childRequestFactory);\n+    this.jsonFactory = checkNotNull(builder.jsonFactory);\n+    HttpResponseInterceptor responseInterceptor = builder.responseInterceptor;\n+    RemoteConfigErrorHandler errorHandler = new RemoteConfigErrorHandler(this.jsonFactory);\n+    this.httpClient = new ErrorHandlingHttpClient<>(requestFactory, jsonFactory, errorHandler)\n+            .setInterceptor(responseInterceptor);\n+  }\n+\n+  @VisibleForTesting\n+  String getRcSendUrl() {\n+    return rcSendUrl;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getRequestFactory() {\n+    return requestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  HttpRequestFactory getChildRequestFactory() {\n+    return childRequestFactory;\n+  }\n+\n+  @VisibleForTesting\n+  JsonFactory getJsonFactory() {\n+    return jsonFactory;\n+  }\n+\n+  @Override\n+  public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+            .addAllHeaders(COMMON_HEADERS);\n+    IncomingHttpResponse response = httpClient.send(request);\n+    RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n+\n+    List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n+\n+    if (etagList == null || etagList.isEmpty()) {\n+      throw new FirebaseRemoteConfigException(\n+              ErrorCode.INTERNAL,\n+              \"ETag header is not available in the server response.\", null, null,\n+              RemoteConfigErrorCode.INTERNAL);\n+    }\n+\n+    String etag = etagList.get(0);\n+\n+    if (Strings.isNullOrEmpty(etag)) {\n+      throw new FirebaseRemoteConfigException(\n+              ErrorCode.INTERNAL,\n+              \"ETag header is not available in the server response.\", null, null,\n+              RemoteConfigErrorCode.INTERNAL);\n+    }\n+\n+    parsed.setETag(etag);\n+    return parsed;\n+  }\n+\n+  static FirebaseRemoteConfigClientImpl fromApp(FirebaseApp app) {\n+    String projectId = ImplFirebaseTrampolines.getProjectId(app);\n+    checkArgument(!Strings.isNullOrEmpty(projectId),\n+            \"Project ID is required to access Remote Config service. Use a service \"\n+                    + \"account credential or set the project ID explicitly via FirebaseOptions. \"\n+                    + \"Alternatively you can also set the project ID via the GOOGLE_CLOUD_PROJECT \"\n+                    + \"environment variable.\");\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(projectId)\n+            .setRequestFactory(ApiClientUtils.newAuthorizedRequestFactory(app))\n+            .setChildRequestFactory(ApiClientUtils.newUnauthorizedRequestFactory(app))\n+            .setJsonFactory(app.getOptions().getJsonFactory())\n+            .build();\n+  }\n+\n+  static Builder builder() {\n+    return new Builder();\n+  }\n+\n+  static final class Builder {\n+\n+    private String projectId;\n+    private HttpRequestFactory requestFactory;\n+    private HttpRequestFactory childRequestFactory;\n+    private JsonFactory jsonFactory;\n+    private HttpResponseInterceptor responseInterceptor;\n+\n+    private Builder() { }\n+\n+    Builder setProjectId(String projectId) {\n+      this.projectId = projectId;\n+      return this;\n+    }\n+\n+    Builder setRequestFactory(HttpRequestFactory requestFactory) {\n+      this.requestFactory = requestFactory;\n+      return this;\n+    }\n+\n+    Builder setChildRequestFactory(", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3MDU4NA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486670584", "bodyText": "Not applicable", "author": "hiranya911", "createdAt": "2020-09-10T22:34:20Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -0,0 +1,224 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static com.google.common.base.Preconditions.checkArgument;\n+import static com.google.common.base.Preconditions.checkNotNull;\n+\n+import com.google.api.client.http.HttpRequestFactory;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseException;\n+import com.google.firebase.ImplFirebaseTrampolines;\n+import com.google.firebase.IncomingHttpResponse;\n+import com.google.firebase.internal.AbstractPlatformErrorHandler;\n+import com.google.firebase.internal.ApiClientUtils;\n+import com.google.firebase.internal.ErrorHandlingHttpClient;\n+import com.google.firebase.internal.HttpRequestInfo;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.remoteconfig.internal.RemoteConfigServiceErrorResponse;\n+\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * A helper class for interacting with Firebase Remote Config service.\n+ */\n+final class FirebaseRemoteConfigClientImpl implements FirebaseRemoteConfigClient {\n+\n+  private static final String RC_URL = \"https://firebaseremoteconfig.googleapis.com/v1/projects/%s/remoteConfig\";\n+\n+  private static final Map<String, String> COMMON_HEADERS =\n+          ImmutableMap.of(\n+                  \"X-GOOG-API-FORMAT-VERSION\", \"2\",\n+                  \"X-Firebase-Client\", \"fire-admin-java/\" + SdkUtils.getVersion(),\n+                  \"Accept-Encoding\", \"gzip\"\n+          );\n+\n+  private final String rcSendUrl;\n+  private final HttpRequestFactory requestFactory;\n+  private final HttpRequestFactory childRequestFactory;", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3MjU2Ng==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486672566", "bodyText": "Are these the only possible error codes? If so we shouldn't expose this enum.", "author": "hiranya911", "createdAt": "2020-09-10T22:39:40Z", "path": "src/main/java/com/google/firebase/remoteconfig/RemoteConfigErrorCode.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+/**\n+ * Error codes that can be raised by the Remote Config APIs.\n+ */\n+public enum RemoteConfigErrorCode {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI0OTgyMA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487249820", "bodyText": "No, there are more. I was going to add the rest as we implement more features in future PRs.", "author": "lahirumaramba", "createdAt": "2020-09-11T19:34:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3MjU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3MjY0Mw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486672643", "bodyText": "Make all public classes final.", "author": "hiranya911", "createdAt": "2020-09-10T22:39:53Z", "path": "src/main/java/com/google/firebase/remoteconfig/RemoteConfigTemplate.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import com.google.api.client.util.Key;\n+\n+public class RemoteConfigTemplate {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mjk1NQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486672955", "bodyText": "Why is the setter needed?", "author": "hiranya911", "createdAt": "2020-09-10T22:40:36Z", "path": "src/main/java/com/google/firebase/remoteconfig/RemoteConfigTemplate.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import com.google.api.client.util.Key;\n+\n+public class RemoteConfigTemplate {\n+\n+  @Key(\"etag\")\n+  private String etag;\n+\n+  public String getETag() {\n+    return this.etag;\n+  }\n+\n+  void setETag(String etag) {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MDkxNA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487250914", "bodyText": "The ETag is in the response header. We need to extract it from the server response and set the value in the json parsed instance.\nhttps://github.com/firebase/firebase-admin-java/pull/477/files#diff-76866506ed3eb4db3eeec1778f57ba31R122", "author": "lahirumaramba", "createdAt": "2020-09-11T19:36:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mjk1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486673793", "bodyText": "Not used", "author": "hiranya911", "createdAt": "2020-09-10T22:42:58Z", "path": "src/main/java/com/google/firebase/remoteconfig/internal/RemoteConfigServiceErrorResponse.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig.internal;\n+\n+import com.google.api.client.json.GenericJson;\n+import com.google.api.client.util.Key;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.internal.Nullable;\n+import com.google.firebase.remoteconfig.RemoteConfigErrorCode;\n+\n+import java.util.Map;\n+\n+/**\n+ * The DTO for parsing error responses from the Remote Config service.\n+ * These error messages take the form,\n+ * `\"error\": {\"code\": 123, \"message\": \"[CODE]: Message Details\", \"status\": \"ERROR_STATUS\"}`\n+ */\n+public class RemoteConfigServiceErrorResponse extends GenericJson {\n+\n+  private static final Map<String, RemoteConfigErrorCode> RC_ERROR_CODES =\n+          ImmutableMap.<String, RemoteConfigErrorCode>builder()\n+                  .put(\"INTERNAL\", RemoteConfigErrorCode.INTERNAL)\n+                  .put(\"INVALID_ARGUMENT\", RemoteConfigErrorCode.INVALID_ARGUMENT)\n+                  .build();\n+\n+  @Key(\"error\")\n+  private Map<String, Object> error;\n+\n+  public String getStatus() {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MjM1MQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487252351", "bodyText": "I wonder maybe we should use the status as the error code. In the current implementation we extract the error code from the error message. Since that is already part of the message I think we could use the status in getRemoteConfigErrorCode()", "author": "lahirumaramba", "createdAt": "2020-09-11T19:39:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MjU3OQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487252579", "bodyText": "Here is a sample error response:\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"[VERSION_MISMATCH]: No If-Match header found on UpdateRemoteConfig call\",\n    \"status\": \"FAILED_PRECONDITION\"\n  }", "author": "lahirumaramba", "createdAt": "2020-09-11T19:40:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2NTIxNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487265217", "bodyText": "status contains the OnePlatform error code. See AbstractPlatformErrorHandler and https://cloud.google.com/apis/design/errors for more details.", "author": "hiranya911", "createdAt": "2020-09-11T20:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI3OTE3OA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487279178", "bodyText": "Ah nice! Let's use the status as the error code then. Thanks!", "author": "lahirumaramba", "createdAt": "2020-09-11T20:37:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5NDc4Mg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487294782", "bodyText": "This happens automatically at the AbstractPlatformErrorHandler. You only need to extract the RC error code from the message.", "author": "hiranya911", "createdAt": "2020-09-11T21:17:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODEyMjY5Nw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r488122697", "bodyText": "Updated, Thanks!!", "author": "lahirumaramba", "createdAt": "2020-09-14T18:02:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Mzg1Mg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486673852", "bodyText": "This is also only used in one place. Can be just inlined.", "author": "hiranya911", "createdAt": "2020-09-10T22:43:12Z", "path": "src/main/java/com/google/firebase/remoteconfig/internal/RemoteConfigServiceErrorResponse.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig.internal;\n+\n+import com.google.api.client.json.GenericJson;\n+import com.google.api.client.util.Key;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.internal.Nullable;\n+import com.google.firebase.remoteconfig.RemoteConfigErrorCode;\n+\n+import java.util.Map;\n+\n+/**\n+ * The DTO for parsing error responses from the Remote Config service.\n+ * These error messages take the form,\n+ * `\"error\": {\"code\": 123, \"message\": \"[CODE]: Message Details\", \"status\": \"ERROR_STATUS\"}`\n+ */\n+public class RemoteConfigServiceErrorResponse extends GenericJson {\n+\n+  private static final Map<String, RemoteConfigErrorCode> RC_ERROR_CODES =\n+          ImmutableMap.<String, RemoteConfigErrorCode>builder()\n+                  .put(\"INTERNAL\", RemoteConfigErrorCode.INTERNAL)\n+                  .put(\"INVALID_ARGUMENT\", RemoteConfigErrorCode.INVALID_ARGUMENT)\n+                  .build();\n+\n+  @Key(\"error\")\n+  private Map<String, Object> error;\n+\n+  public String getStatus() {\n+    if (error == null) {\n+      return null;\n+    }\n+\n+    return (String) error.get(\"status\");\n+  }\n+\n+  @Nullable\n+  public RemoteConfigErrorCode getRemoteConfigErrorCode() {\n+    if (error == null) {\n+      return null;\n+    }\n+\n+    String message = getErrorMessage();\n+    if (Strings.isNullOrEmpty(message)) {\n+      return null;\n+    }\n+\n+    int separator = message.indexOf(':');\n+    if (separator != -1) {\n+      String errorCode = message.substring(0, separator).replaceAll(\"\\\\[|\\\\]\", \"\");\n+      return RC_ERROR_CODES.get(errorCode);\n+    }\n+\n+    return null;\n+  }\n+\n+  @Nullable\n+  public String getErrorMessage() {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Njk4Mw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486676983", "bodyText": "Might be cleaner to extract this using a regex group match like ^\\[(\\w+)\\]:.*$. The current implementation is too lenient.", "author": "hiranya911", "createdAt": "2020-09-10T22:52:45Z", "path": "src/main/java/com/google/firebase/remoteconfig/internal/RemoteConfigServiceErrorResponse.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig.internal;\n+\n+import com.google.api.client.json.GenericJson;\n+import com.google.api.client.util.Key;\n+import com.google.common.base.Strings;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.internal.Nullable;\n+import com.google.firebase.remoteconfig.RemoteConfigErrorCode;\n+\n+import java.util.Map;\n+\n+/**\n+ * The DTO for parsing error responses from the Remote Config service.\n+ * These error messages take the form,\n+ * `\"error\": {\"code\": 123, \"message\": \"[CODE]: Message Details\", \"status\": \"ERROR_STATUS\"}`\n+ */\n+public class RemoteConfigServiceErrorResponse extends GenericJson {\n+\n+  private static final Map<String, RemoteConfigErrorCode> RC_ERROR_CODES =\n+          ImmutableMap.<String, RemoteConfigErrorCode>builder()\n+                  .put(\"INTERNAL\", RemoteConfigErrorCode.INTERNAL)\n+                  .put(\"INVALID_ARGUMENT\", RemoteConfigErrorCode.INVALID_ARGUMENT)\n+                  .build();\n+\n+  @Key(\"error\")\n+  private Map<String, Object> error;\n+\n+  public String getStatus() {\n+    if (error == null) {\n+      return null;\n+    }\n+\n+    return (String) error.get(\"status\");\n+  }\n+\n+  @Nullable\n+  public RemoteConfigErrorCode getRemoteConfigErrorCode() {\n+    if (error == null) {\n+      return null;\n+    }\n+\n+    String message = getErrorMessage();\n+    if (Strings.isNullOrEmpty(message)) {\n+      return null;\n+    }\n+\n+    int separator = message.indexOf(':');", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1MzEwNg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487253106", "bodyText": "Good point!\nPlease see my suggestion above to use the status instead... This issue will become obsolete if we use the status here.", "author": "lahirumaramba", "createdAt": "2020-09-11T19:41:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Njk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5NDk0MQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487294941", "bodyText": "You will still need to parse this to extract the RC error code.", "author": "hiranya911", "createdAt": "2020-09-11T21:17:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3Njk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3NzYxNg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486677616", "bodyText": "The general format is:\nsetup code\n<space>\nTest API\n<space>\nAssertions", "author": "hiranya911", "createdAt": "2020-09-10T22:54:51Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =\n+          \"https://firebaseremoteconfig.googleapis.com/v1/projects/test-project/remoteConfig\";\n+\n+  private static final List<Integer> HTTP_ERRORS = ImmutableList.of(401, 404, 500);\n+\n+  private static final Map<Integer, ErrorCode> HTTP_2_ERROR = ImmutableMap.of(\n+          401, ErrorCode.UNAUTHENTICATED,\n+          404, ErrorCode.NOT_FOUND,\n+          500, ErrorCode.INTERNAL);\n+\n+  private static final String MOCK_TEMPLATE_RESPONSE = \"{\\\"conditions\\\": [], \\\"parameters\\\": {}}\";\n+\n+  private static final String TEST_ETAG = \"etag-123456789012-1\";\n+\n+  private MockLowLevelHttpResponse response;\n+  private TestResponseInterceptor interceptor;\n+  private FirebaseRemoteConfigClient client;\n+\n+  @Before\n+  public void setUp() {\n+    response = new MockLowLevelHttpResponse();\n+    interceptor = new TestResponseInterceptor();\n+    client = initRemoteConfigClient(response, interceptor);\n+  }\n+\n+  @Test\n+  public void testGetTemplate() throws Exception {\n+    response.addHeader(\"etag\", TEST_ETAG);", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3ODM0NA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486678344", "bodyText": "This is still using the same response object as above. So it still has the etag header set to empty string.", "author": "hiranya911", "createdAt": "2020-09-10T22:57:03Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =\n+          \"https://firebaseremoteconfig.googleapis.com/v1/projects/test-project/remoteConfig\";\n+\n+  private static final List<Integer> HTTP_ERRORS = ImmutableList.of(401, 404, 500);\n+\n+  private static final Map<Integer, ErrorCode> HTTP_2_ERROR = ImmutableMap.of(\n+          401, ErrorCode.UNAUTHENTICATED,\n+          404, ErrorCode.NOT_FOUND,\n+          500, ErrorCode.INTERNAL);\n+\n+  private static final String MOCK_TEMPLATE_RESPONSE = \"{\\\"conditions\\\": [], \\\"parameters\\\": {}}\";\n+\n+  private static final String TEST_ETAG = \"etag-123456789012-1\";\n+\n+  private MockLowLevelHttpResponse response;\n+  private TestResponseInterceptor interceptor;\n+  private FirebaseRemoteConfigClient client;\n+\n+  @Before\n+  public void setUp() {\n+    response = new MockLowLevelHttpResponse();\n+    interceptor = new TestResponseInterceptor();\n+    client = initRemoteConfigClient(response, interceptor);\n+  }\n+\n+  @Test\n+  public void testGetTemplate() throws Exception {\n+    response.addHeader(\"etag\", TEST_ETAG);\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    RemoteConfigTemplate template = client.getTemplate();\n+\n+    assertEquals(TEST_ETAG, template.getETag());\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateWithInvalidEtags() {\n+    // Empty ETag\n+    response.addHeader(\"etag\", \"\");\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+\n+    // ETag does not exist", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2MDgxMA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487260810", "bodyText": "Oh good catch! Thanks!", "author": "lahirumaramba", "createdAt": "2020-09-11T19:57:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3ODM0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3OTExNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486679117", "bodyText": "Let's use a bit more descriptive names:\nTEST_REMOTE_CONFIG_URL\nHTTP_STATUS_CODES\nHTTP_STATUS_TO_ERROR_CODE", "author": "hiranya911", "createdAt": "2020-09-10T22:59:31Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY3OTc0Mg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486679742", "bodyText": "headers.getAcceptEncoding()", "author": "hiranya911", "createdAt": "2020-09-10T23:01:28Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =\n+          \"https://firebaseremoteconfig.googleapis.com/v1/projects/test-project/remoteConfig\";\n+\n+  private static final List<Integer> HTTP_ERRORS = ImmutableList.of(401, 404, 500);\n+\n+  private static final Map<Integer, ErrorCode> HTTP_2_ERROR = ImmutableMap.of(\n+          401, ErrorCode.UNAUTHENTICATED,\n+          404, ErrorCode.NOT_FOUND,\n+          500, ErrorCode.INTERNAL);\n+\n+  private static final String MOCK_TEMPLATE_RESPONSE = \"{\\\"conditions\\\": [], \\\"parameters\\\": {}}\";\n+\n+  private static final String TEST_ETAG = \"etag-123456789012-1\";\n+\n+  private MockLowLevelHttpResponse response;\n+  private TestResponseInterceptor interceptor;\n+  private FirebaseRemoteConfigClient client;\n+\n+  @Before\n+  public void setUp() {\n+    response = new MockLowLevelHttpResponse();\n+    interceptor = new TestResponseInterceptor();\n+    client = initRemoteConfigClient(response, interceptor);\n+  }\n+\n+  @Test\n+  public void testGetTemplate() throws Exception {\n+    response.addHeader(\"etag\", TEST_ETAG);\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    RemoteConfigTemplate template = client.getTemplate();\n+\n+    assertEquals(TEST_ETAG, template.getETag());\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateWithInvalidEtags() {\n+    // Empty ETag\n+    response.addHeader(\"etag\", \"\");\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+\n+    // ETag does not exist\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateHttpError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"{}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\n{}\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateTransportError() {\n+    client = initClientWithFaultyTransport();\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for HTTP error\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertEquals(\"Unknown error while making a remote service call: transport error\",\n+              error.getMessage());\n+      assertTrue(error.getCause() instanceof IOException);\n+      assertNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateSuccessResponseWithUnexpectedPayload() {\n+    response.setContent(\"not valid json\");\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for malformed response\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertTrue(error.getMessage().startsWith(\"Error while parsing HTTP response: \"));\n+      assertNotNull(error.getCause());\n+      assertNotNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithZeroContentResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setZeroContent();\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnull\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithMalformedResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"not json\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnot json\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetails() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithCanonicalCode() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"NOT_FOUND\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.NOT_FOUND);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithRcError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \"\n+                      + \"\\\"message\\\": \\\"[INVALID_ARGUMENT]: test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT,\n+                RemoteConfigErrorCode.INVALID_ARGUMENT, \"[INVALID_ARGUMENT]: test error\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetailsAndNoCode() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \"\n+                      + \"\\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test(expected = IllegalArgumentException.class)\n+  public void testBuilderNullProjectId() {\n+    fullyPopulatedBuilder().setProjectId(null).build();\n+  }\n+\n+  @Test(expected = IllegalArgumentException.class)\n+  public void testBuilderEmptyProjectId() {\n+    fullyPopulatedBuilder().setProjectId(\"\").build();\n+  }\n+\n+  @Test(expected = NullPointerException.class)\n+  public void testBuilderNullRequestFactory() {\n+    fullyPopulatedBuilder().setRequestFactory(null).build();\n+  }\n+\n+  @Test(expected = NullPointerException.class)\n+  public void testBuilderNullChildRequestFactory() {\n+    fullyPopulatedBuilder().setChildRequestFactory(null).build();\n+  }\n+\n+  @Test\n+  public void testFromApp() throws IOException {\n+    FirebaseOptions options = FirebaseOptions.builder()\n+            .setCredentials(new MockGoogleCredentials(\"test-token\"))\n+            .setProjectId(\"test-project\")\n+            .build();\n+    FirebaseApp app = FirebaseApp.initializeApp(options);\n+\n+    try {\n+      FirebaseRemoteConfigClientImpl client = FirebaseRemoteConfigClientImpl.fromApp(app);\n+\n+      assertEquals(TEST_RC_URL, client.getRcSendUrl());\n+      assertSame(options.getJsonFactory(), client.getJsonFactory());\n+\n+      HttpRequest request = client.getRequestFactory().buildGetRequest(\n+              new GenericUrl(\"https://example.com\"));\n+      assertEquals(\"Bearer test-token\", request.getHeaders().getAuthorization());\n+\n+      request = client.getChildRequestFactory().buildGetRequest(\n+              new GenericUrl(\"https://example.com\"));\n+      assertNull(request.getHeaders().getAuthorization());\n+    } finally {\n+      app.delete();\n+    }\n+  }\n+\n+  private FirebaseRemoteConfigClientImpl initRemoteConfigClient(\n+          MockLowLevelHttpResponse mockResponse, HttpResponseInterceptor interceptor) {\n+    MockHttpTransport transport = new MockHttpTransport.Builder()\n+            .setLowLevelHttpResponse(mockResponse)\n+            .build();\n+\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(\"test-project\")\n+            .setJsonFactory(Utils.getDefaultJsonFactory())\n+            .setRequestFactory(transport.createRequestFactory())\n+            .setChildRequestFactory(Utils.getDefaultTransport().createRequestFactory())\n+            .setResponseInterceptor(interceptor)\n+            .build();\n+  }\n+\n+  private FirebaseRemoteConfigClientImpl initClientWithFaultyTransport() {\n+    HttpTransport transport = TestUtils.createFaultyHttpTransport();\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(\"test-project\")\n+            .setJsonFactory(Utils.getDefaultJsonFactory())\n+            .setRequestFactory(transport.createRequestFactory())\n+            .setChildRequestFactory(Utils.getDefaultTransport().createRequestFactory())\n+            .build();\n+  }\n+\n+  private FirebaseRemoteConfigClientImpl.Builder fullyPopulatedBuilder() {\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(\"test-project\")\n+            .setJsonFactory(Utils.getDefaultJsonFactory())\n+            .setRequestFactory(Utils.getDefaultTransport().createRequestFactory())\n+            .setChildRequestFactory(Utils.getDefaultTransport().createRequestFactory());\n+  }\n+\n+  private void checkGetRequestHeader(HttpRequest request) {\n+    assertEquals(\"GET\", request.getRequestMethod());\n+    assertEquals(TEST_RC_URL, request.getUrl().toString());\n+    HttpHeaders headers = request.getHeaders();\n+    assertEquals(\"2\", headers.get(\"X-GOOG-API-FORMAT-VERSION\"));\n+    assertEquals(\"fire-admin-java/\" + SdkUtils.getVersion(), headers.get(\"X-Firebase-Client\"));\n+    assertEquals(\"gzip\", headers.getFirstHeaderStringValue(\"Accept-Encoding\"));", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDA0MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486680040", "bodyText": "Also test for error message.", "author": "hiranya911", "createdAt": "2020-09-10T23:02:28Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =\n+          \"https://firebaseremoteconfig.googleapis.com/v1/projects/test-project/remoteConfig\";\n+\n+  private static final List<Integer> HTTP_ERRORS = ImmutableList.of(401, 404, 500);\n+\n+  private static final Map<Integer, ErrorCode> HTTP_2_ERROR = ImmutableMap.of(\n+          401, ErrorCode.UNAUTHENTICATED,\n+          404, ErrorCode.NOT_FOUND,\n+          500, ErrorCode.INTERNAL);\n+\n+  private static final String MOCK_TEMPLATE_RESPONSE = \"{\\\"conditions\\\": [], \\\"parameters\\\": {}}\";\n+\n+  private static final String TEST_ETAG = \"etag-123456789012-1\";\n+\n+  private MockLowLevelHttpResponse response;\n+  private TestResponseInterceptor interceptor;\n+  private FirebaseRemoteConfigClient client;\n+\n+  @Before\n+  public void setUp() {\n+    response = new MockLowLevelHttpResponse();\n+    interceptor = new TestResponseInterceptor();\n+    client = initRemoteConfigClient(response, interceptor);\n+  }\n+\n+  @Test\n+  public void testGetTemplate() throws Exception {\n+    response.addHeader(\"etag\", TEST_ETAG);\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    RemoteConfigTemplate template = client.getTemplate();\n+\n+    assertEquals(TEST_ETAG, template.getETag());\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateWithInvalidEtags() {\n+    // Empty ETag\n+    response.addHeader(\"etag\", \"\");\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+\n+    // ETag does not exist\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateHttpError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"{}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\n{}\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateTransportError() {\n+    client = initClientWithFaultyTransport();\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for HTTP error\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertEquals(\"Unknown error while making a remote service call: transport error\",\n+              error.getMessage());\n+      assertTrue(error.getCause() instanceof IOException);\n+      assertNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateSuccessResponseWithUnexpectedPayload() {\n+    response.setContent(\"not valid json\");\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for malformed response\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertTrue(error.getMessage().startsWith(\"Error while parsing HTTP response: \"));\n+      assertNotNull(error.getCause());\n+      assertNotNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithZeroContentResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setZeroContent();\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnull\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithMalformedResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"not json\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnot json\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetails() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT);", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1NjU2Mg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487256562", "bodyText": "As we call an overloaded checkExceptionFromHttpResponse version here, it checks for the default error message, test error.", "author": "lahirumaramba", "createdAt": "2020-09-11T19:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDA0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2MTE5OA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487261198", "bodyText": "Actually, I will remove the overloaded method. Doesn't look like we need it anymore :)", "author": "lahirumaramba", "createdAt": "2020-09-11T19:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDA0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDMyMg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486680322", "bodyText": ".equals(TEST_RC_URL)?", "author": "hiranya911", "createdAt": "2020-09-10T23:03:21Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =\n+          \"https://firebaseremoteconfig.googleapis.com/v1/projects/test-project/remoteConfig\";\n+\n+  private static final List<Integer> HTTP_ERRORS = ImmutableList.of(401, 404, 500);\n+\n+  private static final Map<Integer, ErrorCode> HTTP_2_ERROR = ImmutableMap.of(\n+          401, ErrorCode.UNAUTHENTICATED,\n+          404, ErrorCode.NOT_FOUND,\n+          500, ErrorCode.INTERNAL);\n+\n+  private static final String MOCK_TEMPLATE_RESPONSE = \"{\\\"conditions\\\": [], \\\"parameters\\\": {}}\";\n+\n+  private static final String TEST_ETAG = \"etag-123456789012-1\";\n+\n+  private MockLowLevelHttpResponse response;\n+  private TestResponseInterceptor interceptor;\n+  private FirebaseRemoteConfigClient client;\n+\n+  @Before\n+  public void setUp() {\n+    response = new MockLowLevelHttpResponse();\n+    interceptor = new TestResponseInterceptor();\n+    client = initRemoteConfigClient(response, interceptor);\n+  }\n+\n+  @Test\n+  public void testGetTemplate() throws Exception {\n+    response.addHeader(\"etag\", TEST_ETAG);\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    RemoteConfigTemplate template = client.getTemplate();\n+\n+    assertEquals(TEST_ETAG, template.getETag());\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateWithInvalidEtags() {\n+    // Empty ETag\n+    response.addHeader(\"etag\", \"\");\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+\n+    // ETag does not exist\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateHttpError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"{}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\n{}\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateTransportError() {\n+    client = initClientWithFaultyTransport();\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for HTTP error\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertEquals(\"Unknown error while making a remote service call: transport error\",\n+              error.getMessage());\n+      assertTrue(error.getCause() instanceof IOException);\n+      assertNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateSuccessResponseWithUnexpectedPayload() {\n+    response.setContent(\"not valid json\");\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for malformed response\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertTrue(error.getMessage().startsWith(\"Error while parsing HTTP response: \"));\n+      assertNotNull(error.getCause());\n+      assertNotNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithZeroContentResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setZeroContent();\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnull\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithMalformedResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"not json\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnot json\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetails() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithCanonicalCode() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"NOT_FOUND\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.NOT_FOUND);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithRcError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \"\n+                      + \"\\\"message\\\": \\\"[INVALID_ARGUMENT]: test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT,\n+                RemoteConfigErrorCode.INVALID_ARGUMENT, \"[INVALID_ARGUMENT]: test error\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetailsAndNoCode() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \"\n+                      + \"\\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test(expected = IllegalArgumentException.class)\n+  public void testBuilderNullProjectId() {\n+    fullyPopulatedBuilder().setProjectId(null).build();\n+  }\n+\n+  @Test(expected = IllegalArgumentException.class)\n+  public void testBuilderEmptyProjectId() {\n+    fullyPopulatedBuilder().setProjectId(\"\").build();\n+  }\n+\n+  @Test(expected = NullPointerException.class)\n+  public void testBuilderNullRequestFactory() {\n+    fullyPopulatedBuilder().setRequestFactory(null).build();\n+  }\n+\n+  @Test(expected = NullPointerException.class)\n+  public void testBuilderNullChildRequestFactory() {\n+    fullyPopulatedBuilder().setChildRequestFactory(null).build();\n+  }\n+\n+  @Test\n+  public void testFromApp() throws IOException {\n+    FirebaseOptions options = FirebaseOptions.builder()\n+            .setCredentials(new MockGoogleCredentials(\"test-token\"))\n+            .setProjectId(\"test-project\")\n+            .build();\n+    FirebaseApp app = FirebaseApp.initializeApp(options);\n+\n+    try {\n+      FirebaseRemoteConfigClientImpl client = FirebaseRemoteConfigClientImpl.fromApp(app);\n+\n+      assertEquals(TEST_RC_URL, client.getRcSendUrl());\n+      assertSame(options.getJsonFactory(), client.getJsonFactory());\n+\n+      HttpRequest request = client.getRequestFactory().buildGetRequest(\n+              new GenericUrl(\"https://example.com\"));\n+      assertEquals(\"Bearer test-token\", request.getHeaders().getAuthorization());\n+\n+      request = client.getChildRequestFactory().buildGetRequest(\n+              new GenericUrl(\"https://example.com\"));\n+      assertNull(request.getHeaders().getAuthorization());\n+    } finally {\n+      app.delete();\n+    }\n+  }\n+\n+  private FirebaseRemoteConfigClientImpl initRemoteConfigClient(\n+          MockLowLevelHttpResponse mockResponse, HttpResponseInterceptor interceptor) {\n+    MockHttpTransport transport = new MockHttpTransport.Builder()\n+            .setLowLevelHttpResponse(mockResponse)\n+            .build();\n+\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(\"test-project\")\n+            .setJsonFactory(Utils.getDefaultJsonFactory())\n+            .setRequestFactory(transport.createRequestFactory())\n+            .setChildRequestFactory(Utils.getDefaultTransport().createRequestFactory())\n+            .setResponseInterceptor(interceptor)\n+            .build();\n+  }\n+\n+  private FirebaseRemoteConfigClientImpl initClientWithFaultyTransport() {\n+    HttpTransport transport = TestUtils.createFaultyHttpTransport();\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(\"test-project\")\n+            .setJsonFactory(Utils.getDefaultJsonFactory())\n+            .setRequestFactory(transport.createRequestFactory())\n+            .setChildRequestFactory(Utils.getDefaultTransport().createRequestFactory())\n+            .build();\n+  }\n+\n+  private FirebaseRemoteConfigClientImpl.Builder fullyPopulatedBuilder() {\n+    return FirebaseRemoteConfigClientImpl.builder()\n+            .setProjectId(\"test-project\")\n+            .setJsonFactory(Utils.getDefaultJsonFactory())\n+            .setRequestFactory(Utils.getDefaultTransport().createRequestFactory())\n+            .setChildRequestFactory(Utils.getDefaultTransport().createRequestFactory());\n+  }\n+\n+  private void checkGetRequestHeader(HttpRequest request) {\n+    assertEquals(\"GET\", request.getRequestMethod());\n+    assertEquals(TEST_RC_URL, request.getUrl().toString());\n+    HttpHeaders headers = request.getHeaders();\n+    assertEquals(\"2\", headers.get(\"X-GOOG-API-FORMAT-VERSION\"));\n+    assertEquals(\"fire-admin-java/\" + SdkUtils.getVersion(), headers.get(\"X-Firebase-Client\"));\n+    assertEquals(\"gzip\", headers.getFirstHeaderStringValue(\"Accept-Encoding\"));\n+  }\n+\n+  private void checkExceptionFromHttpResponse(\n+          FirebaseRemoteConfigException error,\n+          ErrorCode expectedCode) {\n+    checkExceptionFromHttpResponse(error, expectedCode, null, \"test error\");\n+  }\n+\n+  private void checkExceptionFromHttpResponse(\n+          FirebaseRemoteConfigException error,\n+          ErrorCode expectedCode,\n+          RemoteConfigErrorCode expectedRemoteConfigCode,\n+          String expectedMessage) {\n+    assertEquals(expectedCode, error.getErrorCode());\n+    assertEquals(expectedMessage, error.getMessage());\n+    assertTrue(error.getCause() instanceof HttpResponseException);\n+    assertEquals(expectedRemoteConfigCode, error.getRemoteConfigErrorCode());\n+\n+    assertNotNull(error.getHttpResponse());\n+    OutgoingHttpRequest request = error.getHttpResponse().getRequest();\n+    assertEquals(HttpMethods.GET, request.getMethod());\n+    assertTrue(request.getUrl().startsWith(\"https://firebaseremoteconfig.googleapis.com\"));", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI2MzY5Mg==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487263692", "bodyText": "The goal is to reuse this function for other operations :)\nWe will have different complete URLS for them. I need to figure out the best way to group repeating tests...", "author": "lahirumaramba", "createdAt": "2020-09-11T20:03:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDMyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDk4Nw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r486680987", "bodyText": "Duplicate of testGetTemplateErrorWithDetails", "author": "hiranya911", "createdAt": "2020-09-10T23:05:22Z", "path": "src/test/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImplTest.java", "diffHunk": "@@ -0,0 +1,377 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.firebase.remoteconfig;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertSame;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.client.http.GenericUrl;\n+import com.google.api.client.http.HttpHeaders;\n+import com.google.api.client.http.HttpMethods;\n+import com.google.api.client.http.HttpRequest;\n+import com.google.api.client.http.HttpResponseException;\n+import com.google.api.client.http.HttpResponseInterceptor;\n+import com.google.api.client.http.HttpTransport;\n+import com.google.api.client.testing.http.MockHttpTransport;\n+import com.google.api.client.testing.http.MockLowLevelHttpResponse;\n+import com.google.common.collect.ImmutableList;\n+import com.google.common.collect.ImmutableMap;\n+import com.google.firebase.ErrorCode;\n+import com.google.firebase.FirebaseApp;\n+import com.google.firebase.FirebaseOptions;\n+import com.google.firebase.OutgoingHttpRequest;\n+import com.google.firebase.auth.MockGoogleCredentials;\n+import com.google.firebase.internal.SdkUtils;\n+import com.google.firebase.testing.TestResponseInterceptor;\n+import com.google.firebase.testing.TestUtils;\n+\n+import java.io.IOException;\n+import java.util.List;\n+import java.util.Map;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+public class FirebaseRemoteConfigClientImplTest {\n+\n+  private static final String TEST_RC_URL =\n+          \"https://firebaseremoteconfig.googleapis.com/v1/projects/test-project/remoteConfig\";\n+\n+  private static final List<Integer> HTTP_ERRORS = ImmutableList.of(401, 404, 500);\n+\n+  private static final Map<Integer, ErrorCode> HTTP_2_ERROR = ImmutableMap.of(\n+          401, ErrorCode.UNAUTHENTICATED,\n+          404, ErrorCode.NOT_FOUND,\n+          500, ErrorCode.INTERNAL);\n+\n+  private static final String MOCK_TEMPLATE_RESPONSE = \"{\\\"conditions\\\": [], \\\"parameters\\\": {}}\";\n+\n+  private static final String TEST_ETAG = \"etag-123456789012-1\";\n+\n+  private MockLowLevelHttpResponse response;\n+  private TestResponseInterceptor interceptor;\n+  private FirebaseRemoteConfigClient client;\n+\n+  @Before\n+  public void setUp() {\n+    response = new MockLowLevelHttpResponse();\n+    interceptor = new TestResponseInterceptor();\n+    client = initRemoteConfigClient(response, interceptor);\n+  }\n+\n+  @Test\n+  public void testGetTemplate() throws Exception {\n+    response.addHeader(\"etag\", TEST_ETAG);\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    RemoteConfigTemplate template = client.getTemplate();\n+\n+    assertEquals(TEST_ETAG, template.getETag());\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateWithInvalidEtags() {\n+    // Empty ETag\n+    response.addHeader(\"etag\", \"\");\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+\n+    // ETag does not exist\n+    response.setContent(MOCK_TEMPLATE_RESPONSE);\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for invalid ETag\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.INTERNAL, error.getErrorCode());\n+      assertEquals(\"ETag header is not available in the server response.\", error.getMessage());\n+      assertEquals(RemoteConfigErrorCode.INTERNAL, error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateHttpError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"{}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\n{}\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateTransportError() {\n+    client = initClientWithFaultyTransport();\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for HTTP error\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertEquals(\"Unknown error while making a remote service call: transport error\",\n+              error.getMessage());\n+      assertTrue(error.getCause() instanceof IOException);\n+      assertNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateSuccessResponseWithUnexpectedPayload() {\n+    response.setContent(\"not valid json\");\n+\n+    try {\n+      client.getTemplate();\n+      fail(\"No error thrown for malformed response\");\n+    } catch (FirebaseRemoteConfigException error) {\n+      assertEquals(ErrorCode.UNKNOWN, error.getErrorCode());\n+      assertTrue(error.getMessage().startsWith(\"Error while parsing HTTP response: \"));\n+      assertNotNull(error.getCause());\n+      assertNotNull(error.getHttpResponse());\n+      assertNull(error.getRemoteConfigErrorCode());\n+    }\n+    checkGetRequestHeader(interceptor.getLastRequest());\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithZeroContentResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setZeroContent();\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnull\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithMalformedResponse() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\"not json\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, HTTP_2_ERROR.get(code), null,\n+                \"Unexpected HTTP response with status: \" + code + \"\\nnot json\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetails() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithCanonicalCode() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"NOT_FOUND\\\", \\\"message\\\": \\\"test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.NOT_FOUND);\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithRcError() {\n+    for (int code : HTTP_ERRORS) {\n+      response.setStatusCode(code).setContent(\n+              \"{\\\"error\\\": {\\\"status\\\": \\\"INVALID_ARGUMENT\\\", \"\n+                      + \"\\\"message\\\": \\\"[INVALID_ARGUMENT]: test error\\\"}}\");\n+\n+      try {\n+        client.getTemplate();\n+        fail(\"No error thrown for HTTP error\");\n+      } catch (FirebaseRemoteConfigException error) {\n+        checkExceptionFromHttpResponse(error, ErrorCode.INVALID_ARGUMENT,\n+                RemoteConfigErrorCode.INVALID_ARGUMENT, \"[INVALID_ARGUMENT]: test error\");\n+      }\n+      checkGetRequestHeader(interceptor.getLastRequest());\n+    }\n+  }\n+\n+  @Test\n+  public void testGetTemplateErrorWithDetailsAndNoCode() {", "originalCommit": "07ec3047f51bbefef8560133a4ad0d0c614b9647", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI1ODI0MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487258240", "bodyText": "Good catch! removed both testGetTemplateErrorWithCanonicalCode and testGetTemplateErrorWithDetailsAndNoCode", "author": "lahirumaramba", "createdAt": "2020-09-11T19:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY4MDk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5MjI1MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487292250", "bodyText": "Perhaps checkState is more appropriate here.", "author": "hiranya911", "createdAt": "2020-09-11T21:10:14Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -75,49 +75,34 @@ private FirebaseRemoteConfigClientImpl(Builder builder) {\n   }\n \n   @VisibleForTesting\n-  String getRcSendUrl() {\n-    return rcSendUrl;\n+  String getRemoteConfigUrl() {\n+    return remoteConfigUrl;\n   }\n \n   @VisibleForTesting\n   HttpRequestFactory getRequestFactory() {\n     return requestFactory;\n   }\n \n-  @VisibleForTesting\n-  HttpRequestFactory getChildRequestFactory() {\n-    return childRequestFactory;\n-  }\n-\n   @VisibleForTesting\n   JsonFactory getJsonFactory() {\n     return jsonFactory;\n   }\n \n   @Override\n   public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n-    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(remoteConfigUrl)\n             .addAllHeaders(COMMON_HEADERS);\n     IncomingHttpResponse response = httpClient.send(request);\n     RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n \n     List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n-\n-    if (etagList == null || etagList.isEmpty()) {\n-      throw new FirebaseRemoteConfigException(\n-              ErrorCode.INTERNAL,\n-              \"ETag header is not available in the server response.\", null, null,\n-              RemoteConfigErrorCode.INTERNAL);\n-    }\n+    checkArgument(!(etagList == null || etagList.isEmpty()),", "originalCommit": "02301efd1f438041d6c2333be60d6cad956faf3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5MjUzNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487292537", "bodyText": "Also checkState(etagList != null && !etagList.isEmpty())", "author": "hiranya911", "createdAt": "2020-09-11T21:10:59Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -75,49 +75,34 @@ private FirebaseRemoteConfigClientImpl(Builder builder) {\n   }\n \n   @VisibleForTesting\n-  String getRcSendUrl() {\n-    return rcSendUrl;\n+  String getRemoteConfigUrl() {\n+    return remoteConfigUrl;\n   }\n \n   @VisibleForTesting\n   HttpRequestFactory getRequestFactory() {\n     return requestFactory;\n   }\n \n-  @VisibleForTesting\n-  HttpRequestFactory getChildRequestFactory() {\n-    return childRequestFactory;\n-  }\n-\n   @VisibleForTesting\n   JsonFactory getJsonFactory() {\n     return jsonFactory;\n   }\n \n   @Override\n   public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n-    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(remoteConfigUrl)\n             .addAllHeaders(COMMON_HEADERS);\n     IncomingHttpResponse response = httpClient.send(request);\n     RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n \n     List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n-\n-    if (etagList == null || etagList.isEmpty()) {\n-      throw new FirebaseRemoteConfigException(\n-              ErrorCode.INTERNAL,\n-              \"ETag header is not available in the server response.\", null, null,\n-              RemoteConfigErrorCode.INTERNAL);\n-    }\n+    checkArgument(!(etagList == null || etagList.isEmpty()),", "originalCommit": "02301efd1f438041d6c2333be60d6cad956faf3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzI5MzAxNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r487293017", "bodyText": "Here too. I'd even recommend adding a getETag(IncomingResponse resp) helper method, and doing all the validation there.", "author": "hiranya911", "createdAt": "2020-09-11T21:12:08Z", "path": "src/main/java/com/google/firebase/remoteconfig/FirebaseRemoteConfigClientImpl.java", "diffHunk": "@@ -75,49 +75,34 @@ private FirebaseRemoteConfigClientImpl(Builder builder) {\n   }\n \n   @VisibleForTesting\n-  String getRcSendUrl() {\n-    return rcSendUrl;\n+  String getRemoteConfigUrl() {\n+    return remoteConfigUrl;\n   }\n \n   @VisibleForTesting\n   HttpRequestFactory getRequestFactory() {\n     return requestFactory;\n   }\n \n-  @VisibleForTesting\n-  HttpRequestFactory getChildRequestFactory() {\n-    return childRequestFactory;\n-  }\n-\n   @VisibleForTesting\n   JsonFactory getJsonFactory() {\n     return jsonFactory;\n   }\n \n   @Override\n   public RemoteConfigTemplate getTemplate() throws FirebaseRemoteConfigException {\n-    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(rcSendUrl)\n+    HttpRequestInfo request = HttpRequestInfo.buildGetRequest(remoteConfigUrl)\n             .addAllHeaders(COMMON_HEADERS);\n     IncomingHttpResponse response = httpClient.send(request);\n     RemoteConfigTemplate parsed = httpClient.parse(response, RemoteConfigTemplate.class);\n \n     List<String> etagList = (List<String>) response.getHeaders().get(\"etag\");\n-\n-    if (etagList == null || etagList.isEmpty()) {\n-      throw new FirebaseRemoteConfigException(\n-              ErrorCode.INTERNAL,\n-              \"ETag header is not available in the server response.\", null, null,\n-              RemoteConfigErrorCode.INTERNAL);\n-    }\n+    checkArgument(!(etagList == null || etagList.isEmpty()),\n+            \"ETag header is not available in the server response.\");\n \n     String etag = etagList.get(0);\n-\n-    if (Strings.isNullOrEmpty(etag)) {\n-      throw new FirebaseRemoteConfigException(\n-              ErrorCode.INTERNAL,\n-              \"ETag header is not available in the server response.\", null, null,\n-              RemoteConfigErrorCode.INTERNAL);\n-    }\n+    checkArgument(!Strings.isNullOrEmpty(etag),", "originalCommit": "02301efd1f438041d6c2333be60d6cad956faf3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "426fe785cdd626bf9edfef425d8984231b6ae5d7", "url": "https://github.com/firebase/firebase-admin-java/commit/426fe785cdd626bf9edfef425d8984231b6ae5d7", "message": "Improve error handling", "committedDate": "2020-09-14T18:14:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMwMTIzOA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r488301238", "bodyText": "Pattern.compile() could be expensive. Pre-compute it and store as a static constant.", "author": "hiranya911", "createdAt": "2020-09-14T23:55:34Z", "path": "src/main/java/com/google/firebase/remoteconfig/internal/RemoteConfigServiceErrorResponse.java", "diffHunk": "@@ -60,9 +54,9 @@ public RemoteConfigErrorCode getRemoteConfigErrorCode() {\n       return null;\n     }\n \n-    int separator = message.indexOf(':');\n-    if (separator != -1) {\n-      String errorCode = message.substring(0, separator).replaceAll(\"\\\\[|\\\\]\", \"\");\n+    Matcher errorMatcher = Pattern.compile(\"^\\\\[(\\\\w+)\\\\]:.*$\").matcher(message);", "originalCommit": "426fe785cdd626bf9edfef425d8984231b6ae5d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODc2MjQ0MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/477#discussion_r488762440", "bodyText": "Good point! Thanks!", "author": "lahirumaramba", "createdAt": "2020-09-15T15:31:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMwMTIzOA=="}], "type": "inlineReview"}, {"oid": "c13d8893534ef723158a9bb9a8ea50257f4c2e7d", "url": "https://github.com/firebase/firebase-admin-java/commit/c13d8893534ef723158a9bb9a8ea50257f4c2e7d", "message": "Add initial classes for Remote Config API\nAdd unit tests", "committedDate": "2020-09-15T17:35:45Z", "type": "commit"}, {"oid": "71151f80cadab869f73de197a8a4ee35278f1c1e", "url": "https://github.com/firebase/firebase-admin-java/commit/71151f80cadab869f73de197a8a4ee35278f1c1e", "message": "PR fixes", "committedDate": "2020-09-15T17:36:11Z", "type": "commit"}, {"oid": "e6152cca2a89f8d2753d1a83978fa1cb7f0cac20", "url": "https://github.com/firebase/firebase-admin-java/commit/e6152cca2a89f8d2753d1a83978fa1cb7f0cac20", "message": "Improve error handling", "committedDate": "2020-09-15T17:36:16Z", "type": "commit"}, {"oid": "52319e96ef6b105e47a62ea2df22bb313b5fa8f1", "url": "https://github.com/firebase/firebase-admin-java/commit/52319e96ef6b105e47a62ea2df22bb313b5fa8f1", "message": "Pre compute error matching pattern", "committedDate": "2020-09-15T17:36:23Z", "type": "commit"}, {"oid": "52319e96ef6b105e47a62ea2df22bb313b5fa8f1", "url": "https://github.com/firebase/firebase-admin-java/commit/52319e96ef6b105e47a62ea2df22bb313b5fa8f1", "message": "Pre compute error matching pattern", "committedDate": "2020-09-15T17:36:23Z", "type": "forcePushed"}]}