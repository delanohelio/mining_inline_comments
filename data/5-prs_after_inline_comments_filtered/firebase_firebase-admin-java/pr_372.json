{"pr_number": 372, "pr_title": "Add deleteTenant operation to TenantManager.", "pr_createdAt": "2020-02-20T21:37:55Z", "pr_url": "https://github.com/firebase/firebase-admin-java/pull/372", "timeline": [{"oid": "a75bfbca9bc710562cfe7a89072e444d80ae244b", "url": "https://github.com/firebase/firebase-admin-java/commit/a75bfbca9bc710562cfe7a89072e444d80ae244b", "message": "Add deleteTenant operation to TenantManager.", "committedDate": "2020-02-20T21:35:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNDEzMg==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r382314132", "bodyText": "Should use DELETE /tenants/{tenantId} URL format here.", "author": "hiranya911", "createdAt": "2020-02-20T23:21:29Z", "path": "src/main/java/com/google/firebase/auth/FirebaseUserManager.java", "diffHunk": "@@ -226,6 +226,15 @@ UserImportResult importUsers(UserImportRequest request) throws FirebaseAuthExcep\n     return new UserImportResult(request.getUsersCount(), response);\n   }\n \n+  void deleteTenant(String tenantId) throws FirebaseAuthException {\n+    GenericUrl url = new GenericUrl(tenantMgtBaseUrl + \"/tenants:delete\");\n+    url.put(\"name\", tenantId);", "originalCommit": "a75bfbca9bc710562cfe7a89072e444d80ae244b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0NDY4MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385244680", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-27T17:03:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNDEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNDQwOA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r382314408", "bodyText": "Let's also assert the URL of the outgoing request and make sure TENANT_1 is being included in the request.", "author": "hiranya911", "createdAt": "2020-02-20T23:22:18Z", "path": "src/test/java/com/google/firebase/auth/FirebaseUserManagerTest.java", "diffHunk": "@@ -476,6 +476,14 @@ public void testListZeroTenants() throws Exception {\n     checkRequestHeaders(interceptor);\n   }\n \n+  @Test\n+  public void testDeleteTenant() throws Exception {\n+    TestResponseInterceptor interceptor = initializeAppForUserManagement(\"{}\");\n+    // should not throw\n+    FirebaseAuth.getInstance().getTenantManager().deleteTenantAsync(\"TENANT_1\").get();\n+    checkRequestHeaders(interceptor);", "originalCommit": "a75bfbca9bc710562cfe7a89072e444d80ae244b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI0NDgzNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385244837", "bodyText": "Done. How do I assert that that it was a DELETE request?", "author": "micahstairs", "createdAt": "2020-02-27T17:04:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNDQwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNTU5OA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385315598", "bodyText": "Something like the following should work:\ninterceptor.getResponse().getRequest().getMethod()", "author": "hiranya911", "createdAt": "2020-02-27T19:13:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNDQwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQwMDE1MA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385400150", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-27T22:08:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjMxNDQwOA=="}], "type": "inlineReview"}, {"oid": "c03dd3627955d6d8316ea5ceca17902da7b899a1", "url": "https://github.com/firebase/firebase-admin-java/commit/c03dd3627955d6d8316ea5ceca17902da7b899a1", "message": "Address pull request feedback", "committedDate": "2020-02-27T17:03:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNTEyNw==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385315127", "bodyText": "Why was the annotation removed?", "author": "hiranya911", "createdAt": "2020-02-27T19:12:08Z", "path": "src/main/java/com/google/firebase/auth/FirebaseUserManager.java", "diffHunk": "@@ -287,7 +295,7 @@ String getEmailActionLink(EmailLinkType type, String email,\n \n   private <T> T sendRequest(\n           String method, GenericUrl url,\n-          @Nullable Object content, Class<T> clazz) throws FirebaseAuthException {\n+          Object content, Class<T> clazz) throws FirebaseAuthException {", "originalCommit": "c03dd3627955d6d8316ea5ceca17902da7b899a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzMjc5NA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385332794", "bodyText": "I removed this because of the following line:\ncheckNotNull(clazz, \"response class must not be null\");", "author": "micahstairs", "createdAt": "2020-02-27T19:45:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNTEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzOTg3OQ==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385339879", "bodyText": "The annotation was on Object content, which is nullable?", "author": "hiranya911", "createdAt": "2020-02-27T19:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNTEyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM5NDc2Nw==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385394767", "bodyText": "Ah sorry, I was looking at the wrong variable. This will be fixed when I push my other changes.", "author": "micahstairs", "createdAt": "2020-02-27T21:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNTEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNjI2Ng==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385316266", "bodyText": "Make sure the TENANT_NOT_FOUND is handled correctly (similar to getTenant)", "author": "hiranya911", "createdAt": "2020-02-27T19:14:24Z", "path": "src/test/java/com/google/firebase/auth/FirebaseUserManagerTest.java", "diffHunk": "@@ -476,6 +476,16 @@ public void testListZeroTenants() throws Exception {\n     checkRequestHeaders(interceptor);\n   }\n \n+  @Test\n+  public void testDeleteTenant() throws Exception {", "originalCommit": "c03dd3627955d6d8316ea5ceca17902da7b899a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQwMDIyOA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385400228", "bodyText": "Done.", "author": "micahstairs", "createdAt": "2020-02-27T22:08:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMxNjI2Ng=="}], "type": "inlineReview"}, {"oid": "c042c0fc0391c5a2f490ae7b28fe4cb41dbe3e95", "url": "https://github.com/firebase/firebase-admin-java/commit/c042c0fc0391c5a2f490ae7b28fe4cb41dbe3e95", "message": "Work on testing error handling of deleteTenant.", "committedDate": "2020-02-27T20:53:32Z", "type": "commit"}, {"oid": "aa2467b0a0ea84906d059d7df5b219f79292d82c", "url": "https://github.com/firebase/firebase-admin-java/commit/aa2467b0a0ea84906d059d7df5b219f79292d82c", "message": "Fix error handling test for deleteTenant and do some refactoring.", "committedDate": "2020-02-27T22:08:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTQwODA4NA==", "url": "https://github.com/firebase/firebase-admin-java/pull/372#discussion_r385408084", "bodyText": "Nit: Introduce local variable for HttpRequest.", "author": "hiranya911", "createdAt": "2020-02-27T22:27:20Z", "path": "src/test/java/com/google/firebase/auth/FirebaseUserManagerTest.java", "diffHunk": "@@ -1326,6 +1343,11 @@ private static void checkRequestHeaders(TestResponseInterceptor interceptor) {\n     assertEquals(clientVersion, headers.getFirstHeaderStringValue(\"X-Client-Version\"));\n   }\n \n+  private static void checkUrl(TestResponseInterceptor interceptor, String method, String url) {\n+    assertEquals(method, interceptor.getResponse().getRequest().getRequestMethod());", "originalCommit": "aa2467b0a0ea84906d059d7df5b219f79292d82c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d22031fe61042d7b37e3022b426b4f834f752fb5", "url": "https://github.com/firebase/firebase-admin-java/commit/d22031fe61042d7b37e3022b426b4f834f752fb5", "message": "Introduce local variable for HttpRequest", "committedDate": "2020-02-27T23:05:46Z", "type": "commit"}]}