{"pr_number": 1700, "pr_title": "Issue #1695: implement jdbc layer test spring configuration", "pr_createdAt": "2020-12-29T10:46:26Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1700", "timeline": [{"oid": "14642ced1eeb283b9f0573981e1d2b64af5e90ca", "url": "https://github.com/epam/cloud-pipeline/commit/14642ced1eeb283b9f0573981e1d2b64af5e90ca", "message": "Issue #1695: implement jdbc layer test spring configuration\n\nSigned-off-by: Iurii_Kofanov <youkofan@gmail.com>", "committedDate": "2020-12-29T10:45:38Z", "type": "commit"}, {"oid": "bbbdc2cfa5835ed41743df30cea9ae824b51d040", "url": "https://github.com/epam/cloud-pipeline/commit/bbbdc2cfa5835ed41743df30cea9ae824b51d040", "message": "Issue #1695: license added", "committedDate": "2021-01-11T15:15:26Z", "type": "commit"}, {"oid": "d7c71d842cbe1eda60808e73ab084f49cbb7265c", "url": "https://github.com/epam/cloud-pipeline/commit/d7c71d842cbe1eda60808e73ab084f49cbb7265c", "message": "Issue #1695: implement jdbc layer test spring configuration", "committedDate": "2021-01-13T13:46:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODE4OTA5OA==", "url": "https://github.com/epam/cloud-pipeline/pull/1700#discussion_r558189098", "bodyText": "Looks like this wiring is useless since we have CommonTestContext configuration.", "author": "ekazachkova", "createdAt": "2021-01-15T10:12:57Z", "path": "api/src/test/java/com/epam/pipeline/test/jdbc/JdbcTestBeans.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2017-2021 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.test.jdbc;\n+\n+import com.epam.pipeline.common.MessageHelper;\n+import com.epam.pipeline.dao.DaoHelper;\n+import com.epam.pipeline.dao.notification.MonitoringNotificationDao;\n+import com.epam.pipeline.dao.pipeline.PipelineDao;\n+import com.epam.pipeline.manager.EntityManager;\n+import com.epam.pipeline.manager.configuration.RunConfigurationManager;\n+import com.epam.pipeline.manager.git.GitManager;\n+import com.epam.pipeline.manager.issue.AttachmentFileManager;\n+import com.epam.pipeline.manager.issue.IssueManager;\n+import com.epam.pipeline.manager.metadata.MetadataManager;\n+import com.epam.pipeline.manager.notification.NotificationManager;\n+import com.epam.pipeline.manager.pipeline.FolderManager;\n+import com.epam.pipeline.manager.pipeline.PipelineCRUDManager;\n+import com.epam.pipeline.manager.pipeline.PipelineManager;\n+import com.epam.pipeline.manager.pipeline.PipelineRunManager;\n+import com.epam.pipeline.manager.pipeline.RestartRunManager;\n+import com.epam.pipeline.manager.pipeline.RunScheduleManager;\n+import com.epam.pipeline.manager.pipeline.RunStatusManager;\n+import com.epam.pipeline.manager.pipeline.ToolManager;\n+import com.epam.pipeline.manager.pipeline.runner.ConfigurationProviderManager;\n+import com.epam.pipeline.manager.scheduling.RunScheduler;\n+import com.epam.pipeline.manager.scheduling.ScheduleProviderManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.mapper.AbstractRunConfigurationMapper;\n+import com.epam.pipeline.mapper.IssueMapper;\n+import com.epam.pipeline.security.jwt.JwtTokenGenerator;\n+import org.mapstruct.factory.Mappers;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.boot.test.mock.mockito.SpyBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import static org.mockito.Mockito.spy;\n+\n+@Configuration\n+public class JdbcTestBeans {\n+\n+    @Autowired\n+    protected MessageHelper messageHelper;", "originalCommit": "d7c71d842cbe1eda60808e73ab084f49cbb7265c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1ODIyMDA3NA==", "url": "https://github.com/epam/cloud-pipeline/pull/1700#discussion_r558220074", "bodyText": "Could you please remove changes from non-test configuration?", "author": "ekazachkova", "createdAt": "2021-01-15T10:37:10Z", "path": "api/src/main/java/com/epam/pipeline/app/DBConfiguration.java", "diffHunk": "@@ -1,5 +1,5 @@\n /*\n- * Copyright 2017-2019 EPAM Systems, Inc. (https://www.epam.com/)\n+ * Copyright 2017-2021 EPAM Systems, Inc. (https://www.epam.com/)", "originalCommit": "d7c71d842cbe1eda60808e73ab084f49cbb7265c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2080d18f0fea2032d7f93ffbc7e963db5cd8b38d", "url": "https://github.com/epam/cloud-pipeline/commit/2080d18f0fea2032d7f93ffbc7e963db5cd8b38d", "message": "Issue #1695: refactoring of jdbc layer test spring configuration", "committedDate": "2021-01-18T07:19:14Z", "type": "commit"}, {"oid": "e298224f80993053b3e053ee382eb1e5078391d9", "url": "https://github.com/epam/cloud-pipeline/commit/e298224f80993053b3e053ee382eb1e5078391d9", "message": "Issue #1695: removed redundant cache dependencies, changed assertion in the PreferenceDaoTest", "committedDate": "2021-01-18T14:44:23Z", "type": "commit"}, {"oid": "b55fa5d8a608ca4076db162c324eda232f05fc41", "url": "https://github.com/epam/cloud-pipeline/commit/b55fa5d8a608ca4076db162c324eda232f05fc41", "message": "Issue #1695: refactoring in the JDBC configuration", "committedDate": "2021-01-19T10:50:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI1MDIwNw==", "url": "https://github.com/epam/cloud-pipeline/pull/1700#discussion_r560250207", "bodyText": "It seems that we don't need to mock dao components (PipelineDao, DaoHelper, MonitoringNotificationDao) here since we already have:\n@ComponentScan(basePackages = {\"com.epam.pipeline.dao\"})\n\nCould you please check it?", "author": "ekazachkova", "createdAt": "2021-01-19T15:12:44Z", "path": "api/src/test/java/com/epam/pipeline/test/jdbc/JdbcTestBeans.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright 2017-2021 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.test.jdbc;\n+\n+import com.epam.pipeline.dao.DaoHelper;\n+import com.epam.pipeline.dao.notification.MonitoringNotificationDao;\n+import com.epam.pipeline.dao.pipeline.PipelineDao;\n+import com.epam.pipeline.manager.EntityManager;\n+import com.epam.pipeline.manager.configuration.RunConfigurationManager;\n+import com.epam.pipeline.manager.git.GitManager;\n+import com.epam.pipeline.manager.issue.AttachmentFileManager;\n+import com.epam.pipeline.manager.issue.IssueManager;\n+import com.epam.pipeline.manager.metadata.MetadataManager;\n+import com.epam.pipeline.manager.notification.NotificationManager;\n+import com.epam.pipeline.manager.pipeline.FolderManager;\n+import com.epam.pipeline.manager.pipeline.PipelineCRUDManager;\n+import com.epam.pipeline.manager.pipeline.PipelineManager;\n+import com.epam.pipeline.manager.pipeline.PipelineRunManager;\n+import com.epam.pipeline.manager.pipeline.RestartRunManager;\n+import com.epam.pipeline.manager.pipeline.RunScheduleManager;\n+import com.epam.pipeline.manager.pipeline.RunStatusManager;\n+import com.epam.pipeline.manager.pipeline.ToolManager;\n+import com.epam.pipeline.manager.pipeline.runner.ConfigurationProviderManager;\n+import com.epam.pipeline.manager.scheduling.RunScheduler;\n+import com.epam.pipeline.manager.scheduling.ScheduleProviderManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.mapper.AbstractRunConfigurationMapper;\n+import com.epam.pipeline.mapper.IssueMapper;\n+import com.epam.pipeline.security.jwt.JwtTokenGenerator;\n+import org.mapstruct.factory.Mappers;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.boot.test.mock.mockito.SpyBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import static org.mockito.Mockito.spy;\n+\n+@Configuration\n+public class JdbcTestBeans {\n+\n+    @MockBean\n+    protected JwtTokenGenerator mockJwtTokenGenerator;\n+\n+    @MockBean\n+    protected EntityManager mockEntityManager;\n+\n+    @MockBean\n+    protected AttachmentFileManager mockAttachmentFileManager;\n+\n+    @MockBean\n+    protected ToolManager mockToolManager;\n+\n+    @MockBean\n+    protected PipelineCRUDManager mockCrudManager;\n+\n+    @MockBean\n+    protected GitManager mockGitManager;\n+\n+    @MockBean\n+    protected FolderManager mockFolderManager;\n+\n+    @MockBean\n+    protected MetadataManager mockMetadataManager;\n+\n+    @MockBean\n+    protected NotificationManager mockNotificationManager;\n+\n+    @MockBean\n+    protected RunScheduler mockRunScheduler;\n+\n+    @MockBean\n+    protected ScheduleProviderManager mockScheduleProviderManager;\n+\n+    @MockBean\n+    protected PipelineRunManager mockPipelineRunManager;\n+\n+    @MockBean\n+    protected AbstractRunConfigurationMapper mockAbstractRunConfigurationMapper;\n+\n+    @MockBean\n+    protected ConfigurationProviderManager mockConfigurationProviderManager;\n+\n+    @SpyBean\n+    protected PipelineManager spyPipelineManager;\n+\n+    @SpyBean\n+    protected IssueManager spyIssueManager;\n+\n+    @SpyBean\n+    protected PipelineDao spyPipelineDao;", "originalCommit": "b55fa5d8a608ca4076db162c324eda232f05fc41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDI2NzU4Mw==", "url": "https://github.com/epam/cloud-pipeline/pull/1700#discussion_r560267583", "bodyText": "Also, could you please check if RestartRunManager and RunStatusManager can be a @MockBean?", "author": "ekazachkova", "createdAt": "2021-01-19T15:34:11Z", "path": "api/src/test/java/com/epam/pipeline/test/jdbc/JdbcTestBeans.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright 2017-2021 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.test.jdbc;\n+\n+import com.epam.pipeline.dao.DaoHelper;\n+import com.epam.pipeline.dao.notification.MonitoringNotificationDao;\n+import com.epam.pipeline.dao.pipeline.PipelineDao;\n+import com.epam.pipeline.manager.EntityManager;\n+import com.epam.pipeline.manager.configuration.RunConfigurationManager;\n+import com.epam.pipeline.manager.git.GitManager;\n+import com.epam.pipeline.manager.issue.AttachmentFileManager;\n+import com.epam.pipeline.manager.issue.IssueManager;\n+import com.epam.pipeline.manager.metadata.MetadataManager;\n+import com.epam.pipeline.manager.notification.NotificationManager;\n+import com.epam.pipeline.manager.pipeline.FolderManager;\n+import com.epam.pipeline.manager.pipeline.PipelineCRUDManager;\n+import com.epam.pipeline.manager.pipeline.PipelineManager;\n+import com.epam.pipeline.manager.pipeline.PipelineRunManager;\n+import com.epam.pipeline.manager.pipeline.RestartRunManager;\n+import com.epam.pipeline.manager.pipeline.RunScheduleManager;\n+import com.epam.pipeline.manager.pipeline.RunStatusManager;\n+import com.epam.pipeline.manager.pipeline.ToolManager;\n+import com.epam.pipeline.manager.pipeline.runner.ConfigurationProviderManager;\n+import com.epam.pipeline.manager.scheduling.RunScheduler;\n+import com.epam.pipeline.manager.scheduling.ScheduleProviderManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.mapper.AbstractRunConfigurationMapper;\n+import com.epam.pipeline.mapper.IssueMapper;\n+import com.epam.pipeline.security.jwt.JwtTokenGenerator;\n+import org.mapstruct.factory.Mappers;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.boot.test.mock.mockito.SpyBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import static org.mockito.Mockito.spy;\n+\n+@Configuration\n+public class JdbcTestBeans {\n+\n+    @MockBean\n+    protected JwtTokenGenerator mockJwtTokenGenerator;\n+\n+    @MockBean\n+    protected EntityManager mockEntityManager;\n+\n+    @MockBean\n+    protected AttachmentFileManager mockAttachmentFileManager;\n+\n+    @MockBean\n+    protected ToolManager mockToolManager;\n+\n+    @MockBean\n+    protected PipelineCRUDManager mockCrudManager;\n+\n+    @MockBean\n+    protected GitManager mockGitManager;\n+\n+    @MockBean\n+    protected FolderManager mockFolderManager;\n+\n+    @MockBean\n+    protected MetadataManager mockMetadataManager;\n+\n+    @MockBean\n+    protected NotificationManager mockNotificationManager;\n+\n+    @MockBean\n+    protected RunScheduler mockRunScheduler;\n+\n+    @MockBean\n+    protected ScheduleProviderManager mockScheduleProviderManager;\n+\n+    @MockBean\n+    protected PipelineRunManager mockPipelineRunManager;\n+\n+    @MockBean\n+    protected AbstractRunConfigurationMapper mockAbstractRunConfigurationMapper;\n+\n+    @MockBean\n+    protected ConfigurationProviderManager mockConfigurationProviderManager;\n+\n+    @SpyBean\n+    protected PipelineManager spyPipelineManager;\n+\n+    @SpyBean\n+    protected IssueManager spyIssueManager;\n+\n+    @SpyBean\n+    protected PipelineDao spyPipelineDao;\n+\n+    @SpyBean\n+    protected DaoHelper spyDaoHelper;\n+\n+    @SpyBean\n+    protected AuthManager spyAuthManager;\n+\n+    @SpyBean\n+    protected RestartRunManager spyRestartRunManager;", "originalCommit": "b55fa5d8a608ca4076db162c324eda232f05fc41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5bb09ae3cab82a86a39fd2783cfb51a6563dc50e", "url": "https://github.com/epam/cloud-pipeline/commit/5bb09ae3cab82a86a39fd2783cfb51a6563dc50e", "message": "Issue #1695: removed unnecessary test beans", "committedDate": "2021-01-20T07:38:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MDg0NTAxOQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1700#discussion_r560845019", "bodyText": "Could you please fix names? (spy -> mock)", "author": "ekazachkova", "createdAt": "2021-01-20T10:19:12Z", "path": "api/src/test/java/com/epam/pipeline/test/jdbc/JdbcTestBeans.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright 2017-2021 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.test.jdbc;\n+\n+import com.epam.pipeline.manager.EntityManager;\n+import com.epam.pipeline.manager.configuration.RunConfigurationManager;\n+import com.epam.pipeline.manager.git.GitManager;\n+import com.epam.pipeline.manager.issue.AttachmentFileManager;\n+import com.epam.pipeline.manager.issue.IssueManager;\n+import com.epam.pipeline.manager.metadata.MetadataManager;\n+import com.epam.pipeline.manager.notification.NotificationManager;\n+import com.epam.pipeline.manager.pipeline.FolderManager;\n+import com.epam.pipeline.manager.pipeline.PipelineCRUDManager;\n+import com.epam.pipeline.manager.pipeline.PipelineManager;\n+import com.epam.pipeline.manager.pipeline.PipelineRunManager;\n+import com.epam.pipeline.manager.pipeline.RestartRunManager;\n+import com.epam.pipeline.manager.pipeline.RunScheduleManager;\n+import com.epam.pipeline.manager.pipeline.RunStatusManager;\n+import com.epam.pipeline.manager.pipeline.ToolManager;\n+import com.epam.pipeline.manager.pipeline.runner.ConfigurationProviderManager;\n+import com.epam.pipeline.manager.scheduling.RunScheduler;\n+import com.epam.pipeline.manager.scheduling.ScheduleProviderManager;\n+import com.epam.pipeline.manager.security.AuthManager;\n+import com.epam.pipeline.mapper.AbstractRunConfigurationMapper;\n+import com.epam.pipeline.mapper.IssueMapper;\n+import com.epam.pipeline.security.jwt.JwtTokenGenerator;\n+import org.mapstruct.factory.Mappers;\n+import org.springframework.boot.test.mock.mockito.MockBean;\n+import org.springframework.boot.test.mock.mockito.SpyBean;\n+import org.springframework.context.annotation.Bean;\n+import org.springframework.context.annotation.Configuration;\n+\n+import static org.mockito.Mockito.spy;\n+\n+@Configuration\n+public class JdbcTestBeans {\n+\n+    @MockBean\n+    protected JwtTokenGenerator mockJwtTokenGenerator;\n+\n+    @MockBean\n+    protected EntityManager mockEntityManager;\n+\n+    @MockBean\n+    protected AttachmentFileManager mockAttachmentFileManager;\n+\n+    @MockBean\n+    protected ToolManager mockToolManager;\n+\n+    @MockBean\n+    protected PipelineCRUDManager mockCrudManager;\n+\n+    @MockBean\n+    protected GitManager mockGitManager;\n+\n+    @MockBean\n+    protected FolderManager mockFolderManager;\n+\n+    @MockBean\n+    protected MetadataManager mockMetadataManager;\n+\n+    @MockBean\n+    protected NotificationManager mockNotificationManager;\n+\n+    @MockBean\n+    protected RunScheduler mockRunScheduler;\n+\n+    @MockBean\n+    protected ScheduleProviderManager mockScheduleProviderManager;\n+\n+    @MockBean\n+    protected PipelineRunManager mockPipelineRunManager;\n+\n+    @MockBean\n+    protected AbstractRunConfigurationMapper mockAbstractRunConfigurationMapper;\n+\n+    @MockBean\n+    protected ConfigurationProviderManager mockConfigurationProviderManager;\n+\n+    @MockBean\n+    protected RestartRunManager spyRestartRunManager;\n+\n+    @MockBean\n+    protected RunStatusManager spyRunStatusManager;", "originalCommit": "5bb09ae3cab82a86a39fd2783cfb51a6563dc50e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8164158d053f7d03868fc9c58c84ff1191cda096", "url": "https://github.com/epam/cloud-pipeline/commit/8164158d053f7d03868fc9c58c84ff1191cda096", "message": "Issue #1695:  test beans names refactoring", "committedDate": "2021-01-20T10:29:10Z", "type": "commit"}]}