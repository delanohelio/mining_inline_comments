{"pr_number": 1413, "pr_title": "Issue #1405: Implemented tests for LogController", "pr_createdAt": "2020-09-17T14:45:49Z", "pr_url": "https://github.com/epam/cloud-pipeline/pull/1413", "timeline": [{"oid": "f36c11bfc347ec7f483107ac544bedaa7a202b81", "url": "https://github.com/epam/cloud-pipeline/commit/f36c11bfc347ec7f483107ac544bedaa7a202b81", "message": "Issue #1405: Implemented tests for LogController", "committedDate": "2020-09-17T13:58:08Z", "type": "commit"}, {"oid": "d8c8b20a5578d444fbfa63702c91a21f920a14c5", "url": "https://github.com/epam/cloud-pipeline/commit/d8c8b20a5578d444fbfa63702c91a21f920a14c5", "message": "Issue #1405: Added ControllerTestBeans with necessary service mocks. Security enabled for tests", "committedDate": "2020-09-18T15:45:22Z", "type": "commit"}, {"oid": "861c98f612254cd2c24cc38c82131c2646a05ebf", "url": "https://github.com/epam/cloud-pipeline/commit/861c98f612254cd2c24cc38c82131c2646a05ebf", "message": "Issue #1405: WebTestConfiguration added, changed LogControllerTest to use /restapi/ endpoint", "committedDate": "2020-09-23T10:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxMjY5OA==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r494212698", "bodyText": "Could you please shouldDoSmtgh notation for test names", "author": "mzueva", "createdAt": "2020-09-24T10:39:27Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.controller.AbstractControllerTest;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.result.MockMvcResultHandlers;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    @Test\n+    public void testFilterGet() throws Exception {", "originalCommit": "861c98f612254cd2c24cc38c82131c2646a05ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxMjg2Mg==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r494212862", "bodyText": "Please add final for all fields and arguments", "author": "mzueva", "createdAt": "2020-09-24T10:39:45Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.controller.AbstractControllerTest;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.result.MockMvcResultHandlers;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    @Test\n+    public void testFilterGet() throws Exception {\n+        LogFilter logFilter = new LogFilter();", "originalCommit": "861c98f612254cd2c24cc38c82131c2646a05ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDIxMzA3NQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r494213075", "bodyText": "Let's parse object from response and use it for validation", "author": "mzueva", "createdAt": "2020-09-24T10:40:09Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.controller.AbstractControllerTest;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.test.web.servlet.MvcResult;\n+import org.springframework.test.web.servlet.result.MockMvcResultHandlers;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.mockito.Mockito.times;\n+import static org.mockito.Mockito.verify;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    @Test\n+    public void testFilterGet() throws Exception {\n+        LogFilter logFilter = new LogFilter();\n+        MvcResult mvcResult = mvc().perform(get(\"/restapi/log/filter\")\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andDo(MockMvcResultHandlers.print())\n+                .andExpect(status().isOk()).andReturn();\n+\n+        verify(mockLogApiService, times(1)).getFilters();\n+\n+        String actual = mvcResult.getResponse().getContentAsString();\n+        assertThat(actual).isNotBlank();\n+    }\n+\n+    @Test\n+    public void testFilterPost() throws Exception {\n+        LogFilter logFilter = new LogFilter();\n+        logFilter.setMessage(\"testMessage\");\n+        MvcResult mvcResult = mvc().perform(post(\"/restapi/log/filter\")\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andExpect(status().isOk()).andReturn();\n+\n+        ArgumentCaptor<LogFilter> logFilterCaptor = ArgumentCaptor.forClass(LogFilter.class);", "originalCommit": "861c98f612254cd2c24cc38c82131c2646a05ebf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e91d68033889432f0d6252beeb5b95955472d8db", "url": "https://github.com/epam/cloud-pipeline/commit/e91d68033889432f0d6252beeb5b95955472d8db", "message": "Issue #1405: JWTSecurityConfiguration enabled in test, LogControllerTest refactored", "committedDate": "2020-09-25T08:14:49Z", "type": "commit"}, {"oid": "04396d69786f56edbfaf9eb3e639daa9775f9747", "url": "https://github.com/epam/cloud-pipeline/commit/04396d69786f56edbfaf9eb3e639daa9775f9747", "message": "Issue #1405: Added checks for JSON deserialization", "committedDate": "2020-09-25T11:06:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1MzUxOA==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495853518", "bodyText": "Could you please cleanup licence format? (double comment)", "author": "ekazachkova", "createdAt": "2020-09-28T10:54:51Z", "path": "api/src/test/java/com/epam/pipeline/controller/CommonTestContext.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/*", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1NDAwOQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495854009", "bodyText": "Could you please add space before =?", "author": "ekazachkova", "createdAt": "2020-09-28T10:55:49Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.config.JsonMapper;\n+import com.epam.pipeline.controller.AbstractControllerTest;\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.entity.log.LogPagination;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.Assert.assertEquals;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    private static final String LOG_ENDPOINT = SERVLET_PATH + \"/log/filter\";\n+    private final LogFilter logFilter = new LogFilter();\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserGet() throws Exception {\n+        mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnLogFilter() throws Exception {\n+        logFilter.setSortOrder(\"ASC\");\n+        Mockito.doReturn(logFilter).when(mockLogApiService).getFilters();\n+        final MvcResult mvcResult = mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE))\n+                .andExpect(status().isOk()).andReturn();\n+        Mockito.verify(mockLogApiService).getFilters();\n+\n+        final ResponseResult<LogFilter> expectedResult = new ResponseResult<>();\n+        expectedResult.setStatus(\"OK\");\n+        expectedResult.setPayload(logFilter);\n+\n+        final String actual= mvcResult.getResponse().getContentAsString();", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1ODkwMg==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495858902", "bodyText": "Could we move this logic into separate generic method? (to use it in other test)\nsmth like:\nprivate <T> ResponseResult<T> buildExpectedResult(final T payload) {\n        final ResponseResult<T> expectedResult = new ResponseResult<>();\n        expectedResult.setStatus(\"OK\");\n        expectedResult.setPayload(payload);\n        return expectedResult;\n    }\n\nP.S.: may be should create additional utility class for controller tests", "author": "ekazachkova", "createdAt": "2020-09-28T11:06:02Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.config.JsonMapper;\n+import com.epam.pipeline.controller.AbstractControllerTest;\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.entity.log.LogPagination;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.Assert.assertEquals;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    private static final String LOG_ENDPOINT = SERVLET_PATH + \"/log/filter\";\n+    private final LogFilter logFilter = new LogFilter();\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserGet() throws Exception {\n+        mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnLogFilter() throws Exception {\n+        logFilter.setSortOrder(\"ASC\");\n+        Mockito.doReturn(logFilter).when(mockLogApiService).getFilters();\n+        final MvcResult mvcResult = mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE))\n+                .andExpect(status().isOk()).andReturn();\n+        Mockito.verify(mockLogApiService).getFilters();\n+\n+        final ResponseResult<LogFilter> expectedResult = new ResponseResult<>();\n+        expectedResult.setStatus(\"OK\");\n+        expectedResult.setPayload(logFilter);\n+\n+        final String actual= mvcResult.getResponse().getContentAsString();\n+        assertThat(actual).isEqualToIgnoringWhitespace(getObjectMapper().writeValueAsString(expectedResult));\n+\n+        final Result<LogFilter> actualResult =\n+                JsonMapper.parseData(actual, new TypeReference<Result<LogFilter>>() { });\n+\n+        assertEquals(expectedResult.getPayload(), actualResult.getPayload());\n+    }\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserPost() throws Exception {\n+        mvc().perform(post(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnFilteredLogs() throws Exception {\n+        final LogPagination logPagination = LogPagination.builder().pageSize(5).build();\n+        logFilter.setMessage(\"testMessage\");\n+        Mockito.doReturn(logPagination).when(mockLogApiService).filter(logFilter);\n+        final MvcResult mvcResult = mvc().perform(post(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andExpect(status().isOk()).andReturn();\n+\n+        final ArgumentCaptor<LogFilter> logFilterCaptor = ArgumentCaptor.forClass(LogFilter.class);\n+        Mockito.verify(mockLogApiService).filter(logFilterCaptor.capture());\n+        assertThat(logFilterCaptor.getValue().getMessage()).isEqualTo(\"testMessage\");\n+\n+        final ResponseResult<LogPagination> expectedResult = new ResponseResult<>();", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1OTY3MQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495859671", "bodyText": "Could we move this assertions into separate generic method? (to use it in other test)\nP.S.: may be should create additional utility class for controller tests", "author": "ekazachkova", "createdAt": "2020-09-28T11:07:43Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.config.JsonMapper;\n+import com.epam.pipeline.controller.AbstractControllerTest;\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.entity.log.LogPagination;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.Assert.assertEquals;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    private static final String LOG_ENDPOINT = SERVLET_PATH + \"/log/filter\";\n+    private final LogFilter logFilter = new LogFilter();\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserGet() throws Exception {\n+        mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnLogFilter() throws Exception {\n+        logFilter.setSortOrder(\"ASC\");\n+        Mockito.doReturn(logFilter).when(mockLogApiService).getFilters();\n+        final MvcResult mvcResult = mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE))\n+                .andExpect(status().isOk()).andReturn();\n+        Mockito.verify(mockLogApiService).getFilters();\n+\n+        final ResponseResult<LogFilter> expectedResult = new ResponseResult<>();\n+        expectedResult.setStatus(\"OK\");\n+        expectedResult.setPayload(logFilter);\n+\n+        final String actual= mvcResult.getResponse().getContentAsString();\n+        assertThat(actual).isEqualToIgnoringWhitespace(getObjectMapper().writeValueAsString(expectedResult));\n+\n+        final Result<LogFilter> actualResult =\n+                JsonMapper.parseData(actual, new TypeReference<Result<LogFilter>>() { });\n+\n+        assertEquals(expectedResult.getPayload(), actualResult.getPayload());\n+    }\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserPost() throws Exception {\n+        mvc().perform(post(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnFilteredLogs() throws Exception {\n+        final LogPagination logPagination = LogPagination.builder().pageSize(5).build();\n+        logFilter.setMessage(\"testMessage\");\n+        Mockito.doReturn(logPagination).when(mockLogApiService).filter(logFilter);\n+        final MvcResult mvcResult = mvc().perform(post(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andExpect(status().isOk()).andReturn();\n+\n+        final ArgumentCaptor<LogFilter> logFilterCaptor = ArgumentCaptor.forClass(LogFilter.class);\n+        Mockito.verify(mockLogApiService).filter(logFilterCaptor.capture());\n+        assertThat(logFilterCaptor.getValue().getMessage()).isEqualTo(\"testMessage\");\n+\n+        final ResponseResult<LogPagination> expectedResult = new ResponseResult<>();\n+        expectedResult.setStatus(\"OK\");\n+        expectedResult.setPayload(logPagination);\n+\n+        final String actual = mvcResult.getResponse().getContentAsString();", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYyNjg2Ng==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r496626866", "bodyText": "Lets move TypeReference into method arguments:\n    private <T> void assertResponse(final MvcResult mvcResult,\n                                    final ResponseResult<T> expectedResult,\n                                    final TypeReference<Result<T>> typeReference) throws Exception {\n        final String actual = mvcResult.getResponse().getContentAsString();\n        assertThat(actual).isNotBlank();\n        assertThat(actual).isEqualToIgnoringWhitespace(getObjectMapper().writeValueAsString(expectedResult));\n\n        final Result<T> actualResult = JsonMapper.parseData(actual, typeReference);\n        assertEquals(expectedResult.getPayload(), actualResult.getPayload());\n    }\n\nAlso, I would prefer to don't use isNotBlank method since it works incorrectly.\nCould we use org.apache.commons.lang3.StringUtils#isNotBlank or org.skyscreamer.jsonassert.JSONAssert#assertEquals?", "author": "ekazachkova", "createdAt": "2020-09-29T10:59:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg1OTY3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg2ODc3Mg==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495868772", "bodyText": "Do we need this fields?", "author": "ekazachkova", "createdAt": "2020-09-28T11:26:15Z", "path": "api/src/test/java/com/epam/pipeline/controller/AbstractControllerTest.java", "diffHunk": "@@ -17,20 +17,26 @@\n package com.epam.pipeline.controller;\n \n import static org.junit.Assert.assertNotNull;\n+import static org.springframework.security.test.web.servlet.setup.SecurityMockMvcConfigurers.springSecurity;\n \n import com.epam.pipeline.config.JsonMapper;\n import com.fasterxml.jackson.databind.type.TypeFactory;\n import org.junit.Before;\n+import org.junit.runner.RunWith;\n import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.context.junit4.SpringRunner;\n import org.springframework.test.web.servlet.MockMvc;\n import org.springframework.test.web.servlet.setup.MockMvcBuilders;\n import org.springframework.web.context.WebApplicationContext;\n \n+@RunWith(SpringRunner.class)\n+@WebTestConfiguration\n public abstract class AbstractControllerTest {\n     protected static final String JPATH_STATUS = \"$.status\";", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg2OTM0OQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495869349", "bodyText": "Do we need typeFacroty field?", "author": "ekazachkova", "createdAt": "2020-09-28T11:27:30Z", "path": "api/src/test/java/com/epam/pipeline/controller/AbstractControllerTest.java", "diffHunk": "@@ -49,7 +55,8 @@ public void setup() throws Exception {\n         assertNotNull(\"ObjectMapper isn't provided.\", objectMapper);\n \n         typeFactory = TypeFactory.defaultInstance();", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg3MTIxMg==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495871212", "bodyText": "Why do we need this class?", "author": "ekazachkova", "createdAt": "2020-09-28T11:31:20Z", "path": "api/src/test/java/com/epam/pipeline/controller/TestRestConfiguration.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTg3MjAxNw==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r495872017", "bodyText": "Could you please move all controller tests configuration into separate package com.epam.pipeline.test.web?", "author": "ekazachkova", "createdAt": "2020-09-28T11:33:00Z", "path": "api/src/test/java/com/epam/pipeline/controller/WebTestConfiguration.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*", "originalCommit": "04396d69786f56edbfaf9eb3e639daa9775f9747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d396dfb7c638346d889bca03c9399ce97d82a1d1", "url": "https://github.com/epam/cloud-pipeline/commit/d396dfb7c638346d889bca03c9399ce97d82a1d1", "message": "Issue #1405: Removed unused fields and classes, created ControllerTestUtils", "committedDate": "2020-09-28T15:22:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjI5MQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r496606291", "bodyText": "Could we make this class an interface or add empty constructor (to fix checkstyleTest task)?", "author": "ekazachkova", "createdAt": "2020-09-29T10:21:28Z", "path": "api/src/test/java/com/epam/pipeline/util/ControllerTestUtils.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.util;\n+\n+import com.epam.pipeline.controller.ResponseResult;\n+\n+\n+public class ControllerTestUtils {", "originalCommit": "d396dfb7c638346d889bca03c9399ce97d82a1d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYwNjQ0Mg==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r496606442", "bodyText": "Empty line", "author": "ekazachkova", "createdAt": "2020-09-29T10:21:48Z", "path": "api/src/test/java/com/epam/pipeline/util/ControllerTestUtils.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.util;\n+\n+import com.epam.pipeline.controller.ResponseResult;\n+", "originalCommit": "d396dfb7c638346d889bca03c9399ce97d82a1d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjYxMjExMQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r496612111", "bodyText": "Could we move testMessage into constants?", "author": "ekazachkova", "createdAt": "2020-09-29T10:31:52Z", "path": "api/src/test/java/com/epam/pipeline/controller/log/LogControllerTest.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.controller.log;\n+\n+import com.epam.pipeline.config.JsonMapper;\n+import com.epam.pipeline.test.web.AbstractControllerTest;\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.epam.pipeline.entity.log.LogFilter;\n+import com.epam.pipeline.entity.log.LogPagination;\n+import com.epam.pipeline.manager.log.LogApiService;\n+import com.epam.pipeline.util.ControllerTestUtils;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.junit.Test;\n+import org.mockito.ArgumentCaptor;\n+import org.mockito.Mockito;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.boot.test.autoconfigure.web.servlet.WebMvcTest;\n+import org.springframework.security.test.context.support.WithMockUser;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.Assert.assertEquals;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.get;\n+import static org.springframework.test.web.servlet.request.MockMvcRequestBuilders.post;\n+import static org.springframework.test.web.servlet.result.MockMvcResultMatchers.status;\n+\n+@WebMvcTest(controllers = LogController.class)\n+public class LogControllerTest extends AbstractControllerTest {\n+\n+    @Autowired\n+    private LogApiService mockLogApiService;\n+\n+    private static final String LOG_ENDPOINT = SERVLET_PATH + \"/log/filter\";\n+    private final LogFilter logFilter = new LogFilter();\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserGet() throws Exception {\n+        mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnLogFilter() throws Exception {\n+        logFilter.setSortOrder(\"ASC\");\n+        Mockito.doReturn(logFilter).when(mockLogApiService).getFilters();\n+        final MvcResult mvcResult = mvc().perform(get(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE))\n+                .andExpect(status().isOk()).andReturn();\n+\n+        Mockito.verify(mockLogApiService).getFilters();\n+\n+        final ResponseResult<LogFilter> expectedResult = ControllerTestUtils.buildExpectedResult(logFilter);\n+\n+        final String actual = mvcResult.getResponse().getContentAsString();\n+        assertThat(actual).isNotBlank();\n+        assertThat(actual).isEqualToIgnoringWhitespace(getObjectMapper().writeValueAsString(expectedResult));\n+\n+        final Result<LogFilter> actualResult =\n+                JsonMapper.parseData(actual, new TypeReference<Result<LogFilter>>() { });\n+        assertEquals(expectedResult.getPayload(), actualResult.getPayload());\n+    }\n+\n+    @Test\n+    public void shouldFailForUnauthorizedUserPost() throws Exception {\n+        mvc().perform(post(LOG_ENDPOINT)\n+                .servletPath(SERVLET_PATH)\n+                .contentType(EXPECTED_CONTENT_TYPE)\n+                .content(getObjectMapper().writeValueAsString(logFilter)))\n+                .andExpect(status().isUnauthorized());\n+    }\n+\n+    @Test\n+    @WithMockUser\n+    public void shouldReturnFilteredLogs() throws Exception {\n+        final LogPagination logPagination = LogPagination.builder().pageSize(5).build();\n+        logFilter.setMessage(\"testMessage\");", "originalCommit": "d396dfb7c638346d889bca03c9399ce97d82a1d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b1e9fe25c9f518fc4750554fcd6de35b1ba8d73a", "url": "https://github.com/epam/cloud-pipeline/commit/b1e9fe25c9f518fc4750554fcd6de35b1ba8d73a", "message": "Issue #1405: added new method to ControllerTestUtils for assertion", "committedDate": "2020-09-29T13:08:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNjkyMQ==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r496716921", "bodyText": "The test should fail if actual response is blank (StringUtils#isNotBlank returns boolean)", "author": "ekazachkova", "createdAt": "2020-09-29T13:29:29Z", "path": "api/src/test/java/com/epam/pipeline/util/ControllerTestUtils.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.util;\n+\n+import com.epam.pipeline.config.JsonMapper;\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.Assert.assertEquals;\n+\n+public final class ControllerTestUtils {\n+\n+    private ControllerTestUtils() {\n+    }\n+\n+    public static <T> ResponseResult<T> buildExpectedResult(final T payload) {\n+        final ResponseResult<T> expectedResult = new ResponseResult<>();\n+        expectedResult.setStatus(\"OK\");\n+        expectedResult.setPayload(payload);\n+        return expectedResult;\n+    }\n+\n+    public static <T> void assertResponse(final MvcResult mvcResult,\n+                                          final JsonMapper objectMapper,\n+                                          final ResponseResult<T> expectedResult,\n+                                          final TypeReference<Result<T>> typeReference) throws Exception {\n+        final String actual = mvcResult.getResponse().getContentAsString();\n+        StringUtils.isNotBlank(actual);", "originalCommit": "b1e9fe25c9f518fc4750554fcd6de35b1ba8d73a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjcxNzE4Ng==", "url": "https://github.com/epam/cloud-pipeline/pull/1413#discussion_r496717186", "bodyText": "Cleanup please", "author": "ekazachkova", "createdAt": "2020-09-29T13:29:46Z", "path": "api/src/test/java/com/epam/pipeline/util/ControllerTestUtils.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2017-2020 EPAM Systems, Inc. (https://www.epam.com/)\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.epam.pipeline.util;\n+\n+import com.epam.pipeline.config.JsonMapper;\n+import com.epam.pipeline.controller.ResponseResult;\n+import com.epam.pipeline.controller.Result;\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import org.apache.commons.lang3.StringUtils;\n+import org.springframework.test.web.servlet.MvcResult;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.junit.Assert.assertEquals;\n+\n+public final class ControllerTestUtils {\n+\n+    private ControllerTestUtils() {\n+    }\n+\n+    public static <T> ResponseResult<T> buildExpectedResult(final T payload) {\n+        final ResponseResult<T> expectedResult = new ResponseResult<>();\n+        expectedResult.setStatus(\"OK\");\n+        expectedResult.setPayload(payload);\n+        return expectedResult;\n+    }\n+\n+    public static <T> void assertResponse(final MvcResult mvcResult,\n+                                          final JsonMapper objectMapper,\n+                                          final ResponseResult<T> expectedResult,\n+                                          final TypeReference<Result<T>> typeReference) throws Exception {\n+        final String actual = mvcResult.getResponse().getContentAsString();\n+        StringUtils.isNotBlank(actual);\n+        assertThat(actual).isEqualToIgnoringWhitespace(objectMapper.writeValueAsString(expectedResult));\n+\n+        final Result<T> actualResult = JsonMapper.parseData(actual, typeReference);\n+        assertEquals(expectedResult.getPayload(), actualResult.getPayload());\n+        System.out.println(actualResult.getPayload());", "originalCommit": "b1e9fe25c9f518fc4750554fcd6de35b1ba8d73a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ebbea403833b29ce4805865762dd620b762bb9cf", "url": "https://github.com/epam/cloud-pipeline/commit/ebbea403833b29ce4805865762dd620b762bb9cf", "message": "Issue #1405: fixed isNotBlank() assertion", "committedDate": "2020-09-29T15:00:36Z", "type": "commit"}]}