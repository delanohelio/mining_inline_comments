{"pr_number": 13347, "pr_title": "WFLY-11999 Wildfly creates to many instances of all web service classes", "pr_createdAt": "2020-06-04T08:21:03Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13347", "timeline": [{"oid": "e229a77068694481cce1551630caf1ddaeed1be5", "url": "https://github.com/wildfly/wildfly/commit/e229a77068694481cce1551630caf1ddaeed1be5", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-06-08T10:57:29Z", "type": "forcePushed"}, {"oid": "01ef8dc1d2b8bd83b2fe36bbff1f3d67e96c6f2f", "url": "https://github.com/wildfly/wildfly/commit/01ef8dc1d2b8bd83b2fe36bbff1f3d67e96c6f2f", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-06-09T04:11:32Z", "type": "forcePushed"}, {"oid": "e7e75ca4e257d70fb30f5b410f97d33f61475910", "url": "https://github.com/wildfly/wildfly/commit/e7e75ca4e257d70fb30f5b410f97d33f61475910", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-06-30T16:10:19Z", "type": "forcePushed"}, {"oid": "bb5f3510f93ea8e39b24ec9ec23a8e97ca68c821", "url": "https://github.com/wildfly/wildfly/commit/bb5f3510f93ea8e39b24ec9ec23a8e97ca68c821", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-06-30T16:19:00Z", "type": "forcePushed"}, {"oid": "827b3a6ef020eab54a639c989ab6f0f56ef76505", "url": "https://github.com/wildfly/wildfly/commit/827b3a6ef020eab54a639c989ab6f0f56ef76505", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-07-02T18:32:37Z", "type": "forcePushed"}, {"oid": "f84b1bf857b188e16c2c3e8a8e780339dbb738a3", "url": "https://github.com/wildfly/wildfly/commit/f84b1bf857b188e16c2c3e8a8e780339dbb738a3", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-07-10T12:34:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgyNzk5Ng==", "url": "https://github.com/wildfly/wildfly/pull/13347#discussion_r452827996", "bodyText": "This can probably be deleted?", "author": "kabir", "createdAt": "2020-07-10T13:01:05Z", "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/InstanceCountEndpointTestcase.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jboss.as.test.integration.ws.basic;\n+\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.jboss.shrinkwrap.api.Archive;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import javax.xml.namespace.QName;\n+import javax.xml.ws.Service;\n+import java.net.URL;\n+\n+\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class InstanceCountEndpointTestcase {\n+\n+\n+    public static final String ARCHIVE_NAME = \"instanceCountWebservice\";\n+\n+    @ArquillianResource\n+    URL baseUrl;\n+\n+    @Deployment\n+    public static Archive<?> deployment() {\n+        JavaArchive jar = ShrinkWrap.create(JavaArchive.class, ARCHIVE_NAME + \".jar\")\n+                .addClasses(InstanceCountEndpoint.class, InstanceCountEndpointIface.class);\n+        //.addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);", "originalCommit": "f84b1bf857b188e16c2c3e8a8e780339dbb738a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgyODA3Nw==", "url": "https://github.com/wildfly/wildfly/pull/13347#discussion_r452828077", "bodyText": "More cruft?", "author": "kabir", "createdAt": "2020-07-10T13:01:15Z", "path": "testsuite/integration/ws/src/test/java/org/jboss/as/test/integration/ws/basic/InstanceCountEndpointTestcase.java", "diffHunk": "@@ -0,0 +1,56 @@\n+package org.jboss.as.test.integration.ws.basic;\n+\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.jboss.shrinkwrap.api.Archive;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import javax.xml.namespace.QName;\n+import javax.xml.ws.Service;\n+import java.net.URL;\n+\n+\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class InstanceCountEndpointTestcase {\n+\n+\n+    public static final String ARCHIVE_NAME = \"instanceCountWebservice\";\n+\n+    @ArquillianResource\n+    URL baseUrl;\n+\n+    @Deployment\n+    public static Archive<?> deployment() {\n+        JavaArchive jar = ShrinkWrap.create(JavaArchive.class, ARCHIVE_NAME + \".jar\")\n+                .addClasses(InstanceCountEndpoint.class, InstanceCountEndpointIface.class);\n+        //.addClasses(EndpointIface.class, EJBEndpoint.class, HelloObject.class);\n+        return jar;\n+    }\n+\n+    /*@Deployment\n+    public static Archive<?> deploy() {", "originalCommit": "f84b1bf857b188e16c2c3e8a8e780339dbb738a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjgyOTc5MQ==", "url": "https://github.com/wildfly/wildfly/pull/13347#discussion_r452829791", "bodyText": "More cruft :)", "author": "kabir", "createdAt": "2020-07-10T13:04:36Z", "path": "webservices/server-integration/src/main/java/org/jboss/as/webservices/invocation/AbstractInvocationHandler.java", "diffHunk": "@@ -129,21 +124,22 @@ public void invokeInternal(final Endpoint endpoint, final Invocation wsInvocatio\n         // prepare invocation data\n         final ComponentView componentView = getComponentView();\n         Component component = componentView.getComponent();\n-        // in case of @FactoryType annotation we don't need to go into EE interceptors\n         final boolean forceTargetBean = (wsInvocation.getInvocationContext().getProperty(\"forceTargetBean\") != null);\n-        if (forceTargetBean) {\n-            this.reference = new ManagedReference() {\n-                public void release() {\n-                }\n+        boolean isWeldDeployment =  endpoint.getProperty(WELD_DEPLOYMENT) == null ? false : (Boolean) endpoint.getProperty(WELD_DEPLOYMENT);\n+        if (forceTargetBean || !isWeldDeployment && endpoint.getType() == EndpointType.JAXWS_JSE) {\n+       // if (wsInvocation.getInvocationContext().getTargetBean() != null) {", "originalCommit": "f84b1bf857b188e16c2c3e8a8e780339dbb738a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b597907f86472b5d81c79cef32383cb193a31445", "url": "https://github.com/wildfly/wildfly/commit/b597907f86472b5d81c79cef32383cb193a31445", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-07-10T15:44:43Z", "type": "forcePushed"}, {"oid": "b38d21c98b77a8d84eaea4b17b16d6396822e6af", "url": "https://github.com/wildfly/wildfly/commit/b38d21c98b77a8d84eaea4b17b16d6396822e6af", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-07-10T15:47:42Z", "type": "forcePushed"}, {"oid": "b875d2b1cdbce01e0e5d6e9f375e34303ebae3e7", "url": "https://github.com/wildfly/wildfly/commit/b875d2b1cdbce01e0e5d6e9f375e34303ebae3e7", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-07-13T10:34:25Z", "type": "forcePushed"}, {"oid": "5db82d14cb82d01842b9e814485ee48c15ece631", "url": "https://github.com/wildfly/wildfly/commit/5db82d14cb82d01842b9e814485ee48c15ece631", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-07-17T10:03:41Z", "type": "forcePushed"}, {"oid": "dd0381316a0457e145ac822e575cc2d72b03b6ad", "url": "https://github.com/wildfly/wildfly/commit/dd0381316a0457e145ac822e575cc2d72b03b6ad", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-09-14T01:32:52Z", "type": "forcePushed"}, {"oid": "c1ff2918098447e6d5bc4d9ed74940608030f0eb", "url": "https://github.com/wildfly/wildfly/commit/c1ff2918098447e6d5bc4d9ed74940608030f0eb", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-09-14T05:14:24Z", "type": "forcePushed"}, {"oid": "9dff1ff96d59f0a7efcdaea663a19aeb2e7d56de", "url": "https://github.com/wildfly/wildfly/commit/9dff1ff96d59f0a7efcdaea663a19aeb2e7d56de", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-12-08T06:09:22Z", "type": "commit"}, {"oid": "9dff1ff96d59f0a7efcdaea663a19aeb2e7d56de", "url": "https://github.com/wildfly/wildfly/commit/9dff1ff96d59f0a7efcdaea663a19aeb2e7d56de", "message": "WFLY-11999 Wildfly creates to many instances of all web service classes", "committedDate": "2020-12-08T06:09:22Z", "type": "forcePushed"}]}