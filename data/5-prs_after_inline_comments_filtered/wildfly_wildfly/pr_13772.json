{"pr_number": 13772, "pr_title": "WFLY-13792 Test for JSF deployment failure due to UnsupportedOperationExceptio\u2026", "pr_createdAt": "2020-12-03T17:36:30Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13772", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk4NzI0Ng==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r535987246", "bodyText": "There are two httpclient.execute(httpget) requests here, which is unnecessary to perform this test.", "author": "yersan", "createdAt": "2020-12-04T10:13:43Z", "path": "testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/jsf/unsupportedwar/FaceletsViewMappingsTestCase.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.test.integration.jsf.unsupportedwar;\n+\n+import java.net.URL;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.hamcrest.CoreMatchers;\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * <p>Tests the JSF deployment failure due to UnsupportedOperationException when\n+ * <em>javax.faces.FACELETS_VIEW_MAPPINGS</em> is defined with something that\n+ * does not include <em>*.xhtml</em>.</p>\n+ *\n+ * @author Ranabir Chakraborty <rchakrab@redhat.com>\n+ *\n+ */\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class FaceletsViewMappingsTestCase {\n+\n+    private static final String DEPLOYMENT = FaceletsViewMappingsTestCase.class.getSimpleName();\n+\n+    @ArquillianResource\n+    private URL url;\n+\n+    @Deployment\n+    public static WebArchive deployment() {\n+        final Package DEPLOYMENT_PACKAGE = HelloBean.class.getPackage();\n+        WebArchive war = ShrinkWrap.create(WebArchive.class, DEPLOYMENT + \".war\");\n+        war.addClasses(HelloBean.class, ConfigurationBean.class);\n+        war.addAsWebInfResource(DEPLOYMENT_PACKAGE, \"web.xml\", \"web.xml\");\n+        war.addAsWebResource(DEPLOYMENT_PACKAGE, \"hello.jsf\", \"hello.jsf\");\n+        return war;\n+    }\n+\n+    @SuppressWarnings(\"deprecation\")\n+    @Test\n+    public void testHelloWorld() throws Exception {\n+        try (CloseableHttpClient httpclient = HttpClients.createDefault()) {\n+            String Url = url.toExternalForm();\n+            HttpGet httpget = new HttpGet(Url);\n+            httpclient.execute(httpget);\n+\n+            HttpResponse response = httpclient.execute(httpget);", "originalCommit": "925998011b7e893c41c22ee7c4fb7e84d591d464", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk4OTI2OQ==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r535989269", "bodyText": "Suggestion, instead of \"Operation failed\", could you add something more informative? that would helps if you are reviewing the logs. \"Operation failed\" sounds like there is a management operation involved. In addition, you could add the result of the response.getStatusLine().getStatusCode() so you can easily see in the logs what was returned by the previous HTTP request.", "author": "yersan", "createdAt": "2020-12-04T10:16:59Z", "path": "testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/jsf/unsupportedwar/FaceletsViewMappingsTestCase.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.test.integration.jsf.unsupportedwar;\n+\n+import java.net.URL;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.hamcrest.CoreMatchers;\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * <p>Tests the JSF deployment failure due to UnsupportedOperationException when\n+ * <em>javax.faces.FACELETS_VIEW_MAPPINGS</em> is defined with something that\n+ * does not include <em>*.xhtml</em>.</p>\n+ *\n+ * @author Ranabir Chakraborty <rchakrab@redhat.com>\n+ *\n+ */\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class FaceletsViewMappingsTestCase {\n+\n+    private static final String DEPLOYMENT = FaceletsViewMappingsTestCase.class.getSimpleName();\n+\n+    @ArquillianResource\n+    private URL url;\n+\n+    @Deployment\n+    public static WebArchive deployment() {\n+        final Package DEPLOYMENT_PACKAGE = HelloBean.class.getPackage();\n+        WebArchive war = ShrinkWrap.create(WebArchive.class, DEPLOYMENT + \".war\");\n+        war.addClasses(HelloBean.class, ConfigurationBean.class);\n+        war.addAsWebInfResource(DEPLOYMENT_PACKAGE, \"web.xml\", \"web.xml\");\n+        war.addAsWebResource(DEPLOYMENT_PACKAGE, \"hello.jsf\", \"hello.jsf\");\n+        return war;\n+    }\n+\n+    @SuppressWarnings(\"deprecation\")\n+    @Test\n+    public void testHelloWorld() throws Exception {\n+        try (CloseableHttpClient httpclient = HttpClients.createDefault()) {\n+            String Url = url.toExternalForm();\n+            HttpGet httpget = new HttpGet(Url);\n+            httpclient.execute(httpget);\n+\n+            HttpResponse response = httpclient.execute(httpget);\n+            Assert.assertEquals(\"Operation failed\", HttpStatus.SC_OK, response.getStatusLine().getStatusCode());", "originalCommit": "925998011b7e893c41c22ee7c4fb7e84d591d464", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk5MDIxMQ==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r535990211", "bodyText": "Harmless, but Serializable is not needed for RequestScope, feel free to remove it to make the code more clean.", "author": "yersan", "createdAt": "2020-12-04T10:18:27Z", "path": "testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/jsf/unsupportedwar/HelloBean.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.test.integration.jsf.unsupportedwar;\n+\n+import java.io.Serializable;\n+import javax.enterprise.context.RequestScoped;\n+import javax.inject.Named;\n+\n+@Named(value = \"helloBean\")\n+@RequestScoped\n+public class HelloBean implements Serializable {", "originalCommit": "925998011b7e893c41c22ee7c4fb7e84d591d464", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNDkwMg==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r536004902", "bodyText": "Maybe this was only my impression, but when I read the javadoc of this test I was expecting that the test was going to assert that a deployment will fail with an UnsupportedOperationException when javax.faces.FACELETS_VIEW_MAPPINGS does not includes *.xhtml, I had to navigate to the Jira to understand it better.\nIf that is only my impression, that's fine, but my feeling was we can describe it differently. Something like verifies that an JSF application can be deployed if javax.faces.FACELETS_VIEW_MAPPINGS does not includes *.xhtml.", "author": "yersan", "createdAt": "2020-12-04T10:42:00Z", "path": "testsuite/integration/basic/src/test/java/org/jboss/as/test/integration/jsf/unsupportedwar/FaceletsViewMappingsTestCase.java", "diffHunk": "@@ -0,0 +1,80 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jboss.as.test.integration.jsf.unsupportedwar;\n+\n+import java.net.URL;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClients;\n+import org.apache.http.util.EntityUtils;\n+import org.hamcrest.CoreMatchers;\n+import org.jboss.arquillian.container.test.api.Deployment;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.arquillian.test.api.ArquillianResource;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.WebArchive;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * <p>Tests the JSF deployment failure due to UnsupportedOperationException when\n+ * <em>javax.faces.FACELETS_VIEW_MAPPINGS</em> is defined with something that\n+ * does not include <em>*.xhtml</em>.</p>", "originalCommit": "925998011b7e893c41c22ee7c4fb7e84d591d464", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAzMzE3Nw==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r536033177", "bodyText": "the idea of the testing is that the javax.faces.FACELETS_VIEW_MAPPINGS has some real value. Like FACELETS_VIEW_MAPPINGS set to *.jsf, then in the test just deploy the app and access the hello.jsf and check. I can add the JIRA link to the java doc so that someone can get a better understanding.", "author": "RanabirChakraborty", "createdAt": "2020-12-04T11:30:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNDkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEyNTA5NA==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r537125094", "bodyText": "@RanabirChakraborty\nI still don't understand what this test is doing from the above text and looking at the JIRAs. The various JIRAs talk about *.jsp etc and it's not clear what the expected behavior is without reading a lot of discussion and then kind of guessing. Because it's not obvious in this case I think it's worthwhile having a clear explanation in the test.\nI think the wording should be:\n\"Tests that JSF deployment failure does not occur when javax.faces.FACELETS_VIEW_MAPPINGS is defined with something that does not include *.xhtml.\"\nThat is what the test is doing.", "author": "bstansberry", "createdAt": "2020-12-06T21:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNDkwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzIxMzEwMQ==", "url": "https://github.com/wildfly/wildfly/pull/13772#discussion_r537213101", "bodyText": "@bstansberry The issue was that the default value of javax.faces.FACELETS_VIEW_MAPPINGS is *.xhtml and in wildfly adding the parameter FACELETS_VIEW_MAPPINGS that not containing the *.xhtml value triggers JSF deployment failure due to UnsupportedOperationException issue.\nThat's why in this test we are using *.jsf instead of default *.xhtml,(earlier this test was failing because the code fix is there in mojarra, but after the component upgrade this test should pass without failing).\nThe whole idea is that JSF deployment should not fail when javax.faces.FACELETS_VIEW_MAPPINGS is defined with something that does not include *.xhtml.\"", "author": "RanabirChakraborty", "createdAt": "2020-12-07T03:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjAwNDkwMg=="}], "type": "inlineReview"}, {"oid": "f4c4e3e45f1d4c4d428a6f5425524abad5f92552", "url": "https://github.com/wildfly/wildfly/commit/f4c4e3e45f1d4c4d428a6f5425524abad5f92552", "message": "WFLY-13792 JSF deployment failure due to UnsupportedOperationException when javax.faces.FACELETS_VIEW_MAPPINGS is defined", "committedDate": "2020-12-04T12:25:25Z", "type": "commit"}, {"oid": "f4c4e3e45f1d4c4d428a6f5425524abad5f92552", "url": "https://github.com/wildfly/wildfly/commit/f4c4e3e45f1d4c4d428a6f5425524abad5f92552", "message": "WFLY-13792 JSF deployment failure due to UnsupportedOperationException when javax.faces.FACELETS_VIEW_MAPPINGS is defined", "committedDate": "2020-12-04T12:25:25Z", "type": "forcePushed"}]}