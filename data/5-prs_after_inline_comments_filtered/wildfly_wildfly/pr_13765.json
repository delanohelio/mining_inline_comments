{"pr_number": 13765, "pr_title": "[WFLY-14151] Move microprofile-health extension to the microprofile feature pack", "pr_createdAt": "2020-12-02T14:22:11Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13765", "timeline": [{"oid": "fc432f34797203e8028dfb5b1c4f5f9365d68c1a", "url": "https://github.com/wildfly/wildfly/commit/fc432f34797203e8028dfb5b1c4f5f9365d68c1a", "message": "refactor code to extract DMR-Base Server Probes\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-07T09:49:03Z", "type": "forcePushed"}, {"oid": "4e63e6fb58b01e47950707b496220244149cace4", "url": "https://github.com/wildfly/wildfly/commit/4e63e6fb58b01e47950707b496220244149cace4", "message": "add base health subsystem\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-07T12:17:31Z", "type": "forcePushed"}, {"oid": "84f4e6897ef3e9593c909f79423075d1500c035a", "url": "https://github.com/wildfly/wildfly/commit/84f4e6897ef3e9593c909f79423075d1500c035a", "message": "move ServerProbes to base health subsystem\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-08T07:51:59Z", "type": "forcePushed"}, {"oid": "5ed850f4ec1f339defe369af5b84d0e67094ba60", "url": "https://github.com/wildfly/wildfly/commit/5ed850f4ec1f339defe369af5b84d0e67094ba60", "message": "move ServerProbes to base health subsystem\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-08T11:03:12Z", "type": "forcePushed"}, {"oid": "c034f6d7b4728e5fce68000eb5b8f73bff0404e6", "url": "https://github.com/wildfly/wildfly/commit/c034f6d7b4728e5fce68000eb5b8f73bff0404e6", "message": "move ServerProbes to base health subsystem\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-08T13:58:55Z", "type": "forcePushed"}, {"oid": "6e0c07fbbd22ae215c56ac27a2fce1024a0e8ecc", "url": "https://github.com/wildfly/wildfly/commit/6e0c07fbbd22ae215c56ac27a2fce1024a0e8ecc", "message": "Doc\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-08T14:46:25Z", "type": "forcePushed"}, {"oid": "fdc17bd64031721d208bf99139cba6eb3788b95b", "url": "https://github.com/wildfly/wildfly/commit/fdc17bd64031721d208bf99139cba6eb3788b95b", "message": "Doc\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-08T14:48:17Z", "type": "forcePushed"}, {"oid": "25cd30fc532ec542474b6e71ed154a0cb941c286", "url": "https://github.com/wildfly/wildfly/commit/25cd30fc532ec542474b6e71ed154a0cb941c286", "message": "add health subsystem to missing legacy files", "committedDate": "2020-12-09T08:55:24Z", "type": "forcePushed"}, {"oid": "90cab32ca53e01df167333548abc3f3e1360b6e4", "url": "https://github.com/wildfly/wildfly/commit/90cab32ca53e01df167333548abc3f3e1360b6e4", "message": "add health subsystem to missing legacy files", "committedDate": "2020-12-09T10:28:21Z", "type": "forcePushed"}, {"oid": "7366fc3edeef4040a3c1e69535dca607b103c99f", "url": "https://github.com/wildfly/wildfly/commit/7366fc3edeef4040a3c1e69535dca607b103c99f", "message": "observability layer\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-09T13:20:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgxNjMwNw==", "url": "https://github.com/wildfly/wildfly/pull/13765#discussion_r539816307", "bodyText": "^^^", "author": "bstansberry", "createdAt": "2020-12-10T03:25:06Z", "path": "testsuite/integration/basic/src/test/java/org/wildfly/test/integration/health/HealthHTTPEndpointTestCase.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package org.wildfly.test.integration.health;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import java.io.IOException;\n+\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClientBuilder;\n+import org.apache.http.util.EntityUtils;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.as.arquillian.api.ContainerResource;\n+import org.jboss.as.arquillian.container.ManagementClient;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * @author <a href=\"http://jmesnil.net/\">Jeff Mesnil</a> (c) 2018 Red Hat inc.\n+ */\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class HealthHTTPEndpointTestCase {\n+\n+    @ContainerResource\n+    ManagementClient managementClient;\n+\n+    @Test\n+    public void testHealthEndpoint() throws Exception {\n+        testHealthEndpoint(\"/health\");\n+    }\n+\n+    @Test\n+    public void testHealthLiveEndpoint() throws Exception {\n+        testHealthEndpoint(\"/health/live\");\n+    }\n+\n+    @Test\n+    public void testHealthReadyEndpoint() throws Exception {\n+        testHealthEndpoint(\"/health/ready\");\n+    }\n+\n+    private void testHealthEndpoint(String requestPath) throws IOException {\n+        final String healthURL = \"http://\" + managementClient.getMgmtAddress() + \":\" + managementClient.getMgmtPort() + requestPath;\n+        System.out.println(\"healthURL = \" + healthURL);", "originalCommit": "5aaafbd589fb35e613b158efb90d9ae5593a6c07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgxNjM2NQ==", "url": "https://github.com/wildfly/wildfly/pull/13765#discussion_r539816365", "bodyText": "^^^", "author": "bstansberry", "createdAt": "2020-12-10T03:25:16Z", "path": "testsuite/integration/basic/src/test/java/org/wildfly/test/integration/health/HealthHTTPEndpointTestCase.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package org.wildfly.test.integration.health;\n+\n+import static org.junit.Assert.assertEquals;\n+\n+import java.io.IOException;\n+\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpGet;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClientBuilder;\n+import org.apache.http.util.EntityUtils;\n+import org.jboss.arquillian.container.test.api.RunAsClient;\n+import org.jboss.arquillian.junit.Arquillian;\n+import org.jboss.as.arquillian.api.ContainerResource;\n+import org.jboss.as.arquillian.container.ManagementClient;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+/**\n+ * @author <a href=\"http://jmesnil.net/\">Jeff Mesnil</a> (c) 2018 Red Hat inc.\n+ */\n+@RunWith(Arquillian.class)\n+@RunAsClient\n+public class HealthHTTPEndpointTestCase {\n+\n+    @ContainerResource\n+    ManagementClient managementClient;\n+\n+    @Test\n+    public void testHealthEndpoint() throws Exception {\n+        testHealthEndpoint(\"/health\");\n+    }\n+\n+    @Test\n+    public void testHealthLiveEndpoint() throws Exception {\n+        testHealthEndpoint(\"/health/live\");\n+    }\n+\n+    @Test\n+    public void testHealthReadyEndpoint() throws Exception {\n+        testHealthEndpoint(\"/health/ready\");\n+    }\n+\n+    private void testHealthEndpoint(String requestPath) throws IOException {\n+        final String healthURL = \"http://\" + managementClient.getMgmtAddress() + \":\" + managementClient.getMgmtPort() + requestPath;\n+        System.out.println(\"healthURL = \" + healthURL);\n+        try (CloseableHttpClient client = HttpClientBuilder.create().build()) {\n+            CloseableHttpResponse resp = client.execute(new HttpGet(healthURL));\n+            String content = EntityUtils.toString(resp.getEntity());\n+            System.out.println(\"content = \" + content);\n+            System.out.println(resp.getStatusLine().getStatusCode());\n+            assertEquals(200, resp.getStatusLine().getStatusCode());", "originalCommit": "5aaafbd589fb35e613b158efb90d9ae5593a6c07", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgxNjk1NA==", "url": "https://github.com/wildfly/wildfly/pull/13765#discussion_r539816954", "bodyText": "Emmanuel's PR includes a JIRA number so if you add that you will avoid conflicts.", "author": "bstansberry", "createdAt": "2020-12-10T03:26:55Z", "path": "testsuite/integration/basic/src/test/java/org/wildfly/test/integration/microprofile/opentracing/OnOffOpenTracingTestCase.java", "diffHunk": "@@ -59,6 +60,7 @@\n  *\n  * @author Jan Stourac <jstourac@redhat.com>\n  */\n+@Ignore", "originalCommit": "5aaafbd589fb35e613b158efb90d9ae5593a6c07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk4MTYwNw==", "url": "https://github.com/wildfly/wildfly/pull/13765#discussion_r539981607", "bodyText": "thanks, I've amended the commit in the #13756 branch too.", "author": "jmesnil", "createdAt": "2020-12-10T08:48:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTgxNjk1NA=="}], "type": "inlineReview"}, {"oid": "a7bbe0c2ae25f944dac76b333ece625fb83d4774", "url": "https://github.com/wildfly/wildfly/commit/a7bbe0c2ae25f944dac76b333ece625fb83d4774", "message": "[WFLY-14151] Move microprofile-health extension to the microprofile\nfeature pack\n\nAdd new health subsystem that provide base features to query the\napplication server healthiness using /health HTTP endpoints on the\nmanagement interface.\n\nWhen installed, the microprofile-health-smallrye subsystem will \"take\nover\" this /health HTTP endpoints and provide MicroProfile Health\nfeatures for it (including probes from application deployments).\n\nJIRA: https://issues.redhat.com/browse/WFLY-14151\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T08:35:28Z", "type": "forcePushed"}, {"oid": "76d366ced400778be1187ec27c0a64d8018ec6ec", "url": "https://github.com/wildfly/wildfly/commit/76d366ced400778be1187ec27c0a64d8018ec6ec", "message": "[WFLY-14151] Move microprofile-health extension to the microprofile\nfeature pack\n\nAdd new health subsystem that provide base features to query the\napplication server healthiness using /health HTTP endpoints on the\nmanagement interface.\n\nWhen installed, the microprofile-health-smallrye subsystem will \"take\nover\" this /health HTTP endpoints and provide MicroProfile Health\nfeatures for it (including probes from application deployments).\n\nJIRA: https://issues.redhat.com/browse/WFLY-14151\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T08:45:30Z", "type": "forcePushed"}, {"oid": "3195a5f7253465f33a804f6844fab511cd9d9ed2", "url": "https://github.com/wildfly/wildfly/commit/3195a5f7253465f33a804f6844fab511cd9d9ed2", "message": "[WFLY-14108] move microprofile-metrics extension to the full feature-pack\n\nby providing it through the wildfly-mp-feature-pack-galleon-common\nGalleon feature-pack.\n\nJIRA: https://issues.redhat.com/browse/WFLY-14108\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T11:38:34Z", "type": "commit"}, {"oid": "0d8b07f40eacada6760b08aebfcde881ddcdeee1", "url": "https://github.com/wildfly/wildfly/commit/0d8b07f40eacada6760b08aebfcde881ddcdeee1", "message": "[WFLY-14108] move microprofile-metrics extension to the full feature-pack\n\nAdd a `metrics` subsystem that provides base observability features\nfor the ee-feature-pack.\n\nThis subsystem will is responsible for the /metrics HTTP endpoint on the\nmanagement interface. When the `microprofile-metrics-smallrye` subsystem\nis installed, it will \"take over\" this HTTP endpoint to provide the\nMicroProfile Metrics feature on it.\n\nThis base `metrics` subsystems exposes metrics for the WildFly\nmanagement model (subsystem and deployment subtrees) as well as metrics\nfrom the JVM (using JMX to read them).\n\nJIRA: https://issues.redhat.com/browse/WFLY-14108", "committedDate": "2020-12-10T11:38:48Z", "type": "commit"}, {"oid": "70e1d012b02246530c99ae64f873885742ab8be0", "url": "https://github.com/wildfly/wildfly/commit/70e1d012b02246530c99ae64f873885742ab8be0", "message": "[WFLY-14134] Ignore OnOffOpenTracingTestCase\n\nJIRA: https://issues.redhat.com/browse/WFLY-14134\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T11:38:48Z", "type": "commit"}, {"oid": "5d07fbb12345e3ab73efdea122f2d2c6aff95645", "url": "https://github.com/wildfly/wildfly/commit/5d07fbb12345e3ab73efdea122f2d2c6aff95645", "message": "[WFLY-14151] Move microprofile-health extension to the microprofile feature pack\n\nThis extension is no longer provided by the ee feature pack.\n\nJIRA: https://issues.redhat.com/browse/WFLY-14151\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T11:40:27Z", "type": "commit"}, {"oid": "e25e406704d80909dee57acf77ac8b27f2146487", "url": "https://github.com/wildfly/wildfly/commit/e25e406704d80909dee57acf77ac8b27f2146487", "message": "[WFLY-14151] Move microprofile-health extension to the microprofile\nfeature pack\n\nAdd new health subsystem that provide base features to query the\napplication server healthiness using /health HTTP endpoints on the\nmanagement interface.\n\nWhen installed, the microprofile-health-smallrye subsystem will \"take\nover\" this /health HTTP endpoints and provide MicroProfile Health\nfeatures for it (including probes from application deployments).\n\nJIRA: https://issues.redhat.com/browse/WFLY-14151\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T11:40:27Z", "type": "commit"}, {"oid": "e25e406704d80909dee57acf77ac8b27f2146487", "url": "https://github.com/wildfly/wildfly/commit/e25e406704d80909dee57acf77ac8b27f2146487", "message": "[WFLY-14151] Move microprofile-health extension to the microprofile\nfeature pack\n\nAdd new health subsystem that provide base features to query the\napplication server healthiness using /health HTTP endpoints on the\nmanagement interface.\n\nWhen installed, the microprofile-health-smallrye subsystem will \"take\nover\" this /health HTTP endpoints and provide MicroProfile Health\nfeatures for it (including probes from application deployments).\n\nJIRA: https://issues.redhat.com/browse/WFLY-14151\n\nSigned-off-by: Jeff Mesnil <jmesnil@redhat.com>", "committedDate": "2020-12-10T11:40:27Z", "type": "forcePushed"}]}