{"pr_number": 13510, "pr_title": "[WFLY-13806] Add subsystem parsing of persistence.xml documents in th\u2026", "pr_createdAt": "2020-08-27T21:35:04Z", "pr_url": "https://github.com/wildfly/wildfly/pull/13510", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcxMjkyMw==", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r478712923", "bodyText": "Thanks for adding this cool test, great idea!", "author": "scottmarlow", "createdAt": "2020-08-27T21:44:18Z", "path": "jpa/subsystem/src/test/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParserTestCase.java", "diffHunk": "@@ -59,4 +64,57 @@ public void testVersion() throws Exception {\n         String version = metadata.getPersistenceXMLSchemaVersion();\n         assertEquals(\"1.0\", version);\n     }\n+\n+    @Test", "originalCommit": "c548c0c35ab9773cf75cdcfc9406ddf6efa468ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3MzU5Nw==", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r479273597", "bodyText": "Good question, for EE 8 I would like to default to the equivalent Jakarta (EE 8) Persistence 2.2 (http://xmlns.jcp.org/xml/ns/persistence/persistence_2_2.xsd) as parsePU() is doing.\nFor EE 9, I would like to default to 3.0 as you did below for parsePU().", "author": "scottmarlow", "createdAt": "2020-08-28T13:11:29Z", "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "diffHunk": "@@ -94,8 +94,10 @@ public static PersistenceUnitMetadataHolder parse(final XMLStreamReader reader,\n                 version = Version.JPA_2_2;\n             } else if (\"2\".equals(versionString)) {\n                 version = Version.JPA_2_0;\n+            } else if (\"3.0\".equals(versionString)) {\n+                version = Version.JPA_3_0;\n             } else {\n-                version = Version.JPA_2_1;\n+                version = Version.JPA_2_1; // TODO is this still the right default?", "originalCommit": "c548c0c35ab9773cf75cdcfc9406ddf6efa468ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU3NzM0Mw==", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r479577343", "bodyText": "@scottmarlow I added a static initializer to see if an EE 9 api class is available and determine the default based on that.\nAs part of doing that I also centralized the lookup logic and the version # strings a bit.", "author": "bstansberry", "createdAt": "2020-08-28T23:50:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3MzU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQzNjEzOA==", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r480436138", "bodyText": "@scottmarlow Does the change I describe ^^^ look good?", "author": "bstansberry", "createdAt": "2020-08-31T22:30:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTI3MzU5Nw=="}], "type": "inlineReview"}, {"oid": "0e2e3c1fbad6b325e8494f763daa910f9027c15f", "url": "https://github.com/wildfly/wildfly/commit/0e2e3c1fbad6b325e8494f763daa910f9027c15f", "message": "[WFLY-13806] Add subsystem parsing of persistence.xml documents in the EE 9 namespace", "committedDate": "2020-08-28T23:47:01Z", "type": "commit"}, {"oid": "0e2e3c1fbad6b325e8494f763daa910f9027c15f", "url": "https://github.com/wildfly/wildfly/commit/0e2e3c1fbad6b325e8494f763daa910f9027c15f", "message": "[WFLY-13806] Add subsystem parsing of persistence.xml documents in the EE 9 namespace", "committedDate": "2020-08-28T23:47:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQxOTg5Ng==", "url": "https://github.com/wildfly/wildfly/pull/13510#discussion_r510419896", "bodyText": "Cool idea to detect the default as Jakarta EE 8 Persistence 2.2 versus EE 9 Persistence 3.0!", "author": "scottmarlow", "createdAt": "2020-10-22T19:56:24Z", "path": "jpa/subsystem/src/main/java/org/jboss/as/jpa/puparser/PersistenceUnitXmlParser.java", "diffHunk": "@@ -49,6 +49,19 @@\n public class PersistenceUnitXmlParser extends MetaDataElementParser {\n     // cache the trace enabled flag\n     private static final boolean traceEnabled = ROOT_LOGGER.isTraceEnabled();\n+    private static final Version DEFAULT_VERSION;\n+\n+    static {\n+        Version defaultVersion;\n+        try {\n+            // Try and load a jakarta namespace JPA API class to see if we're EE 8 or a later EE\n+            PersistenceUnitXmlParser.class.getClassLoader().loadClass(\"jakarta.persistence.SharedCacheMode\");", "originalCommit": "0e2e3c1fbad6b325e8494f763daa910f9027c15f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}