{"pr_number": 12883, "pr_title": "[WFLY-12473] Add instance id obfuscation in Undertow session route", "pr_createdAt": "2020-01-07T01:23:54Z", "pr_url": "https://github.com/wildfly/wildfly/pull/12883", "timeline": [{"oid": "2641232a87eccdbe5921654e8433f0f798b7b49a", "url": "https://github.com/wildfly/wildfly/commit/2641232a87eccdbe5921654e8433f0f798b7b49a", "message": "[WFLY-12473] Add Undertow subsystem uuid-instance-id attribute, update tests and documentation", "committedDate": "2020-01-07T01:25:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI1Nzg2NA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r411257864", "bodyText": "@fl4via looking at default standalone-ha.xml shipped e.g. with EAP 7.3 I see that element application-security-domains is not defined by default; in all the files undertow-service-*.xml used in the tests that element is always defined: would it make sense to add one more tests with no application-security-domains?", "author": "tommaso-borgato", "createdAt": "2020-04-20T10:11:21Z", "path": "undertow/src/test/java/org/wildfly/extension/undertow/UndertowServiceTestCase.java", "diffHunk": "@@ -0,0 +1,140 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2019, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package org.wildfly.extension.undertow;\n+\n+import java.io.IOException;\n+import java.util.UUID;\n+\n+import org.jboss.as.subsystem.test.KernelServices;\n+import org.jboss.as.subsystem.test.KernelServicesBuilder;\n+import org.jboss.msc.service.ServiceController;\n+import org.jboss.msc.service.ServiceName;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Test for UndertowService created from xml file.\n+ *\n+ * @author Flavia Rainone\n+ */\n+public class UndertowServiceTestCase extends AbstractUndertowSubsystemTestCase {\n+\n+    private static final String NODE_NAME = \"node-name\";\n+    private static final String DEFAULT_SERVER = \"default-server\";\n+    private static final String DEFAULT_SERVLET_CONTAINER = \"default\";\n+    private static final String DEFAULT_VIRTUAL_HOST = \"default-host\";\n+\n+    @Override\n+    protected String getSubsystemXml() throws IOException {\n+        return readResource(\"undertow-11.0.xml\");\n+    }\n+\n+    @Override\n+    protected String getSubsystemXsdPath() throws Exception {\n+        return \"schema/wildfly-undertow_11_0.xsd\";\n+    }\n+\n+    @Override\n+    protected String[] getSubsystemTemplatePaths() {\n+        return new String[] { \"/subsystem-templates/undertow.xml\" };\n+    }\n+\n+    @Before\n+    public void setUp() {\n+        setProperty();\n+        System.setProperty(\"jboss.node.name\", NODE_NAME);\n+    }\n+\n+    private UndertowService load(String xmlFile) throws Exception {\n+        KernelServicesBuilder builder = createKernelServicesBuilder(RUNTIME).setSubsystemXml(readResource(xmlFile));\n+        KernelServices mainServices = builder.build();\n+        if (!mainServices.isSuccessfulBoot()) {\n+            Throwable t = mainServices.getBootError();\n+            Assert.fail(\"Boot unsuccessful: \" + (t != null ? t.toString() : \"no boot error provided\"));\n+        }\n+        final ServiceName undertowServiceName = UndertowRootDefinition.UNDERTOW_CAPABILITY.getCapabilityServiceName();\n+        ServiceController<UndertowService> undertowServiceService = (ServiceController<UndertowService>) mainServices.getContainer().getService(undertowServiceName);\n+        assertNotNull(undertowServiceService);\n+        undertowServiceService.setMode(ServiceController.Mode.ACTIVE);\n+        final UndertowService undertowService = undertowServiceService.getValue();\n+        assertNotNull(undertowService);\n+        return undertowService;\n+    }\n+\n+    @Test\n+    public void testUndefinedAttributes() throws Exception {\n+        final UndertowService undertowService = load(\"undertow-service-undefined-attributes.xml\");\n+        assertEquals(NODE_NAME, undertowService.getInstanceId());\n+        assertFalse(undertowService.isStatisticsEnabled());\n+        assertEquals(DEFAULT_SERVER, undertowService.getDefaultServer());\n+        assertEquals(DEFAULT_SERVLET_CONTAINER, undertowService.getDefaultContainer());\n+        assertEquals(DEFAULT_VIRTUAL_HOST, undertowService.getDefaultVirtualHost());\n+    }\n+\n+    @Test\n+    public void testDefinedDefaultAttributes1() throws Exception {\n+        final UndertowService undertowService = load(\"undertow-service-defined-default-attributes1.xml\");\n+        assertEquals(NODE_NAME, undertowService.getInstanceId());\n+        assertFalse(undertowService.isStatisticsEnabled());\n+        assertEquals(DEFAULT_SERVER, undertowService.getDefaultServer());\n+        assertEquals(DEFAULT_SERVLET_CONTAINER, undertowService.getDefaultContainer());\n+        assertEquals(DEFAULT_VIRTUAL_HOST, undertowService.getDefaultVirtualHost());\n+    }\n+\n+    @Test\n+    public void testDefinedDefaultAttributes2() throws Exception {\n+        final UndertowService undertowService = load(\"undertow-service-defined-default-attributes2.xml\");\n+        assertEquals(NODE_NAME, undertowService.getInstanceId());\n+        assertFalse(undertowService.isStatisticsEnabled());\n+        assertEquals(DEFAULT_SERVER, undertowService.getDefaultServer());\n+        assertEquals(DEFAULT_SERVLET_CONTAINER, undertowService.getDefaultContainer());\n+        assertEquals(DEFAULT_VIRTUAL_HOST, undertowService.getDefaultVirtualHost());\n+    }\n+\n+    @Test\n+    public void testDefinedAttributes() throws Exception {\n+        final UndertowService undertowService = load(\"undertow-service-defined-attributes.xml\");\n+        assertEquals(NODE_NAME + \"-undertow\", undertowService.getInstanceId());\n+        assertTrue(undertowService.isStatisticsEnabled());\n+        assertEquals(\"undertow-server\", undertowService.getDefaultServer());\n+        assertEquals(\"servlet-container\", undertowService.getDefaultContainer());\n+        assertEquals(\"virtual-host\", undertowService.getDefaultVirtualHost());\n+    }\n+\n+    @Test\n+    public void testUuidInstanceId() throws Exception {\n+        final UndertowService undertowService = load(\"undertow-service-uuid-instance-id-attribute.xml\");\n+        assertNotNull(UUID.fromString(undertowService.getInstanceId()));\n+        assertFalse(undertowService.isStatisticsEnabled());\n+        assertEquals(\"undertow-server\", undertowService.getDefaultServer());\n+        assertEquals(DEFAULT_SERVLET_CONTAINER, undertowService.getDefaultContainer());\n+        assertEquals(\"virtual-host3\", undertowService.getDefaultVirtualHost());\n+    }", "originalCommit": "2641232a87eccdbe5921654e8433f0f798b7b49a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM3ODAyOQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r426378029", "bodyText": "certainly, @tommaso-borgato , I'll make that change", "author": "fl4via", "createdAt": "2020-05-18T05:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI1Nzg2NA=="}], "type": "inlineReview"}, {"oid": "43ae3ad76a512b6b0064f44756a83079845dcc26", "url": "https://github.com/wildfly/wildfly/commit/43ae3ad76a512b6b0064f44756a83079845dcc26", "message": "[WFLY-12473] Add Undertow subsystem uuid-instance-id attribute, update tests and documentation", "committedDate": "2020-05-19T21:25:36Z", "type": "forcePushed"}, {"oid": "e3bea7e69e83f681a63feb599de640c132509641", "url": "https://github.com/wildfly/wildfly/commit/e3bea7e69e83f681a63feb599de640c132509641", "message": "[WFLY-12473] Add Undertow subsystem uuid-instance-id attribute, update tests and documentation", "committedDate": "2020-05-20T20:19:42Z", "type": "forcePushed"}, {"oid": "d4fc4048d2f609b126942dcf4b3a9a7f440cc8e2", "url": "https://github.com/wildfly/wildfly/commit/d4fc4048d2f609b126942dcf4b3a9a7f440cc8e2", "message": "[WFLY-12473] Add Undertow subsystem uuid-instance-id attribute, update tests and documentation", "committedDate": "2020-09-13T07:27:40Z", "type": "forcePushed"}, {"oid": "f691bdd35b4e278bb1785d7025c5baa590b0096f", "url": "https://github.com/wildfly/wildfly/commit/f691bdd35b4e278bb1785d7025c5baa590b0096f", "message": "[WFLY-12473] Add Undertow subsystem uuid-instance-id attribute, update tests and documentation", "committedDate": "2020-09-13T07:37:26Z", "type": "forcePushed"}, {"oid": "d0da3391554c002bcc18840e1898ad2b5a5a257d", "url": "https://github.com/wildfly/wildfly/commit/d0da3391554c002bcc18840e1898ad2b5a5a257d", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is defined from first attribute", "committedDate": "2020-09-13T08:16:56Z", "type": "forcePushed"}, {"oid": "f07ce4be0da444d2ea23e33c4dd3a90272268484", "url": "https://github.com/wildfly/wildfly/commit/f07ce4be0da444d2ea23e33c4dd3a90272268484", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is defined from first attribute", "committedDate": "2020-09-13T08:20:31Z", "type": "forcePushed"}, {"oid": "799f2113517a2b849e71fb4889ef0b6b20a3f561", "url": "https://github.com/wildfly/wildfly/commit/799f2113517a2b849e71fb4889ef0b6b20a3f561", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is generated from first attribute", "committedDate": "2020-09-13T08:24:05Z", "type": "forcePushed"}, {"oid": "0ecd31c7164855184cbf3539264c6107a8b5b34b", "url": "https://github.com/wildfly/wildfly/commit/0ecd31c7164855184cbf3539264c6107a8b5b34b", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is generated from first attribute", "committedDate": "2020-09-13T08:41:19Z", "type": "forcePushed"}, {"oid": "8079513af644f669f583caad74b59bdf76b12649", "url": "https://github.com/wildfly/wildfly/commit/8079513af644f669f583caad74b59bdf76b12649", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is generated from first attribute", "committedDate": "2020-09-13T08:44:18Z", "type": "forcePushed"}, {"oid": "091f459bd957451f929ecd648310b25c8211749a", "url": "https://github.com/wildfly/wildfly/commit/091f459bd957451f929ecd648310b25c8211749a", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is generated from first attribute", "committedDate": "2020-09-13T08:48:02Z", "type": "forcePushed"}, {"oid": "24a32a28707af7ea6c68e5b4eb2385dc570b497b", "url": "https://github.com/wildfly/wildfly/commit/24a32a28707af7ea6c68e5b4eb2385dc570b497b", "message": "[WFLY-12473] Proposed change: allow both instance-id and uuid-instance-id, whereas second attribute is generated from first attribute", "committedDate": "2020-09-13T08:51:48Z", "type": "forcePushed"}, {"oid": "1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "url": "https://github.com/wildfly/wildfly/commit/1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "message": "[WFLY-12473] Add Undertow subsystem uuid-instance-id attribute, update tests and documentation", "committedDate": "2020-09-13T08:51:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM1OTE2NQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r489359165", "bodyText": "IMO, this attribute name is no longer sufficiently descriptive, since, when enabled, the generated instance-id has nothing to do with a UUID.\nPerhaps \"obfuscate-instance-id\"?", "author": "pferraro", "createdAt": "2020-09-16T11:18:50Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/Constants.java", "diffHunk": "@@ -46,6 +46,7 @@\n     String HTTP_INVOKER = \"http-invoker\";\n     String LISTENER = \"listener\";\n     String INSTANCE_ID = \"instance-id\";\n+    String UUID_INSTANCE_ID = \"uuid-instance-id\";", "originalCommit": "1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MzQ4OA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r489363488", "bodyText": "I think we want to use DiscardAttributeChecker.UNDEFINED here (and for other version transformations), since a value of true should result in rejection.", "author": "pferraro", "createdAt": "2020-09-16T11:27:25Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/UndertowTransformers.java", "diffHunk": "@@ -118,13 +120,22 @@ private static void registerTransformersWildFly18(ResourceTransformationDescript\n     }\n \n     private static void registerTransformersWildFly16(ResourceTransformationDescriptionBuilder subsystemBuilder) {\n+        subsystemBuilder.getAttributeBuilder()\n+                .addRejectCheck(RejectAttributeChecker.DEFINED, UUID_INSTANCE_ID)\n+                .setDiscard(DiscardAttributeChecker.ALWAYS, UUID_INSTANCE_ID)", "originalCommit": "1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTMwMTM5Ng==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491301396", "bodyText": "I assumed that those checkers were applied in sequence, i.e., fist if attribute is defined, it would be rejected. If not, apply next on the list: discard always, which would imply discard undefined. I'm updating the PR with DiscardAttributeChecker.UNDEFINED", "author": "fl4via", "createdAt": "2020-09-19T07:01:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MzQ4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTYwMTQ1Mg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491601452", "bodyText": "This broke transformation tests, I see errors such as the one below:\n[ERROR]   UndertowTransformersTestCase.testTransformersEAP_7_1_0:72->testTransformers:284->testTransformers:302->AbstractSubsystemTest.checkSubsystemModelTransformation:206->AbstractSubsystemTest.checkSubsystemModelTransformation:220 : { expected:<...-host, instance-id, []server, servlet-cont...> but was:<...-host, instance-id, [obfuscate-instance-id, ]server, servlet-cont...>\nFor that reason, I'm reverting this change, @pferraro", "author": "fl4via", "createdAt": "2020-09-19T23:25:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM2MzQ4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTM3MTA0OQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r489371049", "bodyText": "IMO, this logic actually belongs in org.wildfly.extension.undertow.Server#getRoute().\nThe getRoute() method should obfuscate the entire route (which may also include the server name) when the obfuscation flag is enabled.", "author": "pferraro", "createdAt": "2020-09-16T11:41:48Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/UndertowSubsystemAdd.java", "diffHunk": "@@ -102,8 +105,9 @@ protected void performBoottime(OperationContext context, ModelNode operation, Re\n         final String defaultSecurityDomain = UndertowRootDefinition.DEFAULT_SECURITY_DOMAIN.resolveModelAttribute(context, model).asString();\n \n         final ModelNode instanceIdModel = UndertowRootDefinition.INSTANCE_ID.resolveModelAttribute(context, model);\n-        final String instanceId = instanceIdModel.isDefined() ? instanceIdModel.asString() : null;\n-\n+        final ModelNode uuidInstanceIdModel = UndertowRootDefinition.UUID_INSTANCE_ID.resolveModelAttribute(context, model);\n+        final String instanceId = instanceIdModel.isDefined() ? (uuidInstanceIdModel.asBoolean() ?", "originalCommit": "1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5NzY1Mg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r489697652", "bodyText": "These 2 instances are not incompatible, thus should not utilize setAlternatives(...).", "author": "pferraro", "createdAt": "2020-09-16T19:20:02Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/UndertowRootDefinition.java", "diffHunk": "@@ -87,6 +87,14 @@\n                     .setRestartAllServices()\n                     .setAllowExpression(true)\n                     .setDefaultValue(new ModelNode().set(new ValueExpression(\"${jboss.node.name}\")))\n+                    .setAlternatives(Constants.UUID_INSTANCE_ID)\n+                    .build();\n+    protected static final SimpleAttributeDefinition UUID_INSTANCE_ID =\n+            new SimpleAttributeDefinitionBuilder(Constants.UUID_INSTANCE_ID, ModelType.BOOLEAN, true)\n+                    .setRestartAllServices()\n+                    .setAllowExpression(true)\n+                    .setDefaultValue(ModelNode.FALSE)\n+                    .setAlternatives(Constants.INSTANCE_ID)", "originalCommit": "1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUzMTc2OA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490531768", "bodyText": "pferraro it came as a request from the feature team because they did not want to have this changed this late at the game. However, as I pointed, now that we're renaming, it makes less and less sense to forbid instance-id definition when obfuscated-instance-id is used.", "author": "fl4via", "createdAt": "2020-09-17T20:08:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTY5NzY1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490015062", "bodyText": "This just generates a base64 encoded string from the instanceIdModel value. A base64 encoded string can be easily decoded to the original value (= hostname by default). For example, the original value can be decode by the following command:\n$ echo -n <generate-encoded-value> | base64 -d\n\nSo, as this approach can not hide the actual hostname information, I think this is not what the customer wants.\nI would suggest generating a base64 encoded string from an MD5 hash digest of the instanceIdModel value. Java's name-based UUID (UUID.nameUUIDFromBytes()) is internally generated from the MD5 hash digest of the input value. So, I think this approach is the same level of uniqueness to UUID.nameUUIDFromBytes().\nAlso, Base64.Encoder generates an encoded string with padding (= by default). However, = is not allowed in V0 Cookie. So, I think it's better to use Base64.getUrlEncoder().withoutPadding() instead.\nFor example:\n        final String instanceId = instanceIdModel.isDefined() ?\n            (uuidInstanceIdModel.asBoolean() ? generateObfuscatedInstanceId(instanceIdModel.asString()) : instanceIdModel.asString()): null;\n\n    ...(snip)...\n\n    private String generateObfuscatedInstanceId(String instanceId) {\n        try {\n            MessageDigest md = MessageDigest.getInstance(\"MD5\");\n            byte[] md5Bytes = md.digest(instanceId.getBytes());\n            Base64.Encoder encoder = Base64.getUrlEncoder().withoutPadding(); // = is not allowed in V0 Cookie\n            String encodedString = encoder.encodeToString(md5Bytes);\n            UndertowLogger.ROOT_LOGGER.infof(\"Obfuscated value [%s] is generated from [%s] and will be used as instance-id (jvmRoute)\", encodedString, instanceId);\n            return encodedString;\n        } catch (NoSuchAlgorithmException e) {\n            throw new IllegalArgumentException(e);\n        }\n    }", "author": "msfm", "createdAt": "2020-09-17T07:01:55Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/UndertowSubsystemAdd.java", "diffHunk": "@@ -102,8 +105,9 @@ protected void performBoottime(OperationContext context, ModelNode operation, Re\n         final String defaultSecurityDomain = UndertowRootDefinition.DEFAULT_SECURITY_DOMAIN.resolveModelAttribute(context, model).asString();\n \n         final ModelNode instanceIdModel = UndertowRootDefinition.INSTANCE_ID.resolveModelAttribute(context, model);\n-        final String instanceId = instanceIdModel.isDefined() ? instanceIdModel.asString() : null;\n-\n+        final ModelNode uuidInstanceIdModel = UndertowRootDefinition.UUID_INSTANCE_ID.resolveModelAttribute(context, model);\n+        final String instanceId = instanceIdModel.isDefined() ? (uuidInstanceIdModel.asBoolean() ?\n+                new String(Base64.getUrlEncoder().encode(instanceIdModel.asBytes())) : instanceIdModel.asString()) : null;", "originalCommit": "1a92ed42b1f71c646cadd4c4d0f06c19eb876cbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxOTY1NA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490019654", "bodyText": "This may take the problem full circle but are they concerned about these values being mapped to known host names?  If so maybe some additional secret data is needed in the hash to prevent comparison against known host names.", "author": "darranl", "createdAt": "2020-09-17T07:11:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUzMjc4Mw==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490532783", "bodyText": "@darranl  thanks for your feedback. I'll ask if that's a concern or not. is that something complex to do, or something super simple? The question here is, if the additional secret data is interesting to the user, should it be a follow up RFE or should we add it to this RFE? Please let me know what you think about this.", "author": "fl4via", "createdAt": "2020-09-17T20:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU4MjUxNw==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490582517", "bodyText": "@darranl is referring to a salt.  I think it is sufficient to use the Undertow server name as the salt, as the route identifier (which is the value we are actually interested in) is generated per Undertow server.  This is sufficient to prevent comparison against known host names.", "author": "pferraro", "createdAt": "2020-09-17T21:51:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDc2MTUxMQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490761511", "bodyText": "+1 provided that server name is not shared publicly it should be sufficient in this case.\nWhere only public information goes into a hash it is very easy for someone to create their own reference tables in a kind of reverse lookup.  Once some non public information is added it becomes a lot more complex.\nThe piece I am not familiar with here is the full use of these fields in case my suggestion made it much more complex where we need to be able to map back.", "author": "darranl", "createdAt": "2020-09-18T07:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg5MzUzNg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490893536", "bodyText": "The name of an Undertow server resource is effectively arbitrary, and has no intrinsic meaning outside of the subsystem model - hence my suggestion to use it as a salt (since the name of an Undertow server resource is unique per server).\nBoth the instance-id and the names of Undertow servers stored as clear text in the model, so there should be no need/reason to map back.", "author": "pferraro", "createdAt": "2020-09-18T11:44:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDg5NTA0MQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r490895041", "bodyText": "@pferraro that does sound like enough then.\nIf anyone wanted more than that we would likely need to be looking at stronger approaches, possibly with keys etc...", "author": "darranl", "createdAt": "2020-09-18T11:48:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTA2Mg=="}], "type": "inlineReview"}, {"oid": "a50580209d83a690fc113f98f3e62aa015724a28", "url": "https://github.com/wildfly/wildfly/commit/a50580209d83a690fc113f98f3e62aa015724a28", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T06:41:23Z", "type": "forcePushed"}, {"oid": "43d8d7987e017c5b6881ab756ab332b64bd3d2f9", "url": "https://github.com/wildfly/wildfly/commit/43d8d7987e017c5b6881ab756ab332b64bd3d2f9", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T06:55:25Z", "type": "forcePushed"}, {"oid": "3bd6159367c65617a1ab3393ad101344766dba36", "url": "https://github.com/wildfly/wildfly/commit/3bd6159367c65617a1ab3393ad101344766dba36", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T06:56:42Z", "type": "forcePushed"}, {"oid": "179a2fb8b3a2d32503af1663f1bc04db6b902d56", "url": "https://github.com/wildfly/wildfly/commit/179a2fb8b3a2d32503af1663f1bc04db6b902d56", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T07:03:03Z", "type": "forcePushed"}, {"oid": "d0fc14c695564c9e1fc7f0f50e272bbf36981ca5", "url": "https://github.com/wildfly/wildfly/commit/d0fc14c695564c9e1fc7f0f50e272bbf36981ca5", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T07:04:54Z", "type": "forcePushed"}, {"oid": "be713d880ed0fb3fec8d58ddf36a1c8d033e11f5", "url": "https://github.com/wildfly/wildfly/commit/be713d880ed0fb3fec8d58ddf36a1c8d033e11f5", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T07:11:32Z", "type": "forcePushed"}, {"oid": "e4196217f7b270afdbde041e2d4502b833d7f8a5", "url": "https://github.com/wildfly/wildfly/commit/e4196217f7b270afdbde041e2d4502b833d7f8a5", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T07:15:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MDk1Mg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491480952", "bodyText": "We can skip this logic when service.isObfuscateInstanceId() is true.", "author": "pferraro", "createdAt": "2020-09-19T18:31:24Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/Server.java", "diffHunk": "@@ -169,9 +172,24 @@ public String getDefaultHost() {\n     }\n \n     public String getRoute() {\n-        UndertowService service = this.undertowService.getValue();\n-        String defaultServerRoute = service.getInstanceId();\n-        return this.name.equals(service.getDefaultServer()) ? defaultServerRoute : String.join(\"-\", defaultServerRoute, this.name);\n+        final UndertowService service = this.undertowService.getValue();\n+        final String defaultServerRoute = service.getInstanceId();\n+        final String route = this.name.equals(service.getDefaultServer()) ? defaultServerRoute : String.join(\"-\", defaultServerRoute, this.name);", "originalCommit": "e4196217f7b270afdbde041e2d4502b833d7f8a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTYwMzQwNA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491603404", "bodyText": "ok, noted", "author": "fl4via", "createdAt": "2020-09-19T23:29:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MDk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MjE0NQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491482145", "bodyText": "A couple of comments:\n\nWhy include the server name twice in the hash?  Given that we've already salted the hash using the server name, we can just use:\n\nmd.digest(service.getInstanceId().getBytes(StandardCharsets.UTF-8));\n\nGiven that we don't know the default character encoding of a given host, it's probably best to keep this consistent across all hosts, e.g.\n\nString encodedRoute = new String(encoder.encode(...), StandardCharsets.UTF-8);", "author": "pferraro", "createdAt": "2020-09-19T18:45:46Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/Server.java", "diffHunk": "@@ -169,9 +172,24 @@ public String getDefaultHost() {\n     }\n \n     public String getRoute() {\n-        UndertowService service = this.undertowService.getValue();\n-        String defaultServerRoute = service.getInstanceId();\n-        return this.name.equals(service.getDefaultServer()) ? defaultServerRoute : String.join(\"-\", defaultServerRoute, this.name);\n+        final UndertowService service = this.undertowService.getValue();\n+        final String defaultServerRoute = service.getInstanceId();\n+        final String route = this.name.equals(service.getDefaultServer()) ? defaultServerRoute : String.join(\"-\", defaultServerRoute, this.name);\n+        if (service.isObfuscateInstanceId()) {\n+            try {\n+                final MessageDigest md = MessageDigest.getInstance(\"MD5\");\n+                // salt\n+                md.update(this.name.getBytes());\n+                // encode\n+                final Base64.Encoder encoder = Base64.getUrlEncoder().withoutPadding(); // = is not allowed in V0 Cookie\n+                final String encodedRoute = encoder.encodeToString(md.digest(route.getBytes()));", "originalCommit": "e4196217f7b270afdbde041e2d4502b833d7f8a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTYwMzYzOQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491603639", "bodyText": "@pferraro  good catch, I'll update the PR", "author": "fl4via", "createdAt": "2020-09-19T23:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MjE0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MzMxNw==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491483317", "bodyText": "Oops - my previous comment was incomplete. :(\nWe also want to discard if the attribute is defined, but set to the default value. i.e.\n.setDiscard(DiscardAttributeChecker.DEFAULT_VALUE, OBFUSCATE_INSTANCE_ID);\nSame for other versions.", "author": "pferraro", "createdAt": "2020-09-19T19:00:28Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/UndertowTransformers.java", "diffHunk": "@@ -118,13 +120,22 @@ private static void registerTransformersWildFly18(ResourceTransformationDescript\n     }\n \n     private static void registerTransformersWildFly16(ResourceTransformationDescriptionBuilder subsystemBuilder) {\n+        subsystemBuilder.getAttributeBuilder()\n+                .addRejectCheck(RejectAttributeChecker.DEFINED,OBFUSCATE_INSTANCE_ID)\n+                .setDiscard(DiscardAttributeChecker.UNDEFINED, OBFUSCATE_INSTANCE_ID)", "originalCommit": "e4196217f7b270afdbde041e2d4502b833d7f8a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTYwNDEyOQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491604129", "bodyText": "@pferraro  Oh, I see. Please disregard my other comment about reverting the PR because of the test failure. I'll add the discard instead :-)", "author": "fl4via", "createdAt": "2020-09-19T23:30:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MzMxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MzUzOA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491483538", "bodyText": "Given that we don't know the default character encoding of a given host, it's probably best to keep this consistent across all hosts, e.g.\nmd.update(this.name.getBytes(StandardCharsets.UTF-8));", "author": "pferraro", "createdAt": "2020-09-19T19:03:29Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/Server.java", "diffHunk": "@@ -169,9 +172,24 @@ public String getDefaultHost() {\n     }\n \n     public String getRoute() {\n-        UndertowService service = this.undertowService.getValue();\n-        String defaultServerRoute = service.getInstanceId();\n-        return this.name.equals(service.getDefaultServer()) ? defaultServerRoute : String.join(\"-\", defaultServerRoute, this.name);\n+        final UndertowService service = this.undertowService.getValue();\n+        final String defaultServerRoute = service.getInstanceId();\n+        final String route = this.name.equals(service.getDefaultServer()) ? defaultServerRoute : String.join(\"-\", defaultServerRoute, this.name);\n+        if (service.isObfuscateInstanceId()) {\n+            try {\n+                final MessageDigest md = MessageDigest.getInstance(\"MD5\");\n+                // salt\n+                md.update(this.name.getBytes());", "originalCommit": "e4196217f7b270afdbde041e2d4502b833d7f8a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTYwNDIxOQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r491604219", "bodyText": "noted", "author": "fl4via", "createdAt": "2020-09-19T23:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTQ4MzUzOA=="}], "type": "inlineReview"}, {"oid": "b0287a3706439dfebbd68a233939f714545deae2", "url": "https://github.com/wildfly/wildfly/commit/b0287a3706439dfebbd68a233939f714545deae2", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-instance-id attribute, update tests and documentation", "committedDate": "2020-09-19T23:27:26Z", "type": "forcePushed"}, {"oid": "84b7b88db48267594842a42e3395465a7660ff3f", "url": "https://github.com/wildfly/wildfly/commit/84b7b88db48267594842a42e3395465a7660ff3f", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-session-route attribute, update tests and documentation", "committedDate": "2020-09-21T07:32:14Z", "type": "forcePushed"}, {"oid": "6a8bfa39d98c5de1fb822881b1a953212bec8afe", "url": "https://github.com/wildfly/wildfly/commit/6a8bfa39d98c5de1fb822881b1a953212bec8afe", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-session-route attribute, update tests and documentation", "committedDate": "2020-09-21T07:44:32Z", "type": "forcePushed"}, {"oid": "9aa5f9276a7ec5f583aca188f27baf06a77cdb26", "url": "https://github.com/wildfly/wildfly/commit/9aa5f9276a7ec5f583aca188f27baf06a77cdb26", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-session-route attribute, update tests and documentation", "committedDate": "2020-09-21T07:50:35Z", "type": "forcePushed"}, {"oid": "b5dabebe1c017c4d79b74d410194a8eea7e8cb6a", "url": "https://github.com/wildfly/wildfly/commit/b5dabebe1c017c4d79b74d410194a8eea7e8cb6a", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-session-route attribute, update tests and documentation", "committedDate": "2020-09-21T07:59:27Z", "type": "forcePushed"}, {"oid": "d5239aa938162d2f7813e92b2c35e425fdadd3d1", "url": "https://github.com/wildfly/wildfly/commit/d5239aa938162d2f7813e92b2c35e425fdadd3d1", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-session-route attribute, update tests and documentation", "committedDate": "2020-09-21T10:47:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM1MzAxNw==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r492353017", "bodyText": "Given that we are already salting the hash of the instance-id (usually the host name) using the server name, thus preventing mapping back to known host names, is SHA-256 really necessary here?\nThis results in route identifiers of 43 characters, as opposed to 22 characters when using MD5.\nPerhaps we leave this determination up to the user, i.e. make this configurable?\nThis would replace obfuscate-session-route=\"true|false\" with session-route-digest-algorithm=\"...\", where undefined means we that do not obfuscate.  WDYT?", "author": "pferraro", "createdAt": "2020-09-21T21:20:59Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/Server.java", "diffHunk": "@@ -169,8 +174,23 @@ public String getDefaultHost() {\n     }\n \n     public String getRoute() {\n-        UndertowService service = this.undertowService.getValue();\n-        String defaultServerRoute = service.getInstanceId();\n+        final UndertowService service = this.undertowService.getValue();\n+        final String defaultServerRoute = service.getInstanceId();\n+        if (service.isObfuscateSessionRoute()) {\n+            try {\n+                final MessageDigest md = MessageDigest.getInstance(\"SHA-256\");", "originalCommit": "d5239aa938162d2f7813e92b2c35e425fdadd3d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODgxNzAwNQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r578817005", "bodyText": "@fl4via To reiterate, we do not require a 32 byte hash algorithm for this.  MD5 is sufficient for the purpose of obfuscating the session route and is consistent with the requested behavior in the original feature request.\nWe can discuss making this configurable at a later date.", "author": "pferraro", "createdAt": "2021-02-18T23:23:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM1MzAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MTQ0ODY2MA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r581448660", "bodyText": "@pferraro I'm updating the PR with this change", "author": "fl4via", "createdAt": "2021-02-23T22:53:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjM1MzAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2MDAwMg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r492860002", "bodyText": "@fl4via I don't understand how this test is relevant in EAP7-1187", "author": "tommaso-borgato", "createdAt": "2020-09-22T16:08:00Z", "path": "undertow/src/test/java/org/wildfly/extension/undertow/ServerServiceTestCase.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*", "originalCommit": "d5239aa938162d2f7813e92b2c35e425fdadd3d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc3MTM5Ng==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r493771396", "bodyText": "This is a unit test covering the new logic in org.wildfly.extension.undertow.Server, which is the core logic of EAP7-1187.", "author": "pferraro", "createdAt": "2020-09-23T17:37:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjg2MDAwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMwMTM3MQ==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r493301371", "bodyText": "@fl4via compilation fails: import sun.nio.cs.UTF_8;: is unused import", "author": "tommaso-borgato", "createdAt": "2020-09-23T08:22:10Z", "path": "undertow/src/test/java/org/wildfly/extension/undertow/ServerServiceTestCase.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * JBoss, Home of Professional Open Source.\n+ * Copyright 2020, Red Hat, Inc., and individual contributors\n+ * as indicated by the @author tags. See the copyright.txt file in the\n+ * distribution for a full listing of individual contributors.\n+ *\n+ * This is free software; you can redistribute it and/or modify it\n+ * under the terms of the GNU Lesser General Public License as\n+ * published by the Free Software Foundation; either version 2.1 of\n+ * the License, or (at your option) any later version.\n+ *\n+ * This software is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this software; if not, write to the Free\n+ * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n+ * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n+ */\n+\n+package org.wildfly.extension.undertow;\n+\n+import java.io.IOException;\n+import java.nio.charset.StandardCharsets;\n+import java.security.MessageDigest;\n+import java.util.Base64;\n+import java.util.Set;\n+\n+import org.jboss.as.subsystem.test.KernelServices;\n+import org.jboss.as.subsystem.test.KernelServicesBuilder;\n+import org.jboss.msc.service.ServiceController;\n+import org.jboss.msc.service.ServiceName;\n+\n+import org.junit.Assert;\n+import org.junit.Before;\n+import org.junit.Test;\n+import sun.nio.cs.UTF_8;", "originalCommit": "d5239aa938162d2f7813e92b2c35e425fdadd3d1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc2OTM2OA==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r493769368", "bodyText": "She probably meant to use java.nio.charset.StandardCharsets.UTF_8.\nIDE automation strikes again! :)", "author": "pferraro", "createdAt": "2020-09-23T17:34:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMwMTM3MQ=="}], "type": "inlineReview"}, {"oid": "fa92362b68be712a5592e0f7f15a52345f475e6c", "url": "https://github.com/wildfly/wildfly/commit/fa92362b68be712a5592e0f7f15a52345f475e6c", "message": "[WFLY-12473] Increment documentation and add new test for session management with obfuscatd route", "committedDate": "2021-01-22T04:25:07Z", "type": "forcePushed"}, {"oid": "0ba297d33252ae013fec221e336cfd07834c28a2", "url": "https://github.com/wildfly/wildfly/commit/0ba297d33252ae013fec221e336cfd07834c28a2", "message": "[WFLY-12473] Increment documentation and add new test for session management with obfuscatd route", "committedDate": "2021-01-22T04:33:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQxNDUzMg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r573414532", "bodyText": "@fl4via I believe you need a new 'registerTransformersWildFly22 method (and a MODEL_VERSION_WILDFLY_22) and this code goes there.\nIt then shouldn't be necessary to repeat this logic in the other methods. You handle it in current->MODEL_VERSION_WILDFLY_22 and the chain transformation means its handled for all the earlier ones.", "author": "bstansberry", "createdAt": "2021-02-10T03:07:33Z", "path": "undertow/src/main/java/org/wildfly/extension/undertow/UndertowTransformers.java", "diffHunk": "@@ -118,13 +120,20 @@ private static void registerTransformersWildFly18(ResourceTransformationDescript\n     }\n \n     private static void registerTransformersWildFly16(ResourceTransformationDescriptionBuilder subsystemBuilder) {\n+        subsystemBuilder.getAttributeBuilder().addRejectCheck(RejectAttributeChecker.DEFINED, OBFUSCATE_SESSION_ROUTE)\n+                .setDiscard(DiscardAttributeChecker.DEFAULT_VALUE, OBFUSCATE_SESSION_ROUTE)\n+                .end();", "originalCommit": "0ba297d33252ae013fec221e336cfd07834c28a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3ODY5MDIxNg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r578690216", "bodyText": "A code style nit is that it's nicer to do the setDiscard call before the addRejectCheck call. The order of these doesn't matter technically as the transformation engine does discards before rejects. But maintainers are less likely to know that and putting the code in the order they actually happen helps make it clearer what will happen.\nI wouldn't mention this if it weren't for that fact that my comment above means this will be getting touched anyway.", "author": "bstansberry", "createdAt": "2021-02-18T19:29:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQxNDUzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU4MDc5MjkxNg==", "url": "https://github.com/wildfly/wildfly/pull/12883#discussion_r580792916", "bodyText": "Sure, @bstansberry  I'll update the PR", "author": "fl4via", "createdAt": "2021-02-23T06:22:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MzQxNDUzMg=="}], "type": "inlineReview"}, {"oid": "336c81f969fdae5844cad6cc55adea544f7d171f", "url": "https://github.com/wildfly/wildfly/commit/336c81f969fdae5844cad6cc55adea544f7d171f", "message": "[WFLY-12473] Increment documentation and add new test for session management with obfuscated route", "committedDate": "2021-02-16T13:48:24Z", "type": "forcePushed"}, {"oid": "cdf218537206509dcb69219eb0ee82246eaf617e", "url": "https://github.com/wildfly/wildfly/commit/cdf218537206509dcb69219eb0ee82246eaf617e", "message": "Replace message digest algorithm \"SHA-256\" by \"MD5\"", "committedDate": "2021-02-23T17:46:52Z", "type": "forcePushed"}, {"oid": "5770e928bb2df15423e74a8c6ec9184de9dbb784", "url": "https://github.com/wildfly/wildfly/commit/5770e928bb2df15423e74a8c6ec9184de9dbb784", "message": "[WFLY-12932] Add checks for UndertowService at UndertowSubsystemXXTestCase tests and add UndertowServiceTestCase, a specific test for verifying configuration of subsystem attributes", "committedDate": "2021-02-23T23:02:35Z", "type": "commit"}, {"oid": "2783329eeb684ed7c91cde15220ca25f3099b459", "url": "https://github.com/wildfly/wildfly/commit/2783329eeb684ed7c91cde15220ca25f3099b459", "message": "[WFLY-12933] At Undertow subsystem configuration document, add a table describing the subsystem attributes", "committedDate": "2021-02-23T23:03:27Z", "type": "commit"}, {"oid": "2e7a508e35de24ed8f5936244485f6414ed24639", "url": "https://github.com/wildfly/wildfly/commit/2e7a508e35de24ed8f5936244485f6414ed24639", "message": "[WFLY-13858] Bump Undertow model and schema version to 12.0", "committedDate": "2021-02-23T23:08:11Z", "type": "commit"}, {"oid": "303ebb670268b839ff98192e60467aa7f91e9ce8", "url": "https://github.com/wildfly/wildfly/commit/303ebb670268b839ff98192e60467aa7f91e9ce8", "message": "[WFLY-12473] Add Undertow subsystem obfuscate-session-route attribute, update tests and documentation", "committedDate": "2021-02-23T23:19:30Z", "type": "commit"}, {"oid": "3acf99531ca3fbb37e00edf46aaf44e38008cb8e", "url": "https://github.com/wildfly/wildfly/commit/3acf99531ca3fbb37e00edf46aaf44e38008cb8e", "message": "[WFLY-12473] Increment documentation and add new test for session management with obfuscated route", "committedDate": "2021-02-23T23:19:36Z", "type": "commit"}, {"oid": "3acf99531ca3fbb37e00edf46aaf44e38008cb8e", "url": "https://github.com/wildfly/wildfly/commit/3acf99531ca3fbb37e00edf46aaf44e38008cb8e", "message": "[WFLY-12473] Increment documentation and add new test for session management with obfuscated route", "committedDate": "2021-02-23T23:19:36Z", "type": "forcePushed"}]}