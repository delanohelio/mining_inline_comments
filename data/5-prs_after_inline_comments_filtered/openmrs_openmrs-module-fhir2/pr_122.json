{"pr_number": 122, "pr_title": "FM2-116 : Added support for Cohort.memberships in platform 2.1.0 and newer", "pr_createdAt": "2020-03-23T14:02:21Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122", "timeline": [{"oid": "c61a154ee911b898c58b6d1dfad2725dfc2e2548", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/c61a154ee911b898c58b6d1dfad2725dfc2e2548", "message": "FM2-116 : Add support for Cohort.memberships in 2.1.0 and newer", "committedDate": "2020-03-23T14:05:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzMTIwMg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396531202", "bodyText": "You shouldn't be returning null. Instead\nthrow new NotImplementedException();", "author": "corneliouzbett", "createdAt": "2020-03-23T15:20:08Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/CohortListEntryTranslatorImpl.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.translators.impl;\n+\n+import java.util.List;\n+\n+import org.hl7.fhir.r4.model.ListResource;\n+import org.openmrs.Cohort;\n+import org.openmrs.module.fhir2.api.translators.ListEntryTranslator;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class CohortListEntryTranslatorImpl implements ListEntryTranslator<Cohort> {\n+\t\n+\t@Override\n+\tpublic List<ListResource.ListEntryComponent> toFhirResource(Cohort cohort) {\n+\t\treturn null;\n+\t}", "originalCommit": "c61a154ee911b898c58b6d1dfad2725dfc2e2548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3ODEzOQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396678139", "bodyText": "The suppose of this class is only to create a base from which we can provided implementation in the other supported versions", "author": "jecihjoy", "createdAt": "2020-03-23T18:45:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzMTIwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MDY2Ng==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396680666", "bodyText": "Then just use an interface instead", "author": "corneliouzbett", "createdAt": "2020-03-23T18:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzMTIwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzMjU3OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396532578", "bodyText": "one-liner\nassertThat(dao.getPatientById(0), nullValue());", "author": "corneliouzbett", "createdAt": "2020-03-23T15:21:54Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImplTest.java", "diffHunk": "@@ -161,6 +161,22 @@ public void setup() throws Exception {\n \t\t}\n \t}\n \t\n+\t@Test\n+\tpublic void getPatientById_shouldRetrievePatientById() {\n+\t\tPatient result = dao.getPatientById(4);\n+\t\t\n+\t\tassertThat(result, notNullValue());\n+\t\tassertThat(result.getUuid(), equalTo(PATIENT_UUID));\n+\t\tassertThat(result.getId(), equalTo(4));\n+\t}\n+\t\n+\t@Test\n+\tpublic void getPatientById_shouldReturnNullIfPatientNotFound() {\n+\t\tPatient result = dao.getPatientById(0);\n+\t\t\n+\t\tassertThat(result, nullValue());", "originalCommit": "c61a154ee911b898c58b6d1dfad2725dfc2e2548", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzNzYwNw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396537607", "bodyText": "It's preferred to use list.addEntry(listEntryComponent);", "author": "corneliouzbett", "createdAt": "2020-03-23T15:28:16Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ListTranslatorImpl.java", "diffHunk": "@@ -48,6 +54,8 @@ public ListResource toFhirResource(Cohort cohort) {\n \t\t\tlist.setStatus(ListResource.ListStatus.RETIRED);\n \t\t}\n \t\t\n+\t\tlist.setEntry(listEntryTranslator.toFhirResource(cohort));", "originalCommit": "c61a154ee911b898c58b6d1dfad2725dfc2e2548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU0MjQxNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396542415", "bodyText": "So your listEntryTranslator should return listEntryComponent instead of a list of listEntryComponent\nmodify your listEntryComponentTranslator::toFhirResource\nListResource.ListEntryComponent entry = new ListResource.ListEntryComponent();\nfor (CohortMembership member : cohort.getMemberships()) {\n\tif (!member.getVoided() && (member.getEndDate() == null || member.getEndDate().after(new Date()))) {\t\t\t \n                 entry.setItem(patientReferenceTranslator.toFhirResource(patientDao.getPatientById(member.getPatientId())));\n\t\t entry.setDate(member.getStartDate());\n\t\t}\n\t}\nreturn entry;", "author": "corneliouzbett", "createdAt": "2020-03-23T15:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzNzYwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3NjE1NQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/122#discussion_r396676155", "bodyText": "I'm already returning a list after adding list entries so in this case list.setEntry() is the suitable method to use. The reason for returning a list is because I don't have an option of passing CohortMember to the translator since it doesn't exist in 2.0.5. This means I can only pass Cohort  and process all the items in one place hence returning a list", "author": "jecihjoy", "createdAt": "2020-03-23T18:41:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjUzNzYwNw=="}], "type": "inlineReview"}, {"oid": "f24673a2a5e9a3f83278d289d36a19b7d8a09eed", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/f24673a2a5e9a3f83278d289d36a19b7d8a09eed", "message": "FM2-116 : Add support for Cohort.memberships in 2.1.0 and newer", "committedDate": "2020-03-23T18:45:59Z", "type": "forcePushed"}, {"oid": "1c25b584e558cba647c60d89cb2c54b2c8544cbb", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/1c25b584e558cba647c60d89cb2c54b2c8544cbb", "message": "FM2-116 : Add support for Cohort.memberships in 2.1.0 and newer", "committedDate": "2020-03-23T18:56:23Z", "type": "commit"}, {"oid": "1c25b584e558cba647c60d89cb2c54b2c8544cbb", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/1c25b584e558cba647c60d89cb2c54b2c8544cbb", "message": "FM2-116 : Add support for Cohort.memberships in 2.1.0 and newer", "committedDate": "2020-03-23T18:56:23Z", "type": "forcePushed"}, {"oid": "b426ff32d22448b077eb47c9f350406ae29368b8", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/b426ff32d22448b077eb47c9f350406ae29368b8", "message": "Merge branch 'master' into FM2-116", "committedDate": "2020-03-24T05:16:05Z", "type": "commit"}]}