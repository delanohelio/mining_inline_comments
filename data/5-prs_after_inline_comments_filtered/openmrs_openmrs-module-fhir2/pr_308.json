{"pr_number": 308, "pr_title": " FM2-307: Implementing Condition Resource for OpenMRS 2.1 And Below", "pr_createdAt": "2020-11-19T11:47:24Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308", "timeline": [{"oid": "5ad14010202307f7c4c40338dd4066694c4bc9ad", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/5ad14010202307f7c4c40338dd4066694c4bc9ad", "message": "FM2-311: Refactor to remove BaseServiceRequestTranslatorImpl (#304)", "committedDate": "2020-11-17T15:23:56Z", "type": "commit"}, {"oid": "7099e872076db4c2701eefa2c6cda16dce528c36", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/7099e872076db4c2701eefa2c6cda16dce528c36", "message": "innitial work", "committedDate": "2020-11-19T11:44:10Z", "type": "commit"}, {"oid": "44914287979a7c23e30b66e5f1b51da499007b27", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/44914287979a7c23e30b66e5f1b51da499007b27", "message": "clean up to fix tests", "committedDate": "2020-12-01T19:03:48Z", "type": "commit"}, {"oid": "ed56c206bc4951e2fa1f9df243096b13cbc1a556", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/ed56c206bc4951e2fa1f9df243096b13cbc1a556", "message": "clean up and add more tests", "committedDate": "2020-12-03T16:32:48Z", "type": "commit"}, {"oid": "cae65bfabef9e6fe57e954ada5c385dab57b3966", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/cae65bfabef9e6fe57e954ada5c385dab57b3966", "message": "add serachQuery and Intergration Tests", "committedDate": "2020-12-04T13:58:00Z", "type": "commit"}, {"oid": "7f83bfe3af90c87f9bd46a2371922678c9b93438", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/7f83bfe3af90c87f9bd46a2371922678c9b93438", "message": " Intergration Tests", "committedDate": "2020-12-06T14:23:32Z", "type": "commit"}, {"oid": "41f7b7e4aeade21f5c056a18286ea628e52789bf", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/41f7b7e4aeade21f5c056a18286ea628e52789bf", "message": "clean out tests", "committedDate": "2020-12-07T05:54:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwMTc2MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r537601760", "bodyText": "Generally, we don't want to override getSearchResultsUuids() and change the implementation. The right way to do this is to add the custom logic we need to the setupSearchParams() method (which is overridable for just this purpose). That way we only keep this logic in one place.", "author": "ibacher", "createdAt": "2020-12-07T15:35:06Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl.java", "diffHunk": "@@ -0,0 +1,288 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.dao.impl;\n+\n+import static org.hibernate.criterion.Restrictions.and;\n+import static org.hibernate.criterion.Restrictions.eq;\n+import static org.hibernate.criterion.Restrictions.ge;\n+import static org.hibernate.criterion.Restrictions.le;\n+import static org.hibernate.criterion.Restrictions.not;\n+import static org.hibernate.criterion.Subqueries.propertyIn;\n+\n+import javax.annotation.Nonnull;\n+\n+import java.math.BigDecimal;\n+import java.time.Duration;\n+import java.time.LocalDateTime;\n+import java.time.Period;\n+import java.time.ZoneId;\n+import java.time.temporal.ChronoUnit;\n+import java.time.temporal.TemporalAmount;\n+import java.time.temporal.TemporalUnit;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ca.uhn.fhir.rest.param.DateRangeParam;\n+import ca.uhn.fhir.rest.param.ParamPrefixEnum;\n+import ca.uhn.fhir.rest.param.QuantityAndListParam;\n+import ca.uhn.fhir.rest.param.QuantityParam;\n+import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n+import ca.uhn.fhir.rest.param.TokenAndListParam;\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hibernate.Criteria;\n+import org.hibernate.SessionFactory;\n+import org.hibernate.criterion.Criterion;\n+import org.hibernate.criterion.DetachedCriteria;\n+import org.hibernate.criterion.Projections;\n+import org.openmrs.Obs;\n+import org.openmrs.Retireable;\n+import org.openmrs.Voidable;\n+import org.openmrs.annotation.Authorized;\n+import org.openmrs.annotation.OpenmrsProfile;\n+import org.openmrs.module.fhir2.FhirConstants;\n+import org.openmrs.module.fhir2.api.dao.FhirConditionDao;\n+import org.openmrs.module.fhir2.api.search.param.SearchParameterMap;\n+import org.openmrs.module.fhir2.api.util.LocalDateTimeFactory;\n+import org.openmrs.util.PrivilegeConstants;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Setter(AccessLevel.PUBLIC)\n+@OpenmrsProfile(openmrsPlatformVersion = \"2.0.5 - 2.1.*\")\n+public class FhirConditionDaoImpl extends BaseFhirDao<Obs> implements FhirConditionDao<Obs> {\n+\t\n+\t@Qualifier(\"sessionFactory\")\n+\t@Autowired\n+\tprivate SessionFactory sessionFactory;\n+\t\n+\tprivate final boolean isRetireable;\n+\t\n+\tprivate final boolean isVoidable;\n+\t\n+\tprotected FhirConditionDaoImpl() {\n+\t\tthis.isRetireable = Retireable.class.isAssignableFrom(typeToken.getRawType());\n+\t\tthis.isVoidable = Voidable.class.isAssignableFrom(typeToken.getRawType());\n+\t};\n+\t\n+\tprivate LocalDateTimeFactory localDateTimeFactory;\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic Obs get(@Nonnull String uuid) {\n+\t\treturn super.get(uuid);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.EDIT_OBS)\n+\tpublic Obs createOrUpdate(@Nonnull Obs newEntry) {\n+\t\treturn super.createOrUpdate(newEntry);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.DELETE_OBS)\n+\tpublic Obs delete(@Nonnull String uuid) {\n+\t\treturn super.delete(uuid);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic List<String> getSearchResultUuids(@Nonnull SearchParameterMap theParams) {", "originalCommit": "41f7b7e4aeade21f5c056a18286ea628e52789bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwNzEyOA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r537607128", "bodyText": "It would be safer to use the UUID for the concept (\"1284AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\") since we don't want to be relying on a concept having a given concept id (i.e., we don't want to rely on a dictionary having IDs in a certain order). Even better might be to just be to leverage the system for CIEL and the concept ID, via something like:\nTokenAndListParam problemList = new TokenAndListParam();\n\t\tproblemList.addAnd(new TokenParam().setSystem(\"https://openconceptlab.org/orgs/CIEL/sources/CIEL\").setValue(\"1284\"));\n\t\thandleCodeableConcept(criteria, problemList, \"c\", \"cm\", \"crt\");\nThen this \"1284\" string would have a place in the FhirConstants file.", "author": "ibacher", "createdAt": "2020-12-07T15:42:06Z", "path": "api/src/main/java/org/openmrs/module/fhir2/FhirConstants.java", "diffHunk": "@@ -277,4 +277,6 @@\n \tpublic static final String INCLUDE_RESULT_PARAM = \"result\";\n \t\n \tpublic static final String REVERSE_INCLUDE_SEARCH_HANDLER = \"_revinclude.search.handler\";\n+\t\n+\tpublic static final Integer CONDITION_OBSERVATION_CONCEPT_ID = 1284;", "originalCommit": "41f7b7e4aeade21f5c056a18286ea628e52789bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwOTYzMA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r537609630", "bodyText": "It might be better to refactor things so this method is in BaseDao and can be used from both this class and the 2.2 and later implementation.", "author": "ibacher", "createdAt": "2020-12-07T15:45:24Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl.java", "diffHunk": "@@ -0,0 +1,288 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.dao.impl;\n+\n+import static org.hibernate.criterion.Restrictions.and;\n+import static org.hibernate.criterion.Restrictions.eq;\n+import static org.hibernate.criterion.Restrictions.ge;\n+import static org.hibernate.criterion.Restrictions.le;\n+import static org.hibernate.criterion.Restrictions.not;\n+import static org.hibernate.criterion.Subqueries.propertyIn;\n+\n+import javax.annotation.Nonnull;\n+\n+import java.math.BigDecimal;\n+import java.time.Duration;\n+import java.time.LocalDateTime;\n+import java.time.Period;\n+import java.time.ZoneId;\n+import java.time.temporal.ChronoUnit;\n+import java.time.temporal.TemporalAmount;\n+import java.time.temporal.TemporalUnit;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ca.uhn.fhir.rest.param.DateRangeParam;\n+import ca.uhn.fhir.rest.param.ParamPrefixEnum;\n+import ca.uhn.fhir.rest.param.QuantityAndListParam;\n+import ca.uhn.fhir.rest.param.QuantityParam;\n+import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n+import ca.uhn.fhir.rest.param.TokenAndListParam;\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hibernate.Criteria;\n+import org.hibernate.SessionFactory;\n+import org.hibernate.criterion.Criterion;\n+import org.hibernate.criterion.DetachedCriteria;\n+import org.hibernate.criterion.Projections;\n+import org.openmrs.Obs;\n+import org.openmrs.Retireable;\n+import org.openmrs.Voidable;\n+import org.openmrs.annotation.Authorized;\n+import org.openmrs.annotation.OpenmrsProfile;\n+import org.openmrs.module.fhir2.FhirConstants;\n+import org.openmrs.module.fhir2.api.dao.FhirConditionDao;\n+import org.openmrs.module.fhir2.api.search.param.SearchParameterMap;\n+import org.openmrs.module.fhir2.api.util.LocalDateTimeFactory;\n+import org.openmrs.util.PrivilegeConstants;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Setter(AccessLevel.PUBLIC)\n+@OpenmrsProfile(openmrsPlatformVersion = \"2.0.5 - 2.1.*\")\n+public class FhirConditionDaoImpl extends BaseFhirDao<Obs> implements FhirConditionDao<Obs> {\n+\t\n+\t@Qualifier(\"sessionFactory\")\n+\t@Autowired\n+\tprivate SessionFactory sessionFactory;\n+\t\n+\tprivate final boolean isRetireable;\n+\t\n+\tprivate final boolean isVoidable;\n+\t\n+\tprotected FhirConditionDaoImpl() {\n+\t\tthis.isRetireable = Retireable.class.isAssignableFrom(typeToken.getRawType());\n+\t\tthis.isVoidable = Voidable.class.isAssignableFrom(typeToken.getRawType());\n+\t};\n+\t\n+\tprivate LocalDateTimeFactory localDateTimeFactory;\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic Obs get(@Nonnull String uuid) {\n+\t\treturn super.get(uuid);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.EDIT_OBS)\n+\tpublic Obs createOrUpdate(@Nonnull Obs newEntry) {\n+\t\treturn super.createOrUpdate(newEntry);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.DELETE_OBS)\n+\tpublic Obs delete(@Nonnull String uuid) {\n+\t\treturn super.delete(uuid);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic List<String> getSearchResultUuids(@Nonnull SearchParameterMap theParams) {\n+\t\tCriteria criteria = sessionFactory.getCurrentSession().createCriteria(Obs.class);\n+\t\tcriteria.add(eq(\"concept.conceptId\", FhirConstants.CONDITION_OBSERVATION_CONCEPT_ID));\n+\t\t\n+\t\tDetachedCriteria detachedCriteria = DetachedCriteria.forClass(Obs.class);\n+\t\tCriteria detachedExecutableCriteria = detachedCriteria.getExecutableCriteria(sessionFactory.getCurrentSession());\n+\t\t\n+\t\tif (isVoidable) {\n+\t\t\thandleVoidable(detachedExecutableCriteria);\n+\t\t} else if (isRetireable) {\n+\t\t\thandleRetireable(detachedExecutableCriteria);\n+\t\t}\n+\t\t\n+\t\tsetupSearchParams(detachedExecutableCriteria, theParams);\n+\t\thandleSort(detachedExecutableCriteria, theParams.getSortSpec());\n+\t\t\n+\t\tdetachedCriteria.setProjection(Projections.property(\"uuid\"));\n+\t\t\n+\t\tcriteria.add(propertyIn(\"uuid\", detachedCriteria));\n+\t\tcriteria.setProjection(Projections.groupProperty(\"uuid\"));\n+\t\t\n+\t\t@SuppressWarnings(\"unchecked\")\n+\t\tList<String> results = criteria.list();\n+\t\t\n+\t\treturn results;\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic List<Obs> getSearchResults(@Nonnull SearchParameterMap theParams, @Nonnull List<String> matchingResourceUuids,\n+\t        int firstResult, int lastResult) {\n+\t\treturn super.getSearchResults(theParams, matchingResourceUuids, firstResult, lastResult);\n+\t}\n+\t\n+\tprivate Optional<Criterion> handleAgeByDateProperty(@Nonnull String datePropertyName, @Nonnull QuantityParam age) {", "originalCommit": "41f7b7e4aeade21f5c056a18286ea628e52789bf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2NTgwODA5OQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r565808099", "bodyText": "sure , i did that", "author": "mozzy11", "createdAt": "2021-01-28T04:11:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzYwOTYzMA=="}], "type": "inlineReview"}, {"oid": "35d725425cdb959f2db83d8eeb9ef9b9b74d5d8d", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/35d725425cdb959f2db83d8eeb9ef9b9b74d5d8d", "message": "refactor as per review", "committedDate": "2020-12-08T13:44:35Z", "type": "commit"}, {"oid": "313f73616026b7a699cc5409d7de9632377be03d", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/313f73616026b7a699cc5409d7de9632377be03d", "message": "pull latest", "committedDate": "2020-12-08T14:06:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ2ODI3OQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r538468279", "bodyText": "In this case, because the clinicalStatus is not a required field and we do not really have a way of representing it solely from the Obs, I would prefer that this implementation just return null. That is, if we do not know the right value, we shouldn't lie about knowing the right value (unless we're forced to guess).", "author": "ibacher", "createdAt": "2020-12-08T15:00:32Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/ConditionClinicalStatusTranslatorImpl.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.translators.impl;\n+\n+import org.hl7.fhir.r4.model.CodeableConcept;\n+import org.openmrs.Obs;\n+import org.openmrs.annotation.OpenmrsProfile;\n+import org.openmrs.module.fhir2.FhirConstants;\n+import org.openmrs.module.fhir2.api.translators.ConditionClinicalStatusTranslator;\n+import org.springframework.context.annotation.Primary;\n+import org.springframework.stereotype.Component;\n+\n+@Primary\n+@Component\n+@OpenmrsProfile(openmrsPlatformVersion = \"2.0.5 - 2.1.*\")\n+public class ConditionClinicalStatusTranslatorImpl implements ConditionClinicalStatusTranslator<Obs> {\n+\t\n+\t@Override\n+\tpublic CodeableConcept toFhirResource(Obs clinicalStatus) {\n+\t\tCodeableConcept codeableConcept = new CodeableConcept();\n+\t\tcodeableConcept.addCoding().setCode(\"active\").setDisplay(\"active\")\n+\t\t        .setSystem(FhirConstants.CONDITION_CLINICAL_STATUS_SYSTEM_URI);\n+\t\treturn codeableConcept;", "originalCommit": "313f73616026b7a699cc5409d7de9632377be03d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODUzMzkwMQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r538533901", "bodyText": "we shouldn't lie about knowing the right value (unless we're forced to guess).\n\nhaha  \ud83d\ude0a", "author": "mozzy11", "createdAt": "2020-12-08T15:59:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ2ODI3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODU2MDM0Ng==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r538560346", "bodyText": "@ibacher , i think let me just entirely remove it out", "author": "mozzy11", "createdAt": "2020-12-08T16:22:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ2ODI3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODQ3MDc5OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/308#discussion_r538470798", "bodyText": "I'd prefer this to be aliased to \"c\" for consistency. Also, this should go before the forEach block.", "author": "ibacher", "createdAt": "2020-12-08T15:02:55Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirConditionDaoImpl.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.dao.impl;\n+\n+import static org.hibernate.criterion.Restrictions.eq;\n+\n+import javax.annotation.Nonnull;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import ca.uhn.fhir.rest.param.DateRangeParam;\n+import ca.uhn.fhir.rest.param.QuantityAndListParam;\n+import ca.uhn.fhir.rest.param.ReferenceAndListParam;\n+import ca.uhn.fhir.rest.param.TokenAndListParam;\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hibernate.Criteria;\n+import org.hibernate.SessionFactory;\n+import org.hibernate.criterion.Criterion;\n+import org.openmrs.Obs;\n+import org.openmrs.annotation.Authorized;\n+import org.openmrs.annotation.OpenmrsProfile;\n+import org.openmrs.module.fhir2.FhirConstants;\n+import org.openmrs.module.fhir2.api.dao.FhirConditionDao;\n+import org.openmrs.module.fhir2.api.search.param.SearchParameterMap;\n+import org.openmrs.util.PrivilegeConstants;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.beans.factory.annotation.Qualifier;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Setter(AccessLevel.PUBLIC)\n+@OpenmrsProfile(openmrsPlatformVersion = \"2.0.5 - 2.1.*\")\n+public class FhirConditionDaoImpl extends BaseFhirDao<Obs> implements FhirConditionDao<Obs> {\n+\t\n+\t@Qualifier(\"sessionFactory\")\n+\t@Autowired\n+\tprivate SessionFactory sessionFactory;\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic Obs get(@Nonnull String uuid) {\n+\t\treturn super.get(uuid);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.EDIT_OBS)\n+\tpublic Obs createOrUpdate(@Nonnull Obs newEntry) {\n+\t\treturn super.createOrUpdate(newEntry);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.DELETE_OBS)\n+\tpublic Obs delete(@Nonnull String uuid) {\n+\t\treturn super.delete(uuid);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic List<String> getSearchResultUuids(@Nonnull SearchParameterMap theParams) {\n+\t\treturn super.getSearchResultUuids(theParams);\n+\t}\n+\t\n+\t@Override\n+\t@Authorized(PrivilegeConstants.GET_OBS)\n+\tpublic List<Obs> getSearchResults(@Nonnull SearchParameterMap theParams, @Nonnull List<String> matchingResourceUuids,\n+\t        int firstResult, int lastResult) {\n+\t\treturn super.getSearchResults(theParams, matchingResourceUuids, firstResult, lastResult);\n+\t}\n+\t\n+\t@Override\n+\tprotected void setupSearchParams(Criteria criteria, SearchParameterMap theParams) {\n+\t\ttheParams.getParameters().forEach(entry -> {\n+\t\t\tswitch (entry.getKey()) {\n+\t\t\t\tcase FhirConstants.PATIENT_REFERENCE_SEARCH_HANDLER:\n+\t\t\t\t\tentry.getValue().forEach(\n+\t\t\t\t\t    param -> handlePatientReference(criteria, (ReferenceAndListParam) param.getParam(), \"person\"));\n+\t\t\t\t\tbreak;\n+\t\t\t\tcase FhirConstants.CODED_SEARCH_HANDLER:\n+\t\t\t\t\tentry.getValue().forEach(param -> handleCode(criteria, (TokenAndListParam) param.getParam()));\n+\t\t\t\t\tbreak;\n+\t\t\t\tcase FhirConstants.DATE_RANGE_SEARCH_HANDLER:\n+\t\t\t\t\tentry.getValue()\n+\t\t\t\t\t        .forEach(param -> handleDateRange(param.getPropertyName(), (DateRangeParam) param.getParam())\n+\t\t\t\t\t                .ifPresent(criteria::add));\n+\t\t\t\t\tbreak;\n+\t\t\t\tcase FhirConstants.QUANTITY_SEARCH_HANDLER:\n+\t\t\t\t\tentry.getValue().forEach(param -> handleOnsetAge(criteria, (QuantityAndListParam) param.getParam()));\n+\t\t\t\t\tbreak;\n+\t\t\t\tcase FhirConstants.COMMON_SEARCH_HANDLER:\n+\t\t\t\t\thandleCommonSearchParameters(entry.getValue()).ifPresent(criteria::add);\n+\t\t\t\t\tbreak;\n+\t\t\t}\n+\t\t});\n+\t\tcriteria.createAlias(\"concept\", \"conc\");\n+\t\tcriteria.add(eq(\"conc.uuid\", FhirConstants.CONDITION_OBSERVATION_CONCEPT_UUID));", "originalCommit": "313f73616026b7a699cc5409d7de9632377be03d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0a9c3e20661b44bbe651341dc21bb853661d8e99", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/0a9c3e20661b44bbe651341dc21bb853661d8e99", "message": "remove condition clinical status", "committedDate": "2020-12-08T17:09:32Z", "type": "commit"}, {"oid": "68f538af6080e9bb16188c06c04101000e011dec", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/68f538af6080e9bb16188c06c04101000e011dec", "message": "fix failing test", "committedDate": "2020-12-08T17:54:33Z", "type": "commit"}, {"oid": "347040ecd966ed5e9fb446a1cbe529f4a207b7b2", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/347040ecd966ed5e9fb446a1cbe529f4a207b7b2", "message": "Apply suggestions from code review", "committedDate": "2021-02-01T14:42:28Z", "type": "commit"}]}