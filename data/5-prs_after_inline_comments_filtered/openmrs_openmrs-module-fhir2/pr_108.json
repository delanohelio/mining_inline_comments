{"pr_number": 108, "pr_title": "FM2-104 : Refactor AllergyIntolerance resource translator to use conc\u2026", "pr_createdAt": "2020-03-05T14:38:44Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/108", "timeline": [{"oid": "8bc5dc88e184a4009f73bfd5ac061cd760d680ad", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/8bc5dc88e184a4009f73bfd5ac061cd760d680ad", "message": "FM2-104 : Refactor AllergyIntolerance resource translator to use concept translator", "committedDate": "2020-03-05T16:11:00Z", "type": "forcePushed"}, {"oid": "f5fc3383a84017e50bacdb83c824c100de86f33d", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/f5fc3383a84017e50bacdb83c824c100de86f33d", "message": "FM2-104 : Refactor AllergyIntolerance resource translator to use concept translator", "committedDate": "2020-03-05T17:55:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ2NTc2OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/108#discussion_r388465768", "bodyText": "Unused imports", "author": "corneliouzbett", "createdAt": "2020-03-05T18:01:06Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/AllergyIntoleranceTranslatorImpl.java", "diffHunk": "@@ -16,6 +16,8 @@\n \n import lombok.AccessLevel;\n import lombok.Setter;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;", "originalCommit": "f5fc3383a84017e50bacdb83c824c100de86f33d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4MDYxOQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/108#discussion_r388480619", "bodyText": "If the code doesn't exist as a concept in Openmrs, It will return null and set NonCodedAllergen to coding display, which is okay but what if code exists? Meaning Both codedAllergen and NonCodedAllergen will have a value. I think NonCodedAllergen should only have a value when a concept doesn't exist that allergen. I might be wrong", "author": "corneliouzbett", "createdAt": "2020-03-05T18:29:29Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/AllergyIntoleranceTranslatorImpl.java", "diffHunk": "@@ -108,14 +114,13 @@ public Allergy toOpenmrsType(Allergy allergy, AllergyIntolerance fhirAllergy) {\n \t\tallergy.setUuid(fhirAllergy.getId());\n \t\tif (allergy.getAllergen() == null) {\n \t\t\tAllergen allergen = new Allergen();\n-\t\t\tif (!fhirAllergy.getCode().getCoding().isEmpty()) {\n-\t\t\t\tallergen.setCodedAllergen(\n-\t\t\t\t    conceptService.getConceptByUuid(fhirAllergy.getCode().getCoding().get(0).getCode()).orElse(null));\n+\t\t\tif (fhirAllergy.hasCode()) {\n+\t\t\t\tallergen.setCodedAllergen(conceptTranslator.toOpenmrsType(fhirAllergy.getCode()));\n \t\t\t\tallergen.setNonCodedAllergen(fhirAllergy.getCode().getCoding().get(0).getDisplay());\n \t\t\t}", "originalCommit": "f5fc3383a84017e50bacdb83c824c100de86f33d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NDkxNw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/108#discussion_r388494917", "bodyText": "I'm also unsure about their later but I'll ask this on talk for clarifications", "author": "jecihjoy", "createdAt": "2020-03-05T18:56:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ4MDYxOQ=="}], "type": "inlineReview"}, {"oid": "d604c72321b7be07b7a6adae18b9b8b2df1525c4", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d604c72321b7be07b7a6adae18b9b8b2df1525c4", "message": "FM2-104 : Refactor AllergyIntolerance resource translator to use concept translator", "committedDate": "2020-03-06T06:28:56Z", "type": "commit"}, {"oid": "d604c72321b7be07b7a6adae18b9b8b2df1525c4", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d604c72321b7be07b7a6adae18b9b8b2df1525c4", "message": "FM2-104 : Refactor AllergyIntolerance resource translator to use concept translator", "committedDate": "2020-03-06T06:28:56Z", "type": "forcePushed"}]}