{"pr_number": 298, "pr_title": "FM2-301: Improve Integration Tests for Medication", "pr_createdAt": "2020-08-28T16:08:25Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/298", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ2OTU4MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/298#discussion_r479469581", "bodyText": "For shouldDelete(), we don't need the AsJson and AsXML differentiators. This is because there's no real body to either the request or the response (except in the case of an error).", "author": "ibacher", "createdAt": "2020-08-28T18:29:02Z", "path": "integration-tests/src/test/java/org/openmrs/module/fhir2/providers/r3/MedicationFhirResourceProviderIntegrationTest.java", "diffHunk": "@@ -282,6 +328,100 @@ public void shouldUpdateExistingMedicationAsXml() throws Exception {\n \t\tassertThat(getStrengthExtensionValue(updatedMedication), equalTo(\"800mg\"));\n \t}\n \t\n+\t@Test\n+\tpublic void shouldReturnBadRequestWhenDocumentIdDoesNotMatchMedicationIdAsXML() throws Exception {\n+\t\t// get the existing record\n+\t\tMockHttpServletResponse response = get(\"/Medication/\" + MEDICATION_UUID).accept(FhirMediaTypes.XML).go();\n+\t\tMedication medication = readResponse(response);\n+\t\t\n+\t\t// update the existing record\n+\t\tmedication.setId(WRONG_MEDICATION_UUID);\n+\t\t\n+\t\t// send the update to the server\n+\t\tresponse = put(\"/Medication/\" + MEDICATION_UUID).xmlContext(toXML(medication)).go();\n+\t\t\n+\t\tassertThat(response, isBadRequest());\n+\t\tassertThat(response.getContentType(), is(FhirMediaTypes.XML.toString()));\n+\t\tassertThat(response.getContentAsString(), notNullValue());\n+\t\t\n+\t\tOperationOutcome operationOutcome = readOperationOutcome(response);\n+\t\t\n+\t\tassertThat(operationOutcome, notNullValue());\n+\t\tassertThat(operationOutcome.hasIssue(), is(true));\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnNotFoundWhenUpdatingNonExistentMedicationAsXML() throws Exception {\n+\t\t// get the existing record\n+\t\tMockHttpServletResponse response = get(\"/Medication/\" + MEDICATION_UUID).accept(FhirMediaTypes.XML).go();\n+\t\tMedication medication = readResponse(response);\n+\t\t\n+\t\t// update the existing record\n+\t\tmedication.setId(WRONG_MEDICATION_UUID);\n+\t\t\n+\t\t// send the update to the server\n+\t\tresponse = put(\"/Medication/\" + WRONG_MEDICATION_UUID).xmlContext(toXML(medication)).go();\n+\t\t\n+\t\tassertThat(response, isNotFound());\n+\t\tassertThat(response.getContentType(), is(FhirMediaTypes.XML.toString()));\n+\t\tassertThat(response.getContentAsString(), notNullValue());\n+\t\t\n+\t\tOperationOutcome operationOutcome = readOperationOutcome(response);\n+\t\t\n+\t\tassertThat(operationOutcome, notNullValue());\n+\t\tassertThat(operationOutcome.hasIssue(), is(true));\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldDeleteExistingMedicationAsJson() throws Exception {", "originalCommit": "32f7fe85b1a848cc052cbe204913ea7380022832", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5b748e31f61b5920f6da41757163d92836da5396", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/5b748e31f61b5920f6da41757163d92836da5396", "message": "FM2-301: Improve Integration Tests for Medication", "committedDate": "2020-08-28T18:45:16Z", "type": "commit"}, {"oid": "5b748e31f61b5920f6da41757163d92836da5396", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/5b748e31f61b5920f6da41757163d92836da5396", "message": "FM2-301: Improve Integration Tests for Medication", "committedDate": "2020-08-28T18:45:16Z", "type": "forcePushed"}]}