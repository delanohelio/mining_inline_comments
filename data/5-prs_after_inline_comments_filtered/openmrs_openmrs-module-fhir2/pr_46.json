{"pr_number": 46, "pr_title": "FM2-50: Added search encounters by PatientIdentifier", "pr_createdAt": "2020-01-28T12:50:45Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/46", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyOTcwNA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/46#discussion_r371829704", "bodyText": "I'd prefer the criteria version of this:\nreturn (List<Encounter>) sessionFactory.getCurrentSession().createCriteria(Encounter.class).createAlias(\"patient\", \"p\")\n\t\t\t\t.createAlias(\"p.identifiers\", \"pi\")\n\t\t\t\t.add(eq(\"pi.identifier\", patientIdentifier))\n\t\t\t\t.list();\n\nMy reason for favouring Criteria over HQL or JPQL is that it will make things easier when we get to implementing search across multiple properties.", "author": "ibacher", "createdAt": "2020-01-28T14:21:05Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirEncounterDaoImpl.java", "diffHunk": "@@ -24,14 +26,23 @@\n @Component\n @Setter(AccessLevel.PACKAGE)\n public class FhirEncounterDaoImpl implements FhirEncounterDao {\n-\t\n+\n \t@Inject\n \t@Named(\"sessionFactory\")\n \tprivate SessionFactory sessionFactory;\n-\t\n+\n \t@Override\n \tpublic Encounter getEncounterByUuid(String uuid) {\n \t\treturn (Encounter) sessionFactory.getCurrentSession().createCriteria(Encounter.class).add(eq(\"uuid\", uuid))\n-\t\t        .uniqueResult();\n+\t\t\t\t.uniqueResult();\n+\t}\n+\n+\t@Override\n+\t@SuppressWarnings(\"unchecked\")\n+\tpublic List<Encounter> findEncountersByPatientIdentifier(String patientIdentifier) {\n+\t\treturn sessionFactory.getCurrentSession().createQuery(\"FROM Encounter e \"", "originalCommit": "21b9f9dfc3478926dab3394935e9a87665ef2868", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg1NzkyNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/46#discussion_r371857925", "bodyText": "Got it", "author": "corneliouzbett", "createdAt": "2020-01-28T15:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgyOTcwNA=="}], "type": "inlineReview"}, {"oid": "1ee3e953f32fc1115cafd6f8a19f19acafc45be3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/1ee3e953f32fc1115cafd6f8a19f19acafc45be3", "message": "FM2-50: Added search encounters by PatientIdentifier", "committedDate": "2020-01-28T15:07:48Z", "type": "commit"}, {"oid": "dbdf4f3c6ba49d4330c89bd160efb239b00340b3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/dbdf4f3c6ba49d4330c89bd160efb239b00340b3", "message": "FM2-50: Use Criteria instead of HQL", "committedDate": "2020-01-28T15:07:48Z", "type": "commit"}, {"oid": "315238846692aac1a0c5f40dfc7f935f7273b7e1", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/315238846692aac1a0c5f40dfc7f935f7273b7e1", "message": "Resolved conflicts", "committedDate": "2020-01-28T15:11:38Z", "type": "commit"}]}