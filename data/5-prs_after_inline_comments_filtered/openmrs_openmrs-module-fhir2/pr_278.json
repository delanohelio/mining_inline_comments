{"pr_number": 278, "pr_title": "FM2-280: Add support for localisation of narratives", "pr_createdAt": "2020-08-10T19:01:30Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExNTE5Ng==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278#discussion_r468115196", "bodyText": "Returning null so that absence of the message can be identified in the templates.", "author": "ShivanshRakesh", "createdAt": "2020-08-10T19:02:50Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/narrative/OpenMRSMessageResolver.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.narrative;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.MessageSource;\n+import org.springframework.context.NoSuchMessageException;\n+import org.thymeleaf.context.ITemplateContext;\n+import org.thymeleaf.messageresolver.AbstractMessageResolver;\n+import org.thymeleaf.messageresolver.StandardMessageResolver;\n+\n+@Slf4j\n+public class OpenMRSMessageResolver extends AbstractMessageResolver {\n+\t\n+\tprivate final StandardMessageResolver standardMessageResolver = new StandardMessageResolver();\n+\t\n+\tprivate final MessageSource messageSource;\n+\t\n+\t@Autowired\n+\tpublic OpenMRSMessageResolver(MessageSource messageSource) {\n+\t\tthis.messageSource = messageSource;\n+\t}\n+\t\n+\tpublic String resolveMessage(final ITemplateContext context, final Class<?> origin, final String key,\n+\t        final Object[] messageParameters) {\n+\t\t\n+\t\ttry {\n+\t\t\treturn messageSource.getMessage(key, messageParameters, context != null ? context.getLocale() : null);\n+\t\t}\n+\t\tcatch (NoSuchMessageException ignored) {}\n+\t\t\n+\t\tif (origin != null) {\n+\t\t\treturn standardMessageResolver.resolveMessage(context, origin, key, messageParameters, false, true, true);\n+\t\t}\n+\t\t\n+\t\treturn null;\n+\t}\n+\t\n+\t@Override\n+\tpublic String createAbsentMessageRepresentation(ITemplateContext context, Class<?> origin, String key,\n+\t        Object[] objects) {\n+\t\treturn null;", "originalCommit": "343dcb158e3afebbc5a28389db057fe88c91536d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyMTQ1MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278#discussion_r468121450", "bodyText": "@ShivanshRakesh Things like this should be added as a comment to the code. It's a good point though.", "author": "ibacher", "createdAt": "2020-08-10T19:14:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExNTE5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExNjkwOQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278#discussion_r468116909", "bodyText": "Used a setter so that ReloadableResourceBundleMessageSource could be set as messageSource in web tests.", "author": "ShivanshRakesh", "createdAt": "2020-08-10T19:06:05Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -108,4 +112,9 @@ public void setResourceProviders(Collection<IResourceProvider> theProviders) {\n \tpublic void setServerAddressStrategy(IServerAddressStrategy theServerAddressStrategy) {\n \t\tsuper.setServerAddressStrategy(theServerAddressStrategy);\n \t}\n+\t\n+\t@Autowired\n+\tpublic void setMessageSource(MessageSource messageSource) {", "originalCommit": "343dcb158e3afebbc5a28389db057fe88c91536d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODExODY2NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278#discussion_r468118664", "bodyText": "Setting a ReloadableResourceBundleMessageSource as messageSource for web tests.", "author": "ShivanshRakesh", "createdAt": "2020-08-10T19:09:35Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/BaseFhirResourceProviderWebTest.java", "diffHunk": "@@ -104,6 +107,7 @@ public String getGlobalProperty(String property) throws APIException {\n \t\t});\n \t\t\n \t\tservlet.setResourceProviders(getResourceProvider());\n+\t\tservlet.setMessageSource(messageSource);", "originalCommit": "343dcb158e3afebbc5a28389db057fe88c91536d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "684eb946f8539d938f0f50384c14313feaa315f4", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/684eb946f8539d938f0f50384c14313feaa315f4", "message": "fixed failing webtests", "committedDate": "2020-08-10T19:13:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyMTA1Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278#discussion_r468121053", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public class OpenMRSMessageResolver extends AbstractMessageResolver {\n          \n          \n            \n            public class OpenmrsMessageResolver extends AbstractMessageResolver {", "author": "ibacher", "createdAt": "2020-08-10T19:14:11Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/narrative/OpenMRSMessageResolver.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.narrative;\n+\n+import lombok.extern.slf4j.Slf4j;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.context.MessageSource;\n+import org.springframework.context.NoSuchMessageException;\n+import org.thymeleaf.context.ITemplateContext;\n+import org.thymeleaf.messageresolver.AbstractMessageResolver;\n+import org.thymeleaf.messageresolver.StandardMessageResolver;\n+\n+@Slf4j\n+public class OpenMRSMessageResolver extends AbstractMessageResolver {", "originalCommit": "684eb946f8539d938f0f50384c14313feaa315f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEyMjk1Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/278#discussion_r468122953", "bodyText": "Move these two lines down just before the call to setMessageSource()", "author": "ibacher", "createdAt": "2020-08-10T19:17:53Z", "path": "omod/src/test/java/org/openmrs/module/fhir2/providers/BaseFhirResourceProviderWebTest.java", "diffHunk": "@@ -85,6 +86,8 @@ public void setup() throws ServletException {\n \tpublic abstract Class<? extends IBaseOperationOutcome> getOperationOutcomeClass();\n \t\n \tpublic void setupFhirServlet() throws ServletException {\n+\t\tReloadableResourceBundleMessageSource messageSource = new ReloadableResourceBundleMessageSource();\n+\t\tmessageSource.setBasename(\"classpath:messages\");", "originalCommit": "684eb946f8539d938f0f50384c14313feaa315f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "df28d0f66e9b46bf051b6b27fa39e4bf3e210103", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/df28d0f66e9b46bf051b6b27fa39e4bf3e210103", "message": "localized AllergyIntolerance, Condition, Encounter", "committedDate": "2020-08-11T19:55:44Z", "type": "forcePushed"}, {"oid": "34903954b1d264923d546cfc638998ab92df600b", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/34903954b1d264923d546cfc638998ab92df600b", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-12T20:05:11Z", "type": "forcePushed"}, {"oid": "f138082993cffa630497fd83cc21b2025dfc3e2a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/f138082993cffa630497fd83cc21b2025dfc3e2a", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-12T20:06:32Z", "type": "forcePushed"}, {"oid": "39094af5bdd6889f7471be8ad0e0c9de4e89f4d9", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/39094af5bdd6889f7471be8ad0e0c9de4e89f4d9", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-13T18:04:14Z", "type": "forcePushed"}, {"oid": "e8e097f30b4a57b7f5bcee6422204426bd982969", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/e8e097f30b4a57b7f5bcee6422204426bd982969", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-13T19:11:36Z", "type": "forcePushed"}, {"oid": "072fa9b7ea934338aac8da24e35a5f58ced1c8f4", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/072fa9b7ea934338aac8da24e35a5f58ced1c8f4", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-13T19:16:23Z", "type": "forcePushed"}, {"oid": "4c7a25f7b7617243af153bde0a220fcdde6fccdf", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/4c7a25f7b7617243af153bde0a220fcdde6fccdf", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-13T19:33:22Z", "type": "forcePushed"}, {"oid": "609c6cb4fdfb34903a57da868d3f91799f5fc167", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/609c6cb4fdfb34903a57da868d3f91799f5fc167", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-17T15:23:45Z", "type": "forcePushed"}, {"oid": "fdf1cfdbc04655c3e2775359b3698161a03b8156", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/fdf1cfdbc04655c3e2775359b3698161a03b8156", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-20T19:33:45Z", "type": "commit"}, {"oid": "fdf1cfdbc04655c3e2775359b3698161a03b8156", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/fdf1cfdbc04655c3e2775359b3698161a03b8156", "message": "FM2-280: Add support for localisation of narratives", "committedDate": "2020-08-20T19:33:45Z", "type": "forcePushed"}, {"oid": "1cb6510704502b14ca1010c0754c9a0fed4ed052", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/1cb6510704502b14ca1010c0754c9a0fed4ed052", "message": "Merge branch 'master' into FM2-280", "committedDate": "2020-08-25T21:42:38Z", "type": "commit"}]}