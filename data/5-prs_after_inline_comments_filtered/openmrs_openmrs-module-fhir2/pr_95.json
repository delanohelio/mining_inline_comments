{"pr_number": 95, "pr_title": "FM2-95: Implement sorting for Patient Resource", "pr_createdAt": "2020-02-28T18:21:09Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTU0OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301548", "bodyText": "@CaptainDaVinci Here I'll suggest to use Patient.SP_NAME", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:18:11Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTU3MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301571", "bodyText": "here  Patient.SP_GIVEN", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:18:30Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTYwNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301605", "bodyText": "Here Patient.SP_FAMILY", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:19:01Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTYyMw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301623", "bodyText": "Here Patient.SP_BIRTHDATE", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:19:33Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":\n+\t\t\t\treturn \"pn.familyName\";\n+\t\t\tcase \"birthdate\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTY2MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301661", "bodyText": "Here Patient.SP_DEATH_DATE", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:20:09Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":\n+\t\t\t\treturn \"pn.familyName\";\n+\t\t\tcase \"birthdate\":\n+\t\t\t\treturn \"birthdate\";\n+\t\t\tcase \"deathdate\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTY5OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301698", "bodyText": "Here Patient.SP_ADDRESS_CITY", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:20:38Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":\n+\t\t\t\treturn \"pn.familyName\";\n+\t\t\tcase \"birthdate\":\n+\t\t\t\treturn \"birthdate\";\n+\t\t\tcase \"deathdate\":\n+\t\t\t\treturn \"deathDate\";\n+\t\t\tcase \"address-city\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTc1MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301751", "bodyText": "Here Patient.SP_ADDRESS_STATE", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:21:20Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":\n+\t\t\t\treturn \"pn.familyName\";\n+\t\t\tcase \"birthdate\":\n+\t\t\t\treturn \"birthdate\";\n+\t\t\tcase \"deathdate\":\n+\t\t\t\treturn \"deathDate\";\n+\t\t\tcase \"address-city\":\n+\t\t\t\treturn \"pad.cityVillage\";\n+\t\t\tcase \"address-state\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTc5OQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301799", "bodyText": "Here Patient.SP_ADDRESS_POSTALCODE", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:21:45Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":\n+\t\t\t\treturn \"pn.familyName\";\n+\t\t\tcase \"birthdate\":\n+\t\t\t\treturn \"birthdate\";\n+\t\t\tcase \"deathdate\":\n+\t\t\t\treturn \"deathDate\";\n+\t\t\tcase \"address-city\":\n+\t\t\t\treturn \"pad.cityVillage\";\n+\t\t\tcase \"address-state\":\n+\t\t\t\treturn \"pad.stateProvince\";\n+\t\t\tcase \"address-postalCode\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTgyNA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301824", "bodyText": "Here Patient.SP_ADDRESS_COUNTRY", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:22:24Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))\n+\t\t\t        && !containsAlias(criteria, \"pn\")) {\n+\t\t\t\tcriteria.createAlias(\"names\", \"pn\");\n+\t\t\t}\n+\t\t\tif (paramName.startsWith(\"address\") && !containsAlias(criteria, \"pad\")) {\n+\t\t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n+\t\t\t}\n+\t\t}\n \t\thandleSort(criteria, sort);\n \t\t\n \t\treturn criteria.list();\n \t}\n \t\n+\t@Override\n+\tprotected String paramToProp(String param) {\n+\t\tswitch (param) {\n+\t\t\tcase \"name\":\n+\t\t\tcase \"given\":\n+\t\t\t\treturn \"pn.givenName\";\n+\t\t\tcase \"family\":\n+\t\t\t\treturn \"pn.familyName\";\n+\t\t\tcase \"birthdate\":\n+\t\t\t\treturn \"birthdate\";\n+\t\t\tcase \"deathdate\":\n+\t\t\t\treturn \"deathDate\";\n+\t\t\tcase \"address-city\":\n+\t\t\t\treturn \"pad.cityVillage\";\n+\t\t\tcase \"address-state\":\n+\t\t\t\treturn \"pad.stateProvince\";\n+\t\t\tcase \"address-postalCode\":\n+\t\t\t\treturn \"pad.postalCode\";\n+\t\t\tcase \"address-country\":", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389301958", "bodyText": "@CaptainDaVinci  I would suggest you use Patient.SP_NAME instead of name Patient.SP_GIVEN instead of given Patient.SP_FAMILY instead of family", "author": "VaishSiddharth", "createdAt": "2020-03-07T18:25:12Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImpl.java", "diffHunk": "@@ -85,9 +86,44 @@ public PatientIdentifierType getPatientIdentifierTypeByNameOrUuid(String name, S\n \t\t\tcriteria.createAlias(\"addresses\", \"pad\");\n \t\t\tcriteria.add(c);\n \t\t});\n+\t\tif (sort != null) {\n+\t\t\tString paramName = sort.getParamName();\n+\t\t\tif ((paramName.equals(\"name\") || paramName.equals(\"given\") || paramName.equals(\"family\"))", "originalCommit": "edc81e5e5655003898036786db5422e0311ce5b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM5MjM3NQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389392375", "bodyText": "@VaishSiddharth I don't think these changes are feasible because there's already an \"import org.openmrs.Patient;\" line. Otherwise, it'd have to always written like \"org.hl7.fhir.r4.model.Patient.SP_NAME\".", "author": "varung-31", "createdAt": "2020-03-08T18:09:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM5MzE0MA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389393140", "bodyText": "I am not very sure about what you are saying but please have a look at this maybe it'll help.", "author": "VaishSiddharth", "createdAt": "2020-03-08T18:20:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM5NzMwMA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389397300", "bodyText": "No, I am not saying that it can't be done. All I am saying is that in PatientDaoImpl, patient cannot be imported from two different locations. Hence, you'll need to write the full package name again and again.", "author": "varung-31", "createdAt": "2020-03-08T19:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMDcwNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389400706", "bodyText": "Okay I understood what your are trying to say. Not sure that which approach is better I think for code cleanliness we should use name etc but I guess using org.hl7.fhir.r4.model.Patient.SP_NAME will be more fault tolerant.\n@ibacher What is your take on this?", "author": "VaishSiddharth", "createdAt": "2020-03-08T20:06:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0OTY5Mw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r389449693", "bodyText": "I too prefer using named constants instead of literals.\nOne way to go about having a less verbose approach would be to create an alias,\nclass FHIRPerson extends org.hl7.fhir.r4.model.Patient {\n\t\t\t\n}\n...\n case FHIRPatient.SP_NAME:\n...", "author": "CaptainDaVinci", "createdAt": "2020-03-09T03:31:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI5MDU1NQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r390290555", "bodyText": "Frankly, I wouldn't get too hung-up on the constants vs literals thing. Either are fine. I certainly wouldn't support introducing a new class just to have the name of the constants to be shorter. In that case, it might make more sense to just use static imports, so you can just write:\n...\ncase SP_NAME:\n...", "author": "ibacher", "createdAt": "2020-03-10T12:52:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTMwMTk1OA=="}], "type": "inlineReview"}, {"oid": "b491962c15da2b5cbc7daa271376824fba13eaf3", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/b491962c15da2b5cbc7daa271376824fba13eaf3", "message": "FM2-95: Implement sorting for Patient Resource", "committedDate": "2020-03-09T03:35:27Z", "type": "forcePushed"}, {"oid": "b2d29663cb312e662034af25f082ab878f4ccc90", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/b2d29663cb312e662034af25f082ab878f4ccc90", "message": "FM2-95: Implement sorting for Patient Resource", "committedDate": "2020-03-10T13:53:53Z", "type": "forcePushed"}, {"oid": "4b64b06433067437284120191f13200bdbab014f", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/4b64b06433067437284120191f13200bdbab014f", "message": "FM2-95: Implement sorting for Patient Resource", "committedDate": "2020-03-16T18:18:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzUxMzA0Nw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/95#discussion_r393513047", "bodyText": "Please leave a line before the return", "author": "varung-31", "createdAt": "2020-03-17T08:30:56Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/dao/impl/FhirPatientDaoImplTest.java", "diffHunk": "@@ -379,4 +389,224 @@ public void searchForPatients_shouldSearchForPatientsByPostalCode() {\n \t\tassertThat(results, not(empty()));\n \t\tassertThat(results.iterator().next().getUuid(), equalTo(PATIENT_ADDRESS_PATIENT_UUID));\n \t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByName() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"name\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\t\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\t// Smallest given name of patient i should be less than the largest given name of next patient.\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getNames(), not(empty())); // Not sure why this test is failing\n+\t\t\tString currentSmallestGivenName = patients.get(i - 1).getNames().stream()\n+\t\t\t        .min(Comparator.comparing(pn -> pn.getGivenName())).get().getGivenName();\n+\t\t\tString nextLargestGivenName = patients.get(i).getNames().stream()\n+\t\t\t        .max(Comparator.comparing(pn -> pn.getGivenName())).get().getGivenName();\n+\t\t\t\n+\t\t\tassertThat(currentSmallestGivenName, lessThanOrEqualTo(nextLargestGivenName));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\t\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\t// Largest given name of patient i + 1 i should be greater than the smallest given name of previous patient.\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tString largestGivenName = patients.get(i - 1).getNames().stream()\n+\t\t\t        .max(Comparator.comparing(pn -> pn.getGivenName())).get().getGivenName();\n+\t\t\tString nextSmallestGivenName = patients.get(i).getNames().stream()\n+\t\t\t        .min(Comparator.comparing(pn -> pn.getGivenName())).get().getGivenName();\n+\t\t\t\n+\t\t\tassertThat(largestGivenName, greaterThanOrEqualTo(nextSmallestGivenName));\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByBirthDate() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"birthdate\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getBirthdate(), sameOrBefore(patients.get(i).getBirthdate()));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getBirthdate(), sameOrAfter(patients.get(i).getBirthdate()));\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByDeathDate() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"deathdate\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getDeathDate(), sameOrBefore(patients.get(i).getDeathDate()));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getDeathDate(), sameOrAfter(patients.get(i).getDeathDate()));\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByCity() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"address-city\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\t\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getCityVillage(),\n+\t\t\t    lessThanOrEqualTo(patients.get(i).getPersonAddress().getCityVillage()));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\t\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getCityVillage(),\n+\t\t\t    greaterThanOrEqualTo(patients.get(i).getPersonAddress().getCityVillage()));\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByState() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"address-state\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\t\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getStateProvince(),\n+\t\t\t    lessThanOrEqualTo(patients.get(i).getPersonAddress().getStateProvince()));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\t\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getStateProvince(),\n+\t\t\t    greaterThanOrEqualTo(patients.get(i).getPersonAddress().getStateProvince()));\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByPostalCode() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"address-postalCode\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\t\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getPostalCode(),\n+\t\t\t    lessThanOrEqualTo(patients.get(i).getPersonAddress().getPostalCode()));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\t\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getPostalCode(),\n+\t\t\t    greaterThanOrEqualTo(patients.get(i).getPersonAddress().getPostalCode()));\n+\t\t}\n+\t}\n+\t\n+\t@Test\n+\tpublic void shouldReturnCollectionOfPatientsSortedByCountry() {\n+\t\tSortSpec sort = new SortSpec();\n+\t\tsort.setParamName(\"address-country\");\n+\t\tsort.setOrder(SortOrderEnum.ASC);\n+\t\t\n+\t\tList<Patient> patients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getCountry(),\n+\t\t\t    lessThanOrEqualTo(patients.get(i).getPersonAddress().getCountry()));\n+\t\t}\n+\t\t\n+\t\tsort.setOrder(SortOrderEnum.DESC);\n+\t\t\n+\t\tpatients = getPatientListForSorting(sort);\n+\t\t\n+\t\tfor (int i = 1; i < patients.size(); i++) {\n+\t\t\tassertThat(patients.get(i - 1).getPersonAddress().getCountry(),\n+\t\t\t    greaterThanOrEqualTo(patients.get(i).getPersonAddress().getCountry()));\n+\t\t}\n+\t}\n+\t\n+\tprivate List<Patient> getPatientListForSorting(SortSpec sort) {\n+\t\tCollection<Patient> patients = dao.searchForPatients(null, null, null, null, null, null, null, null, null, null,\n+\t\t    null, null, sort);\n+\t\t\n+\t\tassertThat(patients, notNullValue());\n+\t\tassertThat(patients, not(empty()));\n+\t\tassertThat(patients.size(), greaterThan(1));\n+\t\t\n+\t\tList<Patient> patientList = new ArrayList<>(patients);\n+\t\t// remove patients with sort parameter value null, to allow comparison while asserting. \n+\t\tswitch (sort.getParamName()) {\n+\t\t\tcase \"name\":\n+\t\t\t\tpatientList.removeIf(p -> p.getGivenName() == null);\n+\t\t\t\tbreak;\n+\t\t\tcase \"birthdate\":\n+\t\t\t\tpatientList.removeIf(p -> p.getBirthdate() == null);\n+\t\t\t\tbreak;\n+\t\t\tcase \"deathdate\":\n+\t\t\t\tpatientList.removeIf(p -> p.getDeathDate() == null);\n+\t\t\t\tbreak;\n+\t\t\tcase \"address-city\":\n+\t\t\t\tpatientList.removeIf(p -> addressComponentNullorEmtpy(p.getPersonAddress(), \"city\"));\n+\t\t\t\tbreak;\n+\t\t\tcase \"address-state\":\n+\t\t\t\tpatientList.removeIf(p -> addressComponentNullorEmtpy(p.getPersonAddress(), \"state\"));\n+\t\t\t\tbreak;\n+\t\t\tcase \"address-postalcode\":\n+\t\t\t\tpatientList.removeIf(p -> addressComponentNullorEmtpy(p.getPersonAddress(), \"postalCode\"));\n+\t\t\t\tbreak;\n+\t\t\tcase \"address-country\":\n+\t\t\t\tpatientList.removeIf(p -> addressComponentNullorEmtpy(p.getPersonAddress(), \"country\"));\n+\t\t\t\tbreak;\n+\t\t}\n+\t\t\n+\t\tassertThat(patientList.size(), greaterThan(1));\n+\t\t\n+\t\treturn patientList;\n+\t}\n+\t\n+\tprivate boolean addressComponentNullorEmtpy(PersonAddress address, String component) {\n+\t\tif (address == null) {\n+\t\t\treturn true;\n+\t\t}\n+\t\tswitch (component) {\n+\t\t\tcase \"city\":\n+\t\t\t\treturn address.getCityVillage() == null || address.getCityVillage().isEmpty();\n+\t\t\tcase \"state\":\n+\t\t\t\treturn address.getStateProvince() == null || address.getStateProvince().isEmpty();\n+\t\t\tcase \"postalCode\":\n+\t\t\t\treturn address.getPostalCode() == null || address.getPostalCode().isEmpty();\n+\t\t\tcase \"country\":\n+\t\t\t\treturn address.getCountry() == null || address.getCountry().isEmpty();\n+\t\t}\n+\t\treturn false;", "originalCommit": "e4b37eea86b3a964cde52dece7e07c331b55a5d7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6dbfe4f12a6927873560d211e8dc9b8fb38d4c6b", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6dbfe4f12a6927873560d211e8dc9b8fb38d4c6b", "message": "Add tests for sorting", "committedDate": "2020-03-17T09:33:04Z", "type": "forcePushed"}, {"oid": "9bbaa4f98f891605c60006c718c0d3a26beeaa0b", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/9bbaa4f98f891605c60006c718c0d3a26beeaa0b", "message": "Add tests for sorting", "committedDate": "2020-03-17T12:03:12Z", "type": "forcePushed"}, {"oid": "3c2ec0176c1e2737405b9650dc223ed08d41e968", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/3c2ec0176c1e2737405b9650dc223ed08d41e968", "message": "FM2-95: Implement sorting for Patient Resource", "committedDate": "2020-03-17T12:04:08Z", "type": "forcePushed"}, {"oid": "400f63ffcad3ca403c7e20942758dd4223a6afee", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/400f63ffcad3ca403c7e20942758dd4223a6afee", "message": "FM2-95: Implement sorting for Patient Resource", "committedDate": "2020-03-17T15:30:43Z", "type": "forcePushed"}, {"oid": "a478145d86c19e16f83014219d9aeee990015861", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/a478145d86c19e16f83014219d9aeee990015861", "message": "FM2-95: Implement sorting for Patient Resource\n\nImproves sorting for Person resource and provides a means of sorting by name", "committedDate": "2020-03-17T19:14:26Z", "type": "forcePushed"}, {"oid": "d06ad13fee8956c80132ddd9bc601dfa18604fcc", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d06ad13fee8956c80132ddd9bc601dfa18604fcc", "message": "FM2-95: Implement sorting for Patient Resource", "committedDate": "2020-03-17T19:16:33Z", "type": "commit"}, {"oid": "6e6867a6e618454d3fe5f7a3710bc10300ebad86", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6e6867a6e618454d3fe5f7a3710bc10300ebad86", "message": "FM2-95: Implement sorting for Patient Resource\n\nImproves sorting for Person resource and provides a means of sorting by name", "committedDate": "2020-03-17T19:16:33Z", "type": "forcePushed"}, {"oid": "ec7d75d73afa9821cf71f2e0079f2b1a6d5d3ed9", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/ec7d75d73afa9821cf71f2e0079f2b1a6d5d3ed9", "message": "FM2-95: Implement sorting for Patient Resource\n\nImproves sorting for Person resource and provides a means of sorting by name", "committedDate": "2020-03-17T19:44:02Z", "type": "commit"}, {"oid": "ec7d75d73afa9821cf71f2e0079f2b1a6d5d3ed9", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/ec7d75d73afa9821cf71f2e0079f2b1a6d5d3ed9", "message": "FM2-95: Implement sorting for Patient Resource\n\nImproves sorting for Person resource and provides a means of sorting by name", "committedDate": "2020-03-17T19:44:02Z", "type": "forcePushed"}]}