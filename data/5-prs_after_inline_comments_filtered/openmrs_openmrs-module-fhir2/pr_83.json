{"pr_number": 83, "pr_title": "FM2-76: Implement Observation.hasMember", "pr_createdAt": "2020-02-21T16:04:24Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4MjUzOA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83#discussion_r382682538", "bodyText": "This should look something like this:\nreference.setType(\"Observation\").setReference(\"Observation/\" + OBS_UUID);\nI.e., the reference id is not the Obs uuid (since the reference is a different entity for the observation itself).", "author": "ibacher", "createdAt": "2020-02-21T16:34:59Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImplTest.java", "diffHunk": "@@ -199,21 +198,21 @@ public void toFhirResource_shouldConvertObsValueToValue() {\n \t}\n \t\n \t@Test\n-\tpublic void toFhirResource_shouldConvertObsGroupToComponent() {\n+\tpublic void toFhirResource_shouldConvertObsGroupToHasMemberReferences() {\n \t\tObs observation = new Obs();\n \t\tObs childObs = new Obs();\n \t\tchildObs.setUuid(OBS_UUID);\n \t\tobservation.addGroupMember(childObs);\n \t\t\n-\t\tObservation.ObservationComponentComponent component = new Observation.ObservationComponentComponent();\n-\t\tcomponent.setId(OBS_UUID);\n-\t\twhen(observationComponentTranslator.toFhirResource(childObs)).thenReturn(component);\n+\t\tReference reference = new Reference();\n+\t\treference.setId(OBS_UUID);", "originalCommit": "b107fd02011723957755112c786495f1f98570ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwMjczOA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83#discussion_r382702738", "bodyText": "Thanks for the review! I'll make those changes.", "author": "CaptainDaVinci", "createdAt": "2020-02-21T17:13:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4MjUzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4MzA0Mg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83#discussion_r382683042", "bodyText": "See above.", "author": "ibacher", "createdAt": "2020-02-21T16:35:52Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImplTest.java", "diffHunk": "@@ -252,13 +251,13 @@ public void toOpenmrsType_shouldTranslateCodeToConcept() {\n \t}\n \t\n \t@Test\n-\tpublic void toOpenmrsType_shouldTranslateComponentsToGroupObs() {\n+\tpublic void toOpenmrsType_shouldTranslateHasMemberReferencesToGroupObs() {\n \t\tObservation observation = new Observation();\n-\t\tObservation.ObservationComponentComponent component = observation.addComponent();\n-\t\tcomponent.setId(OBS_UUID);\n+\t\tReference reference = observation.addHasMember();\n+\t\treference.setId(OBS_UUID);", "originalCommit": "b107fd02011723957755112c786495f1f98570ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4NDA0Nw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83#discussion_r382684047", "bodyText": "It's preferable, IMO to use hasItem instead of contains. The test here will also need to be updated to ensure that the type and reference values have been properly set.", "author": "ibacher", "createdAt": "2020-02-21T16:37:47Z", "path": "api/src/test/java/org/openmrs/module/fhir2/api/translators/impl/ObservationTranslatorImplTest.java", "diffHunk": "@@ -199,21 +198,21 @@ public void toFhirResource_shouldConvertObsValueToValue() {\n \t}\n \t\n \t@Test\n-\tpublic void toFhirResource_shouldConvertObsGroupToComponent() {\n+\tpublic void toFhirResource_shouldConvertObsGroupToHasMemberReferences() {\n \t\tObs observation = new Obs();\n \t\tObs childObs = new Obs();\n \t\tchildObs.setUuid(OBS_UUID);\n \t\tobservation.addGroupMember(childObs);\n \t\t\n-\t\tObservation.ObservationComponentComponent component = new Observation.ObservationComponentComponent();\n-\t\tcomponent.setId(OBS_UUID);\n-\t\twhen(observationComponentTranslator.toFhirResource(childObs)).thenReturn(component);\n+\t\tReference reference = new Reference();\n+\t\treference.setId(OBS_UUID);\n+\t\twhen(observationReferenceTranslator.toFhirResource(childObs)).thenReturn(reference);\n \t\t\n \t\tObservation result = observationTranslator.toFhirResource(observation);\n \t\t\n-\t\tassertThat(result.getComponent(), notNullValue());\n-\t\tassertThat(result.getComponent().size(), equalTo(1));\n-\t\tassertThat(result.getComponent(), contains(hasProperty(\"id\", equalTo(OBS_UUID))));\n+\t\tassertThat(result.getHasMember(), notNullValue());\n+\t\tassertThat(result.getHasMember().size(), equalTo(1));\n+\t\tassertThat(result.getHasMember(), contains(hasProperty(\"id\", equalTo(OBS_UUID))));", "originalCommit": "b107fd02011723957755112c786495f1f98570ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwNDA4NA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83#discussion_r382704084", "bodyText": "Here, wouldn't hasProperty(\"id\", ...) have to be changed to something like hasProperty(\"reference\", \"Observation/\" + OBS_UUID), since \"id\" would correspond to the reference entity id and not the Obs id?", "author": "CaptainDaVinci", "createdAt": "2020-02-21T17:16:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4NDA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcwODQzNA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/83#discussion_r382708434", "bodyText": "Yes, I think that would do it", "author": "ibacher", "createdAt": "2020-02-21T17:25:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjY4NDA0Nw=="}], "type": "inlineReview"}, {"oid": "cafe6bb791bfe9bfc45b4e69f397c16e093005e7", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/cafe6bb791bfe9bfc45b4e69f397c16e093005e7", "message": "FM2-76: Implement Observation.hasMember", "committedDate": "2020-02-21T17:39:12Z", "type": "commit"}, {"oid": "cafe6bb791bfe9bfc45b4e69f397c16e093005e7", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/cafe6bb791bfe9bfc45b4e69f397c16e093005e7", "message": "FM2-76: Implement Observation.hasMember", "committedDate": "2020-02-21T17:39:12Z", "type": "forcePushed"}, {"oid": "eaa972e91d0efb38b11b986218660423f35ca52c", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/eaa972e91d0efb38b11b986218660423f35ca52c", "message": "Merge branch 'master' into FM2-76", "committedDate": "2020-02-21T18:32:21Z", "type": "commit"}]}