{"pr_number": 101, "pr_title": "FM-98 : FHIR Medication Resource Initial Implementation", "pr_createdAt": "2020-03-03T11:36:41Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/101", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk2NzQxNg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/101#discussion_r386967416", "bodyText": "Add private modifier", "author": "corneliouzbett", "createdAt": "2020-03-03T11:46:56Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/dao/impl/FhirMedicationDaoImpl.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.dao.impl;\n+\n+import static org.hibernate.criterion.Restrictions.eq;\n+\n+import javax.inject.Inject;\n+import javax.inject.Named;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hibernate.SessionFactory;\n+import org.openmrs.Drug;\n+import org.openmrs.module.fhir2.api.dao.FhirMedicationDao;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Setter(AccessLevel.PACKAGE)\n+public class FhirMedicationDaoImpl implements FhirMedicationDao {\n+\t\n+\t@Inject\n+\t@Named(\"sessionFactory\")\n+\tSessionFactory sessionFactory;\n+\t", "originalCommit": "8e8b6a5166fad4c324bb039d09fca3d24652d6a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3MjM4OQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/101#discussion_r386972389", "bodyText": "@Transactional(readOnly = true)", "author": "corneliouzbett", "createdAt": "2020-03-03T11:57:34Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/impl/FhirMedicationServiceImpl.java", "diffHunk": "@@ -0,0 +1,39 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.impl;\n+\n+import javax.inject.Inject;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hl7.fhir.r4.model.Medication;\n+import org.openmrs.module.fhir2.api.FhirMedicationService;\n+import org.openmrs.module.fhir2.api.dao.FhirMedicationDao;\n+import org.openmrs.module.fhir2.api.translators.MedicationTranslator;\n+import org.springframework.stereotype.Component;\n+import org.springframework.transaction.annotation.Transactional;\n+\n+@Component\n+@Transactional\n+@Setter(AccessLevel.PACKAGE)\n+public class FhirMedicationServiceImpl implements FhirMedicationService {\n+\t\n+\t@Inject\n+\tprivate MedicationTranslator medicationTranslator;\n+\t\n+\t@Inject\n+\tprivate FhirMedicationDao medicationDao;\n+\t\n+\t@Override\n+\t@Transactional\n+\tpublic Medication getMedicationByUuid(String uuid) {", "originalCommit": "8e8b6a5166fad4c324bb039d09fca3d24652d6a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NjA1OA==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/101#discussion_r386976058", "bodyText": "Instead of this, use conceptTranslator\n@Inject\nprivate ConceptTranslator conceptTranslator;\n\nexistingDrug.setConcept(conceptTranslator.toOpenmrsType(med.getCode()));", "author": "corneliouzbett", "createdAt": "2020-03-03T12:05:44Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/MedicationTranslatorImpl.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.translators.impl;\n+\n+import javax.inject.Inject;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hl7.fhir.r4.model.CodeableConcept;\n+import org.hl7.fhir.r4.model.Coding;\n+import org.hl7.fhir.r4.model.Medication;\n+import org.openmrs.Drug;\n+import org.openmrs.DrugIngredient;\n+import org.openmrs.module.fhir2.FhirConstants;\n+import org.openmrs.module.fhir2.api.FhirConceptService;\n+import org.openmrs.module.fhir2.api.translators.MedicationTranslator;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Setter(AccessLevel.PACKAGE)\n+public class MedicationTranslatorImpl implements MedicationTranslator {\n+\t\n+\t@Inject\n+\tprivate FhirConceptService conceptService;\n+\t\n+\t@Override\n+\tpublic Medication toFhirResource(Drug drug) {\n+\t\tif (drug == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\t\n+\t\tMedication medication = new Medication();\n+\t\tmedication.setId(drug.getUuid());\n+\t\tmedication.setCode(new CodeableConcept().addCoding(new Coding(FhirConstants.MEDICATION_CODES_VALUE_SET_URI,\n+\t\t        drug.getConcept().getUuid(), drug.getConcept().getDisplayString())));\n+\t\tmedication.setForm(new CodeableConcept().addCoding(new Coding(FhirConstants.MEDICATION_FORM_VALUE_SET_URI,\n+\t\t        drug.getDosageForm().getUuid(), drug.getDosageForm().getDisplayString())));\n+\t\t\n+\t\tMedication.MedicationIngredientComponent ingredient = new Medication.MedicationIngredientComponent();\n+\t\tCodeableConcept ingredientCode = new CodeableConcept();\n+\t\tfor (DrugIngredient val : drug.getIngredients()) {\n+\t\t\tingredientCode.addCoding(new Coding(FhirConstants.MEDICATION_INGREDIENT_VALUE_SET_URI,\n+\t\t\t        val.getIngredient().getUuid(), val.getIngredient().getDisplayString()));\n+\t\t\t\n+\t\t\tingredient.setItem(ingredientCode);\n+\t\t}\n+\t\tmedication.addIngredient(ingredient);\n+\t\t\n+\t\treturn medication;\n+\t}\n+\t\n+\t@Override\n+\tpublic Drug toOpenmrsType(Drug existingDrug, Medication med) {\n+\t\tif (med == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\texistingDrug.setUuid(med.getId());\n+\t\t\n+\t\tif (med.hasCode()) {\n+\t\t\texistingDrug\n+\t\t\t        .setConcept(conceptService.getConceptByUuid(med.getCode().getCoding().get(0).getCode()).orElse(null));", "originalCommit": "8e8b6a5166fad4c324bb039d09fca3d24652d6a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NjIzMQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/101#discussion_r386976231", "bodyText": "Ditto", "author": "corneliouzbett", "createdAt": "2020-03-03T12:06:03Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/impl/MedicationTranslatorImpl.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.translators.impl;\n+\n+import javax.inject.Inject;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+\n+import lombok.AccessLevel;\n+import lombok.Setter;\n+import org.hl7.fhir.r4.model.CodeableConcept;\n+import org.hl7.fhir.r4.model.Coding;\n+import org.hl7.fhir.r4.model.Medication;\n+import org.openmrs.Drug;\n+import org.openmrs.DrugIngredient;\n+import org.openmrs.module.fhir2.FhirConstants;\n+import org.openmrs.module.fhir2.api.FhirConceptService;\n+import org.openmrs.module.fhir2.api.translators.MedicationTranslator;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+@Setter(AccessLevel.PACKAGE)\n+public class MedicationTranslatorImpl implements MedicationTranslator {\n+\t\n+\t@Inject\n+\tprivate FhirConceptService conceptService;\n+\t\n+\t@Override\n+\tpublic Medication toFhirResource(Drug drug) {\n+\t\tif (drug == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\t\n+\t\tMedication medication = new Medication();\n+\t\tmedication.setId(drug.getUuid());\n+\t\tmedication.setCode(new CodeableConcept().addCoding(new Coding(FhirConstants.MEDICATION_CODES_VALUE_SET_URI,\n+\t\t        drug.getConcept().getUuid(), drug.getConcept().getDisplayString())));\n+\t\tmedication.setForm(new CodeableConcept().addCoding(new Coding(FhirConstants.MEDICATION_FORM_VALUE_SET_URI,\n+\t\t        drug.getDosageForm().getUuid(), drug.getDosageForm().getDisplayString())));\n+\t\t\n+\t\tMedication.MedicationIngredientComponent ingredient = new Medication.MedicationIngredientComponent();\n+\t\tCodeableConcept ingredientCode = new CodeableConcept();\n+\t\tfor (DrugIngredient val : drug.getIngredients()) {\n+\t\t\tingredientCode.addCoding(new Coding(FhirConstants.MEDICATION_INGREDIENT_VALUE_SET_URI,\n+\t\t\t        val.getIngredient().getUuid(), val.getIngredient().getDisplayString()));\n+\t\t\t\n+\t\t\tingredient.setItem(ingredientCode);\n+\t\t}\n+\t\tmedication.addIngredient(ingredient);\n+\t\t\n+\t\treturn medication;\n+\t}\n+\t\n+\t@Override\n+\tpublic Drug toOpenmrsType(Drug existingDrug, Medication med) {\n+\t\tif (med == null) {\n+\t\t\treturn null;\n+\t\t}\n+\t\texistingDrug.setUuid(med.getId());\n+\t\t\n+\t\tif (med.hasCode()) {\n+\t\t\texistingDrug\n+\t\t\t        .setConcept(conceptService.getConceptByUuid(med.getCode().getCoding().get(0).getCode()).orElse(null));\n+\t\t}\n+\t\t\n+\t\tif (med.hasForm()) {\n+\t\t\texistingDrug\n+\t\t\t        .setDosageForm(conceptService.getConceptByUuid(med.getForm().getCoding().get(0).getCode()).orElse(null));", "originalCommit": "8e8b6a5166fad4c324bb039d09fca3d24652d6a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Njk3NzM2Mg==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/101#discussion_r386977362", "bodyText": "Document this param", "author": "corneliouzbett", "createdAt": "2020-03-03T12:08:41Z", "path": "api/src/main/java/org/openmrs/module/fhir2/api/translators/MedicationTranslator.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * This Source Code Form is subject to the terms of the Mozilla Public License,\n+ * v. 2.0. If a copy of the MPL was not distributed with this file, You can\n+ * obtain one at http://mozilla.org/MPL/2.0/. OpenMRS is also distributed under\n+ * the terms of the Healthcare Disclaimer located at http://openmrs.org/license.\n+ *\n+ * Copyright (C) OpenMRS Inc. OpenMRS is a registered trademark and the OpenMRS\n+ * graphic logo is a trademark of OpenMRS Inc.\n+ */\n+package org.openmrs.module.fhir2.api.translators;\n+\n+import org.hl7.fhir.r4.model.Medication;\n+import org.openmrs.Drug;\n+\n+public interface MedicationTranslator extends ToFhirTranslator<Drug, Medication>, UpdatableOpenmrsTranslator<Drug, Medication> {\n+\t\n+\t/**\n+\t * Maps {@link org.openmrs.Drug} to {@link org.hl7.fhir.r4.model.Medication}\n+\t *\n+\t * @param drug the OpenMRS data element to translate\n+\t * @return the corresponding FHIR Medication resource\n+\t */\n+\t@Override\n+\tMedication toFhirResource(Drug drug);\n+\t\n+\t/**\n+\t * Maps {@link org.hl7.fhir.r4.model.Medication} to {@link org.openmrs.Drug}\n+\t *\n+\t * @param existingDrug", "originalCommit": "8e8b6a5166fad4c324bb039d09fca3d24652d6a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "48a407dda9aac44436a67872a18772de7c2d0f9b", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/48a407dda9aac44436a67872a18772de7c2d0f9b", "message": "FM-98 : FHIR Medication Resource Initial Implementation", "committedDate": "2020-03-03T12:40:37Z", "type": "forcePushed"}, {"oid": "d9fb88ac73088d6304c8264301048c581f6015ef", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/d9fb88ac73088d6304c8264301048c581f6015ef", "message": "FM-98 : FHIR Medication Resource Initial Implementation", "committedDate": "2020-03-03T12:43:08Z", "type": "forcePushed"}, {"oid": "6154a1f4faf367dd08dc51ecfd1f85f7db84973e", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6154a1f4faf367dd08dc51ecfd1f85f7db84973e", "message": "FM-98 : FHIR Medication Resource Initial Implementation", "committedDate": "2020-03-03T13:23:38Z", "type": "forcePushed"}, {"oid": "c84001799ac42523d53c21abd98b937ee49c90cf", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/c84001799ac42523d53c21abd98b937ee49c90cf", "message": "FM-98 : FHIR Medication Resource Initial Implementation", "committedDate": "2020-03-03T13:27:00Z", "type": "commit"}, {"oid": "c84001799ac42523d53c21abd98b937ee49c90cf", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/c84001799ac42523d53c21abd98b937ee49c90cf", "message": "FM-98 : FHIR Medication Resource Initial Implementation", "committedDate": "2020-03-03T13:27:00Z", "type": "forcePushed"}]}