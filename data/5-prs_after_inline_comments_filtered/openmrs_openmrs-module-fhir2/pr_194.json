{"pr_number": 194, "pr_title": "FM2-193: Generate default narratives provided by HAPI FHIR", "pr_createdAt": "2020-06-04T07:53:08Z", "pr_url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI3ODkwNQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435278905", "bodyText": "Constants should be UPPER_CASE. Also, we have a FhirConstants class for holding this type of information.", "author": "ibacher", "createdAt": "2020-06-04T13:58:13Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -34,6 +35,8 @@\n \t\n \tprivate static final long serialVersionUID = 1L;\n \t\n+\tprotected static final String hapiDefaultNarrativesPropFile = \"classpath:ca/uhn/fhir/narrative/narratives.properties\";", "originalCommit": "9ead16f584ead2d2b141a561128a17fe4e3627d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI4MTg1MQ==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435281851", "bodyText": "Please don't do this this way. The problem here is that you're hard-coding the FhirContext which is actually being set by Spring (see above). The correct thing to do here would be to replace where you have the call to this.setDefaultNarrativeGenerator() with the last line of code:\ngetFhirContext().setNarrativeGenerator(new CustomThymeleafNarrativeGenerator(hapiDefaultNarrativesPropFile));\nThat way, it only depends on the FhirContext that is set by Spring, so that we don't break support for DSTU3 while doing this.\nIt might also be worth thinking about if we could load the ThymeleafNarrativeGenerator from Spring, as this might give us more flexibility in defining the property files to load, instead of needing to know about them ahead of time.", "author": "ibacher", "createdAt": "2020-06-04T14:02:03Z", "path": "omod/src/main/java/org/openmrs/module/fhir2/web/servlet/FhirRestServlet.java", "diffHunk": "@@ -92,4 +97,9 @@ public void setResourceProviders(Collection<IResourceProvider> theProviders) {\n \tpublic void setServerAddressStrategy(IServerAddressStrategy theServerAddressStrategy) {\n \t\tsuper.setServerAddressStrategy(theServerAddressStrategy);\n \t}\n+\t\n+\tprotected void setDefaultNarrativeGenerator() {\n+\t\tthis.setFhirContext(FhirContext.forR4());\n+\t\tgetFhirContext().setNarrativeGenerator(new CustomThymeleafNarrativeGenerator(hapiDefaultNarrativesPropFile));\n+\t}", "originalCommit": "9ead16f584ead2d2b141a561128a17fe4e3627d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMyMjY5Nw==", "url": "https://github.com/openmrs/openmrs-module-fhir2/pull/194#discussion_r435322697", "bodyText": "Okay, I'll do the changes.", "author": "ShivanshRakesh", "createdAt": "2020-06-04T14:54:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTI4MTg1MQ=="}], "type": "inlineReview"}, {"oid": "15e7fd07a99b3d9a49b5149fd98e00db15af0e2a", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/15e7fd07a99b3d9a49b5149fd98e00db15af0e2a", "message": "FM2-193: Generating HAPI Default Narratives", "committedDate": "2020-06-04T15:08:07Z", "type": "forcePushed"}, {"oid": "a8f9d80fddfc0f549fa846734c1aaa05e45106bb", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/a8f9d80fddfc0f549fa846734c1aaa05e45106bb", "message": "FM2-193: Generating HAPI Default Narratives", "committedDate": "2020-06-04T17:22:53Z", "type": "commit"}, {"oid": "a8f9d80fddfc0f549fa846734c1aaa05e45106bb", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/a8f9d80fddfc0f549fa846734c1aaa05e45106bb", "message": "FM2-193: Generating HAPI Default Narratives", "committedDate": "2020-06-04T17:22:53Z", "type": "forcePushed"}, {"oid": "6e07d7925c362107383f8f20e62b4d531b803796", "url": "https://github.com/openmrs/openmrs-module-fhir2/commit/6e07d7925c362107383f8f20e62b4d531b803796", "message": "Update pom.xml", "committedDate": "2020-06-04T18:25:26Z", "type": "commit"}]}