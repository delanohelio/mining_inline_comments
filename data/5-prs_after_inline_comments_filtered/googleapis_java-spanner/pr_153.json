{"pr_number": 153, "pr_title": "fix: fix flaky test and remove warnings", "pr_createdAt": "2020-04-15T05:52:49Z", "pr_url": "https://github.com/googleapis/java-spanner/pull/153", "timeline": [{"oid": "b27a6a0f92c392524692d8240be17868733f4a90", "url": "https://github.com/googleapis/java-spanner/commit/b27a6a0f92c392524692d8240be17868733f4a90", "message": "fix: fix flaky test and remove warnings\n\nThe test should check for at most baseThreadCount instead of equality,\nas it is possible that the thread pool shuts down one or more of its\nthreads temporarily.\n\nFixes #146", "committedDate": "2020-04-15T05:50:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQzNzMyOA==", "url": "https://github.com/googleapis/java-spanner/pull/153#discussion_r409437328", "bodyText": "Why here shouldn't be isAtMost?\nSame for the following two isEqualTo.", "author": "hengfengli", "createdAt": "2020-04-16T10:05:26Z", "path": "google-cloud-spanner/src/test/java/com/google/cloud/spanner/it/ITSpannerOptionsTest.java", "diffHunk": "@@ -106,29 +101,26 @@ public void testCloseAllThreadsWhenClosingSpanner() throws InterruptedException\n       }\n       // Check the number of threads after the query. Doing a request should initialize a thread\n       // pool for the underlying SpannerClient.\n-      assertThat(\n-          getNumberOfThreadsWithName(SPANNER_THREAD_NAME),\n-          is(equalTo(DEFAULT_NUM_CHANNELS * NUM_THREADS_PER_CHANNEL + baseThreadCount)));\n+      assertThat(getNumberOfThreadsWithName(SPANNER_THREAD_NAME))\n+          .isEqualTo(DEFAULT_NUM_CHANNELS * NUM_THREADS_PER_CHANNEL + baseThreadCount);", "originalCommit": "b27a6a0f92c392524692d8240be17868733f4a90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTUwNjY5Mg==", "url": "https://github.com/googleapis/java-spanner/pull/153#discussion_r409506692", "bodyText": "These threads should all be present as long as the Spanner instance is opened and being used. Closing it would normally bring the number of threads back to the baseThreadCount, but it can happen that additional threads are (temporarily) removed after closing it.", "author": "olavloite", "createdAt": "2020-04-16T12:13:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQzNzMyOA=="}], "type": "inlineReview"}]}