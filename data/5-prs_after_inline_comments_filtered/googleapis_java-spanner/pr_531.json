{"pr_number": 531, "pr_title": "feat: adds options to the write operations", "pr_createdAt": "2020-10-21T00:27:12Z", "pr_url": "https://github.com/googleapis/java-spanner/pull/531", "timeline": [{"oid": "48da5a446867a9d0ce08e766257f997d2122de14", "url": "https://github.com/googleapis/java-spanner/commit/48da5a446867a9d0ce08e766257f997d2122de14", "message": "feat: adds options to the write operations\n\nAdds the possibility of adding options to the write operations and\nencapsulates the write response into it's own class so that we can\naugment the response with more fields than the commit timestamp.", "committedDate": "2020-10-21T01:27:36Z", "type": "commit"}, {"oid": "48da5a446867a9d0ce08e766257f997d2122de14", "url": "https://github.com/googleapis/java-spanner/commit/48da5a446867a9d0ce08e766257f997d2122de14", "message": "feat: adds options to the write operations\n\nAdds the possibility of adding options to the write operations and\nencapsulates the write response into it's own class so that we can\naugment the response with more fields than the commit timestamp.", "committedDate": "2020-10-21T01:27:36Z", "type": "forcePushed"}, {"oid": "5dd32d1096da8ae47af4b03aaf0a9c706ebddfea", "url": "https://github.com/googleapis/java-spanner/commit/5dd32d1096da8ae47af4b03aaf0a9c706ebddfea", "message": "refactor: changes write to transaction option\n\nUpdates WriteOption to TransactionOption and changes the WriteResponse\nto CommitResponse.", "committedDate": "2020-10-21T06:17:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MTM0Nw==", "url": "https://github.com/googleapis/java-spanner/pull/531#discussion_r509061347", "bodyText": "What do you think about WriteOption in place of TransactionOption?", "author": "mayurkale22", "createdAt": "2020-10-21T07:48:40Z", "path": "google-cloud-spanner/src/main/java/com/google/cloud/spanner/DatabaseClient.java", "diffHunk": "@@ -52,6 +53,35 @@\n    */\n   Timestamp write(Iterable<Mutation> mutations) throws SpannerException;\n \n+  /**\n+   * Writes the given mutations atomically to the database with the given options.\n+   *\n+   * <p>This method uses retries and replay protection internally, which means that the mutations\n+   * are applied exactly once on success, or not at all if an error is returned, regardless of any\n+   * failures in the underlying network. Note that if the call is cancelled or reaches deadline, it\n+   * is not possible to know whether the mutations were applied without performing a subsequent\n+   * database operation, but the mutations will have been applied at most once.\n+   *\n+   * <p>Example of blind write.\n+   *\n+   * <pre>{@code\n+   * long singerId = my_singer_id;\n+   * Mutation mutation = Mutation.newInsertBuilder(\"Singer\")\n+   *         .set(\"SingerId\")\n+   *         .to(singerId)\n+   *         .set(\"FirstName\")\n+   *         .to(\"Billy\")\n+   *         .set(\"LastName\")\n+   *         .to(\"Joel\")\n+   *         .build();\n+   * dbClient.writeWithOptions(Collections.singletonList(mutation));\n+   * }</pre>\n+   *\n+   * @return a response with the timestamp at which the write was committed\n+   */\n+  CommitResponse writeWithOptions(Iterable<Mutation> mutations, TransactionOption... options)", "originalCommit": "5dd32d1096da8ae47af4b03aaf0a9c706ebddfea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2OTIwMw==", "url": "https://github.com/googleapis/java-spanner/pull/531#discussion_r509069203", "bodyText": "Thiago and I had a short discussion about this, and we think TransactionOption is better in this case, as we intend to also use this for options that we will need for normal read/write transactions.", "author": "olavloite", "createdAt": "2020-10-21T08:01:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MTM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTQzMzY0NQ==", "url": "https://github.com/googleapis/java-spanner/pull/531#discussion_r509433645", "bodyText": "Ok sgtm", "author": "mayurkale22", "createdAt": "2020-10-21T16:33:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTA2MTM0Nw=="}], "type": "inlineReview"}, {"oid": "902915f6f2a0e01d39ecf1492aae8bdd6bb51a54", "url": "https://github.com/googleapis/java-spanner/commit/902915f6f2a0e01d39ecf1492aae8bdd6bb51a54", "message": "Merge branch 'master' into write-with-options", "committedDate": "2020-10-22T00:52:44Z", "type": "commit"}]}