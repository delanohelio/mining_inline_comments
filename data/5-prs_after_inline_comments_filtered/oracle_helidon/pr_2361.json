{"pr_number": 2361, "pr_title": "ClassPathContentHandler can survive tmp folder cleanup", "pr_createdAt": "2020-09-15T11:02:17Z", "pr_url": "https://github.com/oracle/helidon/pull/2361", "timeline": [{"oid": "006bd5dacc6f8e0d853a5e08865c77bacefdb239", "url": "https://github.com/oracle/helidon/commit/006bd5dacc6f8e0d853a5e08865c77bacefdb239", "message": "ClassPathContentHandler can survive tmp folder cleanup\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-09-15T11:00:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyODc2NQ==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r488628765", "bodyText": "Do not use LOGGER.info even in tests.", "author": "tomas-langer", "createdAt": "2020-09-15T12:33:23Z", "path": "webserver/webserver/src/test/java/io/helidon/webserver/UnstableTempTest.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.webserver;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.concurrent.Flow;\n+import java.util.function.Function;\n+import java.util.jar.Attributes;\n+import java.util.jar.JarEntry;\n+import java.util.jar.JarOutputStream;\n+import java.util.jar.Manifest;\n+import java.util.logging.Logger;\n+\n+import io.helidon.common.http.DataChunk;\n+import io.helidon.common.http.HashParameters;\n+import io.helidon.common.http.Http;\n+import io.helidon.common.reactive.Single;\n+import io.helidon.media.common.MessageBodyWriterContext;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+\n+public class UnstableTempTest {\n+\n+    private static final Logger LOGGER = Logger.getLogger(UnstableTempTest.class.getName());\n+\n+    private static final String JAR_NAME = \"test.jar\";\n+    private static final String FILE_NAME = \"test.js\";\n+    private static final String FILE_CONTENT = \"alert(\\\"Hello, World!\\\");\";\n+\n+    @Test\n+    void cleanedTmpDuringRuntime() throws IOException {\n+        List<String> contents = new ArrayList<>(2);\n+\n+        Path jar = createJar();\n+        URL jarUrl = new URL(\"jar:file:\" + jar.toUri().getPath() + \"!/\" + FILE_NAME);\n+        LOGGER.info(\"Generated test jar url: \" + jarUrl.toString());\n+        ClassPathContentHandler classPathContentHandler =\n+                new ClassPathContentHandler(\"index.html\",\n+                        new ContentTypeSelector(null),\n+                        \"/\",\n+                        Thread.currentThread().getContextClassLoader());\n+\n+        // Empty headers\n+        RequestHeaders headers = mock(RequestHeaders.class);\n+        when(headers.isAccepted(any())).thenReturn(true);\n+        when(headers.acceptedTypes()).thenReturn(Collections.emptyList());\n+        ResponseHeaders responseHeaders = mock(ResponseHeaders.class);\n+\n+        ServerRequest request = Mockito.mock(ServerRequest.class);\n+        Mockito.when(request.headers()).thenReturn(headers);\n+        ServerResponse response = Mockito.mock(ServerResponse.class);\n+        MessageBodyWriterContext ctx = MessageBodyWriterContext.create(HashParameters.create());\n+        ctx.registerFilter(dataChunkPub -> {\n+            String fileContent = new String(Single.create(dataChunkPub).await().bytes());\n+            contents.add(fileContent);\n+            return Single.just(DataChunk.create(ByteBuffer.wrap(fileContent.getBytes())));\n+        });\n+        Mockito.when(response.headers()).thenReturn(responseHeaders);\n+        Mockito.when(response.send(Mockito.any(Function.class))).then(mock -> {\n+            Function<MessageBodyWriterContext, Flow.Publisher<DataChunk>> argument = mock.getArgument(0);\n+            return Single.create(argument.apply(ctx)).onError(throwable -> throwable.printStackTrace());\n+        });\n+\n+        classPathContentHandler.sendJar(Http.Method.GET, FILE_NAME, jarUrl, request, response);\n+        deleteTmpFiles();\n+        classPathContentHandler.sendJar(Http.Method.GET, FILE_NAME, jarUrl, request, response);\n+\n+        assertThat(contents, containsInAnyOrder(FILE_CONTENT, FILE_CONTENT));\n+    }\n+\n+    private void deleteTmpFiles() throws IOException {\n+        File tempDir = File.createTempFile(\"tempLocator\", \"je\").getParentFile();\n+        LOGGER.info(\"Temp dir: \" + tempDir.getAbsolutePath());", "originalCommit": "006bd5dacc6f8e0d853a5e08865c77bacefdb239", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI1MTgzNQ==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r489251835", "bodyText": "fixed", "author": "danielkec", "createdAt": "2020-09-16T08:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyODc2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyOTI1OA==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r488629258", "bodyText": "Use new I/O APIs (e.g. Path in this case)", "author": "tomas-langer", "createdAt": "2020-09-15T12:34:16Z", "path": "webserver/webserver/src/test/java/io/helidon/webserver/UnstableTempTest.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.webserver;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.concurrent.Flow;\n+import java.util.function.Function;\n+import java.util.jar.Attributes;\n+import java.util.jar.JarEntry;\n+import java.util.jar.JarOutputStream;\n+import java.util.jar.Manifest;\n+import java.util.logging.Logger;\n+\n+import io.helidon.common.http.DataChunk;\n+import io.helidon.common.http.HashParameters;\n+import io.helidon.common.http.Http;\n+import io.helidon.common.reactive.Single;\n+import io.helidon.media.common.MessageBodyWriterContext;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+\n+public class UnstableTempTest {\n+\n+    private static final Logger LOGGER = Logger.getLogger(UnstableTempTest.class.getName());\n+\n+    private static final String JAR_NAME = \"test.jar\";\n+    private static final String FILE_NAME = \"test.js\";\n+    private static final String FILE_CONTENT = \"alert(\\\"Hello, World!\\\");\";\n+\n+    @Test\n+    void cleanedTmpDuringRuntime() throws IOException {\n+        List<String> contents = new ArrayList<>(2);\n+\n+        Path jar = createJar();\n+        URL jarUrl = new URL(\"jar:file:\" + jar.toUri().getPath() + \"!/\" + FILE_NAME);\n+        LOGGER.info(\"Generated test jar url: \" + jarUrl.toString());\n+        ClassPathContentHandler classPathContentHandler =\n+                new ClassPathContentHandler(\"index.html\",\n+                        new ContentTypeSelector(null),\n+                        \"/\",\n+                        Thread.currentThread().getContextClassLoader());\n+\n+        // Empty headers\n+        RequestHeaders headers = mock(RequestHeaders.class);\n+        when(headers.isAccepted(any())).thenReturn(true);\n+        when(headers.acceptedTypes()).thenReturn(Collections.emptyList());\n+        ResponseHeaders responseHeaders = mock(ResponseHeaders.class);\n+\n+        ServerRequest request = Mockito.mock(ServerRequest.class);\n+        Mockito.when(request.headers()).thenReturn(headers);\n+        ServerResponse response = Mockito.mock(ServerResponse.class);\n+        MessageBodyWriterContext ctx = MessageBodyWriterContext.create(HashParameters.create());\n+        ctx.registerFilter(dataChunkPub -> {\n+            String fileContent = new String(Single.create(dataChunkPub).await().bytes());\n+            contents.add(fileContent);\n+            return Single.just(DataChunk.create(ByteBuffer.wrap(fileContent.getBytes())));\n+        });\n+        Mockito.when(response.headers()).thenReturn(responseHeaders);\n+        Mockito.when(response.send(Mockito.any(Function.class))).then(mock -> {\n+            Function<MessageBodyWriterContext, Flow.Publisher<DataChunk>> argument = mock.getArgument(0);\n+            return Single.create(argument.apply(ctx)).onError(throwable -> throwable.printStackTrace());\n+        });\n+\n+        classPathContentHandler.sendJar(Http.Method.GET, FILE_NAME, jarUrl, request, response);\n+        deleteTmpFiles();\n+        classPathContentHandler.sendJar(Http.Method.GET, FILE_NAME, jarUrl, request, response);\n+\n+        assertThat(contents, containsInAnyOrder(FILE_CONTENT, FILE_CONTENT));\n+    }\n+\n+    private void deleteTmpFiles() throws IOException {\n+        File tempDir = File.createTempFile(\"tempLocator\", \"je\").getParentFile();", "originalCommit": "006bd5dacc6f8e0d853a5e08865c77bacefdb239", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI1MTkyNQ==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r489251925", "bodyText": "Fixed", "author": "danielkec", "createdAt": "2020-09-16T08:19:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYyOTI1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzMDExOA==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r488630118", "bodyText": "This may be a big performance issue for the test if the temporary directory contains a lot of files.", "author": "tomas-langer", "createdAt": "2020-09-15T12:35:39Z", "path": "webserver/webserver/src/test/java/io/helidon/webserver/UnstableTempTest.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.webserver;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.concurrent.Flow;\n+import java.util.function.Function;\n+import java.util.jar.Attributes;\n+import java.util.jar.JarEntry;\n+import java.util.jar.JarOutputStream;\n+import java.util.jar.Manifest;\n+import java.util.logging.Logger;\n+\n+import io.helidon.common.http.DataChunk;\n+import io.helidon.common.http.HashParameters;\n+import io.helidon.common.http.Http;\n+import io.helidon.common.reactive.Single;\n+import io.helidon.media.common.MessageBodyWriterContext;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+\n+public class UnstableTempTest {\n+\n+    private static final Logger LOGGER = Logger.getLogger(UnstableTempTest.class.getName());\n+\n+    private static final String JAR_NAME = \"test.jar\";\n+    private static final String FILE_NAME = \"test.js\";\n+    private static final String FILE_CONTENT = \"alert(\\\"Hello, World!\\\");\";\n+\n+    @Test\n+    void cleanedTmpDuringRuntime() throws IOException {\n+        List<String> contents = new ArrayList<>(2);\n+\n+        Path jar = createJar();\n+        URL jarUrl = new URL(\"jar:file:\" + jar.toUri().getPath() + \"!/\" + FILE_NAME);\n+        LOGGER.info(\"Generated test jar url: \" + jarUrl.toString());\n+        ClassPathContentHandler classPathContentHandler =\n+                new ClassPathContentHandler(\"index.html\",\n+                        new ContentTypeSelector(null),\n+                        \"/\",\n+                        Thread.currentThread().getContextClassLoader());\n+\n+        // Empty headers\n+        RequestHeaders headers = mock(RequestHeaders.class);\n+        when(headers.isAccepted(any())).thenReturn(true);\n+        when(headers.acceptedTypes()).thenReturn(Collections.emptyList());\n+        ResponseHeaders responseHeaders = mock(ResponseHeaders.class);\n+\n+        ServerRequest request = Mockito.mock(ServerRequest.class);\n+        Mockito.when(request.headers()).thenReturn(headers);\n+        ServerResponse response = Mockito.mock(ServerResponse.class);\n+        MessageBodyWriterContext ctx = MessageBodyWriterContext.create(HashParameters.create());\n+        ctx.registerFilter(dataChunkPub -> {\n+            String fileContent = new String(Single.create(dataChunkPub).await().bytes());\n+            contents.add(fileContent);\n+            return Single.just(DataChunk.create(ByteBuffer.wrap(fileContent.getBytes())));\n+        });\n+        Mockito.when(response.headers()).thenReturn(responseHeaders);\n+        Mockito.when(response.send(Mockito.any(Function.class))).then(mock -> {\n+            Function<MessageBodyWriterContext, Flow.Publisher<DataChunk>> argument = mock.getArgument(0);\n+            return Single.create(argument.apply(ctx)).onError(throwable -> throwable.printStackTrace());\n+        });\n+\n+        classPathContentHandler.sendJar(Http.Method.GET, FILE_NAME, jarUrl, request, response);\n+        deleteTmpFiles();\n+        classPathContentHandler.sendJar(Http.Method.GET, FILE_NAME, jarUrl, request, response);\n+\n+        assertThat(contents, containsInAnyOrder(FILE_CONTENT, FILE_CONTENT));\n+    }\n+\n+    private void deleteTmpFiles() throws IOException {\n+        File tempDir = File.createTempFile(\"tempLocator\", \"je\").getParentFile();\n+        LOGGER.info(\"Temp dir: \" + tempDir.getAbsolutePath());\n+        //Delete all temp files\n+        for (File file : Objects.requireNonNull(tempDir.listFiles((dir, name) -> name.endsWith(\".je\")))) {", "originalCommit": "006bd5dacc6f8e0d853a5e08865c77bacefdb239", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzNjg0Ng==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r488636846", "bodyText": "I think it would be best to allow an explicit folder to be configured for static content handler, and then send a new folder from this test as the configured value.\nThen you can simply delete all files in that folder to simulate the cleanup", "author": "tomas-langer", "createdAt": "2020-09-15T12:46:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzMDExOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTI1MjExMA==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r489252110", "bodyText": "Great idea thx", "author": "danielkec", "createdAt": "2020-09-16T08:19:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODYzMDExOA=="}], "type": "inlineReview"}, {"oid": "243f3fc2970404ed7692b39e868e0185ec75fadf", "url": "https://github.com/oracle/helidon/commit/243f3fc2970404ed7692b39e868e0185ec75fadf", "message": "Configurable temp dir for extracting static content from jar\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-09-15T13:51:08Z", "type": "commit"}, {"oid": "cc26f8ad08c6a97f629b39081853e38deb30ea3e", "url": "https://github.com/oracle/helidon/commit/cc26f8ad08c6a97f629b39081853e38deb30ea3e", "message": "NPE fix\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-09-15T14:11:50Z", "type": "commit"}, {"oid": "010e4235698a164ba0f379b714ea9b9a85de68fc", "url": "https://github.com/oracle/helidon/commit/010e4235698a164ba0f379b714ea9b9a85de68fc", "message": "Use Path instead of File\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-09-15T14:25:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzNTMzOQ==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r493835339", "bodyText": "As this is part of production code, the property name should follow convention.\nAlso directory is more commonly used.\nSo probably tmp-dir is the right configuration here", "author": "tomas-langer", "createdAt": "2020-09-23T19:14:28Z", "path": "microprofile/server/src/main/java/io/helidon/microprofile/server/ServerCdiExtension.java", "diffHunk": "@@ -212,6 +212,9 @@ private void registerClasspathStaticContent(Config config) {\n         cpBuilder.welcomeFileName(config.get(\"welcome\")\n                                           .asString()\n                                           .orElse(\"index.html\"));\n+        config.get(\"tempFolder\")", "originalCommit": "010e4235698a164ba0f379b714ea9b9a85de68fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE2MTQxNQ==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r496161415", "bodyText": "fixed", "author": "danielkec", "createdAt": "2020-09-28T18:48:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzNTMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzNjE2Mw==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r493836163", "bodyText": "please rename to temporaryDirectory or tmpDir. I think both temp and folder are less used", "author": "tomas-langer", "createdAt": "2020-09-23T19:15:59Z", "path": "webserver/webserver/src/main/java/io/helidon/webserver/StaticContentSupport.java", "diffHunk": "@@ -195,6 +196,17 @@ public Builder welcomeFileName(String welcomeFileName) {\n             return this;\n         }\n \n+        /**\n+         * Sets custom temporary folder for extracting static content from a jar.\n+         *\n+         * @param tempFolder custom temporary folder\n+         * @return updated builder\n+         */\n+        public Builder tempFolder(Path tempFolder) {", "originalCommit": "010e4235698a164ba0f379b714ea9b9a85de68fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE2MTU3MA==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r496161570", "bodyText": "np", "author": "danielkec", "createdAt": "2020-09-28T18:48:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzNjE2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzNjY2NA==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r493836664", "bodyText": "Naming convention - this should be tmpDir or tempDir - all upper case is reserved for constants", "author": "tomas-langer", "createdAt": "2020-09-23T19:17:00Z", "path": "webserver/webserver/src/test/java/io/helidon/webserver/UnstableTempTest.java", "diffHunk": "@@ -0,0 +1,142 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.webserver;\n+\n+import java.io.BufferedOutputStream;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.net.URL;\n+import java.nio.ByteBuffer;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.concurrent.Flow;\n+import java.util.function.Function;\n+import java.util.jar.Attributes;\n+import java.util.jar.JarEntry;\n+import java.util.jar.JarOutputStream;\n+import java.util.jar.Manifest;\n+import java.util.logging.Logger;\n+\n+import io.helidon.common.http.DataChunk;\n+import io.helidon.common.http.HashParameters;\n+import io.helidon.common.http.Http;\n+import io.helidon.common.reactive.Single;\n+import io.helidon.media.common.MessageBodyWriterContext;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.containsInAnyOrder;\n+import static org.junit.jupiter.api.Assertions.fail;\n+import static org.mockito.ArgumentMatchers.any;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+import org.junit.jupiter.api.BeforeAll;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+\n+public class UnstableTempTest {\n+\n+    private static final Logger LOGGER = Logger.getLogger(UnstableTempTest.class.getName());\n+\n+    private static final String JAR_NAME = \"test.jar\";\n+    private static final String FILE_NAME = \"test.js\";\n+    private static final String FILE_CONTENT = \"alert(\\\"Hello, World!\\\");\";\n+    private static Path TEMP_DIR;", "originalCommit": "010e4235698a164ba0f379b714ea9b9a85de68fc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE2MTQ4Nw==", "url": "https://github.com/oracle/helidon/pull/2361#discussion_r496161487", "bodyText": "fixed", "author": "danielkec", "createdAt": "2020-09-28T18:48:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzNjY2NA=="}], "type": "inlineReview"}, {"oid": "c56c303a6b569ea7484293573013b9ea7bd5065f", "url": "https://github.com/oracle/helidon/commit/c56c303a6b569ea7484293573013b9ea7bd5065f", "message": "Review issues\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-09-28T18:50:53Z", "type": "commit"}]}