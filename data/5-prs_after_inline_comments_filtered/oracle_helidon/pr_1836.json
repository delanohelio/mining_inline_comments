{"pr_number": 1836, "pr_title": "Add JSONB support to gRPC", "pr_createdAt": "2020-05-20T12:07:01Z", "pr_url": "https://github.com/oracle/helidon/pull/1836", "timeline": [{"oid": "3fbe31543494180d9147efbbae31fe4ee38866fb", "url": "https://github.com/oracle/helidon/commit/3fbe31543494180d9147efbbae31fe4ee38866fb", "message": "Publish snapshots to Synoki Nexus", "committedDate": "2020-05-20T09:45:50Z", "type": "commit"}, {"oid": "66cfdf0d0d1e72dd5fc18f3675d7116855b47c5d", "url": "https://github.com/oracle/helidon/commit/66cfdf0d0d1e72dd5fc18f3675d7116855b47c5d", "message": "Add JSONB support to gRPC", "committedDate": "2020-05-20T12:04:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk3OTg3NA==", "url": "https://github.com/oracle/helidon/pull/1836#discussion_r427979874", "bodyText": "Is the usage of public constructor for a marshaller a standard?\nIf not, please change to create() factory method.", "author": "tomas-langer", "createdAt": "2020-05-20T12:47:00Z", "path": "grpc/core/src/main/java/io/helidon/grpc/core/JsonbMarshaller.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright (c) 2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.grpc.core;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.nio.charset.StandardCharsets;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Named;\n+import javax.json.bind.Jsonb;\n+import javax.json.bind.JsonbBuilder;\n+\n+import io.grpc.MethodDescriptor;\n+\n+/**\n+ * An implementation of a gRPC {@link MethodDescriptor.Marshaller} that\n+ * uses JSONB for serialization.\n+ *\n+ * @param <T>  the type of value to be marshalled\n+ */\n+public class JsonbMarshaller<T>\n+        implements MethodDescriptor.Marshaller<T> {\n+\n+    private static final Jsonb JSONB = JsonbBuilder.create();\n+\n+    private final Class<T> clazz;\n+\n+    /**\n+     * Construct {@code JsonbMarshaller} instance.\n+     *\n+     * @param clazz  the type of object to marshall\n+     */\n+    public JsonbMarshaller(Class<T> clazz) {", "originalCommit": "66cfdf0d0d1e72dd5fc18f3675d7116855b47c5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAyNjY0Ng==", "url": "https://github.com/oracle/helidon/pull/1836#discussion_r428026646", "bodyText": "I made it package private instead", "author": "aseovic", "createdAt": "2020-05-20T13:49:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk3OTg3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4MTgxNQ==", "url": "https://github.com/oracle/helidon/pull/1836#discussion_r427981815", "bodyText": "The name Supplier conflicts with JDK's supplier. I think this should be named differently.", "author": "tomas-langer", "createdAt": "2020-05-20T12:49:59Z", "path": "grpc/core/src/main/java/io/helidon/grpc/core/JsonbMarshaller.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Copyright (c) 2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.helidon.grpc.core;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.InputStream;\n+import java.nio.charset.StandardCharsets;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.inject.Named;\n+import javax.json.bind.Jsonb;\n+import javax.json.bind.JsonbBuilder;\n+\n+import io.grpc.MethodDescriptor;\n+\n+/**\n+ * An implementation of a gRPC {@link MethodDescriptor.Marshaller} that\n+ * uses JSONB for serialization.\n+ *\n+ * @param <T>  the type of value to be marshalled\n+ */\n+public class JsonbMarshaller<T>\n+        implements MethodDescriptor.Marshaller<T> {\n+\n+    private static final Jsonb JSONB = JsonbBuilder.create();\n+\n+    private final Class<T> clazz;\n+\n+    /**\n+     * Construct {@code JsonbMarshaller} instance.\n+     *\n+     * @param clazz  the type of object to marshall\n+     */\n+    public JsonbMarshaller(Class<T> clazz) {\n+        this.clazz = clazz;\n+    }\n+\n+    @Override\n+    public InputStream stream(T obj) {\n+        return new ByteArrayInputStream(JSONB.toJson(obj).getBytes(StandardCharsets.UTF_8));\n+    }\n+\n+    @Override\n+    public T parse(InputStream in) {\n+        return JSONB.fromJson(in, clazz);\n+    }\n+\n+    /**\n+     * A {@link MarshallerSupplier} implementation that supplies\n+     * instances of {@link JsonbMarshaller}.\n+     */\n+    @Named(\"jsonb\")\n+    @ApplicationScoped\n+    public static class Supplier implements MarshallerSupplier {", "originalCommit": "66cfdf0d0d1e72dd5fc18f3675d7116855b47c5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAyODE1NA==", "url": "https://github.com/oracle/helidon/pull/1836#discussion_r428028154", "bodyText": "It's an inner class, it's never used directly (only via ServiceLoader), and we already have a precedent in JavaMarshaller.Supplier, so it's probably best to leave it as is. Nobody will ever import it...", "author": "aseovic", "createdAt": "2020-05-20T13:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk4MTgxNQ=="}], "type": "inlineReview"}, {"oid": "458410a42ea6427b14d9279c053d1c5612516e7a", "url": "https://github.com/oracle/helidon/commit/458410a42ea6427b14d9279c053d1c5612516e7a", "message": "module-info and pom.xml cleanup", "committedDate": "2020-05-20T13:25:07Z", "type": "commit"}, {"oid": "72123bd39d2691ab012f71f5ea4b673d3cecde61", "url": "https://github.com/oracle/helidon/commit/72123bd39d2691ab012f71f5ea4b673d3cecde61", "message": "make JsonbMarshaller constructor package private", "committedDate": "2020-05-20T13:40:11Z", "type": "commit"}]}