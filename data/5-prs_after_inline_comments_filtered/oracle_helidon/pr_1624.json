{"pr_number": 1624, "pr_title": "Changed the default context root for Websocket endpoints", "pr_createdAt": "2020-04-08T17:42:08Z", "pr_url": "https://github.com/oracle/helidon/pull/1624", "timeline": [{"oid": "3e7fcd2239972180130f2e78c887732fcc997cd7", "url": "https://github.com/oracle/helidon/commit/3e7fcd2239972180130f2e78c887732fcc997cd7", "message": "Changed the default context root for Websocket endpoints to be \"/\", just like for REST. Improved testing of endpoints with and without using the default context root. One additional test that mixes REST resources and Websocket endpoints in same application.", "committedDate": "2020-04-08T17:39:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcxMzkwMA==", "url": "https://github.com/oracle/helidon/pull/1624#discussion_r405713900", "bodyText": "I know there have been discussions about avoiding fixed ports because of conflicts on shared systems or parallel tests. Is this opening us up to that problem?", "author": "tjquinno", "createdAt": "2020-04-08T18:04:31Z", "path": "microprofile/websocket/src/test/java/io/helidon/microprofile/tyrus/WebSocketBaseTest.java", "diffHunk": "@@ -26,71 +30,33 @@\n import javax.websocket.OnMessage;\n import javax.websocket.OnOpen;\n import javax.websocket.Session;\n-import javax.websocket.server.ServerApplicationConfig;\n import javax.websocket.server.ServerEndpoint;\n-import javax.websocket.server.ServerEndpointConfig;\n-\n-import java.io.IOException;\n-import java.net.URI;\n-import java.util.Collections;\n-import java.util.Set;\n-import java.util.logging.Logger;\n \n-import io.helidon.microprofile.server.RoutingPath;\n-import io.helidon.microprofile.server.Server;\n import org.junit.jupiter.api.AfterAll;\n-import org.junit.jupiter.api.BeforeAll;\n import org.junit.jupiter.api.Test;\n \n /**\n- * Class WebSocketAppTest.\n+ * Class WebSocketBaseTest.\n  */\n-public class WebSocketAppTest {\n-\n-    private static Server server;\n+public abstract class WebSocketBaseTest {\n \n-    @BeforeAll\n-    static void initClass() {\n-        Server.Builder builder = Server.builder();\n-        server = builder.build();\n-        server.start();\n-    }\n+    static final int DEFAULT_PORT = 7001;\n+    static SeContainer container;\n \n     @AfterAll\n     static void destroyClass() {\n-        server.stop();\n+        container.close();\n     }\n \n-    @Test\n-    public void testEchoAnnot() throws Exception {\n-        URI echoUri = URI.create(\"ws://localhost:\" + server.port() + \"/web/echoAnnot\");\n-        EchoClient echoClient = new EchoClient(echoUri);\n-        echoClient.echo(\"hi\", \"how are you?\");\n-    }\n+    public abstract String context();\n \n     @Test\n-    public void testEchoProg() throws Exception {\n-        URI echoUri = URI.create(\"ws://localhost:\" + server.port() + \"/web/echoProg\");\n+    public void testEchoAnnot() throws Exception {\n+        URI echoUri = URI.create(\"ws://localhost:\" + DEFAULT_PORT + context() + \"/echoAnnot\");", "originalCommit": "3e7fcd2239972180130f2e78c887732fcc997cd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcyNDU3Mw==", "url": "https://github.com/oracle/helidon/pull/1624#discussion_r405724573", "bodyText": "Possibly. I had to switch the startup code to use CDI so I can register beans directly and I don't have access to the server port anymore. The old test was always starting on the default port anyway. So it shouldn't be worse than before, but it does not mean is great.", "author": "spericas", "createdAt": "2020-04-08T18:22:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcxMzkwMA=="}], "type": "inlineReview"}, {"oid": "4b7eaf402aa3d33a02c0a66f16eea4810dfa91ca", "url": "https://github.com/oracle/helidon/commit/4b7eaf402aa3d33a02c0a66f16eea4810dfa91ca", "message": "Updated class comment.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-04-08T18:25:04Z", "type": "commit"}, {"oid": "36bfafce99814c5a854aa4dc2c03e52d7f928daf", "url": "https://github.com/oracle/helidon/commit/36bfafce99814c5a854aa4dc2c03e52d7f928daf", "message": "Get server port via the CDI extension to avoid hardcoding the default port.", "committedDate": "2020-04-08T18:49:59Z", "type": "commit"}, {"oid": "e848f5a5ea0d6f21bae05f4b37caf15e7e168594", "url": "https://github.com/oracle/helidon/commit/e848f5a5ea0d6f21bae05f4b37caf15e7e168594", "message": "Updated Websocket example after changes to context root.\n\nSigned-off-by: Santiago Pericasgeertsen <santiago.pericasgeertsen@oracle.com>", "committedDate": "2020-04-08T20:05:03Z", "type": "commit"}]}