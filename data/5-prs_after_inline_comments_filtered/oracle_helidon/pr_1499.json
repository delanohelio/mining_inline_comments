{"pr_number": 1499, "pr_title": "Fix completable queue and clean-up of messaging tests", "pr_createdAt": "2020-03-12T09:31:26Z", "pr_url": "https://github.com/oracle/helidon/pull/1499", "timeline": [{"oid": "3a73e2a2d9e1b0c6ffff28c14611aaf020be09dc", "url": "https://github.com/oracle/helidon/commit/3a73e2a2d9e1b0c6ffff28c14611aaf020be09dc", "message": "Clean-up of messaging tests\n\n  * Hamcrestination\n  * Flaky tests fix\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-03-12T09:30:10Z", "type": "commit"}, {"oid": "9f5daede04f6c2b71b43dac0058f2cb7c18b8b3f", "url": "https://github.com/oracle/helidon/commit/9f5daede04f6c2b71b43dac0058f2cb7c18b8b3f", "message": "Apply prefetch with back-pressure for completionStages where possible\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-03-13T07:38:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MTUyMA==", "url": "https://github.com/oracle/helidon/pull/1499#discussion_r392181520", "bodyText": "This is a constant - naming convention wrong, also the actual behavior may be different from what you expect\n\nas soon as you shutdown the executor, all subsequent requests to execute anything would fail, and method awaitShutdown will work for a single class implementing this interface", "author": "tomas-langer", "createdAt": "2020-03-13T11:49:18Z", "path": "microprofile/messaging/src/test/java/io/helidon/microprofile/messaging/AsyncTestBean.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright (c)  2020 Oracle and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ *\n+ */\n+\n+package io.helidon.microprofile.messaging;\n+\n+import java.util.concurrent.ExecutorService;\n+import java.util.concurrent.Executors;\n+import java.util.concurrent.TimeUnit;\n+\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+public interface AsyncTestBean {\n+    ExecutorService executor = Executors.newSingleThreadExecutor();", "originalCommit": "9f5daede04f6c2b71b43dac0058f2cb7c18b8b3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUyMDM4NA==", "url": "https://github.com/oracle/helidon/pull/1499#discussion_r392520384", "bodyText": "Fixed", "author": "danielkec", "createdAt": "2020-03-13T22:57:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MTUyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MjcxNw==", "url": "https://github.com/oracle/helidon/pull/1499#discussion_r392182717", "bodyText": "CountDownLatch.await returns a boolean that tells you whether it succeeded, or timed out. That should be asserted to make sure the CDL completed.", "author": "tomas-langer", "createdAt": "2020-03-13T11:52:01Z", "path": "microprofile/messaging/src/test/java/io/helidon/microprofile/messaging/AssertableTestBean.java", "diffHunk": "@@ -20,10 +20,57 @@\n import java.util.Arrays;\n import java.util.HashSet;\n import java.util.Set;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.TimeUnit;\n+import java.util.concurrent.TimeoutException;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.junit.jupiter.api.Assertions.fail;\n+\n+import org.hamcrest.Matcher;\n \n public interface AssertableTestBean {\n \n     Set<String> TEST_DATA = new HashSet<>(Arrays.asList(\"teST1\", \"TEst2\", \"tESt3\"));\n \n     void assertValid();\n+\n+    default void await(String msg, CountDownLatch countDownLatch) {\n+        try {\n+            countDownLatch.await(500, TimeUnit.MILLISECONDS);", "originalCommit": "9f5daede04f6c2b71b43dac0058f2cb7c18b8b3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUyMDExNQ==", "url": "https://github.com/oracle/helidon/pull/1499#discussion_r392520115", "bodyText": "fixed", "author": "danielkec", "createdAt": "2020-03-13T22:56:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjE4MjcxNw=="}], "type": "inlineReview"}, {"oid": "86118caf9b99450906ebf8997da7cafc6dd11da0", "url": "https://github.com/oracle/helidon/commit/86118caf9b99450906ebf8997da7cafc6dd11da0", "message": "Proper executor shutdown\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-03-13T13:37:50Z", "type": "commit"}, {"oid": "fe2741b319c1cbfdf7b44a3412f094489278f852", "url": "https://github.com/oracle/helidon/commit/fe2741b319c1cbfdf7b44a3412f094489278f852", "message": "Source acknowledgement\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-03-17T08:41:20Z", "type": "commit"}, {"oid": "65acfb27e0569daf25fd97e6708e05828a5a1e32", "url": "https://github.com/oracle/helidon/commit/65acfb27e0569daf25fd97e6708e05828a5a1e32", "message": "Remove TODO\n\nSigned-off-by: Daniel Kec <daniel.kec@oracle.com>", "committedDate": "2020-03-17T08:45:54Z", "type": "commit"}]}