{"pr_number": 2438, "pr_title": "CDI.current().getBeanManager() now available during shutdown", "pr_createdAt": "2020-10-12T14:21:53Z", "pr_url": "https://github.com/oracle/helidon/pull/2438", "timeline": [{"oid": "df4fcf0ccb60bd76f6b462d71c4c337a4a31c83f", "url": "https://github.com/oracle/helidon/commit/df4fcf0ccb60bd76f6b462d71c4c337a4a31c83f", "message": "CDI.current().getBeanManager() now available during shutdown\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>", "committedDate": "2020-10-12T14:20:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwMjUzOA==", "url": "https://github.com/oracle/helidon/pull/2438#discussion_r504502538", "bodyText": "Probably not worth it but can be performing better when avoiding Throwable.fillInStackTrace()\n    if (LOGGER.isLoggable(Level.FINEST)) {\n        LOGGER.log(Level.FINEST, \"Invocation of container method during shutdown\",\n                new IllegalStateException(\"Container not running\"));\n    }", "author": "danielkec", "createdAt": "2020-10-14T08:39:14Z", "path": "microprofile/cdi/src/main/java/io/helidon/microprofile/cdi/HelidonContainerImpl.java", "diffHunk": "@@ -399,10 +399,15 @@ public boolean isRunning() {\n \n         @Override\n         public BeanManager getBeanManager() {\n-            if (isRunning.get()) {\n-                return new BeanManagerProxy(beanManager());\n+            if (!isRunning.get()) {\n+                LOGGER.warning(\"BeanManager requested during container shutdown. This may be caused by observer methods \"\n+                                       + \"that use CDI.current(). Switch to finest logging to see stack trace.\");\n+                LOGGER.log(Level.FINEST,\n+                           \"Invocation of container method during shutdown\",\n+                           new IllegalStateException(\"Container not running\"));", "originalCommit": "df4fcf0ccb60bd76f6b462d71c4c337a4a31c83f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg4MzI5MQ==", "url": "https://github.com/oracle/helidon/pull/2438#discussion_r504883291", "bodyText": "Fixed", "author": "tomas-langer", "createdAt": "2020-10-14T18:24:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUwMjUzOA=="}], "type": "inlineReview"}, {"oid": "3a302656906a8a23743047288f05b6d6c8c0aa02", "url": "https://github.com/oracle/helidon/commit/3a302656906a8a23743047288f05b6d6c8c0aa02", "message": "Guarding debug statement\n\nSigned-off-by: Tomas Langer <tomas.langer@oracle.com>", "committedDate": "2020-10-14T18:23:51Z", "type": "commit"}]}