{"pr_number": 24658, "pr_title": "Add functional-match-pattern support to match statement", "pr_createdAt": "2020-07-08T15:58:31Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658", "timeline": [{"oid": "d16ba38b8cce9be6ee724c1ebe49aea319e41dcb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d16ba38b8cce9be6ee724c1ebe49aea319e41dcb", "message": "parseFunctionalMatchPattern method.", "committedDate": "2020-07-03T03:47:12Z", "type": "commit"}, {"oid": "d624d1d84351d0f2d2d1c63072115eb320cdebfc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d624d1d84351d0f2d2d1c63072115eb320cdebfc", "message": "parseFunctionalMatchPatternOrConsPattern method.", "committedDate": "2020-07-03T11:18:08Z", "type": "commit"}, {"oid": "cf53d5787614ae50c7c846143af43984fb4a93e8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cf53d5787614ae50c7c846143af43984fb4a93e8", "message": "functional match pattern support to match statement.", "committedDate": "2020-07-05T11:03:15Z", "type": "commit"}, {"oid": "72d5d3e6c0725d82d9d60991cc5578e5f670c665", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/72d5d3e6c0725d82d9d60991cc5578e5f670c665", "message": "Changed the type of namedArgMatchPatternsNode.", "committedDate": "2020-07-05T11:06:29Z", "type": "commit"}, {"oid": "811db93741fad5b40f82f56340750ab09e289b3f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/811db93741fad5b40f82f56340750ab09e289b3f", "message": "Added more comments.", "committedDate": "2020-07-06T14:01:10Z", "type": "commit"}, {"oid": "f65fa25df234665caca3dc9a4937179771e8a59c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f65fa25df234665caca3dc9a4937179771e8a59c", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern", "committedDate": "2020-07-06T16:29:33Z", "type": "commit"}, {"oid": "41c4db473e46f9f3d3853dbd6fb53105a76aebe9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41c4db473e46f9f3d3853dbd6fb53105a76aebe9", "message": "Changed the parsing logic of functional match pattern.", "committedDate": "2020-07-07T08:19:11Z", "type": "commit"}, {"oid": "98930374df0e6dd695aa20f7e496bbaa8e339fdc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98930374df0e6dd695aa20f7e496bbaa8e339fdc", "message": "Recovery logic for the functional match pattern.", "committedDate": "2020-07-08T11:18:26Z", "type": "commit"}, {"oid": "f26fe5a1c6987cdc78c4ca8d3681c38ec833e7ef", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f26fe5a1c6987cdc78c4ca8d3681c38ec833e7ef", "message": "Test cases for functional match pattern.", "committedDate": "2020-07-08T14:02:52Z", "type": "commit"}, {"oid": "f7a7af90f7299044e650c41acf78228cb4df6de2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f7a7af90f7299044e650c41acf78228cb4df6de2", "message": "Changed the context for open parenthesis in functional match pattern.", "committedDate": "2020-07-08T15:13:05Z", "type": "commit"}, {"oid": "0cd8e55bdfe6fe3f5b817856332b2c9c96ff1f60", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0cd8e55bdfe6fe3f5b817856332b2c9c96ff1f60", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern", "committedDate": "2020-07-08T15:41:33Z", "type": "commit"}, {"oid": "27b36fdc98bea11d278680a23ab8dc0bcd9ddd87", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/27b36fdc98bea11d278680a23ab8dc0bcd9ddd87", "message": "Undo unwanted changes.", "committedDate": "2020-07-08T15:54:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkzODU1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#discussion_r451938551", "bodyText": "I think we can simplify this method and parseOtherArgMatchPatterns method, if we follow the same approach as parseArgList method.\nA further simplified/cleanup version can be found in parseArgListBindingPatterns (still WIP). I would suggest let's do similar to this one.", "author": "SupunS", "createdAt": "2020-07-09T03:09:03Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -12744,6 +12754,251 @@ private STNode parseFieldMatchPatternRhs(SyntaxKind nextTokenKind) {\n         }\n     }\n \n+    private STNode parseFunctionalMatchPatternOrConsPattern(STNode typeRefOrConstExpr) {\n+        return parseFunctionalMatchPatternOrConsPattern(peek().kind, typeRefOrConstExpr);\n+    }\n+\n+    private STNode parseFunctionalMatchPatternOrConsPattern(SyntaxKind nextToken, STNode typeRefOrConstExpr) {\n+        switch (nextToken) {\n+            case OPEN_PAREN_TOKEN:\n+                return parseFunctionalMatchPattern(typeRefOrConstExpr);\n+            default:\n+                if (isMatchPatternRhs(peek().kind)) {\n+                    return typeRefOrConstExpr;\n+                }\n+                Solution solution = recover(peek(), ParserRuleContext.FUNC_MATCH_PATTERN_OR_CONST_PATTERN,\n+                        typeRefOrConstExpr);\n+\n+                // If the parser recovered by inserting a token, then try to re-parse the same\n+                // rule with the inserted token. This is done to pick the correct branch\n+                // to continue the parsing.\n+                if (solution.action == Action.REMOVE) {\n+                    return solution.recoveredNode;\n+                }\n+\n+                return parseFunctionalMatchPatternOrConsPattern(solution.tokenKind, typeRefOrConstExpr);\n+        }\n+    }\n+\n+    private boolean isMatchPatternRhs(SyntaxKind tokenKind) {\n+        switch (tokenKind) {\n+            case RIGHT_DOUBLE_ARROW_TOKEN:\n+            case COMMA_TOKEN:\n+            case CLOSE_BRACE_TOKEN:\n+            case CLOSE_BRACKET_TOKEN:\n+            case CLOSE_PAREN_TOKEN:\n+            case PIPE_TOKEN:\n+            case IF_KEYWORD:\n+            case EOF_TOKEN:\n+                return true;\n+            default:\n+                return false;\n+        }\n+    }\n+\n+    /**\n+     * Parse functional match pattern.\n+     *<p>\n+     *     functional-match-pattern := functionally-constructible-type-reference ( arg-list-match-pattern )\n+     *     <br/>\n+     *     functionally-constructible-type-reference := error | type-reference\n+     *     <br/>\n+     *     type-reference := identifier | qualified-identifier\n+     *     <br/>\n+     *     arg-list-match-pattern := positional-arg-match-patterns [, other-arg-match-patterns]\n+     *    | other-arg-match-patterns\n+     *</p>\n+     *\n+     * @return Parsed functional match pattern node.\n+     */\n+    private STNode parseFunctionalMatchPattern(STNode typeRef) {", "originalCommit": "27b36fdc98bea11d278680a23ab8dc0bcd9ddd87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTk4ODI5Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#discussion_r451988292", "bodyText": "sure will look into that :-)", "author": "rdulmina", "createdAt": "2020-07-09T06:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkzODU1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM5OTA4Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24658#discussion_r452399082", "bodyText": "Improved", "author": "rdulmina", "createdAt": "2020-07-09T18:08:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTkzODU1MQ=="}], "type": "inlineReview"}, {"oid": "6bcd730ce6557ad7bc2e9ac7188d88fb3bc86971", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6bcd730ce6557ad7bc2e9ac7188d88fb3bc86971", "message": "Improved the parsing logic of functional match pattern.", "committedDate": "2020-07-09T18:06:16Z", "type": "commit"}, {"oid": "a9f67cb59a922ba53e48331908dc454995cabb3b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a9f67cb59a922ba53e48331908dc454995cabb3b", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern", "committedDate": "2020-07-09T18:07:25Z", "type": "commit"}, {"oid": "95b37494bb04dc5c9679a0f71984a7c205aa2b7c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95b37494bb04dc5c9679a0f71984a7c205aa2b7c", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into functional-match-pattern", "committedDate": "2020-07-10T04:20:31Z", "type": "commit"}, {"oid": "7a42c37b8999bcad6d60546f9c363cd9d1bcf2e8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7a42c37b8999bcad6d60546f9c363cd9d1bcf2e8", "message": "Undo test1.bal file change.", "committedDate": "2020-07-10T04:23:27Z", "type": "commit"}]}