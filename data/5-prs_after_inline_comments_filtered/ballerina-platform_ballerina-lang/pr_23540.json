{"pr_number": 23540, "pr_title": "Improve log-API performance", "pr_createdAt": "2020-05-27T10:35:59Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODg1Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r431058856", "bodyText": "This still doesn't address the said issue though. Here, the getPackagePath() method needs to be called anyway to get the module name for a given log call. These if conditions are duplicating two checks/functionalities:\n\nThe call to get the module name\nThe check to see if the log level is enabled (since it is checked in the logMessage() method)", "author": "pubudu91", "createdAt": "2020-05-27T11:52:58Z", "path": "stdlib/log-api/src/main/java/org/ballerinalang/stdlib/log/Utils.java", "diffHunk": "@@ -27,39 +27,76 @@\n  * @since 1.1.0\n  */\n public class Utils extends AbstractLogFunction {\n+    private static boolean logLevelEnabled = false;\n+\n     public static void printDebug(Object msg) {\n-        logMessage(Scheduler.getStrand(), msg, BLogLevel.DEBUG, getPackagePath(),\n-                (pkg, message) -> {\n-            getLogger(pkg).debug(message);\n-        });\n+        if (LOG_MANAGER.isModuleLogLevelEnabled()) {\n+            logLevelEnabled = isLogLevelEnabled(BLogLevel.DEBUG, getPackagePath());\n+        } else {\n+            logLevelEnabled = isLogLevelEnabled(BLogLevel.DEBUG, \"\");\n+        }\n+        if (logLevelEnabled) {\n+            logMessage(Scheduler.getStrand(), msg, BLogLevel.DEBUG, getPackagePath(),", "originalCommit": "a290f7bdb57dd395e869b61f43ba9822d9e40206", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA4MjI0Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r431082242", "bodyText": "As mentioned before, it makes a considerable performance improvement when the log level is not enabled. With the new implementation, if module log level is not enabled, getPackagePath() does not have to get called in order to check if the log level is enabled. If only the log level is enabled, getPackagePath() will be called to print the log message.\nYes, agree with the second point. the check in logMessage() is not redundant since it is already confirmed that the log level is enabled. Hence removed that check.", "author": "MadhukaHarith92", "createdAt": "2020-05-27T12:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODg1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1MzY5Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r432053692", "bodyText": "Sorry, yeah, you are right, no need to be doing additional evaluations if the log level is not enabled", "author": "pubudu91", "createdAt": "2020-05-28T18:58:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA1ODg1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MjQ1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r431062451", "bodyText": "This API is sort of redundant isn't it? This is basically doing the same thing as what LogManager.getPackageLogLevel() API does.", "author": "pubudu91", "createdAt": "2020-05-27T11:59:57Z", "path": "stdlib/log-api/src/main/java/org/ballerinalang/stdlib/log/AbstractLogFunction.java", "diffHunk": "@@ -91,4 +91,14 @@ static String getPackagePath() {\n         }\n         return \".\";\n     }\n+\n+    static boolean isLogLevelEnabled(BLogLevel logLevel, String pckg) {", "originalCommit": "a290f7bdb57dd395e869b61f43ba9822d9e40206", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTEzMTUzMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r431131533", "bodyText": "Updated in a924c62", "author": "MadhukaHarith92", "createdAt": "2020-05-27T13:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MjQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1NDgzMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r432054832", "bodyText": "Why is this maintained at class level? There's no need for this right? Each time a log function is called this is updated, but never used. Plus, this class is meant to be stateless isn't it?", "author": "pubudu91", "createdAt": "2020-05-28T19:00:41Z", "path": "stdlib/log-api/src/main/java/org/ballerinalang/stdlib/log/Utils.java", "diffHunk": "@@ -27,39 +27,76 @@\n  * @since 1.1.0\n  */\n public class Utils extends AbstractLogFunction {\n+    private static boolean logLevelEnabled = false;", "originalCommit": "a924c621e865d2da539992fa3c4d34461046558e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjI0NjMxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23540#discussion_r432246315", "bodyText": "Updated in 78c8c82", "author": "MadhukaHarith92", "createdAt": "2020-05-29T04:14:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA1NDgzMg=="}], "type": "inlineReview"}, {"oid": "2e5607a425616134d87fe4f124939244d0f611bb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2e5607a425616134d87fe4f124939244d0f611bb", "message": "Improve log-API performance", "committedDate": "2020-05-29T04:09:18Z", "type": "commit"}, {"oid": "78c8c82f05653b0c96fba98aba2d9b06d25de7d5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/78c8c82f05653b0c96fba98aba2d9b06d25de7d5", "message": "Fix code review changes", "committedDate": "2020-05-29T04:12:07Z", "type": "commit"}]}