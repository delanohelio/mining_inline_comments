{"pr_number": 20624, "pr_title": "Fix intermittent WebSocketMetricsTestCase failure", "pr_createdAt": "2020-01-16T06:30:07Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20624", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI4ODU3OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20624#discussion_r367288579", "bodyText": "Please add a new line at the end of the file", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-01-16T08:35:26Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/observability/metrics/WebSocketMetricsTestCase.java", "diffHunk": "@@ -171,4 +179,4 @@ private String generateNewKey(String metric, String[] tags) {\n         key = key + \"}\";\n         return key;\n     }\n-}\n+}", "originalCommit": "c4284a59030c2bbc804391c0b11c26ba0bdae0a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzI5ODI1Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20624#discussion_r367298256", "bodyText": "Why we can't use setCountDownLatch()  instead of this?", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-01-16T08:58:22Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/observability/metrics/WebSocketMetricsTestCase.java", "diffHunk": "@@ -82,24 +84,30 @@ private void setup() throws Exception {\n      */\n     @Test\n     public void testMetrics() throws Exception {\n-        WebSocketTestClient client = new WebSocketTestClient(\"ws://localhost:9090/basic/ws\");\n-        client.handshake();\n-        client.sendText(MESSAGE);\n-        client.sendText(MESSAGE);\n-        client.sendText(MESSAGE);\n-        client.sendText(MESSAGE);\n-        client.sendText(MESSAGE);\n-        client.sendPing(SENDING_BYTE_BUFFER);\n-        client.sendPong(SENDING_BYTE_BUFFER);\n-        client.sendBinary(SENDING_BYTE_BUFFER);\n-        client.sendText(CLOSE_MESSAGE);\n+        // Test Service\n+        final WebSocketTestClient[] client = new WebSocketTestClient[1];\n+        await().atMost(20, TimeUnit.SECONDS)", "originalCommit": "c4284a59030c2bbc804391c0b11c26ba0bdae0a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3be2e74bdb95c350404af171543fc4e780315054", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3be2e74bdb95c350404af171543fc4e780315054", "message": "Fix intermittent WebSocketMetricsTestCase failure", "committedDate": "2020-01-16T13:29:17Z", "type": "forcePushed"}, {"oid": "2bb3f3efa07509435c7e81926fe46effd752fd6b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2bb3f3efa07509435c7e81926fe46effd752fd6b", "message": "Fix intermittent WebSocketMetricsTestCase failure", "committedDate": "2020-01-17T04:27:00Z", "type": "forcePushed"}, {"oid": "97da8af470cd7483c222c25498602076c745909f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/97da8af470cd7483c222c25498602076c745909f", "message": "Fix intermittent WebSocketMetricsTestCase failure", "committedDate": "2020-01-17T04:27:48Z", "type": "forcePushed"}, {"oid": "a422f9fc9852361e7373ec38abb3aa093cfa8100", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a422f9fc9852361e7373ec38abb3aa093cfa8100", "message": "Fix intermittent WebSocketMetricsTestCase failure", "committedDate": "2020-01-17T04:50:09Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzc3MTI4MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20624#discussion_r367771280", "bodyText": "No need to create the countDownLatch to handshake because we already set it in the implementation. Please refer the test.", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-01-17T05:08:25Z", "path": "tests/jballerina-integration-test/src/test/java/org/ballerinalang/test/observability/metrics/WebSocketMetricsTestCase.java", "diffHunk": "@@ -82,7 +86,9 @@ private void setup() throws Exception {\n      */\n     @Test\n     public void testMetrics() throws Exception {\n-        WebSocketTestClient client = new WebSocketTestClient(\"ws://localhost:9090/basic/ws\");\n+        WebSocketTestClient client = new WebSocketTestClient(SERVER_URL);\n+        CountDownLatch countDownLatch = new CountDownLatch(1);\n+        countDownLatch.await(10, TimeUnit.SECONDS);", "originalCommit": "a422f9fc9852361e7373ec38abb3aa093cfa8100", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7024a2e0b11047d8e7a3e11c5efa32f51a21da2c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7024a2e0b11047d8e7a3e11c5efa32f51a21da2c", "message": "Fix intermittent WebSocketMetricsTestCase failure", "committedDate": "2020-01-20T07:44:48Z", "type": "commit"}, {"oid": "7024a2e0b11047d8e7a3e11c5efa32f51a21da2c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7024a2e0b11047d8e7a3e11c5efa32f51a21da2c", "message": "Fix intermittent WebSocketMetricsTestCase failure", "committedDate": "2020-01-20T07:44:48Z", "type": "forcePushed"}]}