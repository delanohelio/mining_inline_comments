{"pr_number": 26748, "pr_title": "Fix RunExecutable task to reflect actual status of program execution", "pr_createdAt": "2020-11-04T11:19:36Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26748", "timeline": [{"oid": "e28aa9a1ed120ab2484b2b53bbc584bcb45c5b95", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e28aa9a1ed120ab2484b2b53bbc584bcb45c5b95", "message": "Fix exit code from panic", "committedDate": "2020-11-04T11:17:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI4NDM4Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26748#discussion_r517284382", "bodyText": "Don't we need to exit if get exception while running the command?", "author": "warunalakshitha", "createdAt": "2020-11-04T11:41:40Z", "path": "cli/ballerina-packerina/src/main/java/org/ballerinalang/packerina/task/RunExecutableTask.java", "diffHunk": "@@ -130,6 +130,10 @@ private void runGeneratedExecutable(BLangPackage executableModule, BuildContext\n             ProcessBuilder pb = new ProcessBuilder(commands).inheritIO();\n             Process process = pb.start();\n             process.waitFor();\n+            int exitValue = process.exitValue();\n+            if (exitValue != 0) {\n+                Runtime.getRuntime().exit(exitValue);\n+            }\n         } catch (IOException | InterruptedException e) {", "originalCommit": "e28aa9a1ed120ab2484b2b53bbc584bcb45c5b95", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI4NzM5OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26748#discussion_r517287398", "bodyText": "The thrown exceptions are handled and exits are covered at the main class at https://github.com/ballerina-platform/ballerina-lang/blob/ballerina-1.2.x/cli/ballerina-tool/src/main/java/org/ballerinalang/tool/Main.java\nBut when there is no exception thrown as in the case when the ballerina program panics with an error, the exit code does not reflect the actual status. That's why I am suggesting this fix.", "author": "Dilhasha", "createdAt": "2020-11-04T11:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI4NDM4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI5MTUzNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26748#discussion_r517291534", "bodyText": "I realised, we can throw an exception when exit code is not zero and let the main class handle it to keep it consistent. I'll fix it.", "author": "Dilhasha", "createdAt": "2020-11-04T11:55:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzI4NDM4Mg=="}], "type": "inlineReview"}, {"oid": "ff8ad7402fc6ab98d131598f2804771d4b21d7a0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ff8ad7402fc6ab98d131598f2804771d4b21d7a0", "message": "Throw exception based on exit code", "committedDate": "2020-11-04T13:13:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQ0ODA0Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26748#discussion_r517448047", "bodyText": "I think the e.getMessage will not have any useful info as always print \"Execution exited with the exit code <some non 0 value>\". Runtime already print the actual cause when panic. Therefore we do not need to print the error.  Also this will miss the exit code when we print the echo $? which will be always 1. So we can save the exitValue in PanicException and set in here without printing any thing.\ncatch (BLangPanicException e) {\nRuntime.getRuntime().exit(((BlangPanicException).getExitValue())\n}", "author": "warunalakshitha", "createdAt": "2020-11-04T15:56:15Z", "path": "cli/ballerina-tool/src/main/java/org/ballerinalang/tool/Main.java", "diffHunk": "@@ -68,6 +68,9 @@ public static void main(String... args) {\n         } catch (BLauncherException e) {\n             LauncherUtils.printLauncherException(e, errStream);\n             Runtime.getRuntime().exit(1);\n+        } catch (BLangPanicException e) {\n+            errStream.println(e.getMessage());", "originalCommit": "ff8ad7402fc6ab98d131598f2804771d4b21d7a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQ0ODcyNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26748#discussion_r517448725", "bodyText": "Since actuall runtime gets panic shall we rename RuntimePanicException", "author": "warunalakshitha", "createdAt": "2020-11-04T15:57:15Z", "path": "cli/ballerina-tool/src/main/java/org/ballerinalang/tool/BLangPanicException.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ *   Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *   WSO2 Inc. licenses this file to you under the Apache License,\n+ *   Version 2.0 (the \"License\"); you may not use this file except\n+ *   in compliance with the License.\n+ *   You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *   Unless required by applicable law or agreed to in writing,\n+ *   software distributed under the License is distributed on an\n+ *   \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *   KIND, either express or implied.  See the License for the\n+ *   specific language governing permissions and limitations\n+ *   under the License.\n+ */\n+package org.ballerinalang.tool;\n+\n+/**\n+ * Thrown to indicate a non zero exit code from Ballerina executable.\n+ *\n+ * @since 1.2.10\n+ */\n+public class BLangPanicException extends RuntimeException {", "originalCommit": "ff8ad7402fc6ab98d131598f2804771d4b21d7a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "85da05dc62dc78a185f819443a2d5e659f87f940", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/85da05dc62dc78a185f819443a2d5e659f87f940", "message": "Fix PR suggestions", "committedDate": "2020-11-05T10:54:05Z", "type": "forcePushed"}, {"oid": "d4718d10b440461a59db306c1f15010d53b58fc5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d4718d10b440461a59db306c1f15010d53b58fc5", "message": "Fix PR suggestions", "committedDate": "2020-11-05T11:22:49Z", "type": "forcePushed"}, {"oid": "1189875b6079d7e7f62aa32f83189f58c590865b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1189875b6079d7e7f62aa32f83189f58c590865b", "message": "Fix PR suggestions", "committedDate": "2020-11-05T13:38:31Z", "type": "commit"}, {"oid": "1189875b6079d7e7f62aa32f83189f58c590865b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1189875b6079d7e7f62aa32f83189f58c590865b", "message": "Fix PR suggestions", "committedDate": "2020-11-05T13:38:31Z", "type": "forcePushed"}, {"oid": "c239dab3455dcbedff6a54f50d34e98e76433518", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c239dab3455dcbedff6a54f50d34e98e76433518", "message": "Improve java doc comment", "committedDate": "2020-11-05T18:22:51Z", "type": "commit"}]}