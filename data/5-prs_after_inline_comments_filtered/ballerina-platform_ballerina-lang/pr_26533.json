{"pr_number": 26533, "pr_title": "Allow using a compatible map as a record at runtime", "pr_createdAt": "2020-10-22T14:54:31Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26533", "timeline": [{"oid": "8ac94c99c276d065300e92d7401feb11a90ac969", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8ac94c99c276d065300e92d7401feb11a90ac969", "message": "Allow using a compatible map as a record at runtime", "committedDate": "2020-10-22T14:52:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTI1Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26533#discussion_r510275256", "bodyText": "Is it enough to simply check if the two types are compatible? What about the behaviour if the record type contains a never field? \ud83e\udd14", "author": "pubudu91", "createdAt": "2020-10-22T15:55:22Z", "path": "bvm/ballerina-runtime/src/main/java/io/ballerina/runtime/TypeChecker.java", "diffHunk": "@@ -1156,17 +1196,24 @@ private static boolean checkRecordBelongsToAnydataType(MapValue sourceVal, BReco\n \n     private static boolean checkIsRecordType(Object sourceVal, Type sourceType, BRecordType targetType,\n                                              List<TypePair> unresolvedTypes) {\n-        if (sourceType.getTag() != TypeTags.RECORD_TYPE_TAG) {\n-            return false;\n+        switch (sourceType.getTag()) {\n+            case TypeTags.RECORD_TYPE_TAG:\n+                return checkIsRecordType((MapValue) sourceVal, (BRecordType) sourceType, targetType, unresolvedTypes);\n+            case TypeTags.MAP_TAG:\n+                return checkIsRecordType((BMapType) sourceType, targetType, unresolvedTypes);", "originalCommit": "8ac94c99c276d065300e92d7401feb11a90ac969", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI5Nzg1Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26533#discussion_r510297856", "bodyText": "Since we check the source map's constraint against the field type in https://github.com/ballerina-platform/ballerina-lang/pull/26533/files#diff-19c04b50f4303ca57559920287e2ca9ef20fd7ddaad5b7c75d425c340ec5421dR1151, that shouldn't be an issue, right?", "author": "MaryamZi", "createdAt": "2020-10-22T16:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyMTU3OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26533#discussion_r510421579", "bodyText": "Had a chat with Maryam and got this clarified.", "author": "pubudu91", "createdAt": "2020-10-22T19:59:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTI1Ng=="}], "type": "inlineReview"}]}