{"pr_number": 25755, "pr_title": "Remove `CompileResultDiagnosticListener` and update the tests to compatible with new diagnostic api", "pr_createdAt": "2020-09-13T06:57:10Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMTQwOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487531408", "bodyText": "This might give check styles issues. Shall we fix all the check-styles/find-bugs issues?", "author": "SupunS", "createdAt": "2020-09-13T13:44:51Z", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/javainterop/RefTypeNegativeTests.java", "diffHunk": "@@ -24,7 +24,7 @@\n import org.ballerinalang.test.util.BAssertUtil;\n import org.ballerinalang.test.util.BCompileUtil;\n import org.ballerinalang.test.util.CompileResult;\n-import org.ballerinalang.util.diagnostic.Diagnostic;\n+import io.ballerina.tools.diagnostics.Diagnostic;", "originalCommit": "a10f988b54760e8b071091a891b965e01cce7243", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMTcwMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487531701", "bodyText": "Shall we use an ordered list in the bLangPackage to store diagnostics? Then we don't have to sort it everytime..", "author": "SupunS", "createdAt": "2020-09-13T13:47:08Z", "path": "tests/ballerina-test-utils/src/main/java/org/ballerinalang/test/util/CompileResult.java", "diffHunk": "@@ -34,27 +32,25 @@\n public class CompileResult {\n \n     private PackageNode pkgNode;\n-    private CompileResultDiagnosticListener diagnosticListener;\n \n     URLClassLoader classLoader;\n \n-    public CompileResult(CompileResultDiagnosticListener diagnosticListener) {\n-        this.diagnosticListener = diagnosticListener;\n+    public CompileResult() {\n     }\n \n     public Diagnostic[] getDiagnostics() {\n-        List<Diagnostic> diagnostics = this.diagnosticListener.getDiagnostics();\n-        diagnostics.sort(Comparator.comparing((Diagnostic d) -> d.getSource().getCompilationUnitName()).\n-                thenComparingInt(d -> d.getPosition().getStartLine()));\n+        List<Diagnostic> diagnostics = ((BLangPackage) this.pkgNode).getDiagnostics();\n+        diagnostics.sort(Comparator.comparing((Diagnostic d) -> d.location().lineRange().filePath()).", "originalCommit": "a10f988b54760e8b071091a891b965e01cce7243", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU1Nzc4MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487557781", "bodyText": "+1 for using an ordered list. Sorting every time can be a burden when we are doing a migration between versions where there are considerable amount of diagnostics.", "author": "nadeeshaan", "createdAt": "2020-09-13T17:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzUzMTcwMQ=="}], "type": "inlineReview"}, {"oid": "08aa3e97fb94ba0ab0a2e2f05b9c57ff50a34fc8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/08aa3e97fb94ba0ab0a2e2f05b9c57ff50a34fc8", "message": "Remove diagnostic console print", "committedDate": "2020-09-14T09:06:05Z", "type": "commit"}, {"oid": "d8ecf2fbaffc036759fbb992d0ea3ade723a8dd7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8ecf2fbaffc036759fbb992d0ea3ade723a8dd7", "message": "Remove `CompileResultDiagnosticListener` and update the `CompileResult` to get the diagnostics from the `BLangPackage`", "committedDate": "2020-09-14T09:10:19Z", "type": "commit"}, {"oid": "46c72cbd65f96d612b746b0ff5a7c20f03652992", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/46c72cbd65f96d612b746b0ff5a7c20f03652992", "message": "Update ballerina-test-utils/build.gradle with `ballerina-tools-api`", "committedDate": "2020-09-14T09:10:20Z", "type": "commit"}, {"oid": "aaecbd7c273ded617fbefeddf0d0933ebbd2478a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aaecbd7c273ded617fbefeddf0d0933ebbd2478a", "message": "Update tests with new diagnostic api", "committedDate": "2020-09-14T09:10:20Z", "type": "commit"}, {"oid": "bf32b5e1b993fad5445e95b4caa100585694d5d5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bf32b5e1b993fad5445e95b4caa100585694d5d5", "message": "Remove checkstyle issues and refactor some tests", "committedDate": "2020-09-14T11:45:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk2NjAxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487966017", "bodyText": "no need of the listener parameter", "author": "SupunS", "createdAt": "2020-09-14T14:17:47Z", "path": "tests/ballerina-test-utils/src/main/java/org/ballerinalang/test/util/BCompileUtil.java", "diffHunk": "@@ -499,18 +496,16 @@ public static CompileResult compile(String sourceRoot, String packageName, Compi\n     private static CompileResult compile(CompilerContext context, String packageName,\n                                          CompilerPhase compilerPhase, boolean withTests) {\n \n-        CompileResult.CompileResultDiagnosticListener listener = new CompileResult.CompileResultDiagnosticListener();\n-        context.put(DiagnosticListener.class, listener);\n-        return compile(context, listener, packageName, compilerPhase, withTests);\n+        return compile(context, null, packageName, compilerPhase, withTests);\n     }\n \n     private static CompileResult compile(CompilerContext context,\n-                                         CompileResult.CompileResultDiagnosticListener listener,\n+                                         String listener,", "originalCommit": "bf32b5e1b993fad5445e95b4caa100585694d5d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Nzk2NzA3MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25755#discussion_r487967071", "bodyText": "lets remove this", "author": "SupunS", "createdAt": "2020-09-14T14:18:47Z", "path": "misc/ballerinalang-data-mapper/src/test/java/org/ballerinalang/datamapper/util/TestUtil.java", "diffHunk": "@@ -61,6 +60,8 @@\n import java.util.concurrent.CompletableFuture;\n import java.util.concurrent.ExecutionException;\n \n+//import io.ballerina.tools.diagnostics.Diagnostic;\n+", "originalCommit": "bf32b5e1b993fad5445e95b4caa100585694d5d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0b68488c50760ef29db4e1100f7c17febe36a1a3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b68488c50760ef29db4e1100f7c17febe36a1a3", "message": "Remove checkstyle issues and refactor some tests", "committedDate": "2020-09-15T03:39:57Z", "type": "commit"}, {"oid": "0b68488c50760ef29db4e1100f7c17febe36a1a3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b68488c50760ef29db4e1100f7c17febe36a1a3", "message": "Remove checkstyle issues and refactor some tests", "committedDate": "2020-09-15T03:39:57Z", "type": "forcePushed"}]}