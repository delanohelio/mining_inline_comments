{"pr_number": 20991, "pr_title": "Return error for already used http:Responses", "pr_createdAt": "2020-02-11T11:36:11Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991", "timeline": [{"oid": "e2165dc989175d19a3abeb4b0a8dbbd77f5ffb8a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2165dc989175d19a3abeb4b0a8dbbd77f5ffb8a", "message": "Fix bug", "committedDate": "2020-02-11T11:33:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzQxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991#discussion_r377593415", "bodyText": "Should we provide more details with this error log to trace this request ? (May be inboundRequestMsg.getSequenceId())", "author": "anupama-pathirage", "createdAt": "2020-02-11T12:03:29Z", "path": "stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java", "diffHunk": "@@ -61,8 +62,16 @@ public static Object nativeRespond(ObjectValue connectionObj, ObjectValue outbou\n         HttpCarbonMessage inboundRequestMsg = HttpUtil.getCarbonMsg(connectionObj, null);\n         Strand strand = Scheduler.getStrand();\n         DataContext dataContext = new DataContext(strand, new NonBlockingCallback(strand), inboundRequestMsg);\n-        HttpCarbonMessage outboundResponseMsg = HttpUtil\n-                .getCarbonMsg(outboundResponseObj, HttpUtil.createHttpCarbonMessage(false));\n+        if (isDirtyResponse(outboundResponseObj)) {\n+            String errorMessage = \"Couldn't complete the respond operation as the response has been already used.\";\n+            HttpUtil.sendOutboundResponse(inboundRequestMsg, HttpUtil.createErrorMessage(errorMessage, 500));\n+            unBlockStrand(strand);\n+            log.debug(errorMessage);", "originalCommit": "e2165dc989175d19a3abeb4b0a8dbbd77f5ffb8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNDQ0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991#discussion_r378034443", "bodyText": "We couldn't expose the inboundRequestMsg.getSequenceId() to the ballerina and it will not be useful to the user as they can't understand this.", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-02-12T04:22:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzQxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODAzNjg5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991#discussion_r378036890", "bodyText": "This log is for troubleshooting purposes right? Same is used to track other debug log messages [1]. @chamil321 Any thoughts? Btw, don't we need to check log.isDebugEnabled() before having debug logs here?\n[1] \n  \n    \n      ballerina-lang/stdlib/http/src/main/java/org/ballerinalang/net/http/nativeimpl/connection/Respond.java\n    \n    \n         Line 96\n      in\n      e2165dc\n    \n    \n    \n    \n\n        \n          \n           log.debug(\"Pipelining is required. Sequence id of the request: {}\",", "author": "anupama-pathirage", "createdAt": "2020-02-12T04:35:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzQxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA2MTIxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991#discussion_r378061217", "bodyText": "Fixed", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-02-12T06:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzQxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODA5MzIyMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991#discussion_r378093223", "bodyText": "+1 Let's add the change to the master branch as well", "author": "chamil321", "createdAt": "2020-02-12T08:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzQxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM4MTM5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/20991#discussion_r379381393", "bodyText": "Fixed in #21090", "author": "kalaiyarasiganeshalingam", "createdAt": "2020-02-14T11:25:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzU5MzQxNQ=="}], "type": "inlineReview"}, {"oid": "96d4771458a584d7c1e4bb467dfc712a24af4905", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/96d4771458a584d7c1e4bb467dfc712a24af4905", "message": "Fix the comment", "committedDate": "2020-02-12T06:30:52Z", "type": "commit"}]}