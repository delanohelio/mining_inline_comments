{"pr_number": 24417, "pr_title": "Fix issues when passing a vararg for non-rest params", "pr_createdAt": "2020-06-22T18:06:58Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417", "timeline": [{"oid": "793601a002f8d699f3a3c04569a83ac0742fc78d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/793601a002f8d699f3a3c04569a83ac0742fc78d", "message": "Fix issues when using a vararg to provide for required/defaultable params", "committedDate": "2020-06-21T05:42:14Z", "type": "commit"}, {"oid": "c81ebe29187370771bee5591de6baade46fb7c95", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c81ebe29187370771bee5591de6baade46fb7c95", "message": "Add tests for taint analysis with vararg for non-rest param", "committedDate": "2020-06-22T16:20:56Z", "type": "commit"}, {"oid": "c43ca80e9074ecf187ea301d9e662ac37a4e1111", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c43ca80e9074ecf187ea301d9e662ac37a4e1111", "message": "Add test for vararg for different typed params", "committedDate": "2020-06-22T17:05:19Z", "type": "commit"}, {"oid": "f33f2552f5dabd1cca6841d90cc6ec554a342c3d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f33f2552f5dabd1cca6841d90cc6ec554a342c3d", "message": "Refactor code", "committedDate": "2020-06-23T06:49:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg3Njk3NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r454876974", "bodyText": "Shall we add a comment about what's being desugared into what?", "author": "pubudu91", "createdAt": "2020-07-15T08:20:51Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java", "diffHunk": "@@ -5454,21 +5454,72 @@ private void reorderArguments(BLangInvocation iExpr) {\n             stmtExpression.type = firstNonRestArg.type;\n             iExpr.requiredArgs.add(0, stmtExpression);\n \n-            // The original value passed as the vararg has to now be sliced to pass only the args for the rest param,\n-            // if there is a rest param.\n+            // If there's no rest param, the vararg only provided for required/defaultable params.\n             if (invokableSymbol.restParam == null) {\n+                restArgs.remove(0);\n                 return;\n             }\n \n+            // If there is a rest param, the vararg could provide for the rest param too.\n+            // Create a new array with just the members of the original vararg specified for the rest param.\n+            BLangRestArgsExpression restArgsExpression = (BLangRestArgsExpression) restArgs.remove(0);", "originalCommit": "f33f2552f5dabd1cca6841d90cc6ec554a342c3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "abfee195c6464213d1a54a68b4f1a387fd40b746", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/abfee195c6464213d1a54a68b4f1a387fd40b746", "message": "Address review suggestions", "committedDate": "2020-07-15T10:31:14Z", "type": "commit"}, {"oid": "8bcccde548d7c12f568dd41818bd2e10762ad254", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8bcccde548d7c12f568dd41818bd2e10762ad254", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into fix-vararg-as-non-rest-param", "committedDate": "2020-07-15T10:31:27Z", "type": "commit"}, {"oid": "579416ae8c78cf098770eb09387b214f12325cfe", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/579416ae8c78cf098770eb09387b214f12325cfe", "message": "Fix tests", "committedDate": "2020-07-15T11:47:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNjI0Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455136247", "bodyText": "Is this indentation correct here? I think we can change this latter", "author": "rdhananjaya", "createdAt": "2020-07-15T15:21:43Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TaintAnalyzer.java", "diffHunk": "@@ -2445,6 +2473,28 @@ private void analyzeInvocation(BLangInvocation invocationExpr) {\n         getCurrentAnalysisState().taintedStatus = returnTaintedStatus;\n     }\n \n+    private boolean restoreTableIfIgnored(BInvokableSymbol invokableSymbol, Map<Integer, TaintRecord> origTaintTable,\n+     TaintedStatus argumentTaintReturnValue) {", "originalCommit": "579416ae8c78cf098770eb09387b214f12325cfe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0NTM5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455145390", "bodyText": "Ack, will fix this.", "author": "MaryamZi", "createdAt": "2020-07-15T15:34:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNjI0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNzg0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455137841", "bodyText": "Do we need this param returnTaintedStatus", "author": "rdhananjaya", "createdAt": "2020-07-15T15:23:42Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TaintAnalyzer.java", "diffHunk": "@@ -2445,6 +2473,28 @@ private void analyzeInvocation(BLangInvocation invocationExpr) {\n         getCurrentAnalysisState().taintedStatus = returnTaintedStatus;\n     }\n \n+    private boolean restoreTableIfIgnored(BInvokableSymbol invokableSymbol, Map<Integer, TaintRecord> origTaintTable,\n+     TaintedStatus argumentTaintReturnValue) {\n+        if (argumentTaintReturnValue != TaintedStatus.IGNORED) {\n+            return false;\n+        }\n+        invokableSymbol.taintTable = origTaintTable; // restore taint table.\n+        return true;\n+    }\n+\n+    private TaintedStatus updateAndGetTaintedStatus(BLangInvocation invocationExpr, TaintedStatus returnTaintedStatus,", "originalCommit": "579416ae8c78cf098770eb09387b214f12325cfe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0NTEyOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455145128", "bodyText": "If argumentTaintReturnValue == TaintedStatus.TAINTED evaluates to false, we seem to be using this original returnTaintedStatus, so I guess we still need it?", "author": "MaryamZi", "createdAt": "2020-07-15T15:34:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNzg0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE2MTQ0OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24417#discussion_r455161448", "bodyText": "ack", "author": "rdhananjaya", "createdAt": "2020-07-15T16:00:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzNzg0MQ=="}], "type": "inlineReview"}]}