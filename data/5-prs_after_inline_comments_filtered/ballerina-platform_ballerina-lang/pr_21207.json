{"pr_number": 21207, "pr_title": "Allow spread operators in mapping constructor expressions", "pr_createdAt": "2020-02-24T06:01:57Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207", "timeline": [{"oid": "bce7e38059fd1b24c5ca88cd1b72857ea706de0e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bce7e38059fd1b24c5ca88cd1b72857ea706de0e", "message": "Intro grammar changes for spread operator in mapping-constr-expr", "committedDate": "2020-02-10T08:40:06Z", "type": "commit"}, {"oid": "349d57f1a264bd11d6a5cde6684d13bcccfc7e30", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/349d57f1a264bd11d6a5cde6684d13bcccfc7e30", "message": "Merge ballerina-lang master", "committedDate": "2020-02-13T09:11:39Z", "type": "commit"}, {"oid": "a56b97fa4da46c53a67a594710b42ce01904880e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a56b97fa4da46c53a67a594710b42ce01904880e", "message": "Implement semantic, code, df, and taint analysis for spread operator", "committedDate": "2020-02-15T18:21:12Z", "type": "commit"}, {"oid": "95cc638f16b4a41d7992fbb63557eb1f193c77e1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/95cc638f16b4a41d7992fbb63557eb1f193c77e1", "message": "Resolve conflicts and merge ballerina-lang/master", "committedDate": "2020-02-15T18:24:17Z", "type": "commit"}, {"oid": "590222e89fda81f3333e30706d55396212b2151d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/590222e89fda81f3333e30706d55396212b2151d", "message": "Regenerate parser", "committedDate": "2020-02-16T03:38:27Z", "type": "commit"}, {"oid": "178d4acb466687a1775dda1d687aeb3d7349dcd8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/178d4acb466687a1775dda1d687aeb3d7349dcd8", "message": "Remove BLangJSONLiteral and few unused Desugar methods", "committedDate": "2020-02-16T05:41:09Z", "type": "commit"}, {"oid": "acab182417e6ad25370ba18a3d6112e7b8696e30", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/acab182417e6ad25370ba18a3d6112e7b8696e30", "message": "Resolve conflicts and merge ballerina-lang/master", "committedDate": "2020-02-17T13:41:38Z", "type": "commit"}, {"oid": "e01cc22e2c8abc28c900754d2c707e25365646aa", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e01cc22e2c8abc28c900754d2c707e25365646aa", "message": "Regenerate parser", "committedDate": "2020-02-22T15:40:10Z", "type": "commit"}, {"oid": "d02eaac0dd089cfb4eba6f9d2baca0d0df279af3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d02eaac0dd089cfb4eba6f9d2baca0d0df279af3", "message": "Move mapping field insertion logic to Desugar from BIRGen", "committedDate": "2020-02-22T15:40:24Z", "type": "commit"}, {"oid": "42cf0ba12280855bc08e9d4528769d39c68abf81", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/42cf0ba12280855bc08e9d4528769d39c68abf81", "message": "Fix rest param annots for runtime and AnnotationAttachmentTest", "committedDate": "2020-02-22T15:40:29Z", "type": "commit"}, {"oid": "41d29cf4064d12e29c0cfebbc6086a8cba04871a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/41d29cf4064d12e29c0cfebbc6086a8cba04871a", "message": "Desugar spread operator to a foreach statement", "committedDate": "2020-02-22T15:40:34Z", "type": "commit"}, {"oid": "747d8732f2df8bcfa703cba36c241bcc60a1607f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/747d8732f2df8bcfa703cba36c241bcc60a1607f", "message": "Add validation for non-record spread op and fix type inferring", "committedDate": "2020-02-23T09:06:10Z", "type": "commit"}, {"oid": "7682640434e708d6553f6358afc50578bfd71958", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7682640434e708d6553f6358afc50578bfd71958", "message": "Fix spread op type inferring and usage in maps", "committedDate": "2020-02-24T05:40:13Z", "type": "commit"}, {"oid": "d923f8c5ead6cf35d3de602f964cd8bbe571d17d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d923f8c5ead6cf35d3de602f964cd8bbe571d17d", "message": "Fix const analysis for spread op and add more tests", "committedDate": "2020-02-24T18:30:16Z", "type": "commit"}, {"oid": "63f4e0cb176a94d8dbb9c7c0fad9ea26c25e7b9e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/63f4e0cb176a94d8dbb9c7c0fad9ea26c25e7b9e", "message": "Resolve conflicts and merge ballerina-platform/master", "committedDate": "2020-02-26T09:42:20Z", "type": "commit"}, {"oid": "b14150c73642791255c67080640c37dfcb92c3a5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b14150c73642791255c67080640c37dfcb92c3a5", "message": "Merge ballerina-platform/master", "committedDate": "2020-02-27T13:45:37Z", "type": "commit"}, {"oid": "4b7ac5424156509c10a30630565801c6347b875e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4b7ac5424156509c10a30630565801c6347b875e", "message": "Infer optional fields via spread op as optional", "committedDate": "2020-02-29T06:30:03Z", "type": "commit"}, {"oid": "133d9010951cf306ffc708243a18bc3e9f111c22", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/133d9010951cf306ffc708243a18bc3e9f111c22", "message": "Merge ballerina-platform/master", "committedDate": "2020-02-29T06:31:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxOTA0NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207#discussion_r386219044", "bodyText": "What does this check do? The DESUGARED_MAPPING_CONSTR_KEY constant doesn't seem to be set as a var name anywhere?", "author": "pubudu91", "createdAt": "2020-03-02T06:44:31Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/bir/BIRGen.java", "diffHunk": "@@ -572,6 +570,24 @@ private boolean isCompileTimeAnnotationValue(BLangExpression expr) {\n                 return true;\n             case TYPE_CONVERSION_EXPR:\n                 return isCompileTimeAnnotationValue(((BLangTypeConversionExpr) expr).expr);\n+            case STATEMENT_EXPRESSION:\n+                BLangStatementExpression stmtExpr = (BLangStatementExpression) expr;\n+                List<BLangStatement> stmts = ((BLangBlockStmt) stmtExpr.stmt).stmts;\n+\n+                if (!((BLangLocalVarRef) stmtExpr.expr).varSymbol.name.value.startsWith(DESUGARED_MAPPING_CONSTR_KEY)) {", "originalCommit": "133d9010951cf306ffc708243a18bc3e9f111c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjI2MTM1NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21207#discussion_r386261355", "bodyText": "This is the name we use when desugaring the record literal to a struct or map literal - \n  \n    \n      ballerina-lang/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\n    \n    \n         Line 6172\n      in\n      133d901\n    \n    \n    \n    \n\n        \n          \n           String name = DESUGARED_MAPPING_CONSTR_KEY + this.annonVarCount++;", "author": "MaryamZi", "createdAt": "2020-03-02T08:53:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjIxOTA0NA=="}], "type": "inlineReview"}]}