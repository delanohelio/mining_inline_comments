{"pr_number": 25224, "pr_title": "Refactor and remove unused code from trace store", "pr_createdAt": "2020-08-12T04:33:54Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzNDA1MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#discussion_r469034050", "bodyText": "can't we use tracerName.equalsIgnoreCase(openTracer.getName())", "author": "riyafa", "createdAt": "2020-08-12T06:32:28Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/observability/tracer/TracersStore.java", "diffHunk": "@@ -51,31 +52,29 @@ private TracersStore() {\n     public void loadTracers() {\n         ConfigRegistry configRegistry = ConfigRegistry.getInstance();\n         if (configRegistry.getAsBoolean(CONFIG_TRACING_ENABLED)) {\n-\n-            this.tracerStore = new HashMap<>();\n+            String overallProviderName = configRegistry.getConfigOrDefault(CONFIG_OBSERVABILITY_PROVIDER, JAEGER);\n+            String tracerName = configRegistry.getConfigOrDefault(TRACER_NAME_CONFIG, overallProviderName);\n \n             ServiceLoader<OpenTracer> openTracers = ServiceLoader.load(OpenTracer.class);\n-            HashMap<String, OpenTracer> tracerMap = new HashMap<>();\n-            openTracers.forEach(t -> tracerMap.put(t.getName().toLowerCase(), t));\n-\n-            String defaultReporterName = configRegistry.getConfigOrDefault(CONFIG_OBSERVABILITY_PROVIDER, JAEGER);\n-            String tracerName = configRegistry.getConfigOrDefault(TRACER_NAME_CONFIG, defaultReporterName);\n+            for (OpenTracer openTracer : openTracers) {\n+                if (Objects.equals(openTracer.getName().toLowerCase(), tracerName.toLowerCase())) {", "originalCommit": "27c0096da43a9186eb41739056f1cf4f0c7310cb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzNjk3OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#discussion_r469036979", "bodyText": "Fixed", "author": "nadundesilva", "createdAt": "2020-08-12T06:39:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTAzNDA1MA=="}], "type": "inlineReview"}, {"oid": "7c83ef579f23ed8b961b3330a62375361e33302d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7c83ef579f23ed8b961b3330a62375361e33302d", "message": "Fix code review suggestions", "committedDate": "2020-08-12T06:40:05Z", "type": "forcePushed"}, {"oid": "4eb71e090000fd18127369855eda329819447c01", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4eb71e090000fd18127369855eda329819447c01", "message": "Fix code review suggestions", "committedDate": "2020-08-14T08:50:15Z", "type": "forcePushed"}, {"oid": "24b2d2c68250594d727b4537f005e36d5d4a02eb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/24b2d2c68250594d727b4537f005e36d5d4a02eb", "message": "Refactor and cleanup Tracer Store", "committedDate": "2020-08-17T06:55:53Z", "type": "commit"}, {"oid": "ab269a289fda03b9fa5fd62b738f8424d9bfcaa2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ab269a289fda03b9fa5fd62b738f8424d9bfcaa2", "message": "Remove unused Span Store", "committedDate": "2020-08-17T06:55:53Z", "type": "commit"}, {"oid": "6d6e9bb1182215f9f30648d09e86d870a193fb2f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6d6e9bb1182215f9f30648d09e86d870a193fb2f", "message": "Refactor and cleanup Choreo extension", "committedDate": "2020-08-17T06:55:53Z", "type": "commit"}, {"oid": "9f64c07b0b40a83916a55f3db12527c520373267", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/9f64c07b0b40a83916a55f3db12527c520373267", "message": "Refactor and cleanup OpenTracingBallerinaWrapper", "committedDate": "2020-08-17T06:55:53Z", "type": "commit"}, {"oid": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "message": "Fix code review suggestions", "committedDate": "2020-08-17T06:55:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM3NzIxMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#discussion_r472377211", "bodyText": "what is the reason for this change? synchronizing on a different object.", "author": "Kishanthan", "createdAt": "2020-08-18T17:51:50Z", "path": "misc/tracing-extensions/modules/ballerina-choreo-extension/src/main/java/org/ballerinalang/observe/trace/extension/choreo/ChoreoJaegerReporter.java", "diffHunk": "@@ -126,13 +126,15 @@ private synchronized void append(JaegerSpan jaegerSpan) {\n             long duration = jaegerSpan.getDuration() / 1000;    // Jaeger stores duration in microseconds by default\n             ChoreoTraceSpan traceSpan = new ChoreoTraceSpan(spanContext.getTraceId(), spanContext.getSpanId(),\n                     jaegerSpan.getServiceName(), jaegerSpan.getOperationName(), timestamp, duration, tags, references);\n-            traceSpans.add(traceSpan);\n+            synchronized (traceSpans) {\n+                traceSpans.add(traceSpan);\n+            }\n         }\n \n         @Override\n         public void run() {\n             ChoreoTraceSpan[] spansToBeSent;\n-            synchronized (this) {\n+            synchronized (traceSpans) {", "originalCommit": "a39a69f275e1a4e0bb2a8882549ed10ea6fb9a50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjYxMDQ1OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25224#discussion_r472610458", "bodyText": "This change is not required. I reverted the change in 0b5ba74", "author": "nadundesilva", "createdAt": "2020-08-19T02:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM3NzIxMQ=="}], "type": "inlineReview"}, {"oid": "0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "message": "Fix code review suggestions", "committedDate": "2020-08-19T02:36:45Z", "type": "commit"}, {"oid": "0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b5ba74c9a423930d32f41451d597e6fc1dc2fe4", "message": "Fix code review suggestions", "committedDate": "2020-08-19T02:36:45Z", "type": "forcePushed"}, {"oid": "51d6ccb02b65433a521356238f049ec07ce2d965", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51d6ccb02b65433a521356238f049ec07ce2d965", "message": "Merge remote-tracking branch 'upstream/master' into ballerina-observability", "committedDate": "2020-08-22T09:49:09Z", "type": "commit"}, {"oid": "51d6ccb02b65433a521356238f049ec07ce2d965", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/51d6ccb02b65433a521356238f049ec07ce2d965", "message": "Merge remote-tracking branch 'upstream/master' into ballerina-observability", "committedDate": "2020-08-22T09:49:09Z", "type": "forcePushed"}]}