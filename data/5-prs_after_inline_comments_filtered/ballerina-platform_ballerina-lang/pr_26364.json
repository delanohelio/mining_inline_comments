{"pr_number": 26364, "pr_title": "Remove DiagnosticSource and DiagnosticPos usages", "pr_createdAt": "2020-10-15T05:03:58Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364", "timeline": [{"oid": "ba972d0cb40a4b444762b9169f4444dd7a14d7be", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ba972d0cb40a4b444762b9169f4444dd7a14d7be", "message": "Deprecate DiagnosticPos and DiagnosticPosition", "committedDate": "2020-10-15T05:42:39Z", "type": "forcePushed"}, {"oid": "7ee8a17c45ef684d85b624890911ebfca6d78bb4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7ee8a17c45ef684d85b624890911ebfca6d78bb4", "message": "Fix checkstyle errors and spotbug errors", "committedDate": "2020-10-16T19:35:45Z", "type": "forcePushed"}, {"oid": "80baaff2e08d288438a419015f32e8ec3046f371", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/80baaff2e08d288438a419015f32e8ec3046f371", "message": "Remove DiagnosticSource usages through BLangCompilationUnit", "committedDate": "2020-10-16T22:31:53Z", "type": "commit"}, {"oid": "d8dbf993f7909460f96902a728116be4d038bf6c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d8dbf993f7909460f96902a728116be4d038bf6c", "message": "Replace BDiagnosticSource's APIs with new APIs", "committedDate": "2020-10-16T22:31:53Z", "type": "commit"}, {"oid": "d1969befa67ed694a97524fd4b178fe1a35ef5fb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d1969befa67ed694a97524fd4b178fe1a35ef5fb", "message": "Add location to BLangNode", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "0e0562fde0d5095e5bb226cd13bc531201c8b208", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0e0562fde0d5095e5bb226cd13bc531201c8b208", "message": "Add more support for tools-api/Location", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "96d893d9f4046c79d7944e1bef98eeffeb23f766", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/96d893d9f4046c79d7944e1bef98eeffeb23f766", "message": "Replace BDiagnosticSource's APIs in BirTestUtils with new APIs", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "5cd7a7d1584ac7877cd88cf8b2155ed2baa134d9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5cd7a7d1584ac7877cd88cf8b2155ed2baa134d9", "message": "Remove DeleteRange and its usages", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "b43e5f9eefc8c8776d7ecc586ec1f9aa1b42e4ae", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b43e5f9eefc8c8776d7ecc586ec1f9aa1b42e4ae", "message": "Remove DiagnosticSource and its usages", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "ca45c45dffcd6f8ce32c5391ef481fb97d9dc138", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ca45c45dffcd6f8ce32c5391ef481fb97d9dc138", "message": "Replace DiagnosticPos usages with BLangDiagnosticLocation APIs", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "4fd748f6ee1da10ca7bbc932c759c7bb76377d3d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4fd748f6ee1da10ca7bbc932c759c7bb76377d3d", "message": "Deprecate DiagnosticPos and DiagnosticPosition", "committedDate": "2020-10-16T22:31:54Z", "type": "commit"}, {"oid": "2de9b479ee18978e4f6061c209f5b23b3657f306", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2de9b479ee18978e4f6061c209f5b23b3657f306", "message": "Remove package-id from diagnostic location", "committedDate": "2020-10-16T22:31:55Z", "type": "commit"}, {"oid": "2cc21af1e0427f24d2be284194a38a2fcc44d77a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2cc21af1e0427f24d2be284194a38a2fcc44d77a", "message": "Remove duplicate 'location'", "committedDate": "2020-10-16T22:31:55Z", "type": "commit"}, {"oid": "686b1eab9a367804de8a57b832e162f122e9195a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/686b1eab9a367804de8a57b832e162f122e9195a", "message": "Fix checkstyle errors and spotbug errors", "committedDate": "2020-10-17T16:57:16Z", "type": "commit"}, {"oid": "6854823ce1c9f9b9ff7a9c0ec776b09bd5f0b5ec", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6854823ce1c9f9b9ff7a9c0ec776b09bd5f0b5ec", "message": "Fix ballerina-compiler-api test failing", "committedDate": "2020-10-17T16:57:16Z", "type": "commit"}, {"oid": "6854823ce1c9f9b9ff7a9c0ec776b09bd5f0b5ec", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6854823ce1c9f9b9ff7a9c0ec776b09bd5f0b5ec", "message": "Fix ballerina-compiler-api test failing", "committedDate": "2020-10-17T16:57:16Z", "type": "forcePushed"}, {"oid": "0111df9083f8c8b3f1688e4e7dfea61c381acc34", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0111df9083f8c8b3f1688e4e7dfea61c381acc34", "message": "Replace getStartLine(), getEndLine(), getStartColumn() and getEndColumn()", "committedDate": "2020-10-19T04:42:00Z", "type": "commit"}, {"oid": "852f10fa5846000d6ae3fb158a1aa5af8c12f23c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/852f10fa5846000d6ae3fb158a1aa5af8c12f23c", "message": "Add a constructor to create BLangLocation objects with given line-range and text-range", "committedDate": "2020-10-19T04:46:44Z", "type": "commit"}, {"oid": "82834b3c805d07f1eca52beb3276baab0fe2089d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/82834b3c805d07f1eca52beb3276baab0fe2089d", "message": "Rename 'storeDiagnosticInPackage' to 'storeDiagnosticInModule'", "committedDate": "2020-10-19T04:47:11Z", "type": "commit"}, {"oid": "879fe81a5bfa536ea681759e5e10cfff0d176400", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/879fe81a5bfa536ea681759e5e10cfff0d176400", "message": "Merge branch 'master' into diagnostic-change\n\n# Conflicts:\n#\tmisc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormatterUtils.java\n#\tmisc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormattingTreeModifier.java", "committedDate": "2020-10-19T05:01:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ5NjI4Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507496283", "bodyText": "cursorPos.lineRange().startLine() and location.lineRange().startLine() is called multiple times.\nBetter to extract that to a variable.", "author": "SupunS", "createdAt": "2020-10-19T06:19:15Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/impl/BallerinaSemanticModel.java", "diffHunk": "@@ -161,9 +160,38 @@ public BallerinaSemanticModel(BLangPackage bLangPackage, CompilerContext context\n \n     // Private helper methods for the public APIs above.\n \n-    private boolean isSymbolInUserProject(BSymbol symbol, DiagnosticPos cursorPos) {\n+    private boolean isSymbolInUserProject(BSymbol symbol, BLangDiagnosticLocation cursorPos) {\n+        String packageDetailsString = bLangPackage.packageID.name.value\n+                + bLangPackage.packageID.getPackageVersion().value\n+                + cursorPos.lineRange().filePath();\n+        String symbolPackageDetailsString = symbol.pkgID.name.value\n+                + symbol.pkgID.getPackageVersion().value\n+                + symbol.pos.lineRange().filePath();\n+\n+        int value = packageDetailsString.compareTo(symbolPackageDetailsString);\n+\n+        BLangDiagnosticLocation location = symbol.pos;\n+\n+        if (value == 0) {\n+            // If the package detail strings are same, then compare the start line.\n+            if (cursorPos.lineRange().startLine().line() < location.lineRange().startLine().line()) {", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ5Nzk2NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507497965", "bodyText": "Can't we simply use PackageID.equals()?", "author": "SupunS", "createdAt": "2020-10-19T06:21:54Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/impl/BallerinaSemanticModel.java", "diffHunk": "@@ -161,9 +160,38 @@ public BallerinaSemanticModel(BLangPackage bLangPackage, CompilerContext context\n \n     // Private helper methods for the public APIs above.\n \n-    private boolean isSymbolInUserProject(BSymbol symbol, DiagnosticPos cursorPos) {\n+    private boolean isSymbolInUserProject(BSymbol symbol, BLangDiagnosticLocation cursorPos) {\n+        String packageDetailsString = bLangPackage.packageID.name.value\n+                + bLangPackage.packageID.getPackageVersion().value\n+                + cursorPos.lineRange().filePath();\n+        String symbolPackageDetailsString = symbol.pkgID.name.value\n+                + symbol.pkgID.getPackageVersion().value\n+                + symbol.pos.lineRange().filePath();\n+\n+        int value = packageDetailsString.compareTo(symbolPackageDetailsString);", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzQ5OTMwOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507499308", "bodyText": "We should use interface classes (i.e: Location) in these method signatures", "author": "SupunS", "createdAt": "2020-10-19T06:24:09Z", "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/model/symbols/Symbol.java", "diffHunk": "@@ -45,7 +45,7 @@\n \n     List<? extends Symbol> getEnclosedSymbols();\n \n-    DiagnosticPosition getPosition();\n+    BLangDiagnosticLocation getPosition();", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwMDU3NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507500575", "bodyText": "Same here.\nLet's update in all places.", "author": "SupunS", "createdAt": "2020-10-19T06:26:08Z", "path": "compiler/ballerina-lang/src/main/java/org/ballerinalang/util/diagnostic/DiagnosticLog.java", "diffHunk": "@@ -30,12 +32,19 @@\n \n \n     /**\n-     * Logs a message of the specified {@link Diagnostic.Kind} at the {@link DiagnosticPosition}.\n+     * Logs a message of the specified {@link Diagnostic.Kind} at the {@link BLangDiagnosticLocation}.\n      *\n      * @param kind    the kind of the diagnostic\n      * @param pos     the position of the source code element.\n      * @param message the message\n      */\n-    void logDiagnostic(Kind kind, DiagnosticPosition pos, CharSequence message);\n+    void logDiagnostic(Kind kind, BLangDiagnosticLocation pos, CharSequence message);", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwMDc1Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507500757", "bodyText": "Same", "author": "SupunS", "createdAt": "2020-10-19T06:26:32Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/BIRPackageSymbolEnter.java", "diffHunk": "@@ -426,7 +422,7 @@ private void defineGlobalVarDependencies(BInvokableSymbol invokableSymbol, DataI\n     }\n \n     private void defineTypeDef(DataInputStream dataInStream) throws IOException {\n-        DiagnosticPos pos = readPosition(dataInStream);\n+        BLangDiagnosticLocation pos = readPosition(dataInStream);", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwMjM0NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507502345", "bodyText": "Having the current package ID in the logger can be problematic. Only one logger is created per compilation. But a single compilation can have multiple modules.\nSo here it is expected to set the currentPackageId before visiting the package. That makes us depend on the order of usage of the methods, and also makes it easy for someone to miss it out.\nShall we send package ID as a parameter to the diagnostic reporting function every-time?", "author": "SupunS", "createdAt": "2020-10-19T06:30:37Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/diagnostic/BLangDiagnosticLog.java", "diffHunk": "@@ -49,13 +47,15 @@\n \n     private int errorCount = 0;\n     private PackageCache packageCache;\n+    private PackageID currentPackageId;", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNTQxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507505415", "bodyText": "Lets remove these commented out code", "author": "SupunS", "createdAt": "2020-10-19T06:38:33Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/Parser.java", "diffHunk": "@@ -117,30 +114,41 @@ private CompilationUnitNode generateCompilationUnitNew(CompilerInput sourceEntry\n             return compilationUnit;\n         }\n \n-        BLangNodeTransformer bLangNodeTransformer = new BLangNodeTransformer(this.context, diagnosticSource);\n+        BLangNodeTransformer bLangNodeTransformer = new BLangNodeTransformer(this.context, packageID, entryName);\n         compilationUnit = (BLangCompilationUnit) bLangNodeTransformer.accept(tree.rootNode()).get(0);\n+        compilationUnit.setPackageID(packageID);\n         parserCache.put(packageID, entryName, hash, length, compilationUnit);\n         // Node cloner will run for valid ASTs.\n         // This will verify, any modification done to the AST will get handled properly.\n         compilationUnit = nodeCloner.cloneCUnit(compilationUnit);\n         return compilationUnit;\n     }\n \n-    private BDiagnosticSource getDiagnosticSource(CompilerInput sourceEntry, PackageID packageID) {\n-        String entryName = sourceEntry.getEntryName();\n-        return new BDiagnosticSource(packageID, entryName);\n-    }\n-\n-\n     private static int getHash(byte[] code) {\n         // Assuming hash collision is unlikely in a modified source.\n         // Additionally code.Length is considered to avoid hash collision.\n         return Arrays.hashCode(code);\n     }\n \n-    private void reportSyntaxDiagnostics(BDiagnosticSource diagnosticSource, SyntaxTree tree) {\n+    private void reportSyntaxDiagnostics(String cUnitName, PackageID pkgID, SyntaxTree tree) {\n         for (Diagnostic syntaxDiagnostic : tree.diagnostics()) {\n-            dlog.logDiagnostic(diagnosticSource.pkgID, syntaxDiagnostic);\n+            dlog.logDiagnostic(pkgID, syntaxDiagnostic);\n         }\n     }\n+\n+//    private void reportSyntaxDiagnostics(String cUnitName, PackageID pkgID, SyntaxTree tree) {\n+//        for (Diagnostic syntaxDiagnostic : tree.diagnostics()) {\n+//            // This conversion is needed because the compiler diagnostic locations starting index\n+//            // is 1, where as syntax diagnostics locations starting index is 0.\n+//            Location syntaxLocation = syntaxDiagnostic.location();\n+//            LineRange lineRange = syntaxLocation.lineRange();\n+//            LinePosition startLine = lineRange.startLine();\n+//            LinePosition endLine = lineRange.startLine();\n+//            Location location = new BLangDiagnosticLocation(cUnitName, pkgID, startLine.line() + 1,\n+//                    endLine.line() + 1, startLine.offset() + 1, endLine.offset() + 1);\n+//            BLangDiagnostic diag =\n+//                    new BLangDiagnostic(location, syntaxDiagnostic.message(), syntaxDiagnostic.diagnosticInfo());\n+//            dlog.logDiagnostic(pkgID, diag);\n+//        }\n+//    }", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNzQwNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507507406", "bodyText": "Looks like this constructor is never used", "author": "SupunS", "createdAt": "2020-10-19T06:43:22Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/diagnostic/BLangDiagnosticLocation.java", "diffHunk": "@@ -34,12 +34,18 @@\n     private LineRange lineRange;\n     private TextRange textRange;\n \n+    @Deprecated\n     public BLangDiagnosticLocation(String filePath, int startLine, int endLine, int startColumn, int endColumn) {\n         this.lineRange = LineRange.from(filePath, LinePosition.from(startLine, startColumn),\n                 LinePosition.from(endLine, endColumn));\n         this.textRange = TextRange.from(0, 0);\n     }\n \n+    public BLangDiagnosticLocation(LineRange lineRange, TextRange textRange) {", "originalCommit": "879fe81a5bfa536ea681759e5e10cfff0d176400", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUyMjg5MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r507522891", "bodyText": "We need this constructor to be used later right?", "author": "dulajdilshan", "createdAt": "2020-10-19T07:17:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNzQwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODIyMDIxOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508220218", "bodyText": "Since these are internal classes, we can add it when we have a solid requirement", "author": "SupunS", "createdAt": "2020-10-20T05:35:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNzQwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODMxMjA1NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508312055", "bodyText": "okay", "author": "dulajdilshan", "createdAt": "2020-10-20T08:33:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzUwNzQwNg=="}], "type": "inlineReview"}, {"oid": "f5907182c977a0d19464cd8bd9586c217fb7ec46", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f5907182c977a0d19464cd8bd9586c217fb7ec46", "message": "Replace BLangDiagnosticLocation with Location for variable types & parameter types", "committedDate": "2020-10-19T12:13:14Z", "type": "commit"}, {"oid": "a36604c07ffc4d93dff3a205754ca2630ffad8e3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a36604c07ffc4d93dff3a205754ca2630ffad8e3", "message": "Remove unwanted comments", "committedDate": "2020-10-19T12:43:04Z", "type": "commit"}, {"oid": "b8188b74d9cd4c94e9b866b15b94f4baee97cd25", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b8188b74d9cd4c94e9b866b15b94f4baee97cd25", "message": "Refactor isSymbolInUserProject()", "committedDate": "2020-10-20T06:50:01Z", "type": "commit"}, {"oid": "0be55e0027b057f6b75b9a7a20aa7ef142b66cd8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0be55e0027b057f6b75b9a7a20aa7ef142b66cd8", "message": "Merge branch 'master' into diagnostic-change\n\n# Conflicts:\n#\tcli/ballerina-packerina/src/main/java/module-info.java\n#\tcompiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/impl/BallerinaSemanticModel.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/parser/BLangNodeTransformer.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/CompilerPluginRunner.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java\n#\tlanguage-server/modules/langserver-core/src/main/java/module-info.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/builder/impl/ChangeReturnTypeCodeAction.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/common/utils/CommonUtil.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/TreeVisitor.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/CompletionVisitorUtil.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/BlockStatementScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/CursorPositionResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/ForkJoinStatementScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/FunctionNodeScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/InvocationParameterScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/ListConstructorScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/MatchExpressionScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/MatchStatementScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/ObjectTypeScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/PackageNodeScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/RecordLiteralScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/RecordScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/ResourceParamScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/ServiceScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/completions/util/positioning/resolvers/TopLevelNodeScopeResolver.java\n#\tlanguage-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/signature/SignatureTreeVisitor.java", "committedDate": "2020-10-20T07:20:30Z", "type": "commit"}, {"oid": "82185cad67ebd95ab3c8227193c2d07bdaa3a1f0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/82185cad67ebd95ab3c8227193c2d07bdaa3a1f0", "message": "Correct checkstyles errors", "committedDate": "2020-10-20T08:32:12Z", "type": "commit"}, {"oid": "82185cad67ebd95ab3c8227193c2d07bdaa3a1f0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/82185cad67ebd95ab3c8227193c2d07bdaa3a1f0", "message": "Correct checkstyles errors", "committedDate": "2020-10-20T08:32:12Z", "type": "forcePushed"}, {"oid": "2f2adc278f705b6476d857752008b01dc0c7bcc5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/2f2adc278f705b6476d857752008b01dc0c7bcc5", "message": "Remove constructor since no requirement yet", "committedDate": "2020-10-20T08:35:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU1NzA2Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508557063", "bodyText": "Shall we invert the condition and do early exit?\nif (!bLangPackage.packageID.equals(symbol.pkgID)) {\n    return false;\n}", "author": "SupunS", "createdAt": "2020-10-20T14:28:03Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/impl/BallerinaSemanticModel.java", "diffHunk": "@@ -160,9 +160,34 @@ public BallerinaSemanticModel(BLangPackage bLangPackage, CompilerContext context\n \n     // Private helper methods for the public APIs above.\n \n-    private boolean isSymbolInUserProject(BSymbol symbol, DiagnosticPos cursorPos) {\n+    private boolean isSymbolInUserProject(BSymbol symbol, Location cursorPos) {\n+        int value = 0;\n+\n+        LinePosition cursorPosStartLine = cursorPos.lineRange().startLine();\n+        LinePosition symbolStartLine = symbol.pos.lineRange().startLine();\n+\n+        if (bLangPackage.packageID.equals(symbol.pkgID)) {", "originalCommit": "2f2adc278f705b6476d857752008b01dc0c7bcc5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDMwOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508564308", "bodyText": "Can simplify this as:\nif (symbol.owner.getKind() == SymbolKind.PACKAGE || Symbols.isFlagOn(symbol.flags, Flags.WORKER) {\n   return true;\n}\n\nif (cursorPosStartLine.line() < symbolStartLine.line()) {\n    return false;\n} \n\nif (cursorPosStartLine.line() > symbolStartLine.line()) {\n    return true;\n}\n\n// means line numbers are equal. check for the column numbers\nreturn cursorPosStartLine.offset() <= symbolStartLine.offset();", "author": "SupunS", "createdAt": "2020-10-20T14:36:31Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/compiler/api/impl/BallerinaSemanticModel.java", "diffHunk": "@@ -160,9 +160,34 @@ public BallerinaSemanticModel(BLangPackage bLangPackage, CompilerContext context\n \n     // Private helper methods for the public APIs above.\n \n-    private boolean isSymbolInUserProject(BSymbol symbol, DiagnosticPos cursorPos) {\n+    private boolean isSymbolInUserProject(BSymbol symbol, Location cursorPos) {\n+        int value = 0;\n+\n+        LinePosition cursorPosStartLine = cursorPos.lineRange().startLine();\n+        LinePosition symbolStartLine = symbol.pos.lineRange().startLine();\n+\n+        if (bLangPackage.packageID.equals(symbol.pkgID)) {\n+            // If the package detail strings are same, then compare the start line.\n+            if (cursorPosStartLine.line() < symbolStartLine.line()) {\n+                value = -1;\n+            } else if (cursorPosStartLine.line() > symbolStartLine.line()) {\n+                value = 1;\n+            }\n+\n+            if (value == 0) {\n+                // If the start line is the same, then compare the start column.\n+                if (cursorPosStartLine.offset() < symbolStartLine.offset()) {\n+                    value = -1;\n+                } else if (cursorPosStartLine.offset() > symbolStartLine.offset()) {\n+                    value = 1;\n+                }\n+            }", "originalCommit": "2f2adc278f705b6476d857752008b01dc0c7bcc5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NzczMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508567730", "bodyText": "btw, shouldn't we check for the in-range kinda check?\nCheck here for a similar one: https://github.com/ballerina-platform/ballerina-lang/blob/master/misc/formatter/modules/formatter-core/src/main/java/org/ballerinalang/formatter/core/FormatterUtils.java#L32", "author": "SupunS", "createdAt": "2020-10-20T14:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODY5NDU3MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508694570", "bodyText": "Yeah I think the name of the function should be changed", "author": "dulajdilshan", "createdAt": "2020-10-20T17:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1NjE2Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508756163", "bodyText": "The current one only seems to check for the start line/columns info only.\nIf we are doing a range check, shouldn't we check for the ending line/column info as well?", "author": "SupunS", "createdAt": "2020-10-20T18:41:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODk3NDAwOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26364#discussion_r508974009", "bodyText": "what this function does is checking whether the current cursor position has passed the position of symbol. So, do we need to check the endline ?", "author": "dulajdilshan", "createdAt": "2020-10-21T03:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODU2NDMwOA=="}], "type": "inlineReview"}, {"oid": "e8720047fc0fe3b99e39b1e579ff37cbf9b3536e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e8720047fc0fe3b99e39b1e579ff37cbf9b3536e", "message": "Refactor according to the review", "committedDate": "2020-10-20T16:32:46Z", "type": "commit"}, {"oid": "dc2201e3b906dba1b3c352e9ba7c7b2d89a531ab", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dc2201e3b906dba1b3c352e9ba7c7b2d89a531ab", "message": "Merge branch 'master' into diagnostic-change\n\n# Conflicts:\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/util/FunctionalConstructorBuilder.java", "committedDate": "2020-10-20T17:11:58Z", "type": "commit"}, {"oid": "e147a3e199059e4417c90c0fadceda36a56cde45", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e147a3e199059e4417c90c0fadceda36a56cde45", "message": "Refactor isSymbolInUserProject", "committedDate": "2020-10-21T04:11:47Z", "type": "commit"}, {"oid": "d6b22b2b0f7a750c48d8d5e1e9ce9f0e98c6877d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d6b22b2b0f7a750c48d8d5e1e9ce9f0e98c6877d", "message": "Rename isSymbolInUserProject to hasCursorPosPassedSymbolPos", "committedDate": "2020-10-21T04:36:31Z", "type": "commit"}, {"oid": "dbfe796ca739eb81cdd08ad2017f691f5573b24f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/dbfe796ca739eb81cdd08ad2017f691f5573b24f", "message": "Merge branch 'master' into diagnostic-change\n\n# Conflicts:\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/ASTBuilderUtil.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/desugar/Desugar.java\n#\tcompiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/DocumentationAnalyzer.java", "committedDate": "2020-10-21T05:14:51Z", "type": "commit"}, {"oid": "bac3664147f14f1f6ee932aada7e4acb1b7f91f2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bac3664147f14f1f6ee932aada7e4acb1b7f91f2", "message": "Resolve conflicts", "committedDate": "2020-10-21T05:44:33Z", "type": "commit"}, {"oid": "bac3664147f14f1f6ee932aada7e4acb1b7f91f2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bac3664147f14f1f6ee932aada7e4acb1b7f91f2", "message": "Resolve conflicts", "committedDate": "2020-10-21T05:44:33Z", "type": "forcePushed"}]}