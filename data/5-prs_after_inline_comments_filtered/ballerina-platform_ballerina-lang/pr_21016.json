{"pr_number": 21016, "pr_title": "Implement CLI module implementation in Java", "pr_createdAt": "2020-02-12T07:30:09Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016", "timeline": [{"oid": "1f60c88881bd2f30f9bd3fca63fdff2be2a77fdb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1f60c88881bd2f30f9bd3fca63fdff2be2a77fdb", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-12T08:56:54Z", "type": "forcePushed"}, {"oid": "b2644cf7a5e957a64e16cc5fc68ef86ac991d6fe", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2644cf7a5e957a64e16cc5fc68ef86ac991d6fe", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-13T08:48:38Z", "type": "forcePushed"}, {"oid": "061ff5687f2236d33918fd3a06141bbc90da6fae", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/061ff5687f2236d33918fd3a06141bbc90da6fae", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-14T09:28:26Z", "type": "forcePushed"}, {"oid": "f1b2de68d3801ac8adc381d56b4436cc6b44e663", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f1b2de68d3801ac8adc381d56b4436cc6b44e663", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-16T15:37:33Z", "type": "forcePushed"}, {"oid": "cac8c53b7c2a90c6ad1d2a38dd342b009a914ade", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cac8c53b7c2a90c6ad1d2a38dd342b009a914ade", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-17T12:13:58Z", "type": "forcePushed"}, {"oid": "64b69158bc3339cbb5d199f16d6d654c4f7b8da0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/64b69158bc3339cbb5d199f16d6d654c4f7b8da0", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang into bal2java-central-cmd", "committedDate": "2020-02-17T12:53:16Z", "type": "forcePushed"}, {"oid": "1bccda6b51f5eced1175c8131e93ba6b92652f97", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1bccda6b51f5eced1175c8131e93ba6b92652f97", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-17T13:08:17Z", "type": "forcePushed"}, {"oid": "f207694e6d85345250ed511585c7557cf5fe9602", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f207694e6d85345250ed511585c7557cf5fe9602", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-17T14:54:53Z", "type": "forcePushed"}, {"oid": "63b9e8564c68573d0bf352c8a9f8bdb71fb94893", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/63b9e8564c68573d0bf352c8a9f8bdb71fb94893", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-17T16:07:55Z", "type": "forcePushed"}, {"oid": "e5308805a690871e57ef48b8443f10edf18f4e74", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e5308805a690871e57ef48b8443f10edf18f4e74", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-17T17:51:05Z", "type": "forcePushed"}, {"oid": "3b4db30dc50e0598af82e9590c23a22c96ffe188", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3b4db30dc50e0598af82e9590c23a22c96ffe188", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-18T05:10:50Z", "type": "forcePushed"}, {"oid": "48ae5d7170ec583c2bbe1aa486161f3950ca54b5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/48ae5d7170ec583c2bbe1aa486161f3950ca54b5", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-18T06:24:33Z", "type": "forcePushed"}, {"oid": "b002fa1ef7d5a8be1a9f80067f02b5c2a3f13d1f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b002fa1ef7d5a8be1a9f80067f02b5c2a3f13d1f", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-18T09:03:40Z", "type": "forcePushed"}, {"oid": "d95e539e1fa522e859fb4abb311e0b2b51866300", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d95e539e1fa522e859fb4abb311e0b2b51866300", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-18T09:37:50Z", "type": "forcePushed"}, {"oid": "7676b2d610f6989c60e32853a26feff076dc97a6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7676b2d610f6989c60e32853a26feff076dc97a6", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-18T11:24:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc0MjQ3Ng==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r380742476", "bodyText": "Shall we remove this extra line?", "author": "suganyasuven", "createdAt": "2020-02-18T15:24:39Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,227 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!Paths.get(nightlyBuild).toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        }\n+        conn.disconnect();\n+        Authenticator.setDefault(null);\n+    }\n+\n+    private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {\n+        try {\n+            Files.createFile(nightlyBuildMetaFile);\n+        } catch (Exception e) {\n+            createError(\"error occurred while creating nightly.build file.\");\n+        }\n+    }\n+\n+    private static void copyBaloFile(String modulePath, HttpURLConnection conn, String moduleVersion, Path baloPath) {\n+        try (InputStream inputStream = conn.getInputStream();\n+                FileOutputStream outputStream = new FileOutputStream(baloPath.toString())) {\n+            byte[] buffer = new byte[1024];\n+            int count;\n+\n+            long totalSizeInKB = conn.getContentLengthLong() / 1024;\n+            try (ProgressBar progressBar = new ProgressBar(\n+                    modulePath + \":\" + moduleVersion + \" [central.ballerina.io -> home repo] \",\n+                    totalSizeInKB, 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1)) {\n+                while ((count = inputStream.read(buffer)) > 0) {\n+                    outputStream.write(buffer, 0, count);\n+                    progressBar.step();\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"error occurred copying the balo file: \" + e.getMessage());\n+        }\n+    }\n+\n+    private static void createBaloFileDirectory(Path baloCacheWithModulePath) {\n+        try {\n+            Files.createDirectory(baloCacheWithModulePath);\n+        } catch (Exception e) {\n+            createError(\"error creating directory for balo file\");\n+        }\n+    }\n+\n+    private static void handleErrorResponse(String url, String modulePath, boolean isBuild, HttpURLConnection conn,\n+            int statusCode) {\n+        try (BufferedReader reader = new BufferedReader(\n+                new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+            StringBuilder result = new StringBuilder();\n+            String line;\n+            while ((line = reader.readLine()) != null) {\n+                result.append(line);\n+            }\n+\n+            MapValue payload = (MapValue) JSONParser.parse(result.toString());\n+            String errMsg = payload.getStringValue(\"message\");\n+\n+            if (statusCode == HttpURLConnection.HTTP_NOT_FOUND && isBuild && errMsg\n+                    .contains(\"module not found\")) {\n+                // To ignore printing the error\n+                createError(\"\");\n+            } else {\n+                createError(errMsg);\n+            }\n+        } catch (IOException e) {\n+            createError(\"failed to pull the module '\" + modulePath + \"' from the remote repository '\" + url\n+                    + \"'\");\n+        }\n+    }\n+\n+    private static void createError(String errMessage) {\n+        throw ErrorUtil.createCommandException(logFormatter.formatLog(errMessage));\n+    }\n+\n+    private static String setFileNameFromContentDispositionHeader(String contentDisposition, String baloFile) {\n+        if (contentDisposition != null && !contentDisposition.equals(\"\")) {\n+            return contentDisposition.substring(\"attachment; filename=\".length());\n+        } else {\n+            return baloFile;\n+        }\n+    }\n+", "originalCommit": "7676b2d610f6989c60e32853a26feff076dc97a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc1NzM2OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r380757369", "bodyText": "Shall we end the statement with the concatenation operator?", "author": "suganyasuven", "createdAt": "2020-02-18T15:45:54Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,227 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!Paths.get(nightlyBuild).toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        }\n+        conn.disconnect();\n+        Authenticator.setDefault(null);\n+    }\n+\n+    private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {\n+        try {\n+            Files.createFile(nightlyBuildMetaFile);\n+        } catch (Exception e) {\n+            createError(\"error occurred while creating nightly.build file.\");\n+        }\n+    }\n+\n+    private static void copyBaloFile(String modulePath, HttpURLConnection conn, String moduleVersion, Path baloPath) {\n+        try (InputStream inputStream = conn.getInputStream();\n+                FileOutputStream outputStream = new FileOutputStream(baloPath.toString())) {\n+            byte[] buffer = new byte[1024];\n+            int count;\n+\n+            long totalSizeInKB = conn.getContentLengthLong() / 1024;\n+            try (ProgressBar progressBar = new ProgressBar(\n+                    modulePath + \":\" + moduleVersion + \" [central.ballerina.io -> home repo] \",\n+                    totalSizeInKB, 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1)) {\n+                while ((count = inputStream.read(buffer)) > 0) {\n+                    outputStream.write(buffer, 0, count);\n+                    progressBar.step();\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"error occurred copying the balo file: \" + e.getMessage());\n+        }\n+    }\n+\n+    private static void createBaloFileDirectory(Path baloCacheWithModulePath) {\n+        try {\n+            Files.createDirectory(baloCacheWithModulePath);\n+        } catch (Exception e) {\n+            createError(\"error creating directory for balo file\");\n+        }\n+    }\n+\n+    private static void handleErrorResponse(String url, String modulePath, boolean isBuild, HttpURLConnection conn,\n+            int statusCode) {\n+        try (BufferedReader reader = new BufferedReader(\n+                new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+            StringBuilder result = new StringBuilder();\n+            String line;\n+            while ((line = reader.readLine()) != null) {\n+                result.append(line);\n+            }\n+\n+            MapValue payload = (MapValue) JSONParser.parse(result.toString());\n+            String errMsg = payload.getStringValue(\"message\");\n+\n+            if (statusCode == HttpURLConnection.HTTP_NOT_FOUND && isBuild && errMsg\n+                    .contains(\"module not found\")) {\n+                // To ignore printing the error\n+                createError(\"\");\n+            } else {\n+                createError(errMsg);\n+            }\n+        } catch (IOException e) {\n+            createError(\"failed to pull the module '\" + modulePath + \"' from the remote repository '\" + url", "originalCommit": "7676b2d610f6989c60e32853a26feff076dc97a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgxMjQzNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r380812437", "bodyText": "Can you further explain this?", "author": "pramodya1994", "createdAt": "2020-02-18T17:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc1NzM2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTA2Njg3OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381066878", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        createError(\"failed to pull the module '\" + modulePath + \"' from the remote repository '\" + url\n          \n          \n            \n                        createError(\"failed to pull the module '\" + modulePath + \"' from the remote repository '\" + url +\n          \n          \n            \n                                             \"'\");", "author": "suganyasuven", "createdAt": "2020-02-19T04:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc1NzM2OQ=="}], "type": "inlineReview"}, {"oid": "7687615d1c20fc1455e79b211964ae46992df054", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7687615d1c20fc1455e79b211964ae46992df054", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-18T17:10:10Z", "type": "forcePushed"}, {"oid": "1dd12dc846221a799094ab71649a6378ea32ed87", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1dd12dc846221a799094ab71649a6378ea32ed87", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-19T05:26:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyMTc4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381121785", "bodyText": "Shall we remove the space", "author": "warunalakshitha", "createdAt": "2020-02-19T07:45:02Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,226 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyMjIzNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381122236", "bodyText": "Shall we add  conn.disconnect to finally block", "author": "warunalakshitha", "createdAt": "2020-02-19T07:46:09Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,226 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!Paths.get(nightlyBuild).toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        }\n+        conn.disconnect();", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyMjc0MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381122740", "bodyText": "nightlyBuild or nightlyBuildMetaFile?", "author": "warunalakshitha", "createdAt": "2020-02-19T07:47:32Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,226 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!Paths.get(nightlyBuild).toFile().exists()) {", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyMzIzMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381123231", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {\n          \n          \n            \n                private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFilePath) {", "author": "warunalakshitha", "createdAt": "2020-02-19T07:48:52Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,226 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!Paths.get(nightlyBuild).toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        }\n+        conn.disconnect();\n+        Authenticator.setDefault(null);\n+    }\n+\n+    private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyNDAxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381124015", "bodyText": "why we need to ignore the error?", "author": "warunalakshitha", "createdAt": "2020-02-19T07:51:10Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,226 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!Paths.get(nightlyBuild).toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        }\n+        conn.disconnect();\n+        Authenticator.setDefault(null);\n+    }\n+\n+    private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {\n+        try {\n+            Files.createFile(nightlyBuildMetaFile);\n+        } catch (Exception e) {\n+            createError(\"error occurred while creating nightly.build file.\");\n+        }\n+    }\n+\n+    private static void copyBaloFile(String modulePath, HttpURLConnection conn, String moduleVersion, Path baloPath) {\n+        try (InputStream inputStream = conn.getInputStream();\n+                FileOutputStream outputStream = new FileOutputStream(baloPath.toString())) {\n+            byte[] buffer = new byte[1024];\n+            int count;\n+\n+            long totalSizeInKB = conn.getContentLengthLong() / 1024;\n+            try (ProgressBar progressBar = new ProgressBar(\n+                    modulePath + \":\" + moduleVersion + \" [central.ballerina.io -> home repo] \",\n+                    totalSizeInKB, 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1)) {\n+                while ((count = inputStream.read(buffer)) > 0) {\n+                    outputStream.write(buffer, 0, count);\n+                    progressBar.step();\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"error occurred copying the balo file: \" + e.getMessage());\n+        }\n+    }\n+\n+    private static void createBaloFileDirectory(Path baloCacheWithModulePath) {\n+        try {\n+            Files.createDirectory(baloCacheWithModulePath);\n+        } catch (Exception e) {\n+            createError(\"error creating directory for balo file\");\n+        }\n+    }\n+\n+    private static void handleErrorResponse(String url, String modulePath, boolean isBuild, HttpURLConnection conn,\n+            int statusCode) {\n+        try (BufferedReader reader = new BufferedReader(\n+                new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+            StringBuilder result = new StringBuilder();\n+            String line;\n+            while ((line = reader.readLine()) != null) {\n+                result.append(line);\n+            }\n+\n+            MapValue payload = (MapValue) JSONParser.parse(result.toString());\n+            String errMsg = payload.getStringValue(\"message\");\n+\n+            if (statusCode == HttpURLConnection.HTTP_NOT_FOUND && isBuild && errMsg\n+                    .contains(\"module not found\")) {\n+                // To ignore printing the error\n+                createError(\"\");", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyNDE3OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381124178", "bodyText": "Add to finally block", "author": "warunalakshitha", "createdAt": "2020-02-19T07:51:37Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Push.java", "diffHunk": "@@ -0,0 +1,121 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+\n+import java.io.BufferedReader;\n+import java.io.DataOutputStream;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.stream.Collectors;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pushing the modules to ballerina central.\n+ */\n+public class Push {\n+\n+    private static PrintStream errStream = System.err;\n+    private static PrintStream outStream = System.out;\n+\n+    private Push() {\n+    }\n+\n+    public static void execute(String url, String proxyHost, int proxyPort, String proxyUsername, String proxyPassword,\n+            String accessToken, String orgName, String moduleName, String version, Path baloPath) {\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,\n+                proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.POST);\n+\n+        // set headers.\n+        conn.setRequestProperty(\"Authorization\", \"Bearer \" + accessToken);\n+        conn.setRequestProperty(\"Push-Organization\", orgName);\n+        conn.setRequestProperty(\"Content-Type\", \"application/octet-stream\");\n+\n+        conn.setDoOutput(true);\n+        conn.setChunkedStreamingMode(1024);\n+\n+        byte[] baloContent;\n+        try {\n+            baloContent = Files.readAllBytes(baloPath);\n+        } catch (IOException e) {\n+            throw ErrorUtil.createCommandException(\"cannot read the balo content\");\n+        }\n+\n+        try (DataOutputStream outputStream = new DataOutputStream(conn.getOutputStream())) {\n+            // send post request.\n+            byte[] buffer = new byte[1024];\n+            int count;\n+            long totalSizeInMB = baloContent.length / 1024;\n+\n+            try (ProgressBar progressBar = new ProgressBar(\n+                    orgName + \"/\" + moduleName + \":\" + version + \" [project repo -> central]\", totalSizeInMB, 1000,\n+                    outStream, ProgressBarStyle.ASCII, \" KB\", 1);\n+                    FileInputStream fis = new FileInputStream(baloPath.toFile())) {\n+                while ((count = fis.read(buffer)) > 0) {\n+                    outputStream.write(buffer, 0, count);\n+                    outputStream.flush();\n+                    progressBar.step();\n+                }\n+            }\n+        } catch (FileNotFoundException e) {\n+            throw ErrorUtil.createCommandException(\"cannot read the balo content\");\n+        } catch (IOException e) {\n+            throw ErrorUtil.createCommandException(\"error occurred while uploading balo to central: \" + e.getMessage());\n+        }\n+\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                errStream.println(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode == HttpURLConnection.HTTP_UNAUTHORIZED) {\n+                errStream.println(\"unauthorized access token for organisation: \" + orgName);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                try (BufferedReader errorStream = new BufferedReader(\n+                        new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+                    String errorContent = errorStream.lines().collect(Collectors.joining(\"\\n\"));\n+                    errStream.println(errorContent);\n+                }\n+            } else {\n+                outStream.println(orgName + \"/\" + moduleName + \":\" + version + \" pushed to central successfully\");\n+            }\n+        } catch (IOException e) {\n+            throw ErrorUtil.createCommandException(e.getMessage());\n+        }\n+        conn.disconnect();", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyNDQxNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381124414", "bodyText": "Shall we add this to finally block", "author": "warunalakshitha", "createdAt": "2020-02-19T07:52:19Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Search.java", "diffHunk": "@@ -0,0 +1,236 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.ArrayValue;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.text.DateFormat;\n+import java.text.SimpleDateFormat;\n+import java.util.Date;\n+import java.util.stream.Collectors;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is searching modules from ballerina central.\n+ */\n+public class Search {\n+\n+    private static PrintStream errStream = System.err;\n+    private static PrintStream outStream = System.out;\n+\n+    private Search() {\n+    }\n+\n+    public static void execute(String url, String proxyHost, int proxyPort, String proxyUsername, String proxyPassword,\n+            String terminalWidth) {\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url), proxyHost, proxyPort, proxyUsername,\n+                proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        try {\n+            int statusCode = conn.getResponseCode();\n+\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                errStream.println(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                try (BufferedReader errorStream = new BufferedReader(\n+                        new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+                    String errorContent = errorStream.lines().collect(Collectors.joining(\"\\n\"));\n+                    errStream.println(errorContent);\n+                }\n+            } else {\n+                try (BufferedReader reader = new BufferedReader(\n+                        new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+                    StringBuilder result = new StringBuilder();\n+                    String line;\n+                    while ((line = reader.readLine()) != null) {\n+                        result.append(line);\n+                    }\n+                    MapValue payload = (MapValue) JSONParser.parse(result.toString());\n+                    if (payload.getIntValue(\"count\") > 0) {\n+                        ArrayValue modules = payload.getArrayValue(\"modules\");\n+                        printModules(modules, terminalWidth);\n+                    } else {\n+                        errStream.println(\"no modules found\");\n+                    }\n+                }\n+            }\n+        } catch (IOException e) {\n+            throw ErrorUtil.createCommandException(e.getMessage());\n+        }\n+        conn.disconnect();", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyNDgzOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381124838", "bodyText": "add close to finally block", "author": "warunalakshitha", "createdAt": "2020-02-19T07:53:34Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/TokenUpdater.java", "diffHunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import com.sun.net.httpserver.HttpExchange;\n+import com.sun.net.httpserver.HttpHandler;\n+import com.sun.net.httpserver.HttpServer;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.PrintStream;\n+import java.net.InetSocketAddress;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Collections;\n+\n+/**\n+ * This class has a service which updates the access token in the `Settings.toml` file.\n+ */\n+public class TokenUpdater {\n+\n+    private static PrintStream errStream = System.err;\n+    private static PrintStream outStream = System.out;\n+\n+    private TokenUpdater() {\n+    }\n+\n+    public static void execute() {\n+        HttpServer server;\n+        try {\n+            server = HttpServer.create(new InetSocketAddress(9295), 0);\n+        } catch (IOException e) {\n+            throw ErrorUtil.createCommandException(\"error occurred while creating the server: \" + e.getMessage());\n+        }\n+        server.createContext(\"/update-settings\", new TokenUpdateHandler());\n+        server.setExecutor(null); // creates a default executor\n+        server.start();\n+    }\n+\n+    static class TokenUpdateHandler implements HttpHandler {\n+        @Override public void handle(HttpExchange httpExchange) {\n+            String token = getToken(httpExchange.getRequestURI().getPath());\n+            String currentUsersHomeDir = System.getProperty(\"user.home\");\n+            String settingsTomlPath =\n+                    currentUsersHomeDir + File.separator + \".ballerina\" + File.separator + \"Settings.toml\";\n+            FileOutputStream outputStream = null;\n+            try {\n+                outputStream = new FileOutputStream(settingsTomlPath);\n+                String str = \"[central]\\naccesstoken=\\\"\" + token + \"\\\"\";\n+                outputStream.write(str.getBytes(StandardCharsets.UTF_8));\n+            } catch (FileNotFoundException e) {\n+                throw ErrorUtil.createCommandException(\"Settings.toml file could not be found: \" + settingsTomlPath);\n+            } catch (IOException e) {\n+                throw ErrorUtil.createCommandException(\n+                        \"error occurred while writing to the Settings.toml file: \" + e.getMessage());\n+            } finally {\n+                try {\n+                    if (outputStream != null) {\n+                        outputStream.close();\n+                    }\n+                } catch (IOException e) {\n+                    errStream.println(\"error occurred while closing the output stream: \" + e.getMessage());\n+                }\n+            }\n+            outStream.println(\"token updated\");\n+\n+            try {\n+                String response = \"<svg xmlns=\\\"http://www.w3.org/2000/svg\\\"/>\";\n+                httpExchange.getResponseHeaders().put(\"Content-Type\", Collections.singletonList(\"image/svg+xml\"));\n+                httpExchange.sendResponseHeaders(200, response.getBytes(StandardCharsets.UTF_8).length);\n+                OutputStream os = httpExchange.getResponseBody();\n+                os.write(response.getBytes(StandardCharsets.UTF_8));\n+                os.close();", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEyNTAwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r381125000", "bodyText": "Shall we use Paths.get()", "author": "warunalakshitha", "createdAt": "2020-02-19T07:54:03Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/TokenUpdater.java", "diffHunk": "@@ -0,0 +1,102 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import com.sun.net.httpserver.HttpExchange;\n+import com.sun.net.httpserver.HttpHandler;\n+import com.sun.net.httpserver.HttpServer;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+\n+import java.io.File;\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.PrintStream;\n+import java.net.InetSocketAddress;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Collections;\n+\n+/**\n+ * This class has a service which updates the access token in the `Settings.toml` file.\n+ */\n+public class TokenUpdater {\n+\n+    private static PrintStream errStream = System.err;\n+    private static PrintStream outStream = System.out;\n+\n+    private TokenUpdater() {\n+    }\n+\n+    public static void execute() {\n+        HttpServer server;\n+        try {\n+            server = HttpServer.create(new InetSocketAddress(9295), 0);\n+        } catch (IOException e) {\n+            throw ErrorUtil.createCommandException(\"error occurred while creating the server: \" + e.getMessage());\n+        }\n+        server.createContext(\"/update-settings\", new TokenUpdateHandler());\n+        server.setExecutor(null); // creates a default executor\n+        server.start();\n+    }\n+\n+    static class TokenUpdateHandler implements HttpHandler {\n+        @Override public void handle(HttpExchange httpExchange) {\n+            String token = getToken(httpExchange.getRequestURI().getPath());\n+            String currentUsersHomeDir = System.getProperty(\"user.home\");\n+            String settingsTomlPath =", "originalCommit": "1dd12dc846221a799094ab71649a6378ea32ed87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-19T16:27:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNzA1Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383837057", "bodyText": "Please add @since annotation for all the new classes.", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:03:16Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4MzExNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384583114", "bodyText": "Added", "author": "pramodya1994", "createdAt": "2020-02-26T15:50:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzgzNzA1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg0NDIwOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383844209", "bodyText": "What is the purpose of isBuild and statusCode?", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:19:24Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!nightlyBuildMetaFile.toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        } finally {\n+            conn.disconnect();\n+        }\n+        Authenticator.setDefault(null);\n+    }\n+\n+    private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {\n+        try {\n+            Files.createFile(nightlyBuildMetaFile);\n+        } catch (Exception e) {\n+            createError(\"error occurred while creating nightly.build file.\");\n+        }\n+    }\n+\n+    private static void copyBaloFile(String modulePath, HttpURLConnection conn, String moduleVersion, Path baloPath) {\n+        try (InputStream inputStream = conn.getInputStream();\n+                FileOutputStream outputStream = new FileOutputStream(baloPath.toString())) {\n+            byte[] buffer = new byte[1024];\n+            int count;\n+\n+            long totalSizeInKB = conn.getContentLengthLong() / 1024;\n+            try (ProgressBar progressBar = new ProgressBar(\n+                    modulePath + \":\" + moduleVersion + \" [central.ballerina.io -> home repo] \",\n+                    totalSizeInKB, 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1)) {\n+                while ((count = inputStream.read(buffer)) > 0) {\n+                    outputStream.write(buffer, 0, count);\n+                    progressBar.step();\n+                }\n+            }\n+            outStream.println(modulePath + \":\" + moduleVersion + \" pulled from central successfully\");\n+        } catch (IOException e) {\n+            createError(\"error occurred copying the balo file: \" + e.getMessage());\n+        }\n+    }\n+\n+    private static void createBaloFileDirectory(Path baloCacheWithModulePath) {\n+        try {\n+            Files.createDirectory(baloCacheWithModulePath);\n+        } catch (Exception e) {\n+            createError(\"error creating directory for balo file\");\n+        }\n+    }\n+\n+    private static void handleErrorResponse(String url, String modulePath, boolean isBuild, HttpURLConnection conn,", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg0NDY2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383844667", "bodyText": "Can be reformated to a single line?", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:20:27Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {\n+                createError(\"unable to connect to remote repository: \" + url);\n+            } else if (statusCode != HttpURLConnection.HTTP_OK) {\n+                if (statusCode == HttpURLConnection.HTTP_MOVED_TEMP || statusCode == HttpURLConnection.HTTP_MOVED_PERM\n+                        || statusCode == HttpURLConnection.HTTP_SEE_OTHER) {\n+                    redirect = true;\n+                } else {\n+                    handleErrorResponse(url, modulePath, isBuild, conn, statusCode);\n+                }\n+            }\n+\n+            if (redirect) {\n+                // get redirect url from \"location\" header field\n+                String newUrl = conn.getHeaderField(\"Location\");\n+                String contentDisposition = conn.getHeaderField(\"Content-Disposition\");\n+\n+                conn = createHttpUrlConnection(convertToUrl(newUrl), proxyHost, proxyPort, proxyUsername,\n+                        proxyPassword);\n+                conn.setRequestProperty(\"Content-Disposition\", contentDisposition);\n+\n+                String resolvedURI = conn.getHeaderField(\"RESOLVED_REQUESTED_URI\");\n+                if (resolvedURI == null || resolvedURI.equals(\"\")) {\n+                    resolvedURI = newUrl;\n+                }\n+                String[] uriParts = resolvedURI.split(\"/\");\n+                String moduleVersion = uriParts[uriParts.length - 3];\n+                boolean valid = moduleVersion.matches(VERSION_REGEX);\n+\n+                if (valid) {\n+                    String baloFile = setFileNameFromContentDispositionHeader(contentDisposition,\n+                            uriParts[uriParts.length - 1]);\n+                    Path baloCacheWithModulePath = Paths.get(modulePathInBaloCache, moduleVersion);\n+                    //<user.home>.ballerina/balo_cache/<org-name>/<module-name>/<module-version>\n+\n+                    Path baloPath = Paths.get(baloCacheWithModulePath.toString(), baloFile);\n+                    if (baloPath.toFile().exists()) {\n+                        createError(\"module already exists in the home repository: \" + baloPath.toString());\n+                    }\n+\n+                    createBaloFileDirectory(baloCacheWithModulePath);\n+                    copyBaloFile(modulePath, conn, moduleVersion, baloPath);\n+\n+                    if (nightlyBuild.equals(\"true\")) {\n+                        // If its a nightly build tag the file as a module from nightly\n+                        Path nightlyBuildMetaFile = Paths.get(baloCacheWithModulePath.toString(), \"nightly.build\");\n+                        if (!nightlyBuildMetaFile.toFile().exists()) {\n+                            createNightlyBuildMetaFile(nightlyBuildMetaFile);\n+                        }\n+                    }\n+                } else {\n+                    createError(\"module version could not be detected\");\n+                }\n+            }\n+        } catch (IOException e) {\n+            createError(\"connection to the remote repository host failed: \" + e.getMessage());\n+        } finally {\n+            conn.disconnect();\n+        }\n+        Authenticator.setDefault(null);\n+    }\n+\n+    private static void createNightlyBuildMetaFile(Path nightlyBuildMetaFile) {\n+        try {\n+            Files.createFile(nightlyBuildMetaFile);\n+        } catch (Exception e) {\n+            createError(\"error occurred while creating nightly.build file.\");\n+        }\n+    }\n+\n+    private static void copyBaloFile(String modulePath, HttpURLConnection conn, String moduleVersion, Path baloPath) {\n+        try (InputStream inputStream = conn.getInputStream();\n+                FileOutputStream outputStream = new FileOutputStream(baloPath.toString())) {\n+            byte[] buffer = new byte[1024];\n+            int count;\n+\n+            long totalSizeInKB = conn.getContentLengthLong() / 1024;\n+            try (ProgressBar progressBar = new ProgressBar(\n+                    modulePath + \":\" + moduleVersion + \" [central.ballerina.io -> home repo] \",\n+                    totalSizeInKB, 1000, outStream, ProgressBarStyle.ASCII, \" KB\", 1)) {\n+                while ((count = inputStream.read(buffer)) > 0) {\n+                    outputStream.write(buffer, 0, count);\n+                    progressBar.step();\n+                }\n+            }\n+            outStream.println(modulePath + \":\" + moduleVersion + \" pulled from central successfully\");\n+        } catch (IOException e) {\n+            createError(\"error occurred copying the balo file: \" + e.getMessage());\n+        }\n+    }\n+\n+    private static void createBaloFileDirectory(Path baloCacheWithModulePath) {\n+        try {\n+            Files.createDirectory(baloCacheWithModulePath);\n+        } catch (Exception e) {\n+            createError(\"error creating directory for balo file\");\n+        }\n+    }\n+\n+    private static void handleErrorResponse(String url, String modulePath, boolean isBuild, HttpURLConnection conn,\n+            int statusCode) {\n+        try (BufferedReader reader = new BufferedReader(\n+                new InputStreamReader(conn.getInputStream(), Charset.defaultCharset()))) {\n+            StringBuilder result = new StringBuilder();\n+            String line;\n+            while ((line = reader.readLine()) != null) {\n+                result.append(line);\n+            }\n+\n+            MapValue payload = (MapValue) JSONParser.parse(result.toString());\n+            String errMsg = payload.getStringValue(\"message\");\n+            createError(errMsg);\n+        } catch (IOException e) {\n+            createError(\"failed to pull the module '\" + modulePath + \"' from the remote repository '\" +\n+                    url + \"'\");", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg0NjI4Mg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383846282", "bodyText": "Can platform become null? Should we use null safe check? i.e. \"\".equals(platform)?", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:24:07Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1MTYyOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383851628", "bodyText": "Seems proxyPortAsString and executor is not needed anymore.", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:36:11Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/packaging/converters/URIConverter.java", "diffHunk": "@@ -127,35 +128,36 @@ public URI combine(URI s, String p) {\n         String nightlyBuild = String.valueOf(RepoUtils.getBallerinaVersion().contains(\"SNAPSHOT\"));\n         EmbeddedExecutor executor = EmbeddedExecutorProvider.getInstance().getExecutor();\n         for (String supportedPlatform : SUPPORTED_PLATFORMS) {\n-            Optional<RuntimeException> runtimeException = executor.executeMainFunction(\"module_pull\",\n-                    remoteURI.toString(), modulePathInBaloCache.toString(), modulePath, proxy.getHost(),\n-                    proxyPortAsString, proxy.getUserName(), proxy.getPassword(), RepoUtils.getTerminalWidth(),\n-                    supportedVersionRange, String.valueOf(this.isBuild), nightlyBuild, IMPLEMENTATION_VERSION,\n-                    supportedPlatform);\n-            // Check if error has occurred or not.\n-            if (runtimeException.isPresent()) {\n-                String errorMessage = runtimeException.get().getMessage();\n-                if (null != errorMessage && !\"\".equals(errorMessage.trim())) {\n-                    // removing the error stack\n-                    if (errorMessage.contains(\"\\n\\tat\")) {\n-                        errorMessage = errorMessage.substring(0, errorMessage.indexOf(\"\\n\\tat\"));\n-                    }\n-    \n-                    // if module already exists in home repository\n-                    if (errorMessage.contains(\"module already exists in the home repository\") && this.isBuild) {\n-                        // Need to update the version of moduleID that was resolved by remote. But since the version\n-                        // cannot be returned by the call done to module_pull.bal file we need to set the version from\n-                        // the downloaded balo file.\n-                        Patten patten = this.homeBaloRepo.calculate(moduleID);\n-                        return patten.convertToSources(this.homeBaloRepo.getConverterInstance(), moduleID);\n-                    }\n-\n-                    // check if the message is empty or not. Empty means module not found. Else some other error.\n-                    // Log if it is some other error.\n-                    if (!\"\".equals(errorMessage.replace(\"error: \\t\", \"\").trim())) {\n-                        this.errStream.println(errorMessage.trim());\n-                        return Stream.of();\n-                    }\n+            String errorMessage = \"\";", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQzNjc4OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384436788", "bodyText": "removed proxyPortAsString and executor", "author": "pramodya1994", "createdAt": "2020-02-26T11:33:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1MTYyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1MjkzOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383852939", "bodyText": "Why nightlyBuild is passed as a string here? Seems a boolean can be passed directly as it is taken as String.valueOf(RepoUtils.getBallerinaVersion().contains(\"SNAPSHOT\")); in the caller function.", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:38:57Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQzNjk3NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384436975", "bodyText": "Made it a boolean and removed string conversion.", "author": "pramodya1994", "createdAt": "2020-02-26T11:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1MjkzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1OTIxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383859217", "bodyText": "Can we check statusCode >= 500 here?", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:52:35Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);\n+        }\n+        conn.setRequestProperty(\"Accept-Encoding\", \"identity\");\n+\n+        boolean redirect = false;\n+        try {\n+            int statusCode = conn.getResponseCode();\n+            if (Integer.toString(statusCode).startsWith(\"5\")) {", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQzNzIyMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384437221", "bodyText": "Changed the implementation", "author": "pramodya1994", "createdAt": "2020-02-26T11:34:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg1OTIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2MTQ5MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r383861491", "bodyText": "Shall we add a constants class and move all these string constants there? Then it will be easy to track and change if required in future.", "author": "anupama-pathirage", "createdAt": "2020-02-25T12:57:17Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/Pull.java", "diffHunk": "@@ -0,0 +1,220 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import me.tongfei.progressbar.ProgressBar;\n+import me.tongfei.progressbar.ProgressBarStyle;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+import org.ballerinalang.cli.module.util.Utils;\n+import org.ballerinalang.jvm.JSONParser;\n+import org.ballerinalang.jvm.values.MapValue;\n+\n+import java.io.BufferedReader;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.io.PrintStream;\n+import java.net.Authenticator;\n+import java.net.HttpURLConnection;\n+import java.nio.charset.Charset;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+\n+import static org.ballerinalang.cli.module.util.Utils.convertToUrl;\n+import static org.ballerinalang.cli.module.util.Utils.createHttpUrlConnection;\n+import static org.ballerinalang.cli.module.util.Utils.initializeSsl;\n+import static org.ballerinalang.cli.module.util.Utils.setRequestMethod;\n+\n+/**\n+ * This class is pulling the modules from ballerina central.\n+ */\n+public class Pull {\n+    private static final String VERSION_REGEX = \"(\\\\d+\\\\.)(\\\\d+\\\\.)(\\\\d+)\";\n+    private static PrintStream outStream = System.out;\n+    private static DefaultLogFormatter logFormatter = new DefaultLogFormatter();\n+\n+    private Pull() {\n+    }\n+\n+    public static void execute(String url, String modulePathInBaloCache, String modulePath, String proxyHost,\n+            int proxyPort, String proxyUsername, String proxyPassword, String supportedVersionRange, boolean isBuild,\n+            String nightlyBuild, String langSpecVersion, String platform) {\n+        if (isBuild) {\n+            logFormatter = new BuildLogFormatter();\n+        }\n+\n+        initializeSsl();\n+        HttpURLConnection conn = createHttpUrlConnection(convertToUrl(url + supportedVersionRange), proxyHost,\n+                proxyPort, proxyUsername, proxyPassword);\n+        conn.setInstanceFollowRedirects(false);\n+        setRequestMethod(conn, Utils.RequestMethod.GET);\n+\n+        // set headers.\n+        if (!platform.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Platform\", platform);\n+        }\n+        if (!langSpecVersion.equals(\"\")) {\n+            conn.setRequestProperty(\"Ballerina-Language-Specification-Version\", langSpecVersion);", "originalCommit": "25c9755acffbd2103e98e4e0bb3fbf2a04701e39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDU4MzMyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384583324", "bodyText": "Added to a seperate class", "author": "pramodya1994", "createdAt": "2020-02-26T15:51:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg2MTQ5MQ=="}], "type": "inlineReview"}, {"oid": "94943f291600a2fd929b48d2ac85a13e8f9a63aa", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/94943f291600a2fd929b48d2ac85a13e8f9a63aa", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-26T10:37:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ3ODM2OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384478369", "bodyText": "Is it ok to use hard coded port here? What if it is already used?", "author": "anupama-pathirage", "createdAt": "2020-02-26T13:04:41Z", "path": "cli/ballerina-cli-module/src/main/java/org/ballerinalang/cli/module/TokenUpdater.java", "diffHunk": "@@ -0,0 +1,112 @@\n+// Copyright (c) 2020 WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+//\n+// WSO2 Inc. licenses this file to you under the Apache License,\n+// Version 2.0 (the \"License\"); you may not use this file except\n+// in compliance with the License.\n+// You may obtain a copy of the License at\n+//\n+// http://www.apache.org/licenses/LICENSE-2.0\n+//\n+// Unless required by applicable law or agreed to in writing,\n+// software distributed under the License is distributed on an\n+// \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+// KIND, either express or implied.  See the License for the\n+// specific language governing permissions and limitations\n+// under the License.\n+\n+package org.ballerinalang.cli.module;\n+\n+import com.sun.net.httpserver.HttpExchange;\n+import com.sun.net.httpserver.HttpHandler;\n+import com.sun.net.httpserver.HttpServer;\n+import org.ballerinalang.cli.module.util.ErrorUtil;\n+\n+import java.io.FileNotFoundException;\n+import java.io.FileOutputStream;\n+import java.io.IOException;\n+import java.io.OutputStream;\n+import java.io.PrintStream;\n+import java.net.InetSocketAddress;\n+import java.nio.charset.StandardCharsets;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+\n+/**\n+ * This class has a service which updates the access token in the `Settings.toml` file.\n+ */\n+public class TokenUpdater {\n+\n+    private static PrintStream errStream = System.err;\n+    private static PrintStream outStream = System.out;\n+\n+    private TokenUpdater() {\n+    }\n+\n+    public static void execute(String settingsTomlFilePath) {\n+        HttpServer server;\n+        try {\n+            server = HttpServer.create(new InetSocketAddress(9295), 0);", "originalCommit": "94943f291600a2fd929b48d2ac85a13e8f9a63aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDUyNzQzOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21016#discussion_r384527438", "bodyText": "At the moment we are only returning an error message. Still couldn't come up with a fix for this.", "author": "pramodya1994", "createdAt": "2020-02-26T14:30:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ3ODM2OQ=="}], "type": "inlineReview"}, {"oid": "c7be46f7582df04944f1ec8c53e3915452eaf851", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c7be46f7582df04944f1ec8c53e3915452eaf851", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-26T15:50:05Z", "type": "forcePushed"}, {"oid": "24ec9e2714655f87c04edc31ae594e2a3f05b5ae", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/24ec9e2714655f87c04edc31ae594e2a3f05b5ae", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-26T17:35:41Z", "type": "forcePushed"}, {"oid": "a577d3adbb4d7e84088fe7f4e756efb786a29089", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a577d3adbb4d7e84088fe7f4e756efb786a29089", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-27T08:12:55Z", "type": "forcePushed"}, {"oid": "c422f0b172f292f96e5db5f504b5d652642d0395", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c422f0b172f292f96e5db5f504b5d652642d0395", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-27T08:30:20Z", "type": "forcePushed"}, {"oid": "085d82d6ed23bfa870ade72155f3cb7e9da23237", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/085d82d6ed23bfa870ade72155f3cb7e9da23237", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-27T13:29:51Z", "type": "forcePushed"}, {"oid": "7d48a92ffd55eafddc31586f2aea0561497cbc88", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7d48a92ffd55eafddc31586f2aea0561497cbc88", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-02-27T17:49:37Z", "type": "forcePushed"}, {"oid": "e4cff210f7396e329d15acf06fb4d4955bd1cb43", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e4cff210f7396e329d15acf06fb4d4955bd1cb43", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-03-02T05:42:09Z", "type": "commit"}, {"oid": "e4cff210f7396e329d15acf06fb4d4955bd1cb43", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e4cff210f7396e329d15acf06fb4d4955bd1cb43", "message": "Implement CLI module implementation in Java\n\nRewrite the CLI module implementation in Java which has\nimplemented using Ballerina.\n\nFixes https://github.com/ballerina-platform/ballerina-lang/issues/21015", "committedDate": "2020-03-02T05:42:09Z", "type": "forcePushed"}, {"oid": "4f58dc06d8b17b8d0b34d5252a5445537710d01c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4f58dc06d8b17b8d0b34d5252a5445537710d01c", "message": "Merge branch 'master' into bal2java-central-cmd", "committedDate": "2020-03-02T11:44:18Z", "type": "commit"}, {"oid": "123151bcd1e731dceeefa85ea76bf07b51caa263", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/123151bcd1e731dceeefa85ea76bf07b51caa263", "message": "Fix corrupted balo file issue in Pull.java", "committedDate": "2020-03-02T12:55:44Z", "type": "commit"}]}