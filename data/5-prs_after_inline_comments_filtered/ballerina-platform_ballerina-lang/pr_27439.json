{"pr_number": 27439, "pr_title": "Refactor and improve project API util methods", "pr_createdAt": "2020-12-10T14:49:57Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439", "timeline": [{"oid": "21a892b9cfe35c5fcd370214d86eb0415824c66e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/21a892b9cfe35c5fcd370214d86eb0415824c66e", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-10T14:50:25Z", "type": "forcePushed"}, {"oid": "94dc0c0951e8adf61cdc517b83d0cc050f93d655", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/94dc0c0951e8adf61cdc517b83d0cc050f93d655", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-10T15:05:30Z", "type": "forcePushed"}, {"oid": "aa75699c875d994655aa0a7ad71a2a1d304b618c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa75699c875d994655aa0a7ad71a2a1d304b618c", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-10T15:41:10Z", "type": "forcePushed"}, {"oid": "e61c1a59ac0f53511f2d8a0f8321fecaf7953ab7", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e61c1a59ac0f53511f2d8a0f8321fecaf7953ab7", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-10T16:04:04Z", "type": "forcePushed"}, {"oid": "533684968773835c280cb9f1a01989c0d1770112", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/533684968773835c280cb9f1a01989c0d1770112", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-11T07:34:03Z", "type": "forcePushed"}, {"oid": "b2c2d1591b1ad094d17fe9ba6a959300360162e5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b2c2d1591b1ad094d17fe9ba6a959300360162e5", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-11T08:22:57Z", "type": "forcePushed"}, {"oid": "86922cc42be3c129a57dbe92d935fbab9b5d0bfe", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/86922cc42be3c129a57dbe92d935fbab9b5d0bfe", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-11T08:45:31Z", "type": "forcePushed"}, {"oid": "8082df7b420ec7921e7e3c62c07391f1fc82df0f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8082df7b420ec7921e7e3c62c07391f1fc82df0f", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-11T08:52:40Z", "type": "forcePushed"}, {"oid": "981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2020-12-11T09:03:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjYxOTc0NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542619744", "bodyText": "License header missing.", "author": "hemikak", "createdAt": "2020-12-14T18:33:20Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/ProjectPaths.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package io.ballerina.projects.directory;", "originalCommit": "981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1MDMxMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r543050310", "bodyText": "Added in 1594be0", "author": "azinneera", "createdAt": "2020-12-15T05:08:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjYxOTc0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNjk5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542926990", "bodyText": "Let's move this class to io.ballerina.projects.util class.", "author": "sameerajayasoma", "createdAt": "2020-12-14T23:41:20Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/ProjectPaths.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package io.ballerina.projects.directory;", "originalCommit": "981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1MDMwMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r543050300", "bodyText": "Moved in 1594be0", "author": "azinneera", "createdAt": "2020-12-15T05:08:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNjk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNzEyMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542927122", "bodyText": "Missing  @SInCE 2.0.0", "author": "sameerajayasoma", "createdAt": "2020-12-14T23:41:42Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/ProjectPaths.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package io.ballerina.projects.directory;\n+\n+import io.ballerina.projects.Project;\n+import io.ballerina.projects.ProjectException;\n+import io.ballerina.projects.util.ProjectConstants;\n+import org.wso2.ballerinalang.compiler.util.ProjectDirConstants;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Optional;\n+\n+/**\n+ * Consists of static methods that may be used to obtain {@link Project}\n+ * information using file paths.\n+ */", "originalCommit": "981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA1MDI5NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r543050294", "bodyText": "Added in 1594be0", "author": "azinneera", "createdAt": "2020-12-15T05:08:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkyNzEyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMTI1OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542931258", "bodyText": "Do we need to support other files here? e.g., resources, Package.md, Ballerina.toml etc", "author": "sameerajayasoma", "createdAt": "2020-12-14T23:51:18Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/ProjectPaths.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package io.ballerina.projects.directory;\n+\n+import io.ballerina.projects.Project;\n+import io.ballerina.projects.ProjectException;\n+import io.ballerina.projects.util.ProjectConstants;\n+import org.wso2.ballerinalang.compiler.util.ProjectDirConstants;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Optional;\n+\n+/**\n+ * Consists of static methods that may be used to obtain {@link Project}\n+ * information using file paths.\n+ */\n+public class ProjectPaths {\n+\n+    /**\n+     * Finds the root directory of a Ballerina package using the filepath provided.\n+     *\n+     * @param filepath ballerina file that belongs to a package\n+     * @return path to the package root directory\n+     * @throws ProjectException if the provided path is invalid or if it is a standalone ballerina file\n+     */\n+    public static Path findPackageRoot(Path filepath) throws ProjectException {", "originalCommit": "981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMzEwNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542933105", "bodyText": "AFAIR, what we discussed was to introduce two APIs:\n\nCheck whether a given path belongs to a package?\nGet the package root path from a given file path", "author": "sameerajayasoma", "createdAt": "2020-12-14T23:56:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMTI1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA0OTcxNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r543049715", "bodyText": "Yes, the discussed APIs are the ones you mentioned. +1, to add other files. When we support resources, should we support multiple directory levels?", "author": "azinneera", "createdAt": "2020-12-15T05:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzMTI1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNzA0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542937043", "bodyText": "It is not correct to get the module name from the moduleId. Use moduleId to get the ModuleContext.\nWhat's inside moduleId is just for debugging purposes.", "author": "sameerajayasoma", "createdAt": "2020-12-15T00:02:07Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/directory/BuildProject.java", "diffHunk": "@@ -111,4 +114,38 @@ private BuildProject(ProjectEnvironmentBuilder environmentBuilder, Path projectP\n         }\n         return Optional.empty();\n     }\n+\n+    @Override\n+    public DocumentId documentId(Path file) {\n+        ProjectPaths.findPackageRoot(file);\n+        Path parent = Optional.of(file.toAbsolutePath().getParent()).get();\n+        for (ModuleId moduleId : this.currentPackage().moduleIds()) {\n+            String moduleDirName;\n+            if (moduleId.moduleName().contains(DOT)) {", "originalCommit": "981293c0e5e55d2d3b3c4a86fe6d636713e51e04", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzODEwMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r542938101", "bodyText": "ModuleId.moduleName() is public method which is not correct. Please remove that as well.", "author": "sameerajayasoma", "createdAt": "2020-12-15T00:03:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA0ODg0Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r543048847", "bodyText": "ModuleContext is not visible to the BuildProject. What should we do in that case?", "author": "azinneera", "createdAt": "2020-12-15T05:03:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDczMzE5OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r544733199", "bodyText": "We need to restructure the Java packages in io.ballerina.projects to make it work. We can move whatever in the directory package to the io.ballerina.projects package.", "author": "sameerajayasoma", "createdAt": "2020-12-17T01:00:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNzA0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjE1NzEwNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r546157107", "bodyText": "Let's go ahead with the current implementation for now. We need to refactor the packages to fix this properly", "author": "sameerajayasoma", "createdAt": "2020-12-19T00:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjkzNzA0Mw=="}], "type": "inlineReview"}, {"oid": "5249c8e8abf09c371c935eafff71df7f5f524561", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/5249c8e8abf09c371c935eafff71df7f5f524561", "message": "Address review suggestions", "committedDate": "2020-12-15T05:04:09Z", "type": "forcePushed"}, {"oid": "1594be067e816aa6d6e1238d175cec9ef1513090", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1594be067e816aa6d6e1238d175cec9ef1513090", "message": "Address review suggestions", "committedDate": "2020-12-15T05:07:15Z", "type": "forcePushed"}, {"oid": "c61d6c6331463e6185626d11a37f0cef4a04e669", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/c61d6c6331463e6185626d11a37f0cef4a04e669", "message": "Address review suggestions", "committedDate": "2020-12-15T05:47:51Z", "type": "forcePushed"}, {"oid": "0d270ee161c66880f0805f065833d341af80a6d5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0d270ee161c66880f0805f065833d341af80a6d5", "message": "Update project path utils as per the review suggestions", "committedDate": "2020-12-21T06:36:51Z", "type": "forcePushed"}, {"oid": "30cfff21151408ce4b521d63c5fca1a7601e36e1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/30cfff21151408ce4b521d63c5fca1a7601e36e1", "message": "Update project path utils as per the review suggestions", "committedDate": "2020-12-21T08:22:37Z", "type": "forcePushed"}, {"oid": "f68675adc1a57979a103bef0c08cecd59140d8d1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/f68675adc1a57979a103bef0c08cecd59140d8d1", "message": "Update project path utils as per the review suggestions", "committedDate": "2020-12-23T07:14:36Z", "type": "forcePushed"}, {"oid": "012e775e468d57ca1f217d6db01edc0e3f0d0144", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/012e775e468d57ca1f217d6db01edc0e3f0d0144", "message": "Improve project path utils", "committedDate": "2021-01-11T06:40:26Z", "type": "forcePushed"}, {"oid": "1522bb197becc7ef5280a8866014d2bb157f79d8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1522bb197becc7ef5280a8866014d2bb157f79d8", "message": "Improve project path utils", "committedDate": "2021-01-11T06:48:52Z", "type": "forcePushed"}, {"oid": "25c104777fe2d66140be8a7f18e5e5567239b9ab", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/25c104777fe2d66140be8a7f18e5e5567239b9ab", "message": "Improve project path utils", "committedDate": "2021-01-11T19:06:11Z", "type": "forcePushed"}, {"oid": "377c52fe54c2edc415cd40ed3891e756942c9a7f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/377c52fe54c2edc415cd40ed3891e756942c9a7f", "message": "Introduce ProjectPaths utility", "committedDate": "2021-01-15T14:39:29Z", "type": "commit"}, {"oid": "82a32cfa3316634931a8361e2350c1331f283d3f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/82a32cfa3316634931a8361e2350c1331f283d3f", "message": "Add an API to retrieve documentId from document path in Project", "committedDate": "2021-01-15T14:39:29Z", "type": "commit"}, {"oid": "68f101ffa1f306c522c354e931c51e1d74c3802d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/68f101ffa1f306c522c354e931c51e1d74c3802d", "message": "Remove ProjectLoader#getDocumentId and refactor to use the Project", "committedDate": "2021-01-15T14:39:29Z", "type": "commit"}, {"oid": "8785519dcf7053f56d5fa93de6128bf4703f4dc6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8785519dcf7053f56d5fa93de6128bf4703f4dc6", "message": "Address review suggestions", "committedDate": "2021-01-15T14:39:29Z", "type": "commit"}, {"oid": "25c631517c2f34465e8fbb2a2dd5e05559f73b1f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/25c631517c2f34465e8fbb2a2dd5e05559f73b1f", "message": "Update project path utils as per the review suggestions", "committedDate": "2021-01-15T14:39:29Z", "type": "commit"}, {"oid": "eebd3f097540af3058b18d6c47affb71d3ceecba", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eebd3f097540af3058b18d6c47affb71d3ceecba", "message": "Improve project path utils", "committedDate": "2021-01-15T14:39:29Z", "type": "forcePushed"}, {"oid": "b11dc70e9cf2d70a6b16654d6321ede54b4be2da", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b11dc70e9cf2d70a6b16654d6321ede54b4be2da", "message": "Improve project path utils", "committedDate": "2021-01-15T15:06:38Z", "type": "commit"}, {"oid": "b11dc70e9cf2d70a6b16654d6321ede54b4be2da", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b11dc70e9cf2d70a6b16654d6321ede54b4be2da", "message": "Improve project path utils", "committedDate": "2021-01-15T15:06:38Z", "type": "forcePushed"}, {"oid": "98e46a3e4d5225a6c1a9102d830fc366e3edd6d2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98e46a3e4d5225a6c1a9102d830fc366e3edd6d2", "message": "Fix failing jballerina unit test", "committedDate": "2021-01-15T15:32:12Z", "type": "commit"}, {"oid": "98e46a3e4d5225a6c1a9102d830fc366e3edd6d2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/98e46a3e4d5225a6c1a9102d830fc366e3edd6d2", "message": "Fix failing jballerina unit test", "committedDate": "2021-01-15T15:32:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU3MzY2NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r547573664", "bodyText": "What we had previously (findPackageRoot ) is better IMO.", "author": "sameerajayasoma", "createdAt": "2020-12-23T00:37:14Z", "path": "compiler/ballerina-lang/src/main/java/io/ballerina/projects/util/ProjectPaths.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ *  Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ *  WSO2 Inc. licenses this file to you under the Apache License,\n+ *  Version 2.0 (the \"License\"); you may not use this file except\n+ *  in compliance with the License.\n+ *  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ *  Unless required by applicable law or agreed to in writing,\n+ *  software distributed under the License is distributed on an\n+ *  \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ *  KIND, either express or implied.  See the License for the\n+ *  specific language governing permissions and limitations\n+ *  under the License.\n+ */\n+package io.ballerina.projects.util;\n+\n+import io.ballerina.projects.Project;\n+import io.ballerina.projects.ProjectException;\n+import org.wso2.ballerinalang.compiler.util.ProjectDirConstants;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.Optional;\n+\n+import static io.ballerina.projects.util.ProjectConstants.BALLERINA_TOML;\n+\n+/**\n+ * Consists of static methods that may be used to obtain {@link Project}\n+ * information using file paths.\n+ *\n+ * @since 2.0.0\n+ */\n+public class ProjectPaths {\n+\n+    /**\n+     * Finds the root directory of a Ballerina package using the filepath provided.\n+     *\n+     * @param filepath ballerina file that belongs to a package\n+     * @return path to the package root directory\n+     * @throws ProjectException if the provided path is invalid or if it is a standalone ballerina file\n+     */\n+    public static Path packageRoot(Path filepath) throws ProjectException {", "originalCommit": "30cfff21151408ce4b521d63c5fca1a7601e36e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU3NDc5MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/27439#discussion_r547574790", "bodyText": "This method should simply traverse recursively until it finds a Ballerina.toml. We don't need to complicate this method IMO.", "author": "sameerajayasoma", "createdAt": "2020-12-23T00:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzU3MzY2NA=="}], "type": "inlineReview"}]}