{"pr_number": 23640, "pr_title": "Fix failure when iterating over empty array", "pr_createdAt": "2020-06-01T06:10:31Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA2MzQ0OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433063449", "bodyText": "I'm not sure if this is the correct fix. IMO, we should only be creating a union type if there's at least two members. So ideally we wouldn't have a union with no members.\nThis is the approach we usually take in the compiler too. See https://github.com/ballerina-platform/ballerina-lang/blob/master/compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/TypeChecker.java#L3831", "author": "MaryamZi", "createdAt": "2020-06-01T06:30:29Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -2193,6 +2193,9 @@ private static boolean checkFillerValue(BUnionType type) {\n         if (type.isNullable()) {\n             return true;\n         }\n+        if (type.getMemberTypes().isEmpty()) {", "originalCommit": "05eb7439b2cec87b430590e313b3b8087fbf070e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA2MzU2MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433063560", "bodyText": "Shall we move the assertion logic to the bal source?", "author": "MaryamZi", "createdAt": "2020-06-01T06:30:50Z", "path": "tests/jballerina-unit-test/src/test/java/org/ballerinalang/test/jvm/ForeachArrayTests.java", "diffHunk": "@@ -218,4 +218,11 @@ public void testArrayWithNullElements() {\n         Assert.assertEquals(returns.length, 1);\n         Assert.assertEquals(returns[0].stringValue(), \"0:d0 1: 2:d2 3: \");\n     }\n+\n+    @Test\n+    public void testEmptyArray() {", "originalCommit": "05eb7439b2cec87b430590e313b3b8087fbf070e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e9915dead0e03ae1eebac9aacc3ad554466eaae9", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e9915dead0e03ae1eebac9aacc3ad554466eaae9", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-01T09:59:25Z", "type": "forcePushed"}, {"oid": "6f6e0c2e28805d28933678430762c262fc271cab", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6f6e0c2e28805d28933678430762c262fc271cab", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-01T10:18:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzIwODY0Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433208643", "bodyText": "Wouldn't this cause issues when the source type has just a rest-descriptor?\nI think the following will produce an incorrect result with this change.\nimport ballerina/io;\n\npublic function main() {\n    [int...] x = [1, 2];\n    any y = x;\n    io:println(y is string[]);\n}\nWe should ideally have tests for the same too.", "author": "MaryamZi", "createdAt": "2020-06-01T12:37:16Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -974,6 +974,9 @@ private static boolean checkIsArrayType(BType sourceType, BArrayType targetType,\n             sourceArrayType = (BArrayType) sourceType;\n         } else {\n             BTupleType sourceTupleType = (BTupleType) sourceType;\n+            if (sourceTupleType.getTupleTypes().isEmpty()) {", "originalCommit": "6f6e0c2e28805d28933678430762c262fc271cab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI4OTMxNw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433289317", "bodyText": "Thanks fixed", "author": "riyafa", "createdAt": "2020-06-01T15:04:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzIwODY0Mw=="}], "type": "inlineReview"}, {"oid": "0b0d7cb97f478cdad21bda9c667da582197e2111", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0b0d7cb97f478cdad21bda9c667da582197e2111", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-01T15:03:23Z", "type": "forcePushed"}, {"oid": "7f69ee4fd6e574be68101a7ebee52b083d74ba21", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7f69ee4fd6e574be68101a7ebee52b083d74ba21", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-01T15:04:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYzOTg2MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433639860", "bodyText": "This will not work for something like\nimport ballerina/io;\n\npublic function main() {\n    var x = [];\n\n    any a = x;\n    io:println(x is int[2]); // should be false\n}\nI think if tupleTypes.isEmpty() we should return true only if the target array state is ArrayState.UNSEALED or the target size is also 0.", "author": "MaryamZi", "createdAt": "2020-06-02T06:07:17Z", "path": "bvm/ballerina-runtime/src/main/java/org/ballerinalang/jvm/TypeChecker.java", "diffHunk": "@@ -978,6 +978,9 @@ private static boolean checkIsArrayType(BType sourceType, BArrayType targetType,\n             if (sourceTupleType.getRestType() != null) {\n                 tupleTypes.add(sourceTupleType.getRestType());\n             }\n+            if (tupleTypes.isEmpty()) {", "originalCommit": "7f69ee4fd6e574be68101a7ebee52b083d74ba21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcwMzQ5MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/23640#discussion_r433703491", "bodyText": "Fixed thanks.", "author": "riyafa", "createdAt": "2020-06-02T08:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzYzOTg2MA=="}], "type": "inlineReview"}, {"oid": "52aea5e94bf306c3e3d368a0e92ad95669fe4d19", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/52aea5e94bf306c3e3d368a0e92ad95669fe4d19", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-02T08:15:24Z", "type": "forcePushed"}, {"oid": "e48b9c3cee705277c1357c5bfeb6fb81b1c44afc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e48b9c3cee705277c1357c5bfeb6fb81b1c44afc", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-02T08:30:11Z", "type": "forcePushed"}, {"oid": "13f592ca7c1567c6440f5147bb93d8a7afe8d3eb", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/13f592ca7c1567c6440f5147bb93d8a7afe8d3eb", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-03T01:54:39Z", "type": "forcePushed"}, {"oid": "520d82ba957835d1b0b7d471be0c74bb5fae00be", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/520d82ba957835d1b0b7d471be0c74bb5fae00be", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-03T05:30:07Z", "type": "forcePushed"}, {"oid": "4c7a746d32710036015caf91d3cabb9a2d4e85c5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4c7a746d32710036015caf91d3cabb9a2d4e85c5", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-03T09:21:17Z", "type": "commit"}, {"oid": "4c7a746d32710036015caf91d3cabb9a2d4e85c5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/4c7a746d32710036015caf91d3cabb9a2d4e85c5", "message": "Fix failure when iterating over empty array\n\nResolve https://github.com/ballerina-platform/ballerina-lang/issues/23499", "committedDate": "2020-06-03T09:21:17Z", "type": "forcePushed"}]}