{"pr_number": 24037, "pr_title": "Add transaction related changes and api docs", "pr_createdAt": "2020-06-12T16:17:25Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/24037", "timeline": [{"oid": "ad2c373218ca93105b83526f639128cfbcabc2cd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ad2c373218ca93105b83526f639128cfbcabc2cd", "message": "Add transaction related changes and api docs", "committedDate": "2020-06-12T16:16:08Z", "type": "commit"}, {"oid": "00fb5fb25e59aca537e3d9324bcf1535b8c8092f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/00fb5fb25e59aca537e3d9324bcf1535b8c8092f", "message": "Add formatting changes", "committedDate": "2020-06-12T16:34:15Z", "type": "commit"}, {"oid": "20d1f21e4feb23f9599b52fa67bfc9b54de1367f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/20d1f21e4feb23f9599b52fa67bfc9b54de1367f", "message": "Remove sql module name", "committedDate": "2020-06-12T16:42:05Z", "type": "commit"}, {"oid": "b0bb10d4debd0aa76290e8b7fbd275fee2ce4aa3", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b0bb10d4debd0aa76290e8b7fbd275fee2ce4aa3", "message": "Apply suggestions from code review\n\nCo-authored-by: praneesha <praneesha@wso2.com>", "committedDate": "2020-06-12T17:53:05Z", "type": "commit"}, {"oid": "29a9dd945e66f38a7aa3bc2d144e81af96db4242", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/29a9dd945e66f38a7aa3bc2d144e81af96db4242", "message": "Merge branch 'upstream-master' into transaction-changes", "committedDate": "2020-06-12T17:58:41Z", "type": "commit"}, {"oid": "a13e67fa7f6cf6603f425335872d8184449a1c33", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/a13e67fa7f6cf6603f425335872d8184449a1c33", "message": "Merge remote-tracking branch 'origin/transaction-changes' into transaction-changes", "committedDate": "2020-06-12T17:59:13Z", "type": "commit"}, {"oid": "bf8f012f3f3e0212f36b44397e66cec7cacfe775", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bf8f012f3f3e0212f36b44397e66cec7cacfe775", "message": "Fix failing testcases based on the latest transaction fixes", "committedDate": "2020-06-12T18:54:49Z", "type": "commit"}, {"oid": "8d83edd04c02621b84629eb75d70081abb2ddd50", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8d83edd04c02621b84629eb75d70081abb2ddd50", "message": "Apply suggestions from code review\n\nCo-authored-by: praneesha <praneesha@wso2.com>", "committedDate": "2020-06-12T18:58:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxMjAzMw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24037#discussion_r439712033", "bodyText": "Shouldn't we set autoCommit to false here? Else we cant rollback if an error occurs", "author": "niveathika", "createdAt": "2020-06-13T05:45:52Z", "path": "stdlib/database/sql/src/main/java/org/ballerinalang/sql/datasource/SQLDatasource.java", "diffHunk": "@@ -45,13 +48,30 @@\n     private AtomicInteger clientCounter = new AtomicInteger(0);\n     private Lock mutex = new ReentrantLock();\n     private boolean poolShutdown = false;\n+    private boolean xaConn;\n+    private XADataSource xaDataSource;\n \n     private SQLDatasource(SQLDatasourceParams sqlDatasourceParams) {\n         buildDataSource(sqlDatasourceParams);\n-        try (Connection con = getSQLConnection()) {\n+        Connection connection = null;\n+        try {\n+            xaConn = hikariDataSource.isWrapperFor(XADataSource.class);\n+            if (xaConn) {\n+                xaDataSource = hikariDataSource.unwrap(XADataSource.class);\n+                connection = xaDataSource.getXAConnection().getConnection();\n+            } else {\n+                connection = getConnection();", "originalCommit": "8d83edd04c02621b84629eb75d70081abb2ddd50", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxMzcxOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24037#discussion_r439713719", "bodyText": "Here I'm just checking whether valid connection can be obtained, not doing any other queries. But for the case of transaction, I'm setting autoCommit to false as you mentioned here - \n  \n    \n      ballerina-lang/stdlib/database/sql/src/main/java/org/ballerinalang/sql/datasource/SQLDatasourceUtils.java\n    \n    \n         Line 112\n      in\n      8d83edd\n    \n    \n    \n    \n\n        \n          \n           conn.setAutoCommit(false);", "author": "sinthuja", "createdAt": "2020-06-13T06:18:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxMjAzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxNDA4NA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/24037#discussion_r439714084", "bodyText": "Noted", "author": "niveathika", "createdAt": "2020-06-13T06:25:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTcxMjAzMw=="}], "type": "inlineReview"}, {"oid": "454cec1fbad588042765526ee0678d3e5a7410bf", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/454cec1fbad588042765526ee0678d3e5a7410bf", "message": "Enable rollback handler testcase", "committedDate": "2020-06-13T06:53:02Z", "type": "commit"}, {"oid": "ff419ab0e60ca9765b11f294ee568d290c0c7ea5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ff419ab0e60ca9765b11f294ee568d290c0c7ea5", "message": "Merge remote-tracking branch 'origin/transaction-changes' into transaction-changes", "committedDate": "2020-06-13T06:53:17Z", "type": "commit"}, {"oid": "71c3338328d2c8ca6326934e45c635b2e49a0890", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/71c3338328d2c8ca6326934e45c635b2e49a0890", "message": "Merge branch 'upstream-master' into transaction-changes", "committedDate": "2020-06-13T18:19:23Z", "type": "commit"}, {"oid": "6092486799afd31fbb51b7c61e8b105cf42bc779", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6092486799afd31fbb51b7c61e8b105cf42bc779", "message": "Merge branch 'upstream-master' into transaction-changes\n\n# Conflicts:\n#\tstdlib/database/jdbc/src/main/ballerina/src/java.jdbc/client.bal\n#\tstdlib/database/mysql/src/main/ballerina/src/mysql/client.bal\n#\tstdlib/database/sql/src/main/ballerina/src/sql/client.bal\n#\tstdlib/database/sql/src/main/java/org/ballerinalang/sql/utils/ExecuteUtils.java\n#\tstdlib/database/sql/src/test/resources/test-module/mock-sql/src/mockclient/client.bal", "committedDate": "2020-06-13T19:03:49Z", "type": "commit"}, {"oid": "6c634e509121b470c4dfb771cfc6cc15186e19c5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/6c634e509121b470c4dfb771cfc6cc15186e19c5", "message": "Merge branch 'upstream-master' into transaction-changes", "committedDate": "2020-06-14T04:12:32Z", "type": "commit"}, {"oid": "e60fa9a051340877bb35674f0bc20493930238f6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e60fa9a051340877bb35674f0bc20493930238f6", "message": "Change new transactions import", "committedDate": "2020-06-14T05:08:00Z", "type": "commit"}]}