{"pr_number": 26097, "pr_title": "Revamp add-documentation code-action to use new parser API", "pr_createdAt": "2020-09-25T08:56:06Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097", "timeline": [{"oid": "e74876b4fb55a31f1a711145390ad9200972771c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e74876b4fb55a31f1a711145390ad9200972771c", "message": "Revamp add-docs code-action to use new parser-api\n\nSigned-off-by: Rasika <info.rasika@gmail.com>", "committedDate": "2020-09-25T08:53:19Z", "type": "commit"}, {"oid": "e5839000fa4697db3ada8099f103b344d8fde0f1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e5839000fa4697db3ada8099f103b344d8fde0f1", "message": "Remove unused code lenses\n\nSigned-off-by: Rasika <info.rasika@gmail.com>", "committedDate": "2020-09-25T08:53:50Z", "type": "commit"}, {"oid": "fcbc28dc9da0847a2783a5cde11e30144e014235", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fcbc28dc9da0847a2783a5cde11e30144e014235", "message": "Revamp add-doc code lense\n\nSigned-off-by: Rasika <info.rasika@gmail.com>", "committedDate": "2020-09-25T08:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMDQ4OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495530488", "bodyText": "We will need to get rid of the code lenses caching within the Document Manager. Once the new Semantic API and Project API is integrated let's remove this part", "author": "nadeeshaan", "createdAt": "2020-09-27T05:20:19Z", "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/BallerinaTextDocumentService.java", "diffHunk": "@@ -495,9 +495,14 @@ void setClientCapabilities(LSClientCapabilities clientCapabilities) {\n \n             Path compilationPath = getUntitledFilePath(docSymbolFilePath.toString()).orElse(docSymbolFilePath.get());\n             Optional<Lock> lock = docManager.lockFile(compilationPath);\n+\n+            LSContext codeLensContext = new DocumentServiceOperationContext\n+                    .ServiceOperationContextBuilder(LSContextOperation.TXT_CODE_LENS)\n+                    .withCommonParams(null, fileUri, docManager)\n+                    .build();\n+\n             try {\n-                // Compile source document\n-                lenses = CodeLensUtil.compileAndGetCodeLenses(fileUri, docManager);\n+                lenses = CodeLensUtil.getCodeLenses(codeLensContext);\n                 docManager.setCodeLenses(compilationPath, lenses);", "originalCommit": "fcbc28dc9da0847a2783a5cde11e30144e014235", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2NDUyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495764520", "bodyText": "Yes agree, only added changes affected by add-doc code action changes.  Let's remove it coming up PRs.", "author": "rasika", "createdAt": "2020-09-28T08:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMDQ4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMTE2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495531167", "bodyText": "Since we still use the AST nodes to get the node type, let's skip using the BLangNode. Let's calculate the top level node type to be the Syntax node type directly.", "author": "nadeeshaan", "createdAt": "2020-09-27T05:30:00Z", "path": "language-server/modules/langserver-core/src/main/java/org/ballerinalang/langserver/codeaction/CodeActionUtil.java", "diffHunk": "@@ -134,6 +135,22 @@ public static CodeActionNodeType topLevelNodeInLine(LSContext context, TextDocum\n                         && cursorLine == diagnosticPos.sLine) {\n                     return CodeActionNodeType.RECORD;\n                 }\n+\n+                if (topLevelNode instanceof BLangClassDefinition) {", "originalCommit": "fcbc28dc9da0847a2783a5cde11e30144e014235", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2NDU3Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495764577", "bodyText": "Yes agree, only added changes affected by add-doc code action changes.  Let's remove it coming up PRs.", "author": "rasika", "createdAt": "2020-09-28T08:16:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMTE2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTc2NTk0NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26097#discussion_r495765945", "bodyText": "+1", "author": "nadeeshaan", "createdAt": "2020-09-28T08:19:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTUzMTE2Nw=="}], "type": "inlineReview"}]}