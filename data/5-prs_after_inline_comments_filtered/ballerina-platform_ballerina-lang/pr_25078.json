{"pr_number": 25078, "pr_title": "Improve 'transactional' functions parsing", "pr_createdAt": "2020-07-31T10:44:27Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078", "timeline": [{"oid": "d882f33ac45c2aa954271cb18772e3e67317e7c4", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d882f33ac45c2aa954271cb18772e3e67317e7c4", "message": "Add missing case to parseObjectMember method.", "committedDate": "2020-07-30T15:43:38Z", "type": "commit"}, {"oid": "520334fe1d06980a1a933d596d9e25a1e7947b84", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/520334fe1d06980a1a933d596d9e25a1e7947b84", "message": "Add all qualifiers to a list for func-def.", "committedDate": "2020-07-31T10:16:12Z", "type": "commit"}, {"oid": "fe32af56af66db6b967b7a2fa30b9ae5b439afe1", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/fe32af56af66db6b967b7a2fa30b9ae5b439afe1", "message": "Remove fall through.", "committedDate": "2020-07-31T10:31:38Z", "type": "commit"}, {"oid": "0869d6cad732a43b0e575c28afd4bf7ee3b720f0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/0869d6cad732a43b0e575c28afd4bf7ee3b720f0", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang", "committedDate": "2020-07-31T10:40:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzU1MjM1OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r463552359", "bodyText": "If the token is neither transactional or function, we'll have to add recovery here", "author": "SupunS", "createdAt": "2020-07-31T11:16:57Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -1460,28 +1461,21 @@ private STNode parseFuncDefinition(STNode metadata, boolean isObjectMethod, STNo\n      * </code>\n      *\n      * @param metadata Metadata\n-     * @param visibilityQualifier Visibility qualifier\n+     * @param qualifiers qualifier list\n      * @return Parsed node\n      */\n-    private STNode parseFuncDefOrFuncTypeDesc(STNode metadata, boolean isObjectMethod, STNode... qualifiers) {\n-        parseTransactionalQUalifier(qualifiers);\n+    private STNode parseFuncDefOrFuncTypeDesc(STNode metadata, boolean isObjectMethod, List<STNode> qualifiers) {\n+        if (peek().kind == SyntaxKind.TRANSACTIONAL_KEYWORD) {", "originalCommit": "0869d6cad732a43b0e575c28afd4bf7ee3b720f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzU5NzA1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r463597051", "bodyText": "Yes, will add", "author": "rdulmina", "createdAt": "2020-07-31T13:02:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzU1MjM1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDgwMDUyOA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r464800528", "bodyText": "Added.", "author": "rdulmina", "createdAt": "2020-08-04T05:01:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzU1MjM1OQ=="}], "type": "inlineReview"}, {"oid": "ca9b002d317dae50e5354f23674c477206e833ab", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ca9b002d317dae50e5354f23674c477206e833ab", "message": "Added recovery in parseFuncDefOrFuncTypeDesc method.\nAdded recovery in parseFuncDefOrFuncTypeDesc method with some test cases. Will add more tests.", "committedDate": "2020-08-04T04:57:48Z", "type": "commit"}, {"oid": "eb6644589726dcf9a0b6d2a3491072e50633eb1f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/eb6644589726dcf9a0b6d2a3491072e50633eb1f", "message": "Enable test.", "committedDate": "2020-08-04T04:58:30Z", "type": "commit"}, {"oid": "295b566ecb419577e1f97e8ba5e14a26c73ceba0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/295b566ecb419577e1f97e8ba5e14a26c73ceba0", "message": "Added more test cases for transactional functions.", "committedDate": "2020-08-04T12:05:29Z", "type": "commit"}, {"oid": "ec4a189fab7ab7fed6678b9b7924d1733938ec82", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ec4a189fab7ab7fed6678b9b7924d1733938ec82", "message": "Update assert files.", "committedDate": "2020-08-04T17:20:13Z", "type": "commit"}, {"oid": "8a62773b1aac7ae39090922ac552f5b43158b243", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/8a62773b1aac7ae39090922ac552f5b43158b243", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang", "committedDate": "2020-08-05T05:00:00Z", "type": "commit"}, {"oid": "48191cc4b5a546b72743eb9475ac0be1e78d618c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/48191cc4b5a546b72743eb9475ac0be1e78d618c", "message": "Fix IndexOutOfBoundsException in parseReturnTypeDescRhs method.", "committedDate": "2020-08-05T05:20:03Z", "type": "commit"}, {"oid": "d368db2541072397e73e8573eb9645c29c03d60d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/d368db2541072397e73e8573eb9645c29c03d60d", "message": "Fix null pointer exception.", "committedDate": "2020-08-05T09:44:04Z", "type": "commit"}, {"oid": "42c76136fc90a266885d89a35a60331bb73e9a8e", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/42c76136fc90a266885d89a35a60331bb73e9a8e", "message": "Single method to parse function qualifiers.", "committedDate": "2020-08-07T05:41:20Z", "type": "commit"}, {"oid": "bf771cdd1b9cf092af4a74ef5369985e144530dc", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bf771cdd1b9cf092af4a74ef5369985e144530dc", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang", "committedDate": "2020-08-07T05:56:48Z", "type": "commit"}, {"oid": "58eb6cbbf5d454e7227ded19906168f4ed9c098d", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/58eb6cbbf5d454e7227ded19906168f4ed9c098d", "message": "Update node transformer.", "committedDate": "2020-08-07T07:20:46Z", "type": "commit"}, {"oid": "3f376d38508cd7b21b42abb97e3fc96c964ae6dd", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/3f376d38508cd7b21b42abb97e3fc96c964ae6dd", "message": "Fix issue in constant annotation decl parsing.", "committedDate": "2020-08-07T12:12:36Z", "type": "commit"}, {"oid": "ee9c64f9f9c06964e8ee2f9cf0fcfc9b3ad0752c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/ee9c64f9f9c06964e8ee2f9cf0fcfc9b3ad0752c", "message": "Resolve conflicts.", "committedDate": "2020-08-07T12:39:22Z", "type": "commit"}, {"oid": "b5631b81e69824f093f92439235e1b6d9244cee5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b5631b81e69824f093f92439235e1b6d9244cee5", "message": "Add missing files.", "committedDate": "2020-08-07T13:14:47Z", "type": "commit"}, {"oid": "cf8b853aa4b279820621a868396da738a4bb5309", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cf8b853aa4b279820621a868396da738a4bb5309", "message": "Remove ObjectMethodDefinitionNode.", "committedDate": "2020-08-10T04:11:37Z", "type": "commit"}, {"oid": "aa22d6adb6b14d87e9a41b089e4fb94d0b72d07b", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/aa22d6adb6b14d87e9a41b089e4fb94d0b72d07b", "message": "Fix language-server failure.", "committedDate": "2020-08-10T04:31:29Z", "type": "commit"}, {"oid": "bcff57f0f4ca24023848b210da3fbe9dbd129869", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/bcff57f0f4ca24023848b210da3fbe9dbd129869", "message": "Add missing imports.", "committedDate": "2020-08-10T04:32:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5NDE1MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467694151", "bodyText": "these qualifiers are always optional right? Do we need to go to the recovery?", "author": "lochana-chathura", "createdAt": "2020-08-10T05:30:51Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -5636,6 +5662,97 @@ private STNode parseObjectMethodOrField(SyntaxKind nextTokenKind, SyntaxKind nex\n         return parseObjectMethodOrField(solution.tokenKind, nextTokenKind, metadata, visibilityQualifier);\n     }\n \n+    /**\n+     * Parse function qualifiers.\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseFunctionQualifiers(ParserRuleContext context, List<STNode> qualifierList) {\n+        STToken nextToken = peek();\n+        return parseFunctionQualifiers(nextToken.kind, context, qualifierList);\n+    }\n+\n+    private STNode parseFunctionQualifiers(SyntaxKind tokenKind, ParserRuleContext context,\n+                                               List<STNode> qualifierList) {\n+        while (!isEndOfFunctionQualifiers(tokenKind)) {\n+            STNode qualifier;\n+            switch (tokenKind) {\n+                case REMOTE_KEYWORD:\n+                    qualifier = parseRemoteKeyword();\n+                    break;\n+                case TRANSACTIONAL_KEYWORD:\n+                    qualifier = parseTransactionalKeyword();\n+                    break;\n+                case RESOURCE_KEYWORD:\n+                    qualifier = parseResourceKeyword();\n+                    break;\n+                default:\n+                    Solution solution = recover(peek(), context, context, qualifierList);", "originalCommit": "bcff57f0f4ca24023848b210da3fbe9dbd129869", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5ODg0Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467698847", "bodyText": "Yes there can be invalid tokens before qualifier or missing function keyword. Those things will recover here.", "author": "rdulmina", "createdAt": "2020-08-10T05:52:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5NDE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwOTAyNQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467709025", "bodyText": "I see. btw In case there's a missing function key we only skip the while loop. And do the qualifier validation again.\nThis will be a problem, specially when there's an error in the qualifier.\ne.g  For transactional  transactional <missing function>, updateLastNodeInListWithInvalidNode will call twice for same error ryt?\nI think we can simply return if the solution.kind is function keyword. WDYT?", "author": "lochana-chathura", "createdAt": "2020-08-10T06:31:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5NDE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcxNjIyMA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467716220", "bodyText": "Validation is inside the while loop, so we do simply return if the function keyword recovered.", "author": "rdulmina", "createdAt": "2020-08-10T06:54:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5NDE1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5NTIyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467695224", "bodyText": "what if the function keyword missing? we'll end up in an infinite loop right as function keyword is not handled inside parseFunctionQualifiers?\nI think we may check for REMOTE, TRANSACTIONAL, RESOURCE keywords and else return true. WDYT?", "author": "lochana-chathura", "createdAt": "2020-08-10T05:35:31Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -5636,6 +5662,97 @@ private STNode parseObjectMethodOrField(SyntaxKind nextTokenKind, SyntaxKind nex\n         return parseObjectMethodOrField(solution.tokenKind, nextTokenKind, metadata, visibilityQualifier);\n     }\n \n+    /**\n+     * Parse function qualifiers.\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseFunctionQualifiers(ParserRuleContext context, List<STNode> qualifierList) {\n+        STToken nextToken = peek();\n+        return parseFunctionQualifiers(nextToken.kind, context, qualifierList);\n+    }\n+\n+    private STNode parseFunctionQualifiers(SyntaxKind tokenKind, ParserRuleContext context,\n+                                               List<STNode> qualifierList) {\n+        while (!isEndOfFunctionQualifiers(tokenKind)) {\n+            STNode qualifier;\n+            switch (tokenKind) {\n+                case REMOTE_KEYWORD:\n+                    qualifier = parseRemoteKeyword();\n+                    break;\n+                case TRANSACTIONAL_KEYWORD:\n+                    qualifier = parseTransactionalKeyword();\n+                    break;\n+                case RESOURCE_KEYWORD:\n+                    qualifier = parseResourceKeyword();\n+                    break;\n+                default:\n+                    Solution solution = recover(peek(), context, context, qualifierList);\n+\n+                    // If the parser recovered by inserting a token, then try to re-parse the same\n+                    // rule with the inserted token. This is done to pick the correct branch\n+                    // to continue the parsing.\n+                    if (solution.action == Action.REMOVE) {\n+                        return solution.recoveredNode;\n+                    }\n+\n+                    return parseFunctionQualifiers(solution.tokenKind, context, qualifierList);\n+            }\n+\n+            DiagnosticCode diagnosticCode = validateFunctionQualifier(qualifier, context, qualifierList);\n+            if (diagnosticCode != null) {\n+                // If the qualifier list is empty add invalid node as minutiae to the next token.\n+                if (qualifierList.size() == 0) {\n+                    addInvalidNodeToNextToken(qualifier, diagnosticCode, qualifier.toString().trim());\n+                } else {\n+                    //If the qualifier list is not empty add invalid node to the last node in the list.\n+                    updateLastNodeInListWithInvalidNode(qualifierList, qualifier, diagnosticCode);\n+                }\n+            } else {\n+                qualifierList.add(qualifier);\n+            }\n+            tokenKind = peek().kind;\n+        }\n+        return STNodeFactory.createNodeList(qualifierList);\n+    }\n+\n+    private boolean isEndOfFunctionQualifiers(SyntaxKind tokenKind) {\n+        switch (tokenKind) {\n+            case FUNCTION_KEYWORD:\n+            case EOF_TOKEN:\n+                return true;\n+            default:\n+                return false;\n+        }", "originalCommit": "bcff57f0f4ca24023848b210da3fbe9dbd129869", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5OTI0OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467699249", "bodyText": "Missing function keyword will recover inside the recovery of parseFunctionQualifiers() method.", "author": "rdulmina", "createdAt": "2020-08-10T05:54:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5NTIyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5Njk2Nw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467696967", "bodyText": "Shall we also modify return parseObjectMember(solution.tokenKind); beneath. Otherwise we'll be re-parsing with the wrong method I think.", "author": "lochana-chathura", "createdAt": "2020-08-10T05:44:10Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -5550,19 +5573,19 @@ private STNode parseObjectMember(SyntaxKind nextTokenKind, STNode metadata) {\n                 member = parseObjectMethodOrField(metadata, visibilityQualifier);\n                 break;\n             case REMOTE_KEYWORD:\n-                member = parseObjectMethodOrField(metadata, STNodeFactory.createEmptyNode());\n-                break;\n             case FUNCTION_KEYWORD:\n             case TRANSACTIONAL_KEYWORD:\n-                member = parseObjectMethod(metadata, STNodeFactory.createEmptyNode(), STNodeFactory.createEmptyNode());\n+            case RESOURCE_KEYWORD: // resource qualifier is not allowed but let it pass here and validate in\n+                // parseFunctionQualifiers method\n+                member = parseObjectMethod(metadata, new ArrayList<>());\n                 break;\n             default:\n                 if (isTypeStartingToken(nextTokenKind)) {\n                     member = parseObjectField(metadata, STNodeFactory.createEmptyNode());\n                     break;\n                 }\n \n-                Solution solution = recover(peek(), ParserRuleContext.OBJECT_MEMBER_WITHOUT_METADATA);\n+                Solution solution = recover(peek(), ParserRuleContext.OBJECT_MEMBER_WITHOUT_METADATA, metadata);", "originalCommit": "bcff57f0f4ca24023848b210da3fbe9dbd129869", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwMDg4NQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467700885", "bodyText": "U mean to rename the functions?", "author": "rdulmina", "createdAt": "2020-08-10T06:01:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5Njk2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwMTk2OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467701968", "bodyText": "renamed the functions", "author": "rdulmina", "createdAt": "2020-08-10T06:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5Njk2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcwOTc1OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467709759", "bodyText": "not exactly the renaming of method. Earlier we had called the wrong overloaded method (with missing metadata arg) :)", "author": "lochana-chathura", "createdAt": "2020-08-10T06:33:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5Njk2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzcxNjU0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467716541", "bodyText": "Yes, thanx for mentioning I have changed that.", "author": "rdulmina", "createdAt": "2020-08-10T06:54:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzY5Njk2Nw=="}], "type": "inlineReview"}, {"oid": "1536b419dac0ba632398a51d5cb209ee5eb47367", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/1536b419dac0ba632398a51d5cb209ee5eb47367", "message": "Undo unwanted file changes.", "committedDate": "2020-08-10T06:04:34Z", "type": "commit"}, {"oid": "83d57e1662a02b209d65000ee00d4843a31c6c88", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/83d57e1662a02b209d65000ee00d4843a31c6c88", "message": "Update assert files.", "committedDate": "2020-08-10T06:39:38Z", "type": "commit"}, {"oid": "99ff7c5dd1c976ded47baf6e68a67c978b5e5ac5", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/99ff7c5dd1c976ded47baf6e68a67c978b5e5ac5", "message": "Delete unwanted file added to the previous commits.", "committedDate": "2020-08-10T09:41:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgzMjE0OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467832148", "bodyText": "Can returning immediately be a problem?\neg:\ntransactional xyz resource function foo() {\n}\nHere xyz is an invalid token. After recovering from it, shouldn't the loop continue?", "author": "SupunS", "createdAt": "2020-08-10T11:08:09Z", "path": "compiler/ballerina-parser/src/main/java/io/ballerinalang/compiler/internal/parser/BallerinaParser.java", "diffHunk": "@@ -5636,6 +5662,97 @@ private STNode parseObjectMethodOrField(SyntaxKind nextTokenKind, SyntaxKind nex\n         return parseObjectMethodOrField(solution.tokenKind, nextTokenKind, metadata, visibilityQualifier);\n     }\n \n+    /**\n+     * Parse function qualifiers.\n+     *\n+     * @return Parsed node\n+     */\n+    private STNode parseFunctionQualifiers(ParserRuleContext context, List<STNode> qualifierList) {\n+        STToken nextToken = peek();\n+        return parseFunctionQualifiers(nextToken.kind, context, qualifierList);\n+    }\n+\n+    private STNode parseFunctionQualifiers(SyntaxKind tokenKind, ParserRuleContext context,\n+                                               List<STNode> qualifierList) {\n+        while (!isEndOfFunctionQualifiers(tokenKind)) {\n+            STNode qualifier;\n+            switch (tokenKind) {\n+                case REMOTE_KEYWORD:\n+                    qualifier = parseRemoteKeyword();\n+                    break;\n+                case TRANSACTIONAL_KEYWORD:\n+                    qualifier = parseTransactionalKeyword();\n+                    break;\n+                case RESOURCE_KEYWORD:\n+                    qualifier = parseResourceKeyword();\n+                    break;\n+                default:\n+                    Solution solution = recover(peek(), context, context, qualifierList);\n+\n+                    // If the parser recovered by inserting a token, then try to re-parse the same\n+                    // rule with the inserted token. This is done to pick the correct branch\n+                    // to continue the parsing.\n+                    if (solution.action == Action.REMOVE) {\n+                        return solution.recoveredNode;", "originalCommit": "99ff7c5dd1c976ded47baf6e68a67c978b5e5ac5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzg1OTE5Mw==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467859193", "bodyText": "No, In the case of invalid token after recovery it goes to resume parsing. Then it parses the rest of the qualifiers and return here so we return immediately right?", "author": "rdulmina", "createdAt": "2020-08-10T12:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgzMjE0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzkwNDkzOQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467904939", "bodyText": "ah ok. Have any tests covering that?", "author": "SupunS", "createdAt": "2020-08-10T13:31:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgzMjE0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzk1MDQyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/25078#discussion_r467950424", "bodyText": "Yes already added recovery test cases for fuction-def, object-method and service resource method. Those tests contains your example as well.", "author": "rdulmina", "createdAt": "2020-08-10T14:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzgzMjE0OA=="}], "type": "inlineReview"}, {"oid": "54dc59f91ca4264395b8b4cfa2468254dbc6d1d2", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/54dc59f91ca4264395b8b4cfa2468254dbc6d1d2", "message": "Merge branch 'master' of https://github.com/ballerina-platform/ballerina-lang", "committedDate": "2020-08-11T03:33:48Z", "type": "commit"}, {"oid": "145830fd54f3daa54c63bb695fb8036dfd74f86f", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/145830fd54f3daa54c63bb695fb8036dfd74f86f", "message": "Update assert files.", "committedDate": "2020-08-11T03:46:02Z", "type": "commit"}, {"oid": "b7582397b8f33e7e1c9f4b2c1b790b8293eb25ff", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b7582397b8f33e7e1c9f4b2c1b790b8293eb25ff", "message": "Add missing files.", "committedDate": "2020-08-11T04:11:56Z", "type": "commit"}]}