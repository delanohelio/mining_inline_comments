{"pr_number": 26035, "pr_title": "Fix issues with final fields", "pr_createdAt": "2020-09-23T10:20:29Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035", "timeline": [{"oid": "88f0e8c435207c8e098efc44abeb401960d35d55", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/88f0e8c435207c8e098efc44abeb401960d35d55", "message": "Fix issues with final fields", "committedDate": "2020-09-23T09:52:03Z", "type": "commit"}, {"oid": "203fa31e83c532d71abd40a793effd2e7837b3f6", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/203fa31e83c532d71abd40a793effd2e7837b3f6", "message": "Add object constructor tests for final fields", "committedDate": "2020-09-23T10:19:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyNzkwMg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035#discussion_r493427902", "bodyText": "\u26cf\ufe0f Extract this out of for loop? Symbols.isFlagOn(structureType.flags, Flags.READONLY)", "author": "KRVPerera", "createdAt": "2020-09-23T10:33:19Z", "path": "compiler/ballerina-lang/src/main/java/org/wso2/ballerinalang/compiler/semantics/analyzer/SymbolEnter.java", "diffHunk": "@@ -2228,24 +2228,32 @@ private void validateFieldsAndSetReadOnlyType(List<BLangNode> typeDefNodes, Symb\n                 continue;\n             }\n \n-            boolean allReadOnlyOrFinalFields = true;\n+            boolean allImmutableFields = true;\n \n             Collection<BField> fields = structureType.fields.values();\n \n             if (fields.isEmpty()) {\n                 continue;\n             }\n \n-            int flagToCheck = nodeKind == NodeKind.RECORD_TYPE ? Flags.READONLY : Flags.FINAL;\n-\n-            for (BField field : fields) {\n-                if (!Symbols.isFlagOn(field.symbol.flags, flagToCheck)) {\n-                    allReadOnlyOrFinalFields = false;\n-                    break;\n+            if (nodeKind == NodeKind.RECORD_TYPE) {\n+                for (BField field : fields) {\n+                    if (!Symbols.isFlagOn(field.symbol.flags, Flags.READONLY)) {\n+                        allImmutableFields = false;\n+                        break;\n+                    }\n+                }\n+            } else {\n+                for (BField field : fields) {\n+                    if (!Symbols.isFlagOn(field.symbol.flags, Flags.FINAL) ||\n+                            !Symbols.isFlagOn(structureType.flags, Flags.READONLY)) {", "originalCommit": "203fa31e83c532d71abd40a793effd2e7837b3f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ3ODA0MA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/26035#discussion_r493478040", "bodyText": "We don't actually need this check here now since object type descriptor fields cannot be marked as final. Removed in e2badab.", "author": "MaryamZi", "createdAt": "2020-09-23T11:30:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyNzkwMg=="}], "type": "inlineReview"}, {"oid": "e2badab321139d68fd2d456efb44220d9d1d177c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e2badab321139d68fd2d456efb44220d9d1d177c", "message": "Remove obsolete code", "committedDate": "2020-09-23T11:25:25Z", "type": "commit"}, {"oid": "e38d4c63d377a2492889dbd6982060234d4b28bf", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/e38d4c63d377a2492889dbd6982060234d4b28bf", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into readonly-to-final-field", "committedDate": "2020-10-07T04:20:10Z", "type": "commit"}, {"oid": "abd066b411de0ad83e805f5e1ccaf5b2c6d6a13c", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/abd066b411de0ad83e805f5e1ccaf5b2c6d6a13c", "message": "Merge branch 'master' of https://github.com/ballerina-lang/ballerina into readonly-to-final-field", "committedDate": "2020-10-20T15:28:29Z", "type": "commit"}]}