{"pr_number": 22621, "pr_title": "Update xml langlib methods", "pr_createdAt": "2020-04-15T06:41:50Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2NTkyNA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621#discussion_r408765924", "bodyText": "Need to add name parameter here.", "author": "rdhananjaya", "createdAt": "2020-04-15T11:17:57Z", "path": "langlib/lang.xml/src/main/java/org/ballerinalang/langlib/xml/ElementChildren.java", "diffHunk": "@@ -15,49 +15,50 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.ballerinalang.langlib.internal;\n+package org.ballerinalang.langlib.xml;\n \n import org.ballerinalang.jvm.XMLNodeType;\n import org.ballerinalang.jvm.scheduling.Strand;\n import org.ballerinalang.jvm.values.XMLItem;\n import org.ballerinalang.jvm.values.XMLSequence;\n import org.ballerinalang.jvm.values.XMLValue;\n-import org.ballerinalang.jvm.values.api.BXML;\n import org.ballerinalang.model.types.TypeKind;\n import org.ballerinalang.natives.annotations.Argument;\n import org.ballerinalang.natives.annotations.BallerinaFunction;\n import org.ballerinalang.natives.annotations.ReturnType;\n \n-import java.util.ArrayList;\n-\n /**\n  * Return lift getChildren over sequences.\n  *\n  * @since 1.2\n  */\n @BallerinaFunction(\n-        orgName = \"ballerina\", packageName = \"lang.__internal\",\n-        functionName = \"children\",\n+        orgName = \"ballerina\", packageName = \"lang.xml\",\n+        functionName = \"elementChildren\",\n         args = {@Argument(name = \"xmlValue\", type = TypeKind.XML)},", "originalCommit": "60cbb21fcf4ed79df63c242a2d4fe15d9dba6d19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyOTMwMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621#discussion_r409429301", "bodyText": "Added", "author": "irshadnilam", "createdAt": "2020-04-16T09:52:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2NTkyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2NjU0MQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621#discussion_r408766541", "bodyText": "I think we can simply do a name == null check here. Instead of instanceof", "author": "rdhananjaya", "createdAt": "2020-04-15T11:19:02Z", "path": "langlib/lang.xml/src/main/java/org/ballerinalang/langlib/xml/ElementChildren.java", "diffHunk": "@@ -15,49 +15,50 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.ballerinalang.langlib.internal;\n+package org.ballerinalang.langlib.xml;\n \n import org.ballerinalang.jvm.XMLNodeType;\n import org.ballerinalang.jvm.scheduling.Strand;\n import org.ballerinalang.jvm.values.XMLItem;\n import org.ballerinalang.jvm.values.XMLSequence;\n import org.ballerinalang.jvm.values.XMLValue;\n-import org.ballerinalang.jvm.values.api.BXML;\n import org.ballerinalang.model.types.TypeKind;\n import org.ballerinalang.natives.annotations.Argument;\n import org.ballerinalang.natives.annotations.BallerinaFunction;\n import org.ballerinalang.natives.annotations.ReturnType;\n \n-import java.util.ArrayList;\n-\n /**\n  * Return lift getChildren over sequences.\n  *\n  * @since 1.2\n  */\n @BallerinaFunction(\n-        orgName = \"ballerina\", packageName = \"lang.__internal\",\n-        functionName = \"children\",\n+        orgName = \"ballerina\", packageName = \"lang.xml\",\n+        functionName = \"elementChildren\",\n         args = {@Argument(name = \"xmlValue\", type = TypeKind.XML)},\n         returnType = {@ReturnType(type = TypeKind.XML)},\n         isPublic = true\n )\n-public class Children {\n+public class ElementChildren {\n \n-    public static XMLValue children(Strand strand, XMLValue xmlVal) {\n+    public static XMLValue elementChildren(Strand strand, XMLValue xmlVal, Object name) {", "originalCommit": "60cbb21fcf4ed79df63c242a2d4fe15d9dba6d19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQyOTQzMQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621#discussion_r409429431", "bodyText": "+1", "author": "irshadnilam", "createdAt": "2020-04-16T09:52:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc2NjU0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODc3NTMxNg==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621#discussion_r408775316", "bodyText": "We need to lift children of children in a sequence\nRefer the comment in langlib signature # This is equivalent to children(x).elements(nm).", "author": "rdhananjaya", "createdAt": "2020-04-15T11:36:34Z", "path": "langlib/lang.xml/src/main/java/org/ballerinalang/langlib/xml/ElementChildren.java", "diffHunk": "@@ -15,49 +15,50 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.ballerinalang.langlib.internal;\n+package org.ballerinalang.langlib.xml;\n \n import org.ballerinalang.jvm.XMLNodeType;\n import org.ballerinalang.jvm.scheduling.Strand;\n import org.ballerinalang.jvm.values.XMLItem;\n import org.ballerinalang.jvm.values.XMLSequence;\n import org.ballerinalang.jvm.values.XMLValue;\n-import org.ballerinalang.jvm.values.api.BXML;\n import org.ballerinalang.model.types.TypeKind;\n import org.ballerinalang.natives.annotations.Argument;\n import org.ballerinalang.natives.annotations.BallerinaFunction;\n import org.ballerinalang.natives.annotations.ReturnType;\n \n-import java.util.ArrayList;\n-\n /**\n  * Return lift getChildren over sequences.\n  *\n  * @since 1.2\n  */\n @BallerinaFunction(\n-        orgName = \"ballerina\", packageName = \"lang.__internal\",\n-        functionName = \"children\",\n+        orgName = \"ballerina\", packageName = \"lang.xml\",\n+        functionName = \"elementChildren\",\n         args = {@Argument(name = \"xmlValue\", type = TypeKind.XML)},\n         returnType = {@ReturnType(type = TypeKind.XML)},\n         isPublic = true\n )\n-public class Children {\n+public class ElementChildren {\n \n-    public static XMLValue children(Strand strand, XMLValue xmlVal) {\n+    public static XMLValue elementChildren(Strand strand, XMLValue xmlVal, Object name) {\n+        boolean namedQuery = name instanceof String;\n         if (xmlVal.getNodeType() == XMLNodeType.ELEMENT) {\n-            return ((XMLItem) xmlVal).children();\n+            if (namedQuery) {\n+                return (XMLValue) ((XMLItem) xmlVal).children().elements((String) name);\n+            }\n+            return (XMLValue) ((XMLItem) xmlVal).children().elements();\n         } else if (xmlVal.getNodeType() == XMLNodeType.SEQUENCE) {\n-            ArrayList<BXML> liftedChildren = new ArrayList<>();\n-            XMLSequence sequence = (XMLSequence) xmlVal.elements();\n-            for (BXML bxml : sequence.getChildrenList()) {\n-                liftedChildren.addAll(((XMLItem) bxml).getChildrenSeq().getChildrenList());\n+            if (namedQuery) {\n+                 return  ((XMLSequence) xmlVal).elements((String) name);", "originalCommit": "60cbb21fcf4ed79df63c242a2d4fe15d9dba6d19", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTk3NTc5OA==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/22621#discussion_r409975798", "bodyText": "Shall we use the same param names as in .bal file\nAnd also type of parameter name is not String it's a union of string and nil", "author": "rdhananjaya", "createdAt": "2020-04-17T03:45:17Z", "path": "langlib/lang.xml/src/main/java/org/ballerinalang/langlib/xml/ElementChildren.java", "diffHunk": "@@ -29,35 +29,54 @@\n import org.ballerinalang.natives.annotations.ReturnType;\n \n import java.util.ArrayList;\n+import java.util.List;\n \n /**\n  * Return lift getChildren over sequences.\n  *\n  * @since 1.2\n  */\n @BallerinaFunction(\n-        orgName = \"ballerina\", packageName = \"lang.__internal\",\n-        functionName = \"children\",\n-        args = {@Argument(name = \"xmlValue\", type = TypeKind.XML)},\n+        orgName = \"ballerina\", packageName = \"lang.xml\",\n+        functionName = \"elementChildren\",\n+        args = {@Argument(name = \"xmlValue\", type = TypeKind.XML), @Argument(name = \"name\", type = TypeKind.STRING)},", "originalCommit": "00586a32e7224333d16d4402b9ef6beef22db381", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "73dfe0226dc54c900bbcec2efa50e6252c12b0f8", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/73dfe0226dc54c900bbcec2efa50e6252c12b0f8", "message": "Update xml langlib", "committedDate": "2020-04-17T03:51:03Z", "type": "commit"}, {"oid": "b11efbfc5a16c327b1e4a7cc96c276d3141f910a", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/b11efbfc5a16c327b1e4a7cc96c276d3141f910a", "message": "Add tests with namespaces", "committedDate": "2020-04-19T09:16:35Z", "type": "commit"}]}