{"pr_number": 21154, "pr_title": "Fix dynamic service registration issue in gRPC", "pr_createdAt": "2020-02-19T10:04:00Z", "pr_url": "https://github.com/ballerina-platform/ballerina-lang/pull/21154", "timeline": [{"oid": "cd2fb9ba214ede1d4cd48a4834f838b617553704", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/cd2fb9ba214ede1d4cd48a4834f838b617553704", "message": "Fix dynamic service registration issue in gRPC", "committedDate": "2020-02-19T09:59:51Z", "type": "commit"}, {"oid": "48a87528f2b3053fa9a3c116329fb1aa8dd64466", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/48a87528f2b3053fa9a3c116329fb1aa8dd64466", "message": "Change port in testcase", "committedDate": "2020-02-20T02:51:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzA2OTM0OQ==", "url": "https://github.com/ballerina-platform/ballerina-lang/pull/21154#discussion_r383069349", "bodyText": "If we return the providedName from L87, we would not need this null check. WDYT?\nIf so, serviceName variable can be also removed", "author": "chamil321", "createdAt": "2020-02-24T02:45:51Z", "path": "stdlib/grpc/src/main/java/org/ballerinalang/net/grpc/ServicesBuilderUtils.java", "diffHunk": "@@ -69,16 +69,32 @@ public static ServerServiceDefinition getServiceDefinition(BRuntime runtime, Obj\n         if (fileDescriptor == null) {\n             throw new GrpcServerException(\"Couldn't find the service descriptor.\");\n         }\n-        String serviceTypeName = service.getType().getName(); // typeName format: <name>$$<type>$$<version>\n-        String[] splitValues = serviceTypeName.split(\"\\\\$\\\\$\");\n-        String serviceName = splitValues[0];\n+        String serviceName = getServiceName(service);\n         Descriptors.ServiceDescriptor serviceDescriptor = fileDescriptor.findServiceByName(serviceName);\n         if (serviceDescriptor == null) {\n             throw new GrpcServerException(\"Couldn't find the service descriptor for the service: \" + serviceName);\n         }\n         return getServiceDefinition(runtime, service, serviceDescriptor);\n     }\n-    \n+\n+    private static String getServiceName(ObjectValue service) {\n+        String serviceName = null;\n+        Object serviceConfigData = service.getType().getAnnotation(\"ballerina/grpc:ServiceConfig\");\n+        if (serviceConfigData != null) {\n+            MapValue<String, Object> configMap = (MapValue) serviceConfigData;\n+            String providedName = configMap.getStringValue(\"name\");\n+            if (providedName != null && !providedName.isEmpty()) {\n+                serviceName = providedName;\n+            }\n+        }\n+        if (serviceName == null) {", "originalCommit": "48a87528f2b3053fa9a3c116329fb1aa8dd64466", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7008bb513e4903e8af293317461ccb4213f80bd0", "url": "https://github.com/ballerina-platform/ballerina-lang/commit/7008bb513e4903e8af293317461ccb4213f80bd0", "message": "Fix review suggestions", "committedDate": "2020-02-25T02:42:31Z", "type": "commit"}]}