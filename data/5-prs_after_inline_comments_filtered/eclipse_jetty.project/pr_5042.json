{"pr_number": 5042, "pr_title": "Issue #5019 - hot-reload SSL certificates if keystore file changed", "pr_createdAt": "2020-07-13T04:28:56Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5042", "timeline": [{"oid": "24d0e50a0c9a3e35df2b22b43f4d0420872fae06", "url": "https://github.com/eclipse/jetty.project/commit/24d0e50a0c9a3e35df2b22b43f4d0420872fae06", "message": "Issue #5019 - add class to do SSL keystore hot-reload in new module\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-10T08:44:08Z", "type": "commit"}, {"oid": "13e034fc5f904f5a79aef21bbdf01016aac3293b", "url": "https://github.com/eclipse/jetty.project/commit/13e034fc5f904f5a79aef21bbdf01016aac3293b", "message": "Issue #5019 - add testing for the SslKeyStoreScanner\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-10T08:44:24Z", "type": "commit"}, {"oid": "f34873419ec14e43e58949c8c7052ae6d47b3dcd", "url": "https://github.com/eclipse/jetty.project/commit/f34873419ec14e43e58949c8c7052ae6d47b3dcd", "message": "Issue #5019 - add jetty module files and xml to use ssl-reload with start.jar\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-10T08:44:35Z", "type": "commit"}, {"oid": "80f09e1f712641d8457bcf693930fe1dbfe571d1", "url": "https://github.com/eclipse/jetty.project/commit/80f09e1f712641d8457bcf693930fe1dbfe571d1", "message": "fix issues with the ssl-reload module\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-10T08:44:44Z", "type": "commit"}, {"oid": "dc91f690be247863aab17536779497d0420f0699", "url": "https://github.com/eclipse/jetty.project/commit/dc91f690be247863aab17536779497d0420f0699", "message": "use WorkDirExtension in KeystoreReloadTest to fix failing tests on jenkins\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-13T01:33:51Z", "type": "commit"}, {"oid": "0705d8ea77390cb9ab8dae4e728a6a3802c4bfe4", "url": "https://github.com/eclipse/jetty.project/commit/0705d8ea77390cb9ab8dae4e728a6a3802c4bfe4", "message": "generalize the exception type tested in KeystoreReloadTest\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-13T03:35:47Z", "type": "commit"}, {"oid": "62ee077b7967a1f6ecc9c5d66827c463eea16e3f", "url": "https://github.com/eclipse/jetty.project/commit/62ee077b7967a1f6ecc9c5d66827c463eea16e3f", "message": "move code of ssl-reload module to jetty-util, move module files to jetty-server\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-13T13:11:09Z", "type": "commit"}, {"oid": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "url": "https://github.com/eclipse/jetty.project/commit/b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "message": "add tests in KeystoreScannerTest for changes with symlinks\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-13T14:22:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTcyNA==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791724", "bodyText": "Feel free to remove this, you have a testcase for it.\nThis works as-is, and makes sense.", "author": "joakime", "createdAt": "2020-07-13T16:54:40Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?\n+        if (!keystoreFile.exists())\n+            throw new IllegalArgumentException(\"keystore file does not exist\");\n+        if (keystoreFile.isDirectory())\n+            throw new IllegalArgumentException(\"expected keystore file not directory\");\n+\n+        File parentFile = keystoreFile.getParentFile();\n+        if (!parentFile.exists() || !parentFile.isDirectory())\n+            throw new IllegalArgumentException(\"error obtaining keystore dir\");\n+\n+        files.add(parentFile);\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"created {}\", this);\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(this.getClass().getSimpleName() + \".doStart()\");\n+\n+        _scanner = new Scanner();\n+        _scanner.setScanDirs(files);\n+        _scanner.setScanInterval(_scanInterval);\n+        _scanner.setReportDirs(false);\n+        _scanner.setReportExistingFilesOnStartup(false);\n+        _scanner.setScanDepth(1);\n+        _scanner.addListener(this);\n+        _scanner.start();\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception\n+    {\n+        if (_scanner != null)\n+        {\n+            _scanner.stop();\n+            _scanner.removeListener(this);\n+            _scanner = null;\n+        }\n+    }\n+\n+    @Override\n+    public void fileAdded(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"added {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileChanged(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"changed {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileRemoved(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"removed {}\", filename);\n+\n+        // TODO: do we want to do this?", "originalCommit": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTg4Nw==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791887", "bodyText": "Perhaps call it KeyStoreScanner ?", "author": "joakime", "createdAt": "2020-07-13T16:54:58Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener", "originalCommit": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTUwNA==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453795504", "bodyText": "Perhaps try ... sslContextFactory.getKeyStoreResource().getFile()?", "author": "joakime", "createdAt": "2020-07-13T17:00:51Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?", "originalCommit": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NjU5NQ==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453796595", "bodyText": "How do you handle it when there is no KeyStore Resource/Path/File?\nSuch as when the user uses SslContextFactory.setKeyStore(KeyStore) or SslContextFactory.setKeyStoreResource(Resource) on a resource that is not backed by a File?", "author": "joakime", "createdAt": "2020-07-13T17:02:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDEyMzM1MA==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454123350", "bodyText": "If there is no keystore file we will hit one of these IllegalArgumentExceptions and have an error during startup. I think this is fine as its bad configuration to have this when the keystore is not backed by a file.", "author": "lachlan-roberts", "createdAt": "2020-07-14T06:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5MTk3MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453791971", "bodyText": "Drop Ssl from the class name and extend ContainerLifeCycle so we can add the Scanner as a bean.", "author": "sbordet", "createdAt": "2020-07-13T16:55:04Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener", "originalCommit": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTY2NQ==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453795665", "bodyText": "Make _scanner final and add it as a bean in the constructor.\nHere just configure it and call super to start it.", "author": "sbordet", "createdAt": "2020-07-13T17:01:06Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?\n+        if (!keystoreFile.exists())\n+            throw new IllegalArgumentException(\"keystore file does not exist\");\n+        if (keystoreFile.isDirectory())\n+            throw new IllegalArgumentException(\"expected keystore file not directory\");\n+\n+        File parentFile = keystoreFile.getParentFile();\n+        if (!parentFile.exists() || !parentFile.isDirectory())\n+            throw new IllegalArgumentException(\"error obtaining keystore dir\");\n+\n+        files.add(parentFile);\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"created {}\", this);\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(this.getClass().getSimpleName() + \".doStart()\");\n+\n+        _scanner = new Scanner();", "originalCommit": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc5NTg5Nw==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r453795897", "bodyText": "Remove comment as you have a test case for this behavior and seems to work fine.", "author": "sbordet", "createdAt": "2020-07-13T17:01:30Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslKeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,145 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.net.URI;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.AbstractLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class SslKeyStoreScanner extends AbstractLifeCycle implements Scanner.DiscreteListener\n+{\n+    private static final Logger LOG = Log.getLogger(SslKeyStoreScanner.class);\n+\n+    private final SslContextFactory sslContextFactory;\n+    private final File keystoreFile;\n+    private final List<File> files = new ArrayList<>();\n+    private Scanner _scanner;\n+    private int _scanInterval = 1;\n+\n+    public SslKeyStoreScanner(SslContextFactory sslContextFactory)\n+    {\n+        this.sslContextFactory = sslContextFactory;\n+        this.keystoreFile = new File(URI.create(sslContextFactory.getKeyStorePath())); // getKeyStorePath is giving url instead of path?\n+        if (!keystoreFile.exists())\n+            throw new IllegalArgumentException(\"keystore file does not exist\");\n+        if (keystoreFile.isDirectory())\n+            throw new IllegalArgumentException(\"expected keystore file not directory\");\n+\n+        File parentFile = keystoreFile.getParentFile();\n+        if (!parentFile.exists() || !parentFile.isDirectory())\n+            throw new IllegalArgumentException(\"error obtaining keystore dir\");\n+\n+        files.add(parentFile);\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"created {}\", this);\n+    }\n+\n+    @Override\n+    protected void doStart() throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(this.getClass().getSimpleName() + \".doStart()\");\n+\n+        _scanner = new Scanner();\n+        _scanner.setScanDirs(files);\n+        _scanner.setScanInterval(_scanInterval);\n+        _scanner.setReportDirs(false);\n+        _scanner.setReportExistingFilesOnStartup(false);\n+        _scanner.setScanDepth(1);\n+        _scanner.addListener(this);\n+        _scanner.start();\n+    }\n+\n+    @Override\n+    protected void doStop() throws Exception\n+    {\n+        if (_scanner != null)\n+        {\n+            _scanner.stop();\n+            _scanner.removeListener(this);\n+            _scanner = null;\n+        }\n+    }\n+\n+    @Override\n+    public void fileAdded(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"added {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileChanged(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"changed {}\", filename);\n+\n+        if (keystoreFile.toPath().toString().equals(filename))\n+            reload();\n+    }\n+\n+    @Override\n+    public void fileRemoved(String filename) throws Exception\n+    {\n+        if (LOG.isDebugEnabled())\n+            LOG.debug(\"removed {}\", filename);\n+\n+        // TODO: do we want to do this?", "originalCommit": "b03643961d9d7be6ed566c42aadb9bd6428a3cfa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a83844df32f08a18ba2e78a76f98205a611d1254", "url": "https://github.com/eclipse/jetty.project/commit/a83844df32f08a18ba2e78a76f98205a611d1254", "message": "changes from review\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-14T06:10:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDIyMTQ4MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454221481", "bodyText": "Add javadocs.", "author": "sbordet", "createdAt": "2020-07-14T09:20:45Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/KeyStoreScanner.java", "diffHunk": "@@ -0,0 +1,126 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.ssl;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.util.Collections;\n+\n+import org.eclipse.jetty.util.Scanner;\n+import org.eclipse.jetty.util.annotation.ManagedAttribute;\n+import org.eclipse.jetty.util.annotation.ManagedOperation;\n+import org.eclipse.jetty.util.component.ContainerLifeCycle;\n+import org.eclipse.jetty.util.log.Log;\n+import org.eclipse.jetty.util.log.Logger;\n+\n+public class KeyStoreScanner extends ContainerLifeCycle implements Scanner.DiscreteListener", "originalCommit": "a83844df32f08a18ba2e78a76f98205a611d1254", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2541f1f648f86767f9e95d1d002a5ca57fe99e21", "url": "https://github.com/eclipse/jetty.project/commit/2541f1f648f86767f9e95d1d002a5ca57fe99e21", "message": "add javadoc for KeyStoreScanner class\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-15T01:20:57Z", "type": "commit"}, {"oid": "c40ba6922259b7c5c19e71dea2bfc6335c96982b", "url": "https://github.com/eclipse/jetty.project/commit/c40ba6922259b7c5c19e71dea2bfc6335c96982b", "message": "add null checks in SslContextFactory for _factory, which could be null if reload failed\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-15T05:35:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2OTE4MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454869181", "bodyText": "Change the message to \"SslContextFactory not started or reload failed\" in the 3 places you have added it.\nWe will know from the stack trace what is unavailable.", "author": "sbordet", "createdAt": "2020-07-15T08:07:31Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslContextFactory.java", "diffHunk": "@@ -1131,6 +1131,9 @@ public SSLContext getSslContext()\n \n         synchronized (this)\n         {\n+            if (_factory == null)\n+                throw new IllegalStateException(\"reload failed SslContext unavailable\");", "originalCommit": "c40ba6922259b7c5c19e71dea2bfc6335c96982b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg3MjQyOQ==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454872429", "bodyText": "There is this check just above the synchronized block\nif (!isStarted())\n    return _setContext;\nwhich is why I didn't put the \"not started\" bit in the exception message, or do you expect this state to be able to change in between this check and the synchronized block?", "author": "lachlan-roberts", "createdAt": "2020-07-15T08:13:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2OTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg4MjQ2Mw==", "url": "https://github.com/eclipse/jetty.project/pull/5042#discussion_r454882463", "bodyText": "Cool, just say \"SslContextFactory reload failed\" then.", "author": "sbordet", "createdAt": "2020-07-15T08:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDg2OTE4MQ=="}], "type": "inlineReview"}, {"oid": "0f7d99c3bfecf6f67b95f64c031880a0b4832078", "url": "https://github.com/eclipse/jetty.project/commit/0f7d99c3bfecf6f67b95f64c031880a0b4832078", "message": "add documentation for ssl-reload, change exception message in SslContextFactory\n\nSigned-off-by: Lachlan Roberts <lachlan@webtide.com>", "committedDate": "2020-07-15T09:01:15Z", "type": "commit"}]}