{"pr_number": 4458, "pr_title": "Issue #4432 Implement get/setSessionTimeout for ServletContext", "pr_createdAt": "2020-01-07T04:50:43Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4458", "timeline": [{"oid": "9325193fe37aad0ced58f083e0ebc93dc8e85515", "url": "https://github.com/eclipse/jetty.project/commit/9325193fe37aad0ced58f083e0ebc93dc8e85515", "message": "Issue #4432 Implement get/setSessionTimeout for ServletContext\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-07T04:44:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY0ODYxMw==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r363648613", "bodyText": "Just a thought that if I call setSessionTimeout(-1) and then getSessionTimeout() I get back 0 even if I set -1. Is that ok?", "author": "sbordet", "createdAt": "2020-01-07T09:01:59Z", "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java", "diffHunk": "@@ -1382,6 +1382,36 @@ public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingMode\n                 _sessionHandler.setSessionTrackingModes(sessionTrackingModes);\n         }\n \n+        @Override\n+        public int getSessionTimeout()\n+        {\n+            if (!isStarting())\n+                throw new IllegalStateException();\n+            if (!_enabled)\n+                throw new UnsupportedOperationException();\n+\n+            int timeout = -1;\n+            if (_sessionHandler != null)\n+            {\n+                int maxInactive = _sessionHandler.getMaxInactiveInterval();\n+                timeout = (maxInactive < 0 ? 0 : maxInactive / 60);\n+            }\n+\n+            return timeout;\n+        }\n+\n+        @Override\n+        public void setSessionTimeout(int sessionTimeout)\n+        {\n+            if (!isStarting())\n+                throw new IllegalStateException();\n+            if (!_enabled)\n+                throw new UnsupportedOperationException();\n+\n+            if (_sessionHandler != null)\n+                _sessionHandler.setMaxInactiveInterval((sessionTimeout < 0 ? 0 : sessionTimeout * 60));\n+        }", "originalCommit": "9325193fe37aad0ced58f083e0ebc93dc8e85515", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzQyMDcwMA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r367420700", "bodyText": "I've made some changes: you should not be able to set more than the max minutes, nor less than the min minutes. Please take another look.", "author": "janbartel", "createdAt": "2020-01-16T13:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY0ODYxMw=="}], "type": "inlineReview"}, {"oid": "f02d546f83de914c611feb971cb595ebb122d33d", "url": "https://github.com/eclipse/jetty.project/commit/f02d546f83de914c611feb971cb595ebb122d33d", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-4432-set-session-timeout", "committedDate": "2020-01-13T20:43:53Z", "type": "commit"}, {"oid": "7b500406ddb6258db54e2e5f545c92b5849943bb", "url": "https://github.com/eclipse/jetty.project/commit/7b500406ddb6258db54e2e5f545c92b5849943bb", "message": "Fixing checkstyle violation\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-01-13T21:41:57Z", "type": "commit"}, {"oid": "b1cbacca8061323e78c86e81833b450d9cf2eade", "url": "https://github.com/eclipse/jetty.project/commit/b1cbacca8061323e78c86e81833b450d9cf2eade", "message": "Issue #4432 Session timeout values\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-16T13:36:24Z", "type": "commit"}, {"oid": "9ed6d52c61df452988225c8fb198354d51f6a6bf", "url": "https://github.com/eclipse/jetty.project/commit/9ed6d52c61df452988225c8fb198354d51f6a6bf", "message": "Issue #4432 fix javadoc\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-16T14:21:36Z", "type": "commit"}, {"oid": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "url": "https://github.com/eclipse/jetty.project/commit/a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "message": "Issue #4432 fix javadoc\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-20T08:27:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQyNzA1MA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368427050", "bodyText": "Move to ServletContextHandler and make it private.", "author": "sbordet", "createdAt": "2020-01-20T08:53:29Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java", "diffHunk": "@@ -160,6 +161,30 @@ public Enumeration getIds()\n         }\n     };\n \n+    /**\n+     * Session timeout values are specified in web.xml and\n+     * by ServletContext.setSessionTimeout in minutes, expressed\n+     * as an integer, but treated as seconds by the HttpSession\n+     * also as an integer. Thus, there is a floor and ceiling to\n+     * the session timeout values. This method enforces that\n+     * floor and ceiling. Note that all values &lt;&equals; 0\n+     * are effectively equivalent, meaning that the session will\n+     * never expire.\n+     *\n+     * @param minutes the number of minutes before an idle session expires\n+     * @return the number of minutes, limited by the max and min value\n+     */\n+    public static int clipSessionTimeout(int minutes)", "originalCommit": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1NzgwOA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368457808", "bodyText": "I've made this a private static on SessionHandler. It should not move to ServletContextHandler because this knowledge about session timeout vaues should be kept local to the SessionHandler. I've added a new method on SessionHandler called setMaxInactiveIntervalMins, which takes a value in mins, clips it and converts to seconds.", "author": "janbartel", "createdAt": "2020-01-20T09:57:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQyNzA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzMzA4OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368433089", "bodyText": "These constants should not be in this class, as they are only ever used by ServletContextHandler, so they should be moved there and made private.", "author": "sbordet", "createdAt": "2020-01-20T09:07:25Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java", "diffHunk": "@@ -136,11 +136,12 @@\n \n     /**\n      * Web.xml session-timeout is set in minutes, but is stored as an int in seconds by HttpSession and\n-     * the sessionmanager. Thus MAX_INT is the max number of seconds that can be set, and MAX_INT/60 is the\n+     * the sessionmanager. Thus MAX_INT is the max number of seconds that can be set so MAX_INT/60 is the\n      * max number of minutes that you can set.\n      */\n-    public static final java.math.BigDecimal MAX_INACTIVE_MINUTES = new java.math.BigDecimal(Integer.MAX_VALUE / 60);\n-\n+    public static final int MAX_SESSION_TIMEOUT_MINS = Integer.MAX_VALUE / 60;\n+    public static final int MIN_SESSION_TIMEOUT_MINS = Integer.MIN_VALUE / 60;", "originalCommit": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzNDc1OQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368434759", "bodyText": "Fix typos: not -> nor, or -> nor.", "author": "sbordet", "createdAt": "2020-01-20T09:11:05Z", "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -403,6 +468,28 @@ public void destroyServer() throws Exception\n         _server.stop();\n         _server.join();\n     }\n+    \n+    @Test\n+    public void testGetSetSessionTimeout() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        Integer timeout = Integer.valueOf(100);\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\", ServletContextHandler.SESSIONS);\n+        root.addBean(new MySCIStarter(root.getServletContext(), new MySCI(true, timeout.intValue())), true);\n+        _server.start();\n+        \n+        //test can set session timeout from ServletContainerInitializer\n+        assertTrue((Boolean)root.getServletContext().getAttribute(\"MYSCI.setSessionTimeout\"));\n+        //test can get session timeout from ServletContainerInitializer\n+        assertEquals(timeout, (Integer)root.getServletContext().getAttribute(\"MYSCI.getSessionTimeout\"));\n+        assertNull(root.getAttribute(\"MYSCI.sessionTimeoutFailure\"));\n+        //test can't get session timeout from ContextListener not from annotation or web.xml", "originalCommit": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1ODcyNw==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368458727", "bodyText": "This is not a typo :)  The sentence means that you cannot get a session timeout from a ContextListener _that was not annotated or declared in web.xml. I've clarified the language.", "author": "janbartel", "createdAt": "2020-01-20T09:59:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzNDc1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzNDg1MQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368434851", "bodyText": "Ditto re typos.", "author": "sbordet", "createdAt": "2020-01-20T09:11:15Z", "path": "jetty-servlet/src/test/java/org/eclipse/jetty/servlet/ServletContextHandlerTest.java", "diffHunk": "@@ -403,6 +468,28 @@ public void destroyServer() throws Exception\n         _server.stop();\n         _server.join();\n     }\n+    \n+    @Test\n+    public void testGetSetSessionTimeout() throws Exception\n+    {\n+        ContextHandlerCollection contexts = new ContextHandlerCollection();\n+        _server.setHandler(contexts);\n+\n+        Integer timeout = Integer.valueOf(100);\n+        ServletContextHandler root = new ServletContextHandler(contexts, \"/\", ServletContextHandler.SESSIONS);\n+        root.addBean(new MySCIStarter(root.getServletContext(), new MySCI(true, timeout.intValue())), true);\n+        _server.start();\n+        \n+        //test can set session timeout from ServletContainerInitializer\n+        assertTrue((Boolean)root.getServletContext().getAttribute(\"MYSCI.setSessionTimeout\"));\n+        //test can get session timeout from ServletContainerInitializer\n+        assertEquals(timeout, (Integer)root.getServletContext().getAttribute(\"MYSCI.getSessionTimeout\"));\n+        assertNull(root.getAttribute(\"MYSCI.sessionTimeoutFailure\"));\n+        //test can't get session timeout from ContextListener not from annotation or web.xml\n+        assertTrue((Boolean)root.getServletContext().getAttribute(\"MyContextListener.getSessionTimeout\"));\n+        //test can't set session timeout from ContextListener not from annotation or web.xml", "originalCommit": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1ODgwOQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368458809", "bodyText": "See my previous comment.", "author": "janbartel", "createdAt": "2020-01-20T09:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzNDg1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzODQ0MA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368438440", "bodyText": "No need to call a method in SessionHandler when it can be in this class.\nThis will keep the logic of dividing by 60 and multiplying by 60 in the same class.", "author": "sbordet", "createdAt": "2020-01-20T09:18:41Z", "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java", "diffHunk": "@@ -1382,6 +1383,41 @@ public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingMode\n                 _sessionHandler.setSessionTrackingModes(sessionTrackingModes);\n         }\n \n+        @Override\n+        public int getSessionTimeout()\n+        {\n+            if (!isStarting())\n+                throw new IllegalStateException();\n+            if (!_enabled)\n+                throw new UnsupportedOperationException();\n+\n+            int timeout = -1;\n+            if (_sessionHandler != null)\n+            {\n+                int maxInactive = _sessionHandler.getMaxInactiveInterval();\n+                timeout = maxInactive / 60;\n+            }\n+\n+            return timeout;\n+        }\n+\n+        @Override\n+        public void setSessionTimeout(int sessionTimeout)\n+        {\n+            if (!isStarting())\n+                throw new IllegalStateException();\n+            if (!_enabled)\n+                throw new UnsupportedOperationException();\n+\n+            if (_sessionHandler != null)\n+            {\n+                //sessionTimeout is in mins, but session and SessionHandler use seconds,\n+                //both represented as an int, thus there is a floor and ceiling value\n+                //for session timeout minutes.\n+                _sessionHandler.setMaxInactiveInterval(SessionHandler.clipSessionTimeout(sessionTimeout) * 60); //in seconds", "originalCommit": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzOTUxMg==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368439512", "bodyText": "I think this should just be context.setSessionTimeout(val) so that all the logic for checking the value is in ServletContextHandler and there is no need to expose constants and methods and duplicate logic.", "author": "sbordet", "createdAt": "2020-01-20T09:20:59Z", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java", "diffHunk": "@@ -650,11 +651,10 @@ public void visitSessionConfig(WebAppContext context, Descriptor descriptor, Xml\n         XmlParser.Node tNode = node.get(\"session-timeout\");\n         if (tNode != null)\n         {\n-            java.math.BigDecimal asDecimal = new java.math.BigDecimal(tNode.toString(false, true));\n-            if (asDecimal.compareTo(org.eclipse.jetty.server.session.SessionHandler.MAX_INACTIVE_MINUTES) > 0)\n-                throw new IllegalStateException(\"Max session-timeout in minutes is \" + org.eclipse.jetty.server.session.SessionHandler.MAX_INACTIVE_MINUTES);\n-\n-            context.getSessionHandler().setMaxInactiveInterval(asDecimal.intValueExact() * 60);\n+            int val = Integer.parseInt(tNode.toString(false, true));\n+            if (val > SessionHandler.MAX_SESSION_TIMEOUT_MINS)\n+                throw new IllegalStateException(\"Max session-timeout in minutes is \" + SessionHandler.MAX_SESSION_TIMEOUT_MINS);\n+            context.getSessionHandler().setMaxInactiveInterval(SessionHandler.clipSessionTimeout(val) * 60);", "originalCommit": "a6a4c0092f96f90e40b53cb08b7c2e2618990bd7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ1OTAyMA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368459020", "bodyText": "Solved this a different way, please see previous comment.", "author": "janbartel", "createdAt": "2020-01-20T10:00:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQzOTUxMg=="}], "type": "inlineReview"}, {"oid": "d102a13b90c55dd6135da487b18caf8546ed7a88", "url": "https://github.com/eclipse/jetty.project/commit/d102a13b90c55dd6135da487b18caf8546ed7a88", "message": "Issue #4432 Changes after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-20T09:55:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ2NDU0NA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368464544", "bodyText": "Now multiplying by 60 is in this class, but dividing by 60 is in another class.", "author": "sbordet", "createdAt": "2020-01-20T10:11:15Z", "path": "jetty-server/src/main/java/org/eclipse/jetty/server/session/SessionHandler.java", "diffHunk": "@@ -851,6 +876,18 @@ public void setMaxInactiveInterval(int seconds)\n                 LOG.debug(\"SessionManager default maxInactiveInterval={}\", _dftMaxIdleSecs);\n         }\n     }\n+    \n+    /**\n+     * Set the max period of inactivity expressed as minutes.\n+     * The minutes are converted to seconds, and their min and\n+     * max values constrained.\n+     * \n+     * @param mins the number of minutes.\n+     */\n+    public void setMaxInactiveIntervalMins(int mins)\n+    {\n+        setMaxInactiveInterval(clipSessionTimeoutMins(mins) * 60);", "originalCommit": "d102a13b90c55dd6135da487b18caf8546ed7a88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ2NDc4MA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368464780", "bodyText": "Division by 60 here, but missing multiplication in the setter?\nThey should be in the same class.", "author": "sbordet", "createdAt": "2020-01-20T10:11:44Z", "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java", "diffHunk": "@@ -1382,6 +1383,38 @@ public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingMode\n                 _sessionHandler.setSessionTrackingModes(sessionTrackingModes);\n         }\n \n+        @Override\n+        public int getSessionTimeout()\n+        {\n+            if (!isStarting())\n+                throw new IllegalStateException();\n+            if (!_enabled)\n+                throw new UnsupportedOperationException();\n+\n+            int timeout = -1;\n+            if (_sessionHandler != null)\n+            {\n+                int maxInactive = _sessionHandler.getMaxInactiveInterval();\n+                timeout = maxInactive / 60;", "originalCommit": "d102a13b90c55dd6135da487b18caf8546ed7a88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ3MzU3OA==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368473578", "bodyText": "OK, I've added getMaxInactiveIntervalMins() on SessionHandler, so all mins<->seconds happens entirely in SessionHandler.", "author": "janbartel", "createdAt": "2020-01-20T10:29:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ2NDc4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ2NTU1Ng==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368465556", "bodyText": "I would prefer calling a method on context here, rather than on SessionHandler.\nI'm sure people can misconfigure things in a way that context.getSessionHandler() return null.", "author": "sbordet", "createdAt": "2020-01-20T10:13:13Z", "path": "jetty-webapp/src/main/java/org/eclipse/jetty/webapp/StandardDescriptorProcessor.java", "diffHunk": "@@ -650,11 +651,10 @@ public void visitSessionConfig(WebAppContext context, Descriptor descriptor, Xml\n         XmlParser.Node tNode = node.get(\"session-timeout\");\n         if (tNode != null)\n         {\n-            java.math.BigDecimal asDecimal = new java.math.BigDecimal(tNode.toString(false, true));\n-            if (asDecimal.compareTo(org.eclipse.jetty.server.session.SessionHandler.MAX_INACTIVE_MINUTES) > 0)\n-                throw new IllegalStateException(\"Max session-timeout in minutes is \" + org.eclipse.jetty.server.session.SessionHandler.MAX_INACTIVE_MINUTES);\n-\n-            context.getSessionHandler().setMaxInactiveInterval(asDecimal.intValueExact() * 60);\n+            int val = Integer.parseInt(tNode.toString(false, true));\n+            if (val > SessionHandler.MAX_SESSION_TIMEOUT_MINS)\n+                throw new IllegalStateException(\"Max session-timeout in minutes is \" + SessionHandler.MAX_SESSION_TIMEOUT_MINS);\n+            context.getSessionHandler().setMaxInactiveIntervalMins(val);", "originalCommit": "d102a13b90c55dd6135da487b18caf8546ed7a88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ3NDE1Mw==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368474153", "bodyText": "Well if you don't have a SessionHandler, then it's pointless setting the session timeout. Note that the top of the method checks to see if there is a sessionHandler, and skips the method if not.", "author": "janbartel", "createdAt": "2020-01-20T10:30:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODQ2NTU1Ng=="}], "type": "inlineReview"}, {"oid": "c3c9d5a02163cb99d07f8c8b2aaf62ef70e83b59", "url": "https://github.com/eclipse/jetty.project/commit/c3c9d5a02163cb99d07f8c8b2aaf62ef70e83b59", "message": "Issue #4432 Update after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-20T10:25:30Z", "type": "commit"}, {"oid": "0a88d17964550956e1c01e2f63d3c64ff89539de", "url": "https://github.com/eclipse/jetty.project/commit/0a88d17964550956e1c01e2f63d3c64ff89539de", "message": "Issue #4432 changes after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-01-20T12:08:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxOTU4MQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368519581", "bodyText": "If there is no SessionHandler this returns 0, and also if SessionHandler is configured with a value that is less than 60 seconds, either positive or negative.\nIf that's ok by the spec, I'm fine.\nIf you need to retain the fact that the value is negative, then perhaps this is enough?\nreturn timeout < 0 ? -1 : (int)TimeUnit.SECONDS.toMinutes(timeout);", "author": "sbordet", "createdAt": "2020-01-20T12:21:17Z", "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletContextHandler.java", "diffHunk": "@@ -1382,6 +1384,42 @@ public void setSessionTrackingModes(Set<SessionTrackingMode> sessionTrackingMode\n                 _sessionHandler.setSessionTrackingModes(sessionTrackingModes);\n         }\n \n+        @Override\n+        public int getSessionTimeout()\n+        {\n+            if (!isStarting())\n+                throw new IllegalStateException();\n+            if (!_enabled)\n+                throw new UnsupportedOperationException();\n+\n+            int timeout = -1;\n+            if (_sessionHandler != null)\n+            {\n+                timeout = _sessionHandler.getMaxInactiveInterval();\n+            }\n+\n+            return (int)TimeUnit.SECONDS.toMinutes(timeout);", "originalCommit": "0a88d17964550956e1c01e2f63d3c64ff89539de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU3MTIyMQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368571221", "bodyText": "Any value of 0 or less has the same meaning as far as the spec is concerned, ie that the session never expires, so it's probably ok. Also, according to the spec there's no way to set a positive value less than a minute, so there's no option but to return 0 if you've used the jetty-specific methods to allow you to set a value < 60 secs.", "author": "janbartel", "createdAt": "2020-01-20T14:20:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxOTU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU5MjM1NQ==", "url": "https://github.com/eclipse/jetty.project/pull/4458#discussion_r368592355", "bodyText": "Okay then.", "author": "sbordet", "createdAt": "2020-01-20T15:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODUxOTU4MQ=="}], "type": "inlineReview"}]}