{"pr_number": 5215, "pr_title": "Issue #5214 - Servlet HEAD doesn't support content-length over Integer.MAX_VALUE", "pr_createdAt": "2020-08-31T14:44:53Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5215", "timeline": [{"oid": "116871362bf41115bda3522d244112d5dae2fba1", "url": "https://github.com/eclipse/jetty.project/commit/116871362bf41115bda3522d244112d5dae2fba1", "message": "Issue #5214 - Replicating HEAD Content-Length failure for huge files\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-08-31T14:25:07Z", "type": "commit"}, {"oid": "eba360f66247784057c452c7e944b6f53575d9b9", "url": "https://github.com/eclipse/jetty.project/commit/eba360f66247784057c452c7e944b6f53575d9b9", "message": "Issue #5214 - Use known content_length when in bypass write\n\n+ In the case of HEAD, the servlet-api response is a wrapper\n  of javax.servlet.http.HttpServlet$NoBodyResponse\n  We know the content_length, use it.\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-08-31T14:43:04Z", "type": "commit"}, {"oid": "dcb06d3c35c26e634c173d4fbcad20e6289128d7", "url": "https://github.com/eclipse/jetty.project/commit/dcb06d3c35c26e634c173d4fbcad20e6289128d7", "message": "Issue #5214 - Use known content_length when in HEAD mode\n\n+ Adding DefaultServlet.doHead() to avoid servlet wrapping\n+ Making ResourceService HEAD aware\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-08-31T16:03:49Z", "type": "commit"}, {"oid": "9128fc48e4921b72441f3c909151f7b5591cef3f", "url": "https://github.com/eclipse/jetty.project/commit/9128fc48e4921b72441f3c909151f7b5591cef3f", "message": "Cleanup dead code in ResourceService\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-08-31T16:16:22Z", "type": "commit"}, {"oid": "9e326fe5202e060a5f1726f093ae9db31c8dc203", "url": "https://github.com/eclipse/jetty.project/commit/9e326fe5202e060a5f1726f093ae9db31c8dc203", "message": "+ improved sentinels values for content-length\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-08-31T16:19:11Z", "type": "commit"}, {"oid": "a6b7f73019a3cd7b5ba6a382179e25312ad6520c", "url": "https://github.com/eclipse/jetty.project/commit/a6b7f73019a3cd7b5ba6a382179e25312ad6520c", "message": "Merge branch 'jetty-9.4.x-5214-head-huge-static' of https://github.com/eclipse/jetty.project into jetty-9.4.x-5214-head-huge-static", "committedDate": "2020-08-31T16:22:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQzNDA4Ng==", "url": "https://github.com/eclipse/jetty.project/pull/5215#discussion_r481434086", "bodyText": "responseListener.get() only waits for the headers, so to be sure here I would also do (maybe in a try-with-resources):\nassertEquals(-1, response.getInputStream().read());\nwhich would guarantee that the HEAD response really came without body, as it should be.", "author": "sbordet", "createdAt": "2020-09-01T21:11:42Z", "path": "jetty-webapp/src/test/java/org/eclipse/jetty/webapp/HugeResourceTest.java", "diffHunk": "@@ -244,6 +244,26 @@ public void testDownload(String filename, long expectedSize) throws Exception\n         }\n     }\n \n+    @ParameterizedTest\n+    @MethodSource(\"staticFiles\")\n+    public void testHead(String filename, long expectedSize) throws Exception\n+    {\n+        URI destUri = server.getURI().resolve(\"/\" + filename);\n+        InputStreamResponseListener responseListener = new InputStreamResponseListener();\n+\n+        Request request = client.newRequest(destUri)\n+            .method(HttpMethod.HEAD);\n+        request.send(responseListener);\n+        Response response = responseListener.get(5, TimeUnit.SECONDS);", "originalCommit": "a6b7f73019a3cd7b5ba6a382179e25312ad6520c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ1NTkwNg==", "url": "https://github.com/eclipse/jetty.project/pull/5215#discussion_r481455906", "bodyText": "Good point.\nBut if that fails, does that mean that both jetty server and jetty client have bugs then? ;-)", "author": "joakime", "createdAt": "2020-09-01T21:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQzNDA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQ2NzI2Mg==", "url": "https://github.com/eclipse/jetty.project/pull/5215#discussion_r481467262", "bodyText": "Does not matter - we will have a failed test and we'll investigate :)", "author": "sbordet", "createdAt": "2020-09-01T22:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQzNDA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTk4MTEzMQ==", "url": "https://github.com/eclipse/jetty.project/pull/5215#discussion_r481981131", "bodyText": "@joakime I'll fix this to get this merged ASAP.", "author": "gregw", "createdAt": "2020-09-02T10:56:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTQzNDA4Ng=="}], "type": "inlineReview"}, {"oid": "418093af28df8627301d6aee8d23dc843265367c", "url": "https://github.com/eclipse/jetty.project/commit/418093af28df8627301d6aee8d23dc843265367c", "message": "Feedback from review:\n\n + check no content in HEAD response", "committedDate": "2020-09-02T11:01:20Z", "type": "commit"}]}