{"pr_number": 5292, "pr_title": "Issue #5264 Demo modules", "pr_createdAt": "2020-09-17T13:01:25Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5292", "timeline": [{"oid": "52a0fdfbfa1d8eed16cfe7912d845dccf1acb8eb", "url": "https://github.com/eclipse/jetty.project/commit/52a0fdfbfa1d8eed16cfe7912d845dccf1acb8eb", "message": "Issue #5264 Demo modules\n\nCreate modules in jetty-home to download and deploy demos", "committedDate": "2020-09-17T13:00:47Z", "type": "commit"}, {"oid": "e338310c0a59140925bf1392f6311a8f03cc53f0", "url": "https://github.com/eclipse/jetty.project/commit/e338310c0a59140925bf1392f6311a8f03cc53f0", "message": "Issue #5264 - Supporting snapshot maven repo metadata in start.jar\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-18T19:20:41Z", "type": "commit"}, {"oid": "ba78355bd678a4355ca1250923f2caa43d23be62", "url": "https://github.com/eclipse/jetty.project/commit/ba78355bd678a4355ca1250923f2caa43d23be62", "message": "Issue #5264 - Supporting extract of maven archive to destination\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-18T20:53:31Z", "type": "commit"}, {"oid": "4ecff26022f8b686cec40ce0ad89072dcb6869bb", "url": "https://github.com/eclipse/jetty.project/commit/4ecff26022f8b686cec40ce0ad89072dcb6869bb", "message": "Issue #5264 - Reworking test-distribution to use jetty-home\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T18:56:34Z", "type": "commit"}, {"oid": "d0b8a314118a307083ba88b955bf34371bedba93", "url": "https://github.com/eclipse/jetty.project/commit/d0b8a314118a307083ba88b955bf34371bedba93", "message": "Issue #5264 - Disabling jetty-distribution from build reactor\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T18:56:50Z", "type": "commit"}, {"oid": "8a64309cdfafeb8bcbcf450fbecf0120c2057d79", "url": "https://github.com/eclipse/jetty.project/commit/8a64309cdfafeb8bcbcf450fbecf0120c2057d79", "message": "Issue #5264 - Reworking demo/tests into modules based on config classifiers\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T18:57:23Z", "type": "commit"}, {"oid": "533d64cda1cf78d082f471b76e1971a0c69766fd", "url": "https://github.com/eclipse/jetty.project/commit/533d64cda1cf78d082f471b76e1971a0c69766fd", "message": "Issue #5264 - Fixing deploy status on demo webapps\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T19:47:31Z", "type": "commit"}, {"oid": "817533f460954b55de2725c331aece6b8c84001d", "url": "https://github.com/eclipse/jetty.project/commit/817533f460954b55de2725c331aece6b8c84001d", "message": "Issue #5264 - Removing compact3 build\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T19:56:48Z", "type": "commit"}, {"oid": "c002305cb2331c4170738c6ac3cf3ec7c9d7cbdf", "url": "https://github.com/eclipse/jetty.project/commit/c002305cb2331c4170738c6ac3cf3ec7c9d7cbdf", "message": "Issue #5264 - Fixing demo-jndi config\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T20:53:45Z", "type": "commit"}, {"oid": "770f251cbbf83b62755ecc02eab565e208dc1741", "url": "https://github.com/eclipse/jetty.project/commit/770f251cbbf83b62755ecc02eab565e208dc1741", "message": "Issue #5264 - Fixing demo-jndi deps for javax.mail\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-21T21:48:50Z", "type": "commit"}, {"oid": "3768b09d6f2db7d200af826fa6cb8e57a339b7f9", "url": "https://github.com/eclipse/jetty.project/commit/3768b09d6f2db7d200af826fa6cb8e57a339b7f9", "message": "added jstl\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-09-22T11:07:14Z", "type": "commit"}, {"oid": "d1f6cbb9da7981c42b2c0d25aba0d1d8065dd5ac", "url": "https://github.com/eclipse/jetty.project/commit/d1f6cbb9da7981c42b2c0d25aba0d1d8065dd5ac", "message": "added jndi and jaas dependencies\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-09-22T11:28:10Z", "type": "commit"}, {"oid": "63736990c5150cc78ab02b3c6bc43a7ffea347f9", "url": "https://github.com/eclipse/jetty.project/commit/63736990c5150cc78ab02b3c6bc43a7ffea347f9", "message": "Issue #5264 - Changing Distro to Home in jetty-maven-plugin\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-22T16:35:15Z", "type": "commit"}, {"oid": "a2cd9b3a502c444c818f14941f089bf6dbf877b9", "url": "https://github.com/eclipse/jetty.project/commit/a2cd9b3a502c444c818f14941f089bf6dbf877b9", "message": "fix maven plugin starting distribution as jetty home has different name, configure invoker plugin to be faster when running locally\n\nSigned-off-by: olivier lamy <oliver.lamy@gmail.com>", "committedDate": "2020-09-23T07:18:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI4NDc4NA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493284784", "bodyText": "I don't like much the idea about having test depending on downloading resources from https://oss.sonatype.org.\n@joakime not urgent but I can fix that (next week when back from holidays)", "author": "olamy", "createdAt": "2020-09-23T08:05:19Z", "path": "jetty-start/src/test/java/org/eclipse/jetty/start/fileinits/MavenLocalRepoFileInitializerTest.java", "diffHunk": "@@ -172,28 +177,90 @@ public void testGetCoordinateTestMavenBaseUri()\n     }\n \n     @Test\n-    public void testDownloaddefaultrepo()\n+    public void testDownloadDefaultRepo()\n         throws Exception\n     {\n         MavenLocalRepoFileInitializer repo =\n             new MavenLocalRepoFileInitializer(baseHome, null, false);\n-        String ref = \"maven://org.eclipse.jetty/jetty-http/9.4.10.v20180503/jar/tests\";\n+        String ref = \"maven://org.eclipse.jetty/jetty-http/9.4.31.v20200723/jar/tests\";\n         Coordinates coords = repo.getCoordinates(URI.create(ref));\n         assertThat(\"Coordinates\", coords, notNullValue());\n \n         assertThat(\"coords.groupId\", coords.groupId, is(\"org.eclipse.jetty\"));\n         assertThat(\"coords.artifactId\", coords.artifactId, is(\"jetty-http\"));\n-        assertThat(\"coords.version\", coords.version, is(\"9.4.10.v20180503\"));\n+        assertThat(\"coords.version\", coords.version, is(\"9.4.31.v20200723\"));\n         assertThat(\"coords.type\", coords.type, is(\"jar\"));\n         assertThat(\"coords.classifier\", coords.classifier, is(\"tests\"));\n \n         assertThat(\"coords.toCentralURI\", coords.toCentralURI().toASCIIString(),\n-            is(\"https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-http/9.4.10.v20180503/jetty-http-9.4.10.v20180503-tests.jar\"));\n+            is(\"https://repo1.maven.org/maven2/org/eclipse/jetty/jetty-http/9.4.31.v20200723/jetty-http-9.4.31.v20200723-tests.jar\"));\n \n-        Path destination = Paths.get(System.getProperty(\"java.io.tmpdir\"), \"jetty-http-9.4.10.v20180503-tests.jar\");\n+        Path destination = testdir.getEmptyPathDir().resolve(\"jetty-http-9.4.31.v20200723-tests.jar\");\n         Files.deleteIfExists(destination);\n         repo.download(coords.toCentralURI(), destination);\n         assertThat(Files.exists(destination), is(true));\n-        assertThat(destination.toFile().length(), is(962621L));\n+        assertThat(destination.toFile().length(), is(986193L));\n+    }\n+\n+    @Test\n+    public void testDownloadSnapshotRepo()\n+        throws Exception\n+    {\n+        Path snapshotLocalRepoDir = testdir.getPath().resolve(\"snapshot-repo\");\n+        FS.ensureEmpty(snapshotLocalRepoDir);\n+\n+        MavenLocalRepoFileInitializer repo =\n+            new MavenLocalRepoFileInitializer(baseHome, snapshotLocalRepoDir, false, \"https://oss.sonatype.org/content/repositories/jetty-snapshots/\");", "originalCommit": "a2cd9b3a502c444c818f14941f089bf6dbf877b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM0MDUxNg==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493340516", "bodyText": "We could setup a small remote repo in src/test/resources (a 1 artifact repo) for testing purposes.", "author": "joakime", "createdAt": "2020-09-23T09:02:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI4NDc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwNzA4Mg==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493507082", "bodyText": "I'll work on this today.", "author": "joakime", "createdAt": "2020-09-23T12:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI4NDc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMDQ4OA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493330488", "bodyText": "variable not used", "author": "olamy", "createdAt": "2020-09-23T08:52:01Z", "path": "jetty-start/src/test/java/org/eclipse/jetty/start/fileinits/MavenMetadataTest.java", "diffHunk": "@@ -0,0 +1,107 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.start.fileinits;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import java.util.TimeZone;\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.eclipse.jetty.toolchain.test.MavenTestingUtils;\n+import org.junit.jupiter.api.Test;\n+import org.xml.sax.SAXException;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class MavenMetadataTest\n+{\n+    private static final TimeZone UTC = TimeZone.getTimeZone(\"UTC\");", "originalCommit": "a2cd9b3a502c444c818f14941f089bf6dbf877b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMTMwMA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493331300", "bodyText": "this test will fail is executed before noon :)", "author": "olamy", "createdAt": "2020-09-23T08:52:46Z", "path": "jetty-start/src/test/java/org/eclipse/jetty/start/fileinits/MavenMetadataTest.java", "diffHunk": "@@ -0,0 +1,107 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.start.fileinits;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import java.util.TimeZone;\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.eclipse.jetty.toolchain.test.MavenTestingUtils;\n+import org.junit.jupiter.api.Test;\n+import org.xml.sax.SAXException;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class MavenMetadataTest\n+{\n+    private static final TimeZone UTC = TimeZone.getTimeZone(\"UTC\");\n+\n+    @Test\n+    public void testParseExample() throws ParserConfigurationException, SAXException, IOException\n+    {\n+        Path example = MavenTestingUtils.getTestResourcePathFile(\"example-maven-metadata.xml\");\n+        MavenMetadata mavenMetadata = new MavenMetadata(example);\n+\n+        assertThat(\"Metadata.groupId\", mavenMetadata.getGroupId(), is(\"org.eclipse.jetty\"));\n+        assertThat(\"Metadata.artifactId\", mavenMetadata.getArtifactId(), is(\"jetty-rewrite\"));\n+        assertThat(\"Metadata.version\", mavenMetadata.getVersion(), is(\"10.0.0-SNAPSHOT\"));\n+\n+        assertThat(\"Metadata.versioning.lastUpdated\", mavenMetadata.getLastUpdated(), is(\"20200918022411\"));\n+\n+        assertThat(\"Metadata.versioning.snapshot.timestamp\", mavenMetadata.getSnapshotTimestamp(), is(\"20200918.022411\"));\n+        assertThat(\"Metadata.versioning.snapshot.buildNumber\", mavenMetadata.getSnapshotBuildNumber(), is(\"580\"));\n+\n+        assertThat(\"Metadata.snapshots.size\", mavenMetadata.getSnapshots().size(), is(4));\n+\n+        assertThat(\"Metadata.snapshot(null, 'jar').value\",\n+            mavenMetadata.getSnapshot(null, \"jar\").getValue(),\n+            is(\"10.0.0-20200918.022411-580\"));\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampVeryOld()\n+    {\n+        String timestamp = \"20190822223344\";\n+        assertTrue(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampNextWeek()\n+    {\n+        LocalDateTime nextWeek = LocalDateTime.now().plusWeeks(1);\n+        String timestamp = getTimestampFormatter().format(nextWeek);\n+        assertFalse(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should NOT be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampNow()\n+    {\n+        LocalDateTime now = LocalDateTime.now();\n+        String timestamp = getTimestampFormatter().format(now);\n+        assertFalse(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should NOT be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampYesterday()\n+    {\n+        LocalDateTime yesterday = LocalDateTime.now().minusDays(1);\n+        String timestamp = getTimestampFormatter().format(yesterday);\n+        assertTrue(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestamp12HoursOld()", "originalCommit": "a2cd9b3a502c444c818f14941f089bf6dbf877b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM0MDkxNw==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493340917", "bodyText": "Yeah, i caught that 1 failure. :-)\nI'm thinking of just dropping that specific test method.", "author": "joakime", "createdAt": "2020-09-23T09:02:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMTMwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMjE2MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493332161", "bodyText": "what about something such now(ZoneId.of(\"UTC\")) as getTimestampFormatter use UTC?", "author": "olamy", "createdAt": "2020-09-23T08:53:38Z", "path": "jetty-start/src/test/java/org/eclipse/jetty/start/fileinits/MavenMetadataTest.java", "diffHunk": "@@ -0,0 +1,107 @@\n+//\n+// ========================================================================\n+// Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//\n+// This program and the accompanying materials are made available under\n+// the terms of the Eclipse Public License 2.0 which is available at\n+// https://www.eclipse.org/legal/epl-2.0\n+//\n+// This Source Code may also be made available under the following\n+// Secondary Licenses when the conditions for such availability set\n+// forth in the Eclipse Public License, v. 2.0 are satisfied:\n+// the Apache License v2.0 which is available at\n+// https://www.apache.org/licenses/LICENSE-2.0\n+//\n+// SPDX-License-Identifier: EPL-2.0 OR Apache-2.0\n+// ========================================================================\n+//\n+\n+package org.eclipse.jetty.start.fileinits;\n+\n+import java.io.IOException;\n+import java.nio.file.Path;\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n+import java.time.format.DateTimeFormatter;\n+import java.util.TimeZone;\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.eclipse.jetty.toolchain.test.MavenTestingUtils;\n+import org.junit.jupiter.api.Test;\n+import org.xml.sax.SAXException;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.is;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+public class MavenMetadataTest\n+{\n+    private static final TimeZone UTC = TimeZone.getTimeZone(\"UTC\");\n+\n+    @Test\n+    public void testParseExample() throws ParserConfigurationException, SAXException, IOException\n+    {\n+        Path example = MavenTestingUtils.getTestResourcePathFile(\"example-maven-metadata.xml\");\n+        MavenMetadata mavenMetadata = new MavenMetadata(example);\n+\n+        assertThat(\"Metadata.groupId\", mavenMetadata.getGroupId(), is(\"org.eclipse.jetty\"));\n+        assertThat(\"Metadata.artifactId\", mavenMetadata.getArtifactId(), is(\"jetty-rewrite\"));\n+        assertThat(\"Metadata.version\", mavenMetadata.getVersion(), is(\"10.0.0-SNAPSHOT\"));\n+\n+        assertThat(\"Metadata.versioning.lastUpdated\", mavenMetadata.getLastUpdated(), is(\"20200918022411\"));\n+\n+        assertThat(\"Metadata.versioning.snapshot.timestamp\", mavenMetadata.getSnapshotTimestamp(), is(\"20200918.022411\"));\n+        assertThat(\"Metadata.versioning.snapshot.buildNumber\", mavenMetadata.getSnapshotBuildNumber(), is(\"580\"));\n+\n+        assertThat(\"Metadata.snapshots.size\", mavenMetadata.getSnapshots().size(), is(4));\n+\n+        assertThat(\"Metadata.snapshot(null, 'jar').value\",\n+            mavenMetadata.getSnapshot(null, \"jar\").getValue(),\n+            is(\"10.0.0-20200918.022411-580\"));\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampVeryOld()\n+    {\n+        String timestamp = \"20190822223344\";\n+        assertTrue(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampNextWeek()\n+    {\n+        LocalDateTime nextWeek = LocalDateTime.now().plusWeeks(1);\n+        String timestamp = getTimestampFormatter().format(nextWeek);\n+        assertFalse(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should NOT be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampNow()\n+    {\n+        LocalDateTime now = LocalDateTime.now();\n+        String timestamp = getTimestampFormatter().format(now);\n+        assertFalse(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should NOT be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestampYesterday()\n+    {\n+        LocalDateTime yesterday = LocalDateTime.now().minusDays(1);\n+        String timestamp = getTimestampFormatter().format(yesterday);\n+        assertTrue(MavenMetadata.isExpiredTimestamp(timestamp), \"Timestamp should be stale: \" + timestamp);\n+    }\n+\n+    @Test\n+    public void testIsExpiredTimestamp12HoursOld()\n+    {\n+        LocalDateTime oldish = LocalDateTime.now().minusHours(12);", "originalCommit": "a2cd9b3a502c444c818f14941f089bf6dbf877b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM0MTQ2NA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493341464", "bodyText": "That might work.", "author": "joakime", "createdAt": "2020-09-23T09:03:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMjE2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUwNjI0MQ==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493506241", "bodyText": "I opted to just remove this specific test, it's not reliable as written, and is too sensitive to the time of day that surefire user executes the test on.", "author": "joakime", "createdAt": "2020-09-23T12:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzMjE2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzNTUzMA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493335530", "bodyText": "maybe we could have some configuration \u00e0 la mvn -U to force downloading SNAPSHOT as here we have a sort of hardcoded value (the day before) maybe a sys property?", "author": "olamy", "createdAt": "2020-09-23T08:56:50Z", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/fileinits/MavenLocalRepoFileInitializer.java", "diffHunk": "@@ -219,6 +290,65 @@ public Coordinates getCoordinates(URI uri)\n         return coords;\n     }\n \n+    protected void download(Coordinates coords, Path destination)\n+        throws IOException\n+    {\n+        if (coords.version.endsWith(\"-SNAPSHOT\"))\n+        {\n+            Path localRepoMetadataPath = localRepositoryDir.resolve(coords.toMetadataPath());\n+            if (isMetadataStale(localRepoMetadataPath))\n+            {\n+                // Grab a fresh copy of the metadata xml\n+                URI mavenMetadataURI = coords.toSnapshotMetadataXmlURI();\n+                super.download(mavenMetadataURI, localRepoMetadataPath);\n+            }\n+\n+            if (Files.exists(localRepoMetadataPath))\n+            {\n+                // parse metadata to get actual SNAPSHOT version\n+                String actualVersion = getMetadataVersion(localRepoMetadataPath, coords);\n+                super.download(coords.toCentralURI(actualVersion), destination);\n+            }\n+        }\n+        else\n+        {\n+            super.download(coords.toCentralURI(), destination);\n+        }\n+    }\n+\n+    private boolean isMetadataStale(Path localRepoMetadataPath)\n+    {\n+        if (!Files.exists(localRepoMetadataPath))\n+        {\n+            // doesn't exist, it's stale.\n+            return true;\n+        }\n+\n+        try\n+        {\n+            MavenMetadata mavenMetadata = new MavenMetadata(localRepoMetadataPath);\n+            return MavenMetadata.isExpiredTimestamp(mavenMetadata.getLastUpdated());", "originalCommit": "a2cd9b3a502c444c818f14941f089bf6dbf877b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzM0MTk1Mw==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493341953", "bodyText": "Forcing download of new snapshots could be useful, yes.\nLets make that a new PR after this one gets merged.", "author": "joakime", "createdAt": "2020-09-23T09:03:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzNTUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxMjg0NA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493512844", "bodyText": "This ability, to support SNAPSHOT artifacts, is currently only useful to us when testing things.\nThe actual 10.0.0 release wouldn't have this requirement.\nSo I think it's safe to push this --update-snapshots feature to a future Jetty 10.0.x release.", "author": "joakime", "createdAt": "2020-09-23T12:09:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzMzNTUzMA=="}], "type": "inlineReview"}, {"oid": "9d432599b6aaed4255c03285692adf0a58def9a3", "url": "https://github.com/eclipse/jetty.project/commit/9d432599b6aaed4255c03285692adf0a58def9a3", "message": "Issue #5264 - Removing 12 hour expired test (too time of day sensitive)\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T12:01:16Z", "type": "commit"}, {"oid": "797b267e362d8386fe3a9bf426070137b06bb8da", "url": "https://github.com/eclipse/jetty.project/commit/797b267e362d8386fe3a9bf426070137b06bb8da", "message": "Issue #5264 - Removing unused variable\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T12:02:52Z", "type": "commit"}, {"oid": "eedcac314b3f01e988afbc0428fb65353170443e", "url": "https://github.com/eclipse/jetty.project/commit/eedcac314b3f01e988afbc0428fb65353170443e", "message": "Merge branch 'jetty-10.0.x' into jetty-10.0.x-5264-demo-modules", "committedDate": "2020-09-23T13:27:56Z", "type": "commit"}, {"oid": "55f1046c816a21813321119b21c78708c32bd4a1", "url": "https://github.com/eclipse/jetty.project/commit/55f1046c816a21813321119b21c78708c32bd4a1", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-5264-demo-modules", "committedDate": "2020-09-23T16:48:17Z", "type": "commit"}, {"oid": "5332f3f685ea86b0d4c398eab7b3e83f7b8a76f8", "url": "https://github.com/eclipse/jetty.project/commit/5332f3f685ea86b0d4c398eab7b3e83f7b8a76f8", "message": "demo-jaas depends on jaas\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-09-23T17:10:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc1NDM5OQ==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493754399", "bodyText": "I don't think this is necessary at all - seems to introduce a lot of additional complexity.\nMaybe it's a generic feature but I don't think it should go into this PR.", "author": "sbordet", "createdAt": "2020-09-23T17:09:42Z", "path": "jetty-start/src/main/java/org/eclipse/jetty/start/fileinits/MavenLocalRepoFileInitializer.java", "diffHunk": "@@ -219,6 +290,65 @@ public Coordinates getCoordinates(URI uri)\n         return coords;\n     }\n \n+    protected void download(Coordinates coords, Path destination)\n+        throws IOException\n+    {\n+        if (coords.version.endsWith(\"-SNAPSHOT\"))", "originalCommit": "55f1046c816a21813321119b21c78708c32bd4a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc4OTMwOA==", "url": "https://github.com/eclipse/jetty.project/pull/5292#discussion_r493789308", "bodyText": "As discussed, this is ok.", "author": "joakime", "createdAt": "2020-09-23T18:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc1NDM5OQ=="}], "type": "inlineReview"}, {"oid": "5654437cc9fe57d80be8677ed5c6882c2317910a", "url": "https://github.com/eclipse/jetty.project/commit/5654437cc9fe57d80be8677ed5c6882c2317910a", "message": "demo-jaas does not depend on demo-jndi\n\nSigned-off-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-09-23T17:31:24Z", "type": "commit"}, {"oid": "faf6d803900802ce4b1ef774e5165f00adc09dc3", "url": "https://github.com/eclipse/jetty.project/commit/faf6d803900802ce4b1ef774e5165f00adc09dc3", "message": "Issue #5264 - Moving demo webapps to /demos/ tree\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T18:35:19Z", "type": "commit"}, {"oid": "934a95b8eff40e028cdd40233d34411de14b04bf", "url": "https://github.com/eclipse/jetty.project/commit/934a95b8eff40e028cdd40233d34411de14b04bf", "message": "Issue #5264 - Updating embedded JettyDistro to JettyHome\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T18:38:38Z", "type": "commit"}, {"oid": "1feb60bb2c8e521f80aaee2abc901c067b561026", "url": "https://github.com/eclipse/jetty.project/commit/1feb60bb2c8e521f80aaee2abc901c067b561026", "message": "Issue #5264 - Updating Configure DTD to 10_0 for Demos\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T18:52:30Z", "type": "commit"}, {"oid": "bdf30ba43740fe8bfdae6af275fa15dffbccf1e1", "url": "https://github.com/eclipse/jetty.project/commit/bdf30ba43740fe8bfdae6af275fa15dffbccf1e1", "message": "Issue #5264 - Adding demo.mod support to embedded examples tests\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T19:56:53Z", "type": "commit"}, {"oid": "d4556e476f26e28fb0b4ad3446a130bde97201ac", "url": "https://github.com/eclipse/jetty.project/commit/d4556e476f26e28fb0b4ad3446a130bde97201ac", "message": "Issue #5264 - Work around junit-vintage flappy test error\n\n+ ApacheDS has old school testing lib which doesn't\n  play nice with surefire.\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T20:06:35Z", "type": "commit"}, {"oid": "f7cf41109b257125332ab5b6fa9b1859000cdaeb", "url": "https://github.com/eclipse/jetty.project/commit/f7cf41109b257125332ab5b6fa9b1859000cdaeb", "message": "Issue #5264 - Fixing jetty-maven-plugin exclusions for demos\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T20:29:25Z", "type": "commit"}, {"oid": "ad805d4756f56e1c941aeafe5f3bb893bad85ff8", "url": "https://github.com/eclipse/jetty.project/commit/ad805d4756f56e1c941aeafe5f3bb893bad85ff8", "message": "Issue #5264 - More post move to /demos/ updates\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T20:38:34Z", "type": "commit"}, {"oid": "09d159d038fc37999f720e95d8db479b2d385033", "url": "https://github.com/eclipse/jetty.project/commit/09d159d038fc37999f720e95d8db479b2d385033", "message": "Merge remote-tracking branch 'origin/jetty-10.0.x' into jetty-10.0.x-5264-demo-modules", "committedDate": "2020-09-23T20:38:49Z", "type": "commit"}, {"oid": "c9be742d70943646c8ecb431b217c7dd2e8d18d6", "url": "https://github.com/eclipse/jetty.project/commit/c9be742d70943646c8ecb431b217c7dd2e8d18d6", "message": "Issue #5264 - Fixing test-integration references to demos\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T21:44:17Z", "type": "commit"}, {"oid": "413eb4ccfeb42fa5295d37bb18beb2a5b2a3d2c7", "url": "https://github.com/eclipse/jetty.project/commit/413eb4ccfeb42fa5295d37bb18beb2a5b2a3d2c7", "message": "Issue #5264 - Javadoc processing excludes for demos\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T21:44:34Z", "type": "commit"}, {"oid": "9a2d6cd5970f95e513e0691541db10485ee1c9e4", "url": "https://github.com/eclipse/jetty.project/commit/9a2d6cd5970f95e513e0691541db10485ee1c9e4", "message": "Issue #5264 - Adding HostHeaderCustomizer to H2/H2C Transport tests\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T22:03:44Z", "type": "commit"}, {"oid": "23b6eca489100dce99d155abfa26c5f123bcb018", "url": "https://github.com/eclipse/jetty.project/commit/23b6eca489100dce99d155abfa26c5f123bcb018", "message": "Issue #5264 - More javadoc skippedModules\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T22:04:04Z", "type": "commit"}, {"oid": "5d73b42fb34a5aafa6edd4ae040fa5bc348c44b8", "url": "https://github.com/eclipse/jetty.project/commit/5d73b42fb34a5aafa6edd4ae040fa5bc348c44b8", "message": "Issue #5264 -Fixing name\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T22:42:34Z", "type": "commit"}, {"oid": "0f3c41c3ee5b3e5c8e3d58c593ef97edab284805", "url": "https://github.com/eclipse/jetty.project/commit/0f3c41c3ee5b3e5c8e3d58c593ef97edab284805", "message": "Issue #5264 - making embedded examples more reliable\n\n+ Discovering ${jetty.version} better\n+ Creating ${jetty.base}/logs/ on JettyDemoBase usage\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T22:43:36Z", "type": "commit"}, {"oid": "b56733915b1b9457d78adc4ffc42cbcce9838203", "url": "https://github.com/eclipse/jetty.project/commit/b56733915b1b9457d78adc4ffc42cbcce9838203", "message": "Issue #5264 - identifying optional deps in jetty-home\n\n + Done to ease dependency / exclusions listing requirements\n   elsewhere in the reactor.\n   (Prevents accidental discovered components from\n    triggering actions during use of jetty-home\n    as a dependency)\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T22:50:50Z", "type": "commit"}, {"oid": "32875aa564ca966b441098c1e38cbeead24d5e2a", "url": "https://github.com/eclipse/jetty.project/commit/32875aa564ca966b441098c1e38cbeead24d5e2a", "message": "Issue #5264 - Fixing OSGi tests\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T22:56:58Z", "type": "commit"}, {"oid": "73fe2ecfe87a5a1f3abc951bc92319bf84f3dedb", "url": "https://github.com/eclipse/jetty.project/commit/73fe2ecfe87a5a1f3abc951bc92319bf84f3dedb", "message": "Issue #5264 - Fixing demo-async-rest module reference\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T23:52:04Z", "type": "commit"}, {"oid": "3dbedd83478b6014c4df249960a86ba6ae43ba2c", "url": "https://github.com/eclipse/jetty.project/commit/3dbedd83478b6014c4df249960a86ba6ae43ba2c", "message": "Issue #5264 - Fixing OSGi symbolic name references\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-23T23:52:37Z", "type": "commit"}, {"oid": "35bca82e35a431a607d4335b81bfe8666bf49f4b", "url": "https://github.com/eclipse/jetty.project/commit/35bca82e35a431a607d4335b81bfe8666bf49f4b", "message": "Issue #5264 - Addressing (some) aggregate-javadoc issues\n\nSigned-off-by: Joakim Erdfelt <joakim.erdfelt@gmail.com>", "committedDate": "2020-09-24T01:20:27Z", "type": "commit"}]}