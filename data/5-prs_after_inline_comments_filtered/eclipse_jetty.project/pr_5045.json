{"pr_number": 5045, "pr_title": "Avoid large allocations of temporary buffers in BuferUtil", "pr_createdAt": "2020-07-15T04:12:59Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5045", "timeline": [{"oid": "1554768fe315e6f56652e750db0937a15aa192f6", "url": "https://github.com/eclipse/jetty.project/commit/1554768fe315e6f56652e750db0937a15aa192f6", "message": "Avoid large allocations of tmp buffers in buferutil\n\nSigned-off-by: Sergey Tselovalnikov <sergeicelov@gmail.com>", "committedDate": "2020-07-15T04:15:57Z", "type": "commit"}, {"oid": "1554768fe315e6f56652e750db0937a15aa192f6", "url": "https://github.com/eclipse/jetty.project/commit/1554768fe315e6f56652e750db0937a15aa192f6", "message": "Avoid large allocations of tmp buffers in buferutil\n\nSigned-off-by: Sergey Tselovalnikov <sergeicelov@gmail.com>", "committedDate": "2020-07-15T04:15:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgyMTg0Ng==", "url": "https://github.com/eclipse/jetty.project/pull/5045#discussion_r454821846", "bodyText": "Actually slight change would be better.  No need to assign the buffer in the loop:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        byte[] bytes = null;\n          \n          \n            \n                        while (buffer.hasRemaining())\n          \n          \n            \n                        {\n          \n          \n            \n                            int byteCountToWrite = Math.min(buffer.remaining(), TEMP_BUFFER_SIZE);\n          \n          \n            \n                            if (bytes == null)\n          \n          \n            \n                                bytes = new byte[byteCountToWrite];\n          \n          \n            \n                        byte[] bytes = new byte[Math.min(buffer.remaining(), TEMP_BUFFER_SIZE)];\n          \n          \n            \n                        while (buffer.hasRemaining())\n          \n          \n            \n                        {", "author": "gregw", "createdAt": "2020-07-15T06:31:31Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/BufferUtil.java", "diffHunk": "@@ -553,10 +553,12 @@ public static void writeTo(ByteBuffer buffer, OutputStream out) throws IOExcepti\n         }\n         else\n         {\n-            byte[] bytes = new byte[TEMP_BUFFER_SIZE];\n+            byte[] bytes = null;\n             while (buffer.hasRemaining())\n             {\n                 int byteCountToWrite = Math.min(buffer.remaining(), TEMP_BUFFER_SIZE);\n+                if (bytes == null)\n+                    bytes = new byte[byteCountToWrite];", "originalCommit": "1554768fe315e6f56652e750db0937a15aa192f6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "99d19267910a03b7a5fe72ecc95daeeed42c4144", "url": "https://github.com/eclipse/jetty.project/commit/99d19267910a03b7a5fe72ecc95daeeed42c4144", "message": "review feedback\n\nSigned-off-by: Sergey Tselovalnikov <sergeicelov@gmail.com>", "committedDate": "2020-07-15T07:03:16Z", "type": "commit"}]}