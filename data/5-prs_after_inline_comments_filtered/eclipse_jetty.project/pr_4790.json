{"pr_number": 4790, "pr_title": "Fixes #4778 - Enforcing SNI when there are only non-wildcards certifi\u2026", "pr_createdAt": "2020-04-18T16:15:53Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/4790", "timeline": [{"oid": "426c80bf6de4d7944e3ce669a44294757fa5d95a", "url": "https://github.com/eclipse/jetty.project/commit/426c80bf6de4d7944e3ce669a44294757fa5d95a", "message": "Fixes #4778 - Enforcing SNI when there are only non-wildcards certificates.\n\nIf SNI is required, wrap the KeyManagers with SniX509ExtendedKeyManager.\nUpdated the main keystore file to only have one certificate (instead of two),\nsince there never was the need for two certificates in the tests.\n\nSigned-off-by: Simone Bordet <simone.bordet@gmail.com>", "committedDate": "2020-04-18T16:15:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1Nzc4OA==", "url": "https://github.com/eclipse/jetty.project/pull/4790#discussion_r410757788", "bodyText": "Maybe a stupid question, but is it possible to move newSniX509ExtendedKeyManager wrapping to a Server.getKeyManagers method?", "author": "rnd4222", "createdAt": "2020-04-18T22:06:17Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/ssl/SslContextFactory.java", "diffHunk": "@@ -1247,14 +1247,13 @@ protected KeyStore loadTrustStore(Resource resource) throws Exception\n                 }\n \n                 // Is SNI needed to select a certificate?\n-                if (!_certWilds.isEmpty() || _certHosts.size() > 1 || (_certHosts.size() == 1 && _aliasX509.size() > 1))\n+                boolean sniRequired = (this instanceof Server) && ((Server)this).isSniRequired();\n+                if (sniRequired || !_certWilds.isEmpty() || _certHosts.size() > 1 || (_certHosts.size() == 1 && _aliasX509.size() > 1))", "originalCommit": "426c80bf6de4d7944e3ce669a44294757fa5d95a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTE3NTU2MA==", "url": "https://github.com/eclipse/jetty.project/pull/4790#discussion_r411175560", "bodyText": "@rnd4222 we have done this in Jetty 10, but in 9.4.x there are people still using SslContextFactory (not SslContextFactory.Server).", "author": "sbordet", "createdAt": "2020-04-20T08:04:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc1Nzc4OA=="}], "type": "inlineReview"}]}