{"pr_number": 5028, "pr_title": "Issue #5020 Make servlets,filters,listeners beans again", "pr_createdAt": "2020-07-07T09:35:39Z", "pr_url": "https://github.com/eclipse/jetty.project/pull/5028", "timeline": [{"oid": "e007fd6e493c771206ca96e8805dacb0a2d1a537", "url": "https://github.com/eclipse/jetty.project/commit/e007fd6e493c771206ca96e8805dacb0a2d1a537", "message": "Issue #5020 Make servlets,filters,listeners beans again\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-07-07T08:39:25Z", "type": "commit"}, {"oid": "3a5db40fb71d31f7894d8685734d1db41ff880ca", "url": "https://github.com/eclipse/jetty.project/commit/3a5db40fb71d31f7894d8685734d1db41ff880ca", "message": "Issue #5020 Add a test and fixes.\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-07-07T12:04:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3MTAxOQ==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r450971019", "bodyText": "Why are we dumping this new Object() created on the fly?\nAt least it deserves a comment.", "author": "sbordet", "createdAt": "2020-07-07T15:55:17Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/Dumpable.java", "diffHunk": "@@ -155,41 +156,51 @@ static void dumpObjects(Appendable out, String indent, Object object, Object...\n \n         if (object instanceof Container)\n         {\n-            dumpContainer(out, indent, (Container)object, extras == 0);\n+            dumpContainer(out, indent, (Container)object, list);\n         }\n         if (object instanceof Iterable)\n         {\n-            dumpIterable(out, indent, (Iterable<?>)object, extras == 0);\n+            dumpIterable(out, indent, (Iterable<?>)object, list);\n         }\n         else if (object instanceof Map)\n         {\n-            dumpMapEntries(out, indent, (Map<?, ?>)object, extras == 0);\n+            dumpMapEntries(out, indent, (Map<?, ?>)object, list);\n         }\n \n-        if (extras == 0)\n+        if (list.size() == 0)\n             return;\n \n         int i = 0;\n         for (Object item : extraChildren)\n         {\n             i++;\n-            String nextIndent = indent + (i < extras ? \"|  \" : \"   \");\n+            String nextIndent = indent + (i < list.size() ? \"|  \" : \"   \");\n             out.append(indent).append(\"+> \");\n             if (item instanceof Dumpable)\n                 ((Dumpable)item).dump(out, nextIndent);\n             else\n                 dumpObjects(out, nextIndent, item);\n         }\n     }\n-\n+    \n+    @Deprecated\n     static void dumpContainer(Appendable out, String indent, Container object, boolean last) throws IOException\n+    {\n+        dumpContainer(out, indent, object, (last ? Collections.emptyList() : Collections.singletonList(new Object())));", "originalCommit": "3a5db40fb71d31f7894d8685734d1db41ff880ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMyMDYxMA==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451320610", "bodyText": "We are actually not dumping this object at all. If you look at the implementation of dumpContainer, it will skip any bean children of the Container that match any of the objects passed in as the list of extras. In this case, we are passing in either the empty list, or a singleton object as extras, neither of which will ever match anything. I've done this simply to maintain for backwards compatibility the old method signature of dumpContainer(Appendable, String, Container, boolean) - the fact of the matter is that we do not have any code anymore that calls that old method signature, so this (now deprecated) method can be entirely removed in jetty-10.", "author": "janbartel", "createdAt": "2020-07-08T06:52:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3MTAxOQ=="}], "type": "inlineReview"}, {"oid": "e3a4187666b2b7f89f37e2581dca3d154b32720a", "url": "https://github.com/eclipse/jetty.project/commit/e3a4187666b2b7f89f37e2581dca3d154b32720a", "message": "Issue #5020 Reimplement after review\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-07-08T09:08:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4NDA2Nw==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451484067", "bodyText": "OK, This is a actually a much better way to accomplish this.", "author": "joakime", "createdAt": "2020-07-08T11:53:42Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/Dumpable.java", "diffHunk": "@@ -181,14 +181,18 @@ else if (object instanceof Map)\n                 dumpObjects(out, nextIndent, item);\n         }\n     }\n-\n+    \n     static void dumpContainer(Appendable out, String indent, Container object, boolean last) throws IOException\n     {\n         Container container = object;\n         ContainerLifeCycle containerLifeCycle = container instanceof ContainerLifeCycle ? (ContainerLifeCycle)container : null;\n         for (Iterator<Object> i = container.getBeans().iterator(); i.hasNext(); )\n         {\n             Object bean = i.next();\n+\n+            if (container instanceof DumpableContainer && !((DumpableContainer)container).isDumpable(bean))", "originalCommit": "e3a4187666b2b7f89f37e2581dca3d154b32720a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU0NTU5MA==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451545590", "bodyText": "Can dumpContainer be moved to be a static method of DumpableContainer to keep those concepts together?", "author": "gregw", "createdAt": "2020-07-08T13:30:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ4NDA2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTU0MzQxNQ==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r451543415", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (o instanceof Holder || o instanceof BaseHolder || o instanceof FilterMapping || o instanceof ServletMapping)\n          \n          \n            \n                        return false;\n          \n          \n            \n                    return true;\n          \n          \n            \n                    return !(o instanceof Holder || o instanceof BaseHolder || o instanceof FilterMapping || o instanceof ServletMapping);", "author": "gregw", "createdAt": "2020-07-08T13:27:47Z", "path": "jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletHandler.java", "diffHunk": "@@ -133,6 +133,14 @@ public ServletHandler()\n     {\n     }\n \n+    @Override\n+    public boolean isDumpable(Object o)\n+    {\n+        if (o instanceof Holder || o instanceof BaseHolder || o instanceof FilterMapping || o instanceof ServletMapping)\n+            return false;\n+        return true;", "originalCommit": "e3a4187666b2b7f89f37e2581dca3d154b32720a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "572f2a806a9bd195b431bc061e2577f2b0332ede", "url": "https://github.com/eclipse/jetty.project/commit/572f2a806a9bd195b431bc061e2577f2b0332ede", "message": "Update jetty-servlet/src/main/java/org/eclipse/jetty/servlet/ServletHandler.java\n\nCo-authored-by: Greg Wilkins <gregw@webtide.com>", "committedDate": "2020-07-08T20:28:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDgxNw==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452334817", "bodyText": "Empty line!", "author": "sbordet", "createdAt": "2020-07-09T16:16:03Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * ", "originalCommit": "572f2a806a9bd195b431bc061e2577f2b0332ede", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDk3OA==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452334978", "bodyText": "Double space after interface!", "author": "sbordet", "createdAt": "2020-07-09T16:16:20Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable", "originalCommit": "572f2a806a9bd195b431bc061e2577f2b0332ede", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTUxNA==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452335514", "bodyText": "I would move this simple class as an inner class of Dumpable, namely Dumpable.Container.", "author": "sbordet", "createdAt": "2020-07-09T16:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDk3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0NjgwMQ==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452446801", "bodyText": "It can't be called Dumpable.Container because it conflicts in many classes which import both org.eclipse.jetty.util.component.Container and org.eclipse.jetty.util.component.Dumpable, so there would be a lot of places where currently parameters, variables and fields would have to be fully qualified to org.eclipse.jetty.util.component.Container. So I settled on Dumpable.DumpableContainer.", "author": "janbartel", "createdAt": "2020-07-09T19:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNDk3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTA0Mg==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452335042", "bodyText": "Empty line!", "author": "sbordet", "createdAt": "2020-07-09T16:16:26Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable\n+{\n+", "originalCommit": "572f2a806a9bd195b431bc061e2577f2b0332ede", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzNTEwNA==", "url": "https://github.com/eclipse/jetty.project/pull/5028#discussion_r452335104", "bodyText": "Empty line!", "author": "sbordet", "createdAt": "2020-07-09T16:16:32Z", "path": "jetty-util/src/main/java/org/eclipse/jetty/util/component/DumpableContainer.java", "diffHunk": "@@ -0,0 +1,36 @@\n+//\n+//  ========================================================================\n+//  Copyright (c) 1995-2020 Mort Bay Consulting Pty Ltd and others.\n+//  ------------------------------------------------------------------------\n+//  All rights reserved. This program and the accompanying materials\n+//  are made available under the terms of the Eclipse Public License v1.0\n+//  and Apache License v2.0 which accompanies this distribution.\n+//\n+//      The Eclipse Public License is available at\n+//      http://www.eclipse.org/legal/epl-v10.html\n+//\n+//      The Apache License v2.0 is available at\n+//      http://www.opensource.org/licenses/apache2.0.php\n+//\n+//  You may elect to redistribute this code under either of these licenses.\n+//  ========================================================================\n+//\n+\n+package org.eclipse.jetty.util.component;\n+\n+/**\n+ * DumpableContainer\n+ * \n+ * A Dumpable that is a container of beans can implement this\n+ * interface to allow it to refine which of its beans can be\n+ * \n+ */\n+public interface  DumpableContainer extends Dumpable\n+{\n+\n+    default boolean isDumpable(Object o)\n+    {\n+        return true;\n+    }\n+", "originalCommit": "572f2a806a9bd195b431bc061e2577f2b0332ede", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e096ffb5972abeb52d21b758f2211d7a62bee2be", "url": "https://github.com/eclipse/jetty.project/commit/e096ffb5972abeb52d21b758f2211d7a62bee2be", "message": "Issue #5020 Make DumpableContainer a subclass of Dumpable\n\nSigned-off-by: Jan Bartel <janb@webtide.com>", "committedDate": "2020-07-09T19:35:55Z", "type": "commit"}]}