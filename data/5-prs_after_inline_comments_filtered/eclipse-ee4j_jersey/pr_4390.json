{"pr_number": 4390, "pr_title": "Fix #3433 - Multiple cookies with same name are not supported", "pr_createdAt": "2020-02-07T14:23:34Z", "pr_url": "https://github.com/eclipse-ee4j/jersey/pull/4390", "timeline": [{"oid": "743c3fa2c510c87caf26493669606c3266f081ce", "url": "https://github.com/eclipse-ee4j/jersey/commit/743c3fa2c510c87caf26493669606c3266f081ce", "message": "Fix 3433 - Multiple cookies with same name are not supported\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-02-07T14:12:56Z", "type": "commit"}, {"oid": "392a1c0ecc84f9f619b1f18211b0e45f5353a073", "url": "https://github.com/eclipse-ee4j/jersey/commit/392a1c0ecc84f9f619b1f18211b0e45f5353a073", "message": "Fix 3433 - Check style fix\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-02-07T14:49:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM1MjYwNQ==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4390#discussion_r378352605", "bodyText": "Please use Calendar or LocalDateTime to set the dates you want, to prevent parsing exception with foreign locales", "author": "jansupol", "createdAt": "2020-02-12T16:09:57Z", "path": "tests/e2e-core-common/src/test/java/org/glassfish/jersey/tests/e2e/common/message/internal/HeaderUtilsTest.java", "diffHunk": "@@ -180,4 +184,97 @@ public void testAsHeaderString() throws Exception {\n         final String result = HeaderUtils.asHeaderString(values, null);\n         assertEquals(\"value,[null],\" + uri.toASCIIString(), result);\n     }\n+\n+    @Test\n+    public void testgetPreferedNewCookie(){\n+\n+        Date earliestDate;\n+        Date latestDate;\n+\n+        try {\n+            earliestDate = HttpDateFormat.readDate(\"Fri, 1 Jan 2020 00:00:00 GMT\");", "originalCommit": "392a1c0ecc84f9f619b1f18211b0e45f5353a073", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5NDg5Ng==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4390#discussion_r378694896", "bodyText": "expiry date can be NULL. Isn't it better to use maxAge value?", "author": "senivam", "createdAt": "2020-02-13T07:43:35Z", "path": "core-common/src/main/java/org/glassfish/jersey/message/internal/HeaderUtils.java", "diffHunk": "@@ -298,6 +299,24 @@ public static void checkHeaderChanges(final Map<String, String> headersSnapshot,\n         }\n     }\n \n+    /**\n+     * Compare two NewCookies having the same name. See documentation RFC.\n+     *\n+     * @param one    NewCookie to be compared.\n+     * @param second NewCookie to be compared.\n+     * @return the prefered NewCookie according to rules :\n+     *              - the latest expiration date.\n+     *              - if same expiration date, the longest path.\n+     */\n+    public static NewCookie getPreferedNewCookie(NewCookie one, NewCookie second) {\n+\n+        if (!one.getExpiry().equals(second.getExpiry())){", "originalCommit": "392a1c0ecc84f9f619b1f18211b0e45f5353a073", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODc3NDUwNA==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4390#discussion_r378774504", "bodyText": "There is a difference between expiry and maxAge.\nIE does not support maxAge, so most of the servers set expiry rather than maxAge. It is possible to set one or the other.\nNewCookie is what comes from the server, and even though maxAge is recommended, expires seems to be more often. But it seems to be one or the other, so we should compare the later from both.\nBut yes, we should check for NULL, too.", "author": "jansupol", "createdAt": "2020-02-13T10:29:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5NDg5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODc5MTcwMw==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4390#discussion_r378791703", "bodyText": "Well ,regarding check of expiry VS max-age it's good to check them both :)\nRegarding setting one or another attribute in request - actually server shall put both. For now I've found that the only browser which does not support max-age attribute is IE.\nPer RFC 6265 max-age attribute has precedence over expiry attribute if both are present in request. In my opinion this shall be respected while choosing preferred cookie.", "author": "senivam", "createdAt": "2020-02-13T11:01:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5NDg5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY5NTMxNA==", "url": "https://github.com/eclipse-ee4j/jersey/pull/4390#discussion_r378695314", "bodyText": "Preferred ? may be rename the whole method to getPreferredCookie?", "author": "senivam", "createdAt": "2020-02-13T07:44:50Z", "path": "core-common/src/main/java/org/glassfish/jersey/message/internal/HeaderUtils.java", "diffHunk": "@@ -298,6 +299,24 @@ public static void checkHeaderChanges(final Map<String, String> headersSnapshot,\n         }\n     }\n \n+    /**\n+     * Compare two NewCookies having the same name. See documentation RFC.\n+     *\n+     * @param one    NewCookie to be compared.\n+     * @param second NewCookie to be compared.\n+     * @return the prefered NewCookie according to rules :\n+     *              - the latest expiration date.\n+     *              - if same expiration date, the longest path.\n+     */\n+    public static NewCookie getPreferedNewCookie(NewCookie one, NewCookie second) {", "originalCommit": "392a1c0ecc84f9f619b1f18211b0e45f5353a073", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f54fe96853ac168a12c5ca005da25b8bfb96aa98", "url": "https://github.com/eclipse-ee4j/jersey/commit/f54fe96853ac168a12c5ca005da25b8bfb96aa98", "message": "Fix #3433 - Use maxAge instead of Date + method renaming\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-02-13T09:58:46Z", "type": "commit"}, {"oid": "a64354a1fa5fce19e3aaf612a7f5c7cb5744098a", "url": "https://github.com/eclipse-ee4j/jersey/commit/a64354a1fa5fce19e3aaf612a7f5c7cb5744098a", "message": "Fix #3433 - Use calendar for test + comparator for cookie\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-02-14T08:44:35Z", "type": "commit"}, {"oid": "7693649863afee8a1e6824f9e8a45493d2e97cc1", "url": "https://github.com/eclipse-ee4j/jersey/commit/7693649863afee8a1e6824f9e8a45493d2e97cc1", "message": "Fix #3433 - fix compareNullable return value\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-02-14T10:06:23Z", "type": "commit"}, {"oid": "a72ab1f637ad7a51866c7bd6dbe4108ba4db4571", "url": "https://github.com/eclipse-ee4j/jersey/commit/a72ab1f637ad7a51866c7bd6dbe4108ba4db4571", "message": "Fix #3433 - remove compareNullable method + fix calendar test\n\nSigned-off-by: tvallin <thibault.vallin@oracle.com>", "committedDate": "2020-02-17T15:07:20Z", "type": "commit"}]}