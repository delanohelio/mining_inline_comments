{"pr_number": 103, "pr_title": "Query Breakdown: Deletion implemented, version 1 of input parsing complete, loop sketched", "pr_createdAt": "2020-07-15T21:47:04Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103", "timeline": [{"oid": "c9aa6c9f2fff85003ec4633162ab47712ad4e59e", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c9aa6c9f2fff85003ec4633162ab47712ad4e59e", "message": "first commit, contains parser logic", "committedDate": "2020-07-08T16:38:58Z", "type": "commit"}, {"oid": "85fe85fa5102a5986885e09b4ab95d5f41d6c18c", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/85fe85fa5102a5986885e09b4ab95d5f41d6c18c", "message": "added basic tests for parser", "committedDate": "2020-07-08T20:44:25Z", "type": "commit"}, {"oid": "10474369b9e697c241d48f6bf804cf5cdeb18041", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/10474369b9e697c241d48f6bf804cf5cdeb18041", "message": "first sketch of the entire project", "committedDate": "2020-07-08T22:55:39Z", "type": "commit"}, {"oid": "0a61d902ddff40c9b5dc24f4316051411448f484", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0a61d902ddff40c9b5dc24f4316051411448f484", "message": "input text file can be parsed by the program", "committedDate": "2020-07-09T23:49:55Z", "type": "commit"}, {"oid": "c93fe7fc1bfc1915f819745d303140509fe4892a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c93fe7fc1bfc1915f819745d303140509fe4892a", "message": "added multiple line file test, branch testing", "committedDate": "2020-07-11T00:32:53Z", "type": "commit"}, {"oid": "e4787ccb4ac8c23a3d7cf9f93b78e8c8bfa75a82", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e4787ccb4ac8c23a3d7cf9f93b78e8c8bfa75a82", "message": "input text file can be parsed by the program", "committedDate": "2020-07-13T20:15:32Z", "type": "commit"}, {"oid": "4d33a4abe07012c1588b013f794f664c4d18d47b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4d33a4abe07012c1588b013f794f664c4d18d47b", "message": "added multiple line file test, branch testing", "committedDate": "2020-07-13T20:15:32Z", "type": "commit"}, {"oid": "a22f63db3720a92c408ebf8a38ef55d0bc55361a", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/a22f63db3720a92c408ebf8a38ef55d0bc55361a", "message": "changed visibility and file structure", "committedDate": "2020-07-13T20:15:32Z", "type": "commit"}, {"oid": "215b7a8abfa516021a3cd1a75b8903051b17b748", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/215b7a8abfa516021a3cd1a75b8903051b17b748", "message": "change before merge upstream", "committedDate": "2020-07-13T20:15:32Z", "type": "commit"}, {"oid": "6ebe359574fb02198bf9690e128b97af1ce047e0", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/6ebe359574fb02198bf9690e128b97af1ce047e0", "message": "fixed all merge conflicts", "committedDate": "2020-07-13T20:44:04Z", "type": "commit"}, {"oid": "4a81f257e41c52286a5510768a989a3d1ba29ae6", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4a81f257e41c52286a5510768a989a3d1ba29ae6", "message": "changed package, finished draft of loop function", "committedDate": "2020-07-14T19:11:08Z", "type": "commit"}, {"oid": "570a0365a0db5eaaf8f5e91bf0e2bd1a591556bf", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/570a0365a0db5eaaf8f5e91bf0e2bd1a591556bf", "message": "added additional parser testing, added findnthindex function", "committedDate": "2020-07-15T19:15:24Z", "type": "commit"}, {"oid": "73678eb58283a6203e3d99f8a62925fd77619c2c", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/73678eb58283a6203e3d99f8a62925fd77619c2c", "message": "finished draft of deletion", "committedDate": "2020-07-15T20:08:36Z", "type": "commit"}, {"oid": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "message": "deletion complete", "committedDate": "2020-07-15T21:40:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwOTg1Mw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456609853", "bodyText": "The logic seems wrong here. Seems it should be\nif (args[0] == null) {", "author": "feiling", "createdAt": "2020-07-17T18:34:46Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -1,13 +1,17 @@\n+package com.google.bigquery;\n+\n+import java.io.IOException;\n+\n /**\n  * this file is the main file for the command line tool. The first argument is a txt file\n  * containing the queries. The second argument, which is optional, is a time limit that we\n  * impose on processing a single query. The third argument, which is optional, is a file\n  * that we want to write the results to.\n  */\n-public class QueryBreakdown {\n+public class Main {\n   public static void main(String[] args) {\n     String inputFile = null;\n-    double timeLimit = 0.0;\n+    int errorLimit = 0;\n     String outputFile = null;\n \n     if (args[0] != null) {", "originalCommit": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczNzgxNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456737817", "bodyText": "I think the logic here was that if an argument was provided, the variable would be initialized. I maintained the same logic for my new code--let me know if this is wrong!", "author": "subinbean", "createdAt": "2020-07-18T02:28:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwOTg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxMjI4MA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458512280", "bodyText": "in this case, the code block should be something like this:\nif (args[0] != null) {\n  inputFile = args[0];\n} else {\n  System.out.println(\"You have not specified the input file\");\n  return -1;\n}\nIn the current form, inputFile is not initialized.", "author": "feiling", "createdAt": "2020-07-22T03:28:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwOTg1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgxODYxMA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458818610", "bodyText": "Gotcha, I changed the code in main.java to reflect the CLI interface, so I do believe the current way should resolve this issue. Resolving for now!", "author": "subinbean", "createdAt": "2020-07-22T14:06:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYwOTg1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMDUwMA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456610500", "bodyText": "When this happens, shouldn't you need to throw an exception to stop the execution?", "author": "feiling", "createdAt": "2020-07-17T18:36:06Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -17,19 +21,24 @@ public static void main(String[] args) {\n       System.out.println(\"You have not specified the input file\");", "originalCommit": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMDg0Mw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456610843", "bodyText": "inputFile is not initialized.", "author": "feiling", "createdAt": "2020-07-17T18:36:47Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -17,19 +21,24 @@ public static void main(String[] args) {\n       System.out.println(\"You have not specified the input file\");\n     }\n     if (args[1] != null) {\n-      timeLimit = Double.parseDouble(args[1]);\n+      errorLimit = Integer.parseInt(args[1]);\n     }\n     if (args[2] != null) {\n       outputFile = args[2];\n     }\n \n     // this is where we will put the file I/O logic through the input reader.\n-    String originalQuery = InputReader.readInput(inputFile);\n+    String originalQuery = null;\n+    try {\n+      originalQuery = InputReader.readInput(inputFile);", "originalCommit": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMTc5Ng==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456611796", "bodyText": "The code can be simplified by calling readAllLines.", "author": "feiling", "createdAt": "2020-07-17T18:38:49Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/InputReader.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.google.bigquery;\n+\n+import java.io.BufferedReader;\n+import java.io.FileNotFoundException;\n+import java.io.FileReader;\n+import java.io.IOException;\n+\n+/**\n+ * This class will take care of the input handling logic, essentially parsing the input document\n+ * into queries and data-cleaning if needed.\n+ */\n+public class InputReader {\n+\n+  /**\n+   * This method will take in a txt file name, use BufferedReader to parse the input, and return\n+   * all the queries in a string format\n+   */\n+  public static String readInput(String filename) throws IOException {\n+    BufferedReader reader = null;\n+    String currentLine = \"\";\n+    try {\n+      reader = new BufferedReader(new FileReader((filename)));\n+    } catch (FileNotFoundException e) {\n+      System.out.println(\"A file of this name is not found\");\n+    }\n+\n+    StringBuilder sb = new StringBuilder();\n+\n+    while (currentLine != null) {\n+      sb.append(currentLine);\n+      currentLine = reader.readLine();\n+    }\n+\n+    reader.close();\n+\n+    return sb.toString();", "originalCommit": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMzQwMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456613403", "bodyText": "Please create a work item to use a library such as http://commons.apache.org/proper/commons-cli/ to process command line args", "author": "feiling", "createdAt": "2020-07-17T18:42:16Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -17,19 +21,24 @@ public static void main(String[] args) {\n       System.out.println(\"You have not specified the input file\");\n     }\n     if (args[1] != null) {\n-      timeLimit = Double.parseDouble(args[1]);\n+      errorLimit = Integer.parseInt(args[1]);\n     }\n     if (args[2] != null) {\n       outputFile = args[2];\n     }\n ", "originalCommit": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjczNzc1OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456737758", "bodyText": "Addressed in most recent commit :)", "author": "subinbean", "createdAt": "2020-07-18T02:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxMzQwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxNDAzOA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456614038", "bodyText": "Use an enum instead of boolean for errorHandlingType.", "author": "feiling", "createdAt": "2020-07-17T18:43:40Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Node.java", "diffHunk": "@@ -7,22 +9,23 @@\n public class Node {\n \n   // ensures tree structure\n-  ArrayList<Node> children;\n-  Node parent;\n+\n+  private ArrayList<Node> children;\n+  private Node parent;\n \n   // ensures that we know which location the error occurs in\n-  int startLine;\n-  int startColumn;\n-  int endLine;\n-  int endColumn;\n+  private int startLine;\n+  private int startColumn;\n+  private int endLine;\n+  private int endColumn;\n \n   // ensures that we know how the error was handled\n-  boolean errorHandlingType;\n-  String replaceFrom;\n-  String replaceTo;\n+  private boolean errorHandlingType;", "originalCommit": "1bf1dc28c233a1d28404bf27305d5d7e89d7e589", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjcwNzYwNg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r456707606", "bodyText": "Hopefully resolved with the most recent commit!", "author": "subinbean", "createdAt": "2020-07-17T23:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjYxNDAzOA=="}], "type": "inlineReview"}, {"oid": "ababf54486b2ac6a3c8ae601ea13443638f15926", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ababf54486b2ac6a3c8ae601ea13443638f15926", "message": "finished input parsing semicolon separation", "committedDate": "2020-07-17T20:26:00Z", "type": "commit"}, {"oid": "e424e31b13c1572cdc35e215470f785ebff04f6f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e424e31b13c1572cdc35e215470f785ebff04f6f", "message": "enum added", "committedDate": "2020-07-17T21:19:29Z", "type": "commit"}, {"oid": "c7c6dc2f965a5f0017d5ca51cd2c039c2789803d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/c7c6dc2f965a5f0017d5ca51cd2c039c2789803d", "message": "readAllLines used", "committedDate": "2020-07-17T21:31:53Z", "type": "commit"}, {"oid": "e37932466db7a3d5318013b1c0d36ef462200ee2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e37932466db7a3d5318013b1c0d36ef462200ee2", "message": "CLI interface implemented", "committedDate": "2020-07-18T02:24:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI2OTMyMA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458269320", "bodyText": "should we make it a final field?", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:31:14Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/CalciteParser.java", "diffHunk": "@@ -12,10 +14,10 @@\n  * Calcite Parser can be used as a blackbox.\n  */\n public class CalciteParser implements Parser {\n-  SqlParser.Config config;\n+  private SqlParser.Config config;", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NDAwNA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458274004", "bodyText": "Why not first replace and then substring? In this case you end up doing substring, replace and append.", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:39:09Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/InputReader.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.google.bigquery;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.List;\n+\n+/**\n+ * This class will take care of the input handling logic, essentially parsing the input document\n+ * into queries and data-cleaning if needed.\n+ */\n+public class InputReader {\n+\n+  /**\n+   * This method will take in a txt file name, use BufferedReader to parse the input, and return\n+   * all the queries in a string format\n+   */\n+  public static String readInput(String filename) throws IOException {\n+    List<String> lines = Files.readAllLines(Paths.get(filename));\n+\n+    StringBuilder sb = new StringBuilder();\n+    for (String line : lines) {\n+      sb.append(line);\n+    }\n+\n+    String parsedInput = sb.toString();\n+    int len = parsedInput.length();\n+    boolean lastSemicolon = false;\n+\n+    // deals with case where last query ends with a semicolon\n+    if (parsedInput.charAt(len - 1) == ';') {", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg0OTQ5NQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458849495", "bodyText": "fixed accordingly!", "author": "subinbean", "createdAt": "2020-07-22T14:47:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NDAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NjQ4MA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458276480", "bodyText": "private?", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:43:01Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import org.apache.calcite.sql.parser.SqlParseException;\n+import org.apache.calcite.sql.parser.SqlParserPos;\n+\n+/**\n+ * This class is where the main logic lives for the algorithm that this tool utilizes. It will\n+ * also be in charge of outputting the results.\n+ */\n+public class QueryBreakdown {\n+\n+  // global fields that keeps track of the minimum unparseable component so far\n+  private int minimumUnparseableComp = Integer.MAX_VALUE;\n+  private Node solution;\n+\n+  // the generated tree\n+  private Node root;\n+  private static Parser parser;\n+\n+  /**\n+   * This is the method that will run QueryBreakdown given an original query and output\n+   * it to the specified output file, or if that is null, generate a new file to put the output in.\n+   * The provided timeLimit will stop the tool from running over a certain time.\n+   */\n+  public static void run(String originalQuery, String outputFile, int errorLimit) {\n+\n+    // determines which parser to use\n+    parser = new CalciteParser();\n+\n+    // uses the loop function to generate and traverse the tree of possible error recoveries\n+    loop(originalQuery, errorLimit);\n+\n+    // write termination logic for output (tracing the node back, reconstructing path, output)\n+    return;\n+  }\n+\n+  /**\n+   * This is where the code for the algorithm will go: essentially, there will be a loop that\n+   * constantly inputs a new query after adequate error handling\n+   */\n+  private static void loop(String inputQuery, int errorLimit) {\n+    try {\n+      parser.parseQuery(inputQuery);\n+    } catch (Exception e) {\n+      // generates new queries through deletion and replacement\n+      SqlParserPos pos = ((SqlParseException) e).getPos();\n+      String deletionQuery = deletion(inputQuery, pos.getLineNum(), pos.getColumnNum(),\n+          pos.getEndColumnNum());\n+      List<String> replacementQueries = replacement(inputQuery, pos.getLineNum(),\n+          pos.getColumnNum(), pos.getEndColumnNum(),\n+          ((SqlParseException) e).getExpectedTokenNames());\n+\n+      // recursively loops through the new queries\n+      loop(deletionQuery, errorLimit);\n+      for (String s: replacementQueries) {\n+        loop(s, errorLimit);\n+      }\n+    }\n+    // termination condition: if the parsing doesn't throw exceptions, then the leaf is reached\n+    return;\n+  }\n+\n+  /**\n+   * This method implements the deletion mechanism: given the position of the component, it\n+   * generates a new query with that component deleted.\n+   */\n+  static String deletion(String inputQuery, int startLine, int startColumn,", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg1NTg4OQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458855889", "bodyText": "left as package private for now as sort of a \"test hook.\" Will address privacy settings later.", "author": "subinbean", "createdAt": "2020-07-22T14:55:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NjQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2MjM1OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r459062358", "bodyText": "can you please add a comment in the code explaining the justification of extended visibility of the function?", "author": "AayushBhatnagar", "createdAt": "2020-07-22T20:26:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NjQ4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MTM3Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r459081372", "bodyText": "yup, it's more of a comment that's applicable for the entire class so just added a comment above the entire thing", "author": "subinbean", "createdAt": "2020-07-22T21:02:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NjQ4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3Njg5NA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458276894", "bodyText": "If all methods are static, then why these fields are not static?", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:43:41Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import org.apache.calcite.sql.parser.SqlParseException;\n+import org.apache.calcite.sql.parser.SqlParserPos;\n+\n+/**\n+ * This class is where the main logic lives for the algorithm that this tool utilizes. It will\n+ * also be in charge of outputting the results.\n+ */\n+public class QueryBreakdown {\n+\n+  // global fields that keeps track of the minimum unparseable component so far\n+  private int minimumUnparseableComp = Integer.MAX_VALUE;", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NzM1Ng==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458277356", "bodyText": "no need for this statement.", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:44:26Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import org.apache.calcite.sql.parser.SqlParseException;\n+import org.apache.calcite.sql.parser.SqlParserPos;\n+\n+/**\n+ * This class is where the main logic lives for the algorithm that this tool utilizes. It will\n+ * also be in charge of outputting the results.\n+ */\n+public class QueryBreakdown {\n+\n+  // global fields that keeps track of the minimum unparseable component so far\n+  private int minimumUnparseableComp = Integer.MAX_VALUE;\n+  private Node solution;\n+\n+  // the generated tree\n+  private Node root;\n+  private static Parser parser;\n+\n+  /**\n+   * This is the method that will run QueryBreakdown given an original query and output\n+   * it to the specified output file, or if that is null, generate a new file to put the output in.\n+   * The provided timeLimit will stop the tool from running over a certain time.\n+   */\n+  public static void run(String originalQuery, String outputFile, int errorLimit) {\n+\n+    // determines which parser to use\n+    parser = new CalciteParser();\n+\n+    // uses the loop function to generate and traverse the tree of possible error recoveries\n+    loop(originalQuery, errorLimit);\n+\n+    // write termination logic for output (tracing the node back, reconstructing path, output)\n+    return;", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA2MTY4OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r459061688", "bodyText": "I can still see this return statement. can you please remove it first?", "author": "AayushBhatnagar", "createdAt": "2020-07-22T20:25:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NzM1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA4MTE4MA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r459081180", "bodyText": "yikes, my bad--should be removed now", "author": "subinbean", "createdAt": "2020-07-22T21:02:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3NzM1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3Nzc5Ng==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458277796", "bodyText": "is there a cast failure possibility?", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:45:04Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import org.apache.calcite.sql.parser.SqlParseException;\n+import org.apache.calcite.sql.parser.SqlParserPos;\n+\n+/**\n+ * This class is where the main logic lives for the algorithm that this tool utilizes. It will\n+ * also be in charge of outputting the results.\n+ */\n+public class QueryBreakdown {\n+\n+  // global fields that keeps track of the minimum unparseable component so far\n+  private int minimumUnparseableComp = Integer.MAX_VALUE;\n+  private Node solution;\n+\n+  // the generated tree\n+  private Node root;\n+  private static Parser parser;\n+\n+  /**\n+   * This is the method that will run QueryBreakdown given an original query and output\n+   * it to the specified output file, or if that is null, generate a new file to put the output in.\n+   * The provided timeLimit will stop the tool from running over a certain time.\n+   */\n+  public static void run(String originalQuery, String outputFile, int errorLimit) {\n+\n+    // determines which parser to use\n+    parser = new CalciteParser();\n+\n+    // uses the loop function to generate and traverse the tree of possible error recoveries\n+    loop(originalQuery, errorLimit);\n+\n+    // write termination logic for output (tracing the node back, reconstructing path, output)\n+    return;\n+  }\n+\n+  /**\n+   * This is where the code for the algorithm will go: essentially, there will be a loop that\n+   * constantly inputs a new query after adequate error handling\n+   */\n+  private static void loop(String inputQuery, int errorLimit) {\n+    try {\n+      parser.parseQuery(inputQuery);\n+    } catch (Exception e) {\n+      // generates new queries through deletion and replacement\n+      SqlParserPos pos = ((SqlParseException) e).getPos();", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2ODk1OQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458868959", "bodyText": "An issue is that the exception can catch other unwanted exceptions: design will be changed in the future by creating an exception superclass", "author": "subinbean", "createdAt": "2020-07-22T15:13:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3Nzc5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3ODgxMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458278813", "bodyText": "no need for this statement.", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:46:44Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import org.apache.calcite.sql.parser.SqlParseException;\n+import org.apache.calcite.sql.parser.SqlParserPos;\n+\n+/**\n+ * This class is where the main logic lives for the algorithm that this tool utilizes. It will\n+ * also be in charge of outputting the results.\n+ */\n+public class QueryBreakdown {\n+\n+  // global fields that keeps track of the minimum unparseable component so far\n+  private int minimumUnparseableComp = Integer.MAX_VALUE;\n+  private Node solution;\n+\n+  // the generated tree\n+  private Node root;\n+  private static Parser parser;\n+\n+  /**\n+   * This is the method that will run QueryBreakdown given an original query and output\n+   * it to the specified output file, or if that is null, generate a new file to put the output in.\n+   * The provided timeLimit will stop the tool from running over a certain time.\n+   */\n+  public static void run(String originalQuery, String outputFile, int errorLimit) {\n+\n+    // determines which parser to use\n+    parser = new CalciteParser();\n+\n+    // uses the loop function to generate and traverse the tree of possible error recoveries\n+    loop(originalQuery, errorLimit);\n+\n+    // write termination logic for output (tracing the node back, reconstructing path, output)\n+    return;\n+  }\n+\n+  /**\n+   * This is where the code for the algorithm will go: essentially, there will be a loop that\n+   * constantly inputs a new query after adequate error handling\n+   */\n+  private static void loop(String inputQuery, int errorLimit) {\n+    try {\n+      parser.parseQuery(inputQuery);\n+    } catch (Exception e) {\n+      // generates new queries through deletion and replacement\n+      SqlParserPos pos = ((SqlParseException) e).getPos();\n+      String deletionQuery = deletion(inputQuery, pos.getLineNum(), pos.getColumnNum(),\n+          pos.getEndColumnNum());\n+      List<String> replacementQueries = replacement(inputQuery, pos.getLineNum(),\n+          pos.getColumnNum(), pos.getEndColumnNum(),\n+          ((SqlParseException) e).getExpectedTokenNames());\n+\n+      // recursively loops through the new queries\n+      loop(deletionQuery, errorLimit);\n+      for (String s: replacementQueries) {\n+        loop(s, errorLimit);\n+      }\n+    }\n+    // termination condition: if the parsing doesn't throw exceptions, then the leaf is reached\n+    return;", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI3OTIyNg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458279226", "bodyText": "Whats the use of errorLimit variable?", "author": "AayushBhatnagar", "createdAt": "2020-07-21T17:47:18Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/QueryBreakdown.java", "diffHunk": "@@ -0,0 +1,128 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+import org.apache.calcite.sql.parser.SqlParseException;\n+import org.apache.calcite.sql.parser.SqlParserPos;\n+\n+/**\n+ * This class is where the main logic lives for the algorithm that this tool utilizes. It will\n+ * also be in charge of outputting the results.\n+ */\n+public class QueryBreakdown {\n+\n+  // global fields that keeps track of the minimum unparseable component so far\n+  private int minimumUnparseableComp = Integer.MAX_VALUE;\n+  private Node solution;\n+\n+  // the generated tree\n+  private Node root;\n+  private static Parser parser;\n+\n+  /**\n+   * This is the method that will run QueryBreakdown given an original query and output\n+   * it to the specified output file, or if that is null, generate a new file to put the output in.\n+   * The provided timeLimit will stop the tool from running over a certain time.\n+   */\n+  public static void run(String originalQuery, String outputFile, int errorLimit) {\n+\n+    // determines which parser to use\n+    parser = new CalciteParser();\n+\n+    // uses the loop function to generate and traverse the tree of possible error recoveries\n+    loop(originalQuery, errorLimit);\n+\n+    // write termination logic for output (tracing the node back, reconstructing path, output)\n+    return;\n+  }\n+\n+  /**\n+   * This is where the code for the algorithm will go: essentially, there will be a loop that\n+   * constantly inputs a new query after adequate error handling\n+   */\n+  private static void loop(String inputQuery, int errorLimit) {", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68f568c053c40d313ae818f79b355283eadd99ec", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/68f568c053c40d313ae818f79b355283eadd99ec", "message": "simplifed inputreader logic", "committedDate": "2020-07-21T18:26:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNDExNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458514117", "bodyText": "Please add a //TODO comment that a more robust way to break the input into statements will be implemented in the future. The current code probably works for simple cases, but it doesn't handle comments, or semicolon in strings for example.", "author": "feiling", "createdAt": "2020-07-22T03:35:51Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/InputReader.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package com.google.bigquery;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.List;\n+\n+/**\n+ * This class will take care of the input handling logic, essentially parsing the input document\n+ * into queries and data-cleaning if needed.\n+ */\n+public class InputReader {\n+\n+  /**\n+   * This method will take in a txt file name, use BufferedReader to parse the input, and return\n+   * all the queries in a string format\n+   */\n+  public static String readInput(String filename) throws IOException {\n+    List<String> lines = Files.readAllLines(Paths.get(filename));\n+\n+    StringBuilder sb = new StringBuilder();\n+    for (String line : lines) {\n+      sb.append(line);\n+    }\n+\n+    String parsedInput = sb.toString();\n+    int len = parsedInput.length();\n+    boolean lastSemicolon = false;\n+\n+    // deals with case where last query ends with a semicolon\n+    if (parsedInput.charAt(len - 1) == ';') {\n+      parsedInput = parsedInput.substring(0, len - 1);\n+      lastSemicolon = true;\n+    }\n+\n+    parsedInput = parsedInput.replaceAll(\";\", \";\\n\");\n+    if (lastSemicolon) {\n+      parsedInput = parsedInput + ';';\n+    }\n+", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNDMzOQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458514339", "bodyText": "Please add comment describes what command line flags are supported. Also, add some sample usages.", "author": "feiling", "createdAt": "2020-07-22T03:36:55Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.google.bigquery;\n+\n+import org.apache.commons.cli.*;\n+\n+import java.io.IOException;\n+import java.util.Comparator;\n+\n+/**\n+ * this file is the main file for the command line tool. The first argument is a txt file\n+ * containing the queries. The second argument, which is optional, is a time limit that we\n+ * impose on processing a single query. The third argument, which is optional, is a file\n+ * that we want to write the results to.\n+ */", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNDgwNA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458514804", "bodyText": "What's the purpose of having this comparator?", "author": "feiling", "createdAt": "2020-07-22T03:39:03Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.google.bigquery;\n+\n+import org.apache.commons.cli.*;\n+\n+import java.io.IOException;\n+import java.util.Comparator;\n+\n+/**\n+ * this file is the main file for the command line tool. The first argument is a txt file\n+ * containing the queries. The second argument, which is optional, is a time limit that we\n+ * impose on processing a single query. The third argument, which is optional, is a file\n+ * that we want to write the results to.\n+ */\n+public class Main {\n+  public static void main(String[] args) {\n+    String inputFile = null;\n+    int errorLimit = 0;\n+    String outputFile = null;\n+    CommandLine cl = createCommand(args);\n+\n+    // if there is an error in parsing the commandline\n+    if (cl == null) {\n+      System.exit(1);\n+    }\n+\n+    if (cl.hasOption(\"r\")) {\n+      inputFile = cl.getOptionValue(\"r\");\n+    }\n+    if (cl.hasOption(\"w\")) {\n+      outputFile = cl.getOptionValue(\"w\");\n+    }\n+    if (cl.hasOption(\"l\")) {\n+      errorLimit = Integer.parseInt( cl.getOptionValue(\"l\"));\n+    }\n+\n+    // this is where we will put the file I/O logic through the input reader.\n+    String originalQuery = null;\n+    try {\n+      originalQuery = InputReader.readInput(inputFile);\n+    } catch (IOException e) {\n+      System.out.println(\"there was an I/O error while reading the input\");\n+    }\n+\n+    /* this is where we feed in the original query to the UnparseableDetector, which will find\n+       all the unparseable components of the query and output them into the output file if\n+       specified. Otherwise, it will be autogenerated.\n+     */\n+    QueryBreakdown.run(originalQuery, outputFile, errorLimit);\n+  }\n+\n+  /**\n+   * This is the method that instantiates a CommandLine object for the Apache CLI Interface. It deals with\n+   * command line parsing as well as help generation once parsing is unavailable\n+   */\n+  public static CommandLine createCommand(String[] args) {\n+    CommandLineParser parser = new DefaultParser();\n+    Options options = createOptions();\n+    HelpFormatter help = new HelpFormatter();\n+\n+    help.setOptionComparator(new Comparator<Option>() {\n+      public int compare(Option option1, Option option2) {", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODgzMDQ0Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458830442", "bodyText": "The purpose of the comparator is to just order the commands in the order I want it, since the default is alphabetical.\nBefore: -r -l -w\nAfter: -r -w -l", "author": "subinbean", "createdAt": "2020-07-22T14:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNDgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNTE2OA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458515168", "bodyText": "I think \"i\" and \"inputFile\" is a better name for this flag.", "author": "feiling", "createdAt": "2020-07-22T03:40:23Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.google.bigquery;\n+\n+import org.apache.commons.cli.*;\n+\n+import java.io.IOException;\n+import java.util.Comparator;\n+\n+/**\n+ * this file is the main file for the command line tool. The first argument is a txt file\n+ * containing the queries. The second argument, which is optional, is a time limit that we\n+ * impose on processing a single query. The third argument, which is optional, is a file\n+ * that we want to write the results to.\n+ */\n+public class Main {\n+  public static void main(String[] args) {\n+    String inputFile = null;\n+    int errorLimit = 0;\n+    String outputFile = null;\n+    CommandLine cl = createCommand(args);\n+\n+    // if there is an error in parsing the commandline\n+    if (cl == null) {\n+      System.exit(1);\n+    }\n+\n+    if (cl.hasOption(\"r\")) {\n+      inputFile = cl.getOptionValue(\"r\");\n+    }\n+    if (cl.hasOption(\"w\")) {\n+      outputFile = cl.getOptionValue(\"w\");\n+    }\n+    if (cl.hasOption(\"l\")) {\n+      errorLimit = Integer.parseInt( cl.getOptionValue(\"l\"));\n+    }\n+\n+    // this is where we will put the file I/O logic through the input reader.\n+    String originalQuery = null;\n+    try {\n+      originalQuery = InputReader.readInput(inputFile);\n+    } catch (IOException e) {\n+      System.out.println(\"there was an I/O error while reading the input\");\n+    }\n+\n+    /* this is where we feed in the original query to the UnparseableDetector, which will find\n+       all the unparseable components of the query and output them into the output file if\n+       specified. Otherwise, it will be autogenerated.\n+     */\n+    QueryBreakdown.run(originalQuery, outputFile, errorLimit);\n+  }\n+\n+  /**\n+   * This is the method that instantiates a CommandLine object for the Apache CLI Interface. It deals with\n+   * command line parsing as well as help generation once parsing is unavailable\n+   */\n+  public static CommandLine createCommand(String[] args) {\n+    CommandLineParser parser = new DefaultParser();\n+    Options options = createOptions();\n+    HelpFormatter help = new HelpFormatter();\n+\n+    help.setOptionComparator(new Comparator<Option>() {\n+      public int compare(Option option1, Option option2) {\n+        if (option1.isRequired() != option2.isRequired()) {\n+          return option1.isRequired() ? -1 : 1;\n+        }\n+        else {\n+          return (option1.getLongOpt().equals(\"write\")) ? -1 : 1;\n+        }\n+      }\n+    });\n+\n+    CommandLine cl = null;\n+    try {\n+      cl = parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(\"there was an issue parsing the commandline\" + e.getMessage());\n+      help.printHelp(\"query_breakdown\", options, true);\n+    }\n+\n+    return cl;\n+  }\n+\n+  /**\n+   * This is the method that instantiates options for the Apache CLI interface\n+   */\n+  public static Options createOptions() {\n+    Options options = new Options();\n+    options.addOption(Option.builder(\"r\").required(true).longOpt(\"read\").hasArg(true).argName(\"PATH\")", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUxNTIzNQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/103#discussion_r458515235", "bodyText": "Use \"o\" and \"outputFile\" for this flag.", "author": "feiling", "createdAt": "2020-07-22T03:40:42Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/Main.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.google.bigquery;\n+\n+import org.apache.commons.cli.*;\n+\n+import java.io.IOException;\n+import java.util.Comparator;\n+\n+/**\n+ * this file is the main file for the command line tool. The first argument is a txt file\n+ * containing the queries. The second argument, which is optional, is a time limit that we\n+ * impose on processing a single query. The third argument, which is optional, is a file\n+ * that we want to write the results to.\n+ */\n+public class Main {\n+  public static void main(String[] args) {\n+    String inputFile = null;\n+    int errorLimit = 0;\n+    String outputFile = null;\n+    CommandLine cl = createCommand(args);\n+\n+    // if there is an error in parsing the commandline\n+    if (cl == null) {\n+      System.exit(1);\n+    }\n+\n+    if (cl.hasOption(\"r\")) {\n+      inputFile = cl.getOptionValue(\"r\");\n+    }\n+    if (cl.hasOption(\"w\")) {\n+      outputFile = cl.getOptionValue(\"w\");\n+    }\n+    if (cl.hasOption(\"l\")) {\n+      errorLimit = Integer.parseInt( cl.getOptionValue(\"l\"));\n+    }\n+\n+    // this is where we will put the file I/O logic through the input reader.\n+    String originalQuery = null;\n+    try {\n+      originalQuery = InputReader.readInput(inputFile);\n+    } catch (IOException e) {\n+      System.out.println(\"there was an I/O error while reading the input\");\n+    }\n+\n+    /* this is where we feed in the original query to the UnparseableDetector, which will find\n+       all the unparseable components of the query and output them into the output file if\n+       specified. Otherwise, it will be autogenerated.\n+     */\n+    QueryBreakdown.run(originalQuery, outputFile, errorLimit);\n+  }\n+\n+  /**\n+   * This is the method that instantiates a CommandLine object for the Apache CLI Interface. It deals with\n+   * command line parsing as well as help generation once parsing is unavailable\n+   */\n+  public static CommandLine createCommand(String[] args) {\n+    CommandLineParser parser = new DefaultParser();\n+    Options options = createOptions();\n+    HelpFormatter help = new HelpFormatter();\n+\n+    help.setOptionComparator(new Comparator<Option>() {\n+      public int compare(Option option1, Option option2) {\n+        if (option1.isRequired() != option2.isRequired()) {\n+          return option1.isRequired() ? -1 : 1;\n+        }\n+        else {\n+          return (option1.getLongOpt().equals(\"write\")) ? -1 : 1;\n+        }\n+      }\n+    });\n+\n+    CommandLine cl = null;\n+    try {\n+      cl = parser.parse(options, args);\n+    } catch (ParseException e) {\n+      System.out.println(\"there was an issue parsing the commandline\" + e.getMessage());\n+      help.printHelp(\"query_breakdown\", options, true);\n+    }\n+\n+    return cl;\n+  }\n+\n+  /**\n+   * This is the method that instantiates options for the Apache CLI interface\n+   */\n+  public static Options createOptions() {\n+    Options options = new Options();\n+    options.addOption(Option.builder(\"r\").required(true).longOpt(\"read\").hasArg(true).argName(\"PATH\")\n+            .desc(\"this is the file containing queries to be inputted into the tool\").build());\n+    options.addOption(Option.builder(\"w\").longOpt(\"write\").hasArg(true).argName(\"PATH\")", "originalCommit": "e37932466db7a3d5318013b1c0d36ef462200ee2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b59ce143a1d5dc28ca290fd62fa6a1861ee3f16d", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/b59ce143a1d5dc28ca290fd62fa6a1861ee3f16d", "message": "PR comments addressed", "committedDate": "2020-07-22T14:38:32Z", "type": "commit"}, {"oid": "16f25ccd5991d63398e8d04a48e5fb135ee18a74", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/16f25ccd5991d63398e8d04a48e5fb135ee18a74", "message": "PR comments addressed 2 - minor changes added", "committedDate": "2020-07-22T15:15:04Z", "type": "commit"}, {"oid": "96618d8fef9384523d07c2b2487a8688bc61b154", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/96618d8fef9384523d07c2b2487a8688bc61b154", "message": "return removed, comment added", "committedDate": "2020-07-22T21:01:39Z", "type": "commit"}, {"oid": "01d16331bc2559e6620823f4f3c0ef9d2b3c161f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/01d16331bc2559e6620823f4f3c0ef9d2b3c161f", "message": "Merge branch 'master' into milestone1_2", "committedDate": "2020-07-24T15:55:24Z", "type": "commit"}]}