{"pr_number": 123, "pr_title": "Query_Breakdown: Program now executable and works correctly with deletion & correct error tracking ", "pr_createdAt": "2020-07-29T23:43:30Z", "pr_url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123", "timeline": [{"oid": "f32b6ddf7784273c4f084bc136c240ac4d8b3154", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/f32b6ddf7784273c4f084bc136c240ac4d8b3154", "message": "replacement and main loop draft done", "committedDate": "2020-07-24T19:08:09Z", "type": "commit"}, {"oid": "7b09301ba1de656c47401c254eb3979049a24773", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/7b09301ba1de656c47401c254eb3979049a24773", "message": "refactored QueryBreakdown, organized code for PR", "committedDate": "2020-07-24T21:47:02Z", "type": "commit"}, {"oid": "28adf1077930405db08f5b673d45863f82a0be44", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/28adf1077930405db08f5b673d45863f82a0be44", "message": "deletion is now working with the main loop and run", "committedDate": "2020-07-27T16:09:55Z", "type": "commit"}, {"oid": "d32af029dcc6a72e36b7b39b1b6c5acd9579d1cf", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d32af029dcc6a72e36b7b39b1b6c5acd9579d1cf", "message": "location tracker sketched", "committedDate": "2020-07-28T01:28:25Z", "type": "commit"}, {"oid": "e2c576fa062c058e2de724853ba4720dbf2e87c5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/e2c576fa062c058e2de724853ba4720dbf2e87c5", "message": "new input reader code done", "committedDate": "2020-07-28T15:05:52Z", "type": "commit"}, {"oid": "3065c7a7c0e3236fff89f73d2bda1830c750eb06", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/3065c7a7c0e3236fff89f73d2bda1830c750eb06", "message": "tests added for inputreader", "committedDate": "2020-07-28T17:44:05Z", "type": "commit"}, {"oid": "4827419e31ac8389fcedb6c51bd9bd93aa3c8034", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/4827419e31ac8389fcedb6c51bd9bd93aa3c8034", "message": "all input reader tests pass", "committedDate": "2020-07-28T17:58:53Z", "type": "commit"}, {"oid": "993385a7fa87473796c877e4aeef8c3226f88f1b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/993385a7fa87473796c877e4aeef8c3226f88f1b", "message": "making new location tracker instance each time", "committedDate": "2020-07-28T23:46:53Z", "type": "commit"}, {"oid": "ad2ab0eaf9b859c9f8267fd033bf0541ec4528da", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/ad2ab0eaf9b859c9f8267fd033bf0541ec4528da", "message": "deletion part of location tracker draft done", "committedDate": "2020-07-29T00:32:42Z", "type": "commit"}, {"oid": "dbf0f6e23b5a9c585ba4871ebfb26b7a5f23ef2b", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/dbf0f6e23b5a9c585ba4871ebfb26b7a5f23ef2b", "message": "merge conflicts resolved", "committedDate": "2020-07-29T15:40:08Z", "type": "commit"}, {"oid": "d37cd7b7f0fe35780e2dbc2affec82f9553a2c8f", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/d37cd7b7f0fe35780e2dbc2affec82f9553a2c8f", "message": "deletion refactored to not deal with spaces", "committedDate": "2020-07-29T16:18:51Z", "type": "commit"}, {"oid": "be204995c49008460392880e07b809f4b4ae6d75", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/be204995c49008460392880e07b809f4b4ae6d75", "message": "simpleDeletion test passes, deletion and location tracking integration is completed", "committedDate": "2020-07-29T19:10:42Z", "type": "commit"}, {"oid": "75b4892e8c5f82a9e1187202e5c32358ef720b49", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/75b4892e8c5f82a9e1187202e5c32358ef720b49", "message": "deletion tests all pass", "committedDate": "2020-07-29T22:00:46Z", "type": "commit"}, {"oid": "32cd2aa63b236dea7ae74670bb0045188e15bba2", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/32cd2aa63b236dea7ae74670bb0045188e15bba2", "message": "files and comments cleaned for PR", "committedDate": "2020-07-29T22:22:36Z", "type": "commit"}, {"oid": "de1bf6d4eb9924f18f9c002256af1778e134dbe5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/de1bf6d4eb9924f18f9c002256af1778e134dbe5", "message": "program now executable through maven and cli interface", "committedDate": "2020-07-29T23:14:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEzNTEzMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463135133", "bodyText": "throw UnsupportedOperationExceptions instead of return null.", "author": "feiling", "createdAt": "2020-07-30T16:50:43Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/LocationTracker.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ * This class tracks the original location of components in the query, thereby making sure that\n+ * the error locations are correctly represented.\n+ */\n+public class LocationTracker {\n+  /* we keep a double arraylist to represent the position of each character (line and column).\n+     We can do this as the line number of the component will not change\n+     (deletion and replacement won't change the line numbers)\n+   */\n+  private ArrayList<ArrayList<Integer>> location;\n+\n+  /**\n+   * Constructor for the class\n+   */\n+  public LocationTracker() {\n+    location = new ArrayList<>();\n+  }\n+\n+  /**\n+   * This method interacts with the InputReader and adds a pair to the location field that\n+   * represents the position (x, y) in the original query. x and y are 1-indexed, so we\n+   * adjust accordingly.\n+   */\n+  public void add(int x, int y) {\n+    location.get(x - 1).add(y);\n+  }\n+\n+  /**\n+   * This method adds an empty line to the location field\n+   */\n+  public void addLine() {\n+    location.add(new ArrayList<>());\n+  }\n+\n+  /**\n+   * This method removes an entry from location specified by (x, y) in the original query\n+   */\n+  public void remove(int x, int y) {\n+    if (x > 0 && x <= location.size()) {\n+      if (y > 0 && y <= location.get(x - 1).size()) {\n+        location.get(x - 1).remove(y - 1);\n+      }\n+    }\n+  }\n+\n+  /**\n+   * This method gets the original position of the component in (x,y) of the intermediate query\n+   */\n+  public int getOriginalPosition(int x, int y) {\n+    return location.get(x - 1).get(y - 1);\n+  }\n+\n+  /**\n+   * This method ensures that the location field is kept correctly despite the deletion.\n+   */\n+  public LocationTracker delete(int line, int startColumn, int endColumn) {\n+    LocationTracker lt = cloneTracker();\n+    for (int i = startColumn; i < endColumn + 1; i++) {\n+     lt.remove(line, startColumn);\n+    }\n+    return lt;\n+  }\n+\n+  /**\n+   * To be implemented\n+   */\n+  public LocationTracker replace() {\n+    return null;", "originalCommit": "de1bf6d4eb9924f18f9c002256af1778e134dbe5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEzNjYxNg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463136616", "bodyText": "Just use name locationTracker.", "author": "feiling", "createdAt": "2020-07-30T16:53:13Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/InputReader.java", "diffHunk": "@@ -12,31 +11,62 @@\n  */\n public class InputReader {\n \n+  private LocationTracker lt;", "originalCommit": "de1bf6d4eb9924f18f9c002256af1778e134dbe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1ODc0Nw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463158747", "bodyText": "should I change all the lt's to locationTracker?", "author": "subinbean", "createdAt": "2020-07-30T17:31:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcwMTczOQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463701739", "bodyText": "yes", "author": "feiling", "createdAt": "2020-07-31T16:12:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEzNjYxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzcxMzA5Mg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463713092", "bodyText": "fixed!", "author": "subinbean", "createdAt": "2020-07-31T16:35:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzEzNjYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE0MjExNw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463142117", "bodyText": "It's not clear to me how LocationTracker works. It seems that for each pair of (line, column), location.get(line - 1).get(column-1) will return the location. But I don't understand what the location value represents. It's an integer, so I guess it mean the index in the input string?", "author": "feiling", "createdAt": "2020-07-30T17:02:26Z", "path": "tools/query_breakdown/src/main/java/com/google/bigquery/LocationTracker.java", "diffHunk": "@@ -0,0 +1,92 @@\n+package com.google.bigquery;\n+\n+import java.util.ArrayList;\n+\n+/**\n+ * This class tracks the original location of components in the query, thereby making sure that\n+ * the error locations are correctly represented.\n+ */\n+public class LocationTracker {", "originalCommit": "de1bf6d4eb9924f18f9c002256af1778e134dbe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE1ODYwMw==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463158603", "bodyText": "Ah! So for each pair of (line, column), it is initialized in position at the (line - 1)th arraylist and (column - 1)th element of the arraylist as the integer column - 1. Since the line number won't ever change (but the column number will change constantly), we simply keep track of the original column number as the integer in the double arraylist", "author": "subinbean", "createdAt": "2020-07-30T17:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE0MjExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4MTkwMg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463781902", "bodyText": "I see. Please add comment to explain this.", "author": "feiling", "createdAt": "2020-07-31T19:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE0MjExNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2ODU4MA==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463868580", "bodyText": "yup! more documentation is now added", "author": "subinbean", "createdAt": "2020-07-31T22:13:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE0MjExNw=="}], "type": "inlineReview"}, {"oid": "eaed220b72c091cd52a3d28f0c29b3a9f8f41c40", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/eaed220b72c091cd52a3d28f0c29b3a9f8f41c40", "message": "unsupported operation exception", "committedDate": "2020-07-30T17:54:22Z", "type": "commit"}, {"oid": "188ec367f1c3187f51c63af3e460ee71d52c1619", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/188ec367f1c3187f51c63af3e460ee71d52c1619", "message": "variable name lt updated", "committedDate": "2020-07-31T16:34:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4MjMyOQ==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463782329", "bodyText": "Unit tests should be self-contained, i.e. they don't rely on other data. So we shouldn't rely on the file multipleLineQuery.txt. Please add a method to InputReader such as readFromString(string input), then the test data can be passed to inputReader in the test itself.", "author": "feiling", "createdAt": "2020-07-31T19:06:41Z", "path": "tools/query_breakdown/src/test/java/com/google/bigquery/LocationTrackerTest.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package com.google.bigquery;\n+\n+import static org.junit.Assert.*;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import org.junit.Test;\n+\n+public class LocationTrackerTest {\n+\n+  @Test\n+  public void locationTrackerTestInitializedCorrectly() throws IOException {\n+    InputReader ir = new InputReader();\n+    String absPath = new File(\"\").getAbsolutePath();\n+    ir.readInput(absPath + \"/src/test/java/com/google/bigquery\"\n+            + \"/InputTestFiles/multipleLineQuery.txt\");\n+    assertEquals(4, ir.getLocationTracker().getOriginalPosition(3, 4));\n+  }", "originalCommit": "de1bf6d4eb9924f18f9c002256af1778e134dbe5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzg2ODYzNg==", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/pull/123#discussion_r463868636", "bodyText": "Just added the method in inputreader and changed the tests accordingly", "author": "subinbean", "createdAt": "2020-07-31T22:14:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc4MjMyOQ=="}], "type": "inlineReview"}, {"oid": "21cdc721ef769760ead21946542a5248fd63a706", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/21cdc721ef769760ead21946542a5248fd63a706", "message": "testing more internalized, improved documentation for location tracker", "committedDate": "2020-07-31T22:13:11Z", "type": "commit"}, {"oid": "0e2e112fe6df731e99730dbd876a7678b5bb3e39", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/0e2e112fe6df731e99730dbd876a7678b5bb3e39", "message": "Merge branch 'master' into milestone1_4", "committedDate": "2020-08-03T15:59:12Z", "type": "commit"}, {"oid": "72c7702762b51db0a96e6d0e658c27f22cb720c5", "url": "https://github.com/GoogleCloudPlatform/bigquery-utils/commit/72c7702762b51db0a96e6d0e658c27f22cb720c5", "message": "Merge branch 'master' into milestone1_4", "committedDate": "2020-08-04T18:04:04Z", "type": "commit"}]}