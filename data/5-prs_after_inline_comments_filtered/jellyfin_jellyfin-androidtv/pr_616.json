{"pr_number": 616, "pr_title": "Re-add \"Ends at\" time to playback control overlay", "pr_createdAt": "2020-11-06T22:24:17Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616", "timeline": [{"oid": "b10d90773dfe75a3d49430bbbd79ead3134a942b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b10d90773dfe75a3d49430bbbd79ead3134a942b", "message": "Re-add \"Ends at\" time to playback control overlay", "committedDate": "2020-11-07T15:50:09Z", "type": "commit"}, {"oid": "b10d90773dfe75a3d49430bbbd79ead3134a942b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/b10d90773dfe75a3d49430bbbd79ead3134a942b", "message": "Re-add \"Ends at\" time to playback control overlay", "committedDate": "2020-11-07T15:50:09Z", "type": "forcePushed"}, {"oid": "8e5db7a1d194971eceb3793d5a970c8927db21bd", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8e5db7a1d194971eceb3793d5a970c8927db21bd", "message": "Codacy", "committedDate": "2020-11-07T16:13:06Z", "type": "commit"}, {"oid": "9ff8654f43903330052a1135e77e3efeeaa7c100", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/9ff8654f43903330052a1135e77e3efeeaa7c100", "message": "Fix time displayed; moved TextView creation to onCreate; set default text of TextView to \"Loading...\"", "committedDate": "2020-11-07T19:43:46Z", "type": "commit"}, {"oid": "f8a964d53225e7669772303de4428c567f8c4d39", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/f8a964d53225e7669772303de4428c567f8c4d39", "message": "Add string entry for \"Ends at\"; Null checks on context", "committedDate": "2020-11-07T19:54:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTMwNzA2Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r519307063", "bodyText": "Can we use playbackControlsTimeStyle here?\nhttps://cs.android.com/androidx/platform/frameworks/support/+/androidx-master-dev:leanback/leanback/src/main/res/layout/lb_playback_transport_controls_row.xml;l=113", "author": "nielsvanvelzen", "createdAt": "2020-11-08T09:06:19Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/overlay/CustomPlaybackTransportControlGlue.java", "diffHunk": "@@ -59,6 +70,67 @@\n         initActions(context);\n     }\n \n+    @Override\n+    protected PlaybackRowPresenter onCreateRowPresenter() {\n+        final AbstractDetailsDescriptionPresenter detailsPresenter =\n+                new AbstractDetailsDescriptionPresenter() {\n+                    @Override\n+                    protected void onBindDescription(ViewHolder\n+                                                             viewHolder, Object obj) {\n+                        PlaybackTransportControlGlue glue = (PlaybackTransportControlGlue) obj;\n+                        viewHolder.getTitle().setText(glue.getTitle());\n+                        viewHolder.getSubtitle().setText(glue.getSubtitle());\n+                    }\n+                };\n+\n+        PlaybackTransportRowPresenter rowPresenter = new PlaybackTransportRowPresenter() {\n+            @Override\n+            protected RowPresenter.ViewHolder createRowViewHolder(ViewGroup parent) {\n+                RowPresenter.ViewHolder vh = super.createRowViewHolder(parent);\n+                Context context = getContext();\n+\n+                if (context != null) {\n+                    mEndsText = new TextView(context);\n+                    mEndsText.setTextAppearance(context, R.style.PlaybackControlsText);", "originalCommit": "f8a964d53225e7669772303de4428c567f8c4d39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTQ4NDAxMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r519484012", "bodyText": "Apparently, yes. I did not know that. Although it's not using the attr but instead the style the attr value points to.", "author": "MrChip53", "createdAt": "2020-11-08T22:09:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTMwNzA2Mw=="}], "type": "inlineReview"}, {"oid": "e6d7a43e2cc7ee67c0fb8d341f90620f1ce9204b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e6d7a43e2cc7ee67c0fb8d341f90620f1ce9204b", "message": "Use leanback style and initialize mEndsText earlier with proper displayed text", "committedDate": "2020-11-08T22:14:50Z", "type": "commit"}, {"oid": "307f7962cae6a98a8ef8b7345d2f565ef466116b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/307f7962cae6a98a8ef8b7345d2f565ef466116b", "message": "Null check mEndsText before adding to playback controls", "committedDate": "2020-11-08T22:20:59Z", "type": "commit"}, {"oid": "69094ffe4cb56a77e51f5902009520bdfbe74519", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/69094ffe4cb56a77e51f5902009520bdfbe74519", "message": "Move TextView initialization back to createRowViewHolder in CustomPlaybackTransportControlGlue.java", "committedDate": "2020-11-09T02:33:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxODU4OA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r519918588", "bodyText": "I think the implementation of this method could be added to the existing updatePlayState method.", "author": "nielsvanvelzen", "createdAt": "2020-11-09T15:53:56Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/overlay/CustomPlaybackTransportControlGlue.java", "diffHunk": "@@ -197,6 +273,15 @@ public void onCustomActionClicked(Action action, View view) {\n         }\n     }\n \n+    public void setEndTime() {", "originalCommit": "69094ffe4cb56a77e51f5902009520bdfbe74519", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI3NTExMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r520275113", "bodyText": "I was thinking to leave it as is so if we want to call it somewhere else we don't need duplicate code.", "author": "MrChip53", "createdAt": "2020-11-10T04:13:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxODU4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI3NjExNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r520276116", "bodyText": "Actually do you mean the function call or the contents of the function itself? Do we want the setEndTime function to be private? For now I will make it private and create the handler inside the Glue class so the TextView can't be modified externally.", "author": "MrChip53", "createdAt": "2020-11-10T04:17:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxODU4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxOTc2Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r519919762", "bodyText": "These null checks are unnecessary", "author": "nielsvanvelzen", "createdAt": "2020-11-09T15:55:05Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/overlay/CustomPlaybackTransportControlGlue.java", "diffHunk": "@@ -197,6 +273,15 @@ public void onCustomActionClicked(Action action, View view) {\n         }\n     }\n \n+    public void setEndTime() {\n+        long msLeft = playerAdapter.getDuration() - playerAdapter.getCurrentPosition();\n+        Calendar ends = Calendar.getInstance();\n+        ends.setTimeInMillis(ends.getTimeInMillis() + msLeft);\n+        Context context = getContext();\n+        if (context != null && mEndsText != null)", "originalCommit": "69094ffe4cb56a77e51f5902009520bdfbe74519", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDI4NTA1MQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r520285051", "bodyText": "mEndsText does need to be null checked as it appears the play state gets updated before we hook into the view holder function", "author": "MrChip53", "createdAt": "2020-11-10T04:52:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkxOTc2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkyMDkxMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r519920912", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                //Custom views\n          \n          \n            \n                // Injected views", "author": "nielsvanvelzen", "createdAt": "2020-11-09T15:56:32Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/overlay/CustomPlaybackTransportControlGlue.java", "diffHunk": "@@ -51,6 +62,9 @@\n     private ArrayObjectAdapter primaryActionsAdapter;\n     private ArrayObjectAdapter secondaryActionsAdapter;\n \n+    //Custom views", "originalCommit": "69094ffe4cb56a77e51f5902009520bdfbe74519", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTkyMTk4Ng==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/616#discussion_r519921986", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            Context context = getContext();\n          \n          \n            \n                            Context context = parent.getContext();\n          \n      \n    \n    \n  \n\nThat one should always be not-null", "author": "nielsvanvelzen", "createdAt": "2020-11-09T15:57:59Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/overlay/CustomPlaybackTransportControlGlue.java", "diffHunk": "@@ -59,6 +73,68 @@\n         initActions(context);\n     }\n \n+    @Override\n+    protected PlaybackRowPresenter onCreateRowPresenter() {\n+        final AbstractDetailsDescriptionPresenter detailsPresenter =\n+                new AbstractDetailsDescriptionPresenter() {\n+                    @Override\n+                    protected void onBindDescription(ViewHolder\n+                                                             viewHolder, Object obj) {\n+                        PlaybackTransportControlGlue glue = (PlaybackTransportControlGlue) obj;\n+                        viewHolder.getTitle().setText(glue.getTitle());\n+                        viewHolder.getSubtitle().setText(glue.getSubtitle());\n+                    }\n+                };\n+\n+        PlaybackTransportRowPresenter rowPresenter = new PlaybackTransportRowPresenter() {\n+            @Override\n+            protected RowPresenter.ViewHolder createRowViewHolder(ViewGroup parent) {\n+                RowPresenter.ViewHolder vh = super.createRowViewHolder(parent);\n+                Context context = getContext();", "originalCommit": "69094ffe4cb56a77e51f5902009520bdfbe74519", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "726632988cea6abd996beac771080523d2f55bf1", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/726632988cea6abd996beac771080523d2f55bf1", "message": "Address comments from review; change visibility accordingly in handler", "committedDate": "2020-11-10T04:54:30Z", "type": "commit"}, {"oid": "361771836a62aabaec1d94d2c3e621f0bce80ef8", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/361771836a62aabaec1d94d2c3e621f0bce80ef8", "message": "Explicit scopes", "committedDate": "2020-11-10T05:00:21Z", "type": "commit"}, {"oid": "5664e84f591434becb29fd5da976a0c43dc0fd79", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/5664e84f591434becb29fd5da976a0c43dc0fd79", "message": "Use leanback style and initialize mEndsText earlier with proper displayed text", "committedDate": "2020-11-11T04:21:30Z", "type": "commit"}, {"oid": "ec78e01e51aa4042e6c8c564024ae14ca033caba", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/ec78e01e51aa4042e6c8c564024ae14ca033caba", "message": "Remove refresh end time task when video is resumed", "committedDate": "2020-11-11T04:33:58Z", "type": "commit"}, {"oid": "ec78e01e51aa4042e6c8c564024ae14ca033caba", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/ec78e01e51aa4042e6c8c564024ae14ca033caba", "message": "Remove refresh end time task when video is resumed", "committedDate": "2020-11-11T04:33:58Z", "type": "forcePushed"}, {"oid": "4e770a45a31a33ea77c5ce29b2b984ae2cfeef58", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/4e770a45a31a33ea77c5ce29b2b984ae2cfeef58", "message": "Merge branch 'master' into ends-at-v2", "committedDate": "2020-11-12T19:56:45Z", "type": "commit"}]}