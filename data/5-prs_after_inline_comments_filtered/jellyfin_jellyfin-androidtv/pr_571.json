{"pr_number": 571, "pr_title": "Feature play with button", "pr_createdAt": "2020-09-24T18:34:50Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571", "timeline": [{"oid": "461255985c3c689ed1a0e25dea339a4c4086ef6e", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/461255985c3c689ed1a0e25dea339a4c4086ef6e", "message": "play with work", "committedDate": "2020-09-21T19:16:41Z", "type": "commit"}, {"oid": "219545b26acc965c4d2a60ebc9fbfb3946d38952", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/219545b26acc965c4d2a60ebc9fbfb3946d38952", "message": "menu is working", "committedDate": "2020-09-22T19:02:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc4MDE5Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r494780197", "bodyText": "\"Play with\" should use a string so it can be translated.", "author": "nielsvanvelzen", "createdAt": "2020-09-25T06:44:40Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1260,6 +1267,19 @@ public void onClick(View v) {\n                 more.show();\n             }\n         });\n+        if (userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.EXTERNAL) {\n+            playWithButton = new TextUnderButton(this, R.drawable.ic_add, buttonSize, 3, \"Play with\", new View.OnClickListener() {", "originalCommit": "219545b26acc965c4d2a60ebc9fbfb3946d38952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc4MDU4Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r494780587", "bodyText": "This toast looks like it was intended for debugigng purposes, should probably remove it or replace it with a logger debug message.", "author": "nielsvanvelzen", "createdAt": "2020-09-25T06:45:28Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1260,6 +1267,19 @@ public void onClick(View v) {\n                 more.show();\n             }\n         });\n+        if (userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.EXTERNAL) {\n+            playWithButton = new TextUnderButton(this, R.drawable.ic_add, buttonSize, 3, \"Play with\", new View.OnClickListener() {\n+                @Override\n+                public void onClick(View view) {\n+                    Toast.makeText(mApplication, \"Play With Button\", Toast.LENGTH_SHORT).show();", "originalCommit": "219545b26acc965c4d2a60ebc9fbfb3946d38952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc4MTA1NQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r494781055", "bodyText": "User preferences should never be changed without the user explicitly telling the application to do so. In this case you should find a way to set the player for the next play call without changing the setting.", "author": "nielsvanvelzen", "createdAt": "2020-09-25T06:46:35Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1326,6 +1346,29 @@ public boolean onMenuItemClick(MenuItem item) {\n         }\n     };\n \n+    PopupMenu.OnMenuItemClickListener playWithMenuListener = new PopupMenu.OnMenuItemClickListener() {\n+        @Override\n+        public boolean onMenuItemClick(MenuItem item) {\n+            switch (item.getItemId()) {\n+\n+                case R.id.play_with_vlc:\n+                        userPreferences.getValue().set(UserPreferences.Companion.getVideoPlayer(), PreferredVideoPlayer.VLC);", "originalCommit": "219545b26acc965c4d2a60ebc9fbfb3946d38952", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "502c3ff71873c87f23611b7aac00f6e72d9cfff5", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/502c3ff71873c87f23611b7aac00f6e72d9cfff5", "message": "progress on play with feature", "committedDate": "2020-09-26T12:21:03Z", "type": "commit"}, {"oid": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/d4f57744feaef863ecd12513ae0c5f82a039ed59", "message": "working external player", "committedDate": "2020-09-26T18:28:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDE4Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484182", "bodyText": "Use else if", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:46:51Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -888,18 +893,25 @@ public void onError(Exception exception) {\n             mDetailsOverviewRow.addAction(mResumeButton);\n             boolean resumeButtonVisible = (mBaseItem.getBaseItemType() == BaseItemType.Series && !mBaseItem.getUserData().getPlayed()) || (mBaseItem.getCanResume());\n             mResumeButton.setVisibility(resumeButtonVisible ? View.VISIBLE : View.GONE);\n-\n-            TextUnderButton play = new TextUnderButton(this, R.drawable.ic_play, buttonSize, 2, getString(BaseItemUtils.isLiveTv(mBaseItem) ? R.string.lbl_tune_to_channel : mBaseItem.getIsFolderItem() ? R.string.lbl_play_all : R.string.lbl_play), new View.OnClickListener() {\n-                @Override\n-                public void onClick(View v) {\n-                    play(mBaseItem, 0, false);\n-                }\n-            });\n-            mDetailsOverviewRow.addAction(play);\n+            boolean isPlayerPrefChoose = userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.CHOOSE;\n+            TextUnderButton play = null;\n+            if (!isPlayerPrefChoose) {\n+                play = new TextUnderButton(this, R.drawable.ic_play, buttonSize, 2, getString(BaseItemUtils.isLiveTv(mBaseItem) ? R.string.lbl_tune_to_channel : mBaseItem.getIsFolderItem() ? R.string.lbl_play_all : R.string.lbl_play), new View.OnClickListener() {\n+                    @Override\n+                    public void onClick(View v) {\n+                        play(mBaseItem, 0, false);\n+                    }\n+                });\n+                mDetailsOverviewRow.addAction(play);    \n+            }\n+            \n             if (resumeButtonVisible) {\n                 mResumeButton.requestFocus();\n             } else {\n-                play.requestFocus();\n+                if (!isPlayerPrefChoose) {", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDMxNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484316", "bodyText": "Probably easier to add an else statement when checking if the play button should be shown", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:48:36Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1260,6 +1276,18 @@ public void onClick(View v) {\n                 more.show();\n             }\n         });\n+        if (userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.CHOOSE) {", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDMzMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484333", "bodyText": "Since either the play or play with button is shown you can probably reuse the playButton property", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:48:58Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1260,6 +1276,18 @@ public void onClick(View v) {\n                 more.show();\n             }\n         });\n+        if (userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.CHOOSE) {\n+            playWithButton = new TextUnderButton(this, R.drawable.ic_add, buttonSize, 3, getString(R.string.play_with), new View.OnClickListener() {", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDU2Nw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484567", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            if (preferredVideoPlayerByPlayWith == PreferredVideoPlayer.VLC) {\n          \n          \n            \n                                                useVlc = true;\n          \n          \n            \n                                            } else if (preferredVideoPlayerByPlayWith == PreferredVideoPlayer.EXOPLAYER) {\n          \n          \n            \n                                                // Make sure to not use VLC\n          \n          \n            \n                                                useVlc = false;\n          \n          \n            \n                                            }\n          \n          \n            \n                                            useVlc = preferredVideoPlayerByPlayWith == PreferredVideoPlayer.VLC;", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:51:23Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/PlaybackController.java", "diffHunk": "@@ -478,6 +491,16 @@ public void onResponse(StreamInfo internalResponse) {\n                                                         !internalResponse.getMediaSource().getDefaultAudioStream().getCodec().equals(\"dts\"))) &&\n                                         (!DeviceUtils.isFireTvStick() ||\n                                                 (vlcResponse.getMediaSource().getVideoStream() != null && vlcResponse.getMediaSource().getVideoStream().getWidth() < 1000));\n+                            } else if (preferredVideoPlayer == PreferredVideoPlayer.CHOOSE) {\n+                                PreferredVideoPlayer preferredVideoPlayerByPlayWith = userPreferences.getValue().get(UserPreferences.Companion.getChosenPlayer());\n+                                if (preferredVideoPlayerByPlayWith == PreferredVideoPlayer.VLC) {\n+                                    useVlc = true;\n+                                } else if (preferredVideoPlayerByPlayWith == PreferredVideoPlayer.EXOPLAYER) {\n+                                    // Make sure to not use VLC\n+                                    useVlc = false;\n+                                }", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDYwMA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484600", "bodyText": "Use Timber for logging", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:51:44Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/PlaybackController.java", "diffHunk": "@@ -478,6 +491,16 @@ public void onResponse(StreamInfo internalResponse) {\n                                                         !internalResponse.getMediaSource().getDefaultAudioStream().getCodec().equals(\"dts\"))) &&\n                                         (!DeviceUtils.isFireTvStick() ||\n                                                 (vlcResponse.getMediaSource().getVideoStream() != null && vlcResponse.getMediaSource().getVideoStream().getWidth() < 1000));\n+                            } else if (preferredVideoPlayer == PreferredVideoPlayer.CHOOSE) {\n+                                PreferredVideoPlayer preferredVideoPlayerByPlayWith = userPreferences.getValue().get(UserPreferences.Companion.getChosenPlayer());\n+                                if (preferredVideoPlayerByPlayWith == PreferredVideoPlayer.VLC) {\n+                                    useVlc = true;\n+                                } else if (preferredVideoPlayerByPlayWith == PreferredVideoPlayer.EXOPLAYER) {\n+                                    // Make sure to not use VLC\n+                                    useVlc = false;\n+                                }\n+\n+                                System.out.println(\"PREFERRED PLAYER \" + preferredVideoPlayerByPlayWith.name());", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDgxNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484816", "bodyText": "I think this is unused", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:54:15Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1325,6 +1353,42 @@ public boolean onMenuItemClick(MenuItem item) {\n             return false;\n         }\n     };\n+    PlaybackController playbackController= new  PlaybackController(MediaManager.getCurrentVideoQueue());", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDgyNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484826", "bodyText": "Mark private", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:54:23Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -1325,6 +1353,42 @@ public boolean onMenuItemClick(MenuItem item) {\n             return false;\n         }\n     };\n+    PlaybackController playbackController= new  PlaybackController(MediaManager.getCurrentVideoQueue());\n+\n+    PopupMenu.OnMenuItemClickListener playWithMenuListener = new PopupMenu.OnMenuItemClickListener() {", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ4NDgzMw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r495484833", "bodyText": "I think this is unused too", "author": "nielsvanvelzen", "createdAt": "2020-09-26T18:54:35Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/playback/PlaybackController.java", "diffHunk": "@@ -112,6 +112,19 @@ public PlaybackController(List<BaseItemDto> items, IPlaybackOverlayFragment frag\n         useVlc = userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.VLC;\n     }\n \n+    public PlaybackController(List<BaseItemDto> items) {", "originalCommit": "d4f57744feaef863ecd12513ae0c5f82a039ed59", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8ffba55364404c438e35c6e703434caf1f1a3423", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/8ffba55364404c438e35c6e703434caf1f1a3423", "message": "changes from review", "committedDate": "2020-09-27T09:19:27Z", "type": "commit"}, {"oid": "908f99c8014c494e5828c3aa989997b70131ed2b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/908f99c8014c494e5828c3aa989997b70131ed2b", "message": "removed unused imports - string change", "committedDate": "2020-09-27T09:26:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyNzc2Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r499227763", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        playButton = new TextUnderButton(this, R.drawable.ic_add, buttonSize, 3, getString(R.string.play_with), new View.OnClickListener() {\n          \n          \n            \n                        playButton = new TextUnderButton(this, R.drawable.ic_play, buttonSize, 3, getString(R.string.play_with), new View.OnClickListener() {", "author": "nielsvanvelzen", "createdAt": "2020-10-04T09:59:31Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -884,55 +889,71 @@ public void onError(Exception exception) {\n             }\n         });\n \n-        if (BaseItemUtils.canPlay(mBaseItem)) {\n-            mDetailsOverviewRow.addAction(mResumeButton);\n-            boolean resumeButtonVisible = (mBaseItem.getBaseItemType() == BaseItemType.Series && !mBaseItem.getUserData().getPlayed()) || (mBaseItem.getCanResume());\n-            mResumeButton.setVisibility(resumeButtonVisible ? View.VISIBLE : View.GONE);\n-\n-            TextUnderButton play = new TextUnderButton(this, R.drawable.ic_play, buttonSize, 2, getString(BaseItemUtils.isLiveTv(mBaseItem) ? R.string.lbl_tune_to_channel : mBaseItem.getIsFolderItem() ? R.string.lbl_play_all : R.string.lbl_play), new View.OnClickListener() {\n+        //playButton becomes playWith button\n+        if (userPreferences.getValue().get(UserPreferences.Companion.getVideoPlayer()) == PreferredVideoPlayer.CHOOSE) {\n+            playButton = new TextUnderButton(this, R.drawable.ic_add, buttonSize, 3, getString(R.string.play_with), new View.OnClickListener() {", "originalCommit": "908f99c8014c494e5828c3aa989997b70131ed2b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjc5NDA2Mw==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r502794063", "bodyText": "This one isn't fixed yet. We should use the same icon.", "author": "nielsvanvelzen", "createdAt": "2020-10-10T14:04:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTIyNzc2Mw=="}], "type": "inlineReview"}, {"oid": "401799cb05a3351a5adb12d3868fad679039e23f", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/401799cb05a3351a5adb12d3868fad679039e23f", "message": "show playWith button on certain screens", "committedDate": "2020-10-05T18:57:28Z", "type": "commit"}, {"oid": "893a3bfa5b3317992502f25d85d9ff7bac73e46f", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/893a3bfa5b3317992502f25d85d9ff7bac73e46f", "message": "button icon change", "committedDate": "2020-10-10T14:22:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzE5MDIxNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/571#discussion_r507190216", "bodyText": "Codacy found an issue: Fields should be declared at the top of the class, before any method declarations, constructors, initializers or inner classes.", "author": "jellyfin-bot", "createdAt": "2020-10-18T17:32:02Z", "path": "app/src/main/java/org/jellyfin/androidtv/ui/itemdetail/FullDetailsActivity.java", "diffHunk": "@@ -839,6 +843,7 @@ public void onClick(DialogInterface dialog, int which) {\n     private TextUnderButton queueButton = null;\n     private TextUnderButton deleteButton = null;\n     private TextUnderButton moreButton;\n+    private TextUnderButton playButton = null;", "originalCommit": "ea11eaadf78b6efdb91e87ff5326bf2a6ef91404", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ea11eaadf78b6efdb91e87ff5326bf2a6ef91404", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/ea11eaadf78b6efdb91e87ff5326bf2a6ef91404", "message": "episode check added for play with button", "committedDate": "2020-10-18T17:34:11Z", "type": "commit"}]}