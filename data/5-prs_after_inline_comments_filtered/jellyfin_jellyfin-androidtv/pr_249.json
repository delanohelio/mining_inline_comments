{"pr_number": 249, "pr_title": "Add option to choose the preferred media player in settings", "pr_createdAt": "2020-01-02T18:17:57Z", "pr_url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249", "timeline": [{"oid": "e36dd6c968539d85c8609e12f6a2e747581865a3", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/e36dd6c968539d85c8609e12f6a2e747581865a3", "message": "Add option to choose the preferred media player in settings", "committedDate": "2020-01-02T18:13:00Z", "type": "commit"}, {"oid": "3897ebbb554bbf94c3333615710af6e41327473b", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/3897ebbb554bbf94c3333615710af6e41327473b", "message": "Remove strings for external player option", "committedDate": "2020-01-02T18:14:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362587622", "bodyText": "Does it make sense to maintain a config version? I have been thinking it may be less overhead to just check if a specific preference exists and set the default value if it does not.", "author": "thornbill", "createdAt": "2020-01-02T18:58:32Z", "path": "app/src/main/java/org/jellyfin/androidtv/startup/StartupActivity.java", "diffHunk": "@@ -70,6 +70,12 @@ protected void onCreate(Bundle savedInstanceState) {\n             application.getPrefs().edit().putBoolean(\"pref_enable_info_panel\", false).apply();\n             application.getSystemPrefs().edit().putString(\"sys_pref_config_version\", \"4\").apply();\n         }\n+        if (Integer.parseInt(application.getConfigVersion()) < 5) {", "originalCommit": "3897ebbb554bbf94c3333615710af6e41327473b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU5MzAzOQ==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362593039", "bodyText": "I think it does make sense! Imagine a setting being renamed or (like in this case) a setting replacing another one. It would be annoying if the app auto-updates via the play store and suddenly your behavior changed because there is no migration. In this case external player users wouldn't use the external player anymore.\nI do however think that the way this is done is ugly, in the future we might want to separate the preferences to a custom class which brings type safety (using enums instead of strings etc.) and handles migration a bit better.\nThis class could have getters & setters that need to be called and could use shared preferences as storage or maybe even sqlite.", "author": "nielsvanvelzen", "createdAt": "2020-01-02T19:14:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYxMTA5NA==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362611094", "bodyText": "I've created a simple class for usage in my apps with these simple getters and setters and I've used it a lot. Might save a little bit of work https://github.com/Florianisme/SharedPreferences", "author": "Florianisme", "createdAt": "2020-01-02T20:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYxOTg0Mg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362619842", "bodyText": "I would prefer the different settings being defined too, so no \"getBoolean\" or \"getString\" but \"getPreferredPlayer\" and \"getConfigVersion\".\nSomething like:\nenum class PlayerType {\n\tAUTO,\n\tVLC,\n\tEXOPLAYER,\n\tEXTERNAL\n}\n\nclass Preferences(\n\tprivate val context: Context\n) {\n\tprivate val sharedPreferences by lazy {\n\t\tPreferenceManager.getDefaultSharedPreferences(context)\n\t}\n\n\t/* Preferences */\n\tvar preferedPlayer by enumPreference(\"pref_video_player\", PlayerType.AUTO)\n\tvar configVersion by intPreference(\"sys_pref_config_version\", 1)\n\n\t/** Storage functions */\n\tprivate fun intPreference(key: String, default: Int) = object : ReadWriteProperty<Preferences, Int> {\n\t\toverride fun getValue(thisRef: Preferences, property: KProperty<*>): Int {\n\t\t\treturn sharedPreferences.getInt(key, default)\n\t\t}\n\n\t\toverride fun setValue(thisRef: Preferences, property: KProperty<*>, value: Int) {\n\t\t\tsharedPreferences.edit().putInt(key, value).apply()\n\t\t}\n\t}\n\n\tprivate inline fun <reified T: Enum<T>> enumPreference(key: String, default: T?) = object : ReadWriteProperty<Preferences, T?> {\n\t\toverride fun getValue(thisRef: Preferences, property: KProperty<*>): T? {\n\t\t\tval stringValue = sharedPreferences.getString(key, null)\n\n\t\t\treturn if (stringValue == null) default\n\t\t\telse T::class.java.enumConstants.find { it.name == stringValue }\n\t\t}\n\n\t\toverride fun setValue(thisRef: Preferences, property: KProperty<*>, value: T?) {\n\t\t\tif (value == null) sharedPreferences.edit().remove(key).apply()\n\t\t\telse sharedPreferences.edit().putString(key, value.toString()).apply()\n\t\t}\n\t}\n}\nI actually wanted to make a quick example but got carried away so this should probably work already lol", "author": "nielsvanvelzen", "createdAt": "2020-01-02T20:33:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjYyMjUyNg==", "url": "https://github.com/jellyfin/jellyfin-androidtv/pull/249#discussion_r362622526", "bodyText": "Now that I spend some effort I made an issue for it #250", "author": "nielsvanvelzen", "createdAt": "2020-01-02T20:42:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjU4NzYyMg=="}], "type": "inlineReview"}, {"oid": "1e275345d49f3ef3c8c22cc9246a80fe700dc5d2", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/1e275345d49f3ef3c8c22cc9246a80fe700dc5d2", "message": "Merge branch 'master' into player-preferrence\n\n# Conflicts:\n#\tapp/src/main/res/values/strings.xml", "committedDate": "2020-01-03T19:04:34Z", "type": "commit"}, {"oid": "c411f58c3d21dc86c68a4d3856698d54058d04c9", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/c411f58c3d21dc86c68a4d3856698d54058d04c9", "message": "Remove old strings from other languages as well", "committedDate": "2020-01-03T19:06:25Z", "type": "commit"}, {"oid": "7ae58475e5c8e4644d34353e71d1b8846aafc119", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/7ae58475e5c8e4644d34353e71d1b8846aafc119", "message": "Merge branch 'master' into player-preferrence\n\n# Conflicts:\n#\tapp/src/main/java/org/jellyfin/androidtv/TvApp.java", "committedDate": "2020-01-07T18:26:22Z", "type": "commit"}, {"oid": "91e7252025098816c53cae00afe198ec4098fe0d", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/91e7252025098816c53cae00afe198ec4098fe0d", "message": "Make sure to use VLC when preferred, even when transcoding", "committedDate": "2020-01-07T21:23:33Z", "type": "commit"}, {"oid": "35c0801f0d4615aad4a31e6691764ccebd4e0607", "url": "https://github.com/jellyfin/jellyfin-androidtv/commit/35c0801f0d4615aad4a31e6691764ccebd4e0607", "message": "Set default value for useVlc to make sure it is always set according to preferences.\n\nAlso removes the forced-enabling of VLC in the error handler for requesting stream info", "committedDate": "2020-01-07T21:30:11Z", "type": "commit"}]}