{"pr_number": 10503, "pr_title": "Use all configured nameservers when using DnsNameResolver in all cases", "pr_createdAt": "2020-08-26T13:53:53Z", "pr_url": "https://github.com/netty/netty/pull/10503", "timeline": [{"oid": "de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111", "url": "https://github.com/netty/netty/commit/de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111", "message": "Use all configured nameservers when using DnsNameResolver in all cases\n\nMotivation:\n\nDue a change introduced in 68105b257d915d8a0cb7b2acd9061661666537b6 we incorrectly skipped the usage of nameservers in some cases.\n\nModifications:\n\nOnly fetch a new stream of nameserver if the hostname not matches the original hostname in the query.\n\nResult:\n\nUse all configured nameservers. Fixes https://github.com/netty/netty/issues/10499", "committedDate": "2020-08-26T13:51:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQxNjIyOQ==", "url": "https://github.com/netty/netty/pull/10503#discussion_r477416229", "bodyText": "this is not necessary since you changed the parameter name.", "author": "chrisvest", "createdAt": "2020-08-26T16:04:56Z", "path": "resolver-dns/src/main/java/io/netty/resolver/dns/DnsResolveContext.java", "diffHunk": "@@ -1025,11 +1025,18 @@ static String decodeDomainName(ByteBuf in) {\n         }\n     }\n \n-    private DnsServerAddressStream getNameServers(String hostname) {\n-        DnsServerAddressStream stream = getNameServersFromCache(hostname);\n-        // We need to obtain a new stream from the parent DnsNameResolver as the hostname may not be the same as the\n-        // one used for the original query (for example we may follow CNAMEs).\n-        return stream == null ? parent.newNameServerAddressStream(hostname) : stream;\n+    private DnsServerAddressStream getNameServers(String name) {\n+        DnsServerAddressStream stream = getNameServersFromCache(name);\n+        if (stream == null) {\n+            // We need to obtain a new stream from the parent DnsNameResolver if the hostname is not the same as\n+            // for the original query (for example we may follow CNAMEs). Otherwise let's just duplicate the\n+            // original nameservers so we correctly update the internal index\n+            if (name.equals(this.hostname)) {", "originalCommit": "de4bdbe6d95bafbbd7fbfedfed0b09d5fe3d8111", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6268f266de990b71ef3ea9efc6eae784d756a5d3", "url": "https://github.com/netty/netty/commit/6268f266de990b71ef3ea9efc6eae784d756a5d3", "message": "Address chris comment", "committedDate": "2020-08-28T07:27:09Z", "type": "commit"}]}