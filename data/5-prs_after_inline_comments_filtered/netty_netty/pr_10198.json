{"pr_number": 10198, "pr_title": "Fix a potential fd leak in AbstractDiskHttpData.setContent", "pr_createdAt": "2020-04-20T15:03:54Z", "pr_url": "https://github.com/netty/netty/pull/10198", "timeline": [{"oid": "43a40c2f32f893dd50b16cf175d2def1bd0ce70a", "url": "https://github.com/netty/netty/commit/43a40c2f32f893dd50b16cf175d2def1bd0ce70a", "message": "Fix a potential fd leak in AbstractDiskHttpData.setContent", "committedDate": "2020-04-20T14:52:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5MzczNg==", "url": "https://github.com/netty/netty/pull/10198#discussion_r411493736", "bodyText": "nit: static", "author": "normanmaurer", "createdAt": "2020-04-20T15:55:49Z", "path": "codec-http/src/test/java/io/netty/handler/codec/http/multipart/DiskFileUploadTest.java", "diffHunk": "@@ -130,4 +133,65 @@ public void testAddContents() throws Exception {\n             f1.delete();\n         }\n     }\n+\n+    @Test\n+    public void testSetContentFromByteBuf() throws Exception {\n+        DiskFileUpload f1 = new DiskFileUpload(\"file2\", \"file2\", \"application/json\", null, null, 0);\n+        try {\n+            String json = \"{\\\"hello\\\":\\\"world\\\"}\";\n+            byte[] bytes = json.getBytes(CharsetUtil.UTF_8);\n+            f1.setContent(Unpooled.wrappedBuffer(bytes));\n+            assertEquals(json, f1.getString());\n+            assertArrayEquals(bytes, f1.get());\n+            File file = f1.getFile();\n+            assertEquals((long) bytes.length, file.length());\n+            assertArrayEquals(bytes, doReadFile(file, bytes.length));\n+        } finally {\n+            f1.delete();\n+        }\n+    }\n+\n+    @Test\n+    public void testSetContentFromInputStream() throws Exception {\n+        String json = \"{\\\"hello\\\":\\\"world\\\",\\\"foo\\\":\\\"bar\\\"}\";\n+        DiskFileUpload f1 = new DiskFileUpload(\"file3\", \"file3\", \"application/json\", null, null, 0);\n+        try {\n+            byte[] bytes = json.getBytes(CharsetUtil.UTF_8);\n+            ByteBuf buf = Unpooled.wrappedBuffer(bytes);\n+            InputStream is = new ByteBufInputStream(buf);\n+            try {\n+                f1.setContent(is);\n+                assertEquals(json, f1.getString());\n+                assertArrayEquals(bytes, f1.get());\n+                File file = f1.getFile();\n+                assertEquals((long) bytes.length, file.length());\n+                assertArrayEquals(bytes, doReadFile(file, bytes.length));\n+            } finally {\n+                buf.release();\n+                is.close();\n+            }\n+        } finally {\n+            f1.delete();\n+        }\n+    }\n+\n+    private byte[] doReadFile(File file, int maxRead) throws Exception {", "originalCommit": "43a40c2f32f893dd50b16cf175d2def1bd0ce70a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU0Mjg5MA==", "url": "https://github.com/netty/netty/pull/10198#discussion_r411542890", "bodyText": "done", "author": "seedeed", "createdAt": "2020-04-20T17:03:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTQ5MzczNg=="}], "type": "inlineReview"}, {"oid": "b8c7437323bd34d67f1e750311ec7ecc3624b6cf", "url": "https://github.com/netty/netty/commit/b8c7437323bd34d67f1e750311ec7ecc3624b6cf", "message": "Fix a test case problem.", "committedDate": "2020-04-20T17:02:19Z", "type": "commit"}]}