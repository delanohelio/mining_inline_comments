{"pr_number": 10063, "pr_title": "Correctly calculate the produced bytes in all cases when calling Refe\u2026", "pr_createdAt": "2020-02-26T15:05:50Z", "pr_url": "https://github.com/netty/netty/pull/10063", "timeline": [{"oid": "628fda1d073fb704c9bcef927897a878a2d46adb", "url": "https://github.com/netty/netty/commit/628fda1d073fb704c9bcef927897a878a2d46adb", "message": "Correctly calculate the produced bytes in all cases when calling ReferenceCountedOpenSslEngine.wrap(...)\n\nMotivation:\n\nWe did not correctly account for produced bytes when SSL_write(...) returns -1 in all cases. This could lead to lost data and so a corrupt SSL connection.\n\nModifications:\n\nAlways ensure we calculate the produced bytes correctly\n\nResult:\n\nFixes https://github.com/netty/netty/issues/10041", "committedDate": "2020-02-26T15:00:22Z", "type": "commit"}, {"oid": "b59cc29a60676d8ea795bccdf3e1c2b65dd447ea", "url": "https://github.com/netty/netty/commit/b59cc29a60676d8ea795bccdf3e1c2b65dd447ea", "message": "Add unit test", "committedDate": "2020-02-26T15:31:34Z", "type": "commit"}, {"oid": "63c2f7c2b9cc0a9d249b4563f59881c8f565375e", "url": "https://github.com/netty/netty/commit/63c2f7c2b9cc0a9d249b4563f59881c8f565375e", "message": "Add unit tests", "committedDate": "2020-02-26T15:36:39Z", "type": "commit"}, {"oid": "63c2f7c2b9cc0a9d249b4563f59881c8f565375e", "url": "https://github.com/netty/netty/commit/63c2f7c2b9cc0a9d249b4563f59881c8f565375e", "message": "Add unit tests", "committedDate": "2020-02-26T15:36:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYxMjc5OQ==", "url": "https://github.com/netty/netty/pull/10063#discussion_r384612799", "bodyText": "Consider rewording to make the statement more general and use similar terminology as used elsewhere:\n\nEven if SSL_write doesn't consume any application data it is possible that OpenSSL will produce non-application data into the BIO. For example session tickets....", "author": "Scottmitch", "createdAt": "2020-02-26T16:32:23Z", "path": "handler/src/main/java/io/netty/handler/ssl/ReferenceCountedOpenSslEngine.java", "diffHunk": "@@ -865,14 +865,19 @@ public final SSLEngineResult wrap(\n                         bytesWritten = writePlaintextData(src, min(remaining, availableCapacityForWrap));\n                     }\n \n+                    // Determine how much encrypted data was generated.\n+                    //\n+                    // Even if SSL_write did fail we may produced some data in the dst buffer (as the return value", "originalCommit": "63c2f7c2b9cc0a9d249b4563f59881c8f565375e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDY5NzgwNA==", "url": "https://github.com/netty/netty/pull/10063#discussion_r384697804", "bodyText": "are session tickets the only scenario where this might occur?", "author": "johnou", "createdAt": "2020-02-26T18:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYxMjc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDcyNzI4MA==", "url": "https://github.com/netty/netty/pull/10063#discussion_r384727280", "bodyText": "I think in theory no...\nIt was the only way how to reproduce this for me tho", "author": "normanmaurer", "createdAt": "2020-02-26T19:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDYxMjc5OQ=="}], "type": "inlineReview"}, {"oid": "f4e91dbdb8864f13d42237c3705a39d891f97f41", "url": "https://github.com/netty/netty/commit/f4e91dbdb8864f13d42237c3705a39d891f97f41", "message": "Scotts comment", "committedDate": "2020-02-26T19:47:19Z", "type": "commit"}]}