{"pr_number": 10255, "pr_title": "Add option to configure recycler delayed queue drop ratio (#10251)", "pr_createdAt": "2020-05-07T08:46:58Z", "pr_url": "https://github.com/netty/netty/pull/10255", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0Mzg3Ng==", "url": "https://github.com/netty/netty/pull/10255#discussion_r421343876", "bodyText": "we also need to keep the old constructor to not break API", "author": "normanmaurer", "createdAt": "2020-05-07T08:50:58Z", "path": "common/src/main/java/io/netty/util/Recycler.java", "diffHunk": "@@ -136,12 +141,14 @@ protected Recycler(int maxCapacityPerThread) {\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor) {\n-        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);\n+        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD,\n+                DELAYED_QUEUE_RATIO);\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n-                       int ratio, int maxDelayedQueuesPerThread) {\n+                       int ratio, int maxDelayedQueuesPerThread, int delayedQueueRatio) {", "originalCommit": "3bd2845d12856abf2fd2b9f141ce52537baee10c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM0MzkyOQ==", "url": "https://github.com/netty/netty/pull/10255#discussion_r421343929", "bodyText": "we also need to keep the old constructor to not break API", "author": "normanmaurer", "createdAt": "2020-05-07T08:51:03Z", "path": "common/src/main/java/io/netty/util/Recycler.java", "diffHunk": "@@ -136,12 +141,14 @@ protected Recycler(int maxCapacityPerThread) {\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor) {\n-        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD);\n+        this(maxCapacityPerThread, maxSharedCapacityFactor, RATIO, MAX_DELAYED_QUEUES_PER_THREAD,\n+                DELAYED_QUEUE_RATIO);\n     }\n \n     protected Recycler(int maxCapacityPerThread, int maxSharedCapacityFactor,\n-                       int ratio, int maxDelayedQueuesPerThread) {\n+                       int ratio, int maxDelayedQueuesPerThread, int delayedQueueRatio) {", "originalCommit": "3bd2845d12856abf2fd2b9f141ce52537baee10c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "url": "https://github.com/netty/netty/commit/b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "message": "Add option to configure recycler delayed queue drop ratio (#10251)\n\nMotivation\n\n- Recycler stack and delayed queue drop ratio can only be configured with\nthe same value. The overall drop ratio is ratio^2.\n\n- #10251 shows that enable drop in `WeakOrderQueue` may introduce\nperformance degradation. Though the final reason is not clear now,\nit would be better to add option to configure delayed queue drop ratio separately.\n\nModification\n\n- \"io.netty.recycler.delayedQueue.ratio\" as the drop ratio of delayed queue\n- default \"delayedQueue.ratio\" is same as \"ratio\"\n\nResults\n\nAble to configure recycler delayed queue drop ratio separately", "committedDate": "2020-05-07T10:18:13Z", "type": "commit"}, {"oid": "b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "url": "https://github.com/netty/netty/commit/b4d71bfedcf57db0d2c09efc79eecbf429b0c2ab", "message": "Add option to configure recycler delayed queue drop ratio (#10251)\n\nMotivation\n\n- Recycler stack and delayed queue drop ratio can only be configured with\nthe same value. The overall drop ratio is ratio^2.\n\n- #10251 shows that enable drop in `WeakOrderQueue` may introduce\nperformance degradation. Though the final reason is not clear now,\nit would be better to add option to configure delayed queue drop ratio separately.\n\nModification\n\n- \"io.netty.recycler.delayedQueue.ratio\" as the drop ratio of delayed queue\n- default \"delayedQueue.ratio\" is same as \"ratio\"\n\nResults\n\nAble to configure recycler delayed queue drop ratio separately", "committedDate": "2020-05-07T10:18:13Z", "type": "forcePushed"}]}