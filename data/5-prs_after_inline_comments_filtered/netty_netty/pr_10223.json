{"pr_number": 10223, "pr_title": "Self-Signed Certificate: Specify algorithm for key pair", "pr_createdAt": "2020-04-28T01:05:40Z", "pr_url": "https://github.com/netty/netty/pull/10223", "timeline": [{"oid": "5432c4e723dc5794b0fc07dbef3570275f82284c", "url": "https://github.com/netty/netty/commit/5432c4e723dc5794b0fc07dbef3570275f82284c", "message": "Add support for specifying key pair algorithm. Default key pair algorithm is set to EC with 256-bits key size.", "committedDate": "2020-04-28T00:46:20Z", "type": "commit"}, {"oid": "3fdeaea18bd619181aafe6bae00649b94772f139", "url": "https://github.com/netty/netty/commit/3fdeaea18bd619181aafe6bae00649b94772f139", "message": "Update SelfSignedCertificate.java\n\nFix comment for key pair generation.", "committedDate": "2020-04-28T01:09:12Z", "type": "commit"}, {"oid": "a1d9a29a8634294b4fe73b12a0afd67ab3b2efe2", "url": "https://github.com/netty/netty/commit/a1d9a29a8634294b4fe73b12a0afd67ab3b2efe2", "message": "Undo code formatting", "committedDate": "2020-04-28T01:55:27Z", "type": "commit"}, {"oid": "7d1c60703ad2b773fc0af9496f830b416cccbd6b", "url": "https://github.com/netty/netty/commit/7d1c60703ad2b773fc0af9496f830b416cccbd6b", "message": "Set RSA as default algorithm because test suites have RSA ciphers hard-coded", "committedDate": "2020-04-28T14:23:59Z", "type": "commit"}, {"oid": "00137cc9654f7ed0c37d0d8fc8cc6b4c0a91c39f", "url": "https://github.com/netty/netty/commit/00137cc9654f7ed0c37d0d8fc8cc6b4c0a91c39f", "message": "Restore old constructors", "committedDate": "2020-04-28T16:02:40Z", "type": "commit"}, {"oid": "1466a863277817377d3a3f2e92b90755fae5aa77", "url": "https://github.com/netty/netty/commit/1466a863277817377d3a3f2e92b90755fae5aa77", "message": "Remove Key Size comment because key size can also be set using System Properties", "committedDate": "2020-04-28T16:08:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE4NTIyMA==", "url": "https://github.com/netty/netty/pull/10223#discussion_r417185220", "bodyText": "the , should be on the previous line", "author": "normanmaurer", "createdAt": "2020-04-29T09:32:30Z", "path": "handler/src/main/java/io/netty/handler/ssl/util/OpenJdkSelfSignedCertGenerator.java", "diffHunk": "@@ -44,8 +44,8 @@\n final class OpenJdkSelfSignedCertGenerator {\n \n     @SuppressJava6Requirement(reason = \"Usage guarded by dependency check\")\n-    static String[] generate(String fqdn, KeyPair keypair, SecureRandom random, Date notBefore, Date notAfter)\n-            throws Exception {\n+    static String[] generate(String fqdn, KeyPair keypair, SecureRandom random, Date notBefore, Date notAfter\n+            , String algorithm) throws Exception {", "originalCommit": "1466a863277817377d3a3f2e92b90755fae5aa77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE4NTU5MQ==", "url": "https://github.com/netty/netty/pull/10223#discussion_r417185591", "bodyText": "should we verify that only valid algorithm names are used ? (Like either EC or RSA)", "author": "normanmaurer", "createdAt": "2020-04-29T09:33:13Z", "path": "handler/src/main/java/io/netty/handler/ssl/util/OpenJdkSelfSignedCertGenerator.java", "diffHunk": "@@ -70,12 +70,12 @@\n \n         // Sign the cert to identify the algorithm that's used.\n         X509CertImpl cert = new X509CertImpl(info);\n-        cert.sign(key, \"SHA256withRSA\");\n+        cert.sign(key, algorithm.equalsIgnoreCase(\"EC\") ? \"SHA256withECDSA\" : \"SHA256withRSA\");", "originalCommit": "1466a863277817377d3a3f2e92b90755fae5aa77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzIyMDU5MQ==", "url": "https://github.com/netty/netty/pull/10223#discussion_r417220591", "bodyText": "Added check for EC or RSA. If EC, we'll use SHA256withECDSA else SHA256withRSA because RSA is last possible case.", "author": "hyperxpro", "createdAt": "2020-04-29T10:39:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE4NTU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE4NTY5Nw==", "url": "https://github.com/netty/netty/pull/10223#discussion_r417185697", "bodyText": "see comment above", "author": "normanmaurer", "createdAt": "2020-04-29T09:33:24Z", "path": "handler/src/main/java/io/netty/handler/ssl/util/OpenJdkSelfSignedCertGenerator.java", "diffHunk": "@@ -70,12 +70,12 @@\n \n         // Sign the cert to identify the algorithm that's used.\n         X509CertImpl cert = new X509CertImpl(info);\n-        cert.sign(key, \"SHA256withRSA\");\n+        cert.sign(key, algorithm.equalsIgnoreCase(\"EC\") ? \"SHA256withECDSA\" : \"SHA256withRSA\");\n \n         // Update the algorithm and sign again.\n         info.set(CertificateAlgorithmId.NAME + '.' + CertificateAlgorithmId.ALGORITHM, cert.get(X509CertImpl.SIG_ALG));\n         cert = new X509CertImpl(info);\n-        cert.sign(key, \"SHA256withRSA\");\n+        cert.sign(key, algorithm.equalsIgnoreCase(\"EC\") ? \"SHA256withECDSA\" : \"SHA256withRSA\");", "originalCommit": "1466a863277817377d3a3f2e92b90755fae5aa77", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ac39b8a36b46742666a9cc85128825a4296c87e6", "url": "https://github.com/netty/netty/commit/ac39b8a36b46742666a9cc85128825a4296c87e6", "message": "Check if Algorithm is EC or RSA", "committedDate": "2020-04-29T10:29:22Z", "type": "commit"}, {"oid": "2111096d705435bc8e49cb43fb9fc1d8196175e0", "url": "https://github.com/netty/netty/commit/2111096d705435bc8e49cb43fb9fc1d8196175e0", "message": "Remove unused imports", "committedDate": "2020-04-29T10:33:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI1OTA5OQ==", "url": "https://github.com/netty/netty/pull/10223#discussion_r417259099", "bodyText": "imho this would be more readable:\nif (!algorithm.equalsIgnoreCase(\"EC\") && !algorithm.equalsIgnoreCase(\"RSA\")) {\n...\n}", "author": "normanmaurer", "createdAt": "2020-04-29T11:56:59Z", "path": "handler/src/main/java/io/netty/handler/ssl/util/SelfSignedCertificate.java", "diffHunk": "@@ -218,7 +220,11 @@ public SelfSignedCertificate(String fqdn, SecureRandom random, int bits, Date no\n      */\n     public SelfSignedCertificate(String fqdn, SecureRandom random, int bits, Date notBefore, Date notAfter,\n                                  String algorithm) throws CertificateException {\n-        // Generate key pair from specified algorithm.\n+\n+        if (!(algorithm.equalsIgnoreCase(\"EC\") || algorithm.equalsIgnoreCase(\"RSA\"))) {", "originalCommit": "ac39b8a36b46742666a9cc85128825a4296c87e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI2MDQzMQ==", "url": "https://github.com/netty/netty/pull/10223#discussion_r417260431", "bodyText": "Done", "author": "hyperxpro", "createdAt": "2020-04-29T11:59:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI1OTA5OQ=="}], "type": "inlineReview"}, {"oid": "007c07ee5ad95b51990054c538f2f94e2069cc72", "url": "https://github.com/netty/netty/commit/007c07ee5ad95b51990054c538f2f94e2069cc72", "message": "Simplify algorithm check", "committedDate": "2020-04-29T11:59:29Z", "type": "commit"}, {"oid": "9e71f1fe412e184fb19c4e1e9ed4879d7f585cdc", "url": "https://github.com/netty/netty/commit/9e71f1fe412e184fb19c4e1e9ed4879d7f585cdc", "message": "Fix RSA algorithm check", "committedDate": "2020-04-29T12:00:32Z", "type": "commit"}, {"oid": "e691abfbff0a03af7ca71092888289e3c12e37e6", "url": "https://github.com/netty/netty/commit/e691abfbff0a03af7ca71092888289e3c12e37e6", "message": "Replace `example.com` with `localhost`", "committedDate": "2020-04-29T13:12:18Z", "type": "commit"}]}