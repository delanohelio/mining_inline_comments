{"pr_number": 2025, "pr_title": "GH-1900 Server responds with SHACL validation report if validation failed", "pr_createdAt": "2020-03-20T10:02:13Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2025", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNTcxMg==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395635712", "bodyText": "I'm trying out throwing a custom exception based based on if the correct header is set to indicate that this is a shacl violation.", "author": "hmottestad", "createdAt": "2020-03-20T13:29:35Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/SPARQLProtocolSession.java", "diffHunk": "@@ -1041,6 +1044,10 @@ protected HttpResponse execute(HttpUriRequest method) throws IOException, RDF4JE\n \t\t\t\t\t\tthrow new MalformedQueryException(errInfo.getErrorMessage());\n \t\t\t\t\t} else if (errInfo.getErrorType() == ErrorType.UNSUPPORTED_QUERY_LANGUAGE) {\n \t\t\t\t\t\tthrow new UnsupportedQueryLanguageException(errInfo.getErrorMessage());\n+\t\t\t\t\t} else if (exceptionIs(response, \"ShaclSailValidationException\")) {\n+\t\t\t\t\t\tthrow new RepositoryException(new RemoteShaclSailValidationException(\n+\t\t\t\t\t\t\t\tnew StringReader(errInfo.toString()), \"\", RDFFormat.NQUADS));\n+", "originalCommit": "f5d31dfdb9336db3596b20ab0073e9df6ffc3f87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzMwNw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395637307", "bodyText": "I would prefer to throw the real ShaclSailValidationException, but doing so requires a dependency on the shacl module which causes a dependency cycle. I need to extract some interfaces instead....which maven model should I use for those interfaces do you think @jeenbroekstra ?", "author": "hmottestad", "createdAt": "2020-03-20T13:32:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNTcxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwOTI2NA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395909264", "bodyText": "If you want a place to have a shared exception class, rdf4j-util might be a good spot. Create a package org.eclipse.rdf4j.common.exception perhaps?", "author": "jeenbroekstra", "createdAt": "2020-03-20T22:02:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNTcxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395637795", "bodyText": "Went with `X-Eclipse-RDF4J-Exception\u00b4as the header, and it should contain a simple class name.", "author": "hmottestad", "createdAt": "2020-03-20T13:33:01Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/SPARQLProtocolSession.java", "diffHunk": "@@ -1055,6 +1062,21 @@ protected HttpResponse execute(HttpUriRequest method) throws IOException, RDF4JE\n \t\t}\n \t}\n \n+\tprivate boolean exceptionIs(HttpResponse response, String exceptionName) {\n+\t\tHeader[] headers = response.getHeaders(\"X-Eclipse-RDF4J-Exception\");", "originalCommit": "f5d31dfdb9336db3596b20ab0073e9df6ffc3f87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk2NDA0Mw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395964043", "bodyText": "If we must use a custom header, this seems like a good name for it. I'd remove the X- prefix though. That is no longer recommend practice for custom headers. See https://stackoverflow.com/questions/3561381/custom-http-headers-naming-conventions\nI know it's very unlikely that this header will have be standardized, but we might as well stick to what IETF says, regardless.", "author": "jeenbroekstra", "createdAt": "2020-03-21T05:36:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk2NDYwNQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395964605", "bodyText": "Alternatively: instead of using a custom header for this (which on some servers/firewalls is known to cause problems), we could also just let the client look at the response status code, and if it's a 409 conflict, see if there is a payload with a validation report in it.", "author": "jeenbroekstra", "createdAt": "2020-03-21T05:45:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3MzM1Mg==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395973352", "bodyText": "We shouldn\u2019t rely on having to look at the content, since that will stop us from doing a streaming based approach down the line. Custom status line was my first idea until I realized how hard it would be to do with spring.", "author": "hmottestad", "createdAt": "2020-03-21T08:22:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MTY0MA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395981640", "bodyText": "Fwiw I'm fine with going with the header for now but I don't see how looking at the content would stop us streaming: based on content type you can just immediately parse in the background, this is no different from how query results are processed. Also: do these reports really get so large that this is a serious consideration?", "author": "jeenbroekstra", "createdAt": "2020-03-21T10:36:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4Mjk5OA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395982998", "bodyText": "Can you point me to where this is handled for the query results?\nMy fear is that someone will modify a shape and that will cause a lot of data to become invalid. I've done this myself a few times while developing validation rules. It's usually not intentional, but it would be a pity if we bring down the server because we run out of memory.", "author": "hmottestad", "createdAt": "2020-03-21T10:58:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0OTEzMA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396049130", "bodyText": "Can you point me to where this is handled for the query results?\n\nSure thing. For construct queries, for example:\n\nserver-side streaming: org.eclipse.rdf4j.http.server.repository.GraphQueryResultView (the renderInternal method)\nclient-side streaming: SPARQLProtocolSession.getRDFBackground.", "author": "jeenbroekstra", "createdAt": "2020-03-22T02:57:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjEwOTU1OA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396109558", "bodyText": "SPARQLProtocolSession.getRDFBackground is based on headers and not content. It gets the content type from the headers and then passes the content of the response to the parser. It never checks anything from the content.\nWe could extend the content type, essentially like how application/json is extended to application/json+ld we could extend application/n-quads to be application/n-quads+shacl-validation-report or application/json+ld+shacl-validation-report.\nI still think I prefer a custom header. I'll post this to the SHACL forum, maybe someone has come up with something already that we can consider implementing too.", "author": "hmottestad", "createdAt": "2020-03-22T15:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0MDg5Ng==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396140896", "bodyText": "SPARQLProtocolSession.getRDFBackground is based on headers and not content. It gets the content type from the headers and then passes the content of the response to the parser. It never checks anything from the content.\n\nYes, I know, that's what I meant. Sorry if this wasn't clear, my point was that based purely on the status code and the response content type you can process the response body (streaming). No need for an additional custom header.", "author": "jeenbroekstra", "createdAt": "2020-03-22T21:06:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE0NTQ1MA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396145450", "bodyText": "Andy (Jena dev) proposed the same to my email on the SHACL public mailing list. application/shacl-validation-report+n-quads. I\u2019m starting to appreciate that. Will see what others reply before we decide. Would be nice if at least Jena and RDF4J did it the same way.", "author": "hmottestad", "createdAt": "2020-03-22T21:53:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjE2MTQzNA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396161434", "bodyText": "I hadn't even thought of a custom content type - I was just thinking of using plain text/turtle (or application/n-quads). That's all you need to parse the incoming data. Figuring out that it is a SHACL validation report can be done on the parsed model.\nI'm not against a custom content type per se but it's important to realize that unless a client has been specifically built to recognize it, it won't be able to do anything with it.\n+1 on getting alignment between implementations though :)", "author": "jeenbroekstra", "createdAt": "2020-03-22T23:42:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYzNzc5NQ=="}], "type": "inlineReview"}, {"oid": "fc506ee086e31053ab79fb4de89ce30909d6efe5", "url": "https://github.com/eclipse/rdf4j/commit/fc506ee086e31053ab79fb4de89ce30909d6efe5", "message": "GH-1502 Create a SHACL exception in the ProtocolExceptionResolver instead of relying on a generic exception with a message\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-20T13:52:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MTg2NA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395891864", "bodyText": "Why are you sending the validation report with this tagged on, and as plain text? Wouldn't it make more sense to send just the turtle data, as text/turtle?", "author": "jeenbroekstra", "createdAt": "2020-03-20T21:12:16Z", "path": "tools/workbench/src/main/java/org/eclipse/rdf4j/workbench/proxy/WorkbenchServlet.java", "diffHunk": "@@ -127,7 +134,27 @@ private void handleRequest(final HttpServletRequest req, final HttpServletRespon\n \t\t} catch (UnauthorizedException e) {\n \t\t\thandleUnauthorizedException(req, resp);\n \t\t} catch (RepositoryConfigException | RepositoryException e) {\n-\t\t\tthrow new ServletException(e);\n+\t\t\tif (e.getCause() instanceof RemoteShaclSailValidationException) {\n+\t\t\t\tModel model = ((RemoteShaclSailValidationException) e.getCause()).validationReportAsModel();\n+\n+\t\t\t\tresp.setStatus(HttpServletResponse.SC_BAD_REQUEST);\n+\t\t\t\tresp.setContentType(TEXT_PLAIN);\n+\t\t\t\tPrintWriter writer = resp.getWriter();\n+\n+\t\t\t\twriter.println(\"SHACL validation failed with the following report:\\n\");\n+\t\t\t\tWriterConfig writerConfig = new WriterConfig();\n+\t\t\t\twriterConfig.set(BasicWriterSettings.PRETTY_PRINT, true);\n+\t\t\t\twriterConfig.set(BasicWriterSettings.INLINE_BLANK_NODES, true);\n+\t\t\t\tRio.write(model, writer, RDFFormat.TURTLE, writerConfig);\n+\n+\t\t\t\twriter.println(\n+\t\t\t\t\t\t\"\\n\" +\n+\t\t\t\t\t\t\t\t\"THIS ERROR MESSAGE IS EXPERIMENTAL AND IS SUBJECT TO CHANGE - \" +", "originalCommit": "a2fbffb4bee06952e7be6ff76a75721733133b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3Mjc4Mw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395972783", "bodyText": "It\u2019s just a simple way to display it to the user. In the future someone could extend the user interface to show the error properly, at which point it could be changed to work some other way.", "author": "hmottestad", "createdAt": "2020-03-21T08:12:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MTg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MDk4OA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395980988", "bodyText": "To explain further. This is actually a view layer issue...we need to return this error to the view layer in some way, but I've not started looking at the view layer of the workbench to figure out how to interact with it. Returning the text/plain here is just bypassing the view layer, returning text/turtle is not correct because the view layer is supposed to be html. Text/plain is just a temporary hack to make the error visible to the user. And by temporary I mean, probably permanent unless someone who built the workbench can help out.", "author": "hmottestad", "createdAt": "2020-03-21T10:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MTg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MTgwNA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395981804", "bodyText": "I, um, did. But it was a while back. Let me have a think about this, I don't want to make REST API decisions based on shortcomings of the client tool.", "author": "jeenbroekstra", "createdAt": "2020-03-21T10:39:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MTg2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0OTM0Nw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396049347", "bodyText": "Hang on, apologies, I completely misread this - for some reason I assumed I was looking at the RDF4J Server code, not the workbench. So yes - this makes much more sense now!", "author": "jeenbroekstra", "createdAt": "2020-03-22T03:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MTg2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MjMzNw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395892337", "bodyText": "Perhaps a 409 (conflict) is more specific.", "author": "jeenbroekstra", "createdAt": "2020-03-20T21:13:25Z", "path": "tools/workbench/src/main/java/org/eclipse/rdf4j/workbench/proxy/WorkbenchServlet.java", "diffHunk": "@@ -127,7 +134,27 @@ private void handleRequest(final HttpServletRequest req, final HttpServletRespon\n \t\t} catch (UnauthorizedException e) {\n \t\t\thandleUnauthorizedException(req, resp);\n \t\t} catch (RepositoryConfigException | RepositoryException e) {\n-\t\t\tthrow new ServletException(e);\n+\t\t\tif (e.getCause() instanceof RemoteShaclSailValidationException) {\n+\t\t\t\tModel model = ((RemoteShaclSailValidationException) e.getCause()).validationReportAsModel();\n+\n+\t\t\t\tresp.setStatus(HttpServletResponse.SC_BAD_REQUEST);", "originalCommit": "a2fbffb4bee06952e7be6ff76a75721733133b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3MzEyNQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395973125", "bodyText": "409 seems good. Hadn\u2019t heard of that one before.", "author": "hmottestad", "createdAt": "2020-03-21T08:18:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5MjMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzUxNQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395907515", "bodyText": "What purpose does this wrapper interface server? Can we do without?", "author": "jeenbroekstra", "createdAt": "2020-03-20T21:57:01Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/ModelInterface.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.http.client;\n+\n+import org.eclipse.rdf4j.model.Model;\n+import org.eclipse.rdf4j.model.Resource;\n+import org.eclipse.rdf4j.model.impl.DynamicModelFactory;\n+\n+public interface ModelInterface {", "originalCommit": "a2fbffb4bee06952e7be6ff76a75721733133b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MTQ4Mg==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395981482", "bodyText": "This is part of the way the shacl exception is built in the shacl sail. It will be moved into the common module. When that's done we can revisit how it's implemented.", "author": "hmottestad", "createdAt": "2020-03-21T10:34:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzUxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0OTIzMg==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396049232", "bodyText": "I would really prefer keeping this lean, and not introducing additional public interfaces unless there is a clear need for them. Unless I completely misunderstand this does not look like code that an end user should ever want to touch.", "author": "jeenbroekstra", "createdAt": "2020-03-22T02:59:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzUxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzYxMg==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395907612", "bodyText": "Should extend RDF4JException", "author": "jeenbroekstra", "createdAt": "2020-03-20T21:57:19Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/RemoteShaclSailValidationException.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.http.client;\n+\n+import org.eclipse.rdf4j.model.Model;\n+import org.eclipse.rdf4j.model.vocabulary.SHACL;\n+import org.eclipse.rdf4j.rio.RDFFormat;\n+\n+import java.io.StringReader;\n+\n+public class RemoteShaclSailValidationException extends Exception {", "originalCommit": "a2fbffb4bee06952e7be6ff76a75721733133b6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzkxMw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395907913", "bodyText": "What purpose does this wrapper serve? It seems to be pretty basic use of the Rio parser. Can we do without?", "author": "jeenbroekstra", "createdAt": "2020-03-20T21:58:14Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/RemoteValidation.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package org.eclipse.rdf4j.http.client;\n+\n+import org.eclipse.rdf4j.model.Model;\n+import org.eclipse.rdf4j.model.Resource;\n+import org.eclipse.rdf4j.rio.RDFFormat;\n+import org.eclipse.rdf4j.rio.Rio;\n+\n+import java.io.IOException;\n+import java.io.StringReader;\n+\n+public class RemoteValidation implements ModelInterface {", "originalCommit": "a2fbffb4bee06952e7be6ff76a75721733133b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MTU4Ng==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395981586", "bodyText": "Intention is to support streaming validation reports down the line. Hopefully I can build that as part of this branch, so that I can get the requirements down from the get go.", "author": "hmottestad", "createdAt": "2020-03-21T10:35:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzkxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MjA5MQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395982091", "bodyText": "Can we make it package private? I'm a little wary of introducing public interfaces and classes for this.", "author": "jeenbroekstra", "createdAt": "2020-03-21T10:44:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNzkxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODI0NA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395908244", "bodyText": "This is very RDF4J-specific. Shouldn't this be in the RDF4JProtocolSession instead?", "author": "jeenbroekstra", "createdAt": "2020-03-20T21:59:08Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/SPARQLProtocolSession.java", "diffHunk": "@@ -1041,6 +1044,10 @@ protected HttpResponse execute(HttpUriRequest method) throws IOException, RDF4JE\n \t\t\t\t\t\tthrow new MalformedQueryException(errInfo.getErrorMessage());\n \t\t\t\t\t} else if (errInfo.getErrorType() == ErrorType.UNSUPPORTED_QUERY_LANGUAGE) {\n \t\t\t\t\t\tthrow new UnsupportedQueryLanguageException(errInfo.getErrorMessage());\n+\t\t\t\t\t} else if (exceptionIs(response, \"ShaclSailValidationException\")) {", "originalCommit": "a2fbffb4bee06952e7be6ff76a75721733133b6f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3MzIwMA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395973200", "bodyText": "I can try to move it there and see if it works.", "author": "hmottestad", "createdAt": "2020-03-21T08:19:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODI0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4MjA2OQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r395982069", "bodyText": "Took a look now. This execute(....) method is what is used by RDF4JProtocolSession for its requests. RDF4JProtocolSession extends SPARQLProtocolSession. We should probably extract an even lower class that only implements execute(....) so that we can be sure that no one above can bypass it. This isn't in scope for this PR though.", "author": "hmottestad", "createdAt": "2020-03-21T10:43:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODI0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjA0OTI1NQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r396049255", "bodyText": "Fair enough, let's leave for now. It's not in the way.", "author": "jeenbroekstra", "createdAt": "2020-03-22T03:00:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwODI0NA=="}], "type": "inlineReview"}, {"oid": "69c42c2b38f5ee46163c3bd4e016679b994cb260", "url": "https://github.com/eclipse/rdf4j/commit/69c42c2b38f5ee46163c3bd4e016679b994cb260", "message": "GH-1900 changes header and status code\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-21T10:53:57Z", "type": "forcePushed"}, {"oid": "367886423e913f529a4296a314f89b8565e79a8b", "url": "https://github.com/eclipse/rdf4j/commit/367886423e913f529a4296a314f89b8565e79a8b", "message": "GH-1900 changes header and status code\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-21T11:02:18Z", "type": "forcePushed"}, {"oid": "b83b4702028bd2301e8c7ce010fb06e7d9f763c3", "url": "https://github.com/eclipse/rdf4j/commit/b83b4702028bd2301e8c7ce010fb06e7d9f763c3", "message": "GH-1900 created a new package for common SHACL exception interface\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-27T13:32:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTg5OA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r399585898", "bodyText": "I think this should be an abstract class, extending RDF4JException.\nI'd also rename to something more generic, like just ValidationException.", "author": "jeenbroekstra", "createdAt": "2020-03-27T23:48:24Z", "path": "core/sail/shacl-common/src/main/java/org/eclipse/rdf4j/sail/shaclcommon/ShaclSailValidationException.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shaclcommon;\n+\n+\n+import org.eclipse.rdf4j.model.Model;\n+import org.eclipse.rdf4j.sail.shaclcommon.results.ValidationReport;\n+\n+public interface ShaclSailValidationException  {", "originalCommit": "b83b4702028bd2301e8c7ce010fb06e7d9f763c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NjA0Ng==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r399586046", "bodyText": "I think this package name and the module is too specific. I'd suggest putting this in a package org.eclipse.rdf4j.common.validation.", "author": "jeenbroekstra", "createdAt": "2020-03-27T23:49:00Z", "path": "core/sail/shacl-common/src/main/java/org/eclipse/rdf4j/sail/shaclcommon/ShaclSailValidationException.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shaclcommon;", "originalCommit": "b83b4702028bd2301e8c7ce010fb06e7d9f763c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NjIzNA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r399586234", "bodyText": "I don't think you need this here. Doesn't the ValidationREport itself already have an asModel method?", "author": "jeenbroekstra", "createdAt": "2020-03-27T23:49:51Z", "path": "core/sail/shacl-common/src/main/java/org/eclipse/rdf4j/sail/shaclcommon/ShaclSailValidationException.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shaclcommon;\n+\n+\n+import org.eclipse.rdf4j.model.Model;\n+import org.eclipse.rdf4j.sail.shaclcommon.results.ValidationReport;\n+\n+public interface ShaclSailValidationException  {\n+\n+\n+\t/**\n+\t * @return A Model containing the validation report as specified by the SHACL Recommendation\n+\t */\n+\t Model validationReportAsModel() ;", "originalCommit": "b83b4702028bd2301e8c7ce010fb06e7d9f763c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY1ODE4MQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r399658181", "bodyText": "@jeenbroekstra\nThis is the exception that gets thrown by the client when the server responds with a 409 and the validation report. The ValidationException interface is now what's common between the regular ShaclSailValidationException and this exception. Users would then need to migrate to \"catch\" this interface instead of the ShaclSailValidationException if they only retrieve the model and want their code to be portable between a local ShaclSail and remote one.\nThings still left to consider:\n\nShould this exception extend the RDF4JException (which is deprecated) or SailException (which is what the ShaclSailValidationException does? Not sure why the RDF4JException isn't an interface instead of an abstract class.\nShould we mark this and the remote validation exception as experimental, since this isn't the final location of the interface at least?\nHow to support streaming validation reports?\nWhat are we going to do with the current java based validation report? Maybe deprecate it so we can move it and generalise it?", "author": "hmottestad", "createdAt": "2020-03-28T12:42:42Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/shacl/RemoteShaclSailValidationException.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.http.client.shacl;\n+\n+import org.eclipse.rdf4j.model.Model;\n+import org.eclipse.rdf4j.model.vocabulary.SHACL;\n+import org.eclipse.rdf4j.rio.RDFFormat;\n+import org.eclipse.rdf4j.sail.SailException;\n+import org.eclipse.rdf4j.exceptions.ValidationException;\n+\n+import java.io.StringReader;\n+\n+public class RemoteShaclSailValidationException extends SailException implements ValidationException {\n+\n+\tprivate final RemoteValidation remoteValidation;\n+\n+\tpublic RemoteShaclSailValidationException(StringReader stringReader, String s, RDFFormat format) {\n+\t\tremoteValidation = new RemoteValidation(stringReader, s, format);\n+\t}\n+\n+\t/**\n+\t * @return A Model containing the validation report as specified by the SHACL Recommendation\n+\t */\n+\t@Override\n+\tpublic Model validationReportAsModel() {\n+\t\tModel model = remoteValidation.asModel();\n+\t\tmodel.setNamespace(SHACL.PREFIX, SHACL.NAMESPACE);\n+\t\treturn model;\n+\n+\t}\n+\n+}", "originalCommit": "4ef09e5ea14e00279825aca06ea6cca385563891", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3OTU5MQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r399779591", "bodyText": "My take on things:\n\nRDF4JException isn't deprecated. It inherits from the old OpenRDFException (which is deprecated, and is a class because we made a design decision that all RDF4J exceptions are unchecked (so it needs to extend RuntimeException). Actually SailException itself extends RDF4JException as well (all RDF4J exceptions do).  I still find the naming not quite right. The word \"SAIL\" shouldn't appear on the client side at all. Sails are an internal server-side matter. So the server-side version of the ValidationException should be called ShaclValidationException or something like that, and probably extend SailException. But the client-side version should be called something like RemoteShaclValidationException or something like that, but not have Sail in its name, and not extend SailException\nmarking things experimental is always good for a new feature - it gives us leeway :)\nYAGNI (or at the very least, not in scope for this iteration, though I'm fairly confident we can do something along these lines when it becomes necessary)\nis this the report functionality as previously released you mean? If we can deprecate it, keep it functional but then copy and migrate, that'd be ideal.", "author": "jeenbroekstra", "createdAt": "2020-03-29T10:49:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY1ODE4MQ=="}], "type": "inlineReview"}, {"oid": "24749743a0d4e973307885c6ce008a1b21d8d647", "url": "https://github.com/eclipse/rdf4j/commit/24749743a0d4e973307885c6ce008a1b21d8d647", "message": "GH-1900 renamed exception to reflect that it doesn't come from a sail and also canged which exception it inherits from\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-29T15:29:21Z", "type": "forcePushed"}, {"oid": "6410c9938bb2b485f34a567bf2e0e100a1524fa6", "url": "https://github.com/eclipse/rdf4j/commit/6410c9938bb2b485f34a567bf2e0e100a1524fa6", "message": "GH-1900 renamed exception to reflect that it doesn't come from a sail and also canged which exception it inherits from\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-29T16:16:15Z", "type": "forcePushed"}, {"oid": "90d6e1635704783cb929cd8adb7b47169750fdaf", "url": "https://github.com/eclipse/rdf4j/commit/90d6e1635704783cb929cd8adb7b47169750fdaf", "message": "GH-1900 use the ProtocolExceptionResolver to check if ShaclValidationException is present and extract the report so it can be used as the body of the response\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-30T11:28:56Z", "type": "commit"}, {"oid": "3fab174185971fdd6063ed69f28caa3ad048d17b", "url": "https://github.com/eclipse/rdf4j/commit/3fab174185971fdd6063ed69f28caa3ad048d17b", "message": "GH-1900 Create a SHACL exception in the ProtocolExceptionResolver instead of relying on a generic exception with a message\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-30T11:28:56Z", "type": "commit"}, {"oid": "06077c767f55b6beef05430c4f6303fd3eb4b5fc", "url": "https://github.com/eclipse/rdf4j/commit/06077c767f55b6beef05430c4f6303fd3eb4b5fc", "message": "GH-2022 print SHACL validation report in Workbench\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-30T11:28:56Z", "type": "commit"}, {"oid": "e61829da7eb11f6fa327f841e1620ad2b739d86a", "url": "https://github.com/eclipse/rdf4j/commit/e61829da7eb11f6fa327f841e1620ad2b739d86a", "message": "GH-1900 deprecated some classes and methods that are likely to be moved in the future.\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-30T11:28:56Z", "type": "forcePushed"}, {"oid": "f496a4a20a8bbcba2b1580f561b11c2bc6031302", "url": "https://github.com/eclipse/rdf4j/commit/f496a4a20a8bbcba2b1580f561b11c2bc6031302", "message": "GH-1900 updates based on feedback from andy and review\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-30T11:31:45Z", "type": "forcePushed"}, {"oid": "1893b2600d9e571e3b7bf81e60207c714381b1a9", "url": "https://github.com/eclipse/rdf4j/commit/1893b2600d9e571e3b7bf81e60207c714381b1a9", "message": "GH-1900 updates based on feedback from andy and review\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-30T11:45:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0NDY1Mg==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400544652", "bodyText": "Not a blocker for this PR, but: could you fix your formatter to not reorganize imports in this fashion? Most of our code follows the default Eclipse convention to have static imports first, then normal imports organized with anything from java.* at the top, then javax.* , then org.*, then com.*, then everything else.\nReason I ask is that I've had to resolve some merge conflicts in the past that were caused by imports being moved around, and it's a hassle.\nThis was never made explicit because in the past everyone on the project used Eclipse, so it was just the implicit default. Perhaps we should document this now that we have a more diverse toolset.", "author": "jeenbroekstra", "createdAt": "2020-03-30T22:59:00Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/SPARQLProtocolSession.java", "diffHunk": "@@ -102,6 +86,26 @@\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.OutputStream;\n+import java.io.StringReader;\n+import java.net.HttpURLConnection;\n+import java.net.URISyntaxException;\n+import java.nio.charset.Charset;\n+import java.nio.charset.IllegalCharsetNameException;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.concurrent.ExecutorService;\n+\n+import static org.eclipse.rdf4j.http.protocol.Protocol.ACCEPT_PARAM_NAME;", "originalCommit": "1893b2600d9e571e3b7bf81e60207c714381b1a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY1MjA1Mw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400652053", "bodyText": "Doesn\u2019t everyone almost everyone use IntelliJ now? Since this is the default with IntelliJ. Btw, I\u2019m not a fan of having to adjust my editor for every project, there was once an attempt at making a standardized editor config, maybe we should look at that. Also I think the maven formatter plugin should handle this and if it doesn\u2019t then we need to just live with the fact that the imports are going to change. I\u2019ll try not to optimize imports for files I don\u2019t touch. And also IntelliJ can fix import conflicts for you very easily.", "author": "hmottestad", "createdAt": "2020-03-31T05:28:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0NDY1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY3MTgxNw==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400671817", "bodyText": "Doesn\u2019t everyone almost everyone use IntelliJ now?\n\nNo.\n\nSince this is the default with IntelliJ. Btw, I\u2019m not a fan of having to adjust my editor for every project, there was once an attempt at making a standardized editor config, maybe we should look at that.\n\nTo some extent this is unavoidable in an open-source world I'm afraid. Every project has different conventions.\nThen again this one is not a huge deal. I'll cop the occasional merge conflict fallout (it doesn't happen very often anyway - mostly it can resolve it fine, and even if it doesn't it's easy to fix in the IDE).\n\nAlso I think the maven formatter plugin should handle this and if it doesn\u2019t then we need to just live with the fact that the imports are going to change. I\u2019ll try not to optimize imports for files I don\u2019t touch.\n\nI'll take a look at the formatter plugin, see if that's possible. Like I said earlier, we haven't really enforced this guideline before, and I'm not even sure what Netbeans (which Bart uses) does, so don't worry too much about it - I merely asked on the off chance it was a simple tweak on your end.", "author": "jeenbroekstra", "createdAt": "2020-03-31T06:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0NDY1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0NjUwNQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400546505", "bodyText": "Why is this a static? You're not using it in a static way, as far as I can tell, nor are there any other existing static methods in the ProtocolSession class. It think it can just be a private instance method.", "author": "jeenbroekstra", "createdAt": "2020-03-30T23:04:12Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/SPARQLProtocolSession.java", "diffHunk": "@@ -1055,6 +1066,62 @@ protected HttpResponse execute(HttpUriRequest method) throws IOException, RDF4JE\n \t\t}\n \t}\n \n+\tstatic RDFFormat getContentTypeSerialisation(HttpResponse response) {", "originalCommit": "1893b2600d9e571e3b7bf81e60207c714381b1a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY1MjQ4OQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400652489", "bodyText": "Doesn\u2019t rely on any instance data. This means it can be static, and if it can be static it should be static. Also much easier to test when it\u2019s static.", "author": "hmottestad", "createdAt": "2020-03-31T05:30:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU0NjUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1MTg4OQ==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400551889", "bodyText": "Missing curly braces.", "author": "jeenbroekstra", "createdAt": "2020-03-30T23:20:13Z", "path": "core/http/client/src/main/java/org/eclipse/rdf4j/http/client/SPARQLProtocolSession.java", "diffHunk": "@@ -1055,6 +1066,62 @@ protected HttpResponse execute(HttpUriRequest method) throws IOException, RDF4JE\n \t\t}\n \t}\n \n+\tstatic RDFFormat getContentTypeSerialisation(HttpResponse response) {\n+\t\tHeader[] headers = response.getHeaders(\"Content-Type\");\n+\n+\t\tSet<RDFFormat> rdfFormats = RDFParserRegistry.getInstance().getKeys();\n+\t\tif (rdfFormats.isEmpty()) {\n+\t\t\tthrow new RepositoryException(\"No tuple RDF parsers have been registered\");\n+\t\t}\n+\n+\t\tfor (Header header : headers) {\n+\t\t\tfor (HeaderElement element : header.getElements()) {\n+\t\t\t\t// SHACL Validation report Content-Type gets transformed from:\n+\t\t\t\t// application/shacl-validation-report+n-quads => application/n-quads\n+\t\t\t\t// application/shacl-validation-report+ld+json => application/ld+json\n+\t\t\t\t// text/shacl-validation-report+turtle => text/turtle\n+\n+\t\t\t\tString[] split = element.getName().split(\"\\\\+\");\n+\t\t\t\tStringBuilder serialisation = new StringBuilder(element.getName().split(\"/\")[0] + \"/\");\n+\t\t\t\tfor (int i = 1; i < split.length; i++) {\n+\t\t\t\t\tserialisation.append(split[i]);\n+\t\t\t\t\tif (i + 1 < split.length) {\n+\t\t\t\t\t\tserialisation.append(\"+\");\n+\t\t\t\t\t}\n+\t\t\t\t}\n+\n+\t\t\t\tlogger.debug(\"SHACL validation report is serialised as: \" + serialisation.toString());\n+\n+\t\t\t\tOptional<RDFFormat> rdfFormat = RDFFormat.matchMIMEType(serialisation.toString(), rdfFormats);\n+\n+\t\t\t\tif (rdfFormat.isPresent())\n+\t\t\t\t\treturn rdfFormat.get();", "originalCommit": "1893b2600d9e571e3b7bf81e60207c714381b1a9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY1MjY1NA==", "url": "https://github.com/eclipse/rdf4j/pull/2025#discussion_r400652654", "bodyText": "Will fix.", "author": "hmottestad", "createdAt": "2020-03-31T05:30:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU1MTg4OQ=="}], "type": "inlineReview"}, {"oid": "96818898b1f795332edee08031ea7ab0da27bfa4", "url": "https://github.com/eclipse/rdf4j/commit/96818898b1f795332edee08031ea7ab0da27bfa4", "message": "GH-1900 updates based on feedback from andy and review\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-31T06:19:31Z", "type": "commit"}, {"oid": "96818898b1f795332edee08031ea7ab0da27bfa4", "url": "https://github.com/eclipse/rdf4j/commit/96818898b1f795332edee08031ea7ab0da27bfa4", "message": "GH-1900 updates based on feedback from andy and review\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-03-31T06:19:31Z", "type": "forcePushed"}]}