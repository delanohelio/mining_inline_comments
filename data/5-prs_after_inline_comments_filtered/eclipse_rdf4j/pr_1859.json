{"pr_number": 1859, "pr_title": "GH-1555: add example on how to use FedX with RemoteRepositoryManager", "pr_createdAt": "2020-01-20T20:28:06Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/1859", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MTUxMg==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368741512", "bodyText": "Missing copyright header.", "author": "jeenbroekstra", "createdAt": "2020-01-20T22:11:04Z", "path": "tools/federation/src/test/java/demos/FedXWithRemoteRepositoryManager.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package demos;", "originalCommit": "44990bb440e8eea881ffd8f806217c2a30491a48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0MTQ2OQ==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368841469", "bodyText": "Done, added in amended commit", "author": "aschwarte10", "createdAt": "2020-01-21T07:17:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MTUxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MTk4Ng==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368741986", "bodyText": "This reminds me: calling init() should not be mandatory. I'm not sure if the FedXRepository implements that (as it's a fairly new thing).", "author": "jeenbroekstra", "createdAt": "2020-01-20T22:13:27Z", "path": "tools/federation/src/test/java/demos/FedXWithRemoteRepositoryManager.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package demos;\n+\n+import org.eclipse.rdf4j.federated.FedXFactory;\n+import org.eclipse.rdf4j.model.Statement;\n+import org.eclipse.rdf4j.model.vocabulary.FOAF;\n+import org.eclipse.rdf4j.model.vocabulary.RDF;\n+import org.eclipse.rdf4j.repository.Repository;\n+import org.eclipse.rdf4j.repository.RepositoryConnection;\n+import org.eclipse.rdf4j.repository.RepositoryResult;\n+import org.eclipse.rdf4j.repository.manager.RemoteRepositoryManager;\n+import org.eclipse.rdf4j.repository.manager.RepositoryManager;\n+\n+/**\n+ * Demo which shows an example of a local federation which uses repositories from a remote RDF4J instance as federation\n+ * members.\n+ * \n+ * @author Andreas Schwarte\n+ *\n+ */\n+public class FedXWithRemoteRepositoryManager {\n+\n+\tpublic static void main(String[] args) throws Exception {\n+\n+\t\t// connection URL of a RDF4J server which manages the repositories\n+\t\tString serverUrl = \"http://localhost:8080/rdf4j-server\";\n+\t\tRepositoryManager repoManager = new RemoteRepositoryManager(serverUrl);\n+\n+\t\t// assumes that remote repositories exist\n+\t\tRepository repo = FedXFactory.newFederation()\n+\t\t\t\t.withRepositoryResolver(repoManager)\n+\t\t\t\t.withResolvableEndpoint(\"my-repository-1\")\n+\t\t\t\t.withResolvableEndpoint(\"my-repository-2\")\n+\t\t\t\t.create();\n+\n+\t\trepo.init();", "originalCommit": "44990bb440e8eea881ffd8f806217c2a30491a48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0MTU5OA==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368841598", "bodyText": "Good point, just tested and it does not yet work. I'll track an issue and provide a fix for 3.1", "author": "aschwarte10", "createdAt": "2020-01-21T07:18:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MTk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MjUyOQ==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368742529", "bodyText": "You can just do a shutDown on the repoManager, it will shut down the actual repository for you. And perhaps, if we're a bit paranoid, this should be in a finally clause.", "author": "jeenbroekstra", "createdAt": "2020-01-20T22:15:57Z", "path": "tools/federation/src/test/java/demos/FedXWithRemoteRepositoryManager.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package demos;\n+\n+import org.eclipse.rdf4j.federated.FedXFactory;\n+import org.eclipse.rdf4j.model.Statement;\n+import org.eclipse.rdf4j.model.vocabulary.FOAF;\n+import org.eclipse.rdf4j.model.vocabulary.RDF;\n+import org.eclipse.rdf4j.repository.Repository;\n+import org.eclipse.rdf4j.repository.RepositoryConnection;\n+import org.eclipse.rdf4j.repository.RepositoryResult;\n+import org.eclipse.rdf4j.repository.manager.RemoteRepositoryManager;\n+import org.eclipse.rdf4j.repository.manager.RepositoryManager;\n+\n+/**\n+ * Demo which shows an example of a local federation which uses repositories from a remote RDF4J instance as federation\n+ * members.\n+ * \n+ * @author Andreas Schwarte\n+ *\n+ */\n+public class FedXWithRemoteRepositoryManager {\n+\n+\tpublic static void main(String[] args) throws Exception {\n+\n+\t\t// connection URL of a RDF4J server which manages the repositories\n+\t\tString serverUrl = \"http://localhost:8080/rdf4j-server\";\n+\t\tRepositoryManager repoManager = new RemoteRepositoryManager(serverUrl);\n+\n+\t\t// assumes that remote repositories exist\n+\t\tRepository repo = FedXFactory.newFederation()\n+\t\t\t\t.withRepositoryResolver(repoManager)\n+\t\t\t\t.withResolvableEndpoint(\"my-repository-1\")\n+\t\t\t\t.withResolvableEndpoint(\"my-repository-2\")\n+\t\t\t\t.create();\n+\n+\t\trepo.init();\n+\n+\t\ttry (RepositoryConnection conn = repo.getConnection()) {\n+\t\t\ttry (RepositoryResult<Statement> repoResult = conn.getStatements(null, RDF.TYPE, FOAF.PERSON)) {\n+\t\t\t\trepoResult.forEach(st -> System.out.println(st));\n+\t\t\t}\n+\t\t}\n+\n+\t\trepo.shutDown();\n+\t\trepoManager.shutDown();", "originalCommit": "44990bb440e8eea881ffd8f806217c2a30491a48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0MzM1MA==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368843350", "bodyText": "The FedX repository is actually a local repository, while only the federation members are managed in the remote repository manager (i.e. in the HTTP server). Thus the shutdown is required. I tried to make this a bit more explicit in the example by naming the variable \"localRepo\"\nThe finally for the shutdown I typically omit in the very simplistic examples. I typically only add the try with resources for connections and tuple results.", "author": "aschwarte10", "createdAt": "2020-01-21T07:24:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MjUyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2MjQ4MQ==", "url": "https://github.com/eclipse/rdf4j/pull/1859#discussion_r368862481", "bodyText": "Fair enough, makes sense.", "author": "jeenbroekstra", "createdAt": "2020-01-21T08:25:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODc0MjUyOQ=="}], "type": "inlineReview"}, {"oid": "00d9f95cf245891d165d0f45e1592048fcd207dc", "url": "https://github.com/eclipse/rdf4j/commit/00d9f95cf245891d165d0f45e1592048fcd207dc", "message": "GH-1555: add example on how to use FedX with RemoteRepositoryManager", "committedDate": "2020-01-21T07:16:52Z", "type": "commit"}, {"oid": "00d9f95cf245891d165d0f45e1592048fcd207dc", "url": "https://github.com/eclipse/rdf4j/commit/00d9f95cf245891d165d0f45e1592048fcd207dc", "message": "GH-1555: add example on how to use FedX with RemoteRepositoryManager", "committedDate": "2020-01-21T07:16:52Z", "type": "forcePushed"}]}