{"pr_number": 2316, "pr_title": "GH-2315 bugfix: some complex unicode characters fail to unread properly", "pr_createdAt": "2020-06-14T20:10:24Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2316", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r439878460", "bodyText": "Good catch, thanks!", "author": "jeenbroekstra", "createdAt": "2020-06-14T23:28:35Z", "path": "core/rio/turtle/src/main/java/org/eclipse/rdf4j/rio/turtle/TurtleParser.java", "diffHunk": "@@ -1254,13 +1254,16 @@ protected void unread(int codePoint) throws IOException {\n \t * @throws IOException\n \t */\n \tprotected void unread(String string) throws IOException {\n-\t\tfor (int i = string.codePointCount(0, string.length()); i >= 1; i--) {\n+\t\tint i = string.codePointCount(0, string.length());\n+\t\twhile ( i > 0 ) {\n \t\t\tfinal int codePoint = string.codePointBefore(i);\n \t\t\tif (Character.isSupplementaryCodePoint(codePoint)) {\n \t\t\t\tfinal char[] surrogatePair = Character.toChars(codePoint);\n \t\t\t\treader.unread(surrogatePair);\n+\t\t\t\ti -= surrogatePair.length();", "originalCommit": "19e94e7614be73267a7e43a7aeac364167ca34c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI5NTQyMg==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r440295422", "bodyText": "@jeenbroekstra I added a test, which sadly shows this still fail, and fix was not enough.\nI'm not sure where the problem lies. Also not sure If I'll have time to continue debugging this.\nWill you be able to take this from here?", "author": "hochgi", "createdAt": "2020-06-15T16:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ5MzI1MQ==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r440493251", "bodyText": "No problem - though can you still make sure you sign the ECA so we can continue from your work? Otherwise, I'm afraid we'll have to drop this and start from scratch.", "author": "jeenbroekstra", "createdAt": "2020-06-15T23:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ5NDk2OA==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r440494968", "bodyText": "@hochgi Oh hang, I see you've signed off and that your ECA has been completed as well, so that's all good.\nIt's currently failing because this PR also contains a commit by @elad-shaked, who has signed off, but their e-mail address (elad.shaked @ sparkbeyond.com) is not recognized by the ECA verifier. @elad-shaked if you could sign the ECA that'd be great. Otherwise, since your commit is only formatting-related related, I can work around it by cherrypicking the other fixes onto a new branch.", "author": "jeenbroekstra", "createdAt": "2020-06-15T23:08:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDYwMDkzNA==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r440600934", "bodyText": "as per @elad-shaked's request I just squashed his changes into mine.", "author": "hochgi", "createdAt": "2020-06-16T05:51:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxNjM2OA==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r440916368", "bodyText": "@jeenbroekstra just committed a fix suggested by @elad-shaked, and this seems to work \ud83d\udc4d", "author": "hochgi", "createdAt": "2020-06-16T14:55:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4MjMzNw==", "url": "https://github.com/eclipse/rdf4j/pull/2316#discussion_r440982337", "bodyText": "@jeenbroekstra running mvn test from core passes locally but fails in CI \ud83d\ude15", "author": "hochgi", "createdAt": "2020-06-16T16:25:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg3ODQ2MA=="}], "type": "inlineReview"}, {"oid": "2fadca5bbe4f6e73ee934a939b76a00f686eab28", "url": "https://github.com/eclipse/rdf4j/commit/2fadca5bbe4f6e73ee934a939b76a00f686eab28", "message": "GH-2315 fixed formatting & remove redundant parens", "committedDate": "2020-06-15T14:23:42Z", "type": "forcePushed"}, {"oid": "e4fd6e24a3e502f162bb14102fd5719438ee43eb", "url": "https://github.com/eclipse/rdf4j/commit/e4fd6e24a3e502f162bb14102fd5719438ee43eb", "message": "GH-2315 fixed formatting & remove redundant parens\n\nSigned-off-by: Elad Shaked <elad.shaked@sparkbeyond.com>", "committedDate": "2020-06-15T14:37:26Z", "type": "forcePushed"}, {"oid": "6e25c9e95b47f29a18ed70e1fec65685d1248395", "url": "https://github.com/eclipse/rdf4j/commit/6e25c9e95b47f29a18ed70e1fec65685d1248395", "message": "GH-2315 added a test case that fails \u2192 fix wasn't enough \ud83d\ude15\n\nSigned-off-by: hochgi <giladhoch@gmail.com>", "committedDate": "2020-06-15T16:16:21Z", "type": "forcePushed"}, {"oid": "dc398361d964b5c9579826b0f2977b28ed32a53e", "url": "https://github.com/eclipse/rdf4j/commit/dc398361d964b5c9579826b0f2977b28ed32a53e", "message": "GH-2315 bugfix: some complex unicode characters fail to unread properly\n\ne.g. this character:\nhttps://www.compart.com/en/unicode/U+1109D\n\nthe following string fail to unread:\n```\n\"<r:\\uD804\\uDC9D>\"\n```\nsince same position is loaded more than once into reader's buf.\n\nSigned-off-by: hochgi <giladhoch@gmail.com>", "committedDate": "2020-06-16T05:48:47Z", "type": "commit"}, {"oid": "e886ce8f89c99fc40d002d82f2f881d0a8adc266", "url": "https://github.com/eclipse/rdf4j/commit/e886ce8f89c99fc40d002d82f2f881d0a8adc266", "message": "GH-2315 added a test case that fails \u2192 fix wasn't enough \ud83d\ude15\n\nSigned-off-by: hochgi <giladhoch@gmail.com>", "committedDate": "2020-06-16T05:49:05Z", "type": "commit"}, {"oid": "e886ce8f89c99fc40d002d82f2f881d0a8adc266", "url": "https://github.com/eclipse/rdf4j/commit/e886ce8f89c99fc40d002d82f2f881d0a8adc266", "message": "GH-2315 added a test case that fails \u2192 fix wasn't enough \ud83d\ude15\n\nSigned-off-by: hochgi <giladhoch@gmail.com>", "committedDate": "2020-06-16T05:49:05Z", "type": "forcePushed"}, {"oid": "9f2e223559c292fc16135c64fe11b01f9136eedd", "url": "https://github.com/eclipse/rdf4j/commit/9f2e223559c292fc16135c64fe11b01f9136eedd", "message": "GH-2315 root cause found by @elad-shaked - needed to loop according to string.length instead of string.codePointCount\n\nSigned-off-by: hochgi <giladhoch@gmail.com>", "committedDate": "2020-06-16T14:54:17Z", "type": "commit"}]}