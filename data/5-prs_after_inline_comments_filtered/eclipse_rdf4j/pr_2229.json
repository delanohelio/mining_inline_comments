{"pr_number": 2229, "pr_title": "GH-2017 SHACL support for advanced targeting", "pr_createdAt": "2020-05-16T11:04:22Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2229", "timeline": [{"oid": "49165ecaf44d8049ef0887323ced433e670560db", "url": "https://github.com/eclipse/rdf4j/commit/49165ecaf44d8049ef0887323ced433e670560db", "message": "GH-2017 initial test case and implementation\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-13T21:02:25Z", "type": "commit"}, {"oid": "33094b4f3c50a99f9b1a4f5528c51fbf031e6ec1", "url": "https://github.com/eclipse/rdf4j/commit/33094b4f3c50a99f9b1a4f5528c51fbf031e6ec1", "message": "more test cases\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-14T14:11:00Z", "type": "commit"}, {"oid": "b8f6e531dcea5cbcf14cf42627365a0b6aa2955c", "url": "https://github.com/eclipse/rdf4j/commit/b8f6e531dcea5cbcf14cf42627365a0b6aa2955c", "message": "GH-1912 initial sparql target support\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-14T15:12:43Z", "type": "commit"}, {"oid": "07e22c17cdcf83d3565f85fe40bc69e83f3b0442", "url": "https://github.com/eclipse/rdf4j/commit/07e22c17cdcf83d3565f85fe40bc69e83f3b0442", "message": "better support for sparql targets\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-14T18:47:50Z", "type": "commit"}, {"oid": "8b1c2219b1017f91e527d52b20aacd4c404feb78", "url": "https://github.com/eclipse/rdf4j/commit/8b1c2219b1017f91e527d52b20aacd4c404feb78", "message": "GH-1912 better support for sparql targets\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T10:41:38Z", "type": "commit"}, {"oid": "a63706034b55cd6d75138f649495c654b8c20724", "url": "https://github.com/eclipse/rdf4j/commit/a63706034b55cd6d75138f649495c654b8c20724", "message": "test\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T10:46:31Z", "type": "commit"}, {"oid": "63d287620a245f019901796108a7f255104cb926", "url": "https://github.com/eclipse/rdf4j/commit/63d287620a245f019901796108a7f255104cb926", "message": "more sparql target tests\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T10:55:08Z", "type": "commit"}, {"oid": "6e8606e6c8fe3d50856a5b3d75eca59e3ce49494", "url": "https://github.com/eclipse/rdf4j/commit/6e8606e6c8fe3d50856a5b3d75eca59e3ce49494", "message": "fixed typo\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T10:58:01Z", "type": "commit"}, {"oid": "9405a569eb88fb57f5e69f5653d31b7b8bc63863", "url": "https://github.com/eclipse/rdf4j/commit/9405a569eb88fb57f5e69f5653d31b7b8bc63863", "message": "change targetClass to targetObject for new compound targetting\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T11:02:01Z", "type": "commit"}, {"oid": "47127dfb653f63cb3c1acf541642c1374c1fe5b8", "url": "https://github.com/eclipse/rdf4j/commit/47127dfb653f63cb3c1acf541642c1374c1fe5b8", "message": "benchmark\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T11:03:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjE0NDQzOQ==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r426144439", "bodyText": "Use this main method to compare performance between SPARQL targets and predicate+object targets. The benchmarks test how the number of targets already present in the database affect the performance of a standard number (and size) of transactions.", "author": "hmottestad", "createdAt": "2020-05-16T11:15:02Z", "path": "core/sail/shacl/src/test/java/org/eclipse/rdf4j/sail/shacl/benchmark/Main.java", "diffHunk": "@@ -24,7 +24,7 @@\n \t}\n \n \tpublic static void main(String[] args) throws RunnerException {\n-\t\tOptions opt = new OptionsBuilder().include(\"\")\n+\t\tOptions opt = new OptionsBuilder().include(\"TargetBenchmarkInitialData.*\")\n \n \t\t\t\t// .addProfiler(\"stack\", \"lines=20;period=1;top=20\")\n \t\t\t\t.build();", "originalCommit": "47127dfb653f63cb3c1acf541642c1374c1fe5b8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3cf2572665174d79aadcdb9cc643df88d337434", "url": "https://github.com/eclipse/rdf4j/commit/e3cf2572665174d79aadcdb9cc643df88d337434", "message": "fix supported features docs\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T11:19:01Z", "type": "commit"}, {"oid": "e681077b331cc2e646dc158f01c086efbadd5908", "url": "https://github.com/eclipse/rdf4j/commit/e681077b331cc2e646dc158f01c086efbadd5908", "message": "Trigger GitHub ci", "committedDate": "2020-05-16T13:33:38Z", "type": "commit"}, {"oid": "b73b1c3f8331dd1cf025595e6fb6fff609491585", "url": "https://github.com/eclipse/rdf4j/commit/b73b1c3f8331dd1cf025595e6fb6fff609491585", "message": "improved benchmarks\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-16T16:14:00Z", "type": "commit"}, {"oid": "6a53634f978d0343c347ffd890a8b01be41b38bc", "url": "https://github.com/eclipse/rdf4j/commit/6a53634f978d0343c347ffd890a8b01be41b38bc", "message": "Merge branch 'develop' into GH-2017-shacl-advanced-predicate-object-targets\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-19T14:53:20Z", "type": "commit"}, {"oid": "09fdef2c1a6ce0ed059c646e31daf92ca8345d12", "url": "https://github.com/eclipse/rdf4j/commit/09fdef2c1a6ce0ed059c646e31daf92ca8345d12", "message": "GH-2017 introduce support for dash:AllObjectsTarget and AllSubjectsTarget in order to support the filter structure\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-24T10:03:42Z", "type": "commit"}, {"oid": "80c32351549962d48b3e1a151e4512469e04dd63", "url": "https://github.com/eclipse/rdf4j/commit/80c32351549962d48b3e1a151e4512469e04dd63", "message": "GH-2017 initial support for filter shapes\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-26T07:27:12Z", "type": "commit"}, {"oid": "e5cb7526b38fc1ab13ffb592e1ebecd87de4ca6a", "url": "https://github.com/eclipse/rdf4j/commit/e5cb7526b38fc1ab13ffb592e1ebecd87de4ca6a", "message": "fix up tests\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-26T07:53:37Z", "type": "commit"}, {"oid": "ef3c62cfa33e03b26291cc8e2edf5c6948e4c475", "url": "https://github.com/eclipse/rdf4j/commit/ef3c62cfa33e03b26291cc8e2edf5c6948e4c475", "message": "cleanup\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-26T08:12:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1OTc0Ng==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r430259746", "bodyText": "I think this is what causes your current compile failure - on the develop branch, the import for XMLSchema in this class has been replaced with XSD. CI tries to build the PR after merging, and fails because it misses the import.\nEasiest way to fix is to rebase and then replace this reference with XSD.", "author": "jeenbroekstra", "createdAt": "2020-05-26T08:57:30Z", "path": "core/sail/shacl/src/test/java/org/eclipse/rdf4j/sail/shacl/AbstractShaclTest.java", "diffHunk": "@@ -273,7 +295,7 @@ static void runTestCase(String shaclPath, String dataPath, ExpectedResult expect\n \t\t\t\tconnection.begin(isolationLevel);\n \t\t\t\tValueFactory vf = connection.getValueFactory();\n \t\t\t\tconnection.add(vf.createBNode(), vf.createIRI(\"http://example.com/jkhsdfiu3r2y9fjr3u0\"),\n-\t\t\t\t\t\tvf.createLiteral(\"auto-generated!\"), vf.createBNode());\n+\t\t\t\t\t\tvf.createLiteral(\"123\", XMLSchema.INTEGER), vf.createBNode());", "originalCommit": "ef3c62cfa33e03b26291cc8e2edf5c6948e4c475", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI3ODE2NQ==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r430278165", "bodyText": "Ahh. That makes sense. The import gets changed to XSD, but the reference XMLSchema.INTEGER can't resolve.", "author": "hmottestad", "createdAt": "2020-05-26T09:27:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1OTc0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2MTM5NQ==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r430261395", "bodyText": "This copyright header looks a bit odd: it's missing the full lines of asterisks at beginning and end.", "author": "jeenbroekstra", "createdAt": "2020-05-26T09:00:04Z", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/vocabulary/DASH.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/**\n+ * Copyright (c) 2020 Eclipse RDF4J contributors, and others.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ */", "originalCommit": "ef3c62cfa33e03b26291cc8e2edf5c6948e4c475", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "955cde3ff8ab802326c92babbef9992530287fa3", "url": "https://github.com/eclipse/rdf4j/commit/955cde3ff8ab802326c92babbef9992530287fa3", "message": "merge develop\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-26T09:35:56Z", "type": "commit"}, {"oid": "c2f1fa53a8752827cac78a2343f75c966eeb9d19", "url": "https://github.com/eclipse/rdf4j/commit/c2f1fa53a8752827cac78a2343f75c966eeb9d19", "message": "fix dash vocab file\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-26T09:40:11Z", "type": "commit"}, {"oid": "dc908186a1ab6b13803cb6fb0b37f4b8f3d6f8f3", "url": "https://github.com/eclipse/rdf4j/commit/dc908186a1ab6b13803cb6fb0b37f4b8f3d6f8f3", "message": "fix after merge\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-26T09:47:19Z", "type": "commit"}, {"oid": "8b417c07ce7526a912834d58b885afe5d4aa013f", "url": "https://github.com/eclipse/rdf4j/commit/8b417c07ce7526a912834d58b885afe5d4aa013f", "message": "refactoring to better handle target filters\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-27T14:00:43Z", "type": "commit"}, {"oid": "b552cf4cc48c5b2e5377dfc2c9b3cd29855db1ef", "url": "https://github.com/eclipse/rdf4j/commit/b552cf4cc48c5b2e5377dfc2c9b3cd29855db1ef", "message": "merge develop\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T10:36:36Z", "type": "commit"}, {"oid": "9c5aa5a846d8973ed8107cf25688e1efabd01c30", "url": "https://github.com/eclipse/rdf4j/commit/9c5aa5a846d8973ed8107cf25688e1efabd01c30", "message": "merge fixes\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T10:49:22Z", "type": "commit"}, {"oid": "3326bd66259b065b272b11b47c05faf6b801177c", "url": "https://github.com/eclipse/rdf4j/commit/3326bd66259b065b272b11b47c05faf6b801177c", "message": "Support for dash constants for dash:AllSubjects and dash:AllObjects\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T11:09:18Z", "type": "commit"}, {"oid": "ccbc28e48c99a2f6174330fc074674c7074bc93d", "url": "https://github.com/eclipse/rdf4j/commit/ccbc28e48c99a2f6174330fc074674c7074bc93d", "message": "refactored code\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T13:27:32Z", "type": "commit"}, {"oid": "8a244d34e1fa0f4dc2e8dfc5c5a69eeb42ba1686", "url": "https://github.com/eclipse/rdf4j/commit/8a244d34e1fa0f4dc2e8dfc5c5a69eeb42ba1686", "message": "final code for toggle for experimental filter shapes\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T13:39:13Z", "type": "commit"}, {"oid": "0ac1d75620ae7515e8da4542032faf9019e1726a", "url": "https://github.com/eclipse/rdf4j/commit/0ac1d75620ae7515e8da4542032faf9019e1726a", "message": "added test cases for sh:hasValue\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T13:52:14Z", "type": "commit"}, {"oid": "6129b046d404346ceb4f06f61fe4fca2e7836a81", "url": "https://github.com/eclipse/rdf4j/commit/6129b046d404346ceb4f06f61fe4fca2e7836a81", "message": "more test cases for hasValue and also fix for empty sh:and, sh:or, sh:not\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T14:25:25Z", "type": "commit"}, {"oid": "5bb2bc06e46246393049ff59c09546ab6bdd3353", "url": "https://github.com/eclipse/rdf4j/commit/5bb2bc06e46246393049ff59c09546ab6bdd3353", "message": "moving shapes back where they came from, will do the bigger refactor in the new AST branch\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T14:56:43Z", "type": "commit"}, {"oid": "5b13e90c175b1c91578962e1bc84f16fc5f1e464", "url": "https://github.com/eclipse/rdf4j/commit/5b13e90c175b1c91578962e1bc84f16fc5f1e464", "message": "code cleanup\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T16:19:37Z", "type": "commit"}, {"oid": "9bd77d1fe730225bf26587336b25360a31c0de7f", "url": "https://github.com/eclipse/rdf4j/commit/9bd77d1fe730225bf26587336b25360a31c0de7f", "message": "support for sh:hasValue\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T19:41:33Z", "type": "commit"}, {"oid": "4520a620597994dfc024cef9c411b90194a91466", "url": "https://github.com/eclipse/rdf4j/commit/4520a620597994dfc024cef9c411b90194a91466", "message": "more javadocs\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T19:54:50Z", "type": "commit"}, {"oid": "c3049c16f8bc3b9ab6c7431c92da01094cc2f38c", "url": "https://github.com/eclipse/rdf4j/commit/c3049c16f8bc3b9ab6c7431c92da01094cc2f38c", "message": "remove unused tests\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T20:01:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Mjg0OA==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r432882848", "bodyText": "I have chosen to go with the more natural naming rather than the forced uppercase.", "author": "hmottestad", "createdAt": "2020-05-30T20:03:30Z", "path": "core/model/src/main/java/org/eclipse/rdf4j/model/vocabulary/DASH.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.model.vocabulary;\n+\n+import org.eclipse.rdf4j.model.IRI;\n+import org.eclipse.rdf4j.model.Namespace;\n+import org.eclipse.rdf4j.model.ValueFactory;\n+import org.eclipse.rdf4j.model.impl.SimpleNamespace;\n+import org.eclipse.rdf4j.model.impl.SimpleValueFactory;\n+\n+public class DASH {\n+\n+\tpublic static final String NAMESPACE = \"http://datashapes.org/dash#\";\n+\n+\tpublic static final String PREFIX = \"dash\";\n+\n+\t/**\n+\t * An immutable {@link Namespace} constant that represents the namespace.\n+\t */\n+\tpublic static final Namespace NS = new SimpleNamespace(PREFIX, NAMESPACE);\n+\n+\tstatic private final ValueFactory vf = SimpleValueFactory.getInstance();\n+\n+\tpublic static final IRI AllObjectsTarget = createIRI(\"AllObjectsTarget\");\n+\tpublic static final IRI AllSubjectsTarget = createIRI(\"AllSubjectsTarget\");", "originalCommit": "c3049c16f8bc3b9ab6c7431c92da01094cc2f38c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Mjg5MQ==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r432882891", "bodyText": "This is to be able to make sure that the getTargetFilter on NodeShape only operates on the base connection.", "author": "hmottestad", "createdAt": "2020-05-30T20:04:24Z", "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/AST/AbstractSimplePropertyShape.java", "diffHunk": "@@ -101,7 +101,7 @@ static public PlanNode getGenericSingleObjectPlan(ConnectionsGroup connectionsGr\n \n \t\t\tPlanNode discardedRight = innerJoin.getDiscardedRight(BufferedPlanNode.class);\n \n-\t\t\tPlanNode typeFilterPlan = nodeShape.getTargetFilter(connectionsGroup.getBaseConnection(), discardedRight);\n+\t\t\tPlanNode typeFilterPlan = nodeShape.getTargetFilter(connectionsGroup, discardedRight);", "originalCommit": "c3049c16f8bc3b9ab6c7431c92da01094cc2f38c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MzAxMw==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r432883013", "bodyText": "Removed doesn't guarantee to only return this that have been removed, but must return everything that could potentially have been removed. So this implementation will be fine.", "author": "hmottestad", "createdAt": "2020-05-30T20:05:41Z", "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/AST/AllObjectsTarget.java", "diffHunk": "@@ -0,0 +1,126 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shacl.AST;\n+\n+import java.util.UUID;\n+\n+import org.eclipse.rdf4j.model.Resource;\n+import org.eclipse.rdf4j.repository.sail.SailRepositoryConnection;\n+import org.eclipse.rdf4j.sail.SailConnection;\n+import org.eclipse.rdf4j.sail.shacl.ConnectionsGroup;\n+import org.eclipse.rdf4j.sail.shacl.RdfsSubClassOfReasoner;\n+import org.eclipse.rdf4j.sail.shacl.ShaclSail;\n+import org.eclipse.rdf4j.sail.shacl.Stats;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.ExternalFilterIsObject;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.PlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.PlanNodeProvider;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Sort;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.TrimTuple;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.UnBufferedPlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Unique;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.UnorderedSelect;\n+\n+/**\n+ * sh:targetObjectsOf\n+ *\n+ * @author H\u00e5vard Mikkelsen Ottestad\n+ */\n+public class AllObjectsTarget extends NodeShape {\n+\n+\tAllObjectsTarget(Resource id, ShaclSail shaclSail, SailRepositoryConnection connection, boolean deactivated) {\n+\t\tsuper(id, shaclSail, connection, deactivated);\n+\t}\n+\n+\t@Override\n+\tpublic PlanNode getPlan(ConnectionsGroup connectionsGroup, boolean printPlans,\n+\t\t\tPlanNodeProvider overrideTargetNode, boolean negateThisPlan, boolean negateSubPlans) {\n+\t\tassert !negateSubPlans : \"There are no subplans!\";\n+\t\tassert !negateThisPlan;\n+\n+\t\tPlanNode select = new Unique(\n+\t\t\t\tnew Sort(\n+\t\t\t\t\t\tnew TrimTuple(\n+\t\t\t\t\t\t\t\tnew UnorderedSelect(\n+\t\t\t\t\t\t\t\t\t\tconnectionsGroup.getBaseConnection(),\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tUnorderedSelect.OutputPattern.ObjectPredicateSubject),\n+\t\t\t\t\t\t\t\t0,\n+\t\t\t\t\t\t\t\t1)));\n+\n+\t\treturn connectionsGroup.getCachedNodeFor(select);\n+\t}\n+\n+\t@Override\n+\tpublic PlanNode getPlanAddedStatements(ConnectionsGroup connectionsGroup,\n+\t\t\tPlaneNodeWrapper planeNodeWrapper) {\n+\n+\t\tPlanNode select = new Unique(\n+\t\t\t\tnew Sort(\n+\t\t\t\t\t\tnew TrimTuple(\n+\t\t\t\t\t\t\t\tnew UnorderedSelect(\n+\t\t\t\t\t\t\t\t\t\tconnectionsGroup.getAddedStatements(),\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tUnorderedSelect.OutputPattern.ObjectPredicateSubject),\n+\t\t\t\t\t\t\t\t0,\n+\t\t\t\t\t\t\t\t1)));\n+\n+\t\treturn connectionsGroup.getCachedNodeFor(select);\n+\t}\n+\n+\t@Override\n+\tpublic PlanNode getPlanRemovedStatements(ConnectionsGroup connectionsGroup,\n+\t\t\tPlaneNodeWrapper planeNodeWrapper) {\n+\t\tPlanNode select = new Unique(\n+\t\t\t\tnew Sort(\n+\t\t\t\t\t\tnew TrimTuple(\n+\t\t\t\t\t\t\t\tnew UnorderedSelect(\n+\t\t\t\t\t\t\t\t\t\tconnectionsGroup.getRemovedStatements(),\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tnull,\n+\t\t\t\t\t\t\t\t\t\tUnorderedSelect.OutputPattern.ObjectPredicateSubject),\n+\t\t\t\t\t\t\t\t0,\n+\t\t\t\t\t\t\t\t1)));\n+\n+\t\treturn connectionsGroup.getCachedNodeFor(select);\n+\t}", "originalCommit": "c3049c16f8bc3b9ab6c7431c92da01094cc2f38c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MzE0OQ==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r432883149", "bodyText": "AllSubjectsTarget is the only place where we are supporting sh:filterShape currently.", "author": "hmottestad", "createdAt": "2020-05-30T20:07:39Z", "path": "core/sail/shacl/src/main/java/org/eclipse/rdf4j/sail/shacl/AST/AllSubjectsTarget.java", "diffHunk": "@@ -0,0 +1,221 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shacl.AST;\n+\n+import java.util.List;\n+import java.util.UUID;\n+import java.util.stream.Collectors;\n+\n+import org.eclipse.rdf4j.model.IRI;\n+import org.eclipse.rdf4j.model.Resource;\n+import org.eclipse.rdf4j.query.algebra.StatementPattern;\n+import org.eclipse.rdf4j.repository.sail.SailRepositoryConnection;\n+import org.eclipse.rdf4j.sail.SailConnection;\n+import org.eclipse.rdf4j.sail.shacl.ConnectionsGroup;\n+import org.eclipse.rdf4j.sail.shacl.RdfsSubClassOfReasoner;\n+import org.eclipse.rdf4j.sail.shacl.ShaclSail;\n+import org.eclipse.rdf4j.sail.shacl.Stats;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.BulkedExternalInnerJoin;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.EmptyNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.ExternalFilterByQuery;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.ExternalFilterIsSubject;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.PlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.PlanNodeProvider;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Select;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Sort;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.TrimTuple;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.UnBufferedPlanNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.UnionNode;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.Unique;\n+import org.eclipse.rdf4j.sail.shacl.planNodes.UnorderedSelect;\n+\n+/**\n+ * sh:targetObjectsOf\n+ *\n+ * @author H\u00e5vard Mikkelsen Ottestad\n+ */\n+public class AllSubjectsTarget extends NodeShape {\n+\n+\tNodeShape filterShape;\n+\n+\tAllSubjectsTarget(Resource id, ShaclSail shaclSail, SailRepositoryConnection connection, boolean deactivated,\n+\t\t\tResource filterShape) {\n+\t\tsuper(id, shaclSail, connection, deactivated);\n+\t\tif (shaclSail.isExperimentalFilterShapeSupport() && filterShape != null) {\n+\t\t\tthis.filterShape = new NodeShape(filterShape, shaclSail, connection, false);\n+\t\t}\n+\n+\t}", "originalCommit": "c3049c16f8bc3b9ab6c7431c92da01094cc2f38c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "39119e191dae41585c657b9ea337d7cef971eb15", "url": "https://github.com/eclipse/rdf4j/commit/39119e191dae41585c657b9ea337d7cef971eb15", "message": "some simplification and docs\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-30T20:14:30Z", "type": "commit"}, {"oid": "d9f1bf839921abdbcabd9620e013c991ba1a6cf7", "url": "https://github.com/eclipse/rdf4j/commit/d9f1bf839921abdbcabd9620e013c991ba1a6cf7", "message": "fixed headers and more tests\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-31T07:47:10Z", "type": "commit"}, {"oid": "47d3f939ffb7130fdfd85803c70370411755e936", "url": "https://github.com/eclipse/rdf4j/commit/47d3f939ffb7130fdfd85803c70370411755e936", "message": "fix tests and some code cleanup\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-05-31T08:13:10Z", "type": "commit"}, {"oid": "0bfef82fed6c30b7d766e73525769d88f6e63c16", "url": "https://github.com/eclipse/rdf4j/commit/0bfef82fed6c30b7d766e73525769d88f6e63c16", "message": "code cleanup\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-02T07:13:01Z", "type": "commit"}, {"oid": "a0545f04c70fa1ccac69e84cc26e8139aad12f8a", "url": "https://github.com/eclipse/rdf4j/commit/a0545f04c70fa1ccac69e84cc26e8139aad12f8a", "message": "initial support for dash:valuesIn\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-06T15:10:23Z", "type": "commit"}, {"oid": "e316644305a57770e3e470aa1195917b428e07ec", "url": "https://github.com/eclipse/rdf4j/commit/e316644305a57770e3e470aa1195917b428e07ec", "message": "bechmark\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-06T16:23:03Z", "type": "commit"}, {"oid": "299a56814c64aa13db0738e9fa20b81563e1d073", "url": "https://github.com/eclipse/rdf4j/commit/299a56814c64aa13db0738e9fa20b81563e1d073", "message": "Merge branch 'develop' into GH-2017-shacl-advanced-predicate-object-targets", "committedDate": "2020-06-08T10:30:33Z", "type": "commit"}, {"oid": "bbf1eeee3dc09d676a1d5720e9e39f3868f79c3c", "url": "https://github.com/eclipse/rdf4j/commit/bbf1eeee3dc09d676a1d5720e9e39f3868f79c3c", "message": "Merge branch 'develop' into GH-2017-shacl-advanced-predicate-object-targets", "committedDate": "2020-06-11T05:47:34Z", "type": "commit"}, {"oid": "14a3630d4817a9a678a621b1c09912d67f749138", "url": "https://github.com/eclipse/rdf4j/commit/14a3630d4817a9a678a621b1c09912d67f749138", "message": "migrate to sh:targetShape\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-12T16:21:16Z", "type": "commit"}, {"oid": "dd661b561c3f5736362d3245ab47ec9caa16e119", "url": "https://github.com/eclipse/rdf4j/commit/dd661b561c3f5736362d3245ab47ec9caa16e119", "message": "Merge branch 'develop' into GH-2017-shacl-advanced-predicate-object-targets", "committedDate": "2020-06-12T16:21:48Z", "type": "commit"}, {"oid": "c16f9d2f740c96c63dce094d501d84b8a8fc4f08", "url": "https://github.com/eclipse/rdf4j/commit/c16f9d2f740c96c63dce094d501d84b8a8fc4f08", "message": "a couple of tests for negation\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-12T16:38:34Z", "type": "commit"}, {"oid": "ba5b806c1fe9b00cb186f9d6b0d573fea6241c35", "url": "https://github.com/eclipse/rdf4j/commit/ba5b806c1fe9b00cb186f9d6b0d573fea6241c35", "message": "test cases for value in\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-13T08:00:01Z", "type": "commit"}, {"oid": "80c6151ee6d156a3cc42d7dc4458ee37917b3153", "url": "https://github.com/eclipse/rdf4j/commit/80c6151ee6d156a3cc42d7dc4458ee37917b3153", "message": "more tests for targetNode\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-13T08:13:17Z", "type": "commit"}, {"oid": "791136c66bbdcee9678738a463347b9edacc1c98", "url": "https://github.com/eclipse/rdf4j/commit/791136c66bbdcee9678738a463347b9edacc1c98", "message": "added some benchmarks\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-13T08:59:46Z", "type": "commit"}, {"oid": "c782d9d8e4b4592c284b6daeaec691adf44b7090", "url": "https://github.com/eclipse/rdf4j/commit/c782d9d8e4b4592c284b6daeaec691adf44b7090", "message": "implemented handling of node validation\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-13T17:04:06Z", "type": "commit"}, {"oid": "8bb6f62fa9ad6e051cfb16cc61804790ccba7a4f", "url": "https://github.com/eclipse/rdf4j/commit/8bb6f62fa9ad6e051cfb16cc61804790ccba7a4f", "message": "functional implementation for valuesIn\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-14T10:30:13Z", "type": "commit"}, {"oid": "81cc711fd51f72663273e8f401c48a3417904426", "url": "https://github.com/eclipse/rdf4j/commit/81cc711fd51f72663273e8f401c48a3417904426", "message": "more fixes\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-14T11:16:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4NzcwMw==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r439887703", "bodyText": "This test contains no assertions - what exactly are we testing here? Perhaps clarify with a comment.", "author": "jeenbroekstra", "createdAt": "2020-06-15T01:00:53Z", "path": "core/sail/shacl/src/test/java/org/eclipse/rdf4j/sail/shacl/ExperimentalFeaturesTest.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Eclipse RDF4J contributors.\n+ * All rights reserved. This program and the accompanying materials\n+ * are made available under the terms of the Eclipse Distribution License v1.0\n+ * which accompanies this distribution, and is available at\n+ * http://www.eclipse.org/org/documents/edl-v10.php.\n+ *******************************************************************************/\n+\n+package org.eclipse.rdf4j.sail.shacl;\n+\n+import org.eclipse.rdf4j.model.BNode;\n+import org.eclipse.rdf4j.model.IRI;\n+import org.eclipse.rdf4j.model.impl.SimpleValueFactory;\n+import org.eclipse.rdf4j.model.vocabulary.RDF;\n+import org.eclipse.rdf4j.repository.RepositoryException;\n+import org.eclipse.rdf4j.repository.sail.SailRepository;\n+import org.eclipse.rdf4j.repository.sail.SailRepositoryConnection;\n+import org.junit.AfterClass;\n+import org.junit.Test;\n+\n+/**\n+ * @author H\u00e5vard Ottestad\n+ */\n+public class ExperimentalFeaturesTest {\n+\n+\tSimpleValueFactory vf = SimpleValueFactory.getInstance();\n+\tIRI ex_knows = vf.createIRI(\"http://example.com/ns#knows\");\n+\tIRI ex_Person = vf.createIRI(\"http://example.com/ns#Person\");\n+\n+\t@AfterClass\n+\tpublic static void afterClass() {\n+\t\tGlobalValidationExecutionLogging.loggingEnabled = false;\n+\t}\n+\n+\t@Test\n+\tpublic void testDash() throws Exception {\n+\n+\t\tSailRepository shaclRepository = Utils.getInitializedShaclRepository(\"test-cases/class/allSubjects/shacl.ttl\",\n+\t\t\t\tfalse);\n+\n+\t\ttry (SailRepositoryConnection connection = shaclRepository.getConnection()) {\n+\t\t\tconnection.begin();\n+\t\t\tconnection.add(vf.createBNode(), ex_knows, vf.createBNode());", "originalCommit": "81cc711fd51f72663273e8f401c48a3417904426", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk0MzU0OA==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r439943548", "bodyText": "There are two sets of tests that check that the experimental features are disabled by default and that you can enable them after you've added you shapes. Essentially the tests are \"without the experimental features enabled there should be no shacl exception\".", "author": "hmottestad", "createdAt": "2020-06-15T05:53:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4NzcwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTk0NTA4Mg==", "url": "https://github.com/eclipse/rdf4j/pull/2229#discussion_r439945082", "bodyText": "I will add a comment to the test", "author": "hmottestad", "createdAt": "2020-06-15T05:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg4NzcwMw=="}], "type": "inlineReview"}, {"oid": "28e43a581a3ac153c0639ae96dd914440b127095", "url": "https://github.com/eclipse/rdf4j/commit/28e43a581a3ac153c0639ae96dd914440b127095", "message": "switched naming of new features\n\nSigned-off-by: Ha\u030avard Ottestad <hmottestad@gmail.com>", "committedDate": "2020-06-15T20:57:25Z", "type": "commit"}]}