{"pr_number": 2294, "pr_title": "GH-1368 Added a RioSetting Compact_Xml.", "pr_createdAt": "2020-05-29T14:01:22Z", "pr_url": "https://github.com/eclipse/rdf4j/pull/2294", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5Njk5Ng==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r432796996", "bodyText": "I like this, but perhaps a better place for this is XMLWriterSettings, since this configuration option is only relevant for XML.", "author": "jeenbroekstra", "createdAt": "2020-05-30T01:21:14Z", "path": "core/rio/api/src/main/java/org/eclipse/rdf4j/rio/helpers/BasicWriterSettings.java", "diffHunk": "@@ -113,6 +113,17 @@\n \t\t\t\"org.eclipse.rdf4j.rio.encode_rdf_star\",\n \t\t\t\"Encodes RDF* triples to special IRIs for compatibility with RDF\", Boolean.TRUE);\n \n+\t/**\n+\t * Boolean setting for writer to determine whether it should remove the rdf:nodeID attribute from blank nodes.\n+\t * <p>\n+\t * Defaults to False.\n+\t * <p>\n+\t * Can be overridden by setting system property {@code org.eclipse.rdf4j.rio.compact_xml}.\n+\t */\n+\tpublic static final RioSetting<Boolean> COMPACT_XML = new BooleanRioSetting(\n+\t\t\t\"org.eclipse.rdf4j.rio.compact_xml\",\n+\t\t\t\"To generate a compact XML i.e. without Blank Node ID.\", Boolean.FALSE);\n+", "originalCommit": "a93cb8194e1a5ec931df63925b7fac6e02740505", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MzE5Nw==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r432953197", "bodyText": "sure.", "author": "REVERB283", "createdAt": "2020-05-31T14:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc5Njk5Ng=="}], "type": "inlineReview"}, {"oid": "27f637213151dc4f4b75b519c512b675bff82d73", "url": "https://github.com/eclipse/rdf4j/commit/27f637213151dc4f4b75b519c512b675bff82d73", "message": "GH-1368 Added a RioSetting Compact_Xml. [Reformatted and signed]\n\nSigned-off-by: iamaryananand <32545908+iamaryananand@users.noreply.github.com>", "committedDate": "2020-05-31T08:58:02Z", "type": "forcePushed"}, {"oid": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "url": "https://github.com/eclipse/rdf4j/commit/344461a347234fbfca5befa25a0a9bbc3f41e27d", "message": "GH-1368 Added a CompactXML setting to XMLWriterSettings [Reformatted +\nTest Cases]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>\n\nGH-1368 Added a RioSetting Compact_Xml. [Reformatted and signed]\n\nSigned-off-by: iamaryananand <32545908+iamaryananand@users.noreply.github.com>\n\nGH-1368 Added a RioSetting Compact_Xml. [Reformatted]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>\n\nGH-1368 Added a RioSetting Compact_Xml + Test Case Added. [Reformatted]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>\n\nGH-1368 Added a CompactXML setting to XMLWriterSettings\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>", "committedDate": "2020-05-31T16:52:39Z", "type": "commit"}, {"oid": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "url": "https://github.com/eclipse/rdf4j/commit/344461a347234fbfca5befa25a0a9bbc3f41e27d", "message": "GH-1368 Added a CompactXML setting to XMLWriterSettings [Reformatted +\nTest Cases]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>\n\nGH-1368 Added a RioSetting Compact_Xml. [Reformatted and signed]\n\nSigned-off-by: iamaryananand <32545908+iamaryananand@users.noreply.github.com>\n\nGH-1368 Added a RioSetting Compact_Xml. [Reformatted]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>\n\nGH-1368 Added a RioSetting Compact_Xml + Test Case Added. [Reformatted]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>\n\nGH-1368 Added a CompactXML setting to XMLWriterSettings\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>", "committedDate": "2020-05-31T16:52:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwMjU3Mg==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433002572", "bodyText": "I'm not sure why you are using reflection here. As far as I can tell, you can simply do this:\nArrangedWriter arrangedXmlWriter = new ArrangedWriter(rdfXmlWriter);\n\nBut to be honest, I think you can get rid of using the ArrangedWriter as part of this test completely, as it's not really necessary for testing that the COMPACT_XML setting works.", "author": "jeenbroekstra", "createdAt": "2020-06-01T00:44:46Z", "path": "core/rio/rdfxml/src/test/java/org/eclipse/rdf4j/rio/rdfxml/RDFXMLPrettyWriterTest.java", "diffHunk": "@@ -104,6 +109,58 @@ public void outOfSequenceItemsAreNotAbbreviated() throws RDFHandlerException, IO\n \t\tassertEquals(Arrays.asList(\"<rdf:RDF\", \"<rdf:Bag\", \"<rdf:_0\", \"<rdf:_2\"), rdfLines);\n \t}\n \n+\t@Test\n+\tpublic void compactXMLPrintTest() throws RDFHandlerException, IOException, ClassNotFoundException,\n+\t\t\tNoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {\n+\t\tOutputStream outputStream = new ByteArrayOutputStream();\n+\t\tPrintStream printStream = new PrintStream(outputStream);\n+\t\tSystem.setOut(printStream);\n+\n+\t\tRDFWriter rdfXmlWriter = new RDFXMLPrettyWriter(System.out);\n+\n+\t\tClass<?> arrangedWriterCls = Class.forName(\"org.eclipse.rdf4j.rio.turtle.ArrangedWriter\");\n+\t\tConstructor<?> constructor = arrangedWriterCls.getConstructor(RDFWriter.class);\n+\t\tconstructor.setAccessible(true);\n+\t\tRDFWriter arrangedXmlWriter = (RDFWriter) constructor.newInstance(rdfXmlWriter);", "originalCommit": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc3OTc0MA==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r435779740", "bodyText": "We've cleared some clutter (reflections) and are using just the normal instances but I don't understand why do you want us to remove the arrangedwriter part. I mean to check if the setting really works I believe we have to compare the output with the expected one. If you can clear this a bit more, we'll be really grateful.", "author": "REVERB283", "createdAt": "2020-06-05T08:48:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwMjU3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjI0MjIxNA==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r436242214", "bodyText": "We've cleared some clutter (reflections) and are using just the normal instances but I don't understand why do you want us to remove the arrangedwriter part. I mean to check if the setting really works I believe we have to compare the output with the expected one. If you can clear this a bit more, we'll be really grateful.\n\nMy point is that you don't need the ArrangedWriter to test that. The RDFXMLPrettyWriter is expected to work if the input statements are sent in the correct order. All you really need is a  List with statements in the correct order, feed that list into the RDFXMLPrettyWriter, and then check if the output is as you expect.", "author": "jeenbroekstra", "createdAt": "2020-06-06T06:03:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwMjU3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwNTE4OA==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433005188", "bodyText": "Like I said above: I don't really think you need this shuffle on the order of statements here: your test should only be about the improvement to the RDFXMLPrettyWriter that you did. Making sure statements are always in the correct order is not part of that class' job. So by doing this shuffle, all you're really testing is that ArrangedWriter is doing its job - and that should not be part of this unit test.\nThe only thing you should be testing here is that if statements are fed in in the correct order, and the COMPACT_XML setting is turned on, the output is as expected. So I'd suggest that instead of creating a Model and then shuffling that Model, you just create two Statement using the ValueFactory, then add those two statements to a simple ArrayList in the correct order, and then pass that Arraylist to the RDFXMLPrettyWriter.", "author": "jeenbroekstra", "createdAt": "2020-06-01T01:06:29Z", "path": "core/rio/rdfxml/src/test/java/org/eclipse/rdf4j/rio/rdfxml/RDFXMLPrettyWriterTest.java", "diffHunk": "@@ -104,6 +109,58 @@ public void outOfSequenceItemsAreNotAbbreviated() throws RDFHandlerException, IO\n \t\tassertEquals(Arrays.asList(\"<rdf:RDF\", \"<rdf:Bag\", \"<rdf:_0\", \"<rdf:_2\"), rdfLines);\n \t}\n \n+\t@Test\n+\tpublic void compactXMLPrintTest() throws RDFHandlerException, IOException, ClassNotFoundException,\n+\t\t\tNoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {\n+\t\tOutputStream outputStream = new ByteArrayOutputStream();\n+\t\tPrintStream printStream = new PrintStream(outputStream);\n+\t\tSystem.setOut(printStream);\n+\n+\t\tRDFWriter rdfXmlWriter = new RDFXMLPrettyWriter(System.out);\n+\n+\t\tClass<?> arrangedWriterCls = Class.forName(\"org.eclipse.rdf4j.rio.turtle.ArrangedWriter\");\n+\t\tConstructor<?> constructor = arrangedWriterCls.getConstructor(RDFWriter.class);\n+\t\tconstructor.setAccessible(true);\n+\t\tRDFWriter arrangedXmlWriter = (RDFWriter) constructor.newInstance(rdfXmlWriter);\n+\n+\t\tarrangedXmlWriter.set(BasicWriterSettings.PRETTY_PRINT, false);\n+\t\tarrangedXmlWriter.set(BasicWriterSettings.INLINE_BLANK_NODES, true);\n+\t\tarrangedXmlWriter.set(XMLWriterSettings.COMPACT_XML, true);\n+\n+\t\tValueFactory vf = SimpleValueFactory.getInstance();\n+\n+\t\tIRI subject = vf.createIRI(\"http://example.org/subject\");\n+\t\tIRI relation = vf.createIRI(\"http://example.org/relation\");\n+\n+\t\tLinkedHashModel model = new LinkedHashModel();\n+\t\tBNode bnode = vf.createBNode(\"bnode\");\n+\n+\t\tmodel.add(subject, relation, bnode);\n+\t\tmodel.add(bnode, RDFS.LABEL, vf.createLiteral(\"the bnode\"));\n+\t\tmodel.setNamespace(RDFS.NS);\n+\t\tmodel.setNamespace(\"ex\", \"http://example.org/\");\n+\n+\t\tList<Statement> shuffledStatements = new ArrayList<>(model);\n+\t\tCollections.shuffle(shuffledStatements);\n+\t\tRio.write(shuffledStatements, arrangedXmlWriter);", "originalCommit": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwNjgyMg==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433006822", "bodyText": "Rather than redirecting System.out, why not just give the outputStream argument directly to the RDFXMlPrettyWriter?", "author": "jeenbroekstra", "createdAt": "2020-06-01T01:18:25Z", "path": "core/rio/rdfxml/src/test/java/org/eclipse/rdf4j/rio/rdfxml/RDFXMLPrettyWriterTest.java", "diffHunk": "@@ -104,6 +109,58 @@ public void outOfSequenceItemsAreNotAbbreviated() throws RDFHandlerException, IO\n \t\tassertEquals(Arrays.asList(\"<rdf:RDF\", \"<rdf:Bag\", \"<rdf:_0\", \"<rdf:_2\"), rdfLines);\n \t}\n \n+\t@Test\n+\tpublic void compactXMLPrintTest() throws RDFHandlerException, IOException, ClassNotFoundException,\n+\t\t\tNoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {\n+\t\tOutputStream outputStream = new ByteArrayOutputStream();\n+\t\tPrintStream printStream = new PrintStream(outputStream);\n+\t\tSystem.setOut(printStream);", "originalCommit": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAwOTEyMQ==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433009121", "bodyText": "If you get rid of using the ArrangedWriter, you can also remove the first two settings, and just set the third one (but directly on the rdfXmlWriter, of course).", "author": "jeenbroekstra", "createdAt": "2020-06-01T01:34:38Z", "path": "core/rio/rdfxml/src/test/java/org/eclipse/rdf4j/rio/rdfxml/RDFXMLPrettyWriterTest.java", "diffHunk": "@@ -104,6 +109,58 @@ public void outOfSequenceItemsAreNotAbbreviated() throws RDFHandlerException, IO\n \t\tassertEquals(Arrays.asList(\"<rdf:RDF\", \"<rdf:Bag\", \"<rdf:_0\", \"<rdf:_2\"), rdfLines);\n \t}\n \n+\t@Test\n+\tpublic void compactXMLPrintTest() throws RDFHandlerException, IOException, ClassNotFoundException,\n+\t\t\tNoSuchMethodException, IllegalAccessException, InvocationTargetException, InstantiationException {\n+\t\tOutputStream outputStream = new ByteArrayOutputStream();\n+\t\tPrintStream printStream = new PrintStream(outputStream);\n+\t\tSystem.setOut(printStream);\n+\n+\t\tRDFWriter rdfXmlWriter = new RDFXMLPrettyWriter(System.out);\n+\n+\t\tClass<?> arrangedWriterCls = Class.forName(\"org.eclipse.rdf4j.rio.turtle.ArrangedWriter\");\n+\t\tConstructor<?> constructor = arrangedWriterCls.getConstructor(RDFWriter.class);\n+\t\tconstructor.setAccessible(true);\n+\t\tRDFWriter arrangedXmlWriter = (RDFWriter) constructor.newInstance(rdfXmlWriter);\n+\n+\t\tarrangedXmlWriter.set(BasicWriterSettings.PRETTY_PRINT, false);\n+\t\tarrangedXmlWriter.set(BasicWriterSettings.INLINE_BLANK_NODES, true);\n+\t\tarrangedXmlWriter.set(XMLWriterSettings.COMPACT_XML, true);", "originalCommit": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAxMjU1Nw==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433012557", "bodyText": "I just had another look at this, and at the issue, and I realized that this new setting is not really necessary, as there already exists a setting for this: BasicWriterSettings.INLINE_BLANK_NODES.\nWhy not use that setting to check in RDFXMLPrettyWriter, and remove this new setting?", "author": "jeenbroekstra", "createdAt": "2020-06-01T01:56:01Z", "path": "core/rio/api/src/main/java/org/eclipse/rdf4j/rio/helpers/XMLWriterSettings.java", "diffHunk": "@@ -57,6 +57,17 @@\n \tpublic static final RioSetting<Boolean> USE_SINGLE_QUOTES = new BooleanRioSetting(\n \t\t\t\"org.eclipse.rdf4j.rio.use_single_quotes\", \"Use single quotes\", Boolean.FALSE);\n \n+\t/**\n+\t * Boolean setting for writer to determine whether it should remove the rdf:nodeID attribute from blank nodes.\n+\t * <p>\n+\t * Defaults to False.\n+\t * <p>\n+\t * Can be overridden by setting system property {@code org.eclipse.rdf4j.rio.compact_xml}.\n+\t */\n+\tpublic static final RioSetting<Boolean> COMPACT_XML = new BooleanRioSetting(\n+\t\t\t\"org.eclipse.rdf4j.rio.compact_xml\",\n+\t\t\t\"To generate a compact XML i.e. without Blank Node ID.\", Boolean.FALSE);\n+", "originalCommit": "344461a347234fbfca5befa25a0a9bbc3f41e27d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MDY5OA==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433160698", "bodyText": "Well I didn't quite understand the what this setting INLINE_BLANK_NODES is all about. While understanding the issue I went through the entire link that @barthanssens shared and that contained some test cases that the author was trying to model this problem and I took help from that. But If you're saying that this can be achieved using INLINE_BLANK_NODES settings only then I think I can do that.\nMoreover I had a doubt regarding the checks: Is it necessary that the checks will succeed only if @iamaryananand (author of the pull request) will do the commit?", "author": "REVERB283", "createdAt": "2020-06-01T10:36:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAxMjU1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzU2NjQzNQ==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r433566435", "bodyText": "Well I didn't quite understand the what this setting INLINE_BLANK_NODES is all about. While understanding the issue I went through the entire link that @barthanssens shared and that contained some test cases that the author was trying to model this problem and I took help from that. But If you're saying that this can be achieved using INLINE_BLANK_NODES settings only then I think I can do that.\n\nNot a problem, it took me a while to remember this as well. But yes, I believe we can reuse the existing setting.\n\nMoreover I had a doubt regarding the checks: Is it necessary that the checks will succeed only if @iamaryananand (author of the pull request) will do the commit?\n\nIf you mean the sign off check: it doesn't matter who created the pull request, it looks at the commits inside the pull request. Each individual commit that you add needs to be signed off by the author of that commit, and that author needs to be on record as having signed the Eclipse Contributor Agreement. So if you add a commit, you need to sign it off, if @iamaryananand adds a commit, they need to sign off that commit.\nIf you are interested in learning why we need this: our project is part of the Eclipse Foundation, which requires a formal record of each contribution, who has created it, and that that person has given us license to use their contribution. As an open-source contributor you still own your own code, so we need written evidence that you given us permission to reuse it. In other words, we need to have an audit trail for Intellectual Property (IP).", "author": "jeenbroekstra", "createdAt": "2020-06-02T01:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAxMjU1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTc3MzE4Nw==", "url": "https://github.com/eclipse/rdf4j/pull/2294#discussion_r435773187", "bodyText": "Okay! So we managed to delete the CompactXML setting as you requested and are using the existing INLINE_BLANK_NODES for our purpose.", "author": "REVERB283", "createdAt": "2020-06-05T08:36:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzAxMjU1Nw=="}], "type": "inlineReview"}, {"oid": "70ad0cd5f66fe2ef2ea03e6c2fd6b273feaa4444", "url": "https://github.com/eclipse/rdf4j/commit/70ad0cd5f66fe2ef2ea03e6c2fd6b273feaa4444", "message": "GH-1368 Removed ArrangedWriter(use and dependency) from the test case and removed CompactXML setting.\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>", "committedDate": "2020-06-06T10:12:51Z", "type": "commit"}, {"oid": "fd66f41b5d9b662fd7d924a61dd684ecbdd2bd62", "url": "https://github.com/eclipse/rdf4j/commit/fd66f41b5d9b662fd7d924a61dd684ecbdd2bd62", "message": "GH-1368 Removed ArrangedWriter(use and dependency) from the test case and removed CompactXML setting(reformatted).\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>", "committedDate": "2020-06-06T10:35:50Z", "type": "commit"}, {"oid": "7a902d4e4108ab285af50740ae613e2991801025", "url": "https://github.com/eclipse/rdf4j/commit/7a902d4e4108ab285af50740ae613e2991801025", "message": "GH-1368 Using INLINE_BLANK_NODE setting and test case changed. [Reformatted code]\n\nSigned-off-by: iamaryananand <aryan16020@iiitd.ac.in>", "committedDate": "2020-06-07T18:44:45Z", "type": "commit"}]}