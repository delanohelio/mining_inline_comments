{"pr_number": 3195, "pr_title": "[STORM-3567] fix UI showing wrong resource info when topo is not scheduled", "pr_createdAt": "2020-01-16T20:44:10Z", "pr_url": "https://github.com/apache/storm/pull/3195", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTM0Ng==", "url": "https://github.com/apache/storm/pull/3195#discussion_r368141346", "bodyText": "Nit: Java doc is missing @param topology topoConf", "author": "Ethanlm", "createdAt": "2020-01-17T21:21:34Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4242,20 +4231,30 @@ public TopologyPageInfo getTopologyPageInfo(String topoId, String window, boolea\n     }\n \n     /**\n-     * Add placeholder AggStats allowing topology page to show components before AggStats are populated.\n+     * If aggStats are not populated, compute common and component(spout) agg and create placeholder stat.\n+     * This allow the topology page to show component spec even the topo is not scheduled.\n+     * Otherwise, just fetch data from current topoPageInfo.\n      *\n      * @param topoPageInfo topology page info holding spout AggStats\n      * @param topology     storm topology used to get spout names\n      */\n-    private void maybeAddPlaceholderSpoutAggStats(TopologyPageInfo topoPageInfo, StormTopology topology) {\n+    private void addSpoutAggStats(TopologyPageInfo topoPageInfo, StormTopology topology, Map<String, Object> topoConf) {", "originalCommit": "1f4dd374cb7a5ea5804d4d5a4fe1d95a70b0e1f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTUxNA==", "url": "https://github.com/apache/storm/pull/3195#discussion_r368141514", "bodyText": "nit: missing javadoc @param topoConf", "author": "Ethanlm", "createdAt": "2020-01-17T21:22:07Z", "path": "storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java", "diffHunk": "@@ -4264,23 +4263,35 @@ private void maybeAddPlaceholderSpoutAggStats(TopologyPageInfo topoPageInfo, Sto\n                 SpecificAggregateStats specificStats = new SpecificAggregateStats();\n                 specificStats.set_spout(spoutAggStats);\n                 placeholderComponentStats.set_specific_stats(specificStats);\n-\n-                topoPageInfo.get_id_to_spout_agg_stats().put(entry.getKey(), placeholderComponentStats);\n+                topoPageInfo.get_id_to_spout_agg_stats().put(spoutName, placeholderComponentStats);\n+            }\n+        } else {\n+            for (Entry<String, ComponentAggregateStats> entry : topoPageInfo.get_id_to_spout_agg_stats().entrySet()) {\n+                CommonAggregateStats commonStats = entry.getValue().get_common_stats();\n+                setResourcesDefaultIfNotSet(spoutResources, entry.getKey(), topoConf);\n+                commonStats.set_resources_map(spoutResources.get(entry.getKey()).toNormalizedMap());\n             }\n         }\n     }\n \n     /**\n-     * Add placeholder AggStats allowing topology page to show components before AggStats are populated.\n+     * If aggStats are not populated, compute common and component(bolt) agg and create placeholder stat.\n+     * This allow the topology page to show component spec even the topo is not scheduled.\n+     * Otherwise, just fetch data from current topoPageInfo.\n      *\n      * @param topoPageInfo  topology page info holding bolt AggStats\n      * @param topology      storm topology used to get bolt names\n      * @param includeSys    whether to show system bolts\n      */\n-    private void maybeAddPlaceholderBoltAggStats(TopologyPageInfo topoPageInfo, StormTopology topology, boolean includeSys) {\n+    private void addBoltAggStats(TopologyPageInfo topoPageInfo, StormTopology topology,", "originalCommit": "1f4dd374cb7a5ea5804d4d5a4fe1d95a70b0e1f4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE1NDIyNA==", "url": "https://github.com/apache/storm/pull/3195#discussion_r368154224", "bodyText": "Corrected both and force-push.", "author": "RuiLi8080", "createdAt": "2020-01-17T22:00:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODE0MTUxNA=="}], "type": "inlineReview"}, {"oid": "bc47a748948e0588cfbce2e9d5f20a3b682a27eb", "url": "https://github.com/apache/storm/commit/bc47a748948e0588cfbce2e9d5f20a3b682a27eb", "message": "[STORM-3567] fix UI showing wrong resource info when topo is not scheduled", "committedDate": "2020-01-17T21:59:25Z", "type": "commit"}, {"oid": "bc47a748948e0588cfbce2e9d5f20a3b682a27eb", "url": "https://github.com/apache/storm/commit/bc47a748948e0588cfbce2e9d5f20a3b682a27eb", "message": "[STORM-3567] fix UI showing wrong resource info when topo is not scheduled", "committedDate": "2020-01-17T21:59:25Z", "type": "forcePushed"}, {"oid": "c43754f8e0b7851e994f1777a5af1478f2124aa0", "url": "https://github.com/apache/storm/commit/c43754f8e0b7851e994f1777a5af1478f2124aa0", "message": "revert mustache fix since name collision wouldn't happen with the nimbus changes", "committedDate": "2020-01-21T19:14:36Z", "type": "commit"}, {"oid": "c43754f8e0b7851e994f1777a5af1478f2124aa0", "url": "https://github.com/apache/storm/commit/c43754f8e0b7851e994f1777a5af1478f2124aa0", "message": "revert mustache fix since name collision wouldn't happen with the nimbus changes", "committedDate": "2020-01-21T19:14:36Z", "type": "forcePushed"}]}