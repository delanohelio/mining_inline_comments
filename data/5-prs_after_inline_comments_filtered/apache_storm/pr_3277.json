{"pr_number": 3277, "pr_title": "STORM-3641 upgrade metrics API for JCQueue", "pr_createdAt": "2020-06-01T16:42:14Z", "pr_url": "https://github.com/apache/storm/pull/3277", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxMzM4NA==", "url": "https://github.com/apache/storm/pull/3277#discussion_r434013384", "bodyText": "can be simplified with Collections.singletonList(-1)", "author": "Ethanlm", "createdAt": "2020-06-02T16:29:48Z", "path": "storm-client/src/jvm/org/apache/storm/daemon/worker/WorkerTransfer.java", "diffHunk": "@@ -65,8 +67,10 @@\n                                                + Config.TOPOLOGY_TRANSFER_BUFFER_SIZE + \":\" + xferQueueSz);\n         }\n \n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(-1);\n         this.transferQueue = new JCQueue(\"worker-transfer-queue\", xferQueueSz, 0, xferBatchSz, backPressureWaitStrategy,\n-            workerState.getTopologyId(), Constants.SYSTEM_COMPONENT_ID, -1, workerState.getPort(),\n+            workerState.getTopologyId(), Constants.SYSTEM_COMPONENT_ID, taskIds, workerState.getPort(),", "originalCommit": "7d27685d540b954b767b4c52f01531d272384a23", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDEzNzE4NA==", "url": "https://github.com/apache/storm/pull/3277#discussion_r434137184", "bodyText": "these changes were all made and squashed", "author": "agresch", "createdAt": "2020-06-02T19:50:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxMzM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxNDUyOQ==", "url": "https://github.com/apache/storm/pull/3277#discussion_r434014529", "bodyText": "Can be simplified with Collections.singletonList(100)", "author": "Ethanlm", "createdAt": "2020-06-02T16:31:38Z", "path": "examples/storm-perf/src/main/java/org/apache/storm/perf/queuetest/JCQueuePerfTest.java", "diffHunk": "@@ -45,11 +47,17 @@ public static void main(String[] args) throws Exception {\n \n     }\n \n+    private static List<Integer> getTaskIds() {\n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(1000);\n+        return taskIds;\n+    }\n+\n     private static void ackingProducerSimulation() {\n         WaitStrategyPark ws = new WaitStrategyPark(100);\n         StormMetricRegistry registry = new StormMetricRegistry();\n-        JCQueue spoutQ = new JCQueue(\"spoutQ\", 1024, 0, 100, ws, \"test\", \"test\", 1000, 1000, registry);\n-        JCQueue ackQ = new JCQueue(\"ackQ\", 1024, 0, 100, ws, \"test\", \"test\", 1000, 1000, registry);\n+        JCQueue spoutQ = new JCQueue(\"spoutQ\", 1024, 0, 100, ws, \"test\", \"test\", getTaskIds(), 1000, registry);", "originalCommit": "7d27685d540b954b767b4c52f01531d272384a23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxOTI0NA==", "url": "https://github.com/apache/storm/pull/3277#discussion_r434019244", "bodyText": "can be simplified with Collections.singletonList(1000)", "author": "Ethanlm", "createdAt": "2020-06-02T16:38:54Z", "path": "storm-client/test/jvm/org/apache/storm/utils/JCQueueBackpressureTest.java", "diffHunk": "@@ -18,11 +18,16 @@\n import org.junit.Assert;\n import org.junit.Test;\n \n+import java.util.ArrayList;\n+import java.util.List;\n+\n \n public class JCQueueBackpressureTest {\n     \n     private static JCQueue createQueue(String name, int queueSize) {\n-        return new JCQueue(name, queueSize, 0, 1, new WaitStrategyPark(0), \"test\", \"test\", 1000, 1000, new StormMetricRegistry());\n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(1000);\n+        return new JCQueue(name, queueSize, 0, 1, new WaitStrategyPark(0), \"test\", \"test\", taskIds, 1000, new StormMetricRegistry());", "originalCommit": "7d27685d540b954b767b4c52f01531d272384a23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDAxOTM1NQ==", "url": "https://github.com/apache/storm/pull/3277#discussion_r434019355", "bodyText": "here too", "author": "Ethanlm", "createdAt": "2020-06-02T16:39:04Z", "path": "storm-client/test/jvm/org/apache/storm/utils/JCQueueTest.java", "diffHunk": "@@ -157,7 +159,9 @@ private JCQueue createQueue(String name, int queueSize) {\n     }\n \n     private JCQueue createQueue(String name, int batchSize, int queueSize) {\n-        return new JCQueue(name, queueSize, 0, batchSize, waitStrategy, \"test\", \"test\", 1000, 1000, new StormMetricRegistry());\n+        List<Integer> taskIds = new ArrayList<>();\n+        taskIds.add(1000);", "originalCommit": "7d27685d540b954b767b4c52f01531d272384a23", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3852a24eb994e3acc63551c99766e2fdd91bcdf", "url": "https://github.com/apache/storm/commit/e3852a24eb994e3acc63551c99766e2fdd91bcdf", "message": "STORM-3641 upgrade metrics API for JCQueue", "committedDate": "2020-06-02T19:46:41Z", "type": "commit"}, {"oid": "e3852a24eb994e3acc63551c99766e2fdd91bcdf", "url": "https://github.com/apache/storm/commit/e3852a24eb994e3acc63551c99766e2fdd91bcdf", "message": "STORM-3641 upgrade metrics API for JCQueue", "committedDate": "2020-06-02T19:46:41Z", "type": "forcePushed"}]}