{"pr_number": 3247, "pr_title": "[STORM-3619] Add null check for topology name", "pr_createdAt": "2020-04-08T20:59:36Z", "pr_url": "https://github.com/apache/storm/pull/3247", "timeline": [{"oid": "be63269cc338078c4bfb3d88f2732dcae672aab8", "url": "https://github.com/apache/storm/commit/be63269cc338078c4bfb3d88f2732dcae672aab8", "message": "[STORM-3619] Add null check for topology name", "committedDate": "2020-04-08T20:58:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxMjcxOA==", "url": "https://github.com/apache/storm/pull/3247#discussion_r405812718", "bodyText": "Changing the name here because it calls client.getClient().isTopologyNameAllowed and it doesn't only check the existence of the topology name.", "author": "Ethanlm", "createdAt": "2020-04-08T21:01:54Z", "path": "storm-client/src/jvm/org/apache/storm/StormSubmitter.java", "diffHunk": "@@ -435,7 +436,7 @@ public void onCompleted(String srcFile, String targetFile, long totalBytes) {\n         });\n     }\n \n-    private static boolean topologyNameExists(String name, NimbusClient client) {\n+    private static boolean isTopologyNameAllowed(String name, NimbusClient client) {", "originalCommit": "be63269cc338078c4bfb3d88f2732dcae672aab8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDY1Mg==", "url": "https://github.com/apache/storm/pull/3247#discussion_r405814652", "bodyText": "Copied TOPOLOGY_NAME_REGEX from storm-server/src/main/java/org/apache/storm/daemon/nimbus/Nimbus.java. We should have a consistent check for topology name.\nTOPOLOGY_KEY_PATTERN was originally only used for blob key. See #2703", "author": "Ethanlm", "createdAt": "2020-04-08T21:05:48Z", "path": "storm-client/src/jvm/org/apache/storm/utils/Utils.java", "diffHunk": "@@ -122,7 +122,9 @@\n     // tests by subclassing.\n     private static Utils _instance = new Utils();\n     private static String memoizedLocalHostnameString = null;\n-    public static final Pattern TOPOLOGY_KEY_PATTERN = Pattern.compile(\"^[\\\\w \\\\t\\\\._-]+$\", Pattern.UNICODE_CHARACTER_CLASS);\n+    public static final Pattern BLOB_KEY_PATTERN =\n+            Pattern.compile(\"^[\\\\w \\\\t\\\\._-]+$\", Pattern.UNICODE_CHARACTER_CLASS);\n+    private static final Pattern TOPOLOGY_NAME_REGEX = Pattern.compile(\"^[^/.:\\\\\\\\]+$\");", "originalCommit": "be63269cc338078c4bfb3d88f2732dcae672aab8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDk1MQ==", "url": "https://github.com/apache/storm/pull/3247#discussion_r405814951", "bodyText": "why was this removed?", "author": "agresch", "createdAt": "2020-04-08T21:06:28Z", "path": "storm-client/src/jvm/org/apache/storm/StormSubmitter.java", "diffHunk": "@@ -248,11 +252,8 @@ public static void submitTopologyAs(String name, Map<String, Object> topoConf, S\n         try {\n             String serConf = JSONValue.toJSONString(topoConf);\n             try (NimbusClient client = NimbusClient.getConfiguredClientAs(conf, asUser)) {\n-                if (topologyNameExists(name, client)) {\n-                    throw new RuntimeException(\"Topology with name `\" + name + \"` already exists on cluster\");\n-                }\n-                if (!Utils.isValidKey(name)) {", "originalCommit": "be63269cc338078c4bfb3d88f2732dcae672aab8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNzI2MQ==", "url": "https://github.com/apache/storm/pull/3247#discussion_r405817261", "bodyText": "There are two reasons:\n\nMoved the name check to the very beginning of this submit function.\nReplace it with Utils.validateTopologyName(name); so we have the same check on client and server side.", "author": "Ethanlm", "createdAt": "2020-04-08T21:10:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgxNDk1MQ=="}], "type": "inlineReview"}]}