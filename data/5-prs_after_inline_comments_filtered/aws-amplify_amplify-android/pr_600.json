{"pr_number": 600, "pr_title": "fix(aws-api): Fix path with leading slash breaking REST", "pr_createdAt": "2020-06-25T18:52:45Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/600", "timeline": [{"oid": "865ac722a359177017f0bb3138c893321329f767", "url": "https://github.com/aws-amplify/amplify-android/commit/865ac722a359177017f0bb3138c893321329f767", "message": "Re-enable REST API tests", "committedDate": "2020-06-25T07:19:29Z", "type": "commit"}, {"oid": "60d00ec02b871e3a9d212b4c3bfdad9570d0c350", "url": "https://github.com/aws-amplify/amplify-android/commit/60d00ec02b871e3a9d212b4c3bfdad9570d0c350", "message": "Strip leading slashes in path", "committedDate": "2020-06-25T18:02:45Z", "type": "commit"}, {"oid": "59537bcc8ecd0b4c776dee916f6ee5bdaf8b94a1", "url": "https://github.com/aws-amplify/amplify-android/commit/59537bcc8ecd0b4c776dee916f6ee5bdaf8b94a1", "message": "Adjust test for new slash behavior", "committedDate": "2020-06-25T18:40:51Z", "type": "commit"}, {"oid": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1", "url": "https://github.com/aws-amplify/amplify-android/commit/a7b430867aaa0541b9eea75cfeb9391edc41d6c1", "message": "Checkstyle + whitespace", "committedDate": "2020-06-25T18:57:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwOTgxOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/600#discussion_r445909819", "bodyText": "Suggestion for readability (eschew regular expression):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return path.replaceAll(\"^[\\\\\\\\/]+\", \"\");\n          \n          \n            \n                    if (path.startsWith(\"/\") || path.startsWith(\"\\\\\")) {\n          \n          \n            \n                        return path.substring(1);\n          \n          \n            \n                    }\n          \n          \n            \n                    \n          \n          \n            \n                    return path;", "author": "jpignata", "createdAt": "2020-06-26T00:35:58Z", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/utils/RestRequestFactory.java", "diffHunk": "@@ -125,12 +129,20 @@ public static Request createRequest(\n     private static void populateBody(\n             Request.Builder builder,\n             byte[] data,\n-            BodyCreationStrategy strategy) {\n+            BodyCreationStrategy strategy\n+    ) {\n         if (data != null) {\n             strategy.buildRequest(builder, data);\n         }\n     }\n \n+    // Segment separator can be either '/' or '\\'.\n+    // HttpUrl.Builder assumes an empty URL if path segments\n+    // begin with either character. Strip them before appending.\n+    private static String stripLeadingSlashes(final String path) {\n+        return path.replaceAll(\"^[\\\\\\\\/]+\", \"\");", "originalCommit": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEyMjA3Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/600#discussion_r447122076", "bodyText": "I know this is excessive, but it works for any combination of any number of slashes in the beginning. This way I REALLY ensure that the path doesn't begin with \"/\" or \"\" or any combination of those two.\nThis way the method name actually makes sense, since it wants to completely strip the left side of any slashes.", "author": "raphkim", "createdAt": "2020-06-29T17:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkwOTgxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkxMDk1MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/600#discussion_r445910950", "bodyText": "Why is this invalid? No scheme?", "author": "jpignata", "createdAt": "2020-06-26T00:40:41Z", "path": "aws-api/src/test/java/com/amplifyframework/api/aws/utils/RestRequestFactoryTest.java", "diffHunk": "@@ -83,9 +97,9 @@ public void createValidURLWithQuery() throws MalformedURLException {\n      * @throws MalformedURLException Should throw since the URL is invalid.\n      */\n     @Test(expected = MalformedURLException.class)\n-    public void createInValidURL() throws MalformedURLException {\n+    public void createInvalidURL() throws MalformedURLException {", "originalCommit": "a7b430867aaa0541b9eea75cfeb9391edc41d6c1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEyMzI0OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/600#discussion_r447123249", "bodyText": "I did not write this test, but I think OkHttp doesn't like it when the endpoint is missing the http", "author": "raphkim", "createdAt": "2020-06-29T17:07:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTkxMDk1MA=="}], "type": "inlineReview"}]}