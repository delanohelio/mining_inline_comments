{"pr_number": 988, "pr_title": "fix: associated Flutter models can sync to cloud", "pr_createdAt": "2020-11-24T08:55:24Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/988", "timeline": [{"oid": "4d1e13c271dbe598d6251eed74f83df114eeb4b4", "url": "https://github.com/aws-amplify/amplify-android/commit/4d1e13c271dbe598d6251eed74f83df114eeb4b4", "message": "fix: associated Flutter models can sync to cloud\n\nVersion 1.6.3 of Amplify fixed an issue where associated/connected\nmodels failed to sync down from AppSync, when being used with\nFlutter-style ModelSchema.\n\nUnfortunately, 1.6.3 stopped short of supporting associated models when\nsyncing *up* to AppSync, from the client.\n\nThis current change expands the HybridCloudSyncInstrumentationTest, to\ndemonstrate successful sync up and down from AppSync.\n\nTo support this, request-forming logic is extracted from the\nModelSchema, and split accross the AppSyncRequestFactory (for DataStore)\nand the AppSyncGraphQLRequestFactory (for API category). The DataStore\nflavor of the factory is expanded to properly build requests when\ndealing with associations in Flutter-style SerializedModels.", "committedDate": "2020-11-24T08:54:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc2MDMxMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/988#discussion_r529760313", "bodyText": "What's the reasoning for moving this out of ModelSchema?    And why is the implementation of this method not identical to the similar method created in AppSyncGraphQLRequestFactory?\nUltimately, I think AppSyncRequestFactory (used for DataStore) and AppSyncGraphQLRequestFactory (used for API) should be combined, or at least have a common superclass maybe.", "author": "richardmcclellan", "createdAt": "2020-11-24T17:40:05Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/appsync/AppSyncRequestFactory.java", "diffHunk": "@@ -315,4 +302,81 @@ private static Object appSyncOpValue(QueryOperator<?> qOp) throws DataStoreExcep\n                     amplifyException, \"Validate your model file.\");\n         }\n     }\n+\n+    private static Map<String, Object> getMapOfFieldNameAndValues(", "originalCommit": "4d1e13c271dbe598d6251eed74f83df114eeb4b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc3MTgwNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/988#discussion_r529771805", "bodyText": "Maybe have some of the common functionality could go in the aws-api-appsync package since it's used by both api and datastore?", "author": "rjuliano", "createdAt": "2020-11-24T17:58:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc2MDMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgwMDkzNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/988#discussion_r529800936", "bodyText": "That doesn't have to be in this PR if you wanted to split it out.  But, go for it if you want!\nI was more interested in the reasoning for moving this method out of ModelSchema?", "author": "richardmcclellan", "createdAt": "2020-11-24T18:45:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc2MDMxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgwODc0MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/988#discussion_r529808741", "bodyText": "The two request factories have little differences laced throughout - the response type, whether to include _version, the request options object, etc. \u2026 \ud83d\ude22\nLong term, I would like to see all of the AppSync-specific stuff go into aws-api-appsync; I still think that's a good direction.\nI had moved the request formation logic out of the ModelSchema since ModelSchema lives in core. I didn\u2019t want core doesn\u2019t know about SerializedModels. This getMapOfFieldNameAndValues(...) method really is about forming an outbound request, I think, not something having to do with the schema in-and-of-itself.", "author": "jamesonwilliams", "createdAt": "2020-11-24T18:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTc2MDMxMw=="}], "type": "inlineReview"}]}