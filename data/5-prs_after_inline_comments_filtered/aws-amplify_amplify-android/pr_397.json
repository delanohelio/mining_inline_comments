{"pr_number": 397, "pr_title": "[aws-datastore] AWSDataStorePlugin via Constructor", "pr_createdAt": "2020-04-24T04:58:45Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/397", "timeline": [{"oid": "5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "url": "https://github.com/aws-amplify/amplify-android/commit/5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "message": "[aws-datastore] AWSDataStorePlugin via Constructor\n\nDisposition 1. All of the other plugins currently used in Amplify can be\ncreated by constructor. The AWSDataStorePlugin.forModels(...) factory\nbreaks the customer's expectations of how plugins are instantiated.\n\nDisposition 2. It is possible to dynamically locate the code-generated\nmodel provider, internal to the plugin, and use it to instantiate the\nplugin. To simplify the happy path of onboarding with the DataStore, a\nno-arguments constructor is provided.\n\nThe plugin may now be added into the system by the same means as the\nother plugins:\n\n    Amplify.addPlugin(new AWSDataStorePlugin());\n    Amplify.configure(getApplicationContext());", "committedDate": "2020-04-24T05:16:59Z", "type": "commit"}, {"oid": "5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "url": "https://github.com/aws-amplify/amplify-android/commit/5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "message": "[aws-datastore] AWSDataStorePlugin via Constructor\n\nDisposition 1. All of the other plugins currently used in Amplify can be\ncreated by constructor. The AWSDataStorePlugin.forModels(...) factory\nbreaks the customer's expectations of how plugins are instantiated.\n\nDisposition 2. It is possible to dynamically locate the code-generated\nmodel provider, internal to the plugin, and use it to instantiate the\nplugin. To simplify the happy path of onboarding with the DataStore, a\nno-arguments constructor is provided.\n\nThe plugin may now be added into the system by the same means as the\nother plugins:\n\n    Amplify.addPlugin(new AWSDataStorePlugin());\n    Amplify.configure(getApplicationContext());", "committedDate": "2020-04-24T05:16:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUzNjEzMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/397#discussion_r414536130", "bodyText": "Minor:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * the Amplify Code Generator, then this will be break. Likewise, if you need to provide a custom\n          \n          \n            \n                 * the Amplify Code Generator, then this will break. Likewise, if you need to provide a custom", "author": "rjuliano", "createdAt": "2020-04-24T12:26:27Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/AWSDataStorePlugin.java", "diffHunk": "@@ -86,33 +86,50 @@ private AWSDataStorePlugin(\n     }\n \n     /**\n-     * Creates an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * Constructs an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * your application's code-generated model provider. This model provider is expected to have the\n+     * fully qualified class name of com.amplifyframework.datastore.generated.model.AmplifyModelProvider.\n+     *\n+     * This constructor will attempt to find that provide by means of reflection. If you have changed\n+     * the path to your {@link ModelProvider} instance, and do not use the default path generated by\n+     * the Amplify Code Generator, then this will be break. Likewise, if you need to provide a custom", "originalCommit": "5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU0MDExNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/397#discussion_r414540114", "bodyText": "When I started looking at DataStore, this was one of the points of confusion for me. How do I tell if remote sync is enabled? It doesn't appear to be a setting in the category or plugin configuration, so I'm asserting that it's simply by virtue of an API being present. If that's the case, maybe we should say something like:\n\nIf the API plugin is present and configured, then remote synchronization will be performed.\n\nOr something along those lines", "author": "rjuliano", "createdAt": "2020-04-24T12:33:04Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/AWSDataStorePlugin.java", "diffHunk": "@@ -86,33 +86,50 @@ private AWSDataStorePlugin(\n     }\n \n     /**\n-     * Creates an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * Constructs an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * your application's code-generated model provider. This model provider is expected to have the\n+     * fully qualified class name of com.amplifyframework.datastore.generated.model.AmplifyModelProvider.\n+     *\n+     * This constructor will attempt to find that provide by means of reflection. If you have changed\n+     * the path to your {@link ModelProvider} instance, and do not use the default path generated by\n+     * the Amplify Code Generator, then this will be break. Likewise, if you need to provide a custom\n+     * {@link ModelProvider}, this will not work. In both cases, you should prefer one of the other\n+     * overloads such as {@link #AWSDataStorePlugin(ModelProvider)}.\n+     *\n+     * If remote synchronization is enabled, it will be performed via {@link Amplify#API}.", "originalCommit": "5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwOTI2NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/397#discussion_r414809264", "bodyText": "Good point, done!", "author": "jamesonwilliams", "createdAt": "2020-04-24T19:23:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU0MDExNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcxMTM2NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/397#discussion_r414711364", "bodyText": "oh wow, this is fancy! I like it.\nI wasn't expecting this to happen anytime soon, you're a ninja @jamesonwilliams", "author": "drochetti", "createdAt": "2020-04-24T16:37:37Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/AWSDataStorePlugin.java", "diffHunk": "@@ -86,33 +86,50 @@ private AWSDataStorePlugin(\n     }\n \n     /**\n-     * Creates an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * Constructs an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * your application's code-generated model provider. This model provider is expected to have the\n+     * fully qualified class name of com.amplifyframework.datastore.generated.model.AmplifyModelProvider.\n+     *\n+     * This constructor will attempt to find that provide by means of reflection. If you have changed\n+     * the path to your {@link ModelProvider} instance, and do not use the default path generated by\n+     * the Amplify Code Generator, then this will be break. Likewise, if you need to provide a custom\n+     * {@link ModelProvider}, this will not work. In both cases, you should prefer one of the other\n+     * overloads such as {@link #AWSDataStorePlugin(ModelProvider)}.\n+     *\n+     * If remote synchronization is enabled, it will be performed via {@link Amplify#API}.\n+     *\n+     * @throws DataStoreException If it is not possible to access the code-generated model provider\n+     */\n+    @SuppressWarnings({\"unused\", \"WeakerAccess\"})\n+    public AWSDataStorePlugin() throws DataStoreException {\n+        this(ModelProviderLocator.locate(), Amplify.API);", "originalCommit": "5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcxMjkwNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/397#discussion_r414712907", "bodyText": "on iOS we're treating this constructor as internal, only for dependency injection purposes. Customers cannot pass their own API implementation because of how strict our sync engine is when it comes to how API should behave.", "author": "drochetti", "createdAt": "2020-04-24T16:40:04Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/AWSDataStorePlugin.java", "diffHunk": "@@ -86,33 +86,50 @@ private AWSDataStorePlugin(\n     }\n \n     /**\n-     * Creates an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * Constructs an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n+     * your application's code-generated model provider. This model provider is expected to have the\n+     * fully qualified class name of com.amplifyframework.datastore.generated.model.AmplifyModelProvider.\n+     *\n+     * This constructor will attempt to find that provide by means of reflection. If you have changed\n+     * the path to your {@link ModelProvider} instance, and do not use the default path generated by\n+     * the Amplify Code Generator, then this will be break. Likewise, if you need to provide a custom\n+     * {@link ModelProvider}, this will not work. In both cases, you should prefer one of the other\n+     * overloads such as {@link #AWSDataStorePlugin(ModelProvider)}.\n+     *\n+     * If remote synchronization is enabled, it will be performed via {@link Amplify#API}.\n+     *\n+     * @throws DataStoreException If it is not possible to access the code-generated model provider\n+     */\n+    @SuppressWarnings({\"unused\", \"WeakerAccess\"})\n+    public AWSDataStorePlugin() throws DataStoreException {\n+        this(ModelProviderLocator.locate(), Amplify.API);\n+    }\n+\n+    /**\n+     * Constructs an {@link AWSDataStorePlugin} which can warehouse the model types provided by\n      * the supplied {@link ModelProvider}. If remote synchronization is enabled, it will be\n      * performed through {@link Amplify#API}.\n      * @param modelProvider Provider of models to be usable by plugin\n-     * @return An {@link AWSDataStorePlugin} which warehouses the provided models\n      */\n-    @NonNull\n-    @SuppressWarnings(\"WeakerAccess\")\n-    public static AWSDataStorePlugin forModels(@NonNull ModelProvider modelProvider) {\n-        Objects.requireNonNull(modelProvider);\n-        return create(modelProvider, Amplify.API);\n+    @SuppressWarnings({\"unused\", \"WeakerAccess\"})\n+    public AWSDataStorePlugin(@NonNull ModelProvider modelProvider) {\n+        this(Objects.requireNonNull(modelProvider), Amplify.API);\n     }\n \n     /**\n-     * Creates an {@link AWSDataStorePlugin} which can warehouse the model types provided by the\n+     * Constructs an {@link AWSDataStorePlugin} which can warehouse the model types provided by the\n      * supplied {@link ModelProvider}. If remote synchronization is enabled, it will be performed\n      * through the provided {@link GraphQlBehavior}.\n      * @param modelProvider Provides the set of models to be warehouse-able by this system\n      * @param api Interface to a remote system where models will be synchronized\n-     * @return An {@link AWSDataStorePlugin} which warehouses the provided model types\n      */\n-    @NonNull\n-    public static AWSDataStorePlugin create(@NonNull ModelProvider modelProvider, @NonNull GraphQlBehavior api) {\n-        Objects.requireNonNull(modelProvider);\n-        Objects.requireNonNull(api);\n-        ModelSchemaRegistry modelSchemaRegistry = ModelSchemaRegistry.instance();\n-        return new AWSDataStorePlugin(modelSchemaRegistry, modelProvider, api);\n+    @SuppressWarnings(\"WeakerAccess\")\n+    public AWSDataStorePlugin(@NonNull ModelProvider modelProvider, @NonNull GraphQlBehavior api) {", "originalCommit": "5cc5db761933a4c2f9ac45102c2b2a825ce812a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgwNzAwOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/397#discussion_r414807009", "bodyText": "This is a good point. I'll look to remove the public access.", "author": "jamesonwilliams", "createdAt": "2020-04-24T19:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDcxMjkwNw=="}], "type": "inlineReview"}, {"oid": "81c5e04527e8f7db4ced075d6d25c619c937b948", "url": "https://github.com/aws-amplify/amplify-android/commit/81c5e04527e8f7db4ced075d6d25c619c937b948", "message": "Address feedback on PR", "committedDate": "2020-04-24T19:22:20Z", "type": "commit"}]}