{"pr_number": 712, "pr_title": "Fix (datastore) quote sql commands", "pr_createdAt": "2020-08-08T09:26:18Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/712", "timeline": [{"oid": "904fe84cb4d5ff023e810c683b4233363a1d4190", "url": "https://github.com/aws-amplify/amplify-android/commit/904fe84cb4d5ff023e810c683b4233363a1d4190", "message": "add gitignore rule for jenv", "committedDate": "2020-08-08T06:27:14Z", "type": "commit"}, {"oid": "456a84205c50b1fd4c0a5c6c4b32ae97f4fb2b8b", "url": "https://github.com/aws-amplify/amplify-android/commit/456a84205c50b1fd4c0a5c6c4b32ae97f4fb2b8b", "message": "[aws-datatore] Quote table and column names in sql commands\n\nDatastore SQL commands fail if your model has SQLite reserved words in them.\nThis quotes table and column names to avoid that\n\nResolves: https://github.com/aws-amplify/amplify-android/issues/707", "committedDate": "2020-08-08T07:54:49Z", "type": "commit"}, {"oid": "e7661aee6eca8836130048426d0b8f26f665f5ff", "url": "https://github.com/aws-amplify/amplify-android/commit/e7661aee6eca8836130048426d0b8f26f665f5ff", "message": "use Wrap to quote table and column names", "committedDate": "2020-08-08T09:48:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1NTMwOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/712#discussion_r468255308", "bodyText": "shouldn't these be\n\"SELECT `Person`.`id` AS `Person_id`, `Person`.`age` AS `Person_age`, `Person`.`firstName` AS `Person_firstName`, \" +\n    \"`Person`.`lastName` AS `Person_lastName` FROM `Person`\";\n\n?", "author": "raphkim", "createdAt": "2020-08-11T00:18:25Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/storage/sqlite/SqlCommandTest.java", "diffHunk": "@@ -55,7 +55,7 @@\n \n     private static final String PERSON_BASE_QUERY =\n             \"SELECT Person.id AS Person_id, Person.age AS Person_age, Person.firstName AS Person_firstName, \" +\n-                    \"Person.lastName AS Person_lastName FROM Person\";\n+                    \"Person.lastName AS Person_lastName FROM `Person`\";", "originalCommit": "e7661aee6eca8836130048426d0b8f26f665f5ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgwOTQ5Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/712#discussion_r468809497", "bodyText": "fixed in the latest commit", "author": "saltonmassally", "createdAt": "2020-08-11T19:18:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODI1NTMwOA=="}], "type": "inlineReview"}, {"oid": "f2f810d725a80b41be767a1257c688dda9a643ef", "url": "https://github.com/aws-amplify/amplify-android/commit/f2f810d725a80b41be767a1257c688dda9a643ef", "message": "add instrumentation tests and quote column names", "committedDate": "2020-08-11T19:16:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgxMjY3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/712#discussion_r468812670", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Enables Android Strict Mode, to help catch common errors while using.\n          \n          \n            \n                 * Enables Android Strict Mode, to help catch common errors while using", "author": "raphkim", "createdAt": "2020-08-11T19:24:20Z", "path": "aws-datastore/src/androidTest/java/com/amplifyframework/datastore/storage/sqlite/SQLiteStorageReservedWordTest.java", "diffHunk": "@@ -0,0 +1,559 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore.storage.sqlite;\n+\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.core.model.Model;\n+import com.amplifyframework.core.model.ModelProvider;\n+import com.amplifyframework.core.model.annotations.BelongsTo;\n+import com.amplifyframework.core.model.annotations.HasMany;\n+import com.amplifyframework.core.model.annotations.Index;\n+import com.amplifyframework.core.model.annotations.ModelConfig;\n+import com.amplifyframework.core.model.annotations.ModelField;\n+import com.amplifyframework.core.model.query.Where;\n+import com.amplifyframework.core.model.query.predicate.QueryField;\n+import com.amplifyframework.datastore.DataStoreException;\n+import com.amplifyframework.datastore.StrictMode;\n+import com.amplifyframework.datastore.storage.SynchronousStorageAdapter;\n+import com.amplifyframework.util.Immutable;\n+\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import java.util.Arrays;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.UUID;\n+\n+import static com.amplifyframework.core.model.query.predicate.QueryField.field;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Test that reserved SQLite words can be safely used in Model names and fields.\n+ */\n+public final class SQLiteStorageReservedWordTest {\n+    private SynchronousStorageAdapter adapter;\n+\n+    /**\n+     * Enables Android Strict Mode, to help catch common errors while using.", "originalCommit": "f2f810d725a80b41be767a1257c688dda9a643ef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgxNjE3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/712#discussion_r468816170", "bodyText": "this description is not true for empty strings right? you can use Empty#check(String) utility method to return the original string if true.", "author": "raphkim", "createdAt": "2020-08-11T19:31:04Z", "path": "core/src/main/java/com/amplifyframework/util/Wrap.java", "diffHunk": "@@ -24,6 +24,20 @@\n public final class Wrap {\n     private Wrap() {}\n \n+    /**\n+     * Returns original string wrapped with in backticks.\n+     * @param original Original string to modify.\n+     * @return Original string wrapped with backtick.\n+     *         If original string is null or empty, it just returns the original.", "originalCommit": "f2f810d725a80b41be767a1257c688dda9a643ef", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgyNzAyMg==", "url": "https://github.com/aws-amplify/amplify-android/pull/712#discussion_r468827022", "bodyText": "Good catch. Fixed in next commit", "author": "saltonmassally", "createdAt": "2020-08-11T19:52:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODgxNjE3MA=="}], "type": "inlineReview"}, {"oid": "5da02acb8d306288991a9d5aa2b2bc085b1df39e", "url": "https://github.com/aws-amplify/amplify-android/commit/5da02acb8d306288991a9d5aa2b2bc085b1df39e", "message": "Update aws-datastore/src/androidTest/java/com/amplifyframework/datastore/storage/sqlite/SQLiteStorageReservedWordTest.java\n\nCo-authored-by: Raphael Kim <52714340+raphkim@users.noreply.github.com>", "committedDate": "2020-08-11T19:42:27Z", "type": "commit"}, {"oid": "dda86e2345ec4832c2da20619f39e368b77c1d03", "url": "https://github.com/aws-amplify/amplify-android/commit/dda86e2345ec4832c2da20619f39e368b77c1d03", "message": "have Wrap#inBackticks return original string if empty", "committedDate": "2020-08-11T19:51:20Z", "type": "commit"}]}