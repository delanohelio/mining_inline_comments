{"pr_number": 392, "pr_title": "Expose all GraphQL error properties", "pr_createdAt": "2020-04-22T09:00:49Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/392", "timeline": [{"oid": "473f73b781f052878d2ddd66a82848b92be341c7", "url": "https://github.com/aws-amplify/amplify-android/commit/473f73b781f052878d2ddd66a82848b92be341c7", "message": "Expose all GraphQL error properties", "committedDate": "2020-04-22T08:57:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMTA4OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412811089", "bodyText": "can it be final?", "author": "raphkim", "createdAt": "2020-04-22T09:11:26Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLLocation.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+/**\n+ * Location mapping to a particular line and column in the request.\n+ */\n+public class GraphQLLocation {", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2MzEzMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413163131", "bodyText": "yep, added.", "author": "richardmcclellan", "createdAt": "2020-04-22T17:10:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMTA4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMjk2MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412812960", "bodyText": "Maybe ClassCastException might be a better fit?", "author": "raphkim", "createdAt": "2020-04-22T09:14:14Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLPathSegment.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+public class GraphQLPathSegment {\n+    private final Object value;\n+\n+    public GraphQLPathSegment(int value) {\n+        this.value = Integer.valueOf(value);\n+    }\n+\n+    public GraphQLPathSegment(String value) {\n+        this.value = value;\n+    }\n+\n+    /**\n+     * Used before calling getAsInt() to confirm if value is int.\n+     *\n+     * @return boolean, whether segment is an int\n+     */\n+    public boolean isInteger() {\n+        return value instanceof Integer;\n+    }\n+\n+    /**\n+     * Used before calling getAsString() to confirm if value is String.\n+     *\n+     * @return boolean, whether segment is a String\n+     */\n+    public boolean isString() {\n+        return value instanceof String;\n+    }\n+\n+    /**\n+     * Convenience method to get this element as a String.\n+     *\n+     * @return get this element as a String\n+     * @throws IllegalStateException if the value contained is not a String.\n+     */\n+    public String getAsString() {\n+        if (isString()) {\n+            return (String) value;\n+        }\n+        throw new IllegalStateException(\"Not a String: \" + value.getClass().getSimpleName());\n+    }\n+\n+    /**\n+     * Convenience method to get this element as an int.\n+     *\n+     * @return get this element as an int\n+     * @throws IllegalStateException if the value contained is not an Integer.\n+     */\n+    public int getAsInt() {\n+        if (isInteger()) {\n+            return ((Integer) value).intValue();\n+        }\n+        throw new IllegalStateException(\"Not an int: \" + value.getClass().getSimpleName());", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1NzA3NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413157075", "bodyText": "I modeled GraphQLPathSegment off of JsonElement, which has a similar set of methods.  They throw an IllegalStateException here, though I tend to agree with you that ClassCastException is more logical.  Fixed!", "author": "richardmcclellan", "createdAt": "2020-04-22T17:02:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMjk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMzE2MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412813161", "bodyText": "final?", "author": "raphkim", "createdAt": "2020-04-22T09:14:31Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLPathSegment.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+public class GraphQLPathSegment {", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE1NjI3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413156270", "bodyText": "Added", "author": "richardmcclellan", "createdAt": "2020-04-22T17:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxMzE2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNjAwNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412816007", "bodyText": "@Nullable annotation on the rest of the parameters would be helpful, since it is a public constructor", "author": "raphkim", "createdAt": "2020-04-22T09:18:24Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -110,24 +113,73 @@ public int hashCode() {\n      * See https://graphql.github.io/graphql-spec/June2018/#sec-Response-Format\n      */\n     public static final class Error {\n+        // Description of the error\n         private final String message;\n \n+        // list of locations describing the syntax element\n+        private final List<GraphQLLocation> locations;\n+\n+        // Details the key path of the response field with error.\n+        private final List<GraphQLPathSegment> path;\n+\n+        // Additional error map, reserved for implementors to use however they see fit.\n+        private final Map<String, Object> extensions;\n+\n         /**\n          * Constructs error response in accordance with GraphQL specs.\n          * @param message error message\n+         * @param locations list of locations describing the syntax element\n+         * @param path The key path of the response field with error.\n+         * @param extensions additional error map, reserved for implementors.\n          */\n-        public Error(@NonNull String message) {\n+        public Error(@NonNull String message, List<GraphQLLocation> locations, List<GraphQLPathSegment> path,", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2MzI0OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413163249", "bodyText": "Added!", "author": "richardmcclellan", "createdAt": "2020-04-22T17:10:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNjAwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNzIxMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412817210", "bodyText": "Let's make the list properties immutable. Luckily, we have nice Immutable utility class to help with that :)\nreturn Immutable.of(locations);", "author": "raphkim", "createdAt": "2020-04-22T09:20:10Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -110,24 +113,73 @@ public int hashCode() {\n      * See https://graphql.github.io/graphql-spec/June2018/#sec-Response-Format\n      */\n     public static final class Error {\n+        // Description of the error\n         private final String message;\n \n+        // list of locations describing the syntax element\n+        private final List<GraphQLLocation> locations;\n+\n+        // Details the key path of the response field with error.\n+        private final List<GraphQLPathSegment> path;\n+\n+        // Additional error map, reserved for implementors to use however they see fit.\n+        private final Map<String, Object> extensions;\n+\n         /**\n          * Constructs error response in accordance with GraphQL specs.\n          * @param message error message\n+         * @param locations list of locations describing the syntax element\n+         * @param path The key path of the response field with error.\n+         * @param extensions additional error map, reserved for implementors.\n          */\n-        public Error(@NonNull String message) {\n+        public Error(@NonNull String message, List<GraphQLLocation> locations, List<GraphQLPathSegment> path,\n+                     Map<String, Object> extensions) {\n             this.message = Objects.requireNonNull(message);\n+            this.locations = locations;\n+            this.path = path;\n+            this.extensions = extensions;\n         }\n \n         /**\n          * Gets the error message.\n+         *\n          * @return error message\n          */\n         public String getMessage() {\n             return message;\n         }\n \n+        /**\n+         * Gets the list of locations where each location describes the beginning of an associated\n+         * syntax element.\n+         *\n+         * @return locations\n+         */\n+        public List<GraphQLLocation> getLocations() {\n+            return locations;", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxODEyMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412818120", "bodyText": "Also might be helpful to mark the return type as @Nullable, along with the other properties.", "author": "raphkim", "createdAt": "2020-04-22T09:21:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNzIxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2MzQ4NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413163484", "bodyText": "Added!", "author": "richardmcclellan", "createdAt": "2020-04-22T17:11:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNzIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNzQ5NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412817494", "bodyText": "^", "author": "raphkim", "createdAt": "2020-04-22T09:20:35Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -110,24 +113,73 @@ public int hashCode() {\n      * See https://graphql.github.io/graphql-spec/June2018/#sec-Response-Format\n      */\n     public static final class Error {\n+        // Description of the error\n         private final String message;\n \n+        // list of locations describing the syntax element\n+        private final List<GraphQLLocation> locations;\n+\n+        // Details the key path of the response field with error.\n+        private final List<GraphQLPathSegment> path;\n+\n+        // Additional error map, reserved for implementors to use however they see fit.\n+        private final Map<String, Object> extensions;\n+\n         /**\n          * Constructs error response in accordance with GraphQL specs.\n          * @param message error message\n+         * @param locations list of locations describing the syntax element\n+         * @param path The key path of the response field with error.\n+         * @param extensions additional error map, reserved for implementors.\n          */\n-        public Error(@NonNull String message) {\n+        public Error(@NonNull String message, List<GraphQLLocation> locations, List<GraphQLPathSegment> path,\n+                     Map<String, Object> extensions) {\n             this.message = Objects.requireNonNull(message);\n+            this.locations = locations;\n+            this.path = path;\n+            this.extensions = extensions;\n         }\n \n         /**\n          * Gets the error message.\n+         *\n          * @return error message\n          */\n         public String getMessage() {\n             return message;\n         }\n \n+        /**\n+         * Gets the list of locations where each location describes the beginning of an associated\n+         * syntax element.\n+         *\n+         * @return locations\n+         */\n+        public List<GraphQLLocation> getLocations() {\n+            return locations;\n+        }\n+\n+        /**\n+         * Gets the key path of the response field which experienced the error.  This allows clients\n+         * to identify whether a null result is intentional or caused by a runtime error.  The\n+         * values are either strings or 0-index integers.\n+         *\n+         * @return path\n+         */\n+        public List<GraphQLPathSegment> getPath() {\n+            return path;", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgxNzU0Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412817542", "bodyText": "^", "author": "raphkim", "createdAt": "2020-04-22T09:20:41Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -110,24 +113,73 @@ public int hashCode() {\n      * See https://graphql.github.io/graphql-spec/June2018/#sec-Response-Format\n      */\n     public static final class Error {\n+        // Description of the error\n         private final String message;\n \n+        // list of locations describing the syntax element\n+        private final List<GraphQLLocation> locations;\n+\n+        // Details the key path of the response field with error.\n+        private final List<GraphQLPathSegment> path;\n+\n+        // Additional error map, reserved for implementors to use however they see fit.\n+        private final Map<String, Object> extensions;\n+\n         /**\n          * Constructs error response in accordance with GraphQL specs.\n          * @param message error message\n+         * @param locations list of locations describing the syntax element\n+         * @param path The key path of the response field with error.\n+         * @param extensions additional error map, reserved for implementors.\n          */\n-        public Error(@NonNull String message) {\n+        public Error(@NonNull String message, List<GraphQLLocation> locations, List<GraphQLPathSegment> path,\n+                     Map<String, Object> extensions) {\n             this.message = Objects.requireNonNull(message);\n+            this.locations = locations;\n+            this.path = path;\n+            this.extensions = extensions;\n         }\n \n         /**\n          * Gets the error message.\n+         *\n          * @return error message\n          */\n         public String getMessage() {\n             return message;\n         }\n \n+        /**\n+         * Gets the list of locations where each location describes the beginning of an associated\n+         * syntax element.\n+         *\n+         * @return locations\n+         */\n+        public List<GraphQLLocation> getLocations() {\n+            return locations;\n+        }\n+\n+        /**\n+         * Gets the key path of the response field which experienced the error.  This allows clients\n+         * to identify whether a null result is intentional or caused by a runtime error.  The\n+         * values are either strings or 0-index integers.\n+         *\n+         * @return path\n+         */\n+        public List<GraphQLPathSegment> getPath() {\n+            return path;\n+        }\n+\n+        /**\n+         * Returns additional error information of type E.  Reserved for GraphQL implementors to\n+         * add details however they see fit.  No additional restrictions on its contents.\n+         *\n+         * @return extensions\n+         */\n+        public Map<String, Object> getExtensions() {\n+            return extensions;", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgyMTUwMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r412821501", "bodyText": "So I see this class doesn't have a real constructor that allows instantiation with specific line + column. This is functional for now since we use GSON to directly write these values. Still, we should provide a constructor or static factory method for other plugin implementers that may not rely on a deserializer.", "author": "raphkim", "createdAt": "2020-04-22T09:26:13Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLLocation.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+/**\n+ * Location mapping to a particular line and column in the request.\n+ */\n+public class GraphQLLocation {", "originalCommit": "473f73b781f052878d2ddd66a82848b92be341c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE2MzYxMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413163611", "bodyText": "Added!", "author": "richardmcclellan", "createdAt": "2020-04-22T17:11:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgyMTUwMQ=="}], "type": "inlineReview"}, {"oid": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "url": "https://github.com/aws-amplify/amplify-android/commit/d4a171faad72e71f1a765ca1cceb781be3292ab0", "message": "Add Nullable, NonNull annotations, return Immutable types, other fixes", "committedDate": "2020-04-22T16:54:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI0MjI2Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413242267", "bodyText": "Ah crumbs. When I did the checkstyle rules last year,  I think I had intended to include\nMissingJavadocType, so that we remembered to make Javadocs on public entities. I suspect we are missing some around the code base. Anyway, if a user will get this GraphQLPathSegment back in response, it would be nice to have doco for any public entity they might access. (For this object, I would not expect a user to need the constructor (well, that could be documented though.) But, class-level doco may benefit the them?)", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:00:59Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLPathSegment.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+import androidx.annotation.NonNull;\n+\n+public final class GraphQLPathSegment {", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5MDM5Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414090392", "bodyText": "Got it, I added Javadoc for this class and a few others as well.  If I get a chance later, I will follow up in a separate PR to add MissingJavadocType to checkstyle-rules.xml.", "author": "richardmcclellan", "createdAt": "2020-04-23T20:09:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI0MjI2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1MDk3Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413250972", "bodyText": "It'd be good to avoid putting this in the core module, if possible. Can we put it under aws-api, instead?", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:14:51Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/AppSyncExtensions.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.util.Immutable;\n+\n+import java.util.Map;\n+\n+public final class AppSyncExtensions {", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzMzNTkwMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413335901", "bodyText": "I initially put it in core since that's the current approach on iOS (though this PR is pending refactoring) and I understand we don't really want AppSync specific stuff in core.\nAppSyncExtensions is really just a helper object with a couple potential consumers:\n(1)  A unit test in aws-api\n(2) An end user consuming the aws-api\n(3) aws-datastore could use it to parse the error to handle conflict resolution.\nAny of the above three use cases has the ability to access extensions via the Map<String, Object> though.\nIf we put it in aws-api, then it would not be accessible by aws-datastore.\nI'm sort of inclined to move it to aws-datastore because that satisfies (3).  For (1), we can just move the unit test to datastore, and for (2), not worry about it now since the end user use case isn't totally understood, and they can just use the Map<String, Object>.\n@jamesonwilliams I don't have much context on datastore yet, so you tell me, does it make sense to put it in aws-datastore?", "author": "richardmcclellan", "createdAt": "2020-04-22T21:11:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1MDk3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQyMjk0MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413422940", "bodyText": "Hey @richardmcclellan, yea, I think aws-datastore should work fine, and be an improvement over core.\nWe have App Sync details in both aws-api, and aws-datastore, at the moment, with no real rules about how or why.\nWhen we get some time, I think it probably makes sense to create a new module called appsync. aws-api and aws-datastore would continue to depend on core, to implements its contracts. But both plugin modules could leverage a shared appsync library module, to achieve their AppSync-specific implementations.", "author": "jamesonwilliams", "createdAt": "2020-04-23T00:27:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1MDk3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1MTc3Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413251777", "bodyText": "Did this JavaDoc get left over from a previous dev iteration, pre-commit?", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:16:06Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -110,24 +114,79 @@ public int hashCode() {\n      * See https://graphql.github.io/graphql-spec/June2018/#sec-Response-Format\n      */\n     public static final class Error {\n+        // Description of the error\n         private final String message;\n \n+        // list of locations describing the syntax element\n+        private final List<GraphQLLocation> locations;\n+\n+        // Details the key path of the response field with error.\n+        private final List<GraphQLPathSegment> path;\n+\n+        // Additional error map, reserved for implementors to use however they see fit.\n+        private final Map<String, Object> extensions;\n+\n         /**\n          * Constructs error response in accordance with GraphQL specs.\n          * @param message error message\n+         * @param locations list of locations describing the syntax element\n+         * @param path The key path of the response field with error.\n+         * @param extensions additional error map, reserved for implementors.\n          */\n-        public Error(@NonNull String message) {\n+        public Error(@NonNull String message,\n+                     @Nullable List<GraphQLLocation> locations,\n+                     @Nullable List<GraphQLPathSegment> path,\n+                     @Nullable Map<String, Object> extensions) {\n             this.message = Objects.requireNonNull(message);\n+            this.locations = locations;\n+            this.path = path;\n+            this.extensions = extensions;\n         }\n \n         /**\n          * Gets the error message.\n+         *\n          * @return error message\n          */\n+        @NonNull\n         public String getMessage() {\n             return message;\n         }\n \n+        /**\n+         * Gets the list of locations where each location describes the beginning of an associated\n+         * syntax element.\n+         *\n+         * @return locations\n+         */\n+        @Nullable\n+        public List<GraphQLLocation> getLocations() {\n+            return Immutable.of(locations);\n+        }\n+\n+        /**\n+         * Gets the key path of the response field which experienced the error.  This allows clients\n+         * to identify whether a null result is intentional or caused by a runtime error.  The\n+         * values are either strings or 0-index integers.\n+         *\n+         * @return path\n+         */\n+        @Nullable\n+        public List<GraphQLPathSegment> getPath() {\n+            return Immutable.of(path);\n+        }\n+\n+        /**\n+         * Returns additional error information of type E.  Reserved for GraphQL implementors to", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5MDY4Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414090686", "bodyText": "Yep, fixed!", "author": "richardmcclellan", "createdAt": "2020-04-23T20:10:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI1MTc3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI2NTQ5OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413265498", "bodyText": "(TLDR Ignore this, no action needed.)\n\nI just realized how we could do this 100% to spec. It ends up being way overkill, and I still do think we should stick what you have, here.\nIt would be possible for us to strongly-model the extensions as a native GraphQL entity. To do so, we would need Java models for all of the various types defined in the GraphQL spec.\niOS uses the type JSONValue, here. While GraphQL and JSON share some similarities, the type definitions are not the same. As a simple example, even the scalar definitions are slightly different (ref: GraphQL, JSON.) The String-Object Map in Java is a looser specification of typing than the GraphQL spec.\nPart of the scope of work we have taken up with Amplify is to create a lightweight GraphQL client. The AppSync SDK leverages an Apollo distribution for this purpose. While we are building our GraphQL client, we have identified needed functionalities by breadth-first discovery. But in instances like this, we sometimes uncover considerable depth needed to fully model all of the parts of the spec.\nI hadn't checked until now. But for what its worth, Apollo also does use a String-Object Map for this model, too.", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:35:31Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -110,24 +114,79 @@ public int hashCode() {\n      * See https://graphql.github.io/graphql-spec/June2018/#sec-Response-Format\n      */\n     public static final class Error {\n+        // Description of the error\n         private final String message;\n \n+        // list of locations describing the syntax element\n+        private final List<GraphQLLocation> locations;\n+\n+        // Details the key path of the response field with error.\n+        private final List<GraphQLPathSegment> path;\n+\n+        // Additional error map, reserved for implementors to use however they see fit.\n+        private final Map<String, Object> extensions;\n+\n         /**\n          * Constructs error response in accordance with GraphQL specs.\n          * @param message error message\n+         * @param locations list of locations describing the syntax element\n+         * @param path The key path of the response field with error.\n+         * @param extensions additional error map, reserved for implementors.\n          */\n-        public Error(@NonNull String message) {\n+        public Error(@NonNull String message,\n+                     @Nullable List<GraphQLLocation> locations,\n+                     @Nullable List<GraphQLPathSegment> path,\n+                     @Nullable Map<String, Object> extensions) {", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA5ODEzMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414098133", "bodyText": "Thanks for the thoughts.  I think this would be a small improvement over what I have now, but for now, I think Map<String, Object> works pretty well.\nIt would be nice to actually parse extensions as a template type though.  I think this could actually be done by creating a new template type R (response) which wraps a  and an extension type, E.   This would require updating all methods in ApiBehavior though, and I'm not sure if we have the bandwidth to make that change right now.", "author": "richardmcclellan", "createdAt": "2020-04-23T20:22:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI2NTQ5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3MDM3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413270370", "bodyText": "You can add a checkstyle suppression if you want to keep this {} together. Or, we could update the checkstyle rules to not enforce this rule for class bodies.\nFor the first option, either @SuppressWarnings(\"checkstyle:WhitespaceAround\") or maybe a // noinspect WhitespaceAround would work here? (Not sure about the second method.)\nFor the second option --\nI think this is WhitespaceAround right? Might be addressed by adding a property for allowEmptyTypes as true?", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:42:16Z", "path": "aws-api/src/main/java/com/amplifyframework/api/aws/GsonErrorDeserializer.java", "diffHunk": "@@ -0,0 +1,112 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.aws;\n+\n+import com.amplifyframework.api.graphql.GraphQLResponse;\n+import com.amplifyframework.api.graphql.error.GraphQLLocation;\n+import com.amplifyframework.api.graphql.error.GraphQLPathSegment;\n+\n+import com.google.gson.JsonDeserializationContext;\n+import com.google.gson.JsonDeserializer;\n+import com.google.gson.JsonElement;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonParseException;\n+import com.google.gson.JsonPrimitive;\n+import com.google.gson.reflect.TypeToken;\n+\n+import java.lang.reflect.Type;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+\n+public final class GsonErrorDeserializer implements JsonDeserializer<GraphQLResponse.Error> {\n+    private static final String MESSAGE_KEY = \"message\";\n+    private static final String LOCATIONS_KEY = \"locations\";\n+    private static final String PATH_KEY = \"path\";\n+    private static final String EXTENSIONS_KEY = \"extensions\";\n+\n+    @Override\n+    public GraphQLResponse.Error deserialize(JsonElement json,\n+                 Type typeOfT, JsonDeserializationContext context) throws JsonParseException {\n+        if (!(json.isJsonObject())) {\n+            throw new JsonParseException(\"Expected a JSONObject but found a \" +\n+                    json.getClass().getName() + \" while deserializing error\");\n+        }\n+\n+        String message = null;\n+        List<GraphQLLocation> locations = null;\n+        List<GraphQLPathSegment> path = null;\n+        Map<String, Object> extensions = null;\n+        JsonObject extensionsJson = new JsonObject();\n+        JsonObject nonSpecifiedData = new JsonObject();\n+\n+        JsonObject error = json.getAsJsonObject();\n+\n+        for (String key : error.keySet()) {\n+            JsonElement value = error.get(key);\n+            if (value != null && !value.isJsonNull()) {\n+                if (key.equals(MESSAGE_KEY)) {\n+                    message = context.deserialize(value, String.class);\n+                } else if (key.equals(LOCATIONS_KEY)) {\n+                    Type locationsType = new TypeToken<List<GraphQLLocation>>() { }.getType();\n+                    locations = context.deserialize(value, locationsType);\n+                } else if (key.equals(PATH_KEY)) {\n+                    path = getPath(value);\n+                } else if (key.equals(EXTENSIONS_KEY)) {\n+                    extensionsJson = value.getAsJsonObject();\n+                } else {\n+                    nonSpecifiedData.add(key, value);\n+                }\n+            }\n+        }\n+\n+        // Merge nonSpecifiedData into extensions, but don't overwrite anything already there.\n+        for (String key : nonSpecifiedData.keySet()) {\n+            if (!extensionsJson.has(key)) {\n+                extensionsJson.add(key, nonSpecifiedData.get(key));\n+            }\n+        }\n+\n+        // Deserialize the extensions JSON to a Map\n+        if (extensionsJson.size() > 0) {\n+            Type extensionType = new TypeToken<Map<String, Object>>() {", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA4OTQ0Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414089446", "bodyText": "Thanks for the tip!  I updated checkstyle-rules.xml", "author": "richardmcclellan", "createdAt": "2020-04-23T20:07:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3MDM3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3MTU0OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413271548", "bodyText": "These are backwards, the meaning of the arguments are assertEquals(expectedValue, actualValue) -- \"failed\" is the one you expected to find, error.getMessage() is the actual value under test.", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:44:14Z", "path": "aws-api/src/test/java/com/amplifyframework/api/aws/GsonGraphQLResponseFactoryTest.java", "diffHunk": "@@ -122,15 +123,59 @@ public void partialResponseRendersWithTodoDataAndErrors() throws ApiException {\n         // Assert that we parsed the errors successfully.\n         assertNotNull(response.getErrors());\n \n-        final List<GraphQLResponse.Error> expectedErrors = Arrays.asList(\n-            new GraphQLResponse.Error(\"failed\"),\n-            new GraphQLResponse.Error(\"failed\"),\n-            new GraphQLResponse.Error(\"failed\")\n-        );\n+        for (GraphQLResponse.Error error : response.getErrors()) {\n+            assertEquals(error.getMessage(), \"failed\");", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA4MzQ4Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414083482", "bodyText": "Fixed!", "author": "richardmcclellan", "createdAt": "2020-04-23T19:57:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3MTU0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3ODE3Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r413278173", "bodyText": "Under the hood, assertEquals(..., ...) is basically just this:\nif (!expect.equals(actual)) {\n    throw new AssertionError(providedMessage);\n}\n\nSo, so long as your objects have a sensible equals() implementation (they do!), you can make high-level assertions on objects using jUnit's assertEquals(...) methods.\nHere, what I propose is to reword this into one bit assertion statement, like:\nassertEquals(\n    /* expected */ new GraphQLResponse(\n        null,\n        Arrays.asList(\n            new GraphQLError(\"Confict resolver rejects ...\", ,, ) // build these up, from the fields in your assertions\n        )\n    ),\n    actualResponse /* built the same exact way you are now, in the Act portion. */\n);", "author": "jamesonwilliams", "createdAt": "2020-04-22T19:51:54Z", "path": "aws-api/src/test/java/com/amplifyframework/api/aws/GsonGraphQLResponseFactoryTest.java", "diffHunk": "@@ -122,15 +123,59 @@ public void partialResponseRendersWithTodoDataAndErrors() throws ApiException {\n         // Assert that we parsed the errors successfully.\n         assertNotNull(response.getErrors());\n \n-        final List<GraphQLResponse.Error> expectedErrors = Arrays.asList(\n-            new GraphQLResponse.Error(\"failed\"),\n-            new GraphQLResponse.Error(\"failed\"),\n-            new GraphQLResponse.Error(\"failed\")\n-        );\n+        for (GraphQLResponse.Error error : response.getErrors()) {\n+            assertEquals(error.getMessage(), \"failed\");\n+        }\n+    }\n \n-        final List<GraphQLResponse.Error> actualErrors = response.getErrors();\n+    /**\n+     * This tests the GsonErrorDeserializer.  The test JSON response has 4 errors, which are all in\n+     * different formats, but are expected to be parsed into the same resulting object:\n+     * 1. Error contains errorType, errorInfo, data (AppSync specific fields) at root level\n+     * 2. Error contains errorType, errorInfo, data inside extensions object\n+     * 3. Error contains errorType, errorInfo, data at root AND inside extensions (fields inside\n+     * extensions take precedence)\n+     * 4. Error contains errorType at root, and errorInfo, data inside extensions (all should be\n+     * merged into extensions)\n+     *\n+     * @throws ApiException From API configuration\n+     */\n+    @Test\n+    public void errorResponseDeserializesExtensionsMap() throws ApiException {\n+        // Arrange some JSON string from a \"server\"\n+        final String partialResponseJson =\n+                Resources.readAsString(\"error-extensions-gql-response.json\");\n+\n+        // Act! Parse it into a model.\n+        final GraphQLResponse<ListTodosResult> response =\n+                responseFactory.buildSingleItemResponse(partialResponseJson, ListTodosResult.class);\n \n-        assertEquals(expectedErrors, actualErrors);\n+        // Assert that the response contained things...\n+        assertNotNull(response);\n+        assertNotNull(response.getErrors());\n+        assertEquals(response.getErrors().size(), 4);\n+\n+        // Assert that each error is has been parsed to the same output object", "originalCommit": "d4a171faad72e71f1a765ca1cceb781be3292ab0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDA4MzQwMg==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414083402", "bodyText": "Originally I didn't do this because GraphQLLocation (which is only created via gson) didn't have a constructor, but I added that constructor while addressing @raphkim's feedback, essentially because a customer may actually want a constructor.\nI do like the suggestion generally because it is a good way to ensure everything is tested, even if new fields are added later, so I've gone ahead and made this change.  I did keep a couple intermediate asserts though.  When the test succeeds, they are redundant, but when the test fails, the intermediate ones are very useful to debug the problem.\nI even caught and fixed a bug in after refactoring this test, which was that elements equal to JsonNull in the error object were getting dropped instead of getting merged into extensions.\nNote: I did have to implement equals in the GraphQLLocation, GraphQLPathSegment, AppSyncExtensions classes to get this to work, but it's good that it's there now :)", "author": "richardmcclellan", "createdAt": "2020-04-23T19:57:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzI3ODE3Mw=="}], "type": "inlineReview"}, {"oid": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "url": "https://github.com/aws-amplify/amplify-android/commit/b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "message": "fixups", "committedDate": "2020-04-23T20:07:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNjQzOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414836438", "bodyText": "Assuming that GraphQLResponse.Error's equals() implementation considers all of message, extensions, path, locations, you should only need L211, and not L207-210.", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:14:26Z", "path": "aws-api/src/test/java/com/amplifyframework/api/aws/GsonGraphQLResponseFactoryTest.java", "diffHunk": "@@ -122,15 +126,94 @@ public void partialResponseRendersWithTodoDataAndErrors() throws ApiException {\n         // Assert that we parsed the errors successfully.\n         assertNotNull(response.getErrors());\n \n-        final List<GraphQLResponse.Error> expectedErrors = Arrays.asList(\n-            new GraphQLResponse.Error(\"failed\"),\n-            new GraphQLResponse.Error(\"failed\"),\n-            new GraphQLResponse.Error(\"failed\")\n+        final List<GraphQLResponse.Error> expectedErrors = new ArrayList<>();\n+        for (int i = 0; i < 3; i++) {\n+            String message = \"failed\";\n+            List<GraphQLLocation> locations = Arrays.asList(\n+                    new GraphQLLocation(5, 7));\n+            List<GraphQLPathSegment> path = Arrays.asList(\n+                    new GraphQLPathSegment(\"listTodos\"),\n+                    new GraphQLPathSegment(\"items\"),\n+                    new GraphQLPathSegment(i),\n+                    new GraphQLPathSegment(\"name\")\n+            );\n+            Map<String, Object> extensions = new LinkedTreeMap<>();\n+            extensions.put(\"errorType\", null);\n+            extensions.put(\"errorInfo\", null);\n+            extensions.put(\"data\", null);\n+            expectedErrors.add(new GraphQLResponse.Error(message, locations, path, extensions));\n+        }\n+\n+        assertEquals(expectedErrors, response.getErrors());\n+    }\n+\n+    /**\n+     * This tests the GsonErrorDeserializer.  The test JSON response has 4 errors, which are all in\n+     * different formats, but are expected to be parsed into the same resulting object:\n+     * 1. Error contains errorType, errorInfo, data (AppSync specific fields) at root level\n+     * 2. Error contains errorType, errorInfo, data inside extensions object\n+     * 3. Error contains errorType, errorInfo, data at root AND inside extensions (fields inside\n+     * extensions take precedence)\n+     * 4. Error contains errorType at root, and errorInfo, data inside extensions (all should be\n+     * merged into extensions)\n+     *\n+     * @throws ApiException From API configuration\n+     */\n+    @Test\n+    public void errorResponseDeserializesExtensionsMap() throws ApiException {\n+        // Arrange some JSON string from a \"server\"\n+        final String partialResponseJson =\n+                Resources.readAsString(\"error-extensions-gql-response.json\");\n+\n+        // Act! Parse it into a model.\n+        final GraphQLResponse<ListTodosResult> response =\n+                responseFactory.buildSingleItemResponse(partialResponseJson, ListTodosResult.class);\n+\n+        // Assert that the response contained things...\n+        String message = \"Conflict resolver rejects mutation.\";\n+        List<GraphQLLocation> locations = Arrays.asList(\n+                new GraphQLLocation(11, 3));\n+        List<GraphQLPathSegment> path = Arrays.asList(\n+                new GraphQLPathSegment(\"listTodos\"),\n+                new GraphQLPathSegment(\"items\"),\n+                new GraphQLPathSegment(0),\n+                new GraphQLPathSegment(\"name\")\n         );\n \n-        final List<GraphQLResponse.Error> actualErrors = response.getErrors();\n+        Map<String, Object> data = new LinkedTreeMap<>();\n+        data.put(\"id\", \"EF48518C-92EB-4F7A-A64E-D1B9325205CF\");\n+        data.put(\"title\", \"new3\");\n+        data.put(\"content\", \"Original content from DataStoreEndToEndTests at 2020-03-26 21:55:47 \" +\n+                \"+0000\");\n+        data.put(\"_version\", 2.0);\n+\n+        Map<String, Object> extensions = new LinkedTreeMap<>();\n+        extensions.put(\"errorType\", \"ConflictUnhandled\");\n+        extensions.put(\"errorInfo\", null);\n+        extensions.put(\"data\", data);\n+\n+        GraphQLResponse.Error expectedError = new GraphQLResponse.Error(message, locations, path, extensions);\n+        GraphQLResponse<ListTodosResult> expectedResponse = new GraphQLResponse<>(null,\n+                Arrays.asList(expectedError, expectedError, expectedError, expectedError));\n+\n+        assertNotNull(response);\n+        assertNotNull(response.getErrors());\n+        assertEquals(expectedResponse.getErrors().size(), response.getErrors().size());\n+\n+        // Assert that each error has been parsed to the same output object.\n+        for (int i = 0; i < response.getErrors().size(); i++) {\n+            GraphQLResponse.Error actual = response.getErrors().get(i);\n+            GraphQLResponse.Error expected = expectedResponse.getErrors().get(i);\n+            assertEquals(\"Unexpected message on error[\" + i + \"]\", expected.getMessage(), actual.getMessage());\n+            assertEquals(\"Unexpected extensions on error[\" + i + \"]\", expected.getExtensions(), actual.getExtensions());\n+            assertEquals(\"Unexpected path on error[\" + i + \"]\", expected.getPath(), actual.getPath());\n+            assertEquals(\"Unexpected locations on error[\" + i + \"]\", expected.getLocations(), actual.getLocations());\n+            assertEquals(\"Unexpected error[\" + i + \"]\", expected, actual);", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkzMjQwNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414932404", "bodyText": "Agreed.  I had left these here because it makes it easier to debug when this test fails.  That said, adding toString() implementations to each class should solve that problem, so I'll go ahead and remove them!", "author": "richardmcclellan", "createdAt": "2020-04-25T00:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNjQzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNjkxNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414836917", "bodyText": "Can you provide a toString() implementation, as well?", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:15:27Z", "path": "aws-datastore/src/main/java/com/amplifyframework/datastore/appsync/AppSyncExtensions.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore.appsync;\n+\n+import androidx.annotation.Nullable;\n+import androidx.core.util.ObjectsCompat;\n+\n+import com.amplifyframework.util.Immutable;\n+\n+import java.util.Map;\n+\n+/**\n+ * Model representing a AppSync specific extensions map.  This data may be included on a\n+ * GraphQLResponse.Error object, and is represented as a Map&lt;String, Object&gt;.  This class can be\n+ * used to create a strongly typed model by passing the Map&lt;String, Object&gt; to the constructor.\n+ */\n+public final class AppSyncExtensions {\n+    private static final String ERROR_TYPE_KEY = \"errorType\";\n+    private static final String ERROR_INFO_KEY = \"errorInfo\";\n+    private static final String DATA_KEY = \"data\";\n+\n+    private final String errorType;\n+    private final String errorInfo;\n+    private final Map<String, Object> data;\n+\n+    @SuppressWarnings(\"unchecked\")\n+    public AppSyncExtensions(Map<String, Object> extensions) {\n+        this.errorType = (String) extensions.get(ERROR_TYPE_KEY);\n+        this.errorInfo = (String) extensions.get(ERROR_INFO_KEY);\n+        this.data = (Map<String, Object>) extensions.get(DATA_KEY);\n+    }\n+\n+    public AppSyncExtensions(String errorType, String errorInfo, Map<String, Object> data) {\n+        this.errorType = errorType;\n+        this.errorInfo = errorInfo;\n+        this.data = data;\n+    }\n+\n+    /**\n+     * Returns the specific AppSync error type, often related to handling conflicts.\n+     * https://docs.aws.amazon.com/appsync/latest/devguide/conflict-detection-and-sync.html#errors\n+     *\n+     * @return errorType\n+     */\n+    @Nullable\n+    public String getErrorType() {\n+        return errorType;\n+    }\n+\n+    /**\n+     * Returns more info about the error.\n+     *\n+     * @return errorInfo\n+     */\n+    @Nullable\n+    public String getErrorInfo() {\n+        return errorInfo;\n+    }\n+\n+    /**\n+     * For conflict unhandled errors, returns a map containing the same fields as the model type.\n+     *\n+     * @return data\n+     */\n+    @Nullable\n+    public Map<String, Object> getData() {\n+        return Immutable.of(data);\n+    }\n+", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkxNDA2Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414914066", "bodyText": "will do!", "author": "richardmcclellan", "createdAt": "2020-04-24T23:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNjkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNzY0OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414837648", "bodyText": "Need to update GraphQLResponse.Error's toString() as well, I think. Right now it just only prints the message , but not any of your new fields.", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:16:46Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/GraphQLResponse.java", "diffHunk": "@@ -139,12 +199,19 @@ public boolean equals(Object thatObject) {\n \n             Error error = (Error) thatObject;\n \n-            return message.equals(error.message);\n+            return ObjectsCompat.equals(message, error.message) &&\n+                   ObjectsCompat.equals(path, error.path) &&\n+                   ObjectsCompat.equals(extensions, error.extensions) &&\n+                   ObjectsCompat.equals(locations, error.locations);\n         }\n ", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkzMjQyMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414932420", "bodyText": "Will do!", "author": "richardmcclellan", "createdAt": "2020-04-25T00:25:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNzY0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODI2NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414838264", "bodyText": "Since GraphQLResponse is at com.amplifyframework.api.graphql, and since Error lives in it, that means Error is com.amplifyframework.api.graphql. All of these inner components should live in the same package as well.\nIn other words, I think this package should be com.amplifyframework.api.graphql.", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:18:06Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLLocation.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0NjQ0Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414846447", "bodyText": "Makes sense, I will move this as well as GraphQLPathSegment!", "author": "richardmcclellan", "createdAt": "2020-04-24T20:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODI2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODM2MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414838361", "bodyText": "toString() ?", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:18:15Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLLocation.java", "diffHunk": "@@ -0,0 +1,68 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+/**\n+ * Location mapping to a particular line and column in the request.\n+ */\n+public final class GraphQLLocation {\n+    private int line;\n+    private int column;\n+\n+    public GraphQLLocation(int line, int column) {\n+        this.line = line;\n+        this.column = column;\n+    }\n+\n+    /**\n+     * Returns line number corresponding to position in the request where an error occurred.\n+     *\n+     * @return line\n+     */\n+    public int getLine() {\n+        return line;\n+    }\n+\n+    /**\n+     * Returns column number corresponding to position in the request where an error occurred.\n+     *\n+     * @return column\n+     */\n+    public int getColumn() {\n+        return column;\n+    }\n+", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0OTc0OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414849749", "bodyText": "Will add.", "author": "richardmcclellan", "createdAt": "2020-04-24T20:40:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODUzMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414838531", "bodyText": "toString() impl?", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:18:36Z", "path": "core/src/main/java/com/amplifyframework/api/graphql/error/GraphQLPathSegment.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.api.graphql.error;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.util.ObjectsCompat;\n+\n+/**\n+ * If a GraphQLResponse contains an error that can be associated with a particular field in the\n+ * requested GraphQL document, it will contain an entry with the key, path.  This entry should be a\n+ * list of GraphQLPathSegments starting at the root of the response and ending with the field\n+ * associated with the error.  This allows clients to determine whether a null result is intentional\n+ * or caused by a runtime error.  Path segments that represent fields should be strings, and path\n+ * segments that represent list indices should be 0\u2010indexed integers.\n+ * https://spec.graphql.org/June2018/#sec-Errors\n+ */\n+public final class GraphQLPathSegment {\n+    private final Object value;\n+\n+    public GraphQLPathSegment(int value) {\n+        this.value = Integer.valueOf(value);\n+    }\n+\n+    public GraphQLPathSegment(@NonNull String value) {\n+        this.value = value;\n+    }\n+\n+    /**\n+     * Used before calling getAsInt() to confirm if value is int.\n+     *\n+     * @return boolean, whether segment is an int\n+     */\n+    public boolean isInteger() {\n+        return value instanceof Integer;\n+    }\n+\n+    /**\n+     * Used before calling getAsString() to confirm if value is String.\n+     *\n+     * @return boolean, whether segment is a String\n+     */\n+    public boolean isString() {\n+        return value instanceof String;\n+    }\n+\n+    /**\n+     * Convenience method to get this element as a String.\n+     *\n+     * @return get this element as a String\n+     * @throws ClassCastException if the value contained is not a String.\n+     */\n+    @NonNull\n+    public String getAsString() {\n+        if (isString()) {\n+            return (String) value;\n+        }\n+        throw new ClassCastException(\"Not a String: \" + value.getClass().getSimpleName());\n+    }\n+\n+    /**\n+     * Convenience method to get this element as an int.\n+     *\n+     * @return get this element as an int\n+     * @throws ClassCastException if the value contained is not an Integer.\n+     */\n+    public int getAsInt() {\n+        if (isInteger()) {\n+            return ((Integer) value).intValue();\n+        }\n+        throw new ClassCastException(\"Not an int: \" + value.getClass().getSimpleName());\n+    }\n+\n+    @Override\n+    public boolean equals(Object thatObject) {\n+        if (this == thatObject) {\n+            return true;\n+        }\n+        if (thatObject == null || getClass() != thatObject.getClass()) {\n+            return false;\n+        }\n+\n+        GraphQLPathSegment segment = (GraphQLPathSegment) thatObject;\n+\n+        if (isString() && segment.isString()) {\n+            return ObjectsCompat.equals(getAsString(), segment.getAsString());\n+        }\n+        if (isInteger() && segment.isInteger()) {\n+            return ObjectsCompat.equals(getAsInt(), segment.getAsInt());\n+        }\n+        return false;\n+    }\n+", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0ODQ2Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414848467", "bodyText": "Will add", "author": "richardmcclellan", "createdAt": "2020-04-24T20:37:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODUzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzOTQwNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414839406", "bodyText": "The AppSyncExtensions utility and its test are \"above\" the abstraction of Gson, at this point. So, we should not import any Gson components as that's a leaking abstraction. If you need a map which preserves insertion order, consider a LinkedHashMap, or if you need one that preserves a natural ordering of keys, look at a (Java Collections) TreeMap.", "author": "jamesonwilliams", "createdAt": "2020-04-24T20:20:21Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncExtensionsTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.datastore.appsync;\n+\n+import com.google.gson.internal.LinkedTreeMap;", "originalCommit": "b85f6e46291321fe7e6559be6dfc0eebbc1d1731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkxMTIzMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414911231", "bodyText": "Good point!  No need to preserve order here, so I'll just use a HashMap.\nI also just realized that while GsonErrorDeserializer is serializing extensions as a HashMap, all JsonObjects inside of extensions are serialized as Gson LinkedTreeMaps, since that is the default when using gson.  I will update this to make sure HashMaps are used.", "author": "richardmcclellan", "createdAt": "2020-04-24T23:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzOTQwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDkzNjcyMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/392#discussion_r414936720", "bodyText": "Oh! Good catch. Getting into the fine points here :-D", "author": "jamesonwilliams", "createdAt": "2020-04-25T00:43:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzOTQwNg=="}], "type": "inlineReview"}]}