{"pr_number": 632, "pr_title": "Develop screen navigation and header for dev menu", "pr_createdAt": "2020-07-09T15:55:45Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/632", "timeline": [{"oid": "2416f3bce777a4b79a7e5e9816bf998dd1c601d3", "url": "https://github.com/aws-amplify/amplify-android/commit/2416f3bce777a4b79a7e5e9816bf998dd1c601d3", "message": "created activity to display dev menu from context and updated package name", "committedDate": "2020-06-24T18:41:41Z", "type": "commit"}, {"oid": "0fbba26fe8dcf30cc52c61b0465f7450caa27181", "url": "https://github.com/aws-amplify/amplify-android/commit/0fbba26fe8dcf30cc52c61b0465f7450caa27181", "message": "start the developer menu activity and display developer menu on bottom of screen", "committedDate": "2020-06-24T23:49:57Z", "type": "commit"}, {"oid": "fe55183e7c1e640cce2d383d7048a9664c0bc4a1", "url": "https://github.com/aws-amplify/amplify-android/commit/fe55183e7c1e640cce2d383d7048a9664c0bc4a1", "message": "changed styling of dev menu to overlay current view", "committedDate": "2020-06-26T15:04:40Z", "type": "commit"}, {"oid": "d5d1d3706b4580ff63d8bb1248969a5196db7a38", "url": "https://github.com/aws-amplify/amplify-android/commit/d5d1d3706b4580ff63d8bb1248969a5196db7a38", "message": "Merge branch 'main' into eeatonaws-dev-menu", "committedDate": "2020-06-26T15:10:02Z", "type": "commit"}, {"oid": "3782d18333b185ece108abda0004066a45b7d474", "url": "https://github.com/aws-amplify/amplify-android/commit/3782d18333b185ece108abda0004066a45b7d474", "message": "updated copyright year", "committedDate": "2020-06-29T20:33:08Z", "type": "commit"}, {"oid": "c7835d544c14244e76378be421f6efed13cb881b", "url": "https://github.com/aws-amplify/amplify-android/commit/c7835d544c14244e76378be421f6efed13cb881b", "message": "Merge branch 'main' into eeatonaws-dev-menu", "committedDate": "2020-06-29T22:12:54Z", "type": "commit"}, {"oid": "52b2dbce3cb491ea6ee6823e7e8e5cea6d8855cd", "url": "https://github.com/aws-amplify/amplify-android/commit/52b2dbce3cb491ea6ee6823e7e8e5cea6d8855cd", "message": "only display dev menu if in debug mode", "committedDate": "2020-06-30T16:44:27Z", "type": "commit"}, {"oid": "f08434b9b85c84306bfe396e190946d43998e126", "url": "https://github.com/aws-amplify/amplify-android/commit/f08434b9b85c84306bfe396e190946d43998e126", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu and fix merge conflict.", "committedDate": "2020-06-30T16:52:01Z", "type": "commit"}, {"oid": "71a07d475dee8b572fd77c031805f1649475322c", "url": "https://github.com/aws-amplify/amplify-android/commit/71a07d475dee8b572fd77c031805f1649475322c", "message": "activate dev menu on device shake or keyboard shortcut", "committedDate": "2020-07-01T21:22:18Z", "type": "commit"}, {"oid": "36481de3107cc22c71b57c0257b33ac63cfd1dd9", "url": "https://github.com/aws-amplify/amplify-android/commit/36481de3107cc22c71b57c0257b33ac63cfd1dd9", "message": "Merge branch 'main' into eeatonaws-dev-menu", "committedDate": "2020-07-01T22:14:19Z", "type": "commit"}, {"oid": "ae96c687d4c01486acf0047a5362d6384513d27f", "url": "https://github.com/aws-amplify/amplify-android/commit/ae96c687d4c01486acf0047a5362d6384513d27f", "message": "adjusted shake threshold", "committedDate": "2020-07-02T18:31:13Z", "type": "commit"}, {"oid": "59f95d076adafdd81a4e5db3428fc9de81962044", "url": "https://github.com/aws-amplify/amplify-android/commit/59f95d076adafdd81a4e5db3428fc9de81962044", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu", "committedDate": "2020-07-02T18:36:44Z", "type": "commit"}, {"oid": "e860ea2b7300e055bca4f7f63c49c133d31734c6", "url": "https://github.com/aws-amplify/amplify-android/commit/e860ea2b7300e055bca4f7f63c49c133d31734c6", "message": "reordered fields in DeveloperMenuActivity", "committedDate": "2020-07-06T14:34:22Z", "type": "commit"}, {"oid": "79bead5640b823697e44c5b5480093dd1b98da10", "url": "https://github.com/aws-amplify/amplify-android/commit/79bead5640b823697e44c5b5480093dd1b98da10", "message": "factor shake detection logic out into separate class", "committedDate": "2020-07-06T19:00:05Z", "type": "commit"}, {"oid": "533629c1b58b9d257f4f293f2d88732992bf5bab", "url": "https://github.com/aws-amplify/amplify-android/commit/533629c1b58b9d257f4f293f2d88732992bf5bab", "message": "added buttons to dev menu and did basic styling", "committedDate": "2020-07-06T21:10:07Z", "type": "commit"}, {"oid": "7790dbc1043732c7eb0060dbe125b5918b1292b5", "url": "https://github.com/aws-amplify/amplify-android/commit/7790dbc1043732c7eb0060dbe125b5918b1292b5", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu", "committedDate": "2020-07-06T21:11:44Z", "type": "commit"}, {"oid": "0e2118fd60e69e4186e452562260c5c3144dcd19", "url": "https://github.com/aws-amplify/amplify-android/commit/0e2118fd60e69e4186e452562260c5c3144dcd19", "message": "changed XML IDs from camel case to lower snake case", "committedDate": "2020-07-06T22:03:31Z", "type": "commit"}, {"oid": "920324b5be73e2a56d2b251957b2b4bacf3d24a1", "url": "https://github.com/aws-amplify/amplify-android/commit/920324b5be73e2a56d2b251957b2b4bacf3d24a1", "message": "move SensorManager out of activity and into ShakeDetector", "committedDate": "2020-07-07T15:16:16Z", "type": "commit"}, {"oid": "e731a750599d61ab034a124c9617ecfc77eaec85", "url": "https://github.com/aws-amplify/amplify-android/commit/e731a750599d61ab034a124c9617ecfc77eaec85", "message": "wrote unit tests for ShakeDetector", "committedDate": "2020-07-07T21:16:26Z", "type": "commit"}, {"oid": "ba110f5ac1e338a6870eca7357f02c8434180657", "url": "https://github.com/aws-amplify/amplify-android/commit/ba110f5ac1e338a6870eca7357f02c8434180657", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu", "committedDate": "2020-07-07T21:17:11Z", "type": "commit"}, {"oid": "12cdbe20dcbdde774cee97e23c3c6d3a047e1b6b", "url": "https://github.com/aws-amplify/amplify-android/commit/12cdbe20dcbdde774cee97e23c3c6d3a047e1b6b", "message": "fixed lint errors", "committedDate": "2020-07-07T21:33:03Z", "type": "commit"}, {"oid": "480c6423a454de4753eaed33aa3bda3842e96b12", "url": "https://github.com/aws-amplify/amplify-android/commit/480c6423a454de4753eaed33aa3bda3842e96b12", "message": "changed name of constants and throw RuntimeException if creating a thread fails", "committedDate": "2020-07-07T21:41:24Z", "type": "commit"}, {"oid": "f5c54c4cdf160fb77083c1bf33db3af68715efa6", "url": "https://github.com/aws-amplify/amplify-android/commit/f5c54c4cdf160fb77083c1bf33db3af68715efa6", "message": "added header and navigation to dev menu", "committedDate": "2020-07-09T15:21:28Z", "type": "commit"}, {"oid": "790e41fc727682b77d23d2c0d5ef31cc2dfbbe98", "url": "https://github.com/aws-amplify/amplify-android/commit/790e41fc727682b77d23d2c0d5ef31cc2dfbbe98", "message": "changed action bar title for each view", "committedDate": "2020-07-09T15:43:10Z", "type": "commit"}, {"oid": "aa2a7af11b06517e45e134b4d46a6c325580a9db", "url": "https://github.com/aws-amplify/amplify-android/commit/aa2a7af11b06517e45e134b4d46a6c325580a9db", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu", "committedDate": "2020-07-09T15:45:02Z", "type": "commit"}, {"oid": "4c7dc2692a5772aa2261c05278a43979206c61b3", "url": "https://github.com/aws-amplify/amplify-android/commit/4c7dc2692a5772aa2261c05278a43979206c61b3", "message": "Merge branch 'main' into eeatonaws-dev-menu", "committedDate": "2020-07-09T15:46:15Z", "type": "commit"}, {"oid": "32018a05a2240ea1aa119552ef3c8459177d2acb", "url": "https://github.com/aws-amplify/amplify-android/commit/32018a05a2240ea1aa119552ef3c8459177d2acb", "message": "Merge branch 'DevMenu' into eeatonaws-dev-menu", "committedDate": "2020-07-09T16:58:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyMTM3MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r452421370", "bodyText": "Hmm, it would be best not to manage navigation on our own like this.  It may work for this iteration of the dev menu, but will quickly become unmaintainable when we want to add new sub pages, more levels of navigation, etc.\nIt'd be best to use the Android system back stack, and then you don't need to override onBackPressed().   Using Fragments are probably the best option for this.  A Fragment is essentially a view plus lifecycle methods and the ability to be added to the system back stack.  Have you considered this approach?", "author": "richardmcclellan", "createdAt": "2020-07-09T18:49:24Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -63,6 +100,17 @@ public boolean onKeyUp(int keyCode, KeyEvent event) {\n         }\n     }\n \n+    @Override", "originalCommit": "32018a05a2240ea1aa119552ef3c8459177d2acb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxODA2OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r452618069", "bodyText": "Fragments are one approach. You can also look at the (~new-ish) Navigation component in Jet Pack.", "author": "jamesonwilliams", "createdAt": "2020-07-10T04:39:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyMTM3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxNzkwMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r452617900", "bodyText": "These individual views have a parent view, right? Can you set it GONE and VISIBLE, instead of doing it on all of the individual children?", "author": "jamesonwilliams", "createdAt": "2020-07-10T04:38:14Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -74,4 +122,30 @@ private void changeVisibility() {\n             devMenuLayout.setVisibility(View.VISIBLE);\n         }\n     }\n+\n+    /**\n+     * Hides the main developer menu view, displays the given View, and\n+     * changes the title text on the action bar.\n+     * @param newView View to display.\n+     * @param titleTextId ID of the string resource for the action bar title text.\n+     */\n+    private void leaveMainView(View newView, int titleTextId) {\n+        buttons.setVisibility(View.GONE);\n+        newView.setVisibility(View.VISIBLE);\n+        backButton.setVisibility(View.VISIBLE);\n+        titleText.setText(titleTextId);\n+    }\n+\n+    /**\n+     * Hide the current view and display the main developer menu view.\n+     */\n+    private void displayMainView() {", "originalCommit": "32018a05a2240ea1aa119552ef3c8459177d2acb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYxODMwNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r452618304", "bodyText": "It's a subtle point here, but the Activity ought to be about visual display. So I would phrase this as \"display\" and \"hide\" the main view, instead of the navigation-sounding (control) names you're using.", "author": "jamesonwilliams", "createdAt": "2020-07-10T04:40:28Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -74,4 +122,30 @@ private void changeVisibility() {\n             devMenuLayout.setVisibility(View.VISIBLE);\n         }\n     }\n+\n+    /**\n+     * Hides the main developer menu view, displays the given View, and\n+     * changes the title text on the action bar.\n+     * @param newView View to display.\n+     * @param titleTextId ID of the string resource for the action bar title text.\n+     */\n+    private void leaveMainView(View newView, int titleTextId) {", "originalCommit": "32018a05a2240ea1aa119552ef3c8459177d2acb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5325c28d39c81a5b489305b7b89bc00bbb72b14c", "url": "https://github.com/aws-amplify/amplify-android/commit/5325c28d39c81a5b489305b7b89bc00bbb72b14c", "message": "use navigation and toolbar instead of nested layouts", "committedDate": "2020-07-10T22:50:45Z", "type": "commit"}, {"oid": "3ee50053fd65a748fa63c35c416f7f1fd24bbb9b", "url": "https://github.com/aws-amplify/amplify-android/commit/3ee50053fd65a748fa63c35c416f7f1fd24bbb9b", "message": "removed back arrow icon resource", "committedDate": "2020-07-10T22:51:38Z", "type": "commit"}, {"oid": "1730149e962c29552d116d1c6035a7dc23766e7a", "url": "https://github.com/aws-amplify/amplify-android/commit/1730149e962c29552d116d1c6035a7dc23766e7a", "message": "move start of license comment to new line", "committedDate": "2020-07-10T22:54:44Z", "type": "commit"}, {"oid": "46f119b17124e2013f07a46bb9b26c36ab247a1e", "url": "https://github.com/aws-amplify/amplify-android/commit/46f119b17124e2013f07a46bb9b26c36ab247a1e", "message": "add copyright statement", "committedDate": "2020-07-13T14:01:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzE2MDk4NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453160984", "bodyText": "Maybe name this DevMenuDeviceFragment, since it's a Fragment now, not a View?  And same for all the other classes like this as well.", "author": "richardmcclellan", "createdAt": "2020-07-11T06:01:40Z", "path": "core/src/main/java/com/amplifyframework/core/DevMenuDeviceView.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import androidx.fragment.app.Fragment;\n+\n+/**\n+ * A {@link Fragment} subclass representing the view\n+ * to display the device information on the developer menu.\n+ */\n+public final class DevMenuDeviceView extends Fragment {", "originalCommit": "1730149e962c29552d116d1c6035a7dc23766e7a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxMjI4NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453812284", "bodyText": "Is it still necessary to override onBackPressed?  When a user taps back while on the main menu, we probably want to finish() the DeveloperMenuActivity so it is removed from memory, rather than just setting visibility to View.GONE.  I'm thinking this will probably just happen automatically if you don't override onBackPressed.", "author": "richardmcclellan", "createdAt": "2020-07-13T17:28:50Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -63,6 +74,16 @@ public boolean onKeyUp(int keyCode, KeyEvent event) {\n         }\n     }\n \n+    @Override\n+    public void onBackPressed() {", "originalCommit": "46f119b17124e2013f07a46bb9b26c36ab247a1e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgzOTQ2MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453839460", "bodyText": "The DeveloperMenuActivity is finished by default (if I don't override onBackPressed) if the user presses the phone's back button, but that means the user can no longer activate the developer menu.", "author": "eeatonaws", "createdAt": "2020-07-13T18:15:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxMjI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MDk2Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453890967", "bodyText": "Ahh, I just took at look at the changes you made in Amplify.configure().   By design, an Activity should really only be used when there is UI to be displayed, so I don't think it's a good idea to create an Activity until the dev menu is actually supposed to be shown.\nAnother issue I think you will have with the current approach is this scenario:\n\nIn the customer's app, they call Amplify.configure(), which starts the DeveloperMenuActivity\nThen the customer creates one or more of their own activities for their app.\nThen, the customer shakes the phone.  Now, DeveloperMenuActivity is not the foreground activity, so even if you change visibility of elements on the dev menu, it won't be shown, since it is behind other activities.\n\nInstead, perhaps you could turn ShakeDetector into a singleton, which is initialized in Amplify.configure, and is always listening for shake events.  Then, when the ShakeDetector detects a shake, it could start the DeveloperMenuActivity?", "author": "richardmcclellan", "createdAt": "2020-07-13T19:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxMjI4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk0OTgyNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453949827", "bodyText": "Thanks for pointing this out. I just tested it and you're right that the DeveloperMenuActivity isn't visible even when shaking the phone if another activity is started.", "author": "eeatonaws", "createdAt": "2020-07-13T21:41:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxMjI4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxNzY1Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453817656", "bodyText": "Maybe just call this method navigate?  It is hiding the main view, but that's not all - it is also taking the user to the new view.", "author": "richardmcclellan", "createdAt": "2020-07-13T17:37:59Z", "path": "core/src/main/java/com/amplifyframework/core/DevMenuMainView.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.TextView;\n+import androidx.fragment.app.Fragment;\n+import androidx.navigation.Navigation;\n+\n+/**\n+ * A {@link Fragment} subclass representing the main view for\n+ * the developer menu.\n+ */\n+public final class DevMenuMainView extends Fragment {\n+    // Text displayed in the action bar.\n+    private TextView titleText;\n+\n+    /**\n+     * Required empty public constructor.\n+     */\n+    public DevMenuMainView() { }\n+\n+    @Override\n+    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n+                             Bundle savedInstanceState) {\n+        // Inflate the layout for this fragment\n+        View mainView = inflater.inflate(R.layout.fragment_main_view, container, false);\n+\n+        titleText = getActivity().findViewById(R.id.toolbar_title);\n+        titleText.setText(R.string.menu_title);\n+\n+        // Set on-click listeners for each button on the main view of the developer menu.\n+        mainView.findViewById(R.id.env_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_env_info_view, R.string.env_view_title));\n+        mainView.findViewById(R.id.device_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_device_info_view, R.string.device_view_title));\n+        mainView.findViewById(R.id.logs_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_logs_view, R.string.logs_view_title));\n+        mainView.findViewById(R.id.file_issue_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_file_issue_view, R.string.file_issue_view_title));\n+\n+        return mainView;\n+    }\n+\n+    /**\n+     * Hides the main developer menu view, displays the view with the given\n+     * ID, and changes the title text on the action bar.\n+     * @param view View to navigate away from.\n+     * @param newViewId ID of the new view to display.\n+     * @param titleTextId ID of the string resource for the action bar title text.\n+     */\n+    private void hideMainView(View view, int newViewId, int titleTextId) {", "originalCommit": "46f119b17124e2013f07a46bb9b26c36ab247a1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgzMDI3NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r453830274", "bodyText": "Instead of setting the title text here, it would probably be cleaner to do the following:\n\nIn the dev_menu_nav_graph.xml, set the label attribute on each <fragment> to the string resource id for the title.\nThen, according to the setupActionBarWithNavController documentation, the title will automatically be updated when you navigate between fragments.", "author": "richardmcclellan", "createdAt": "2020-07-13T17:59:26Z", "path": "core/src/main/java/com/amplifyframework/core/DevMenuMainView.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import android.widget.TextView;\n+import androidx.fragment.app.Fragment;\n+import androidx.navigation.Navigation;\n+\n+/**\n+ * A {@link Fragment} subclass representing the main view for\n+ * the developer menu.\n+ */\n+public final class DevMenuMainView extends Fragment {\n+    // Text displayed in the action bar.\n+    private TextView titleText;\n+\n+    /**\n+     * Required empty public constructor.\n+     */\n+    public DevMenuMainView() { }\n+\n+    @Override\n+    public View onCreateView(LayoutInflater inflater, ViewGroup container,\n+                             Bundle savedInstanceState) {\n+        // Inflate the layout for this fragment\n+        View mainView = inflater.inflate(R.layout.fragment_main_view, container, false);\n+\n+        titleText = getActivity().findViewById(R.id.toolbar_title);\n+        titleText.setText(R.string.menu_title);\n+\n+        // Set on-click listeners for each button on the main view of the developer menu.\n+        mainView.findViewById(R.id.env_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_env_info_view, R.string.env_view_title));\n+        mainView.findViewById(R.id.device_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_device_info_view, R.string.device_view_title));\n+        mainView.findViewById(R.id.logs_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_logs_view, R.string.logs_view_title));\n+        mainView.findViewById(R.id.file_issue_button).setOnClickListener(view -> hideMainView(view,\n+                R.id.show_file_issue_view, R.string.file_issue_view_title));\n+\n+        return mainView;\n+    }\n+\n+    /**\n+     * Hides the main developer menu view, displays the view with the given\n+     * ID, and changes the title text on the action bar.\n+     * @param view View to navigate away from.\n+     * @param newViewId ID of the new view to display.\n+     * @param titleTextId ID of the string resource for the action bar title text.\n+     */\n+    private void hideMainView(View view, int newViewId, int titleTextId) {\n+        Navigation.findNavController(view).navigate(newViewId);\n+        titleText.setText(titleTextId);", "originalCommit": "46f119b17124e2013f07a46bb9b26c36ab247a1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "780940bb283e19425374466bb9b76e52f939b3e0", "url": "https://github.com/aws-amplify/amplify-android/commit/780940bb283e19425374466bb9b76e52f939b3e0", "message": "moved dependencies to project build.gradle and renamed files from view to fragment", "committedDate": "2020-07-13T19:11:58Z", "type": "commit"}, {"oid": "0bb534db5498503a9763bf7029aec6d323a8a655", "url": "https://github.com/aws-amplify/amplify-android/commit/0bb534db5498503a9763bf7029aec6d323a8a655", "message": "changed nav graph action names and removed unneeded actions", "committedDate": "2020-07-13T19:23:39Z", "type": "commit"}, {"oid": "f27808542f5e805e5dd81f854750f98409f296a9", "url": "https://github.com/aws-amplify/amplify-android/commit/f27808542f5e805e5dd81f854750f98409f296a9", "message": "remove centered title and reformat navigation dependencies", "committedDate": "2020-07-13T20:49:20Z", "type": "commit"}, {"oid": "731e61ac53fabc8c25de305a4c4cd8b28257c8d6", "url": "https://github.com/aws-amplify/amplify-android/commit/731e61ac53fabc8c25de305a4c4cd8b28257c8d6", "message": "changed double quotes for navigationversion to single quotes", "committedDate": "2020-07-13T21:39:06Z", "type": "commit"}, {"oid": "75893291140af7a4deb83409f3925dfa94df8039", "url": "https://github.com/aws-amplify/amplify-android/commit/75893291140af7a4deb83409f3925dfa94df8039", "message": "changed navigation dependency spacing and version name", "committedDate": "2020-07-14T14:17:07Z", "type": "commit"}, {"oid": "a8a3893c4557541453de1cfe356ad906e6d58134", "url": "https://github.com/aws-amplify/amplify-android/commit/a8a3893c4557541453de1cfe356ad906e6d58134", "message": "start and stop dev menu activity on device shake", "committedDate": "2020-07-14T15:42:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxOTAyOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454519029", "bodyText": "Hmm, instead of shaking to dismiss, could the user just tap the Back button to dismiss?   I imagine this would be a more intuitive UX, and the code would be simpler (no ShakeDetector stuff inside DeveloperMenuActivity).", "author": "richardmcclellan", "createdAt": "2020-07-14T17:23:16Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -29,27 +27,34 @@\n  * This is the activity to display the developer menu.\n  */\n public final class DeveloperMenuActivity extends FragmentActivity {\n+\n+    // Indicates whether this activity has started.\n+    private static boolean activityStarted;\n     // Parent layout for the developer menu.\n     private View devMenuLayout;\n     // Detect and handle shake events.\n     private ShakeDetector detector;\n-    // Manages app navigation.\n-    private NavController navController;\n \n     @Override\n     protected void onCreate(Bundle savedInstanceState) {\n         super.onCreate(savedInstanceState);\n         setContentView(R.layout.activity_dev_menu);\n         devMenuLayout = findViewById(R.id.dev_layout);\n         devMenuLayout.setFocusable(true);\n-        devMenuLayout.setVisibility(View.GONE);\n-        detector = new ShakeDetector(getApplicationContext(), this::changeVisibility);\n+        detector = new ShakeDetector(getApplicationContext(), this::finish);", "originalCommit": "a8a3893c4557541453de1cfe356ad906e6d58134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU4MDc5Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454580793", "bodyText": "I believe she supports both which I think is the best customer experience.", "author": "TrekSoft", "createdAt": "2020-07-14T19:07:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxOTAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYwMzE0NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454603144", "bodyText": "I was a little concerned that if a customer does a particularly strong shake, it could be recognized as 2 shakes, which would show and then immediately hide the menu, which I don't think would be an expected experience.   I don't feel too strongly though, I'm good to try it with this functionality.", "author": "richardmcclellan", "createdAt": "2020-07-14T19:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxOTAyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYwOTc1Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454609757", "bodyText": "I added a duration threshold in ShakeDetector that only calls the given callback method if a minimum amount of time has passed since the shake started, in order to prevent the developer menu from appearing and then immediately disappearing if there's a strong shake.", "author": "eeatonaws", "createdAt": "2020-07-14T20:00:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxOTAyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454542822", "bodyText": "Maintaining state in a static variable should generally be avoided because it can be accessed/modified from anywhere, and thus can lead to bugs and code that's hard to maintain.  Looks like you are referencing this in Amplify.configure to see whether DeveloperMenuActivity should be started.  Instead, I'd suggest this:\n\nWhen a shake is detected, stop listening for shakes, and then start DeveloperMenuActivity using the startActivityForResult() method (https://developer.android.com/training/basics/intents/result).\nThen, implement onActivityResult() to know when DeveloperMenuActivity is finished.  When it is finished, start listening for shakes again.", "author": "richardmcclellan", "createdAt": "2020-07-14T18:01:16Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -29,27 +27,34 @@\n  * This is the activity to display the developer menu.\n  */\n public final class DeveloperMenuActivity extends FragmentActivity {\n+\n+    // Indicates whether this activity has started.\n+    private static boolean activityStarted;", "originalCommit": "a8a3893c4557541453de1cfe356ad906e6d58134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYwMjg4Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454602883", "bodyText": "I tested listening for shakes again in the DeveloperMenuActivity onStop() and this approach works. Are there any drawbacks to starting to listen for shakes again in onStop() as opposed to using onActivityResult()?", "author": "eeatonaws", "createdAt": "2020-07-14T19:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY3MDMwNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454670306", "bodyText": "Hmm, how are you referencing the ShakeDetector defined in Amplify.configure from DeveloperMenuActivity.onStop() to start listening again?\nOne concern is that the logic for starting and stopping listening is not encapsulated in one place, and thus harder to maintain/understand - starting is in Amplify.configure, and stopping is in DeveloperMenuActivity.\nAnother concern is the following scenario:\n\nAmplify.configure starts listening for shakes.\nCustomer shakes device, listening stops, DeveloperMenuActivity is launched.\nCustomer receives a push notification, taps it, which launches a new Activity to display that push notification.  onStop is called, so listening starts again.\nCustomer taps back, and is now on DeveloperMenuActivity, and listener is still active.\nCustomer shakes devices again, and now a new DeveloperMenuActivity instance is started on top of the existing one.", "author": "richardmcclellan", "createdAt": "2020-07-14T21:59:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY4NjQyMg==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454686422", "bodyText": "In DeveloperMenuActivity.onStop(), I call Amplify.enableDeveloperMenu, which handles starting and stopping listening for shake events when the developer menu activity has not started (essentially creating a new ShakeDetector instance).\nThe scenario you bring up is a good point. I could return the ShakeDetector instance from Amplify.enableDeveloperMenu, store that in a field in DeveloperMenuActivity when Amplify.enableDeveloperMenu is called in DeveloperMenuActivity.onStop, and then in DeveloperMenuActivity.onRestart, stop listening for the shake event that would start a new activity. What do you think about this approach, or would your suggestion of overriding onActivityResult in DeveloperMenuActivity also solve the problem in the scenario you described?", "author": "eeatonaws", "createdAt": "2020-07-14T22:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5MTY0NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454691645", "bodyText": "I see - hmm, we really should avoid making Amplify.enableDeveloperMenu a public method, as that is now exposed to customers, and I don't think there's a strong customer use case to support that.  If there was a customer use case, this is the kind of thing that would need to go through a design review with all platforms as well.", "author": "richardmcclellan", "createdAt": "2020-07-14T22:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5NjQ0MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454696441", "bodyText": "I didn't realize that, thanks for pointing it out. I was trying to avoid repeating the same code in DeveloperMenuActivity. If I move the method to DeveloperMenuActivity, but still keep it public so I can call it in Amplify.configure, would it no longer be exposed to customers?", "author": "eeatonaws", "createdAt": "2020-07-14T23:10:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY5NzEwNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454697107", "bodyText": "My previous suggestion was to implement onActivityResult in the class that starts DeveloperMenuActivity, but I just realized that doesn't work because that has to be implemented in an Activity, and Amplify is not an Activity.\nNew idea: how about starting DeveloperMenuActivity with FLAG_ACTIVITY_SINGLE_TOP?  Then, if you shake while it's already launched, nothing should happen.  Then, you can just always be listening for shakes in Amplify.configure.  The problem you still might have though is shake to dismiss might not work, hmmm.....", "author": "richardmcclellan", "createdAt": "2020-07-14T23:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcwMzE5Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454703197", "bodyText": "Since I'm starting the developer menu activity from outside of an activity, I have to use FLAG_ACTIVITY_NEW_TASK. The documentation for this flag says \"if a task is already running for the activity you are now starting, then a new activity will not be started; instead, the current task will simply be brought to the front of the screen with the state it was last in\". Does this mean that in the scenario you described, a new developer menu activity would not be started when the user returns to the developer menu using the back button?", "author": "eeatonaws", "createdAt": "2020-07-14T23:30:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDcwOTE0Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454709147", "bodyText": "Does this mean that in the scenario you described, a new developer menu activity would not be started?\n\nYes, that's right.\nIf you are okay with not supporting shake to dismiss, using the FLAG_ACTIVITY_SINGLE_TOP would probably give you a complete solution.\nIf you do want to support shake to dismiss, it is a bit more complex.  I think you could accomplish it though with something like the logic below.  It's not my favorite idea, because it still involves maintaining a static state, but I'm not sure of a different solution - it's definitely a tricky problem.\nclass DevMenuManager implements ShakeDetector.Listener {\n    private boolean visible;\n \n    private static DevMenuManager sInstance = new DevMenuManager();\n\n    public static sharedInstance() {\n         return sInstance;\n    }\n\n    public start() {\n         // Subscribe to shake events\n    }\n\n    public void onShakeDetected() {\n         if(visible) {\n            Amplify.Hub.publish(\"HideDeveloperMenu\");  // this syntax is probably wrong, but the idea is to broadcast a message on Hub.  Then, you would listen for this message in `DeveloperMenuActivity`, and call finish when you receive the message.\nvisible = false;\n         } else {\n            Intent mainIntent = new Intent(context, DeveloperMenuActivity.class);\n            mainIntent.setAction(Intent.ACTION_MAIN);\n            mainIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n            context.startActivity(mainIntent);\n            visible = true;\n       }\n   }\n}\n\nIn Amplify.configure():\nDevMenuManager.sharedInstance().start()\n\nIn DeveloperMenuActivity.onCreate():\nAmplify.Hub.subscribe(\"HideDeveloperMenu\", event -> {\n      finish();\n});", "author": "richardmcclellan", "createdAt": "2020-07-14T23:49:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU0MjgyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2MzczNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454563736", "bodyText": "In the interest of keeping the configure(...) method as lean as possible, can we state this block as:\nif (isDebuggableApplication()) {\n    enableDeveloperMenu();\n}\n\nAnd then put the details into helpers?", "author": "jamesonwilliams", "createdAt": "2020-07-14T18:37:02Z", "path": "core/src/main/java/com/amplifyframework/core/Amplify.java", "diffHunk": "@@ -137,11 +137,16 @@ public static void configure(@NonNull final AmplifyConfiguration configuration,\n                 }\n             }\n             if ((context.getApplicationInfo().flags & ApplicationInfo.FLAG_DEBUGGABLE) != 0) {\n-                // Start activity for developer menu\n+                // Start activity for developer menu on device shake\n                 Intent mainIntent = new Intent(context, DeveloperMenuActivity.class);\n                 mainIntent.setAction(Intent.ACTION_MAIN);\n                 mainIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n-                context.startActivity(mainIntent);\n+                ShakeDetector shakeDetector = new ShakeDetector(context, () -> {\n+                    if (!DeveloperMenuActivity.isActivityStarted()) {\n+                        context.startActivity(mainIntent);\n+                    }\n+                });\n+                shakeDetector.startDetecting();", "originalCommit": "a8a3893c4557541453de1cfe356ad906e6d58134", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2NTEzMg==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454565132", "bodyText": "This template is repeated a few times.\nCan you make just one of these fragments, and give it a constructor which accepts:\npublic final class DevMenuLogsFragement extends Fragment {\n    @IdRes private final int layoutResourceId;\n\n    public DevMenuLogsFragment(@IdRes int layoutResourceId) {\n        this.layoutResourceId = layoutResourceId;\n    }\n    ...\n}\n\nUpdate: oh, duh. Nope. Your comment says the no-args constructor is required. Nevermind!", "author": "jamesonwilliams", "createdAt": "2020-07-14T18:39:34Z", "path": "core/src/main/java/com/amplifyframework/core/DevMenuLogsFragment.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.os.Bundle;\n+import android.view.LayoutInflater;\n+import android.view.View;\n+import android.view.ViewGroup;\n+import androidx.fragment.app.Fragment;\n+\n+/**\n+ * A {@link Fragment} subclass representing the view\n+ * to display the logs on the developer menu.\n+ */\n+public final class DevMenuLogsFragment extends Fragment {", "originalCommit": "a8a3893c4557541453de1cfe356ad906e6d58134", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2NzIzMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454567231", "bodyText": "Hm, you now have two instances of the ShakeDetector, one in Amplify, and one in this Activity. Ideally, you could have one detector that broadcast to multiple listeners. Instead of the simple callback mechanism we are using right now, you could use Amplify.Hub instead. Then, just listen for a hub event in both locations -- from one detector instance.", "author": "jamesonwilliams", "createdAt": "2020-07-14T18:43:12Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuActivity.java", "diffHunk": "@@ -15,16 +15,22 @@\n \n package com.amplifyframework.core;\n \n-import android.app.Activity;\n import android.os.Bundle;\n-import android.view.KeyEvent;\n import android.view.View;\n+import androidx.fragment.app.FragmentActivity;\n+import androidx.navigation.NavController;\n+import androidx.navigation.Navigation;\n+import androidx.navigation.ui.AppBarConfiguration;\n+import androidx.navigation.ui.NavigationUI;\n \n /**\n  * This is the activity to display the developer menu.\n  */\n-public final class DeveloperMenuActivity extends Activity {\n-    // The parent layout for the developer menu.\n+public final class DeveloperMenuActivity extends FragmentActivity {\n+\n+    // Indicates whether this activity has started.\n+    private static boolean activityStarted;\n+    // Parent layout for the developer menu.\n     private View devMenuLayout;\n     // Detect and handle shake events.\n     private ShakeDetector detector;", "originalCommit": "a8a3893c4557541453de1cfe356ad906e6d58134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIxNTUzMA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455215530", "bodyText": "After rewriting the code, I now have only one instance of ShakeDetector (in DeveloperMenuManager). I also tried using Amplify.Hub, but that would require adding a new CategoryType for the developer menu in the HubChannel enum.", "author": "eeatonaws", "createdAt": "2020-07-15T17:28:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDU2NzIzMQ=="}], "type": "inlineReview"}, {"oid": "d8cce289d0c89e38e340c4173a014f2653d2b03f", "url": "https://github.com/aws-amplify/amplify-android/commit/d8cce289d0c89e38e340c4173a014f2653d2b03f", "message": "start and stop shake listener instead of having activityStarted field", "committedDate": "2020-07-14T21:35:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MzQxNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454663416", "bodyText": "Just an idea -- feel free to ignore --\nInstead of using the boolean, you could encode this behavior in your callback:\nfinal class ShakeDetector {\n    private final ShakeDetector.Listener listener;\n\n    ShakeDetector(ShakeDetector.Listener listener) {\n        this.listener = listener;\n    }\n\n    // Change this\n    @FunctionalInterface\n    interface Listener {\n        void onShakeDetected(ShakeDetector source);\n    }\n}\nThen you'll have an instance to call stopDetecting() on, in your lambda:\nShakeDetector detector = new ShakeDetector(context, it -> {\n    context.startActivity(mainIntent);\n    it.stopDetecting();\n});\nWithout changing the listener, you could already do:\nfinal AtomicReference<ShakeDetector.Listener> listener = new AtomicReference<>();\nShakeDetector detector = new ShakeDetector(context, () -> {\n    context.startActivity(mainIntent);\n    listener.get().stopDetecting();\n});\n^ This would give you a final reference inside of your lambda. The AtomicReference thing is sort of a kludge that I try to avoid if I can, though.", "author": "jamesonwilliams", "createdAt": "2020-07-14T21:43:40Z", "path": "core/src/main/java/com/amplifyframework/core/Amplify.java", "diffHunk": "@@ -179,6 +170,20 @@ private static void beginInitialization(@NonNull Category<? extends Plugin<?>> c\n         updatePluginRegistry(plugin, RegistryUpdateType.REMOVE);\n     }\n \n+    /**\n+     * Starts listening for a shake event and shows the developer menu on device shake.\n+     * @param context an Android Context\n+     */\n+    public static void enableDeveloperMenu(Context context) {\n+        // Start activity for developer menu on device shake\n+        Intent mainIntent = new Intent(context, DeveloperMenuActivity.class);\n+        mainIntent.setAction(Intent.ACTION_MAIN);\n+        mainIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+        ShakeDetector shakeDetector = new ShakeDetector(context, () -> context.startActivity(mainIntent),\n+                true);", "originalCommit": "d8cce289d0c89e38e340c4173a014f2653d2b03f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY3OTcwOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r454679709", "bodyText": "Thanks for the suggestion. Using the FunctionalInterface works well and it does seem cleaner than using a boolean.", "author": "eeatonaws", "createdAt": "2020-07-14T22:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDY2MzQxNg=="}], "type": "inlineReview"}, {"oid": "c85e091168cd6c399bfeb3e02fd00854a0a71626", "url": "https://github.com/aws-amplify/amplify-android/commit/c85e091168cd6c399bfeb3e02fd00854a0a71626", "message": "make ShakeDetector.Listener a FunctionalInterface and remove ShakeDetector boolean field", "committedDate": "2020-07-14T22:24:52Z", "type": "commit"}, {"oid": "84b7ed8ccac1ea95339bcf2f1a894c26b52e0462", "url": "https://github.com/aws-amplify/amplify-android/commit/84b7ed8ccac1ea95339bcf2f1a894c26b52e0462", "message": "created dev menu manager to handle showing and hiding dev menu", "committedDate": "2020-07-15T15:44:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI1MTg4OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455251889", "bodyText": "The name setVisibility makes me think this method would take a Visibility enum parameter, (GONE, INVISIBLE, VISIBLE).\nMaybe setVisible?", "author": "richardmcclellan", "createdAt": "2020-07-15T18:21:12Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuManager.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+/**\n+ * Manage the display and shake detection behavior for the\n+ * developer menu.\n+ */\n+public final class DeveloperMenuManager implements ShakeDetector.Listener {\n+    // An instance of DeveloperMenuManager.\n+    private static DeveloperMenuManager sInstance = new DeveloperMenuManager();\n+    // Indicates whether the developer menu is visible.\n+    private boolean visible;\n+    // Listens for shake events.\n+    private ShakeDetector shakeDetector;\n+    // Action to take when the developer menu should be hidden.\n+    private HideAction hideAction;\n+\n+    /**\n+     * Constructs a new DeveloperMenuManager.\n+     */\n+    private DeveloperMenuManager() { }\n+\n+    /**\n+     * Returns an instance of DeveloperMenuManager.\n+     * @return a DeveloperMenuManager\n+     */\n+    public static DeveloperMenuManager sharedInstance() {\n+        return sInstance;\n+    }\n+\n+    /**\n+     * Start listening for a shake event.\n+     * @param context an Android Context\n+     */\n+    public void startListening(Context context) {\n+        shakeDetector = new ShakeDetector(context, this);\n+        shakeDetector.startDetecting();\n+    }\n+\n+    @Override\n+    public void onShakeDetected() {\n+        if (visible) {\n+            if (hideAction != null) {\n+                hideAction.hideDeveloperMenu();\n+            }\n+            visible = false;\n+        } else {\n+            Context context = shakeDetector.getContext();\n+            Intent mainIntent = new Intent(context, DeveloperMenuActivity.class);\n+            mainIntent.setAction(Intent.ACTION_MAIN);\n+            mainIntent.setFlags(Intent.FLAG_ACTIVITY_NEW_TASK);\n+            context.startActivity(mainIntent);\n+            visible = true;\n+        }\n+    }\n+\n+    /**\n+     * Set the visibility of the developer menu.\n+     * @param visible boolean indicating whether the developer menu is visible.\n+     */\n+    public void setVisibility(boolean visible) {", "originalCommit": "84b7ed8ccac1ea95339bcf2f1a894c26b52e0462", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI1NTI2Nw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455255267", "bodyText": "It'd be better to lazily initialize this in sharedInstance() like this:\npublic static DeveloperMenuManager sharedInstance() {\n    if(sInstance == null) {\n        sInstance = new DeveloperMenuManager();\n    }\n    return sInstance;\n}", "author": "richardmcclellan", "createdAt": "2020-07-15T18:25:55Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuManager.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+/**\n+ * Manage the display and shake detection behavior for the\n+ * developer menu.\n+ */\n+public final class DeveloperMenuManager implements ShakeDetector.Listener {\n+    // An instance of DeveloperMenuManager.\n+    private static DeveloperMenuManager sInstance = new DeveloperMenuManager();", "originalCommit": "84b7ed8ccac1ea95339bcf2f1a894c26b52e0462", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI1NjYwNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455256604", "bodyText": "It'd probably be better for DeveloperMenuManager to just keep its own Context property, which gets set in startListening().  It isn't really the job of shakeDetector to be providing Context to others.", "author": "richardmcclellan", "createdAt": "2020-07-15T18:28:19Z", "path": "core/src/main/java/com/amplifyframework/core/DeveloperMenuManager.java", "diffHunk": "@@ -0,0 +1,100 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.core;\n+\n+import android.content.Context;\n+import android.content.Intent;\n+\n+/**\n+ * Manage the display and shake detection behavior for the\n+ * developer menu.\n+ */\n+public final class DeveloperMenuManager implements ShakeDetector.Listener {\n+    // An instance of DeveloperMenuManager.\n+    private static DeveloperMenuManager sInstance = new DeveloperMenuManager();\n+    // Indicates whether the developer menu is visible.\n+    private boolean visible;\n+    // Listens for shake events.\n+    private ShakeDetector shakeDetector;\n+    // Action to take when the developer menu should be hidden.\n+    private HideAction hideAction;\n+\n+    /**\n+     * Constructs a new DeveloperMenuManager.\n+     */\n+    private DeveloperMenuManager() { }\n+\n+    /**\n+     * Returns an instance of DeveloperMenuManager.\n+     * @return a DeveloperMenuManager\n+     */\n+    public static DeveloperMenuManager sharedInstance() {\n+        return sInstance;\n+    }\n+\n+    /**\n+     * Start listening for a shake event.\n+     * @param context an Android Context\n+     */\n+    public void startListening(Context context) {\n+        shakeDetector = new ShakeDetector(context, this);\n+        shakeDetector.startDetecting();\n+    }\n+\n+    @Override\n+    public void onShakeDetected() {\n+        if (visible) {\n+            if (hideAction != null) {\n+                hideAction.hideDeveloperMenu();\n+            }\n+            visible = false;\n+        } else {\n+            Context context = shakeDetector.getContext();", "originalCommit": "84b7ed8ccac1ea95339bcf2f1a894c26b52e0462", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI2MzIxNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455263217", "bodyText": "I initially had a Context field in DeveloperMenuManager, but there was a warning that this caused a memory leak since you can access a static instance of DeveloperMenuManager.\nEdit: I was able to get around the memory leak warning by using Context.getApplicationContext().", "author": "eeatonaws", "createdAt": "2020-07-15T18:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI1NjYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMwMzIwNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455303205", "bodyText": "Storing Context within a static variable is a valid concern for memory leaks.   The same concern is also valid though for storing it in ShakeDetector, since it is still stored in a static instance (DeveloperMenuManager.sharedInstance().shakeDetector.context).    The same concern is even valid for your first iteration of this PR, where you were starting the DeveloperMenuManager from a callback inside of the Amplify.configure method.    In all cases, you are holding onto a reference of Context indefinitely.\nIt's important to understand there are two types of Context in Android:\n\nThe Application context, which lives for the lifetime of your app\nAn Activity Context, which lives for the lifecycle of an Activity\n\nThe important thing is not to keep references to any Activity Context instances, beyond the lifecycle of that Activity because that will prevent the Activity from being removed from memory when it is finished (a memory leak).  Using the Application Context is okay though, since is available for the lifecycle of your app.  The only caveat to this is that the Application Context has more limited functionality than an Activity Context - you can't use it to show a dialog view, for example. I don't think that's actually a concern for this use case though.\nCustomers are probably passing in an Application Context to Amplify.configure(), since that's what we say to do in the setup docs.   There's no guarantee though - an Activity class is actually a subclass of Context, so they might be passing in an Activity.\nTo account for this, if an Activity is passed in, you can get an Application context from it by calling getApplicationContext() on the Activity.  This is something we should probably do to ensure we ensure we aren't causing any memory leaks.    Here's an example of how Firebase does something similar in their equivalent of Amplify.configure.  For now, I'd suggest putting some similar logic inside the startListening() method.\nRegarding the warning itself - where do you see that specifically?  Is it flagged by our checkstyle rules, or is it actually preventing the build from compiling?", "author": "richardmcclellan", "createdAt": "2020-07-15T19:52:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI1NjYwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTMxNzkyNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/632#discussion_r455317925", "bodyText": "The warning appears when I open DeveloperMenuManager.java and it also prevents the build from succeeding. Using Context.getApplicationContext() and adding a Context parameter to the constructor makes the warning disappear (the warning is still present if I set the context field to context.getApplicationContext() inside the startListening method).", "author": "eeatonaws", "createdAt": "2020-07-15T20:20:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTI1NjYwNA=="}], "type": "inlineReview"}, {"oid": "05ba5b230af901b31fe5b6d09dc6f43d231af55b", "url": "https://github.com/aws-amplify/amplify-android/commit/05ba5b230af901b31fe5b6d09dc6f43d231af55b", "message": "rename setVisibility method and do lazy initialization of DeveloperMenuManager instance", "committedDate": "2020-07-15T18:45:34Z", "type": "commit"}, {"oid": "aa5f72b7d5feac88db573486227e9d8fd4b7f45e", "url": "https://github.com/aws-amplify/amplify-android/commit/aa5f72b7d5feac88db573486227e9d8fd4b7f45e", "message": "create context field in DeveloperMenuManager", "committedDate": "2020-07-15T19:10:42Z", "type": "commit"}]}