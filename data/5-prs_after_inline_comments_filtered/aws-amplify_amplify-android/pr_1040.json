{"pr_number": 1040, "pr_title": "fix(aws-datastore): store schema float as a java double", "pr_createdAt": "2020-12-09T22:48:14Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/1040", "timeline": [{"oid": "3ec606da06dc4dd42e65f9ddbd19c4c898df0a3e", "url": "https://github.com/aws-amplify/amplify-android/commit/3ec606da06dc4dd42e65f9ddbd19c4c898df0a3e", "message": "fix(aws-datastore): store schema float as a java double\n\nThe Amplify DataStore leverages GraphQL to define its data models.\nTherefor, our intention is to support a strict superset of the primitive\ntypes described by the GraphQL specification.\n\nWhile implementing the DataStore, we overlooked that the GraphQL \"Float\"\ntype is a double-precision value. The SQL adapter is able to accomodate\nthis, currently. However, our Java codegen stores a float value, and we\nlook for values of Float type while serializing and deserializing object\ndata.\n\nUnfortunately, we need to continue to support that behavior, since\ncustomers will have Float values in their models. None-the-less, the\nFlutter consumer of this library rightly wants to use the actual GraphQL\nscalar types, and see the same behavior accross iOS and Android. As a\nresult of these constraints, we must support both types in the library,\nfor now.\n\nThe decision to express a floating point value as a Java Float or Double\nwill be taken from the type of the value in the model object. For our\nJava models, it will be a Float. When Map data is passed from Flutter,\nit will be a Double. Both SQL and AppSync will treat both as a double,\nwhich is large enough to accomodate both types. Or in other words, both\ntypes are supported, now.\n\nThe next step will be to update the Java codegen, so that it represents\nGraphQL Float types as Java Doubles. This change will allow new\ncustomers to use the fix, while we continue to support existing\ncustomers' models.\n\nResolves: https://github.com/aws-amplify/amplify-android/issues/1031", "committedDate": "2020-12-09T23:18:32Z", "type": "commit"}, {"oid": "3ec606da06dc4dd42e65f9ddbd19c4c898df0a3e", "url": "https://github.com/aws-amplify/amplify-android/commit/3ec606da06dc4dd42e65f9ddbd19c4c898df0a3e", "message": "fix(aws-datastore): store schema float as a java double\n\nThe Amplify DataStore leverages GraphQL to define its data models.\nTherefor, our intention is to support a strict superset of the primitive\ntypes described by the GraphQL specification.\n\nWhile implementing the DataStore, we overlooked that the GraphQL \"Float\"\ntype is a double-precision value. The SQL adapter is able to accomodate\nthis, currently. However, our Java codegen stores a float value, and we\nlook for values of Float type while serializing and deserializing object\ndata.\n\nUnfortunately, we need to continue to support that behavior, since\ncustomers will have Float values in their models. None-the-less, the\nFlutter consumer of this library rightly wants to use the actual GraphQL\nscalar types, and see the same behavior accross iOS and Android. As a\nresult of these constraints, we must support both types in the library,\nfor now.\n\nThe decision to express a floating point value as a Java Float or Double\nwill be taken from the type of the value in the model object. For our\nJava models, it will be a Float. When Map data is passed from Flutter,\nit will be a Double. Both SQL and AppSync will treat both as a double,\nwhich is large enough to accomodate both types. Or in other words, both\ntypes are supported, now.\n\nThe next step will be to update the Java codegen, so that it represents\nGraphQL Float types as Java Doubles. This change will allow new\ncustomers to use the fix, while we continue to support existing\ncustomers' models.\n\nResolves: https://github.com/aws-amplify/amplify-android/issues/1031", "committedDate": "2020-12-09T23:18:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTcyMjEzMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/1040#discussion_r539722133", "bodyText": "Accidentally fixed one of the bugs here.\nThe milliseconds issue is unrelated. That's about AppSync using AWSTimestamp as:\n\nthe number of seconds that have elapsed since 1970-01-01T00:00Z\n\nBut then it returns a value in milliseconds in the ConflictUnhandled data, in production \ud83e\udd37 . Most likely straight from a Java API without conversion.", "author": "jamesonwilliams", "createdAt": "2020-12-09T23:21:28Z", "path": "aws-datastore/src/test/java/com/amplifyframework/datastore/appsync/AppSyncConflictUnhandledErrorTest.java", "diffHunk": "@@ -119,9 +119,8 @@ public void conflictErrorExtractedIfPresent() {\n             AppSyncConflictUnhandledError.findFirst(Note.class, response.getErrors());\n         assertNotNull(conflictUnhandledError);\n \n-        // TODO: The JSON document has '1601499066604' as the time. These differ by 26604,\n-        // also the TimeUnit appears to be wrong. Should be MILLISECONDS.\n-        Temporal.Timestamp lastChangedAt = new Temporal.Timestamp(1601499040000L, TimeUnit.SECONDS);\n+        // TODO: the TimeUnit appears to be wrong. Should be MILLISECONDS?", "originalCommit": "3ec606da06dc4dd42e65f9ddbd19c4c898df0a3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczNDMxNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/1040#discussion_r539734317", "bodyText": "Could we get rid of the FLOAT type at some point in the future?  We can't now, since the codegen'd models all have Float objects, but if we change codegen to generate Double objects, then we could, right?", "author": "richardmcclellan", "createdAt": "2020-12-09T23:47:15Z", "path": "aws-api-appsync/src/main/java/com/amplifyframework/core/model/types/JavaFieldType.java", "diffHunk": "@@ -46,6 +46,11 @@\n      */\n     FLOAT(Float.class),", "originalCommit": "3ec606da06dc4dd42e65f9ddbd19c4c898df0a3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczNjQ2OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/1040#discussion_r539736468", "bodyText": "Yes! Down the road, when the majority of folks are using the new modelgen, we could drop the Floats. Truthfully I suspect we could do it now, if we showed people how to update their models. But, it would technically be a breaking change.", "author": "jamesonwilliams", "createdAt": "2020-12-09T23:52:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTczNDMxNw=="}], "type": "inlineReview"}]}