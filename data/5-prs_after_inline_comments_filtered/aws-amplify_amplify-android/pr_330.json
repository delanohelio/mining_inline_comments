{"pr_number": 330, "pr_title": "Auth Category to Staging Branch [Do Not Merge To Master]", "pr_createdAt": "2020-03-26T15:45:50Z", "pr_url": "https://github.com/aws-amplify/amplify-android/pull/330", "timeline": [{"oid": "a7dfe88427c7082c0d4eecea8832d6afb48f6758", "url": "https://github.com/aws-amplify/amplify-android/commit/a7dfe88427c7082c0d4eecea8832d6afb48f6758", "message": "Initial commit", "committedDate": "2020-03-26T15:24:45Z", "type": "commit"}, {"oid": "5ebe3fa3e727e57473fcb418a658aed5c9e7e8af", "url": "https://github.com/aws-amplify/amplify-android/commit/5ebe3fa3e727e57473fcb418a658aed5c9e7e8af", "message": "Merged in master and updated comments", "committedDate": "2020-03-26T15:44:48Z", "type": "commit"}, {"oid": "8c97635dcbc96a73b21e049ae2f256c244c7eaa8", "url": "https://github.com/aws-amplify/amplify-android/commit/8c97635dcbc96a73b21e049ae2f256c244c7eaa8", "message": "Fixes checkstyle", "committedDate": "2020-03-26T15:49:15Z", "type": "commit"}, {"oid": "bfba833d7de14e85971eee239367bc35a58f4140", "url": "https://github.com/aws-amplify/amplify-android/commit/bfba833d7de14e85971eee239367bc35a58f4140", "message": "Raise minSdkVersion to 16 (#327)\n\nGiven the vanishingly small number of ICS users according to Google's\r\nDistribution Dashboard and our own log analysis and industry trends\r\n(Google Play Services supports API Level 16+, for example), we are\r\ndropping support for API Level 15.", "committedDate": "2020-03-26T17:04:20Z", "type": "commit"}, {"oid": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "url": "https://github.com/aws-amplify/amplify-android/commit/1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "message": "Updated dependencies", "committedDate": "2020-03-26T18:57:10Z", "type": "commit"}, {"oid": "2005012c0bf1ce9a4ec651ba9683139e6ec27682", "url": "https://github.com/aws-amplify/amplify-android/commit/2005012c0bf1ce9a4ec651ba9683139e6ec27682", "message": "Update the plugin key for analytics to match one generated by the cli and update configuration method (#328)", "committedDate": "2020-03-26T19:04:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxODE5Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399018193", "bodyText": "can be final, since the reference to the collection won't change", "author": "jamesonwilliams", "createdAt": "2020-03-27T03:39:59Z", "path": "core/src/main/java/com/amplifyframework/auth/options/AuthSignUpOptions.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.options;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public final class AuthSignUpOptions {\n+    private final Map<String, String> userAttributes;\n+    private final Map<String, String> validationData;\n+\n+    private AuthSignUpOptions(\n+            Map<String, String> userAttributes,\n+            Map<String, String> validationData\n+    ) {\n+        this.userAttributes = userAttributes;\n+        this.validationData = validationData;\n+    }\n+\n+    @NonNull\n+    public Map<String, String> getUserAttributes() {\n+        return userAttributes;\n+    }\n+\n+    @NonNull\n+    public Map<String, String> getValidationData() {\n+        return validationData;\n+    }\n+\n+    @NonNull\n+    public static Builder builder() {\n+        return new Builder();\n+    }\n+\n+    public static final class Builder {\n+        private Map<String, String> userAttributes;\n+        private Map<String, String> validationData;", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0NTA5NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399345094", "bodyText": "Sounds good", "author": "TrekSoft", "createdAt": "2020-03-27T15:24:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAxODE5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMDM1OA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399020358", "bodyText": "You can probably create a subclass of Callback, that includes some of hte common boiler-plate. Somewhere (I think its checked in?) I had a DelegatingCallback, or something like that. Basically, you give it a Consumer<R> (result) and a Consumer` (exception) and then the se callback emthod delegate to thsoe consumers.\nLooks like\nfinal class DelegatingCallback<T> implements Callback<T> {\n    private final Consumer<T> onResult;\n    private final Consumer<Exception> onError;\n\n    DelegatingCallback(..., ... /* blah blah) {\n    }\n\n    public static <T> DelegatingCallback<T> create(Consumer<T> onResult, Consumer<Exception> onError) {\n       reutrn new DelegatignCallback(...);\n    }\n\n    @Override\n    public void onResult(T result) {\n        onResult.accept(result);\n    }\n\n    @Override\n    public void onError(Exception error) {\n        onError.accept(error);\n    }\n}\n\nWith this, you can change line 113 to:\nDelegatingCallback.create(signUpResult -> {\n    onSuccess.accept(new AuthSignUpResult(\n    ));\n}, exception -> {\n    onResult.accept(new ApiException(/* wrap the Exception that mobile client provides (ugh!) */));\n});\n\nThis sounds like overkill, but consider that you would use it to reduce the boiler plate of every interaction with the mobile client.\nOh well actually, and I already wrote it. Its in the test dir I think. You might just be able to move it into core/src/main somewhere appropriate and start using it.", "author": "jamesonwilliams", "createdAt": "2020-03-27T03:49:51Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -0,0 +1,430 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n+import com.amplifyframework.auth.AuthException;\n+import com.amplifyframework.auth.AuthPlugin;\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.mobile.client.Callback;\n+import com.amazonaws.mobile.client.HostedUIOptions;\n+import com.amazonaws.mobile.client.IdentityProvider;\n+import com.amazonaws.mobile.client.SignInUIOptions;\n+import com.amazonaws.mobile.client.UserState;\n+import com.amazonaws.mobile.client.UserStateDetails;\n+import com.amazonaws.mobile.client.results.SignInResult;\n+import com.amazonaws.mobile.client.results.SignInState;\n+import com.amazonaws.mobile.client.results.SignUpResult;\n+import com.amazonaws.mobile.client.results.Tokens;\n+import com.amazonaws.mobile.client.results.UserCodeDeliveryDetails;\n+import com.amazonaws.mobile.config.AWSConfiguration;\n+import org.json.JSONObject;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class AWSCognitoAuthPlugin extends AuthPlugin<AWSMobileClient> {\n+    private static final String AWS_COGNITO_AUTH_PLUGIN_KEY = \"awsCognitoAuthPlugin\";\n+    private static final long SECONDS_BEFORE_TIMEOUT = 10;\n+\n+    @NonNull\n+    @Override\n+    public String getPluginKey() {\n+        return AWS_COGNITO_AUTH_PLUGIN_KEY;\n+    }\n+\n+    @Override\n+    public void configure(\n+            @NonNull JSONObject pluginConfiguration,\n+            @NonNull Context context\n+    ) throws AmplifyException {\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        AWSMobileClient.getInstance().initialize(\n+            context,\n+            new AWSConfiguration(pluginConfiguration),\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    latch.countDown();\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    throw new IllegalStateException(\"Failed to instantiate AWSMobileClient\", error);\n+                }\n+            }\n+        );\n+\n+        try {\n+            if (latch.await(SECONDS_BEFORE_TIMEOUT, TimeUnit.SECONDS)) {\n+                return;\n+            } else {\n+                throw new IllegalStateException(\n+                    \"Failed to instantiate AWSMobileClient within \" + SECONDS_BEFORE_TIMEOUT + \" seconds\"\n+                );\n+            }\n+        } catch (InterruptedException error) {\n+            throw new IllegalStateException(error);\n+        }\n+    }\n+\n+    public void signUp(\n+            String username,\n+            String password,\n+            AuthSignUpOptions options,\n+            final Consumer<AuthSignUpResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signUp(\n+            username,\n+            password,\n+            options.getUserAttributes(),\n+            options.getValidationData(),\n+            new Callback<SignUpResult>() {", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0OTExNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399349114", "bodyText": "Hmm, I see what you're saying but I think especially since this is only a temporary implementation of the plugin wrapping AWSMobileClient for GA and the plan is to do a fast follow with a completely fresh new Auth implementation, it probably isn't worth doing now.", "author": "TrekSoft", "createdAt": "2020-03-27T15:29:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMDM1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM2MzMzNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399363336", "bodyText": "And while there are a couple extra lines of code added this way vs. the way you recommend, it's actually faster to write because the IDE autocompletes it.", "author": "TrekSoft", "createdAt": "2020-03-27T15:50:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMDM1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMDkzMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399020933", "bodyText": "We use this approach in test, towards simplifying a list of assertions, sort of like a checklist. \"Okay, if this worked, and this worked, and this worked...\"\nBut in source code, it would be best to keep this async all the way through.\nThe DataStore performs some async initialization. Maybe auth will need to, as well. There is a beginInitialization hook in the Plugin class where this could fit.\nYou'll need to make an arrangement for the other method to queue up after that initialization completes. But, there's an example of that in the DataStore as well.\nWe can probably extract any shared logic to a common area, where both plugins could make use of the afterInitialization(....) (I think its called, for DataStore.)", "author": "jamesonwilliams", "createdAt": "2020-03-27T03:52:19Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -0,0 +1,430 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n+import com.amplifyframework.auth.AuthException;\n+import com.amplifyframework.auth.AuthPlugin;\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.mobile.client.Callback;\n+import com.amazonaws.mobile.client.HostedUIOptions;\n+import com.amazonaws.mobile.client.IdentityProvider;\n+import com.amazonaws.mobile.client.SignInUIOptions;\n+import com.amazonaws.mobile.client.UserState;\n+import com.amazonaws.mobile.client.UserStateDetails;\n+import com.amazonaws.mobile.client.results.SignInResult;\n+import com.amazonaws.mobile.client.results.SignInState;\n+import com.amazonaws.mobile.client.results.SignUpResult;\n+import com.amazonaws.mobile.client.results.Tokens;\n+import com.amazonaws.mobile.client.results.UserCodeDeliveryDetails;\n+import com.amazonaws.mobile.config.AWSConfiguration;\n+import org.json.JSONObject;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class AWSCognitoAuthPlugin extends AuthPlugin<AWSMobileClient> {\n+    private static final String AWS_COGNITO_AUTH_PLUGIN_KEY = \"awsCognitoAuthPlugin\";\n+    private static final long SECONDS_BEFORE_TIMEOUT = 10;\n+\n+    @NonNull\n+    @Override\n+    public String getPluginKey() {\n+        return AWS_COGNITO_AUTH_PLUGIN_KEY;\n+    }\n+\n+    @Override\n+    public void configure(\n+            @NonNull JSONObject pluginConfiguration,\n+            @NonNull Context context\n+    ) throws AmplifyException {\n+        final CountDownLatch latch = new CountDownLatch(1);", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0NzUxNQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399347515", "bodyText": "Alright I'll find out more about this from you on our call", "author": "TrekSoft", "createdAt": "2020-03-27T15:27:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMDkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk4OTUzNA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r400989534", "bodyText": "Discussed in the call that given this is calling AWSMobileClient's configure method it makes sense to leave this here. Were going to try using the Await class but it's timeout error handling isn't suitable for this so leaving it as is.", "author": "TrekSoft", "createdAt": "2020-03-31T15:07:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMDkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMTU2Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399021563", "bodyText": "Consider using a switch here. It would looke like:\nswitch (state) {\n    case foo:\n    case bar:\n    case baz:\n        onSuccess.accept(....);\n        break;\n    default:\n        helperMethodForYourElseBranch(...);\n        break;\n}", "author": "jamesonwilliams", "createdAt": "2020-03-27T03:55:01Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -0,0 +1,430 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n+import com.amplifyframework.auth.AuthException;\n+import com.amplifyframework.auth.AuthPlugin;\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.mobile.client.Callback;\n+import com.amazonaws.mobile.client.HostedUIOptions;\n+import com.amazonaws.mobile.client.IdentityProvider;\n+import com.amazonaws.mobile.client.SignInUIOptions;\n+import com.amazonaws.mobile.client.UserState;\n+import com.amazonaws.mobile.client.UserStateDetails;\n+import com.amazonaws.mobile.client.results.SignInResult;\n+import com.amazonaws.mobile.client.results.SignInState;\n+import com.amazonaws.mobile.client.results.SignUpResult;\n+import com.amazonaws.mobile.client.results.Tokens;\n+import com.amazonaws.mobile.client.results.UserCodeDeliveryDetails;\n+import com.amazonaws.mobile.config.AWSConfiguration;\n+import org.json.JSONObject;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class AWSCognitoAuthPlugin extends AuthPlugin<AWSMobileClient> {\n+    private static final String AWS_COGNITO_AUTH_PLUGIN_KEY = \"awsCognitoAuthPlugin\";\n+    private static final long SECONDS_BEFORE_TIMEOUT = 10;\n+\n+    @NonNull\n+    @Override\n+    public String getPluginKey() {\n+        return AWS_COGNITO_AUTH_PLUGIN_KEY;\n+    }\n+\n+    @Override\n+    public void configure(\n+            @NonNull JSONObject pluginConfiguration,\n+            @NonNull Context context\n+    ) throws AmplifyException {\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        AWSMobileClient.getInstance().initialize(\n+            context,\n+            new AWSConfiguration(pluginConfiguration),\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    latch.countDown();\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    throw new IllegalStateException(\"Failed to instantiate AWSMobileClient\", error);\n+                }\n+            }\n+        );\n+\n+        try {\n+            if (latch.await(SECONDS_BEFORE_TIMEOUT, TimeUnit.SECONDS)) {\n+                return;\n+            } else {\n+                throw new IllegalStateException(\n+                    \"Failed to instantiate AWSMobileClient within \" + SECONDS_BEFORE_TIMEOUT + \" seconds\"\n+                );\n+            }\n+        } catch (InterruptedException error) {\n+            throw new IllegalStateException(error);\n+        }\n+    }\n+\n+    public void signUp(\n+            String username,\n+            String password,\n+            AuthSignUpOptions options,\n+            final Consumer<AuthSignUpResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signUp(\n+            username,\n+            password,\n+            options.getUserAttributes(),\n+            options.getValidationData(),\n+            new Callback<SignUpResult>() {\n+                @Override\n+                public void onResult(SignUpResult result) {\n+                    UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                    onSuccess.accept(new AuthSignUpResult(\n+                        result.getConfirmationState(),\n+                        details != null\n+                            ? new AuthCodeDeliveryDetails(\n+                                details.getDestination(),\n+                                details.getDeliveryMedium(),\n+                                details.getAttributeName()\n+                            )\n+                            : null\n+                    ));\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    onException.accept(\n+                        new AuthException(\"Sign up failed\", error, \"See attached exception for more details\")\n+                    );\n+                }\n+            }\n+        );\n+    }\n+\n+    public void confirmSignUp(\n+        String username,\n+        String code,\n+        final Consumer<AuthSignUpResult> onSuccess,\n+        final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmSignUp(username, code, new Callback<SignUpResult>() {\n+            @Override\n+            public void onResult(SignUpResult result) {\n+                UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                onSuccess.accept(new AuthSignUpResult(\n+                    result.getConfirmationState(),\n+                    details != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            details.getDestination(),\n+                            details.getDeliveryMedium(),\n+                            details.getAttributeName()\n+                        )\n+                        : null\n+                ));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\"Confirm sign up failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().resendSignUp(username, new Callback<SignUpResult>() {\n+            @Override\n+            public void onResult(SignUpResult result) {\n+                UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                onSuccess.accept(new AuthSignUpResult(\n+                    result.getConfirmationState(),\n+                    details != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            details.getDestination(),\n+                            details.getDeliveryMedium(),\n+                            details.getAttributeName()\n+                        )\n+                        : null\n+                ));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\n+                        \"Resend confirmation code failed\",\n+                        error,\n+                        \"See attached exception for more details\"\n+                    )\n+                );\n+            }\n+        });\n+    }\n+\n+    public void signIn(\n+        String username,\n+        String password,\n+        AuthSignInOptions options,\n+        final Consumer<AuthSignInResult> onSuccess,\n+        final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signIn(username, password, null, new Callback<SignInResult>() {\n+            @Override\n+            public void onResult(SignInResult result) {\n+                AuthUserState state;\n+                UserCodeDeliveryDetails oldDetails = result.getCodeDetails();\n+                // Take information from Cognito specific object and wrap it in the new Amplify object\n+                AuthCodeDeliveryDetails newDetails =\n+                    oldDetails != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            oldDetails.getDestination(),\n+                            oldDetails.getDeliveryMedium(),\n+                            oldDetails.getAttributeName()\n+                        )\n+                        : null;\n+\n+                if (result.getSignInState().equals(SignInState.DONE)) {\n+                    state = AuthUserState.SIGNED_IN;\n+                } else {\n+                    state = AuthUserState.SIGNED_OUT;\n+                }\n+\n+                onSuccess.accept(new AuthSignInResult(state, newDetails));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\"Sign in failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    public void signIn(\n+            String username,\n+            String password,\n+            final Consumer<AuthSignInResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        signIn(username, password, null, onSuccess, onException);\n+    }\n+\n+    public void signInWithUI(\n+            Activity callingActivity,\n+            final Consumer<String> onSuccess,\n+            final Consumer<AmplifyException> onException\n+    ) {\n+        HostedUIOptions hostedUIOptions = HostedUIOptions.builder()\n+                .scopes(\"openid\", \"email\")\n+                .build();\n+        SignInUIOptions signInUIOptions = SignInUIOptions.builder()\n+                .hostedUIOptions(hostedUIOptions)\n+                .build();\n+\n+        AWSMobileClient.getInstance().showSignIn(callingActivity, signInUIOptions, new Callback<UserStateDetails>() {\n+            @Override\n+            public void onResult(UserStateDetails details) {\n+                onSuccess.accept(details.getUserState().toString());\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AmplifyException(\"Sign in with UI failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    public void handleSignInWithUIResponse(Intent intent) {\n+        AWSMobileClient.getInstance().handleAuthResponse(intent);\n+    }\n+\n+    public void signInWithFacebook(\n+            String token,\n+            final Consumer<String> onSuccess,\n+            final Consumer<AmplifyException> onException\n+    ) {\n+        AWSMobileClient.getInstance().federatedSignIn(\n+            IdentityProvider.FACEBOOK.toString(),\n+            token,\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    onSuccess.accept(result.getUserState().toString());\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    onException.accept(\n+                        new AmplifyException(\n+                                \"Sign in with Facebook failed\",\n+                                error,\n+                                \"See attached exception for more details\"\n+                        )\n+                    );\n+                }\n+            }\n+        );\n+    }\n+\n+    // The result of a success callback is an object of type AWSCognitoAuthSession so that when the result\n+    // is cast to that type, the following Cognito specific fields can be retrieved:\n+    //   - AWSCredentials\n+    //   - Cognito Identity ID\n+    //   - Cognito Access Token\n+    //   - Cognito ID Token\n+    //   - Cognito Refresh Token\n+    @Override\n+    public void currentAuthState(\n+            @NonNull Consumer<AuthSession> onSuccess,\n+            @NonNull Consumer<AuthException> onError\n+    ) {\n+        try {\n+            AWSMobileClient.getInstance().currentUserState(new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    UserState state = result.getUserState();\n+\n+                    if (state.equals(UserState.SIGNED_OUT) ||\n+                            state.equals(UserState.SIGNED_OUT_FEDERATED_TOKENS_INVALID) ||\n+                            state.equals(UserState.SIGNED_OUT_USER_POOLS_TOKENS_INVALID)", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0OTI2NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399349265", "bodyText": "Ok", "author": "TrekSoft", "createdAt": "2020-03-27T15:30:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMTU2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMjU1MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399022551", "bodyText": "This is highly nested. Any calls to AWSMobileClient you do inside of the callback, I would pull out into helper methods.\nThis is getting into the general software problem known as \"callback hell.\". That website has some general factoring tips to help avoid it. I'll offer a couple other thoughts --\nRx Single and Completable can help.\nInstead of a pattern:\nfoo(() -> {\n    bar(() -> {\n        baz();\n    }\n});\n\nWhere each call nests,\nYou can \"chomp\" down:\nfoo()\n    .andThen(bar())\n    .andThen(baz())\n\nOr, if providing result types from the operations,\nfoo()\n    .flatMap(result -> bar(result))\n    .flatMap(result -> baz(result))\n\nOf course, you'd have to add a dependency on RxJava to use those. Which may be overkill for this plugin unless you use it extensively. (Or, require it on a public API surface.)", "author": "jamesonwilliams", "createdAt": "2020-03-27T03:59:16Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -0,0 +1,430 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n+import com.amplifyframework.auth.AuthException;\n+import com.amplifyframework.auth.AuthPlugin;\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.mobile.client.Callback;\n+import com.amazonaws.mobile.client.HostedUIOptions;\n+import com.amazonaws.mobile.client.IdentityProvider;\n+import com.amazonaws.mobile.client.SignInUIOptions;\n+import com.amazonaws.mobile.client.UserState;\n+import com.amazonaws.mobile.client.UserStateDetails;\n+import com.amazonaws.mobile.client.results.SignInResult;\n+import com.amazonaws.mobile.client.results.SignInState;\n+import com.amazonaws.mobile.client.results.SignUpResult;\n+import com.amazonaws.mobile.client.results.Tokens;\n+import com.amazonaws.mobile.client.results.UserCodeDeliveryDetails;\n+import com.amazonaws.mobile.config.AWSConfiguration;\n+import org.json.JSONObject;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class AWSCognitoAuthPlugin extends AuthPlugin<AWSMobileClient> {\n+    private static final String AWS_COGNITO_AUTH_PLUGIN_KEY = \"awsCognitoAuthPlugin\";\n+    private static final long SECONDS_BEFORE_TIMEOUT = 10;\n+\n+    @NonNull\n+    @Override\n+    public String getPluginKey() {\n+        return AWS_COGNITO_AUTH_PLUGIN_KEY;\n+    }\n+\n+    @Override\n+    public void configure(\n+            @NonNull JSONObject pluginConfiguration,\n+            @NonNull Context context\n+    ) throws AmplifyException {\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        AWSMobileClient.getInstance().initialize(\n+            context,\n+            new AWSConfiguration(pluginConfiguration),\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    latch.countDown();\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    throw new IllegalStateException(\"Failed to instantiate AWSMobileClient\", error);\n+                }\n+            }\n+        );\n+\n+        try {\n+            if (latch.await(SECONDS_BEFORE_TIMEOUT, TimeUnit.SECONDS)) {\n+                return;\n+            } else {\n+                throw new IllegalStateException(\n+                    \"Failed to instantiate AWSMobileClient within \" + SECONDS_BEFORE_TIMEOUT + \" seconds\"\n+                );\n+            }\n+        } catch (InterruptedException error) {\n+            throw new IllegalStateException(error);\n+        }\n+    }\n+\n+    public void signUp(\n+            String username,\n+            String password,\n+            AuthSignUpOptions options,\n+            final Consumer<AuthSignUpResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signUp(\n+            username,\n+            password,\n+            options.getUserAttributes(),\n+            options.getValidationData(),\n+            new Callback<SignUpResult>() {\n+                @Override\n+                public void onResult(SignUpResult result) {\n+                    UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                    onSuccess.accept(new AuthSignUpResult(\n+                        result.getConfirmationState(),\n+                        details != null\n+                            ? new AuthCodeDeliveryDetails(\n+                                details.getDestination(),\n+                                details.getDeliveryMedium(),\n+                                details.getAttributeName()\n+                            )\n+                            : null\n+                    ));\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    onException.accept(\n+                        new AuthException(\"Sign up failed\", error, \"See attached exception for more details\")\n+                    );\n+                }\n+            }\n+        );\n+    }\n+\n+    public void confirmSignUp(\n+        String username,\n+        String code,\n+        final Consumer<AuthSignUpResult> onSuccess,\n+        final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmSignUp(username, code, new Callback<SignUpResult>() {\n+            @Override\n+            public void onResult(SignUpResult result) {\n+                UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                onSuccess.accept(new AuthSignUpResult(\n+                    result.getConfirmationState(),\n+                    details != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            details.getDestination(),\n+                            details.getDeliveryMedium(),\n+                            details.getAttributeName()\n+                        )\n+                        : null\n+                ));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\"Confirm sign up failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().resendSignUp(username, new Callback<SignUpResult>() {\n+            @Override\n+            public void onResult(SignUpResult result) {\n+                UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                onSuccess.accept(new AuthSignUpResult(\n+                    result.getConfirmationState(),\n+                    details != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            details.getDestination(),\n+                            details.getDeliveryMedium(),\n+                            details.getAttributeName()\n+                        )\n+                        : null\n+                ));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\n+                        \"Resend confirmation code failed\",\n+                        error,\n+                        \"See attached exception for more details\"\n+                    )\n+                );\n+            }\n+        });\n+    }\n+\n+    public void signIn(\n+        String username,\n+        String password,\n+        AuthSignInOptions options,\n+        final Consumer<AuthSignInResult> onSuccess,\n+        final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signIn(username, password, null, new Callback<SignInResult>() {\n+            @Override\n+            public void onResult(SignInResult result) {\n+                AuthUserState state;\n+                UserCodeDeliveryDetails oldDetails = result.getCodeDetails();\n+                // Take information from Cognito specific object and wrap it in the new Amplify object\n+                AuthCodeDeliveryDetails newDetails =\n+                    oldDetails != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            oldDetails.getDestination(),\n+                            oldDetails.getDeliveryMedium(),\n+                            oldDetails.getAttributeName()\n+                        )\n+                        : null;\n+\n+                if (result.getSignInState().equals(SignInState.DONE)) {\n+                    state = AuthUserState.SIGNED_IN;\n+                } else {\n+                    state = AuthUserState.SIGNED_OUT;\n+                }\n+\n+                onSuccess.accept(new AuthSignInResult(state, newDetails));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\"Sign in failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    public void signIn(\n+            String username,\n+            String password,\n+            final Consumer<AuthSignInResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        signIn(username, password, null, onSuccess, onException);\n+    }\n+\n+    public void signInWithUI(\n+            Activity callingActivity,\n+            final Consumer<String> onSuccess,\n+            final Consumer<AmplifyException> onException\n+    ) {\n+        HostedUIOptions hostedUIOptions = HostedUIOptions.builder()\n+                .scopes(\"openid\", \"email\")\n+                .build();\n+        SignInUIOptions signInUIOptions = SignInUIOptions.builder()\n+                .hostedUIOptions(hostedUIOptions)\n+                .build();\n+\n+        AWSMobileClient.getInstance().showSignIn(callingActivity, signInUIOptions, new Callback<UserStateDetails>() {\n+            @Override\n+            public void onResult(UserStateDetails details) {\n+                onSuccess.accept(details.getUserState().toString());\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AmplifyException(\"Sign in with UI failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    public void handleSignInWithUIResponse(Intent intent) {\n+        AWSMobileClient.getInstance().handleAuthResponse(intent);\n+    }\n+\n+    public void signInWithFacebook(\n+            String token,\n+            final Consumer<String> onSuccess,\n+            final Consumer<AmplifyException> onException\n+    ) {\n+        AWSMobileClient.getInstance().federatedSignIn(\n+            IdentityProvider.FACEBOOK.toString(),\n+            token,\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    onSuccess.accept(result.getUserState().toString());\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    onException.accept(\n+                        new AmplifyException(\n+                                \"Sign in with Facebook failed\",\n+                                error,\n+                                \"See attached exception for more details\"\n+                        )\n+                    );\n+                }\n+            }\n+        );\n+    }\n+\n+    // The result of a success callback is an object of type AWSCognitoAuthSession so that when the result\n+    // is cast to that type, the following Cognito specific fields can be retrieved:\n+    //   - AWSCredentials\n+    //   - Cognito Identity ID\n+    //   - Cognito Access Token\n+    //   - Cognito ID Token\n+    //   - Cognito Refresh Token\n+    @Override\n+    public void currentAuthState(\n+            @NonNull Consumer<AuthSession> onSuccess,\n+            @NonNull Consumer<AuthException> onError\n+    ) {\n+        try {\n+            AWSMobileClient.getInstance().currentUserState(new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    UserState state = result.getUserState();\n+\n+                    if (state.equals(UserState.SIGNED_OUT) ||\n+                            state.equals(UserState.SIGNED_OUT_FEDERATED_TOKENS_INVALID) ||\n+                            state.equals(UserState.SIGNED_OUT_USER_POOLS_TOKENS_INVALID)\n+                    ) {\n+                        onSuccess.accept(new AWSCognitoAuthSession(AuthUserState.SIGNED_OUT));\n+                    } else {\n+                        final AWSCognitoAuthSession session;\n+                        final CountDownLatch latch = new CountDownLatch(2);\n+\n+                        if (state.equals(UserState.SIGNED_IN) || state.equals(UserState.GUEST)) {\n+                            session = new AWSCognitoAuthSession(\n+                                    state.equals(UserState.SIGNED_IN)\n+                                            ? AuthUserState.SIGNED_IN\n+                                            : AuthUserState.GUEST,\n+                                    null,\n+                                    AWSMobileClient.getInstance().getIdentityId(),\n+                                    null,\n+                                    null,\n+                                    null\n+                            );\n+\n+                            AWSMobileClient.getInstance().getTokens(new Callback<Tokens>() {", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzMjMyMQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399332321", "bodyText": "There's only one level of nesting here right? After currentUserState succeeds, I make a bunch of calls in parallel depending on the result.", "author": "TrekSoft", "createdAt": "2020-03-27T15:06:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMjU1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMjk3Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399022976", "bodyText": "Maybe you want a utility method where you pass in a Tokens, and get back a fully populated AWSCognitoAuthSession  object. I guess, AWSCognitoAuthSessionFactory would be a good name for it?\n...\n    public static AWSCognitoAuthSession fromTokens(Tokens tokens) {\n       AWSCognitoAuthSession session = new AWSCognitoAuthSession();\n       ... set fields\n       return session;\n    }\n\nThis would be economical from a software craft standpoint if you will use the utility ~3+ times, probably?", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:01:25Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthPlugin.java", "diffHunk": "@@ -0,0 +1,430 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import android.app.Activity;\n+import android.content.Context;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.AuthCodeDeliveryDetails;\n+import com.amplifyframework.auth.AuthException;\n+import com.amplifyframework.auth.AuthPlugin;\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+import com.amazonaws.mobile.client.AWSMobileClient;\n+import com.amazonaws.mobile.client.Callback;\n+import com.amazonaws.mobile.client.HostedUIOptions;\n+import com.amazonaws.mobile.client.IdentityProvider;\n+import com.amazonaws.mobile.client.SignInUIOptions;\n+import com.amazonaws.mobile.client.UserState;\n+import com.amazonaws.mobile.client.UserStateDetails;\n+import com.amazonaws.mobile.client.results.SignInResult;\n+import com.amazonaws.mobile.client.results.SignInState;\n+import com.amazonaws.mobile.client.results.SignUpResult;\n+import com.amazonaws.mobile.client.results.Tokens;\n+import com.amazonaws.mobile.client.results.UserCodeDeliveryDetails;\n+import com.amazonaws.mobile.config.AWSConfiguration;\n+import org.json.JSONObject;\n+\n+import java.util.concurrent.CountDownLatch;\n+import java.util.concurrent.TimeUnit;\n+\n+public final class AWSCognitoAuthPlugin extends AuthPlugin<AWSMobileClient> {\n+    private static final String AWS_COGNITO_AUTH_PLUGIN_KEY = \"awsCognitoAuthPlugin\";\n+    private static final long SECONDS_BEFORE_TIMEOUT = 10;\n+\n+    @NonNull\n+    @Override\n+    public String getPluginKey() {\n+        return AWS_COGNITO_AUTH_PLUGIN_KEY;\n+    }\n+\n+    @Override\n+    public void configure(\n+            @NonNull JSONObject pluginConfiguration,\n+            @NonNull Context context\n+    ) throws AmplifyException {\n+        final CountDownLatch latch = new CountDownLatch(1);\n+\n+        AWSMobileClient.getInstance().initialize(\n+            context,\n+            new AWSConfiguration(pluginConfiguration),\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    latch.countDown();\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    throw new IllegalStateException(\"Failed to instantiate AWSMobileClient\", error);\n+                }\n+            }\n+        );\n+\n+        try {\n+            if (latch.await(SECONDS_BEFORE_TIMEOUT, TimeUnit.SECONDS)) {\n+                return;\n+            } else {\n+                throw new IllegalStateException(\n+                    \"Failed to instantiate AWSMobileClient within \" + SECONDS_BEFORE_TIMEOUT + \" seconds\"\n+                );\n+            }\n+        } catch (InterruptedException error) {\n+            throw new IllegalStateException(error);\n+        }\n+    }\n+\n+    public void signUp(\n+            String username,\n+            String password,\n+            AuthSignUpOptions options,\n+            final Consumer<AuthSignUpResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signUp(\n+            username,\n+            password,\n+            options.getUserAttributes(),\n+            options.getValidationData(),\n+            new Callback<SignUpResult>() {\n+                @Override\n+                public void onResult(SignUpResult result) {\n+                    UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                    onSuccess.accept(new AuthSignUpResult(\n+                        result.getConfirmationState(),\n+                        details != null\n+                            ? new AuthCodeDeliveryDetails(\n+                                details.getDestination(),\n+                                details.getDeliveryMedium(),\n+                                details.getAttributeName()\n+                            )\n+                            : null\n+                    ));\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    onException.accept(\n+                        new AuthException(\"Sign up failed\", error, \"See attached exception for more details\")\n+                    );\n+                }\n+            }\n+        );\n+    }\n+\n+    public void confirmSignUp(\n+        String username,\n+        String code,\n+        final Consumer<AuthSignUpResult> onSuccess,\n+        final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().confirmSignUp(username, code, new Callback<SignUpResult>() {\n+            @Override\n+            public void onResult(SignUpResult result) {\n+                UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                onSuccess.accept(new AuthSignUpResult(\n+                    result.getConfirmationState(),\n+                    details != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            details.getDestination(),\n+                            details.getDeliveryMedium(),\n+                            details.getAttributeName()\n+                        )\n+                        : null\n+                ));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\"Confirm sign up failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    @Override\n+    public void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().resendSignUp(username, new Callback<SignUpResult>() {\n+            @Override\n+            public void onResult(SignUpResult result) {\n+                UserCodeDeliveryDetails details = result.getUserCodeDeliveryDetails();\n+\n+                onSuccess.accept(new AuthSignUpResult(\n+                    result.getConfirmationState(),\n+                    details != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            details.getDestination(),\n+                            details.getDeliveryMedium(),\n+                            details.getAttributeName()\n+                        )\n+                        : null\n+                ));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\n+                        \"Resend confirmation code failed\",\n+                        error,\n+                        \"See attached exception for more details\"\n+                    )\n+                );\n+            }\n+        });\n+    }\n+\n+    public void signIn(\n+        String username,\n+        String password,\n+        AuthSignInOptions options,\n+        final Consumer<AuthSignInResult> onSuccess,\n+        final Consumer<AuthException> onException\n+    ) {\n+        AWSMobileClient.getInstance().signIn(username, password, null, new Callback<SignInResult>() {\n+            @Override\n+            public void onResult(SignInResult result) {\n+                AuthUserState state;\n+                UserCodeDeliveryDetails oldDetails = result.getCodeDetails();\n+                // Take information from Cognito specific object and wrap it in the new Amplify object\n+                AuthCodeDeliveryDetails newDetails =\n+                    oldDetails != null\n+                        ? new AuthCodeDeliveryDetails(\n+                            oldDetails.getDestination(),\n+                            oldDetails.getDeliveryMedium(),\n+                            oldDetails.getAttributeName()\n+                        )\n+                        : null;\n+\n+                if (result.getSignInState().equals(SignInState.DONE)) {\n+                    state = AuthUserState.SIGNED_IN;\n+                } else {\n+                    state = AuthUserState.SIGNED_OUT;\n+                }\n+\n+                onSuccess.accept(new AuthSignInResult(state, newDetails));\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AuthException(\"Sign in failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    public void signIn(\n+            String username,\n+            String password,\n+            final Consumer<AuthSignInResult> onSuccess,\n+            final Consumer<AuthException> onException\n+    ) {\n+        signIn(username, password, null, onSuccess, onException);\n+    }\n+\n+    public void signInWithUI(\n+            Activity callingActivity,\n+            final Consumer<String> onSuccess,\n+            final Consumer<AmplifyException> onException\n+    ) {\n+        HostedUIOptions hostedUIOptions = HostedUIOptions.builder()\n+                .scopes(\"openid\", \"email\")\n+                .build();\n+        SignInUIOptions signInUIOptions = SignInUIOptions.builder()\n+                .hostedUIOptions(hostedUIOptions)\n+                .build();\n+\n+        AWSMobileClient.getInstance().showSignIn(callingActivity, signInUIOptions, new Callback<UserStateDetails>() {\n+            @Override\n+            public void onResult(UserStateDetails details) {\n+                onSuccess.accept(details.getUserState().toString());\n+            }\n+\n+            @Override\n+            public void onError(Exception error) {\n+                onException.accept(\n+                    new AmplifyException(\"Sign in with UI failed\", error, \"See attached exception for more details\")\n+                );\n+            }\n+        });\n+    }\n+\n+    public void handleSignInWithUIResponse(Intent intent) {\n+        AWSMobileClient.getInstance().handleAuthResponse(intent);\n+    }\n+\n+    public void signInWithFacebook(\n+            String token,\n+            final Consumer<String> onSuccess,\n+            final Consumer<AmplifyException> onException\n+    ) {\n+        AWSMobileClient.getInstance().federatedSignIn(\n+            IdentityProvider.FACEBOOK.toString(),\n+            token,\n+            new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    onSuccess.accept(result.getUserState().toString());\n+                }\n+\n+                @Override\n+                public void onError(Exception error) {\n+                    onException.accept(\n+                        new AmplifyException(\n+                                \"Sign in with Facebook failed\",\n+                                error,\n+                                \"See attached exception for more details\"\n+                        )\n+                    );\n+                }\n+            }\n+        );\n+    }\n+\n+    // The result of a success callback is an object of type AWSCognitoAuthSession so that when the result\n+    // is cast to that type, the following Cognito specific fields can be retrieved:\n+    //   - AWSCredentials\n+    //   - Cognito Identity ID\n+    //   - Cognito Access Token\n+    //   - Cognito ID Token\n+    //   - Cognito Refresh Token\n+    @Override\n+    public void currentAuthState(\n+            @NonNull Consumer<AuthSession> onSuccess,\n+            @NonNull Consumer<AuthException> onError\n+    ) {\n+        try {\n+            AWSMobileClient.getInstance().currentUserState(new Callback<UserStateDetails>() {\n+                @Override\n+                public void onResult(UserStateDetails result) {\n+                    UserState state = result.getUserState();\n+\n+                    if (state.equals(UserState.SIGNED_OUT) ||\n+                            state.equals(UserState.SIGNED_OUT_FEDERATED_TOKENS_INVALID) ||\n+                            state.equals(UserState.SIGNED_OUT_USER_POOLS_TOKENS_INVALID)\n+                    ) {\n+                        onSuccess.accept(new AWSCognitoAuthSession(AuthUserState.SIGNED_OUT));\n+                    } else {\n+                        final AWSCognitoAuthSession session;\n+                        final CountDownLatch latch = new CountDownLatch(2);\n+\n+                        if (state.equals(UserState.SIGNED_IN) || state.equals(UserState.GUEST)) {\n+                            session = new AWSCognitoAuthSession(\n+                                    state.equals(UserState.SIGNED_IN)\n+                                            ? AuthUserState.SIGNED_IN\n+                                            : AuthUserState.GUEST,\n+                                    null,\n+                                    AWSMobileClient.getInstance().getIdentityId(),\n+                                    null,\n+                                    null,\n+                                    null\n+                            );\n+\n+                            AWSMobileClient.getInstance().getTokens(new Callback<Tokens>() {\n+                                @Override\n+                                public void onResult(Tokens result) {\n+                                    session.setAccessToken(result.getAccessToken().getTokenString());\n+                                    session.setIdToken(result.getIdToken().getTokenString());\n+                                    session.setRefreshToken(result.getRefreshToken().getTokenString());", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzMTYzNw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399331637", "bodyText": "The problem with this is that I need to populate some of the AWSCognitoAuthSession object before this callback and also need to populate some of it potentially after this (depending on what order the AWSMobileClient calls come back)", "author": "TrekSoft", "createdAt": "2020-03-27T15:05:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMjk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMzY5MA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399023690", "bodyText": "If all of these things can be null, how do we get a predictable experience for the user? Right now, they'll have to null check anything they get back from a getter on this object. Can we make fewer of these things null?\nAlternately, we could provided hasFoo(), methods, to help a little:\nif (session.hasIdentityId()) {\n    String idnetityId = session.getIdnetitytId();\n}\n\nOr, a functional style:\nsession.ifPresent(SessionToken.REFRESH, /* Action */ () -> {\n   // This gets executed if there is a session token.\n});\n```", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:04:29Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthSession.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+\n+import java.util.Objects;\n+\n+public final class AWSCognitoAuthSession extends AuthSession {\n+    private AWSCredentials awsCredentials;\n+    private String identityId;\n+    private String accessToken;\n+    private String idToken;\n+    private String refreshToken;\n+\n+    public AWSCognitoAuthSession(\n+            @NonNull AuthUserState state\n+    ) {\n+        super(state);\n+    }\n+\n+    public AWSCognitoAuthSession(\n+            @NonNull AuthUserState state,\n+            @Nullable AWSCredentials awsCredentials,\n+            @Nullable String identityId,\n+            @Nullable String accessToken,\n+            @Nullable String idToken,\n+            @Nullable String refreshToken", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzMzc3Mg==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399333772", "bodyText": "This is a raw escape hatch data object where the user gets back whatever underlying AWS Credentials may or may not exist depending on the type of account and whether it's signed in or not. We can talk about it more on the call.", "author": "TrekSoft", "createdAt": "2020-03-27T15:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMzY5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQ4ODU5Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399488596", "bodyText": "Add a builder to make it immutable and comment on the reason some things can be null", "author": "TrekSoft", "createdAt": "2020-03-27T19:18:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyMzY5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNDMwNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399024306", "bodyText": "Instead of mutation the session object, we might like to decouple these token/credentials.\nYou can \"defer\" the resolution of these things by using a provider delegate.\nfinal class ImmutableSession {\n    ImmutableSession(final Provider<AWSCredentials> credentialsProvider, final Provider<String> identityIdProvider) {\n    }\n\nThis way, the session object isn't changing. But, the functions that are passed in to resolve fields may return different results.\nnew WhateverSession(/* provider */ () -> awsCredentials, /* provider */ () -> identityId);\n\nOr maybe there's some implementation that's real crazy, not just returning a variable.\nThis is the pattern of the AWS credentials provider.", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:07:30Z", "path": "aws-auth-cognito/src/main/java/com/amplifyframework/auth/cognito/AWSCognitoAuthSession.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.cognito;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.auth.AuthSession;\n+import com.amplifyframework.auth.AuthUserState;\n+\n+import com.amazonaws.auth.AWSCredentials;\n+\n+import java.util.Objects;\n+\n+public final class AWSCognitoAuthSession extends AuthSession {\n+    private AWSCredentials awsCredentials;\n+    private String identityId;\n+    private String accessToken;\n+    private String idToken;\n+    private String refreshToken;\n+\n+    public AWSCognitoAuthSession(\n+            @NonNull AuthUserState state\n+    ) {\n+        super(state);\n+    }\n+\n+    public AWSCognitoAuthSession(\n+            @NonNull AuthUserState state,\n+            @Nullable AWSCredentials awsCredentials,\n+            @Nullable String identityId,\n+            @Nullable String accessToken,\n+            @Nullable String idToken,\n+            @Nullable String refreshToken\n+    ) {\n+        super(Objects.requireNonNull(state));\n+\n+        this.awsCredentials = awsCredentials;\n+        this.identityId = identityId;\n+        this.accessToken = accessToken;\n+        this.idToken = idToken;\n+        this.refreshToken = refreshToken;\n+    }\n+\n+    public AWSCredentials getAwsCredentials() {\n+        return awsCredentials;\n+    }\n+\n+    public String getIdentityId() {\n+        return identityId;\n+    }\n+\n+    public String getAccessToken() {\n+        return accessToken;\n+    }\n+\n+    public String getIdToken() {\n+        return idToken;\n+    }\n+\n+    public String getRefreshToken() {\n+        return refreshToken;\n+    }\n+\n+    public void setAwsCredentials(AWSCredentials awsCredentials) {", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzYwOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399027609", "bodyText": "This is like the Analytics API. When you provide a map, the user can do stuff like:\nMap<String, String> userAttributes = new HashMap<>();\nmap.put(\"emailZZ\", \"jameson@domain.tld\");\n\nAnd they won't realize they mispelled anything until their app is out in the field and it fails at runtime.\nSo, data modeling can help.\nMap<String, Object> is basically a class, where you name the field members in keys, and populate their values in values.\nMap<String, String> is more or less the same thing, but with less intricate data types.\nFor example,\nMap<String, String> userAttributes = new HashMap<>();\nenum AttributeKeys {\n    EMAIL(\"email\"),\n    NAME(\"name\"); // .... etc.. ..\n}\ninterface Whatever {\n    // By the way, please make sure that, by convention, you use AttributeKeys!!!\n    void useAttributes(Map<String, String> userAttributes);\n}\n\nWell, okay. But we could have done:\nfinal class UserAttributes {\n    private Email email;\n    private Name name;\n   \n    UserAttributes(Email email, Name name) {\n       this.email = email;\n       this.name = name;\n    }\n\n    static final class Email {\n         private final String validEmail;\n         private Email(String validEmail) {\n            this.validEmail = validEmail; \n         }\n         public static Email parse(String anyString) {\n             // Emails have a defined format with TLD at the end, an @ in the middle, etc....\n             // Does this string?\n             return new Email(/* validated */ anyString);\n         }\n         public String getUserName() {\n             // reutrn the part before at symbol\n         }\n         public String getDomainName() {\n             // return portion after at...\n         }\n    }\n\n    static final class Name {\n        private final String validatedName;\n        private Name(String validatedName) {\n            this.validatedName = validatedName);\n        }\n   \n        public static Name parse(@Nullable String fullName) {\n            // Validate the format of the string is actually a name....\n            // For sake of argument, let's require a first and last name.\n            return new Name(/*valid! */ string);\n        }\n\n        public String getFirstName() {\n        \n    }\n}\n\nOkay so anyway, my point is, that data modeling created a semantic experience for a user, that is a lot more fool proof. The user would make this stuff like:\n// This can be a step builder, to catch all the required fields, and get that stuff at runtime.\nUserAttributes.builder()\n    .email(Email.parse(\"tony@koolbiz.uk\"))\n    .name(Name.parse(\"Tony Daniels\"))\n    .build();\n\nCompare with:\nMap<String, String> attrs = new HashMap<>();\nattrs.put(\"Eamil\", \"whoops\");\nattrs.put(\"Eamil\", \"whoopsOverwrite\");\n\nAlot more of the stuff is left to reading the docs carefully and then validating at runtime.", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:22:26Z", "path": "core/src/main/java/com/amplifyframework/auth/options/AuthSignUpOptions.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.options;\n+\n+import androidx.annotation.NonNull;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public final class AuthSignUpOptions {\n+    private final Map<String, String> userAttributes;\n+    private final Map<String, String> validationData;\n+\n+    private AuthSignUpOptions(\n+            Map<String, String> userAttributes,\n+            Map<String, String> validationData\n+    ) {\n+        this.userAttributes = userAttributes;\n+        this.validationData = validationData;\n+    }\n+\n+    @NonNull\n+    public Map<String, String> getUserAttributes() {\n+        return userAttributes;\n+    }\n+\n+    @NonNull\n+    public Map<String, String> getValidationData() {\n+        return validationData;\n+    }\n+\n+    @NonNull\n+    public static Builder builder() {\n+        return new Builder();\n+    }\n+\n+    public static final class Builder {\n+        private Map<String, String> userAttributes;\n+        private Map<String, String> validationData;\n+\n+        public Builder() {\n+            this.userAttributes = new HashMap<>();\n+            this.validationData = new HashMap<>();\n+        }\n+\n+        @NonNull\n+        public Builder userAttributes(@NonNull Map<String, String> userAttributes) {", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0NjM1OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399346359", "bodyText": "So the thing with this is that it's intentionally left open because the customer needs to be able to pass a map of any key/value pairs. There's no limit on what they could be.", "author": "TrekSoft", "createdAt": "2020-03-27T15:26:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzYwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzg3NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399027875", "bodyText": "Naming, cause", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:23:42Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthException.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+import androidx.annotation.NonNull;\n+\n+import com.amplifyframework.AmplifyException;\n+\n+/**\n+ * Exception thrown by Storage category plugins.\n+ */\n+public final class AuthException extends AmplifyException {\n+\n+    private static final long serialVersionUID = 1L;\n+\n+    /**\n+     * Creates a new exception with a message, root cause, and recovery suggestion.\n+     * @param message An error message describing why this exception was thrown\n+     * @param throwable The underlying cause of this exception\n+     * @param recoverySuggestion Text suggesting a way to recover from the error being described\n+     */\n+    public AuthException(\n+            @NonNull final String message,\n+            final Throwable throwable,", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0NDkxNg==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399344916", "bodyText": "We'd have to rename this for all the exceptions across the platform - do you think it's worth it?", "author": "TrekSoft", "createdAt": "2020-03-27T15:23:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyOTc3MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401229771", "bodyText": "I do, yea. We should fix the other categories in a separate PR.", "author": "jamesonwilliams", "createdAt": "2020-03-31T21:36:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzg3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzk4Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399027986", "bodyText": "Can this be an enum? Which are the different delivery mediums? Are they known to us? Do we only support a constrained set of them?", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:24:09Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCodeDeliveryDetails.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+public final class AuthCodeDeliveryDetails {\n+    private String destination;\n+    private String deliveryMedium;\n+    private String attributeName;\n+\n+    public AuthCodeDeliveryDetails(String destination, String deliveryMedium, String attributeName) {\n+        this.destination = destination;\n+        this.deliveryMedium = deliveryMedium;", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0MzAxOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399343019", "bodyText": "Which are the different delivery mediums?\n\nThese are things like Email, SMS, etc.\n\nAre they known to us?\n\nI don't know all of what options can currently be in this since AWSMobileClient returns it as a String\n\nDo we only support a constrained set of them?\n\nThis isn't a value we send out but only receive\n\nCan this be an enum?\n\nWe could do one with the values we know and then have an Unknown value to catch the rest and add values in the future as desired.", "author": "TrekSoft", "createdAt": "2020-03-27T15:21:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIzMDEyOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401230128", "bodyText": "Jithin spec'd out an enum for this - you could check the iOS PR / sync with him.", "author": "jamesonwilliams", "createdAt": "2020-03-31T21:36:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTM0MTY2NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401341664", "bodyText": "Email and SMS are the two values added in iOS which are also supported by Cognito.", "author": "royjit", "createdAt": "2020-04-01T03:54:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzk4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYzODE1Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401638153", "bodyText": "Ah yeah whoops - I forgot about adding this - will do.", "author": "TrekSoft", "createdAt": "2020-04-01T14:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyNzk4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODA2Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399028063", "bodyText": "This is the  behavior of the default constructor in Java, if you don't supply one\nThat is to say, you could safely remove this.", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:24:32Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryConfiguration.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+import com.amplifyframework.core.category.CategoryConfiguration;\n+import com.amplifyframework.core.category.CategoryType;\n+\n+/**\n+ * Configuration for Auth category that also\n+ * contains configuration for individual plugins.\n+ */\n+public final class AuthCategoryConfiguration extends CategoryConfiguration {\n+    // Any category level properties would be defined here and populateFromJson would be overridden\n+    // below to fill in these values from the JSON data.\n+\n+    /**\n+     * Constructs a new AuthCategoryConfiguration.\n+     */\n+    public AuthCategoryConfiguration() {\n+        super();\n+    }", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0MjIwMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399342203", "bodyText": "Ok, this was copying existing code from another category so I guess I can fix that across all of them.", "author": "TrekSoft", "createdAt": "2020-03-27T15:20:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODA2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODM4NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399028385", "bodyText": "Why does Facebook get to be special?\nWe should figure out a way to spec out this API without naming particular providers.\nEven this woudl be more extensible:\nsignInWith(SignInProvider provider, ...);\n\nwith:\nenum SignInProvider {\n    FACEBOOK; // For not, it's gotta be Facebook or nuthin, pal.\n    // GOOGLE; // Someday!\n}", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:26:11Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+import android.app.Activity;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+public interface AuthCategoryBehavior {\n+\n+    /**\n+     * Creates a new user account with the specified username and password.\n+     * Can also pass in user attributes to associate with the user through\n+     * the options object.\n+     * @param username This can be a typical username, email, phone number, etc.\n+     * @param password The user's password\n+     * @param options Advanced options such as additional attributes of the user or validation data\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signUp(\n+            @NonNull String username,\n+            @NonNull String password,\n+            @NonNull AuthSignUpOptions options,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If you have attribute confirmation enabled, this will allow the user\n+     * to enter the confirmation code they received to activate their account.\n+     * @param username The username of the account to confirm\n+     * @param code The confirmation code the user received\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void confirmSignUp(\n+            @NonNull String username,\n+            @NonNull String code,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If the user's code expires or they just missed it, this method can\n+     * be used to send them a new one.\n+     * @param username The username of the account to resend the code to\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password or, if custom auth is setup,\n+     * you can send null for those and the necessary authentication details in the options object.\n+     * @param username This can be a normal username, email/phone if that's setup, or null if custom auth is enabled\n+     * @param password User's password for normal signup, null if custom auth or passwordless configurations are setup\n+     * @param options Advanced options such as a map of auth information for custom auth\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull AuthSignInOptions options,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password.\n+     * @param username This can be a normal username or email/phone if that's setup\n+     * @param password User's password\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Launch a pre-built sign in UI flow. You should also put the {@link #handleSignInWithUIResponse(Intent)} method in\n+     * your activity's onResume method to capture the response which comes back from the UI flow.\n+     * @param callingActivity The activity in your app you are calling this from\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signInWithUI(\n+            @NonNull Activity callingActivity,\n+            @NonNull Consumer<String> onSuccess,\n+            @NonNull Consumer<AmplifyException> onError);\n+\n+    /**\n+     * Handles the response which comes back from {@link #signInWithUI(Activity, Consumer, Consumer)}.\n+     * @param intent The app activity's intent\n+     */\n+    void handleSignInWithUIResponse(Intent intent);\n+\n+    /**\n+     * TODO: Replace this with a generic sign in with social method (or whatever naming lands on)\n+     *       which takes the provider as an enum.\n+     * @param token Token retrieved from the social provider's authentication code.\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signInWithFacebook(", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTMzNTEzOA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399335138", "bodyText": ":P\nTODO: Replace this with a generic sign in with social method (or whatever naming lands on)\n            which takes the provider as an enum.", "author": "TrekSoft", "createdAt": "2020-03-27T15:10:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODM4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODkyMg==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399028922", "bodyText": "What happens on error?", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:28:36Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+import android.app.Activity;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+public interface AuthCategoryBehavior {\n+\n+    /**\n+     * Creates a new user account with the specified username and password.\n+     * Can also pass in user attributes to associate with the user through\n+     * the options object.\n+     * @param username This can be a typical username, email, phone number, etc.\n+     * @param password The user's password\n+     * @param options Advanced options such as additional attributes of the user or validation data\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signUp(\n+            @NonNull String username,\n+            @NonNull String password,\n+            @NonNull AuthSignUpOptions options,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If you have attribute confirmation enabled, this will allow the user\n+     * to enter the confirmation code they received to activate their account.\n+     * @param username The username of the account to confirm\n+     * @param code The confirmation code the user received\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void confirmSignUp(\n+            @NonNull String username,\n+            @NonNull String code,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If the user's code expires or they just missed it, this method can\n+     * be used to send them a new one.\n+     * @param username The username of the account to resend the code to\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password or, if custom auth is setup,\n+     * you can send null for those and the necessary authentication details in the options object.\n+     * @param username This can be a normal username, email/phone if that's setup, or null if custom auth is enabled\n+     * @param password User's password for normal signup, null if custom auth or passwordless configurations are setup\n+     * @param options Advanced options such as a map of auth information for custom auth\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull AuthSignInOptions options,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password.\n+     * @param username This can be a normal username or email/phone if that's setup\n+     * @param password User's password\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Launch a pre-built sign in UI flow. You should also put the {@link #handleSignInWithUIResponse(Intent)} method in\n+     * your activity's onResume method to capture the response which comes back from the UI flow.\n+     * @param callingActivity The activity in your app you are calling this from\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signInWithUI(\n+            @NonNull Activity callingActivity,\n+            @NonNull Consumer<String> onSuccess,\n+            @NonNull Consumer<AmplifyException> onError);\n+\n+    /**\n+     * Handles the response which comes back from {@link #signInWithUI(Activity, Consumer, Consumer)}.\n+     * @param intent The app activity's intent\n+     */\n+    void handleSignInWithUIResponse(Intent intent);", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTM0MDkzMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399340933", "bodyText": "The triggering function above, signInWithUI, gets that error in it's error listener", "author": "TrekSoft", "createdAt": "2020-03-27T15:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQwOTY3Mw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r402409673", "bodyText": "The triggering function above, signInWithUI, gets that error in it's error listener\n\nShould add this to doco", "author": "jamesonwilliams", "createdAt": "2020-04-02T15:35:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyODkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTAyOTQxMw==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r399029413", "bodyText": "void lookupAuthSession(Consumer<AuthSession> onSessionFound, Consumer<AuthException> onSessionUnavailable);\n\n\nStart method names with a verb;\nMatch the subject of the method name to the result parameter", "author": "jamesonwilliams", "createdAt": "2020-03-27T04:30:52Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+import android.app.Activity;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+public interface AuthCategoryBehavior {\n+\n+    /**\n+     * Creates a new user account with the specified username and password.\n+     * Can also pass in user attributes to associate with the user through\n+     * the options object.\n+     * @param username This can be a typical username, email, phone number, etc.\n+     * @param password The user's password\n+     * @param options Advanced options such as additional attributes of the user or validation data\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signUp(\n+            @NonNull String username,\n+            @NonNull String password,\n+            @NonNull AuthSignUpOptions options,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If you have attribute confirmation enabled, this will allow the user\n+     * to enter the confirmation code they received to activate their account.\n+     * @param username The username of the account to confirm\n+     * @param code The confirmation code the user received\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void confirmSignUp(\n+            @NonNull String username,\n+            @NonNull String code,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If the user's code expires or they just missed it, this method can\n+     * be used to send them a new one.\n+     * @param username The username of the account to resend the code to\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password or, if custom auth is setup,\n+     * you can send null for those and the necessary authentication details in the options object.\n+     * @param username This can be a normal username, email/phone if that's setup, or null if custom auth is enabled\n+     * @param password User's password for normal signup, null if custom auth or passwordless configurations are setup\n+     * @param options Advanced options such as a map of auth information for custom auth\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull AuthSignInOptions options,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password.\n+     * @param username This can be a normal username or email/phone if that's setup\n+     * @param password User's password\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Launch a pre-built sign in UI flow. You should also put the {@link #handleSignInWithUIResponse(Intent)} method in\n+     * your activity's onResume method to capture the response which comes back from the UI flow.\n+     * @param callingActivity The activity in your app you are calling this from\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signInWithUI(\n+            @NonNull Activity callingActivity,\n+            @NonNull Consumer<String> onSuccess,\n+            @NonNull Consumer<AmplifyException> onError);\n+\n+    /**\n+     * Handles the response which comes back from {@link #signInWithUI(Activity, Consumer, Consumer)}.\n+     * @param intent The app activity's intent\n+     */\n+    void handleSignInWithUIResponse(Intent intent);\n+\n+    /**\n+     * TODO: Replace this with a generic sign in with social method (or whatever naming lands on)\n+     *       which takes the provider as an enum.\n+     * @param token Token retrieved from the social provider's authentication code.\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signInWithFacebook(\n+            @NonNull String token,\n+            @NonNull Consumer<String> onSuccess,\n+            @NonNull Consumer<AmplifyException> onError);\n+\n+    /**\n+     * Retrieve the user's current state - Signed Out, Guest, or Signed In.\n+     * Depending on how a plugin implements this, the resulting AuthSession can also be cast to a type specific\n+     * to that plugin which contains the various security tokens as an escape hatch if you want to manually use\n+     * them outside the plugin. Within Amplify this should not be needed as the other categories will automatically\n+     * work as long as you are signed in.\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void currentAuthState(", "originalCommit": "1d9b7bfc7d822ce8c1c43995eb155b97ccd0f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "496b9da4c26221d134b347aed96790a034508f76", "url": "https://github.com/aws-amplify/amplify-android/commit/496b9da4c26221d134b347aed96790a034508f76", "message": "Merge branch 'ddaudeli/AuthCategory' of https://github.com/aws-amplify/amplify-android into ddaudeli/AuthCategory", "committedDate": "2020-03-27T15:54:30Z", "type": "commit"}, {"oid": "c18508681d3b526691aa8e8e38120f5e5273e621", "url": "https://github.com/aws-amplify/amplify-android/commit/c18508681d3b526691aa8e8e38120f5e5273e621", "message": "Updates Javadocs", "committedDate": "2020-03-30T16:08:35Z", "type": "commit"}, {"oid": "305397c208bf5766cf9c8c82ace93b06daa805b2", "url": "https://github.com/aws-amplify/amplify-android/commit/305397c208bf5766cf9c8c82ace93b06daa805b2", "message": "Addresses PR feedback", "committedDate": "2020-03-31T19:14:05Z", "type": "commit"}, {"oid": "40e0729253d20f92b6d0080da678dca8d3ac9204", "url": "https://github.com/aws-amplify/amplify-android/commit/40e0729253d20f92b6d0080da678dca8d3ac9204", "message": "Added hashCode, toString, and equals methods", "committedDate": "2020-03-31T20:42:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyODU0NA==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401228544", "bodyText": "Somewhere around here is a good opportunity to wrap these in Immutable.of(...), so that they are, int he created object.", "author": "jamesonwilliams", "createdAt": "2020-03-31T21:33:30Z", "path": "core/src/main/java/com/amplifyframework/auth/options/AuthSignUpOptions.java", "diffHunk": "@@ -0,0 +1,128 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.util.ObjectsCompat;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public final class AuthSignUpOptions {\n+    private final Map<String, String> userAttributes;\n+    private final Map<String, String> validationData;\n+\n+    /**\n+     * Advanced options for signing in.\n+     * @param userAttributes Additional user attributes which should be associated with this user on registration\n+     * @param validationData A map of custom key/values to be sent as part of the sign up process\n+     */\n+    private AuthSignUpOptions(\n+            Map<String, String> userAttributes,\n+            Map<String, String> validationData\n+    ) {\n+        this.userAttributes = userAttributes;\n+        this.validationData = validationData;\n+    }\n+\n+    /**\n+     * Get additional user attributes which should be associated with this user on registration.\n+     * @return additional user attributes which should be associated with this user on registration\n+     */\n+    @NonNull\n+    public Map<String, String> getUserAttributes() {\n+        return userAttributes;\n+    }\n+\n+    /**\n+     * Get a map of custom key/values to be sent as part of the sign up process.\n+     * @return a map of custom key/values to be sent as part of the sign up process\n+     */\n+    @NonNull\n+    public Map<String, String> getValidationData() {\n+        return validationData;\n+    }\n+\n+    @NonNull\n+    public static Builder builder() {\n+        return new Builder();\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return ObjectsCompat.hash(\n+                getUserAttributes(),\n+                getValidationData()\n+        );\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        } else if (obj == null || getClass() != obj.getClass()) {\n+            return false;\n+        } else {\n+            AuthSignUpOptions authSignUpOptions = (AuthSignUpOptions) obj;\n+            return ObjectsCompat.equals(getValidationData(), authSignUpOptions.getValidationData()) &&\n+                    ObjectsCompat.equals(getUserAttributes(), authSignUpOptions.getUserAttributes());\n+        }\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return new StringBuilder()\n+                .append(\"AuthSignUpOptions { \")\n+                .append(\"validationData: \")\n+                .append(getValidationData())\n+                .append(\", userAttributes: \")\n+                .append(getUserAttributes())\n+                .append(\" }\")\n+                .toString();\n+    }\n+\n+    public static final class Builder {\n+        private Map<String, String> userAttributes;\n+        private Map<String, String> validationData;\n+\n+        public Builder() {\n+            this.userAttributes = new HashMap<>();\n+            this.validationData = new HashMap<>();\n+        }\n+\n+        @NonNull\n+        public Builder userAttributes(@NonNull Map<String, String> userAttributes) {\n+            Objects.requireNonNull(userAttributes);\n+            this.userAttributes.clear();\n+            this.userAttributes.putAll(userAttributes);\n+            return this;\n+        }\n+\n+        @NonNull\n+        public Builder validationData(@NonNull Map<String, String> validationData) {\n+            Objects.requireNonNull(validationData);\n+            this.validationData.clear();\n+            this.validationData.putAll(validationData);\n+            return this;\n+        }\n+\n+        @NonNull\n+        public AuthSignUpOptions build() {\n+            return new AuthSignUpOptions(userAttributes, validationData);", "originalCommit": "40e0729253d20f92b6d0080da678dca8d3ac9204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyODk3Ng==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401228976", "bodyText": "Immutable.of(validationData)", "author": "jamesonwilliams", "createdAt": "2020-03-31T21:34:21Z", "path": "core/src/main/java/com/amplifyframework/auth/options/AuthSignInOptions.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth.options;\n+\n+import androidx.annotation.NonNull;\n+import androidx.core.util.ObjectsCompat;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+public final class AuthSignInOptions {\n+    private final Map<String, String> validationData;\n+\n+    /**\n+     * Advanced options for signing in.\n+     * @param validationData A map of custom key/values to be sent as part of the sign in process\n+     */\n+    private AuthSignInOptions(Map<String, String> validationData) {\n+        this.validationData = validationData;\n+    }\n+\n+    /**\n+     * Get a map of custom key/values to be sent as part of the sign in process.\n+     * @return a map of custom key/values to be sent as part of the sign in process\n+     */\n+    @NonNull\n+    public Map<String, String> getValidationData() {\n+        return validationData;\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return ObjectsCompat.hash(\n+                getValidationData()\n+        );\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (this == obj) {\n+            return true;\n+        } else if (obj == null || getClass() != obj.getClass()) {\n+            return false;\n+        } else {\n+            AuthSignInOptions authSignInOptions = (AuthSignInOptions) obj;\n+            return ObjectsCompat.equals(getValidationData(), authSignInOptions.getValidationData());\n+        }\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return new StringBuilder()\n+                .append(\"AuthSignInOptions { \")\n+                .append(\"validationData: \")\n+                .append(getValidationData())\n+                .append(\" }\")\n+                .toString();\n+    }\n+\n+    @NonNull\n+    public static Builder builder() {\n+        return new Builder();\n+    }\n+\n+    public static final class Builder {\n+        private Map<String, String> validationData;\n+\n+        public Builder() {\n+            this.validationData = new HashMap<>();\n+        }\n+\n+        @NonNull\n+        public Builder validationData(@NonNull Map<String, String> validationData) {\n+            Objects.requireNonNull(validationData);\n+            this.validationData.clear();\n+            this.validationData.putAll(validationData);\n+            return this;\n+        }\n+\n+        @NonNull\n+        public AuthSignInOptions build() {\n+            return new AuthSignInOptions(validationData);", "originalCommit": "40e0729253d20f92b6d0080da678dca8d3ac9204", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyOTU0NQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401229545", "bodyText": "Or sign in has not been attempted?", "author": "jamesonwilliams", "createdAt": "2020-03-31T21:35:33Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthSignedInStatus.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+public enum AuthSignedInStatus {\n+    /** User is signed in. **/\n+    SIGNED_IN,\n+    /** User is signed out. **/\n+    SIGNED_OUT,\n+    /** User is signed in as a guest. **/", "originalCommit": "40e0729253d20f92b6d0080da678dca8d3ac9204", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYzNjY2OQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401636669", "bodyText": "No if sign in hasn't been attempted they'll always be in SIGNED_OUT state - you have to explicitly sign in as guest.", "author": "TrekSoft", "createdAt": "2020-04-01T13:58:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIyOTU0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTM0MjAzOQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401342039", "bodyText": "Shouldnt we return the same result here as well? AuthSignInResult?", "author": "royjit", "createdAt": "2020-04-01T03:56:22Z", "path": "core/src/main/java/com/amplifyframework/auth/AuthCategoryBehavior.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package com.amplifyframework.auth;\n+\n+import android.app.Activity;\n+import android.content.Intent;\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+\n+import com.amplifyframework.AmplifyException;\n+import com.amplifyframework.auth.options.AuthSignInOptions;\n+import com.amplifyframework.auth.options.AuthSignUpOptions;\n+import com.amplifyframework.auth.result.AuthSignInResult;\n+import com.amplifyframework.auth.result.AuthSignUpResult;\n+import com.amplifyframework.core.Consumer;\n+\n+public interface AuthCategoryBehavior {\n+\n+    /**\n+     * Creates a new user account with the specified username and password.\n+     * Can also pass in user attributes to associate with the user through\n+     * the options object.\n+     * @param username This can be a typical username, email, phone number, etc.\n+     * @param password The user's password\n+     * @param options Advanced options such as additional attributes of the user or validation data\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signUp(\n+            @NonNull String username,\n+            @NonNull String password,\n+            @NonNull AuthSignUpOptions options,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If you have attribute confirmation enabled, this will allow the user\n+     * to enter the confirmation code they received to activate their account.\n+     * @param username The username of the account to confirm\n+     * @param code The confirmation code the user received\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void confirmSignUp(\n+            @NonNull String username,\n+            @NonNull String code,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * If the user's code expires or they just missed it, this method can\n+     * be used to send them a new one.\n+     * @param username The username of the account to resend the code to\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void resendSignUpCode(\n+            @NonNull String username,\n+            @NonNull Consumer<AuthSignUpResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password or, if custom auth is setup,\n+     * you can send null for those and the necessary authentication details in the options object.\n+     * @param username This can be a normal username, email/phone if that's setup, or null if custom auth is enabled\n+     * @param password User's password for normal signup, null if custom auth or passwordless configurations are setup\n+     * @param options Advanced options such as a map of auth information for custom auth\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull AuthSignInOptions options,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Basic authentication to the app with a username and password.\n+     * @param username This can be a normal username or email/phone if that's setup\n+     * @param password User's password\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signIn(\n+            @Nullable String username,\n+            @Nullable String password,\n+            @NonNull Consumer<AuthSignInResult> onSuccess,\n+            @NonNull Consumer<AuthException> onError);\n+\n+    /**\n+     * Launch a pre-built sign in UI flow. You should also put the {@link #handleSignInWithUIResponse(Intent)} method in\n+     * your activity's onResume method to capture the response which comes back from the UI flow.\n+     * @param callingActivity The activity in your app you are calling this from\n+     * @param onSuccess Success callback\n+     * @param onError Error callback\n+     */\n+    void signInWithUI(\n+            @NonNull Activity callingActivity,\n+            @NonNull Consumer<String> onSuccess,\n+            @NonNull Consumer<AmplifyException> onError);", "originalCommit": "40e0729253d20f92b6d0080da678dca8d3ac9204", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTYzNjI4MQ==", "url": "https://github.com/aws-amplify/amplify-android/pull/330#discussion_r401636281", "bodyText": "Yeah this is not the final method signature - it's still from the POC", "author": "TrekSoft", "createdAt": "2020-04-01T13:57:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTM0MjAzOQ=="}], "type": "inlineReview"}, {"oid": "14906829740c791b766c9711c2e5e3d5b9475125", "url": "https://github.com/aws-amplify/amplify-android/commit/14906829740c791b766c9711c2e5e3d5b9475125", "message": "Addresses round 2 of PR comments", "committedDate": "2020-04-01T20:10:58Z", "type": "commit"}]}