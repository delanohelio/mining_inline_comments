{"pr_number": 11250, "pr_title": "Debug info improvements for Mandrel", "pr_createdAt": "2020-08-06T10:54:25Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11250", "timeline": [{"oid": "f89d6c770ea5e60becf862e6bfdc40eca525ccdf", "url": "https://github.com/quarkusio/quarkus/commit/f89d6c770ea5e60becf862e6bfdc40eca525ccdf", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs.", "committedDate": "2020-08-06T10:54:43Z", "type": "forcePushed"}, {"oid": "edd672e69a1953a084809f85259fbdee78e4ffde", "url": "https://github.com/quarkusio/quarkus/commit/edd672e69a1953a084809f85259fbdee78e4ffde", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs.", "committedDate": "2020-08-06T10:56:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjQ4OTM5OQ==", "url": "https://github.com/quarkusio/quarkus/pull/11250#discussion_r466489399", "bodyText": "The pattern is not good enough IMHO. I will push a commit to fix it.", "author": "gsmet", "createdAt": "2020-08-06T15:18:47Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java", "diffHunk": "@@ -572,4 +646,104 @@ private static void objcopy(String... args) {\n             }\n         }\n     }\n+\n+    protected static final class GraalVM {\n+        static final class Version implements Comparable<Version> {\n+            private static final Pattern PATTERN = Pattern.compile(\n+                    \"GraalVM Version ((1|[1-9][0-9]).([0-3]).[0-9]|\\\\p{XDigit}*)[^(\\n$]*(\\\\(Mandrel Distribution\\\\))?\\\\s*\");", "originalCommit": "edd672e69a1953a084809f85259fbdee78e4ffde", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6190179febd50d71db17fd80392c67ec3275191c", "url": "https://github.com/quarkusio/quarkus/commit/6190179febd50d71db17fd80392c67ec3275191c", "message": "Debug info improvements #9792\n\n* Add third party source jars support.\n* Third party jars not downloaded by default,\nso it requires user to call `mvn dependencies:sources`\nor equivalent.\n* If source jars are found,\nthey're put next to the jars in the lib directory.\n* After generating native executable,\nthe source jars are removed.\n* Application sources are added individually using\n-H:DebugInfoSourceSearchPath option.\nThey're only added if the directory exists.\n* Debug symbols flag switched\nfrom -H:GenerateDebugInfo=1 to `-g`.\n* Sources cache has been moved to target/sources-cache\nusing the -H:DebugInfoSourceCacheRoot option.\nThis makes sources cache more closely available.\ngdb should discover these automatically,\nbut it does not seem to work,\nso better use `set directories` pointing to them.\n* These changes only work on Mandrel or GraalVM 20.2,\nso reworked the whole GraalVM version and distribution\nresolution logic to make this easier to handle.\n* Previous ad-hoc GraalVM version resolution\nhas been been replaced by a regex solution.\n* Added unit tests to verify that\nGraalVM versions and distributions are resolved correctly\nwith a diverse set of `native-image --version` outputs.", "committedDate": "2020-08-06T15:19:23Z", "type": "commit"}, {"oid": "da44c26ca9f5458a207527b91d8c80ecb234a218", "url": "https://github.com/quarkusio/quarkus/commit/da44c26ca9f5458a207527b91d8c80ecb234a218", "message": "Fix the GraalVM version regexp", "committedDate": "2020-08-06T15:29:36Z", "type": "commit"}, {"oid": "da44c26ca9f5458a207527b91d8c80ecb234a218", "url": "https://github.com/quarkusio/quarkus/commit/da44c26ca9f5458a207527b91d8c80ecb234a218", "message": "Fix the GraalVM version regexp", "committedDate": "2020-08-06T15:29:36Z", "type": "forcePushed"}, {"oid": "b08e71429d4959e6ab5f1d2288b643527092da10", "url": "https://github.com/quarkusio/quarkus/commit/b08e71429d4959e6ab5f1d2288b643527092da10", "message": "Get back to displaying the full version in log messages\n\nThe toString() is really not user-friendly.", "committedDate": "2020-08-06T16:53:41Z", "type": "commit"}]}