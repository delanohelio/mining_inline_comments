{"pr_number": 9917, "pr_title": "code gen with gRPC", "pr_createdAt": "2020-06-10T13:34:08Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9917", "timeline": [{"oid": "e695facd3dbf524dc4a66f728ad9fc20142f9762", "url": "https://github.com/quarkusio/quarkus/commit/e695facd3dbf524dc4a66f728ad9fc20142f9762", "message": "code gen", "committedDate": "2020-06-10T13:54:24Z", "type": "forcePushed"}, {"oid": "ef7a740a8766df23ddad9e0185cccb9519e0894f", "url": "https://github.com/quarkusio/quarkus/commit/ef7a740a8766df23ddad9e0185cccb9519e0894f", "message": "code gen - make gradle generation work", "committedDate": "2020-06-22T14:22:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwNjEzNA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r444706134", "bodyText": "Not a big fan of watchers, it's slightly different from the hot reload approach. @stuartwdouglas WDYT?", "author": "cescoffier", "createdAt": "2020-06-24T07:45:01Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/dev/IsolatedDevModeMain.java", "diffHunk": "@@ -126,6 +142,42 @@ public void accept(Integer integer) {\n         }\n     }\n \n+    private void startCodeGenWatcher(QuarkusClassLoader classLoader, List<CodeGenData> codeGens) {\n+        Executors.newSingleThreadExecutor().execute(\n+                () -> {\n+                    Collection<FSWatchUtil.Watcher> watchers = new ArrayList<>();", "originalCommit": "67035cce698f46b8e03be9987d2f649efa47680d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg1NzA1Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r444857052", "bodyText": "it's actively watching for file changes. That's to enable users to use the changes right away in their code (without doing a request to the app first).", "author": "michalszynkiewicz", "createdAt": "2020-06-24T12:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwNjEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI3NDQ2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r445274469", "bodyText": "We don't want to use the normal hot reload approach here. Otherwise you need to reload your browser for the generated source code to be generated, go back to your IDE to actually use the generated source, then back to your browser to see the changes.", "author": "stuartwdouglas", "createdAt": "2020-06-25T02:33:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwNjEzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY5NzY0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r450697645", "bodyText": "Make sense.", "author": "cescoffier", "createdAt": "2020-07-07T08:32:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwNjEzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwODA1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r444708057", "bodyText": "Wondering about the default phase.\nDo we want it to run late or early? Early: generate sources is fine, late: process resources might be better.", "author": "cescoffier", "createdAt": "2020-06-24T07:48:40Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/CodeGenMojo.java", "diffHunk": "@@ -0,0 +1,151 @@\n+package io.quarkus.maven;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.List;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.plugin.AbstractMojo;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.Component;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.eclipse.aether.RepositorySystem;\n+import org.eclipse.aether.RepositorySystemSession;\n+import org.eclipse.aether.repository.RemoteRepository;\n+\n+import io.quarkus.bootstrap.app.CuratedApplication;\n+import io.quarkus.bootstrap.app.QuarkusBootstrap;\n+import io.quarkus.bootstrap.classloading.QuarkusClassLoader;\n+import io.quarkus.bootstrap.model.AppArtifact;\n+import io.quarkus.bootstrap.prebuild.CodeGenFailureException;\n+import io.quarkus.bootstrap.resolver.maven.MavenArtifactResolver;\n+import io.quarkus.deployment.CodeGenerator;\n+import io.quarkus.deployment.codegen.CodeGenData;\n+\n+@Mojo(name = \"prepare\", defaultPhase = LifecyclePhase.GENERATE_SOURCES, requiresDependencyResolution = ResolutionScope.COMPILE_PLUS_RUNTIME)", "originalCommit": "67035cce698f46b8e03be9987d2f649efa47680d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTEyODY3OA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451128678", "bodyText": "what would be the benefit of running it later?\nIt's literally for generating sources, that's why I used this phase...", "author": "michalszynkiewicz", "createdAt": "2020-07-07T20:37:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwODA1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM0MzcyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451343729", "bodyText": "It makes sense, I just wanted to double-check.", "author": "cescoffier", "createdAt": "2020-07-08T07:38:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcwODA1Nw=="}], "type": "inlineReview"}, {"oid": "8464e72f2230b5d7e5d50a7cbe7680cc581cf634", "url": "https://github.com/quarkusio/quarkus/commit/8464e72f2230b5d7e5d50a7cbe7680cc581cf634", "message": "grpc hot reload\n\nfixes #9327\nfixes #9328", "committedDate": "2020-07-07T07:04:29Z", "type": "forcePushed"}, {"oid": "a7649be36c0be80aa39f3740e3e37d34c92dd98c", "url": "https://github.com/quarkusio/quarkus/commit/a7649be36c0be80aa39f3740e3e37d34c92dd98c", "message": "grpc hot reload\n\nfixes #9327\nfixes #9328", "committedDate": "2020-07-07T09:09:43Z", "type": "forcePushed"}, {"oid": "6713217f451fa1a224c063ebf2cb23720f770cb5", "url": "https://github.com/quarkusio/quarkus/commit/6713217f451fa1a224c063ebf2cb23720f770cb5", "message": "grpc hot reload\n\nfixes #9327\nfixes #9328", "committedDate": "2020-07-07T11:05:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2NjcyOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451166729", "bodyText": "Won't this include an exe file into the lib?", "author": "aloubyansky", "createdAt": "2020-07-07T21:56:16Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/AppModelGradleResolver.java", "diffHunk": "@@ -339,7 +344,7 @@ private void collectExtensionDeps(Set<ResolvedDependency> resolvedDeps,\n      * A {@link ResolvedArtifact} is valid if it's a JAR or a directory\n      */\n     private static boolean isDependency(ResolvedArtifact a) {\n-        return BootstrapConstants.JAR.equalsIgnoreCase(a.getExtension()) ||\n+        return BootstrapConstants.JAR.equalsIgnoreCase(a.getExtension()) || \"exe\".equalsIgnoreCase(a.getExtension()) ||", "originalCommit": "6713217f451fa1a224c063ebf2cb23720f770cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMyMjA5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451322097", "bodyText": "Do you mean lib directory used in runtime?\nWithout it, artifacts with packaging exe were not among the dependencies.\nAnd this is how protoc is shipped.", "author": "michalszynkiewicz", "createdAt": "2020-07-08T06:55:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2NjcyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM2NTc5MA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451365790", "bodyText": "I checked integration-tests/gradle/build/resources/test/grpc-multi-module-project/application/build/lib where the grpc code gen is used and I don't see the exe files there.\nIsn't it the same as deployment jars?", "author": "michalszynkiewicz", "createdAt": "2020-07-08T08:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2NjcyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTgwNDAxOA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451804018", "bodyText": "Ok", "author": "aloubyansky", "createdAt": "2020-07-08T20:23:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2NjcyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2OTUwNA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451169504", "bodyText": "If you look below you'll see SourceSet's. That'll be the proper way to get the sources dirs.", "author": "aloubyansky", "createdAt": "2020-07-07T22:02:34Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/QuarkusPlugin.java", "diffHunk": "@@ -112,6 +121,22 @@ public void execute(Task test) {\n                 JavaPlugin.class,\n                 javaPlugin -> {\n                     project.afterEvaluate(this::afterEvaluate);\n+                    JavaCompile compileJavaTask = (JavaCompile) tasks.getByName(JavaPlugin.COMPILE_JAVA_TASK_NAME);\n+                    compileJavaTask.mustRunAfter(quarkusPrepare);\n+                    quarkusPrepare.setSourceRegistrar(compileJavaTask::source);\n+\n+                    try {\n+                        // TODO: support kotlin\n+                        tasks.getByName(\"compileTestKotlin\");\n+                    } catch (UnknownTaskException noKotlin) {\n+                        JavaCompile compileTestJavaTask = (JavaCompile) tasks.getByName(JavaPlugin.COMPILE_TEST_JAVA_TASK_NAME);\n+                        compileTestJavaTask.dependsOn(quarkusPrepareTests);\n+                        quarkusPrepareTests.setSourceRegistrar(compileTestJavaTask::source);\n+                    }\n+\n+                    Path projectPath = project.getProjectDir().toPath();\n+                    quarkusPrepare.setSourcesDirectory(projectPath.resolve(\"src\").resolve(\"main\"));\n+                    quarkusPrepareTests.setSourcesDirectory(projectPath.resolve(\"src\").resolve(\"test\"));", "originalCommit": "6713217f451fa1a224c063ebf2cb23720f770cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQyOTU0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451429547", "bodyText": "parent of java's source works too :)", "author": "michalszynkiewicz", "createdAt": "2020-07-08T10:04:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE2OTUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3MTQ4OQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451171489", "bodyText": "I guess you should probably be using/checking sourcePaths. Most of the time it will be a singleton set.", "author": "aloubyansky", "createdAt": "2020-07-07T22:07:40Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusDev.java", "diffHunk": "@@ -457,7 +457,10 @@ private void addLocalProject(Project project, DevModeContext context, Set<AppArt\n                 sourcePaths,\n                 classesDir,\n                 resourcesSrcDir.getAbsolutePath(),\n-                resourcesOutputPath);\n+                resourcesOutputPath,\n+                Paths.get(\"src\", \"main\").toAbsolutePath().toString(),", "originalCommit": "6713217f451fa1a224c063ebf2cb23720f770cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTYxNDU2OA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451614568", "bodyText": "will do", "author": "michalszynkiewicz", "createdAt": "2020-07-08T15:02:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3MTQ4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3MjI3Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451172272", "bodyText": "Was this necessary for dev mode? This is something to be avoided.", "author": "aloubyansky", "createdAt": "2020-07-07T22:09:45Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusPrepare.java", "diffHunk": "@@ -0,0 +1,114 @@\n+package io.quarkus.gradle.tasks;\n+\n+import java.io.File;\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+\n+import org.gradle.api.GradleException;\n+import org.gradle.api.plugins.Convention;\n+import org.gradle.api.plugins.JavaPluginConvention;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import io.quarkus.bootstrap.BootstrapException;\n+import io.quarkus.bootstrap.app.CuratedApplication;\n+import io.quarkus.bootstrap.app.QuarkusBootstrap;\n+import io.quarkus.bootstrap.classloading.QuarkusClassLoader;\n+import io.quarkus.bootstrap.model.AppArtifact;\n+import io.quarkus.bootstrap.resolver.AppModelResolver;\n+import io.quarkus.deployment.CodeGenerator;\n+\n+public class QuarkusPrepare extends QuarkusTask {\n+\n+    public static final String INIT_AND_RUN = \"initAndRun\";\n+    private Path sourcesDirectory;\n+    private Consumer<Path> sourceRegistrar;\n+    private boolean test = false;\n+\n+    public QuarkusPrepare() {\n+        super(\"Quarkus performs pre-build preparations, such as sources generation\");\n+    }\n+\n+    @TaskAction\n+    public void prepareQuarkus() {\n+        getLogger().lifecycle(\"preparing quarkus application\");\n+\n+        final AppArtifact appArtifact = extension().getAppArtifact();\n+        appArtifact.setPaths(QuarkusGradleUtils.getOutputPaths(getProject()));", "originalCommit": "6713217f451fa1a224c063ebf2cb23720f770cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTM1ODc2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451358769", "bodyText": "I ran the tests I have and they work without it. I'm dropping it.", "author": "michalszynkiewicz", "createdAt": "2020-07-08T08:05:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3MjI3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3NjI3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451176276", "bodyText": "This looks like a duplicate of getSourcesSourcesDir()?", "author": "aloubyansky", "createdAt": "2020-07-07T22:20:05Z", "path": "independent-projects/bootstrap/maven-resolver/src/main/java/io/quarkus/bootstrap/resolver/maven/workspace/LocalProject.java", "diffHunk": "@@ -249,6 +253,11 @@ public Path getSourcesSourcesDir() {\n         return resolveRelativeToBaseDir(srcDir, \"src/main/java\");\n     }\n \n+    public Path getSourcesDir() {", "originalCommit": "6713217f451fa1a224c063ebf2cb23720f770cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMxMzUyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451313521", "bodyText": "getSorucesSourcesDir returns the path to src/main/java and this thing returns the path to src/main", "author": "michalszynkiewicz", "createdAt": "2020-07-08T06:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3NjI3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3Njk0NA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451176944", "bodyText": "Is this actually used anywhere?", "author": "aloubyansky", "createdAt": "2020-07-07T22:21:46Z", "path": "independent-projects/bootstrap/core/src/main/java/io/quarkus/bootstrap/app/CuratedApplication.java", "diffHunk": "@@ -302,4 +304,8 @@ public void close() {\n             baseRuntimeClassLoader.close();\n         }\n     }\n+\n+    public AppModelResolver getAppModelResolver() {", "originalCommit": "6713217f451fa1a224c063ebf2cb23720f770cb5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTMyMDA5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r451320093", "bodyText": "no, it's a left-over, I will remove it", "author": "michalszynkiewicz", "createdAt": "2020-07-08T06:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTE3Njk0NA=="}], "type": "inlineReview"}, {"oid": "d0ca4a21beb5874afd19d99b16906dab3fc07a57", "url": "https://github.com/quarkusio/quarkus/commit/d0ca4a21beb5874afd19d99b16906dab3fc07a57", "message": "codegenprovider: gradle mode rework", "committedDate": "2020-07-08T15:18:42Z", "type": "forcePushed"}, {"oid": "384860fd310fa08f29723647db3363282737bbc3", "url": "https://github.com/quarkusio/quarkus/commit/384860fd310fa08f29723647db3363282737bbc3", "message": "codegenprovider: gradle mode rework", "committedDate": "2020-07-08T16:09:47Z", "type": "forcePushed"}, {"oid": "abf586be45d47f07f31f85c49ee0fa0a9ff2cee4", "url": "https://github.com/quarkusio/quarkus/commit/abf586be45d47f07f31f85c49ee0fa0a9ff2cee4", "message": "codegenprovider: gradle mode rework", "committedDate": "2020-07-08T17:48:49Z", "type": "forcePushed"}, {"oid": "505ebe81d5b42bee625313f6003b858a78ea2f11", "url": "https://github.com/quarkusio/quarkus/commit/505ebe81d5b42bee625313f6003b858a78ea2f11", "message": "codegenprovider: gradle rework", "committedDate": "2020-07-10T06:16:02Z", "type": "forcePushed"}, {"oid": "88a829eb979b9407a0d8095793305b88a8056c75", "url": "https://github.com/quarkusio/quarkus/commit/88a829eb979b9407a0d8095793305b88a8056c75", "message": "logging to figure out what's wrong with grpc reload", "committedDate": "2020-07-10T12:20:19Z", "type": "forcePushed"}, {"oid": "0697a8469686bd5ce65d5b65dc792d803ad83115", "url": "https://github.com/quarkusio/quarkus/commit/0697a8469686bd5ce65d5b65dc792d803ad83115", "message": "even more logging", "committedDate": "2020-07-10T14:21:31Z", "type": "forcePushed"}, {"oid": "1b706385ce5fb6aa0e0caded7c114d632e57a15d", "url": "https://github.com/quarkusio/quarkus/commit/1b706385ce5fb6aa0e0caded7c114d632e57a15d", "message": "even more logging", "committedDate": "2020-07-10T15:08:33Z", "type": "forcePushed"}, {"oid": "3da5db2d19ff23ac106d6d86913781ad4bd4edcc", "url": "https://github.com/quarkusio/quarkus/commit/3da5db2d19ff23ac106d6d86913781ad4bd4edcc", "message": "even more logging", "committedDate": "2020-07-11T20:13:42Z", "type": "forcePushed"}, {"oid": "93e1ba6f97fa2714fe67c42d8d197f0210437100", "url": "https://github.com/quarkusio/quarkus/commit/93e1ba6f97fa2714fe67c42d8d197f0210437100", "message": "code gen with grpc", "committedDate": "2020-07-12T19:48:06Z", "type": "commit"}, {"oid": "7c6fb3b227e7339d9e448bd2664e5f4de7e1bcc5", "url": "https://github.com/quarkusio/quarkus/commit/7c6fb3b227e7339d9e448bd2664e5f4de7e1bcc5", "message": "grpc dev mode - use single server", "committedDate": "2020-07-12T19:48:06Z", "type": "forcePushed"}, {"oid": "dc343a7cf1cebca51f11f9f40c7dcfda5ad1f0e8", "url": "https://github.com/quarkusio/quarkus/commit/dc343a7cf1cebca51f11f9f40c7dcfda5ad1f0e8", "message": "grpc dev mode - use single server", "committedDate": "2020-07-12T20:33:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NDg3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455044876", "bodyText": "Should we be more explicit in this message? We only skip the code gen part right?", "author": "cescoffier", "createdAt": "2020-07-15T13:19:54Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/CodeGenMojo.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package io.quarkus.maven;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.plugin.AbstractMojo;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.Component;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.eclipse.aether.RepositorySystem;\n+import org.eclipse.aether.RepositorySystemSession;\n+import org.eclipse.aether.repository.RemoteRepository;\n+\n+import io.quarkus.bootstrap.app.CuratedApplication;\n+import io.quarkus.bootstrap.app.QuarkusBootstrap;\n+import io.quarkus.bootstrap.classloading.QuarkusClassLoader;\n+import io.quarkus.bootstrap.model.AppArtifact;\n+import io.quarkus.bootstrap.prebuild.CodeGenFailureException;\n+import io.quarkus.bootstrap.resolver.maven.MavenArtifactResolver;\n+import io.quarkus.deployment.CodeGenerator;\n+import io.quarkus.deployment.codegen.CodeGenData;\n+\n+@Mojo(name = \"prepare\", defaultPhase = LifecyclePhase.GENERATE_SOURCES, requiresDependencyResolution = ResolutionScope.COMPILE_PLUS_RUNTIME)\n+public class CodeGenMojo extends AbstractMojo {\n+\n+    @Parameter(defaultValue = \"${project.build.directory}\")\n+    private File buildDir;\n+\n+    @Parameter(defaultValue = \"${project}\", readonly = true, required = true)\n+    protected MavenProject project;\n+\n+    @Component\n+    private RepositorySystem repoSystem;\n+\n+    @Parameter(defaultValue = \"${repositorySystemSession}\", readonly = true)\n+    private RepositorySystemSession repoSession;\n+\n+    @Parameter(defaultValue = \"${project.remoteProjectRepositories}\", readonly = true, required = true)\n+    private List<RemoteRepository> repos;\n+\n+    /** Skip the execution of this mojo */\n+    @Parameter(defaultValue = \"false\", property = \"quarkus.prepare.skip\")\n+    private boolean skipSourceGeneration = false;\n+\n+    @Override\n+    public void execute() throws MojoExecutionException, MojoFailureException {\n+        String projectDir = project.getBasedir().getAbsolutePath();\n+        Path sourcesDir = Paths.get(projectDir, \"src\", \"main\");\n+        doExecute(sourcesDir, path -> project.addCompileSourceRoot(path.toString()), false);\n+    }\n+\n+    void doExecute(Path sourcesDir,\n+            Consumer<Path> sourceRegistrar,\n+            boolean test) throws MojoFailureException, MojoExecutionException {\n+        if (project.getPackaging().equals(\"pom\")) {\n+            getLog().info(\"Type of the artifact is POM, skipping build goal\");\n+            return;\n+        }\n+        if (skipSourceGeneration) {\n+            getLog().info(\"Skipping Quarkus build\");", "originalCommit": "28b78b2b1aa09349850879fcc6daa72123097678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTEzMTU4Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455131583", "bodyText": "yes, I'll fix this", "author": "michalszynkiewicz", "createdAt": "2020-07-15T15:15:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NDg3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NjY1NA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455046654", "bodyText": "Can you remove the class javadoc?", "author": "cescoffier", "createdAt": "2020-07-15T13:22:22Z", "path": "extensions/grpc/deployment/src/test/java/io/quarkus/grpc/server/devmode/DevModeTestRestResource.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package io.quarkus.grpc.server.devmode;\n+\n+import javax.inject.Inject;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.core.MediaType;\n+\n+/**\n+ * @author Michal Szynkiewicz, michal.l.szynkiewicz@gmail.com", "originalCommit": "28b78b2b1aa09349850879fcc6daa72123097678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5MzQyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455093421", "bodyText": "stuff copied from quarkus-grpc where I didn't have adding headers disabled, will do", "author": "michalszynkiewicz", "createdAt": "2020-07-15T14:26:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NjY1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0Njc4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455046786", "bodyText": "Can you remove this javadoc block?", "author": "cescoffier", "createdAt": "2020-07-15T13:22:33Z", "path": "extensions/grpc/deployment/src/test/java/io/quarkus/grpc/server/devmode/DevModeTestService.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package io.quarkus.grpc.server.devmode;\n+\n+import javax.inject.Singleton;\n+\n+import devmodetest.v1.Devmodetest;\n+import io.grpc.examples.helloworld.GreeterGrpc;\n+import io.grpc.examples.helloworld.HelloReply;\n+import io.grpc.examples.helloworld.HelloRequest;\n+import io.grpc.stub.StreamObserver;\n+\n+/**\n+ * @author Michal Szynkiewicz, michal.l.szynkiewicz@gmail.com\n+ *         <br>", "originalCommit": "28b78b2b1aa09349850879fcc6daa72123097678", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0Njg5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455046893", "bodyText": "Same :-D", "author": "cescoffier", "createdAt": "2020-07-15T13:22:42Z", "path": "extensions/grpc/deployment/src/test/java/io/quarkus/grpc/server/devmode/DevModeTestStreamService.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package io.quarkus.grpc.server.devmode;\n+\n+import java.time.Duration;\n+\n+import javax.inject.Singleton;\n+\n+import com.example.test.MutinyStreamsGrpc;\n+import com.example.test.StreamsOuterClass.Item;\n+\n+import io.smallrye.mutiny.Multi;\n+\n+/**\n+ * @author Michal Szynkiewicz, michal.l.szynkiewicz@gmail.com\n+ *         <br>", "originalCommit": "28b78b2b1aa09349850879fcc6daa72123097678", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NzAwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455047009", "bodyText": "Same :-D", "author": "cescoffier", "createdAt": "2020-07-15T13:22:52Z", "path": "extensions/grpc/deployment/src/test/java/io/quarkus/grpc/server/devmode/GrpcDevModeTest.java", "diffHunk": "@@ -0,0 +1,159 @@\n+package io.quarkus.grpc.server.devmode;\n+\n+import static io.restassured.RestAssured.when;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import java.util.List;\n+import java.util.concurrent.CompletableFuture;\n+import java.util.concurrent.CompletionStage;\n+import java.util.concurrent.CopyOnWriteArrayList;\n+import java.util.concurrent.TimeUnit;\n+\n+import org.awaitility.Awaitility;\n+import org.hamcrest.Matchers;\n+import org.jboss.shrinkwrap.api.ShrinkWrap;\n+import org.jboss.shrinkwrap.api.spec.JavaArchive;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.junit.jupiter.api.extension.RegisterExtension;\n+\n+import com.example.test.MutinyStreamsGrpc;\n+import com.example.test.StreamsGrpc;\n+import com.example.test.StreamsOuterClass;\n+\n+import devmodetest.v1.Devmodetest;\n+import io.grpc.ManagedChannel;\n+import io.grpc.ManagedChannelBuilder;\n+import io.grpc.examples.helloworld.GreeterGrpc;\n+import io.grpc.examples.helloworld.HelloReply;\n+import io.grpc.examples.helloworld.HelloRequest;\n+import io.quarkus.test.QuarkusDevModeTest;\n+import io.smallrye.mutiny.Multi;\n+import io.smallrye.mutiny.subscription.Subscribers;\n+\n+/**\n+ * @author Michal Szynkiewicz, michal.l.szynkiewicz@gmail.com\n+ *         <br>", "originalCommit": "28b78b2b1aa09349850879fcc6daa72123097678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTIzNDE2NA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455234164", "bodyText": "done", "author": "michalszynkiewicz", "createdAt": "2020-07-15T17:52:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0NzAwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0ODA2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455048063", "bodyText": "This should be removed.", "author": "cescoffier", "createdAt": "2020-07-15T13:24:22Z", "path": "integration-tests/gradle/src/test/java/io/quarkus/gradle/devmode/GrpcDevModeTest.java", "diffHunk": "@@ -0,0 +1,24 @@\n+//package io.quarkus.gradle.devmode;\n+//\n+//import static org.assertj.core.api.Assertions.assertThat;\n+//\n+//import com.google.common.collect.ImmutableMap;\n+// // TODO: to be uncommented with #10631", "originalCommit": "28b78b2b1aa09349850879fcc6daa72123097678", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA5MzAxMA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455093010", "bodyText": "I'd rather keep it and uncomment it in #10631, if that's okay.", "author": "michalszynkiewicz", "createdAt": "2020-07-15T14:25:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA0ODA2Mw=="}], "type": "inlineReview"}, {"oid": "ba16068f6b8f519fa42f236f03c021d135759b45", "url": "https://github.com/quarkusio/quarkus/commit/ba16068f6b8f519fa42f236f03c021d135759b45", "message": "grpc dev mode - use single server", "committedDate": "2020-07-15T19:25:39Z", "type": "commit"}, {"oid": "ba16068f6b8f519fa42f236f03c021d135759b45", "url": "https://github.com/quarkusio/quarkus/commit/ba16068f6b8f519fa42f236f03c021d135759b45", "message": "grpc dev mode - use single server", "committedDate": "2020-07-15T19:25:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5Nzk5MA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455697990", "bodyText": "This method does not return a collection", "author": "ppalaga", "createdAt": "2020-07-16T10:50:13Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/CodeGenProvider.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package io.quarkus.deployment;\n+\n+import org.wildfly.common.annotation.NotNull;\n+\n+import io.quarkus.bootstrap.prebuild.CodeGenException;\n+\n+/**\n+ * Service providers for this interfaces are triggered during generate-sources phase of build of Quarkus applications\n+ */\n+public interface CodeGenProvider {\n+    /**\n+     *\n+     * @return unique name of the code gen provider, will correspond to the directory in <code>generated-sources</code>\n+     */\n+    @NotNull\n+    String providerId();\n+\n+    /**\n+     * File extensions that CodeGenProvider will generate code from\n+     *\n+     * @return collection of file extensions", "originalCommit": "ba16068f6b8f519fa42f236f03c021d135759b45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5ODM5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455698393", "bodyText": "What is the purpose of this class?", "author": "ppalaga", "createdAt": "2020-07-16T10:50:58Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/CodeGenerator.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package io.quarkus.deployment;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.ServiceLoader;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+\n+import io.quarkus.bootstrap.model.AppModel;\n+import io.quarkus.bootstrap.prebuild.CodeGenException;\n+import io.quarkus.deployment.codegen.CodeGenData;\n+\n+public class CodeGenerator {", "originalCommit": "ba16068f6b8f519fa42f236f03c021d135759b45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTgxNTE4Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455815186", "bodyText": "Code generation, in short.\nGoing in a bit more detail: to gather the logic of initializing and executing CodeGenProviders.", "author": "michalszynkiewicz", "createdAt": "2020-07-16T14:09:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5ODM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg0NzY0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455847647", "bodyText": "Thanks, a line of JavaDoc would be nice", "author": "ppalaga", "createdAt": "2020-07-16T14:51:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5ODM5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTY5ODU5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455698597", "bodyText": "What is \"code gen\"?", "author": "ppalaga", "createdAt": "2020-07-16T10:51:23Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/CodeGenerator.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package io.quarkus.deployment;\n+\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.ServiceLoader;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+\n+import io.quarkus.bootstrap.model.AppModel;\n+import io.quarkus.bootstrap.prebuild.CodeGenException;\n+import io.quarkus.deployment.codegen.CodeGenData;\n+\n+public class CodeGenerator {\n+\n+    // used by Gradle\n+    @SuppressWarnings(\"unused\")\n+    public static void initAndRun(ClassLoader classLoader,\n+            Set<Path> sourceParentDirs, Path generatedSourcesDir, Path buildDir,\n+            Consumer<Path> sourceRegistrar,\n+            AppModel appModel) throws CodeGenException {\n+        List<CodeGenData> generators = init(classLoader, sourceParentDirs, generatedSourcesDir, buildDir, sourceRegistrar);\n+        for (CodeGenData generator : generators) {\n+            trigger(classLoader, generator, appModel);\n+        }\n+    }\n+\n+    public static List<CodeGenData> init(ClassLoader deploymentClassLoader,\n+            Set<Path> sourceParentDirs,\n+            Path generatedSourcesDir,\n+            Path buildDir,\n+            Consumer<Path> sourceRegistrar) throws CodeGenException {\n+        return callWithClassloader(deploymentClassLoader, () -> {\n+            List<CodeGenData> result = new ArrayList<>();\n+            Class<? extends CodeGenProvider> codeGenProviderClass;\n+            try {\n+                //noinspection unchecked\n+                codeGenProviderClass = (Class<? extends CodeGenProvider>) deploymentClassLoader\n+                        .loadClass(CodeGenProvider.class.getName());\n+            } catch (ClassNotFoundException e) {\n+                throw new CodeGenException(\"Failde to load CodeGenProvider class from deployment classloader\", e);\n+            }\n+            for (CodeGenProvider provider : ServiceLoader.load(codeGenProviderClass)) {\n+                Path outputDir = codeGenOutDir(generatedSourcesDir, provider, sourceRegistrar);\n+                for (Path sourceParentDir : sourceParentDirs) {\n+                    result.add(\n+                            new CodeGenData(provider, outputDir, sourceParentDir.resolve(provider.inputDirectory()), buildDir));\n+                }\n+            }\n+\n+            return result;\n+        });\n+    }\n+\n+    private static <T> T callWithClassloader(ClassLoader deploymentClassLoader, CodeGenAction<T> supplier)\n+            throws CodeGenException {\n+        ClassLoader originalClassloader = Thread.currentThread().getContextClassLoader();\n+        try {\n+            Thread.currentThread().setContextClassLoader(deploymentClassLoader);\n+            return supplier.fire();\n+        } finally {\n+            Thread.currentThread().setContextClassLoader(originalClassloader);\n+        }\n+    }\n+\n+    /**\n+     * generate sources for given code gen", "originalCommit": "ba16068f6b8f519fa42f236f03c021d135759b45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcwMDUwNA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455700504", "bodyText": "Perhaps better Performs Quarkus pre-build preparations, such as sources generation", "author": "ppalaga", "createdAt": "2020-07-16T10:54:49Z", "path": "devtools/gradle/src/main/java/io/quarkus/gradle/tasks/QuarkusPrepare.java", "diffHunk": "@@ -0,0 +1,112 @@\n+package io.quarkus.gradle.tasks;\n+\n+import java.lang.reflect.InvocationTargetException;\n+import java.lang.reflect.Method;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.Arrays;\n+import java.util.List;\n+import java.util.Optional;\n+import java.util.Properties;\n+import java.util.Set;\n+import java.util.function.Consumer;\n+\n+import org.gradle.api.GradleException;\n+import org.gradle.api.plugins.Convention;\n+import org.gradle.api.plugins.JavaPluginConvention;\n+import org.gradle.api.tasks.SourceSet;\n+import org.gradle.api.tasks.TaskAction;\n+\n+import io.quarkus.bootstrap.BootstrapException;\n+import io.quarkus.bootstrap.app.CuratedApplication;\n+import io.quarkus.bootstrap.app.QuarkusBootstrap;\n+import io.quarkus.bootstrap.classloading.QuarkusClassLoader;\n+import io.quarkus.bootstrap.model.AppArtifact;\n+import io.quarkus.bootstrap.resolver.AppModelResolver;\n+import io.quarkus.deployment.CodeGenerator;\n+\n+public class QuarkusPrepare extends QuarkusTask {\n+\n+    public static final String INIT_AND_RUN = \"initAndRun\";\n+    private Set<Path> sourcesDirectories;\n+    private Consumer<Path> sourceRegistrar;\n+    private boolean test = false;\n+\n+    public QuarkusPrepare() {\n+        super(\"Quarkus performs pre-build preparations, such as sources generation\");", "originalCommit": "ba16068f6b8f519fa42f236f03c021d135759b45", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcwMTYzNw==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455701637", "bodyText": "Please add a single line of JavaDoc explaining the purpose of this mojo.\nIs there any reason against adding threadSafe = true?", "author": "ppalaga", "createdAt": "2020-07-16T10:57:00Z", "path": "devtools/maven/src/main/java/io/quarkus/maven/CodeGenMojo.java", "diffHunk": "@@ -0,0 +1,152 @@\n+package io.quarkus.maven;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Properties;\n+import java.util.function.Consumer;\n+\n+import org.apache.maven.artifact.Artifact;\n+import org.apache.maven.plugin.AbstractMojo;\n+import org.apache.maven.plugin.MojoExecutionException;\n+import org.apache.maven.plugin.MojoFailureException;\n+import org.apache.maven.plugins.annotations.Component;\n+import org.apache.maven.plugins.annotations.LifecyclePhase;\n+import org.apache.maven.plugins.annotations.Mojo;\n+import org.apache.maven.plugins.annotations.Parameter;\n+import org.apache.maven.plugins.annotations.ResolutionScope;\n+import org.apache.maven.project.MavenProject;\n+import org.eclipse.aether.RepositorySystem;\n+import org.eclipse.aether.RepositorySystemSession;\n+import org.eclipse.aether.repository.RemoteRepository;\n+\n+import io.quarkus.bootstrap.app.CuratedApplication;\n+import io.quarkus.bootstrap.app.QuarkusBootstrap;\n+import io.quarkus.bootstrap.classloading.QuarkusClassLoader;\n+import io.quarkus.bootstrap.model.AppArtifact;\n+import io.quarkus.bootstrap.prebuild.CodeGenFailureException;\n+import io.quarkus.bootstrap.resolver.maven.MavenArtifactResolver;\n+import io.quarkus.deployment.CodeGenerator;\n+import io.quarkus.deployment.codegen.CodeGenData;\n+\n+@Mojo(name = \"prepare\", defaultPhase = LifecyclePhase.GENERATE_SOURCES, requiresDependencyResolution = ResolutionScope.COMPILE_PLUS_RUNTIME)", "originalCommit": "ba16068f6b8f519fa42f236f03c021d135759b45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTc5NjMwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455796309", "bodyText": "does it mark a plugin safe to run in parallel with building other modules?", "author": "michalszynkiewicz", "createdAt": "2020-07-16T13:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcwMTYzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTg0OTk0OA==", "url": "https://github.com/quarkusio/quarkus/pull/9917#discussion_r455849948", "bodyText": "https://maven.apache.org/developers/mojo-api-specification.html\n\nMarks this mojo as being thread-safe, i.e. the mojo safely supports concurrent execution during parallel builds. Mojos without this annotation will make Maven output a warning when used during a parallel build session. The short-hand notation @threadsafe without a tag value is equivalent to @threadsafe true. Since Maven 3.0.", "author": "ppalaga", "createdAt": "2020-07-16T14:54:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTcwMTYzNw=="}], "type": "inlineReview"}]}