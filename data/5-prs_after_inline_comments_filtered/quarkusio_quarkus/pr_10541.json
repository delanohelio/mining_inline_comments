{"pr_number": 10541, "pr_title": "Introduce entityManager() in PanacheEntityBase and PanacheRepositoryBase", "pr_createdAt": "2020-07-07T22:32:47Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10541", "timeline": [{"oid": "c4127048865dad5b72c2c281bbdda60a50fcfb8c", "url": "https://github.com/quarkusio/quarkus/commit/c4127048865dad5b72c2c281bbdda60a50fcfb8c", "message": "Introduce entityManager() in PanacheEntityBase and PanacheRepositoryBase and Kotlin counterparts\n\nFixes #7233", "committedDate": "2020-07-08T14:46:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r452203627", "bodyText": "I think this got merged a bit quickly. Please wait a bit longer to give people time to review.\nWhy is this protected, and why is this not named getEntityManager? In general I don't have anything against dropping get from accessor methods but this is not coherent here because we have isPersistent in the same class.", "author": "FroMage", "createdAt": "2020-07-09T13:08:21Z", "path": "extensions/panache/hibernate-orm-panache/runtime/src/main/java/io/quarkus/hibernate/orm/panache/PanacheEntityBase.java", "diffHunk": "@@ -31,6 +32,15 @@\n \n     // Operations\n \n+    /**\n+     * Returns the default {@link EntityManager} for extra operations (eg. CriteriaQueries)\n+     *\n+     * @return the default {@link EntityManager}\n+     */\n+    protected EntityManager entityManager() {", "originalCommit": "c4127048865dad5b72c2c281bbdda60a50fcfb8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIxMTkwNg==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r452211906", "bodyText": "Thanks for your feedback. May I ask why do you think it should be public? Shouldn't an EntityManager be used only inside the entity? About the method name, I reused what @emmanuelbernard suggested in #7233", "author": "gastaldi", "createdAt": "2020-07-09T13:20:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIxNjQ0NQ==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r452216445", "bodyText": "I believe @emmanuelbernard was in the wrong :)\nAs for why it should be public, it's forwarding to a public method anyway, so there's no need to hide it, it can always be useful to some people I guess.", "author": "FroMage", "createdAt": "2020-07-09T13:27:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjY2NzIzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r452667235", "bodyText": "I didn't notice the protected modifier when I review the PR my bad.\nI too think it should be public, the main idea behind providing these methods is to allow people to have an easy access to the entity manager (we can already access it via injection as it's a CDI bean, or via Panache.getEntityManager) for more complex use cases.\nIt's a developer choice to use it only inside the entitry/repository of from a business service layer for example, we should'nt restrict what is possible.\nAs for the method names, in MongoDB we provides mongoCollection() and mongoDatabase() to access the underlying low level access objects so it's more natural to provides entityManager() for Hibernate Panache. I remember that we discuss to use get prefix and there is two reason why I think it's better without it:\n\nFor entity, get is for a getter on the JavaBean standard, so it tells people that it is a field of the object. We can tweak HIbernate to not treat it as a field but it's not natural.\nThe Panache build infrastructure didn't works OOTB with methods starting with get as it thinks it's a field getter so it didn't want to inject inside it the implementation (something inside the enhancer ...).", "author": "loicmathieu", "createdAt": "2020-07-10T07:19:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc4NDAxOA==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r452784018", "bodyText": "@loicmathieu those are really good reasons, and I think I like it without the get prefix too. Please feel free to revert my commit from #10611 (but making it public) if you manage to convince @FroMage \ud83d\ude09", "author": "gastaldi", "createdAt": "2020-07-10T11:22:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mjc4ODI2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r452788263", "bodyText": "This has already been merged so let's keep it like this, after all @FroMage is the master of Panache ;)", "author": "loicmathieu", "createdAt": "2020-07-10T11:32:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk4NDE4Mg==", "url": "https://github.com/quarkusio/quarkus/pull/10541#discussion_r454984182", "bodyText": "yes I think getEM would likely create more trouble due to the JPA bean property discovery mechanism. Though to be fair I did not think of that when I proposed the name :)", "author": "emmanuelbernard", "createdAt": "2020-07-15T11:33:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjIwMzYyNw=="}], "type": "inlineReview"}]}