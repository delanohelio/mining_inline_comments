{"pr_number": 7586, "pr_title": "Upgrade to RESTEasy 4.5 to support async IO", "pr_createdAt": "2020-03-04T23:33:31Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7586", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAxMTE5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7586#discussion_r388011193", "bodyText": "Can't asyncFlush happen before asyncWrite in this snippet? Wondering if it's better to read:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    CompletionStage<Void> a = entityStream.asyncWrite(jsonArray.toBuffer().getBytes());\n          \n          \n            \n                    CompletionStage<Void> b = entityStream.asyncFlush();\n          \n          \n            \n                    return a.thenCompose(v -> b);\n          \n          \n            \n                    return entityStream.asyncWrite(jsonArray.toBuffer().getBytes())\n          \n          \n            \n                                   .thenCompose(v -> entityStream.asyncFlush());", "author": "gastaldi", "createdAt": "2020-03-05T00:17:23Z", "path": "extensions/resteasy/runtime/src/main/java/io/quarkus/resteasy/runtime/vertx/JsonArrayWriter.java", "diffHunk": "@@ -35,4 +38,14 @@ public void writeTo(JsonArray jsonArray, Class<?> type, Type genericType, Annota\n         entityStream.flush();\n         entityStream.close();\n     }\n+\n+    @Override\n+    public CompletionStage<Void> asyncWriteTo(JsonArray jsonArray, Class<?> type, Type genericType, Annotation[] annotations,\n+            MediaType mediaType,\n+            MultivaluedMap<String, Object> httpHeaders,\n+            AsyncOutputStream entityStream) {\n+        CompletionStage<Void> a = entityStream.asyncWrite(jsonArray.toBuffer().getBytes());\n+        CompletionStage<Void> b = entityStream.asyncFlush();\n+        return a.thenCompose(v -> b);", "originalCommit": "b68ec9ea69bda712f0c5e44ae996bea86b7799c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODA3OTcwNg==", "url": "https://github.com/quarkusio/quarkus/pull/7586#discussion_r388079706", "bodyText": "I just removed the flush, it looks like none of the other writers have it, and in general flushes are a bad idea as they can force chunked encoding when it is not nessesary.", "author": "stuartwdouglas", "createdAt": "2020-03-05T05:03:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAxMTE5Mw=="}], "type": "inlineReview"}, {"oid": "160a2398ae6e64f8cb5f19f7aeaeb96237fea239", "url": "https://github.com/quarkusio/quarkus/commit/160a2398ae6e64f8cb5f19f7aeaeb96237fea239", "message": "Upgrade to RESTEasy 4.5 to support async IO\n\n- Remove second vertx instance\n- Microprofile REST client 1.4\n\nFixes #5593", "committedDate": "2020-03-05T04:43:22Z", "type": "commit"}, {"oid": "160a2398ae6e64f8cb5f19f7aeaeb96237fea239", "url": "https://github.com/quarkusio/quarkus/commit/160a2398ae6e64f8cb5f19f7aeaeb96237fea239", "message": "Upgrade to RESTEasy 4.5 to support async IO\n\n- Remove second vertx instance\n- Microprofile REST client 1.4\n\nFixes #5593", "committedDate": "2020-03-05T04:43:22Z", "type": "forcePushed"}]}