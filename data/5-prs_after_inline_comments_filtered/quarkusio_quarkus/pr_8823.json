{"pr_number": 8823, "pr_title": "Ensure that an uppercase username doesn't break container-image building", "pr_createdAt": "2020-04-24T12:22:35Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8823", "timeline": [{"oid": "e80b3a7766b64712f9388a11f4bdfb8706515ee4", "url": "https://github.com/quarkusio/quarkus/commit/e80b3a7766b64712f9388a11f4bdfb8706515ee4", "message": "Ensure that an uppercase username doesn't break container image building\n\nFixes: #8819", "committedDate": "2020-04-24T12:21:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU0ODIzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/8823#discussion_r414548235", "bodyText": "I'm not sure why we lowercase only in this case? I mean it will fail if the group has some uppercase character, won't it?", "author": "gsmet", "createdAt": "2020-04-24T12:46:30Z", "path": "extensions/container-image/deployment/src/main/java/io/quarkus/container/image/deployment/ContainerImageConfig.java", "diffHunk": "@@ -61,4 +61,20 @@\n      */\n     @ConfigItem\n     public boolean push;\n+\n+    /**\n+     * Since user.name which is default value can be uppercase and uppercase values are not allowed\n+     * in the repository part of image references, we need to make the username lowercase.\n+     *\n+     * We purposely don't change the value of an explicitly set group.\n+     */\n+    public Optional<String> getEffectiveGroup() {\n+        if (group.isPresent()) {\n+            String originalGroup = group.get();\n+            if (originalGroup.equals(System.getProperty(\"user.name\"))) {\n+                return Optional.of(originalGroup.toLowerCase());", "originalCommit": "e80b3a7766b64712f9388a11f4bdfb8706515ee4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU1MDY5MA==", "url": "https://github.com/quarkusio/quarkus/pull/8823#discussion_r414550690", "bodyText": "My idea is that it's better to fail if the user explicitly sets a group that is invalid (the error message is very explicit and actionable). I am thinking that if we start changing user supplied configuration it could be a very slippery slope...\nIf however the user did not set anything and the username was used implicitly, then only in that implicit case should we intervene.", "author": "geoand", "createdAt": "2020-04-24T12:50:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDU0ODIzNQ=="}], "type": "inlineReview"}]}