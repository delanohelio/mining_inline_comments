{"pr_number": 12385, "pr_title": "Micrometer @Timed and @Counted", "pr_createdAt": "2020-09-29T04:06:33Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12385", "timeline": [{"oid": "ec655877bec07531f14d5b2131e25355e40dbac3", "url": "https://github.com/quarkusio/quarkus/commit/ec655877bec07531f14d5b2131e25355e40dbac3", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-29T04:15:51Z", "type": "forcePushed"}, {"oid": "21cf23250be4f563f2da0cbce78eac912abae487", "url": "https://github.com/quarkusio/quarkus/commit/21cf23250be4f563f2da0cbce78eac912abae487", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-29T04:18:00Z", "type": "forcePushed"}, {"oid": "a3ed0c9af5ff50265965cac600a4e1f5eb087e35", "url": "https://github.com/quarkusio/quarkus/commit/a3ed0c9af5ff50265965cac600a4e1f5eb087e35", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-29T13:21:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5MDM1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r496790357", "bodyText": "[nit] Just a thought I had from a general perspective and not specific to this PR only, but can we get smarter about registering beans as being unremovable?\nFor instance, can we check for usage of @Timed in application code before marking the classes for it as unremovable?\nMaybe the cost of that search isn't worth the small amount of marking classes as unremovable, but I'm curious", "author": "kenfinnigan", "createdAt": "2020-09-29T15:00:18Z", "path": "extensions/micrometer/deployment/src/main/java/io/quarkus/micrometer/deployment/MicrometerProcessor.java", "diffHunk": "@@ -84,6 +99,12 @@ UnremovableBeanBuildItem registerAdditionalBeans(CombinedIndexBuildItem indexBui\n                 .addBeanClass(CompositeRegistryCreator.class)\n                 .addBeanClass(MeterFilterConstraint.class)\n                 .addBeanClass(MeterFilterConstraints.class)\n+                .addBeanClass(TIMED_ANNOTATION.toString())", "originalCommit": "a3ed0c9af5ff50265965cac600a4e1f5eb087e35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwMzA4MA==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r496803080", "bodyText": "yea.. I can chew on it", "author": "ebullient", "createdAt": "2020-09-29T15:16:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5MDM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5ODkxMg==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r497198912", "bodyText": "If it's speed of search that's a consideration (and assuming this can be some sort of compile-only dependency) I cannot recommend https://github.com/classgraph/classgraph enough. So fast...", "author": "jkschneider", "createdAt": "2020-09-30T01:50:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5MDM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcwMjI5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r497702297", "bodyText": "Moved annotations (and interceptors) to a different set of additional beans that are removable. Everything still works (I added more tests to an IT bucket to make sure)", "author": "ebullient", "createdAt": "2020-09-30T18:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5MDM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5NDM0Ng==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r496794346", "bodyText": "Wondering if, long term, there's a better home for this kind of thing so other projects can get this OOTB?", "author": "kenfinnigan", "createdAt": "2020-09-29T15:05:36Z", "path": "extensions/micrometer/runtime/src/main/java/io/quarkus/micrometer/runtime/MicrometerCountedInterceptor.java", "diffHunk": "@@ -0,0 +1,111 @@\n+package io.quarkus.micrometer.runtime;\n+\n+import java.lang.reflect.Method;\n+import java.util.concurrent.CompletionStage;\n+", "originalCommit": "a3ed0c9af5ff50265965cac600a4e1f5eb087e35", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwMzkwOA==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r496803908", "bodyText": "I don't follow. This is specific to what the @timed / @counted implementation for Micrometer annotations expect..\nAnd I'm not sure I entirely love this. This is probably where the most changes might come as it stews.", "author": "ebullient", "createdAt": "2020-09-29T15:17:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5NDM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgwODcxMA==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r496808710", "bodyText": "Agree it's specific to those annotations, but thinking from a perspective of other projects using Micrometer directly, do they need this too? If so, where should it go?\nMaybe the answer is they don't, and it's fine to be only here.", "author": "kenfinnigan", "createdAt": "2020-09-29T15:23:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5NDM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5OTE5OQ==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r497199199", "bodyText": "I think this commit disappeared. Happy to pull something into Micrometer core if it's generally useful.", "author": "jkschneider", "createdAt": "2020-09-30T01:51:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5NDM0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzcxMTYzMg==", "url": "https://github.com/quarkusio/quarkus/pull/12385#discussion_r497711632", "bodyText": "I think I'll keep it for now.. I just don't like it. I don't believe there is anything here that can be pulled out to somewhere more generic.", "author": "ebullient", "createdAt": "2020-09-30T18:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njc5NDM0Ng=="}], "type": "inlineReview"}, {"oid": "bbc58dfb6c9a32aa1c759b9072bc707c75af6f53", "url": "https://github.com/quarkusio/quarkus/commit/bbc58dfb6c9a32aa1c759b9072bc707c75af6f53", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-30T01:41:21Z", "type": "forcePushed"}, {"oid": "288697012dcf1e3b989e8244c5ba74c2f3b1b5cd", "url": "https://github.com/quarkusio/quarkus/commit/288697012dcf1e3b989e8244c5ba74c2f3b1b5cd", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-30T17:39:00Z", "type": "forcePushed"}, {"oid": "63767dbc92cc260bd7f7886cfa1acab0e7ac3ae4", "url": "https://github.com/quarkusio/quarkus/commit/63767dbc92cc260bd7f7886cfa1acab0e7ac3ae4", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-30T18:12:34Z", "type": "commit"}, {"oid": "63767dbc92cc260bd7f7886cfa1acab0e7ac3ae4", "url": "https://github.com/quarkusio/quarkus/commit/63767dbc92cc260bd7f7886cfa1acab0e7ac3ae4", "message": "Micrometer @Timed and @Counted", "committedDate": "2020-09-30T18:12:34Z", "type": "forcePushed"}]}