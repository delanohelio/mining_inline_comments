{"pr_number": 9469, "pr_title": "SSL support for Reactive SQL Clients", "pr_createdAt": "2020-05-19T21:44:08Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9469", "timeline": [{"oid": "73acac4862ab92986c15d884c64a2f36a1a0e21c", "url": "https://github.com/quarkusio/quarkus/commit/73acac4862ab92986c15d884c64a2f36a1a0e21c", "message": "SSL support for Reactive Pg Client\n\nFixes #552", "committedDate": "2020-05-19T21:51:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTMyMA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r429739320", "bodyText": "We try to avoid import statements using *.", "author": "cescoffier", "createdAt": "2020-05-25T05:40:02Z", "path": "extensions/reactive-pg-client/runtime/src/main/java/io/quarkus/reactive/pg/client/runtime/PgPoolRecorder.java", "diffHunk": "@@ -2,6 +2,7 @@\n \n import static io.quarkus.credentials.CredentialsProvider.PASSWORD_PROPERTY_NAME;\n import static io.quarkus.credentials.CredentialsProvider.USER_PROPERTY_NAME;\n+import static io.quarkus.vertx.core.runtime.SSLConfigHelper.*;", "originalCommit": "35b2a349219b22f6a08aad14d455f02a7a62ea7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1NTM5MA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r429955390", "bodyText": "Sorry, I will fix that", "author": "tsegismont", "createdAt": "2020-05-25T14:10:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTU5NA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r429739594", "bodyText": "Shouldn't we break the chain if we already configured the options?\nIf you use PEM, the chances to also use JKS PFX are 0, no?", "author": "cescoffier", "createdAt": "2020-05-25T05:41:15Z", "path": "extensions/reactive-pg-client/runtime/src/main/java/io/quarkus/reactive/pg/client/runtime/PgPoolRecorder.java", "diffHunk": "@@ -121,6 +122,18 @@ private PgConnectOptions toPgConnectOptions(DataSourceRuntimeConfig dataSourceRu\n             pgConnectOptions.setPipeliningLimit(dataSourceReactivePostgreSQLConfig.pipeliningLimit.getAsInt());\n         }\n \n+        if (dataSourceReactivePostgreSQLConfig.sslMode.isPresent()) {\n+            pgConnectOptions.setSslMode(dataSourceReactivePostgreSQLConfig.sslMode.get());\n+        }\n+\n+        configurePemTrustOptions(pgConnectOptions, dataSourceReactivePostgreSQLConfig.trustCertificatePem);", "originalCommit": "35b2a349219b22f6a08aad14d455f02a7a62ea7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1NjA0MA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r429956040", "bodyText": "Actually we do, this is done in SSLHelper#ensureTrustOptionsNotSet.", "author": "tsegismont", "createdAt": "2020-05-25T14:11:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTkxNw==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r429739917", "bodyText": "This should be done directly in the config class. List are comma-separated by default. See the last example from https://github.com/eclipse/microprofile-config/blob/master/spec/src/main/asciidoc/configexamples.asciidoc.", "author": "cescoffier", "createdAt": "2020-05-25T05:42:43Z", "path": "extensions/vertx-core/runtime/src/main/java/io/quarkus/vertx/core/runtime/SSLConfigHelper.java", "diffHunk": "@@ -0,0 +1,119 @@\n+package io.quarkus.vertx.core.runtime;\n+\n+import java.util.regex.Pattern;\n+\n+import io.quarkus.vertx.core.runtime.config.JksConfiguration;\n+import io.quarkus.vertx.core.runtime.config.PemKeyCertConfiguration;\n+import io.quarkus.vertx.core.runtime.config.PemTrustCertConfiguration;\n+import io.quarkus.vertx.core.runtime.config.PfxConfiguration;\n+import io.vertx.core.net.*;\n+\n+public class SSLConfigHelper {\n+\n+    private static final Pattern COMMA_PATTERN = Pattern.compile(\",\");", "originalCommit": "35b2a349219b22f6a08aad14d455f02a7a62ea7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk1NzI0MA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r429957240", "bodyText": "Thanks for pointing this out, I will update the config object.", "author": "tsegismont", "createdAt": "2020-05-25T14:14:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTczOTkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk1ODI4Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r430958283", "bodyText": "This javadoc is used in the configuration reference doc. Thus it's better to avoid link to properties and also use the \"dash case\" versions that are used in config (so trust-certificate-jks for instance).", "author": "gsmet", "createdAt": "2020-05-27T08:50:09Z", "path": "extensions/reactive-datasource/runtime/src/main/java/io/quarkus/reactive/datasource/runtime/DataSourceReactiveRuntimeConfig.java", "diffHunk": "@@ -24,4 +28,58 @@\n      */\n     @ConfigItem\n     public OptionalInt maxSize;\n+\n+    /**\n+     * Whether all server certificates should be trusted.\n+     */\n+    @ConfigItem(defaultValue = \"false\")\n+    public boolean trustAll;\n+\n+    /**\n+     * Trust configuration in the PEM format.\n+     * <p>\n+     * When enabled, {@link #trustCertificateJks} and {@link #trustCertificatePfx} must be disabled.", "originalCommit": "49343655e9ee5e5666360dd4f444f13358ea5807", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTE1MzI1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r431153257", "bodyText": "Done", "author": "tsegismont", "createdAt": "2020-05-27T13:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk1ODI4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY4NDkxMw==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r433684913", "bodyText": "@michalszynkiewicz Don't we have the same type of code in gRPC? Maybe we can reuse the same classes.", "author": "cescoffier", "createdAt": "2020-06-02T07:49:34Z", "path": "extensions/vertx-core/runtime/src/main/java/io/quarkus/vertx/core/runtime/SSLConfigHelper.java", "diffHunk": "@@ -0,0 +1,120 @@\n+package io.quarkus.vertx.core.runtime;\n+\n+import io.quarkus.vertx.core.runtime.config.JksConfiguration;\n+import io.quarkus.vertx.core.runtime.config.PemKeyCertConfiguration;\n+import io.quarkus.vertx.core.runtime.config.PemTrustCertConfiguration;\n+import io.quarkus.vertx.core.runtime.config.PfxConfiguration;\n+import io.vertx.core.net.JksOptions;\n+import io.vertx.core.net.KeyCertOptions;\n+import io.vertx.core.net.PemKeyCertOptions;\n+import io.vertx.core.net.PemTrustOptions;\n+import io.vertx.core.net.PfxOptions;\n+import io.vertx.core.net.TCPSSLOptions;\n+\n+public class SSLConfigHelper {\n+\n+    public static void configurePemTrustOptions(TCPSSLOptions options, PemTrustCertConfiguration configuration) {", "originalCommit": "5030577e61b969367624b13ba1fd6fc1164c4715", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcxNTExMA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r433715110", "bodyText": "@cescoffier can we do any follow-up work related to gRPC in another PR? If you and @gsmet are both fine with this one, it would be great to merge it so I can rebase #9644", "author": "tsegismont", "createdAt": "2020-06-02T08:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY4NDkxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTQ0NDYwOA==", "url": "https://github.com/quarkusio/quarkus/pull/9469#discussion_r435444608", "bodyText": "Yes @tsegismont, this is not an issue with this PR, it's a good idea to reuse them!", "author": "cescoffier", "createdAt": "2020-06-04T17:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzY4NDkxMw=="}], "type": "inlineReview"}, {"oid": "da52deabcf24c675196c802c50d292cf3db6f314", "url": "https://github.com/quarkusio/quarkus/commit/da52deabcf24c675196c802c50d292cf3db6f314", "message": "Update Javadoc", "committedDate": "2020-06-09T12:54:31Z", "type": "forcePushed"}, {"oid": "50d2691863cc602cd08b93d2cc7b1dd30ac8abd0", "url": "https://github.com/quarkusio/quarkus/commit/50d2691863cc602cd08b93d2cc7b1dd30ac8abd0", "message": "Update Javadoc", "committedDate": "2020-06-11T09:20:59Z", "type": "forcePushed"}, {"oid": "0062a3c74d290bca3fb2ee8c3890a1059d6734b1", "url": "https://github.com/quarkusio/quarkus/commit/0062a3c74d290bca3fb2ee8c3890a1059d6734b1", "message": "SSL support for Reactive Pg Client\n\nFixes #552", "committedDate": "2020-06-17T09:46:08Z", "type": "commit"}, {"oid": "31272a1fc0c7780f4f05222ea1122f2926defcae", "url": "https://github.com/quarkusio/quarkus/commit/31272a1fc0c7780f4f05222ea1122f2926defcae", "message": "DataSourceReactivePostgreSQLConfig: use same prop names as in EventBusConfiguration", "committedDate": "2020-06-17T09:46:08Z", "type": "commit"}, {"oid": "9df17f89e76dc2ff56fae772e01d445c412a79a4", "url": "https://github.com/quarkusio/quarkus/commit/9df17f89e76dc2ff56fae772e01d445c412a79a4", "message": "DataSourceReactivePostgreSQLConfig: added config doc", "committedDate": "2020-06-17T09:46:08Z", "type": "commit"}, {"oid": "7f9ea6b7f500bfd34c8202375bd8afc36801edf5", "url": "https://github.com/quarkusio/quarkus/commit/7f9ea6b7f500bfd34c8202375bd8afc36801edf5", "message": "Updated as per review", "committedDate": "2020-06-17T09:46:09Z", "type": "commit"}, {"oid": "4fea9f9cb1a0d1030214016b3897a0ef9261910d", "url": "https://github.com/quarkusio/quarkus/commit/4fea9f9cb1a0d1030214016b3897a0ef9261910d", "message": "SSL support for Reactive MySQL Client\n\nFixes #6321", "committedDate": "2020-06-17T09:46:09Z", "type": "commit"}, {"oid": "e9eadccf2143cb8596ee1f26a49bb5d59fc1d85a", "url": "https://github.com/quarkusio/quarkus/commit/e9eadccf2143cb8596ee1f26a49bb5d59fc1d85a", "message": "Update Javadoc", "committedDate": "2020-06-17T09:46:09Z", "type": "commit"}, {"oid": "e9eadccf2143cb8596ee1f26a49bb5d59fc1d85a", "url": "https://github.com/quarkusio/quarkus/commit/e9eadccf2143cb8596ee1f26a49bb5d59fc1d85a", "message": "Update Javadoc", "committedDate": "2020-06-17T09:46:09Z", "type": "forcePushed"}]}