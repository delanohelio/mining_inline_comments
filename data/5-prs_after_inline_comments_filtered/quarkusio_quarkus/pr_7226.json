{"pr_number": 7226, "pr_title": "Introduce QuarkusProdModeTest", "pr_createdAt": "2020-02-17T13:37:52Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7226", "timeline": [{"oid": "4ec78903638d3c12a422808bd306d7281d008d90", "url": "https://github.com/quarkusio/quarkus/commit/4ec78903638d3c12a422808bd306d7281d008d90", "message": "Convert kubernetes integration tests to QuarkusProdModeTest", "committedDate": "2020-02-17T15:11:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDkxMg==", "url": "https://github.com/quarkusio/quarkus/pull/7226#discussion_r380244912", "bodyText": "If we are doing that, why not copy them while walking the dependency tree?", "author": "aloubyansky", "createdAt": "2020-02-17T15:27:55Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -415,43 +434,71 @@ private void doThinJarGeneration(CurateOutcomeBuildItem curateOutcomeBuildItem,\n \n         final List<AppDependency> appDeps = curateOutcomeBuildItem.getEffectiveModel().getUserDependencies();\n \n-        copyLibraryJars(transformedClasses, libDir, classPath, appDeps);\n+        Map<AppDependency, List<Path>> classesOfNonJarDependencies = copyLibraryJars(transformedClasses, libDir, classPath,\n+                appDeps, services);", "originalCommit": "4ec78903638d3c12a422808bd306d7281d008d90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NjA0OA==", "url": "https://github.com/quarkusio/quarkus/pull/7226#discussion_r380246048", "bodyText": "Very good point! I'll update the PR.", "author": "geoand", "createdAt": "2020-02-17T15:30:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDkxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI1MTAyMg==", "url": "https://github.com/quarkusio/quarkus/pull/7226#discussion_r380251022", "bodyText": "Fixed", "author": "geoand", "createdAt": "2020-02-17T15:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDI0NDkxMg=="}], "type": "inlineReview"}, {"oid": "1e03eb3c240831ee117815cd2416fb3e8a6a9ddb", "url": "https://github.com/quarkusio/quarkus/commit/1e03eb3c240831ee117815cd2416fb3e8a6a9ddb", "message": "Convert kubernetes integration tests to QuarkusProdModeTest", "committedDate": "2020-02-17T15:38:56Z", "type": "forcePushed"}, {"oid": "8b97f8890ef94104fdfa74c999485c7037a07e0c", "url": "https://github.com/quarkusio/quarkus/commit/8b97f8890ef94104fdfa74c999485c7037a07e0c", "message": "Convert kubernetes integration tests to QuarkusProdModeTest", "committedDate": "2020-02-17T20:32:59Z", "type": "forcePushed"}, {"oid": "93225491e60737a360f25447ac1d75a6c9125656", "url": "https://github.com/quarkusio/quarkus/commit/93225491e60737a360f25447ac1d75a6c9125656", "message": "Convert kubernetes integration tests to QuarkusProdModeTest", "committedDate": "2020-02-17T20:36:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM5MDM3Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7226#discussion_r380390376", "bodyText": "Wouldn't !Files.isDirectory() be more appropriate here? I know it is not likely to happen but you could have a directory that ends in .jar.", "author": "stuartwdouglas", "createdAt": "2020-02-17T22:52:38Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/JarResultBuildStep.java", "diffHunk": "@@ -284,6 +237,72 @@ public FileVisitResult visitFile(Path file, BasicFileAttributes attrs)\n         return new JarBuildItem(runnerJar, originalJar, null);\n     }\n \n+    private boolean isAppDepAJar(AppArtifact artifact) {\n+        return \"jar\".equals(artifact.getType());\n+    }\n+\n+    private boolean isAppDepPathAJar(AppArtifact artifact) {\n+        return artifact.getPath().getFileName().toString().endsWith(\".jar\");", "originalCommit": "93225491e60737a360f25447ac1d75a6c9125656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDQ5MTgyMg==", "url": "https://github.com/quarkusio/quarkus/pull/7226#discussion_r380491822", "bodyText": "Makes perfect sense, fixed", "author": "geoand", "createdAt": "2020-02-18T07:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDM5MDM3Ng=="}], "type": "inlineReview"}, {"oid": "5c5f62dfa22294ac503bde999a3271c8eb9b7e54", "url": "https://github.com/quarkusio/quarkus/commit/5c5f62dfa22294ac503bde999a3271c8eb9b7e54", "message": "Ensure that Quarkus dependencies picked up by localProjectDiscovery are copied to jar", "committedDate": "2020-02-18T07:10:24Z", "type": "commit"}, {"oid": "ef99352cafcc1c7e544df0973d8c89670a045eb6", "url": "https://github.com/quarkusio/quarkus/commit/ef99352cafcc1c7e544df0973d8c89670a045eb6", "message": "Introduce QuarkusProdModeTest", "committedDate": "2020-02-18T07:10:28Z", "type": "commit"}, {"oid": "28e2b6a1b22f93aa2bcf53a56165446c1c26f7da", "url": "https://github.com/quarkusio/quarkus/commit/28e2b6a1b22f93aa2bcf53a56165446c1c26f7da", "message": "Convert kubernetes integration tests to QuarkusProdModeTest", "committedDate": "2020-02-18T07:11:45Z", "type": "commit"}, {"oid": "28e2b6a1b22f93aa2bcf53a56165446c1c26f7da", "url": "https://github.com/quarkusio/quarkus/commit/28e2b6a1b22f93aa2bcf53a56165446c1c26f7da", "message": "Convert kubernetes integration tests to QuarkusProdModeTest", "committedDate": "2020-02-18T07:11:45Z", "type": "forcePushed"}]}