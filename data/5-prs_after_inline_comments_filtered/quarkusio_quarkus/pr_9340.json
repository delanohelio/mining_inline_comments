{"pr_number": 9340, "pr_title": "Properly support JUnit 5 parameters on test methods", "pr_createdAt": "2020-05-15T11:35:59Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9340", "timeline": [{"oid": "03ac12312ff8aabe12c6a4a769f62d05aed6f70b", "url": "https://github.com/quarkusio/quarkus/commit/03ac12312ff8aabe12c6a4a769f62d05aed6f70b", "message": "Properly support JUnit 5 parameters on test methods\n\nThis is done by deep-cloning the objects into the TCCL\nbefore actually passing them to the test\n\nFixes #8251, fixes #8703, fixes #8978", "committedDate": "2020-05-15T12:22:58Z", "type": "forcePushed"}, {"oid": "c2f679ebcb3e3187ec82bec591c4ba3677db2bdc", "url": "https://github.com/quarkusio/quarkus/commit/c2f679ebcb3e3187ec82bec591c4ba3677db2bdc", "message": "Properly support JUnit 5 parameters on test methods\n\nThis is done by deep-cloning the objects into the TCCL\nbefore actually passing them to the test\n\nFixes #8251, fixes #8703, fixes #8978", "committedDate": "2020-05-17T04:52:17Z", "type": "commit"}, {"oid": "c2f679ebcb3e3187ec82bec591c4ba3677db2bdc", "url": "https://github.com/quarkusio/quarkus/commit/c2f679ebcb3e3187ec82bec591c4ba3677db2bdc", "message": "Properly support JUnit 5 parameters on test methods\n\nThis is done by deep-cloning the objects into the TCCL\nbefore actually passing them to the test\n\nFixes #8251, fixes #8703, fixes #8978", "committedDate": "2020-05-17T04:52:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426328238", "bodyText": "I don't like this, jboss marshalling has some Cloner support that is likely more appropriate to use here.\nReally though if we had support for creating an object without calling a constructor you could just use reflection to recursively clone, but adding this support requires multi release jar support and would prevent Quarkus being build with JDK8.\nIdeally we would move non-constructor based instantiation into a mini library, and then do a simple reflection based clone. I probably won't get to look at this today, but I will likely have time later this week.", "author": "stuartwdouglas", "createdAt": "2020-05-18T01:08:48Z", "path": "test-framework/junit5/src/main/java/io/quarkus/test/junit/internal/XStreamDeepClone.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package io.quarkus.test.junit.internal;\n+\n+import com.thoughtworks.xstream.XStream;\n+\n+/**\n+ * Super simple cloning strategy that just serializes to XML and deserializes it using xstream\n+ */\n+public class XStreamDeepClone implements DeepClone {\n+\n+    private final XStream xStream;\n+\n+    public XStreamDeepClone(ClassLoader classLoader) {", "originalCommit": "c2f679ebcb3e3187ec82bec591c4ba3677db2bdc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM2NTc1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426365753", "bodyText": "Sure, that's obviously the right way to do things, but is it really warranted to spend the extra cycles for this use case?", "author": "geoand", "createdAt": "2020-05-18T04:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM3MjU0MA==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426372540", "bodyText": "Not to mention the various corner cases that we would need look out for as opposed to this way we seems to \"just work\" - although I obviously agree that it's not the cleanest solution in the world :)", "author": "geoand", "createdAt": "2020-05-18T05:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQwNTU5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426405597", "bodyText": "Took a quick look at JBoss Marshalling and it's cloner support is just for serializable or cloneable objects", "author": "geoand", "createdAt": "2020-05-18T06:58:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxNDQxOA==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426414418", "bodyText": "In any case, if you think it best, I'll wait until the no-constructor library is in place and then update the PR to use it - just ping me about it :)", "author": "geoand", "createdAt": "2020-05-18T07:18:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxNTkxNA==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426415914", "bodyText": "From memory it has an interface that you can implement to decide if an object can be cloned, and you can use to just pretend everything is serialisable. Lots of classes are also not going to work with the XML based approach.\nThinking about it wouldn't XStream also require a no-arg constructor, so a reflection based approach would not be any worse?", "author": "stuartwdouglas", "createdAt": "2020-05-18T07:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxODUxNg==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426418516", "bodyText": "XStream doesn't call the constructor at all, see:\nXStream is not calling the default constructor during deserialization.\n\nThis is, in fact, the same case as above. XStream uses the same mechanism as the JDK serialization. When using the enhanced mode with the optimized reflection API, it does not invoke the default constructor. The solution is to implement the readResolve or readObject as demonstrated with the last question.\n\nfrom https://x-stream.github.io/faq.html.\nSo it should just work (and indeed in the test cases I added, the objects being passed around include ones with a no-args constructor)", "author": "geoand", "createdAt": "2020-05-18T07:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQyMDkwOQ==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426420909", "bodyText": "FWIW, I chose this strategy because it's also used in Powemock :)", "author": "geoand", "createdAt": "2020-05-18T07:31:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzNjIyNw==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426436227", "bodyText": "ok, lets just go with it then", "author": "stuartwdouglas", "createdAt": "2020-05-18T07:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzODI5MQ==", "url": "https://github.com/quarkusio/quarkus/pull/9340#discussion_r426438291", "bodyText": "Cool :)", "author": "geoand", "createdAt": "2020-05-18T08:03:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMyODIzOA=="}], "type": "inlineReview"}]}