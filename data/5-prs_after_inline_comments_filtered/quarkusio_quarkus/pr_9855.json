{"pr_number": 9855, "pr_title": "Add global quarkus.tls.trust-all configuration property", "pr_createdAt": "2020-06-08T09:20:41Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9855", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjg2MTA2Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9855#discussion_r436861062", "bodyText": "I'm not sure it should be deprecated. There has to be an option for each extension to choose to differ from the global value. The example I suggested during the forum discussion: Vault is internal, OIDC server is not.\nSo I'd rename quarkus.oidc.tls.verification to quarkus.oidc.tls.trust-all (initialized by default to quarkus.tls.trust-all as per your PR) without the deprecated tag (and similarly for the other extensions). We can then update the migration guide. And docs to recommend quarkus.tls.trust-all but the users would still have an option to override it with quarkus.oidc.tls.trust-all for OIDC or quarkus.vault.tls.trust-all for Vault, etc...", "author": "sberyozkin", "createdAt": "2020-06-08T17:08:21Z", "path": "extensions/oidc/runtime/src/main/java/io/quarkus/oidc/OidcTenantConfig.java", "diffHunk": "@@ -120,31 +120,14 @@\n \n     @ConfigGroup\n     public static class Tls {\n-        public enum Verification {\n-            /**\n-             * Certificates are validated and hostname verification is enabled. This is the default value.\n-             */\n-            REQUIRED,\n-            /**\n-             * All certificated are trusted and hostname verification is disabled.\n-             */\n-            NONE\n-        }\n \n         /**\n-         * Certificate validation and hostname verification, which can be one of the following values from enum\n-         * {@link Verification}. Default is required.\n+         * Enable or disable certificate validation and hostname verification. Enable by default.\n+         * \n+         * @deprecated use quarkus.tls.trust-all instead", "originalCommit": "af35a6804e7a2ba06477b63591328feffc95cdf3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01ecba51b00531b2ad72d9a3fbe5d5cd9312dabc", "url": "https://github.com/quarkusio/quarkus/commit/01ecba51b00531b2ad72d9a3fbe5d5cd9312dabc", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-06-12T13:17:43Z", "type": "forcePushed"}, {"oid": "6066b2034efb75d1d2c0b082443dabd5a229c5d1", "url": "https://github.com/quarkusio/quarkus/commit/6066b2034efb75d1d2c0b082443dabd5a229c5d1", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-06-15T07:14:35Z", "type": "forcePushed"}, {"oid": "8d7214edc65b14f82ca1a3befaaa0c27c59f0f10", "url": "https://github.com/quarkusio/quarkus/commit/8d7214edc65b14f82ca1a3befaaa0c27c59f0f10", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-06-16T13:04:57Z", "type": "forcePushed"}, {"oid": "7575ce415e2faf68aebb254165bc103eff4677f2", "url": "https://github.com/quarkusio/quarkus/commit/7575ce415e2faf68aebb254165bc103eff4677f2", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-06-17T07:09:16Z", "type": "forcePushed"}, {"oid": "cfe3d0bed1113882d03723a6d01aadb81a8e0e0a", "url": "https://github.com/quarkusio/quarkus/commit/cfe3d0bed1113882d03723a6d01aadb81a8e0e0a", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-09-25T14:51:47Z", "type": "forcePushed"}, {"oid": "6d18886f7359996b6f6be171ff4bb6feded46c56", "url": "https://github.com/quarkusio/quarkus/commit/6d18886f7359996b6f6be171ff4bb6feded46c56", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-10-02T15:15:09Z", "type": "forcePushed"}, {"oid": "d9d8d88668b3e4b854f35a43e01fb0ee92a29baa", "url": "https://github.com/quarkusio/quarkus/commit/d9d8d88668b3e4b854f35a43e01fb0ee92a29baa", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-10-27T18:57:39Z", "type": "forcePushed"}, {"oid": "fc312a2a3d0d31c6e4009edcaaae7a1635bff1fa", "url": "https://github.com/quarkusio/quarkus/commit/fc312a2a3d0d31c6e4009edcaaae7a1635bff1fa", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-03T20:10:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxNTA3MQ==", "url": "https://github.com/quarkusio/quarkus/pull/9855#discussion_r520615071", "bodyText": "@glefloch Hi, in this specific example, should it be && ? (assuming tlsConfig.trustAll is true by default)\nIMHO, keeping the extension specific properties is OK because it can let the users be specific about the concrete extensions, but hence the extension specific setting should take the priority ?", "author": "sberyozkin", "createdAt": "2020-11-10T14:43:05Z", "path": "extensions/oidc/runtime/src/main/java/io/quarkus/oidc/runtime/OidcRecorder.java", "diffHunk": "@@ -199,7 +201,7 @@ private TenantConfigContext createTenantContext(Vertx vertx, OidcTenantConfig oi\n             options.setProxyOptions(proxyOpt.get());\n         }\n \n-        if (oidcConfig.tls.verification == Verification.NONE) {\n+        if (oidcConfig.tls.verification == Verification.NONE || tlsConfig.trustAll) {", "originalCommit": "fc312a2a3d0d31c6e4009edcaaae7a1635bff1fa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYyNjIzMg==", "url": "https://github.com/quarkusio/quarkus/pull/9855#discussion_r520626232", "bodyText": "@sberyozkin yes you are right, I'm going to update this.", "author": "glefloch", "createdAt": "2020-11-10T14:56:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxNTA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0ODM2MA==", "url": "https://github.com/quarkusio/quarkus/pull/9855#discussion_r521248360", "bodyText": "@glefloch So as you reminded tlsConfig.trustAll is false by default, then if want to prioritize on the extension specific property then if we remove the default values for oidcConfig.tls.verification (and similarly for other extensions) then it should work\nboolean trustAll = oidcConfig.tls.verification.isPresent() ? oidcConfig.tls.verification == Verification.NONE : tlsConfig.trustAll;\n\nWhat do you think ?", "author": "sberyozkin", "createdAt": "2020-11-11T10:05:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxNTA3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQyNTU5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/9855#discussion_r521425596", "bodyText": "Yes indeed, I will give it a try. That seem to be a better approach. Thanks", "author": "glefloch", "createdAt": "2020-11-11T15:11:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDYxNTA3MQ=="}], "type": "inlineReview"}, {"oid": "70e460e9971a29066b704b14cfa6574204ba718a", "url": "https://github.com/quarkusio/quarkus/commit/70e460e9971a29066b704b14cfa6574204ba718a", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-10T15:06:43Z", "type": "forcePushed"}, {"oid": "36364395696c6d5e661b80c9d89bafd2e43d9b87", "url": "https://github.com/quarkusio/quarkus/commit/36364395696c6d5e661b80c9d89bafd2e43d9b87", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-10T15:26:14Z", "type": "forcePushed"}, {"oid": "2a99722c47338c190fc91c005d3185540299f441", "url": "https://github.com/quarkusio/quarkus/commit/2a99722c47338c190fc91c005d3185540299f441", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-11T20:22:38Z", "type": "forcePushed"}, {"oid": "625fcd4a08906ea054d759dd749013ec8d766071", "url": "https://github.com/quarkusio/quarkus/commit/625fcd4a08906ea054d759dd749013ec8d766071", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-16T16:29:10Z", "type": "forcePushed"}, {"oid": "5744ce388470a1fe280e0278a854f13e81e0683a", "url": "https://github.com/quarkusio/quarkus/commit/5744ce388470a1fe280e0278a854f13e81e0683a", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-17T09:45:07Z", "type": "forcePushed"}, {"oid": "618c3fe0877de5976d9be48aa81ce9d05339806f", "url": "https://github.com/quarkusio/quarkus/commit/618c3fe0877de5976d9be48aa81ce9d05339806f", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-17T13:23:58Z", "type": "forcePushed"}, {"oid": "b4896db2a8276506964fa4d031211f63c97655d5", "url": "https://github.com/quarkusio/quarkus/commit/b4896db2a8276506964fa4d031211f63c97655d5", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-17T14:35:52Z", "type": "commit"}, {"oid": "b4896db2a8276506964fa4d031211f63c97655d5", "url": "https://github.com/quarkusio/quarkus/commit/b4896db2a8276506964fa4d031211f63c97655d5", "message": "Add global quarkus.tls.trust-all configuration property", "committedDate": "2020-11-17T14:35:52Z", "type": "forcePushed"}]}