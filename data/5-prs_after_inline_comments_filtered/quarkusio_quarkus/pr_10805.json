{"pr_number": 10805, "pr_title": "Add the ability to generate Kubernetes resources in dev mode", "pr_createdAt": "2020-07-17T10:09:28Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10805", "timeline": [{"oid": "74014f36429952c5a70d0d4b244b506fc6c17bb0", "url": "https://github.com/quarkusio/quarkus/commit/74014f36429952c5a70d0d4b244b506fc6c17bb0", "message": "Add the ability to generate Kubernetes resources in dev mode\n\nFixes: #10744", "committedDate": "2020-07-17T12:42:48Z", "type": "commit"}, {"oid": "74014f36429952c5a70d0d4b244b506fc6c17bb0", "url": "https://github.com/quarkusio/quarkus/commit/74014f36429952c5a70d0d4b244b506fc6c17bb0", "message": "Add the ability to generate Kubernetes resources in dev mode\n\nFixes: #10744", "committedDate": "2020-07-17T12:42:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODI3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10805#discussion_r458478279", "bodyText": "Why not just ask for GeneratedFileSystemResourceBuildItem when augmenting dev mode?", "author": "stuartwdouglas", "createdAt": "2020-07-22T01:20:21Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/builditem/GeneratedFileSystemResourceHandledBuildItem.java", "diffHunk": "@@ -0,0 +1,10 @@\n+package io.quarkus.deployment.builditem;\n+\n+import io.quarkus.builder.item.SimpleBuildItem;\n+\n+/**\n+ * Marker used only to ensure that the file system resources where properly written in dev-mode\n+ */\n+public final class GeneratedFileSystemResourceHandledBuildItem extends SimpleBuildItem {", "originalCommit": "74014f36429952c5a70d0d4b244b506fc6c17bb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODc4NA==", "url": "https://github.com/quarkusio/quarkus/pull/10805#discussion_r458478784", "bodyText": "I don't think you need these changes if you remove GeneratedFileSystemResourceHandledBuildItem", "author": "stuartwdouglas", "createdAt": "2020-07-22T01:22:11Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/FileSystemResourcesBuildStep.java", "diffHunk": "@@ -7,22 +7,41 @@\n import java.nio.file.Path;\n import java.util.List;\n \n+import io.quarkus.deployment.IsNormal;\n import io.quarkus.deployment.annotations.BuildProducer;\n import io.quarkus.deployment.annotations.BuildStep;\n import io.quarkus.deployment.builditem.GeneratedFileSystemResourceBuildItem;\n+import io.quarkus.deployment.builditem.GeneratedFileSystemResourceHandledBuildItem;\n+import io.quarkus.deployment.builditem.LaunchModeBuildItem;\n import io.quarkus.deployment.pkg.builditem.ArtifactResultBuildItem;\n import io.quarkus.deployment.pkg.builditem.OutputTargetBuildItem;\n+import io.quarkus.runtime.LaunchMode;\n \n public class FileSystemResourcesBuildStep {\n \n-    @BuildStep\n-    public void write(OutputTargetBuildItem outputTargetBuildItem,\n+    @BuildStep(onlyIfNot = IsNormal.class)\n+    public void notNormalMode(OutputTargetBuildItem outputTargetBuildItem,\n+            LaunchModeBuildItem launchMode,\n+            List<GeneratedFileSystemResourceBuildItem> generatedFileSystemResources,\n+            BuildProducer<GeneratedFileSystemResourceHandledBuildItem> producer) {\n+        if (launchMode.getLaunchMode() == LaunchMode.DEVELOPMENT) {", "originalCommit": "74014f36429952c5a70d0d4b244b506fc6c17bb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU4MDcyOA==", "url": "https://github.com/quarkusio/quarkus/pull/10805#discussion_r458580728", "bodyText": "That doesn't work, because then FileSystemResourcesBuildStep doesn't get the chance to do the actual writing of the resources.\nThat means that the Kubernetes Process does run and it does create the proper FileSystemResourcesBuildStep objects, but no code takes care of writing them.\nWe could move the code that writes the result outside of the build, but I don't like it that much.\nWDYT?", "author": "geoand", "createdAt": "2020-07-22T07:09:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxMTA0NA==", "url": "https://github.com/quarkusio/quarkus/pull/10805#discussion_r458611044", "bodyText": "Ah, I see why it needed now. Sorry for the noise", "author": "stuartwdouglas", "createdAt": "2020-07-22T08:05:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODYxMTc3OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10805#discussion_r458611779", "bodyText": "Np, thanks for checking :)", "author": "geoand", "createdAt": "2020-07-22T08:07:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ3ODc4NA=="}], "type": "inlineReview"}]}