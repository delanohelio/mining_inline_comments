{"pr_number": 13749, "pr_title": "Quarkus ArC integration refactoring", "pr_createdAt": "2020-12-08T10:30:56Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/13749", "timeline": [{"oid": "99be638fb2a0db6a7d56f1a773551adf837b21f1", "url": "https://github.com/quarkusio/quarkus/commit/99be638fb2a0db6a7d56f1a773551adf837b21f1", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- code refactoring", "committedDate": "2020-12-08T12:33:42Z", "type": "forcePushed"}, {"oid": "6bbbcdfa3421fece1bceaba43c61d5cb0c29d7c0", "url": "https://github.com/quarkusio/quarkus/commit/6bbbcdfa3421fece1bceaba43c61d5cb0c29d7c0", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring", "committedDate": "2020-12-08T15:22:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc2NjQ1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r538766457", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Additionaly, the bean resolver can be used to apply the type-safe resolution rules, e.g. to find out wheter there is a bean\n          \n          \n            \n             * Additionaly, the bean resolver can be used to apply the type-safe resolution rules, e.g. to find out whether there is a bean", "author": "metacosm", "createdAt": "2020-12-08T20:00:39Z", "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/SynthesisFinishedBuildItem.java", "diffHunk": "@@ -0,0 +1,21 @@\n+package io.quarkus.arc.deployment;\n+\n+import io.quarkus.arc.processor.BeanDeployment;\n+\n+/**\n+ * Consumers of this build item can easily inspect all beans, observers and injection points registered in the\n+ * application. Synthetic beans and observers are included. If interested in class-based components only you can use the\n+ * {@link BeanDiscoveryFinishedBuildItem} instead.\n+ * <p>\n+ * Additionaly, the bean resolver can be used to apply the type-safe resolution rules, e.g. to find out wheter there is a bean", "originalCommit": "6bbbcdfa3421fece1bceaba43c61d5cb0c29d7c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDI0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r538770243", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    \"It is not defined how a bean instance should be created, use ExtendedBeanConfigurator#creator(), ExtendedBeanConfigurator#supplier() or ExtendedBeanConfigurator#runtimeValue()\");\n          \n          \n            \n                                    \"No creation modality has been defined for SyntheticBean of type \" + getImplClazz() + \", use ExtendedBeanConfigurator#creator(), ExtendedBeanConfigurator#supplier() or ExtendedBeanConfigurator#runtimeValue()\");", "author": "metacosm", "createdAt": "2020-12-08T20:07:02Z", "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/SyntheticBeanBuildItem.java", "diffHunk": "@@ -65,8 +84,9 @@ public SyntheticBeanBuildItem done() {\n             if (supplier != null && runtimeValue != null) {\n                 throw new IllegalStateException(\"It is not possible to specify both - a supplier and a runtime value\");\n             }\n-            if (supplier == null && runtimeValue == null) {\n-                throw new IllegalStateException(\"Either a supplier or a runtime value must be set\");\n+            if (creatorConsumer == null && supplier == null && runtimeValue == null) {\n+                throw new IllegalStateException(\n+                        \"It is not defined how a bean instance should be created, use ExtendedBeanConfigurator#creator(), ExtendedBeanConfigurator#supplier() or ExtendedBeanConfigurator#runtimeValue()\");", "originalCommit": "6bbbcdfa3421fece1bceaba43c61d5cb0c29d7c0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTA3MzI3Nw==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r539073277", "bodyText": "With all respect, I find \"No creation modality has been defined\" really cryptic. Also the class info is not that important because the stack will contain the exact location of the failure and the extension developer should immediately fix the problem.", "author": "mkouba", "createdAt": "2020-12-09T07:37:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDI0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTExMDkzOQ==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r539110939", "bodyText": "Does it hurt to add the class info? If not, I'd add it.\nAs for No creation modality, I agree that it's not the best wording. How about:\n\n  \n    \n  \n    \n\n  \n  This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    \"It is not defined how a bean instance should be created, use ExtendedBeanConfigurator#creator(), ExtendedBeanConfigurator#supplier() or ExtendedBeanConfigurator#runtimeValue()\");\n          \n          \n            \n                                    \"SyntheticBean for type \" + getImplClazz() + \" does not provide a creation method. Use either ExtendedBeanConfigurator#creator(), ExtendedBeanConfigurator#supplier() or ExtendedBeanConfigurator#runtimeValue()\");", "author": "metacosm", "createdAt": "2020-12-09T08:40:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDI0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTEyMTA5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r539121095", "bodyText": "Does it hurt to add the class info? If not, I'd add it.\n\nIt does not hurt but it's not that relevant in the context of a synthetic bean, e.g. if you add a synthetic bean for java.lang.String it does not help much.\nI like the \"Synthetic bean does not provide a creation method...\" though!", "author": "mkouba", "createdAt": "2020-12-09T08:55:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODc3MDI0Mw=="}], "type": "inlineReview"}, {"oid": "0e083b504ea6919df6f6233e0b4554bb440837d1", "url": "https://github.com/quarkusio/quarkus/commit/0e083b504ea6919df6f6233e0b4554bb440837d1", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>", "committedDate": "2020-12-09T08:24:43Z", "type": "forcePushed"}, {"oid": "e1e91d0eaef09244195dd0c06a3c39e13a4367a6", "url": "https://github.com/quarkusio/quarkus/commit/e1e91d0eaef09244195dd0c06a3c39e13a4367a6", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>\n\nCo-authored-by: Matej Novotny <matej.novotny2@gmail.com>", "committedDate": "2020-12-09T10:11:48Z", "type": "forcePushed"}, {"oid": "6fad305a9e2bbcb1c9c59e6d77798e526725bbd4", "url": "https://github.com/quarkusio/quarkus/commit/6fad305a9e2bbcb1c9c59e6d77798e526725bbd4", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>\n\nCo-authored-by: Matej Novotny <matej.novotny2@gmail.com>", "committedDate": "2020-12-09T10:13:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMzg3OA==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r539203878", "bodyText": "So just to be extra sure, you handle that differently now?", "author": "gsmet", "createdAt": "2020-12-09T10:51:30Z", "path": "extensions/arc/deployment/src/main/java/io/quarkus/arc/deployment/ArcProcessor.java", "diffHunk": "@@ -278,9 +281,6 @@ protected DotName getDotName(BeanInfo bean) {\n                 builder.addRemovalExclusion(new BeanClassAnnotationExclusion(annotation.getName()));\n             }\n         }\n-        for (UnremovableBeanBuildItem exclusion : removalExclusions) {\n-            builder.addRemovalExclusion(exclusion.getPredicate());\n-        }", "originalCommit": "6fad305a9e2bbcb1c9c59e6d77798e526725bbd4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIxOTA0Mg==", "url": "https://github.com/quarkusio/quarkus/pull/13749#discussion_r539219042", "bodyText": "Yes, UnremovableBeanBuildItems are processed in the io.quarkus.arc.deployment.ArcProcessor.validate() phase and passed directly to the BeanProcessor. The advantage of this approach is that you can register an UnremovableBeanBuildItem based on e.g. an existing injection point.", "author": "mkouba", "createdAt": "2020-12-09T11:14:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTIwMzg3OA=="}], "type": "inlineReview"}, {"oid": "2d0a7108de4328eb9165e9ebbd6d5d89c59fa7f4", "url": "https://github.com/quarkusio/quarkus/commit/2d0a7108de4328eb9165e9ebbd6d5d89c59fa7f4", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>\nCo-authored-by: Matej Novotny <matej.novotny2@gmail.com>\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>", "committedDate": "2020-12-09T11:45:52Z", "type": "forcePushed"}, {"oid": "ecf0f62d96d1781c2ff50447c047da5b6689964e", "url": "https://github.com/quarkusio/quarkus/commit/ecf0f62d96d1781c2ff50447c047da5b6689964e", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>\nCo-authored-by: Matej Novotny <matej.novotny2@gmail.com>\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>", "committedDate": "2020-12-09T11:54:29Z", "type": "forcePushed"}, {"oid": "0cef176cb3cd7606a412d0feac29d54ba4ffeea8", "url": "https://github.com/quarkusio/quarkus/commit/0cef176cb3cd7606a412d0feac29d54ba4ffeea8", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>\nCo-authored-by: Matej Novotny <matej.novotny2@gmail.com>\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>", "committedDate": "2020-12-09T17:20:43Z", "type": "commit"}, {"oid": "0cef176cb3cd7606a412d0feac29d54ba4ffeea8", "url": "https://github.com/quarkusio/quarkus/commit/0cef176cb3cd7606a412d0feac29d54ba4ffeea8", "message": "Quarkus ArC integration refactoring\n\n- modify SyntheticBeanBuildItem so that it can be used for \"regular\" synthetic beans, i.e. no recorder proxy is needed\n- introduce BeanDiscoveryFinishedBuildItem and SynthesisFinishedBuildItem\n- introduce the \"CDI Integration Guide\" and remove the relevant parts from the reference guide\n- deprecate some build items\n- code refactoring\n\nCo-authored-by: Chris Laprun <metacosm@users.noreply.github.com>\nCo-authored-by: Matej Novotny <matej.novotny2@gmail.com>\nCo-authored-by: Guillaume Smet <guillaume.smet@gmail.com>", "committedDate": "2020-12-09T17:20:43Z", "type": "forcePushed"}]}