{"pr_number": 9237, "pr_title": "Support MongoDB JavaScript $regex pattern", "pr_createdAt": "2020-05-12T11:30:48Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9237", "timeline": [{"oid": "5332da001d0e76f4bac6a8dfd14a537a967f9bc4", "url": "https://github.com/quarkusio/quarkus/commit/5332da001d0e76f4bac6a8dfd14a537a967f9bc4", "message": "Support MongoDB JavaScript $regex pattern\n\nFixes #9219", "committedDate": "2020-05-12T09:24:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1Njk3NA==", "url": "https://github.com/quarkusio/quarkus/pull/9237#discussion_r423856974", "bodyText": "what's in position 0 here?  i would expect that to be the leading /", "author": "evanchooly", "createdAt": "2020-05-12T16:09:27Z", "path": "extensions/panache/mongodb-panache/runtime/src/main/java/io/quarkus/mongodb/panache/binder/MongoParserVisitor.java", "diffHunk": "@@ -54,7 +54,13 @@ public String visitLessThanOrEqualPredicate(HqlParser.LessThanOrEqualPredicateCo\n \n     @Override\n     public String visitLikePredicate(HqlParser.LikePredicateContext ctx) {\n-        return ctx.expression(0).accept(this) + \":{'$regex':\" + ctx.expression(1).accept(this) + \"}\";\n+        String parameter = ctx.expression(1).accept(this);\n+        if (parameter.indexOf('/') == 1 && parameter.lastIndexOf('/') > 1) {", "originalCommit": "5332da001d0e76f4bac6a8dfd14a537a967f9bc4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg5OTk4NQ==", "url": "https://github.com/quarkusio/quarkus/pull/9237#discussion_r423899985", "bodyText": "This means that my comment is not clear enought ;)\nctx.expression(1).accept(this); will calls visitParameterExpression() that will escape the parameter with single quote.\nBut if the parameter is a JavaScript patern, we need to un-escape it as the character in position.\nSo the parameter in position zero is '.\nI didn't want to add regex specific stuff inside visitParameterExpression() ... mainly because there is no easy way to know inside this method that we are in a like expression (maybe possible via ctx.getParent() ...)", "author": "loicmathieu", "createdAt": "2020-05-12T17:14:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1Njk3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTc1Mw==", "url": "https://github.com/quarkusio/quarkus/pull/9237#discussion_r423915753", "bodyText": "Ah, ok.  I wasn't sure if the single quote there was part of the incoming string or a typographical artifact to delinate a string a text.  :)", "author": "evanchooly", "createdAt": "2020-05-12T17:39:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzg1Njk3NA=="}], "type": "inlineReview"}]}