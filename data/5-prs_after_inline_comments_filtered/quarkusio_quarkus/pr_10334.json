{"pr_number": 10334, "pr_title": "Make Elytron Security extensions config overridable at runtime", "pr_createdAt": "2020-06-29T11:23:51Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10334", "timeline": [{"oid": "b40a6b663c0cd53b181bbe838747c84d1e8ac300", "url": "https://github.com/quarkusio/quarkus/commit/b40a6b663c0cd53b181bbe838747c84d1e8ac300", "message": "Separate build time and runtime configuration for Elytron Security OAuth2", "committedDate": "2020-06-29T09:37:57Z", "type": "commit"}, {"oid": "c1f25f64a88e0c64596da8f479609e1b68b7a2f5", "url": "https://github.com/quarkusio/quarkus/commit/c1f25f64a88e0c64596da8f479609e1b68b7a2f5", "message": "Separate build time and runtime configuration for Elytron Security JDBC", "committedDate": "2020-06-29T09:37:57Z", "type": "commit"}, {"oid": "3ffed5ff3fb4aaaaeb7e0999259691e67ecf2468", "url": "https://github.com/quarkusio/quarkus/commit/3ffed5ff3fb4aaaaeb7e0999259691e67ecf2468", "message": "Separate build time and runtime configuration for Elytron Security LDAP", "committedDate": "2020-06-29T09:37:57Z", "type": "commit"}, {"oid": "7b5790c9204da0566edeefa9d26ff1b2f2238bf2", "url": "https://github.com/quarkusio/quarkus/commit/7b5790c9204da0566edeefa9d26ff1b2f2238bf2", "message": "Allow anonymous bind for Elytron Security LDAP", "committedDate": "2020-06-29T09:44:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg5NjgwMg==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r446896802", "bodyText": "Perhaps also make this a build step parameter?", "author": "geoand", "createdAt": "2020-06-29T11:26:10Z", "path": "extensions/elytron-security-jdbc/deployment/src/main/java/io/quarkus/elytron/security/jdbc/deployment/ElytronSecurityJdbcProcessor.java", "diffHunk": "@@ -17,13 +17,12 @@\n import io.quarkus.elytron.security.deployment.ElytronPasswordMarkerBuildItem;\n import io.quarkus.elytron.security.deployment.SecurityRealmBuildItem;\n import io.quarkus.elytron.security.jdbc.JdbcRecorder;\n-import io.quarkus.elytron.security.jdbc.JdbcSecurityRealmConfig;\n+import io.quarkus.elytron.security.jdbc.JdbcSecurityRealmBuildTimeConfig;\n+import io.quarkus.elytron.security.jdbc.JdbcSecurityRealmRuntimeConfig;\n import io.quarkus.runtime.RuntimeValue;\n \n class ElytronSecurityJdbcProcessor {\n \n-    JdbcSecurityRealmConfig jdbc;", "originalCommit": "7b5790c9204da0566edeefa9d26ff1b2f2238bf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjkwNzY2Mw==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r446907663", "bodyText": "Stupid mistake, sorry!", "author": "geoand", "createdAt": "2020-06-29T11:46:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg5NjgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r446969974", "bodyText": "I'm not 100% sure about the implications of allowing the anonymous LDAP binds OOB. I've looked around, for example, https://www.acunetix.com/vulnerabilities/web/ldap-anonymous-binds/. I guess it should be OK in some cases, but may be we should have a boolean allow-anonymous-bind (false by default) ? This will let the empty principal/password be accepted only if the user has explicitly requested it by having allow-anonymous-bind=true ? Without it, with Optional we don't know if it is a user mistake or an intentional decision...", "author": "sberyozkin", "createdAt": "2020-06-29T13:26:51Z", "path": "extensions/elytron-security-ldap/runtime/src/main/java/io/quarkus/elytron/security/ldap/LdapRecorder.java", "diffHunk": "@@ -47,8 +47,8 @@\n     private ExceptionSupplier<DirContext, NamingException> createDirContextSupplier(DirContextConfig dirContext) {\n         DirContextFactory dirContextFactory = new QuarkusDirContextFactory(\n                 dirContext.url,\n-                dirContext.principal,\n-                dirContext.password);\n+                dirContext.principal.orElse(null),", "originalCommit": "7b5790c9204da0566edeefa9d26ff1b2f2238bf2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAwMTYwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r447001605", "bodyText": "I'm really not sure about this. I think it's OK as is tbh. If they can't log in to their LDAP directory, they will soon realize that they need to set the credentials.", "author": "gsmet", "createdAt": "2020-06-29T14:11:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzA0NDc2MA==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r447044760", "bodyText": "Anonymous binds enabled in LDAP servers are usually seen as a security flaw, but having a flag to allow it seems to be too much work compared to just not providing the credentials, so I'm torn on this one too :)\nI think we should at the very least put something in the logs.", "author": "gastaldi", "createdAt": "2020-06-29T15:09:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzEwNzUwMQ==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r447107501", "bodyText": "Hi @gsmet @gastaldi yeah, I agree, it does feel like it is one more extra step; my concern would be that say the next day after the release someone files the vulnerability request along these lines \"Quarkus activates the anonymous LDAP binds by default\" with some description why it would be a risk :-). As it stands right now, the user who has to get it bound to the secured LDAP has to do some real work (set the principal and password, 2 props), while the user who is OK with the anonymous one just does nothing, so may be it is not that much work to set this property...So at least in the hypothetical scenario (which a good number of CVEs operate in), we have a Quarkus doing an anonymous bind to the LDAP which has been misconfigured to allow such binds. I think I'm getting paranoid, sorry :-)", "author": "sberyozkin", "createdAt": "2020-06-29T16:41:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzExMjE2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r447112165", "bodyText": "@gsmet @gastaldi If it is not convincing, then go ahead please, I'd not like my theoretical musings stop the enhancement going ahead :-). Would also be good for @stuartwdouglas to check as well but he is offline right now", "author": "sberyozkin", "createdAt": "2020-06-29T16:49:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzExNzA4MQ==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r447117081", "bodyText": "@sberyozkin that makes sense, but isn't up to the LDAP server to decide if anonymous bindings are allowed?", "author": "gastaldi", "createdAt": "2020-06-29T16:57:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI4NzAyOA==", "url": "https://github.com/quarkusio/quarkus/pull/10334#discussion_r447287028", "bodyText": "@gastaldi yes, makes sense", "author": "sberyozkin", "createdAt": "2020-06-29T22:15:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njk2OTk3NA=="}], "type": "inlineReview"}]}