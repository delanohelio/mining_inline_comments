{"pr_number": 7831, "pr_title": "Generate entities in correct class loader", "pr_createdAt": "2020-03-12T23:14:28Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7831", "timeline": [{"oid": "c434a077e685d048f77106fa8c38092cd018e385", "url": "https://github.com/quarkusio/quarkus/commit/c434a077e685d048f77106fa8c38092cd018e385", "message": "Generate entities in correct class loader\n\nFixes #7433", "committedDate": "2020-03-12T23:13:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk1NzczNw==", "url": "https://github.com/quarkusio/quarkus/pull/7831#discussion_r391957737", "bodyText": "We are enhancing application classes and I don't understand why the enhanced classes should not be considered application classes?", "author": "gsmet", "createdAt": "2020-03-12T23:30:35Z", "path": "extensions/hibernate-orm/deployment/src/main/java/io/quarkus/hibernate/orm/deployment/HibernateOrmProcessor.java", "diffHunk": "@@ -760,7 +760,7 @@ private void enhanceEntities(final JpaEntitiesBuildItem domainObjects,\n             try {\n                 byte[] bytes = IoUtil.readClassAsBytes(HibernateOrmProcessor.class.getClassLoader(), className);\n                 byte[] enhanced = hibernateEntityEnhancer.enhance(className, bytes);\n-                additionalClasses.produce(new GeneratedClassBuildItem(true, className, enhanced != null ? enhanced : bytes));\n+                additionalClasses.produce(new GeneratedClassBuildItem(false, className, enhanced != null ? enhanced : bytes));", "originalCommit": "c434a077e685d048f77106fa8c38092cd018e385", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk2MTE5MA==", "url": "https://github.com/quarkusio/quarkus/pull/7831#discussion_r391961190", "bodyText": "These are AdditionalJpaModelBuildItem classes, that are for entities defined in extensions. If we generate them in the application class loader then you end up with two copies, one in the runtime class loader and the original unmodified one in the base runtime class loader. Normally this is ok, unless a class in the base runtime CL attempts to use the entity, in which case you get problems.", "author": "stuartwdouglas", "createdAt": "2020-03-12T23:43:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk1NzczNw=="}], "type": "inlineReview"}]}