{"pr_number": 12147, "pr_title": "Generate an \"All Build Items\" documentation page", "pr_createdAt": "2020-09-16T18:15:53Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/12147", "timeline": [{"oid": "d30c121757d8524a3d5eee6ed2dfcb956a094853", "url": "https://github.com/quarkusio/quarkus/commit/d30c121757d8524a3d5eee6ed2dfcb956a094853", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\nfind extensions -name \"*BuildItem.java\" | jbang builditemdoc@quarkusio > docs/src/main/asciidoc/build-items.adoc\n```\n\nFixes #9945", "committedDate": "2020-09-16T19:18:18Z", "type": "forcePushed"}, {"oid": "770bf4bdce4c3fd60f2f16b3d46ab09f7c1716b3", "url": "https://github.com/quarkusio/quarkus/commit/770bf4bdce4c3fd60f2f16b3d46ab09f7c1716b3", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\nfind core/deployment core/test-extension extensions -name \"*BuildItem.java\" | jbang builditemdoc@quarkusio > docs/src/main/asciidoc/build-items.adoc\n```\n\nFixes #9945", "committedDate": "2020-09-16T20:39:15Z", "type": "forcePushed"}, {"oid": "03dad652e7af11081ccee7831f38da38368ed87a", "url": "https://github.com/quarkusio/quarkus/commit/03dad652e7af11081ccee7831f38da38368ed87a", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\nfind core/deployment core/test-extension extensions -name \"*BuildItem.java\" | jbang .github/quarkusbuilditemdoc.java > docs/src/main/asciidoc/build-items.adoc\n```\n\nFixes #9945", "committedDate": "2020-09-17T00:22:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyMzQzMg==", "url": "https://github.com/quarkusio/quarkus/pull/12147#discussion_r490923432", "bodyText": "Does this only list public classes ?\nIf a build item is not public, it's not designed to be used outside the extension", "author": "loicmathieu", "createdAt": "2020-09-18T12:45:21Z", "path": ".github/quarkusbuilditemdoc.java", "diffHunk": "@@ -0,0 +1,167 @@\n+//usr/bin/env jbang \"$0\" \"$@\" ; exit $?\n+//DEPS info.picocli:picocli:4.5.0\n+//DEPS org.jboss.forge.roaster:roaster-jdt:2.22.2.Final\n+//DEPS org.eclipse.collections:eclipse-collections:10.4.0\n+//DEPS org.yaml:snakeyaml:1.27\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Map;\n+import java.util.TreeMap;\n+import java.util.concurrent.Callable;\n+\n+import org.eclipse.collections.api.multimap.Multimap;\n+import org.eclipse.collections.api.multimap.MutableMultimap;\n+import org.eclipse.collections.api.tuple.Pair;\n+import org.eclipse.collections.impl.factory.Multimaps;\n+import org.eclipse.collections.impl.tuple.Tuples;\n+import org.jboss.forge.roaster.Roaster;\n+import org.jboss.forge.roaster.model.source.JavaClassSource;\n+import org.yaml.snakeyaml.Yaml;\n+import picocli.CommandLine;\n+import picocli.CommandLine.Command;\n+\n+@Command(name = \"builditemdoc\", mixinStandardHelpOptions = true, version = \"builditemdoc 0.1\",\n+        description = \"builditemdoc made with jbang\")\n+class quarkusbuilditemdoc implements Callable<Integer> {\n+\n+    public static void main(String... args) {\n+        int exitCode = new CommandLine(new quarkusbuilditemdoc()).execute(args);\n+        System.exit(exitCode);\n+    }\n+\n+    // find extensions -name \"*BuildItem.java\" | jbang ~/workspace/quarkus-jbang-catalog/builditemdoc.java > docs/src/main/asciidoc/build-items.adoc\n+    @Override\n+    public Integer call() throws Exception {\n+        final Multimap<String, Pair<Path, JavaClassSource>> multimap = collect();\n+        Map<String, String> names = extractNames(Paths.get(\".\"), multimap.keySet());\n+        printDocumentHeader();\n+        names.forEach((key, name) -> {\n+            printTableHeader(name);\n+            for (Pair<Path, JavaClassSource> source : multimap.get(key)) {\n+                printTableRow(source);\n+            }\n+            printTableFooter();\n+        });\n+        return 0;\n+    }\n+\n+    private String buildDescriptionFromJavaDoc(JavaClassSource source) {\n+        if (!source.hasJavaDoc()) {\n+            return \"<i>No Javadoc found</i>\";\n+        }\n+        return source.getJavaDoc().getText();\n+    }\n+\n+    private Multimap<String, Pair<Path, JavaClassSource>> collect() throws IOException {\n+        MutableMultimap<String, Pair<Path, JavaClassSource>> multimap = Multimaps.mutable.list.empty();\n+        String line;\n+        try (BufferedReader br = new BufferedReader(new InputStreamReader(System.in))) {\n+            while ((line = br.readLine()) != null) {\n+                Path path = Paths.get(line);\n+                JavaClassSource source = Roaster.parse(JavaClassSource.class, path.toFile());", "originalCommit": "03dad652e7af11081ccee7831f38da38368ed87a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkyNDU1MQ==", "url": "https://github.com/quarkusio/quarkus/pull/12147#discussion_r490924551", "bodyText": "I think we need to provide inside Quarkus core an annotation to be able to restrict a BuildItem to be listed here, like @NotDocumented or @NotExposed or @Private.\nSome build items are designed to be used inside the extension only, and they cannot be made package private always so we need a finer way to control the inclusion in the page.", "author": "loicmathieu", "createdAt": "2020-09-18T12:47:18Z", "path": ".github/quarkusbuilditemdoc.java", "diffHunk": "@@ -0,0 +1,167 @@\n+//usr/bin/env jbang \"$0\" \"$@\" ; exit $?\n+//DEPS info.picocli:picocli:4.5.0\n+//DEPS org.jboss.forge.roaster:roaster-jdt:2.22.2.Final\n+//DEPS org.eclipse.collections:eclipse-collections:10.4.0\n+//DEPS org.yaml:snakeyaml:1.27\n+\n+import java.io.BufferedReader;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.InputStreamReader;\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.nio.file.Paths;\n+import java.util.Map;\n+import java.util.TreeMap;\n+import java.util.concurrent.Callable;\n+\n+import org.eclipse.collections.api.multimap.Multimap;\n+import org.eclipse.collections.api.multimap.MutableMultimap;\n+import org.eclipse.collections.api.tuple.Pair;\n+import org.eclipse.collections.impl.factory.Multimaps;\n+import org.eclipse.collections.impl.tuple.Tuples;\n+import org.jboss.forge.roaster.Roaster;\n+import org.jboss.forge.roaster.model.source.JavaClassSource;\n+import org.yaml.snakeyaml.Yaml;\n+import picocli.CommandLine;\n+import picocli.CommandLine.Command;\n+\n+@Command(name = \"builditemdoc\", mixinStandardHelpOptions = true, version = \"builditemdoc 0.1\",\n+        description = \"builditemdoc made with jbang\")\n+class quarkusbuilditemdoc implements Callable<Integer> {\n+\n+    public static void main(String... args) {\n+        int exitCode = new CommandLine(new quarkusbuilditemdoc()).execute(args);\n+        System.exit(exitCode);\n+    }\n+\n+    // find extensions -name \"*BuildItem.java\" | jbang ~/workspace/quarkus-jbang-catalog/builditemdoc.java > docs/src/main/asciidoc/build-items.adoc\n+    @Override\n+    public Integer call() throws Exception {\n+        final Multimap<String, Pair<Path, JavaClassSource>> multimap = collect();\n+        Map<String, String> names = extractNames(Paths.get(\".\"), multimap.keySet());\n+        printDocumentHeader();\n+        names.forEach((key, name) -> {\n+            printTableHeader(name);\n+            for (Pair<Path, JavaClassSource> source : multimap.get(key)) {\n+                printTableRow(source);\n+            }\n+            printTableFooter();\n+        });\n+        return 0;\n+    }\n+\n+    private String buildDescriptionFromJavaDoc(JavaClassSource source) {\n+        if (!source.hasJavaDoc()) {\n+            return \"<i>No Javadoc found</i>\";\n+        }\n+        return source.getJavaDoc().getText();\n+    }\n+\n+    private Multimap<String, Pair<Path, JavaClassSource>> collect() throws IOException {\n+        MutableMultimap<String, Pair<Path, JavaClassSource>> multimap = Multimaps.mutable.list.empty();\n+        String line;\n+        try (BufferedReader br = new BufferedReader(new InputStreamReader(System.in))) {\n+            while ((line = br.readLine()) != null) {\n+                Path path = Paths.get(line);\n+                JavaClassSource source = Roaster.parse(JavaClassSource.class, path.toFile());\n+                // Ignore deprecated annotations\n+                if (!source.hasAnnotation(Deprecated.class)) {", "originalCommit": "03dad652e7af11081ccee7831f38da38368ed87a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fad9045bf662c4b5396da371b398afad0f90140b", "url": "https://github.com/quarkusio/quarkus/commit/fad9045bf662c4b5396da371b398afad0f90140b", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\nfind core/deployment core/test-extension extensions -name \"*BuildItem.java\" | jbang .github/quarkusbuilditemdoc.java > docs/src/main/asciidoc/build-items.adoc\n```\n\nFixes #9945", "committedDate": "2020-09-18T14:49:47Z", "type": "forcePushed"}, {"oid": "3e5e591b7a209516c45b9f19ffba53694f168be9", "url": "https://github.com/quarkusio/quarkus/commit/3e5e591b7a209516c45b9f19ffba53694f168be9", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\nfind core/deployment core/test-extension extensions -name \"*BuildItem.java\" | jbang .github/quarkusbuilditemdoc.java > docs/src/main/asciidoc/build-items.adoc\n```\n\nFixes #9945", "committedDate": "2020-09-18T15:48:20Z", "type": "forcePushed"}, {"oid": "d47956c2ff6c6c139578addbefe9aa7571c3cc16", "url": "https://github.com/quarkusio/quarkus/commit/d47956c2ff6c6c139578addbefe9aa7571c3cc16", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\nfind core/deployment core/test-extension extensions -name \"*BuildItem.java\" | jbang .github/quarkusbuilditemdoc.java > docs/src/main/asciidoc/build-items.adoc\n```\n\nFixes #9945", "committedDate": "2020-09-18T15:55:09Z", "type": "forcePushed"}, {"oid": "c0fd4cf19a1ff278b3d03abf48b272161f6ec068", "url": "https://github.com/quarkusio/quarkus/commit/c0fd4cf19a1ff278b3d03abf48b272161f6ec068", "message": "Fixed minor javadoc bug", "committedDate": "2020-09-21T14:14:57Z", "type": "commit"}, {"oid": "3b8e5f38e5a403b6f07c517adbeec0d93e769fab", "url": "https://github.com/quarkusio/quarkus/commit/3b8e5f38e5a403b6f07c517adbeec0d93e769fab", "message": "chmod -x writing-extensions.adoc gcp-functions.adoc", "committedDate": "2020-09-21T14:14:58Z", "type": "commit"}, {"oid": "8abf44e9421cf545898ff1c801d9400ae316e1be", "url": "https://github.com/quarkusio/quarkus/commit/8abf44e9421cf545898ff1c801d9400ae316e1be", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile docs/src/main/asciidoc/build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T14:14:58Z", "type": "forcePushed"}, {"oid": "fbde685599074b8a01d62c5bebd3e6529b4b52f6", "url": "https://github.com/quarkusio/quarkus/commit/fbde685599074b8a01d62c5bebd3e6529b4b52f6", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile docs/src/main/asciidoc/build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T14:52:22Z", "type": "forcePushed"}, {"oid": "df42d1546ee93098824aac6b84420d3cda82a715", "url": "https://github.com/quarkusio/quarkus/commit/df42d1546ee93098824aac6b84420d3cda82a715", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile docs/src/main/asciidoc/build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T14:58:56Z", "type": "forcePushed"}, {"oid": "7dbd5b8f037756162936062a9f8860d717d51709", "url": "https://github.com/quarkusio/quarkus/commit/7dbd5b8f037756162936062a9f8860d717d51709", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile docs/src/main/asciidoc/build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T15:01:27Z", "type": "forcePushed"}, {"oid": "d58e30d42d8337835307da111f6f4e0f697de32e", "url": "https://github.com/quarkusio/quarkus/commit/d58e30d42d8337835307da111f6f4e0f697de32e", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile target/asciidoc/generated/config/quarkus-all-build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T15:28:26Z", "type": "forcePushed"}, {"oid": "26ab81f9adf500671cb91565b8c8917a5a243bf0", "url": "https://github.com/quarkusio/quarkus/commit/26ab81f9adf500671cb91565b8c8917a5a243bf0", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile target/asciidoc/generated/config/quarkus-all-build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T18:00:19Z", "type": "forcePushed"}, {"oid": "8d6205fcdcf63bff16cdc9f85a7f8afb325224d7", "url": "https://github.com/quarkusio/quarkus/commit/8d6205fcdcf63bff16cdc9f85a7f8afb325224d7", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile target/asciidoc/generated/config/quarkus-all-build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T19:28:00Z", "type": "forcePushed"}, {"oid": "c9e2c76792d1cb64b4d81bb8379fe2f0e1ce1901", "url": "https://github.com/quarkusio/quarkus/commit/c9e2c76792d1cb64b4d81bb8379fe2f0e1ce1901", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile target/asciidoc/generated/config/quarkus-all-build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T19:50:05Z", "type": "commit"}, {"oid": "c9e2c76792d1cb64b4d81bb8379fe2f0e1ce1901", "url": "https://github.com/quarkusio/quarkus/commit/c9e2c76792d1cb64b4d81bb8379fe2f0e1ce1901", "message": "Add build-items.adoc\n\nThis file is generated by running the following command in the root:\n\n```bash\njbang .github/quarkusbuilditemdoc.java --outputFile target/asciidoc/generated/config/quarkus-all-build-items.adoc --dirs core/deployment core/test-extension extensions\n```\n\nFixes #9945", "committedDate": "2020-09-21T19:50:05Z", "type": "forcePushed"}]}