{"pr_number": 7147, "pr_title": "MongoDB with Panache multi-update", "pr_createdAt": "2020-02-11T17:04:49Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7147", "timeline": [{"oid": "80742a767581acb3e6ff587ba9c46a72c7657a39", "url": "https://github.com/quarkusio/quarkus/commit/80742a767581acb3e6ff587ba9c46a72c7657a39", "message": "MongoDB with Panache multi-update\n\nFixes 5924", "committedDate": "2020-02-14T15:21:14Z", "type": "forcePushed"}, {"oid": "8f417431dc04295e267ea2e5b6bad29005e7b216", "url": "https://github.com/quarkusio/quarkus/commit/8f417431dc04295e267ea2e5b6bad29005e7b216", "message": "MongoDB with Panache multi-update\n\nFixes 5924", "committedDate": "2020-02-17T10:06:06Z", "type": "forcePushed"}, {"oid": "809ad9b6c37fa93ca2a0a35394670fcbc54c6137", "url": "https://github.com/quarkusio/quarkus/commit/809ad9b6c37fa93ca2a0a35394670fcbc54c6137", "message": "MongoDB with Panache multi-update\n\nFixes 5924", "committedDate": "2020-02-26T16:46:22Z", "type": "forcePushed"}, {"oid": "5f725128b8f9aaee6ed15c511d7f1e36dd823e4c", "url": "https://github.com/quarkusio/quarkus/commit/5f725128b8f9aaee6ed15c511d7f1e36dd823e4c", "message": "MongoDB with Panache multi-update\n\nFixes 5924", "committedDate": "2020-02-27T09:48:50Z", "type": "forcePushed"}, {"oid": "4605eb6a87468b713de8bad6c1bf2064db3941f5", "url": "https://github.com/quarkusio/quarkus/commit/4605eb6a87468b713de8bad6c1bf2064db3941f5", "message": "MongoDB with Panache multi-update\n\nFixes 5924", "committedDate": "2020-03-09T11:34:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY2NDg1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r389664857", "bodyText": "I'm not sure what the mandatory here means. It should be removed.", "author": "FroMage", "createdAt": "2020-03-09T13:29:48Z", "path": "extensions/panache/mongodb-panache/runtime/src/main/java/io/quarkus/mongodb/panache/PanacheMongoEntityBase.java", "diffHunk": "@@ -864,6 +864,49 @@ public static void persistOrUpdate(Object firstEntity, Object... entities) {\n         MongoOperations.persistOrUpdate(firstEntity, entities);\n     }\n \n+    /**\n+     * Update all entities of this type matching the given query, with mandatory indexed parameters.", "originalCommit": "4605eb6a87468b713de8bad6c1bf2064db3941f5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY2NTcwNA==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r389665704", "bodyText": "Below (for repository) it's optional\u2026", "author": "FroMage", "createdAt": "2020-03-09T13:30:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY2NDg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTcwNjM3NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r389706375", "bodyText": "It's copied from the JavaDoc of Hibernate with Panache where mandatory is used. I think it's wrong as we should be able to use it without any parameters : Person.update(\"set person.status = 'Dead' where person.status='Alive');\nI check the code of the Hibernate with Panache implementation and no parameters are allowed at code level, I'll update the documentation with optional here also.", "author": "loicmathieu", "createdAt": "2020-03-09T14:06:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY2NDg1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTcxMjAxMQ==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r389712011", "bodyText": "Yeah, I've no idea how this could have slipped through. Thanks for fixing it there too.", "author": "FroMage", "createdAt": "2020-03-09T14:10:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTY2NDg1Nw=="}], "type": "inlineReview"}, {"oid": "fbd38da2a026840a59b3033756adce2856c09e1d", "url": "https://github.com/quarkusio/quarkus/commit/fbd38da2a026840a59b3033756adce2856c09e1d", "message": "Fix Hibernate with Panache update documentation", "committedDate": "2020-03-09T14:32:04Z", "type": "forcePushed"}, {"oid": "3bf8c101f77e3621e99f11b990d62c22ad03599d", "url": "https://github.com/quarkusio/quarkus/commit/3bf8c101f77e3621e99f11b990d62c22ad03599d", "message": "fix: multi-update", "committedDate": "2020-03-13T11:07:09Z", "type": "forcePushed"}, {"oid": "3cceb4a1f6086adbcc432a91703039fead7144ca", "url": "https://github.com/quarkusio/quarkus/commit/3cceb4a1f6086adbcc432a91703039fead7144ca", "message": "fix: multi-update", "committedDate": "2020-03-13T11:09:21Z", "type": "forcePushed"}, {"oid": "f61f683d365bb3452df423f61c3899a028985825", "url": "https://github.com/quarkusio/quarkus/commit/f61f683d365bb3452df423f61c3899a028985825", "message": "fix: multi-update", "committedDate": "2020-03-13T11:11:08Z", "type": "forcePushed"}, {"oid": "defef83511bfe25bb5e14f6687a3838350bc1b0e", "url": "https://github.com/quarkusio/quarkus/commit/defef83511bfe25bb5e14f6687a3838350bc1b0e", "message": "fix: multi-update", "committedDate": "2020-03-13T11:15:24Z", "type": "forcePushed"}, {"oid": "35b1b1b5de14d6526076b987306066091031adfa", "url": "https://github.com/quarkusio/quarkus/commit/35b1b1b5de14d6526076b987306066091031adfa", "message": "fix: multi-update", "committedDate": "2020-03-13T11:22:56Z", "type": "forcePushed"}, {"oid": "2588a29c19edeb7a658bdbfdbb9d565c8f3e326d", "url": "https://github.com/quarkusio/quarkus/commit/2588a29c19edeb7a658bdbfdbb9d565c8f3e326d", "message": "Fix Hibernate with Panache update documentation", "committedDate": "2020-03-23T11:46:58Z", "type": "forcePushed"}, {"oid": "ac38f3d025eaeec68519b86c1f3c949eab19058c", "url": "https://github.com/quarkusio/quarkus/commit/ac38f3d025eaeec68519b86c1f3c949eab19058c", "message": "Fix Hibernate with Panache update documentation", "committedDate": "2020-03-30T11:08:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NjkxNw==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r400146917", "bodyText": "It's not really a document here, is it?", "author": "FroMage", "createdAt": "2020-03-30T12:20:37Z", "path": "extensions/panache/mongodb-panache/runtime/src/main/java/io/quarkus/mongodb/panache/PanacheMongoEntityBase.java", "diffHunk": "@@ -875,6 +875,55 @@ public static void persistOrUpdate(Object firstEntity, Object... entities) {\n         MongoOperations.persistOrUpdate(firstEntity, entities);\n     }\n \n+    /**\n+     * Update all entities of this type by the given update document, with optional indexed parameters.", "originalCommit": "ac38f3d025eaeec68519b86c1f3c949eab19058c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE1MDU5Mg==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r400150592", "bodyText": "Also, I read the whole PR and I'm not sure what syntax is allowed in the update param besides the mongo native query. It says this is a query string, but it's not, is it?\nCan I do foo = :name, bar = :lastname or gee = 2?", "author": "FroMage", "createdAt": "2020-03-30T12:26:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NjkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY5Mjc5Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r400692797", "bodyText": "Yes, you can do it.\nIn reality, everything is a document in MongoDB, so there is no difference between what we called a query (MongoDB called it a filter document) and a stored document.\nSo you can use PanacheQL to express the update document, all the following are working update document:\nFooBar.update(\"foo = :name and bar = :lastname\", parameters).all()\nFooBar.update(\"foo = :name, bar = :lastname\", parameters).all()\nFooBar.update(\"foo = ?1 and bar = ?2\", name, lastname).all()\nFooBar.update(\"foo = ?1, bar = ?2\", name, lastname).all()\nFooBar.update(\"{'foo' : :name, 'bar' : :lastname}\", parameters).all()\nFooBar.update(\"{'foo' : ?1, 'bar' : ?2}\", name, lastname).all()\nFooBar.update(\"foo\", name).all()", "author": "loicmathieu", "createdAt": "2020-03-31T07:19:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NjkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcwODk2NQ==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r400708965", "bodyText": "I added some sentence on the guide to document this inside the 'Simplified query' section.", "author": "loicmathieu", "createdAt": "2020-03-31T07:49:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NjkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NzEyNw==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r400147127", "bodyText": "This talks about a query.", "author": "FroMage", "createdAt": "2020-03-30T12:21:00Z", "path": "extensions/panache/mongodb-panache/runtime/src/main/java/io/quarkus/mongodb/panache/PanacheMongoEntityBase.java", "diffHunk": "@@ -875,6 +875,55 @@ public static void persistOrUpdate(Object firstEntity, Object... entities) {\n         MongoOperations.persistOrUpdate(firstEntity, entities);\n     }\n \n+    /**\n+     * Update all entities of this type by the given update document, with optional indexed parameters.\n+     * The returned {@link PanacheUpdate} object will allow to restrict on which document the update should be applied.\n+     *\n+     * @param update the update document, if it didn't contain <code>$set</code> we add it.\n+     *        It can also be expressed as a {@link io.quarkus.mongodb.panache query string}.\n+     * @param params optional sequence of indexed parameters\n+     * @return a new {@link PanacheUpdate} instance for the given update query\n+     * @see #update(String, Map)\n+     * @see #update(String, Parameters)\n+     */\n+    @GenerateBridge\n+    public static PanacheUpdate update(String update, Object... params) {\n+        throw MongoOperations.implementationInjectionMissing();\n+    }\n+\n+    /**\n+     * Update all entities of this type matching the given query, with named parameters.", "originalCommit": "ac38f3d025eaeec68519b86c1f3c949eab19058c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcwOTIyNQ==", "url": "https://github.com/quarkusio/quarkus/pull/7147#discussion_r400709225", "bodyText": "I fixed the javadoc in all places.", "author": "loicmathieu", "createdAt": "2020-03-31T07:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NzEyNw=="}], "type": "inlineReview"}, {"oid": "2b45b9075bb72362171b515d8eef867ee929cd45", "url": "https://github.com/quarkusio/quarkus/commit/2b45b9075bb72362171b515d8eef867ee929cd45", "message": "Fix Hibernate with Panache update documentation", "committedDate": "2020-03-31T07:47:53Z", "type": "forcePushed"}, {"oid": "85c207405a36a1d1b9b7ed4e69dda08c254b3912", "url": "https://github.com/quarkusio/quarkus/commit/85c207405a36a1d1b9b7ed4e69dda08c254b3912", "message": "MongoDB with Panache multi-update\n\nFixes #5924", "committedDate": "2020-03-31T10:05:49Z", "type": "commit"}, {"oid": "ce3d644fe84ec045e867b5df88bc61411cdad16a", "url": "https://github.com/quarkusio/quarkus/commit/ce3d644fe84ec045e867b5df88bc61411cdad16a", "message": "Fix Hibernate with Panache update documentation", "committedDate": "2020-03-31T10:05:49Z", "type": "commit"}, {"oid": "ce3d644fe84ec045e867b5df88bc61411cdad16a", "url": "https://github.com/quarkusio/quarkus/commit/ce3d644fe84ec045e867b5df88bc61411cdad16a", "message": "Fix Hibernate with Panache update documentation", "committedDate": "2020-03-31T10:05:49Z", "type": "forcePushed"}]}