{"pr_number": 9484, "pr_title": "Escaping JSON strings in QuarkusErrorServlet", "pr_createdAt": "2020-05-20T08:53:56Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/9484", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMTY2Mg==", "url": "https://github.com/quarkusio/quarkus/pull/9484#discussion_r428001662", "bodyText": "I think it is escaped later in TemplateHtmlBuilder so we don't need to escape it here. Am I right?", "author": "gsmet", "createdAt": "2020-05-20T13:17:40Z", "path": "extensions/undertow/runtime/src/main/java/io/quarkus/undertow/runtime/QuarkusErrorServlet.java", "diffHunk": "@@ -40,15 +40,17 @@ protected void service(HttpServletRequest req, HttpServletResponse resp) throws\n         if (accept != null && accept.contains(\"application/json\")) {\n             resp.setContentType(\"application/json\");\n             resp.setCharacterEncoding(StandardCharsets.UTF_8.name());\n-            String escapedStack = stack.replace(System.lineSeparator(), \"\\\\n\").replace(\"\\\"\", \"\\\\\\\"\");\n-            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(details).append(\"\\\",\\\"stack\\\":\\\"\")\n-                    .append(escapedStack).append(\"\\\"}\");\n+            String escapedDetails = escapeJsonString(details);\n+            String escapedStack = escapeJsonString(stack);\n+            StringBuilder jsonPayload = new StringBuilder(\"{\\\"details\\\":\\\"\").append(escapedDetails)\n+                    .append(\"\\\",\\\"stack\\\":\\\"\").append(escapedStack).append(\"\\\"}\");\n             resp.getWriter().write(jsonPayload.toString());\n         } else {\n             //We default to HTML representation\n+            String escapedDetails = escapeHtml(details);", "originalCommit": "c56855997c1b4ddf33ddb4c5a30b59f34073f013", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODMwNDM1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/9484#discussion_r428304357", "bodyText": "Yes, it is also escaped in the TemplateHtmlBuilder directly in the used constructor. I just removed the escaping from QuarkusErrorServlet.", "author": "lodrantl", "createdAt": "2020-05-20T21:00:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODAwMTY2Mg=="}], "type": "inlineReview"}, {"oid": "bb688f883334f061685bce66582e0aeb19f7ecfa", "url": "https://github.com/quarkusio/quarkus/commit/bb688f883334f061685bce66582e0aeb19f7ecfa", "message": "Proper escaping of JSON strings in ErrorServlet", "committedDate": "2020-05-21T08:37:11Z", "type": "commit"}, {"oid": "a7a91cd450618a7a11d071688d9759da9230c1c1", "url": "https://github.com/quarkusio/quarkus/commit/a7a91cd450618a7a11d071688d9759da9230c1c1", "message": "Don't escapeHTML when using JSON", "committedDate": "2020-05-21T08:37:11Z", "type": "commit"}, {"oid": "28e3587c910bec520c40d6d0b5359215e58fee40", "url": "https://github.com/quarkusio/quarkus/commit/28e3587c910bec520c40d6d0b5359215e58fee40", "message": "Removed the double HTML escaping.", "committedDate": "2020-05-21T08:37:11Z", "type": "commit"}, {"oid": "28e3587c910bec520c40d6d0b5359215e58fee40", "url": "https://github.com/quarkusio/quarkus/commit/28e3587c910bec520c40d6d0b5359215e58fee40", "message": "Removed the double HTML escaping.", "committedDate": "2020-05-21T08:37:11Z", "type": "forcePushed"}]}