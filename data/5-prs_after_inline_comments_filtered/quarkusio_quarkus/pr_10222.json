{"pr_number": 10222, "pr_title": "Error messages when jdbc.url has not been defined", "pr_createdAt": "2020-06-24T14:21:38Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/10222", "timeline": [{"oid": "5613c059158474caef0d1b2016d2decb64f9ea8e", "url": "https://github.com/quarkusio/quarkus/commit/5613c059158474caef0d1b2016d2decb64f9ea8e", "message": "Log error messages when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T14:23:54Z", "type": "forcePushed"}, {"oid": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "url": "https://github.com/quarkusio/quarkus/commit/163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T16:19:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDU0Nw==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445024547", "bodyText": "isn't it quarkus.datasource.<name>.jdbc.url?", "author": "gsmet", "createdAt": "2020-06-24T16:34:48Z", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";", "originalCommit": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNTg5NQ==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445035895", "bodyText": "fixed", "author": "ejba", "createdAt": "2020-06-24T16:53:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDcwMg==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445024702", "bodyText": "Please avoid reformatting this.", "author": "gsmet", "createdAt": "2020-06-24T16:35:04Z", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -202,7 +236,8 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         // Explicit reference to bypass reflection need of the ServiceLoader used by AgroalDataSource#from\n         AgroalDataSourceConfiguration agroalConfiguration = dataSourceConfiguration.get();\n         AgroalDataSource dataSource = new io.agroal.pool.DataSource(agroalConfiguration,\n-                new AgroalEventLoggingListener(dataSourceName));\n+                new AgroalEventLoggingListener(\n+                        dataSourceName));", "originalCommit": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzMTk2Nw==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445031967", "bodyText": "Fighting against the IDE, sure I will!", "author": "ejba", "createdAt": "2020-06-24T16:46:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTAzOA==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445025038", "bodyText": "I would avoid the backticks in log messages.", "author": "gsmet", "createdAt": "2020-06-24T16:35:38Z", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName\n+                            + \".url` is deprecated and will be removed in a future version - it is \" +\n+                            \"recommended to switch to `quarkus.datasource.\" + dataSourceName\n+                            + \".jdbc.url`. See https://quarkus.io/guides/datasource\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n+            }\n+\n             if (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.jdbc.\" + dataSourceName + \".url` has not been defined\";\n+                }\n+                throw new ConfigurationException(errorMessage);\n             }\n         } else {\n             if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n-                throw new ConfigurationException(\"URL is not defined for datasource \" + dataSourceName);\n+                String errorMessage;\n+                if (DataSourceUtil.isDefault(dataSourceName)) {\n+                    errorMessage = \"`quarkus.datasource.url` has not been defined\";\n+                } else {\n+                    errorMessage = \"`quarkus.datasource.\" + dataSourceName + \".url` has not been defined\";", "originalCommit": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNjAwNQ==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445036005", "bodyText": "fixed", "author": "ejba", "createdAt": "2020-06-24T16:53:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTAzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTMwNw==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445025307", "bodyText": "I would get rid of these constants, there's no value for them IMHO.", "author": "gsmet", "createdAt": "2020-06-24T16:36:04Z", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -64,6 +64,14 @@\n public class DataSources {\n \n     private static final Logger log = Logger.getLogger(DataSources.class.getName());\n+    public static final String DEPRECATED_URL_PROPERTY_NAME_ERROR_MESSAGE_FORMAT = \"`quarkus.datasource.%s.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.%s.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DEPRECATED_URL_PROPERTY_ERROR_MESSAGE = \"`quarkus.datasource.url` is deprecated and will be removed in a future version - it is \"\n+            +\n+            \"recommended to switch to `quarkus.datasource.jdbc.url`. See https://quarkus.io/guides/datasource\";\n+    public static final String DATASOURCE_JDBC_URL_HAS_NOT_BEEN_DEFINED = \"`quarkus.datasource.jdbc.url` has not been defined\";\n+    public static final String DATASOURCE_JDBC_S_URL_HAS_NOT_BEEN_DEFINED_MESSAGE_FORMAT = \"`quarkus.datasource.jdbc.%s.url` has not been defined\";", "originalCommit": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNjEwMA==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445036100", "bodyText": "fixed", "author": "ejba", "createdAt": "2020-06-24T16:53:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNTMwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNjUxMA==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445026510", "bodyText": "I would have had something like:\nif (!dataSourceJdbcRuntimeConfig.url.isPresent()) {\n    if (!legacyDataSourceRuntimeConfig.url.isPresent()) {\n        // no legacy JDBC URL either so proceed with the standard message\n    } else {\n        // the user provided a legacy JDBC URL, provide an explicit error message\n    }\n}", "author": "gsmet", "createdAt": "2020-06-24T16:38:06Z", "path": "extensions/agroal/runtime/src/main/java/io/quarkus/agroal/runtime/DataSources.java", "diffHunk": "@@ -142,12 +150,38 @@ public AgroalDataSource doCreateDataSource(String dataSourceName) {\n         DataSourceSupport.Entry matchingSupportEntry = dataSourceSupport.entries.get(dataSourceName);\n         boolean isLegacy = matchingSupportEntry.isLegacy;\n         if (!isLegacy) {\n+            if (!dataSourceJdbcRuntimeConfig.url.isPresent() && legacyDataSourceRuntimeConfig.url.isPresent()) {", "originalCommit": "163dbef1cfed022cc782116eb792c1e7e3e4a9ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAzNjE2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/10222#discussion_r445036169", "bodyText": "done", "author": "ejba", "createdAt": "2020-06-24T16:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNjUxMA=="}], "type": "inlineReview"}, {"oid": "8f0b28e5c1fded41a0adef4ce0f243db65af9386", "url": "https://github.com/quarkusio/quarkus/commit/8f0b28e5c1fded41a0adef4ce0f243db65af9386", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T16:47:51Z", "type": "forcePushed"}, {"oid": "d4ba95a2f76f6315661e15812a725203130eb1c3", "url": "https://github.com/quarkusio/quarkus/commit/d4ba95a2f76f6315661e15812a725203130eb1c3", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T16:50:46Z", "type": "forcePushed"}, {"oid": "0f0b8da65a0dbdb89a82f37db4913316a07927d7", "url": "https://github.com/quarkusio/quarkus/commit/0f0b8da65a0dbdb89a82f37db4913316a07927d7", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T16:52:57Z", "type": "forcePushed"}, {"oid": "7289c8fba44a4231c7ab5be6b9ae6b0c6d4b4801", "url": "https://github.com/quarkusio/quarkus/commit/7289c8fba44a4231c7ab5be6b9ae6b0c6d4b4801", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T17:00:04Z", "type": "forcePushed"}, {"oid": "adc30732194db99f0234934b7cb1eb2d35de4dab", "url": "https://github.com/quarkusio/quarkus/commit/adc30732194db99f0234934b7cb1eb2d35de4dab", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-24T17:17:01Z", "type": "forcePushed"}, {"oid": "20e4f3fe392150b7c79f932a99dc9de7e04f986f", "url": "https://github.com/quarkusio/quarkus/commit/20e4f3fe392150b7c79f932a99dc9de7e04f986f", "message": "Enhance error message when quarkus.database.jdbc.url property has not been defined", "committedDate": "2020-06-25T09:11:20Z", "type": "commit"}, {"oid": "2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "url": "https://github.com/quarkusio/quarkus/commit/2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "message": "Adjust the error messages a bit", "committedDate": "2020-06-25T09:21:39Z", "type": "commit"}, {"oid": "2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "url": "https://github.com/quarkusio/quarkus/commit/2e6bd5275ec3a70be5bc26c11ea9e6411bfd3dc5", "message": "Adjust the error messages a bit", "committedDate": "2020-06-25T09:21:39Z", "type": "forcePushed"}]}