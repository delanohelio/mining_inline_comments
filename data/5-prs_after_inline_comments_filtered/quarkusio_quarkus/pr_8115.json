{"pr_number": 8115, "pr_title": "Use CustomScopeAnnotationsBuildItem where needed", "pr_createdAt": "2020-03-24T17:25:49Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8115", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzY2OTc5Mw==", "url": "https://github.com/quarkusio/quarkus/pull/8115#discussion_r397669793", "bodyText": "would be better to say \"with no scope defined\", there could be some other unrelated annotations", "author": "jmartisk", "createdAt": "2020-03-25T08:11:26Z", "path": "extensions/scheduler/deployment/src/main/java/io/quarkus/scheduler/deployment/SchedulerProcessor.java", "diffHunk": "@@ -104,14 +104,14 @@ public boolean appliesTo(org.jboss.jandex.AnnotationTarget.Kind kind) {\n \n             @Override\n             public void transform(TransformationContext context) {\n-                if (context.isClass() && !scopes.isScopeDeclaredOn(context.getTarget().asClass())) {\n+                ClassInfo target = context.getTarget().asClass();\n+                if (!scopes.isScopeIn(context.getAnnotations())\n+                        && (target.annotations().containsKey(SCHEDULED_NAME)\n+                                || target.annotations().containsKey(SCHEDULES_NAME))) {\n                     // Class with no scope annotation but with @Scheduled method\n-                    if (context.getTarget().asClass().annotations().containsKey(SCHEDULED_NAME)\n-                            || context.getTarget().asClass().annotations().containsKey(SCHEDULES_NAME)) {\n-                        LOGGER.debugf(\"Found scheduled business methods on a class %s with no annotations - adding @Singleton\",\n-                                context.getTarget());\n-                        context.transform().add(Singleton.class).done();\n-                    }\n+                    LOGGER.debugf(\"Found scheduled business methods on a class %s with no annotations - adding @Singleton\",", "originalCommit": "9ba607113fe974601f06eaf54706a03f1bae0217", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3851472f6b42b01b2fcc5d7b5e048440c44a0351", "url": "https://github.com/quarkusio/quarkus/commit/3851472f6b42b01b2fcc5d7b5e048440c44a0351", "message": "Use CustomScopeAnnotationsBuildItem where needed\n\n- follows up on #7076", "committedDate": "2020-03-25T08:58:48Z", "type": "commit"}, {"oid": "3851472f6b42b01b2fcc5d7b5e048440c44a0351", "url": "https://github.com/quarkusio/quarkus/commit/3851472f6b42b01b2fcc5d7b5e048440c44a0351", "message": "Use CustomScopeAnnotationsBuildItem where needed\n\n- follows up on #7076", "committedDate": "2020-03-25T08:58:48Z", "type": "forcePushed"}]}