{"pr_number": 7165, "pr_title": "Support for AWS XRay", "pr_createdAt": "2020-02-12T15:54:43Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7165", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODM4MDIzOA==", "url": "https://github.com/quarkusio/quarkus/pull/7165#discussion_r378380238", "bodyText": "Remove this commented out code", "author": "gastaldi", "createdAt": "2020-02-12T16:52:01Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/steps/NativeImageAutoFeatureStep.java", "diffHunk": "@@ -254,8 +254,17 @@ public void write(String s, byte[] bytes) {\n \n             TryBlock tc = mv.tryBlock();\n \n-            ResultHandle clazz = tc.invokeStaticMethod(ofMethod(Class.class, \"forName\", Class.class, String.class),\n-                    tc.load(entry.getKey()));\n+            //ResultHandle clazz = tc.invokeStaticMethod(ofMethod(Class.class, \"forName\", Class.class, String.class),\n+            //        tc.load(entry.getKey()));", "originalCommit": "7a589fe7d6262a406ac0a9ac46d2f74c54c90ee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1MjY1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/7165#discussion_r378452657", "bodyText": "If you need Jackson, you should include the quarkus-jackson extension rather than doing that.", "author": "gsmet", "createdAt": "2020-02-12T19:05:21Z", "path": "extensions/amazon-lambda-xray/deployment/src/main/java/io/quarkus/amazon/lambda/xray/XrayBuildStep.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package io.quarkus.amazon.lambda.xray;\n+\n+import io.quarkus.deployment.annotations.BuildProducer;\n+import io.quarkus.deployment.annotations.BuildStep;\n+import io.quarkus.deployment.builditem.nativeimage.NativeImageResourceBuildItem;\n+import io.quarkus.deployment.builditem.nativeimage.ReflectiveClassBuildItem;\n+import io.quarkus.deployment.builditem.nativeimage.RuntimeInitializedClassBuildItem;\n+import io.quarkus.deployment.pkg.steps.NativeBuild;\n+\n+public class XrayBuildStep {\n+    @BuildStep(onlyIf = NativeBuild.class)\n+    public void process(BuildProducer<ReflectiveClassBuildItem> reflectiveClass,\n+            BuildProducer<RuntimeInitializedClassBuildItem> runtimeInitialized,\n+            BuildProducer<NativeImageResourceBuildItem> resource) {\n+        runtimeInitialized.produce(new RuntimeInitializedClassBuildItem(\"com.amazonaws.xray.AWSXRay\"));\n+        runtimeInitialized.produce(new RuntimeInitializedClassBuildItem(\"com.amazonaws.xray.AWSXRayRecorder\"));\n+        runtimeInitialized.produce(new RuntimeInitializedClassBuildItem(\"com.amazonaws.xray.interceptors.TracingInterceptor\"));\n+        runtimeInitialized.produce(\n+                new RuntimeInitializedClassBuildItem(\"com.amazonaws.xray.strategy.sampling.LocalizedSamplingStrategy\"));\n+        reflectiveClass.produce(new ReflectiveClassBuildItem(\n+                true, true, true,\n+                \"com.amazonaws.xray.handlers.config.AWSServiceHandlerManifest\",\n+                \"com.amazonaws.xray.AWSXRay\",\n+                \"com.amazonaws.xray.strategy.sampling.manifest.SamplingRuleManifest\",\n+                \"com.amazonaws.xray.strategy.sampling.rule.SamplingRule\",\n+                \"com.amazonaws.xray.strategy.sampling.reservoir.Reservoir\",\n+                \"com.amazonaws.xray.strategy.sampling.reservoir.Reservoir$MaxFunction\",\n+                \"com.amazonaws.xray.strategy.sampling.reservoir.Reservoir$LessThan10\",\n+                \"com.amazonaws.xray.strategy.sampling.reservoir.Reservoir$AtLeast10\",\n+                \"com.amazonaws.auth.AWS4Signer\",\n+                \"com.amazonaws.xray.handlers.config.AWSOperationHandlerManifest\",\n+                \"com.amazonaws.xray.handlers.config.AWSOperationHandler\",\n+                \"com.amazonaws.xray.handlers.config.AWSOperationHandlerRequestDescriptor\",\n+                \"com.amazonaws.xray.handlers.config.AWSOperationHandlerResponseDescriptor\",\n+                \"com.amazonaws.xray.entities.SubsegmentImpl\",\n+                \"com.amazonaws.xray.entities.EntityImpl\",\n+                \"com.amazonaws.xray.entities.TraceID\",\n+                \"com.amazonaws.xray.entities.Cause\",\n+                \"com.amazonaws.xray.entities.SegmentImpl\",\n+                \"com.fasterxml.jackson.databind.ser.std.ToStringSerializer\"));", "originalCommit": "7a589fe7d6262a406ac0a9ac46d2f74c54c90ee3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODUxMDMxNw==", "url": "https://github.com/quarkusio/quarkus/pull/7165#discussion_r378510317", "bodyText": "Don't think I can do that.  This is a third party jar I'm \"hacking\" in.  Can't change the third party.", "author": "patriot1burke", "createdAt": "2020-02-12T21:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1MjY1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ1NDMzNQ==", "url": "https://github.com/quarkusio/quarkus/pull/7165#discussion_r378454335", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            public final class LambdaSegmentContextSubtitution {\n          \n          \n            \n            public final class LambdaSegmentContextSubstitution {", "author": "gsmet", "createdAt": "2020-02-12T19:08:40Z", "path": "extensions/amazon-lambda-xray/runtime/src/main/java/io/quarkus/amazon/lambda/xray/graal/LambdaSegmentContextSubtitution.java", "diffHunk": "@@ -0,0 +1,18 @@\n+package io.quarkus.amazon.lambda.xray.graal;\n+\n+import com.amazonaws.xray.contexts.LambdaSegmentContext;\n+import com.amazonaws.xray.entities.TraceHeader;\n+import com.oracle.svm.core.annotate.Substitute;\n+import com.oracle.svm.core.annotate.TargetClass;\n+\n+import io.quarkus.amazon.lambda.runtime.TraceId;\n+\n+@TargetClass(LambdaSegmentContext.class)\n+public final class LambdaSegmentContextSubtitution {", "originalCommit": "7a589fe7d6262a406ac0a9ac46d2f74c54c90ee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "856a280df567744046270ac523c7aedaaade7332", "url": "https://github.com/quarkusio/quarkus/commit/856a280df567744046270ac523c7aedaaade7332", "message": "xray\n\nimprove\n\nfinish tracing\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nrename", "committedDate": "2020-02-12T19:20:58Z", "type": "forcePushed"}, {"oid": "2951cbaa002d5da9c8c124953ebb72e46884dcd3", "url": "https://github.com/quarkusio/quarkus/commit/2951cbaa002d5da9c8c124953ebb72e46884dcd3", "message": "xray\n\nimprove\n\nfinish tracing\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nrename\n\nUpdate extensions/amazon-lambda-xray/runtime/src/main/resources/META-INF/quarkus-extension.yaml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nmoar fixes", "committedDate": "2020-02-12T19:23:44Z", "type": "forcePushed"}, {"oid": "ca553f62deed963e3bb1fefe92c38255c6381f76", "url": "https://github.com/quarkusio/quarkus/commit/ca553f62deed963e3bb1fefe92c38255c6381f76", "message": "xray\n\nimprove\n\nfinish tracing\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nrename\n\nUpdate extensions/amazon-lambda-xray/runtime/src/main/resources/META-INF/quarkus-extension.yaml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nmoar fixes\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate extensions/amazon-lambda-xray/runtime/pom.xml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate extensions/amazon-lambda-xray/pom.xml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate extensions/amazon-lambda-xray/deployment/pom.xml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>", "committedDate": "2020-02-13T02:44:57Z", "type": "commit"}, {"oid": "ca553f62deed963e3bb1fefe92c38255c6381f76", "url": "https://github.com/quarkusio/quarkus/commit/ca553f62deed963e3bb1fefe92c38255c6381f76", "message": "xray\n\nimprove\n\nfinish tracing\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nrename\n\nUpdate extensions/amazon-lambda-xray/runtime/src/main/resources/META-INF/quarkus-extension.yaml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate docs/src/main/asciidoc/amazon-lambda-http.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nmoar fixes\n\nUpdate docs/src/main/asciidoc/amazon-lambda.adoc\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate extensions/amazon-lambda-xray/runtime/pom.xml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate extensions/amazon-lambda-xray/pom.xml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>\n\nUpdate extensions/amazon-lambda-xray/deployment/pom.xml\n\nCo-Authored-By: Guillaume Smet <guillaume.smet@gmail.com>", "committedDate": "2020-02-13T02:44:57Z", "type": "forcePushed"}]}