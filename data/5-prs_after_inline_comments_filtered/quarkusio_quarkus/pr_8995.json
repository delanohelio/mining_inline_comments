{"pr_number": 8995, "pr_title": "Improve transformer dev mode performance", "pr_createdAt": "2020-05-01T01:45:05Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/8995", "timeline": [{"oid": "a9fc18c12e29111b5278d1f533335332d9154901", "url": "https://github.com/quarkusio/quarkus/commit/a9fc18c12e29111b5278d1f533335332d9154901", "message": "Do transformation eagerly in dev mode\n\nIt's the most expensive part of bootstrap,\nmight as well get all the cores involved", "committedDate": "2020-05-01T02:04:46Z", "type": "forcePushed"}, {"oid": "be2302ec35eb50806ad75f4012f251342f7fe539", "url": "https://github.com/quarkusio/quarkus/commit/be2302ec35eb50806ad75f4012f251342f7fe539", "message": "Improve getResources performance", "committedDate": "2020-05-01T02:50:31Z", "type": "commit"}, {"oid": "fcae90b56202897bc0128ac82b0fda8fa2b61869", "url": "https://github.com/quarkusio/quarkus/commit/fcae90b56202897bc0128ac82b0fda8fa2b61869", "message": "Do transformation eagerly in dev mode\n\nIt's the most expensive part of bootstrap,\nmight as well get all the cores involved", "committedDate": "2020-05-01T02:50:36Z", "type": "forcePushed"}, {"oid": "19e7bdbc5547ae4306fb6f0d85499a97076f19b4", "url": "https://github.com/quarkusio/quarkus/commit/19e7bdbc5547ae4306fb6f0d85499a97076f19b4", "message": "Do transformation eagerly in dev mode\n\nIt's the most expensive part of bootstrap,\nmight as well get all the cores involved", "committedDate": "2020-05-01T03:56:48Z", "type": "commit"}, {"oid": "19e7bdbc5547ae4306fb6f0d85499a97076f19b4", "url": "https://github.com/quarkusio/quarkus/commit/19e7bdbc5547ae4306fb6f0d85499a97076f19b4", "message": "Do transformation eagerly in dev mode\n\nIt's the most expensive part of bootstrap,\nmight as well get all the cores involved", "committedDate": "2020-05-01T03:56:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyMDM3Mw==", "url": "https://github.com/quarkusio/quarkus/pull/8995#discussion_r419420373", "bodyText": "What if you have only one core in a container?", "author": "gsmet", "createdAt": "2020-05-04T13:06:04Z", "path": "core/deployment/src/main/java/io/quarkus/runner/bootstrap/StartupActionImpl.java", "diffHunk": "@@ -66,12 +72,47 @@ public StartupActionImpl(CuratedApplication curatedApplication, BuildResult buil\n             runtimeClassLoader = baseClassLoader;\n         }\n         this.runtimeClassLoader = runtimeClassLoader;\n+        handleEagerClasses(runtimeClassLoader, eagerClasses);\n+    }\n+\n+    private void handleEagerClasses(QuarkusClassLoader runtimeClassLoader, Set<String> eagerClasses) {\n+        int availableProcessors = Runtime.getRuntime().availableProcessors();\n+        if (availableProcessors == 1) {\n+            return;\n+        }\n+        //leave one processor for the main startup thread\n+        ExecutorService loadingExecutor = Executors.newFixedThreadPool(availableProcessors - 1);", "originalCommit": "19e7bdbc5547ae4306fb6f0d85499a97076f19b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc0NTk2MQ==", "url": "https://github.com/quarkusio/quarkus/pull/8995#discussion_r419745961", "bodyText": "This code is not run, there is a check 4 lines above that will bail out.", "author": "stuartwdouglas", "createdAt": "2020-05-04T21:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyMDM3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTc1NTY3MQ==", "url": "https://github.com/quarkusio/quarkus/pull/8995#discussion_r419755671", "bodyText": "Hum. Silly me.", "author": "gsmet", "createdAt": "2020-05-04T22:02:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQyMDM3Mw=="}], "type": "inlineReview"}]}