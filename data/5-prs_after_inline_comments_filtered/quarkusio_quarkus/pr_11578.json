{"pr_number": 11578, "pr_title": "Upgrade to GraalVM 20.2.0", "pr_createdAt": "2020-08-24T18:43:48Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/11578", "timeline": [{"oid": "7fa2a7db3f45ad9e4603217fed3197813e111477", "url": "https://github.com/quarkusio/quarkus/commit/7fa2a7db3f45ad9e4603217fed3197813e111477", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-24T18:53:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1ODgyNA==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r476258824", "bodyText": "Yeah so that's where I think we need some tweaking because doing that, we will recommend using 20.1 in the log message if people are using an older version which is not what we want to do.\nI think we need two constants: the minimal version and the current one.", "author": "gsmet", "createdAt": "2020-08-25T08:08:06Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java", "diffHunk": "@@ -658,6 +658,7 @@ private static void objcopy(String... args) {\n             static final Version SNAPSHOT_MANDREL = new Version(\"Snapshot\", Integer.MAX_VALUE, Integer.MAX_VALUE,\n                     Distribution.MANDREL);\n             static final Version VERSION_20_1 = new Version(\"GraalVM 20.1\", 20, 1, Distribution.ORACLE);\n+            // Keeping 20.1 until Mandrel is updated\n             static final Version CURRENT = VERSION_20_1;", "originalCommit": "d91a046e948c4b1b4317c52f011303aef9d9be3a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1OTY3Mg==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r476259672", "bodyText": "Btw, I wouldn't mind if I didn't think this would happen at each upgrade. There will always be a delay between Mandrel and GraalVM and we might release a version where both versions are not aligned.", "author": "gsmet", "createdAt": "2020-08-25T08:09:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1ODgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5MzcyMA==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r476393720", "bodyText": "We can't release a final Mandrel 20.2 yet because we're depending on Java 11.0.9 changes coming up. GraalVM control their JDK (labs JDK) and they added some changes to the underlying JDK that is used for GraalVM 20.2. We're playing catch up here, unable to release final until 11.0.9 comes out.\nI think we should maybe rename CURRENT to MINIMUM, to signal that's the minimum version that we support. That's all CURRENT is used for, to detect which is the minimum version.", "author": "galderz", "createdAt": "2020-08-25T12:00:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1ODgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjM5Mzk2OA==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r476393968", "bodyText": "Having said that, we plan to release a Mandrel 20.2 beta shortly.", "author": "galderz", "createdAt": "2020-08-25T12:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1ODgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjQzNzE1Nw==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r476437157", "bodyText": "No current is also used in the log message. So we need both MINIMUM and CURRENT.", "author": "gsmet", "createdAt": "2020-08-25T13:12:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjI1ODgyNA=="}], "type": "inlineReview"}, {"oid": "02dd8014b7d16f98ea496a572d69429f3955c2a6", "url": "https://github.com/quarkusio/quarkus/commit/02dd8014b7d16f98ea496a572d69429f3955c2a6", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-25T17:15:47Z", "type": "forcePushed"}, {"oid": "6ea3288fcd8336b6e2c399967fa115e91820f4d7", "url": "https://github.com/quarkusio/quarkus/commit/6ea3288fcd8336b6e2c399967fa115e91820f4d7", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-25T17:17:48Z", "type": "forcePushed"}, {"oid": "f519ea8dfbb77508cdb07d37ae0e68596642cb16", "url": "https://github.com/quarkusio/quarkus/commit/f519ea8dfbb77508cdb07d37ae0e68596642cb16", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-25T17:19:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI0Njk0OQ==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r477246949", "bodyText": "I'm not really happy with the wording change. I would keep the message as is, just using CURRENT and major.minor.\nI prefer recommending only one version even if we don't force the upgrade.", "author": "gsmet", "createdAt": "2020-08-26T12:03:24Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/pkg/steps/NativeImageBuildStep.java", "diffHunk": "@@ -495,10 +496,16 @@ private RuntimeException imageGenerationFailed(int exitValue, List<String> comma\n     private void checkGraalVMVersion(GraalVM.Version version) {\n         log.info(\"Running Quarkus native-image plugin on \" + version.getFullVersion());\n         if (version.isObsolete()) {\n-            final int major = GraalVM.Version.CURRENT.major;\n-            final int minor = GraalVM.Version.CURRENT.minor;\n-            throw new IllegalStateException(\"Out of date version of GraalVM detected: \" + version.getFullVersion() + \".\"\n-                    + \" Quarkus currently supports \" + major + \".\" + minor + \". Please upgrade GraalVM to this version.\");\n+            String currentVersion = GraalVM.Version.CURRENT.getFullVersion();\n+            if (GraalVM.Version.CURRENT != GraalVM.Version.MINIMUM) {\n+                currentVersion += \" (minimum: \" + GraalVM.Version.MINIMUM.getFullVersion() + \")\";\n+            }\n+            String msg = String.format(\"Out of date version of GraalVM detected: %s.\"\n+                    + \" Quarkus currently supports %s. Please upgrade to %s.\",\n+                    version.getFullVersion(),\n+                    currentVersion,\n+                    GraalVM.Version.CURRENT.getFullVersion());", "originalCommit": "f519ea8dfbb77508cdb07d37ae0e68596642cb16", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM0MDUyMg==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r477340522", "bodyText": "Just to be clear: you recommend to display only the current version in the message and use the minimum just to check if the GraalVM used is obsolete?", "author": "gastaldi", "createdAt": "2020-08-26T14:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI0Njk0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzUzOTc5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/11578#discussion_r477539796", "bodyText": "Yes, I would keep the current message as is. And use the minimum version to determine if we should display it.\nThat's what we did before Galder's refactoring. This way we encourage people to migrate to the currently supported (and tested) version.", "author": "gsmet", "createdAt": "2020-08-26T19:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzI0Njk0OQ=="}], "type": "inlineReview"}, {"oid": "90e2a0a2f2883cb783df444aaf8077e0620d758b", "url": "https://github.com/quarkusio/quarkus/commit/90e2a0a2f2883cb783df444aaf8077e0620d758b", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-26T14:22:56Z", "type": "forcePushed"}, {"oid": "84499aad3db291528693ca54b41e45e6b02f24c4", "url": "https://github.com/quarkusio/quarkus/commit/84499aad3db291528693ca54b41e45e6b02f24c4", "message": "Using Modifier.isFinal instead of org.objectweb.asm.Opcodes.ACC_FINAL", "committedDate": "2020-08-28T17:41:32Z", "type": "commit"}, {"oid": "3e7d811e079f134fa0e85e30206618194319d0a3", "url": "https://github.com/quarkusio/quarkus/commit/3e7d811e079f134fa0e85e30206618194319d0a3", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-28T17:41:35Z", "type": "commit"}, {"oid": "3e7d811e079f134fa0e85e30206618194319d0a3", "url": "https://github.com/quarkusio/quarkus/commit/3e7d811e079f134fa0e85e30206618194319d0a3", "message": "Upgrade to GraalVM 20.2.0\n\nFixes #11576", "committedDate": "2020-08-28T17:41:35Z", "type": "forcePushed"}]}