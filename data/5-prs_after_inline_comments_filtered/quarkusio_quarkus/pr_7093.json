{"pr_number": 7093, "pr_title": "Add banner extension module - default banner & option for custom banner for user", "pr_createdAt": "2020-02-08T18:50:22Z", "pr_url": "https://github.com/quarkusio/quarkus/pull/7093", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxNzgyMg==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r376817822", "bodyText": "This needs to be:\n@BuildStep(loadsApplicationClasses = true)\n\nOtherwise if you try to set a custom banner (that of course needs to be placed in src/main/resources), the banner not found and therefore not displayed at runtime.", "author": "geoand", "createdAt": "2020-02-09T21:38:44Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/logging/LoggingResourceProcessor.java", "diffHunk": "@@ -79,11 +81,22 @@ void miscSetup(\n     @BuildStep", "originalCommit": "2936f716622fc3ff46ab29268362279f5da1344d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjgxODA0OA==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r376818048", "bodyText": "It should be mentioned that this path is a path relative to the root of the classpath, not a file system path", "author": "geoand", "createdAt": "2020-02-09T21:41:48Z", "path": "extensions/banner/deployment/src/main/java/io/quarkus/banner/deployment/BannerConfig.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package io.quarkus.banner.deployment;\n+\n+import io.quarkus.runtime.annotations.ConfigItem;\n+import io.quarkus.runtime.annotations.ConfigRoot;\n+\n+@ConfigRoot(name = \"banner\")\n+public class BannerConfig {\n+    /**\n+     * The path of the banner which could be provided by user", "originalCommit": "2936f716622fc3ff46ab29268362279f5da1344d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MDcwNg==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377150706", "bodyText": "This is correct, \ud83d\udc4d", "author": "geoand", "createdAt": "2020-02-10T15:55:28Z", "path": "extensions/banner/deployment/src/main/java/io/quarkus/banner/deployment/BannerProcessor.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package io.quarkus.banner.deployment;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.io.UncheckedIOException;\n+import java.net.URL;\n+import java.nio.charset.StandardCharsets;\n+\n+import org.jboss.logging.Logger;\n+\n+import io.quarkus.banner.runtime.BannerRecorder;\n+import io.quarkus.builder.Version;\n+import io.quarkus.deployment.annotations.BuildStep;\n+import io.quarkus.deployment.annotations.ExecutionTime;\n+import io.quarkus.deployment.annotations.Record;\n+import io.quarkus.deployment.builditem.ConsoleFormatterBannerBuildItem;\n+import io.quarkus.deployment.builditem.HotDeploymentWatchedFileBuildItem;\n+import io.quarkus.deployment.util.FileUtil;\n+\n+public class BannerProcessor {\n+\n+    private static final Logger logger = Logger.getLogger(BannerProcessor.class);\n+\n+    @BuildStep(loadsApplicationClasses = true)", "originalCommit": "08359527396dbf18f7bbdd663ae93cddc0e75f26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377151343", "bodyText": "Did I mention that this needs to change? If I did, sorry, I was wrong. This should not be needed, only the other loadsApplicationClasses = true you added", "author": "geoand", "createdAt": "2020-02-10T15:56:22Z", "path": "core/deployment/src/main/java/io/quarkus/deployment/logging/LoggingResourceProcessor.java", "diffHunk": "@@ -76,14 +78,25 @@ void miscSetup(\n                 new ServiceProviderBuildItem(EmbeddedConfigurator.class.getName(), InitialConfigurator.class.getName()));\n     }\n \n-    @BuildStep\n+    @BuildStep(loadsApplicationClasses = true)", "originalCommit": "08359527396dbf18f7bbdd663ae93cddc0e75f26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3NjE5Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377376196", "bodyText": "But it was not loading resource. When I changed this too. It did", "author": "RotBolt", "createdAt": "2020-02-10T23:22:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzM3Njc1Ng==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377376756", "bodyText": "Oh wait , did you mean , loadApplicationClassTrue in banner extension and not on LoggingResourceProcessor", "author": "RotBolt", "createdAt": "2020-02-10T23:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ0NzI2OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377447269", "bodyText": "@geoand  I checked , I have to add loadApplicationClasses= true to both places. Otherwise It is not working\nOtherwise it get stucks at this line\n[INFO] --- quarkus-maven-plugin:999-SNAPSHOT:dev (default-cli) @ banner-test ---\nListening for transport dt_socket at address: 5005\n\nNo output further", "author": "RotBolt", "createdAt": "2020-02-11T05:04:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ2OTAwNg==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377469006", "bodyText": "I'll check again and let you know, but I really don't think it's necessary", "author": "geoand", "createdAt": "2020-02-11T07:04:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ3NDAyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377474021", "bodyText": "I double-checked a test application and indeed this is not needed.\nThe reason why it's needed in the other build step you added is because you are attempting you read a classpath resource inside a build step - a resource that was added by the user. The default Thread Context ClassLoader that is used when build steps are run (which Quarkus calls the Augmentation ClassLoader) does not have access to the application classes and resources.\nWhen using loadApplicationClasses then the Thread Context ClassLoader that is set when the build step is run (is what Quarkus calls the Deployment ClassLoader) and this does have access to application classes and resources.\nThe logging processor you have changed here has nothing to do with loading the resource.", "author": "geoand", "createdAt": "2020-02-11T07:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4MDAyMQ==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377480021", "bodyText": "I removed it from LoggingResourceProcessor , but then it doesn't work . As I output stuck", "author": "RotBolt", "createdAt": "2020-02-11T07:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4MDk0OQ==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377480949", "bodyText": "You must be doing something wrong. I tried it multiple times", "author": "geoand", "createdAt": "2020-02-11T07:50:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4MjM3NA==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377482374", "bodyText": "You mean on your side banner is working ?", "author": "RotBolt", "createdAt": "2020-02-11T07:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ4MzIyNA==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377483224", "bodyText": "Yes, when I use @BuildStep(loadsApplicationClasses = true) in BannerProcessor only and leave this one without it (like it was before the change), then a custom banner file placed inside src/main/resources and configured in application.properties, works just fine", "author": "geoand", "createdAt": "2020-02-11T07:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ5MTE4NA==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377491184", "bodyText": "Ok its working now.\nI probably erased @BuildStep annotation itself instead of removing loadApplicationClasses = true only from LoggingResourceProcessor. \ud83d\ude13", "author": "RotBolt", "createdAt": "2020-02-11T08:22:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQ5MTcxNQ==", "url": "https://github.com/quarkusio/quarkus/pull/7093#discussion_r377491715", "bodyText": "Great!", "author": "geoand", "createdAt": "2020-02-11T08:23:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzE1MTM0Mw=="}], "type": "inlineReview"}, {"oid": "1745553121c1c5894a3a98591f37f469e7eec1e4", "url": "https://github.com/quarkusio/quarkus/commit/1745553121c1c5894a3a98591f37f469e7eec1e4", "message": "Add banner extension module, default banner, option for user banner, CustomBannerFormatter", "committedDate": "2020-02-12T03:38:45Z", "type": "commit"}]}