{"pr_number": 2020, "pr_title": "Auto brewer", "pr_createdAt": "2020-06-24T19:13:57Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/2020", "timeline": [{"oid": "4f6bbafdfc6dfa19ce617ff1f95273e9d1c8b543", "url": "https://github.com/Slimefun/Slimefun4/commit/4f6bbafdfc6dfa19ce617ff1f95273e9d1c8b543", "message": "Added Auto Brewer.\n\nA new medium machine that can create potions automatically.", "committedDate": "2020-06-24T18:24:16Z", "type": "commit"}, {"oid": "daadabd535cd03edf21435f39b5cf3a6d88ca623", "url": "https://github.com/Slimefun/Slimefun4/commit/daadabd535cd03edf21435f39b5cf3a6d88ca623", "message": "Fixed an import dis-organisation.", "committedDate": "2020-06-24T18:25:42Z", "type": "commit"}, {"oid": "776dc2a302c2d6c7608e3ed4e98edb58158e0515", "url": "https://github.com/Slimefun/Slimefun4/commit/776dc2a302c2d6c7608e3ed4e98edb58158e0515", "message": "Added some documentation.", "committedDate": "2020-06-24T19:17:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTM1Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2020#discussion_r445121353", "bodyText": "You should probably create an \"isPotion(ItemStack)\" method for this instead of doing this multiple times, also", "author": "TheBusyBiscuit", "createdAt": "2020-06-24T19:27:57Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/AutoBrewer.java", "diffHunk": "@@ -0,0 +1,201 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.items.electric.machines;\n+\n+import java.util.HashMap;\n+\n+import org.bukkit.Material;\n+import org.bukkit.block.Block;\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.inventory.meta.PotionMeta;\n+import org.bukkit.potion.PotionData;\n+import org.bukkit.potion.PotionType;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.InvUtils;\n+import io.github.thebusybiscuit.cscorelib2.item.CustomItem;\n+import io.github.thebusybiscuit.slimefun4.utils.ChestMenuUtils;\n+import me.mrCookieSlime.Slimefun.Lists.RecipeType;\n+import me.mrCookieSlime.Slimefun.Objects.Category;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.abstractItems.AContainer;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.abstractItems.MachineRecipe;\n+import me.mrCookieSlime.Slimefun.api.BlockStorage;\n+import me.mrCookieSlime.Slimefun.api.SlimefunItemStack;\n+import me.mrCookieSlime.Slimefun.api.energy.ChargableBlock;\n+import me.mrCookieSlime.Slimefun.api.inventory.BlockMenu;\n+\n+/**\n+ *\n+ * The Auto Brewer machine with most if not all potion recipes.\n+ *\n+ * @author Linox\n+ *\n+ * @see AContainer\n+ *\n+ */\n+public class AutoBrewer extends AContainer {\n+\n+    private static final HashMap<Material, PotionType> potionRecipes = new HashMap<>();\n+    private static final HashMap<PotionType, PotionType> fermSpiderEye = new HashMap<>();\n+\n+    static {\n+        potionRecipes.put(Material.SUGAR, PotionType.SPEED);\n+        potionRecipes.put(Material.RABBIT_FOOT, PotionType.JUMP);\n+        potionRecipes.put(Material.BLAZE_POWDER, PotionType.STRENGTH);\n+        potionRecipes.put(Material.GLISTERING_MELON_SLICE, PotionType.INSTANT_HEAL);\n+        potionRecipes.put(Material.SPIDER_EYE, PotionType.POISON);\n+        potionRecipes.put(Material.GHAST_TEAR, PotionType.REGEN);\n+        potionRecipes.put(Material.MAGMA_CREAM, PotionType.FIRE_RESISTANCE);\n+        potionRecipes.put(Material.PUFFERFISH, PotionType.WATER_BREATHING);\n+        potionRecipes.put(Material.GOLDEN_CARROT, PotionType.NIGHT_VISION);\n+        potionRecipes.put(Material.TURTLE_HELMET, PotionType.TURTLE_MASTER);\n+        potionRecipes.put(Material.PHANTOM_MEMBRANE, PotionType.SLOW_FALLING);\n+\n+        fermSpiderEye.put(PotionType.SPEED, PotionType.SLOWNESS);\n+        fermSpiderEye.put(PotionType.JUMP, PotionType.SLOWNESS);\n+        fermSpiderEye.put(PotionType.INSTANT_HEAL, PotionType.INSTANT_DAMAGE);\n+        fermSpiderEye.put(PotionType.POISON, PotionType.INSTANT_DAMAGE);\n+        fermSpiderEye.put(PotionType.NIGHT_VISION, PotionType.INVISIBILITY);\n+    }\n+\n+    public AutoBrewer(Category category, SlimefunItemStack item, RecipeType recipeType, ItemStack[] recipe) {\n+        super(category, item, recipeType, recipe);\n+    }\n+\n+    @Override\n+    protected void tick(Block b) {\n+        BlockMenu menu = BlockStorage.getInventory(b.getLocation());\n+\n+        if (isProcessing(b)) {\n+            int timeleft = progress.get(b);\n+\n+            if (timeleft > 0) {\n+                ChestMenuUtils.updateProgressbar(menu, 22, timeleft, processing.get(b).getTicks(), getProgressBar());\n+\n+                if (ChargableBlock.isChargable(b)) {\n+                    if (ChargableBlock.getCharge(b) < getEnergyConsumption()) {\n+                        return;\n+                    }\n+\n+                    ChargableBlock.addCharge(b, -getEnergyConsumption());\n+                    progress.put(b, timeleft - 1);\n+                }\n+                else {\n+                    progress.put(b, timeleft - 1);\n+                }\n+            }\n+            else {\n+                menu.replaceExistingItem(22, new CustomItem(new ItemStack(Material.BLACK_STAINED_GLASS_PANE), \" \"));\n+\n+                for (ItemStack item : processing.get(b).getOutput()) {\n+                    menu.pushItem(item, getOutputSlots());\n+                }\n+\n+                progress.remove(b);\n+                processing.remove(b);\n+            }\n+        }\n+        else {\n+            MachineRecipe recipe = findRecipe(menu);\n+\n+            if (recipe != null) {\n+                if (!InvUtils.fitAll(menu.toInventory(), recipe.getOutput(), getOutputSlots())) {\n+                    return;\n+                }\n+\n+                for (int slot : getInputSlots()) {\n+                    menu.consumeItem(slot);\n+                }\n+\n+                processing.put(b, recipe);\n+                progress.put(b, recipe.getTicks());\n+            }\n+        }\n+    }\n+\n+    private MachineRecipe findRecipe(BlockMenu menu) {\n+        ItemStack input1 = menu.getItemInSlot(getInputSlots()[0]);\n+        ItemStack input2 = menu.getItemInSlot(getInputSlots()[1]);\n+\n+        if (input1 == null || input2 == null) return null;\n+\n+        if (input1.getType().name().endsWith(\"POTION\") || input2.getType().name().endsWith(\"POTION\")) {\n+            boolean slot = input1.getType().name().endsWith(\"POTION\");", "originalCommit": "776dc2a302c2d6c7608e3ed4e98edb58158e0515", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTU2OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2020#discussion_r445121569", "bodyText": "Why a carrot on a stick?", "author": "TheBusyBiscuit", "createdAt": "2020-06-24T19:28:20Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/electric/machines/AutoBrewer.java", "diffHunk": "@@ -0,0 +1,201 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.items.electric.machines;\n+\n+import java.util.HashMap;\n+\n+import org.bukkit.Material;\n+import org.bukkit.block.Block;\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.inventory.meta.PotionMeta;\n+import org.bukkit.potion.PotionData;\n+import org.bukkit.potion.PotionType;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.InvUtils;\n+import io.github.thebusybiscuit.cscorelib2.item.CustomItem;\n+import io.github.thebusybiscuit.slimefun4.utils.ChestMenuUtils;\n+import me.mrCookieSlime.Slimefun.Lists.RecipeType;\n+import me.mrCookieSlime.Slimefun.Objects.Category;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.abstractItems.AContainer;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.abstractItems.MachineRecipe;\n+import me.mrCookieSlime.Slimefun.api.BlockStorage;\n+import me.mrCookieSlime.Slimefun.api.SlimefunItemStack;\n+import me.mrCookieSlime.Slimefun.api.energy.ChargableBlock;\n+import me.mrCookieSlime.Slimefun.api.inventory.BlockMenu;\n+\n+/**\n+ *\n+ * The Auto Brewer machine with most if not all potion recipes.\n+ *\n+ * @author Linox\n+ *\n+ * @see AContainer\n+ *\n+ */\n+public class AutoBrewer extends AContainer {\n+\n+    private static final HashMap<Material, PotionType> potionRecipes = new HashMap<>();\n+    private static final HashMap<PotionType, PotionType> fermSpiderEye = new HashMap<>();\n+\n+    static {\n+        potionRecipes.put(Material.SUGAR, PotionType.SPEED);\n+        potionRecipes.put(Material.RABBIT_FOOT, PotionType.JUMP);\n+        potionRecipes.put(Material.BLAZE_POWDER, PotionType.STRENGTH);\n+        potionRecipes.put(Material.GLISTERING_MELON_SLICE, PotionType.INSTANT_HEAL);\n+        potionRecipes.put(Material.SPIDER_EYE, PotionType.POISON);\n+        potionRecipes.put(Material.GHAST_TEAR, PotionType.REGEN);\n+        potionRecipes.put(Material.MAGMA_CREAM, PotionType.FIRE_RESISTANCE);\n+        potionRecipes.put(Material.PUFFERFISH, PotionType.WATER_BREATHING);\n+        potionRecipes.put(Material.GOLDEN_CARROT, PotionType.NIGHT_VISION);\n+        potionRecipes.put(Material.TURTLE_HELMET, PotionType.TURTLE_MASTER);\n+        potionRecipes.put(Material.PHANTOM_MEMBRANE, PotionType.SLOW_FALLING);\n+\n+        fermSpiderEye.put(PotionType.SPEED, PotionType.SLOWNESS);\n+        fermSpiderEye.put(PotionType.JUMP, PotionType.SLOWNESS);\n+        fermSpiderEye.put(PotionType.INSTANT_HEAL, PotionType.INSTANT_DAMAGE);\n+        fermSpiderEye.put(PotionType.POISON, PotionType.INSTANT_DAMAGE);\n+        fermSpiderEye.put(PotionType.NIGHT_VISION, PotionType.INVISIBILITY);\n+    }\n+\n+    public AutoBrewer(Category category, SlimefunItemStack item, RecipeType recipeType, ItemStack[] recipe) {\n+        super(category, item, recipeType, recipe);\n+    }\n+\n+    @Override\n+    protected void tick(Block b) {\n+        BlockMenu menu = BlockStorage.getInventory(b.getLocation());\n+\n+        if (isProcessing(b)) {\n+            int timeleft = progress.get(b);\n+\n+            if (timeleft > 0) {\n+                ChestMenuUtils.updateProgressbar(menu, 22, timeleft, processing.get(b).getTicks(), getProgressBar());\n+\n+                if (ChargableBlock.isChargable(b)) {\n+                    if (ChargableBlock.getCharge(b) < getEnergyConsumption()) {\n+                        return;\n+                    }\n+\n+                    ChargableBlock.addCharge(b, -getEnergyConsumption());\n+                    progress.put(b, timeleft - 1);\n+                }\n+                else {\n+                    progress.put(b, timeleft - 1);\n+                }\n+            }\n+            else {\n+                menu.replaceExistingItem(22, new CustomItem(new ItemStack(Material.BLACK_STAINED_GLASS_PANE), \" \"));\n+\n+                for (ItemStack item : processing.get(b).getOutput()) {\n+                    menu.pushItem(item, getOutputSlots());\n+                }\n+\n+                progress.remove(b);\n+                processing.remove(b);\n+            }\n+        }\n+        else {\n+            MachineRecipe recipe = findRecipe(menu);\n+\n+            if (recipe != null) {\n+                if (!InvUtils.fitAll(menu.toInventory(), recipe.getOutput(), getOutputSlots())) {\n+                    return;\n+                }\n+\n+                for (int slot : getInputSlots()) {\n+                    menu.consumeItem(slot);\n+                }\n+\n+                processing.put(b, recipe);\n+                progress.put(b, recipe.getTicks());\n+            }\n+        }\n+    }\n+\n+    private MachineRecipe findRecipe(BlockMenu menu) {\n+        ItemStack input1 = menu.getItemInSlot(getInputSlots()[0]);\n+        ItemStack input2 = menu.getItemInSlot(getInputSlots()[1]);\n+\n+        if (input1 == null || input2 == null) return null;\n+\n+        if (input1.getType().name().endsWith(\"POTION\") || input2.getType().name().endsWith(\"POTION\")) {\n+            boolean slot = input1.getType().name().endsWith(\"POTION\");\n+            ItemStack pItem = slot ? input1 : input2;\n+            ItemStack iItem = slot ? input2 : input1;\n+\n+            PotionMeta potion = (PotionMeta) pItem.getItemMeta();\n+            if (potion == null) return null;\n+            PotionData potionData = potion.getBasePotionData();\n+\n+            ItemStack output;\n+            if (potionData.getType() == PotionType.WATER) {\n+                if (iItem.getType() == Material.FERMENTED_SPIDER_EYE) {\n+                    potion.setBasePotionData(new PotionData(PotionType.WEAKNESS, false, false));\n+                    output = new ItemStack(pItem.getType());\n+\n+                } else if (iItem.getType() == Material.NETHER_WART) {\n+                    potion.setBasePotionData(new PotionData(PotionType.AWKWARD, false, false));\n+                    output = new ItemStack(pItem.getType());\n+\n+                } else if (pItem.getType() == Material.POTION && iItem.getType() == Material.GUNPOWDER) {\n+                    output = new ItemStack(Material.SPLASH_POTION);\n+\n+                } else if (pItem.getType() == Material.SPLASH_POTION && iItem.getType() == Material.DRAGON_BREATH) {\n+                    output = new ItemStack(Material.LINGERING_POTION);\n+\n+                } else return null;\n+\n+            } else {\n+                if (iItem.getType() == Material.FERMENTED_SPIDER_EYE) {\n+                    potion.setBasePotionData(new PotionData(fermSpiderEye.get(potionData.getType()), false, false));\n+                    output = new ItemStack(pItem.getType());\n+\n+                } else if (iItem.getType() == Material.REDSTONE) {\n+                    potion.setBasePotionData(new PotionData(potionData.getType(), true, potionData.isUpgraded()));\n+                    output = new ItemStack(pItem.getType());\n+\n+                } else if (iItem.getType() == Material.GLOWSTONE_DUST) {\n+                    potion.setBasePotionData(new PotionData(potionData.getType(), potionData.isExtended(), true));\n+                    output = new ItemStack(pItem.getType());\n+\n+                } else if (potionData.getType() == PotionType.AWKWARD && potionRecipes.containsKey(iItem.getType())) {\n+                    potion.setBasePotionData(new PotionData(potionRecipes.get(iItem.getType()), false, false));\n+                    output = new ItemStack(pItem.getType());\n+\n+                } else return null;\n+            }\n+\n+            output.setItemMeta(potion);\n+\n+            return new MachineRecipe(30, new ItemStack[]{input1, input2}, new ItemStack[]{output});\n+        } else return null;\n+    }\n+\n+    @Override\n+    public String getInventoryTitle() {\n+        return \"&6Auto-Brewer\";\n+    }\n+\n+    @Override\n+    public ItemStack getProgressBar() {\n+        return new ItemStack(Material.CARROT_ON_A_STICK);", "originalCommit": "776dc2a302c2d6c7608e3ed4e98edb58158e0515", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTk5Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2020#discussion_r445121993", "bodyText": "because I thought it looks similar to brewing stand. any better idea?", "author": "LinoxGH", "createdAt": "2020-06-24T19:29:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMzA4MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2020#discussion_r445123081", "bodyText": "Nah, not really :/", "author": "TheBusyBiscuit", "createdAt": "2020-06-24T19:31:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMzk4Ng==", "url": "https://github.com/Slimefun/Slimefun4/pull/2020#discussion_r445123986", "bodyText": "if you don't have a better idea why not keep it?", "author": "LinoxGH", "createdAt": "2020-06-24T19:33:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTEyMTU2OQ=="}], "type": "inlineReview"}, {"oid": "4249a2b85bcdcd1ad3d2368a84cfb037bae2a65f", "url": "https://github.com/Slimefun/Slimefun4/commit/4249a2b85bcdcd1ad3d2368a84cfb037bae2a65f", "message": "Did the requested changes.", "committedDate": "2020-06-24T19:33:55Z", "type": "commit"}, {"oid": "8f0c5100d4c75c18d7a1c33a8071a09e3dbc16fd", "url": "https://github.com/Slimefun/Slimefun4/commit/8f0c5100d4c75c18d7a1c33a8071a09e3dbc16fd", "message": "Merge branch 'master' into AutoBrewer", "committedDate": "2020-06-24T19:38:15Z", "type": "commit"}, {"oid": "3cba1f71fcfedb8d60185268cfdbf1e8442ac4f3", "url": "https://github.com/Slimefun/Slimefun4/commit/3cba1f71fcfedb8d60185268cfdbf1e8442ac4f3", "message": "Fixed an issue created by another pr.", "committedDate": "2020-06-24T19:46:02Z", "type": "commit"}]}