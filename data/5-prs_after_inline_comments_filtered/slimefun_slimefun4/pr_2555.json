{"pr_number": 2555, "pr_title": "Fixed a bug of Duplicate items with BlockPlacer", "pr_createdAt": "2020-11-17T00:07:45Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/2555", "timeline": [{"oid": "3db77a008166c6f61bb9360f2905f754e05cf6cc", "url": "https://github.com/Slimefun/Slimefun4/commit/3db77a008166c6f61bb9360f2905f754e05cf6cc", "message": "Fixed a bug of Duplicate items with BlockPlacer\n\nFixed a bug of Duplicate items with BlockPlacer's delay\r\non BlockPlacer place an item, just take out the item when it place,then one in hand and \r\nanother is placed", "committedDate": "2020-11-17T00:01:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTM3Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805373", "bodyText": "Formatting, please adhere to our code style guidelines, there should be a space after the if and before the curly bracket {", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T00:27:04Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -146,6 +146,10 @@ private boolean isBlacklisted(Material type) {\n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){", "originalCommit": "3db77a008166c6f61bb9360f2905f754e05cf6cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTM5MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805391", "bodyText": "Formatting, please adhere to our code style guidelines, there should be a space after the if and before the curly bracket {", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T00:27:07Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -182,6 +186,10 @@ private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block\n     private void placeBlock(ItemStack item, Block facedBlock, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, facedBlock);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){", "originalCommit": "3db77a008166c6f61bb9360f2905f754e05cf6cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTcwMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805700", "bodyText": "There is no point in calling an Event when it gets cancelled anyway.\nThe whole point of the Event contract is that others get a say in the outcome of the Event, not that their changes get overridden otherwise.\nIf no block gets placed, then there shouldn't even be an Event called.", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T00:28:11Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -146,6 +146,10 @@ private boolean isBlacklisted(Material type) {\n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){\n+        \te.setCancelled(true);", "originalCommit": "3db77a008166c6f61bb9360f2905f754e05cf6cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTczOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524805739", "bodyText": "There is no point in calling an Event when it gets cancelled anyway.\nThe whole point of the Event contract is that others get a say in the outcome of the Event, not that their changes get overridden otherwise.\nIf no block gets placed, then there shouldn't even be an Event called.", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T00:28:20Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -182,6 +186,10 @@ private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block\n     private void placeBlock(ItemStack item, Block facedBlock, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, facedBlock);\n         Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(!dispenser.getInventory().getViewers().isEmpty()){\n+        \te.setCancelled(true);", "originalCommit": "3db77a008166c6f61bb9360f2905f754e05cf6cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgxODU0Ng==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r524818546", "bodyText": "Sorry, but the event has been called at Bukkit.getPluginManager().callEvent(e).\nso we can add if before it", "author": "LobbyTech-MC", "createdAt": "2020-11-17T01:07:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDgwNTczOQ=="}], "type": "inlineReview"}, {"oid": "965e34869568b3fa4850253ccdfe2e8582ea0c91", "url": "https://github.com/Slimefun/Slimefun4/commit/965e34869568b3fa4850253ccdfe2e8582ea0c91", "message": "Update BlockPlacer.java", "committedDate": "2020-11-17T01:13:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3MzE1MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525073151", "bodyText": "Still formatting...", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T11:11:29Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -145,7 +145,10 @@ private boolean isBlacklisted(Material type) {\n \n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {", "originalCommit": "965e34869568b3fa4850253ccdfe2e8582ea0c91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3MzYzMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525073630", "bodyText": "Putting this here makes absolutely no sense.\nThe only thing it would do is break all other plugins and allow for many other duplications.", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T11:12:19Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -145,7 +145,10 @@ private boolean isBlacklisted(Material type) {\n \n     private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, block);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {\n+        \tBukkit.getPluginManager().callEvent(e);", "originalCommit": "965e34869568b3fa4850253ccdfe2e8582ea0c91", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NDY3NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525074675", "bodyText": "You cannot just make only the event calling conditional. The check must occur far before any Event is even called, so better before these methods are even invoked in the first place.\nAlso, you should really test your changes before-hand.", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T11:14:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3MzYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTA3NDc0NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2555#discussion_r525074744", "bodyText": "Still formatting...", "author": "TheBusyBiscuit", "createdAt": "2020-11-17T11:14:18Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/blocks/BlockPlacer.java", "diffHunk": "@@ -181,7 +184,10 @@ private void placeSlimefunBlock(SlimefunItem sfItem, ItemStack item, Block block\n \n     private void placeBlock(ItemStack item, Block facedBlock, Dispenser dispenser) {\n         BlockPlacerPlaceEvent e = new BlockPlacerPlaceEvent(dispenser.getBlock(), item, facedBlock);\n-        Bukkit.getPluginManager().callEvent(e);\n+        \n+        if(dispenser.getInventory().getViewers().isEmpty()) {", "originalCommit": "965e34869568b3fa4850253ccdfe2e8582ea0c91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d76f77cd84d793e5ac51fffabf17ec79dbb1185a", "url": "https://github.com/Slimefun/Slimefun4/commit/d76f77cd84d793e5ac51fffabf17ec79dbb1185a", "message": "Update BlockPlacer.java", "committedDate": "2020-11-18T01:21:59Z", "type": "commit"}, {"oid": "024dbf4fc55098d662f149f911240e74dd4cc604", "url": "https://github.com/Slimefun/Slimefun4/commit/024dbf4fc55098d662f149f911240e74dd4cc604", "message": "Update BlockPlacer.java", "committedDate": "2020-11-18T01:37:54Z", "type": "commit"}]}