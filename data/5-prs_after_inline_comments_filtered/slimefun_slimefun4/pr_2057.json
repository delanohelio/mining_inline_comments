{"pr_number": 2057, "pr_title": "Added Bee Protection to Hazmat Suit.", "pr_createdAt": "2020-06-26T20:19:54Z", "pr_url": "https://github.com/Slimefun/Slimefun4/pull/2057", "timeline": [{"oid": "cd4a36c519702f21e7ae0affc853695557cbb821", "url": "https://github.com/Slimefun/Slimefun4/commit/cd4a36c519702f21e7ae0affc853695557cbb821", "message": "Added Bee Protection to Hazmat Suit.", "committedDate": "2020-06-26T20:18:27Z", "type": "commit"}, {"oid": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "url": "https://github.com/Slimefun/Slimefun4/commit/29fe88176873b8eb7cf791d0caab0ab53644a6a4", "message": "Added a new lore to Hazmat Suit for 1.15+", "committedDate": "2020-06-26T20:31:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMTk4OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446421988", "bodyText": "The see attribute shouldn't really be used for external classes, please only use it for Slimefun classes.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:37:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/HazmatSuitListener.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ * @see Bee", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMjI3Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446422273", "bodyText": "Should probably rename this to BeeListener, since it only checks for Bees and has rather few to do with the actual mechanics of the HazmatSuit.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:38:51Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/HazmatSuitListener.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ * @see Bee\n+ *\n+ */\n+public class HazmatSuitListener implements Listener {", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMjg3NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446422875", "bodyText": "Performance-wise this is a rather careless design choice. You should put this if-statement in front of initializing this Listener in the first place (in SlimefunPlugin.java), otherwise you are registering a completely unnecessary Listener.\nAnd let's be honest... the Minecraft version won't change from one minute to another.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:40:32Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/HazmatSuitListener.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ * @see Bee\n+ *\n+ */\n+public class HazmatSuitListener implements Listener {\n+\n+    public HazmatSuitListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (!SlimefunPlugin.getMinecraftVersion().isAtLeast(MinecraftVersion.MINECRAFT_1_15)) return;", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzEyOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446423129", "bodyText": "This is a really expensive check and should not be done this way.\nCheck the ArmorTask class, there are already optimizations for the Hazmat Suit in place.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:41:15Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/HazmatSuitListener.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.MinecraftVersion;\n+import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ * @see Bee\n+ *\n+ */\n+public class HazmatSuitListener implements Listener {\n+\n+    public HazmatSuitListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (!SlimefunPlugin.getMinecraftVersion().isAtLeast(MinecraftVersion.MINECRAFT_1_15)) return;\n+\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {\n+                Player p = (Player) e.getEntity();\n+\n+                int hazmatCount = 0;\n+                for (ItemStack armor : p.getInventory().getArmorContents()) {\n+                    SlimefunItem sfItem = SlimefunItem.getByItem(armor);\n+                    if (sfItem == null) return;\n+\n+                    String id = sfItem.getID();\n+                    if (id.equals(\"SCUBA_HELMET\")) hazmatCount++;\n+                    if (id.equals(\"HAZMAT_CHESTPLATE\")) hazmatCount++;\n+                    if (id.equals(\"HAZMAT_LEGGINGS\")) hazmatCount++;\n+                    if (id.equals(\"RUBBER_BOOTS\")) hazmatCount++;\n+                }", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzMwMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446423302", "bodyText": "This should be renamed and gated behind an if statement (see my review comments on this Listener class)", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:41:42Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/SlimefunPlugin.java", "diffHunk": "@@ -237,6 +238,7 @@ else if (getServer().getPluginManager().isPluginEnabled(\"CS-CoreLib\")) {\n             new WitherListener(this);\n             new IronGolemListener(this);\n             new PlayerInteractEntityListener(this);\n+            new HazmatSuitListener(this);", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzM5NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446423394", "bodyText": "ItemMeta cannot be null.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:41:58Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/SlimefunItemStack.java", "diffHunk": "@@ -245,4 +246,20 @@ else if (PatternUtils.ALPHANUMERIC.matcher(texture).matches()) {\n         }\n     }\n \n+    /**\n+     * Adds additional lores for the {@link ItemStack}.\n+     *\n+     * @param newLore\n+     *                New lores to be added to the {@link ItemStack}\n+     */\n+    public void addLore(String... newLore) {\n+        ItemMeta meta = getItemMeta();\n+        if (meta == null) return;", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQzMTM5OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446431398", "bodyText": "I'm almost sure it could be in 1.13. Or it's my bad memory", "author": "LinoxGH", "createdAt": "2020-06-26T22:07:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzM5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzUxOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446423519", "bodyText": "You should check .hasItemMeta() before this, otherwise you are computing wasteful objects.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:42:21Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/SlimefunItemStack.java", "diffHunk": "@@ -245,4 +246,20 @@ else if (PatternUtils.ALPHANUMERIC.matcher(texture).matches()) {\n         }\n     }\n \n+    /**\n+     * Adds additional lores for the {@link ItemStack}.\n+     *\n+     * @param newLore\n+     *                New lores to be added to the {@link ItemStack}\n+     */\n+    public void addLore(String... newLore) {\n+        ItemMeta meta = getItemMeta();", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzYwMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446423602", "bodyText": "This is not good. Use .hasLore() instead.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:42:36Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/SlimefunItemStack.java", "diffHunk": "@@ -245,4 +246,20 @@ else if (PatternUtils.ALPHANUMERIC.matcher(texture).matches()) {\n         }\n     }\n \n+    /**\n+     * Adds additional lores for the {@link ItemStack}.\n+     *\n+     * @param newLore\n+     *                New lores to be added to the {@link ItemStack}\n+     */\n+    public void addLore(String... newLore) {\n+        ItemMeta meta = getItemMeta();\n+        if (meta == null) return;\n+        List<String> oldLore = meta.getLore();\n+        if (oldLore == null) return;", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQyMzkxOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446423919", "bodyText": "I don't really think this method is useful here, I'd argue this should be removed and just done manually or via the Consumer in the constructor.", "author": "TheBusyBiscuit", "createdAt": "2020-06-26T21:43:30Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/SlimefunItemStack.java", "diffHunk": "@@ -245,4 +246,20 @@ else if (PatternUtils.ALPHANUMERIC.matcher(texture).matches()) {\n         }\n     }\n \n+    /**\n+     * Adds additional lores for the {@link ItemStack}.\n+     *\n+     * @param newLore\n+     *                New lores to be added to the {@link ItemStack}\n+     */\n+    public void addLore(String... newLore) {", "originalCommit": "29fe88176873b8eb7cf791d0caab0ab53644a6a4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ffd57ec760cd2fb977a67bb8d84b9190dd2485ac", "url": "https://github.com/Slimefun/Slimefun4/commit/ffd57ec760cd2fb977a67bb8d84b9190dd2485ac", "message": "Did the requested Changes", "committedDate": "2020-06-26T22:51:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2MjA0NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446462045", "bodyText": "This statement is the wrong way around, you are checking for the opposite, so remove the negations here.\nAlso the armor item and the SlimefunItem need to be swapped too.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T00:39:21Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunItems;\n+import io.github.thebusybiscuit.slimefun4.utils.SlimefunUtils;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {\n+                Player p = (Player) e.getEntity();\n+\n+                // Check for a Hazmat Suit\n+                if (!SlimefunUtils.isItemSimilar(SlimefunItems.SCUBA_HELMET, p.getInventory().getHelmet(), true) &&\n+                        !SlimefunUtils.isItemSimilar(SlimefunItems.HAZMAT_CHESTPLATE, p.getInventory().getChestplate(), true) &&\n+                        !SlimefunUtils.isItemSimilar(SlimefunItems.HAZMAT_LEGGINGS, p.getInventory().getLeggings(), true) &&\n+                        !SlimefunUtils.isItemSimilar(SlimefunItems.RUBBER_BOOTS, p.getInventory().getBoots(), true)) {", "originalCommit": "ffd57ec760cd2fb977a67bb8d84b9190dd2485ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4NTIwMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446485202", "bodyText": "Right I didn't notice the !s there it's a copy-paste lol", "author": "LinoxGH", "createdAt": "2020-06-27T04:55:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2MjA0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2MjA5NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446462095", "bodyText": "Why are you doing this instead of cancelling the event?", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T00:39:37Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,47 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunItems;\n+import io.github.thebusybiscuit.slimefun4.utils.SlimefunUtils;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {\n+                Player p = (Player) e.getEntity();\n+\n+                // Check for a Hazmat Suit\n+                if (!SlimefunUtils.isItemSimilar(SlimefunItems.SCUBA_HELMET, p.getInventory().getHelmet(), true) &&\n+                        !SlimefunUtils.isItemSimilar(SlimefunItems.HAZMAT_CHESTPLATE, p.getInventory().getChestplate(), true) &&\n+                        !SlimefunUtils.isItemSimilar(SlimefunItems.HAZMAT_LEGGINGS, p.getInventory().getLeggings(), true) &&\n+                        !SlimefunUtils.isItemSimilar(SlimefunItems.RUBBER_BOOTS, p.getInventory().getBoots(), true)) {\n+                    e.setDamage(0D);", "originalCommit": "ffd57ec760cd2fb977a67bb8d84b9190dd2485ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ4NTI1Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446485253", "bodyText": "When you cancel the event bee just keeps trying. And doesn't die", "author": "LinoxGH", "createdAt": "2020-06-27T04:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2MjA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjQ2MjE1OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446462158", "bodyText": "Random unused import", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T00:40:01Z", "path": "src/main/java/me/mrCookieSlime/Slimefun/api/SlimefunItemStack.java", "diffHunk": "@@ -2,6 +2,7 @@\n \n import java.nio.charset.StandardCharsets;\n import java.util.ArrayList;\n+import java.util.Arrays;", "originalCommit": "ffd57ec760cd2fb977a67bb8d84b9190dd2485ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "52dc7585fcf3b368e46f35e704b8770b2d59ab38", "url": "https://github.com/Slimefun/Slimefun4/commit/52dc7585fcf3b368e46f35e704b8770b2d59ab38", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4 into HazmatSuitBees\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "committedDate": "2020-06-27T05:09:09Z", "type": "commit"}, {"oid": "73973a00b722b897449a91a9bdf2fd246eb94c53", "url": "https://github.com/Slimefun/Slimefun4/commit/73973a00b722b897449a91a9bdf2fd246eb94c53", "message": "Did the requested changes and some fixes.", "committedDate": "2020-06-27T09:26:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTI1Mg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446509252", "bodyText": "Just pass the Player as an argument, this will perform a lengthy UUID lookup.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T10:12:41Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -119,9 +120,26 @@ private boolean hasSunlight(Player p) {\n         return (world.getTime() < 12300 || world.getTime() > 23850) && p.getEyeLocation().getBlock().getLightFromSky() == 15;\n     }\n \n-    private void checkForRadiation(Player p) {\n+    private void checkForRadiation(PlayerProfile profile) {\n+        HashedArmorpiece[] armor = profile.getArmor();\n+        Player p = profile.getPlayer();", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTMyNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446509326", "bodyText": "I very much like the transition of the Hazmat suit to the SlimefunArmorPiece system!\nBut I am not the greatest fan of id-comparison.\nBest would be to create a new ItemAttribute, like \"HazmatProtection\" and then create a HazmatSuit class which extends SlimefunArmorpiece and implements that attribute.\nThis way we don't have to rely on hardcoded ids and are flexible in terms of adding more hazmat suits in the future.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T10:13:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -119,9 +120,26 @@ private boolean hasSunlight(Player p) {\n         return (world.getTime() < 12300 || world.getTime() > 23850) && p.getEyeLocation().getBlock().getLightFromSky() == 15;\n     }\n \n-    private void checkForRadiation(Player p) {\n+    private void checkForRadiation(PlayerProfile profile) {\n+        HashedArmorpiece[] armor = profile.getArmor();\n+        Player p = profile.getPlayer();\n+\n         // Check for a Hazmat Suit\n-        if (!SlimefunUtils.isItemSimilar(p.getInventory().getHelmet(), SlimefunItems.SCUBA_HELMET, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getChestplate(), SlimefunItems.HAZMAT_CHESTPLATE, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getLeggings(), SlimefunItems.HAZMAT_LEGGINGS, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getBoots(), SlimefunItems.RUBBER_BOOTS, true)) {\n+        boolean hasHazmat = false;\n+        for (HashedArmorpiece armorPiece : armor) {\n+\n+            Optional<SlimefunArmorPiece> sfArmor = armorPiece.getItem();\n+            if (!sfArmor.isPresent()) continue;\n+\n+            if (sfArmor.get().getID().equals(\"SCUBA_HELMET\") ||\n+                    sfArmor.get().getID().equals(\"HAZMAT_CHESTPLATE\") ||\n+                    sfArmor.get().getID().equals(\"HAZMAT_LEGGINGS\") ||\n+                    sfArmor.get().getID().equals(\"RUBBER_BOOTS\")) {\n+                hasHazmat = true;", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTM4Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446509383", "bodyText": "Also since you are only checking for ANY hazmat piece, you can break the loop here.\nOr even better, make a seperate method with a boolean return type for this.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T10:14:30Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -119,9 +120,26 @@ private boolean hasSunlight(Player p) {\n         return (world.getTime() < 12300 || world.getTime() > 23850) && p.getEyeLocation().getBlock().getLightFromSky() == 15;\n     }\n \n-    private void checkForRadiation(Player p) {\n+    private void checkForRadiation(PlayerProfile profile) {\n+        HashedArmorpiece[] armor = profile.getArmor();\n+        Player p = profile.getPlayer();\n+\n         // Check for a Hazmat Suit\n-        if (!SlimefunUtils.isItemSimilar(p.getInventory().getHelmet(), SlimefunItems.SCUBA_HELMET, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getChestplate(), SlimefunItems.HAZMAT_CHESTPLATE, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getLeggings(), SlimefunItems.HAZMAT_LEGGINGS, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getBoots(), SlimefunItems.RUBBER_BOOTS, true)) {\n+        boolean hasHazmat = false;\n+        for (HashedArmorpiece armorPiece : armor) {\n+\n+            Optional<SlimefunArmorPiece> sfArmor = armorPiece.getItem();\n+            if (!sfArmor.isPresent()) continue;\n+\n+            if (sfArmor.get().getID().equals(\"SCUBA_HELMET\") ||\n+                    sfArmor.get().getID().equals(\"HAZMAT_CHESTPLATE\") ||\n+                    sfArmor.get().getID().equals(\"HAZMAT_LEGGINGS\") ||\n+                    sfArmor.get().getID().equals(\"RUBBER_BOOTS\")) {\n+                hasHazmat = true;", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTQxMA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446509410", "bodyText": "Same as below, in regards to the hardcoded ids.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T10:14:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import java.util.Optional;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.items.HashedArmorpiece;\n+import io.github.thebusybiscuit.slimefun4.api.player.PlayerProfile;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {\n+                Player p = (Player) e.getEntity();\n+                PlayerProfile.get(p, profile -> {\n+\n+                    HashedArmorpiece[] armors = profile.getArmor();\n+                    if (hasFullHazmat(armors)) {\n+                        for (ItemStack armor : p.getInventory().getArmorContents()) {\n+                            ItemUtils.damageItem(armor, 1, false);\n+                        }\n+                        e.setDamage(0D);\n+                    }\n+                });\n+            }\n+        }\n+    }\n+\n+    private boolean hasFullHazmat(HashedArmorpiece[] armors) {\n+        int hazmatCount = 0;\n+\n+        // Check for a Hazmat Suit\n+        for (HashedArmorpiece armor : armors) {\n+            Optional<SlimefunArmorPiece> armorPiece = armor.getItem();\n+            if (!armorPiece.isPresent()) return false;\n+\n+            if (armorPiece.get().getID().equals(\"SCUBA_HELMET\") ||\n+                    armorPiece.get().getID().equals(\"HAZMAT_CHESTPLATE\") ||\n+                    armorPiece.get().getID().equals(\"HAZMAT_LEGGINGS\") ||\n+                    armorPiece.get().getID().equals(\"RUBBER_BOOTS\")) {\n+                hazmatCount++;\n+            }", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMDAxMg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446510012", "bodyText": "This is an asynchronous operation, so you should NOT do e.setDamage() here, as it will have no effect when this is delayed.\nYou need to the following instead:\nOptional<PlayerProfile> optional = PlayerProfile.find(p);\nif (!optional .isPresent()) {\n  PlayerProfile.request(p);\n  return;\n}\n\nPlayerProfile profile = optional.get();\n// Do stuff...\nThis will ensure that we don't access the PlayerProfile asynchronously, which will lead to problems.\nAnd only execute the code if it's synced.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T10:22:15Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import java.util.Optional;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.items.HashedArmorpiece;\n+import io.github.thebusybiscuit.slimefun4.api.player.PlayerProfile;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {\n+                Player p = (Player) e.getEntity();\n+                PlayerProfile.get(p, profile -> {\n+\n+                    HashedArmorpiece[] armors = profile.getArmor();\n+                    if (hasFullHazmat(armors)) {\n+                        for (ItemStack armor : p.getInventory().getArmorContents()) {\n+                            ItemUtils.damageItem(armor, 1, false);\n+                        }\n+                        e.setDamage(0D);\n+                    }\n+                });", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTg3OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446509878", "bodyText": "This is in an async operation, this will happen AFTER the event has fired and therefore have no change.", "author": "WalshyDev", "createdAt": "2020-06-27T10:20:19Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import java.util.Optional;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.items.HashedArmorpiece;\n+import io.github.thebusybiscuit.slimefun4.api.player.PlayerProfile;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {\n+                Player p = (Player) e.getEntity();\n+                PlayerProfile.get(p, profile -> {\n+\n+                    HashedArmorpiece[] armors = profile.getArmor();\n+                    if (hasFullHazmat(armors)) {\n+                        for (ItemStack armor : p.getInventory().getArmorContents()) {\n+                            ItemUtils.damageItem(armor, 1, false);\n+                        }\n+                        e.setDamage(0D);", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUwOTkwNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446509906", "bodyText": "Useless nested if. &&", "author": "WalshyDev", "createdAt": "2020-06-27T10:20:41Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,68 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import java.util.Optional;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.items.HashedArmorpiece;\n+import io.github.thebusybiscuit.slimefun4.api.player.PlayerProfile;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+import me.mrCookieSlime.Slimefun.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee) {\n+            if (e.getEntity() instanceof Player) {", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMDA2MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446510061", "bodyText": "This should only be true if all items are hazmat gear. Right now, this is not the case.", "author": "WalshyDev", "createdAt": "2020-06-27T10:22:46Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -119,9 +120,26 @@ private boolean hasSunlight(Player p) {\n         return (world.getTime() < 12300 || world.getTime() > 23850) && p.getEyeLocation().getBlock().getLightFromSky() == 15;\n     }\n \n-    private void checkForRadiation(Player p) {\n+    private void checkForRadiation(PlayerProfile profile) {\n+        HashedArmorpiece[] armor = profile.getArmor();\n+        Player p = profile.getPlayer();\n+\n         // Check for a Hazmat Suit\n-        if (!SlimefunUtils.isItemSimilar(p.getInventory().getHelmet(), SlimefunItems.SCUBA_HELMET, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getChestplate(), SlimefunItems.HAZMAT_CHESTPLATE, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getLeggings(), SlimefunItems.HAZMAT_LEGGINGS, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getBoots(), SlimefunItems.RUBBER_BOOTS, true)) {\n+        boolean hasHazmat = false;\n+        for (HashedArmorpiece armorPiece : armor) {\n+\n+            Optional<SlimefunArmorPiece> sfArmor = armorPiece.getItem();\n+            if (!sfArmor.isPresent()) continue;\n+\n+            if (sfArmor.get().getID().equals(\"SCUBA_HELMET\") ||\n+                    sfArmor.get().getID().equals(\"HAZMAT_CHESTPLATE\") ||\n+                    sfArmor.get().getID().equals(\"HAZMAT_LEGGINGS\") ||\n+                    sfArmor.get().getID().equals(\"RUBBER_BOOTS\")) {\n+                hasHazmat = true;", "originalCommit": "73973a00b722b897449a91a9bdf2fd246eb94c53", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMTY0NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446511645", "bodyText": "It never worked like that though. Only 1 piece always protected you from radiation. Idk if it's a bug but players could just do half slime armor and half hazmat suit for:\n\nWater Breathing\nFire Resistance\nRadiation Resistance\nJump Boost\nSpeed Boost\n\nEven I use that set when I play.", "author": "LinoxGH", "createdAt": "2020-06-27T10:43:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMDA2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMjA5Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446512093", "bodyText": "This is the radiation protection check though. And for that you ALWAYS needed the full set, as seen here, before you changed this behaviour:\nhttps://github.com/TheBusyBiscuit/Slimefun4/blob/master/src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java#L124\nIf any piece is missing, the radiation check continues.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T10:49:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUxMDA2MQ=="}], "type": "inlineReview"}, {"oid": "b5ef8ff019f0af88e96cb03330dfb9d4ba12ac0d", "url": "https://github.com/Slimefun/Slimefun4/commit/b5ef8ff019f0af88e96cb03330dfb9d4ba12ac0d", "message": "Did the requested changes + improvements.", "committedDate": "2020-06-27T12:58:36Z", "type": "commit"}, {"oid": "ba0c3b30ddabdb5325c5aab1dc6fc35f61db7329", "url": "https://github.com/Slimefun/Slimefun4/commit/ba0c3b30ddabdb5325c5aab1dc6fc35f61db7329", "message": "Merge branch 'master' of https://github.com/TheBusyBiscuit/Slimefun4 into HazmatSuitBees\n\n\u0001 Conflicts:\n\u0001\tsrc/main/java/me/mrCookieSlime/Slimefun/SlimefunPlugin.java", "committedDate": "2020-06-27T13:01:36Z", "type": "commit"}, {"oid": "a456034005cc99cd89aacd91c5842609dce50ba8", "url": "https://github.com/Slimefun/Slimefun4/commit/a456034005cc99cd89aacd91c5842609dce50ba8", "message": "Fixed merge conflicts.", "committedDate": "2020-06-27T13:07:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTI2NQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525265", "bodyText": "Please don't declare an enum inside the interface. Make a seperate file for this...", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:09:42Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/CustomProtection.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.entity.EntityDamageEvent;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.HazmatArmorPiece;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+\n+/**\n+ * Implement this interface for any {@link SlimefunArmorPiece} to prevent\n+ * the {@link Player} wearing that {@link SlimefunArmorPiece}\n+ *\n+ * <b>Important</b>: This will not cancel any {@link EntityDamageEvent}.\n+ * It will simply prevent Slimefun from ever applying {@link ProtectionType}\n+ * to this {@link SlimefunArmorPiece}'s wearer.\n+ *\n+ * @author Linox\n+ *\n+ * @see SlimefunArmorPiece\n+ * @see HazmatArmorPiece\n+ * @see ItemAttribute\n+ *\n+ */\n+public interface CustomProtection extends ItemAttribute {\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.\n+     *\n+     * @return The {@link ProtectionType}s\n+     */\n+    ProtectionType[] getProtectionTypes();\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.\n+     *\n+     * @return The {@link ProtectionType}s\n+     */\n+    boolean requireFullSet();\n+\n+    enum ProtectionType {\n+\n+        RADIATION,\n+\n+        BEES;\n+    }", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTMyMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525321", "bodyText": "This is a bit misleading, should probably be \"isFullSetRequired()\".", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:10:06Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/CustomProtection.java", "diffHunk": "@@ -0,0 +1,48 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.entity.EntityDamageEvent;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.HazmatArmorPiece;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+\n+/**\n+ * Implement this interface for any {@link SlimefunArmorPiece} to prevent\n+ * the {@link Player} wearing that {@link SlimefunArmorPiece}\n+ *\n+ * <b>Important</b>: This will not cancel any {@link EntityDamageEvent}.\n+ * It will simply prevent Slimefun from ever applying {@link ProtectionType}\n+ * to this {@link SlimefunArmorPiece}'s wearer.\n+ *\n+ * @author Linox\n+ *\n+ * @see SlimefunArmorPiece\n+ * @see HazmatArmorPiece\n+ * @see ItemAttribute\n+ *\n+ */\n+public interface CustomProtection extends ItemAttribute {\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.\n+     *\n+     * @return The {@link ProtectionType}s\n+     */\n+    ProtectionType[] getProtectionTypes();\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.\n+     *\n+     * @return The {@link ProtectionType}s\n+     */\n+    boolean requireFullSet();", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTQ0OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525449", "bodyText": "Please use a NamespacedKey for this rather than a String, otherwise you could run into ID conflicts.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:11:39Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/SlimefunArmorPiece.java", "diffHunk": "@@ -29,4 +36,12 @@ public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType\n         return effects;\n     }\n \n+    /**\n+     * This returns the armor set ID of this {@link SlimefunArmorPiece}.\n+     *\n+     * @return The set ID, <code>null</code> if no set ID is found.\n+     */\n+    public String getSetID() {\n+        return setID;\n+    }", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTQ2Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525463", "bodyText": "Also: \"Id\", not \"ID\".", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:11:50Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/SlimefunArmorPiece.java", "diffHunk": "@@ -29,4 +36,12 @@ public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType\n         return effects;\n     }\n \n+    /**\n+     * This returns the armor set ID of this {@link SlimefunArmorPiece}.\n+     *\n+     * @return The set ID, <code>null</code> if no set ID is found.\n+     */\n+    public String getSetID() {", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTQ4OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525489", "bodyText": "\"isProtected\" sounds more appropriate.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:12:11Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,85 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import java.util.Optional;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.items.HashedArmorpiece;\n+import io.github.thebusybiscuit.slimefun4.api.player.PlayerProfile;\n+import io.github.thebusybiscuit.slimefun4.core.attributes.CustomProtection;\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunPlugin;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee && e.getEntity() instanceof Player) {\n+\n+            Player p = (Player) e.getEntity();\n+            Optional<PlayerProfile> optional = PlayerProfile.find(p);\n+            if (!optional.isPresent()) {\n+                PlayerProfile.request(p);\n+                return;\n+            }\n+            PlayerProfile profile = optional.get();\n+\n+            HashedArmorpiece[] armors = profile.getArmor();\n+            if (shouldProtect(armors)) {\n+                for (ItemStack armor : p.getInventory().getArmorContents()) {\n+                    ItemUtils.damageItem(armor, 1, false);\n+                }\n+                e.setDamage(0D);\n+            }\n+        }\n+    }\n+\n+    private boolean shouldProtect(HashedArmorpiece[] armors) {", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTUzNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525535", "bodyText": "*Radiation, not Radioactive.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:12:41Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -119,18 +121,19 @@ private boolean hasSunlight(Player p) {\n         return (world.getTime() < 12300 || world.getTime() > 23850) && p.getEyeLocation().getBlock().getLightFromSky() == 15;\n     }\n \n-    private void checkForRadiation(Player p) {\n-        // Check for a Hazmat Suit\n-        if (!SlimefunUtils.isItemSimilar(p.getInventory().getHelmet(), SlimefunItems.SCUBA_HELMET, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getChestplate(), SlimefunItems.HAZMAT_CHESTPLATE, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getLeggings(), SlimefunItems.HAZMAT_LEGGINGS, true) || !SlimefunUtils.isItemSimilar(p.getInventory().getBoots(), SlimefunItems.RUBBER_BOOTS, true)) {\n+    private void checkForRadiation(Player p, PlayerProfile profile) {\n+        HashedArmorpiece[] armor = profile.getArmor();\n+\n+        if (!shouldProtect(armor)) {\n             for (ItemStack item : p.getInventory()) {\n-                if (isRadioactive(p, item)) {\n+                if (checkAndApplyRadioactive(p, item)) {\n                     break;\n                 }\n             }\n         }\n     }\n \n-    private boolean isRadioactive(Player p, ItemStack item) {\n+    private boolean checkAndApplyRadioactive(Player p, ItemStack item) {", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyODM3OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446528378", "bodyText": "thats how it was", "author": "LinoxGH", "createdAt": "2020-06-27T13:46:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTUzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTU2OQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525569", "bodyText": "\"isProtected\" sounds better here.\nAlso since you are reusing this method twice... It may make sense to make a more general method for this inside PlayerProfile.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:13:16Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -148,4 +151,35 @@ private boolean isRadioactive(Player p, ItemStack item) {\n         return false;\n     }\n \n+    private boolean shouldProtect(HashedArmorpiece[] armors) {", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTYwNw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446525607", "bodyText": "Is the id even required in the first place?\nI think it would make more sense to have a \"ProtectionType\" argument for this method and check if all 4 protect against this.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T13:13:50Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/tasks/ArmorTask.java", "diffHunk": "@@ -148,4 +151,35 @@ private boolean isRadioactive(Player p, ItemStack item) {\n         return false;\n     }\n \n+    private boolean shouldProtect(HashedArmorpiece[] armors) {\n+        int armorCount = 0;\n+        boolean first = true;\n+\n+        String setID = null;\n+        for (HashedArmorpiece armor : armors) {\n+            Optional<SlimefunArmorPiece> armorPiece = armor.getItem();\n+            if (!armorPiece.isPresent()) return false;\n+\n+            if (armorPiece.get() instanceof CustomProtection) {\n+                CustomProtection protectedArmor = (CustomProtection) armorPiece.get();\n+\n+                if (first) {\n+                    if (protectedArmor.requireFullSet()) setID = armorPiece.get().getSetID();", "originalCommit": "a456034005cc99cd89aacd91c5842609dce50ba8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyODQ4NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446528484", "bodyText": "I wanted to allow people to create sets that only required 1 part for the protection", "author": "LinoxGH", "createdAt": "2020-06-27T13:47:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjUyNTYwNw=="}], "type": "inlineReview"}, {"oid": "64a1b247b4518577a32006ce1692218a5399af52", "url": "https://github.com/Slimefun/Slimefun4/commit/64a1b247b4518577a32006ce1692218a5399af52", "message": "Did the requested changes + fixes.", "committedDate": "2020-06-27T14:30:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MDEyNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446570125", "bodyText": "Some documentation here would be nice.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T21:41:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/ProtectionType.java", "diffHunk": "@@ -0,0 +1,8 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+public enum ProtectionType {\n+\n+    RADIATION,\n+    BEES;\n+\n+}", "originalCommit": "64a1b247b4518577a32006ce1692218a5399af52", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MDE4MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446570181", "bodyText": "Is the setID here really required? shouldn't it be slimefun:hazmat by default for this class?", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T21:42:53Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/HazmatArmorPiece.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.items.armor;\n+\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.potion.PotionEffect;\n+\n+import io.github.thebusybiscuit.slimefun4.core.attributes.CustomProtection;\n+import io.github.thebusybiscuit.slimefun4.core.attributes.ProtectionType;\n+import me.mrCookieSlime.Slimefun.Lists.RecipeType;\n+import me.mrCookieSlime.Slimefun.Objects.Category;\n+import me.mrCookieSlime.Slimefun.api.SlimefunItemStack;\n+\n+public class HazmatArmorPiece extends SlimefunArmorPiece implements CustomProtection {\n+\n+    private final ProtectionType[] types;\n+\n+    public HazmatArmorPiece(Category category, SlimefunItemStack item, RecipeType recipeType, ItemStack[] recipe, PotionEffect[] effects, String setID) {\n+        super(category, item, recipeType, recipe, effects, setID);", "originalCommit": "64a1b247b4518577a32006ce1692218a5399af52", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MTQyMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446571421", "bodyText": "Thought an addon may extend this but mkay changing it.", "author": "LinoxGH", "createdAt": "2020-06-27T21:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MDE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MDE4NA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446570184", "bodyText": "Missing documentation.", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T21:42:59Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/HazmatArmorPiece.java", "diffHunk": "@@ -0,0 +1,31 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.items.armor;\n+\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.potion.PotionEffect;\n+\n+import io.github.thebusybiscuit.slimefun4.core.attributes.CustomProtection;\n+import io.github.thebusybiscuit.slimefun4.core.attributes.ProtectionType;\n+import me.mrCookieSlime.Slimefun.Lists.RecipeType;\n+import me.mrCookieSlime.Slimefun.Objects.Category;\n+import me.mrCookieSlime.Slimefun.api.SlimefunItemStack;\n+\n+public class HazmatArmorPiece extends SlimefunArmorPiece implements CustomProtection {", "originalCommit": "64a1b247b4518577a32006ce1692218a5399af52", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MDIwNg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446570206", "bodyText": "Please use a NamespacedKey instead of a String for the setId...", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T21:43:19Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/SlimefunArmorPiece.java", "diffHunk": "@@ -19,6 +22,12 @@ public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType\n         this.effects = effects == null ? new PotionEffect[0] : effects;\n     }\n \n+    public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType recipeType, ItemStack[] recipe, PotionEffect[] effects, String setId) {", "originalCommit": "64a1b247b4518577a32006ce1692218a5399af52", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MDIxOQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446570219", "bodyText": "Using Slimefun's instance here defeats the entire purpose of a NamespacedKey...", "author": "TheBusyBiscuit", "createdAt": "2020-06-27T21:43:37Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/SlimefunArmorPiece.java", "diffHunk": "@@ -19,6 +22,12 @@ public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType\n         this.effects = effects == null ? new PotionEffect[0] : effects;\n     }\n \n+    public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType recipeType, ItemStack[] recipe, PotionEffect[] effects, String setId) {\n+        this(category, item, recipeType, recipe, effects);\n+\n+        this.id = new NamespacedKey(SlimefunPlugin.instance, setId);", "originalCommit": "64a1b247b4518577a32006ce1692218a5399af52", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "07d837299ff3feae12eeeb6f37b4891f661a50f6", "url": "https://github.com/Slimefun/Slimefun4/commit/07d837299ff3feae12eeeb6f37b4891f661a50f6", "message": "Did the requested changes.", "committedDate": "2020-06-27T22:07:37Z", "type": "commit"}, {"oid": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "url": "https://github.com/Slimefun/Slimefun4/commit/a935951c229dc1c04646dcd9e72b03b30b81fc6d", "message": "Oops forgot to change these.", "committedDate": "2020-06-27T22:14:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NDg1OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446584858", "bodyText": "This method should probably be moved to your CustomProtection interface and then implemented in the Hazmat class.", "author": "TheBusyBiscuit", "createdAt": "2020-06-28T00:55:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/SlimefunArmorPiece.java", "diffHunk": "@@ -29,4 +37,12 @@ public SlimefunArmorPiece(Category category, SlimefunItemStack item, RecipeType\n         return effects;\n     }\n \n+    /**\n+     * This returns the armor set {@link NamespacedKey} of this {@link SlimefunArmorPiece}.\n+     *\n+     * @return The set {@link NamespacedKey}, <code>null</code> if none is found.\n+     */\n+    public NamespacedKey getSetId() {\n+        return id;\n+    }", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NDk1Mg==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446584952", "bodyText": "This being null here isn't really the best ideas.\nI mean, we only use this key for the CustomProtection armor, so it might make sense to just have the getter in that interface and force the developer to implement this field in their implementation class instead.\nThis way we avoid unnecessary null fields, since those aren't needed in this class here.", "author": "TheBusyBiscuit", "createdAt": "2020-06-28T00:57:24Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/SlimefunArmorPiece.java", "diffHunk": "@@ -1,16 +1,19 @@\n package io.github.thebusybiscuit.slimefun4.implementation.items.armor;\n \n+import org.bukkit.NamespacedKey;\n import org.bukkit.entity.Player;\n import org.bukkit.inventory.ItemStack;\n import org.bukkit.potion.PotionEffect;\n \n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunPlugin;\n import me.mrCookieSlime.Slimefun.Lists.RecipeType;\n import me.mrCookieSlime.Slimefun.Objects.Category;\n import me.mrCookieSlime.Slimefun.Objects.SlimefunItem.SlimefunItem;\n import me.mrCookieSlime.Slimefun.api.SlimefunItemStack;\n \n public class SlimefunArmorPiece extends SlimefunItem {\n \n+    private NamespacedKey id = null;", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjA3MA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586070", "bodyText": "You made a variable for the armour, use it. Also, if you're gonna do a one line if, it's generally only for a short return. This is bad.", "author": "WalshyDev", "createdAt": "2020-06-28T01:14:35Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/api/player/PlayerProfile.java", "diffHunk": "@@ -448,6 +453,39 @@ public static void getBackpack(ItemStack item, Consumer<PlayerBackpack> callback\n         }\n     }\n \n+    public boolean isProtected(ProtectionType type) {\n+        int armorCount = 0;\n+        boolean first = true;\n+\n+        NamespacedKey setId = null;\n+        for (HashedArmorpiece armor : armor) {\n+            Optional<SlimefunArmorPiece> armorPiece = armor.getItem();\n+            if (!armorPiece.isPresent()) return false;\n+\n+            if (armorPiece.get() instanceof CustomProtection) {\n+                CustomProtection protectedArmor = (CustomProtection) armorPiece.get();\n+\n+                if (first) {\n+                    if (protectedArmor.isFullSetRequired()) setId = armorPiece.get().getSetId();", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjE0MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586141", "bodyText": "Instead of a first variable you could literally just check if the ID is null and set it.", "author": "WalshyDev", "createdAt": "2020-06-28T01:15:23Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/api/player/PlayerProfile.java", "diffHunk": "@@ -448,6 +453,39 @@ public static void getBackpack(ItemStack item, Consumer<PlayerBackpack> callback\n         }\n     }\n \n+    public boolean isProtected(ProtectionType type) {\n+        int armorCount = 0;\n+        boolean first = true;\n+\n+        NamespacedKey setId = null;\n+        for (HashedArmorpiece armor : armor) {\n+            Optional<SlimefunArmorPiece> armorPiece = armor.getItem();\n+            if (!armorPiece.isPresent()) return false;\n+\n+            if (armorPiece.get() instanceof CustomProtection) {\n+                CustomProtection protectedArmor = (CustomProtection) armorPiece.get();\n+\n+                if (first) {\n+                    if (protectedArmor.isFullSetRequired()) setId = armorPiece.get().getSetId();\n+                    first = false;", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjE5Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586193", "bodyText": "Again, there's a variable. I don't like all these get()s", "author": "WalshyDev", "createdAt": "2020-06-28T01:16:17Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/api/player/PlayerProfile.java", "diffHunk": "@@ -448,6 +453,39 @@ public static void getBackpack(ItemStack item, Consumer<PlayerBackpack> callback\n         }\n     }\n \n+    public boolean isProtected(ProtectionType type) {\n+        int armorCount = 0;\n+        boolean first = true;\n+\n+        NamespacedKey setId = null;\n+        for (HashedArmorpiece armor : armor) {\n+            Optional<SlimefunArmorPiece> armorPiece = armor.getItem();\n+            if (!armorPiece.isPresent()) return false;\n+\n+            if (armorPiece.get() instanceof CustomProtection) {\n+                CustomProtection protectedArmor = (CustomProtection) armorPiece.get();\n+\n+                if (first) {\n+                    if (protectedArmor.isFullSetRequired()) setId = armorPiece.get().getSetId();\n+                    first = false;\n+                }\n+\n+                for (ProtectionType protectionType : protectedArmor.getProtectionTypes()) {\n+                    if (protectionType == type) {\n+                        if (setId == null) {\n+                            return true;\n+                        } else if (setId.equals(armorPiece.get().getSetId())) {", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjMyNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586325", "bodyText": "I don't understand what this class does at all from this comment. It doesn't let people put on this armour? But also (?) stops \"applying protection\", what does that mean?\nThis really needs to be reworded.", "author": "WalshyDev", "createdAt": "2020-06-28T01:18:02Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/CustomProtection.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.entity.EntityDamageEvent;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.HazmatArmorPiece;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+\n+/**\n+ * Implement this interface for any {@link SlimefunArmorPiece} to prevent\n+ * the {@link Player} wearing that {@link SlimefunArmorPiece}\n+ *\n+ * <b>Important</b>: This will not cancel any {@link EntityDamageEvent}.\n+ * It will simply prevent Slimefun from ever applying {@link ProtectionType}\n+ * to this {@link SlimefunArmorPiece}'s wearer.", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjQwNA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586404", "bodyText": "Does this just stop the armour from being damaged or the player too?", "author": "WalshyDev", "createdAt": "2020-06-28T01:19:12Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/CustomProtection.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.entity.EntityDamageEvent;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.HazmatArmorPiece;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+\n+/**\n+ * Implement this interface for any {@link SlimefunArmorPiece} to prevent\n+ * the {@link Player} wearing that {@link SlimefunArmorPiece}\n+ *\n+ * <b>Important</b>: This will not cancel any {@link EntityDamageEvent}.\n+ * It will simply prevent Slimefun from ever applying {@link ProtectionType}\n+ * to this {@link SlimefunArmorPiece}'s wearer.\n+ *\n+ * @author Linox\n+ *\n+ * @see SlimefunArmorPiece\n+ * @see HazmatArmorPiece\n+ * @see ItemAttribute\n+ *\n+ */\n+public interface CustomProtection extends ItemAttribute {\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjQyNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586425", "bodyText": "Copied comment. Wasn't changed.", "author": "WalshyDev", "createdAt": "2020-06-28T01:19:33Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/CustomProtection.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.entity.EntityDamageEvent;\n+\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.HazmatArmorPiece;\n+import io.github.thebusybiscuit.slimefun4.implementation.items.armor.SlimefunArmorPiece;\n+\n+/**\n+ * Implement this interface for any {@link SlimefunArmorPiece} to prevent\n+ * the {@link Player} wearing that {@link SlimefunArmorPiece}\n+ *\n+ * <b>Important</b>: This will not cancel any {@link EntityDamageEvent}.\n+ * It will simply prevent Slimefun from ever applying {@link ProtectionType}\n+ * to this {@link SlimefunArmorPiece}'s wearer.\n+ *\n+ * @author Linox\n+ *\n+ * @see SlimefunArmorPiece\n+ * @see HazmatArmorPiece\n+ * @see ItemAttribute\n+ *\n+ */\n+public interface CustomProtection extends ItemAttribute {\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.\n+     *\n+     * @return The {@link ProtectionType}s\n+     */\n+    ProtectionType[] getProtectionTypes();\n+\n+    /**\n+     * This returns the {@link ProtectionType}s this {@link ItemAttribute}\n+     * prevents the assigned {@link SlimefunArmorPiece} to be damaged by.\n+     *\n+     * @return The {@link ProtectionType}s", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjYxNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586615", "bodyText": "Not sure I'm a fan of this being an enum. I'd rather addons be able to add their own as they wish. This could be a Predicate with the damage event (or such object) and then it's tested.", "author": "WalshyDev", "createdAt": "2020-06-28T01:21:58Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/core/attributes/ProtectionType.java", "diffHunk": "@@ -0,0 +1,17 @@\n+package io.github.thebusybiscuit.slimefun4.core.attributes;\n+\n+/**\n+ * Represents the {@link ProtectionType} that a {@link CustomProtection}\n+ * prevents the damage from.\n+ *\n+ * @author Linox\n+ *\n+ * @see CustomProtection\n+ *\n+ */\n+public enum ProtectionType {", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDY2MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446590661", "bodyText": "I don't think I understand this.", "author": "LinoxGH", "createdAt": "2020-06-28T02:25:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjYxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDg5MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446590891", "bodyText": "Instead of accepting an enum, having like a canProtect(Predicate) and then test the predicate for if it can protect.\nThis way, other addons can actually add their own protection with this system.", "author": "WalshyDev", "createdAt": "2020-06-28T02:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjYxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYyNDM4Ng==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446624386", "bodyText": "I agree that it would be really awesome if addons could add their own types.\nBut I don't really see how a Predicate would be useful here.\nI would rather suggest a Namespaced-key based approach here too.\nHowever I would also recommend to delay this discussion, we can always change it and improve this API later.\nWe probably bombarded Linox with change requests more than enough for now :LUL:\nI'd say this is ready to be merged and we can always make the API more accessible later down the line.", "author": "TheBusyBiscuit", "createdAt": "2020-06-28T09:11:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjYxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY0NDA5MQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446644091", "bodyText": "I'm ok with this.", "author": "WalshyDev", "createdAt": "2020-06-28T12:23:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjYzMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586631", "bodyText": "Empty line", "author": "WalshyDev", "createdAt": "2020-06-28T01:22:18Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/SlimefunItems.java", "diffHunk": "@@ -295,6 +298,41 @@ private SlimefunItems() {}\n         REINFORCED_ALLOY_LEGGINGS.addUnsafeEnchantments(reinforced);\n         REINFORCED_ALLOY_BOOTS.addUnsafeEnchantments(reinforced);\n \n+        if (SlimefunPlugin.getMinecraftVersion().isAtLeast(MinecraftVersion.MINECRAFT_1_15)) {\n+", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjY0OA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586648", "bodyText": "ChatColors.color", "author": "WalshyDev", "createdAt": "2020-06-28T01:22:34Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/SlimefunItems.java", "diffHunk": "@@ -295,6 +298,41 @@ private SlimefunItems() {}\n         REINFORCED_ALLOY_LEGGINGS.addUnsafeEnchantments(reinforced);\n         REINFORCED_ALLOY_BOOTS.addUnsafeEnchantments(reinforced);\n \n+        if (SlimefunPlugin.getMinecraftVersion().isAtLeast(MinecraftVersion.MINECRAFT_1_15)) {\n+\n+            ItemMeta scubaHelmetMeta = SCUBA_HELMET.getItemMeta();\n+            List<String> scubaHelmetMetaLore = scubaHelmetMeta.getLore();\n+            scubaHelmetMetaLore.addAll(Arrays.asList(\"\",\n+                    ChatColor.translateAlternateColorCodes('&', \"&7Equip the full set for:\"),", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjcyMQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586721", "bodyText": "Just initialise right away", "author": "WalshyDev", "createdAt": "2020-06-28T01:23:54Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/items/armor/HazmatArmorPiece.java", "diffHunk": "@@ -0,0 +1,43 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.items.armor;\n+\n+import org.bukkit.NamespacedKey;\n+import org.bukkit.inventory.ItemStack;\n+import org.bukkit.potion.PotionEffect;\n+\n+import io.github.thebusybiscuit.slimefun4.core.attributes.CustomProtection;\n+import io.github.thebusybiscuit.slimefun4.core.attributes.ProtectionType;\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunPlugin;\n+import me.mrCookieSlime.Slimefun.Lists.RecipeType;\n+import me.mrCookieSlime.Slimefun.Objects.Category;\n+import me.mrCookieSlime.Slimefun.api.SlimefunItemStack;\n+\n+/**\n+ * Represents 1 {@link SlimefunArmorPiece} of the Hazmat armor set.\n+ * One of the very few utilisations of {@link CustomProtection}.\n+ *\n+ * @author Linox\n+ *\n+ * @see SlimefunArmorPiece\n+ * @see CustomProtection\n+ *\n+ */\n+public class HazmatArmorPiece extends SlimefunArmorPiece implements CustomProtection {\n+\n+    private final ProtectionType[] types;\n+\n+    public HazmatArmorPiece(Category category, SlimefunItemStack item, RecipeType recipeType, ItemStack[] recipe, PotionEffect[] effects) {\n+        super(category, item, recipeType, recipe, effects, new NamespacedKey(SlimefunPlugin.instance, \"hazmat_suit\"));\n+\n+        types = new ProtectionType[] {ProtectionType.BEES, ProtectionType.RADIATION};", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjgxNQ==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446586815", "bodyText": "Should cancel. This will mess with other plugins.", "author": "WalshyDev", "createdAt": "2020-06-28T01:25:06Z", "path": "src/main/java/io/github/thebusybiscuit/slimefun4/implementation/listeners/BeeListener.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package io.github.thebusybiscuit.slimefun4.implementation.listeners;\n+\n+import java.util.Optional;\n+\n+import org.bukkit.entity.Bee;\n+import org.bukkit.entity.Player;\n+import org.bukkit.event.EventHandler;\n+import org.bukkit.event.Listener;\n+import org.bukkit.event.entity.EntityDamageByEntityEvent;\n+import org.bukkit.inventory.ItemStack;\n+\n+import io.github.thebusybiscuit.cscorelib2.inventory.ItemUtils;\n+import io.github.thebusybiscuit.slimefun4.api.player.PlayerProfile;\n+import io.github.thebusybiscuit.slimefun4.core.attributes.ProtectionType;\n+import io.github.thebusybiscuit.slimefun4.implementation.SlimefunPlugin;\n+\n+/**\n+ * The listener for Hazmat Suit's {@link Bee} sting protection.\n+ * Only applied if the whole set is worn.\n+ *\n+ * @author Linox\n+ *\n+ */\n+public class BeeListener implements Listener {\n+\n+    public BeeListener(SlimefunPlugin plugin) {\n+        plugin.getServer().getPluginManager().registerEvents(this, plugin);\n+    }\n+\n+    @EventHandler\n+    public void onDamage(EntityDamageByEntityEvent e) {\n+        if (e.getDamager() instanceof Bee && e.getEntity() instanceof Player) {\n+\n+            Player p = (Player) e.getEntity();\n+            Optional<PlayerProfile> optional = PlayerProfile.find(p);\n+            if (!optional.isPresent()) {\n+                PlayerProfile.request(p);\n+                return;\n+            }\n+\n+            PlayerProfile profile = optional.get();\n+            if (profile.isProtected(ProtectionType.BEES)) {\n+                for (ItemStack armor : p.getInventory().getArmorContents()) {\n+                    ItemUtils.damageItem(armor, 1, false);\n+                }\n+                e.setDamage(0D);", "originalCommit": "a935951c229dc1c04646dcd9e72b03b30b81fc6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU5MDg2Mw==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446590863", "bodyText": "Cannot when cancelled bee doesn't stop from trying to attack you.", "author": "LinoxGH", "createdAt": "2020-06-28T02:29:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjgxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYyNDU1MA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446624550", "bodyText": "Hmmm, what about setting the anger level or target or such for the Bee?", "author": "TheBusyBiscuit", "createdAt": "2020-06-28T09:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjgxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjYzNzUzOA==", "url": "https://github.com/Slimefun/Slimefun4/pull/2057#discussion_r446637538", "bodyText": "That would cause more issues most likely.", "author": "LinoxGH", "createdAt": "2020-06-28T11:18:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU4NjgxNQ=="}], "type": "inlineReview"}, {"oid": "3e271ac78631bd975f95c18a34da7ab3e1de9c75", "url": "https://github.com/Slimefun/Slimefun4/commit/3e271ac78631bd975f95c18a34da7ab3e1de9c75", "message": "Did more requested changes.", "committedDate": "2020-06-28T02:29:51Z", "type": "commit"}]}