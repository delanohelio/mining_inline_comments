{"pr_number": 215, "pr_title": ":bug: Analytic state attribute 54", "pr_createdAt": "2020-01-28T03:24:32Z", "pr_url": "https://github.com/constellation-app/constellation/pull/215", "timeline": [{"oid": "7b6c7943273276574264d2c9c7508836c992c5d3", "url": "https://github.com/constellation-app/constellation/commit/7b6c7943273276574264d2c9c7508836c992c5d3", "message": "Initial testing of implementation", "committedDate": "2020-01-16T22:45:37Z", "type": "commit"}, {"oid": "40a6da64fb30d8db17fdce992fd4d9b7f46f24a4", "url": "https://github.com/constellation-app/constellation/commit/40a6da64fb30d8db17fdce992fd4d9b7f46f24a4", "message": "Implement update handler", "committedDate": "2020-01-20T04:05:01Z", "type": "commit"}, {"oid": "591408c905f1a71dff9e75ba6b599669f8cd1f40", "url": "https://github.com/constellation-app/constellation/commit/591408c905f1a71dff9e75ba6b599669f8cd1f40", "message": "Merge pull request #7 from constellation-app/master\n\nUpdate Master", "committedDate": "2020-01-21T23:31:56Z", "type": "commit"}, {"oid": "d5b3d3a2f170d7fb221aa296dd63d38b1306b013", "url": "https://github.com/constellation-app/constellation/commit/d5b3d3a2f170d7fb221aa296dd63d38b1306b013", "message": "Code Cleanup", "committedDate": "2020-01-21T23:32:12Z", "type": "commit"}, {"oid": "0cd191c003cfb1c91d1152f0c741b81bdcd150c1", "url": "https://github.com/constellation-app/constellation/commit/0cd191c003cfb1c91d1152f0c741b81bdcd150c1", "message": "Merge branch 'master' into Analytic-State_Attribute-54", "committedDate": "2020-01-21T23:32:45Z", "type": "commit"}, {"oid": "6bd5cf50e7e6fb3e21ae254caedde257fe54c7c5", "url": "https://github.com/constellation-app/constellation/commit/6bd5cf50e7e6fb3e21ae254caedde257fe54c7c5", "message": "Implement plugin selection and deselection from state", "committedDate": "2020-01-23T01:41:38Z", "type": "commit"}, {"oid": "c1a70938d9a3789e1328c9b0cbae1f0feb3943d4", "url": "https://github.com/constellation-app/constellation/commit/c1a70938d9a3789e1328c9b0cbae1f0feb3943d4", "message": "Implement read write of state", "committedDate": "2020-01-24T04:35:20Z", "type": "commit"}, {"oid": "cf775c2a88a157e9e9fb62d758014269c2b8586a", "url": "https://github.com/constellation-app/constellation/commit/cf775c2a88a157e9e9fb62d758014269c2b8586a", "message": "Refactor variable names", "committedDate": "2020-01-28T01:08:18Z", "type": "commit"}, {"oid": "f15b37bc387c702d43beac8ba7574e1c3f6aaec3", "url": "https://github.com/constellation-app/constellation/commit/f15b37bc387c702d43beac8ba7574e1c3f6aaec3", "message": "Merge pull request #8 from constellation-app/master\n\nUpdate Master", "committedDate": "2020-01-28T01:09:31Z", "type": "commit"}, {"oid": "2275588afe92b48c079874514bd52cc1c52ec44a", "url": "https://github.com/constellation-app/constellation/commit/2275588afe92b48c079874514bd52cc1c52ec44a", "message": "Merge branch 'master' into Analytic-State_Attribute-54", "committedDate": "2020-01-28T01:10:18Z", "type": "commit"}, {"oid": "a7bbe1f5d8d9338fce2496334d3aca44af61a0e5", "url": "https://github.com/constellation-app/constellation/commit/a7bbe1f5d8d9338fce2496334d3aca44af61a0e5", "message": "Code Cleanup", "committedDate": "2020-01-28T03:08:16Z", "type": "commit"}, {"oid": "cd79295a690315c7c95dce7902538afb57167be0", "url": "https://github.com/constellation-app/constellation/commit/cd79295a690315c7c95dce7902538afb57167be0", "message": "refactor comment", "committedDate": "2020-01-28T03:27:14Z", "type": "commit"}, {"oid": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "url": "https://github.com/constellation-app/constellation/commit/fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "message": "refactor comment", "committedDate": "2020-01-28T03:28:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Mzg3NA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371643874", "bodyText": "What is happening here?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:35:29Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -490,15 +510,29 @@ public static final SelectableAnalyticPlugin lookupSelectablePlugin(final String\n         return NAME_TO_SELECTABLE_PLUGIN_MAP.get(selectableAnalyticPluginName);\n     }\n \n+    private static void setSuppressedFlag(final boolean newValue) {\n+        selectionSuppressed = newValue;\n+    }\n+\n     public final class SelectableAnalyticPlugin {\n \n         private final CheckBox checkbox;\n+        private ListCell<SelectableAnalyticPlugin> parent;\n         private final AnalyticPlugin plugin;\n         private PluginParameters parameters;\n         private PluginParameters updatedParameters;\n \n         public SelectableAnalyticPlugin(final AnalyticPlugin plugin) {\n             this.checkbox = new CheckBox();\n+            // Allows triggering of selection listener when a checkbox is changed", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwMDUxOA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372100518", "bodyText": "constellation/CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java\n    \n    \n        Lines 527 to 535\n      in\n      fbce6de\n    \n    \n    \n    \n\n        \n          \n           // Allows triggering of selection listener when a checkbox is changed \n        \n\n        \n          \n           this.checkbox.selectedProperty().addListener((observable, oldValue, newValue) -> { \n        \n\n        \n          \n               if (parent != null) { \n        \n\n        \n          \n                   if (parent.getListView().getSelectionModel().getSelectedItem() == this) { \n        \n\n        \n          \n                       parent.getListView().getSelectionModel().clearSelection(); \n        \n\n        \n          \n                   } \n        \n\n        \n          \n                   parent.getListView().getSelectionModel().select(this); \n        \n\n        \n          \n               } \n        \n\n        \n          \n           }); \n        \n    \n  \n\n\nSo, for an event to fire on the selection model of the pluginList, the plugin has to change state to highlighted. If the plugin was already highlighted but did not have it's checkbox \"checked\", a user could select the checkbox and no update event would occur to store the state.\nBy adding a listener to the checkbox, I could trigger an event in it's parent (Listviewcell)'s selection model event. I felt that this would be the cleanest way rather than creating another public method to call once the checkbox event was called.", "author": "aldebaran30701", "createdAt": "2020-01-28T22:43:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Mzg3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1Nzg5NQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372357895", "bodyText": "Cool - that makes sense.", "author": "cygnus-x-1", "createdAt": "2020-01-29T12:37:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Mzg3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NDU0Mw==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371644543", "bodyText": "Should this be categoryWasSelected?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:37:45Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -582,4 +620,71 @@ public String getName() {\n             return \"Analytic View: Update State\";\n         }\n     }\n+    \n+    /**\n+     * Update the display by reading and writing to/from the state attribute. \n+     */\n+    private static final class AnalyticViewStateUpdater extends SimpleEditPlugin {\n+\n+        private final AnalyticConfigurationPane analyticConfigurationPane;\n+        private final boolean pluginWasSelected;\n+        \n+        public AnalyticViewStateUpdater(final AnalyticConfigurationPane analyticConfigurationPane, final boolean categoryWasSelected) {\n+            this.analyticConfigurationPane = analyticConfigurationPane;\n+            this.pluginWasSelected = categoryWasSelected;", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNDQyNA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372104424", "bodyText": "A missed variable when refactoring for ease of reading. Ill get that fixed.", "author": "aldebaran30701", "createdAt": "2020-01-28T22:53:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NDU0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTQ5Ng==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371645496", "bodyText": "What's the advantage of this, isn't it functionally equivalent to what was there before?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:41:15Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/state/AnalyticViewState.java", "diffHunk": "@@ -65,7 +66,11 @@ public void setCurrentAnalyticQuestionIndex(final int currentAnalyticQuestionInd\n \n     public void addAnalyticQuestion(final AnalyticQuestionDescription<?> question, final List<SelectableAnalyticPlugin> selectablePlugins) {\n         activeAnalyticQuestions.add(question);\n-        activeSelectablePlugins.add(selectablePlugins);\n+        for (SelectableAnalyticPlugin plugin : selectablePlugins) {", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNTA2Ng==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372105066", "bodyText": "Yes, I overlooked the change when working on another solution. This should work fine without the change.", "author": "aldebaran30701", "createdAt": "2020-01-28T22:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTQ5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjExMzc2MA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372113760", "bodyText": "On testing, I now recall that the reason for this was to pass a list of selected plugins to the state class. This state class then grabbed each one and singly added them to a list and added that list as an entry to the activeSelectablePlugins list.\nRegarding the double list structure, and your comment in the original issue post; Would you like this refactored, or the implementation changed to match the design decision of including multiple plugins in a single list to suit the question and tabbed design?", "author": "aldebaran30701", "createdAt": "2020-01-28T23:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTQ5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM0OTIwNQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372349205", "bodyText": "Yes I think that would be a better design.", "author": "cygnus-x-1", "createdAt": "2020-01-29T12:16:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NTQ5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Njk0OA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371646948", "bodyText": "Why are you doing this? In fact why is activeSelectablePlugins a list of lists?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:45:47Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/state/AnalyticViewState.java", "diffHunk": "@@ -65,7 +66,11 @@ public void setCurrentAnalyticQuestionIndex(final int currentAnalyticQuestionInd\n \n     public void addAnalyticQuestion(final AnalyticQuestionDescription<?> question, final List<SelectableAnalyticPlugin> selectablePlugins) {\n         activeAnalyticQuestions.add(question);\n-        activeSelectablePlugins.add(selectablePlugins);\n+        for (SelectableAnalyticPlugin plugin : selectablePlugins) {", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjEwNDcyOA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372104728", "bodyText": "I had the impression it was a design decision for something that may be implemented in the future possibly to do with saving/loading of questions/plugins.", "author": "aldebaran30701", "createdAt": "2020-01-28T22:54:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Njk0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM0OTQ5MQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372349491", "bodyText": "Sorry, I recalled why it was structured this way after I wrote this comment - please disregard.", "author": "cygnus-x-1", "createdAt": "2020-01-29T12:17:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0Njk0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647125", "bodyText": "Why have you removed all the attribute listeners? Also, is there a reason you haven't implemented the structure and state listeners above?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:46:08Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticViewTopComponent.java", "diffHunk": "@@ -109,16 +109,6 @@ public AnalyticViewTopComponent() {\n                 prerequisiteAttributes.get(attribute).add(plugin);\n             });\n         });\n-        prerequisiteAttributes.forEach((attribute, plugins) -> {", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjExMDcwNw==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372110707", "bodyText": "Regarding the attribute listeners,\nThey seemed to be running over most if not all plugin parameters and updating their parameters to the default parameters. Do you have a suggestion on how this would be possible to work around, whilst still allowing them to be added for the plugins not on this repo?\nI can take a look at refactoring the code to include these state listeners if you feel they would benefit as opposed to the current solution.", "author": "aldebaran30701", "createdAt": "2020-01-28T23:11:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1NjUwNQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372356505", "bodyText": "So what should be happening here is that individual analytics can specify prerequisite attributes (ie. attributes they rely on for their parameters) using AnalyticPlugin.getPrerequisiteAttributes along with a way of handling changes to those attributes using AnalyticPlugin.onPrerequisiteAttributeChange. This block of code is generically attaching listeners against all specified prerequisite attributes and handling them with the provided handler functions. I would expect many analytics to be affected by this as ScoreAnalyticPlugin and FactAnalyticPlugin use this mechanism to listen for changes to the AnalyticConcept.TransactionAttribute.TYPE attribute in order to update their \"Transaction Types\" parameters when types are added to or removed from the graph. If it's not quite behaving on an update, then it might be worth taking a look at ScoreAnalyticPlugin.onPrerequisiteAttributeChange and FactAnalyticPlugin.onPrerequisiteAttributeChange.", "author": "cygnus-x-1", "createdAt": "2020-01-29T12:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mjc3NzA1OA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372777058", "bodyText": "Hi @cygnus-x-1 I've noticed that within the section I removed for listeners and prerequisite attributes, there is a call to createParameters().\n\n  \n    \n      constellation/CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/analytics/AnalyticPlugin.java\n    \n    \n        Lines 80 to 83\n      in\n      b9389f2\n    \n    \n    \n    \n\n        \n          \n           @Override \n        \n\n        \n          \n           public PluginParameters createParameters() { \n        \n\n        \n          \n               return new PluginParameters(); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nI believe that when it hits line 115, the plugins that do not implement any special behaviour just act out the superclass method above. Which just returns the default parameters from a plugin.\n\n  \n    \n      constellation/CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticViewTopComponent.java\n    \n    \n        Lines 112 to 122\n      in\n      b9389f2\n    \n    \n    \n    \n\n        \n          \n               prerequisiteAttributes.forEach((attribute, plugins) -> { \n        \n\n        \n          \n                   addAttributeValueChangeHandler(attribute, graph -> { \n        \n\n        \n          \n                       plugins.forEach(plugin -> { \n        \n\n        \n          \n                           final PluginParameters updatedParameters = plugin.createParameters().copy(); \n        \n\n        \n          \n                           plugin.onPrerequisiteAttributeChange(graph, updatedParameters); \n        \n\n        \n          \n                           analyticViewPane.getConfigurationPane().lookupSelectablePlugin(plugin).setUpdatedParameters(updatedParameters); \n        \n\n        \n          \n                       }); \n        \n\n        \n          \n                       analyticViewPane.getConfigurationPane().updateSelectablePluginsParameters(); \n        \n\n        \n          \n                   }); \n        \n\n        \n          \n               }); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nThese are then set at line 117 which overrides the different parameter values at runtime.\nAs createParameters() is utilized by many other classes, changing the default behaviour may come with unwanted bugs. How could I handle this to keep it from breaking other code.\nI'll also push the rest of the code, this is the last of the pull request fixes currently in review.", "author": "aldebaran30701", "createdAt": "2020-01-30T06:26:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjkyNDQzMw==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372924433", "bodyText": "That sounds right - if an AnalyticPlugin does not have any parameters, then it'll simply use an empty PluginParameters  inherited from the abstract base class.\nThe listeners in the AnalyticViewTopComponent will then react to changes to a \"prerequisite attribute\" by updating that plugins parameters (which defaults to no parameters) using that plugins onPrerequisiteAttributeChange implementation (which defaults to a no-op). Note that this code also takes a copy of the parameters and updates SelectableAnalyticPlugin.updatedParameters instead of SelectableAnalyticPlugin.parameters in order to avoid events being triggered by changes to these parameters until the Analytic View is ready for them (AnalyticConfigurationPane.updateSelectablePluginsParameters).\nPlugin.createParameters is simply designed to set-up and return the default parameters for a plugin, generally to be used at the beginning of a plugin lifecycle. It is designed to be overridden to make it specific to a plugin implementation, and I believe that's exactly how it's being used here. Are you seeing any specific issues manifesting with this code?", "author": "cygnus-x-1", "createdAt": "2020-01-30T12:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzI4MDI0NA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r373280244", "bodyText": "Plugin.createParameters is simply designed to set-up and return the default parameters for a plugin, generally to be used at the beginning of a plugin lifecycle. It is designed to be overridden to make it specific to a plugin implementation, and I believe that's exactly how it's being used here.\n\nYou are not wrong in saying this, It currently gets the default PluginParameters during the createParameters() call. Then, obviously it .copy() 's the default parameters values.\nThe main issue I see is that within .manualUpdate(), all listeners are triggered to update things. Including the PrerequisiteAttributeListeners. The graph is read from and state attribute written to first. Then when you launch the Analytic View, it does a .manualUpdate().\nAs you can see in this step through, the first image is line 117 getting the SelectableAnalyticPlugin. Note the red circle showing the boolean value read from the state attribute.\n\nIn this second screenshot, It displays the value of the updatedParameters which are going to replace the current values. Note the highlighted boolean value down the bottom showing the SelectableAnalyticPlugin parameters value which will now be set to true after execution of this line.\n\nAll of this occurs when the following preconditions are met:\n\nGraph is currently opened\nAnalytic View is being opened\n\nLine 115 and 116 seem to work perfect for the use case when the prerequisite attribute changes, but on triggering of all handlers, it writes defaults to them which override the loaded parameters from state.", "author": "aldebaran30701", "createdAt": "2020-01-31T01:32:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzQ1NTg0MA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r373455840", "bodyText": "Okay I think I understand the problem you're describing - essentially any parameters which are not updated by AnalyticPlugin.onPrerequisiteAttributeChange explicitly will instead be updated to the default value for that parameter when SelectableAnalyticPlugin.updatedParameters is copied across to SelectableAnalyticPlugin.parameters, overwriting any other changes, such as those set by the state.\nYeah that's a tough one - i'll have to think about that.", "author": "cygnus-x-1", "createdAt": "2020-01-31T12:27:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzI2NA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647264", "bodyText": "Shouldn't all this be in the state listener on the top component?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:46:37Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -582,4 +620,71 @@ public String getName() {\n             return \"Analytic View: Update State\";\n         }\n     }\n+    \n+    /**\n+     * Update the display by reading and writing to/from the state attribute. \n+     */\n+    private static final class AnalyticViewStateUpdater extends SimpleEditPlugin {\n+\n+        private final AnalyticConfigurationPane analyticConfigurationPane;\n+        private final boolean pluginWasSelected;\n+        \n+        public AnalyticViewStateUpdater(final AnalyticConfigurationPane analyticConfigurationPane, final boolean categoryWasSelected) {\n+            this.analyticConfigurationPane = analyticConfigurationPane;\n+            this.pluginWasSelected = categoryWasSelected;\n+        }\n+\n+        @Override\n+        public void edit(final GraphWriteMethods graph, final PluginInteraction interaction, final PluginParameters parameters) throws InterruptedException, PluginException {\n+            String currentCategory = analyticConfigurationPane.categoryList.getSelectionModel().getSelectedItem();\n+            int stateAttributeId = AnalyticViewConcept.MetaAttribute.ANALYTIC_VIEW_STATE.ensure(graph);\n+            \n+            // Make a copy in case the state on the graph is currently being modified.\n+            AnalyticViewState currentState = graph.getObjectValue(stateAttributeId, 0);\n+            currentState = (currentState == null) ? new AnalyticViewState() : new AnalyticViewState(currentState);\n+            \n+            if (pluginWasSelected) {\n+                // remove all plugins matching category\n+                currentState.removePluginsMatchingCategory(currentCategory);\n+                // grab all plugins from currently selected category\n+                List<SelectableAnalyticPlugin> checkedPlugins = new ArrayList<>();\n+                // adding items to checkedPlugins array when they are selected\n+                analyticConfigurationPane.pluginList.getItems().forEach(selectablePlugin -> {\n+                    if (selectablePlugin.isSelected()) {\n+                        checkedPlugins.add(selectablePlugin);\n+                    }\n+                });\n+                if (!checkedPlugins.isEmpty()) {\n+                    currentState.addAnalyticQuestion(analyticConfigurationPane.currentQuestion, checkedPlugins);\n+                }\n+                graph.setObjectValue(stateAttributeId, 0, currentState);\n+            }\n+            \n+            // get question only if one exists ", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjExNDE1NQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372114155", "bodyText": "I can take a look at refactoring the code to include these state listeners if you feel they would benefit as opposed to the current solution.", "author": "aldebaran30701", "createdAt": "2020-01-28T23:21:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzI2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzUyNA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647524", "bodyText": "Should this be categoryWasSelected?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:47:26Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -582,4 +620,71 @@ public String getName() {\n             return \"Analytic View: Update State\";\n         }\n     }\n+    \n+    /**\n+     * Update the display by reading and writing to/from the state attribute. \n+     */\n+    private static final class AnalyticViewStateUpdater extends SimpleEditPlugin {\n+\n+        private final AnalyticConfigurationPane analyticConfigurationPane;\n+        private final boolean pluginWasSelected;\n+        \n+        public AnalyticViewStateUpdater(final AnalyticConfigurationPane analyticConfigurationPane, final boolean categoryWasSelected) {\n+            this.analyticConfigurationPane = analyticConfigurationPane;\n+            this.pluginWasSelected = categoryWasSelected;", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzY5Mg==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r371647692", "bodyText": "What is this trying to achieve?", "author": "cygnus-x-1", "createdAt": "2020-01-28T07:48:00Z", "path": "CoreAnalyticView/src/au/gov/asd/tac/constellation/views/analyticview/AnalyticConfigurationPane.java", "diffHunk": "@@ -490,15 +510,29 @@ public static final SelectableAnalyticPlugin lookupSelectablePlugin(final String\n         return NAME_TO_SELECTABLE_PLUGIN_MAP.get(selectableAnalyticPluginName);\n     }\n \n+    private static void setSuppressedFlag(final boolean newValue) {\n+        selectionSuppressed = newValue;\n+    }\n+\n     public final class SelectableAnalyticPlugin {\n \n         private final CheckBox checkbox;\n+        private ListCell<SelectableAnalyticPlugin> parent;\n         private final AnalyticPlugin plugin;\n         private PluginParameters parameters;\n         private PluginParameters updatedParameters;\n \n         public SelectableAnalyticPlugin(final AnalyticPlugin plugin) {\n             this.checkbox = new CheckBox();\n+            // Allows triggering of selection listener when a checkbox is changed\n+            this.checkbox.selectedProperty().addListener((observable, oldValue, newValue) -> {", "originalCommit": "fbce6de64cf65397f7d6065cb58cd2b85b3c8e2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjExMTM3NQ==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372111375", "bodyText": "See #215 (comment)", "author": "aldebaran30701", "createdAt": "2020-01-28T23:13:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzY5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjM1MDMyNA==", "url": "https://github.com/constellation-app/constellation/pull/215#discussion_r372350324", "bodyText": "Sorry about the duplicate comments, I accidentally left the page while reviewing and didn't realise GitHub must have submitted my comments automatically on exit.", "author": "cygnus-x-1", "createdAt": "2020-01-29T12:19:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTY0NzY5Mg=="}], "type": "inlineReview"}, {"oid": "a8bad43ae498c20024996eebf50e1f941eec4b7b", "url": "https://github.com/constellation-app/constellation/commit/a8bad43ae498c20024996eebf50e1f941eec4b7b", "message": "Refactor Analytic Config Pane\n\nName change of boolean flag pluginWasSelected", "committedDate": "2020-01-28T23:24:02Z", "type": "commit"}, {"oid": "52679593a8b80d00c5e03498cbda4203188be4c7", "url": "https://github.com/constellation-app/constellation/commit/52679593a8b80d00c5e03498cbda4203188be4c7", "message": "Comment out unimplemented options menu\n\nLocated within Analytic View", "committedDate": "2020-01-29T23:18:31Z", "type": "commit"}, {"oid": "6fee225ecddc24bf6b5fbeadbf04384d75e562cd", "url": "https://github.com/constellation-app/constellation/commit/6fee225ecddc24bf6b5fbeadbf04384d75e562cd", "message": "Add support for multiple tabs\n\nImplement plugins stored within single list\nImplement question storage within state", "committedDate": "2020-01-30T00:45:50Z", "type": "commit"}, {"oid": "3df416ef5e7c0b1bca4e9cb92868916c8c44fb3d", "url": "https://github.com/constellation-app/constellation/commit/3df416ef5e7c0b1bca4e9cb92868916c8c44fb3d", "message": "Add graph and state listener functionality\n\nimplement change of graph and parameter loop for saving of state", "committedDate": "2020-01-30T03:40:58Z", "type": "commit"}, {"oid": "19349880555d771cc6b133aa81a3bf941b21e3f5", "url": "https://github.com/constellation-app/constellation/commit/19349880555d771cc6b133aa81a3bf941b21e3f5", "message": "Add Eventhandler to top component\n\nsuppress an event only when manual update is called initially", "committedDate": "2020-02-04T00:24:45Z", "type": "commit"}]}