{"pr_number": 849, "pr_title": "Expressions framework and Layers View Integration", "pr_createdAt": "2020-10-01T02:11:51Z", "pr_url": "https://github.com/constellation-app/constellation/pull/849", "timeline": [{"oid": "dd35bdf45aa0cf3874a4b7d657e520a728bdd66f", "url": "https://github.com/constellation-app/constellation/commit/dd35bdf45aa0cf3874a4b7d657e520a728bdd66f", "message": "Version 1 of expression framework", "committedDate": "2020-08-06T02:37:39Z", "type": "commit"}, {"oid": "085e232f556cf4b29723dab4c6631151f608090c", "url": "https://github.com/constellation-app/constellation/commit/085e232f556cf4b29723dab4c6631151f608090c", "message": "Word based operators, parsing handles more edge cases", "committedDate": "2020-08-10T02:01:43Z", "type": "commit"}, {"oid": "e87040c1262ab3015fc8f52f5b9b9bdfd1fafeff", "url": "https://github.com/constellation-app/constellation/commit/e87040c1262ab3015fc8f52f5b9b9bdfd1fafeff", "message": "Merge remote-tracking branch 'origin/master' into expressions", "committedDate": "2020-08-10T02:06:36Z", "type": "commit"}, {"oid": "62c72f2fbf75ff76f184f2cf277fff1a34e80728", "url": "https://github.com/constellation-app/constellation/commit/62c72f2fbf75ff76f184f2cf277fff1a34e80728", "message": "Updated licence", "committedDate": "2020-08-11T03:05:10Z", "type": "commit"}, {"oid": "8a6b33eead10915e535f9832d092903aeed1d193", "url": "https://github.com/constellation-app/constellation/commit/8a6b33eead10915e535f9832d092903aeed1d193", "message": "Added help dependency back in to get working", "committedDate": "2020-08-13T01:02:19Z", "type": "commit"}, {"oid": "3315024330b92cb0240ea1e8a64074a7dd957677", "url": "https://github.com/constellation-app/constellation/commit/3315024330b92cb0240ea1e8a64074a7dd957677", "message": "Initial commit for expressions framework", "committedDate": "2020-08-17T13:51:49Z", "type": "commit"}, {"oid": "70885010fd556c47452ba4baf31033f229f68c4a", "url": "https://github.com/constellation-app/constellation/commit/70885010fd556c47452ba4baf31033f229f68c4a", "message": "Updated to expressions framework version 2", "committedDate": "2020-08-20T01:04:48Z", "type": "commit"}, {"oid": "fc63ba59225880e3688c943ff0c34194c7725732", "url": "https://github.com/constellation-app/constellation/commit/fc63ba59225880e3688c943ff0c34194c7725732", "message": "Added access registry", "committedDate": "2020-08-24T04:05:52Z", "type": "commit"}, {"oid": "b75e246785cb40cc2767da3046305d23dbdc9284", "url": "https://github.com/constellation-app/constellation/commit/b75e246785cb40cc2767da3046305d23dbdc9284", "message": "Merged master", "committedDate": "2020-08-24T04:10:20Z", "type": "commit"}, {"oid": "a95361812593ab77f746b3a3f9b914b2c2eb6682", "url": "https://github.com/constellation-app/constellation/commit/a95361812593ab77f746b3a3f9b914b2c2eb6682", "message": "Merge remote-tracking branch 'origin/master' into expressions_framework", "committedDate": "2020-09-01T01:48:19Z", "type": "commit"}, {"oid": "f8e0288b05b160016e66b0fad2f10e77752669b2", "url": "https://github.com/constellation-app/constellation/commit/f8e0288b05b160016e66b0fad2f10e77752669b2", "message": "Pull out functionality from storegraph", "committedDate": "2020-09-01T02:32:55Z", "type": "commit"}, {"oid": "a4d305834212385e32e4ad1dc68ae85fab93f688", "url": "https://github.com/constellation-app/constellation/commit/a4d305834212385e32e4ad1dc68ae85fab93f688", "message": "Merge branch 'expressions' into feature/layer-standalone", "committedDate": "2020-09-01T22:41:14Z", "type": "commit"}, {"oid": "092a3608979d37ec73a35f3d63f657414175a9c6", "url": "https://github.com/constellation-app/constellation/commit/092a3608979d37ec73a35f3d63f657414175a9c6", "message": "implement expression functionality", "committedDate": "2020-09-02T04:59:01Z", "type": "commit"}, {"oid": "120a5d6d540789d61ed384f6122147501e5b1d17", "url": "https://github.com/constellation-app/constellation/commit/120a5d6d540789d61ed384f6122147501e5b1d17", "message": "Dependencies update", "committedDate": "2020-09-02T05:15:32Z", "type": "commit"}, {"oid": "cfb1ad0e725465df459d250dd96e1397ab6088fb", "url": "https://github.com/constellation-app/constellation/commit/cfb1ad0e725465df459d250dd96e1397ab6088fb", "message": "Merge branch 'expressions_framework' into feature/layer-standalone", "committedDate": "2020-09-02T06:00:16Z", "type": "commit"}, {"oid": "ee841db8f54d0069bb2ebfe6a4227666d9ab1f43", "url": "https://github.com/constellation-app/constellation/commit/ee841db8f54d0069bb2ebfe6a4227666d9ab1f43", "message": "Query class", "committedDate": "2020-09-02T06:27:32Z", "type": "commit"}, {"oid": "a93a1d533a05e8edfecc8f68f59d210ebacb45c9", "url": "https://github.com/constellation-app/constellation/commit/a93a1d533a05e8edfecc8f68f59d210ebacb45c9", "message": "BitmaskQuery", "committedDate": "2020-09-02T07:02:52Z", "type": "commit"}, {"oid": "c38a2857f76d1bd80788c5d17890722122ad0d48", "url": "https://github.com/constellation-app/constellation/commit/c38a2857f76d1bd80788c5d17890722122ad0d48", "message": "BitMaskQuery", "committedDate": "2020-09-02T23:42:33Z", "type": "commit"}, {"oid": "b8b5e3a977bc054b96103aa29aec9518218d4999", "url": "https://github.com/constellation-app/constellation/commit/b8b5e3a977bc054b96103aa29aec9518218d4999", "message": "Working BitMaskQuery Plugin", "committedDate": "2020-09-03T12:01:41Z", "type": "commit"}, {"oid": "77fe1fadc94f09fc12963ff8783433fc0f2c5404", "url": "https://github.com/constellation-app/constellation/commit/77fe1fadc94f09fc12963ff8783433fc0f2c5404", "message": "Fixed active queries bug", "committedDate": "2020-09-03T23:31:31Z", "type": "commit"}, {"oid": "b5cf8cb43d6a1e50dc47772ee43804554aac9e34", "url": "https://github.com/constellation-app/constellation/commit/b5cf8cb43d6a1e50dc47772ee43804554aac9e34", "message": "Removed conflicting code from StoreGraph", "committedDate": "2020-09-04T08:12:23Z", "type": "commit"}, {"oid": "f06972f7fd22feb373716873f6400c8de3bf6608", "url": "https://github.com/constellation-app/constellation/commit/f06972f7fd22feb373716873f6400c8de3bf6608", "message": "Merge branch 'expressions_framework' into feature/layer-standalone", "committedDate": "2020-09-07T00:18:28Z", "type": "commit"}, {"oid": "ebc9d9f5a9b944146d43b727055d371255bb51a3", "url": "https://github.com/constellation-app/constellation/commit/ebc9d9f5a9b944146d43b727055d371255bb51a3", "message": "Fixed small bug in BitMaskQueryCollection", "committedDate": "2020-09-07T01:28:32Z", "type": "commit"}, {"oid": "e370508bd99b8347de276ee05ef5110439702155", "url": "https://github.com/constellation-app/constellation/commit/e370508bd99b8347de276ee05ef5110439702155", "message": "convert Layerdescription to Bitmaskquery\n\nmerge conflict and layers view switch to query", "committedDate": "2020-09-09T02:17:43Z", "type": "commit"}, {"oid": "a314eab8a0986956479b512dfa857adccffdff60", "url": "https://github.com/constellation-app/constellation/commit/a314eab8a0986956479b512dfa857adccffdff60", "message": "Merge branch 'expressions_framework' into feature/layer-standalone", "committedDate": "2020-09-09T02:25:27Z", "type": "commit"}, {"oid": "281a2b82d12beecae37c6742e7acbb4d339ce32d", "url": "https://github.com/constellation-app/constellation/commit/281a2b82d12beecae37c6742e7acbb4d339ce32d", "message": "convert Layers View to use expressions", "committedDate": "2020-09-21T04:28:05Z", "type": "commit"}, {"oid": "3d2756ba418eb03a3a6476bc9a45ef273bb5321f", "url": "https://github.com/constellation-app/constellation/commit/3d2756ba418eb03a3a6476bc9a45ef273bb5321f", "message": "bugfixes", "committedDate": "2020-09-29T04:34:08Z", "type": "commit"}, {"oid": "6551f9407f66868afb400780ac441699f61e321d", "url": "https://github.com/constellation-app/constellation/commit/6551f9407f66868afb400780ac441699f61e321d", "message": "convert layers to query using expressions", "committedDate": "2020-10-01T01:15:13Z", "type": "commit"}, {"oid": "597897aa9ce2d8ad5d80671a84986b6b3e65639d", "url": "https://github.com/constellation-app/constellation/commit/597897aa9ce2d8ad5d80671a84986b6b3e65639d", "message": "Merge branch 'master' into feature/layer-standalone", "committedDate": "2020-10-01T01:15:55Z", "type": "commit"}, {"oid": "69a0602698bd5009f7075b78e6a392307fcdadbe", "url": "https://github.com/constellation-app/constellation/commit/69a0602698bd5009f7075b78e6a392307fcdadbe", "message": "resolve race condition for attribute listening", "committedDate": "2020-10-01T23:22:01Z", "type": "commit"}, {"oid": "ea5d5ce48ebf1e06d747e41ccf6f59656f79d415", "url": "https://github.com/constellation-app/constellation/commit/ea5d5ce48ebf1e06d747e41ccf6f59656f79d415", "message": "sonar bug fixes", "committedDate": "2020-10-02T00:20:30Z", "type": "commit"}, {"oid": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "url": "https://github.com/constellation-app/constellation/commit/2c8ce30289dd4da043903eb88ff0a058c9f8de94", "message": "fix test cases", "committedDate": "2020-10-02T05:17:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYyNzM2MA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500627360", "bodyText": "What is the reason for moving from Integer to Long for this? I'm probably not understanding how the layers are programmed in but I didn't think you could have that many layers.", "author": "antares1470", "createdAt": "2020-10-06T22:17:15Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/LayersConcept.java", "diffHunk": "@@ -54,23 +53,11 @@ private GraphAttribute() {\n             throw new IllegalStateException(\"Concept class\");\n         }\n \n-        public static final SchemaAttribute LAYER_MASK_SELECTED = new SchemaAttribute.Builder(GraphElementType.GRAPH, IntegerAttributeDescription.ATTRIBUTE_NAME, \"layer_bitmask_selected\")\n+        public static final SchemaAttribute LAYER_MASK_SELECTED = new SchemaAttribute.Builder(GraphElementType.GRAPH, LongAttributeDescription.ATTRIBUTE_NAME, \"layer_bitmask_selected\")", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM0ODAzMQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501348031", "bodyText": "So if the user wanted to, they could have 64 layers. previously it was 32. It shouldn't cost much to have this extra headroom. The long value allows for each bit to be toggled, each bit represents a layer.", "author": "aldebaran30701", "createdAt": "2020-10-07T22:34:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYyNzM2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM5NTA2MQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501395061", "bodyText": "Figured there was a reason. I just wanted to understand what that reason was", "author": "antares1470", "createdAt": "2020-10-08T01:14:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYyNzM2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYyODY1OQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500628659", "bodyText": "not using setStringValue?", "author": "antares1470", "createdAt": "2020-10-06T22:20:39Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/attribute/StringAttributeDescription.java", "diffHunk": "@@ -257,4 +261,24 @@ public void restoreData(final Object savedData) {\n         final String[] sd = (String[]) savedData;\n         data = Arrays.copyOf(sd, sd.length);\n     }\n+\n+    @Override\n+    public Object createReadObject(IntReadable indexReadable) {\n+        return (StringReadable) () -> data[indexReadable.readInt()];\n+    }\n+\n+    @Override\n+    public Object createWriteObject(GraphWriteMethods graph, int attribute, IntReadable indexReadable) {\n+        return new StringVariable() {\n+            @Override\n+            public String readString() {\n+                return data[indexReadable.readInt()];\n+            }\n+\n+            @Override\n+            public void writeString(String value) {\n+                graph.setObjectValue(attribute, indexReadable.readInt(), value);", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMDIyNw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500630227", "bodyText": "I would declare this as AccessRegistry<D> rather than var", "author": "antares1470", "createdAt": "2020-10-06T22:24:49Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/Access.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * \n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import au.gov.asd.tac.constellation.graph.value.readables.ByteReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.CharReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.DoubleReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.FloatReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.IntReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.LongReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.ShortReadable;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class Access {\n+    \n+    private static final Access DEFAULT = new Access();\n+    \n+    public static Access getDefault() {\n+        return DEFAULT;\n+    }\n+    \n+    static {\n+        Access.getDefault().getRegistry(CharReadable.class)\n+                .register(ByteReadable.class, (s) -> () -> (char)s.readShort())\n+                .register(ShortReadable.class, (s) -> () -> (char)s.readShort())\n+                .register(IntReadable.class, (s) -> () -> (char)s.readInt())\n+                .register(LongReadable.class, (s) -> () -> (char)s.readLong())\n+                .register(FloatReadable.class, (s) -> () -> (char)s.readFloat())\n+                .register(DoubleReadable.class, (s) -> () -> (char)s.readDouble());\n+\n+            \n+            Access.getDefault().getRegistry(ByteReadable.class)\n+                .register(ShortReadable.class, (s) -> () -> (byte)s.readShort())\n+                .register(IntReadable.class, (s) -> () -> (byte)s.readInt())\n+                .register(LongReadable.class, (s) -> () -> (byte)s.readLong())\n+                .register(FloatReadable.class, (s) -> () -> (byte)s.readFloat())\n+                .register(DoubleReadable.class, (s) -> () -> (byte)s.readDouble());\n+            \n+            Access.getDefault().getRegistry(ShortReadable.class)\n+                .register(IntReadable.class, (s) -> () -> (byte)s.readInt())\n+                .register(LongReadable.class, (s) -> () -> (byte)s.readLong())\n+                .register(FloatReadable.class, (s) -> () -> (byte)s.readFloat())\n+                .register(DoubleReadable.class, (s) -> () -> (byte)s.readDouble());\n+            \n+            Access.getDefault().getRegistry(IntReadable.class)\n+                .register(LongReadable.class, (s) -> () -> (byte)s.readLong())\n+                .register(FloatReadable.class, (s) -> () -> (byte)s.readFloat())\n+                .register(DoubleReadable.class, (s) -> () -> (byte)s.readDouble());\n+            \n+            Access.getDefault().getRegistry(LongReadable.class)\n+                .register(FloatReadable.class, (s) -> () -> (byte)s.readFloat())\n+                .register(DoubleReadable.class, (s) -> () -> (byte)s.readDouble());\n+            \n+            Access.getDefault().getRegistry(FloatReadable.class)\n+                .register(DoubleReadable.class, (s) -> () -> (byte)s.readDouble());\n+    }\n+    \n+    private final Map<Class, AccessRegistry> registries = new HashMap<>();\n+    \n+    public final <D> AccessRegistry<D> getRegistry(Class<D> destinationClass) {\n+        synchronized(registries) {\n+            var registry = (AccessRegistry<D>)registries.get(destinationClass);", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM2MzAzNA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501363034", "bodyText": "Declared as AccessRegistry<D>", "author": "aldebaran30701", "createdAt": "2020-10-07T23:17:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMDIyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTA5NQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500631095", "bodyText": "Would declare as Class<?> (or if you know the type then include that)", "author": "antares1470", "createdAt": "2020-10-06T22:27:08Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/AccessRegistry.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.Function;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class AccessRegistry<D> {\n+\n+    private final Class<D> destinationClass;\n+    private final List<FunctionRecord<?, D>> functions = new ArrayList<>();\n+\n+    public AccessRegistry(Class<D> destinationClass) {\n+        this.destinationClass = destinationClass;\n+    }\n+\n+    public <S> AccessRegistry<D> register(Class<S> sourceClass, Function<? super S, ? extends D> function) {\n+        functions.add(new FunctionRecord<>(sourceClass, destinationClass, function));\n+        return this;\n+    }\n+\n+    public D convert(Object source) {\n+        final var sourceClass = source.getClass();", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM2Mjk0NA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501362944", "bodyText": "Declared as Class<?>", "author": "aldebaran30701", "createdAt": "2020-10-07T23:17:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTg3Mw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500631873", "bodyText": "given the value of i is altered in the loop, it may be better to make this a while loop", "author": "antares1470", "createdAt": "2020-10-06T22:29:04Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/AccessRegistry.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.Function;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class AccessRegistry<D> {\n+\n+    private final Class<D> destinationClass;\n+    private final List<FunctionRecord<?, D>> functions = new ArrayList<>();\n+\n+    public AccessRegistry(Class<D> destinationClass) {\n+        this.destinationClass = destinationClass;\n+    }\n+\n+    public <S> AccessRegistry<D> register(Class<S> sourceClass, Function<? super S, ? extends D> function) {\n+        functions.add(new FunctionRecord<>(sourceClass, destinationClass, function));\n+        return this;\n+    }\n+\n+    public D convert(Object source) {\n+        final var sourceClass = source.getClass();\n+        final List<FunctionRecord<?, D>> applicableRecords = new ArrayList<>();\n+        functions.forEach((function) -> {\n+            if (function.isApplicable(sourceClass)) {\n+                boolean insert = true;\n+                for (int i = 0; i < applicableRecords.size(); i++) {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM2Mjc1MQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501362751", "bodyText": "Unsure about this, @sirius-1 thoughts?", "author": "aldebaran30701", "createdAt": "2020-10-07T23:16:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQzMTI0Mw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501431243", "bodyText": "I'll note that it does seem that the handling of the loop variable doesn't seem to be broken in this instance. What I'll say about this recommendation though is that the general advice is against altering the value of the loop variable in a for loop (and you should use a while loop in these cases).", "author": "antares1470", "createdAt": "2020-10-08T03:45:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk3MzM3MQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r502973371", "bodyText": "Also worth noting that sonar also flags this issue (though doesn't mention while loops as a possible solution)", "author": "antares1470", "createdAt": "2020-10-11T22:19:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU2NjY4Nw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r503566687", "bodyText": "If it is considered more clear as a while loop then go for it.", "author": "sirius-1", "createdAt": "2020-10-12T22:33:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMTg3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMzU3Mw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500633573", "bodyText": "given the value of i is altered in the loop, should probably make this a while loop", "author": "antares1470", "createdAt": "2020-10-06T22:33:42Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/OperatorRegistry.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class OperatorRegistry {\n+\n+    private final String name;\n+    private final List<FunctionRecord> functions = new ArrayList<>();\n+    private final List<BiFunctionRecord> biFunctions = new ArrayList<>();\n+\n+    public OperatorRegistry(String name) {\n+        this.name = name;\n+    }\n+\n+    public final <P, R> OperatorRegistry register(Class<P> parameterClass, Class<R> resultClass, Function<? super P, ? extends R> function) {\n+        functions.add(new FunctionRecord(parameterClass, function));\n+        return this;\n+    }\n+\n+    public final <P1, P2, R> OperatorRegistry register(Class<P1> parameter1Class, Class<P2> parameter2Class, Class<R> resultClass, BiFunction<? super P1, ? super P2, ? extends R> biFunction) {\n+        biFunctions.add(new BiFunctionRecord(parameter1Class, parameter2Class, biFunction));\n+        return this;\n+    }\n+\n+    public Object apply(Object parameter) {\n+        final var parameterClass = parameter.getClass();\n+        final List<FunctionRecord> applicableRecords = new ArrayList<>();\n+        functions.forEach((function) -> {\n+            if (function.isApplicable(parameterClass)) {\n+                boolean insert = true;\n+                for (int i = 0; i < applicableRecords.size(); i++) {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM2MjcyNA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501362724", "bodyText": "Unsure about this, @sirius-1 thoughts?", "author": "aldebaran30701", "createdAt": "2020-10-07T23:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMzU3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU2NzExMA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r503567110", "bodyText": "Again, if it is easier to understand as a while loop then better off to change it.", "author": "sirius-1", "createdAt": "2020-10-12T22:34:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzMzU3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzNTYzNA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500635634", "bodyText": "Change the declaration to not be var for both of these", "author": "antares1470", "createdAt": "2020-10-06T22:39:23Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/OperatorRegistry.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.BiFunction;\n+import java.util.function.Function;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class OperatorRegistry {\n+\n+    private final String name;\n+    private final List<FunctionRecord> functions = new ArrayList<>();\n+    private final List<BiFunctionRecord> biFunctions = new ArrayList<>();\n+\n+    public OperatorRegistry(String name) {\n+        this.name = name;\n+    }\n+\n+    public final <P, R> OperatorRegistry register(Class<P> parameterClass, Class<R> resultClass, Function<? super P, ? extends R> function) {\n+        functions.add(new FunctionRecord(parameterClass, function));\n+        return this;\n+    }\n+\n+    public final <P1, P2, R> OperatorRegistry register(Class<P1> parameter1Class, Class<P2> parameter2Class, Class<R> resultClass, BiFunction<? super P1, ? super P2, ? extends R> biFunction) {\n+        biFunctions.add(new BiFunctionRecord(parameter1Class, parameter2Class, biFunction));\n+        return this;\n+    }\n+\n+    public Object apply(Object parameter) {\n+        final var parameterClass = parameter.getClass();\n+        final List<FunctionRecord> applicableRecords = new ArrayList<>();\n+        functions.forEach((function) -> {\n+            if (function.isApplicable(parameterClass)) {\n+                boolean insert = true;\n+                for (int i = 0; i < applicableRecords.size(); i++) {\n+                    switch (function.compareTo(applicableRecords.get(i))) {\n+                        case -1:\n+                            insert = false;\n+                            break;\n+                        case 0:\n+                            break;\n+                        case 1:\n+                            applicableRecords.remove(i);\n+                            i -= 1;\n+                            break;\n+                        default:\n+                            // Default case added - S131\n+                            break;\n+                    }\n+                }\n+                if (insert) {\n+                    applicableRecords.add(function);\n+                }\n+            }\n+        });\n+        switch (applicableRecords.size()) {\n+            case 0:\n+                return null;\n+            case 1:\n+                return applicableRecords.get(0).apply(parameter);\n+            default:\n+                throw new IllegalArgumentException(\"Ambiguous operator\");\n+        }\n+    }\n+\n+    public Object apply(Object parameter1, Object parameter2) {\n+        final var parameter1Class = parameter1.getClass();\n+        final var parameter2Class = parameter2.getClass();", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM1NTQxOQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501355419", "bodyText": "Changed to Class<?>", "author": "aldebaran30701", "createdAt": "2020-10-07T22:54:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzNTYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzNjgxMw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500636813", "bodyText": "Declare as OperatorRegistry", "author": "antares1470", "createdAt": "2020-10-06T22:42:33Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/Operators.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * \n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class Operators {\n+    \n+    private static final Operators DEFAULT = new Operators();\n+    \n+    public static Operators getDefault() {\n+        return DEFAULT;\n+    }\n+    \n+    private final Map<String, OperatorRegistry> registries = new HashMap<>();\n+    \n+    public final OperatorRegistry getRegistry(String name) {\n+        synchronized(registries) {\n+            var registry = registries.get(name);", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzNzEyMQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500637121", "bodyText": "Declare these without using var. I'll stop adding comments for all of them but there do seem to be more scattered throughout the code", "author": "antares1470", "createdAt": "2020-10-06T22:43:24Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/StringOperation.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * \n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value;\n+\n+import au.gov.asd.tac.constellation.graph.value.constants.StringConstant;\n+import au.gov.asd.tac.constellation.graph.value.readables.BooleanReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.DoubleReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.FloatReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.IntReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.LongReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.StringReadable;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public interface StringOperation {\n+    boolean execute(String p1, String p2);\n+    \n+    default void register(OperatorRegistry registry) {\n+        \n+        registry.register(StringReadable.class, StringReadable.class, BooleanReadable.class, (p1, p2) -> { \n+            return () -> execute(p1.readString(), p2.readString()); \n+        });\n+        \n+        registry.register(StringConstant.class, StringConstant.class, BooleanReadable.class, (p1, p2) -> { \n+            final var p1String = p1.readString();\n+            final var p2String = p2.readString();\n+            final var result = execute(p1String, p2String);", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzODUxNg==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500638516", "bodyText": "Is the intention that stuff can be added to this interface? A blank interface seems unnecessary (could just use StringReadable)", "author": "antares1470", "createdAt": "2020-10-06T22:47:09Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/constants/StringConstant.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * \n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.constants;\n+\n+import au.gov.asd.tac.constellation.graph.value.readables.StringReadable;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public interface StringConstant extends StringReadable {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3MDQ3OA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r503570478", "bodyText": "The interfaces implemented by a class are used to determine how operators are applied to that object. In this case, it is to allow string constants in the query to be treated differently to string values coming from the graph. For example, '45' + age where age is of type integer will cause an integer addition to occur. However, name + age, where name is of type string and age in of type integer will cause a string concatenation. In the first case, '45' is a StringConstant, while in the second case, name is of type StringReadable. Maybe there is a better way to express this?", "author": "sirius-1", "createdAt": "2020-10-12T22:45:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzODUxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODg4MDcwNQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r508880705", "bodyText": "Ok, I think that makes sense. Happy to leave those as is then", "author": "antares1470", "createdAt": "2020-10-20T22:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDYzODUxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0MDIxMQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500640211", "bodyText": "public abstract static rather than public static abstract", "author": "antares1470", "createdAt": "2020-10-06T22:51:58Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/expression/ExpressionParser.java", "diffHunk": "@@ -0,0 +1,465 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.expression;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class ExpressionParser {\n+\n+    public static final char NO_TOKEN = 0;\n+    private static final String NESTED_PARENTHESIS_ERROR = \"Invalid nesting of parenthesis\";\n+    private static final String ENDS_WITH_OPERATOR_ERROR = \"An expression cannot end with an operator\";\n+    private static final String END_OF_QUOTED_STRING_ERROR = \"Unexpected end of expression while in quoted string\";\n+    private static final String UNEXPECTED_CHARACTER_ERROR = \"Unexpected character: \";\n+\n+    private static enum ParseState {\n+        READING_WHITESPACE,\n+        READING_SINGLE_STRING,\n+        READING_DOUBLE_STRING,\n+        READING_VARIABLE,\n+        READING_SINGLE_ESCAPED,\n+        READING_DOUBLE_ESCAPED\n+    }\n+\n+    public static enum Operator {\n+        AND_AND(NO_TOKEN, 11),\n+        AND('&', 11, null, AND_AND),\n+        OR_OR(NO_TOKEN, 12),\n+        OR('|', 12, null, OR_OR),\n+        EXCLUSIVE_OR('^', 3),\n+        NOT('!', 2),\n+        ADD('+', 4),\n+        SUBTRACT('-', 4),\n+        MULTIPLY('*', 3),\n+        DIVIDE('/', 3),\n+        MODULO('%', 3),\n+        GREATER_THAN('>', 6),\n+        LESS_THAN('<', 6),\n+        GREATER_THAN_OR_EQUALS(NO_TOKEN, 6),\n+        LESS_THAN_OR_EQUALS(NO_TOKEN, 6),\n+        NOT_EQUALS(NO_TOKEN, 7),\n+        CONTAINS(NO_TOKEN, 4),\n+        STARTS_WITH(NO_TOKEN, 4),\n+        ENDS_WITH(NO_TOKEN, 4),\n+        EQUALS(NO_TOKEN, 7),\n+        ASSIGN('=', 14, null, EQUALS, GREATER_THAN, GREATER_THAN_OR_EQUALS, LESS_THAN, LESS_THAN_OR_EQUALS, NOT, NOT_EQUALS);\n+\n+        private final char token;\n+        private final int precedence;\n+        private final Map<Operator, Operator> combinations = new HashMap<>();\n+\n+        private Operator(char token, int precedence, Operator... combinations) {\n+            this.token = token;\n+            this.precedence = precedence;\n+\n+            for (int i = 0; i < combinations.length; i += 2) {\n+                if (combinations[i] == null) {\n+                    this.combinations.put(this, combinations[i + 1]);\n+                } else {\n+                    this.combinations.put(combinations[i], combinations[i + 1]);\n+                }\n+            }\n+        }\n+\n+        public char getToken() {\n+            return token;\n+        }\n+\n+        public int getPrecedence() {\n+            return precedence;\n+        }\n+\n+        private static final Map<Character, Operator> OPERATOR_TOKENS = new HashMap<>();\n+\n+        static {\n+            for (final Operator operator : Operator.values()) {\n+                if (operator.token != NO_TOKEN) {\n+                    OPERATOR_TOKENS.put(operator.token, operator);\n+                }\n+            }\n+        }\n+    }\n+\n+    private static final Map<String, Operator> WORD_OPERATORS = new HashMap<>();\n+\n+    static {\n+        WORD_OPERATORS.put(\"contains\", Operator.CONTAINS);\n+        WORD_OPERATORS.put(\"startswith\", Operator.STARTS_WITH);\n+        WORD_OPERATORS.put(\"endswith\", Operator.ENDS_WITH);\n+        WORD_OPERATORS.put(\"or\", Operator.OR);\n+        WORD_OPERATORS.put(\"and\", Operator.AND);\n+        WORD_OPERATORS.put(\"equals\", Operator.EQUALS);\n+        WORD_OPERATORS.put(\"notequals\", Operator.NOT_EQUALS);\n+    }\n+\n+    private ExpressionParser() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static abstract class Expression {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0MzExMA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500643110", "bodyText": "assuming to the todo is the children being empty then adding currentExpression.children.isEmpty to the beginning of the if conditional should resolve the todo (|| it with the current conditional)", "author": "antares1470", "createdAt": "2020-10-06T23:00:21Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/expression/ExpressionParser.java", "diffHunk": "@@ -0,0 +1,465 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.expression;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class ExpressionParser {\n+\n+    public static final char NO_TOKEN = 0;\n+    private static final String NESTED_PARENTHESIS_ERROR = \"Invalid nesting of parenthesis\";\n+    private static final String ENDS_WITH_OPERATOR_ERROR = \"An expression cannot end with an operator\";\n+    private static final String END_OF_QUOTED_STRING_ERROR = \"Unexpected end of expression while in quoted string\";\n+    private static final String UNEXPECTED_CHARACTER_ERROR = \"Unexpected character: \";\n+\n+    private static enum ParseState {\n+        READING_WHITESPACE,\n+        READING_SINGLE_STRING,\n+        READING_DOUBLE_STRING,\n+        READING_VARIABLE,\n+        READING_SINGLE_ESCAPED,\n+        READING_DOUBLE_ESCAPED\n+    }\n+\n+    public static enum Operator {\n+        AND_AND(NO_TOKEN, 11),\n+        AND('&', 11, null, AND_AND),\n+        OR_OR(NO_TOKEN, 12),\n+        OR('|', 12, null, OR_OR),\n+        EXCLUSIVE_OR('^', 3),\n+        NOT('!', 2),\n+        ADD('+', 4),\n+        SUBTRACT('-', 4),\n+        MULTIPLY('*', 3),\n+        DIVIDE('/', 3),\n+        MODULO('%', 3),\n+        GREATER_THAN('>', 6),\n+        LESS_THAN('<', 6),\n+        GREATER_THAN_OR_EQUALS(NO_TOKEN, 6),\n+        LESS_THAN_OR_EQUALS(NO_TOKEN, 6),\n+        NOT_EQUALS(NO_TOKEN, 7),\n+        CONTAINS(NO_TOKEN, 4),\n+        STARTS_WITH(NO_TOKEN, 4),\n+        ENDS_WITH(NO_TOKEN, 4),\n+        EQUALS(NO_TOKEN, 7),\n+        ASSIGN('=', 14, null, EQUALS, GREATER_THAN, GREATER_THAN_OR_EQUALS, LESS_THAN, LESS_THAN_OR_EQUALS, NOT, NOT_EQUALS);\n+\n+        private final char token;\n+        private final int precedence;\n+        private final Map<Operator, Operator> combinations = new HashMap<>();\n+\n+        private Operator(char token, int precedence, Operator... combinations) {\n+            this.token = token;\n+            this.precedence = precedence;\n+\n+            for (int i = 0; i < combinations.length; i += 2) {\n+                if (combinations[i] == null) {\n+                    this.combinations.put(this, combinations[i + 1]);\n+                } else {\n+                    this.combinations.put(combinations[i], combinations[i + 1]);\n+                }\n+            }\n+        }\n+\n+        public char getToken() {\n+            return token;\n+        }\n+\n+        public int getPrecedence() {\n+            return precedence;\n+        }\n+\n+        private static final Map<Character, Operator> OPERATOR_TOKENS = new HashMap<>();\n+\n+        static {\n+            for (final Operator operator : Operator.values()) {\n+                if (operator.token != NO_TOKEN) {\n+                    OPERATOR_TOKENS.put(operator.token, operator);\n+                }\n+            }\n+        }\n+    }\n+\n+    private static final Map<String, Operator> WORD_OPERATORS = new HashMap<>();\n+\n+    static {\n+        WORD_OPERATORS.put(\"contains\", Operator.CONTAINS);\n+        WORD_OPERATORS.put(\"startswith\", Operator.STARTS_WITH);\n+        WORD_OPERATORS.put(\"endswith\", Operator.ENDS_WITH);\n+        WORD_OPERATORS.put(\"or\", Operator.OR);\n+        WORD_OPERATORS.put(\"and\", Operator.AND);\n+        WORD_OPERATORS.put(\"equals\", Operator.EQUALS);\n+        WORD_OPERATORS.put(\"notequals\", Operator.NOT_EQUALS);\n+    }\n+\n+    private ExpressionParser() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static abstract class Expression {\n+\n+        private SequenceExpression parent;\n+\n+        private Expression(SequenceExpression parent) {\n+            this.parent = parent;\n+        }\n+\n+        public SequenceExpression getParent() {\n+            return parent;\n+        }\n+\n+        protected abstract void print(String prefix, StringBuilder out);\n+\n+        @Override\n+        public String toString() {\n+            final var out = new StringBuilder();\n+            print(\"\", out);\n+            return out.toString();\n+        }\n+    }\n+\n+    public static class VariableExpression extends Expression {\n+\n+        private final String content;\n+\n+        private VariableExpression(SequenceExpression parent, char[] content, int contentLength) {\n+            super(parent);\n+            this.content = new String(content, 0, contentLength);\n+        }\n+\n+        public String getContent() {\n+            return content;\n+        }\n+\n+        @Override\n+        protected void print(String prefix, StringBuilder out) {\n+            out.append(prefix).append(\"VARIABLE: \").append(content).append(\"\\n\");\n+        }\n+    }\n+\n+    public static class StringExpression extends Expression {\n+\n+        private final String content;\n+\n+        private StringExpression(SequenceExpression parent, char[] content, int contentLength) {\n+            super(parent);\n+            this.content = new String(content, 0, contentLength);\n+        }\n+\n+        public String getContent() {\n+            return content;\n+        }\n+\n+        @Override\n+        protected void print(String prefix, StringBuilder out) {\n+            out.append(prefix).append(\"STRING: \").append(content).append(\"\\n\");\n+        }\n+    }\n+\n+    public static class OperatorExpression extends Expression {\n+\n+        private Operator operator;\n+\n+        private OperatorExpression(SequenceExpression parent, Operator operator) {\n+            super(parent);\n+            this.operator = operator;\n+        }\n+\n+        public Operator getOperator() {\n+            return operator;\n+        }\n+\n+        @Override\n+        protected void print(String prefix, StringBuilder out) {\n+            out.append(prefix).append(\"OPERATOR\").append(\": \").append(operator).append(\"\\n\");\n+        }\n+    }\n+\n+    public static class SequenceExpression extends Expression {\n+\n+        private final List<Expression> children = new ArrayList<>();\n+        private final List<Expression> unmodifiableChildren = Collections.unmodifiableList(children);\n+\n+        private SequenceExpression(SequenceExpression parent) {\n+            super(parent);\n+        }\n+\n+        public List<Expression> getUnmodifiableChildren() {\n+            return unmodifiableChildren;\n+        }\n+\n+        private void addChild(Expression expression) {\n+\n+            if (expression instanceof SequenceExpression) {\n+                final var tokenSequence = (SequenceExpression) expression;\n+                switch (tokenSequence.children.size()) {\n+                    case 0:\n+                        return;\n+                    case 1:\n+                        expression = tokenSequence.children.get(0);\n+                        break;\n+                    default:\n+                        if (tokenSequence.children.get(tokenSequence.children.size() - 1) instanceof OperatorExpression) {\n+                            throw new IllegalArgumentException(ENDS_WITH_OPERATOR_ERROR);\n+                        }\n+                }\n+            }\n+\n+            if (expression instanceof OperatorExpression && !children.isEmpty()) {\n+                final var lastChild = children.get(children.size() - 1);\n+                if (lastChild instanceof OperatorExpression) {\n+                    final var tokenOperator = (OperatorExpression) expression;\n+                    final var lastChildOperator = (OperatorExpression) lastChild;\n+                    final var combinedOperator = tokenOperator.operator.combinations.get(lastChildOperator.operator);\n+                    if (combinedOperator != null) {\n+                        children.remove(children.size() - 1);\n+                        tokenOperator.operator = combinedOperator;\n+                    }\n+                }\n+            }\n+\n+            if (!(expression instanceof OperatorExpression) && !children.isEmpty()) {\n+                final var lastChild = children.get(children.size() - 1);\n+                if (lastChild instanceof OperatorExpression) {\n+                    if (children.size() == 1 || children.get(children.size() - 2) instanceof OperatorExpression) {\n+                        final var childSequence = new SequenceExpression(this);\n+                        lastChild.parent = childSequence;\n+                        childSequence.children.add(lastChild);\n+                        expression.parent = childSequence;\n+                        childSequence.children.add(expression);\n+                        children.remove(children.size() - 1);\n+                        addChild(childSequence);\n+                        return;\n+                    }\n+                } else {\n+                    if (expression instanceof VariableExpression) {\n+                        final var tokenVariable = (VariableExpression) expression;\n+                        final var wordOperator = WORD_OPERATORS.get(tokenVariable.content.toLowerCase());\n+                        if (wordOperator != null) {\n+                            children.add(new OperatorExpression(this, wordOperator));\n+                            return;\n+                        }\n+                    }\n+                    throw new IllegalStateException(\"2 non-operator tokens in sequence\");\n+                }\n+            }\n+\n+            children.add(expression);\n+        }\n+\n+        public void normalize() {\n+            normalizeChildren();\n+\n+            while (children.size() > 3) {\n+                var lowestPrecedence = Integer.MAX_VALUE;\n+                var lowestIndex = -1;\n+                for (int i = 1; i < children.size(); i += 2) {\n+                    final int precedence = ((OperatorExpression) children.get(i)).getOperator().getPrecedence();\n+                    if (precedence < lowestPrecedence) {\n+                        lowestPrecedence = precedence;\n+                        lowestIndex = i;\n+                    }\n+                }\n+\n+                final var childSequence = new SequenceExpression(this);\n+\n+                final var left = children.remove(lowestIndex - 1);\n+                left.parent = childSequence;\n+                childSequence.addChild(left);\n+\n+                final var operator = children.remove(lowestIndex - 1);\n+                operator.parent = childSequence;\n+                childSequence.addChild(operator);\n+\n+                final var right = children.get(lowestIndex - 1);\n+                right.parent = childSequence;\n+                childSequence.addChild(right);\n+\n+                children.set(lowestIndex - 1, childSequence);\n+            }\n+        }\n+\n+        private void normalizeChildren() {\n+            for (int i = children.size() - 1; i >= 0; i--) {\n+                final var child = children.get(i);\n+                if (child instanceof SequenceExpression) {\n+                    ((SequenceExpression) child).normalize();\n+                }\n+            }\n+        }\n+\n+        @Override\n+        protected void print(String prefix, StringBuilder out) {\n+            out.append(prefix).append(\"(\\n\");\n+            children.forEach(child -> {\n+                child.print(prefix + \"  \", out);\n+            });\n+            out.append(prefix).append(\")\\n\");\n+        }\n+    }\n+\n+    public static SequenceExpression parse(String expression) {\n+\n+        var state = ParseState.READING_WHITESPACE;\n+        var content = new char[expression.length()];\n+        var contentLength = 0;\n+\n+        var rootExpression = new SequenceExpression(null);\n+        var currentExpression = rootExpression;\n+\n+        for (int i = 0; i <= expression.length(); i++) {\n+            final char c = i < expression.length() ? expression.charAt(i) : 0;\n+\n+            switch (state) {\n+                case READING_WHITESPACE:\n+                    if (c != ' ' && c != 0) {\n+                        if (isLetter(c)) {\n+                            content[contentLength++] = c;\n+                            state = ParseState.READING_VARIABLE;\n+                        } else if (c == '\\'') {\n+                            state = ParseState.READING_SINGLE_STRING;\n+                        } else if (c == '\"') {\n+                            state = ParseState.READING_DOUBLE_STRING;\n+                        } else if (c == '(') {\n+                            currentExpression = new SequenceExpression(currentExpression);\n+                        } else if (c == ')') {\n+                            if (currentExpression == rootExpression) {\n+                                throw new IllegalArgumentException(NESTED_PARENTHESIS_ERROR);\n+                            }\n+                            final var parentExpression = currentExpression.getParent();\n+                            parentExpression.addChild(currentExpression);\n+                            currentExpression = parentExpression;\n+                        } else if (Operator.OPERATOR_TOKENS.containsKey(c)) {\n+                            currentExpression.addChild(new OperatorExpression(currentExpression, Operator.OPERATOR_TOKENS.get(c)));\n+                        } else {\n+                            throw new IllegalArgumentException(UNEXPECTED_CHARACTER_ERROR + c);\n+                        }\n+                    }\n+                    break;\n+\n+                case READING_VARIABLE:\n+                    if (c == ' ' || c == 0) {\n+                        currentExpression.addChild(new VariableExpression(currentExpression, content, contentLength));\n+                        contentLength = 0;\n+                        state = ParseState.READING_WHITESPACE;\n+                    } else if (isLetter(c) || isDigit(c)) {\n+                        content[contentLength++] = c;\n+                    } else if (c == '(') {\n+                        currentExpression.addChild(new VariableExpression(currentExpression, content, contentLength));\n+                        contentLength = 0;\n+                        currentExpression = new SequenceExpression(currentExpression);\n+                    } else if (c == ')') {\n+                        if (currentExpression == rootExpression) {\n+                            throw new IllegalArgumentException(NESTED_PARENTHESIS_ERROR);\n+                        }\n+                        currentExpression.addChild(new VariableExpression(currentExpression, content, contentLength));\n+                        contentLength = 0;\n+                        final var parentExpression = currentExpression.getParent();\n+                        parentExpression.addChild(currentExpression);\n+                        currentExpression = parentExpression;\n+                        state = ParseState.READING_WHITESPACE;\n+                    } else if (Operator.OPERATOR_TOKENS.containsKey(c)) {\n+                        currentExpression.addChild(new VariableExpression(currentExpression, content, contentLength));\n+                        contentLength = 0;\n+                        currentExpression.addChild(new OperatorExpression(currentExpression, Operator.OPERATOR_TOKENS.get(c)));\n+                        state = ParseState.READING_WHITESPACE;\n+                    } else {\n+                        throw new IllegalArgumentException(UNEXPECTED_CHARACTER_ERROR + c);\n+                    }\n+                    break;\n+\n+                case READING_SINGLE_STRING:\n+                    if (c == '\\'') {\n+                        currentExpression.addChild(new StringExpression(currentExpression, content, contentLength));\n+                        contentLength = 0;\n+                        state = ParseState.READING_WHITESPACE;\n+                    } else if (c == '\\\\') {\n+                        state = ParseState.READING_SINGLE_ESCAPED;\n+                    } else if (c == 0) {\n+                        throw new IllegalArgumentException(END_OF_QUOTED_STRING_ERROR);\n+                    } else {\n+                        content[contentLength++] = c;\n+                    }\n+                    break;\n+\n+                case READING_DOUBLE_STRING:\n+                    if (c == '\"') {\n+                        currentExpression.addChild(new StringExpression(currentExpression, content, contentLength));\n+                        contentLength = 0;\n+                        state = ParseState.READING_WHITESPACE;\n+                    } else if (c == '\\\\') {\n+                        state = ParseState.READING_DOUBLE_ESCAPED;\n+                    } else if (c == 0) {\n+                        throw new IllegalArgumentException(END_OF_QUOTED_STRING_ERROR);\n+                    } else {\n+                        content[contentLength++] = c;\n+                    }\n+                    break;\n+\n+                case READING_SINGLE_ESCAPED:\n+                    if (c == 0) {\n+                        throw new IllegalArgumentException(END_OF_QUOTED_STRING_ERROR);\n+                    } else {\n+                        content[contentLength++] = c;\n+                        state = ParseState.READING_SINGLE_STRING;\n+                    }\n+                    break;\n+\n+                case READING_DOUBLE_ESCAPED:\n+                    if (c == 0) {\n+                        throw new IllegalArgumentException(END_OF_QUOTED_STRING_ERROR);\n+                    } else {\n+                        content[contentLength++] = c;\n+                        state = ParseState.READING_DOUBLE_STRING;\n+                    }\n+                    break;\n+            }\n+        }\n+\n+        if (currentExpression != rootExpression) {\n+            throw new IllegalArgumentException(NESTED_PARENTHESIS_ERROR);\n+        }\n+        if (rootExpression.children.size() == 1) {\n+            final var onlyChild = rootExpression.children.get(0);\n+            if (onlyChild instanceof SequenceExpression) {\n+                rootExpression = (SequenceExpression) onlyChild;\n+            }\n+        }\n+        // TODO: errors as indexoutofbounds when it is 0.\n+        if (!currentExpression.children.isEmpty() && currentExpression.children.get(currentExpression.children.size() - 1) instanceof OperatorExpression) {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM1NzgxNw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501357817", "bodyText": "I added the comment as a note to myself to mention this to @sirius-1\nAdding the check if it wasn't null seemed enough to stop the issue occurring. I'll remove the TODO.", "author": "aldebaran30701", "createdAt": "2020-10-07T23:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0MzExMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NTk2Mw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500645963", "bodyText": "change to return p2 == null || p1.compareTo(p2) > 0", "author": "antares1470", "createdAt": "2020-10-06T23:09:36Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/operations/GreaterThan.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.operations;\n+\n+import au.gov.asd.tac.constellation.graph.value.ComparisonOperation;\n+import au.gov.asd.tac.constellation.graph.value.Operators;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class GreaterThan {\n+\n+    public static final String NAME = \"GREATER_THAN\";\n+\n+    private GreaterThan() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static final ComparisonOperation COMPARISON_OPERATION = new ComparisonOperation() {\n+        @Override\n+        public boolean execute(double p1, double p2) {\n+            return p1 > p2;\n+        }\n+\n+        @Override\n+        public boolean execute(float p1, float p2) {\n+            return p1 > p2;\n+        }\n+\n+        @Override\n+        public boolean execute(long p1, long p2) {\n+            return p1 > p2;\n+        }\n+\n+        @Override\n+        public boolean execute(int p1, int p2) {\n+            return p1 > p2;\n+        }\n+\n+        @Override\n+        public boolean execute(String p1, String p2) {\n+            if (p1 == null) {\n+                return false;\n+            } else {\n+                return p2 == null ? true : p1.compareTo(p2) > 0;", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NjIxNA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500646214", "bodyText": "change to return p2 == null || p1.compareTo(p2) >= 0", "author": "antares1470", "createdAt": "2020-10-06T23:10:19Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/operations/GreaterThanOrEquals.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.operations;\n+\n+import au.gov.asd.tac.constellation.graph.value.ComparisonOperation;\n+import au.gov.asd.tac.constellation.graph.value.Operators;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class GreaterThanOrEquals {\n+\n+    public static final String NAME = \"GREATER_THAN_OR_EQUALS\";\n+\n+    private GreaterThanOrEquals() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static final ComparisonOperation COMPARISON_OPERATION = new ComparisonOperation() {\n+        @Override\n+        public boolean execute(double p1, double p2) {\n+            return p1 >= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(float p1, float p2) {\n+            return p1 >= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(long p1, long p2) {\n+            return p1 >= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(int p1, int p2) {\n+            return p1 >= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(String p1, String p2) {\n+            if (p1 == null) {\n+                return p2 == null;\n+            } else {\n+                return p2 == null ? true : p1.compareTo(p2) >= 0;", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NjUyMg==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500646522", "bodyText": "change to return p2 != null && p1.compareTo(p2) < 0", "author": "antares1470", "createdAt": "2020-10-06T23:11:22Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/operations/LessThan.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.operations;\n+\n+import au.gov.asd.tac.constellation.graph.value.ComparisonOperation;\n+import au.gov.asd.tac.constellation.graph.value.Operators;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class LessThan {\n+\n+    public static final String NAME = \"LESS_THAN\";\n+\n+    private LessThan() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static final ComparisonOperation COMPARISON_OPERATION = new ComparisonOperation() {\n+        @Override\n+        public boolean execute(double p1, double p2) {\n+            return p1 < p2;\n+        }\n+\n+        @Override\n+        public boolean execute(float p1, float p2) {\n+            return p1 < p2;\n+        }\n+\n+        @Override\n+        public boolean execute(long p1, long p2) {\n+            return p1 < p2;\n+        }\n+\n+        @Override\n+        public boolean execute(int p1, int p2) {\n+            return p1 < p2;\n+        }\n+\n+        @Override\n+        public boolean execute(String p1, String p2) {\n+            if (p1 == null) {\n+                return p2 != null;\n+            } else {\n+                return p2 == null ? false : p1.compareTo(p2) < 0;", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0NzAwMA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500647000", "bodyText": "change to return p2 != null && p1.compareTo(p2) <= 0", "author": "antares1470", "createdAt": "2020-10-06T23:12:52Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/operations/LessThanOrEquals.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.operations;\n+\n+import au.gov.asd.tac.constellation.graph.value.ComparisonOperation;\n+import au.gov.asd.tac.constellation.graph.value.Operators;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class LessThanOrEquals {\n+\n+    public static final String NAME = \"LESS_THAN_OR_EQUALS\";\n+\n+    private LessThanOrEquals() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static final ComparisonOperation COMPARISON_OPERATION = new ComparisonOperation() {\n+        @Override\n+        public boolean execute(double p1, double p2) {\n+            return p1 <= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(float p1, float p2) {\n+            return p1 <= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(long p1, long p2) {\n+            return p1 <= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(int p1, int p2) {\n+            return p1 <= p2;\n+        }\n+\n+        @Override\n+        public boolean execute(String p1, String p2) {\n+            if (p1 == null) {\n+                return true;\n+            } else {\n+                return p2 == null ? false : p1.compareTo(p2) <= 0;", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0Nzc0NA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500647744", "bodyText": "can remove the brackets from p1 (similar for following instances)", "author": "antares1470", "createdAt": "2020-10-06T23:15:19Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/operations/Negative.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.operations;\n+\n+import au.gov.asd.tac.constellation.graph.value.Operators;\n+import au.gov.asd.tac.constellation.graph.value.readables.DoubleReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.FloatReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.IntReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.LongReadable;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class Negative {\n+\n+    public static final String NAME = \"NEGATIVE\";\n+\n+    private Negative() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static void register(Operators operators) {\n+        final var registry = operators.getRegistry(NAME);\n+\n+        registry.register(DoubleReadable.class, DoubleReadable.class, (p1) -> {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0ODAyMQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500648021", "bodyText": "can remove brackets surrounding p1 and alter lambda to p1 -> p1 (similar for following instances)", "author": "antares1470", "createdAt": "2020-10-06T23:16:18Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/operations/Positive.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.operations;\n+\n+import au.gov.asd.tac.constellation.graph.value.Operators;\n+import au.gov.asd.tac.constellation.graph.value.readables.DoubleReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.FloatReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.IntReadable;\n+import au.gov.asd.tac.constellation.graph.value.readables.LongReadable;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class Positive {\n+\n+    public static final String NAME = \"POSITIVE\";\n+\n+    private Positive() {\n+        // added private constructor to hide implicit public constructor - S1118.\n+    }\n+\n+    public static void register(Operators operators) {\n+        final var registry = operators.getRegistry(NAME);\n+\n+        registry.register(DoubleReadable.class, DoubleReadable.class, (p1) -> {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0OTU1Ng==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500649556", "bodyText": "this and number of other interfaces for expressions are blank. Is there a reason why they need to be included?", "author": "antares1470", "createdAt": "2020-10-06T23:21:30Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/readables/And.java", "diffHunk": "@@ -0,0 +1,25 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * \n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.readables;\n+\n+import au.gov.asd.tac.constellation.graph.value.Readable;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public interface And<V> extends Readable<V> {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM2MTAyNA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501361024", "bodyText": "I'd have to check with @sirius-1 as to why", "author": "aldebaran30701", "createdAt": "2020-10-07T23:11:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0OTU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3MTc0Ng==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r503571746", "bodyText": "I have left a comment above with respect to StringConstant and StringReadable. Maybe there is a better way to express this?", "author": "sirius-1", "createdAt": "2020-10-12T22:48:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY0OTU1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1MTU0OA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500651548", "bodyText": "package names shouldn't have any capitals but personally I reckon we could probably just put this one and others directly in the types directory (I not too bothered by the number of files that it may end up containing)", "author": "antares1470", "createdAt": "2020-10-06T23:28:26Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/types/booleanType/BooleanLogicConverters.java", "diffHunk": "@@ -0,0 +1,157 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.types.booleanType;", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTM2NDcxNg==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501364716", "bodyText": "So put all the types directly into the types directory? It would contain around 50 classes if I'm understanding correctly", "author": "aldebaran30701", "createdAt": "2020-10-07T23:22:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1MTU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTQzMzU4Ng==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r501433586", "bodyText": "Splitting in packages by type isn't really something that has been done in the rest of the code base which is why I made the suggestion. As I say it out loud though, 50 classes does seem like a lot to put into one package. Three options I can think of for this:\n\nLeave the structure as is and alter the names of sub-directories of types from camel case to lower case (e.g. booleanType -> booleantype) to follow recommended naming convention\nMove all the files from sub-directories of types directly into the types directory\nRestructure the sub-directories of types to be split by functionality rather than by type (logic converters, value stores, etc)", "author": "antares1470", "createdAt": "2020-10-08T03:55:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1MTU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjA0NTIxOQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r502045219", "bodyText": "I'm liking the sound of 3, it sounds like it fits with what is currently throughout the project.\nJust on that, @sirius-1 I was wondering the difference of IntValue within value.values and the IntValue within Value.types.integerType.", "author": "aldebaran30701", "createdAt": "2020-10-08T22:22:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1MTU0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU3NTA3Mg==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r503575072", "bodyText": "Yeah, that is a pretty bad name clash. integerType.IntValue is actually the type used extensively in the framework. values.IntValue was just an implementation designed to be used programmatically to allow the insertion of values into expressions when needed. Looking at them now, the integerType.IntValue class does seem to provide all the functionality of the other and make the values.IntValue redundant. It looks like they are not used anyway so maybe just delete?", "author": "sirius-1", "createdAt": "2020-10-12T22:58:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY1MTU0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2MjMxOA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500662318", "bodyText": "can omit V in return type (i.e. ObjectValue<>())", "author": "antares1470", "createdAt": "2020-10-07T00:03:04Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/types/objectType/ObjectValueStore.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ * \n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ * \n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ * \n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.types.objectType;\n+\n+import java.util.Arrays;\n+import au.gov.asd.tac.constellation.graph.value.ValueStore;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class ObjectValueStore<V> implements ValueStore<ObjectValue<V>> {\n+\n+    private static final Object[] EMPTY_VALUES = new Object[0];\n+    \n+    private Object[] values = EMPTY_VALUES;\n+    \n+    public ObjectValueStore() {\n+        this.values = EMPTY_VALUES;\n+    }\n+    \n+    public ObjectValueStore(V[] values) {\n+        this.values = values;\n+    }\n+    \n+    @Override\n+    public ObjectValue<V> createValue() {\n+        return new ObjectValue<V>();", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2MzE4NA==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500663184", "bodyText": "public static synchronized", "author": "antares1470", "createdAt": "2020-10-07T00:06:11Z", "path": "CoreLayersView/src/au/gov/asd/tac/constellation/views/layers/LayersViewController.java", "diffHunk": "@@ -40,10 +45,74 @@\n  */\n public class LayersViewController {\n \n-    private final LayersViewTopComponent parent;\n+    // Layers view controller instance\n+    private static LayersViewController INSTANCE = null;\n+    private LayersViewTopComponent parent;\n \n-    public LayersViewController(final LayersViewTopComponent parent) {\n+    private final List<AttributeValueMonitor> valueMonitors;\n+    private final List<SchemaAttribute> changeListeners;\n+\n+    private final BitMaskQueryCollection vxBitMaskCollection = new BitMaskQueryCollection(GraphElementType.VERTEX);\n+    private final BitMaskQueryCollection txBitMaskCollection = new BitMaskQueryCollection(GraphElementType.TRANSACTION);\n+\n+    /**\n+     * Private constructor for singleton\n+     */\n+    private LayersViewController() {\n+        this.valueMonitors = new ArrayList<>();\n+        this.changeListeners = new ArrayList<>();\n+    }\n+\n+    /**\n+     * Singleton instance retrieval\n+     *\n+     * @return the instance, if one is not made, it will make one.\n+     */\n+    public synchronized static LayersViewController getDefault() {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2NDU4MQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500664581", "bodyText": "change modifiers of above 4 fields to static final", "author": "antares1470", "createdAt": "2020-10-07T00:11:03Z", "path": "CoreLayersView/src/au/gov/asd/tac/constellation/views/layers/query/BitMaskQueryCollection.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.layers.query;\n+\n+import au.gov.asd.tac.constellation.graph.GraphElementType;\n+import au.gov.asd.tac.constellation.graph.GraphReadMethods;\n+import au.gov.asd.tac.constellation.graph.GraphWriteMethods;\n+import au.gov.asd.tac.constellation.graph.schema.attribute.SchemaAttribute;\n+import au.gov.asd.tac.constellation.graph.schema.attribute.SchemaAttributeUtilities;\n+import au.gov.asd.tac.constellation.graph.value.values.IntValue;\n+import java.util.ArrayList;\n+import java.util.List;\n+import org.apache.commons.lang3.StringUtils;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class BitMaskQueryCollection {\n+\n+    public final static int MAX_QUERY_AMT = 64;\n+    private final static String INVALID_INDEX_ERROR = \" is not a valid index for a layer\";\n+\n+    public final static BitMaskQuery[] DEFAULT_VX_QUERIES = new BitMaskQuery[]{\n+        new BitMaskQuery(new Query(null, BitMaskQuery.DEFAULT_QUERY_STRING), 0, BitMaskQuery.DEFAULT_QUERY_DESCRIPTION),\n+        new BitMaskQuery(new Query(GraphElementType.VERTEX, null), 1, StringUtils.EMPTY)};\n+\n+    public final static BitMaskQuery[] DEFAULT_TX_QUERIES = new BitMaskQuery[]{", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2NTc4OQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500665789", "bodyText": "Split the InterruptedException and ExecutionException cases as there is no need to interrupt the thread in the ExecutionException case", "author": "antares1470", "createdAt": "2020-10-07T00:15:03Z", "path": "CoreLayersView/src/au/gov/asd/tac/constellation/views/layers/shortcut/LayersViewShortcuts.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.layers.shortcut;\n+\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.PluginExecution;\n+import au.gov.asd.tac.constellation.views.layers.LayersViewController;\n+import java.awt.event.ActionEvent;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.Future;\n+import javax.swing.AbstractAction;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.awt.ActionRegistration;\n+import org.openide.util.Exceptions;\n+import org.openide.util.NbBundle;\n+\n+/**\n+ * Defines the keyboard shortcuts for use with the Layers view\n+ *\n+ * @author formalhaut69\n+ */\n+@ActionID(category = \"Options\", id = \"au.gov.asd.tac.constellation.views.layersviewshortcuts\")\n+@ActionRegistration(displayName = \"#CTL_LayersViewShortcuts\", surviveFocusChange = true)\n+@ActionReferences({\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-D\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-L\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-1\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-2\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-3\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-4\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-5\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-6\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-7\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-8\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-9\")\n+})\n+@NbBundle.Messages(\"CTL_LayersViewShortcuts=Layers View: Shortcuts\")\n+public class LayersViewShortcuts extends AbstractAction {\n+\n+    @Override\n+    public void actionPerformed(ActionEvent e) {\n+        Future<?> enableLayerFuture = null;\n+\n+        final String hotkey = e.getActionCommand();\n+        switch (hotkey) {\n+            case \"CA-L\":\n+                PluginExecution.withPlugin(new NewLayerPlugin()).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-D\":\n+                PluginExecution.withPlugin(new DeselectAllLayersPlugin()).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-1\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(1)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-2\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(2)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-3\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(3)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-4\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(4)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-5\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(5)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-6\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(6)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-7\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(7)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-8\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(8)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-9\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(9)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            default:\n+                break;\n+        }\n+\n+        // wait for future, execute and update the state.\n+        if (enableLayerFuture != null) {\n+            try {\n+                enableLayerFuture.get();\n+            } catch (InterruptedException | ExecutionException ex) {\n+                Exceptions.printStackTrace(ex);\n+                // Restore interrupted state...\n+                Thread.currentThread().interrupt();", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2NTg1Mg==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500665852", "bodyText": "same here", "author": "antares1470", "createdAt": "2020-10-07T00:15:15Z", "path": "CoreLayersView/src/au/gov/asd/tac/constellation/views/layers/shortcut/LayersViewShortcuts.java", "diffHunk": "@@ -0,0 +1,121 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.layers.shortcut;\n+\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.PluginExecution;\n+import au.gov.asd.tac.constellation.views.layers.LayersViewController;\n+import java.awt.event.ActionEvent;\n+import java.util.concurrent.ExecutionException;\n+import java.util.concurrent.Future;\n+import javax.swing.AbstractAction;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.awt.ActionRegistration;\n+import org.openide.util.Exceptions;\n+import org.openide.util.NbBundle;\n+\n+/**\n+ * Defines the keyboard shortcuts for use with the Layers view\n+ *\n+ * @author formalhaut69\n+ */\n+@ActionID(category = \"Options\", id = \"au.gov.asd.tac.constellation.views.layersviewshortcuts\")\n+@ActionRegistration(displayName = \"#CTL_LayersViewShortcuts\", surviveFocusChange = true)\n+@ActionReferences({\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-D\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-L\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-1\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-2\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-3\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-4\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-5\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-6\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-7\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-8\"),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-9\")\n+})\n+@NbBundle.Messages(\"CTL_LayersViewShortcuts=Layers View: Shortcuts\")\n+public class LayersViewShortcuts extends AbstractAction {\n+\n+    @Override\n+    public void actionPerformed(ActionEvent e) {\n+        Future<?> enableLayerFuture = null;\n+\n+        final String hotkey = e.getActionCommand();\n+        switch (hotkey) {\n+            case \"CA-L\":\n+                PluginExecution.withPlugin(new NewLayerPlugin()).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-D\":\n+                PluginExecution.withPlugin(new DeselectAllLayersPlugin()).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-1\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(1)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-2\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(2)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-3\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(3)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-4\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(4)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-5\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(5)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-6\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(6)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-7\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(7)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-8\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(8)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            case \"CA-9\":\n+                enableLayerFuture = PluginExecution.withPlugin(new EnableLayerPlugin(9)).executeLater(GraphManager.getDefault().getActiveGraph());\n+                break;\n+            default:\n+                break;\n+        }\n+\n+        // wait for future, execute and update the state.\n+        if (enableLayerFuture != null) {\n+            try {\n+                enableLayerFuture.get();\n+            } catch (InterruptedException | ExecutionException ex) {\n+                Exceptions.printStackTrace(ex);\n+                // Restore interrupted state...\n+                Thread.currentThread().interrupt();\n+            }\n+\n+            LayersViewController.getDefault().execute();\n+            final Future<?> writeStateFuture = LayersViewController.getDefault().writeState();\n+            if (writeStateFuture != null) {\n+                try {\n+                    writeStateFuture.get();\n+                } catch (InterruptedException | ExecutionException ex) {\n+                    Exceptions.printStackTrace(ex);\n+                    // Restore interrupted state...\n+                    Thread.currentThread().interrupt();", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2NjY1OQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500666659", "bodyText": "can omit static modifier from nested enum (nested enums are static implicitly)", "author": "antares1470", "createdAt": "2020-10-07T00:18:12Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/expression/ExpressionParser.java", "diffHunk": "@@ -0,0 +1,465 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.expression;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class ExpressionParser {\n+\n+    public static final char NO_TOKEN = 0;\n+    private static final String NESTED_PARENTHESIS_ERROR = \"Invalid nesting of parenthesis\";\n+    private static final String ENDS_WITH_OPERATOR_ERROR = \"An expression cannot end with an operator\";\n+    private static final String END_OF_QUOTED_STRING_ERROR = \"Unexpected end of expression while in quoted string\";\n+    private static final String UNEXPECTED_CHARACTER_ERROR = \"Unexpected character: \";\n+\n+    private static enum ParseState {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDY2NjcwNQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r500666705", "bodyText": "same here", "author": "antares1470", "createdAt": "2020-10-07T00:18:20Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/expression/ExpressionParser.java", "diffHunk": "@@ -0,0 +1,465 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.graph.value.expression;\n+\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ *\n+ * @author sirius\n+ */\n+public class ExpressionParser {\n+\n+    public static final char NO_TOKEN = 0;\n+    private static final String NESTED_PARENTHESIS_ERROR = \"Invalid nesting of parenthesis\";\n+    private static final String ENDS_WITH_OPERATOR_ERROR = \"An expression cannot end with an operator\";\n+    private static final String END_OF_QUOTED_STRING_ERROR = \"Unexpected end of expression while in quoted string\";\n+    private static final String UNEXPECTED_CHARACTER_ERROR = \"Unexpected character: \";\n+\n+    private static enum ParseState {\n+        READING_WHITESPACE,\n+        READING_SINGLE_STRING,\n+        READING_DOUBLE_STRING,\n+        READING_VARIABLE,\n+        READING_SINGLE_ESCAPED,\n+        READING_DOUBLE_ESCAPED\n+    }\n+\n+    public static enum Operator {", "originalCommit": "2c8ce30289dd4da043903eb88ff0a058c9f8de94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a78eaa6446651be3c0bb46aeed3e6604e5b303a", "url": "https://github.com/constellation-app/constellation/commit/4a78eaa6446651be3c0bb46aeed3e6604e5b303a", "message": "Requested changes fix", "committedDate": "2020-10-07T23:39:59Z", "type": "commit"}, {"oid": "cc862d8cc4ea76332f79c41f293f04029b891b4d", "url": "https://github.com/constellation-app/constellation/commit/cc862d8cc4ea76332f79c41f293f04029b891b4d", "message": "Replace var with explicit type", "committedDate": "2020-10-13T22:39:35Z", "type": "commit"}, {"oid": "f9d2cafaf602610c2fdecaf038247ce2e35a1398", "url": "https://github.com/constellation-app/constellation/commit/f9d2cafaf602610c2fdecaf038247ce2e35a1398", "message": "convert for loop to while", "committedDate": "2020-10-13T22:58:33Z", "type": "commit"}, {"oid": "3db11bce4284cd7a426a0bdc4f0f5e407c0db581", "url": "https://github.com/constellation-app/constellation/commit/3db11bce4284cd7a426a0bdc4f0f5e407c0db581", "message": "sonarcube fixes", "committedDate": "2020-10-26T02:29:00Z", "type": "commit"}, {"oid": "859e0d443cf2cbd55eb8aeda116374c4b116b28a", "url": "https://github.com/constellation-app/constellation/commit/859e0d443cf2cbd55eb8aeda116374c4b116b28a", "message": "SQ Fixes", "committedDate": "2020-10-30T04:03:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3NDA2Nw==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r515674067", "bodyText": "I'll just point out as an FYI that an easier solution for the code smell you were fixing here would've been to simply omit the curly braces as they were unnecessary in the switch statement case", "author": "antares1470", "createdAt": "2020-11-01T21:26:44Z", "path": "CoreGraphFramework/src/au/gov/asd/tac/constellation/graph/value/expression/ExpressionCompiler.java", "diffHunk": "@@ -89,35 +89,38 @@ private ExpressionCompiler() {\n         // added private constructor to hide implicit public constructor - S1118.\n     }\n \n+    private static Object compileTwoChildrenExpression(final List<Expression> children, final VariableProvider variableProvider, final IntReadable indexReadable, final Operators operators) {\n+        final OperatorExpression operator = (OperatorExpression) children.get(0);\n+        final Object right = compileExpression(children.get(1), variableProvider, indexReadable, operators);\n+        final String operatorName = CONVERTER_CLASSES.get(operator.getOperator());\n+        final Object result = operators.getRegistry(operatorName).apply(right);\n+        if (result == null) {\n+            throw new ExpressionException(\"Unable to find implementation of operator: \" + operatorName + \" (\" + right.getClass().getCanonicalName() + \")\");\n+        }\n+        return result;\n+    }\n+\n+    private static Object compileThreeChildrenExpression(final List<Expression> children, final VariableProvider variableProvider, final IntReadable indexReadable, final Operators operators) {\n+        final Object left = compileExpression(children.get(0), variableProvider, indexReadable, operators);\n+        final OperatorExpression operator = (OperatorExpression) children.get(1);\n+        final Object right = compileExpression(children.get(2), variableProvider, indexReadable, operators);\n+        final String operatorName = OPERATOR_CLASSES.get(operator.getOperator());\n+        final Object result = operators.getRegistry(operatorName).apply(left, right);\n+        if (result == null) {\n+            throw new ExpressionException(\"Unable to find implementation of operator: \" + operatorName + \" (\" + left.getClass().getCanonicalName() + \", \" + right.getClass().getCanonicalName() + \")\");\n+        }\n+        return result;\n+    }\n+\n     public static Object compileSequenceExpression(SequenceExpression expression, VariableProvider variableProvider, IntReadable indexReadable, Operators operators) {\n         final List<Expression> children = expression.getUnmodifiableChildren();\n         switch (children.size()) {\n             case 1:\n                 return compileExpression(children.get(0), variableProvider, indexReadable, operators);\n-\n-            case 2: {\n-                final OperatorExpression operator = (OperatorExpression) children.get(0);\n-                final Object right = compileExpression(children.get(1), variableProvider, indexReadable, operators);\n-                final String operatorName = CONVERTER_CLASSES.get(operator.getOperator());\n-                final Object result = operators.getRegistry(operatorName).apply(right);\n-                if (result == null) {\n-                    throw new ExpressionException(\"Unable to find implementation of operator: \" + operatorName + \" (\" + right.getClass().getCanonicalName() + \")\");\n-                }\n-                return result;\n-            }\n-\n-            case 3: {\n-                final Object left = compileExpression(children.get(0), variableProvider, indexReadable, operators);\n-                final OperatorExpression operator = (OperatorExpression) children.get(1);\n-                final Object right = compileExpression(children.get(2), variableProvider, indexReadable, operators);\n-                final String operatorName = OPERATOR_CLASSES.get(operator.getOperator());\n-                final Object result = operators.getRegistry(operatorName).apply(left, right);\n-                if (result == null) {\n-                    throw new ExpressionException(\"Unable to find implementation of operator: \" + operatorName + \" (\" + left.getClass().getCanonicalName() + \", \" + right.getClass().getCanonicalName() + \")\");\n-                }\n-                return result;\n-            }\n-\n+            case 2:\n+                return compileTwoChildrenExpression(children, variableProvider, indexReadable, operators);", "originalCommit": "859e0d443cf2cbd55eb8aeda116374c4b116b28a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3NTExMQ==", "url": "https://github.com/constellation-app/constellation/pull/849#discussion_r515675111", "bodyText": "I use them myself and didn't know that you could do multi-line without them. I can revert adding them to methods if it helps readability?", "author": "aldebaran30701", "createdAt": "2020-11-01T21:37:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTY3NDA2Nw=="}], "type": "inlineReview"}, {"oid": "83ee8a62c2a52ac5c6a24822168578a9853821a9", "url": "https://github.com/constellation-app/constellation/commit/83ee8a62c2a52ac5c6a24822168578a9853821a9", "message": "revert switch statements from methods", "committedDate": "2020-11-01T22:08:04Z", "type": "commit"}, {"oid": "802d4653e8b192c4ab323fbcfb2ad90c5b79316c", "url": "https://github.com/constellation-app/constellation/commit/802d4653e8b192c4ab323fbcfb2ad90c5b79316c", "message": "sonar diamond operator", "committedDate": "2020-11-01T22:53:16Z", "type": "commit"}]}