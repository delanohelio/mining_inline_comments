{"pr_number": 880, "pr_title": "Notes View", "pr_createdAt": "2020-10-27T06:47:02Z", "pr_url": "https://github.com/constellation-app/constellation/pull/880", "timeline": [{"oid": "50f687c17d0446b6e6a2ba227b7b48bfd11ff762", "url": "https://github.com/constellation-app/constellation/commit/50f687c17d0446b6e6a2ba227b7b48bfd11ff762", "message": "Add Notes View", "committedDate": "2020-10-27T06:48:07Z", "type": "commit"}, {"oid": "bc8668775c4c0f953890ec261e1029b11b3f8509", "url": "https://github.com/constellation-app/constellation/commit/bc8668775c4c0f953890ec261e1029b11b3f8509", "message": "Add new icon and comments", "committedDate": "2020-11-02T05:46:23Z", "type": "commit"}, {"oid": "f778be375d9f1c0eccfebdbc16073d594e091b30", "url": "https://github.com/constellation-app/constellation/commit/f778be375d9f1c0eccfebdbc16073d594e091b30", "message": "Merge branch 'master' into feature/Notes-View-#56", "committedDate": "2020-11-02T05:47:50Z", "type": "commit"}, {"oid": "48e688843bb08d43b93c17671f2f5c0cceb1817b", "url": "https://github.com/constellation-app/constellation/commit/48e688843bb08d43b93c17671f2f5c0cceb1817b", "message": "Fix nfinite loop bug and refactor existing code", "committedDate": "2020-11-04T08:04:40Z", "type": "commit"}, {"oid": "a9849dc4e2980dc9df67654d6e4b0e41147dfa25", "url": "https://github.com/constellation-app/constellation/commit/a9849dc4e2980dc9df67654d6e4b0e41147dfa25", "message": "Merge branch 'master' into feature/Notes-View-#56", "committedDate": "2020-11-04T08:06:02Z", "type": "commit"}, {"oid": "056e9a073ed1ae6c21b0c6d9dbedb0cd8b101723", "url": "https://github.com/constellation-app/constellation/commit/056e9a073ed1ae6c21b0c6d9dbedb0cd8b101723", "message": "Add filter for notes", "committedDate": "2020-12-08T08:12:29Z", "type": "commit"}, {"oid": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "url": "https://github.com/constellation-app/constellation/commit/7005a3cb3f68c8432abb2747a98c6c749e6088d5", "message": "Merge branch 'master' into feature/Notes-View-#56", "committedDate": "2020-12-08T08:13:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5NzgzNQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r538997835", "bodyText": "event can be final", "author": "antares1470", "createdAt": "2020-12-09T04:31:08Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewPane.java", "diffHunk": "@@ -0,0 +1,539 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReport;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReportListener;\n+import au.gov.asd.tac.constellation.views.notes.state.NotesViewEntry;\n+import java.text.SimpleDateFormat;\n+import java.time.ZonedDateTime;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.Date;\n+import java.util.List;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ListChangeListener;\n+import javafx.collections.ObservableList;\n+import javafx.geometry.Pos;\n+import javafx.scene.Scene;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TextArea;\n+import javafx.scene.control.TextField;\n+import javafx.scene.image.Image;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.BorderPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Priority;\n+import javafx.scene.layout.VBox;\n+import javafx.stage.Stage;\n+import javax.swing.JOptionPane;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.controlsfx.control.CheckComboBox;\n+import org.openide.windows.WindowManager;\n+\n+/**\n+ * Handles generating UI elements for the Notes View pane and its notes.\n+ * \n+ * @author sol695510\n+ */\n+public class NotesViewPane extends BorderPane implements PluginReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final List<NotesViewEntry> notesViewEntries;\n+    \n+    private final ObservableList<String> availableFilters;\n+    private final List<String> selectedFilters;\n+    private final CheckComboBox filterCheckComboBox;\n+    private Boolean isSelectedFiltersUpdating = false;\n+    \n+    private final HBox filterNotesHBox;\n+    private final VBox notesViewPaneVBox;\n+    private final VBox addNoteVBox;\n+    private final VBox notesListVBox;\n+    private final ScrollPane notesListScrollPane;\n+    private Stage editStage;\n+    \n+    private final int DEFAULT_SPACING = 5;\n+    private final String PROMPT_COLOUR = \"#909090\";\n+    private final String USER_COLOUR = \"#C15A58\";\n+    private final String AUTO_COLOUR = \"#588BC1\";\n+    private final String DATETIME_PATTERN = \"hh:mm:ss a 'on' dd/MM/yyyy\";\n+    \n+    /**\n+     * NotesViewPane constructor.\n+     * \n+     * @param controller \n+     */\n+    public NotesViewPane(final NotesViewController controller) {\n+        \n+        notesViewController = controller;\n+        notesViewEntries = new ArrayList<>();\n+        \n+        availableFilters = FXCollections.observableArrayList(\"User Notes\", \"Auto Notes\");\n+        selectedFilters = new ArrayList<>(availableFilters); // By default all filters are selected.\n+        \n+        // CheckComboBox to select and deselect various filters for note rendering.\n+        filterCheckComboBox = new CheckComboBox(availableFilters);\n+        filterCheckComboBox.setTitle(\"Select a filter...\");\n+        filterCheckComboBox.getCheckModel().getCheckedItems().addListener(new ListChangeListener() {\n+            @Override\n+            public void onChanged(ListChangeListener.Change event) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5ODQ0MQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r538998441", "bodyText": "pluginReport can be final", "author": "antares1470", "createdAt": "2020-12-09T04:32:53Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewPane.java", "diffHunk": "@@ -0,0 +1,539 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReport;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReportListener;\n+import au.gov.asd.tac.constellation.views.notes.state.NotesViewEntry;\n+import java.text.SimpleDateFormat;\n+import java.time.ZonedDateTime;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.Date;\n+import java.util.List;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ListChangeListener;\n+import javafx.collections.ObservableList;\n+import javafx.geometry.Pos;\n+import javafx.scene.Scene;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TextArea;\n+import javafx.scene.control.TextField;\n+import javafx.scene.image.Image;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.BorderPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Priority;\n+import javafx.scene.layout.VBox;\n+import javafx.stage.Stage;\n+import javax.swing.JOptionPane;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.controlsfx.control.CheckComboBox;\n+import org.openide.windows.WindowManager;\n+\n+/**\n+ * Handles generating UI elements for the Notes View pane and its notes.\n+ * \n+ * @author sol695510\n+ */\n+public class NotesViewPane extends BorderPane implements PluginReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final List<NotesViewEntry> notesViewEntries;\n+    \n+    private final ObservableList<String> availableFilters;\n+    private final List<String> selectedFilters;\n+    private final CheckComboBox filterCheckComboBox;\n+    private Boolean isSelectedFiltersUpdating = false;\n+    \n+    private final HBox filterNotesHBox;\n+    private final VBox notesViewPaneVBox;\n+    private final VBox addNoteVBox;\n+    private final VBox notesListVBox;\n+    private final ScrollPane notesListScrollPane;\n+    private Stage editStage;\n+    \n+    private final int DEFAULT_SPACING = 5;\n+    private final String PROMPT_COLOUR = \"#909090\";\n+    private final String USER_COLOUR = \"#C15A58\";\n+    private final String AUTO_COLOUR = \"#588BC1\";\n+    private final String DATETIME_PATTERN = \"hh:mm:ss a 'on' dd/MM/yyyy\";\n+    \n+    /**\n+     * NotesViewPane constructor.\n+     * \n+     * @param controller \n+     */\n+    public NotesViewPane(final NotesViewController controller) {\n+        \n+        notesViewController = controller;\n+        notesViewEntries = new ArrayList<>();\n+        \n+        availableFilters = FXCollections.observableArrayList(\"User Notes\", \"Auto Notes\");\n+        selectedFilters = new ArrayList<>(availableFilters); // By default all filters are selected.\n+        \n+        // CheckComboBox to select and deselect various filters for note rendering.\n+        filterCheckComboBox = new CheckComboBox(availableFilters);\n+        filterCheckComboBox.setTitle(\"Select a filter...\");\n+        filterCheckComboBox.getCheckModel().getCheckedItems().addListener(new ListChangeListener() {\n+            @Override\n+            public void onChanged(ListChangeListener.Change event) {\n+                if (!isSelectedFiltersUpdating) {\n+                    \n+                    setFilters(filterCheckComboBox.getCheckModel().getCheckedItems());\n+                    \n+                    final Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+\n+                    if (activeGraph != null) {\n+                        updateNotes();\n+                        controller.writeState();\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // VBox to store control items used to filter notes.\n+        filterNotesHBox = new HBox(DEFAULT_SPACING, filterCheckComboBox);\n+        filterNotesHBox.setAlignment(Pos.CENTER_LEFT);\n+        filterNotesHBox.setStyle(\"-fx-padding: 5px;\");\n+        \n+        // TextField to enter new note title.\n+        final TextField titleField = new TextField();\n+        titleField.setPromptText(\"Type a title...\");\n+        titleField.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+        \n+        // TextArea to enter new note content.\n+        final TextArea contentField = new TextArea();\n+        contentField.setPromptText(\"Type a note...\");\n+        contentField.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+        contentField.setWrapText(true);\n+        contentField.setOnKeyPressed(key -> {\n+            // If tab is typed and shift isn't being held dowm.\n+            if (key.getCode() == KeyCode.TAB && !key.isShiftDown()) {\n+                // Backspace any tabs typed.\n+                contentField.fireEvent(new KeyEvent(null, null, KeyEvent.KEY_PRESSED, \"\", \"\", KeyCode.BACK_SPACE, false, false, false, false));\n+                // Move focus to the next UI element.\n+                contentField.getParent().getChildrenUnmodifiable().get(contentField.getParent().getChildrenUnmodifiable().indexOf(contentField) + 1).requestFocus();\n+            }\n+        });\n+        \n+        // Button to add new note.\n+        final Button addNoteButton = new Button(\"Add Note\");\n+        addNoteButton.setOnAction(event -> {\n+            \n+            final Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+            \n+            if (activeGraph != null) {\n+                \n+                if ((titleField.getText().isBlank() && titleField.getText().isEmpty())\n+                        || (contentField.getText().isBlank() && contentField.getText().isEmpty())) {\n+                    JOptionPane.showMessageDialog(null, \"Type in missing fields.\", \"Invalid Text\", JOptionPane.WARNING_MESSAGE);\n+                } else {\n+                    notesViewEntries.add(new NotesViewEntry(\n+                            Long.toString(ZonedDateTime.now().toInstant().toEpochMilli()),\n+                            titleField.getText(),\n+                            contentField.getText(),\n+                            true\n+                    ));\n+                    \n+                    titleField.clear();\n+                    contentField.clear();\n+                    updateNotes();\n+                    controller.writeState();\n+                    event.consume();\n+                }\n+            }\n+        });\n+        \n+        // VBox to store control items used to add new note.\n+        addNoteVBox = new VBox(DEFAULT_SPACING, titleField, contentField, addNoteButton);\n+        addNoteVBox.setAlignment(Pos.CENTER_RIGHT);\n+        addNoteVBox.setStyle(\"-fx-padding: 5px;\");\n+        addNoteVBox.setMinHeight(200);\n+        \n+        // VBox in a ScrollPane for holding expanding list of user and plugin generated notes.\n+        notesListVBox = new VBox(DEFAULT_SPACING);\n+        notesListVBox.setAlignment(Pos.BOTTOM_CENTER);\n+        notesListScrollPane = new ScrollPane();\n+        notesListScrollPane.setContent(notesListVBox);\n+        notesListScrollPane.setStyle(\"-fx-padding: 5px; -fx-background-color: transparent;\");\n+        notesListScrollPane.setFitToWidth(true);\n+        VBox.setVgrow(notesListScrollPane, Priority.ALWAYS);\n+        \n+        // Main Notes View Pane VBox.\n+        notesViewPaneVBox = new VBox(DEFAULT_SPACING, filterNotesHBox, notesListScrollPane, addNoteVBox);\n+        notesViewPaneVBox.setAlignment(Pos.BOTTOM_CENTER);\n+        setCenter(notesViewPaneVBox);\n+    }\n+    \n+    /**\n+     * Prepares the pane used by the Notes View.\n+     * \n+     * @param controller \n+     * @param pane \n+     */\n+    protected synchronized void prepareNotesViewPane(final NotesViewController controller) {\n+        controller.addAttributes();\n+        controller.readState();\n+//        controller.addAttributes();\n+    }\n+    \n+    /**\n+     * Set the plugin reports that have executed on the current graph report.\n+     */\n+    protected synchronized void setGraphReport(final NotesViewController controller) {\n+        final GraphReport currentGraphReport = GraphReportManager.getGraphReport(GraphManager.getDefault().getActiveGraph().getId());\n+        \n+        if (currentGraphReport != null) {\n+            // Iterates the list of currently executed plugins.\n+            currentGraphReport.getPluginReports().forEach(pluginReport -> {\n+                setPluginReport(pluginReport);\n+            });\n+            // Clears duplicates from the list.\n+            final List<NotesViewEntry> uniqueNotes = clearDuplicates(notesViewEntries);\n+            notesViewEntries.clear();\n+            notesViewEntries.addAll(uniqueNotes);\n+            // Update the Notes View UI.\n+            updateNotes();\n+            updateFilters();\n+            controller.writeState();\n+        }\n+    }\n+    \n+    /**\n+     * Adds a plugin report to notesViewEntries as a Notes View Entry object.\n+     * \n+     * @param pluginReport Plugin report to be added.\n+     */\n+    protected synchronized void setPluginReport(final PluginReport pluginReport) {\n+        // Omit plugin reports from the Notes View and Quality Control View.\n+        if (!pluginReport.getPluginName().contains(\"Notes View\")) {\n+            if (!pluginReport.getPluginName().contains(\"Quality Control View\")) {\n+                // Listener monitors changes to the plugin report as it executes and finishes. Affects the output of getMessage().\n+                pluginReport.addPluginReportListener(this);\n+                \n+                notesViewEntries.add(new NotesViewEntry(\n+                        Long.toString(pluginReport.getStartTime()),\n+                        pluginReport.getPluginName(),\n+                        pluginReport.getMessage(),\n+                        false\n+                ));\n+            }\n+        }\n+    }\n+    \n+    /**\n+     * Returns an unmodifiable view backed by notesViewEntries.\n+     * \n+     * @return Unmodifiable view backed by notesViewEntries.\n+     */\n+    protected List<NotesViewEntry> getNotes() {\n+        return Collections.unmodifiableList(notesViewEntries);\n+    }\n+    \n+    /**\n+     * Returns an unmodifiable view backed by selectedFilters.\n+     * \n+     * @return Unmodifiable view backed by selectedFilters.\n+     */\n+    protected List<String> getFilters() {\n+        return Collections.unmodifiableList(selectedFilters);\n+    }\n+    \n+    /**\n+     * Sets notesViewEntries.\n+     * \n+     * @param notesViewEntries A list of NotesViewEntry objects to add to notesViewEntries.\n+     */\n+    protected synchronized void setNotes(final List<NotesViewEntry> notesViewEntries) {\n+        Platform.runLater(() -> {\n+            this.notesViewEntries.clear();\n+            \n+            notesViewEntries.forEach(entry -> {\n+                this.notesViewEntries.add(entry);\n+            });\n+            \n+            updateNotes();\n+        });\n+    }\n+    \n+    /**\n+     * Sets selectedFilters.\n+     * \n+     * @param selectFilters A list of String objects to add to selectedFilters.\n+     */\n+    protected synchronized void setFilters(final List<String> selectedFilters) {\n+        Platform.runLater(() -> {\n+            this.selectedFilters.clear();\n+            \n+            selectedFilters.forEach(filter -> {\n+                this.selectedFilters.add(filter);\n+            });\n+            \n+            updateFilters();\n+        });\n+    }\n+    \n+    /**\n+     * Updates the UI of the notes currently being displayed in the Notes View.\n+     */\n+    protected synchronized void updateNotes() {\n+        Platform.runLater(() -> {\n+            notesListVBox.getChildren().removeAll(notesListVBox.getChildren());\n+            \n+            final List<NotesViewEntry> notesToRender = new ArrayList<>();\n+            \n+            notesViewEntries.forEach(entry -> {\n+                // Add user note to render list if \"User Note\" filter is selected.\n+                if (selectedFilters.contains(\"User Notes\") && entry.isUserCreated()) {\n+                    notesToRender.add(entry);\n+                }\n+                // Add auto note to render list if \"Auto Note\" filter is selected.\n+                if (selectedFilters.contains(\"Auto Notes\") && !entry.isUserCreated()) {\n+                    notesToRender.add(entry);\n+                }\n+            });\n+            \n+            if (CollectionUtils.isNotEmpty(notesToRender)) {\n+                notesToRender.sort(Comparator.comparing(NotesViewEntry::getDateTime));\n+                notesToRender.forEach(note -> {\n+                    createNote(note);\n+                });\n+            }\n+        });\n+    }\n+    \n+    /**\n+     * Updates the UI of the filters currently being selected in the Notes View.\n+     */\n+    protected synchronized void updateFilters() {\n+        Platform.runLater(() -> {            \n+            isSelectedFiltersUpdating = true;\n+\n+            filterCheckComboBox.getCheckModel().clearChecks();\n+\n+            selectedFilters.forEach(filter -> {\n+                filterCheckComboBox.getCheckModel().check(filter);\n+            });\n+\n+            isSelectedFiltersUpdating = false;\n+        });\n+    }\n+    \n+    /**\n+     * Clears UI elements in the Notes View and clears the list of NoteEntry objects.\n+     */\n+    protected void clearNotes() {\n+        Platform.runLater(() -> {\n+            notesListVBox.getChildren().removeAll(notesListVBox.getChildren());\n+            notesViewEntries.clear();\n+        });\n+    }\n+    \n+    /**\n+     * Iterates list of NoteEntry objects and\n+     * removes objects that share the same dateTime.\n+     * \n+     * @param duplicatedNotes A list with duplicates.\n+     * @return The given list with duplicates removed.\n+     */\n+    private synchronized List<NotesViewEntry> clearDuplicates(final List<NotesViewEntry> duplicatedNotes) {\n+        final List<NotesViewEntry> uniqueNotes = new ArrayList();\n+        Collections.reverse(duplicatedNotes);\n+        \n+        duplicatedNotes.forEach(report -> {\n+            boolean isUnique = true;\n+            \n+            for (final NotesViewEntry uniqueReport : uniqueNotes) {\n+                if (report.getDateTime().equals(uniqueReport.getDateTime())) {\n+                    isUnique = false;\n+                }\n+            }\n+            // Adds only unique notes to the list.\n+            if (isUnique) {\n+                uniqueNotes.add(report);\n+            }\n+        });\n+        \n+        return uniqueNotes;\n+    }\n+    \n+    /**\n+     * Adds all available filters to the selectedFilters list.\n+     */\n+    protected void selectAllFilters() {\n+        setFilters(availableFilters);\n+    }\n+    \n+    /**\n+     * Takes a NoteEntry object and creates the UI for it in the Notes View.\n+     *\n+     * @param newNote NoteEntry object used to create a the note UI in the Notes View.\n+     */\n+    private void createNote(final NotesViewEntry newNote) {\n+        \n+        final String noteColour = newNote.isUserCreated() ? USER_COLOUR : AUTO_COLOUR;\n+        \n+        final Label dateTimeLabel = new Label((new SimpleDateFormat(DATETIME_PATTERN).format(new Date(Long.parseLong(newNote.getDateTime())))));\n+        dateTimeLabel.setWrapText(true);\n+        dateTimeLabel.setStyle(\"-fx-font-weight: bold; -fx-font-size: 15;\");\n+        \n+        final Label titleLabel = new Label(newNote.getNoteTitle());\n+        titleLabel.setWrapText(true);\n+        titleLabel.setStyle(\"-fx-font-weight: bold; -fx-font-size: 15;\");\n+        \n+        final Label contentLabel = new Label(newNote.getNoteContent());\n+        contentLabel.setWrapText(true);\n+        \n+        final VBox noteInformation = new VBox(DEFAULT_SPACING, dateTimeLabel, titleLabel, contentLabel);\n+        HBox.setHgrow(noteInformation, Priority.ALWAYS);\n+        \n+        final Button editButton = new Button(\"Edit\");\n+        editButton.setMinWidth(55);\n+        editButton.setOnAction(event -> {\n+            openEdit(newNote.getNoteTitle(), newNote.getNoteContent(), newNote);\n+            event.consume();\n+        });\n+        \n+        final Button deleteButton = new Button(\"Delete\");\n+        deleteButton.setMinWidth(55);\n+        \n+        final VBox noteButtons = new VBox(DEFAULT_SPACING, editButton, deleteButton);\n+        noteButtons.setAlignment(Pos.CENTER);\n+        \n+        final HBox noteBody = newNote.isUserCreated() ? new HBox(DEFAULT_SPACING, noteInformation, noteButtons) : new HBox(DEFAULT_SPACING, noteInformation);\n+        noteBody.setStyle(\"-fx-padding: 5px; -fx-background-color: \" + noteColour + \"; -fx-background-radius: 10 10 10 10;\");\n+        notesListVBox.getChildren().add(noteBody);\n+        \n+        deleteButton.setOnAction(event -> {\n+            if (notesViewEntries.removeIf(note -> note.getDateTime().equals(newNote.getDateTime()))) {\n+                notesListVBox.getChildren().remove(noteBody);\n+                notesViewController.writeState();\n+            }\n+            \n+            event.consume();\n+        });\n+        \n+        // Keeps the scroll bar at the bottom?\n+        Platform.runLater(() -> {\n+            notesListScrollPane.setVvalue(notesListScrollPane.getVmax());\n+        });\n+    }\n+    \n+    /**\n+     * Pop-up window for editing user created notes.\n+     * \n+     * @param title\n+     * @param content\n+     * @param noteToEdit\n+     */\n+    private void openEdit(final String title, final String content, final NotesViewEntry noteToEdit) {\n+        Platform.runLater(() -> {\n+            editStage = new Stage();\n+            editStage.getIcons().add(new Image(\"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\"));\n+            editStage.setTitle(\"Edit Note\");\n+//            editStage.setX(WindowManager.getDefault().getMainWindow().getBounds().getCenterX());\n+//            editStage.setY(WindowManager.getDefault().getMainWindow().getBounds().getCenterY());\n+            \n+            final TextField newTitle = new TextField(title);\n+            newTitle.setPromptText(\"Edit title...\");\n+            newTitle.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+            newTitle.setText(title);\n+            \n+            final TextArea newContent = new TextArea(content);\n+            newContent.setPromptText(\"Edit note...\");\n+            newContent.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+            newContent.setText(content);\n+            newContent.setWrapText(true);\n+            newContent.setOnKeyPressed(key -> {\n+                // If tab is typed and shift isn't being held dowm.\n+                if (key.getCode() == KeyCode.TAB && !key.isShiftDown()) {\n+                    // Backspace any tabs typed.\n+                    newContent.fireEvent(new KeyEvent(null, null, KeyEvent.KEY_PRESSED, \"\", \"\", KeyCode.BACK_SPACE, false, false, false, false));\n+                    // Move focus to the next UI element.\n+                    newContent.getParent().getChildrenUnmodifiable().get(newContent.getParent().getChildrenUnmodifiable().indexOf(newContent) + 1).requestFocus();\n+                }\n+            });\n+            \n+            final Button saveButton = new Button(\"Save\");\n+            saveButton.setOnAction(event -> {\n+                if ((newTitle.getText().isBlank() && newTitle.getText().isEmpty())\n+                        || (newContent.getText().isBlank() && newContent.getText().isEmpty())) {\n+                    JOptionPane.showMessageDialog(null, \"Type in missing fields.\", \"Invalid Text\", JOptionPane.WARNING_MESSAGE);\n+                } else {\n+                    noteToEdit.setNoteTitle(newTitle.getText());\n+                    noteToEdit.setNoteContent(newContent.getText());\n+                    updateNotes();\n+                    notesViewController.writeState();\n+                    closeEdit();\n+                }\n+                \n+                event.consume();\n+            });\n+            \n+            final VBox editNoteVBox = new VBox(DEFAULT_SPACING, newTitle, newContent, saveButton);\n+            editNoteVBox.setAlignment(Pos.CENTER_RIGHT);\n+            editNoteVBox.setStyle(\"-fx-padding: 5px;\");\n+            \n+            final Scene scene = new Scene(editNoteVBox, 250, 200);\n+            editStage.setScene(scene);\n+            editStage.show();\n+        });\n+    }\n+    \n+    /**\n+     * Convenience method to close the pop-up window for editing user created notes.\n+     */\n+    protected void closeEdit() {\n+        Platform.runLater(() -> {\n+            if (editStage != null && editStage.isShowing()) {\n+                editStage.close();\n+            }\n+        });\n+    }\n+    \n+    /**\n+     * Triggers when plugin reports undergo a change, such as when they go between executing and finishing.\n+     * \n+     * @param pluginReport \n+     */\n+    @Override\n+    public void pluginReportChanged(PluginReport pluginReport) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5ODU1OA==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r538998558", "bodyText": "parameters can be final", "author": "antares1470", "createdAt": "2020-12-09T04:33:19Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewPane.java", "diffHunk": "@@ -0,0 +1,539 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReport;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReportListener;\n+import au.gov.asd.tac.constellation.views.notes.state.NotesViewEntry;\n+import java.text.SimpleDateFormat;\n+import java.time.ZonedDateTime;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.Date;\n+import java.util.List;\n+import javafx.application.Platform;\n+import javafx.collections.FXCollections;\n+import javafx.collections.ListChangeListener;\n+import javafx.collections.ObservableList;\n+import javafx.geometry.Pos;\n+import javafx.scene.Scene;\n+import javafx.scene.control.Button;\n+import javafx.scene.control.Label;\n+import javafx.scene.control.ScrollPane;\n+import javafx.scene.control.TextArea;\n+import javafx.scene.control.TextField;\n+import javafx.scene.image.Image;\n+import javafx.scene.input.KeyCode;\n+import javafx.scene.input.KeyEvent;\n+import javafx.scene.layout.BorderPane;\n+import javafx.scene.layout.HBox;\n+import javafx.scene.layout.Priority;\n+import javafx.scene.layout.VBox;\n+import javafx.stage.Stage;\n+import javax.swing.JOptionPane;\n+import org.apache.commons.collections.CollectionUtils;\n+import org.controlsfx.control.CheckComboBox;\n+import org.openide.windows.WindowManager;\n+\n+/**\n+ * Handles generating UI elements for the Notes View pane and its notes.\n+ * \n+ * @author sol695510\n+ */\n+public class NotesViewPane extends BorderPane implements PluginReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final List<NotesViewEntry> notesViewEntries;\n+    \n+    private final ObservableList<String> availableFilters;\n+    private final List<String> selectedFilters;\n+    private final CheckComboBox filterCheckComboBox;\n+    private Boolean isSelectedFiltersUpdating = false;\n+    \n+    private final HBox filterNotesHBox;\n+    private final VBox notesViewPaneVBox;\n+    private final VBox addNoteVBox;\n+    private final VBox notesListVBox;\n+    private final ScrollPane notesListScrollPane;\n+    private Stage editStage;\n+    \n+    private final int DEFAULT_SPACING = 5;\n+    private final String PROMPT_COLOUR = \"#909090\";\n+    private final String USER_COLOUR = \"#C15A58\";\n+    private final String AUTO_COLOUR = \"#588BC1\";\n+    private final String DATETIME_PATTERN = \"hh:mm:ss a 'on' dd/MM/yyyy\";\n+    \n+    /**\n+     * NotesViewPane constructor.\n+     * \n+     * @param controller \n+     */\n+    public NotesViewPane(final NotesViewController controller) {\n+        \n+        notesViewController = controller;\n+        notesViewEntries = new ArrayList<>();\n+        \n+        availableFilters = FXCollections.observableArrayList(\"User Notes\", \"Auto Notes\");\n+        selectedFilters = new ArrayList<>(availableFilters); // By default all filters are selected.\n+        \n+        // CheckComboBox to select and deselect various filters for note rendering.\n+        filterCheckComboBox = new CheckComboBox(availableFilters);\n+        filterCheckComboBox.setTitle(\"Select a filter...\");\n+        filterCheckComboBox.getCheckModel().getCheckedItems().addListener(new ListChangeListener() {\n+            @Override\n+            public void onChanged(ListChangeListener.Change event) {\n+                if (!isSelectedFiltersUpdating) {\n+                    \n+                    setFilters(filterCheckComboBox.getCheckModel().getCheckedItems());\n+                    \n+                    final Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+\n+                    if (activeGraph != null) {\n+                        updateNotes();\n+                        controller.writeState();\n+                    }\n+                }\n+            }\n+        });\n+        \n+        // VBox to store control items used to filter notes.\n+        filterNotesHBox = new HBox(DEFAULT_SPACING, filterCheckComboBox);\n+        filterNotesHBox.setAlignment(Pos.CENTER_LEFT);\n+        filterNotesHBox.setStyle(\"-fx-padding: 5px;\");\n+        \n+        // TextField to enter new note title.\n+        final TextField titleField = new TextField();\n+        titleField.setPromptText(\"Type a title...\");\n+        titleField.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+        \n+        // TextArea to enter new note content.\n+        final TextArea contentField = new TextArea();\n+        contentField.setPromptText(\"Type a note...\");\n+        contentField.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+        contentField.setWrapText(true);\n+        contentField.setOnKeyPressed(key -> {\n+            // If tab is typed and shift isn't being held dowm.\n+            if (key.getCode() == KeyCode.TAB && !key.isShiftDown()) {\n+                // Backspace any tabs typed.\n+                contentField.fireEvent(new KeyEvent(null, null, KeyEvent.KEY_PRESSED, \"\", \"\", KeyCode.BACK_SPACE, false, false, false, false));\n+                // Move focus to the next UI element.\n+                contentField.getParent().getChildrenUnmodifiable().get(contentField.getParent().getChildrenUnmodifiable().indexOf(contentField) + 1).requestFocus();\n+            }\n+        });\n+        \n+        // Button to add new note.\n+        final Button addNoteButton = new Button(\"Add Note\");\n+        addNoteButton.setOnAction(event -> {\n+            \n+            final Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+            \n+            if (activeGraph != null) {\n+                \n+                if ((titleField.getText().isBlank() && titleField.getText().isEmpty())\n+                        || (contentField.getText().isBlank() && contentField.getText().isEmpty())) {\n+                    JOptionPane.showMessageDialog(null, \"Type in missing fields.\", \"Invalid Text\", JOptionPane.WARNING_MESSAGE);\n+                } else {\n+                    notesViewEntries.add(new NotesViewEntry(\n+                            Long.toString(ZonedDateTime.now().toInstant().toEpochMilli()),\n+                            titleField.getText(),\n+                            contentField.getText(),\n+                            true\n+                    ));\n+                    \n+                    titleField.clear();\n+                    contentField.clear();\n+                    updateNotes();\n+                    controller.writeState();\n+                    event.consume();\n+                }\n+            }\n+        });\n+        \n+        // VBox to store control items used to add new note.\n+        addNoteVBox = new VBox(DEFAULT_SPACING, titleField, contentField, addNoteButton);\n+        addNoteVBox.setAlignment(Pos.CENTER_RIGHT);\n+        addNoteVBox.setStyle(\"-fx-padding: 5px;\");\n+        addNoteVBox.setMinHeight(200);\n+        \n+        // VBox in a ScrollPane for holding expanding list of user and plugin generated notes.\n+        notesListVBox = new VBox(DEFAULT_SPACING);\n+        notesListVBox.setAlignment(Pos.BOTTOM_CENTER);\n+        notesListScrollPane = new ScrollPane();\n+        notesListScrollPane.setContent(notesListVBox);\n+        notesListScrollPane.setStyle(\"-fx-padding: 5px; -fx-background-color: transparent;\");\n+        notesListScrollPane.setFitToWidth(true);\n+        VBox.setVgrow(notesListScrollPane, Priority.ALWAYS);\n+        \n+        // Main Notes View Pane VBox.\n+        notesViewPaneVBox = new VBox(DEFAULT_SPACING, filterNotesHBox, notesListScrollPane, addNoteVBox);\n+        notesViewPaneVBox.setAlignment(Pos.BOTTOM_CENTER);\n+        setCenter(notesViewPaneVBox);\n+    }\n+    \n+    /**\n+     * Prepares the pane used by the Notes View.\n+     * \n+     * @param controller \n+     * @param pane \n+     */\n+    protected synchronized void prepareNotesViewPane(final NotesViewController controller) {\n+        controller.addAttributes();\n+        controller.readState();\n+//        controller.addAttributes();\n+    }\n+    \n+    /**\n+     * Set the plugin reports that have executed on the current graph report.\n+     */\n+    protected synchronized void setGraphReport(final NotesViewController controller) {\n+        final GraphReport currentGraphReport = GraphReportManager.getGraphReport(GraphManager.getDefault().getActiveGraph().getId());\n+        \n+        if (currentGraphReport != null) {\n+            // Iterates the list of currently executed plugins.\n+            currentGraphReport.getPluginReports().forEach(pluginReport -> {\n+                setPluginReport(pluginReport);\n+            });\n+            // Clears duplicates from the list.\n+            final List<NotesViewEntry> uniqueNotes = clearDuplicates(notesViewEntries);\n+            notesViewEntries.clear();\n+            notesViewEntries.addAll(uniqueNotes);\n+            // Update the Notes View UI.\n+            updateNotes();\n+            updateFilters();\n+            controller.writeState();\n+        }\n+    }\n+    \n+    /**\n+     * Adds a plugin report to notesViewEntries as a Notes View Entry object.\n+     * \n+     * @param pluginReport Plugin report to be added.\n+     */\n+    protected synchronized void setPluginReport(final PluginReport pluginReport) {\n+        // Omit plugin reports from the Notes View and Quality Control View.\n+        if (!pluginReport.getPluginName().contains(\"Notes View\")) {\n+            if (!pluginReport.getPluginName().contains(\"Quality Control View\")) {\n+                // Listener monitors changes to the plugin report as it executes and finishes. Affects the output of getMessage().\n+                pluginReport.addPluginReportListener(this);\n+                \n+                notesViewEntries.add(new NotesViewEntry(\n+                        Long.toString(pluginReport.getStartTime()),\n+                        pluginReport.getPluginName(),\n+                        pluginReport.getMessage(),\n+                        false\n+                ));\n+            }\n+        }\n+    }\n+    \n+    /**\n+     * Returns an unmodifiable view backed by notesViewEntries.\n+     * \n+     * @return Unmodifiable view backed by notesViewEntries.\n+     */\n+    protected List<NotesViewEntry> getNotes() {\n+        return Collections.unmodifiableList(notesViewEntries);\n+    }\n+    \n+    /**\n+     * Returns an unmodifiable view backed by selectedFilters.\n+     * \n+     * @return Unmodifiable view backed by selectedFilters.\n+     */\n+    protected List<String> getFilters() {\n+        return Collections.unmodifiableList(selectedFilters);\n+    }\n+    \n+    /**\n+     * Sets notesViewEntries.\n+     * \n+     * @param notesViewEntries A list of NotesViewEntry objects to add to notesViewEntries.\n+     */\n+    protected synchronized void setNotes(final List<NotesViewEntry> notesViewEntries) {\n+        Platform.runLater(() -> {\n+            this.notesViewEntries.clear();\n+            \n+            notesViewEntries.forEach(entry -> {\n+                this.notesViewEntries.add(entry);\n+            });\n+            \n+            updateNotes();\n+        });\n+    }\n+    \n+    /**\n+     * Sets selectedFilters.\n+     * \n+     * @param selectFilters A list of String objects to add to selectedFilters.\n+     */\n+    protected synchronized void setFilters(final List<String> selectedFilters) {\n+        Platform.runLater(() -> {\n+            this.selectedFilters.clear();\n+            \n+            selectedFilters.forEach(filter -> {\n+                this.selectedFilters.add(filter);\n+            });\n+            \n+            updateFilters();\n+        });\n+    }\n+    \n+    /**\n+     * Updates the UI of the notes currently being displayed in the Notes View.\n+     */\n+    protected synchronized void updateNotes() {\n+        Platform.runLater(() -> {\n+            notesListVBox.getChildren().removeAll(notesListVBox.getChildren());\n+            \n+            final List<NotesViewEntry> notesToRender = new ArrayList<>();\n+            \n+            notesViewEntries.forEach(entry -> {\n+                // Add user note to render list if \"User Note\" filter is selected.\n+                if (selectedFilters.contains(\"User Notes\") && entry.isUserCreated()) {\n+                    notesToRender.add(entry);\n+                }\n+                // Add auto note to render list if \"Auto Note\" filter is selected.\n+                if (selectedFilters.contains(\"Auto Notes\") && !entry.isUserCreated()) {\n+                    notesToRender.add(entry);\n+                }\n+            });\n+            \n+            if (CollectionUtils.isNotEmpty(notesToRender)) {\n+                notesToRender.sort(Comparator.comparing(NotesViewEntry::getDateTime));\n+                notesToRender.forEach(note -> {\n+                    createNote(note);\n+                });\n+            }\n+        });\n+    }\n+    \n+    /**\n+     * Updates the UI of the filters currently being selected in the Notes View.\n+     */\n+    protected synchronized void updateFilters() {\n+        Platform.runLater(() -> {            \n+            isSelectedFiltersUpdating = true;\n+\n+            filterCheckComboBox.getCheckModel().clearChecks();\n+\n+            selectedFilters.forEach(filter -> {\n+                filterCheckComboBox.getCheckModel().check(filter);\n+            });\n+\n+            isSelectedFiltersUpdating = false;\n+        });\n+    }\n+    \n+    /**\n+     * Clears UI elements in the Notes View and clears the list of NoteEntry objects.\n+     */\n+    protected void clearNotes() {\n+        Platform.runLater(() -> {\n+            notesListVBox.getChildren().removeAll(notesListVBox.getChildren());\n+            notesViewEntries.clear();\n+        });\n+    }\n+    \n+    /**\n+     * Iterates list of NoteEntry objects and\n+     * removes objects that share the same dateTime.\n+     * \n+     * @param duplicatedNotes A list with duplicates.\n+     * @return The given list with duplicates removed.\n+     */\n+    private synchronized List<NotesViewEntry> clearDuplicates(final List<NotesViewEntry> duplicatedNotes) {\n+        final List<NotesViewEntry> uniqueNotes = new ArrayList();\n+        Collections.reverse(duplicatedNotes);\n+        \n+        duplicatedNotes.forEach(report -> {\n+            boolean isUnique = true;\n+            \n+            for (final NotesViewEntry uniqueReport : uniqueNotes) {\n+                if (report.getDateTime().equals(uniqueReport.getDateTime())) {\n+                    isUnique = false;\n+                }\n+            }\n+            // Adds only unique notes to the list.\n+            if (isUnique) {\n+                uniqueNotes.add(report);\n+            }\n+        });\n+        \n+        return uniqueNotes;\n+    }\n+    \n+    /**\n+     * Adds all available filters to the selectedFilters list.\n+     */\n+    protected void selectAllFilters() {\n+        setFilters(availableFilters);\n+    }\n+    \n+    /**\n+     * Takes a NoteEntry object and creates the UI for it in the Notes View.\n+     *\n+     * @param newNote NoteEntry object used to create a the note UI in the Notes View.\n+     */\n+    private void createNote(final NotesViewEntry newNote) {\n+        \n+        final String noteColour = newNote.isUserCreated() ? USER_COLOUR : AUTO_COLOUR;\n+        \n+        final Label dateTimeLabel = new Label((new SimpleDateFormat(DATETIME_PATTERN).format(new Date(Long.parseLong(newNote.getDateTime())))));\n+        dateTimeLabel.setWrapText(true);\n+        dateTimeLabel.setStyle(\"-fx-font-weight: bold; -fx-font-size: 15;\");\n+        \n+        final Label titleLabel = new Label(newNote.getNoteTitle());\n+        titleLabel.setWrapText(true);\n+        titleLabel.setStyle(\"-fx-font-weight: bold; -fx-font-size: 15;\");\n+        \n+        final Label contentLabel = new Label(newNote.getNoteContent());\n+        contentLabel.setWrapText(true);\n+        \n+        final VBox noteInformation = new VBox(DEFAULT_SPACING, dateTimeLabel, titleLabel, contentLabel);\n+        HBox.setHgrow(noteInformation, Priority.ALWAYS);\n+        \n+        final Button editButton = new Button(\"Edit\");\n+        editButton.setMinWidth(55);\n+        editButton.setOnAction(event -> {\n+            openEdit(newNote.getNoteTitle(), newNote.getNoteContent(), newNote);\n+            event.consume();\n+        });\n+        \n+        final Button deleteButton = new Button(\"Delete\");\n+        deleteButton.setMinWidth(55);\n+        \n+        final VBox noteButtons = new VBox(DEFAULT_SPACING, editButton, deleteButton);\n+        noteButtons.setAlignment(Pos.CENTER);\n+        \n+        final HBox noteBody = newNote.isUserCreated() ? new HBox(DEFAULT_SPACING, noteInformation, noteButtons) : new HBox(DEFAULT_SPACING, noteInformation);\n+        noteBody.setStyle(\"-fx-padding: 5px; -fx-background-color: \" + noteColour + \"; -fx-background-radius: 10 10 10 10;\");\n+        notesListVBox.getChildren().add(noteBody);\n+        \n+        deleteButton.setOnAction(event -> {\n+            if (notesViewEntries.removeIf(note -> note.getDateTime().equals(newNote.getDateTime()))) {\n+                notesListVBox.getChildren().remove(noteBody);\n+                notesViewController.writeState();\n+            }\n+            \n+            event.consume();\n+        });\n+        \n+        // Keeps the scroll bar at the bottom?\n+        Platform.runLater(() -> {\n+            notesListScrollPane.setVvalue(notesListScrollPane.getVmax());\n+        });\n+    }\n+    \n+    /**\n+     * Pop-up window for editing user created notes.\n+     * \n+     * @param title\n+     * @param content\n+     * @param noteToEdit\n+     */\n+    private void openEdit(final String title, final String content, final NotesViewEntry noteToEdit) {\n+        Platform.runLater(() -> {\n+            editStage = new Stage();\n+            editStage.getIcons().add(new Image(\"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\"));\n+            editStage.setTitle(\"Edit Note\");\n+//            editStage.setX(WindowManager.getDefault().getMainWindow().getBounds().getCenterX());\n+//            editStage.setY(WindowManager.getDefault().getMainWindow().getBounds().getCenterY());\n+            \n+            final TextField newTitle = new TextField(title);\n+            newTitle.setPromptText(\"Edit title...\");\n+            newTitle.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+            newTitle.setText(title);\n+            \n+            final TextArea newContent = new TextArea(content);\n+            newContent.setPromptText(\"Edit note...\");\n+            newContent.setStyle(\"-fx-prompt-text-fill: \" + PROMPT_COLOUR + \";\");\n+            newContent.setText(content);\n+            newContent.setWrapText(true);\n+            newContent.setOnKeyPressed(key -> {\n+                // If tab is typed and shift isn't being held dowm.\n+                if (key.getCode() == KeyCode.TAB && !key.isShiftDown()) {\n+                    // Backspace any tabs typed.\n+                    newContent.fireEvent(new KeyEvent(null, null, KeyEvent.KEY_PRESSED, \"\", \"\", KeyCode.BACK_SPACE, false, false, false, false));\n+                    // Move focus to the next UI element.\n+                    newContent.getParent().getChildrenUnmodifiable().get(newContent.getParent().getChildrenUnmodifiable().indexOf(newContent) + 1).requestFocus();\n+                }\n+            });\n+            \n+            final Button saveButton = new Button(\"Save\");\n+            saveButton.setOnAction(event -> {\n+                if ((newTitle.getText().isBlank() && newTitle.getText().isEmpty())\n+                        || (newContent.getText().isBlank() && newContent.getText().isEmpty())) {\n+                    JOptionPane.showMessageDialog(null, \"Type in missing fields.\", \"Invalid Text\", JOptionPane.WARNING_MESSAGE);\n+                } else {\n+                    noteToEdit.setNoteTitle(newTitle.getText());\n+                    noteToEdit.setNoteContent(newContent.getText());\n+                    updateNotes();\n+                    notesViewController.writeState();\n+                    closeEdit();\n+                }\n+                \n+                event.consume();\n+            });\n+            \n+            final VBox editNoteVBox = new VBox(DEFAULT_SPACING, newTitle, newContent, saveButton);\n+            editNoteVBox.setAlignment(Pos.CENTER_RIGHT);\n+            editNoteVBox.setStyle(\"-fx-padding: 5px;\");\n+            \n+            final Scene scene = new Scene(editNoteVBox, 250, 200);\n+            editStage.setScene(scene);\n+            editStage.show();\n+        });\n+    }\n+    \n+    /**\n+     * Convenience method to close the pop-up window for editing user created notes.\n+     */\n+    protected void closeEdit() {\n+        Platform.runLater(() -> {\n+            if (editStage != null && editStage.isShowing()) {\n+                editStage.close();\n+            }\n+        });\n+    }\n+    \n+    /**\n+     * Triggers when plugin reports undergo a change, such as when they go between executing and finishing.\n+     * \n+     * @param pluginReport \n+     */\n+    @Override\n+    public void pluginReportChanged(PluginReport pluginReport) {\n+        setPluginReport(pluginReport);\n+        \n+        // Clears duplicates from the list.\n+        final List<NotesViewEntry> uniqueNotes = clearDuplicates(notesViewEntries);\n+        notesViewEntries.clear();\n+        notesViewEntries.addAll(uniqueNotes);\n+        // Update the Notes View UI.\n+        updateNotes();\n+        notesViewController.writeState();\n+    }\n+    \n+    @Override\n+    public void addedChildReport(PluginReport parentReport, PluginReport childReport) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTUyMQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r538999521", "bodyText": "This shortcut is currently used by Named Selections so one of the shortcuts will need to change", "author": "antares1470", "createdAt": "2020-12-09T04:36:30Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewTopComponent.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportListener;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.views.JavaFxTopComponent;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.util.NbBundle.Messages;\n+import org.openide.windows.TopComponent;\n+\n+/**\n+ * UI component associated with the Notes View.\n+ * \n+ * @author sol695510\n+ */\n+@TopComponent.Description(\n+        preferredID = \"NotesViewTopComponent\",\n+        iconBase = \"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\",\n+        persistenceType = TopComponent.PERSISTENCE_ALWAYS)\n+@TopComponent.Registration(\n+        mode = \"explorer\",\n+        openAtStartup = false)\n+@ActionID(\n+        category = \"Window\",\n+        id = \"au.gov.asd.tac.constellation.views.notes.NotesViewTopComponent\")\n+@ActionReferences({\n+    @ActionReference(path = \"Menu/Experimental/Views\", position = 500),\n+    @ActionReference(path = \"Shortcuts\", name = \"CS-N\")})", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTY4MA==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r538999680", "bodyText": "pluginReport can be final", "author": "antares1470", "createdAt": "2020-12-09T04:37:00Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewTopComponent.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportListener;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.views.JavaFxTopComponent;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.util.NbBundle.Messages;\n+import org.openide.windows.TopComponent;\n+\n+/**\n+ * UI component associated with the Notes View.\n+ * \n+ * @author sol695510\n+ */\n+@TopComponent.Description(\n+        preferredID = \"NotesViewTopComponent\",\n+        iconBase = \"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\",\n+        persistenceType = TopComponent.PERSISTENCE_ALWAYS)\n+@TopComponent.Registration(\n+        mode = \"explorer\",\n+        openAtStartup = false)\n+@ActionID(\n+        category = \"Window\",\n+        id = \"au.gov.asd.tac.constellation.views.notes.NotesViewTopComponent\")\n+@ActionReferences({\n+    @ActionReference(path = \"Menu/Experimental/Views\", position = 500),\n+    @ActionReference(path = \"Shortcuts\", name = \"CS-N\")})\n+@TopComponent.OpenActionRegistration(\n+        displayName = \"#CTL_NotesViewAction\",\n+        preferredID = \"NotesViewTopComponent\")\n+@Messages({\n+    \"CTL_NotesViewAction=Notes View\",\n+    \"CTL_NotesViewTopComponent=Notes View\",\n+    \"HINT_NotesViewTopComponent=Notes View\"})\n+\n+public class NotesViewTopComponent extends JavaFxTopComponent<NotesViewPane> implements GraphReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final NotesViewPane notesViewPane;\n+\n+    /**\n+     * Creates a new NotesViewTopComponent.\n+     */\n+    public NotesViewTopComponent() {\n+        \n+        setName(Bundle.CTL_NotesViewTopComponent());\n+        setToolTipText(Bundle.HINT_NotesViewTopComponent());\n+        \n+        initComponents();\n+        \n+        notesViewController = new NotesViewController(this);\n+        notesViewPane = new NotesViewPane(notesViewController);\n+        \n+        initContent();\n+    }\n+    \n+    @Override\n+    protected void handleNewGraph(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphOpened(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphClosed(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+            notesViewPane.closeEdit();\n+        }\n+    }\n+\n+    @Override\n+    protected void handleComponentOpened() {\n+        \n+        GraphReportManager.addGraphReportListener(this);\n+        Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+        \n+        if (activeGraph != null) {\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+            // Ensures plugin reports created while the Notes View is not \"open\" will appear when it is opened later.\n+            notesViewPane.setGraphReport(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleComponentClosed() {\n+        \n+        GraphReportManager.removeGraphReportListener(this);\n+        notesViewPane.clearNotes();\n+        notesViewPane.prepareNotesViewPane(notesViewController);\n+        notesViewPane.closeEdit();\n+    }\n+\n+    @Override\n+    protected String createStyle() {\n+        return \"resources/notes-view.css\";\n+    }\n+\n+    @Override\n+    protected NotesViewPane createContent() {\n+        return notesViewPane;\n+    }\n+\n+    // Triggers when plugin reports are added or removed.\n+    @Override\n+    public void newPluginReport(PluginReport pluginReport) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTgyNA==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r538999824", "bodyText": "merge these nested if statements", "author": "antares1470", "createdAt": "2020-12-09T04:37:22Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewTopComponent.java", "diffHunk": "@@ -0,0 +1,164 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportListener;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.views.JavaFxTopComponent;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.util.NbBundle.Messages;\n+import org.openide.windows.TopComponent;\n+\n+/**\n+ * UI component associated with the Notes View.\n+ * \n+ * @author sol695510\n+ */\n+@TopComponent.Description(\n+        preferredID = \"NotesViewTopComponent\",\n+        iconBase = \"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\",\n+        persistenceType = TopComponent.PERSISTENCE_ALWAYS)\n+@TopComponent.Registration(\n+        mode = \"explorer\",\n+        openAtStartup = false)\n+@ActionID(\n+        category = \"Window\",\n+        id = \"au.gov.asd.tac.constellation.views.notes.NotesViewTopComponent\")\n+@ActionReferences({\n+    @ActionReference(path = \"Menu/Experimental/Views\", position = 500),\n+    @ActionReference(path = \"Shortcuts\", name = \"CS-N\")})\n+@TopComponent.OpenActionRegistration(\n+        displayName = \"#CTL_NotesViewAction\",\n+        preferredID = \"NotesViewTopComponent\")\n+@Messages({\n+    \"CTL_NotesViewAction=Notes View\",\n+    \"CTL_NotesViewTopComponent=Notes View\",\n+    \"HINT_NotesViewTopComponent=Notes View\"})\n+\n+public class NotesViewTopComponent extends JavaFxTopComponent<NotesViewPane> implements GraphReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final NotesViewPane notesViewPane;\n+\n+    /**\n+     * Creates a new NotesViewTopComponent.\n+     */\n+    public NotesViewTopComponent() {\n+        \n+        setName(Bundle.CTL_NotesViewTopComponent());\n+        setToolTipText(Bundle.HINT_NotesViewTopComponent());\n+        \n+        initComponents();\n+        \n+        notesViewController = new NotesViewController(this);\n+        notesViewPane = new NotesViewPane(notesViewController);\n+        \n+        initContent();\n+    }\n+    \n+    @Override\n+    protected void handleNewGraph(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphOpened(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphClosed(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+            notesViewPane.closeEdit();\n+        }\n+    }\n+\n+    @Override\n+    protected void handleComponentOpened() {\n+        \n+        GraphReportManager.addGraphReportListener(this);\n+        Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+        \n+        if (activeGraph != null) {\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+            // Ensures plugin reports created while the Notes View is not \"open\" will appear when it is opened later.\n+            notesViewPane.setGraphReport(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleComponentClosed() {\n+        \n+        GraphReportManager.removeGraphReportListener(this);\n+        notesViewPane.clearNotes();\n+        notesViewPane.prepareNotesViewPane(notesViewController);\n+        notesViewPane.closeEdit();\n+    }\n+\n+    @Override\n+    protected String createStyle() {\n+        return \"resources/notes-view.css\";\n+    }\n+\n+    @Override\n+    protected NotesViewPane createContent() {\n+        return notesViewPane;\n+    }\n+\n+    // Triggers when plugin reports are added or removed.\n+    @Override\n+    public void newPluginReport(PluginReport pluginReport) {\n+        // Omit plugin reports from the Notes View and Quality Control View.\n+        if (!pluginReport.getPluginName().contains(\"Notes View\")) {\n+            if (!pluginReport.getPluginName().contains(\"Quality Control View\")) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAxOTE1Mw==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539019153", "bodyText": "This was a deliberate decision made in lieu of trying to merge the statements. If I merge these with a || it does not achieve the same effect of blocking plugin reports with either cases and causes an infinite loop which ends up locking up and crashing constellation.", "author": "sol695510", "createdAt": "2020-12-09T05:36:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY1OTcxNw==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539659717", "bodyText": "@sol695510 So you actually merge nested ifs with && rather than || (with the outside if condition listed first). We know && will work as both if conditions need to be true in order for the nested block code to run (the || will  behave differently as then only one of these would  need to be true)\nSo what you're looking for here is:\n!pluginReport.getPluginName().contains(\"Notes View\") && !pluginReport.getPluginName().contains(\"Quality Control View\")", "author": "antares1470", "createdAt": "2020-12-09T21:26:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDc0MjU5Ng==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r540742596", "bodyText": "That wouldn't work either because a single plugin report's name can't have both \"Notes View\" and \"Quality Control\" in it, since I'm blocking plugin reports that either have the name containing \"Notes View\" so a plugin report from the Notes View or the name \"Quality Control\" so a plugin from the Quality Control action.\nThat makes it sound like it should be a || and should work with a || but for some reason it does not.", "author": "sol695510", "createdAt": "2020-12-11T07:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjAxMzU2OQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r542013569", "bodyText": "@sol695510 Don't forget that there is a not (!) in front of each of those statements so that statement actually reads \"name doesn't contain 'Notes View' and name doesn't contain 'Quality Control View'\" rather than \"name doesn't contain 'Notes View' and 'Quality Control View'\" so it's checking for each of those individually rather than both of them together.\nAn equivalent statement to the one I said is !(pluginReport.getPluginName().contains(\"Notes View\") || pluginReport.getPluginName().contains(\"Quality Control View\")) but it is preferred to propagate the !\nIf it still doesn't make sense, I'm happy to chat about this further but for it's worth, sonar will flag the same thing (and make the same suggestion I've made).", "author": "antares1470", "createdAt": "2020-12-13T21:51:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjEzMzY1MQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r542133651", "bodyText": "I kinda understood so I've made the changes. Took me some time because I was also trying to rectify some minor issues.", "author": "sol695510", "createdAt": "2020-12-14T06:07:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODk5OTgyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAwMDAzNg==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539000036", "bodyText": "currentState can be final", "author": "antares1470", "createdAt": "2020-12-09T04:38:09Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/state/NotesViewState.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes.state;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * Stores all notes and filters for the selected graph's current state for the Notes View.\n+ *\n+ * @author sol695510\n+ */\n+public class NotesViewState {\n+    \n+    private final List<NotesViewEntry> notesViewEntries;\n+    private final List<String> selectedFilters;\n+    \n+    public NotesViewState() {\n+        notesViewEntries = new ArrayList();\n+        selectedFilters = new ArrayList();\n+    }\n+    \n+    public NotesViewState(NotesViewState currentState) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAwMDI0Nw==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539000247", "bodyText": "note can be final", "author": "antares1470", "createdAt": "2020-12-09T04:38:54Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/state/NotesViewStateIoProvider.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes.state;\n+\n+import au.gov.asd.tac.constellation.graph.Attribute;\n+import au.gov.asd.tac.constellation.graph.GraphReadMethods;\n+import au.gov.asd.tac.constellation.graph.GraphWriteMethods;\n+import au.gov.asd.tac.constellation.graph.attribute.io.AbstractGraphIOProvider;\n+import au.gov.asd.tac.constellation.graph.attribute.io.GraphByteReader;\n+import au.gov.asd.tac.constellation.graph.attribute.io.GraphByteWriter;\n+import au.gov.asd.tac.constellation.utilities.datastructure.ImmutableObjectCache;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import org.openide.util.lookup.ServiceProvider;\n+\n+/**\n+ * IO provider for the NotesViewState object.\n+ *\n+ * @author aldebaran30701\n+ * @author sol695510\n+ */\n+@ServiceProvider(service = AbstractGraphIOProvider.class)\n+public class NotesViewStateIoProvider extends AbstractGraphIOProvider {\n+\n+    @Override\n+    public String getName() {\n+        return NotesViewConcept.MetaAttribute.NOTES_VIEW_STATE.getName();\n+    }\n+\n+    @Override\n+    public void readObject(final int attributeId, final int elementId, final JsonNode jnode,\n+            final GraphWriteMethods graph, final Map<Integer, Integer> vertexMap, final Map<Integer, Integer> transactionMap,\n+            final GraphByteReader byteReader, final ImmutableObjectCache cache) throws IOException {\n+        \n+        if (!jnode.isNull()) {\n+            // Reading notes from state.\n+            final List<NotesViewEntry> noteViewEntries = new ArrayList<>();\n+            final ArrayNode notesArray = (ArrayNode) jnode.withArray(\"notes\");\n+            \n+            for (int i = 0; i < notesArray.size(); i++) {\n+                if (!notesArray.get(i).isNull()) {\n+                    noteViewEntries.add(new NotesViewEntry(\n+                            notesArray.get(i).get(0).asText(),\n+                            notesArray.get(i).get(1).asText(),\n+                            notesArray.get(i).get(2).asText(),\n+                            notesArray.get(i).get(3).asBoolean()\n+                    ));\n+                }\n+            }\n+            // Reading filters from state.\n+            final List<String> selectedFilters = new ArrayList<>();\n+            final ArrayNode filtersArray = (ArrayNode) jnode.withArray(\"filters\");\n+            \n+            for (int i = 0; i < filtersArray.size(); i++) { \n+                if (!filtersArray.get(i).isNull()) {\n+                    selectedFilters.add(filtersArray.get(i).asText());\n+                }\n+            }\n+            \n+            final NotesViewState state = new NotesViewState(noteViewEntries, selectedFilters);\n+            graph.setObjectValue(attributeId, elementId, state);\n+        }\n+    }\n+\n+    @Override\n+    public void writeObject(final Attribute attribute, final int elementId, final JsonGenerator jsonGenerator,\n+            final GraphReadMethods graph, final GraphByteWriter byteWriter, final boolean verbose) throws IOException {\n+\n+        if (verbose || !graph.isDefaultValue(attribute.getId(), elementId)) {\n+            final NotesViewState originalState = graph.getObjectValue(attribute.getId(), elementId);\n+\n+            if (originalState == null) {\n+                jsonGenerator.writeNullField(attribute.getName());\n+            } else {\n+                // Make a copy in case the state on the graph is currently being modified.\n+                final NotesViewState state = new NotesViewState(originalState);\n+                \n+                jsonGenerator.writeObjectFieldStart(attribute.getName());\n+                \n+                jsonGenerator.writeArrayFieldStart(\"notes\"); // Start writing notes to state.\n+\n+                for (NotesViewEntry note : state.getNotes()) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAwMDMyMw==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539000323", "bodyText": "filter can be final", "author": "antares1470", "createdAt": "2020-12-09T04:39:07Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/state/NotesViewStateIoProvider.java", "diffHunk": "@@ -0,0 +1,131 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes.state;\n+\n+import au.gov.asd.tac.constellation.graph.Attribute;\n+import au.gov.asd.tac.constellation.graph.GraphReadMethods;\n+import au.gov.asd.tac.constellation.graph.GraphWriteMethods;\n+import au.gov.asd.tac.constellation.graph.attribute.io.AbstractGraphIOProvider;\n+import au.gov.asd.tac.constellation.graph.attribute.io.GraphByteReader;\n+import au.gov.asd.tac.constellation.graph.attribute.io.GraphByteWriter;\n+import au.gov.asd.tac.constellation.utilities.datastructure.ImmutableObjectCache;\n+import com.fasterxml.jackson.core.JsonGenerator;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.node.ArrayNode;\n+import java.io.IOException;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import org.openide.util.lookup.ServiceProvider;\n+\n+/**\n+ * IO provider for the NotesViewState object.\n+ *\n+ * @author aldebaran30701\n+ * @author sol695510\n+ */\n+@ServiceProvider(service = AbstractGraphIOProvider.class)\n+public class NotesViewStateIoProvider extends AbstractGraphIOProvider {\n+\n+    @Override\n+    public String getName() {\n+        return NotesViewConcept.MetaAttribute.NOTES_VIEW_STATE.getName();\n+    }\n+\n+    @Override\n+    public void readObject(final int attributeId, final int elementId, final JsonNode jnode,\n+            final GraphWriteMethods graph, final Map<Integer, Integer> vertexMap, final Map<Integer, Integer> transactionMap,\n+            final GraphByteReader byteReader, final ImmutableObjectCache cache) throws IOException {\n+        \n+        if (!jnode.isNull()) {\n+            // Reading notes from state.\n+            final List<NotesViewEntry> noteViewEntries = new ArrayList<>();\n+            final ArrayNode notesArray = (ArrayNode) jnode.withArray(\"notes\");\n+            \n+            for (int i = 0; i < notesArray.size(); i++) {\n+                if (!notesArray.get(i).isNull()) {\n+                    noteViewEntries.add(new NotesViewEntry(\n+                            notesArray.get(i).get(0).asText(),\n+                            notesArray.get(i).get(1).asText(),\n+                            notesArray.get(i).get(2).asText(),\n+                            notesArray.get(i).get(3).asBoolean()\n+                    ));\n+                }\n+            }\n+            // Reading filters from state.\n+            final List<String> selectedFilters = new ArrayList<>();\n+            final ArrayNode filtersArray = (ArrayNode) jnode.withArray(\"filters\");\n+            \n+            for (int i = 0; i < filtersArray.size(); i++) { \n+                if (!filtersArray.get(i).isNull()) {\n+                    selectedFilters.add(filtersArray.get(i).asText());\n+                }\n+            }\n+            \n+            final NotesViewState state = new NotesViewState(noteViewEntries, selectedFilters);\n+            graph.setObjectValue(attributeId, elementId, state);\n+        }\n+    }\n+\n+    @Override\n+    public void writeObject(final Attribute attribute, final int elementId, final JsonGenerator jsonGenerator,\n+            final GraphReadMethods graph, final GraphByteWriter byteWriter, final boolean verbose) throws IOException {\n+\n+        if (verbose || !graph.isDefaultValue(attribute.getId(), elementId)) {\n+            final NotesViewState originalState = graph.getObjectValue(attribute.getId(), elementId);\n+\n+            if (originalState == null) {\n+                jsonGenerator.writeNullField(attribute.getName());\n+            } else {\n+                // Make a copy in case the state on the graph is currently being modified.\n+                final NotesViewState state = new NotesViewState(originalState);\n+                \n+                jsonGenerator.writeObjectFieldStart(attribute.getName());\n+                \n+                jsonGenerator.writeArrayFieldStart(\"notes\"); // Start writing notes to state.\n+\n+                for (NotesViewEntry note : state.getNotes()) {\n+                    if (note == null) {\n+                        jsonGenerator.writeNull();\n+                    } else {\n+                        jsonGenerator.writeStartArray();\n+                        jsonGenerator.writeString(note.getDateTime());\n+                        jsonGenerator.writeString(note.getNoteTitle());\n+                        jsonGenerator.writeString(note.getNoteContent());\n+                        jsonGenerator.writeBoolean(note.isUserCreated());\n+                        jsonGenerator.writeEndArray();\n+                    }\n+                }\n+                \n+                jsonGenerator.writeEndArray(); // End writing notes to state.\n+                \n+                jsonGenerator.writeArrayFieldStart(\"filters\"); // Start writing filters to state.\n+\n+                for (String filter : state.getFilters()) {", "originalCommit": "7005a3cb3f68c8432abb2747a98c6c749e6088d5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b08b183638469d41748f23f38c77d4bbe2790b64", "url": "https://github.com/constellation-app/constellation/commit/b08b183638469d41748f23f38c77d4bbe2790b64", "message": "Add requested changes", "committedDate": "2020-12-09T05:42:39Z", "type": "commit"}, {"oid": "ae7fe60f6f41b85e9e93c99a5327d373d6480481", "url": "https://github.com/constellation-app/constellation/commit/ae7fe60f6f41b85e9e93c99a5327d373d6480481", "message": "Fix race condition\n\nIf a graph was opened before the Notes View, opening the Notes View after would not render the correct notes and select the correct filters due to a race condition.\n\nSee changes in NotesViewTopComponent.handleComponentOpened().", "committedDate": "2020-12-09T08:14:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2NDIyNw==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539664227", "bodyText": "Not sure I'm a fan of switching this to Ctrl-Alt given all other view shortcuts are Ctrl-Shift. I think it would be good to change this back to Ctrl-Shift and change the letter instead (maybe A for annotate?)", "author": "antares1470", "createdAt": "2020-12-09T21:33:35Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewTopComponent.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportListener;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.views.JavaFxTopComponent;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.util.Exceptions;\n+import org.openide.util.NbBundle.Messages;\n+import org.openide.windows.TopComponent;\n+\n+/**\n+ * UI component associated with the Notes View.\n+ * \n+ * @author sol695510\n+ */\n+@TopComponent.Description(\n+        preferredID = \"NotesViewTopComponent\",\n+        iconBase = \"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\",\n+        persistenceType = TopComponent.PERSISTENCE_ALWAYS)\n+@TopComponent.Registration(\n+        mode = \"explorer\",\n+        openAtStartup = false)\n+@ActionID(\n+        category = \"Window\",\n+        id = \"au.gov.asd.tac.constellation.views.notes.NotesViewTopComponent\")\n+@ActionReferences({\n+    @ActionReference(path = \"Menu/Experimental/Views\", position = 500),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-N\")})", "originalCommit": "ae7fe60f6f41b85e9e93c99a5327d373d6480481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2NjI4MQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539666281", "bodyText": "Add a Thread.currentThread().interrupt() here given this is an Interrupted exception", "author": "antares1470", "createdAt": "2020-12-09T21:36:50Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewTopComponent.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportListener;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.views.JavaFxTopComponent;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.util.Exceptions;\n+import org.openide.util.NbBundle.Messages;\n+import org.openide.windows.TopComponent;\n+\n+/**\n+ * UI component associated with the Notes View.\n+ * \n+ * @author sol695510\n+ */\n+@TopComponent.Description(\n+        preferredID = \"NotesViewTopComponent\",\n+        iconBase = \"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\",\n+        persistenceType = TopComponent.PERSISTENCE_ALWAYS)\n+@TopComponent.Registration(\n+        mode = \"explorer\",\n+        openAtStartup = false)\n+@ActionID(\n+        category = \"Window\",\n+        id = \"au.gov.asd.tac.constellation.views.notes.NotesViewTopComponent\")\n+@ActionReferences({\n+    @ActionReference(path = \"Menu/Experimental/Views\", position = 500),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-N\")})\n+@TopComponent.OpenActionRegistration(\n+        displayName = \"#CTL_NotesViewAction\",\n+        preferredID = \"NotesViewTopComponent\")\n+@Messages({\n+    \"CTL_NotesViewAction=Notes View\",\n+    \"CTL_NotesViewTopComponent=Notes View\",\n+    \"HINT_NotesViewTopComponent=Notes View\"})\n+\n+public class NotesViewTopComponent extends JavaFxTopComponent<NotesViewPane> implements GraphReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final NotesViewPane notesViewPane;\n+\n+    /**\n+     * NotesViewTopComponent constructor.\n+     */\n+    public NotesViewTopComponent() {\n+        \n+        setName(Bundle.CTL_NotesViewTopComponent());\n+        setToolTipText(Bundle.HINT_NotesViewTopComponent());\n+        \n+        initComponents();\n+        \n+        notesViewController = new NotesViewController(this);\n+        notesViewPane = new NotesViewPane(notesViewController);\n+        \n+        initContent();\n+    }\n+    \n+    @Override\n+    protected void handleNewGraph(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphOpened(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphClosed(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.closeEdit();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleComponentOpened() {\n+        \n+        GraphReportManager.addGraphReportListener(this);\n+        final Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+        \n+        if (activeGraph != null) {\n+            // Thread.sleep(100) used to ensure the following methods run in this order.\n+            try {\n+                Thread.sleep(100);\n+                notesViewPane.clearNotes();\n+                Thread.sleep(100);\n+                notesViewPane.prepareNotesViewPane(notesViewController);\n+                Thread.sleep(100);\n+                notesViewPane.setGraphReport(notesViewController); // Plugin reports created while the Notes View is not \"open\" will appear when it is opened later.\n+            } catch (final InterruptedException ex) {\n+                Exceptions.printStackTrace(ex);", "originalCommit": "ae7fe60f6f41b85e9e93c99a5327d373d6480481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY2ODU2OA==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r539668568", "bodyText": "I'm ok with leaving these sleeps in for now but it might be good to add a todo to remind us to look at ways to ensure this code runs in the desired order without having to add sleeps (there are similar todos in other places in the codebase).", "author": "antares1470", "createdAt": "2020-12-09T21:40:35Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewTopComponent.java", "diffHunk": "@@ -0,0 +1,176 @@\n+/*\n+ * Copyright 2010-2020 Australian Signals Directorate\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package au.gov.asd.tac.constellation.views.notes;\n+\n+import au.gov.asd.tac.constellation.graph.Graph;\n+import au.gov.asd.tac.constellation.graph.manager.GraphManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportListener;\n+import au.gov.asd.tac.constellation.plugins.reporting.GraphReportManager;\n+import au.gov.asd.tac.constellation.plugins.reporting.PluginReport;\n+import au.gov.asd.tac.constellation.views.JavaFxTopComponent;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionReference;\n+import org.openide.awt.ActionReferences;\n+import org.openide.util.Exceptions;\n+import org.openide.util.NbBundle.Messages;\n+import org.openide.windows.TopComponent;\n+\n+/**\n+ * UI component associated with the Notes View.\n+ * \n+ * @author sol695510\n+ */\n+@TopComponent.Description(\n+        preferredID = \"NotesViewTopComponent\",\n+        iconBase = \"au/gov/asd/tac/constellation/views/notes/resources/notes-view.png\",\n+        persistenceType = TopComponent.PERSISTENCE_ALWAYS)\n+@TopComponent.Registration(\n+        mode = \"explorer\",\n+        openAtStartup = false)\n+@ActionID(\n+        category = \"Window\",\n+        id = \"au.gov.asd.tac.constellation.views.notes.NotesViewTopComponent\")\n+@ActionReferences({\n+    @ActionReference(path = \"Menu/Experimental/Views\", position = 500),\n+    @ActionReference(path = \"Shortcuts\", name = \"CA-N\")})\n+@TopComponent.OpenActionRegistration(\n+        displayName = \"#CTL_NotesViewAction\",\n+        preferredID = \"NotesViewTopComponent\")\n+@Messages({\n+    \"CTL_NotesViewAction=Notes View\",\n+    \"CTL_NotesViewTopComponent=Notes View\",\n+    \"HINT_NotesViewTopComponent=Notes View\"})\n+\n+public class NotesViewTopComponent extends JavaFxTopComponent<NotesViewPane> implements GraphReportListener {\n+    \n+    private final NotesViewController notesViewController;\n+    private final NotesViewPane notesViewPane;\n+\n+    /**\n+     * NotesViewTopComponent constructor.\n+     */\n+    public NotesViewTopComponent() {\n+        \n+        setName(Bundle.CTL_NotesViewTopComponent());\n+        setToolTipText(Bundle.HINT_NotesViewTopComponent());\n+        \n+        initComponents();\n+        \n+        notesViewController = new NotesViewController(this);\n+        notesViewPane = new NotesViewPane(notesViewController);\n+        \n+        initContent();\n+    }\n+    \n+    @Override\n+    protected void handleNewGraph(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphOpened(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.selectAllFilters();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleGraphClosed(final Graph graph) {\n+\n+        if (needsUpdate() && graph != null) {\n+            notesViewPane.closeEdit();\n+            notesViewPane.clearNotes();\n+            notesViewPane.prepareNotesViewPane(notesViewController);\n+        }\n+    }\n+\n+    @Override\n+    protected void handleComponentOpened() {\n+        \n+        GraphReportManager.addGraphReportListener(this);\n+        final Graph activeGraph = GraphManager.getDefault().getActiveGraph();\n+        \n+        if (activeGraph != null) {\n+            // Thread.sleep(100) used to ensure the following methods run in this order.\n+            try {\n+                Thread.sleep(100);\n+                notesViewPane.clearNotes();\n+                Thread.sleep(100);\n+                notesViewPane.prepareNotesViewPane(notesViewController);\n+                Thread.sleep(100);\n+                notesViewPane.setGraphReport(notesViewController); // Plugin reports created while the Notes View is not \"open\" will appear when it is opened later.", "originalCommit": "ae7fe60f6f41b85e9e93c99a5327d373d6480481", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "84aa10a3619cab523f049cdec7e7586664182824", "url": "https://github.com/constellation-app/constellation/commit/84aa10a3619cab523f049cdec7e7586664182824", "message": "Removed use of sleep() and update whatsnew.txt and update shortcut", "committedDate": "2020-12-11T07:53:22Z", "type": "commit"}, {"oid": "50cd9ff3b80dfa82a768c9ecf9e609402af72e1b", "url": "https://github.com/constellation-app/constellation/commit/50cd9ff3b80dfa82a768c9ecf9e609402af72e1b", "message": "Merge ifs", "committedDate": "2020-12-14T06:08:09Z", "type": "commit"}, {"oid": "26ca7ffb9c7d76ea668af8d800294c0e1ecddf63", "url": "https://github.com/constellation-app/constellation/commit/26ca7ffb9c7d76ea668af8d800294c0e1ecddf63", "message": "Fix lost saved notes after closing Notes View\n\nFixed a case where opening a saved graph with notes, opening Notes View to check if notes are there, then closing Notes View, dragging to create new Select In Box notes, then opening Notes View to find only the new Select In Box notes are shown and previously saved notes are lost.", "committedDate": "2020-12-14T06:43:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjgwNzg1OQ==", "url": "https://github.com/constellation-app/constellation/pull/880#discussion_r542807859", "bodyText": "change the parameter to the primitive boolean rather than Boolean", "author": "antares1470", "createdAt": "2020-12-14T21:26:28Z", "path": "CoreNotesView/src/au/gov/asd/tac/constellation/views/notes/NotesViewPane.java", "diffHunk": "@@ -342,11 +344,15 @@ protected synchronized void updateFilters() {\n     \n     /**\n      * Clears UI elements in the Notes View and clears the list of NoteEntry objects.\n+     * \n+     * @param clearOnlyUI True if only the UI elements are intended to be cleared.\n      */\n-    protected void clearNotes() {\n+    protected void clearNotes(final Boolean clearOnlyUI) {", "originalCommit": "26ca7ffb9c7d76ea668af8d800294c0e1ecddf63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1efbeb899a97fff4ffa73e12813e34d5d73c924b", "url": "https://github.com/constellation-app/constellation/commit/1efbeb899a97fff4ffa73e12813e34d5d73c924b", "message": "Change parameter boolean to primitive", "committedDate": "2020-12-15T01:32:23Z", "type": "commit"}, {"oid": "4ba4c133452e322efcad30d1dd0d63fa16086ba0", "url": "https://github.com/constellation-app/constellation/commit/4ba4c133452e322efcad30d1dd0d63fa16086ba0", "message": "Merge branch 'master' into feature/Notes-View-#56", "committedDate": "2021-01-11T14:12:54Z", "type": "commit"}]}