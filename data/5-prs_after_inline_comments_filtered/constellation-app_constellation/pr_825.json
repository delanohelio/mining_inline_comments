{"pr_number": 825, "pr_title": "Bugfix/issue727 conversation clear content", "pr_createdAt": "2020-08-28T04:33:59Z", "pr_url": "https://github.com/constellation-app/constellation/pull/825", "timeline": [{"oid": "8d46e1e017a5636aa12fcc7db12d31530f9ee516", "url": "https://github.com/constellation-app/constellation/commit/8d46e1e017a5636aa12fcc7db12d31530f9ee516", "message": ":bug: Added conversationExistanceUpdater to handle graph closure \nAdded consversationExistanceUpdater that depends on \nnewGraphUpdateComponent to handle when a graph is closed.\nMade other updateControllers dependent on this and modified them to \nhandle the null graph case where required.", "committedDate": "2020-08-28T04:23:33Z", "type": "commit"}, {"oid": "1c0aad465c154779af513ccdb694012f6dc17b8f", "url": "https://github.com/constellation-app/constellation/commit/1c0aad465c154779af513ccdb694012f6dc17b8f", "message": ":bug: Modified methods to handle null graph case.\nModified to handle the null graph case for when these methods are \ncalled without an active graph.", "committedDate": "2020-08-28T04:24:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyNzkxMA==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r479827910", "bodyText": "You can declare this variable here (rather than a couple lines above) since it doesn't seem to be used outside this code block. Also can make it final", "author": "antares1470", "createdAt": "2020-08-30T23:13:48Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/Conversation.java", "diffHunk": "@@ -183,17 +201,23 @@ public GraphUpdateManager getGraphUpdateManager() {\n         @Override\n         protected boolean update(GraphReadMethods graph) {\n \n+            \n             ConversationState newConversationState;\n-            int conversationStateAttribute = ConversationViewConcept.MetaAttribute.CONVERSATION_VIEW_STATE.get(graph);\n-            if (conversationStateAttribute == Graph.NOT_FOUND) {\n-                newConversationState = new ConversationState();\n-                newConversationState.setSenderAttributesToKeys(graph);\n-            } else {\n-                newConversationState = (ConversationState) graph.getObjectValue(conversationStateAttribute, 0);\n-                if (newConversationState == null) {\n+            int conversationStateAttribute;\n+            if (Objects.nonNull(graph)) {\n+                conversationStateAttribute = ConversationViewConcept.MetaAttribute.CONVERSATION_VIEW_STATE.get(graph);", "originalCommit": "1c0aad465c154779af513ccdb694012f6dc17b8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MDM0NA==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480470344", "bodyText": "done", "author": "Nova-2119", "createdAt": "2020-08-31T23:25:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyNzkxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyODAxMQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r479828011", "bodyText": "Can possibly remove commented out code if it's not needed", "author": "antares1470", "createdAt": "2020-08-30T23:14:51Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/Conversation.java", "diffHunk": "@@ -410,9 +435,9 @@ public void run() {\n     private UpdateComponent<GraphReadMethods> senderUpdater = new UpdateComponent<GraphReadMethods>(\"Senders\", LOCK_STAGE) {\n         @Override\n         protected boolean update(GraphReadMethods graph) {\n-            if (graph == null) {\n-                return false;\n-            }\n+//            if (graph == null) {\n+//                return false;\n+//            }", "originalCommit": "1c0aad465c154779af513ccdb694012f6dc17b8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MDM4NQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480470385", "bodyText": "oh yeah, done", "author": "Nova-2119", "createdAt": "2020-08-31T23:25:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyODAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyODEyNw==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r479828127", "bodyText": "I know you didn't add this but if you make this final please that would be good", "author": "antares1470", "createdAt": "2020-08-30T23:15:42Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/ConversationContributionProvider.java", "diffHunk": "@@ -133,9 +134,11 @@ public final int getPriority() {\n      */\n     public static List<ConversationContributionProvider> getCompatibleProviders(GraphReadMethods graph) {\n         List<ConversationContributionProvider> compatibleProviders = new ArrayList<>();", "originalCommit": "1c0aad465c154779af513ccdb694012f6dc17b8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MDQyNQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480470425", "bodyText": "done", "author": "Nova-2119", "createdAt": "2020-08-31T23:25:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyODEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyODMwMQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r479828301", "bodyText": "this import isn't used according to sonar", "author": "antares1470", "createdAt": "2020-08-30T23:17:24Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/DefaultConversationDatetimeProvider.java", "diffHunk": "@@ -22,6 +22,7 @@\n import java.time.ZonedDateTime;\n import java.time.format.DateTimeFormatter;\n import java.util.List;\n+import java.util.Objects;", "originalCommit": "1c0aad465c154779af513ccdb694012f6dc17b8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MjE4Nw==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480472187", "bodyText": "I agree", "author": "Nova-2119", "createdAt": "2020-08-31T23:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTgyODMwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQxNDk1Ng==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480414956", "bodyText": "Is there any reason you have used Objects.isNull?\nThis is a minor feedback but to me Objects.isNull looks a bit out of place given the rest of the code base doesn't use this approach to check for null. Are you able to change this to graph == null so it looks more familiar? There are several occurrences of this method that would require changing in this PR.\nApparently it is useful inside lambda functions, see https://stackoverflow.com/a/46025437.", "author": "arcturus2", "createdAt": "2020-08-31T21:40:42Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/Conversation.java", "diffHunk": "@@ -174,6 +181,17 @@ public GraphUpdateManager getGraphUpdateManager() {\n         return graphUpdateManager;\n     }\n \n+    /**\n+     * Inspects the contents of the conversation state and registers any changes\n+     * that have occurred.\n+     */\n+    private UpdateComponent<GraphReadMethods> conversationExistanceUpdater = new UpdateComponent<GraphReadMethods>(\"Existance State\", LOCK_STAGE) {\n+\n+        @Override\n+        protected boolean update(GraphReadMethods graph) {\n+            return Objects.isNull(graph);", "originalCommit": "1c0aad465c154779af513ccdb694012f6dc17b8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3MjM4MQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480472381", "bodyText": "No meaningful reason, just personal preference. I find it easier to read,\nChanged.", "author": "Nova-2119", "createdAt": "2020-08-31T23:31:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQxNDk1Ng=="}], "type": "inlineReview"}, {"oid": "0140c6e2f6c9c71c162e3c2b97d71e87ba15cfac", "url": "https://github.com/constellation-app/constellation/commit/0140c6e2f6c9c71c162e3c2b97d71e87ba15cfac", "message": "Merge branch 'master' into bugfix/Issue727-ConversationClearContent", "committedDate": "2020-08-31T23:01:21Z", "type": "commit"}, {"oid": "2e6376b48967d5c0200669b626a0e2eaac699416", "url": "https://github.com/constellation-app/constellation/commit/2e6376b48967d5c0200669b626a0e2eaac699416", "message": ":art: Small improvement as requested in PR\nMade variable final\nChanged Objects.isnull() to == null\nRemoved commented out code\nRestricted variable scope", "committedDate": "2020-08-31T23:32:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3OTY5MQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480479691", "bodyText": "final", "author": "antares1470", "createdAt": "2020-08-31T23:55:59Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/Conversation.java", "diffHunk": "@@ -183,17 +201,22 @@ public GraphUpdateManager getGraphUpdateManager() {\n         @Override\n         protected boolean update(GraphReadMethods graph) {\n \n+            \n             ConversationState newConversationState;\n-            int conversationStateAttribute = ConversationViewConcept.MetaAttribute.CONVERSATION_VIEW_STATE.get(graph);\n-            if (conversationStateAttribute == Graph.NOT_FOUND) {\n-                newConversationState = new ConversationState();\n-                newConversationState.setSenderAttributesToKeys(graph);\n-            } else {\n-                newConversationState = (ConversationState) graph.getObjectValue(conversationStateAttribute, 0);\n-                if (newConversationState == null) {\n+            if (Objects.nonNull(graph)) {\n+                int conversationStateAttribute = ConversationViewConcept.MetaAttribute.CONVERSATION_VIEW_STATE.get(graph);", "originalCommit": "2e6376b48967d5c0200669b626a0e2eaac699416", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ4Mjg0Nw==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r480482847", "bodyText": "final final ?", "author": "Nova-2119", "createdAt": "2020-09-01T00:06:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQ3OTY5MQ=="}], "type": "inlineReview"}, {"oid": "9ce37475963ef7c51fd31a4ad75f1483f2216389", "url": "https://github.com/constellation-app/constellation/commit/9ce37475963ef7c51fd31a4ad75f1483f2216389", "message": ":art: Made conversationStateAttribute final.", "committedDate": "2020-09-01T00:06:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjUzOTkxMg==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r482539912", "bodyText": "graph != null", "author": "antares1470", "createdAt": "2020-09-02T22:27:17Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/Conversation.java", "diffHunk": "@@ -222,12 +245,14 @@ protected boolean update(GraphReadMethods graph) {\n         @Override\n         protected boolean update(GraphReadMethods graph) {\n             possibleSenderAttributes.clear();\n-            final int attributeCount = graph.getAttributeCount(GraphElementType.VERTEX);\n-            for (int i = 0; i < attributeCount; i++) {\n-                final int attributeId = graph.getAttribute(GraphElementType.VERTEX, i);\n-                final Attribute attribute = new GraphAttribute(graph, attributeId);\n-                if (!ObjectAttributeDescription.class.isAssignableFrom(attribute.getDataType())) {\n-                    possibleSenderAttributes.add(attribute.getName());\n+            if (Objects.nonNull(graph)) {", "originalCommit": "9ce37475963ef7c51fd31a4ad75f1483f2216389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MDIzNg==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r482540236", "bodyText": "graph != null", "author": "antares1470", "createdAt": "2020-09-02T22:27:36Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/ConversationContributionProvider.java", "diffHunk": "@@ -132,10 +133,12 @@ public final int getPriority() {\n      * @return A list of all providers that are compatible with the given graph.\n      */\n     public static List<ConversationContributionProvider> getCompatibleProviders(GraphReadMethods graph) {\n-        List<ConversationContributionProvider> compatibleProviders = new ArrayList<>();\n-        for (ConversationContributionProvider provider : getProviders()) {\n-            if (provider.isCompatibleWithGraph(graph)) {\n-                compatibleProviders.add(provider);\n+        final List<ConversationContributionProvider> compatibleProviders = new ArrayList<>();\n+        if (Objects.nonNull(graph)) {", "originalCommit": "9ce37475963ef7c51fd31a4ad75f1483f2216389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MDY3Nw==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r482540677", "bodyText": "graph == null...", "author": "antares1470", "createdAt": "2020-09-02T22:27:58Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/DefaultConversationColorProvider.java", "diffHunk": "@@ -33,7 +34,11 @@\n     @Override\n     public void updateMessageColors(GraphReadMethods graph, List<ConversationMessage> messages) {\n         assert !SwingUtilities.isEventDispatchThread();\n-\n+        \n+        if (Objects.isNull(graph) || messages.isEmpty()) {", "originalCommit": "9ce37475963ef7c51fd31a4ad75f1483f2216389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MDk5NQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r482540995", "bodyText": "graph == null", "author": "antares1470", "createdAt": "2020-09-02T22:28:15Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/DefaultConversationMessageProvider.java", "diffHunk": "@@ -38,7 +39,10 @@\n     @Override\n     public void getMessages(GraphReadMethods graph, List<ConversationMessage> messages) {\n         assert !SwingUtilities.isEventDispatchThread();\n-\n+        messages.clear();\n+        if (Objects.isNull(graph)) {", "originalCommit": "9ce37475963ef7c51fd31a4ad75f1483f2216389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjU0MTMyNQ==", "url": "https://github.com/constellation-app/constellation/pull/825#discussion_r482541325", "bodyText": "graph == null...", "author": "antares1470", "createdAt": "2020-09-02T22:28:30Z", "path": "CoreConversationView/src/au/gov/asd/tac/constellation/views/conversationview/DefaultConversationSenderProvider.java", "diffHunk": "@@ -51,6 +52,9 @@\n     public void updateMessageSenders(GraphReadMethods graph, List<ConversationMessage> messages, List<String> senderAttributes) {\n         assert !SwingUtilities.isEventDispatchThread();\n \n+        if(Objects.isNull(graph) || messages.isEmpty()){", "originalCommit": "9ce37475963ef7c51fd31a4ad75f1483f2216389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "88f403992d9cc6584eccaccaf5256987adc5b565", "url": "https://github.com/constellation-app/constellation/commit/88f403992d9cc6584eccaccaf5256987adc5b565", "message": ":art: changed Objects.__null to != or == null.", "committedDate": "2020-09-02T23:37:24Z", "type": "commit"}, {"oid": "a8209421082af26a76e73dde189a5502cfcb0998", "url": "https://github.com/constellation-app/constellation/commit/a8209421082af26a76e73dde189a5502cfcb0998", "message": "Merge branch 'master' into bugfix/Issue727-ConversationClearContent", "committedDate": "2020-09-02T23:39:43Z", "type": "commit"}, {"oid": "87ba346bf2ba10e41cb7865526b1c4cdfd304dbe", "url": "https://github.com/constellation-app/constellation/commit/87ba346bf2ba10e41cb7865526b1c4cdfd304dbe", "message": "Merge branch 'master' into bugfix/Issue727-ConversationClearContent", "committedDate": "2020-09-04T01:20:46Z", "type": "commit"}, {"oid": "545483ae0ce95d02c16d17cab7e93931ed3a147a", "url": "https://github.com/constellation-app/constellation/commit/545483ae0ce95d02c16d17cab7e93931ed3a147a", "message": ":art: Removed unused import", "committedDate": "2020-09-04T01:30:28Z", "type": "commit"}]}