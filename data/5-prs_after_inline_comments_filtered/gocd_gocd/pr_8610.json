{"pr_number": 8610, "pr_title": "Fix scm and package update", "pr_createdAt": "2020-10-05T07:05:57Z", "pr_url": "https://github.com/gocd/gocd/pull/8610", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQzNjE1MQ==", "url": "https://github.com/gocd/gocd/pull/8610#discussion_r499436151", "bodyText": "The comparison check has been performed in the modifiedConfig.pipelinesAssociatedWithPackage method. Do we require it again.", "author": "kritika-singh3", "createdAt": "2020-10-05T08:45:48Z", "path": "server/src/main/java/com/thoughtworks/go/config/update/UpdatePackageConfigCommand.java", "diffHunk": "@@ -68,6 +75,17 @@ public boolean canContinue(CruiseConfig cruiseConfig) {\n         return isAuthorized() && isRepositoryPresent(cruiseConfig) && isIdSame() && isRequestFresh();\n     }\n \n+    private void updatePackageConfigurationOnAssociatedPipelines(CruiseConfig modifiedConfig) {\n+        List<PipelineConfig> pipelinesWithPackage = modifiedConfig.pipelinesAssociatedWithPackage(newPackage);\n+        pipelinesWithPackage.forEach(pipelineConfig -> {\n+            pipelineConfig.packageMaterialConfigs().forEach(packageMaterialConfig -> {\n+                if (packageMaterialConfig.getPackageId().equals(newPackage.getId())) {", "originalCommit": "203e37c08ba45832ee8fecc0b023b7dd0fc3f820", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ3NDQ0OA==", "url": "https://github.com/gocd/gocd/pull/8610#discussion_r499474448", "bodyText": "I was thinking of a scenario where a PipleineConfig has more than one package material. We would need this check in those cases right?", "author": "maheshp", "createdAt": "2020-10-05T09:47:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQzNjE1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQ5Mzk0Nw==", "url": "https://github.com/gocd/gocd/pull/8610#discussion_r499493947", "bodyText": "Yes right - we would need this check then.", "author": "kritika-singh3", "createdAt": "2020-10-05T10:21:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQzNjE1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTQzNjQ2Ng==", "url": "https://github.com/gocd/gocd/pull/8610#discussion_r499436466", "bodyText": "Same here: the check has performed in modifiedConfig.pipelinesAssociatedWithPackageRepository", "author": "kritika-singh3", "createdAt": "2020-10-05T08:46:19Z", "path": "server/src/main/java/com/thoughtworks/go/config/update/UpdatePackageRepositoryCommand.java", "diffHunk": "@@ -50,16 +53,29 @@ public void update(CruiseConfig modifiedConfig) {\n         PackageRepositories repositories = modifiedConfig.getPackageRepositories();\n         repositories.replace(oldRepo, newRepo);\n         modifiedConfig.setPackageRepositories(repositories);\n+\n+        updatePackageRepositoryConfigurationOnAssociatedPipelines(modifiedConfig);\n     }\n \n     @Override\n     public boolean canContinue(CruiseConfig cruiseConfig) {\n         return super.canContinue(cruiseConfig) && isIdSame() && isRequestFresh();\n     }\n \n+    private void updatePackageRepositoryConfigurationOnAssociatedPipelines(CruiseConfig modifiedConfig) {\n+        List<PipelineConfig> pipelinesWithPackageRepo = modifiedConfig.pipelinesAssociatedWithPackageRepository(newRepo);\n+        pipelinesWithPackageRepo.forEach(pipelineConfig -> {\n+            pipelineConfig.packageMaterialConfigs().forEach(packageMaterialConfig -> {\n+                if (packageMaterialConfig.getPackageDefinition().getRepository().getId().equals(newRepo.getId())) {", "originalCommit": "203e37c08ba45832ee8fecc0b023b7dd0fc3f820", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f65386a49436e581efc3fffb4f0521f1b3a546ec", "url": "https://github.com/gocd/gocd/commit/f65386a49436e581efc3fffb4f0521f1b3a546ec", "message": "Updated pipelines as part of SCM update #8542\n\n* For Pipelines with Pluggable SCM materials, any changes to the\n  global SCM configuration did not reflect on the SCM configuration\n  referred by pipeline. This commit updates the SCM configuration\n  on the pipeline on changes to the SCM.", "committedDate": "2020-10-05T09:30:38Z", "type": "commit"}, {"oid": "48e07aed48dca75ddf2d13c753120f4ddab35690", "url": "https://github.com/gocd/gocd/commit/48e07aed48dca75ddf2d13c753120f4ddab35690", "message": "Update pipelines as part of PackageRepo and Package update #8542\n\n* For pipelines with package materials, any changes to the package or\n  package repo did not reflect on the config referred by the pipleine.\n  This commit updates the package configs on the pipeline on changes\n  to the package/repo.", "committedDate": "2020-10-05T09:30:46Z", "type": "commit"}, {"oid": "48e07aed48dca75ddf2d13c753120f4ddab35690", "url": "https://github.com/gocd/gocd/commit/48e07aed48dca75ddf2d13c753120f4ddab35690", "message": "Update pipelines as part of PackageRepo and Package update #8542\n\n* For pipelines with package materials, any changes to the package or\n  package repo did not reflect on the config referred by the pipleine.\n  This commit updates the package configs on the pipeline on changes\n  to the package/repo.", "committedDate": "2020-10-05T09:30:46Z", "type": "forcePushed"}]}