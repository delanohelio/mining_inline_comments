{"pr_number": 8023, "pr_title": "Webhook triggers for configrepo branch support", "pr_createdAt": "2020-04-20T04:38:19Z", "pr_url": "https://github.com/gocd/gocd/pull/8023", "timeline": [{"oid": "b44f6649ec2b8cfe2622662d35d6521f44e43354", "url": "https://github.com/gocd/gocd/commit/b44f6649ec2b8cfe2622662d35d6521f44e43354", "message": "wip: add github PR type for webhook payloads", "committedDate": "2020-04-20T19:03:04Z", "type": "forcePushed"}, {"oid": "869aca22b28047898c9ea1912aac7b31fb6d531c", "url": "https://github.com/gocd/gocd/commit/869aca22b28047898c9ea1912aac7b31fb6d531c", "message": "wip: add github PR type for webhook payloads", "committedDate": "2020-06-12T09:32:48Z", "type": "forcePushed"}, {"oid": "920402ed98512a1ee31da07b3391413db0fcc734", "url": "https://github.com/gocd/gocd/commit/920402ed98512a1ee31da07b3391413db0fcc734", "message": "wip: add github PR type for webhook payloads", "committedDate": "2020-06-29T18:43:52Z", "type": "forcePushed"}, {"oid": "3ba023076a1a9cbf3287dd91344264064892c089", "url": "https://github.com/gocd/gocd/commit/3ba023076a1a9cbf3287dd91344264064892c089", "message": "wip", "committedDate": "2020-07-03T01:22:05Z", "type": "forcePushed"}, {"oid": "a0754c26e0505e9ae89eab94931d4aed35e5dfc1", "url": "https://github.com/gocd/gocd/commit/a0754c26e0505e9ae89eab94931d4aed35e5dfc1", "message": "wip", "committedDate": "2020-07-08T10:27:09Z", "type": "forcePushed"}, {"oid": "865a153147c2805a2837ab2631d86ba1338a9e94", "url": "https://github.com/gocd/gocd/commit/865a153147c2805a2837ab2631d86ba1338a9e94", "message": "wip", "committedDate": "2020-07-11T05:10:27Z", "type": "forcePushed"}, {"oid": "512fbce235f92efdb41010345287fa18956094c9", "url": "https://github.com/gocd/gocd/commit/512fbce235f92efdb41010345287fa18956094c9", "message": "wip", "committedDate": "2020-10-05T16:30:32Z", "type": "forcePushed"}, {"oid": "4966465ff8953f941c69981420704ccc30817b14", "url": "https://github.com/gocd/gocd/commit/4966465ff8953f941c69981420704ccc30817b14", "message": "wip", "committedDate": "2020-10-14T22:05:55Z", "type": "forcePushed"}, {"oid": "efadcbe5dc3af509cb9ac2d500bbcda0423c23e4", "url": "https://github.com/gocd/gocd/commit/efadcbe5dc3af509cb9ac2d500bbcda0423c23e4", "message": "wip", "committedDate": "2020-10-14T22:47:23Z", "type": "forcePushed"}, {"oid": "5fd1ea74faab8af68c30ba53fdd942f8300be83b", "url": "https://github.com/gocd/gocd/commit/5fd1ea74faab8af68c30ba53fdd942f8300be83b", "message": "Remove validation that required `autoUpdate == true` on `ConfigRepoConfig`", "committedDate": "2020-10-14T23:34:49Z", "type": "forcePushed"}, {"oid": "16a2a878daf04662ec278e5e5f115d0481519215", "url": "https://github.com/gocd/gocd/commit/16a2a878daf04662ec278e5e5f115d0481519215", "message": "wip", "committedDate": "2020-10-16T00:05:53Z", "type": "forcePushed"}, {"oid": "f360fe376a44e4138b7f5672de89c905c122e5b2", "url": "https://github.com/gocd/gocd/commit/f360fe376a44e4138b7f5672de89c905c122e5b2", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-19T11:09:43Z", "type": "forcePushed"}, {"oid": "cd74b2b2de4dfe580639126cff3359c770e5bed7", "url": "https://github.com/gocd/gocd/commit/cd74b2b2de4dfe580639126cff3359c770e5bed7", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-19T14:44:40Z", "type": "forcePushed"}, {"oid": "e15d20445ccdc42cfe6364b2db63d55caa038b19", "url": "https://github.com/gocd/gocd/commit/e15d20445ccdc42cfe6364b2db63d55caa038b19", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-20T01:55:04Z", "type": "forcePushed"}, {"oid": "269818c8e7a49c29d51137e43322c13228c981ee", "url": "https://github.com/gocd/gocd/commit/269818c8e7a49c29d51137e43322c13228c981ee", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-20T08:15:14Z", "type": "forcePushed"}, {"oid": "2883fab6667b56acf185f016689ac9496636dbf8", "url": "https://github.com/gocd/gocd/commit/2883fab6667b56acf185f016689ac9496636dbf8", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-20T09:48:59Z", "type": "forcePushed"}, {"oid": "5d02feeb8a31e54db365bfeb8fa26d14e32fde0d", "url": "https://github.com/gocd/gocd/commit/5d02feeb8a31e54db365bfeb8fa26d14e32fde0d", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-20T10:04:23Z", "type": "forcePushed"}, {"oid": "1ba6a599c4403e4d6ad85f82331241053151aa1b", "url": "https://github.com/gocd/gocd/commit/1ba6a599c4403e4d6ad85f82331241053151aa1b", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-21T06:25:42Z", "type": "forcePushed"}, {"oid": "8208ad976ed8ff7d6ec63a24f91a53599e9f1964", "url": "https://github.com/gocd/gocd/commit/8208ad976ed8ff7d6ec63a24f91a53599e9f1964", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-21T08:06:26Z", "type": "forcePushed"}, {"oid": "c244d4563bbbc49844005d9c4b3cc1c62e868b3d", "url": "https://github.com/gocd/gocd/commit/c244d4563bbbc49844005d9c4b3cc1c62e868b3d", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-21T10:21:38Z", "type": "forcePushed"}, {"oid": "51072e589c357a07d8f172d5cb8c2d4958cc2763", "url": "https://github.com/gocd/gocd/commit/51072e589c357a07d8f172d5cb8c2d4958cc2763", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-23T02:31:40Z", "type": "forcePushed"}, {"oid": "315a64cc9ef1e50a4667a1ec80bdf310bf44a1b6", "url": "https://github.com/gocd/gocd/commit/315a64cc9ef1e50a4667a1ec80bdf310bf44a1b6", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-26T04:21:12Z", "type": "forcePushed"}, {"oid": "ced98e83af375a0030c293767f4bb13054e76ea7", "url": "https://github.com/gocd/gocd/commit/ced98e83af375a0030c293767f4bb13054e76ea7", "message": "wip: add new pull request webhook endpoint for configrepos", "committedDate": "2020-10-26T13:49:57Z", "type": "forcePushed"}, {"oid": "ddaeb03d773dc7b93ae413ca32a9cd324ae911c7", "url": "https://github.com/gocd/gocd/commit/ddaeb03d773dc7b93ae413ca32a9cd324ae911c7", "message": "wip2", "committedDate": "2020-11-04T04:24:17Z", "type": "forcePushed"}, {"oid": "e1c28f60230bc2db32c1320f65bd6a74fd2c9001", "url": "https://github.com/gocd/gocd/commit/e1c28f60230bc2db32c1320f65bd6a74fd2c9001", "message": "wip2", "committedDate": "2020-11-10T06:03:16Z", "type": "forcePushed"}, {"oid": "fa0615946d2acbc9a1cb953d27344b978a06082f", "url": "https://github.com/gocd/gocd/commit/fa0615946d2acbc9a1cb953d27344b978a06082f", "message": "wip3", "committedDate": "2020-11-13T05:48:53Z", "type": "forcePushed"}, {"oid": "4ef7be4fb6daefbb8609f17452f0d9d8732de7af", "url": "https://github.com/gocd/gocd/commit/4ef7be4fb6daefbb8609f17452f0d9d8732de7af", "message": "whitespc", "committedDate": "2020-11-17T03:56:41Z", "type": "forcePushed"}, {"oid": "5931b345ad8b9442e233eaa241f6587dfedcf93b", "url": "https://github.com/gocd/gocd/commit/5931b345ad8b9442e233eaa241f6587dfedcf93b", "message": "whitespc", "committedDate": "2020-11-17T05:00:35Z", "type": "forcePushed"}, {"oid": "05381e6ba76f7a93fed6712e021b6f7b90459fbb", "url": "https://github.com/gocd/gocd/commit/05381e6ba76f7a93fed6712e021b6f7b90459fbb", "message": "wip fleshing out PR payload, some rethinking too", "committedDate": "2020-11-18T00:26:16Z", "type": "forcePushed"}, {"oid": "eaf9eae3c312c7cfb3dd49aff6cb267459019097", "url": "https://github.com/gocd/gocd/commit/eaf9eae3c312c7cfb3dd49aff6cb267459019097", "message": "wip fleshing out PR payload, some rethinking too", "committedDate": "2020-11-18T02:41:19Z", "type": "forcePushed"}, {"oid": "8c683c173177b0093a8ca2670f5eea57b72abf3c", "url": "https://github.com/gocd/gocd/commit/8c683c173177b0093a8ca2670f5eea57b72abf3c", "message": "wip fleshing out PR payload, some rethinking too", "committedDate": "2020-11-19T05:53:08Z", "type": "forcePushed"}, {"oid": "1d7ceda63db3f21cecb408a419e6718051e1fa2b", "url": "https://github.com/gocd/gocd/commit/1d7ceda63db3f21cecb408a419e6718051e1fa2b", "message": "Flesh out PR payloads and tests", "committedDate": "2020-11-19T10:23:13Z", "type": "forcePushed"}, {"oid": "819644dc101eb1379afe29fb104fe21a853f9f9c", "url": "https://github.com/gocd/gocd/commit/819644dc101eb1379afe29fb104fe21a853f9f9c", "message": "full controller coverage", "committedDate": "2020-11-23T12:17:40Z", "type": "forcePushed"}, {"oid": "4602b4ad548560f8c5b167ced359b5c45e47af9d", "url": "https://github.com/gocd/gocd/commit/4602b4ad548560f8c5b167ced359b5c45e47af9d", "message": "ui", "committedDate": "2020-11-25T12:09:59Z", "type": "forcePushed"}, {"oid": "a9c210337106a53300ffd0698572392f9cf86be1", "url": "https://github.com/gocd/gocd/commit/a9c210337106a53300ffd0698572392f9cf86be1", "message": "ui", "committedDate": "2020-12-01T05:41:52Z", "type": "forcePushed"}, {"oid": "33e4782471c1f8f6c4dccc9365e6dd7cbfe7f82b", "url": "https://github.com/gocd/gocd/commit/33e4782471c1f8f6c4dccc9365e6dd7cbfe7f82b", "message": "ui", "committedDate": "2020-12-03T08:31:23Z", "type": "forcePushed"}, {"oid": "eec8baf36c45feb32098a67c27335a39dc53e032", "url": "https://github.com/gocd/gocd/commit/eec8baf36c45feb32098a67c27335a39dc53e032", "message": "ui2", "committedDate": "2020-12-04T21:16:53Z", "type": "forcePushed"}, {"oid": "f3c53ccfb7a6ec65be143b600a6e4f2fb9db6b71", "url": "https://github.com/gocd/gocd/commit/f3c53ccfb7a6ec65be143b600a6e4f2fb9db6b71", "message": "wip-ui\n\nui\n\nui\n\nui2\n\ntweak ui", "committedDate": "2020-12-07T00:08:46Z", "type": "forcePushed"}, {"oid": "d2bc7f527029a11a7c5114ae0c4478578a72fe8e", "url": "https://github.com/gocd/gocd/commit/d2bc7f527029a11a7c5114ae0c4478578a72fe8e", "message": "Update lombok so it works on the latest IDEA", "committedDate": "2020-12-07T03:50:50Z", "type": "forcePushed"}, {"oid": "ad6cfe214858d7f58e866dafea77eeaccb589a99", "url": "https://github.com/gocd/gocd/commit/ad6cfe214858d7f58e866dafea77eeaccb589a99", "message": "Update lombok so it works on the latest IDEA", "committedDate": "2020-12-07T05:27:45Z", "type": "forcePushed"}, {"oid": "01a7d0df12d0688e0487ac47ed4084d9f4e8a2b8", "url": "https://github.com/gocd/gocd/commit/01a7d0df12d0688e0487ac47ed4084d9f4e8a2b8", "message": "Include configured server site urls in the base layout so we can build URLs client-side", "committedDate": "2020-12-07T05:30:23Z", "type": "commit"}, {"oid": "aec09a6eb2f20f50bf746e5ead1423e473442ece", "url": "https://github.com/gocd/gocd/commit/aec09a6eb2f20f50bf746e5ead1423e473442ece", "message": "Introduce endpoint for config repo webhooks\n\nPath: `/go/api/webhooks/:provider/config_repos/:repoId`\n\n- Responds to both push and pull request events\n- Triggers an arbitrary config repo based on an ID parameter\n    - Config repos need not correspond with the webhook's originating repo\n      as one can store config-as-code definitions in any repostiory\n    - Introduce new payload types for pull requests and associated\n      children\n- Refactor webhook request and payload relationship to facilitate support\n  for multiple event types and conditional payload parsing under a single\n  endpoint\n    - Webhook requests are now payload-independent, and are only\n      concerned with webhook auth, event parsing, and event validation\n    - Webhook payloads are a separate domain object that are only parsed\n      after knowing the event type\n    - Tests refactored to DRY via parameterized tests over payload\n      classes", "committedDate": "2020-12-07T05:32:26Z", "type": "commit"}, {"oid": "e16b74f414baaaebfebc38a05cbe78d233f3b7bf", "url": "https://github.com/gocd/gocd/commit/e16b74f414baaaebfebc38a05cbe78d233f3b7bf", "message": "Update lombok so it works on the latest IDEA", "committedDate": "2020-12-07T05:34:18Z", "type": "forcePushed"}, {"oid": "2d0ad31e8512e0c7f26c181cd7328ce0fede5d22", "url": "https://github.com/gocd/gocd/commit/2d0ad31e8512e0c7f26c181cd7328ce0fede5d22", "message": "Introduce webhook URL suggestion helper component\n\nThis component generates configrepo webhook URLs for chosen providers.\nIt is shown on the config repo page for config repos where `autoUpdate`\nis set to `false`.\n\nThis relies on a base-URL building utility which first consults any\nconfigured site URL or secure site URL, falling back to guessing the\nbase URL from the `window.location` if neither is configured.\n\nThe component also informs the user of the provider-specific events to\nconfigure the webhook.\n\nThis also introduces a new click-to-copy component that can be composed\nmore flexibly in that it does not rely on an input field. It will probably\nreplace <CopyField/>.", "committedDate": "2020-12-07T12:22:05Z", "type": "commit"}, {"oid": "edcbaa703677002ea9b5b08993de396abcf98cd1", "url": "https://github.com/gocd/gocd/commit/edcbaa703677002ea9b5b08993de396abcf98cd1", "message": "Update lombok so it works on the latest IDEA", "committedDate": "2020-12-07T12:24:48Z", "type": "commit"}, {"oid": "edcbaa703677002ea9b5b08993de396abcf98cd1", "url": "https://github.com/gocd/gocd/commit/edcbaa703677002ea9b5b08993de396abcf98cd1", "message": "Update lombok so it works on the latest IDEA", "committedDate": "2020-12-07T12:24:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAzNjA0Nw==", "url": "https://github.com/gocd/gocd/pull/8023#discussion_r538036047", "bodyText": "This should be id: https://docs.gitlab.com/ee/user/project/integrations/webhooks.html#merge-request-events", "author": "kritika-singh3", "createdAt": "2020-12-08T04:59:23Z", "path": "api/api-webhook-v1/src/main/java/com/thoughtworks/go/apiv1/webhook/request/payload/pr/GitLabPR.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2020 ThoughtWorks, Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.thoughtworks.go.apiv1.webhook.request.payload.pr;\n+\n+import com.google.gson.annotations.SerializedName;\n+import com.thoughtworks.go.apiv1.webhook.request.json.GitLabProject;\n+\n+import static com.thoughtworks.go.apiv1.webhook.request.payload.pr.PrPayload.State.CLOSED;\n+import static com.thoughtworks.go.apiv1.webhook.request.payload.pr.PrPayload.State.OPEN;\n+import static java.lang.String.format;\n+\n+@SuppressWarnings({\"unused\", \"RedundantSuppression\"})\n+public class GitLabPR implements PrPayload {\n+    private GitLabProject project;\n+\n+    @SerializedName(\"object_attributes\")\n+    private Attrs attrs;\n+\n+    @Override\n+    public String identifier() {\n+        return format(\"#%d\", attrs.number);\n+    }\n+\n+    @Override\n+    public State state() {\n+        return \"opened\".equals(attrs.state) ? OPEN : CLOSED;\n+    }\n+\n+    @Override\n+    public String hostname() {\n+        return project.hostname();\n+    }\n+\n+    @Override\n+    public String fullName() {\n+        return project.fullName();\n+    }\n+\n+    private static class Attrs {\n+        @SerializedName(\"iid\")", "originalCommit": "aec09a6eb2f20f50bf746e5ead1423e473442ece", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODA3MzQ5Mw==", "url": "https://github.com/gocd/gocd/pull/8023#discussion_r538073493", "bodyText": "Sorry ignore me - I was thinking this was a typo - but we do have both id and iid.", "author": "kritika-singh3", "createdAt": "2020-12-08T06:41:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODAzNjA0Nw=="}], "type": "inlineReview"}, {"oid": "322f0632247a6921c8dcc3e47826752745b4d1ae", "url": "https://github.com/gocd/gocd/commit/322f0632247a6921c8dcc3e47826752745b4d1ae", "message": "Rename field `page` => `urlGenerator` for clarity; also restore assignment operator alignment in `buttons/index.tsx`", "committedDate": "2020-12-09T04:41:44Z", "type": "commit"}]}