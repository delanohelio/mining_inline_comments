{"pr_number": 164, "pr_title": "DEV-1342 Add turquoise event publishing", "pr_createdAt": "2020-06-18T20:42:31Z", "pr_url": "https://github.com/hartwigmedical/pipeline5/pull/164", "timeline": [{"oid": "b504fed79515cfd457a803657a6717c372ac9b24", "url": "https://github.com/hartwigmedical/pipeline5/commit/b504fed79515cfd457a803657a6717c372ac9b24", "message": "DEV-1342 Add turquoise event publishing\n\nAdds publishing of an event on pipeline start and pipeline completion with the following subjects:\n- sample\n- set\n- type (somatic, shallow, single)\n- barcodes\n- run id if present\n- status for completion\n\nFor now made the choice to completely decouple from turquoise at compile time, and duplicate the\nclasses required to publish the events. Will probably revisit this later and perhaps create a simple\nturquoise client.\n\nThe publishing is hid behind a feature toggle which is for disabled.", "committedDate": "2020-06-18T20:41:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMDYzMA==", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442920630", "bodyText": "This feels a bit over-abstracted to me, suspect it will continue to evolve.", "author": "nedleitch", "createdAt": "2020-06-19T15:57:12Z", "path": "cluster/src/main/java/com/hartwig/pipeline/turquoise/Event.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package com.hartwig.pipeline.turquoise;\n+\n+import java.time.LocalDateTime;\n+import java.util.List;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+@JsonSerialize(as = ImmutableEvent.class)\n+interface Event {\n+\n+    @Value.Parameter\n+    LocalDateTime timestamp();\n+\n+    @Value.Parameter\n+    EventType type();", "originalCommit": "b504fed79515cfd457a803657a6717c372ac9b24", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjk0MzI4OQ==", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442943289", "bodyText": "Actually I'm happy to remove this, makes the json more verbose than it needs to be.", "author": "pauldwolfe", "createdAt": "2020-06-19T16:42:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMDYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMjAyNg==", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442922026", "bodyText": "See comment above, in BigQuery this is just a string at the top-level.", "author": "nedleitch", "createdAt": "2020-06-19T15:59:47Z", "path": "cluster/src/main/java/com/hartwig/pipeline/turquoise/EventType.java", "diffHunk": "@@ -0,0 +1,13 @@\n+package com.hartwig.pipeline.turquoise;\n+\n+import com.fasterxml.jackson.databind.annotation.JsonSerialize;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+@JsonSerialize(as = ImmutableEventType.class)\n+interface EventType {\n+\n+    @Value.Parameter\n+    String name();\n+}", "originalCommit": "b504fed79515cfd457a803657a6717c372ac9b24", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjkyMzE2OA==", "url": "https://github.com/hartwigmedical/pipeline5/pull/164#discussion_r442923168", "bodyText": "Rarely seen in the wild.", "author": "nedleitch", "createdAt": "2020-06-19T16:02:04Z", "path": "cluster/src/main/java/com/hartwig/pipeline/turquoise/PipelineCompleted.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package com.hartwig.pipeline.turquoise;\n+\n+import java.util.List;\n+\n+import org.immutables.value.Value;\n+\n+@Value.Immutable\n+public interface PipelineCompleted extends PipelineEvent {\n+\n+    String status();\n+\n+    @Override\n+    default String eventType() {\n+        return \"pipeline.completed\";\n+    }\n+\n+    @Override\n+    default List<Subject> subjects() {\n+        List<Subject> subjects = PipelineEvent.super.subjects();", "originalCommit": "b504fed79515cfd457a803657a6717c372ac9b24", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "618fd85e2e9885e1df10975add5c5029467aa885", "url": "https://github.com/hartwigmedical/pipeline5/commit/618fd85e2e9885e1df10975add5c5029467aa885", "message": "DEV-1342 Address review comments\n\nRemove the wrapper types from message.\n\nExternalize JSON in tests.", "committedDate": "2020-06-19T17:19:19Z", "type": "commit"}]}