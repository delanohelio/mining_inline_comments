{"pr_number": 7766, "pr_title": "netty: Upgrade to Netty 4.1.52 and tcnative 2.0.34", "pr_createdAt": "2020-12-28T22:51:24Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7766", "timeline": [{"oid": "e97d47974f5c307988675e429fdbe4fbf88c112b", "url": "https://github.com/grpc/grpc-java/commit/e97d47974f5c307988675e429fdbe4fbf88c112b", "message": "netty: Upgrade to Netty 4.1.52 and tcnative 2.0.34\n\nThe tiny cache size was removed from the bytebuf allocator and so was\ndeprecated. TLSv1.3 was enabled by the upgrade, which fails mTLS\nconnections at different times. Conscrypt is incompatible with the\ndefault TrustManager when TLSv1.3 is enabled so we explicitly disable\nTLSv1.3 when Conscrypt is used for the moment.", "committedDate": "2020-12-28T23:19:02Z", "type": "commit"}, {"oid": "e97d47974f5c307988675e429fdbe4fbf88c112b", "url": "https://github.com/grpc/grpc-java/commit/e97d47974f5c307988675e429fdbe4fbf88c112b", "message": "netty: Upgrade to Netty 4.1.52 and tcnative 2.0.34\n\nThe tiny cache size was removed from the bytebuf allocator and so was\ndeprecated. TLSv1.3 was enabled by the upgrade, which fails mTLS\nconnections at different times. Conscrypt is incompatible with the\ndefault TrustManager when TLSv1.3 is enabled so we explicitly disable\nTLSv1.3 when Conscrypt is used for the moment.", "committedDate": "2020-12-28T23:19:02Z", "type": "forcePushed"}, {"oid": "6260d71d072b9d5be6b11e74e0e6f923e6bf0e83", "url": "https://github.com/grpc/grpc-java/commit/6260d71d072b9d5be6b11e74e0e6f923e6bf0e83", "message": "Fix tests verifying SSLHandshakeException for mTLS", "committedDate": "2020-12-28T23:52:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUzMjU4Mg==", "url": "https://github.com/grpc/grpc-java/pull/7766#discussion_r549532582", "bodyText": "If it enters here because of the if clause what's the point of this assertion?", "author": "sanjaypujare", "createdAt": "2020-12-29T01:03:04Z", "path": "xds/src/test/java/io/grpc/xds/XdsSdsClientServerTest.java", "diffHunk": "@@ -175,8 +176,14 @@ public void requireClientAuth_noClientCert_expectException()\n       unaryRpc(/* requestMessage= */ \"buddy\", blockingStub);\n       fail(\"exception expected\");\n     } catch (StatusRuntimeException sre) {\n-      assertThat(sre).hasCauseThat().isInstanceOf(SSLHandshakeException.class);\n-      assertThat(sre).hasCauseThat().hasMessageThat().contains(\"HANDSHAKE_FAILURE\");\n+      if (sre.getCause() instanceof SSLHandshakeException) {\n+        assertThat(sre).hasCauseThat().isInstanceOf(SSLHandshakeException.class);", "originalCommit": "6260d71d072b9d5be6b11e74e0e6f923e6bf0e83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTc4NzE0NA==", "url": "https://github.com/grpc/grpc-java/pull/7766#discussion_r549787144", "bodyText": "To clearly show the assertion being made. So a readability thing. I agree it will never fail, but if the condition is removed/changed in the future, the assertion could easily be forgotten.", "author": "ejona86", "createdAt": "2020-12-29T17:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUzMjU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTUzMjc2Mg==", "url": "https://github.com/grpc/grpc-java/pull/7766#discussion_r549532762", "bodyText": "Same as above. If sre.getCause() instanceof SSLHandshakeException is true, wouldn't this assertion will always be true?", "author": "sanjaypujare", "createdAt": "2020-12-29T01:04:03Z", "path": "xds/src/test/java/io/grpc/xds/XdsSdsClientServerTest.java", "diffHunk": "@@ -206,8 +213,14 @@ public void mtls_badClientCert_expectException() throws IOException, URISyntaxEx\n           false);\n       fail(\"exception expected\");\n     } catch (StatusRuntimeException sre) {\n-      assertThat(sre).hasCauseThat().isInstanceOf(SSLHandshakeException.class);\n-      assertThat(sre).hasCauseThat().hasMessageThat().contains(\"HANDSHAKE_FAILURE\");\n+      if (sre.getCause() instanceof SSLHandshakeException) {\n+        assertThat(sre).hasCauseThat().isInstanceOf(SSLHandshakeException.class);", "originalCommit": "6260d71d072b9d5be6b11e74e0e6f923e6bf0e83", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "28068e9cf7c9920039d3b3a9335294d55db15290", "url": "https://github.com/grpc/grpc-java/commit/28068e9cf7c9920039d3b3a9335294d55db15290", "message": "Relax channel state for slow test execution", "committedDate": "2020-12-29T17:21:54Z", "type": "commit"}, {"oid": "5bb2540538a434f48bbf914f6b54f117fcb3a650", "url": "https://github.com/grpc/grpc-java/commit/5bb2540538a434f48bbf914f6b54f117fcb3a650", "message": "Fix grpc version netty upgrade is a part of", "committedDate": "2020-12-29T17:25:39Z", "type": "forcePushed"}, {"oid": "39dc5ea6c75dcd998b83731ae033387ea66dd892", "url": "https://github.com/grpc/grpc-java/commit/39dc5ea6c75dcd998b83731ae033387ea66dd892", "message": "Fix grpc version netty upgrade is a part of", "committedDate": "2020-12-29T17:26:08Z", "type": "commit"}, {"oid": "39dc5ea6c75dcd998b83731ae033387ea66dd892", "url": "https://github.com/grpc/grpc-java/commit/39dc5ea6c75dcd998b83731ae033387ea66dd892", "message": "Fix grpc version netty upgrade is a part of", "committedDate": "2020-12-29T17:26:08Z", "type": "forcePushed"}, {"oid": "974bcbf582688261db0ac55786fd38f360179638", "url": "https://github.com/grpc/grpc-java/commit/974bcbf582688261db0ac55786fd38f360179638", "message": "Relax exception string check, as different OpenSSL/Boringssl versions produce slightly different errors", "committedDate": "2020-12-29T20:20:15Z", "type": "commit"}]}