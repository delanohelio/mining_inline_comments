{"pr_number": 7646, "pr_title": "xds: obtain the global SharedCallCounterMap in the xDS resolver only", "pr_createdAt": "2020-11-19T19:37:56Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7646", "timeline": [{"oid": "3117ed4b1c5ca52dbd22ea198a538096fd6362a4", "url": "https://github.com/grpc/grpc-java/commit/3117ed4b1c5ca52dbd22ea198a538096fd6362a4", "message": "Obtain the global SharedCallCounterMap in the xDS resolver and pass it down as an attribute to LB policies.", "committedDate": "2020-11-19T19:13:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIzMTc3OA==", "url": "https://github.com/grpc/grpc-java/pull/7646#discussion_r527231778", "bodyText": "If childLbState does not need need it, might discard the key for downstream balancers.", "author": "dapengzhang0", "createdAt": "2020-11-19T22:02:26Z", "path": "xds/src/main/java/io/grpc/xds/EdsLoadBalancer2.java", "diffHunk": "@@ -108,6 +110,10 @@ public void handleResolvedAddresses(ResolvedAddresses resolvedAddresses) {\n       xdsClientPool = resolvedAddresses.getAttributes().get(XdsAttributes.XDS_CLIENT_POOL);\n       xdsClient = xdsClientPool.getObject();\n     }\n+    if (callCounterProvider == null) {\n+      callCounterProvider =\n+          resolvedAddresses.getAttributes().get(XdsAttributes.CALL_COUNTER_PROVIDER);", "originalCommit": "3117ed4b1c5ca52dbd22ea198a538096fd6362a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIzOTM2OA==", "url": "https://github.com/grpc/grpc-java/pull/7646#discussion_r527239368", "bodyText": "Well, not necessary. Just like the object pool for XdsClient, we do not discard it even if it is not needed in the leaf LB policy.", "author": "voidzcy", "createdAt": "2020-11-19T22:15:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIzMTc3OA=="}], "type": "inlineReview"}]}