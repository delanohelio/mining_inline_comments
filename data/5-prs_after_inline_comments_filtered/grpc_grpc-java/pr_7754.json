{"pr_number": 7754, "pr_title": "Remove dependency on Apache commons lang", "pr_createdAt": "2020-12-23T17:09:41Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7754", "timeline": [{"oid": "9170114886e78fe04f4fe5872de23f20ff7e3c6d", "url": "https://github.com/grpc/grpc-java/commit/9170114886e78fe04f4fe5872de23f20ff7e3c6d", "message": "Merge pull request #1 from grpc/master\n\nmerge from origin", "committedDate": "2020-04-14T17:27:13Z", "type": "commit"}, {"oid": "d1120d18db3f5890b6f6fcd1f27bef2563b41ac2", "url": "https://github.com/grpc/grpc-java/commit/d1120d18db3f5890b6f6fcd1f27bef2563b41ac2", "message": "Merge pull request #2 from grpc/master\n\nmerge", "committedDate": "2020-05-27T17:44:25Z", "type": "commit"}, {"oid": "1e8fcd4e6bb828699418b6855f8b13e53531a70b", "url": "https://github.com/grpc/grpc-java/commit/1e8fcd4e6bb828699418b6855f8b13e53531a70b", "message": "Merge branch 'master' of github.com:grpc/grpc-java", "committedDate": "2020-06-03T13:08:03Z", "type": "commit"}, {"oid": "18835f226f8a9b19d03ef5b5037cf5102e37e2e4", "url": "https://github.com/grpc/grpc-java/commit/18835f226f8a9b19d03ef5b5037cf5102e37e2e4", "message": "Merge remote-tracking branch 'upstream/master'", "committedDate": "2020-06-23T18:21:46Z", "type": "commit"}, {"oid": "acddcb752ebbdb37b69f292e104fccc030602cc3", "url": "https://github.com/grpc/grpc-java/commit/acddcb752ebbdb37b69f292e104fccc030602cc3", "message": "Merge pull request #3 from grpc/master\n\nudpate fork", "committedDate": "2020-12-23T16:46:11Z", "type": "commit"}, {"oid": "9adf93b718e9a5243e9a27d70b243468be40a940", "url": "https://github.com/grpc/grpc-java/commit/9adf93b718e9a5243e9a27d70b243468be40a940", "message": "remove dependency on commons lang", "committedDate": "2020-12-23T17:06:25Z", "type": "commit"}, {"oid": "24132c801bd78a21621b124ec243e87be23580e7", "url": "https://github.com/grpc/grpc-java/commit/24132c801bd78a21621b124ec243e87be23580e7", "message": "import Locale", "committedDate": "2020-12-23T17:25:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA3MjA1NQ==", "url": "https://github.com/grpc/grpc-java/pull/7754#discussion_r548072055", "bodyText": "Don't make this a static variable; move it into isRunningOnGcp. It is only used in isRunningOnGcp and isRunningOnGcp is only called once.", "author": "ejona86", "createdAt": "2020-12-23T17:30:25Z", "path": "alts/src/main/java/io/grpc/alts/CheckGcpEnvironment.java", "diffHunk": "@@ -63,13 +63,15 @@ static boolean checkBiosDataOnWindows(BufferedReader reader) throws IOException\n     }\n     return false;\n   }\n+  \n+  private static final String OS = System.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH);", "originalCommit": "24132c801bd78a21621b124ec243e87be23580e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA5MzMzOA==", "url": "https://github.com/grpc/grpc-java/pull/7754#discussion_r548093338", "bodyText": "done", "author": "elharo", "createdAt": "2020-12-23T17:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA3MjA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA3MzU2NQ==", "url": "https://github.com/grpc/grpc-java/pull/7754#discussion_r548073565", "bodyText": "How did you come up with this code? Why not the more conventional startsWith() and why not use \"windows\" here?", "author": "ejona86", "createdAt": "2020-12-23T17:32:36Z", "path": "alts/src/main/java/io/grpc/alts/CheckGcpEnvironment.java", "diffHunk": "@@ -63,13 +63,15 @@ static boolean checkBiosDataOnWindows(BufferedReader reader) throws IOException\n     }\n     return false;\n   }\n+  \n+  private static final String OS = System.getProperty(\"os.name\").toLowerCase(Locale.ENGLISH);\n \n   private static boolean isRunningOnGcp() {\n     try {\n-      if (SystemUtils.IS_OS_LINUX) {\n+      if (OS.indexOf(\"linux\") >= 0) {\n         // Checks GCE residency on Linux platform.\n         return checkProductNameOnLinux(Files.newBufferedReader(Paths.get(DMI_PRODUCT_NAME), UTF_8));\n-      } else if (SystemUtils.IS_OS_WINDOWS) {\n+      } else if (OS.indexOf(\"win\") >= 0) {", "originalCommit": "24132c801bd78a21621b124ec243e87be23580e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA5Nzk2OA==", "url": "https://github.com/grpc/grpc-java/pull/7754#discussion_r548097968", "bodyText": "I picked \"win\" instead of \"windows\" in case we end up with something weird like \"Win95\" or \"WinXP\" one of these days. indexOf seemed a little more general than startsWith.", "author": "elharo", "createdAt": "2020-12-23T18:03:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA3MzU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODEzNTgzNg==", "url": "https://github.com/grpc/grpc-java/pull/7754#discussion_r548135836", "bodyText": "But it seems you copied from a lower-ranked answer that initially had bugs like \"checking for 'darwin' after 'win'\" if you look at the very first comment. And you can't simply remove the Darwin case and expect proper behavior.\nOpenJDK uses very regular names for Windows. Mac is hard-coded to \"Mac OS X\" and Unix uses uname -s. I don't see the hard-coding for OS X in Java 7, so it probably used \"Darwin.\" That's all obviously OpenJDK-specific, but I'd expect other JDKs to be similar (use uname for most cases, start Windows names with \"Windows\").\nUse startsWith() and spell out \"windows\" in full.", "author": "ejona86", "createdAt": "2020-12-23T18:50:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA3MzU2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODE0ODM2MQ==", "url": "https://github.com/grpc/grpc-java/pull/7754#discussion_r548148361", "bodyText": "done", "author": "elharo", "createdAt": "2020-12-23T19:05:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0ODA3MzU2NQ=="}], "type": "inlineReview"}, {"oid": "89daaedff4f66e36606a47df9aa35bdad1070dc7", "url": "https://github.com/grpc/grpc-java/commit/89daaedff4f66e36606a47df9aa35bdad1070dc7", "message": "field --> local variable", "committedDate": "2020-12-23T18:04:49Z", "type": "commit"}, {"oid": "805c9b11d74c07f535b5c3b0b85d95e2b47b2c4e", "url": "https://github.com/grpc/grpc-java/commit/805c9b11d74c07f535b5c3b0b85d95e2b47b2c4e", "message": "use startsWith and full name of Windows", "committedDate": "2020-12-23T19:04:10Z", "type": "commit"}]}