{"pr_number": 7273, "pr_title": "xds: support v3 for XdsClient", "pr_createdAt": "2020-07-31T05:17:56Z", "pr_url": "https://github.com/grpc/grpc-java/pull/7273", "timeline": [{"oid": "a6383abeedb63b43dc7efb12bc232716df6c15c6", "url": "https://github.com/grpc/grpc-java/commit/a6383abeedb63b43dc7efb12bc232716df6c15c6", "message": "xds: support v3 for XdsClient", "committedDate": "2020-07-31T05:14:58Z", "type": "commit"}, {"oid": "a641f22a34c5b623343da12f4aad858205e8e50e", "url": "https://github.com/grpc/grpc-java/commit/a641f22a34c5b623343da12f4aad858205e8e50e", "message": "duplicate XdsClientImplTest for v2", "committedDate": "2020-07-31T05:15:04Z", "type": "commit"}, {"oid": "b68fefcc8b1233ac1a3618e370fe2a7e4be15ecc", "url": "https://github.com/grpc/grpc-java/commit/b68fefcc8b1233ac1a3618e370fe2a7e4be15ecc", "message": "Use v3 protocol for XdsClientImplTestV3", "committedDate": "2020-07-31T05:15:04Z", "type": "commit"}, {"oid": "2f8699e84a0f552e49bf4df295f926a6ff80e16e", "url": "https://github.com/grpc/grpc-java/commit/2f8699e84a0f552e49bf4df295f926a6ff80e16e", "message": "useProtocolV3 can be final", "committedDate": "2020-07-31T16:54:17Z", "type": "commit"}, {"oid": "2f8699e84a0f552e49bf4df295f926a6ff80e16e", "url": "https://github.com/grpc/grpc-java/commit/2f8699e84a0f552e49bf4df295f926a6ff80e16e", "message": "useProtocolV3 can be final", "committedDate": "2020-07-31T16:54:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0NzkxMA==", "url": "https://github.com/grpc/grpc-java/pull/7273#discussion_r463747910", "bodyText": "nit: you could just pass a channel for each AdsStream's constructor and create its own stub inside.", "author": "voidzcy", "createdAt": "2020-07-31T17:50:18Z", "path": "xds/src/main/java/io/grpc/xds/XdsClientImpl.java", "diffHunk": "@@ -516,12 +522,18 @@ public String toString() {\n    */\n   private void startRpcStream() {\n     checkState(adsStream == null, \"Previous adsStream has not been cleared yet\");\n-    io.envoyproxy.envoy.service.discovery.v2.AggregatedDiscoveryServiceGrpc\n-            .AggregatedDiscoveryServiceStub\n-        stub =\n-            io.envoyproxy.envoy.service.discovery.v2.AggregatedDiscoveryServiceGrpc.newStub(\n-                channel);\n-    adsStream = new AdsStreamV2(stub);\n+    if (useProtocolV3) {\n+      AggregatedDiscoveryServiceGrpc.AggregatedDiscoveryServiceStub stub =", "originalCommit": "2f8699e84a0f552e49bf4df295f926a6ff80e16e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc3MDc1Ng==", "url": "https://github.com/grpc/grpc-java/pull/7273#discussion_r463770756", "bodyText": "Good idea. Done.", "author": "dapengzhang0", "createdAt": "2020-07-31T18:39:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc0NzkxMA=="}], "type": "inlineReview"}, {"oid": "6065ef76cd2030b039e00efcd9084a91c8d47758", "url": "https://github.com/grpc/grpc-java/commit/6065ef76cd2030b039e00efcd9084a91c8d47758", "message": "cleanup AdsStream constructor", "committedDate": "2020-07-31T18:39:17Z", "type": "commit"}]}