{"pr_number": 1308, "pr_title": "[#691] Expand fixture API with \"expect no scheduled events / deadlines\"", "pr_createdAt": "2020-01-06T14:08:03Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1308", "timeline": [{"oid": "6d8338bb69195ce944594b633e16a69b8546fcbc", "url": "https://github.com/AxonFramework/AxonFramework/commit/6d8338bb69195ce944594b633e16a69b8546fcbc", "message": "Some preliminary work\n\nMake some minor adjustments prior to introducing the canceled deadlines\nlogic as a form of clean up\n\n#691", "committedDate": "2020-01-06T10:14:04Z", "type": "commit"}, {"oid": "ced28317f044a20843fd9a1d805dfba4c8ad1d5e", "url": "https://github.com/AxonFramework/AxonFramework/commit/ced28317f044a20843fd9a1d805dfba4c8ad1d5e", "message": "Add assert-no-scheduled-deadline methods\n\nTo provide functionality to match/test for no scheduled deadlines\nfunctions should be introduced which assert that. An assert method\ntaking in a Duration and a Matcher and an assert method taking in an\nInstant and a Matcher should be sufficient. Whilst in the file, resolve\ninconsistencies and warnings as mentioned by the IDE\n\n#691", "committedDate": "2020-01-06T11:15:22Z", "type": "commit"}, {"oid": "f0f056155133f67a378cbd1f949922ca319c5067", "url": "https://github.com/AxonFramework/AxonFramework/commit/f0f056155133f67a378cbd1f949922ca319c5067", "message": "Implement set of expect no scheduled deadline methods\n\nThe AggregateTestFixture should allow testing for no scheduled deadlines\nThe same parameters used to test for actual scheduled deadlines, thus\nthrough a deadline Matcher, object, type and name, should be provided,\nas well as method sets for Instant and Duration checking.\n\n#691", "committedDate": "2020-01-06T11:39:41Z", "type": "commit"}, {"oid": "2a4b642cd05c6ea557c8309d3650220441822ae6", "url": "https://github.com/AxonFramework/AxonFramework/commit/2a4b642cd05c6ea557c8309d3650220441822ae6", "message": "Implement set of expect no scheduled deadline methods\n\nThe SagaTestFixture should allow testing for no scheduled deadlines\nThe same parameters used to test for actual scheduled deadlines, thus\nthrough a deadline Matcher, object, type and name, should be provided,\nas well as method sets for Instant and Duration checking.\n\n#691", "committedDate": "2020-01-06T11:46:43Z", "type": "commit"}, {"oid": "511b0e91df6172d9f7c03a8e42de55a03c06cb15", "url": "https://github.com/AxonFramework/AxonFramework/commit/511b0e91df6172d9f7c03a8e42de55a03c06cb15", "message": "Move the EventSchedulerValidator to the eventscheduler package\n\nMove the EventSchedulerValidator to the eventscheduler package\n\n#691", "committedDate": "2020-01-06T11:48:53Z", "type": "commit"}, {"oid": "cdc374d994ec1c40a08d5c9d5f89f4b27a1f3b79", "url": "https://github.com/AxonFramework/AxonFramework/commit/cdc374d994ec1c40a08d5c9d5f89f4b27a1f3b79", "message": "Add assert-no-scheduled-event methods\n\nTo provide functionality to match/test for no scheduled events\nfunctions should be introduced which assert that. An assert method\ntaking in a Duration and a Matcher and an assert method taking in an\nInstant and a Matcher should be sufficient. Whilst in the file, resolve\ninconsistencies and warnings as mentioned by the IDE\n\n#691", "committedDate": "2020-01-06T13:28:51Z", "type": "commit"}, {"oid": "ba211ae1731c44a9793841b03b57742738a5e213", "url": "https://github.com/AxonFramework/AxonFramework/commit/ba211ae1731c44a9793841b03b57742738a5e213", "message": "Implement set of expect no scheduled event methods\n\nThe SagaTestFixture should allow testing for no scheduled events\nThe same parameters used to test for actual scheduled events, thus\nthrough a event Matcher, object, type and name, should be provided,\nas well as method sets for Instant and Duration checking.\n\n#691", "committedDate": "2020-01-06T13:30:02Z", "type": "commit"}, {"oid": "e294292c922b44415b320b076769bcfb6f60b523", "url": "https://github.com/AxonFramework/AxonFramework/commit/e294292c922b44415b320b076769bcfb6f60b523", "message": "Provide tests for the no-scheduled-events methods\n\nAdd a dedicated test class for scheduled events for clarity. Move\napplicable tests from the AnnotatedSagaTest to this new file and add\ntest scenarios for the new expect no-scheduled-events. Perform some\nclean up for the touched files whilst at it\n\n#691", "committedDate": "2020-01-06T13:56:11Z", "type": "commit"}, {"oid": "b3faa074c328fa2a22548d625563e45f144567ca", "url": "https://github.com/AxonFramework/AxonFramework/commit/b3faa074c328fa2a22548d625563e45f144567ca", "message": "Adjust test names for clarity\n\nAdjust test names for clarity\n\n#691", "committedDate": "2020-01-06T13:57:00Z", "type": "commit"}, {"oid": "e06b2099895ff5a6407ef9b54e33f72cc8b0362d", "url": "https://github.com/AxonFramework/AxonFramework/commit/e06b2099895ff5a6407ef9b54e33f72cc8b0362d", "message": "Trigger copyright update\n\nTrigger copyright notice update to 2020\n\n#691", "committedDate": "2020-01-06T14:08:48Z", "type": "commit"}, {"oid": "b9b465c9a16fb1c18508324693e270b6bf3050a5", "url": "https://github.com/AxonFramework/AxonFramework/commit/b9b465c9a16fb1c18508324693e270b6bf3050a5", "message": "Undo change to trigger copyright update\n\nUndo the change which triggered the copyright notice update\n\n#691", "committedDate": "2020-01-06T14:11:57Z", "type": "commit"}, {"oid": "6b474f56cc0639f1496edac714f3b41ffb513fb8", "url": "https://github.com/AxonFramework/AxonFramework/commit/6b474f56cc0639f1496edac714f3b41ffb513fb8", "message": "Merge branch 'feature/894' into feature/691", "committedDate": "2020-01-06T14:26:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMzNTgwMA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#discussion_r363335800", "bodyText": "This is still a @duration =)\njavadoc changes as usual", "author": "lfgcampos", "createdAt": "2020-01-06T15:15:22Z", "path": "test/src/main/java/org/axonframework/test/aggregate/ResultValidator.java", "diffHunk": "@@ -274,6 +275,100 @@\n      */\n     ResultValidator<T> expectNoScheduledDeadlines();\n \n+    /**\n+     * Asserts that <b>no</b> deadline matching the given {@code matcher} should be scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration the time at which no deadline matching the given {@code matcher} should be scheduled\n+     * @param matcher  the matcher defining the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineMatching(Duration duration,\n+                                                         Matcher<? super DeadlineMessage<?>> matcher);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline equal to the given {@code deadline} has been scheduled after the given {@code\n+     * duration}.\n+     * <p/>\n+     * Note that the source attribute of the deadline is ignored when comparing deadlines. Deadlines are compared using\n+     * an \"equals\" check on all fields in the deadlines.\n+     *\n+     * @param duration the time at which no deadline equal to the given {@code deadline} should be scheduled\n+     * @param deadline the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadline(Duration duration, Object deadline);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline of the given {@code deadlineType} has been scheduled at the given {@code\n+     * scheduledTime}.", "originalCommit": "6b474f56cc0639f1496edac714f3b41ffb513fb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzY3MzEyNQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#discussion_r363673125", "bodyText": "Darn it...thanks for spotting it though! Resolved it just now.", "author": "smcvb", "createdAt": "2020-01-07T10:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzMzNTgwMA=="}], "type": "inlineReview"}, {"oid": "73fcc6c48329afe15f2c41a643eb4cf302701ad6", "url": "https://github.com/AxonFramework/AxonFramework/commit/73fcc6c48329afe15f2c41a643eb4cf302701ad6", "message": "Resolve javadoc typos\n\nResolve javadoc typos\n\n#691", "committedDate": "2020-01-07T10:01:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MTkyNA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#discussion_r364451924", "bodyText": "The timestamp of a DeadlineMessage should reflect the time of expiry of the deadline. At least, the DeadlineManager implementations for production use, have the schedule date as the event timestamp once they publish the Deadline Message. It would be nice for the StubDeadlineManager to reflect this behavior.\nThat would make the Instant parameter obsolete for this method. As a result, the method could become more powerful, as one can more easily validate the absence of any deadlines that match certain criteria.", "author": "abuijze", "createdAt": "2020-01-08T21:28:45Z", "path": "test/src/main/java/org/axonframework/test/aggregate/ResultValidator.java", "diffHunk": "@@ -274,6 +275,100 @@\n      */\n     ResultValidator<T> expectNoScheduledDeadlines();\n \n+    /**\n+     * Asserts that <b>no</b> deadline matching the given {@code matcher} should be scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration the time at which no deadline matching the given {@code matcher} should be scheduled\n+     * @param matcher  the matcher defining the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineMatching(Duration duration,\n+                                                         Matcher<? super DeadlineMessage<?>> matcher);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline equal to the given {@code deadline} has been scheduled after the given {@code\n+     * duration}.\n+     * <p/>\n+     * Note that the source attribute of the deadline is ignored when comparing deadlines. Deadlines are compared using\n+     * an \"equals\" check on all fields in the deadlines.\n+     *\n+     * @param duration the time at which no deadline equal to the given {@code deadline} should be scheduled\n+     * @param deadline the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadline(Duration duration, Object deadline);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline of the given {@code deadlineType} has been scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration     the time at which no deadline of {@code deadlineType} should be scheduled\n+     * @param deadlineType the type of the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineOfType(Duration duration, Class<?> deadlineType);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline with the given {@code deadlineName} has been scheduled after the given {@code\n+     * duration}.\n+     *\n+     * @param duration     the time at which no deadline of {@code deadlineName} should be scheduled\n+     * @param deadlineName the name of the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineWithName(Duration duration, String deadlineName);\n+\n+    /**\n+     * Asserts that <b>no</b> deadline matching the given {@code matcher} has been scheduled at the given {@code\n+     * scheduledTime}.\n+     * <p/>\n+     * If the {@code scheduledTime} is calculated based on the \"current time\", use the {@link\n+     * TestExecutor#currentTime()} to get the time to use as \"current time\".\n+     *\n+     * @param scheduledTime the time at which no deadline matching the given {@code matcher} should be scheduled\n+     * @param matcher       the matcher defining the deadline which should not be scheduled\n+     * @return the current ResultValidator, for fluent interfacing\n+     */\n+    ResultValidator<T> expectNoScheduledDeadlineMatching(Instant scheduledTime,", "originalCommit": "73fcc6c48329afe15f2c41a643eb4cf302701ad6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI0NDY2OA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1308#discussion_r365244668", "bodyText": "Very good point @abuijze! I've made the suggested change in this commit. Would you mind giving your opinion on it?", "author": "smcvb", "createdAt": "2020-01-10T13:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDQ1MTkyNA=="}], "type": "inlineReview"}, {"oid": "5200f41b69531de25972a341f386b866b6648c78", "url": "https://github.com/AxonFramework/AxonFramework/commit/5200f41b69531de25972a341f386b866b6648c78", "message": "Merge remote-tracking branch 'origin/master' into feature/691", "committedDate": "2020-01-10T09:38:00Z", "type": "commit"}, {"oid": "560e6ab4882bbe3d16ee38a2287fa8daa59637f9", "url": "https://github.com/AxonFramework/AxonFramework/commit/560e6ab4882bbe3d16ee38a2287fa8daa59637f9", "message": "Add expectNoScheduledDeadlineMatching(Matcher<DeadlineMessage>)\n\nThe DeadlineMessage also contains the scheduled time. Hence, the\nResultValidatorImpl and FixtureExecutionResultImpl can already match if\nthe given Duration/Instant matches the scheduled time in the\nDeadlineMessage. This simplifies the DeadlineManagerValidator, as it\ndoesn't have to provide two assert methods (with differing time types)\nbut a single one taking in a Matcher\n\n#691", "committedDate": "2020-01-10T13:40:06Z", "type": "commit"}, {"oid": "1946cd5e390f04b8575845770e3c6902b2e094e9", "url": "https://github.com/AxonFramework/AxonFramework/commit/1946cd5e390f04b8575845770e3c6902b2e094e9", "message": "Minor javadoc change\n\nMinor javadoc change\n\n#691", "committedDate": "2020-01-10T14:01:59Z", "type": "commit"}, {"oid": "4f98a7a6f67b41061859792c411c1f644629f39f", "url": "https://github.com/AxonFramework/AxonFramework/commit/4f98a7a6f67b41061859792c411c1f644629f39f", "message": "Switch around time and matcher check\n\nIt's smarter to first do the time matching and only then the provided\nmatcher. This way we ensure the given matcher isn't called for messages\nwith a completely different timestamp. Additionally, if the given\nmatcher is \"slow\", it would not be called in vain either.\n\n#691", "committedDate": "2020-01-10T15:28:36Z", "type": "commit"}]}