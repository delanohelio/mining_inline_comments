{"pr_number": 1348, "pr_title": "Consider top aggregate prototype when looking for aggregate spring bean.", "pr_createdAt": "2020-02-18T12:15:18Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1348", "timeline": [{"oid": "d5069f1e23e673a5fd8557a6b76a894ebde6b93b", "url": "https://github.com/AxonFramework/AxonFramework/commit/d5069f1e23e673a5fd8557a6b76a894ebde6b93b", "message": "Consider top aggregate prototype when looking for aggregate spring bean.", "committedDate": "2020-02-18T12:12:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NDk2Ng==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1348#discussion_r380664966", "bodyText": "I suppose this needs to be beanNamesForType.length != 1?", "author": "abuijze", "createdAt": "2020-02-18T13:17:58Z", "path": "spring/src/main/java/org/axonframework/spring/config/SpringAxonAutoConfigurer.java", "diffHunk": "@@ -327,6 +330,18 @@ private void registerSagaBeanDefinitions(EventProcessingConfigurer configurer) {\n         return hierarchy;\n     }\n \n+    private <A> String prototype(Class<A> type) {\n+        String[] beanNamesForType = beanFactory.getBeanNamesForType(type);\n+        if (beanNamesForType.length == 0) {\n+            throw new AxonConfigurationException(format(\"There are no spring beans for '%s' defined.\", type.getName()));\n+        } else {\n+            if (beanNamesForType.length == 1) {", "originalCommit": "d5069f1e23e673a5fd8557a6b76a894ebde6b93b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NTMwMQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1348#discussion_r380665301", "bodyText": "The name \"prototype\" is misleading, as this returns the name of the bean (which happens to be a prototype bean)", "author": "abuijze", "createdAt": "2020-02-18T13:18:37Z", "path": "spring/src/main/java/org/axonframework/spring/config/SpringAxonAutoConfigurer.java", "diffHunk": "@@ -327,6 +330,18 @@ private void registerSagaBeanDefinitions(EventProcessingConfigurer configurer) {\n         return hierarchy;\n     }\n \n+    private <A> String prototype(Class<A> type) {", "originalCommit": "d5069f1e23e673a5fd8557a6b76a894ebde6b93b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY2NTUwNA==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1348#discussion_r380665504", "bodyText": "Suggest renaming this property to \"beanName\".", "author": "abuijze", "createdAt": "2020-02-18T13:18:59Z", "path": "spring/src/main/java/org/axonframework/spring/config/SpringAxonAutoConfigurer.java", "diffHunk": "@@ -526,4 +543,40 @@ private ModuleConfiguration getDelegate() {\n             return delegate;\n         }\n     }\n+\n+    private static class SpringAggregate<T> {\n+        private final String prototype;\n+        private final Class<T> classType;\n+\n+        private SpringAggregate(String prototype, Class<T> classType) {\n+            this.prototype = prototype;\n+            this.classType = classType;\n+        }\n+\n+        public String getPrototype() {", "originalCommit": "d5069f1e23e673a5fd8557a6b76a894ebde6b93b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}