{"pr_number": 1410, "pr_title": "Adjust retrieval of Query Name in the QueryGateway", "pr_createdAt": "2020-04-17T10:13:22Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1410", "timeline": [{"oid": "a8554884504e92dca7038e7f3977903fe0598c3e", "url": "https://github.com/AxonFramework/AxonFramework/commit/a8554884504e92dca7038e7f3977903fe0598c3e", "message": "Adjust how the query name will be retrieved\n\nThe commit which introduce the option to provide a Message as the query\nparameter missed the adjustment to ensure the queryName would stay\nconsistently. Hence, the queryName could become \"Message\", which is\ndefinitely not intended. As a resolution, a static method can be\nintroduced in the GenericMessage class which correctly deduced the\nmessage name. This static method can in turn be used in the QueryGateway\n default methods to supply the right queryName field. Subsequently, the\n tests should be updated to verify this behaviour.\n\n#query-name-fix", "committedDate": "2020-04-17T10:06:08Z", "type": "commit"}, {"oid": "1d8b849ccfd496348bbb6bb0f2ad160da269360a", "url": "https://github.com/AxonFramework/AxonFramework/commit/1d8b849ccfd496348bbb6bb0f2ad160da269360a", "message": "Add tests\n\nAdd tests which verify the given query name will be used if it's\nspecified\n\n#1410", "committedDate": "2020-04-17T12:08:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NTQ5NQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410#discussion_r412145495", "bodyText": "I think this class also needs to take instance of QueryMessage into account, and use the queryName property to get the name.\nAlso suggest using queryName instead of messageName as method name and moving it to GenericQueryMessage.", "author": "abuijze", "createdAt": "2020-04-21T12:36:01Z", "path": "messaging/src/main/java/org/axonframework/messaging/GenericMessage.java", "diffHunk": "@@ -56,6 +57,23 @@\n         }\n     }\n \n+    /**\n+     * Extracts the message name from the given {@code payloadOrMessage}. If the given {@code payloadOrMessage} is an\n+     * instance of {@link Message}, {@link Message#getPayloadType()} is used. Otherwise we expect the given {@link\n+     * Object} to be the payload directly. The return value will be the result of {@link Class#getName()}, either from\n+     * the {@code Message}'s {@code payloadType} or from the payload's class.\n+     *\n+     * @param payloadOrMessage the payload to extract the {@link Class#getName()} from, or an instance of {@link\n+     *                         Message}\n+     * @return the {@link Class#getName()} result from the payload, or from the {@link Message#getPayloadType()} if the\n+     * given {@code payloadOrMessage} is an instance of {@link Message}\n+     */\n+    public static String messageName(Object payloadOrMessage) {", "originalCommit": "1d8b849ccfd496348bbb6bb0f2ad160da269360a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI4MzYxOQ==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1410#discussion_r412283619", "bodyText": "Good point. Moved this method to the QueryMessage interface, renamed it to queryName and added a third option: that the given payloadOrMessage can be of type QueryMessage, meaning QueryMessage#getQueryName() should be returned.", "author": "smcvb", "createdAt": "2020-04-21T15:24:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NTQ5NQ=="}], "type": "inlineReview"}, {"oid": "148a12f63fdbcf619aa43fb519af0aaa610df279", "url": "https://github.com/AxonFramework/AxonFramework/commit/148a12f63fdbcf619aa43fb519af0aaa610df279", "message": "Adjust logic to retrieve the query name\n\nMove the static messageName method to the QueryMessage interface. Added,\n supply a check which verifies if the given object is a QueryMessage.\n\n#1410", "committedDate": "2020-04-21T15:18:53Z", "type": "commit"}, {"oid": "44d59b64336a8cba644e32991fcccd281e7829a1", "url": "https://github.com/AxonFramework/AxonFramework/commit/44d59b64336a8cba644e32991fcccd281e7829a1", "message": "Merge remote-tracking branch 'origin/axon-4.3.x' into bug/query-name-fix", "committedDate": "2020-04-21T15:19:21Z", "type": "commit"}]}