{"pr_number": 1512, "pr_title": "[#1505] isCaughtUp() always returns true for pushing-\"Event Streams\"", "pr_createdAt": "2020-09-21T09:02:09Z", "pr_url": "https://github.com/AxonFramework/AxonFramework/pull/1512", "timeline": [{"oid": "a0e6bb59d606353eb74e6ae0bc5e1d908e53de12", "url": "https://github.com/AxonFramework/AxonFramework/commit/a0e6bb59d606353eb74e6ae0bc5e1d908e53de12", "message": "Adjust update position of caughtUp flag\n\nWhilst using a RDBMS to provide events to a TEP, the caughtUp flag would\n correctly reflect whenever the segment in question actually caughtUp as\n it proactively retrieves events. When using AxonServer, it is AS' job\n to push the events to the TEP. If pushing events took longer than the\n defined eventAvailabilityTimeout, the caughtUp flag could incorrectly\n show it was caughtUp since the TEP thought not events where present\n whilst it actually was still pending event. Moving the\n checkSegmentCaughtUp() to after handling an actual batch of events more\n directly reflects if the stream is updated.\n\n#1505", "committedDate": "2020-09-18T14:38:06Z", "type": "commit"}, {"oid": "fec3bf30e04f63ad3370013eb0dfe85ed3d697d7", "url": "https://github.com/AxonFramework/AxonFramework/commit/fec3bf30e04f63ad3370013eb0dfe85ed3d697d7", "message": "Merge remote-tracking branch 'origin/axon-4.4.x' into bug/1505", "committedDate": "2020-09-21T08:03:46Z", "type": "commit"}, {"oid": "f72a9aca705de410ee78011a9ca509be0c6aa471", "url": "https://github.com/AxonFramework/AxonFramework/commit/f72a9aca705de410ee78011a9ca509be0c6aa471", "message": "Fine tune testing of validating caughtUp flag\n\nThe original tests used sleeps to wait for a specified amount of time.\nTo mitigate this usage, methods which can assert for a given period of\ntime (with intervals) should be added to the AssertUtils. Further more,\nthese should be used at the right trigger moment, thus when the event\navailability time out kicks in.\n\n#1505", "committedDate": "2020-09-21T08:40:02Z", "type": "commit"}, {"oid": "6e4435211d90f89bc4a3510a82a33f60c778b5f0", "url": "https://github.com/AxonFramework/AxonFramework/commit/6e4435211d90f89bc4a3510a82a33f60c778b5f0", "message": "Change event availability timeout\n\nChange event availability timeout to cope with adjusted caughtUp flag\nupdate\n\n#1505", "committedDate": "2020-09-21T11:50:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0MDE0Ng==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1512#discussion_r492040146", "bodyText": "There is a check after the entire if block, so I don't see why there should be one here?", "author": "abuijze", "createdAt": "2020-09-21T13:23:01Z", "path": "messaging/src/main/java/org/axonframework/eventhandling/TrackingEventProcessor.java", "diffHunk": "@@ -437,6 +436,7 @@ private void processBatch(Segment segment, BlockingStream<TrackedEventMessage<?>\n                     return;\n                 }\n             } else {\n+                checkSegmentCaughtUp(segment, eventStream);", "originalCommit": "6e4435211d90f89bc4a3510a82a33f60c778b5f0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Mjk1Nw==", "url": "https://github.com/AxonFramework/AxonFramework/pull/1512#discussion_r492042957", "bodyText": "Thought was to allow validation if the caughtUp flag in the scenario the BlockingStream would not return at all. As the else reaches a return statement, we would thus miss updating the caughtUp flag in case the event stream was actually empty.", "author": "smcvb", "createdAt": "2020-09-21T13:26:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0MDE0Ng=="}], "type": "inlineReview"}]}