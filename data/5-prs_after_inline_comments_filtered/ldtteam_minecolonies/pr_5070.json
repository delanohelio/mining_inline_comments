{"pr_number": 5070, "pr_title": "Adds chat notification when all citizens (other than guards) are sleeping", "pr_createdAt": "2020-05-25T00:18:07Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5070", "timeline": [{"oid": "e2ab97ed59734f9da3a6debd301de2270b4509cd", "url": "https://github.com/ldtteam/minecolonies/commit/e2ab97ed59734f9da3a6debd301de2270b4509cd", "message": "Adds message when all citizens are sleeping\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>", "committedDate": "2020-05-24T19:29:41Z", "type": "commit"}, {"oid": "8c1c962f1bf085059570e94720a7c6c778609443", "url": "https://github.com/ldtteam/minecolonies/commit/8c1c962f1bf085059570e94720a7c6c778609443", "message": "Handles spamming of sleep notifications\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>", "committedDate": "2020-05-25T00:15:03Z", "type": "commit"}, {"oid": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034", "url": "https://github.com/ldtteam/minecolonies/commit/59f2054e6a19371b0a3b97ca71b6ab3a35a30034", "message": "Merge branch 'version/1.15' into feature/sleep_notifications", "committedDate": "2020-05-25T17:33:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzNzQ4NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430037485", "bodyText": "This is actually more then needed. We have already a way to check on the sleep handler if a citizen is sleeping. So you only need to check this, no need for additional variables.", "author": "Raycoms", "createdAt": "2020-05-25T18:10:29Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -548,4 +550,31 @@ public ICitizenData getRandomCitizen()\n     {\n         return (ICitizenData) citizens.values().toArray()[random.nextInt(citizens.values().size())];\n     }\n+\n+    @Override\n+    public void updateCitizenSleep(final boolean sleep)\n+    {\n+        this.isCitizensSleeping = sleep;\n+    }\n+\n+    @Override\n+    public void onCitizenSleep()\n+    {\n+\n+\n+        for (final ICitizenData citizenData : citizens.values())", "originalCommit": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzOTE2Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430039166", "bodyText": "this.isCitizensSleeping is used to mark that all citizens are sleeping, not just a particular citizen.", "author": "PowerSchill", "createdAt": "2020-05-25T18:17:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzNzQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzOTczNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430039737", "bodyText": "I mean, that is not necessary. You can just, when a citizen lies down, check if all other citizen are sleeping already. And if so, print the message.", "author": "Raycoms", "createdAt": "2020-05-25T18:19:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzNzQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0MjkwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430042900", "bodyText": "Oh, I remember now. The citizen, for some reason, calls trySleep multiple times even after they sleep which lead to several notifications being triggered. This was my way to reset the notifications until the next day.", "author": "PowerSchill", "createdAt": "2020-05-25T18:34:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzNzQ4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0NDM1MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430244350", "bodyText": "Then there seems to be code missing in the PR, does this compile?", "author": "Raycoms", "createdAt": "2020-05-26T08:32:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDAzNzQ4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA0MDA2Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430040066", "bodyText": "getImportantMessageEntityPlayers will notify any officers even when not inside the colony, e.g. your friend who is officer in your colony aswell. Think you want to use the nonimportant ones", "author": "someaddons", "createdAt": "2020-05-25T18:21:17Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -548,4 +550,31 @@ public ICitizenData getRandomCitizen()\n     {\n         return (ICitizenData) citizens.values().toArray()[random.nextInt(citizens.values().size())];\n     }\n+\n+    @Override\n+    public void updateCitizenSleep(final boolean sleep)\n+    {\n+        this.isCitizensSleeping = sleep;\n+    }\n+\n+    @Override\n+    public void onCitizenSleep()\n+    {\n+\n+\n+        for (final ICitizenData citizenData : citizens.values())\n+        {\n+            if (!(citizenData.isAsleep() || citizenData.getJob() instanceof AbstractJobGuard))\n+            {\n+                return;\n+            }\n+        }\n+\n+        if (!this.isCitizensSleeping)\n+        {\n+            LanguageHandler.sendPlayersMessage(colony.getImportantMessageEntityPlayers(), ALL_CITIZENS_ARE_SLEEPING);", "originalCommit": "59f2054e6a19371b0a3b97ca71b6ab3a35a30034", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "546afd3e4c9f81fc1f9ca21bbcc71bfcb8a404be", "url": "https://github.com/ldtteam/minecolonies/commit/546afd3e4c9f81fc1f9ca21bbcc71bfcb8a404be", "message": "Updates notification targets for sleep message\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>", "committedDate": "2020-05-25T18:36:08Z", "type": "commit"}, {"oid": "d3f04ebcf6644588599e19bbc9cfe6ff08eda808", "url": "https://github.com/ldtteam/minecolonies/commit/d3f04ebcf6644588599e19bbc9cfe6ff08eda808", "message": "Merge branch 'version/1.15' into feature/sleep_notifications", "committedDate": "2020-05-26T08:32:14Z", "type": "commit"}, {"oid": "9d07c400561d7f31a603326a82217e5e36e01a4b", "url": "https://github.com/ldtteam/minecolonies/commit/9d07c400561d7f31a603326a82217e5e36e01a4b", "message": "Adds missing field\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>", "committedDate": "2020-05-26T09:59:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI5ODI2NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r430298265", "bodyText": "areCitizensSleeping then", "author": "Raycoms", "createdAt": "2020-05-26T10:02:03Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -82,6 +84,11 @@\n      */\n     private Random random = new Random();\n \n+    /**\n+     * Whether all citizens excluding guards are sleeping\n+     */\n+    private boolean isCitizensSleeping;\n+", "originalCommit": "9d07c400561d7f31a603326a82217e5e36e01a4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA3MjQyMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r432072423", "bodyText": "Still this here =D", "author": "Raycoms", "createdAt": "2020-05-28T19:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI5ODI2NQ=="}], "type": "inlineReview"}, {"oid": "66557cef921d55a8f1a21414d99ce903452e2f0b", "url": "https://github.com/ldtteam/minecolonies/commit/66557cef921d55a8f1a21414d99ce903452e2f0b", "message": "Merge branch 'version/1.15' into feature/sleep_notifications", "committedDate": "2020-05-28T19:31:41Z", "type": "commit"}, {"oid": "2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85", "url": "https://github.com/ldtteam/minecolonies/commit/2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85", "message": "Renames sleeping parameter", "committedDate": "2020-05-28T19:44:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjA4MDA5Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5070#discussion_r432080093", "bodyText": "Just this 2 lines of whitespace here and then we can merge it =D", "author": "Raycoms", "createdAt": "2020-05-28T19:48:01Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/CitizenManager.java", "diffHunk": "@@ -548,4 +554,31 @@ public ICitizenData getRandomCitizen()\n     {\n         return (ICitizenData) citizens.values().toArray()[random.nextInt(citizens.values().size())];\n     }\n+\n+    @Override\n+    public void updateCitizenSleep(final boolean sleep)\n+    {\n+        this.areCitizensSleeping = sleep;\n+    }\n+\n+    @Override\n+    public void onCitizenSleep()\n+    {\n+", "originalCommit": "2ad771d974e0ea42b5f9ee0cf7bd03d57900ef85", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e6b1c2b5e2aec992ba73fde14efb8f40adaa1823", "url": "https://github.com/ldtteam/minecolonies/commit/e6b1c2b5e2aec992ba73fde14efb8f40adaa1823", "message": "Cleans up whitespace\n\nSigned-off-by: Mark E. Schill <Mark.Schill@cmschill.net>", "committedDate": "2020-05-28T19:50:22Z", "type": "commit"}]}