{"pr_number": 5581, "pr_title": "Add notification for Recipe Improvement", "pr_createdAt": "2020-08-14T23:35:14Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5581", "timeline": [{"oid": "2cb3d4d6dd31f0a1ab2dd1e5272419dfe6acb660", "url": "https://github.com/ldtteam/minecolonies/commit/2cb3d4d6dd31f0a1ab2dd1e5272419dfe6acb660", "message": "Add notification for recipeimprovement", "committedDate": "2020-08-14T23:29:23Z", "type": "commit"}, {"oid": "8310160f9cf29b6658add433bd3c58b0b9ab3917", "url": "https://github.com/ldtteam/minecolonies/commit/8310160f9cf29b6658add433bd3c58b0b9ab3917", "message": "Update src/main/resources/assets/minecolonies/lang/en_us.json\n\nCo-authored-by: ravenbuilder934 <sabrinajamie@outlook.com>", "committedDate": "2020-08-15T16:26:58Z", "type": "commit"}, {"oid": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483", "url": "https://github.com/ldtteam/minecolonies/commit/7ec288f5b28f8a4f525b572ebc7601ea67c6c483", "message": "Update src/main/resources/assets/minecolonies/lang/en_us.json\n\nCo-authored-by: ravenbuilder934 <sabrinajamie@outlook.com>", "committedDate": "2020-08-15T16:27:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471092691", "bodyText": "pretty sure we had a LanguageHandler function to send it to all players, should check that out", "author": "someaddons", "createdAt": "2020-08-16T10:05:20Z", "path": "src/main/java/com/minecolonies/coremod/colony/buildings/AbstractBuildingWorker.java", "diffHunk": "@@ -343,6 +347,16 @@ public void improveRecipe(IRecipeStorage recipe, int count, ICitizenData citizen\n                     Blocks.AIR);\n \n                 replaceRecipe(recipe.getToken(), IColonyManager.getInstance().getRecipeManager().checkOrAddRecipe(storage));\n+\n+                // Expected parameters for RECIPE_IMPROVED are Job, Result, Ingredient, Citizen\n+                for(PlayerEntity player :colony.getMessagePlayerEntities())", "originalCommit": "7ec288f5b28f8a4f525b572ebc7601ea67c6c483", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyNTkxNA==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471125914", "bodyText": "I did, and it didn't work with the replacements correctly. I looked at the source for it in Structurize, and it looks overly complicated. We probably need to review a bunch of our LanguageHandler stuff, and look at where it makes sense to use MessageFormatter rather than String.format.", "author": "Mekle001", "createdAt": "2020-08-16T15:28:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyODM3MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471128370", "bodyText": "There should be two versions, one uses string.format, second is the big thing for weird formatting used back in old minecolonies and left for compatibility reasons (tho ray is still using it and I still hadn't got how it works)", "author": "Nightenom", "createdAt": "2020-08-16T15:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEyODUyMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471128521", "bodyText": "also you definitely should reuse the message instead of creating it every time", "author": "Nightenom", "createdAt": "2020-08-16T15:54:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMDQxNA==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471130414", "bodyText": "You should be able to give the Languagehandler version the TranslateableTextComponent", "author": "Raycoms", "createdAt": "2020-08-16T16:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMzAxMA==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471133010", "bodyText": "Only one of the functions in LanguageHandler.java takes a player collection, sendPlayersMessage. That's the one that creates a chat component and didn't work correctly.\nsendMessageToPlayer sends to an individual player, by creating a stringTextComponent wrapped around a translateKeyWithFormat, which is a simple string.Format on the resulting key.\nNothing in LanguageHandler takes a ITextComponent as it's only parameter.\nI think what I'm doing here is actually the most correct way to accomplish this (except the message reuse, which I'll fix).  If I use any of the current methods of LanguageHandler, I'm implicitly recreating the message every time anyway.", "author": "Mekle001", "createdAt": "2020-08-16T16:41:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTEzMzc3Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/5581#discussion_r471133777", "bodyText": "To be clear: I believe we need to add this functionality (in several methods) to LanguageHandler, and I will start on that change, once I figure out appropriate naming that doesn't create a prototype that conflicts with what is already there.", "author": "Mekle001", "createdAt": "2020-08-16T16:49:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTA5MjY5MQ=="}], "type": "inlineReview"}, {"oid": "84b05698418179f8f0851a182bafdff35ff019f7", "url": "https://github.com/ldtteam/minecolonies/commit/84b05698418179f8f0851a182bafdff35ff019f7", "message": "Create the message only once", "committedDate": "2020-08-16T16:44:26Z", "type": "commit"}, {"oid": "843848f6dc706012bdd32bb5a016be8056a56c0f", "url": "https://github.com/ldtteam/minecolonies/commit/843848f6dc706012bdd32bb5a016be8056a56c0f", "message": "Formatting", "committedDate": "2020-08-16T17:13:21Z", "type": "commit"}]}