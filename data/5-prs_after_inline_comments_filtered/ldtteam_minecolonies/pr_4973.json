{"pr_number": 4973, "pr_title": "Allow buildings to opt-out from deliveryman", "pr_createdAt": "2020-05-11T23:33:58Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4973", "timeline": [{"oid": "be22c3c182b406ae757b99cff2b89f628758a25a", "url": "https://github.com/ldtteam/minecolonies/commit/be22c3c182b406ae757b99cff2b89f628758a25a", "message": "Roadfixed a possible index-out-of-bound exception in the building manager's getRandomBuilding.", "committedDate": "2020-05-11T18:34:30Z", "type": "commit"}, {"oid": "c23c9e699023bdc335786b63755a4c9ab6fd4492", "url": "https://github.com/ldtteam/minecolonies/commit/c23c9e699023bdc335786b63755a4c9ab6fd4492", "message": "Added opt-out from deliveryman gathering", "committedDate": "2020-05-11T22:56:18Z", "type": "commit"}, {"oid": "3a62d597f05d390d104c1dbc7bce419729bf81b6", "url": "https://github.com/ldtteam/minecolonies/commit/3a62d597f05d390d104c1dbc7bce419729bf81b6", "message": "Added PickUpPriorityState's toString() method, and formatted code. Also removed an unnecessary logger call.", "committedDate": "2020-05-11T23:16:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc0NTI1NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4973#discussion_r423745255", "bodyText": "Why do we need the int representation, can't we pick the ordinal?", "author": "Raycoms", "createdAt": "2020-05-12T13:45:29Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/PickUpPriorityState.java", "diffHunk": "@@ -0,0 +1,69 @@\n+package com.minecolonies.api.colony.buildings;\n+\n+public enum PickUpPriorityState\n+{\n+    NEVER(0),\n+    STATIC(1),\n+    AUTOMATIC(2);\n+\n+    /**\n+     * The internal serializable int-representation of this enum.\n+     * We could use Java's ordinal(), but that is VERY error-prone.\n+     * So, do our own instead.\n+     */\n+    private final int intRepresentation;\n+\n+    PickUpPriorityState(final int intRepresentation)\n+    {\n+        this.intRepresentation = intRepresentation;\n+    }\n+\n+    /**\n+     * The integer representation for this enum. Used for message serialization.\n+     *\n+     * @return The integer representation\n+     */\n+    public int getIntRepresentation()\n+    {\n+        return intRepresentation;\n+    }\n+\n+    /**\n+     * Creates the enum from an int. Used for message deserialization.\n+     * This is not DRY, but we're talking about 3 to maybe later 4 values here.\n+     *\n+     * @param intRepresentation The internal representation of the enum.\n+     * @return The corresponding enum.\n+     */\n+    public static PickUpPriorityState fromIntRepresentation(int intRepresentation)", "originalCommit": "3a62d597f05d390d104c1dbc7bce419729bf81b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgwODgzNw==", "url": "https://github.com/ldtteam/minecolonies/pull/4973#discussion_r423808837", "bodyText": "Because Java's ordinals are not meant to be used for such scenarios.\nThere's a couple of reasons for this, see https://stackoverflow.com/a/44654410.", "author": "JiaYow", "createdAt": "2020-05-12T15:05:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc0NTI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgxNzEwMw==", "url": "https://github.com/ldtteam/minecolonies/pull/4973#discussion_r423817103", "bodyText": "Yeah, it definitely would lead to backwards compatibility problems if you insert values inbetween. Due to laziness all of our enums use the ordenal for persistency.\nI wonder if it is possible to abstract this a bit so that it could be used anywhere basically (so that we can avoid adding this boilerplate to all our enums).", "author": "Raycoms", "createdAt": "2020-05-12T15:16:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc0NTI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgyNTcxNw==", "url": "https://github.com/ldtteam/minecolonies/pull/4973#discussion_r423825717", "bodyText": "Backwards compatibility isn't even my main concern. This is.\nA pointer to the enum will return 0, not the value you would expect. This will undoubtedly cause a bug along the way.\nAs for boilerplate, there might be a way by using enum types inheritance and/or generic shenanigans. However, I feel this is slightly out of the scope of this PR^^", "author": "JiaYow", "createdAt": "2020-05-12T15:27:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc0NTI1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzgyODU3Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/4973#discussion_r423828572", "bodyText": "Sounds okay, although, whoever will create an enum next, will have to extract this to avoid copying the code just over.", "author": "Raycoms", "createdAt": "2020-05-12T15:31:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzc0NTI1NQ=="}], "type": "inlineReview"}, {"oid": "377e0c143315d0a23ab0eb15cfed8e90286062dd", "url": "https://github.com/ldtteam/minecolonies/commit/377e0c143315d0a23ab0eb15cfed8e90286062dd", "message": "Merge branch 'up/version/1.15' into feature/prevent-pickup\n\nConflicts:\n\tsrc/main/java/com/minecolonies/coremod/client/gui/AbstractWindowWorkerBuilding.java", "committedDate": "2020-05-12T18:35:21Z", "type": "commit"}]}