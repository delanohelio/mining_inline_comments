{"pr_number": 6207, "pr_title": "Fix/archer pos", "pr_createdAt": "2020-12-06T17:07:45Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/6207", "timeline": [{"oid": "af55596bbb5875fb4cfe36c782104ea7fad01f36", "url": "https://github.com/ldtteam/minecolonies/commit/af55596bbb5875fb4cfe36c782104ea7fad01f36", "message": "fix 6186 + 6177", "committedDate": "2020-12-06T14:52:24Z", "type": "commit"}, {"oid": "66f7c8db3f61e1b346108438262cbfa6d4b389ef", "url": "https://github.com/ldtteam/minecolonies/commit/66f7c8db3f61e1b346108438262cbfa6d4b389ef", "message": "Improved archer positioning", "committedDate": "2020-12-06T17:07:11Z", "type": "commit"}, {"oid": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86", "url": "https://github.com/ldtteam/minecolonies/commit/4eb576cc4f91a4c5a86c9471ff748933d39cbc86", "message": "fix #6179", "committedDate": "2020-12-06T17:15:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA==", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537084724", "bodyText": "what is this supposed to do?", "author": "someaddons", "createdAt": "2020-12-06T17:23:45Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/guard/EntityAIRanger.java", "diffHunk": "@@ -553,21 +553,33 @@ private double getAimHeight()\n     @Override\n     public void moveInAttackPosition()\n     {\n-        if (buildingGuards.getTask() == GuardTask.GUARD)\n-        {\n-            ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker, target, world, buildingGuards.getGuardPos(), 20),\n-              null,\n-              getCombatMovementSpeed());\n-            return;\n-        }\n+        ((MinecoloniesAdvancedPathNavigate) worker.getNavigator()).setPathJob(new PathJobCanSee(worker,\n+            target,\n+            world,\n+            buildingGuards.getGuardPos(), shouldStayCloseToPos()\n+             ? 20 : 40),\n+          null,\n+          getCombatMovementSpeed());\n+    }\n \n-        worker.getNavigator()\n-          .tryMoveToBlockPos(worker.getPosition().offset(BlockPosUtil.getXZFacing(target.getPosition(), worker.getPosition()).getOpposite(), 8), getCombatMovementSpeed());\n+    /**\n+     * If the guard should stick close to the guard/patroll pos.\n+     * @return true if so.\n+     */\n+    private boolean shouldStayCloseToPos()\n+    {\n+        return buildingGuards.getTask() == GuardTask.GUARD || (buildingGuards.getTask() == GuardTask.PATROL && buildingGuards.shallPatrolManually());\n     }\n \n     @Override\n     public void guardMovement()\n     {\n+        if (worker.getRandom().nextInt(3) < 1)\n+        {\n+            worker.isWorkerAtSiteWithMove(buildingGuards.getGuardPos(), 3);", "originalCommit": "4eb576cc4f91a4c5a86c9471ff748933d39cbc86", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NTQwMA==", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537085400", "bodyText": "Atm, there is a problem that the archer, stays a very long time, far away from the actual guarding spot. This should balance out that regularly the archer returns to the initial guarding spot and then from there walk a little bit again.", "author": "Raycoms", "createdAt": "2020-12-06T17:27:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NjEyOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/6207#discussion_r537086129", "bodyText": "ok", "author": "someaddons", "createdAt": "2020-12-06T17:31:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzA4NDcyNA=="}], "type": "inlineReview"}]}