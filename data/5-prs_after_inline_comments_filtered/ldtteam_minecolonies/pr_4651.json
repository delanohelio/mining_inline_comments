{"pr_number": 4651, "pr_title": "Happiness", "pr_createdAt": "2020-04-16T18:44:39Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4651", "timeline": [{"oid": "70ef7bc9154455bebc1227b4e3ee7c3d1a6d1c56", "url": "https://github.com/ldtteam/minecolonies/commit/70ef7bc9154455bebc1227b4e3ee7c3d1a6d1c56", "message": "fix #4624", "committedDate": "2020-04-15T11:34:56Z", "type": "commit"}, {"oid": "3df4e7176ec6be83f8a2ab5052300103d029ea39", "url": "https://github.com/ldtteam/minecolonies/commit/3df4e7176ec6be83f8a2ab5052300103d029ea39", "message": "fix #4638", "committedDate": "2020-04-15T12:25:40Z", "type": "commit"}, {"oid": "8e20ae209f39e904d1ca1c6338447b5ce95370c0", "url": "https://github.com/ldtteam/minecolonies/commit/8e20ae209f39e904d1ca1c6338447b5ce95370c0", "message": "Add research conclude messages", "committedDate": "2020-04-15T13:29:03Z", "type": "commit"}, {"oid": "9b1144cd790e5d446bc97f8f840b6cd168ece1ac", "url": "https://github.com/ldtteam/minecolonies/commit/9b1144cd790e5d446bc97f8f840b6cd168ece1ac", "message": "hotfix #4643", "committedDate": "2020-04-15T20:38:30Z", "type": "commit"}, {"oid": "ad53a0c3af3fdd3a9956417be30351b97f095b41", "url": "https://github.com/ldtteam/minecolonies/commit/ad53a0c3af3fdd3a9956417be30351b97f095b41", "message": "Initital setup of new happiness setting.", "committedDate": "2020-04-15T20:39:12Z", "type": "commit"}, {"oid": "fcca76790e1e58e211a6195a7e5c073fbc1a5417", "url": "https://github.com/ldtteam/minecolonies/commit/fcca76790e1e58e211a6195a7e5c073fbc1a5417", "message": "Happiness rework", "committedDate": "2020-04-16T18:40:28Z", "type": "commit"}, {"oid": "ffbea1e1f3a266953cf798707e196de8318994d8", "url": "https://github.com/ldtteam/minecolonies/commit/ffbea1e1f3a266953cf798707e196de8318994d8", "message": "Merge remote-tracking branch 'origin/version/1.15' into happiness", "committedDate": "2020-04-16T18:41:24Z", "type": "commit"}, {"oid": "09c5cbcaccfab710450713075e55a772ae3aa179", "url": "https://github.com/ldtteam/minecolonies/commit/09c5cbcaccfab710450713075e55a772ae3aa179", "message": "increase importance", "committedDate": "2020-04-16T18:56:30Z", "type": "commit"}, {"oid": "47c1ee5fcc13c68efff97f2767b706ccc30e9ca5", "url": "https://github.com/ldtteam/minecolonies/commit/47c1ee5fcc13c68efff97f2767b706ccc30e9ca5", "message": "add constants", "committedDate": "2020-04-17T08:04:37Z", "type": "commit"}, {"oid": "e7add57428d515ab1af9a3c461dcc09cafe8a555", "url": "https://github.com/ldtteam/minecolonies/commit/e7add57428d515ab1af9a3c461dcc09cafe8a555", "message": "fix #4653", "committedDate": "2020-04-17T08:09:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA2OTUyNA==", "url": "https://github.com/ldtteam/minecolonies/pull/4651#discussion_r410069524", "bodyText": "you could flip this comparison, as that makes it way easier to read", "author": "reggaemuffin", "createdAt": "2020-04-17T08:24:21Z", "path": "src/api/java/com/minecolonies/api/entity/citizen/happiness/ExpirationBasedHappinessModifier.java", "diffHunk": "@@ -0,0 +1,112 @@\n+package com.minecolonies.api.entity.citizen.happiness;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+\n+import java.util.function.DoubleSupplier;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_DAY;\n+\n+/**\n+ * The time based happiness modifier.\n+ */\n+public class ExpirationBasedHappinessModifier extends StaticHappinessModifier\n+{\n+    /**\n+     * The number of passed days.\n+     */\n+    private int days = 0;\n+\n+    /**\n+     * Period of time this modifier applies.\n+     */\n+    private final int period;\n+\n+    /**\n+     * If this should give a penalty if not active.\n+     */\n+    private boolean inverted;\n+\n+    /**\n+     * Create an instance of the happiness modifier.\n+     *\n+     * @param id     its string id.\n+     * @param weight its weight.\n+     * @param period the period.\n+     */\n+    public ExpirationBasedHappinessModifier(final String id, final double weight, final DoubleSupplier supplier, final int period)\n+    {\n+        super(id, weight, supplier);\n+        this.period = period;\n+    }\n+\n+    /**\n+     * Create an instance of the happiness modifier.\n+     *\n+     * @param id     its string id.\n+     * @param weight its weight.\n+     * @param period the period.\n+     * @param inverted if inverted.\n+     */\n+    public ExpirationBasedHappinessModifier(final String id, final double weight, final DoubleSupplier supplier, final int period, final boolean inverted)\n+    {\n+        this(id, weight, supplier, period);\n+        this.inverted = inverted;\n+    }\n+\n+    @Override\n+    public double getFactor()\n+    {\n+        if (inverted)\n+        {\n+            if (days > 0)\n+            {\n+                return 1;\n+            }\n+            return super.getFactor();\n+        }\n+        else\n+        {\n+            if (days > 0)", "originalCommit": "e7add57428d515ab1af9a3c461dcc09cafe8a555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA3MDY1MQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4651#discussion_r410070651", "bodyText": "Can you crite some documentation on what inverted means? I can roughly understand it from the code, but the use case is unclear and should be documented, so that people using this method know what they are changing with this", "author": "reggaemuffin", "createdAt": "2020-04-17T08:26:24Z", "path": "src/api/java/com/minecolonies/api/entity/citizen/happiness/ExpirationBasedHappinessModifier.java", "diffHunk": "@@ -0,0 +1,112 @@\n+package com.minecolonies.api.entity.citizen.happiness;\n+\n+import net.minecraft.nbt.CompoundNBT;\n+\n+import java.util.function.DoubleSupplier;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_DAY;\n+\n+/**\n+ * The time based happiness modifier.\n+ */\n+public class ExpirationBasedHappinessModifier extends StaticHappinessModifier\n+{\n+    /**\n+     * The number of passed days.\n+     */\n+    private int days = 0;\n+\n+    /**\n+     * Period of time this modifier applies.\n+     */\n+    private final int period;\n+\n+    /**\n+     * If this should give a penalty if not active.\n+     */\n+    private boolean inverted;\n+\n+    /**\n+     * Create an instance of the happiness modifier.\n+     *\n+     * @param id     its string id.\n+     * @param weight its weight.\n+     * @param period the period.\n+     */\n+    public ExpirationBasedHappinessModifier(final String id, final double weight, final DoubleSupplier supplier, final int period)\n+    {\n+        super(id, weight, supplier);\n+        this.period = period;\n+    }\n+\n+    /**\n+     * Create an instance of the happiness modifier.\n+     *\n+     * @param id     its string id.\n+     * @param weight its weight.\n+     * @param period the period.\n+     * @param inverted if inverted.", "originalCommit": "e7add57428d515ab1af9a3c461dcc09cafe8a555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDA3MTg3Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/4651#discussion_r410071876", "bodyText": "missing javadoc, as supplier and timebasedfactor are both undocumented and actually important parts for understanding this", "author": "reggaemuffin", "createdAt": "2020-04-17T08:28:33Z", "path": "src/api/java/com/minecolonies/api/entity/citizen/happiness/TimeBasedHappinessModifier.java", "diffHunk": "@@ -0,0 +1,95 @@\n+package com.minecolonies.api.entity.citizen.happiness;\n+\n+import com.minecolonies.api.util.Tuple;\n+import net.minecraft.nbt.CompoundNBT;\n+\n+import java.util.function.DoubleSupplier;\n+\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_DAY;\n+\n+/**\n+ * The time based happiness modifier.\n+ */\n+public class TimeBasedHappinessModifier extends StaticHappinessModifier\n+{\n+    /**\n+     * The time based factors.\n+     */\n+    private final Tuple<Integer, Double>[] timeBasedFactor;\n+\n+    /**\n+     * The number of passed days.\n+     */\n+    private int days = 0;\n+\n+    /**\n+     * Create an instance of the happiness modifier.\n+     *\n+     * @param id     its string id.\n+     * @param weight its weight.", "originalCommit": "e7add57428d515ab1af9a3c461dcc09cafe8a555", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}