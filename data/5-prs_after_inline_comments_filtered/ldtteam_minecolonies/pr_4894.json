{"pr_number": 4894, "pr_title": "Tavern", "pr_createdAt": "2020-05-05T14:54:18Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/4894", "timeline": [{"oid": "c024336000388233b1525eb468910e5237201ac6", "url": "https://github.com/ldtteam/minecolonies/commit/c024336000388233b1525eb468910e5237201ac6", "message": "Tavern building/blocks", "committedDate": "2020-05-05T13:53:12Z", "type": "commit"}, {"oid": "705dd86dc83d67d1c6408906c23bc0a5edf86f31", "url": "https://github.com/ldtteam/minecolonies/commit/705dd86dc83d67d1c6408906c23bc0a5edf86f31", "message": "Tavern building/event", "committedDate": "2020-05-07T10:34:50Z", "type": "commit"}, {"oid": "9491f1c881831bc5cb9ca41b71f3a29e8355befd", "url": "https://github.com/ldtteam/minecolonies/commit/9491f1c881831bc5cb9ca41b71f3a29e8355befd", "message": "tavern", "committedDate": "2020-05-07T20:58:20Z", "type": "commit"}, {"oid": "dccbffde42af0a91ee09a4a249de81c2425cc6f9", "url": "https://github.com/ldtteam/minecolonies/commit/dccbffde42af0a91ee09a4a249de81c2425cc6f9", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into Tavern\n\n# Conflicts:\n#\tsrc/api/java/com/minecolonies/api/blocks/ModBlocks.java\n#\tsrc/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBlocksInitializer.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java\n#\tsrc/main/java/com/minecolonies/coremod/entity/citizen/citizenhandlers/CitizenChatHandler.java", "committedDate": "2020-05-08T08:26:11Z", "type": "commit"}, {"oid": "ae30324f584a926af9bb62c1d14bc070d46bdf22", "url": "https://github.com/ldtteam/minecolonies/commit/ae30324f584a926af9bb62c1d14bc070d46bdf22", "message": "tavern sound added", "committedDate": "2020-05-09T16:53:01Z", "type": "commit"}, {"oid": "f63c57d7a95a81c6fe4730fd40c38a5e32c074a7", "url": "https://github.com/ldtteam/minecolonies/commit/f63c57d7a95a81c6fe4730fd40c38a5e32c074a7", "message": "tavern sounds/progress added", "committedDate": "2020-05-09T19:32:58Z", "type": "commit"}, {"oid": "b898e35994b43451758e23b67e4fc21309859377", "url": "https://github.com/ldtteam/minecolonies/commit/b898e35994b43451758e23b67e4fc21309859377", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into Tavern\n\n# Conflicts:\n#\tsrc/api/java/com/minecolonies/api/blocks/ModBlocks.java\n#\tsrc/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBlocksInitializer.java\n#\tsrc/main/java/com/minecolonies/apiimp/initializer/ModBuildingsInitializer.java", "committedDate": "2020-05-09T19:35:25Z", "type": "commit"}, {"oid": "02a0b800a635b08b913b7399efc9250b25296aa1", "url": "https://github.com/ldtteam/minecolonies/commit/02a0b800a635b08b913b7399efc9250b25296aa1", "message": "fix guard npe", "committedDate": "2020-05-09T19:59:17Z", "type": "commit"}, {"oid": "36a3405ab75e3d2bb31dca079efc44e021df66d6", "url": "https://github.com/ldtteam/minecolonies/commit/36a3405ab75e3d2bb31dca079efc44e021df66d6", "message": "javadoc", "committedDate": "2020-05-09T20:24:36Z", "type": "commit"}, {"oid": "9418a9ac66c36f4178e996857b39fbf9147d12d7", "url": "https://github.com/ldtteam/minecolonies/commit/9418a9ac66c36f4178e996857b39fbf9147d12d7", "message": "credits and invalidate cache", "committedDate": "2020-05-10T07:12:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYwNzU0Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r422607546", "bodyText": "this formatting looks wrong now =D", "author": "Raycoms", "createdAt": "2020-05-10T08:14:39Z", "path": "src/api/java/com/minecolonies/api/colony/buildings/ModBuildings.java", "diffHunk": "@@ -86,6 +87,7 @@\n     public static       BuildingEntry dyer;\n     public static       BuildingEntry fletcher;\n     public static       BuildingEntry mechanic;\n+    public static BuildingEntry tavern;", "originalCommit": "9418a9ac66c36f4178e996857b39fbf9147d12d7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NDgzOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423654839", "bodyText": "Yes please rerun the formatter.", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:17:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYwNzU0Ng=="}], "type": "inlineReview"}, {"oid": "b22cf061446cdb8cc23aad399cb917adcbd50971", "url": "https://github.com/ldtteam/minecolonies/commit/b22cf061446cdb8cc23aad399cb917adcbd50971", "message": "fix network messages merge regressions", "committedDate": "2020-05-10T14:27:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NDI2Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423654266", "bodyText": "It is either an IForgeRegistry<CitizenDataTypeRegirtryEntry> or the method should be called getCitizenDataRegistry()", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:16:38Z", "path": "src/api/java/com/minecolonies/api/IMinecoloniesAPI.java", "diffHunk": "@@ -59,4 +60,6 @@ static IMinecoloniesAPI getInstance() {\n     IGlobalResearchTree getGlobalResearchTree();\n \n     IForgeRegistry<ColonyEventTypeRegistryEntry> getColonyEventRegistry();\n+\n+    IForgeRegistry<CitizenDataRegistryEntry> getCitizenDataTypeRegistry();", "originalCommit": "b22cf061446cdb8cc23aad399cb917adcbd50971", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NDU2Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423654567", "bodyText": "See interface declaration on naming issues.", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:17:13Z", "path": "src/api/java/com/minecolonies/api/MinecoloniesAPIProxy.java", "diffHunk": "@@ -140,4 +141,10 @@ public IGlobalResearchTree getGlobalResearchTree()\n     {\n         return apiInstance.getColonyEventRegistry();\n     }\n+\n+    @Override\n+    public IForgeRegistry<CitizenDataRegistryEntry> getCitizenDataTypeRegistry()", "originalCommit": "b22cf061446cdb8cc23aad399cb917adcbd50971", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NTczNA==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423655734", "bodyText": "If I see this correctly, this would allow for a custom ICitizenData implementation to be used.\nI do not think this is a good idea.\nA better approach to solve this problem would be to make ICitizenData an ICapabilityProvider and via this way allow the handling and adaptation of custom data on a given citizen.", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:19:26Z", "path": "src/api/java/com/minecolonies/api/colony/citizen/CitizenDataRegistryEntry.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package com.minecolonies.api.colony.citizen;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.util.Log;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraftforge.registries.ForgeRegistryEntry;\n+import net.minecraftforge.registries.IForgeRegistryEntry;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.function.BiFunction;\n+\n+/**\n+ * Registry entry for citizen data types, matches a resource location id to a creation function.\n+ */\n+public class CitizenDataRegistryEntry extends ForgeRegistryEntry<CitizenDataRegistryEntry> implements IForgeRegistryEntry<CitizenDataRegistryEntry>", "originalCommit": "b22cf061446cdb8cc23aad399cb917adcbd50971", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NjgzNg==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423656836", "bodyText": "Since i also see no real reason why this is part of this PR, it should be split of into a seperate one.", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:21:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwNTg0Ng==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423705846", "bodyText": "Additionally I see no reason for it to exist at all..... So there is that, but i might be missing something.", "author": "OrionDevelopment", "createdAt": "2020-05-12T12:49:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NTczNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzk4OTI1Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423989252", "bodyText": "The idea for this was to have a central place for varying external citizen entities, which can be traders/visitor citizens/guards whatever and still get the sync benefit colonyviews serialization/deserialization.", "author": "someaddons", "createdAt": "2020-05-12T19:44:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1NTczNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1Nzk2NA==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423657964", "bodyText": "Your warning references the wrong class name: Should be: ModCitizenDataTypeInitializer?", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:23:45Z", "path": "src/main/java/com/minecolonies/apiimp/initializer/ModCitizenDataTypeInitializer.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package com.minecolonies.apiimp.initializer;\n+\n+import com.minecolonies.api.colony.citizen.CitizenDataRegistryEntry;\n+import com.minecolonies.coremod.colony.CitizenData;\n+import net.minecraftforge.event.RegistryEvent;\n+import net.minecraftforge.registries.IForgeRegistry;\n+\n+/**\n+ * Initializer for citizen data registry entries\n+ */\n+public class ModCitizenDataTypeInitializer\n+{\n+    private ModCitizenDataTypeInitializer()\n+    {\n+        throw new IllegalStateException(\"Tried to initialize: CitizenDataInitializer but this is a Utility class.\");", "originalCommit": "b22cf061446cdb8cc23aad399cb917adcbd50971", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY1OTUxNA==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423659514", "bodyText": "Remove this class from this PR.\nAs stated it is not needed, can be added later again, but for now please do not mix feature and infrastructure or bugfixes in one PR but split them in several.\nMixing the goals of a PR makes things harder.", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:26:41Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/ColonyRecruitableCitizenEvent.java", "diffHunk": "@@ -0,0 +1,226 @@\n+package com.minecolonies.coremod.colony.colonyEvents;\n+\n+import com.minecolonies.api.colony.ICitizenData;\n+import com.minecolonies.api.colony.IColony;\n+import com.minecolonies.api.colony.colonyEvents.EventStatus;\n+import com.minecolonies.api.colony.colonyEvents.IColonyEntitySpawnEvent;\n+import com.minecolonies.api.util.BlockPosUtil;\n+import com.minecolonies.coremod.colony.CitizenData;\n+import net.minecraft.entity.Entity;\n+import net.minecraft.entity.LivingEntity;\n+import net.minecraft.nbt.CompoundNBT;\n+import net.minecraft.nbt.INBT;\n+import net.minecraft.nbt.ListNBT;\n+import net.minecraft.util.ResourceLocation;\n+import net.minecraft.util.math.BlockPos;\n+import org.jetbrains.annotations.NotNull;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static com.minecolonies.api.colony.colonyEvents.NBTTags.*;\n+import static com.minecolonies.api.util.constant.Constants.MOD_ID;\n+import static com.minecolonies.api.util.constant.Constants.TAG_COMPOUND;\n+import static com.minecolonies.api.util.constant.NbtTagConstants.TAG_CITIZENS;\n+\n+/**\n+ * TODO: unused for now, implement soon\n+ * Event for recruitable citizens spawning in the tavern\n+ */\n+public class ColonyRecruitableCitizenEvent implements IColonyEntitySpawnEvent", "originalCommit": "b22cf061446cdb8cc23aad399cb917adcbd50971", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2MTM2Nw==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423661367", "bodyText": "This needs to be way more dynamic.\nI already told ray this.\nPlease find a way to make this more fluently useable.\nInstead of doing a bunch of if switches design a registry or even a better placement logic system todo this.", "author": "OrionDevelopment", "createdAt": "2020-05-12T11:30:14Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/BuildingManager.java", "diffHunk": "@@ -612,4 +619,43 @@ private void addField(@NotNull final BlockPos pos)\n         }\n         colony.markDirty();\n     }\n+\n+    @Override\n+    public boolean canPlaceAt(final Block block, final BlockPos pos, final PlayerEntity player)\n+    {\n+        if (block instanceof BlockHutWareHouse)", "originalCommit": "b22cf061446cdb8cc23aad399cb917adcbd50971", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY4ODQ0NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423688445", "bodyText": "I think this would be too out of scope of this PR, I here just move the existing logic a bit", "author": "someaddons", "createdAt": "2020-05-12T12:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2MTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwMTIwNQ==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423701205", "bodyText": "There are a lot of things in this PR that are completely out of scope...... Hence this PR needs to be broken up into several pieces.", "author": "OrionDevelopment", "createdAt": "2020-05-12T12:42:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2MTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwMjY2MA==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423702660", "bodyText": "I wouldnt label 1 and an unused thing as a lot of things xD", "author": "someaddons", "createdAt": "2020-05-12T12:44:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2MTM2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzcwNTI4NA==", "url": "https://github.com/ldtteam/minecolonies/pull/4894#discussion_r423705284", "bodyText": "1 and an unused thing is still 2 more then should be in this PR.", "author": "OrionDevelopment", "createdAt": "2020-05-12T12:48:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY2MTM2Nw=="}], "type": "inlineReview"}, {"oid": "fec6d9e0c49561d3ccd30e8557bb57e42318016b", "url": "https://github.com/ldtteam/minecolonies/commit/fec6d9e0c49561d3ccd30e8557bb57e42318016b", "message": "Removing citizen data registry and unused event", "committedDate": "2020-05-12T18:58:34Z", "type": "commit"}, {"oid": "71c95a38030ec21b5de6ab9e77ef6f344866683c", "url": "https://github.com/ldtteam/minecolonies/commit/71c95a38030ec21b5de6ab9e77ef6f344866683c", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into Tavern", "committedDate": "2020-05-12T18:59:42Z", "type": "commit"}]}