{"pr_number": 5688, "pr_title": "Make the miner less likely to get stuck", "pr_createdAt": "2020-08-31T13:48:19Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5688", "timeline": [{"oid": "84a71e44a4514a6e9b66cdb9f7625177855baedb", "url": "https://github.com/ldtteam/minecolonies/commit/84a71e44a4514a6e9b66cdb9f7625177855baedb", "message": "Make getActiveNode stable", "committedDate": "2020-08-31T13:45:27Z", "type": "commit"}, {"oid": "58ecd1485c1f2bd5636bf957e56f32f61d7767f9", "url": "https://github.com/ldtteam/minecolonies/commit/58ecd1485c1f2bd5636bf957e56f32f61d7767f9", "message": "Add rotation tracking, with validations", "committedDate": "2020-08-31T13:45:27Z", "type": "commit"}, {"oid": "101d751ec158c64dfea81501a4aca3331a5a036b", "url": "https://github.com/ldtteam/minecolonies/commit/101d751ec158c64dfea81501a4aca3331a5a036b", "message": "Make node picking less random on new levels", "committedDate": "2020-08-31T13:45:28Z", "type": "commit"}, {"oid": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "url": "https://github.com/ldtteam/minecolonies/commit/8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "message": "Default to undefined node style", "committedDate": "2020-08-31T15:01:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODY5OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480408699", "bodyText": "constant please", "author": "Raycoms", "createdAt": "2020-08-31T21:27:45Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Level.java", "diffHunk": "@@ -194,7 +195,7 @@ public Level(@NotNull final CompoundNBT compound)\n     public Node getRandomNode(@Nullable final Node node)\n     {\n         Node nextNode = null;\n-        if (node != null && rand.nextInt(RANDOM_TYPES) > 0)\n+        if (node != null && getNumberOfBuiltNodes() > 10 && rand.nextInt(RANDOM_TYPES) > 0)", "originalCommit": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODg1MA==", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480408850", "bodyText": "I'd say .error -> Please tell the mod authors about this.", "author": "Raycoms", "createdAt": "2020-08-31T21:28:04Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Level.java", "diffHunk": "@@ -230,6 +231,9 @@ public void closeNextNode(final int rotation, final Node node)\n                 nodeCenterList.add(getNextNodePositionFromNodeWithRotation(tempNode, rotation, ROTATE_ONCE));\n                 nodeCenterList.add(getNextNodePositionFromNodeWithRotation(tempNode, rotation, ROTATE_THREE_TIMES));\n                 break;\n+            case UNDEFINED:\n+                Log.getLogger().warn(\"Node: \" + node.getX() + \":\" + node.getZ() +\" style undefined, not creating children\");", "originalCommit": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwODkyNA==", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480408924", "bodyText": "same here potentially", "author": "Raycoms", "createdAt": "2020-08-31T21:28:17Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Level.java", "diffHunk": "@@ -245,8 +249,14 @@ public void closeNextNode(final int rotation, final Node node)\n             nodes.put(pos, tempNodeToAdd);\n             openNodes.add(tempNodeToAdd);\n         }\n-        nodes.get(new Vec2i(tempNode.getX(), tempNode.getZ())).setStatus(Node.NodeStatus.COMPLETED);\n+        Node I = nodes.get(new Vec2i(tempNode.getX(), tempNode.getZ()));\n+        if(!tempNode.equals(I))\n+        {\n+            Log.getLogger().warn(\"Nodes not equal during close\");", "originalCommit": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTA1NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480409055", "bodyText": "wrong logger", "author": "Raycoms", "createdAt": "2020-08-31T21:28:33Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Node.java", "diffHunk": "@@ -127,9 +139,18 @@ public static Node createFromNBT(@NotNull final CompoundNBT compound)\n \n         //Set the node status in all directions.\n         @NotNull final Node node = new Node(x, z, parent);\n+        if(style == NodeType.UNDEFINED)\n+        {\n+            com.ldtteam.blockout.Log.getLogger().warn(\"Node \" + x + \",\" + z + \" has an undefined style\");", "originalCommit": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDQwOTEwOQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5688#discussion_r480409109", "bodyText": "javadoc", "author": "Raycoms", "createdAt": "2020-08-31T21:28:40Z", "path": "src/main/java/com/minecolonies/coremod/entity/ai/citizen/miner/Node.java", "diffHunk": "@@ -367,6 +393,18 @@ public int hashCode()\n         //Crossroad structure\n         CROSSROAD,\n         //Bending tunnle\n-        BEND\n+        BEND,\n+        //New node, undefined\n+        UNDEFINED\n+    }\n+\n+    public Optional<Integer> getRot()\n+    {\n+        return rot;\n+    }\n+\n+    public void setRot(int rot)", "originalCommit": "8f4efa1435d9f611ff6ac3e8ac0eb1c486a6101a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f43ab36fb4d1921a0ee80abecdace5ab6a8145e0", "url": "https://github.com/ldtteam/minecolonies/commit/f43ab36fb4d1921a0ee80abecdace5ab6a8145e0", "message": "Review Feedback", "committedDate": "2020-08-31T22:08:25Z", "type": "commit"}, {"oid": "f0b1ce52f65d5bfaaa6980e3913d40e9082021f2", "url": "https://github.com/ldtteam/minecolonies/commit/f0b1ce52f65d5bfaaa6980e3913d40e9082021f2", "message": "Merge branch 'version/1.15' into miner/stableworkingnode", "committedDate": "2020-09-01T15:12:47Z", "type": "commit"}, {"oid": "185242554ef257aef258da28f7d3b39061cd7185", "url": "https://github.com/ldtteam/minecolonies/commit/185242554ef257aef258da28f7d3b39061cd7185", "message": "Small optimization", "committedDate": "2020-09-01T15:34:43Z", "type": "commit"}, {"oid": "a17a68f577ff966ada2a0fe5928828aeb8c5ea84", "url": "https://github.com/ldtteam/minecolonies/commit/a17a68f577ff966ada2a0fe5928828aeb8c5ea84", "message": "Merge branch 'version/1.15' into miner/stableworkingnode", "committedDate": "2020-09-01T16:13:53Z", "type": "commit"}]}