{"pr_number": 5756, "pr_title": "Raid biome chance and some fixes", "pr_createdAt": "2020-09-10T08:55:10Z", "pr_url": "https://github.com/ldtteam/minecolonies/pull/5756", "timeline": [{"oid": "c60473d6be69414837243818b4f3c4ab126f4f82", "url": "https://github.com/ldtteam/minecolonies/commit/c60473d6be69414837243818b4f3c4ab126f4f82", "message": "Add chance to spawn raiders in any biome\nFix possible crash on world load\nAdjust EntityLocation to saving the obj ref instead of multiple get", "committedDate": "2020-09-10T08:54:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NzE1Mg==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486177152", "bodyText": "what, a public static constant without javadoc?", "author": "Raycoms", "createdAt": "2020-09-10T08:56:37Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/norsemenevent/NorsemenShipRaidEvent.java", "diffHunk": "@@ -25,6 +25,8 @@\n      */\n     public static final ResourceLocation NORSEMEN_RAID_EVENT_TYPE_ID = new ResourceLocation(Constants.MOD_ID, \"norsemen_ship_raid\");\n \n+    public static final String SHIP_NAME = \"norsemen_ship\";", "originalCommit": "c60473d6be69414837243818b4f3c4ab126f4f82", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NzUwNw==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486177507", "bodyText": "Old I think?", "author": "Raycoms", "createdAt": "2020-09-10T08:57:14Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/RaidManager.java", "diffHunk": "@@ -145,6 +152,8 @@\n      */\n     private int lostCitizens = 0;\n \n+    private static final HashMap<BiomeDictionary.Type, List<Consumer<IColony>>> raidBiomeMap = new HashMap<>();\n+", "originalCommit": "c60473d6be69414837243818b4f3c4ab126f4f82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3ODgyMw==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486178823", "bodyText": "ye", "author": "someaddons", "createdAt": "2020-09-10T08:59:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3NzUwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3ODI0Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486178243", "bodyText": "but this way the egyptian raid is slighly more likely than the other ones. Can't we do a rand.nextInt(100) and then if numb == 1, egyptian, if numb == 2 then amazon, (or even a small range)", "author": "Raycoms", "createdAt": "2020-09-10T08:58:26Z", "path": "src/main/java/com/minecolonies/coremod/colony/managers/RaidManager.java", "diffHunk": "@@ -284,15 +297,15 @@ else if (ShipBasedRaiderUtils.canSpawnShipAt(colony, targetSpawnPoint, amount, s\n             {\n                 final String biomePath = colony.getWorld().getBiome(targetSpawnPoint).getRegistryName().getPath();\n                 final HordeRaidEvent event;\n-                if (biomePath.contains(DESERT_BIOME_ID))\n+                if (biomePath.contains(DESERT_BIOME_ID) || rand.nextInt(100) < IGNORE_BIOME_CHANCE)", "originalCommit": "c60473d6be69414837243818b4f3c4ab126f4f82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3OTI3NA==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486179274", "bodyText": "hm in any case the egyptian would be rolled first", "author": "someaddons", "createdAt": "2020-09-10T08:59:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3ODI0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3OTcwMg==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486179702", "bodyText": "but ye we could make it one roll", "author": "someaddons", "createdAt": "2020-09-10T09:00:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3ODI0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE4MDgyMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486180821", "bodyText": "yeah but if egyptian is 1 or 2, amazon is 3 or 4 next is 5 or 6 then the chance is equal", "author": "Raycoms", "createdAt": "2020-09-10T09:02:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3ODI0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE4MzQ3NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486183475", "bodyText": "check now^^", "author": "someaddons", "createdAt": "2020-09-10T09:06:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE3ODI0Mw=="}], "type": "inlineReview"}, {"oid": "05f835bab230c73345fe1e5247c40f205e4c6d78", "url": "https://github.com/ldtteam/minecolonies/commit/05f835bab230c73345fe1e5247c40f205e4c6d78", "message": "cleanup", "committedDate": "2020-09-10T08:58:39Z", "type": "commit"}, {"oid": "cf6f88e90616c4b7782d514099db171a86cefce6", "url": "https://github.com/ldtteam/minecolonies/commit/cf6f88e90616c4b7782d514099db171a86cefce6", "message": "Merge remote-tracking branch 'remotes/origin/version/1.15' into nextchanges", "committedDate": "2020-09-10T09:05:37Z", "type": "commit"}, {"oid": "d47fea37b67141bb0dc72e9d8a4f8be46132775b", "url": "https://github.com/ldtteam/minecolonies/commit/d47fea37b67141bb0dc72e9d8a4f8be46132775b", "message": "one roll and ranges", "committedDate": "2020-09-10T09:05:58Z", "type": "commit"}, {"oid": "0cef278f26c97f8d364264abb043da4ed2782f9b", "url": "https://github.com/ldtteam/minecolonies/commit/0cef278f26c97f8d364264abb043da4ed2782f9b", "message": "fix typo", "committedDate": "2020-09-10T09:18:53Z", "type": "commit"}, {"oid": "84024c69e16cca446b4482993b629bbb7c9191e4", "url": "https://github.com/ldtteam/minecolonies/commit/84024c69e16cca446b4482993b629bbb7c9191e4", "message": "fix typo", "committedDate": "2020-09-10T09:21:15Z", "type": "commit"}, {"oid": "c004b08be581c587c8c4b9878eab66d7d7ade9da", "url": "https://github.com/ldtteam/minecolonies/commit/c004b08be581c587c8c4b9878eab66d7d7ade9da", "message": "fix raidmanager not writing", "committedDate": "2020-09-10T10:50:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwMDcxMQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486600711", "bodyText": "Rename the field to be more accurate.", "author": "OrionDevelopment", "createdAt": "2020-09-10T20:01:41Z", "path": "src/main/java/com/minecolonies/coremod/colony/colonyEvents/raidEvents/pirateEvent/ShipBasedRaiderUtils.java", "diffHunk": "@@ -128,15 +127,15 @@ public static void setupSpawner(final BlockPos location, final World world, fina\n      * @param rotation   the rotation.\n      * @return true if successful.\n      */\n-    public static boolean canSpawnShipAt(final IColony colony, final BlockPos spawnPoint, final int raidLevel, final int rotation, final IColonyStructureSpawnEvent event)\n+    public static boolean canSpawnShipAt(final IColony colony, final BlockPos spawnPoint, final int raidLevel, final int rotation, final String shipName)\n     {\n         if (spawnPoint.equals(colony.getCenter()) || spawnPoint.getY() > MineColonies.getConfig().getCommon().maxYForBarbarians.get())\n         {\n             return false;\n         }\n \n         final World world = colony.getWorld();\n-        final String shipSize = ShipSize.getShipForRaiderAmount(raidLevel).schematicPrefix + event.getShipDesc();\n+        final String shipSize = ShipSize.getShipForRaiderAmount(raidLevel).schematicPrefix + shipName;", "originalCommit": "c004b08be581c587c8c4b9878eab66d7d7ade9da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwMTY4OQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486601689", "bodyText": "This really does not matter at all..........\nNo change needed, just wanted to inform you that the HotSpot VM does this automatically, and as such these optimisations are not needed.\nNext time PRs with arbitrary changes like this will get rejected.", "author": "OrionDevelopment", "createdAt": "2020-09-10T20:03:37Z", "path": "src/main/java/com/minecolonies/coremod/colony/requestsystem/locations/EntityLocation.java", "diffHunk": "@@ -70,13 +69,14 @@ private void checkEntity()\n     public BlockPos getInDimensionLocation()\n     {\n         checkEntity();\n-        if (entity == null || entity.get() == null)\n+        final Entity entityRef = entity.get();", "originalCommit": "c004b08be581c587c8c4b9878eab66d7d7ade9da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwODQ2NQ==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486608465", "bodyText": "ah the JVM already does that, good to know", "author": "someaddons", "createdAt": "2020-09-10T20:17:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwMTY4OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYxMDQ1Mw==", "url": "https://github.com/ldtteam/minecolonies/pull/5756#discussion_r486610453", "bodyText": "This is a WeakReference - which has special semantics - you need to store the contained reference in a local variable or another field otherwise the GC can come and clear the WeakReference at any time. So calling get() twice in this case can result in different outcomes.", "author": "MatthiasMann", "createdAt": "2020-09-10T20:21:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjYwMTY4OQ=="}], "type": "inlineReview"}]}