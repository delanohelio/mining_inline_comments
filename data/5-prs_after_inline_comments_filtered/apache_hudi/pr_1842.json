{"pr_number": 1842, "pr_title": "[HUDI-1037]Introduce a write committed callback hook", "pr_createdAt": "2020-07-17T10:37:50Z", "pr_url": "https://github.com/apache/hudi/pull/1842", "timeline": [{"oid": "e0e24be2406f277c4b3aee3236638827a3290ce2", "url": "https://github.com/apache/hudi/commit/e0e24be2406f277c4b3aee3236638827a3290ce2", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-17T15:23:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMwOTIxMQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457309211", "bodyText": "keep consistent with callback_on above,  so writeCommitCallbackOn?", "author": "leesf", "createdAt": "2020-07-20T11:46:41Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteConfig.java", "diffHunk": "@@ -632,6 +632,33 @@ public FileSystemViewStorageConfig getClientSpecifiedViewStorageConfig() {\n     return clientSpecifiedViewStorageConfig;\n   }\n \n+  /**\n+   * Commit call back configs.\n+   */\n+  public boolean enableWriteCommitCallback() {", "originalCommit": "e0e24be2406f277c4b3aee3236638827a3290ce2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MDIwOQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457470209", "bodyText": "keep consistent with callback_on above, so writeCommitCallbackOn?\n\ndone", "author": "wangxianghu", "createdAt": "2020-07-20T15:02:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMwOTIxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMwOTQ0OQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457309449", "bodyText": "no need use String.valueOf here", "author": "leesf", "createdAt": "2020-07-20T11:47:08Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteCommitCallbackConfig.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.config;\n+\n+import org.apache.hudi.callback.common.HoodieCommitCallbackType;\n+import org.apache.hudi.common.config.DefaultHoodieConfig;\n+\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+/**\n+ * Write callback related config.\n+ */\n+public class HoodieWriteCommitCallbackConfig extends DefaultHoodieConfig {\n+\n+  public static final String CALLBACK_ON = \"hoodie.write.commit.callback.on\";\n+  public static final boolean DEFAULT_CALLBACK_ON = false;\n+\n+  public static final String CALLBACK_TYPE_PROP = \"hoodie.write.commit.callback.type\";\n+  public static final String DEFAULT_CALLBACK_TYPE_PROP = HoodieCommitCallbackType.HTTP.name();\n+\n+  public static final String CALLBACK_CLASS_PROP = \"hoodie.write.commit.callback.class\";\n+  public static final String DEFAULT_CALLBACK_CLASS_PROP = \"\";\n+\n+  // ***** REST callback configs *****\n+  public static final String CALLBACK_HTTP_URL_PROP = \"hoodie.write.commit.callback.http.url\";\n+  public static final String CALLBACK_API_KEY = \"hoodie.write.commit.callback.http.api.key\";\n+  public static final String DEFAULT_CALLBACK_API_KEY = \"hudi_write_commit_callback\";\n+  public static final String CALLBACK_TIMEOUT_SECONDS = \"hoodie.write.commit.callback.rest.timeout.seconds\";\n+  public static final String DEFAULT_CALLBACK_TIMEOUT_SECONDS = \"3\";\n+\n+  private HoodieWriteCommitCallbackConfig(Properties props) {\n+    super(props);\n+  }\n+\n+  public static HoodieWriteCommitCallbackConfig.Builder newBuilder() {\n+    return new HoodieWriteCommitCallbackConfig.Builder();\n+  }\n+\n+  public static class Builder {\n+\n+    private final Properties props = new Properties();\n+\n+    public HoodieWriteCommitCallbackConfig.Builder fromFile(File propertiesFile) throws IOException {\n+      try (FileReader reader = new FileReader(propertiesFile)) {\n+        this.props.load(reader);\n+        return this;\n+      }\n+    }\n+\n+    public HoodieWriteCommitCallbackConfig.Builder fromProperties(Properties props) {\n+      this.props.putAll(props);\n+      return this;\n+    }\n+\n+    public HoodieWriteCommitCallbackConfig.Builder writeCommitCallbackOn(String callbackOn) {\n+      props.setProperty(CALLBACK_ON, String.valueOf(callbackOn));", "originalCommit": "e0e24be2406f277c4b3aee3236638827a3290ce2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MDM2OA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457470368", "bodyText": "no need use String.valueOf here\n\ndone", "author": "wangxianghu", "createdAt": "2020-07-20T15:02:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMwOTQ0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMTk1NA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457311954", "bodyText": "should we move these methods into HoodieHttpWriteCommitCallback.java, I am worry about the explode of other callback methods in HoodieWriteConfig", "author": "leesf", "createdAt": "2020-07-20T11:50:50Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteConfig.java", "diffHunk": "@@ -632,6 +632,33 @@ public FileSystemViewStorageConfig getClientSpecifiedViewStorageConfig() {\n     return clientSpecifiedViewStorageConfig;\n   }\n \n+  /**\n+   * Commit call back configs.\n+   */\n+  public boolean enableWriteCommitCallback() {\n+    return Boolean.parseBoolean(props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_ON));\n+  }\n+\n+  public String getCallbackType() {\n+    return props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_TYPE_PROP);\n+  }\n+\n+  public String getCallbackClass() {\n+    return props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_CLASS_PROP);\n+  }\n+\n+  public String getCallbackRestUrl() {\n+    return props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_HTTP_URL_PROP);\n+  }\n+\n+  public int getCallbackRestTimeout() {\n+    return Integer.parseInt(props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_TIMEOUT_SECONDS));\n+  }\n+\n+  public String getCallbackRestApiKey() {\n+    return props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_API_KEY);\n+  }", "originalCommit": "e0e24be2406f277c4b3aee3236638827a3290ce2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MDUzNg==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457470536", "bodyText": "should we move these methods into HoodieHttpWriteCommitCallback.java, I am worry about the explode of other callback methods in HoodieWriteConfig\n\ndone", "author": "wangxianghu", "createdAt": "2020-07-20T15:03:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMTk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMjM2MQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457312361", "bodyText": "extra line", "author": "leesf", "createdAt": "2020-07-20T11:51:27Z", "path": "hudi-client/src/main/java/org/apache/hudi/exception/HoodieCommitCallbackException.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.exception;\n+\n+import org.apache.hudi.callback.HoodieWriteCommitCallback;\n+\n+/**\n+ * Exception thrown for any higher level errors when {@link HoodieWriteCommitCallback} is executing a callback.\n+ */\n+public class HoodieCommitCallbackException extends HoodieException {\n+\n+  public HoodieCommitCallbackException(String msg, Throwable e) {\n+    super(msg, e);\n+  }\n+\n+  public HoodieCommitCallbackException(String msg) {\n+    super(msg);\n+  }\n+", "originalCommit": "e0e24be2406f277c4b3aee3236638827a3290ce2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ3MDcxMA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457470710", "bodyText": "extra line\n\ndone", "author": "wangxianghu", "createdAt": "2020-07-20T15:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzMxMjM2MQ=="}], "type": "inlineReview"}, {"oid": "ae1253ec713af8272d997fb958cd55717efb63a7", "url": "https://github.com/apache/hudi/commit/ae1253ec713af8272d997fb958cd55717efb63a7", "message": "rename and relocate some methods", "committedDate": "2020-07-20T13:01:46Z", "type": "forcePushed"}, {"oid": "617cf632d8d16116c222b085a64696a590655aa4", "url": "https://github.com/apache/hudi/commit/617cf632d8d16116c222b085a64696a590655aa4", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-20T15:01:00Z", "type": "forcePushed"}, {"oid": "db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "url": "https://github.com/apache/hudi/commit/db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-20T15:28:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2OTQyMQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457769421", "bodyText": "Can we provide both commit instant and table name?", "author": "yanghua", "createdAt": "2020-07-21T00:42:19Z", "path": "hudi-client/src/main/java/org/apache/hudi/callback/HoodieWriteCommitCallback.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback;\n+\n+/**\n+ * A callback interface help to call back when a write commit completes successfully.\n+ */\n+public interface HoodieWriteCommitCallback {\n+\n+  /**\n+   * A callback method the user can implement to provide asynchronous handling of successful write.\n+   * This method will be called when a write operation is committed successfully.\n+   *\n+   * @param commitTime commitTime which is successfully committed\n+   */\n+  void call(String commitTime);", "originalCommit": "db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2OTkzNA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457769934", "bodyText": "If we provide the  table name as a parameter in HoodieWriteCommitCallback#call(...), then this class is not necessary, IMO.", "author": "yanghua", "createdAt": "2020-07-21T00:44:05Z", "path": "hudi-client/src/main/java/org/apache/hudi/callback/common/HoodieBaseCommitCallbackMessage.java", "diffHunk": "@@ -0,0 +1,67 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback.common;\n+\n+import java.io.Serializable;\n+\n+/**\n+ * Base callback message, which contains commitTime and tableName only for now.\n+ */\n+public class HoodieBaseCommitCallbackMessage implements Serializable {", "originalCommit": "db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzg4Njg1MQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457886851", "bodyText": "If we provide the table name as a parameter in HoodieWriteCommitCallback#call(...), then this class is not necessary, IMO.\n\nYes, that would be more concise, but it maybe a little inconvenient to expand as more params may be needed in the future, WDYT?", "author": "wangxianghu", "createdAt": "2020-07-21T07:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc2OTkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MTI3OQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457771279", "bodyText": "We may need to consider making these hard codes configurable.", "author": "yanghua", "createdAt": "2020-07-21T00:49:07Z", "path": "hudi-client/src/main/java/org/apache/hudi/callback/client/http/HoodieWriteCallbackHttpClient.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback.client.http;\n+\n+import org.apache.http.HttpHeaders;\n+import org.apache.http.client.config.RequestConfig;\n+import org.apache.http.client.methods.CloseableHttpResponse;\n+import org.apache.http.client.methods.HttpPost;\n+import org.apache.http.entity.ContentType;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.CloseableHttpClient;\n+import org.apache.http.impl.client.HttpClientBuilder;\n+import org.apache.hudi.config.HoodieWriteCommitCallbackConfig;\n+import org.apache.hudi.config.HoodieWriteConfig;\n+import org.apache.log4j.LogManager;\n+import org.apache.log4j.Logger;\n+\n+import java.io.Closeable;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+/**\n+ * Write commit callback http client.\n+ */\n+public class HoodieWriteCallbackHttpClient implements Closeable {\n+\n+  private static final Logger LOG = LogManager.getLogger(HoodieWriteCallbackHttpClient.class);\n+\n+  public static final String HEADER_KEY_API_KEY = \"HUDI-CALLBACK-KEY\";\n+\n+  private final String apiKey;\n+  private final String url;\n+  private final CloseableHttpClient client;\n+  private Properties props;\n+\n+  public HoodieWriteCallbackHttpClient(HoodieWriteConfig config) {\n+    this.props = config.getProps();\n+    this.apiKey = getApiKey();\n+    this.url = getUrl();\n+    this.client = getClient();\n+  }\n+\n+  public HoodieWriteCallbackHttpClient(String apiKey, String url, CloseableHttpClient client) {\n+    this.apiKey = apiKey;\n+    this.url = url;\n+    this.client = client;\n+  }\n+\n+  public void send(String callbackMsg) {\n+    HttpPost request = new HttpPost(url);\n+    request.setHeader(HEADER_KEY_API_KEY, apiKey);\n+    request.setHeader(HttpHeaders.CONTENT_TYPE, ContentType.APPLICATION_JSON.toString());\n+    request.setEntity(new StringEntity(callbackMsg, ContentType.APPLICATION_JSON));\n+    try (CloseableHttpResponse response = client.execute(request)) {\n+      int statusCode = response.getStatusLine().getStatusCode();\n+      if (statusCode >= 300) {\n+        LOG.warn(String.format(\"Failed to send callback message. Response was %s\", response));\n+      } else {\n+        LOG.info(String.format(\"Sent Callback data %s to %s successfully !\", callbackMsg, url));\n+      }\n+    } catch (IOException e) {\n+      LOG.warn(\"Failed to send callback.\", e);\n+    }\n+  }\n+\n+  private String getApiKey() {\n+    return props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_HTTP_API_KEY);\n+  }\n+\n+  private String getUrl() {\n+    return props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_HTTP_URL_PROP);\n+  }\n+\n+  private CloseableHttpClient getClient() {\n+    Integer timeoutSeconds = getHttpTimeoutSeconds();\n+    return HttpClientBuilder.create()\n+        .setDefaultRequestConfig(RequestConfig.custom()\n+            .setConnectTimeout(timeoutSeconds * 1000)", "originalCommit": "db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MTg4Nw==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457771887", "bodyText": "Is HoodieWriteCommitHttpCallback more reasonable?", "author": "yanghua", "createdAt": "2020-07-21T00:51:13Z", "path": "hudi-client/src/main/java/org/apache/hudi/callback/impl/HoodieHttpWriteCommitCallback.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback.impl;\n+\n+import org.apache.hudi.callback.HoodieWriteCommitCallback;\n+import org.apache.hudi.callback.client.http.HoodieWriteCallbackHttpClient;\n+import org.apache.hudi.callback.common.HoodieBaseCommitCallbackMessage;\n+import org.apache.hudi.config.HoodieWriteConfig;\n+import org.apache.hudi.exception.HoodieCommitCallbackException;\n+import org.apache.log4j.LogManager;\n+import org.apache.log4j.Logger;\n+import org.codehaus.jackson.map.ObjectMapper;\n+\n+import java.io.IOException;\n+\n+/**\n+ * A http implementation of {@link HoodieWriteCommitCallback}.\n+ */\n+public class HoodieHttpWriteCommitCallback implements HoodieWriteCommitCallback {", "originalCommit": "db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3ODgzNg==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457778836", "bodyText": "Is HoodieWriteCommitHttpCallback more reasonable?\n\nYes, looks better", "author": "wangxianghu", "createdAt": "2020-07-21T01:16:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MTg4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MzE4Mw==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r457773183", "bodyText": "IMO, this property is not necessary. We can only depend on getCallbackClass  to specify the detailed implementation. This is a simple SPI mode.  Otherwise, it causes two entry points in the factory you implemented. WDYT?", "author": "yanghua", "createdAt": "2020-07-21T00:56:15Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteConfig.java", "diffHunk": "@@ -632,6 +632,21 @@ public FileSystemViewStorageConfig getClientSpecifiedViewStorageConfig() {\n     return clientSpecifiedViewStorageConfig;\n   }\n \n+  /**\n+   * Commit call back configs.\n+   */\n+  public boolean writeCommitCallbackOn() {\n+    return Boolean.parseBoolean(props.getProperty(HoodieWriteCommitCallbackConfig.CALLBACK_ON));\n+  }\n+\n+  public String getCallbackType() {", "originalCommit": "db65a1ef99dd62f27862a6d7fa0989bab8c5e902", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODA2MDIzNA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458060234", "bodyText": "IMO, this property is not necessary. We can only depend on getCallbackClass  to specify the detailed implementation. This is a simple SPI mode. Otherwise, it causes two entry points in the factory you implemented. WDYT?\n\ndone", "author": "wangxianghu", "createdAt": "2020-07-21T12:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Nzc3MzE4Mw=="}], "type": "inlineReview"}, {"oid": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "url": "https://github.com/apache/hudi/commit/0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "message": "remove callback type", "committedDate": "2020-07-21T12:36:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MjMzMA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458482330", "bodyText": "This naming is strange. IMHO, does CALLBACK_SWITCH or CALLBACK_FEATURE or CALLBACK_FUNCTION look better?", "author": "yanghua", "createdAt": "2020-07-22T01:35:09Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteCommitCallbackConfig.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.config;\n+\n+import org.apache.hudi.common.config.DefaultHoodieConfig;\n+\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+/**\n+ * Write callback related config.\n+ */\n+public class HoodieWriteCommitCallbackConfig extends DefaultHoodieConfig {\n+\n+  public static final String CALLBACK_ON = \"hoodie.write.commit.callback.on\";\n+  public static final boolean DEFAULT_CALLBACK_ON = false;", "originalCommit": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MjU2NQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458482565", "bodyText": "CALLBACK_CLASS?", "author": "yanghua", "createdAt": "2020-07-22T01:35:54Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteCommitCallbackConfig.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.config;\n+\n+import org.apache.hudi.common.config.DefaultHoodieConfig;\n+\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+/**\n+ * Write callback related config.\n+ */\n+public class HoodieWriteCommitCallbackConfig extends DefaultHoodieConfig {\n+\n+  public static final String CALLBACK_ON = \"hoodie.write.commit.callback.on\";\n+  public static final boolean DEFAULT_CALLBACK_ON = false;\n+\n+  public static final String CALLBACK_CLASS_PROP = \"hoodie.write.commit.callback.class\";", "originalCommit": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MjYwNQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458482605", "bodyText": "DEFAULT_CALLBACK_CLASS?", "author": "yanghua", "createdAt": "2020-07-22T01:36:07Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteCommitCallbackConfig.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.config;\n+\n+import org.apache.hudi.common.config.DefaultHoodieConfig;\n+\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+/**\n+ * Write callback related config.\n+ */\n+public class HoodieWriteCommitCallbackConfig extends DefaultHoodieConfig {\n+\n+  public static final String CALLBACK_ON = \"hoodie.write.commit.callback.on\";\n+  public static final boolean DEFAULT_CALLBACK_ON = false;\n+\n+  public static final String CALLBACK_CLASS_PROP = \"hoodie.write.commit.callback.class\";\n+  public static final String DEFAULT_CALLBACK_CLASS_PROP = \"org.apache.hudi.callback.impl.HoodieWriteCommitHttpCallback\";", "originalCommit": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1MjQzNQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458552435", "bodyText": "DEFAULT_CALLBACK_CLASS?\n\nHi, @yanghua thanks for your detailed review.\nall these variables are named referring to existing variables, keeping the same naming style would be better :)", "author": "wangxianghu", "createdAt": "2020-07-22T05:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MjYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3MzAzNw==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458873037", "bodyText": "Ok, sounds good.", "author": "yanghua", "createdAt": "2020-07-22T15:19:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MjYwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MzIzNQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458483235", "bodyText": "int?", "author": "yanghua", "createdAt": "2020-07-22T01:38:37Z", "path": "hudi-client/src/main/java/org/apache/hudi/config/HoodieWriteCommitCallbackConfig.java", "diffHunk": "@@ -0,0 +1,106 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.config;\n+\n+import org.apache.hudi.common.config.DefaultHoodieConfig;\n+\n+import java.io.File;\n+import java.io.FileReader;\n+import java.io.IOException;\n+import java.util.Properties;\n+\n+/**\n+ * Write callback related config.\n+ */\n+public class HoodieWriteCommitCallbackConfig extends DefaultHoodieConfig {\n+\n+  public static final String CALLBACK_ON = \"hoodie.write.commit.callback.on\";\n+  public static final boolean DEFAULT_CALLBACK_ON = false;\n+\n+  public static final String CALLBACK_CLASS_PROP = \"hoodie.write.commit.callback.class\";\n+  public static final String DEFAULT_CALLBACK_CLASS_PROP = \"org.apache.hudi.callback.impl.HoodieWriteCommitHttpCallback\";\n+\n+  // ***** REST callback configs *****\n+  public static final String CALLBACK_HTTP_URL_PROP = \"hoodie.write.commit.callback.http.url\";\n+  public static final String CALLBACK_HTTP_API_KEY = \"hoodie.write.commit.callback.http.api.key\";\n+  public static final String DEFAULT_CALLBACK_HTTP_API_KEY = \"hudi_write_commit_http_callback\";\n+  public static final String CALLBACK_HTTP_TIMEOUT_SECONDS = \"hoodie.write.commit.callback.http.timeout.seconds\";\n+  public static final String DEFAULT_CALLBACK_HTTP_TIMEOUT_SECONDS = \"3\";", "originalCommit": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1MDc5MA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458550790", "bodyText": "int?\n\nyes, better", "author": "wangxianghu", "createdAt": "2020-07-22T05:53:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4MzIzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjM3Mw==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458486373", "bodyText": "What's purpose of this class?", "author": "yanghua", "createdAt": "2020-07-22T01:50:12Z", "path": "hudi-client/src/test/java/org/apache/hudi/callback/http/TestHoodieWriteCommitHttpCallback.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback.http;\n+\n+import org.apache.hudi.callback.impl.HoodieWriteCommitHttpCallback;\n+import org.apache.hudi.testutils.HoodieWriteCommitTestHarness;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+\n+import java.io.IOException;\n+\n+import static org.junit.jupiter.api.Assertions.assertDoesNotThrow;\n+\n+/**\n+ * Unit test for {@link HoodieWriteCommitHttpCallback}.\n+ */\n+public class TestHoodieWriteCommitHttpCallback extends HoodieWriteCommitTestHarness {", "originalCommit": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1NTgyNA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458555824", "bodyText": "What's purpose of this class?\n\nits purpose is to test the Initialization process of HoodieWriteCommitHttpCallback when provided with proper params referring to this test 'org.apache.hudi.metrics.datadog.TestDatadogMetricsReporter#instantiationShouldSucceed'.\nthis test might be unnecessary\uff0cI'll remove it if you think it is unnecessary too", "author": "wangxianghu", "createdAt": "2020-07-22T06:08:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjM3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3MjYzMg==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458872632", "bodyText": "IMO, it's not necessary. We can remove it.", "author": "yanghua", "createdAt": "2020-07-22T15:18:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjM3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNzY3Nw==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458917677", "bodyText": "done", "author": "wangxianghu", "createdAt": "2020-07-22T16:22:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjM3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjU5OA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458486598", "bodyText": "ditto", "author": "yanghua", "createdAt": "2020-07-22T01:50:55Z", "path": "hudi-client/src/test/java/org/apache/hudi/testutils/HoodieWriteCommitTestHarness.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.testutils;\n+\n+import org.apache.hudi.common.testutils.HoodieCommonTestHarness;\n+import org.apache.hudi.config.HoodieWriteCommitCallbackConfig;\n+import org.apache.hudi.config.HoodieWriteConfig;\n+\n+import java.io.IOException;\n+\n+/**\n+ * The test harness for resource initialization and cleanup.\n+ */\n+public class HoodieWriteCommitTestHarness extends HoodieCommonTestHarness {", "originalCommit": "0afe21ce82f51778627f3d955f6bbb5a233f6bcb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODU1Njc1Mg==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458556752", "bodyText": "ditto\n\nThis class provides test functions for callback service, right now, it provides functions to init and teardown HoodieWriteCommitCallbackConfig and HoodieWriteConfig", "author": "wangxianghu", "createdAt": "2020-07-22T06:11:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3MjcyNQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458872725", "bodyText": "ditto", "author": "yanghua", "createdAt": "2020-07-22T15:18:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyNjcxOQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458926719", "bodyText": "done", "author": "wangxianghu", "createdAt": "2020-07-22T16:31:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODQ4NjU5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3NTA5Ng==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458875096", "bodyText": "Can we reference CALLBACK_CLASS_PROP  not hoodie.write.commit.callback.class? What's more, it's not ** Parameter**, it's a config option. Let's say e.g. The value of the config option xxx can not be ....? Does it make sense?", "author": "yanghua", "createdAt": "2020-07-22T15:21:56Z", "path": "hudi-client/src/main/java/org/apache/hudi/callback/util/HoodieCommitCallbackFactory.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback.util;\n+\n+import org.apache.hudi.callback.HoodieWriteCommitCallback;\n+import org.apache.hudi.common.util.ReflectionUtils;\n+import org.apache.hudi.common.util.StringUtils;\n+import org.apache.hudi.config.HoodieWriteConfig;\n+import org.apache.hudi.exception.HoodieCommitCallbackException;\n+\n+/**\n+ * Factory help to create {@link HoodieWriteCommitCallback}.\n+ */\n+public class HoodieCommitCallbackFactory {\n+  public static HoodieWriteCommitCallback create(HoodieWriteConfig config) {\n+    String callbackClass = config.getCallbackClass();\n+    if (!StringUtils.isNullOrEmpty(callbackClass)) {\n+      Object instance = ReflectionUtils.loadClass(callbackClass, config);\n+      if (!(instance instanceof HoodieWriteCommitCallback)) {\n+        throw new HoodieCommitCallbackException(callbackClass + \" is not a subclass of HoodieWriteCommitCallback\");\n+      }\n+      return (HoodieWriteCommitCallback) instance;\n+    } else {\n+      throw new HoodieCommitCallbackException(\"Parameter 'hoodie.write.commit.callback.class' can not be null or empty\");", "originalCommit": "9e8f6e25c1615e722d4ceca8d9c1fb2a281da749", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkyMjM1OA==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458922358", "bodyText": "done", "author": "wangxianghu", "createdAt": "2020-07-22T16:26:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3NTA5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3NjUxNQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458876515", "bodyText": "Let's use HoodieWriteCommitHttpCallback.class.getSimpleName()  to replace the hard code HoodieWriteCommitCallback ?", "author": "yanghua", "createdAt": "2020-07-22T15:23:48Z", "path": "hudi-client/src/main/java/org/apache/hudi/callback/util/HoodieCommitCallbackFactory.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License. You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.hudi.callback.util;\n+\n+import org.apache.hudi.callback.HoodieWriteCommitCallback;\n+import org.apache.hudi.common.util.ReflectionUtils;\n+import org.apache.hudi.common.util.StringUtils;\n+import org.apache.hudi.config.HoodieWriteConfig;\n+import org.apache.hudi.exception.HoodieCommitCallbackException;\n+\n+/**\n+ * Factory help to create {@link HoodieWriteCommitCallback}.\n+ */\n+public class HoodieCommitCallbackFactory {\n+  public static HoodieWriteCommitCallback create(HoodieWriteConfig config) {\n+    String callbackClass = config.getCallbackClass();\n+    if (!StringUtils.isNullOrEmpty(callbackClass)) {\n+      Object instance = ReflectionUtils.loadClass(callbackClass, config);\n+      if (!(instance instanceof HoodieWriteCommitCallback)) {\n+        throw new HoodieCommitCallbackException(callbackClass + \" is not a subclass of HoodieWriteCommitCallback\");", "originalCommit": "9e8f6e25c1615e722d4ceca8d9c1fb2a281da749", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODkxNjgwMQ==", "url": "https://github.com/apache/hudi/pull/1842#discussion_r458916801", "bodyText": "Let's use HoodieWriteCommitHttpCallback.class.getSimpleName()  to replace the hard code HoodieWriteCommitCallback ?\n\ndone", "author": "wangxianghu", "createdAt": "2020-07-22T16:21:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg3NjUxNQ=="}], "type": "inlineReview"}, {"oid": "e729c9be8ec74263a3b25856da77c17d978d05e0", "url": "https://github.com/apache/hudi/commit/e729c9be8ec74263a3b25856da77c17d978d05e0", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-22T16:20:02Z", "type": "forcePushed"}, {"oid": "656d9e770e0f3feeb2fe3985719efab12ce3f5fe", "url": "https://github.com/apache/hudi/commit/656d9e770e0f3feeb2fe3985719efab12ce3f5fe", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-22T16:26:07Z", "type": "forcePushed"}, {"oid": "b01a062012c9d17efa5ac92637302d0a3f4aaa08", "url": "https://github.com/apache/hudi/commit/b01a062012c9d17efa5ac92637302d0a3f4aaa08", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-22T16:29:32Z", "type": "commit"}, {"oid": "b01a062012c9d17efa5ac92637302d0a3f4aaa08", "url": "https://github.com/apache/hudi/commit/b01a062012c9d17efa5ac92637302d0a3f4aaa08", "message": "[HUDI-1037]Introduce a write committed callback hook", "committedDate": "2020-07-22T16:29:32Z", "type": "forcePushed"}]}