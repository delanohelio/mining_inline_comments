{"pr_number": 2157, "pr_title": "[HUDI-1330] handle prefix filtering at directory level", "pr_createdAt": "2020-10-09T12:52:25Z", "pr_url": "https://github.com/apache/hudi/pull/2157", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTgzMA==", "url": "https://github.com/apache/hudi/pull/2157#discussion_r502829830", "bodyText": "let us add java docs here?", "author": "pratyakshsharma", "createdAt": "2020-10-10T20:36:51Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/DFSPathSelector.java", "diffHunk": "@@ -119,4 +103,18 @@ public DFSPathSelector(TypedProperties props, Configuration hadoopConf) {\n       throw new HoodieIOException(\"Unable to read from source from checkpoint: \" + lastCheckpointStr, ioe);\n     }\n   }\n+\n+  private List<FileStatus> listEligibleFiles(FileSystem fs, Path path, long lastCheckpointTime) throws IOException {", "originalCommit": "14b56db5f68a078baa411fde61237b4fadc482b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzEwODM0NA==", "url": "https://github.com/apache/hudi/pull/2157#discussion_r503108344", "bodyText": "added", "author": "hotienvu", "createdAt": "2020-10-12T08:01:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTgzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMzk2Ng==", "url": "https://github.com/apache/hudi/pull/2157#discussion_r503723966", "bodyText": "what's the advantage of walking recursively by ourselves, instead of calling fs.listStatus(,true) like before?  (in the interest of keeping PR minimal and changing just the prefix filtering)", "author": "vinothchandar", "createdAt": "2020-10-13T07:26:35Z", "path": "hudi-utilities/src/main/java/org/apache/hudi/utilities/sources/helpers/DFSPathSelector.java", "diffHunk": "@@ -119,4 +103,25 @@ public DFSPathSelector(TypedProperties props, Configuration hadoopConf) {\n       throw new HoodieIOException(\"Unable to read from source from checkpoint: \" + lastCheckpointStr, ioe);\n     }\n   }\n+\n+  /**\n+   * List files recursively, filter out illegible files/directories while doing so.\n+   */\n+  private List<FileStatus> listEligibleFiles(FileSystem fs, Path path, long lastCheckpointTime) throws IOException {\n+    // skip files/dirs whose names start with (_, ., etc)\n+    FileStatus[] statuses = fs.listStatus(path, file ->", "originalCommit": "83a2e3ee3c8e969d2f41407f3a6f8d256d960269", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzc3ODAzOA==", "url": "https://github.com/apache/hudi/pull/2157#discussion_r503778038", "bodyText": "Hi Vinoth, thanks for the feedback. Unfortunately the old listFiles(,true) returns everything so we will have to check all files under the path. Also the logic will be a bit more complicated cos we will have to check for all the sub-dir along the path too e.g. foo/_bar/file.  On the other hand, walking recursively allow us to exit early as soon as the file/directory name doesn't match. This will also allow us to do more directory skipping (based on modification time) in the future.\nUnder the hood, listFiles also call listStatus recursively so performance wise there should be no impact.", "author": "hotienvu", "createdAt": "2020-10-13T08:50:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMzk2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTAxNTc3OA==", "url": "https://github.com/apache/hudi/pull/2157#discussion_r509015778", "bodyText": "makes sense. thanks for the detailed explanation!", "author": "vinothchandar", "createdAt": "2020-10-21T06:19:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzcyMzk2Ng=="}], "type": "inlineReview"}, {"oid": "68b3d65a4d8324c1f69a74b906cb2f538448f95c", "url": "https://github.com/apache/hudi/commit/68b3d65a4d8324c1f69a74b906cb2f538448f95c", "message": "handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading.", "committedDate": "2020-10-15T13:08:51Z", "type": "forcePushed"}, {"oid": "c272a6c808a5fddd920175ea2692a17db9a0f168", "url": "https://github.com/apache/hudi/commit/c272a6c808a5fddd920175ea2692a17db9a0f168", "message": "handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading.", "committedDate": "2020-10-19T13:54:42Z", "type": "forcePushed"}, {"oid": "155366df398738e0f19ee978a0c355053cbd48c3", "url": "https://github.com/apache/hudi/commit/155366df398738e0f19ee978a0c355053cbd48c3", "message": "[HUDI-1330] handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading.", "committedDate": "2020-10-20T15:16:44Z", "type": "commit"}, {"oid": "155366df398738e0f19ee978a0c355053cbd48c3", "url": "https://github.com/apache/hudi/commit/155366df398738e0f19ee978a0c355053cbd48c3", "message": "[HUDI-1330] handle prefix filtering at directory level\n\nThe current DFSPathSelector only ignore prefix(_, .) at the file level while files under subdirectories\ne.g. (.checkpoint/*) are still considered which result in bad-format exception during reading.", "committedDate": "2020-10-20T15:16:44Z", "type": "forcePushed"}]}