{"pr_number": 2093, "pr_title": "[HUDI-1200]: fixed NPE in CustomKeyGenerator", "pr_createdAt": "2020-09-16T18:19:20Z", "pr_url": "https://github.com/apache/hudi/pull/2093", "timeline": [{"oid": "99835a065c73eecacc5d42b86e564af2eac1ea00", "url": "https://github.com/apache/hudi/commit/99835a065c73eecacc5d42b86e564af2eac1ea00", "message": "[HUDI-1200]: fixed NPE in CustomKeyGenerator", "committedDate": "2020-09-16T18:16:13Z", "type": "commit"}, {"oid": "45e7ade9c76c5569a29b8e06a3bfefa374daf14d", "url": "https://github.com/apache/hudi/commit/45e7ade9c76c5569a29b8e06a3bfefa374daf14d", "message": "[HUDI-1200]: fixed build", "committedDate": "2020-09-16T20:05:55Z", "type": "commit"}, {"oid": "a7232efe9b197e07c0dbbbfdf73da7f87613be30", "url": "https://github.com/apache/hudi/commit/a7232efe9b197e07c0dbbbfdf73da7f87613be30", "message": "[HUDI-1200]: retrigger build", "committedDate": "2020-09-17T07:52:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTM1MzkzMw==", "url": "https://github.com/apache/hudi/pull/2093#discussion_r491353933", "bodyText": "Hey, Since there is a protected config field in KeyGenerator, which can be shared with all subclasses. Why do not we check that must be non-nullable?", "author": "yanghua", "createdAt": "2020-09-19T09:42:24Z", "path": "hudi-spark/src/main/java/org/apache/hudi/keygen/CustomKeyGenerator.java", "diffHunk": "@@ -58,6 +59,7 @@\n \n   public CustomKeyGenerator(TypedProperties props) {\n     super(props);\n+    this.props = props;", "originalCommit": "a7232efe9b197e07c0dbbbfdf73da7f87613be30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk0MTMyMg==", "url": "https://github.com/apache/hudi/pull/2093#discussion_r492941322", "bodyText": "+1  there is no need to duplicate this again in the sub class right.", "author": "vinothchandar", "createdAt": "2020-09-22T18:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTM1MzkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mjk3MTg0OQ==", "url": "https://github.com/apache/hudi/pull/2093#discussion_r492971849", "bodyText": "@yanghua due to serialization and config field being transient, the issue is happening. In CustomKeyGenerator, we try to initialise new object of SimpleKeyGenerator and TimestampBasedKeyGenerator using config object, that is where NPE occurs. The only good way I can think of is to introduce a TimestampBasedKeyGenerator object in CustomKeyGenerator and call getPartitionPath method using this object. Let me do the changes here.", "author": "pratyakshsharma", "createdAt": "2020-09-22T19:09:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTM1MzkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg1OTY0MQ==", "url": "https://github.com/apache/hudi/pull/2093#discussion_r498859641", "bodyText": "@pratyakshsharma : Why does config field need to be transient ?", "author": "bvaradar", "createdAt": "2020-10-02T14:32:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTM1MzkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTI3NTIxNA==", "url": "https://github.com/apache/hudi/pull/2093#discussion_r499275214", "bodyText": "@bvaradar It has been like this from the very beginning. I am not sure of the reason though. Making config field non-transient is the easiest fix possible here.", "author": "pratyakshsharma", "createdAt": "2020-10-04T18:33:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTM1MzkzMw=="}], "type": "inlineReview"}, {"oid": "0d63b550bff2967711fd0b6514d40e9b66b3ffda", "url": "https://github.com/apache/hudi/commit/0d63b550bff2967711fd0b6514d40e9b66b3ffda", "message": "[HUDI-1200]: fixed NPE in CustomKeyGenerator", "committedDate": "2020-10-04T21:35:00Z", "type": "commit"}]}