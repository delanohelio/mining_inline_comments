{"pr_number": 1707, "pr_title": "[HUDI-988] fix more unit tests flakiness", "pr_createdAt": "2020-06-06T00:49:13Z", "pr_url": "https://github.com/apache/hudi/pull/1707", "timeline": [{"oid": "54ee82408b97586beb2824ab36a3264913cb3736", "url": "https://github.com/apache/hudi/commit/54ee82408b97586beb2824ab36a3264913cb3736", "message": "[HUDI-988] Fix More Unit Test Flakiness", "committedDate": "2020-06-08T00:07:11Z", "type": "commit"}, {"oid": "54ee82408b97586beb2824ab36a3264913cb3736", "url": "https://github.com/apache/hudi/commit/54ee82408b97586beb2824ab36a3264913cb3736", "message": "[HUDI-988] Fix More Unit Test Flakiness", "committedDate": "2020-06-08T00:07:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjU1Mg==", "url": "https://github.com/apache/hudi/pull/1707#discussion_r436456552", "bodyText": "@garyli1019 : Is this one of the places where we are missing the cleanup of resources ?", "author": "bvaradar", "createdAt": "2020-06-08T04:55:41Z", "path": "hudi-client/src/test/java/org/apache/hudi/client/TestMultiFS.java", "diffHunk": "@@ -63,9 +63,7 @@ public void setUp() throws Exception {\n \n   @AfterEach\n   public void tearDown() throws Exception {\n-    cleanupSparkContexts();\n-    cleanupDFS();\n-    cleanupTestDataGenerator();\n+    cleanupResources();", "originalCommit": "54ee82408b97586beb2824ab36a3264913cb3736", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ2NzU5OA==", "url": "https://github.com/apache/hudi/pull/1707#discussion_r436467598", "bodyText": "We didn't miss one yet but it's easy to miss, so I put all the clean up in one place.\nThe leak I found was HoodieLogFileReader and HoodieWrapperFileSystem. These instances were created from different classes and difficult to clean up.\nBy setting Xmx2g is consuming less memory than Xmx4g, probably because of the more aggressive GC.", "author": "garyli1019", "createdAt": "2020-06-08T05:44:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjU1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ3NTI4MQ==", "url": "https://github.com/apache/hudi/pull/1707#discussion_r436475281", "bodyText": "@garyli1019 : Can you open a jira with information about the leak that you found in HoodieLogFileReader and HoodieWrapperFileSystem. We need to get to the top of this asap.", "author": "bvaradar", "createdAt": "2020-06-08T06:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQ1NjU1Mg=="}], "type": "inlineReview"}]}