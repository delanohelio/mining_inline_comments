{"pr_number": 882, "pr_title": "WIP: #703 -Added custom RegistryStore and builder", "pr_createdAt": "2020-02-21T20:42:31Z", "pr_url": "https://github.com/resilience4j/resilience4j/pull/882", "timeline": [{"oid": "3c94cf03e43ba94cedf9500d4f164f5ca1031abf", "url": "https://github.com/resilience4j/resilience4j/commit/3c94cf03e43ba94cedf9500d4f164f5ca1031abf", "message": "WIP: Issue#703 -Added custom Registry Store and builds for CircuitBreakerRegistry", "committedDate": "2020-02-21T20:24:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMzODIzMg==", "url": "https://github.com/resilience4j/resilience4j/pull/882#discussion_r383338232", "bodyText": "withCircuitBreakerConfigDefaults is not necessary.  If the config map is empty, the InMemoryCircuitBreakerRegistry creates a default config.", "author": "RobWin", "createdAt": "2020-02-24T15:37:14Z", "path": "resilience4j-circuitbreaker/src/main/java/io/github/resilience4j/circuitbreaker/CircuitBreakerRegistry.java", "diffHunk": "@@ -261,4 +263,60 @@ CircuitBreaker circuitBreaker(String name,\n         Supplier<CircuitBreakerConfig> circuitBreakerConfigSupplier,\n         io.vavr.collection.Map<String, String> tags);\n \n+    static Builder custom() {\n+        return new Builder();\n+    }\n+\n+    class Builder {\n+\n+        private static final String DEFAULT_CONFIG = \"default\";\n+        private RegistryStore registryStore;\n+        private Map<String, CircuitBreakerConfig> circuitBreakerConfigsMap;\n+        private List<RegistryEventConsumer<CircuitBreaker>> registryEventConsumers;\n+        private io.vavr.collection.Map<String, String> tags;\n+\n+        public Builder() {\n+            this.circuitBreakerConfigsMap = new java.util.HashMap<>();\n+            this.registryEventConsumers = new ArrayList<>();\n+        }\n+\n+        public Builder withRegistryStore(RegistryStore registryStore) {\n+            this.registryStore = registryStore;\n+            return this;\n+        }\n+\n+        public Builder withCircuitBreakerConfig(CircuitBreakerConfig circuitBreakerConfig) {\n+            circuitBreakerConfigsMap.put(DEFAULT_CONFIG, circuitBreakerConfig);\n+            return this;\n+        }\n+\n+        public Builder withCircuitBreakerConfigDefaults() {\n+            circuitBreakerConfigsMap.put(DEFAULT_CONFIG, CircuitBreakerConfig.ofDefaults());", "originalCommit": "3c94cf03e43ba94cedf9500d4f164f5ca1031abf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzcyNTcxOA==", "url": "https://github.com/resilience4j/resilience4j/pull/882#discussion_r383725718", "bodyText": "@RobWin  I agree that if the config map is empty, InMemoryCircuitBreakerRegistry creates a default config but I implemented this method so that user can take conscious decision to create CircuitBreakerRegistry configs by default and does not leave the hashmap empty unknowingly. Let me know if that makes sense, I will remove the method otherwise.", "author": "KrnSaurabh", "createdAt": "2020-02-25T08:35:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMzODIzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDMxMjk2MQ==", "url": "https://github.com/resilience4j/resilience4j/pull/882#discussion_r384312961", "bodyText": "A CircuitBreakerRegistry always has a default CircuitBreakerConfig. It doesn't really matter if the user invokes withCircuitBreakerConfigDefaults or not.\nIf this method exists, it might be confusing for a users that a CircuitBreakerRegistry has defaults, even if the user didn't invoke the method. I think we should remove it.", "author": "RobWin", "createdAt": "2020-02-26T07:29:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzMzODIzMg=="}], "type": "inlineReview"}, {"oid": "bd74563063895302c54d3d664d7c010356391aed", "url": "https://github.com/resilience4j/resilience4j/commit/bd74563063895302c54d3d664d7c010356391aed", "message": "#703 Added unit tests and code refactor", "committedDate": "2020-03-01T12:40:18Z", "type": "commit"}]}