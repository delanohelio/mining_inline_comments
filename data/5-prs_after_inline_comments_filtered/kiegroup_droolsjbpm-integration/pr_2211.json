{"pr_number": 2211, "pr_title": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from t\u2026", "pr_createdAt": "2020-08-26T14:40:09Z", "pr_url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2211", "timeline": [{"oid": "edccf77fd601785971658bcd1cee6eadc0e28368", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/edccf77fd601785971658bcd1cee6eadc0e28368", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-09-01T07:17:00Z", "type": "commit"}, {"oid": "edccf77fd601785971658bcd1cee6eadc0e28368", "url": "https://github.com/kiegroup/droolsjbpm-integration/commit/edccf77fd601785971658bcd1cee6eadc0e28368", "message": "[JBPM-9310] Warning in BAMTaskEventListener if task is skipped from task event listener", "committedDate": "2020-09-01T07:17:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MjM2MQ==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2211#discussion_r483172361", "bodyText": "Not used, remove it", "author": "gmunozfe", "createdAt": "2020-09-03T18:24:41Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm/src/main/java/org/kie/server/services/jbpm/JbpmKieServerExtension.java", "diffHunk": "@@ -101,6 +101,7 @@\n import org.kie.internal.runtime.conf.NamedObjectModel;\n import org.kie.internal.runtime.conf.ObjectModel;\n import org.kie.internal.runtime.conf.RuntimeStrategy;\n+import org.kie.internal.runtime.manager.deploy.DeploymentDescriptorImpl;", "originalCommit": "edccf77fd601785971658bcd1cee6eadc0e28368", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5NjY3Mw==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2211#discussion_r483496673", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-04T09:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MjM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MjkwMA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2211#discussion_r483172900", "bodyText": "even if the list is empty, add(0, model) would add it in the first position, is this if-else worth it?", "author": "gmunozfe", "createdAt": "2020-09-03T18:25:33Z", "path": "kie-server-parent/kie-server-services/kie-server-services-jbpm/src/main/java/org/kie/server/services/jbpm/JbpmKieServerExtension.java", "diffHunk": "@@ -708,12 +709,19 @@ protected void addAsyncHandler(final KModuleDeploymentUnit unit, final InternalK\n     protected void addTaskBAMEventListener(final KModuleDeploymentUnit unit, final InternalKieContainer kieContainer) {\n         final DeploymentDescriptor descriptor = getDeploymentDescriptor(unit, kieContainer);\n         if (descriptor.getAuditMode() != AuditMode.NONE) {\n-            descriptor.getBuilder().addTaskEventListener(\n-                    new ObjectModel(\n+            List<ObjectModel> oldList = descriptor.getTaskEventListeners();\n+            ObjectModel model = new ObjectModel(\n                             \"mvel\",\n                             \"new org.jbpm.services.task.lifecycle.listeners.BAMTaskEventListener(false)\"\n-                    )\n             );\n+            if(!oldList.contains(model)) {\n+                if(!oldList.isEmpty()) {\n+                    oldList.add(0, model);\n+                } else {\n+                    oldList.add(model);", "originalCommit": "edccf77fd601785971658bcd1cee6eadc0e28368", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5NjYzNA==", "url": "https://github.com/kiegroup/droolsjbpm-integration/pull/2211#discussion_r483496634", "bodyText": "done", "author": "elguardian", "createdAt": "2020-09-04T09:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzE3MjkwMA=="}], "type": "inlineReview"}]}