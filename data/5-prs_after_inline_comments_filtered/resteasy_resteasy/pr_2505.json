{"pr_number": 2505, "pr_title": "[RESTEASY-2686] Prepare TS profile for bootable jar testing", "pr_createdAt": "2020-09-04T12:09:33Z", "pr_url": "https://github.com/resteasy/resteasy/pull/2505", "timeline": [{"oid": "b3f78a920011ba149eb1f45ba99093d3cc61ab35", "url": "https://github.com/resteasy/resteasy/commit/b3f78a920011ba149eb1f45ba99093d3cc61ab35", "message": "[RESTEASY-2686] Prepare TS profile for bootable jar testing", "committedDate": "2020-09-07T07:47:33Z", "type": "forcePushed"}, {"oid": "bb748241421b64050f905b5b8638881bae2239ea", "url": "https://github.com/resteasy/resteasy/commit/bb748241421b64050f905b5b8638881bae2239ea", "message": "[RESTEASY-2686] Prepare TS profile for bootable jar testing", "committedDate": "2020-09-07T11:47:07Z", "type": "forcePushed"}, {"oid": "eaf7365cc6ba4ab6775e295c08c0a3841146f129", "url": "https://github.com/resteasy/resteasy/commit/eaf7365cc6ba4ab6775e295c08c0a3841146f129", "message": "[RESTEASY-2686] Prepare TS profile for bootable jar testing", "committedDate": "2020-09-07T11:53:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTgzNw==", "url": "https://github.com/resteasy/resteasy/pull/2505#discussion_r484505837", "bodyText": "These could be correct or not (I haven't checked), but are they really related to this PR / RESTEASY-2686?", "author": "asoldano", "createdAt": "2020-09-07T16:00:42Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/providers/sse/resource/SseBroadcastResource.java", "diffHunk": "@@ -15,18 +14,17 @@\n import javax.ws.rs.sse.SseEventSink;\n import java.io.IOException;\n \n-@Singleton\n @Path(\"/broadcast\")\n public class SseBroadcastResource {\n \n-   private final Object sseBroadcasterLock = new Object();\n-   private volatile SseBroadcaster sseBroadcaster;\n-   private volatile boolean onErrorCalled = false;\n-   private volatile boolean onCloseCalled = false;\n+   private static final Object sseBroadcasterLock = new Object();\n+   private static volatile SseBroadcaster sseBroadcaster;\n+   private static volatile boolean onErrorCalled = false;\n+   private static volatile boolean onCloseCalled = false;\n \n    private static final Logger logger = Logger.getLogger(SseBroadcastResource.class);\n \n-   SseEventSink subscribedSink = null;\n+   static SseEventSink subscribedSink = null;", "originalCommit": "eaf7365cc6ba4ab6775e295c08c0a3841146f129", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3NzAwMw==", "url": "https://github.com/resteasy/resteasy/pull/2505#discussion_r484677003", "bodyText": "The point here is that there is no EJB galleon layer ready. But this test was originally using @singleton annotation, see https://github.com/resteasy/Resteasy/blob/3.12/testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/providers/sse/resource/SseBroadcastResource.java#L18\nSo basically we have a few choices here:\n\nignore this test now and unignore it once EJB layer is ready\nremove Singleton annotation and replace \"singleton\" variables by static variables\nuse ApplicationScope CDI bean instead of  (I don't test it, but it should probably works)\n\nI chose the second option, but I can also try some another, I don't have strong feelings here ...", "author": "marekkopecky", "createdAt": "2020-09-08T06:23:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTgzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTkxOQ==", "url": "https://github.com/resteasy/resteasy/pull/2505#discussion_r484505919", "bodyText": "These could be correct or not (I haven't checked), but are they really related to this PR / RESTEASY-2686?", "author": "asoldano", "createdAt": "2020-09-07T16:01:01Z", "path": "testsuite/integration-tests/src/test/java/org/jboss/resteasy/test/providers/sse/resource/SseReconnectResource.java", "diffHunk": "@@ -18,15 +17,14 @@\n import javax.ws.rs.sse.SseEventSink;\n import java.util.concurrent.TimeUnit;\n \n-@Singleton\n @Path(\"/reconnect\")\n public class SseReconnectResource {\n \n-   private volatile boolean isServiceAvailable = false;\n+   private static volatile boolean isServiceAvailable = false;\n \n-   private volatile long startTime = 0L;\n-   private volatile long endTime = 0L;\n-   private volatile long lastEventDeliveryTime;\n+   private static volatile long startTime = 0L;\n+   private static volatile long endTime = 0L;\n+   private static volatile long lastEventDeliveryTime;", "originalCommit": "eaf7365cc6ba4ab6775e295c08c0a3841146f129", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDY3NzI5Ng==", "url": "https://github.com/resteasy/resteasy/pull/2505#discussion_r484677296", "bodyText": "See my previous comment #2505 (comment)", "author": "marekkopecky", "createdAt": "2020-09-08T06:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTkxOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjE0NTgyNw==", "url": "https://github.com/resteasy/resteasy/pull/2505#discussion_r486145827", "bodyText": "OK, thanks for the explanation, makes sense (here and in the other discussion)", "author": "asoldano", "createdAt": "2020-09-10T08:06:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUwNTkxOQ=="}], "type": "inlineReview"}, {"oid": "b6073a833d3be1aaf98f93ec0bec4acb0c64ef13", "url": "https://github.com/resteasy/resteasy/commit/b6073a833d3be1aaf98f93ec0bec4acb0c64ef13", "message": "[RESTEASY-2686] Prepare TS profile for bootable jar testing", "committedDate": "2020-09-08T06:50:50Z", "type": "commit"}, {"oid": "b6073a833d3be1aaf98f93ec0bec4acb0c64ef13", "url": "https://github.com/resteasy/resteasy/commit/b6073a833d3be1aaf98f93ec0bec4acb0c64ef13", "message": "[RESTEASY-2686] Prepare TS profile for bootable jar testing", "committedDate": "2020-09-08T06:50:50Z", "type": "forcePushed"}]}