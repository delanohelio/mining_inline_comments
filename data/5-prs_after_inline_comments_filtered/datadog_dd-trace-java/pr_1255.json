{"pr_number": 1255, "pr_title": "Add list of blacklisted spring classes", "pr_createdAt": "2020-02-25T19:30:48Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/1255", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyMTI5NQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1255#discussion_r384121295", "bodyText": "Should there be just default implementation instead of these repeats?", "author": "mar-kolya", "createdAt": "2020-02-25T20:56:40Z", "path": "dd-java-agent/instrumentation/dropwizard/src/test/groovy/JettyTestInstrumentation.java", "diffHunk": "@@ -24,4 +26,9 @@ public AgentBuilder instrument(final AgentBuilder agentBuilder) {\n             new AgentBuilder.Transformer.ForAdvice()\n                 .advice(named(\"handle\"), HttpServerTestAdvice.ServerEntryAdvice.class.getName()));\n   }\n+\n+  @Override\n+  public Collection<String> getLibraryBlacklistedPrefixes() {\n+    return Collections.emptySet();\n+  }", "originalCommit": "f250b44a601293b01e993b4651736f8d07a83acf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEzMDMxNA==", "url": "https://github.com/DataDog/dd-trace-java/pull/1255#discussion_r384130314", "bodyText": "Yup, I even added a comment to Instrumenter.  The problem is we're Java 7 for the time being.", "author": "randomanderson", "createdAt": "2020-02-25T21:15:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyMTI5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0NzAxMg==", "url": "https://github.com/DataDog/dd-trace-java/pull/1255#discussion_r384147012", "bodyText": "We could add a default implementation to Instrumenter.Default.\nAlthough, I'll admit I'm usually fine with making each implementation explicitly redeclare it needs, since these are really independent decisions for each matcher.  However, in this case, I think we'll rarely use the blacklist.\nBut I do have a related question, does this really belong on an Instrumenter?  It seems like the blacklist is really more a property of a library and separate from any particular instrumentation.", "author": "dougqh", "createdAt": "2020-02-25T21:49:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyMTI5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDEyMzQwNQ==", "url": "https://github.com/DataDog/dd-trace-java/pull/1255#discussion_r384123405", "bodyText": "Personally I would say that mutable matcher goes heavily against BBs design intentions and may lead to awkward and hard to debug errors.\nAlso: having list of ignores classes in instrumentation is counterintuitive: we probably want that list to apply even if instrumentation is disabled for some reason. Or, for that matter, if for some reason we could not load it.\nI think keeping list of ignores here is actually less confusing (since we keep some here anyway).", "author": "mar-kolya", "createdAt": "2020-02-25T21:01:14Z", "path": "dd-java-agent/agent-tooling/src/main/java/datadog/trace/agent/tooling/bytebuddy/GlobalIgnoresMatcher.java", "diffHunk": "@@ -9,11 +12,13 @@\n public class GlobalIgnoresMatcher<T extends TypeDescription>\n     extends ElementMatcher.Junction.AbstractBase<T> {\n \n+  private final Set<String> blacklistedPrefixes = new HashSet<>();\n+\n   private static final Pattern COM_MCHANGE_PROXY =\n       Pattern.compile(\"com\\\\.mchange\\\\.v2\\\\.c3p0\\\\..*Proxy\");\n \n-  public static <T extends TypeDescription> ElementMatcher.Junction<T> globalIgnoresMatcher() {\n-    return new GlobalIgnoresMatcher<>();\n+  public void addBlacklistedPrefixes(final Collection<String> prefixes) {\n+    blacklistedPrefixes.addAll(prefixes);", "originalCommit": "f250b44a601293b01e993b4651736f8d07a83acf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa3f449ec444281bd8fcee222c8ea6cd3b3461e0", "url": "https://github.com/DataDog/dd-trace-java/commit/fa3f449ec444281bd8fcee222c8ea6cd3b3461e0", "message": "Add list of blacklisted spring classes", "committedDate": "2020-02-25T21:33:39Z", "type": "commit"}, {"oid": "fa3f449ec444281bd8fcee222c8ea6cd3b3461e0", "url": "https://github.com/DataDog/dd-trace-java/commit/fa3f449ec444281bd8fcee222c8ea6cd3b3461e0", "message": "Add list of blacklisted spring classes", "committedDate": "2020-02-25T21:33:39Z", "type": "forcePushed"}, {"oid": "84c7be64b512962fd43f701f3954f772b8a62f22", "url": "https://github.com/DataDog/dd-trace-java/commit/84c7be64b512962fd43f701f3954f772b8a62f22", "message": "Add blacklist directly to global ignores", "committedDate": "2020-02-26T16:59:21Z", "type": "commit"}]}