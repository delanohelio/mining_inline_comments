{"pr_number": 2141, "pr_title": "Use same logging logic for APM and profile uploaders.", "pr_createdAt": "2020-12-01T15:35:09Z", "pr_url": "https://github.com/DataDog/dd-trace-java/pull/2141", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzMzg4MA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2141#discussion_r533533880", "bodyText": "Feels weird that this formatting would change.", "author": "bantonsson", "createdAt": "2020-12-01T16:08:54Z", "path": "dd-trace-core/src/main/java/datadog/trace/common/writer/ddagent/DDAgentApi.java", "diffHunk": "@@ -200,41 +189,20 @@ private void countAndLogFailedSend(\n     this.failedTraces += traceCount;\n     // these are used to catch and log if there is a failure in debug logging the response body\n     String agentError = getResponseBody(response);\n-    if (log.isDebugEnabled()) {\n-      String sendErrorString =\n-          createSendLogMessage(\n-              traceCount, sizeInBytes, agentError.isEmpty() ? \"Error\" : agentError);\n-      if (response != null) {\n-        log.debug(\n-            \"{} Status: {}, Response: {}, Body: {}\",\n-            sendErrorString,\n-            response.code(),\n-            response.message(),\n-            agentError);\n-      } else if (outer != null) {\n-        log.debug(sendErrorString, outer);\n-      } else {\n-        log.debug(sendErrorString);\n-      }\n-      return;\n-    }\n     String sendErrorString =\n-        createSendLogMessage(traceCount, sizeInBytes, agentError.isEmpty() ? \"Error\" : agentError);\n-    boolean hasLogged;\n-    if (response != null) {\n-      hasLogged =\n-          ratelimitedLogger.warn(\n-              \"{} Status: {} {}\", sendErrorString, response.code(), response.message());\n-    } else if (outer != null) {\n-      hasLogged =\n-          ratelimitedLogger.warn(\n-              \"{} {}: {}\", sendErrorString, outer.getClass().getName(), outer.getMessage());\n-    } else {\n-      hasLogged = ratelimitedLogger.warn(sendErrorString);\n-    }\n-    if (hasLogged) {\n-      this.logNextSuccess = true;\n+      createSendLogMessage(\n+        traceCount,\n+        sizeInBytes,\n+        agentError.isEmpty() ? \"Error\" : agentError);", "originalCommit": "69a7c59f3367ec830b70afbf42da8d3f8ee741e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2Njk4OA==", "url": "https://github.com/DataDog/dd-trace-java/pull/2141#discussion_r533566988", "bodyText": "Yeah I seem to have committed a stale version of these files, before spotlessApply \ud83d\ude1e Fixed!", "author": "AlexJF", "createdAt": "2020-12-01T16:52:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzUzMzg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcxODg2Ng==", "url": "https://github.com/DataDog/dd-trace-java/pull/2141#discussion_r533718866", "bodyText": "Perhaps IOLogger instead?  We don't really deem writing traces to the agent as \"uploading\".", "author": "tylerbenson", "createdAt": "2020-12-01T21:01:38Z", "path": "internal-api/src/main/java/datadog/trace/api/UploadLogger.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package datadog.trace.api;\n+\n+import java.util.concurrent.TimeUnit;\n+import lombok.EqualsAndHashCode;\n+import lombok.Getter;\n+import lombok.RequiredArgsConstructor;\n+import lombok.ToString;\n+import org.slf4j.Logger;\n+\n+/** Logger specialized on logging upload-related activity */\n+public class UploadLogger {", "originalCommit": "d0a8829acaa21a3aa35e503d7e10575331346f9f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "52b77da66ebe69f2733f43835485886c97b1ce5a", "url": "https://github.com/DataDog/dd-trace-java/commit/52b77da66ebe69f2733f43835485886c97b1ce5a", "message": "Use same logging logic for APM and profile uploaders.", "committedDate": "2020-12-02T16:43:10Z", "type": "forcePushed"}, {"oid": "82ba723f800de0ca2b7fd554aae6ea0d23409520", "url": "https://github.com/DataDog/dd-trace-java/commit/82ba723f800de0ca2b7fd554aae6ea0d23409520", "message": "Use same logging logic for APM and profile uploaders.", "committedDate": "2020-12-03T11:16:07Z", "type": "forcePushed"}, {"oid": "6a80202f2e11ef4676ac43d727a143eedcf9e2ad", "url": "https://github.com/DataDog/dd-trace-java/commit/6a80202f2e11ef4676ac43d727a143eedcf9e2ad", "message": "Use same logging logic for APM and profile uploaders.", "committedDate": "2020-12-03T11:52:02Z", "type": "forcePushed"}, {"oid": "f90997bb50b4451b229871ba7b80dd8d0b766fe3", "url": "https://github.com/DataDog/dd-trace-java/commit/f90997bb50b4451b229871ba7b80dd8d0b766fe3", "message": "Use same logging logic for APM and profile uploaders.", "committedDate": "2020-12-03T15:05:30Z", "type": "commit"}, {"oid": "f90997bb50b4451b229871ba7b80dd8d0b766fe3", "url": "https://github.com/DataDog/dd-trace-java/commit/f90997bb50b4451b229871ba7b80dd8d0b766fe3", "message": "Use same logging logic for APM and profile uploaders.", "committedDate": "2020-12-03T15:05:30Z", "type": "forcePushed"}]}