{"pr_number": 189, "pr_title": "IModelData support", "pr_createdAt": "2020-09-06T17:26:20Z", "pr_url": "https://github.com/PatchworkMC/patchwork-api/pull/189", "timeline": [{"oid": "255967dbef30da5c4b823711fef055420db36396", "url": "https://github.com/PatchworkMC/patchwork-api/commit/255967dbef30da5c4b823711fef055420db36396", "message": "Add IModelData", "committedDate": "2020-08-22T16:39:55Z", "type": "commit"}, {"oid": "912c4d72f555f799193e774f7d53245226865358", "url": "https://github.com/PatchworkMC/patchwork-api/commit/912c4d72f555f799193e774f7d53245226865358", "message": "Make IModelData a separate package\n\ntesselateSmooth & tesselateFlat", "committedDate": "2020-09-05T14:30:13Z", "type": "commit"}, {"oid": "b9bdd317de2020509f8168f0598cdd6a8459a208", "url": "https://github.com/PatchworkMC/patchwork-api/commit/b9bdd317de2020509f8168f0598cdd6a8459a208", "message": "Merge remote-tracking branch 'origin/master' into feature/model-data", "committedDate": "2020-09-05T14:31:32Z", "type": "commit"}, {"oid": "53285c33dc55eb99ef0d55c06acc5e540de711a1", "url": "https://github.com/PatchworkMC/patchwork-api/commit/53285c33dc55eb99ef0d55c06acc5e540de711a1", "message": "Fix MixinBlockRenderManager", "committedDate": "2020-09-05T14:51:39Z", "type": "commit"}, {"oid": "26e6d195d32fe6ea9b5c16e19748670edd90f2e4", "url": "https://github.com/PatchworkMC/patchwork-api/commit/26e6d195d32fe6ea9b5c16e19748670edd90f2e4", "message": "Impl MixinChunkRenderer", "committedDate": "2020-09-05T16:27:13Z", "type": "commit"}, {"oid": "f8779c2a2191f87d8c085c7e1d488cc0db7bf107", "url": "https://github.com/PatchworkMC/patchwork-api/commit/f8779c2a2191f87d8c085c7e1d488cc0db7bf107", "message": "Code clean up", "committedDate": "2020-09-05T17:11:42Z", "type": "commit"}, {"oid": "8c4fd198f771ba01eb70187551c4cd66d672da4c", "url": "https://github.com/PatchworkMC/patchwork-api/commit/8c4fd198f771ba01eb70187551c4cd66d672da4c", "message": "Fix license", "committedDate": "2020-09-05T17:22:44Z", "type": "commit"}, {"oid": "434b58bd04544b272b914a4f690cf27da6e8d62c", "url": "https://github.com/PatchworkMC/patchwork-api/commit/434b58bd04544b272b914a4f690cf27da6e8d62c", "message": "Patch ChunkRenderTask, IModelData supplier done", "committedDate": "2020-09-06T14:18:08Z", "type": "commit"}, {"oid": "b19088c23e7cf65e766da14d7c6005d5ac32b8ce", "url": "https://github.com/PatchworkMC/patchwork-api/commit/b19088c23e7cf65e766da14d7c6005d5ac32b8ce", "message": "Impl IForgeBakedModel.getParticleTexture and isAmbientOcclusion", "committedDate": "2020-09-06T17:10:43Z", "type": "commit"}, {"oid": "8fed9df122a833e7674c070935eacea530bdc4c2", "url": "https://github.com/PatchworkMC/patchwork-api/commit/8fed9df122a833e7674c070935eacea530bdc4c2", "message": "Finalize IModelData and IForgeBakedModel for 1.14.4", "committedDate": "2020-09-07T14:53:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NDgwNA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r486994804", "bodyText": "I thought it wasn't valid for a Mixin to extend its target?", "author": "williambl", "createdAt": "2020-09-11T11:54:24Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/patchworkmc/mixin/extensions/bakedmodel/MixinBakedModel.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.extensions.bakedmodel;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import net.minecraftforge.client.extensions.IForgeBakedModel;\n+\n+import net.minecraft.client.render.model.BakedModel;\n+import net.minecraft.client.render.model.json.ModelTransformation;\n+\n+@Mixin(BakedModel.class)\n+public interface MixinBakedModel extends BakedModel, IForgeBakedModel {", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3Mjc1OA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r487172758", "bodyText": "for interface targets, this is valid.", "author": "rikka0w0", "createdAt": "2020-09-11T16:59:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NDgwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyNTEzNw==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r487225137", "bodyText": "well, TIL.", "author": "williambl", "createdAt": "2020-09-11T18:44:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NDgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NjI4Nw==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r486996287", "bodyText": "Is this method not needed?", "author": "williambl", "createdAt": "2020-09-11T11:57:19Z", "path": "patchwork-extensions-blockentity/src/main/java/net/minecraftforge/common/extensions/IForgeTileEntity.java", "diffHunk": "@@ -171,30 +173,4 @@ default boolean canRenderBreaking() {\n \tdefault boolean hasFastRenderer() {\n \t\treturn false;\n \t}\n-\n-\t/**\n-\t * Requests a refresh for the model data of your TE\n-\t * Call this every time your {@link #getModelData()} changes.\n-\t */\n-\tdefault void requestModelDataUpdate() {\n-\t\tBlockEntity te = getTileEntity();\n-\t\tWorld world = te.getWorld();\n-\n-\t\tif (world != null && world.isClient) {\n-\t\t//\tModelDataManager.requestModelDataRefresh(te);\n-\t\t}\n-\t}\n-\n-\t/**\n-\t * Allows you to return additional model data.\n-\t * This data can be used to provide additional functionality in your {@link net.minecraft.client.renderer.model.IBakedModel}\n-\t * You need to schedule a refresh of you model data via {@link #requestModelDataUpdate()} if the result of this function changes.\n-\t * <b>Note that this method may be called on a chunk render thread instead of the main client thread</b>\n-\t *\n-\t * @return Your model data\n-\t */\n-\t//@Nonnull\n-\t//default IModelData getModelData() {\n-\t//\treturn EmptyModelData.INSTANCE;", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3MzE3NQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r487173175", "bodyText": "It is declared in one of our other classes", "author": "rikka0w0", "createdAt": "2020-09-11T17:00:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzE3MzYzMg==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r487173632", "bodyText": "Need to do this because we want to keep things modular and also helps resolving a circular dependency problem", "author": "rikka0w0", "createdAt": "2020-09-11T17:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NjI4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzIyNTA0OA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r487225048", "bodyText": "\ud83d\udc4d", "author": "williambl", "createdAt": "2020-09-11T18:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5NjI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMDU4Mg==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r484510582", "bodyText": "what do you mean \"separated package\"?", "author": "TheGlitch76", "createdAt": "2020-09-07T16:15:14Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/minecraftforge/client/extensions/IForgeBakedModel.java", "diffHunk": "@@ -0,0 +1,64 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.client.extensions;\n+\n+import java.util.List;\n+import java.util.Random;\n+\n+import javax.annotation.Nonnull;\n+import javax.annotation.Nullable;\n+\n+import net.minecraftforge.client.model.data.IModelData;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.client.render.model.BakedModel;\n+import net.minecraft.client.render.model.BakedQuad;\n+import net.minecraft.client.texture.Sprite;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.Direction;\n+import net.minecraft.world.BlockRenderView;\n+\n+/**\n+ * Forge makes every BakeModel including vanilla BakedModels extend this interface.\n+ * The handlePerspective and doesHandlePerspectives callback will be supported in a separated package.", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk5Mjg0OA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r499992848", "bodyText": "handlePerspective callback requires a lot of math classes, which obviously we dont have. \"extensions-bakedmodel\" might not be a good place for them. Furthermore, the internal detail of the way forge handle perspectives changes a lot since 1.15, so I'm still thinking...It might not worth to implement the handlePerspective callback in 1.14.", "author": "rikka0w0", "createdAt": "2020-10-06T04:00:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMDU4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NjU5Nw==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r495476597", "bodyText": "patchworl", "author": "TheGlitch76", "createdAt": "2020-09-26T17:14:16Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/patchworkmc/impl/extensions/bakedmodel/ForgeBlockModelRenderer.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.impl.extensions.bakedmodel;\n+\n+import java.util.Random;\n+\n+import net.minecraftforge.client.model.data.IModelData;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.client.render.BufferBuilder;\n+import net.minecraft.client.render.block.BlockModelRenderer;\n+import net.minecraft.client.render.model.BakedModel;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.BlockRenderView;\n+\n+public interface ForgeBlockModelRenderer {\n+\tvoid patchwork$tesselate_ModelData(IModelData modelData);\n+\tvoid patchworl$tesselateSmoothFlat_ModelData(IModelData modelData);", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk5Mjk1OA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r499992958", "bodyText": "Sorry i didnt notice this", "author": "rikka0w0", "createdAt": "2020-10-06T04:01:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NjU5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NjY2Mg==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r495476662", "bodyText": "Is this getting? setting? an action? Could use some documentation.", "author": "TheGlitch76", "createdAt": "2020-09-26T17:14:55Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/patchworkmc/impl/extensions/bakedmodel/ForgeBlockModelRenderer.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.impl.extensions.bakedmodel;\n+\n+import java.util.Random;\n+\n+import net.minecraftforge.client.model.data.IModelData;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.client.render.BufferBuilder;\n+import net.minecraft.client.render.block.BlockModelRenderer;\n+import net.minecraft.client.render.model.BakedModel;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.BlockRenderView;\n+\n+public interface ForgeBlockModelRenderer {\n+\tvoid patchwork$tesselate_ModelData(IModelData modelData);\n+\tvoid patchworl$tesselateSmoothFlat_ModelData(IModelData modelData);", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk5MzE1MQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r499993151", "bodyText": "These function are used to setup the context, which optionally contains an IModelData param. I will add some comments.", "author": "rikka0w0", "createdAt": "2020-10-06T04:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NjY2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NjczNQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r495476735", "bodyText": "same thing here", "author": "TheGlitch76", "createdAt": "2020-09-26T17:15:21Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/patchworkmc/impl/extensions/bakedmodel/ForgeBlockRenderManager.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.impl.extensions.bakedmodel;\n+\n+import java.util.Random;\n+\n+import net.minecraftforge.client.model.data.IModelData;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.client.render.BufferBuilder;\n+import net.minecraft.client.render.block.BlockRenderManager;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.world.BlockRenderView;\n+\n+public interface ForgeBlockRenderManager {\n+\tvoid patchwork$tesselateBlock_ModelData(IModelData modelData);", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NjkxNA==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r495476914", "bodyText": "This is really messy, but to be honest I don't understand the code here. Unless someone is able to show how it's done otherwise, though, this is the solution I'll accept for now.", "author": "TheGlitch76", "createdAt": "2020-09-26T17:17:38Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/patchworkmc/mixin/extensions/bakedmodel/MixinBlockModelRenderer.java", "diffHunk": "@@ -0,0 +1,112 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.extensions.bakedmodel;\n+\n+import java.util.List;\n+import java.util.Random;\n+\n+import org.objectweb.asm.Opcodes;\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.Unique;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.Redirect;\n+import org.spongepowered.asm.mixin.injection.At.Shift;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfoReturnable;\n+import net.minecraftforge.client.extensions.IForgeBakedModel;\n+import net.minecraftforge.client.model.data.IModelData;\n+\n+import net.minecraft.block.BlockState;\n+import net.minecraft.client.render.BufferBuilder;\n+import net.minecraft.client.render.block.BlockModelRenderer;\n+import net.minecraft.client.render.model.BakedModel;\n+import net.minecraft.client.render.model.BakedQuad;\n+import net.minecraft.util.math.BlockPos;\n+import net.minecraft.util.math.Direction;\n+import net.minecraft.world.BlockRenderView;\n+\n+import net.patchworkmc.impl.extensions.bakedmodel.ModelDataParameter;\n+import net.patchworkmc.impl.extensions.bakedmodel.ForgeBlockModelRenderer;\n+\n+/**\n+ * Implements {@link net.minecraftforge.client.extensions.IForgeBakedModel#getQuads(BlockState,Direction,Random,IModelData)} and\n+ * {@link net.minecraftforge.client.extensions.IForgeBakedModel#shouldApplyDiffuseLighting()}.\n+ */", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NzIyMg==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r495477222", "bodyText": "This is also extremely messy and breaks Canvas/Sodium compat.", "author": "TheGlitch76", "createdAt": "2020-09-26T17:21:06Z", "path": "patchwork-extensions-bakedmodel/src/main/java/net/patchworkmc/mixin/extensions/bakedmodel/MixinChunkRenderer.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Minecraft Forge, Patchwork Project\n+ * Copyright (c) 2016-2020, 2019-2020\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.patchworkmc.mixin.extensions.bakedmodel;\n+\n+import java.util.Iterator;\n+import java.util.Random;\n+import java.util.Set;\n+\n+import org.spongepowered.asm.mixin.Mixin;\n+import org.spongepowered.asm.mixin.injection.At;\n+import org.spongepowered.asm.mixin.injection.At.Shift;\n+import org.spongepowered.asm.mixin.injection.Inject;\n+import org.spongepowered.asm.mixin.injection.callback.CallbackInfo;\n+import org.spongepowered.asm.mixin.injection.callback.LocalCapture;\n+import net.minecraftforge.client.model.data.IModelData;\n+\n+import net.minecraft.block.Block;\n+import net.minecraft.block.BlockRenderType;\n+import net.minecraft.block.BlockState;\n+import net.minecraft.client.render.BufferBuilder;\n+import net.minecraft.client.render.RenderLayer;\n+import net.minecraft.client.render.block.BlockRenderManager;\n+import net.minecraft.client.render.chunk.ChunkOcclusionDataBuilder;\n+import net.minecraft.client.render.chunk.ChunkRenderData;\n+import net.minecraft.client.render.chunk.ChunkRenderTask;\n+import net.minecraft.client.render.chunk.ChunkRenderer;\n+import net.minecraft.client.render.chunk.ChunkRendererRegion;\n+import net.minecraft.client.render.model.BakedModel;\n+import net.minecraft.util.math.BlockPos;\n+\n+import net.fabricmc.fabric.api.renderer.v1.model.FabricBakedModel;\n+import net.fabricmc.fabric.impl.client.indigo.Indigo;\n+\n+import net.patchworkmc.impl.extensions.bakedmodel.ForgeBlockRenderManager;\n+import net.patchworkmc.impl.extensions.bakedmodel.ForgeChunkRenderTask;\n+\n+/**\n+ * Mimic calling Forge's IModelData sensitive version of tesselateBlock().\n+ */\n+@Mixin(ChunkRenderer.class)\n+public abstract class MixinChunkRenderer {\n+\t/**\n+\t * This method can be better if we can talk to the Fabric API developer.\n+\t * If the implementation of {@link net.fabricmc.fabric.mixin.client.indigo.renderer.MixinChunkRenderer#hookChunkBuildTesselate}\n+\t * is placed in a separate class, it will be much easier for us.", "originalCommit": "8fed9df122a833e7674c070935eacea530bdc4c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTk5NTA2OQ==", "url": "https://github.com/PatchworkMC/patchwork-api/pull/189#discussion_r499995069", "bodyText": "It is really hard to find a better workaround. The only solution is to talk to the Fabric team to see if they want to make some change to their code to make their hooks less invasive. I don't think we can solve this on our own, wrapping forge's rendering system using fabric's api is unlikely to give good result, because they almost don't share any feature in common.", "author": "rikka0w0", "createdAt": "2020-10-06T04:10:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQ3NzIyMg=="}], "type": "inlineReview"}, {"oid": "2cbef2f44dd1615666a7bf78a7730ac3d9c4383c", "url": "https://github.com/PatchworkMC/patchwork-api/commit/2cbef2f44dd1615666a7bf78a7730ac3d9c4383c", "message": "Add comments and fix a naming problem", "committedDate": "2020-10-25T15:59:21Z", "type": "commit"}]}