{"pr_number": 5951, "pr_title": "FileUpload - fix issues with allowTypes, fileLimit, sizeLimit and templateMessage for simple mode", "pr_createdAt": "2020-05-23T22:22:04Z", "pr_url": "https://github.com/primefaces/primefaces/pull/5951", "timeline": [{"oid": "e8afba12dfaaf5dbbc845377200db25089bf9c18", "url": "https://github.com/primefaces/primefaces/commit/e8afba12dfaaf5dbbc845377200db25089bf9c18", "message": "validating/formating for both simple/advanced modes", "committedDate": "2020-05-22T16:08:18Z", "type": "commit"}, {"oid": "10612ae22942b40446a3d6c2146d974dbf5580d9", "url": "https://github.com/primefaces/primefaces/commit/10612ae22942b40446a3d6c2146d974dbf5580d9", "message": "invalidSizeMessage, invalidFileMessage & fileLimitMessage default values", "committedDate": "2020-05-23T21:06:46Z", "type": "commit"}, {"oid": "689df79d394d0e01978e2a7dd833223ac366e87a", "url": "https://github.com/primefaces/primefaces/commit/689df79d394d0e01978e2a7dd833223ac366e87a", "message": "add disabled to simple mode", "committedDate": "2020-05-23T21:25:42Z", "type": "commit"}, {"oid": "556a00d0b8f2a478d5fa9573738550654387bb2b", "url": "https://github.com/primefaces/primefaces/commit/556a00d0b8f2a478d5fa9573738550654387bb2b", "message": "Merge branch 'master' into PF-5941", "committedDate": "2020-05-23T22:25:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyODY5OA==", "url": "https://github.com/primefaces/primefaces/pull/5951#discussion_r429628698", "bodyText": "Why did you remove the EscapeUtils around invalidSize messsage?", "author": "melloware", "createdAt": "2020-05-24T11:55:56Z", "path": "src/main/java/org/primefaces/component/fileupload/FileUploadRenderer.java", "diffHunk": "@@ -95,21 +87,27 @@ protected void encodeScript(FacesContext context, FileUpload fileUpload) throws\n                     .callback(\"onAdd\", \"function(file, callback)\", fileUpload.getOnAdd())\n                     .callback(\"onstart\", \"function()\", fileUpload.getOnstart())\n                     .callback(\"onerror\", \"function()\", fileUpload.getOnerror())\n-                    .callback(\"onvalidationfailure\", \"function(msg)\", fileUpload.getOnvalidationfailure())\n                     .callback(\"oncancel\", \"function()\", fileUpload.getOncancel())\n                     .callback(\"oncomplete\", \"function(args)\", fileUpload.getOncomplete());\n \n-            String allowTypes = fileUpload.getAllowTypes();\n-\n-            if (allowTypes != null) {\n-                wb.append(\",allowTypes:\").append(allowTypes);\n-            }\n         }\n         else {\n             wb.init(\"SimpleFileUpload\", fileUpload.resolveWidgetVar(context), clientId)\n-                    .attr(\"skinSimple\", fileUpload.isSkinSimple(), false)\n-                    .attr(\"maxFileSize\", fileUpload.getSizeLimit(), Long.MAX_VALUE)\n-                    .attr(\"invalidSizeMessage\", EscapeUtils.forJavaScript(fileUpload.getInvalidSizeMessage()), null);\n+                    .attr(\"skinSimple\", fileUpload.isSkinSimple(), false);\n+        }\n+\n+        wb.attr(\"disabled\", fileUpload.isDisabled(), false)\n+                .attr(\"invalidSizeMessage\", fileUpload.getInvalidSizeMessage(), null)", "originalCommit": "556a00d0b8f2a478d5fa9573738550654387bb2b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY0NDEzMA==", "url": "https://github.com/primefaces/primefaces/pull/5951#discussion_r429644130", "bodyText": "Hi @melloware\nThe EscapeUtils.forJavaScript() call in FileUploadRenderer was removed due the following reasons:\n\nIt is already called by WidgetBuilder.attr():\n\npublic WidgetBuilder attr(String name, String value, String defaultValue) throws IOException {\n        if (value != null && !value.equals(defaultValue)) {\n            // ...\n            rw.write(EscapeUtils.forJavaScript(value));\n            // ...\n        }\n        return this;\n    }\n\nCalling EscapeUtils.forJavaScript() before the nullity check results in \"null\" strings instead of null references;\n\nassertEquals(\"null\", EscapeUtils.forJavaScript(null)); \nI just added some tests for these cases.", "author": "doleron", "createdAt": "2020-05-24T14:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTYyODY5OA=="}], "type": "inlineReview"}, {"oid": "66f986857959a89fd3defdf095f20be385b76a14", "url": "https://github.com/primefaces/primefaces/commit/66f986857959a89fd3defdf095f20be385b76a14", "message": "junit test forJavascript on null input", "committedDate": "2020-05-24T14:37:39Z", "type": "commit"}, {"oid": "8fc1d1a2a954338276fbd7b612a0952170c97cd7", "url": "https://github.com/primefaces/primefaces/commit/8fc1d1a2a954338276fbd7b612a0952170c97cd7", "message": "tests for WidgetBuilder.attr() js escape and default value", "committedDate": "2020-05-24T14:39:02Z", "type": "commit"}, {"oid": "39f4a7bcc9153492d3123fc93847a314b80bf56c", "url": "https://github.com/primefaces/primefaces/commit/39f4a7bcc9153492d3123fc93847a314b80bf56c", "message": "Merge branch 'PF-5941' of https://github.com/doleron/primefaces.git into PF-5941", "committedDate": "2020-05-24T14:39:19Z", "type": "commit"}]}