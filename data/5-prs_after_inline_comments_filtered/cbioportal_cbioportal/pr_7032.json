{"pr_number": 7032, "pr_title": "Add a check for existing \"SV Genetic Profile\" during import", "pr_createdAt": "2020-01-21T19:28:05Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7032", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE5ODgwOQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7032#discussion_r369198809", "bodyText": "Can you add a comment explaining the logic here?", "author": "ao508", "createdAt": "2020-01-21T19:29:24Z", "path": "core/src/main/java/org/mskcc/cbio/portal/util/GeneticProfileReader.java", "diffHunk": "@@ -82,11 +82,18 @@ public static GeneticProfile loadGeneticProfile(File file) throws IOException, D\n                throw new RuntimeException(\"Error: genetic_profile record found with same Stable ID as the one used in your data:  \"\n                        + existingGeneticProfile.getStableId() + \". Remove the existing genetic_profile record first.\");\n             } else if (geneticProfile.getDatatype().equals(\"FUSION\")) {\n+                String svStableId = existingGeneticProfile.getStableId().replace(\"mutations\", \"fusion\");\n+                // check if structural variant genetic proile already exists for fusions\n+                // if an auto-generated <study_id>_fusion genetic profile exists, do not attempt to add it again\n+                // otherwise, exception is thrown causing import to exit\n                 // populate the structural variant genetic profile for fusions\n-                GeneticProfile gp = new GeneticProfile(geneticProfile);\n-                gp.setGeneticAlterationType(GeneticAlterationType.STRUCTURAL_VARIANT);\n-                gp.setStableId(gp.getStableId().replace(\"mutations\",\"fusion\"));\n-                DaoGeneticProfile.addGeneticProfile(gp);\n+                GeneticProfile existingSVGeneticProfile = DaoGeneticProfile.getGeneticProfileByStableId(svStableId);", "originalCommit": "87ec72fe5bfb455ace91e419aa2fd9d5c3bd5b36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTE5ODkwNw==", "url": "https://github.com/cBioPortal/cbioportal/pull/7032#discussion_r369198907", "bodyText": "Give a tiny bit more detail here for context.\nWhat does \"two files\" mean? Just add something like, \"i.e., somatic fusions and germline fusions\"\nOtherwise someone looking at this might be confused as to why there would be fusion data stored in multiple files.", "author": "ao508", "createdAt": "2020-01-21T19:29:37Z", "path": "core/src/test/java/org/mskcc/cbio/portal/scripts/TestImportProfileData.java", "diffHunk": "@@ -218,6 +219,41 @@ public void testImportSplitMutationsFile() throws Exception {\n         assertEquals(\"1\", clinicalData.get(1).getAttrVal());\n     }\n \n+    @Test\n+    public void testImportSplitFusionsFile() throws Exception {\n+        /*\n+         * Check case where study has multiple fusions file.", "originalCommit": "87ec72fe5bfb455ace91e419aa2fd9d5c3bd5b36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3208fd1970dda8bc0be4f3aefecc8ea5dd6752e2", "url": "https://github.com/cBioPortal/cbioportal/commit/3208fd1970dda8bc0be4f3aefecc8ea5dd6752e2", "message": "Add a check for existing \"SV Genetic Profile\" during import\nPreviously, SV genetic profile was automatically generated for fusion files,\nbut this could result in adding multiple genetic profiles with same names\ncausing an exception\nAdded unit tests for \"split\" fusions file", "committedDate": "2020-01-21T19:31:55Z", "type": "commit"}, {"oid": "3208fd1970dda8bc0be4f3aefecc8ea5dd6752e2", "url": "https://github.com/cBioPortal/cbioportal/commit/3208fd1970dda8bc0be4f3aefecc8ea5dd6752e2", "message": "Add a check for existing \"SV Genetic Profile\" during import\nPreviously, SV genetic profile was automatically generated for fusion files,\nbut this could result in adding multiple genetic profiles with same names\ncausing an exception\nAdded unit tests for \"split\" fusions file", "committedDate": "2020-01-21T19:31:55Z", "type": "forcePushed"}]}