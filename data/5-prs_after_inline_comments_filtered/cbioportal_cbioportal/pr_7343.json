{"pr_number": 7343, "pr_title": "backend change for supporting new survival data format", "pr_createdAt": "2020-03-31T17:24:50Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7343", "timeline": [{"oid": "b873c4fa47ce8245d02cbd8c5fd530d725a62716", "url": "https://github.com/cBioPortal/cbioportal/commit/b873c4fa47ce8245d02cbd8c5fd530d725a62716", "message": "modify file format for survival data", "committedDate": "2020-04-01T17:00:53Z", "type": "forcePushed"}, {"oid": "08e51791dc6e27388b4bfbc4d10ea979429ec487", "url": "https://github.com/cBioPortal/cbioportal/commit/08e51791dc6e27388b4bfbc4d10ea979429ec487", "message": "backend support for survival data migration", "committedDate": "2020-04-07T05:07:27Z", "type": "forcePushed"}, {"oid": "777880cd8ad6d4ad4924c407971f4cfdb1ce6464", "url": "https://github.com/cBioPortal/cbioportal/commit/777880cd8ad6d4ad4924c407971f4cfdb1ce6464", "message": "test", "committedDate": "2020-04-07T05:26:11Z", "type": "forcePushed"}, {"oid": "35ab2c20773d5d3261c7b7f59a2c9e95479a9ee8", "url": "https://github.com/cBioPortal/cbioportal/commit/35ab2c20773d5d3261c7b7f59a2c9e95479a9ee8", "message": "test", "committedDate": "2020-04-07T05:46:59Z", "type": "forcePushed"}, {"oid": "005f2eea7127743dbe43326578e90a0499a24c33", "url": "https://github.com/cBioPortal/cbioportal/commit/005f2eea7127743dbe43326578e90a0499a24c33", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-24T17:13:04Z", "type": "forcePushed"}, {"oid": "951fca080751085b9fcb487eef164b7dd4be345a", "url": "https://github.com/cBioPortal/cbioportal/commit/951fca080751085b9fcb487eef164b7dd4be345a", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-24T17:33:26Z", "type": "forcePushed"}, {"oid": "b0f482c7dd5404e975ba157aee73a47d0dd10fc9", "url": "https://github.com/cBioPortal/cbioportal/commit/b0f482c7dd5404e975ba157aee73a47d0dd10fc9", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-24T18:48:50Z", "type": "forcePushed"}, {"oid": "db07beaaa6e6dd356e7f0301a88b12f7d4ce2628", "url": "https://github.com/cBioPortal/cbioportal/commit/db07beaaa6e6dd356e7f0301a88b12f7d4ce2628", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-28T14:18:51Z", "type": "forcePushed"}, {"oid": "2d4ed49bc70ec3d0aca8456ed6b5e64d3d8737c6", "url": "https://github.com/cBioPortal/cbioportal/commit/2d4ed49bc70ec3d0aca8456ed6b5e64d3d8737c6", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-28T15:10:06Z", "type": "forcePushed"}, {"oid": "a1fe4b7c5fbc3621588795eeff768836ff552715", "url": "https://github.com/cBioPortal/cbioportal/commit/a1fe4b7c5fbc3621588795eeff768836ff552715", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-28T15:21:06Z", "type": "forcePushed"}, {"oid": "94a85b668c3e94c6886729f977054dd715fa186e", "url": "https://github.com/cBioPortal/cbioportal/commit/94a85b668c3e94c6886729f977054dd715fa186e", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-04-28T15:50:49Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI5MTA4NQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r417291085", "bodyText": "If we are generalizing the code, why are we looking for specific values , like \"1:DECEASED\" or \"0:LIVING\" ?\nAlso, is \"os\" and \"dfs\" dataType, coming from the clinical data file now?", "author": "n1zea144", "createdAt": "2020-04-29T12:54:11Z", "path": "core/src/main/java/org/mskcc/cbio/portal/servlet/GetSurvivalDataJSON.java", "diffHunk": "@@ -144,9 +144,9 @@ protected void doPost(HttpServletRequest httpServletRequest,\n                     String osStatus = clinicalData.getOverallSurvivalStatus();\n                     if(osStatus == null || osStatus.length() == 0) {\n                         _result.put(\"status\", \"NA\");\n-                    } else if (osStatus.equalsIgnoreCase(\"DECEASED\")) {\n+                    } else if (osStatus.equalsIgnoreCase(\"1:DECEASED\")) {", "originalCommit": "94a85b668c3e94c6886729f977054dd715fa186e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzM3MDY2Ng==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r417370666", "bodyText": "I think this file is outdated. I just want to keep the consistency between all the files, so I also changed this.", "author": "dippindots", "createdAt": "2020-04-29T14:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI5MTA4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU3Mjg4Mg==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r419572882", "bodyText": "I think this code may still be used by the old web service (R and MATLAB libraries included).  If I understand the code, you are transforming a value of \"1:DECEASED\" to \"1\" on the way out of this servlet...but why do you want to do this?", "author": "n1zea144", "createdAt": "2020-05-04T16:41:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzI5MTA4NQ=="}], "type": "inlineReview"}, {"oid": "608492d4373bf54ac5da5422ddda60af212bd905", "url": "https://github.com/cBioPortal/cbioportal/commit/608492d4373bf54ac5da5422ddda60af212bd905", "message": "testImportClinicalDataSurvival:216", "committedDate": "2020-04-30T01:25:09Z", "type": "forcePushed"}, {"oid": "b69759630a61eb0040436987801ad57079cfdcfb", "url": "https://github.com/cBioPortal/cbioportal/commit/b69759630a61eb0040436987801ad57079cfdcfb", "message": "address comments", "committedDate": "2020-04-30T01:47:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU2ODEwNQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r419568105", "bodyText": "I suggest using the \"has\" approach as implemented in ImportClinicalData. MissingAttributeValues.  It makes for cleaner code -\n\n  \n    \n      cbioportal/core/src/main/java/org/mskcc/cbio/portal/scripts/ImportClinicalData.java\n    \n    \n         Line 81\n      in\n      b697596\n    \n    \n    \n    \n\n        \n          \n           static public boolean has(String value) {", "author": "n1zea144", "createdAt": "2020-05-04T16:34:22Z", "path": "core/src/main/java/org/mskcc/cbio/portal/scripts/ImportClinicalData.java", "diffHunk": "@@ -559,7 +558,12 @@ private void addDatum(int internalId, String attrId, String attrVal, String attr\n         // attribute value exists and if so, perfom an update\n         if (attrType.equals(ClinicalAttribute.PATIENT_ATTRIBUTE)) {\n             numPatientSpecificClinicalAttributesAdded++;\n-            DaoClinicalData.addPatientDatum(internalId, attrId, attrVal.trim());\n+            // add prefix for OS or DFS attributes\n+            if (SurvivalAttributeUtil.isSurvivalAttribute(attrId)) {", "originalCommit": "b69759630a61eb0040436987801ad57079cfdcfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU3MzE4NA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r419573184", "bodyText": "Please add a newline here.", "author": "n1zea144", "createdAt": "2020-05-04T16:42:21Z", "path": "core/src/main/java/org/mskcc/cbio/portal/util/SurvivalAttributeUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package org.mskcc.cbio.portal.util;\n+\n+public class SurvivalAttributeUtil {\n+\n+    private static final String ZERO_PREFIX = \"0:\";\n+    private static final String ONE_PREFIX = \"1:\";\n+\n+    public enum SurvivalStatusAttributes {\n+        OS_STATUS(\"OS_STATUS\"),\n+        DFS_STATUS(\"DFS_STATUS\");\n+\n+        String attributeId;\n+        SurvivalStatusAttributes(String attrId) {\n+            attributeId = attrId;\n+        }\n+\n+        String getAttributeId() {\n+            return attributeId;\n+        }\n+    }\n+\n+    public enum SurvivalStatusMappingOneValues {\n+        DECEASED(\"DECEASED\"),\n+        RECURRED_PROGRESSED(\"Recurred/Progressed\"),\n+        RECURRED(\"Recurred\"),\n+        PROGRESSED(\"Progressed\");\n+\n+        String statusValue;\n+        SurvivalStatusMappingOneValues(String value) {\n+            statusValue = value;\n+        }\n+\n+        String getStatusValue() {\n+            return statusValue;\n+        }\n+    }\n+\n+    public enum SurvivalStatusMappingZeroValues {\n+        LIVING(\"LIVING\"),\n+        DISEASE_FREE(\"DiseaseFree\");\n+\n+        String statusValue;\n+        SurvivalStatusMappingZeroValues(String value) {\n+            statusValue = value;\n+        }\n+\n+        String getStatusValue() {\n+            return statusValue;\n+        }\n+    }\n+\n+    public static boolean isSurvivalAttribute(String attributeId) {\n+        for (SurvivalStatusAttributes attribute : SurvivalStatusAttributes.values()) {\n+            if (attribute.getAttributeId().equals(attributeId)) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    public static String getModifiedAttributeValue(String value) {\n+        for (SurvivalStatusMappingOneValues attributeValue : SurvivalStatusMappingOneValues.values()) {\n+            if (attributeValue.getStatusValue().equals(value)) {\n+                return ONE_PREFIX + value;\n+            }\n+        }\n+        for (SurvivalStatusMappingZeroValues attributeValue : SurvivalStatusMappingZeroValues.values()) {\n+            if (attributeValue.getStatusValue().equals(value)) {\n+                return ZERO_PREFIX + value;\n+            }\n+        }\n+        // value is new format or is one of the NULL_VALUES\n+        return value;\n+    }\n+}", "originalCommit": "b69759630a61eb0040436987801ad57079cfdcfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU3Mzc0NA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r419573744", "bodyText": "Suggest using the \"has\" approach as linked above...", "author": "n1zea144", "createdAt": "2020-05-04T16:43:15Z", "path": "core/src/main/java/org/mskcc/cbio/portal/util/SurvivalAttributeUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package org.mskcc.cbio.portal.util;\n+\n+public class SurvivalAttributeUtil {\n+\n+    private static final String ZERO_PREFIX = \"0:\";\n+    private static final String ONE_PREFIX = \"1:\";\n+\n+    public enum SurvivalStatusAttributes {\n+        OS_STATUS(\"OS_STATUS\"),\n+        DFS_STATUS(\"DFS_STATUS\");\n+\n+        String attributeId;\n+        SurvivalStatusAttributes(String attrId) {\n+            attributeId = attrId;\n+        }\n+\n+        String getAttributeId() {\n+            return attributeId;\n+        }\n+    }\n+\n+    public enum SurvivalStatusMappingOneValues {\n+        DECEASED(\"DECEASED\"),\n+        RECURRED_PROGRESSED(\"Recurred/Progressed\"),\n+        RECURRED(\"Recurred\"),\n+        PROGRESSED(\"Progressed\");\n+\n+        String statusValue;\n+        SurvivalStatusMappingOneValues(String value) {\n+            statusValue = value;\n+        }\n+\n+        String getStatusValue() {\n+            return statusValue;\n+        }\n+    }\n+\n+    public enum SurvivalStatusMappingZeroValues {\n+        LIVING(\"LIVING\"),\n+        DISEASE_FREE(\"DiseaseFree\");\n+\n+        String statusValue;\n+        SurvivalStatusMappingZeroValues(String value) {\n+            statusValue = value;\n+        }\n+\n+        String getStatusValue() {\n+            return statusValue;\n+        }\n+    }\n+\n+    public static boolean isSurvivalAttribute(String attributeId) {\n+        for (SurvivalStatusAttributes attribute : SurvivalStatusAttributes.values()) {", "originalCommit": "b69759630a61eb0040436987801ad57079cfdcfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTU3MzgzNA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7343#discussion_r419573834", "bodyText": "Suggest using the \"has\" approach as linked above...", "author": "n1zea144", "createdAt": "2020-05-04T16:43:22Z", "path": "core/src/main/java/org/mskcc/cbio/portal/util/SurvivalAttributeUtil.java", "diffHunk": "@@ -0,0 +1,75 @@\n+package org.mskcc.cbio.portal.util;\n+\n+public class SurvivalAttributeUtil {\n+\n+    private static final String ZERO_PREFIX = \"0:\";\n+    private static final String ONE_PREFIX = \"1:\";\n+\n+    public enum SurvivalStatusAttributes {\n+        OS_STATUS(\"OS_STATUS\"),\n+        DFS_STATUS(\"DFS_STATUS\");\n+\n+        String attributeId;\n+        SurvivalStatusAttributes(String attrId) {\n+            attributeId = attrId;\n+        }\n+\n+        String getAttributeId() {\n+            return attributeId;\n+        }\n+    }\n+\n+    public enum SurvivalStatusMappingOneValues {\n+        DECEASED(\"DECEASED\"),\n+        RECURRED_PROGRESSED(\"Recurred/Progressed\"),\n+        RECURRED(\"Recurred\"),\n+        PROGRESSED(\"Progressed\");\n+\n+        String statusValue;\n+        SurvivalStatusMappingOneValues(String value) {\n+            statusValue = value;\n+        }\n+\n+        String getStatusValue() {\n+            return statusValue;\n+        }\n+    }\n+\n+    public enum SurvivalStatusMappingZeroValues {\n+        LIVING(\"LIVING\"),\n+        DISEASE_FREE(\"DiseaseFree\");\n+\n+        String statusValue;\n+        SurvivalStatusMappingZeroValues(String value) {\n+            statusValue = value;\n+        }\n+\n+        String getStatusValue() {\n+            return statusValue;\n+        }\n+    }\n+\n+    public static boolean isSurvivalAttribute(String attributeId) {\n+        for (SurvivalStatusAttributes attribute : SurvivalStatusAttributes.values()) {\n+            if (attribute.getAttributeId().equals(attributeId)) {\n+                return true;\n+            }\n+        }\n+        return false;\n+    }\n+\n+    public static String getModifiedAttributeValue(String value) {", "originalCommit": "b69759630a61eb0040436987801ad57079cfdcfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "84889942504443dd1b471924e1bc926df50ec74d", "url": "https://github.com/cBioPortal/cbioportal/commit/84889942504443dd1b471924e1bc926df50ec74d", "message": "add has() function to enum", "committedDate": "2020-05-05T20:53:03Z", "type": "forcePushed"}, {"oid": "86f066aca39614fc7d7978e746d95d391b34162c", "url": "https://github.com/cBioPortal/cbioportal/commit/86f066aca39614fc7d7978e746d95d391b34162c", "message": "add has() function to enum", "committedDate": "2020-05-05T21:39:52Z", "type": "forcePushed"}, {"oid": "3d661e981431b0de7ad80ec637f4986b10fd5f82", "url": "https://github.com/cBioPortal/cbioportal/commit/3d661e981431b0de7ad80ec637f4986b10fd5f82", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-05-14T19:15:18Z", "type": "forcePushed"}, {"oid": "f72115a531a053294866654871f7280659265ff5", "url": "https://github.com/cBioPortal/cbioportal/commit/f72115a531a053294866654871f7280659265ff5", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-05-14T19:21:33Z", "type": "commit"}, {"oid": "f72115a531a053294866654871f7280659265ff5", "url": "https://github.com/cBioPortal/cbioportal/commit/f72115a531a053294866654871f7280659265ff5", "message": "add '0:' and '1:' as prefix before survival status clinical attribute data", "committedDate": "2020-05-14T19:21:33Z", "type": "forcePushed"}]}