{"pr_number": 7148, "pr_title": "Fix study view fusion gene filter", "pr_createdAt": "2020-02-11T16:44:59Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7148", "timeline": [{"oid": "042d404ef577a49b81e3752cb3343dae57d53391", "url": "https://github.com/cBioPortal/cbioportal/commit/042d404ef577a49b81e3752cb3343dae57d53391", "message": "Fix study view fusion gene filter", "committedDate": "2020-02-18T20:05:47Z", "type": "commit"}, {"oid": "042d404ef577a49b81e3752cb3343dae57d53391", "url": "https://github.com/cBioPortal/cbioportal/commit/042d404ef577a49b81e3752cb3343dae57d53391", "message": "Fix study view fusion gene filter", "committedDate": "2020-02-18T20:05:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkyOTc1MA==", "url": "https://github.com/cBioPortal/cbioportal/pull/7148#discussion_r380929750", "bodyText": "This is a temporary fix. the _fusion profile is created in the database for studies that still have fusions in the mutation table.", "author": "zhx828", "createdAt": "2020-02-18T20:56:04Z", "path": "web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java", "diffHunk": "@@ -125,20 +125,50 @@ public SampleIdentifier apply(Sample sample) {\n \n         if (!CollectionUtils.isEmpty(studyViewFilter.getGeneFilters())) {\n \n-            Set<String> molecularProfileIds = studyViewFilter.getGeneFilters().stream()\n-                    .flatMap(geneFilter -> geneFilter.getMolecularProfileIds().stream()).collect(Collectors.toSet());\n+            Set<String> molecularProfileIds = studyViewFilter.getGeneFilters()\n+                    .stream()\n+                    .flatMap(geneFilter -> {\n+                        // TODO: cleanup once fusion/structural data is fixed in database\n+                        // until then use mutation profile to fetch fusions\n+                        return geneFilter.getMolecularProfileIds().stream().flatMap(molecularProfileId -> {\n+                            ArrayList<String> ids = new ArrayList<String>();\n+                            ids.add(molecularProfileId);\n+                            if (molecularProfileId.endsWith(\"_fusion\")) {", "originalCommit": "042d404ef577a49b81e3752cb3343dae57d53391", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}