{"pr_number": 7617, "pr_title": "Accelerate generic assay endpoint response speed", "pr_createdAt": "2020-06-15T05:06:24Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/7617", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDIxNzk4Ng==", "url": "https://github.com/cBioPortal/cbioportal/pull/7617#discussion_r440217986", "bodyText": "Main change is at here: we call function getGenericAssayAdditionalproperties once instead of calling N times getGeneticEntityIdByStableId and getGenericAssayMetaPropertiesMap (N is the number of stable ids).", "author": "dippindots", "createdAt": "2020-06-15T14:30:25Z", "path": "service/src/main/java/org/cbioportal/service/impl/GenericAssayServiceImpl.java", "diffHunk": "@@ -74,14 +75,19 @@\n                     metaResults.add(new GenericAssayMeta(meta.getStableId()));\n                 }\n             } else {\n-                // get additional properties for each meta data\n+                List<GenericAssayAdditionalProperty> additionalProperties = genericAssayRepository.getGenericAssayAdditionalproperties(distinctStableIds);\n                 for (GenericAssayMeta meta : metaData) {\n-                    int geneticEntityId = genericAssayRepository.getGeneticEntityIdByStableId(meta.getStableId());\n+                    String stableId = meta.getStableId();\n                     HashMap<String, String> map = new HashMap<>();\n-                    for (HashMap<String, String> data : genericAssayRepository.getGenericAssayMetaPropertiesMap(geneticEntityId)) {\n-                        map.put(data.get(\"key\"), data.get(\"value\"));\n+                    List<GenericAssayAdditionalProperty> filteredAdditionalProperties = additionalProperties\n+                            .stream()\n+                            .filter(additionalProperty -> additionalProperty.getStableId().equals(stableId))\n+                            .collect(Collectors.toList());\n+                    for (GenericAssayAdditionalProperty additionalProperty : filteredAdditionalProperties) {\n+                        map.put(additionalProperty.getName(), additionalProperty.getValue());\n                     }\n-                    metaResults.add(new GenericAssayMeta(meta.getEntityType(), meta.getStableId(), map));\n+                    meta.setGenericEntityMetaProperties(map);\n+                    metaResults.add(meta);", "originalCommit": "3ff98321d348436bdd5389dfda5adedcff5b1a0d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "url": "https://github.com/cBioPortal/cbioportal/commit/d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "message": "Accelerate generic assay endpoint response speed", "committedDate": "2020-06-15T14:58:08Z", "type": "commit"}, {"oid": "d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "url": "https://github.com/cBioPortal/cbioportal/commit/d7567255e5fb946a2fbf6b93ff3401e92664fc3b", "message": "Accelerate generic assay endpoint response speed", "committedDate": "2020-06-15T14:58:08Z", "type": "forcePushed"}]}