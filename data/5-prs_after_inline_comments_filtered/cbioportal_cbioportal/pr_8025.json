{"pr_number": 8025, "pr_title": "Fix 8007", "pr_createdAt": "2020-11-02T19:29:49Z", "pr_url": "https://github.com/cBioPortal/cbioportal/pull/8025", "timeline": [{"oid": "b6d5d5066647abc07ae0368906d4a284cf6766b9", "url": "https://github.com/cBioPortal/cbioportal/commit/b6d5d5066647abc07ae0368906d4a284cf6766b9", "message": "Use both gene1 and gene2 for calculating structural variants counts", "committedDate": "2020-11-02T20:36:43Z", "type": "forcePushed"}, {"oid": "f3e1335af9cb164e4dcb1d99118e01df44f75096", "url": "https://github.com/cBioPortal/cbioportal/commit/f3e1335af9cb164e4dcb1d99118e01df44f75096", "message": "Use both gene1 and gene2 for calculating structural variants counts", "committedDate": "2020-11-03T20:22:30Z", "type": "commit"}, {"oid": "f3e1335af9cb164e4dcb1d99118e01df44f75096", "url": "https://github.com/cBioPortal/cbioportal/commit/f3e1335af9cb164e4dcb1d99118e01df44f75096", "message": "Use both gene1 and gene2 for calculating structural variants counts", "committedDate": "2020-11-03T20:22:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI4NDI4MA==", "url": "https://github.com/cBioPortal/cbioportal/pull/8025#discussion_r518284280", "bodyText": "Where is this SUMMARY coming from? Why isn't this a constant?", "author": "Luke-Sikina", "createdAt": "2020-11-05T18:50:26Z", "path": "service/src/main/java/org/cbioportal/service/util/MutationMapperUtils.java", "diffHunk": "@@ -90,12 +101,16 @@\n                             } else {\n                                 try {\n                                     Gene site2Gene = geneService.getGene(site2GeneSymbol);\n-                                    if (site2Gene != null) {\n-                                        structuralVariant.setSite2EntrezGeneId(site2Gene.getGeneticEntityId());\n-                                        structuralVariant.setSite2HugoSymbol(site2Gene.getHugoGeneSymbol());\n-                                    }\n+                                    structuralVariant.setSite2EntrezGeneId(site2Gene.getEntrezGeneId());\n+                                    structuralVariant.setSite2HugoSymbol(site2Gene.getHugoGeneSymbol());\n                                 } catch (Exception e) {\n-                                    // Site2 gene is not set when gene symbol is not found in database\n+                                    // Site2 gene is not set when gene symbol is not found in database. Check if it is an alias\n+                                    List<Gene> aliasGenes = geneService.getAllGenes(null, site2GeneSymbol, \"SUMMARY\",", "originalCommit": "f3e1335af9cb164e4dcb1d99118e01df44f75096", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyMjg4Mg==", "url": "https://github.com/cBioPortal/cbioportal/pull/8025#discussion_r518322882", "bodyText": "SUMMARY constant is present in web layer. moving it to service layer introduces lot of changes. better to fix it in another pr", "author": "kalletlak", "createdAt": "2020-11-05T19:47:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI4NDI4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI4NTg5Nw==", "url": "https://github.com/cBioPortal/cbioportal/pull/8025#discussion_r518285897", "bodyText": "So what was molecularAlterationFilterType doing here? It looks like it was doing absolutely nothing - is that correct?", "author": "Luke-Sikina", "createdAt": "2020-11-05T18:53:07Z", "path": "web/src/main/java/org/cbioportal/web/util/StudyViewFilterApplier.java", "diffHunk": "@@ -272,8 +271,7 @@ public SampleIdentifier apply(Sample sample) {\n     }\n \n     private List<SampleIdentifier> filterMutatedGenes(List<GeneFilter> mutatedGenefilters,\n-            Map<String, MolecularProfile> molecularProfileMap, MolecularAlterationType molecularAlterationFilterType,\n-            List<SampleIdentifier> sampleIdentifiers) {\n+            Map<String, MolecularProfile> molecularProfileMap, List<SampleIdentifier> sampleIdentifiers) {", "originalCommit": "f3e1335af9cb164e4dcb1d99118e01df44f75096", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyNDIyNQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/8025#discussion_r518324225", "bodyText": "It was useful before when both mutation and fusion/SV data requests are handled together. I forgot to clean it up once I introduced new service for fetching/filtering fusion/SV data", "author": "kalletlak", "createdAt": "2020-11-05T19:50:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI4NTg5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI4NzEzMQ==", "url": "https://github.com/cBioPortal/cbioportal/pull/8025#discussion_r518287131", "bodyText": "We should probably document these changes with a unit test or two.", "author": "Luke-Sikina", "createdAt": "2020-11-05T18:55:15Z", "path": "service/src/main/java/org/cbioportal/service/impl/MolecularProfileServiceImpl.java", "diffHunk": "@@ -163,18 +163,17 @@ public BaseMeta getMetaMolecularProfilesInStudies(List<String> studyIds) {\n \n         //TODO: remove mutation profile once fusions are migrated to structural variant in the database\n         getMolecularProfilesInStudies(studyIds, \"SUMMARY\").stream().forEach(molecularProfile -> {\n-            if (!mapByStudyId.containsKey(molecularProfile.getCancerStudyIdentifier())) {\n-                if (molecularProfile.getMolecularAlterationType()\n-                        .equals(MolecularProfile.MolecularAlterationType.MUTATION_EXTENDED)\n-                        || (molecularProfile.getMolecularAlterationType()\n-                                .equals(MolecularProfile.MolecularAlterationType.STRUCTURAL_VARIANT)\n-                                && molecularProfile.getDatatype() == \"SV\")) {\n+            if (molecularProfile.getMolecularAlterationType().equals(MolecularProfile.MolecularAlterationType.FUSION)", "originalCommit": "f3e1335af9cb164e4dcb1d99118e01df44f75096", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODMyNDkyNg==", "url": "https://github.com/cBioPortal/cbioportal/pull/8025#discussion_r518324926", "bodyText": "True, but all this logic is gonna go away once the data is fixed. Not sure it its worth writing tests", "author": "kalletlak", "createdAt": "2020-11-05T19:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODI4NzEzMQ=="}], "type": "inlineReview"}]}