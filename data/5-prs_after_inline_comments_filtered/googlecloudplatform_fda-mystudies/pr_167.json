{"pr_number": 167, "pr_title": "User Mgmt module issue fixes", "pr_createdAt": "2020-04-17T13:18:41Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167", "timeline": [{"oid": "7e4bcb9f32b7be6d8c830f5c482c449eea61e22e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7e4bcb9f32b7be6d8c830f5c482c449eea61e22e", "message": "Latest code push with below changes:                                                                                                                                                                                                                                                                                                    1. Verify Email Code issue fix #130\n2. Resend Confirmation issue fix for alraedy deactivated account's email id\n3. Push notification issue fix based on internal review\n4. Model class changes to make it consistent across all components.", "committedDate": "2020-04-17T13:04:16Z", "type": "commit"}, {"oid": "e14eef39c114d99a920d1f7c16e0e83af962b112", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e14eef39c114d99a920d1f7c16e0e83af962b112", "message": "Revert \"Latest code push with below changes:                                                                                                                                                                                                                                                                                                    1. Verify Email Code issue fix #130\"\n\nThis reverts commit 7e4bcb9f32b7be6d8c830f5c482c449eea61e22e.", "committedDate": "2020-04-17T13:08:40Z", "type": "commit"}, {"oid": "6dc0227ecc340d7e2a5999c2220a732285947f98", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6dc0227ecc340d7e2a5999c2220a732285947f98", "message": "latest code commit with changes as bellow                                                                                                                                                                                                                                                                                          1. Verify Email Code issue fix #130\n2. Resend Confirmation issue fix for alraedy deactivated account's email id\n3. Push notification issue fix based on internal review\n4. Model class changes to make it consistent across all components.", "committedDate": "2020-04-17T13:15:50Z", "type": "commit"}, {"oid": "c984cc3089d7fd61920a50571f4283c18f466bb3", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c984cc3089d7fd61920a50571f4283c18f466bb3", "message": "Merge branch 'early-access' into early-access-build", "committedDate": "2020-04-17T13:26:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI0MzM5OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410243399", "bodyText": "StringUtils.IsEmpty checks for null values as well; so there is not need for a separate null check of each value.", "author": "zohrehj", "createdAt": "2020-04-17T14:01:47Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java", "diffHunk": "@@ -60,7 +60,7 @@\n         || (accessToken.length() == 0 || StringUtils.isEmpty(accessToken))\n         || (userId.length() == 0 || StringUtils.isEmpty(userId))\n         || (verificationForm.getCode() == null\n-            && StringUtils.isEmpty(verificationForm.getCode()))) {\n+            || StringUtils.isEmpty(verificationForm.getCode()))) {", "originalCommit": "c984cc3089d7fd61920a50571f4283c18f466bb3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b6b80e6e3412344f65f5550b3b08a1f0b0007b6b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/b6b80e6e3412344f65f5550b3b08a1f0b0007b6b", "message": "Null check removed as per Zohreh's comment", "committedDate": "2020-04-17T14:23:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI3NzM4MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410277381", "bodyText": "Why not allocate the value below instead of creating an array with an explicit length here?", "author": "nikklassen", "createdAt": "2020-04-17T14:54:47Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserProfileManagementDaoImpl.java", "diffHunk": "@@ -146,7 +146,7 @@ public UserDetailsBO getParticipantDetailsByEmail(\n     CriteriaBuilder criteriaBuilder = null;\n     CriteriaQuery<UserDetailsBO> criteriaQuery = null;\n     Root<UserDetailsBO> userDetailsBoRoot = null;\n-    Predicate[] predicates = new Predicate[2];\n+    Predicate[] predicates = new Predicate[3];", "originalCommit": "b6b80e6e3412344f65f5550b3b08a1f0b0007b6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY5MDU5OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410690598", "bodyText": "@nikklassen Fixed.\nHandled the predicate size in a generic way , so that no need to explicitly define the size of the array.", "author": "aswinijena100", "createdAt": "2020-04-18T12:18:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI3NzM4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI4MjEzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410282135", "bodyText": "It looks like this is still \"CHAR(8)\" in the enroll-mgmt model. I assume these should be in sync? Would an Enum be more appropriate for this field though?", "author": "nikklassen", "createdAt": "2020-04-17T15:02:05Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/model/ParticipantRegistrySite.java", "diffHunk": "@@ -46,10 +50,16 @@\n   @Column(name = \"invitation_date\", columnDefinition = \"TIMESTAMP\")\n   private Date invitationDate;\n \n+  @Column(name = \"invitation_count\", nullable = false, columnDefinition = \"bigint(20) default 0\")\n+  private Long invitationCount = 0L;\n+\n+  @Column(name = \"disabled_date\", columnDefinition = \"TIMESTAMP default NULL\")\n+  private Date disabledDate;\n+\n   @Column(name = \"enrollment_token_expiry\", columnDefinition = \"TIMESTAMP\")\n   private Date enrollmentTokenExpiry;\n \n-  @Column(name = \"onboarding_status\", columnDefinition = \"CHAR(8)\")\n+  @Column(name = \"onboarding_status\", columnDefinition = \"CHAR(1)\")", "originalCommit": "b6b80e6e3412344f65f5550b3b08a1f0b0007b6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY5MDk2NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410690964", "bodyText": "Syncing  across all components had been modified already and  planning was to push the changes in the subsequent PRs . However included the same BO from other components as well.", "author": "aswinijena100", "createdAt": "2020-04-18T12:22:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI4MjEzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI4MzkyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410283925", "bodyText": "A boolean and calling this \"canEdit\" seems more appopriate, unless I'm misunderstanding the purpose of this field.", "author": "nikklassen", "createdAt": "2020-04-17T15:04:44Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/model/SitePermission.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Use of this source code is governed by an MIT-style\n+ * license that can be found in the LICENSE file or at\n+ * https://opensource.org/licenses/MIT.\n+ */\n+package com.google.cloud.healthcare.fdamystudies.model;\n+\n+import java.time.LocalDateTime;\n+import javax.persistence.Column;\n+import javax.persistence.Entity;\n+import javax.persistence.GeneratedValue;\n+import javax.persistence.GenerationType;\n+import javax.persistence.Id;\n+import javax.persistence.JoinColumn;\n+import javax.persistence.ManyToOne;\n+import javax.persistence.Table;\n+import lombok.Getter;\n+import lombok.Setter;\n+\n+@Setter\n+@Getter\n+@Entity\n+@Table(name = \"sites_permissions\")\n+public class SitePermission {\n+\n+  @Id\n+  @Column(name = \"id\")\n+  @GeneratedValue(strategy = GenerationType.AUTO)\n+  private Integer id;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"ur_admin_user_id\", insertable = false, updatable = false)\n+  private UserRegAdminUser urAdminUser;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"study_id\", insertable = true, updatable = true)\n+  private StudyInfoBO studyInfo;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"site_id\", insertable = true, updatable = true)\n+  private SiteBo siteBo;\n+\n+  @ManyToOne\n+  @JoinColumn(name = \"app_info_id\", insertable = true, updatable = true)\n+  private AppInfoDetailsBO appInfo;\n+\n+  @Column(name = \"edit\", columnDefinition = \"TINYINT(1) default 0\")\n+  private Integer edit = 0;", "originalCommit": "b6b80e6e3412344f65f5550b3b08a1f0b0007b6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDY5MTM3MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r410691370", "bodyText": "@nikklassen modified the variable as per your suggestion. However changing datatype needs modification in the dependent files and it leads to through testing of the functionality. Hence did not modified in the scope.", "author": "aswinijena100", "createdAt": "2020-04-18T12:26:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI4MzkyNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTM3OTM3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/167#discussion_r411379375", "bodyText": "acknowledged, thanks for keeping the scope of this change smaller", "author": "nikklassen", "createdAt": "2020-04-20T13:32:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI4MzkyNQ=="}], "type": "inlineReview"}, {"oid": "426f1e0956bc82abd7d3c3ff1b50fa9dc1d94fa4", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/426f1e0956bc82abd7d3c3ff1b50fa9dc1d94fa4", "message": "Changes made as per requested changes on the pull request by Nik and Internal QA issue fixes for FISMA popup in WCP sign in", "committedDate": "2020-04-18T12:15:33Z", "type": "commit"}, {"oid": "aeb31ca57650137b2917cd347f0a17dc36346baa", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/aeb31ca57650137b2917cd347f0a17dc36346baa", "message": "Merge branch 'early-access' into early-access-build", "committedDate": "2020-04-20T14:08:53Z", "type": "commit"}]}