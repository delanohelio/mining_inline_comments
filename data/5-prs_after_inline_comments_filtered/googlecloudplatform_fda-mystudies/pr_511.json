{"pr_number": 511, "pr_title": "User-mgmt: combine confirmation emails, improve logs", "pr_createdAt": "2020-06-14T21:59:10Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511", "timeline": [{"oid": "1400c98ae5f744b11f8e07b67c2bef3774405611", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/1400c98ae5f744b11f8e07b67c2bef3774405611", "message": "User-mgmt: combine confirmation and resent confirmation email.", "committedDate": "2020-06-14T21:58:19Z", "type": "commit"}, {"oid": "f6b5710bcc9ac61244a31efd0f749c818dff044b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f6b5710bcc9ac61244a31efd0f749c818dff044b", "message": "User-mgmt: improve error logs", "committedDate": "2020-06-14T21:58:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MTgwOQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511#discussion_r440271809", "bodyText": "\" bad request.\"?", "author": "nikklassen", "createdAt": "2020-06-15T15:45:43Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/VerifyEmailIdController.java", "diffHunk": "@@ -70,7 +70,7 @@\n       verifyEmailIdResponse.setCode(HttpStatus.BAD_REQUEST.value());\n       verifyEmailIdResponse.setMessage(\n           MyStudiesUserRegUtil.ErrorCodes.INVALID_INPUT_ERROR_MSG.getValue());\n-      logger.info(AppConstants.VERIFY_EMAILID_CONTROLLER_ENDS_MESSAGE);\n+      logger.warn(AppConstants.VERIFY_EMAILID_CONTROLLER_ENDS_MESSAGE + \"Bad request\");", "originalCommit": "f6b5710bcc9ac61244a31efd0f749c818dff044b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzODM0MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511#discussion_r440338341", "bodyText": "done.", "author": "zohrehj", "createdAt": "2020-06-15T17:37:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MTgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MzI3OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511#discussion_r440273278", "bodyText": "nit: should we use the format // TODO(#496)? Not sure if it really makes them easier to find, but it could help.", "author": "nikklassen", "createdAt": "2020-06-15T15:47:55Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/controller/UserRegistrationController.java", "diffHunk": "@@ -245,26 +250,12 @@ void deleteUserFromAuthServer(AuthRegistrationResponseBean authServerResponse, S\n     List<String> emailContent = null;\n     if (otp != null) {\n       emailContent = new ArrayList<>();\n-      String message =\n-          \"<html>\"\n-              + \"<body>\"\n-              + \"<div style='margin:20px;padding:10px;font-family: sans-serif;font-size: 14px;'>\"\n-              + \"<span>Hi,</span><br/><br/>\"\n-              + \"<span>Thank you for registering with us! We look forward to having you on board and actively taking part in<br/>research studies conducted by the &lt;Org Name&gt; and its partners.</span><br/><br/>\"\n-              + \"<span>Your sign-up process is almost complete. Please use the verification code provided below to<br/>complete the Verification step in the mobile app. </span><br/><br/>\"\n-              + \"<span><strong>Verification Code: </strong>\"\n-              + otp\n-              + \"</span><br/><br/>\"\n-              + \"<span>This code can be used only once and is valid for a period of 48 hours only.</span><br/><br/>\"\n-              + \"<span>Please note that  registration (or sign up) for the app  is requested only to provide you with a <br/>seamless experience of using the app. Your registration information does not become part of <br/>the data collected for any study housed in the app. Each study has its own consent process <br/> and no data for any study will not be collected unless and until you provide an informed consent<br/> prior to joining the study </span><br/><br/>\"\n-              + \"<span>For any questions or assistance, please write to <a> &lt;contact email address&gt; </a> </span><br/><br/>\"\n-              + \"<span style='font-size:15px;'>Thanks,</span><br/><span>The &lt;Org Name&gt; MyStudies Support Team</span>\"\n-              + \"<br/><span>----------------------------------------------------</span><br/>\"\n-              + \"<span style='font-size:10px;'>PS - This is an auto-generated email. Please do not reply.</span>\"\n-              + \"</div>\"\n-              + \"</body>\"\n-              + \"</html>\";\n-      String subject = \"Welcome to the <App Name> App!\";\n+      Map<String, String> emailMap = new HashMap<String, String>();\n+      emailMap.put(\"$securitytoken\", otp);\n+      // TODO: replace with actual study's org name in #496.", "originalCommit": "f6b5710bcc9ac61244a31efd0f749c818dff044b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzOTM3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511#discussion_r440339379", "bodyText": "Good idea. Fixed in both places.", "author": "zohrehj", "createdAt": "2020-06-15T17:39:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3MzI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3NDI3OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511#discussion_r440274279", "bodyText": "logger.debug for consistency.", "author": "nikklassen", "createdAt": "2020-06-15T15:49:25Z", "path": "user-registration-server-ws/user-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/util/Mail.java", "diffHunk": "@@ -159,7 +159,7 @@ public boolean sendMailWithAttachment() throws Exception {\n         } catch (Exception e) {\n             logger.error(\"ERROR:  sendemail() - \" + e + \" : \");\n         }\n-        logger.info(\"Mail.sendemail() :: Ends\");\n+        logger.info(\"Mail.sendMailWithAttachment() :: Ends\");", "originalCommit": "f6b5710bcc9ac61244a31efd0f749c818dff044b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM0MDAwNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/511#discussion_r440340007", "bodyText": "Good catch! fixed it.", "author": "zohrehj", "createdAt": "2020-06-15T17:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI3NDI3OQ=="}], "type": "inlineReview"}, {"oid": "a12799c3ffb52f1d0a26dad3621777c0de230883", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/a12799c3ffb52f1d0a26dad3621777c0de230883", "message": "Make format consistent.", "committedDate": "2020-06-15T17:44:26Z", "type": "commit"}, {"oid": "09d96454fc4f9e890a0ec47e2bd6455e5830e8c8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/09d96454fc4f9e890a0ec47e2bd6455e5830e8c8", "message": "Merge branch 'early-access' into user-mgmt", "committedDate": "2020-06-15T17:44:50Z", "type": "commit"}, {"oid": "726d5eec5d32fdaf0bd518baf6a55b2a51ed4204", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/726d5eec5d32fdaf0bd518baf6a55b2a51ed4204", "message": "Merge branch 'early-access' into user-mgmt", "committedDate": "2020-06-15T18:50:33Z", "type": "commit"}]}