{"pr_number": 128, "pr_title": "Create utility to substitute environment vars in WCP-WS", "pr_createdAt": "2020-04-09T22:34:39Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/128", "timeline": [{"oid": "163260e425d574183da0934a1c8784377ed7527e", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/163260e425d574183da0934a1c8784377ed7527e", "message": "Add new utility that substitutes environment variables from a provided properties file into a Java Properties class.", "committedDate": "2020-04-09T22:27:07Z", "type": "commit"}, {"oid": "6cd499b2d9305ea98518fd8b6a69038a2bae647a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/6cd499b2d9305ea98518fd8b6a69038a2bae647a", "message": "Rename properties file to be inline with other services.", "committedDate": "2020-04-09T22:30:45Z", "type": "commit"}, {"oid": "07f528a799a010b28fb268ac3666f51f35ac81ec", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/07f528a799a010b28fb268ac3666f51f35ac81ec", "message": "Use new util use Properties with correctly substituted environment variables.", "committedDate": "2020-04-09T22:32:11Z", "type": "commit"}, {"oid": "21bbd9643f66711970575fa55942eb692123cbb8", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/21bbd9643f66711970575fa55942eb692123cbb8", "message": "Only allow environment vars in the form .", "committedDate": "2020-04-13T16:47:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU4NTQzMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/128#discussion_r407585432", "bodyText": "Should this stay as \"application_local.properties\"? I think the files are here: https://github.com/GoogleCloudPlatform/fda-mystudies/tree/early-access/WCP-WS/src/main/resources", "author": "kuoyuchi", "createdAt": "2020-04-13T16:54:51Z", "path": "WCP-WS/src/main/java/com/hphc/mystudies/util/HibernateUtil.java", "diffHunk": "@@ -42,18 +42,9 @@ public static SessionFactory getSessionFactory() {\n     logger.info(\"INFO: HibernateUtil - getSessionFactory() :: Starts\");\n     try {\n       if (sessionFactory == null) {\n-\n-        InputStream inputStream =\n-            HibernateUtil.class\n-                .getClassLoader()\n-                .getResourceAsStream(\"application_local.properties\");\n-\n-        Properties properties = new Properties();\n-\n-        properties.load(inputStream);\n         sessionFactory =\n             new AnnotationConfiguration()\n-                .addProperties(properties)\n+                .addProperties(PropertiesUtil.makePropertiesWithEnvironmentVariables(\"application.properties\"))", "originalCommit": "21bbd9643f66711970575fa55942eb692123cbb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYxMDY0NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/128#discussion_r407610645", "bodyText": "I changed the name in an earlier commit. application.properties is what we use for the other services so changed it to mirror that. Also I think application_local.properties would be the name of the dev file if we were using the property file hierarchy as intended so application.properties makes more sense.", "author": "wamills", "createdAt": "2020-04-13T17:40:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU4NTQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYyMzcwOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/128#discussion_r407623708", "bodyText": "SGTM. Thanks for explaining.", "author": "kuoyuchi", "createdAt": "2020-04-13T18:03:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU4NTQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU4NTU2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/128#discussion_r407585561", "bodyText": "application_local.properties", "author": "kuoyuchi", "createdAt": "2020-04-13T16:55:04Z", "path": "WCP-WS/src/main/java/com/hphc/mystudies/util/StudyMetaDataUtil.java", "diffHunk": "@@ -74,11 +74,8 @@ public static HashMap getAppProperties() {\n         hm.put(key, value);\n       }\n       ServletContext context = ServletContextHolder.getServletContext();\n-      Properties prop = new Properties();\n \n-      InputStream inputStream =\n-          HibernateUtil.class.getClassLoader().getResourceAsStream(\"application_local.properties\");\n-      prop.load(inputStream);\n+      Properties prop = PropertiesUtil.makePropertiesWithEnvironmentVariables(\"application.properties\");", "originalCommit": "21bbd9643f66711970575fa55942eb692123cbb8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzYxMDczNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/128#discussion_r407610737", "bodyText": "see other comment.", "author": "wamills", "createdAt": "2020-04-13T17:40:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzU4NTU2MQ=="}], "type": "inlineReview"}, {"oid": "23520c8ab19d0ef97916a20eb116fe87fd36b58c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/23520c8ab19d0ef97916a20eb116fe87fd36b58c", "message": "Rename META-INF context path for application.properties.", "committedDate": "2020-04-13T17:42:55Z", "type": "commit"}, {"oid": "4b716b2c8888a6c716202c585e72497bebcb2c07", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4b716b2c8888a6c716202c585e72497bebcb2c07", "message": "Merge branch 'early-access' into wamills_wcp_env_var_fix", "committedDate": "2020-04-13T17:47:06Z", "type": "commit"}]}