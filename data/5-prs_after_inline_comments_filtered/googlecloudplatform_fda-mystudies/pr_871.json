{"pr_number": 871, "pr_title": "Consent Service : Replace Model BO with Entity classes from common service", "pr_createdAt": "2020-09-03T15:47:31Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871", "timeline": [{"oid": "f40db11bf25b293101968f68d6b15ae34a5c4d95", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f40db11bf25b293101968f68d6b15ae34a5c4d95", "message": "Data Integrity - Integration with Consent Service\n\nData Integrity - Integration with Consent Service", "committedDate": "2020-09-02T07:33:56Z", "type": "commit"}, {"oid": "331b862a6216404f11da510c238022e35e401989", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/331b862a6216404f11da510c238022e35e401989", "message": "data integrity of consent service\n\ndata integrity of consent service", "committedDate": "2020-09-03T06:53:18Z", "type": "commit"}, {"oid": "18a3df3ec50d1e929ed2df1fed5ba3054f8a35a5", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/18a3df3ec50d1e929ed2df1fed5ba3054f8a35a5", "message": "Added DataSharingEnum\n\nAdded DataSharingEnum", "committedDate": "2020-09-03T15:36:44Z", "type": "commit"}, {"oid": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/76b18cb22ffe4c4a542a21db2611b810317f65c0", "message": "removed unused BO\n\nremoved unused BO", "committedDate": "2020-09-03T15:45:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI2OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080269", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'participantStudiesBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:14Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserConsentManagementServiceImpl.java", "diffHunk": "@@ -42,9 +44,9 @@\n       LoggerFactory.getLogger(UserConsentManagementServiceImpl.class);\n \n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementServiceImpl getParticipantStudies() - Started \");\n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI3Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080272", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'participantStudiesBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:14Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/service/UserConsentManagementServiceImpl.java", "diffHunk": "@@ -96,11 +98,11 @@ public String saveStudyConsent(StudyConsentBO studyConsent) {\n \n   @Override\n   public ConsentStudyResponseBean getStudyConsentDetails(\n-      String userId, Integer studyId, String consentVersion, AuditLogEventRequest auditRequest) {\n+      String userId, String studyId, String consentVersion, AuditLogEventRequest auditRequest) {\n \n     logger.info(\"UserConsentManagementServiceImpl getStudyConsentDetails() - Started \");\n-    StudyConsentBO studyConsent = null;\n-    ParticipantStudiesBO participantStudiesBO = null;\n+    StudyConsentEntity studyConsent = null;\n+    ParticipantStudyEntity participantStudiesBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI3NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080274", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'appDetailsBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:14Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/CommonDaoImpl.java", "diffHunk": "@@ -43,41 +42,41 @@ public AppOrgInfoBean getUserAppDetailsByAllApi(String userId, String appId, Str\n     logger.info(\"UserConsentManagementDaoImpl validatedUserAppDetailsByAllApi() - Started \");\n     Transaction transaction = null;\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<AppInfoDetailsBO> appDetailsBoCriteria = null;\n-    Root<AppInfoDetailsBO> appDetailsBoRoot = null;\n+    CriteriaQuery<AppEntity> appDetailsBoCriteria = null;\n+    Root<AppEntity> appDetailsBoRoot = null;\n     Predicate[] appDetailsPredicates = new Predicate[1];\n-    List<AppInfoDetailsBO> appDetailsList = null;\n-    AppInfoDetailsBO appDetailsBO = null;\n+    List<AppEntity> appDetailsList = null;\n+    AppEntity appDetailsBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI3OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080278", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'userDetailsBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:14Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/CommonDaoImpl.java", "diffHunk": "@@ -100,35 +99,34 @@ public AppOrgInfoBean getUserAppDetailsByAllApi(String userId, String appId, Str\n   }\n \n   @Override\n-  public Integer getUserDetailsId(String userId) {\n+  public String getUserDetailsId(String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyInfoId() - Starts \");\n     Transaction transaction = null;\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<UserDetailsBO> userDetailsBoCriteria = null;\n-    Root<UserDetailsBO> userDetailsBoRoot = null;\n-    List<UserDetailsBO> userDetailsBoList = null;\n+    CriteriaQuery<UserDetailsEntity> userDetailsBoCriteria = null;\n+    Root<UserDetailsEntity> userDetailsBoRoot = null;\n+    List<UserDetailsEntity> userDetailsBoList = null;\n     Predicate[] userDetailspredicates = new Predicate[1];\n-    UserDetailsBO userDetailsBO = null;\n-    Integer userDetailsId = 0;\n+    UserDetailsEntity userDetailsBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI4Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080282", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'participantStudiesBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:15Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -41,44 +45,46 @@\n \n   @Autowired private EntityManagerFactory entityManagerFactory;\n \n+  @Autowired StudyRepository studyRepository;\n+\n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getParticipantStudies() - Started \");\n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI4Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080283", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'userDetailsBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:15Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -41,44 +45,46 @@\n \n   @Autowired private EntityManagerFactory entityManagerFactory;\n \n+  @Autowired StudyRepository studyRepository;\n+\n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getParticipantStudies() - Started \");\n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesBO = null;\n     CriteriaBuilder criteriaBuilder = null;\n \n-    CriteriaQuery<StudyInfoBO> studiesBoCriteria = null;\n-    Root<StudyInfoBO> studiesBoRoot = null;\n+    CriteriaQuery<StudyEntity> studiesBoCriteria = null;\n+    Root<StudyEntity> studiesBoRoot = null;\n     Predicate[] studiesBoPredicates = new Predicate[1];\n \n-    List<StudyInfoBO> studiesBoList = null;\n-    StudyInfoBO studyInfo = null;\n+    List<StudyEntity> studiesBoList = null;\n+    StudyEntity studyInfo = null;\n \n-    CriteriaQuery<ParticipantStudiesBO> participantStudiesBoCriteria = null;\n-    Root<ParticipantStudiesBO> participantStudiesBoRoot = null;\n+    CriteriaQuery<ParticipantStudyEntity> participantStudiesBoCriteria = null;\n+    Root<ParticipantStudyEntity> participantStudiesBoRoot = null;\n     Predicate[] predicates = new Predicate[2];\n-    List<ParticipantStudiesBO> participantStudiesBoList = null;\n+    List<ParticipantStudyEntity> participantStudiesBoList = null;\n \n-    CriteriaQuery<UserDetailsBO> userDetailsBoCriteria = null;\n-    Root<UserDetailsBO> userDetailsBoRoot = null;\n-    List<UserDetailsBO> userDetailsBoList = null;\n+    CriteriaQuery<UserDetailsEntity> userDetailsBoCriteria = null;\n+    Root<UserDetailsEntity> userDetailsBoRoot = null;\n+    List<UserDetailsEntity> userDetailsBoList = null;\n     Predicate[] userDetailspredicates = new Predicate[1];\n-    UserDetailsBO userDetailsBO = null;\n+    UserDetailsEntity userDetailsBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI4NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080285", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'userDetailsBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:15Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -162,56 +166,56 @@ public String saveParticipantStudies(List<ParticipantStudiesBO> participantStudi\n   }\n \n   @Override\n-  public StudyConsentBO getStudyConsent(String userId, Integer studyId, String consentVersion) {\n+  public StudyConsentEntity getStudyConsent(String userId, String studyId, String consentVersion) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyConsent() - Started \");\n-    StudyConsentBO studyConsent = null;\n+    StudyConsentEntity studyConsent = null;\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<StudyConsentBO> criteriaQuery = null;\n-    Root<StudyConsentBO> studyConsentBoRoot = null;\n+    CriteriaQuery<StudyConsentEntity> criteriaQuery = null;\n+    Root<StudyConsentEntity> studyConsentBoRoot = null;\n     Predicate[] predicates;\n-    List<StudyConsentBO> studyConsentBoList = null;\n-    CriteriaQuery<UserDetailsBO> userDetailsBoCriteria = null;\n-    Root<UserDetailsBO> userDetailsBoRoot = null;\n-    List<UserDetailsBO> userDetailsBoList = null;\n+    List<StudyConsentEntity> studyConsentBoList = null;\n+    CriteriaQuery<UserDetailsEntity> userDetailsBoCriteria = null;\n+    Root<UserDetailsEntity> userDetailsBoRoot = null;\n+    List<UserDetailsEntity> userDetailsBoList = null;\n     Predicate[] userDetailspredicates = new Predicate[1];\n-    UserDetailsBO userDetailsBO = null;\n-    Integer userDetailsId = 0;\n+    UserDetailsEntity userDetailsBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI4OA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080288", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'appDetailsBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:15Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -279,39 +284,39 @@ public String saveStudyConsent(StudyConsentBO studyConsent) {\n   public AppOrgInfoBean getUserAppDetailsByAllApi(String userId, String appId, String orgId) {\n     logger.info(\"UserConsentManagementDaoImpl validatedUserAppDetailsByAllApi() - Started \");\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<AppInfoDetailsBO> appDetailsBoCriteria = null;\n-    Root<AppInfoDetailsBO> appDetailsBoRoot = null;\n+    CriteriaQuery<AppEntity> appDetailsBoCriteria = null;\n+    Root<AppEntity> appDetailsBoRoot = null;\n     Predicate[] appDetailsPredicates = new Predicate[1];\n-    List<AppInfoDetailsBO> appDetailsList = null;\n-    AppInfoDetailsBO appDetailsBO = null;\n+    List<AppEntity> appDetailsList = null;\n+    AppEntity appDetailsBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080290", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'studyInfoBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:15Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -336,17 +341,17 @@ public StudyInfoBean getStudyInfoId(String customStudyId) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyInfoId() - Starts \");\n     StudyInfoBean studyInfoBean = new StudyInfoBean();\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<StudyInfoBO> studyInfoBoCriteria = null;\n-    Root<StudyInfoBO> studyInfoBoRoot = null;\n+    CriteriaQuery<StudyEntity> studyInfoBoCriteria = null;\n+    Root<StudyEntity> studyInfoBoRoot = null;\n     Predicate[] studyInfoPredicates = new Predicate[1];\n-    List<StudyInfoBO> studyInfoList = null;\n-    StudyInfoBO studyInfoBO = null;\n-    Integer studyInfoId = 0;\n+    List<StudyEntity> studyInfoList = null;\n+    StudyEntity studyInfoBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzA4MDI5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r483080292", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nAbbreviation in name 'userDetailsBO' must contain no more than '1' consecutive capital letters.", "author": "github-actions", "createdAt": "2020-09-03T15:48:15Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -368,31 +373,31 @@ public StudyInfoBean getStudyInfoId(String customStudyId) {\n   }\n \n   @Override\n-  public Integer getUserDetailsId(String userId) {\n+  public String getUserDetailsId(String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyInfoId() - Starts \");\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<UserDetailsBO> userDetailsBoCriteria = null;\n-    Root<UserDetailsBO> userDetailsBoRoot = null;\n-    List<UserDetailsBO> userDetailsBoList = null;\n+    CriteriaQuery<UserDetailsEntity> userDetailsBoCriteria = null;\n+    Root<UserDetailsEntity> userDetailsBoRoot = null;\n+    List<UserDetailsEntity> userDetailsBoList = null;\n     Predicate[] userDetailspredicates = new Predicate[1];\n-    UserDetailsBO userDetailsBO = null;\n-    Integer userDetailsId = 0;\n+    UserDetailsEntity userDetailsBO = null;", "originalCommit": "76b18cb22ffe4c4a542a21db2611b810317f65c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3bd7da17764d0745d031513852a898ffc7bfbe86", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3bd7da17764d0745d031513852a898ffc7bfbe86", "message": "Fixed comment\n\nFixed comment", "committedDate": "2020-09-07T15:06:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ4NDgyNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r484484825", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 104).", "author": "github-actions", "createdAt": "2020-09-07T15:08:27Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -162,56 +166,56 @@ public String saveParticipantStudies(List<ParticipantStudiesBO> participantStudi\n   }\n \n   @Override\n-  public StudyConsentBO getStudyConsent(String userId, Integer studyId, String consentVersion) {\n+  public StudyConsentEntity getStudyConsent(String userId, String studyId, String consentVersion) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyConsent() - Started \");\n-    StudyConsentBO studyConsent = null;\n+    StudyConsentEntity studyConsent = null;\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<StudyConsentBO> criteriaQuery = null;\n-    Root<StudyConsentBO> studyConsentBoRoot = null;\n+    CriteriaQuery<StudyConsentEntity> criteriaQuery = null;\n+    Root<StudyConsentEntity> studyConsentBoRoot = null;\n     Predicate[] predicates;\n-    List<StudyConsentBO> studyConsentBoList = null;\n-    CriteriaQuery<UserDetailsBO> userDetailsBoCriteria = null;\n-    Root<UserDetailsBO> userDetailsBoRoot = null;\n-    List<UserDetailsBO> userDetailsBoList = null;\n+    List<StudyConsentEntity> studyConsentBoList = null;\n+    CriteriaQuery<UserDetailsEntity> userDetailsBoCriteria = null;\n+    Root<UserDetailsEntity> userDetailsBoRoot = null;\n+    List<UserDetailsEntity> userDetailsBoList = null;\n     Predicate[] userDetailspredicates = new Predicate[1];\n-    UserDetailsBO userDetailsBO = null;\n-    Integer userDetailsId = 0;\n+    UserDetailsEntity userDetailsEntity = null;\n+\n+    Optional<StudyEntity> optStudy = studyRepository.findById(studyId);\n \n     try (Session session = entityManagerFactory.unwrap(SessionFactory.class).openSession()) {\n       criteriaBuilder = session.getCriteriaBuilder();\n       if (!StringUtils.isEmpty(userId)) {\n-        userDetailsBoCriteria = criteriaBuilder.createQuery(UserDetailsBO.class);\n-        userDetailsBoRoot = userDetailsBoCriteria.from(UserDetailsBO.class);\n+        userDetailsBoCriteria = criteriaBuilder.createQuery(UserDetailsEntity.class);\n+        userDetailsBoRoot = userDetailsBoCriteria.from(UserDetailsEntity.class);\n         userDetailspredicates[0] =\n             criteriaBuilder.equal(userDetailsBoRoot.get(AppConstants.KEY_USERID), userId);\n         userDetailsBoCriteria.select(userDetailsBoRoot).where(userDetailspredicates);\n         userDetailsBoList = session.createQuery(userDetailsBoCriteria).getResultList();\n         if (!userDetailsBoList.isEmpty()) {\n-          userDetailsBO = userDetailsBoList.get(0);\n-          userDetailsId = userDetailsBO.getUserDetailsId();\n+          userDetailsEntity = userDetailsBoList.get(0);\n         }\n       }\n-      criteriaQuery = criteriaBuilder.createQuery(StudyConsentBO.class);\n-      studyConsentBoRoot = criteriaQuery.from(StudyConsentBO.class);\n+      criteriaQuery = criteriaBuilder.createQuery(StudyConsentEntity.class);\n+      studyConsentBoRoot = criteriaQuery.from(StudyConsentEntity.class);\n       if ((consentVersion != null) && !StringUtils.isEmpty(consentVersion)) {\n         predicates = new Predicate[3];\n-        predicates[0] =\n-            criteriaBuilder.equal(studyConsentBoRoot.get(AppConstants.KEY_USERID), userDetailsId);\n-        predicates[1] =\n-            criteriaBuilder.equal(studyConsentBoRoot.get(AppConstants.STUDY_INFO_ID), studyId);\n+        predicates[0] = criteriaBuilder.equal(studyConsentBoRoot.get(\"userDetails\"), userDetailsEntity);", "originalCommit": "3bd7da17764d0745d031513852a898ffc7bfbe86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDQ4NDgyNw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r484484827", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nLine is longer than 100 characters (found 104).", "author": "github-actions", "createdAt": "2020-09-07T15:08:27Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -162,56 +166,56 @@ public String saveParticipantStudies(List<ParticipantStudiesBO> participantStudi\n   }\n \n   @Override\n-  public StudyConsentBO getStudyConsent(String userId, Integer studyId, String consentVersion) {\n+  public StudyConsentEntity getStudyConsent(String userId, String studyId, String consentVersion) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyConsent() - Started \");\n-    StudyConsentBO studyConsent = null;\n+    StudyConsentEntity studyConsent = null;\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<StudyConsentBO> criteriaQuery = null;\n-    Root<StudyConsentBO> studyConsentBoRoot = null;\n+    CriteriaQuery<StudyConsentEntity> criteriaQuery = null;\n+    Root<StudyConsentEntity> studyConsentBoRoot = null;\n     Predicate[] predicates;\n-    List<StudyConsentBO> studyConsentBoList = null;\n-    CriteriaQuery<UserDetailsBO> userDetailsBoCriteria = null;\n-    Root<UserDetailsBO> userDetailsBoRoot = null;\n-    List<UserDetailsBO> userDetailsBoList = null;\n+    List<StudyConsentEntity> studyConsentBoList = null;\n+    CriteriaQuery<UserDetailsEntity> userDetailsBoCriteria = null;\n+    Root<UserDetailsEntity> userDetailsBoRoot = null;\n+    List<UserDetailsEntity> userDetailsBoList = null;\n     Predicate[] userDetailspredicates = new Predicate[1];\n-    UserDetailsBO userDetailsBO = null;\n-    Integer userDetailsId = 0;\n+    UserDetailsEntity userDetailsEntity = null;\n+\n+    Optional<StudyEntity> optStudy = studyRepository.findById(studyId);\n \n     try (Session session = entityManagerFactory.unwrap(SessionFactory.class).openSession()) {\n       criteriaBuilder = session.getCriteriaBuilder();\n       if (!StringUtils.isEmpty(userId)) {\n-        userDetailsBoCriteria = criteriaBuilder.createQuery(UserDetailsBO.class);\n-        userDetailsBoRoot = userDetailsBoCriteria.from(UserDetailsBO.class);\n+        userDetailsBoCriteria = criteriaBuilder.createQuery(UserDetailsEntity.class);\n+        userDetailsBoRoot = userDetailsBoCriteria.from(UserDetailsEntity.class);\n         userDetailspredicates[0] =\n             criteriaBuilder.equal(userDetailsBoRoot.get(AppConstants.KEY_USERID), userId);\n         userDetailsBoCriteria.select(userDetailsBoRoot).where(userDetailspredicates);\n         userDetailsBoList = session.createQuery(userDetailsBoCriteria).getResultList();\n         if (!userDetailsBoList.isEmpty()) {\n-          userDetailsBO = userDetailsBoList.get(0);\n-          userDetailsId = userDetailsBO.getUserDetailsId();\n+          userDetailsEntity = userDetailsBoList.get(0);\n         }\n       }\n-      criteriaQuery = criteriaBuilder.createQuery(StudyConsentBO.class);\n-      studyConsentBoRoot = criteriaQuery.from(StudyConsentBO.class);\n+      criteriaQuery = criteriaBuilder.createQuery(StudyConsentEntity.class);\n+      studyConsentBoRoot = criteriaQuery.from(StudyConsentEntity.class);\n       if ((consentVersion != null) && !StringUtils.isEmpty(consentVersion)) {\n         predicates = new Predicate[3];\n-        predicates[0] =\n-            criteriaBuilder.equal(studyConsentBoRoot.get(AppConstants.KEY_USERID), userDetailsId);\n-        predicates[1] =\n-            criteriaBuilder.equal(studyConsentBoRoot.get(AppConstants.STUDY_INFO_ID), studyId);\n+        predicates[0] = criteriaBuilder.equal(studyConsentBoRoot.get(\"userDetails\"), userDetailsEntity);\n+        if (optStudy.isPresent()) {\n+          predicates[1] = criteriaBuilder.equal(studyConsentBoRoot.get(\"study\"), optStudy.get());\n+        }\n         predicates[2] = criteriaBuilder.equal(studyConsentBoRoot.get(\"version\"), consentVersion);\n       } else {\n         predicates = new Predicate[2];\n-        predicates[0] =\n-            criteriaBuilder.equal(studyConsentBoRoot.get(AppConstants.KEY_USERID), userDetailsId);\n-        predicates[1] =\n-            criteriaBuilder.equal(studyConsentBoRoot.get(AppConstants.STUDY_INFO_ID), studyId);\n+        predicates[0] = criteriaBuilder.equal(studyConsentBoRoot.get(\"userDetails\"), userDetailsEntity);", "originalCommit": "3bd7da17764d0745d031513852a898ffc7bfbe86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f66cedf27762792c9ccbe5815cafaf26ca69c7d9", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f66cedf27762792c9ccbe5815cafaf26ca69c7d9", "message": "Fixed comment\n\nFixed comment", "committedDate": "2020-09-07T15:14:31Z", "type": "commit"}, {"oid": "3c71f0c4b635e3ff0db362281f881210ebba79c7", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3c71f0c4b635e3ff0db362281f881210ebba79c7", "message": "Merge branch 'develop' into consent-data-integrity", "committedDate": "2020-09-10T11:52:57Z", "type": "commit"}, {"oid": "8df5ddc4ae5aa577be097e5d92470213f9824b14", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8df5ddc4ae5aa577be097e5d92470213f9824b14", "message": "Merge branch 'develop' into consent-data-integrity", "committedDate": "2020-09-11T07:01:24Z", "type": "commit"}, {"oid": "034f7dc2f8ce30a131d363512d0a6c8f34f55464", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/034f7dc2f8ce30a131d363512d0a6c8f34f55464", "message": "Resolved conflicts\n\nResolved conflicts", "committedDate": "2020-09-11T14:14:27Z", "type": "commit"}, {"oid": "2710a1de9cd834affb53f82dd797df56f72fb3b0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/2710a1de9cd834affb53f82dd797df56f72fb3b0", "message": "Reolved conflicts\n\nReolved conflicts", "committedDate": "2020-09-16T04:39:23Z", "type": "commit"}, {"oid": "08a809a35ff23e299f09a430ad0489f10ee74e6f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/08a809a35ff23e299f09a430ad0489f10ee74e6f", "message": "Merge branch 'develop' into consent-data-integrity", "committedDate": "2020-09-16T05:44:21Z", "type": "commit"}, {"oid": "00c68d4defd8518dc01048b5ddc1cac096a31790", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/00c68d4defd8518dc01048b5ddc1cac096a31790", "message": "resolved conflicts\n\nresolved conflicts", "committedDate": "2020-09-17T06:48:24Z", "type": "commit"}, {"oid": "7ff07644dcb6fa6e95be81262f32ed27c2c66f3c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7ff07644dcb6fa6e95be81262f32ed27c2c66f3c", "message": "Merge branch 'develop' into consent-data-integrity", "committedDate": "2020-09-17T07:01:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTE4Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r490015183", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'studiesBoList' declaration and its first usage is 6, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-17T07:02:09Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -38,97 +42,98 @@\n \n   @Autowired private SessionFactory sessionFactory;\n \n+  @Autowired StudyRepository studyRepository;\n+\n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getParticipantStudies() - Started \");\n+\n     Session session = this.sessionFactory.getCurrentSession();\n \n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesEntity = null;\n     CriteriaBuilder criteriaBuilder = null;\n \n-    CriteriaQuery<StudyInfoBO> studiesBoCriteria = null;\n-    Root<StudyInfoBO> studiesBoRoot = null;\n+    CriteriaQuery<StudyEntity> studiesBoCriteria = null;\n+    Root<StudyEntity> studiesBoRoot = null;\n     Predicate[] studiesBoPredicates = new Predicate[1];\n \n-    List<StudyInfoBO> studiesBoList = null;\n-    StudyInfoBO studyInfo = null;\n+    List<StudyEntity> studiesBoList = null;", "originalCommit": "7ff07644dcb6fa6e95be81262f32ed27c2c66f3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTE4Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r490015187", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'participantStudiesBoCriteria' declaration and its first usage is 7, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-17T07:02:09Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -38,97 +42,98 @@\n \n   @Autowired private SessionFactory sessionFactory;\n \n+  @Autowired StudyRepository studyRepository;\n+\n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getParticipantStudies() - Started \");\n+\n     Session session = this.sessionFactory.getCurrentSession();\n \n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesEntity = null;\n     CriteriaBuilder criteriaBuilder = null;\n \n-    CriteriaQuery<StudyInfoBO> studiesBoCriteria = null;\n-    Root<StudyInfoBO> studiesBoRoot = null;\n+    CriteriaQuery<StudyEntity> studiesBoCriteria = null;\n+    Root<StudyEntity> studiesBoRoot = null;\n     Predicate[] studiesBoPredicates = new Predicate[1];\n \n-    List<StudyInfoBO> studiesBoList = null;\n-    StudyInfoBO studyInfo = null;\n+    List<StudyEntity> studiesBoList = null;\n+    StudyEntity studyInfo = null;\n \n-    CriteriaQuery<ParticipantStudiesBO> participantStudiesBoCriteria = null;\n-    Root<ParticipantStudiesBO> participantStudiesBoRoot = null;\n+    CriteriaQuery<ParticipantStudyEntity> participantStudiesBoCriteria = null;", "originalCommit": "7ff07644dcb6fa6e95be81262f32ed27c2c66f3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTE5MA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r490015190", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'participantStudiesBoRoot' declaration and its first usage is 8, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-17T07:02:09Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -38,97 +42,98 @@\n \n   @Autowired private SessionFactory sessionFactory;\n \n+  @Autowired StudyRepository studyRepository;\n+\n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getParticipantStudies() - Started \");\n+\n     Session session = this.sessionFactory.getCurrentSession();\n \n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesEntity = null;\n     CriteriaBuilder criteriaBuilder = null;\n \n-    CriteriaQuery<StudyInfoBO> studiesBoCriteria = null;\n-    Root<StudyInfoBO> studiesBoRoot = null;\n+    CriteriaQuery<StudyEntity> studiesBoCriteria = null;\n+    Root<StudyEntity> studiesBoRoot = null;\n     Predicate[] studiesBoPredicates = new Predicate[1];\n \n-    List<StudyInfoBO> studiesBoList = null;\n-    StudyInfoBO studyInfo = null;\n+    List<StudyEntity> studiesBoList = null;\n+    StudyEntity studyInfo = null;\n \n-    CriteriaQuery<ParticipantStudiesBO> participantStudiesBoCriteria = null;\n-    Root<ParticipantStudiesBO> participantStudiesBoRoot = null;\n+    CriteriaQuery<ParticipantStudyEntity> participantStudiesBoCriteria = null;\n+    Root<ParticipantStudyEntity> participantStudiesBoRoot = null;", "originalCommit": "7ff07644dcb6fa6e95be81262f32ed27c2c66f3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxNTE5Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r490015193", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'studyConsentBoRoot' declaration and its first usage is 4, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-17T07:02:09Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -137,64 +142,65 @@ public String saveParticipantStudies(List<ParticipantStudiesBO> participantStudi\n     if ((isUpdated > 0) || (isSaved > 0)) {\n       message = MyStudiesUserRegUtil.ErrorCodes.SUCCESS.getValue();\n     }\n-\n     logger.info(\"UserConsentManagementDaoImpl saveParticipantStudies() - Ends \");\n     return message;\n   }\n \n   @Override\n-  public StudyConsentBO getStudyConsent(String userId, Integer studyId, String consentVersion) {\n+  public StudyConsentEntity getStudyConsent(String userId, String studyId, String consentVersion) {\n     logger.info(\"UserConsentManagementDaoImpl getStudyConsent() - Started \");\n+    StudyConsentEntity studyConsent = null;\n \n     Session session = this.sessionFactory.getCurrentSession();\n \n-    StudyConsentBO studyConsent = null;\n     CriteriaBuilder criteriaBuilder = null;\n-    CriteriaQuery<StudyConsentBO> criteriaQuery = null;\n-    Root<StudyConsentBO> studyConsentBoRoot = null;\n+    CriteriaQuery<StudyConsentEntity> criteriaQuery = null;\n+    Root<StudyConsentEntity> studyConsentBoRoot = null;", "originalCommit": "7ff07644dcb6fa6e95be81262f32ed27c2c66f3c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3f500278db2f935f1fc8060e803402374818ba3a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3f500278db2f935f1fc8060e803402374818ba3a", "message": "Fixed comments\n\nFixed comments", "committedDate": "2020-09-17T07:16:34Z", "type": "commit"}, {"oid": "e572ac716ac0d31495f6c039f4232d2630e0fffd", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/e572ac716ac0d31495f6c039f4232d2630e0fffd", "message": "Merge branch 'consent-data-integrity' of https://github.com/GoogleCloudPlatform/fda-mystudies into consent-data-integrity", "committedDate": "2020-09-17T07:17:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAyMzkyNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/871#discussion_r490023924", "bodyText": "[consent-mgmt Checks] reported by reviewdog \ud83d\udc36\nDistance between variable 'participantStudiesBoRoot' declaration and its first usage is 6, but allowed 3.  Consider making that variable final if you still need to store its value in advance (before method calls that might have side effects on the original value).", "author": "github-actions", "createdAt": "2020-09-17T07:19:10Z", "path": "user-registration-server-ws/consent-mgmt-module/consent-mgmt/src/main/java/com/google/cloud/healthcare/fdamystudies/dao/UserConsentManagementDaoImpl.java", "diffHunk": "@@ -38,97 +42,97 @@\n \n   @Autowired private SessionFactory sessionFactory;\n \n+  @Autowired StudyRepository studyRepository;\n+\n   @Override\n-  public ParticipantStudiesBO getParticipantStudies(Integer studyId, String userId) {\n+  public ParticipantStudyEntity getParticipantStudies(String studyId, String userId) {\n     logger.info(\"UserConsentManagementDaoImpl getParticipantStudies() - Started \");\n+\n     Session session = this.sessionFactory.getCurrentSession();\n \n-    ParticipantStudiesBO participantStudiesBO = null;\n+    ParticipantStudyEntity participantStudiesEntity = null;\n     CriteriaBuilder criteriaBuilder = null;\n \n-    CriteriaQuery<StudyInfoBO> studiesBoCriteria = null;\n-    Root<StudyInfoBO> studiesBoRoot = null;\n+    CriteriaQuery<StudyEntity> studiesBoCriteria = null;\n+    Root<StudyEntity> studiesBoRoot = null;\n     Predicate[] studiesBoPredicates = new Predicate[1];\n \n-    List<StudyInfoBO> studiesBoList = null;\n-    StudyInfoBO studyInfo = null;\n+    StudyEntity studyInfo = null;\n \n-    CriteriaQuery<ParticipantStudiesBO> participantStudiesBoCriteria = null;\n-    Root<ParticipantStudiesBO> participantStudiesBoRoot = null;\n+    Root<ParticipantStudyEntity> participantStudiesBoRoot = null;", "originalCommit": "e572ac716ac0d31495f6c039f4232d2630e0fffd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bd470fcf92b32a7f7c758c264dafc151ac1b4125", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/bd470fcf92b32a7f7c758c264dafc151ac1b4125", "message": "Fixed comments\n\nFixed comments", "committedDate": "2020-09-17T07:35:01Z", "type": "commit"}, {"oid": "ff251baabad6ecf7c5ae55550de5d93493142939", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/ff251baabad6ecf7c5ae55550de5d93493142939", "message": "Merge branch 'develop' into consent-data-integrity", "committedDate": "2020-09-18T05:06:40Z", "type": "commit"}, {"oid": "212e497d6ff57e52eb247bda23a16048ee11a7d2", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/212e497d6ff57e52eb247bda23a16048ee11a7d2", "message": "Merge branch 'develop' into consent-data-integrity", "committedDate": "2020-09-18T05:26:02Z", "type": "commit"}]}