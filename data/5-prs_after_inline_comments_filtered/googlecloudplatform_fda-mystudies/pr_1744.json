{"pr_number": 1744, "pr_title": "SQL injection Fixes for remaining line of code in StudyDAOImpl.java", "pr_createdAt": "2020-10-30T11:31:33Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744", "timeline": [{"oid": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9cc76c844436867e862b2c1c0bd90e7e61823f83", "message": "SQL injection Fixes for remaining line of code in StudyDAOImpl.java\n\nSQL injection Fixes for remaining line of code in StudyDAOImpl.java", "committedDate": "2020-10-30T11:29:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEyNTcxMw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515125713", "bodyText": "please remove commented code", "author": "zohrehj", "createdAt": "2020-10-30T14:10:00Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -2890,12 +2851,17 @@ public boolean resetDraftStudyByCustomStudyId(\n         String permissionQuery =\n             \"select s.user_id,s.view_permission\"\n                 + \" from study_permission s, user_permission_mapping u, user_permissions p\"\n-                + \" where s.study_id=\"\n-                + liveStudyBo.getId()\n+                + \" where s.study_id= :id\"\n+                //                + liveStudyBo.getId()", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc3OTE3NQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515779175", "bodyText": "the fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:25:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEyNTcxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEyNjI0OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515126249", "bodyText": ":liveStudyBo.getId()  should be :id", "author": "zohrehj", "createdAt": "2020-10-30T14:10:52Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -2923,7 +2889,8 @@ public boolean resetDraftStudyByCustomStudyId(\n         session.save(studySequenceBo);\n \n         // Over View\n-        query = session.createQuery(\"from StudyPageBo where studyId=\" + liveStudyBo.getId());\n+        query = session.createQuery(\"from StudyPageBo where studyId= :liveStudyBo.getId() \");", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc3OTk0Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515779946", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:27:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEyNjI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEyNjY2Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515126663", "bodyText": "please remove", "author": "zohrehj", "createdAt": "2020-10-30T14:11:30Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -3029,10 +2994,13 @@ public boolean resetDraftStudyByCustomStudyId(\n                   .getFrequency()\n                   .equalsIgnoreCase(FdahpStudyDesignerConstants.FREQUENCY_TYPE_MANUALLY_SCHEDULE)) {\n                 searchQuery =\n-                    \"From QuestionnaireCustomScheduleBo QCSBO where QCSBO.questionnairesId=\"\n-                        + questionnaireBo.getId();\n+                    \"From QuestionnaireCustomScheduleBo QCSBO where QCSBO.questionnairesId=:id\";\n+                //                        + questionnaireBo.getId();", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MDEyMQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515780121", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:28:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTEyNjY2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MjMwNA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515162304", "bodyText": "please remove all commented code", "author": "zohrehj", "createdAt": "2020-10-30T15:00:09Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -6975,25 +6891,48 @@ public boolean validateAppId(String customStudyId, String appId, String studyTyp\n     Session session = null;\n     List<StudyBo> studyBos = null;\n     String searchQuery = \"\";\n-    String subQry = \"\";\n+    // String subQry = \"\";", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MDI2NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515780264", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MjMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MjQ0Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515162442", "bodyText": "same here", "author": "zohrehj", "createdAt": "2020-10-30T15:00:18Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -6975,25 +6891,48 @@ public boolean validateAppId(String customStudyId, String appId, String studyTyp\n     Session session = null;\n     List<StudyBo> studyBos = null;\n     String searchQuery = \"\";\n-    String subQry = \"\";\n+    // String subQry = \"\";\n     try {\n       session = hibernateTemplate.getSessionFactory().openSession();\n       if (!studyType.isEmpty() && !appId.isEmpty()) {\n-        if (StringUtils.isNotEmpty(customStudyId)) {\n-          subQry = \" and customStudyId!='\" + customStudyId + \"'\";\n-        }\n+        //        if (StringUtils.isNotEmpty(customStudyId)) {\n+        //          subQry = \" and customStudyId!=:customStudyId\";\n+        //        }", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MDM3Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515780377", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:28:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2MjQ0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NDA0OQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515164049", "bodyText": "remove", "author": "zohrehj", "createdAt": "2020-10-30T15:02:47Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -7143,29 +7088,40 @@ public String updateDraftToEditedStatus(\n       }\n       if ((userId != null) && (studyId != null)) {\n         if ((actionType != null) && (FdahpStudyDesignerConstants.DRAFT_STUDY).equals(actionType)) {\n-          draftColumn = \"hasStudyDraft = 1\";\n+          // draftColumn = \"hasStudyDraft = 1\";", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MDQ2MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515780461", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NDA0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NDI3NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515164274", "bodyText": "same her, please clean these comments", "author": "zohrehj", "createdAt": "2020-10-30T15:03:09Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -7143,29 +7088,40 @@ public String updateDraftToEditedStatus(\n       }\n       if ((userId != null) && (studyId != null)) {\n         if ((actionType != null) && (FdahpStudyDesignerConstants.DRAFT_STUDY).equals(actionType)) {\n-          draftColumn = \"hasStudyDraft = 1\";\n+          // draftColumn = \"hasStudyDraft = 1\";\n+          queryString =\n+              \" Update StudyBo set hasStudyDraft = 1 , modifiedBy =:userId , modifiedOn = now() where id = :studyId \";\n         } else if ((actionType != null)\n             && (FdahpStudyDesignerConstants.DRAFT_QUESTIONNAIRE).equals(actionType)) {\n-          draftColumn = \"hasQuestionnaireDraft = 1, hasStudyDraft = 1 \";\n+          //          draftColumn = \"hasQuestionnaireDraft = 1, hasStudyDraft = 1 \";", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MTYyOA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515781628", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:31:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NDI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NjAwNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515166005", "bodyText": "remove all this commented code please", "author": "zohrehj", "createdAt": "2020-10-30T15:05:45Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -7143,29 +7088,40 @@ public String updateDraftToEditedStatus(\n       }\n       if ((userId != null) && (studyId != null)) {\n         if ((actionType != null) && (FdahpStudyDesignerConstants.DRAFT_STUDY).equals(actionType)) {\n-          draftColumn = \"hasStudyDraft = 1\";\n+          // draftColumn = \"hasStudyDraft = 1\";\n+          queryString =\n+              \" Update StudyBo set hasStudyDraft = 1 , modifiedBy =:userId , modifiedOn = now() where id = :studyId \";\n         } else if ((actionType != null)\n             && (FdahpStudyDesignerConstants.DRAFT_QUESTIONNAIRE).equals(actionType)) {\n-          draftColumn = \"hasQuestionnaireDraft = 1, hasStudyDraft = 1 \";\n+          //          draftColumn = \"hasQuestionnaireDraft = 1, hasStudyDraft = 1 \";\n+          queryString =\n+              \" Update StudyBo set hasQuestionnaireDraft = 1, hasStudyDraft = 1  , modifiedBy =:userId , modifiedOn = now() where id = :studyId \";\n         } else if ((actionType != null)\n             && (FdahpStudyDesignerConstants.DRAFT_ACTIVETASK).equals(actionType)) {\n-          draftColumn = \"hasActivetaskDraft = 1, hasStudyDraft = 1 \";\n+          //          draftColumn = \"hasActivetaskDraft = 1, hasStudyDraft = 1 \";", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MTY4Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515781683", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2NjAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2Nzc4NA==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515167784", "bodyText": "please remove input.contains(\",\") check.\nWith this condition your method will return an empty list even if the input string contains a single element.", "author": "zohrehj", "createdAt": "2020-10-30T15:08:40Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -7201,4 +7157,15 @@ public String updateDraftToEditedStatus(\n     }\n     return outputList;\n   }\n+\n+  public List<String> convertStringToList(String input) {\n+    List<String> outputList = new ArrayList<>();\n+    if (!StringUtils.isEmpty(input) && input.contains(\",\")) {", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MTcyMg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515781722", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:32:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2Nzc4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2ODQ5Mg==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515168492", "bodyText": "please rename this to something more generic, e.g. itemArray. StatusIdArray assumes that input contains list of statusIds.", "author": "zohrehj", "createdAt": "2020-10-30T15:09:41Z", "path": "study-builder/fdahpStudyDesigner/src/main/java/com/fdahpstudydesigner/dao/StudyDAOImpl.java", "diffHunk": "@@ -7201,4 +7157,15 @@ public String updateDraftToEditedStatus(\n     }\n     return outputList;\n   }\n+\n+  public List<String> convertStringToList(String input) {\n+    List<String> outputList = new ArrayList<>();\n+    if (!StringUtils.isEmpty(input) && input.contains(\",\")) {\n+      String[] statusIdArray = input.split(\",\");", "originalCommit": "9cc76c844436867e862b2c1c0bd90e7e61823f83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc4MTg3Nw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/1744#discussion_r515781877", "bodyText": "The issues has been fixed it as  suggested", "author": "vigneshjbtc", "createdAt": "2020-11-02T07:32:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE2ODQ5Mg=="}], "type": "inlineReview"}, {"oid": "85c16464c6935db347af242ce2098f280a47e3f0", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/85c16464c6935db347af242ce2098f280a47e3f0", "message": "All the issue has been fixed it.\n\nAll the issue has been fixed it.", "committedDate": "2020-11-02T07:24:38Z", "type": "commit"}, {"oid": "eb8b8223762d8d15cf4360f25f11bb3f848e685f", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/eb8b8223762d8d15cf4360f25f11bb3f848e685f", "message": "Merge branch 'develop' into Sql_injection_part2_from_2000_line_onwards", "committedDate": "2020-11-02T15:26:24Z", "type": "commit"}]}