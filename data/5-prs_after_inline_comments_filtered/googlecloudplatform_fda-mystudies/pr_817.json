{"pr_number": 817, "pr_title": "Implement postAuditLogEvent in common-service", "pr_createdAt": "2020-08-26T20:06:42Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817", "timeline": [{"oid": "75200bd87fcf378bb5862ffd76095313f7ebaf94", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/75200bd87fcf378bb5862ffd76095313f7ebaf94", "message": "implement postAuditLogEvent in common-service", "committedDate": "2020-08-25T21:33:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MjIzNQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#discussion_r478562235", "bodyText": "nit: you have  kept the logger.entry, but removed logger.exit. let's add them consistently.", "author": "zohrehj", "createdAt": "2020-08-27T16:55:33Z", "path": "common-modules/common-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/AuditEventServiceImpl.java", "diffHunk": "@@ -26,15 +30,26 @@\n \n   private XLogger logger = XLoggerFactory.getXLogger(AuditEventServiceImpl.class.getName());\n \n+  private static final String AUDIT_LOG_NAME = \"application-audit-log\";\n+\n   @Override\n   public void postAuditLogEvent(AuditLogEventRequest auditRequest) {\n     logger.entry(\n         String.format(\"begin postAuditLogEvent() for %s event\", auditRequest.getEventCode()));\n \n-    JsonNode requestBody = getObjectMapper().convertValue(auditRequest, JsonNode.class);\n+    Logging logging = LoggingOptions.getDefaultInstance().getService();\n+\n+    // The data to write to the log\n+    Map<String, Object> jsonPayloadMap = getObjectMapper().convertValue(auditRequest, Map.class);\n+\n+    LogEntry entry = LogEntry.newBuilder(Payload.JsonPayload.of(jsonPayloadMap))\n+            .setTimestamp(auditRequest.getOccured().getTime())\n+            .setSeverity(Severity.INFO)\n+            .setLogName(AUDIT_LOG_NAME)\n+            .setResource(MonitoredResource.newBuilder(\"global\").build())\n+            .build();\n \n-    // TODO (#703) integration with GCP stackdriver. Please remove the requestBody from below logger\n-    // statement during stackdriver integration as it may contain PII information.\n-    logger.exit(String.format(\"audit request=%s\", requestBody));", "originalCommit": "75200bd87fcf378bb5862ffd76095313f7ebaf94", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcwMzU0MQ==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/817#discussion_r478703541", "bodyText": "I added it back, but not including the entire requestBody per that TODO suggests", "author": "saminguyen", "createdAt": "2020-08-27T21:23:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODU2MjIzNQ=="}], "type": "inlineReview"}, {"oid": "f29a57df04a8c78a90a25322943f199f0f2db87c", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f29a57df04a8c78a90a25322943f199f0f2db87c", "message": "added logger exit message", "committedDate": "2020-08-27T21:17:52Z", "type": "commit"}, {"oid": "9304ad847da1e4df1a5a80dce4e318325cb20b8a", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/9304ad847da1e4df1a5a80dce4e318325cb20b8a", "message": "Merge branch 'develop' into common-service-auditlog", "committedDate": "2020-08-27T21:22:19Z", "type": "commit"}, {"oid": "4d17c46c1d4eb1b3112f0943dec8b69d5b57876b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/4d17c46c1d4eb1b3112f0943dec8b69d5b57876b", "message": "Merge branch 'develop' into common-service-auditlog", "committedDate": "2020-08-28T21:21:48Z", "type": "commit"}, {"oid": "3b491976ed0cafc566f5e50f6775ac862c29e706", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/3b491976ed0cafc566f5e50f6775ac862c29e706", "message": "build error fix", "committedDate": "2020-08-28T21:22:32Z", "type": "commit"}, {"oid": "f2349a3456015414662ad462bea6017bf23b2ceb", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/f2349a3456015414662ad462bea6017bf23b2ceb", "message": "Merge branch 'common-service-auditlog' of https://github.com/GoogleCloudPlatform/fda-mystudies into common-service-auditlog", "committedDate": "2020-08-28T21:23:51Z", "type": "commit"}, {"oid": "cc2105c7d9028868dc02f060a5a8a575ead4674b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/cc2105c7d9028868dc02f060a5a8a575ead4674b", "message": "Merge branch 'develop' into common-service-auditlog", "committedDate": "2020-08-31T14:59:44Z", "type": "commit"}, {"oid": "d9739d1848180c59ac1c4f72a14d30e529f62cab", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d9739d1848180c59ac1c4f72a14d30e529f62cab", "message": "Merge branch 'develop' into common-service-auditlog", "committedDate": "2020-08-31T15:08:25Z", "type": "commit"}]}