{"pr_number": 686, "pr_title": "Participant manager addNewUser api with non super admin", "pr_createdAt": "2020-07-27T15:36:15Z", "pr_url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686", "timeline": [{"oid": "826cafb721f47dead393a25f3ce7971c5529d744", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/826cafb721f47dead393a25f3ce7971c5529d744", "message": "son super admin flow for addNewUser imolemented", "committedDate": "2020-07-27T15:23:53Z", "type": "commit"}, {"oid": "78d8e41f74f128043903f5191f31bc11b7bf5031", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/78d8e41f74f128043903f5191f31bc11b7bf5031", "message": "code formated", "committedDate": "2020-07-27T15:28:09Z", "type": "commit"}, {"oid": "c39158123585cbba466e7a6129e8da59c790f12d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/c39158123585cbba466e7a6129e8da59c790f12d", "message": "Merge branch 'participant-manager-add-new-user-common-module' into participant-manager-add-new-user-with-non-super-admin-implementation\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java", "committedDate": "2020-07-27T15:39:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNTE0Mw==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686#discussion_r462715143", "bodyText": "\"Details\"", "author": "saminguyen", "createdAt": "2020-07-30T03:38:10Z", "path": "participant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java", "diffHunk": "@@ -139,10 +149,108 @@ private AdminUserResponse saveAdminDetails(UserRequest user) {\n     UserRegAdminEntity adminDetails =\n         UserMapper.fromUserRequest(user, Long.valueOf(appConfig.getSecurityCodeExpireDate()));\n     adminDetails = userAdminRepository.saveAndFlush(adminDetails);\n+\n+    Map<Boolean, List<UserAppPermissionRequest>> groupBySelectedAppMap =\n+        user.getApps()\n+            .stream()\n+            .collect(Collectors.groupingBy(UserAppPermissionRequest::isSelected));\n+\n+    // save permissions for selected apps\n+    for (UserAppPermissionRequest app :\n+        CollectionUtils.emptyIfNull(groupBySelectedAppMap.get(CommonConstants.SELECTED))) {\n+      saveAppStudySitePermissions(user, adminDetails, app);\n+    }\n+\n+    // save permissions for unselected apps\n+    for (UserAppPermissionRequest app :\n+        CollectionUtils.emptyIfNull(groupBySelectedAppMap.get(CommonConstants.UNSELECTED))) {\n+      for (UserStudyPermissionRequest study : CollectionUtils.emptyIfNull(app.getStudies())) {\n+        if (study.isSelected()) {\n+          saveStudySitePermissions(user, adminDetails, study);\n+        } else if (CollectionUtils.isNotEmpty(study.getSites())) {\n+          saveSitePermissions(user, adminDetails, study);\n+        }\n+      }\n+    }\n     logger.exit(\"Successfully saved admin details.\");\n     return new AdminUserResponse(MessageCode.ADD_NEW_USER_SUCCESS, adminDetails.getId());\n   }\n \n+  private void saveAppStudySitePermissions(\n+      UserRequest user, UserRegAdminEntity adminDeatils, UserAppPermissionRequest app) {", "originalCommit": "c39158123585cbba466e7a6129e8da59c790f12d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzAxMzU4Ng==", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/pull/686#discussion_r463013586", "bodyText": "typo fixed", "author": "chiranjibi009", "createdAt": "2020-07-30T13:55:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcxNTE0Mw=="}], "type": "inlineReview"}, {"oid": "adfb7931ddab2df6b1a90e75ca2d50a7cd7b0a2d", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/adfb7931ddab2df6b1a90e75ca2d50a7cd7b0a2d", "message": "Merge branch 'participant-manager-add-new-user-common-module' into participant-manager-add-new-user-with-non-super-admin-implementation", "committedDate": "2020-07-30T13:28:17Z", "type": "commit"}, {"oid": "96bfd0e30a921a6433163a645610506b37ba9aab", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/96bfd0e30a921a6433163a645610506b37ba9aab", "message": "commented PR fixed", "committedDate": "2020-07-30T13:38:18Z", "type": "commit"}, {"oid": "78a17c7914d8ac1398100669438585ddd903cd86", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/78a17c7914d8ac1398100669438585ddd903cd86", "message": "Merge branch 'participant-manager-add-new-user-common-module' into participant-manager-add-new-user-with-non-super-admin-implementation", "committedDate": "2020-07-31T06:32:08Z", "type": "commit"}, {"oid": "d360b5ee153c73b45d0c40e87c59132b98c6bc84", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/d360b5ee153c73b45d0c40e87c59132b98c6bc84", "message": "Merge branch 'develop' into participant-manager-add-new-user-with-non-super-admin-implementation", "committedDate": "2020-08-18T06:38:57Z", "type": "commit"}, {"oid": "7b9763d266765d42c6d562560617efb97ba1c8fb", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/7b9763d266765d42c6d562560617efb97ba1c8fb", "message": "Merge branch 'develop' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-add-new-user-with-non-super-admin-implementation\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java", "committedDate": "2020-08-18T06:46:08Z", "type": "commit"}, {"oid": "67f3f411ff6ee12b360fb6663a33b87383dcc8cc", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/67f3f411ff6ee12b360fb6663a33b87383dcc8cc", "message": "Merge branch 'participant-manager-add-new-user-with-non-super-admin-implementation' of https://github.com/GoogleCloudPlatform/fda-mystudies into participant-manager-add-new-user-with-non-super-admin-implementation\n\n# Conflicts:\n#\tparticipant-manager-module/participant-manager-service/src/main/java/com/google/cloud/healthcare/fdamystudies/service/ManageUserServiceImpl.java", "committedDate": "2020-08-18T06:59:49Z", "type": "commit"}, {"oid": "8cbc9c9603d9979d17e886f1e722e017c2fcd72b", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/8cbc9c9603d9979d17e886f1e722e017c2fcd72b", "message": "Merge branch 'develop' into participant-manager-add-new-user-with-non-super-admin-implementation", "committedDate": "2020-08-18T13:26:23Z", "type": "commit"}, {"oid": "0e08cc628de7955f185a6df99da8e651bd2b0575", "url": "https://github.com/GoogleCloudPlatform/fda-mystudies/commit/0e08cc628de7955f185a6df99da8e651bd2b0575", "message": "Merge branch 'develop' into participant-manager-add-new-user-with-non-super-admin-implementation", "committedDate": "2020-08-18T14:05:52Z", "type": "commit"}]}