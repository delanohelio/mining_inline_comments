{"pr_number": 3028, "pr_title": "Core - new method getAllSponsoredMembers", "pr_createdAt": "2020-12-08T15:19:27Z", "pr_url": "https://github.com/CESNET/perun/pull/3028", "timeline": [{"oid": "78588de21e14e49f198710d0a90253a12c23db01", "url": "https://github.com/CESNET/perun/commit/78588de21e14e49f198710d0a90253a12c23db01", "message": "Core - new method getAllSponsoredMembers\n\n- added new method getAllSponsoredMembers which does not filter members by callers sponsorship\n- new method is used by the old one to prevent duplicating code", "committedDate": "2020-12-08T15:02:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r539150395", "bodyText": "Please, use here the original politic getSponsoredMembers_Vo_policy. The GUI needs it to resolve authorization.", "author": "Vojtech-Sassmann", "createdAt": "2020-12-09T09:35:37Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization", "originalCommit": "78588de21e14e49f198710d0a90253a12c23db01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA3MDE5OA==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r541070198", "bodyText": "Ok, fixed.", "author": "metodej", "createdAt": "2020-12-11T16:29:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MjAwNQ==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542192005", "bodyText": "I think the policy check is still missing.", "author": "Vojtech-Sassmann", "createdAt": "2020-12-14T08:23:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMDMxMg==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542210312", "bodyText": "Sorry, I misunderstood, I hope it's fixed now.", "author": "metodej", "createdAt": "2020-12-14T08:53:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MDM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MTQ5OQ==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r539151499", "bodyText": "The variable name filteredMembers doesn't make much sense anymore, since this method doesn't filter anything.", "author": "Vojtech-Sassmann", "createdAt": "2020-12-09T09:37:08Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,20 +1434,25 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization\n+\t\treturn getAllSponsoredMembers(sess, vo).stream()\n+\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n+\t\t\t.collect(Collectors.toList());\n+\t}\n+\n+\t@Override\n+\tpublic List<RichMember> getAllSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n \t\tUtils.checkPerunSession(sess);\n \t\tUtils.notNull(vo, \"vo\");\n \n \t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n \n \t\t//Authorization\n-\t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembers_Vo_policy\", vo)) {\n-\t\t\tthrow new PrivilegeException(sess, \"getSponsoredMembers\");\n+\t\tif(!AuthzResolver.authorizedInternal(sess, \"getAllSponsoredMembers_Vo_policy\", vo)) {\n+\t\t\tthrow new PrivilegeException(sess, \"getAllSponsoredMembers\");\n \t\t}\n \n-\t\t//Filter members based on authorization\n-\t\tList<Member> filteredMembers = membersManagerBl.getSponsoredMembers(sess, vo).stream()\n-\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n-\t\t\t.collect(Collectors.toList());\n+\t\tList<Member> filteredMembers = membersManagerBl.getSponsoredMembers(sess, vo);", "originalCommit": "78588de21e14e49f198710d0a90253a12c23db01", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTA3MDM0Nw==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r541070347", "bodyText": "Good point, fixed.", "author": "metodej", "createdAt": "2020-12-11T16:29:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE1MTQ5OQ=="}], "type": "inlineReview"}, {"oid": "4c9f9edbfb02a8185746db5588a83f80702432e8", "url": "https://github.com/CESNET/perun/commit/4c9f9edbfb02a8185746db5588a83f80702432e8", "message": "Changes based on review\n\n- fixed authorization policy and variable name\n- added test", "committedDate": "2020-12-11T16:22:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MTgzNA==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542191834", "bodyText": "This is probably an incorrect description.", "author": "Vojtech-Sassmann", "createdAt": "2020-12-14T08:23:36Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/api/MembersManager.java", "diffHunk": "@@ -1351,6 +1351,16 @@\n \t */\n \tList<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException;\n \n+\t/**\n+\t * Gets list of all sponsored members of a VO.\n+\t *\n+\t * @param sess actor", "originalCommit": "4c9f9edbfb02a8185746db5588a83f80702432e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIwOTkyMA==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542209920", "bodyText": "Fixed.", "author": "metodej", "createdAt": "2020-12-14T08:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MTgzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MzQ1NA==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542193454", "bodyText": "This policy should be used in the method getSponsoredMembers. For this method, you should create a new one.", "author": "Vojtech-Sassmann", "createdAt": "2020-12-14T08:26:18Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/entry/MembersManagerEntry.java", "diffHunk": "@@ -1434,22 +1434,27 @@ public RichMember sponsorMember(PerunSession session, Member sponsored, User spo\n \n \t@Override\n \tpublic List<RichMember> getSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n+\t\t//Filter members based on authorization\n+\t\treturn getAllSponsoredMembers(sess, vo).stream()\n+\t\t\t.filter(member -> AuthzResolver.authorizedInternal(sess, \"filter-getSponsoredMembers_Vo_policy\", member, vo))\n+\t\t\t.collect(Collectors.toList());\n+\t}\n+\n+\t@Override\n+\tpublic List<RichMember> getAllSponsoredMembers(PerunSession sess, Vo vo) throws PrivilegeException, VoNotExistsException {\n \t\tUtils.checkPerunSession(sess);\n \t\tUtils.notNull(vo, \"vo\");\n \n \t\tperunBl.getVosManagerBl().checkVoExists(sess, vo);\n \n \t\t//Authorization\n \t\tif(!AuthzResolver.authorizedInternal(sess, \"getSponsoredMembers_Vo_policy\", vo)) {", "originalCommit": "4c9f9edbfb02a8185746db5588a83f80702432e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjIxMDAxMQ==", "url": "https://github.com/CESNET/perun/pull/3028#discussion_r542210011", "bodyText": "Fixed.", "author": "metodej", "createdAt": "2020-12-14T08:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjE5MzQ1NA=="}], "type": "inlineReview"}, {"oid": "709d836f913ac9da3196b2b843ec9761bb5811f2", "url": "https://github.com/CESNET/perun/commit/709d836f913ac9da3196b2b843ec9761bb5811f2", "message": "Changes based on review\n\n- fixed authorization policy\n- fixed incorrect javadoc description", "committedDate": "2020-12-14T08:46:11Z", "type": "commit"}]}