{"pr_number": 2647, "pr_title": "Added attribute to store UID ranges", "pr_createdAt": "2020-03-30T07:37:13Z", "pr_url": "https://github.com/CESNET/perun/pull/2647", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc4Mjk4NA==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r400782984", "bodyText": "In the text there should be 'one of id ranges'.", "author": "stavamichal", "createdAt": "2020-03-31T09:50:08Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -1085,24 +1085,24 @@ public User getUserFromMessage(PerunSessionImpl sess, String message) throws Int\n \t}\n \n \t@Override\n-\tpublic Map<Integer, Integer> checkAndConvertGIDRanges(Attribute gidRangesAttribute) throws InternalErrorException, WrongAttributeValueException {\n+\tpublic Map<Integer, Integer> checkAndConvertIDRanges(Attribute idRangesAttribute) throws InternalErrorException, WrongAttributeValueException {\n \t\t//Prepare structure for better working with GID Ranges\n \t\tMap<Integer, Integer> convertedRanges = new HashMap<>();\n \n \t\t//For null attribute throw an exception\n-\t\tif(gidRangesAttribute == null) throw new InternalErrorException(\"Can't get value from null attribute!\");\n+\t\tif(idRangesAttribute == null) throw new InternalErrorException(\"Can't get value from null attribute!\");\n \n-\t\tMap<String, String> gidRanges = (LinkedHashMap) gidRangesAttribute.getValue();\n+\t\tMap<String, String> idRanges = (LinkedHashMap) idRangesAttribute.getValue();\n \n \t\t//Return empty map if there is empty input of gidRanges in method parameters\n-\t\tif(gidRanges == null || gidRanges.isEmpty()) return convertedRanges;\n+\t\tif(idRanges == null || idRanges.isEmpty()) return convertedRanges;\n \n \t\t//Check every range if it is in correct format and it is valid range\n-\t\tfor(String minimumOfRange: gidRanges.keySet()) {\n+\t\tfor(String minimumOfRange: idRanges.keySet()) {\n \t\t\t//Check not null\n-\t\t\tif(minimumOfRange == null || minimumOfRange.isEmpty()) throw new WrongAttributeValueException(gidRangesAttribute, \"Minimum in one of gid ranges is empty!\");\n-\t\t\tString maximumOfRange = gidRanges.get(minimumOfRange);\n-\t\t\tif(maximumOfRange == null || maximumOfRange.isEmpty()) throw new WrongAttributeValueException(gidRangesAttribute, \"Maximum in one of gid ranges is empty!\");\n+\t\t\tif(minimumOfRange == null || minimumOfRange.isEmpty()) throw new WrongAttributeValueException(idRangesAttribute, \"Minimum in one of gid ranges is empty!\");\n+\t\t\tString maximumOfRange = idRanges.get(minimumOfRange);\n+\t\t\tif(maximumOfRange == null || maximumOfRange.isEmpty()) throw new WrongAttributeValueException(idRangesAttribute, \"Maximum in one of gid ranges is empty!\");", "originalCommit": "e95a389ef4380ec1dc6cc4cf4a368e99aff29728", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc4MzI3NQ==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r400783275", "bodyText": "Text should be 'between two id ranges'.", "author": "stavamichal", "createdAt": "2020-03-31T09:50:37Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/ModulesUtilsBlImpl.java", "diffHunk": "@@ -1128,7 +1128,7 @@ public User getUserFromMessage(PerunSessionImpl sess, String message) throws Int\n \t\t//Check gid ranges overlaps (there should be no overlaps)\n \t\tInteger lastMaxValue = 0;\n \t\tfor(Integer minValue: convertedRanges.keySet().stream().sorted().collect(Collectors.toList())) {\n-\t\t\tif(minValue <= lastMaxValue) throw new WrongAttributeValueException(gidRangesAttribute, \"There is an overlap between two gid ranges.\");\n+\t\t\tif(minValue <= lastMaxValue) throw new WrongAttributeValueException(idRangesAttribute, \"There is an overlap between two gid ranges.\");", "originalCommit": "e95a389ef4380ec1dc6cc4cf4a368e99aff29728", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc4NTkzMA==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r400785930", "bodyText": "I don't think you need to override this method if there is no change in it.", "author": "stavamichal", "createdAt": "2020-03-31T09:54:41Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_virt_UIDRanges.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.*;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.impl.Utils;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleAbstract;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleImplApi;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class urn_perun_facility_attribute_def_virt_UIDRanges extends FacilityVirtualAttributesModuleAbstract implements FacilityVirtualAttributesModuleImplApi {\n+\n+\tprivate static final String A_E_namespaceUIDRanges = AttributesManager.NS_ENTITYLESS_ATTR_DEF + \":namespace-UIDRanges\";\n+\tprivate static final String A_FAC_uidNamespace = AttributesManager.NS_FACILITY_ATTR_DEF + \":uid-namespace\";\n+\n+\t@Override\n+\tpublic void checkAttributeSemantics(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException, WrongAttributeAssignmentException {\n+\t\ttry {\n+\t\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\t\tif(uidNamespaceAttribute.getValue() == null) throw new WrongReferenceAttributeValueException(attribute, uidNamespaceAttribute, \"There is missing UID namespace on the facility.\");\n+\t\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\t\tsess.getPerunBl().getAttributesManagerBl().checkAttributeSemantics(sess, uidNamespaceAttribute.valueAsString(), namespaceUIDRangesAttribute);\n+\t\t} catch(WrongReferenceAttributeValueException ex) {\n+\t\t\tthrow new WrongReferenceAttributeValueException(attribute, ex.getReferenceAttribute());\n+\t\t}\n+\n+\t}\n+\n+\t@Override\n+\tpublic Attribute fillAttribute(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) {\n+\t\treturn new Attribute(attributeDefinition);\n+\t}", "originalCommit": "e95a389ef4380ec1dc6cc4cf4a368e99aff29728", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc4NjQ4OA==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r400786488", "bodyText": "This is not wrong, but I would prefer to have a throw on separate line, please.", "author": "stavamichal", "createdAt": "2020-03-31T09:55:37Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_virt_UIDRanges.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.*;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.impl.Utils;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleAbstract;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleImplApi;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class urn_perun_facility_attribute_def_virt_UIDRanges extends FacilityVirtualAttributesModuleAbstract implements FacilityVirtualAttributesModuleImplApi {\n+\n+\tprivate static final String A_E_namespaceUIDRanges = AttributesManager.NS_ENTITYLESS_ATTR_DEF + \":namespace-UIDRanges\";\n+\tprivate static final String A_FAC_uidNamespace = AttributesManager.NS_FACILITY_ATTR_DEF + \":uid-namespace\";\n+\n+\t@Override\n+\tpublic void checkAttributeSemantics(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException, WrongAttributeAssignmentException {\n+\t\ttry {\n+\t\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\t\tif(uidNamespaceAttribute.getValue() == null) throw new WrongReferenceAttributeValueException(attribute, uidNamespaceAttribute, \"There is missing UID namespace on the facility.\");\n+\t\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\t\tsess.getPerunBl().getAttributesManagerBl().checkAttributeSemantics(sess, uidNamespaceAttribute.valueAsString(), namespaceUIDRangesAttribute);\n+\t\t} catch(WrongReferenceAttributeValueException ex) {\n+\t\t\tthrow new WrongReferenceAttributeValueException(attribute, ex.getReferenceAttribute());\n+\t\t}\n+\n+\t}\n+\n+\t@Override\n+\tpublic Attribute fillAttribute(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) {\n+\t\treturn new Attribute(attributeDefinition);\n+\t}\n+\n+\t@Override\n+\tpublic Attribute getAttributeValue(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) throws InternalErrorException {\n+\t\tAttribute attribute = new Attribute(attributeDefinition);\n+\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\tif(uidNamespaceAttribute.getValue() == null) return attribute;\n+\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\treturn Utils.copyAttributeToVirtualAttributeWithValue(namespaceUIDRangesAttribute, attribute);\n+\t}\n+\n+\t@Override\n+\tpublic boolean setAttributeValue(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException {\n+\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\tif(uidNamespaceAttribute.getValue() == null) throw new WrongReferenceAttributeValueException(attribute, uidNamespaceAttribute, \"There is missing UID namespace on the facility.\");\n+\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\tif(! (attribute.getValue() == null ? namespaceUIDRangesAttribute.getValue() == null : attribute.getValue().equals(namespaceUIDRangesAttribute.getValue()))) {\n+\t\t\t//attribute from param have other vale then physical attribute\n+\t\t\tthrow new WrongReferenceAttributeValueException(attribute, namespaceUIDRangesAttribute, \"You can't change attribute value of UID Ranges by changing value of virtual attribute.\");\n+\t\t}\n+\t\treturn false;\n+\t}\n+\n+\t@Override\n+\tpublic void removeAttributeValue(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) throws InternalErrorException {\n+\t\t//Not suported yet.\n+\t\tthrow new InternalErrorException(\"Can't remove value of this virtual attribute this way. \" + attributeDefinition);\n+\t}\n+\n+\tprivate Attribute getNamespaceUIDRangesAttribute(PerunSessionImpl sess, String uidNamespace) throws InternalErrorException {\n+\t\ttry {\n+\t\t\treturn sess.getPerunBl().getAttributesManagerBl().getAttribute(sess, uidNamespace, A_E_namespaceUIDRanges);\n+\t\t} catch(AttributeNotExistsException ex) { throw new ConsistencyErrorException(ex);\n+\t\t} catch(WrongAttributeAssignmentException ex) { throw new InternalErrorException(ex);\n+\t\t}", "originalCommit": "e95a389ef4380ec1dc6cc4cf4a368e99aff29728", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc4ODAxNg==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r400788016", "bodyText": "Maybe it is problem with gid ranges too, but I am not sure why is this logic here at all. You definitely can't set anything this way (there is no logic for setting in it) so maybe we should skip it at all. Or did I miss something?", "author": "stavamichal", "createdAt": "2020-03-31T09:58:02Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_virt_UIDRanges.java", "diffHunk": "@@ -0,0 +1,108 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.*;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.impl.Utils;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleAbstract;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleImplApi;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class urn_perun_facility_attribute_def_virt_UIDRanges extends FacilityVirtualAttributesModuleAbstract implements FacilityVirtualAttributesModuleImplApi {\n+\n+\tprivate static final String A_E_namespaceUIDRanges = AttributesManager.NS_ENTITYLESS_ATTR_DEF + \":namespace-UIDRanges\";\n+\tprivate static final String A_FAC_uidNamespace = AttributesManager.NS_FACILITY_ATTR_DEF + \":uid-namespace\";\n+\n+\t@Override\n+\tpublic void checkAttributeSemantics(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException, WrongAttributeAssignmentException {\n+\t\ttry {\n+\t\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\t\tif(uidNamespaceAttribute.getValue() == null) throw new WrongReferenceAttributeValueException(attribute, uidNamespaceAttribute, \"There is missing UID namespace on the facility.\");\n+\t\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\t\tsess.getPerunBl().getAttributesManagerBl().checkAttributeSemantics(sess, uidNamespaceAttribute.valueAsString(), namespaceUIDRangesAttribute);\n+\t\t} catch(WrongReferenceAttributeValueException ex) {\n+\t\t\tthrow new WrongReferenceAttributeValueException(attribute, ex.getReferenceAttribute());\n+\t\t}\n+\n+\t}\n+\n+\t@Override\n+\tpublic Attribute fillAttribute(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) {\n+\t\treturn new Attribute(attributeDefinition);\n+\t}\n+\n+\t@Override\n+\tpublic Attribute getAttributeValue(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) throws InternalErrorException {\n+\t\tAttribute attribute = new Attribute(attributeDefinition);\n+\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\tif(uidNamespaceAttribute.getValue() == null) return attribute;\n+\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\treturn Utils.copyAttributeToVirtualAttributeWithValue(namespaceUIDRangesAttribute, attribute);\n+\t}\n+\n+\t@Override\n+\tpublic boolean setAttributeValue(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException {\n+\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\tif(uidNamespaceAttribute.getValue() == null) throw new WrongReferenceAttributeValueException(attribute, uidNamespaceAttribute, \"There is missing UID namespace on the facility.\");\n+\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\tif(! (attribute.getValue() == null ? namespaceUIDRangesAttribute.getValue() == null : attribute.getValue().equals(namespaceUIDRangesAttribute.getValue()))) {\n+\t\t\t//attribute from param have other vale then physical attribute\n+\t\t\tthrow new WrongReferenceAttributeValueException(attribute, namespaceUIDRangesAttribute, \"You can't change attribute value of UID Ranges by changing value of virtual attribute.\");\n+\t\t}\n+\t\treturn false;\n+\t}", "originalCommit": "e95a389ef4380ec1dc6cc4cf4a368e99aff29728", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8919a585064eb25286ec325407111d2d9d5bedcf", "url": "https://github.com/CESNET/perun/commit/8919a585064eb25286ec325407111d2d9d5bedcf", "message": "Added attribute to store UID ranges\n\n- added new attributes to store UID ranges instead of UID max/min\n- renamed method used to check and convert GID and now UID ranges", "committedDate": "2020-04-01T20:31:43Z", "type": "forcePushed"}, {"oid": "f1bb8a107018b18d4a10759dbd75141a418d9eaa", "url": "https://github.com/CESNET/perun/commit/f1bb8a107018b18d4a10759dbd75141a418d9eaa", "message": "Added attribute to store UID ranges\n\n- added new attributes to store UID ranges instead of UID max/min\n- renamed method used to check and convert GID and now UID ranges", "committedDate": "2020-04-01T22:05:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgwOTkxNA==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r444809914", "bodyText": "Attribute should be of LinkedHashMap type. Please fix this also in GIDRanges attribute module. Thank you.", "author": "zlamalp", "createdAt": "2020-06-24T10:52:27Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_virt_UIDRanges.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.*;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.impl.Utils;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleAbstract;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleImplApi;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class urn_perun_facility_attribute_def_virt_UIDRanges extends FacilityVirtualAttributesModuleAbstract implements FacilityVirtualAttributesModuleImplApi {\n+\n+\tprivate static final String A_E_namespaceUIDRanges = AttributesManager.NS_ENTITYLESS_ATTR_DEF + \":namespace-UIDRanges\";\n+\tprivate static final String A_FAC_uidNamespace = AttributesManager.NS_FACILITY_ATTR_DEF + \":uid-namespace\";\n+\n+\t@Override\n+\tpublic void checkAttributeSemantics(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException, WrongAttributeAssignmentException {\n+\t\ttry {\n+\t\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\t\tif(uidNamespaceAttribute.getValue() == null) throw new WrongReferenceAttributeValueException(attribute, uidNamespaceAttribute, \"There is missing UID namespace on the facility.\");\n+\t\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\t\tsess.getPerunBl().getAttributesManagerBl().checkAttributeSemantics(sess, uidNamespaceAttribute.valueAsString(), namespaceUIDRangesAttribute);\n+\t\t} catch(WrongReferenceAttributeValueException ex) {\n+\t\t\tthrow new WrongReferenceAttributeValueException(attribute, ex.getReferenceAttribute());\n+\t\t}\n+\n+\t}\n+\n+\t@Override\n+\tpublic Attribute getAttributeValue(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) throws InternalErrorException {\n+\t\tAttribute attribute = new Attribute(attributeDefinition);\n+\t\tAttribute uidNamespaceAttribute = getUidNamespaceAttribute(sess, facility);\n+\t\tif(uidNamespaceAttribute.getValue() == null) return attribute;\n+\t\tAttribute namespaceUIDRangesAttribute = getNamespaceUIDRangesAttribute(sess, uidNamespaceAttribute.valueAsString());\n+\t\treturn Utils.copyAttributeToVirtualAttributeWithValue(namespaceUIDRangesAttribute, attribute);\n+\t}\n+\n+\t@Override\n+\tpublic void removeAttributeValue(PerunSessionImpl sess, Facility facility, AttributeDefinition attributeDefinition) throws InternalErrorException {\n+\t\t//Not suported yet.\n+\t\tthrow new InternalErrorException(\"Can't remove value of this virtual attribute this way. \" + attributeDefinition);\n+\t}\n+\n+\tprivate Attribute getNamespaceUIDRangesAttribute(PerunSessionImpl sess, String uidNamespace) throws InternalErrorException {\n+\t\ttry {\n+\t\t\treturn sess.getPerunBl().getAttributesManagerBl().getAttribute(sess, uidNamespace, A_E_namespaceUIDRanges);\n+\t\t} catch(AttributeNotExistsException ex) {\n+\t\t\tthrow new ConsistencyErrorException(ex);\n+\t\t} catch(WrongAttributeAssignmentException ex) {\n+\t\t\tthrow new InternalErrorException(ex);\n+\t\t}\n+\t}\n+\n+\tprivate Attribute getUidNamespaceAttribute(PerunSessionImpl sess, Facility facility) throws InternalErrorException {\n+\t\ttry {\n+\t\t\treturn sess.getPerunBl().getAttributesManagerBl().getAttribute(sess, facility, A_FAC_uidNamespace);\n+\t\t} catch(AttributeNotExistsException | WrongAttributeAssignmentException ex) { throw new InternalErrorException(ex);\n+\t\t}\n+\t}\n+\n+\t@Override\n+\tpublic List<String> getDependencies() {\n+\t\tList<String> dependencies = new ArrayList<>();\n+\t\tdependencies.add(A_FAC_uidNamespace);\n+\t\tdependencies.add(A_E_namespaceUIDRanges);\n+\t\treturn dependencies;\n+\t}\n+\n+\t@Override\n+\tpublic List<String> getStrongDependencies() {\n+\t\tList<String> strongDependencies = new ArrayList<>();\n+\t\tstrongDependencies.add(A_FAC_uidNamespace);\n+\t\tstrongDependencies.add(A_E_namespaceUIDRanges);\n+\t\treturn strongDependencies;\n+\t}\n+\n+\t@Override\n+\tpublic AttributeDefinition getAttributeDefinition() {\n+\t\tAttributeDefinition attr = new AttributeDefinition();\n+\t\tattr.setNamespace(AttributesManager.NS_FACILITY_ATTR_VIRT);\n+\t\tattr.setFriendlyName(\"UIDRanges\");\n+\t\tattr.setDisplayName(\"UID ranges in set namespace for the Facility\");\n+\t\tattr.setType(List.class.getName());", "originalCommit": "f1bb8a107018b18d4a10759dbd75141a418d9eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxNzM1Ng==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r445217356", "bodyText": "It has the correct type now, thank you.", "author": "metodej", "createdAt": "2020-06-24T23:00:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgwOTkxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxNDE0Ng==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r444814146", "bodyText": "We no longer use InternalErrorException in the API, please remove it from all the methods.", "author": "zlamalp", "createdAt": "2020-06-24T11:01:01Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/impl/modules/attributes/urn_perun_facility_attribute_def_virt_UIDRanges.java", "diffHunk": "@@ -0,0 +1,93 @@\n+package cz.metacentrum.perun.core.impl.modules.attributes;\n+\n+import cz.metacentrum.perun.core.api.Attribute;\n+import cz.metacentrum.perun.core.api.AttributeDefinition;\n+import cz.metacentrum.perun.core.api.AttributesManager;\n+import cz.metacentrum.perun.core.api.Facility;\n+import cz.metacentrum.perun.core.api.exceptions.*;\n+import cz.metacentrum.perun.core.impl.PerunSessionImpl;\n+import cz.metacentrum.perun.core.impl.Utils;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleAbstract;\n+import cz.metacentrum.perun.core.implApi.modules.attributes.FacilityVirtualAttributesModuleImplApi;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+public class urn_perun_facility_attribute_def_virt_UIDRanges extends FacilityVirtualAttributesModuleAbstract implements FacilityVirtualAttributesModuleImplApi {\n+\n+\tprivate static final String A_E_namespaceUIDRanges = AttributesManager.NS_ENTITYLESS_ATTR_DEF + \":namespace-UIDRanges\";\n+\tprivate static final String A_FAC_uidNamespace = AttributesManager.NS_FACILITY_ATTR_DEF + \":uid-namespace\";\n+\n+\t@Override\n+\tpublic void checkAttributeSemantics(PerunSessionImpl sess, Facility facility, Attribute attribute) throws InternalErrorException, WrongReferenceAttributeValueException, WrongAttributeAssignmentException {", "originalCommit": "f1bb8a107018b18d4a10759dbd75141a418d9eaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIxNzIzMA==", "url": "https://github.com/CESNET/perun/pull/2647#discussion_r445217230", "bodyText": "Okay, removed.", "author": "metodej", "createdAt": "2020-06-24T23:00:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgxNDE0Ng=="}], "type": "inlineReview"}, {"oid": "7c6360b4758f851ad1d6288fc4d84ebdea2fd6f8", "url": "https://github.com/CESNET/perun/commit/7c6360b4758f851ad1d6288fc4d84ebdea2fd6f8", "message": "Added attribute to store UID ranges\n\n- added new attributes to store UID ranges instead of UID max/min\n- renamed method used to check and convert GID and now UID ranges", "committedDate": "2020-06-24T22:48:52Z", "type": "commit"}, {"oid": "a7e625887d2b863b19fbb545d3b4d7ff4d300356", "url": "https://github.com/CESNET/perun/commit/a7e625887d2b863b19fbb545d3b4d7ff4d300356", "message": "Fixes based on review\n\n- removed InternalErrorException from all methods\n- attribute type in definition changed to LikedHashMap", "committedDate": "2020-06-24T22:55:46Z", "type": "commit"}, {"oid": "a7e625887d2b863b19fbb545d3b4d7ff4d300356", "url": "https://github.com/CESNET/perun/commit/a7e625887d2b863b19fbb545d3b4d7ff4d300356", "message": "Fixes based on review\n\n- removed InternalErrorException from all methods\n- attribute type in definition changed to LikedHashMap", "committedDate": "2020-06-24T22:55:46Z", "type": "forcePushed"}]}