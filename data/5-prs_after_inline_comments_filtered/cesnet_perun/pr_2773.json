{"pr_number": 2773, "pr_title": "CORE: Move generating random password into PasswordManagerModule", "pr_createdAt": "2020-07-01T09:23:40Z", "pr_url": "https://github.com/CESNET/perun/pull/2773", "timeline": [{"oid": "58aa3a79320aeae959b09180a0201545594eb4cd", "url": "https://github.com/CESNET/perun/commit/58aa3a79320aeae959b09180a0201545594eb4cd", "message": "CORE: Move generating random password into PasswordManagerModule\n\n- PasswordManagerModule can now generate own random password.\n  It does it from defined chars in expected length and performs\n  check on strength. Only passwords passing that check are returned.\n  Null is returned on fail.\n- Added module for 'vsup' namespace, which have specific requirements\n  for random password generation. Eg. omit chars that user can mistake\n  on keyboard: l vs I, yY<->zZ, special chars.", "committedDate": "2020-07-01T09:22:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgyMDc1Nw==", "url": "https://github.com/CESNET/perun/pull/2773#discussion_r448820757", "bodyText": "I can't see the changePassword method call.", "author": "Vojtech-Sassmann", "createdAt": "2020-07-02T08:02:47Z", "path": "perun-core/src/main/java/cz/metacentrum/perun/core/blImpl/UsersManagerBlImpl.java", "diffHunk": "@@ -2064,43 +2061,38 @@ public void removeAllUserExtSources(PerunSession sess, User user) {\n \t}\n \n \t@Override\n-\tpublic String changePasswordRandom(PerunSession session, User user, String loginNamespace) throws PasswordOperationTimeoutException, LoginNotExistsException, PasswordChangeFailedException, InvalidLoginException, PasswordStrengthException {\n-\n-\t\tchar[] possibleCharacters =\n-\t\t\t\t\"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%&*()-_=+;:,<.>/?\"\n-\t\t\t\t\t\t.toCharArray();\n-\t\tint count = 12;\n-\n-\t\t// FIXME - We will replace following logic once each login-namespace will implement\n-\t\t// FIXME   pwd-manager module and have server side checks\n-\t\tif (Objects.equals(loginNamespace, \"vsup\")) {\n-\t\t\tcount = 14;\n-\t\t\t// removed O, l, specific only: +, -, *, /, .\n-\t\t\tpossibleCharacters = \"ABCDEFGHIJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz0123456789+-*/.\".toCharArray();\n-\t\t}\n-\n-\t\tString newRandomPassword = RandomStringUtils.random(count, 0, possibleCharacters.length - 1, false,\n-\t\t\t\tfalse, possibleCharacters, new SecureRandom());\n+\tpublic String changePasswordRandom(PerunSession session, User user, String namespace) throws PasswordOperationTimeoutException, LoginNotExistsException, PasswordChangeFailedException, InvalidLoginException, PasswordStrengthException {\n \n+\t\t// first check if user has login in specified namespace!\n+\t\tString userLogin;\n \t\ttry {\n-\t\t\t// FIXME - we want to re-generate password if it was considered weak\n-\t\t\tchangePassword(session, user, loginNamespace, null, newRandomPassword, false);\n-\t\t} catch (PasswordDoesntMatchException | PasswordStrengthFailedException e) {\n-\t\t\t// should not happen when we are not using the old password\n+\t\t\tAttribute userLoginAttribute = getPerunBl().getAttributesManagerBl().getAttribute(session, user, AttributesManager.NS_USER_ATTR_DEF + \":login-namespace:\" + namespace);\n+\t\t\tuserLogin = (String) userLoginAttribute.getValue();\n+\t\t} catch (WrongAttributeAssignmentException | AttributeNotExistsException e) {\n+\t\t\t// should not happen since the changePassword method passed", "originalCommit": "58aa3a79320aeae959b09180a0201545594eb4cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODg4MzY0MQ==", "url": "https://github.com/CESNET/perun/pull/2773#discussion_r448883641", "bodyText": "It was moved to the line 2087, since we now first check if user has login and then perform other logic.", "author": "zlamalp", "createdAt": "2020-07-02T09:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODgyMDc1Nw=="}], "type": "inlineReview"}]}