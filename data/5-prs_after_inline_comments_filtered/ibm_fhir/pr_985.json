{"pr_number": 985, "pr_title": "BulkData $import API improvement - Exit Status #949", "pr_createdAt": "2020-04-26T00:45:31Z", "pr_url": "https://github.com/IBM/FHIR/pull/985", "timeline": [{"oid": "4574c505d9722829ea525e4078942339de1dbeb6", "url": "https://github.com/IBM/FHIR/commit/4574c505d9722829ea525e4078942339de1dbeb6", "message": "BulkData $import API improvement - Exit Status #949\n\n- Updated the ChunkJob.xml to include missing parameters (the passed\nvalues didn't agree)\n- Add guard for null condition\n- Added support for operational outcome bucket\n```\n{\n    \"transactionTime\": \"2020-04-25T20:35:50.699-04:00\",\n    \"request\": \"$import\",\n    \"requiresAccessToken\": false,\n    \"output\": [\n        {\n            \"type\": \"OperationOutcome\",\n            \"url\": \"test-import.ndjson_oo_success.ndjson\",\n            \"count\": 3\n        }\n    ],\n    \"error\": [\n        {\n            \"type\": \"OperationOutcome\",\n            \"url\": \"test-import.ndjson_oo_errors.ndjson\",\n            \"count\": 0\n        }\n    ]\n}```\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-04-26T00:44:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2NzM0Mw==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415767343", "bodyText": "not sure why this change is needed, not inject property is used in ImportPartitionCollector(), the CosClient was created in ImportPartitionCollector() to make sure it's only created once for each ImportPartitionCollector object.", "author": "albertwang-ibm", "createdAt": "2020-04-27T12:25:19Z", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkimport/ImportPartitionCollector.java", "diffHunk": "@@ -80,10 +86,7 @@ public ImportPartitionCollector() throws Exception {\n                 logger.finer(\"ImportPartitionCollector: Succeed get CosClient!\");\n             }\n         }\n-    }\n \n-    @Override\n-    public Serializable collectPartitionData() throws Exception{", "originalCommit": "4574c505d9722829ea525e4078942339de1dbeb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2ODcwMA==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415768700", "bodyText": "it was null, always null when executed", "author": "prb112", "createdAt": "2020-04-27T12:27:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2NzM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2ODgyNg==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415768826", "bodyText": "I debugged it, and found it was injected after object creation", "author": "prb112", "createdAt": "2020-04-27T12:27:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2NzM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5NDk1Nw==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415794957", "bodyText": "I am leaving this code as-is", "author": "prb112", "createdAt": "2020-04-27T13:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2NzM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5OTk4Mg==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415799982", "bodyText": "en... this is ugly. so this means the constructor is never called.", "author": "albertwang-ibm", "createdAt": "2020-04-27T13:12:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2NzM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNDExNg==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415804116", "bodyText": "The constructor is called... then injection... you're depending on the injection to happen prior to the constructor call .", "author": "prb112", "createdAt": "2020-04-27T13:17:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc2NzM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MDIzOQ==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415770239", "bodyText": "Mapper already got these properties from injection, don't need to pass through partition properties.", "author": "albertwang-ibm", "createdAt": "2020-04-27T12:29:42Z", "path": "fhir-bulkimportexport-webapp/src/main/java/com/ibm/fhir/bulkimport/ImportPartitionMapper.java", "diffHunk": "@@ -269,6 +276,13 @@ public PartitionPlan mapPartitions() throws Exception {\n             Properties p = new Properties();\n             p.setProperty(Constants.IMPORT_PARTITTION_WORKITEM, fhirDataSource.getUrl());\n             p.setProperty(Constants.IMPORT_PARTITTION_RESOURCE_TYPE, fhirDataSource.getType());\n+            p.setProperty(Constants.COS_API_KEY, cosApiKeyProperty);\n+            p.setProperty(Constants.COS_SRVINST_ID, cosSrvinstId);\n+            p.setProperty(Constants.COS_ENDPOINT_URL, cosEndpointUrl);\n+            p.setProperty(Constants.COS_LOCATION, cosLocation);\n+            p.setProperty(Constants.COS_OPERATIONOUTCOMES_BUCKET_NAME, cosOperationOutcomesBucketName);\n+            p.setProperty(Constants.COS_IS_IBM_CREDENTIAL, cosCredentialIbm);\n+", "originalCommit": "4574c505d9722829ea525e4078942339de1dbeb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MTI4NA==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415771284", "bodyText": "That's not what I found, I found the properties were empty when it went to the step execution", "author": "prb112", "createdAt": "2020-04-27T12:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5NDY5MA==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415794690", "bodyText": "backed out this change.", "author": "prb112", "createdAt": "2020-04-27T13:05:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwMjMyMQ==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415802321", "bodyText": "I don't really think this is correct, I mean if so, the import job should have always failed.", "author": "albertwang-ibm", "createdAt": "2020-04-27T13:15:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgwNTQ2Ng==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415805466", "bodyText": "sorry, I mean the chunkjob steps already got these properties from injection. don't need to be set by the mapper.  otherwise, the import job should have never succeeded from the beginning ...", "author": "albertwang-ibm", "createdAt": "2020-04-27T13:19:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MDIzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTgxNDY5OQ==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415814699", "bodyText": "Yes, no worries, it was confused with the Collector problem. All fixed now", "author": "prb112", "createdAt": "2020-04-27T13:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3MDIzOQ=="}], "type": "inlineReview"}, {"oid": "b97c16145e83c9cc6a4a9ea9f84ee25a7a5f97d1", "url": "https://github.com/IBM/FHIR/commit/b97c16145e83c9cc6a4a9ea9f84ee25a7a5f97d1", "message": "Update fhir-bulkimportexport-webapp/src/main/java/META-INF/batch-jobs/FhirBulkImportChunkJob.xml\r\n\r\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-04-27T12:29:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjUwMg==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415776502", "bodyText": "better use OperationOutcome instead of Oo?", "author": "albertwang-ibm", "createdAt": "2020-04-27T12:39:14Z", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/client/BulkDataClient.java", "diffHunk": "@@ -448,6 +453,7 @@ public String submitImport(String inputFormat, String inputSource, List<Input> i\n         builder.applicationName(properties.get(BulkDataConfigUtil.APPLICATION_NAME));\n         builder.moduleName(properties.get(BulkDataConfigUtil.MODULE_NAME));\n         builder.cosBucketName(properties.get(BulkDataConfigUtil.JOB_PARAMETERS_BUCKET));\n+        builder.cosBucketNameOo(properties.get(BulkDataConfigUtil.JOB_PARAMETERS_BUCKET));", "originalCommit": "4574c505d9722829ea525e4078942339de1dbeb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MDc3MQ==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415790771", "bodyText": "Fixed in next commit", "author": "prb112", "createdAt": "2020-04-27T12:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjUwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MTE2MQ==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415791161", "bodyText": "Fixed in next commit", "author": "prb112", "createdAt": "2020-04-27T13:00:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjUwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjgzMw==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415776833", "bodyText": "better use OperationOutcome instead of Oo?", "author": "albertwang-ibm", "createdAt": "2020-04-27T12:39:44Z", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/model/JobExecutionResponse.java", "diffHunk": "@@ -340,6 +340,11 @@ public Builder fhirStorageType(StorageDetail storageDetails) {\n             jobParameter.setStorageDetails(storageDetails);\n             return this;\n         }\n+\n+        public Builder cosBucketNameOo(String cosBucketNameOo) {", "originalCommit": "4574c505d9722829ea525e4078942339de1dbeb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MDg0NA==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415790844", "bodyText": "Fixed in next commit", "author": "prb112", "createdAt": "2020-04-27T12:59:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjgzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MTIxOA==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415791218", "bodyText": "Fixed in next commit", "author": "prb112", "createdAt": "2020-04-27T13:00:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NjgzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NzQ5MA==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415777490", "bodyText": "Oo seems strange ...", "author": "albertwang-ibm", "createdAt": "2020-04-27T12:40:48Z", "path": "fhir-operation-bulkdata/src/main/java/com/ibm/fhir/operation/bulkdata/model/JobInstanceRequest.java", "diffHunk": "@@ -190,6 +190,11 @@ public JobInstanceRequest build() {\n             request.setJobParameters(jobParameter);\n             return request;\n         }\n+\n+        public Builder cosBucketNameOo(String cosBucketNameOo) {", "originalCommit": "4574c505d9722829ea525e4078942339de1dbeb6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MDkwMQ==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415790901", "bodyText": "Fixed in next commit", "author": "prb112", "createdAt": "2020-04-27T12:59:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NzQ5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc5MTI4Ng==", "url": "https://github.com/IBM/FHIR/pull/985#discussion_r415791286", "bodyText": "Fixed in next commit", "author": "prb112", "createdAt": "2020-04-27T13:00:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTc3NzQ5MA=="}], "type": "inlineReview"}, {"oid": "82fb63f07613d154e8c2011893e71aa376568f22", "url": "https://github.com/IBM/FHIR/commit/82fb63f07613d154e8c2011893e71aa376568f22", "message": "BulkData $import API improvement - Exit Status #949\n\nSigned-off-by: Paul Bastide <pbastide@us.ibm.com>", "committedDate": "2020-04-27T13:05:56Z", "type": "commit"}, {"oid": "709ad3b44846d5ccba0404dd55bd9cf7e6c41487", "url": "https://github.com/IBM/FHIR/commit/709ad3b44846d5ccba0404dd55bd9cf7e6c41487", "message": "Merge branch 'issue-949' of github.com:IBM/FHIR into issue-949", "committedDate": "2020-04-27T13:06:19Z", "type": "commit"}]}