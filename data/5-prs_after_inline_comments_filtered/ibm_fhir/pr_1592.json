{"pr_number": 1592, "pr_title": "issue #1449 - build the capabilitystatement from the config", "pr_createdAt": "2020-10-19T13:08:16Z", "pr_url": "https://github.com/IBM/FHIR/pull/1592", "timeline": [{"oid": "12fca15b4a021aba736c0d0b19c58c9d8903397f", "url": "https://github.com/IBM/FHIR/commit/12fca15b4a021aba736c0d0b19c58c9d8903397f", "message": "issue #1449 - build the capabilitystatement from the config\n\nNow operators can configure the server to advertise only a subset of\nresource types and/or interactions via the new resources config section\nof fhir-server-config.json.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T13:11:11Z", "type": "forcePushed"}, {"oid": "96d9a21cf2e314d35915b5ac05975f0fc5861a46", "url": "https://github.com/IBM/FHIR/commit/96d9a21cf2e314d35915b5ac05975f0fc5861a46", "message": "issue #1449 - build the capabilitystatement from the config\n\nNow operators can configure the server to advertise only a subset of\nresource types and/or interactions via the new resources config section\nof fhir-server-config.json.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T14:15:23Z", "type": "commit"}, {"oid": "96d9a21cf2e314d35915b5ac05975f0fc5861a46", "url": "https://github.com/IBM/FHIR/commit/96d9a21cf2e314d35915b5ac05975f0fc5861a46", "message": "issue #1449 - build the capabilitystatement from the config\n\nNow operators can configure the server to advertise only a subset of\nresource types and/or interactions via the new resources config section\nof fhir-server-config.json.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T14:15:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MjgwOQ==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507782809", "bodyText": "Personal preference.  \"search\".equals(interactionString)\nSame for other else if checks in this method.", "author": "tbieste", "createdAt": "2020-10-19T14:13:18Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/Capabilities.java", "diffHunk": "@@ -383,10 +397,55 @@ private CapabilityStatement buildCapabilityStatement() throws Exception {\n         return conformance;\n     }\n \n+    private List<Rest.Resource.Interaction> buildInteracations(List<String> interactionConfig) throws FHIRPersistenceException {\n+        if (interactionConfig == null) return null;\n+\n+        List<Rest.Resource.Interaction> defaultInteractions = new ArrayList<>();\n+        for (String interactionString : interactionConfig) {\n+            if (interactionString.equals(\"search\")) {", "originalCommit": "12fca15b4a021aba736c0d0b19c58c9d8903397f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc5NzI5Ng==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507797296", "bodyText": "suggestion taken", "author": "lmsurpre", "createdAt": "2020-10-19T14:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MjgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MzU1Mw==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507783553", "bodyText": "Variable is defaultInteractions, but this isn't just for defaults. Consider renaming variable.", "author": "tbieste", "createdAt": "2020-10-19T14:14:19Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/Capabilities.java", "diffHunk": "@@ -383,10 +397,55 @@ private CapabilityStatement buildCapabilityStatement() throws Exception {\n         return conformance;\n     }\n \n+    private List<Rest.Resource.Interaction> buildInteracations(List<String> interactionConfig) throws FHIRPersistenceException {\n+        if (interactionConfig == null) return null;\n+\n+        List<Rest.Resource.Interaction> defaultInteractions = new ArrayList<>();", "originalCommit": "12fca15b4a021aba736c0d0b19c58c9d8903397f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc5NTU1NA==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507795554", "bodyText": "Oh, I saw this buildInteractions method also called on line 256, which made me think it wasn't just the defaults.", "author": "tbieste", "createdAt": "2020-10-19T14:28:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MzU1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc5NjcyOA==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507796728", "bodyText": "you were right, i was wrong.  thought this was in the other spot.  suggestion taken.", "author": "lmsurpre", "createdAt": "2020-10-19T14:29:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MzU1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MzgxOA==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507783818", "bodyText": "Typo in \"Interacations\"", "author": "tbieste", "createdAt": "2020-10-19T14:14:38Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/Capabilities.java", "diffHunk": "@@ -383,10 +397,55 @@ private CapabilityStatement buildCapabilityStatement() throws Exception {\n         return conformance;\n     }\n \n+    private List<Rest.Resource.Interaction> buildInteracations(List<String> interactionConfig) throws FHIRPersistenceException {", "originalCommit": "12fca15b4a021aba736c0d0b19c58c9d8903397f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc5NzA3MA==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507797070", "bodyText": "fixed", "author": "lmsurpre", "createdAt": "2020-10-19T14:29:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzc4MzgxOA=="}], "type": "inlineReview"}, {"oid": "b924c1e2aece097d057e5f22e67cd5c7b3acac03", "url": "https://github.com/IBM/FHIR/commit/b924c1e2aece097d057e5f22e67cd5c7b3acac03", "message": "address feedback from PR\n\nminor renaming and style stuff\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T14:28:01Z", "type": "forcePushed"}, {"oid": "ffc55abd591b42fabc4c695d02ba14c9cb665544", "url": "https://github.com/IBM/FHIR/commit/ffc55abd591b42fabc4c695d02ba14c9cb665544", "message": "add null check and address feedback from PR\n\nthis should fix the case where there is no `resources` field in the\nconfig\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T15:06:38Z", "type": "forcePushed"}, {"oid": "cf5f45ad722b51bbc79d49f3d6030813f3c8e7ba", "url": "https://github.com/IBM/FHIR/commit/cf5f45ad722b51bbc79d49f3d6030813f3c8e7ba", "message": "add null check and address feedback from PR\n\nthis should fix the case where there is no `resources` field in the\nconfig\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T15:33:30Z", "type": "forcePushed"}, {"oid": "b955a3b066a8bcdd8f489597279524f2411052f6", "url": "https://github.com/IBM/FHIR/commit/b955a3b066a8bcdd8f489597279524f2411052f6", "message": "issue #1499 - added docs\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T16:07:57Z", "type": "forcePushed"}, {"oid": "9c1e751aecca9612d78fad5d1630018189a02836", "url": "https://github.com/IBM/FHIR/commit/9c1e751aecca9612d78fad5d1630018189a02836", "message": "issue #1499 - added docs\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T16:22:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwMDg5MQ==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507900891", "bodyText": "This is such a complicated stack to get here, it may be good to put a comment about the input and output as an ImplNote (not required, just a thought on how complex this Resource can be to build. )", "author": "prb112", "createdAt": "2020-10-19T16:46:45Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/Capabilities.java", "diffHunk": "@@ -383,10 +408,55 @@ private CapabilityStatement buildCapabilityStatement() throws Exception {\n         return conformance;\n     }\n \n+    private List<Rest.Resource.Interaction> buildInteractions(List<String> interactionConfig) throws FHIRPersistenceException {", "originalCommit": "9c1e751aecca9612d78fad5d1630018189a02836", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2NjQ5MQ==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507966491", "bodyText": "added some javadoc", "author": "lmsurpre", "createdAt": "2020-10-19T18:16:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwMDg5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwMTA1Mw==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507901053", "bodyText": "Same comment as 411", "author": "prb112", "createdAt": "2020-10-19T16:47:00Z", "path": "fhir-server/src/main/java/com/ibm/fhir/server/resources/Capabilities.java", "diffHunk": "@@ -383,10 +408,55 @@ private CapabilityStatement buildCapabilityStatement() throws Exception {\n         return conformance;\n     }\n \n+    private List<Rest.Resource.Interaction> buildInteractions(List<String> interactionConfig) throws FHIRPersistenceException {\n+        if (interactionConfig == null) return null;\n+\n+        List<Rest.Resource.Interaction> interactions = new ArrayList<>();\n+        for (String interactionString : interactionConfig) {\n+            if (\"search\".equals(interactionString)) {\n+                // special case for search since the value set uses \"search-type\" instead of just \"search\"\n+                interactions.add(buildInteractionStatement(TypeRestfulInteraction.SEARCH_TYPE));\n+            } else if (\"history\".equals(interactionString)){\n+                // special case for search since the value set uses \"history-instance\" instead of just \"history\"\n+                interactions.add(buildInteractionStatement(TypeRestfulInteraction.HISTORY_INSTANCE));\n+            } else if (\"delete\".equals(interactionString)) {\n+                // special case for delete since we shouldn't advertise it if the PL doesn't support it\n+                interactions.add(buildInteractionStatement(TypeRestfulInteraction.DELETE));\n+            } else {\n+                interactions.add(buildInteractionStatement(TypeRestfulInteraction.of(interactionString)));\n+            }\n+        }\n+        return interactions;\n+    }\n+\n+    private List<ResourceType.ValueSet> getSupportedResourceTypes(boolean supportOmittedRsrcTypes) throws Exception {", "originalCommit": "9c1e751aecca9612d78fad5d1630018189a02836", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk2NjQxNQ==", "url": "https://github.com/IBM/FHIR/pull/1592#discussion_r507966415", "bodyText": "added some javadoc", "author": "lmsurpre", "createdAt": "2020-10-19T18:16:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwMTA1Mw=="}], "type": "inlineReview"}, {"oid": "bf5f87e33f419f3f991003790b06dcb63157b6dc", "url": "https://github.com/IBM/FHIR/commit/bf5f87e33f419f3f991003790b06dcb63157b6dc", "message": "issue #1499 - added docs\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T16:50:00Z", "type": "forcePushed"}, {"oid": "974d8a3264c89fdee39f6d76e9a280210d144342", "url": "https://github.com/IBM/FHIR/commit/974d8a3264c89fdee39f6d76e9a280210d144342", "message": "added javadoc for private methods\n\nas suggested during review.  also refactored getSupportedResourceTypes a\nbit.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T18:15:40Z", "type": "forcePushed"}, {"oid": "5e7388212c06ab3ce648a2073b407c19796c291b", "url": "https://github.com/IBM/FHIR/commit/5e7388212c06ab3ce648a2073b407c19796c291b", "message": "add null check and address feedback from PR\n\nthis should fix the case where there is no `resources` field in the\nconfig\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T21:25:37Z", "type": "commit"}, {"oid": "1d23fd48b51810eae430b4a2e8f8201fb30dcee4", "url": "https://github.com/IBM/FHIR/commit/1d23fd48b51810eae430b4a2e8f8201fb30dcee4", "message": "added javadoc for private methods\n\nas suggested during review.  also refactored getSupportedResourceTypes a\nbit.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T21:25:50Z", "type": "forcePushed"}, {"oid": "21fc059792820c598029fae9443415bc9429f909", "url": "https://github.com/IBM/FHIR/commit/21fc059792820c598029fae9443415bc9429f909", "message": "added doc to user's guide and added javadoc for private methods\n\nas suggested during review.  also refactored getSupportedResourceTypes a\nbit.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T21:27:34Z", "type": "commit"}, {"oid": "21fc059792820c598029fae9443415bc9429f909", "url": "https://github.com/IBM/FHIR/commit/21fc059792820c598029fae9443415bc9429f909", "message": "added doc to user's guide and added javadoc for private methods\n\nas suggested during review.  also refactored getSupportedResourceTypes a\nbit.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T21:27:34Z", "type": "forcePushed"}, {"oid": "f44090fbb982a6b520b769df9286b2ba3c003045", "url": "https://github.com/IBM/FHIR/commit/f44090fbb982a6b520b769df9286b2ba3c003045", "message": "Use FHIRConfigHelper over fhirConfig to support per-tenant capabilities\n\n`FHIRResource.fhirConfig` is always using the default tenant.\nInstead, we should use FHIRConfigHelper for most properties so that we\nget that nice tenant->default fallback lookup.\n\nThis change focuses on the following properties:\n* `fhirServer/core/capabilityStatementCacheTimeout`\n* `fhirServer/security/*`\n\nThe former was marked as tenant-specific, but wasn't.  The latter was\nmarked as `N|N` but there was no reason for this since they are just\nabout controlling the CapabilityStatement and smart-configuration info.\n\nIn addition to useful behavior, this change puts us in a better position\nfor testing various configs more easilly.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-19T22:21:31Z", "type": "commit"}, {"oid": "d7da15baa22557a76f1f020a17bd375f61594eeb", "url": "https://github.com/IBM/FHIR/commit/d7da15baa22557a76f1f020a17bd375f61594eeb", "message": "Merge pull request #1601 from IBM/issue-1449-tests\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T00:42:17Z", "type": "commit"}, {"oid": "dc560b6085731cc1af3089eb804ed5223d420a0c", "url": "https://github.com/IBM/FHIR/commit/dc560b6085731cc1af3089eb804ed5223d420a0c", "message": "fix the PROPERTY_SECURITY_CERT_ENABLED property path\n\nin the sample config (and now the docs), we spell out certificates\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T03:15:19Z", "type": "commit"}, {"oid": "ce32f1145019adfdb78828b9fa039b1c458fb09a", "url": "https://github.com/IBM/FHIR/commit/ce32f1145019adfdb78828b9fa039b1c458fb09a", "message": "Add tests for issues #1589 and #1449\n\nWe don't make it very easy to add component-level tests for our rest\nlayer.  This pull request works with what we have to test the public\nJAX-RS methods for building the CapabilityStatement resource and the\nsmart-configuration JSON from various configs.\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T03:18:51Z", "type": "commit"}, {"oid": "069c5607ecd67e3bd943225dbf98af6ff66eed52", "url": "https://github.com/IBM/FHIR/commit/069c5607ecd67e3bd943225dbf98af6ff66eed52", "message": "removed TODOs and move tests to com.ibm.fhir.server.test package\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T12:54:49Z", "type": "commit"}, {"oid": "e8300cfa3f56ad29060313fb86976766f5d10a8b", "url": "https://github.com/IBM/FHIR/commit/e8300cfa3f56ad29060313fb86976766f5d10a8b", "message": "Merge pull request #1603 from IBM/issue-1449-tests\n\nSigned-off-by: Lee Surprenant <lmsurpre@us.ibm.com>", "committedDate": "2020-10-20T13:21:23Z", "type": "commit"}]}