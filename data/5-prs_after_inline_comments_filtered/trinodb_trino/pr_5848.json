{"pr_number": 5848, "pr_title": "Update to testcontainers to fix running tests on Mac", "pr_createdAt": "2020-11-05T20:58:00Z", "pr_url": "https://github.com/trinodb/trino/pull/5848", "timeline": [{"oid": "954eedde0ad828bb5703b338b004eb147b0bc932", "url": "https://github.com/trinodb/trino/commit/954eedde0ad828bb5703b338b004eb147b0bc932", "message": "Do not allocate resources within test constructor\n\nMaven surefire plugin does not report full exception when it happens\nduring test class constructor call.", "committedDate": "2020-11-06T15:00:49Z", "type": "commit"}, {"oid": "2f68e750a383ff76215aec28b70ad362aa9ae545", "url": "https://github.com/trinodb/trino/commit/2f68e750a383ff76215aec28b70ad362aa9ae545", "message": "Report resource name when missing", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "9f819dacd918c523282ee31461a95a6a1e1e91b4", "url": "https://github.com/trinodb/trino/commit/9f819dacd918c523282ee31461a95a6a1e1e91b4", "message": "Fix resource URI to file system path conversion", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "ed4d9a2d691a992988b7d4157684e794c2c91905", "url": "https://github.com/trinodb/trino/commit/ed4d9a2d691a992988b7d4157684e794c2c91905", "message": "Flatten unnecessary packages\n\n`TestDynamicTable` was in separate package for no apparent, important reason.\n`util` package did not contain e.g. `MetadataUtil` class.", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "07e7ca73442f077c0d9699588d599231fe3758a1", "url": "https://github.com/trinodb/trino/commit/07e7ca73442f077c0d9699588d599231fe3758a1", "message": "Adjusts CI timeouts\n\nMaven checks can legitimately take 30 minutes.\nAssumption is that same applies to Error Prone checks.", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "276458bb0e303292048c068985d02c0e464ed281", "url": "https://github.com/trinodb/trino/commit/276458bb0e303292048c068985d02c0e464ed281", "message": "Do not close DockerClientFactory.lazyClient()\n\n`DockerClientFactory.lazyClient` is a singleton, does not need to be\nclosed. Currently, the `close()` is delegated and eventually ignored in\n`com.github.dockerjava.okhttp.OkHttpDockerCmdExecFactory`. `close()` will be\nexplicitly rejected in future testcontainers version.", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "ae2be0cc5b281c11051c098c513f5c01b86a40bd", "url": "https://github.com/trinodb/trino/commit/ae2be0cc5b281c11051c098c513f5c01b86a40bd", "message": "Declare shared network explicitly\n\nPinot tests (`TestMinimalFunctionality`) depend on the fact that Kafka\ncontainer created by `TestingKafka` and Pinot container created by\n`TestingPinotCluster` are on the same network. This is currently\nimplicitly the case, as `KafkaContainer` sets `Network.SHARED` in its\nconstructor, but it won't be so in a future version of testcontainers.", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2", "url": "https://github.com/trinodb/trino/commit/3defb197f8a76ccd5c190b83162544d0e8dcfce2", "message": "Update to testcontainers to fix running tests on Mac\n\nThe RC2 version contains a fix for\nhttps://github.com/testcontainers/testcontainers-java/issues/3166.", "committedDate": "2020-11-06T15:00:54Z", "type": "commit"}, {"oid": "3defb197f8a76ccd5c190b83162544d0e8dcfce2", "url": "https://github.com/trinodb/trino/commit/3defb197f8a76ccd5c190b83162544d0e8dcfce2", "message": "Update to testcontainers to fix running tests on Mac\n\nThe RC2 version contains a fix for\nhttps://github.com/testcontainers/testcontainers-java/issues/3166.", "committedDate": "2020-11-06T15:00:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyOTAzMQ==", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518829031", "bodyText": "What\u2019s this?", "author": "martint", "createdAt": "2020-11-06T15:34:01Z", "path": "presto-elasticsearch/src/test/java/io/prestosql/elasticsearch/ElasticsearchServer.java", "diffHunk": "@@ -35,7 +36,8 @@\n     public ElasticsearchServer(String image, Map<String, String> configurationFiles)\n             throws IOException\n     {\n-        container = new ElasticsearchContainer(image);\n+        DockerImageName dockerImageName = DockerImageName.parse(image).asCompatibleSubstituteFor(\"docker.elastic.co/elasticsearch/elasticsearch\");", "originalCommit": "3defb197f8a76ccd5c190b83162544d0e8dcfce2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzMDAwNQ==", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518830005", "bodyText": "see \"Add image compatibility checks\" in release notes at https://github.com/testcontainers/testcontainers-java/releases/tag/1.15.0", "author": "findepi", "createdAt": "2020-11-06T15:35:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyOTAzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzMzI1OQ==", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518833259", "bodyText": "Not sure I understand why we need it here, though. The official images for the open source version of ES are the ones in docker hub.", "author": "martint", "createdAt": "2020-11-06T15:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyOTAzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg0MTM5MQ==", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518841391", "bodyText": "This is called with\n\nelasticsearch:7.8.0 from  TestPasswordAuthentication\nelasticsearch:7.0.0 from TestElasticsearch7IntegrationSmokeTest\ndocker.elastic.co/elasticsearch/elasticsearch-oss:6.0.0 from TestElasticsearch6IntegrationSmokeTest", "author": "findepi", "createdAt": "2020-11-06T15:53:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyOTAzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODg0NDk4OQ==", "url": "https://github.com/trinodb/trino/pull/5848#discussion_r518844989", "bodyText": "The last one is because there's no 6.0.0 available in docker hub", "author": "martint", "createdAt": "2020-11-06T15:59:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgyOTAzMQ=="}], "type": "inlineReview"}]}