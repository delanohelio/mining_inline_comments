{"pr_number": 4983, "pr_title": "Fix CONVERT_TO_VARCHAR with arrays", "pr_createdAt": "2020-08-26T08:37:39Z", "pr_url": "https://github.com/trinodb/trino/pull/4983", "timeline": [{"oid": "89dd93b753a0cc30664246385f3d3310705c21c7", "url": "https://github.com/trinodb/trino/commit/89dd93b753a0cc30664246385f3d3310705c21c7", "message": "Extract variable", "committedDate": "2020-08-26T08:11:29Z", "type": "commit"}, {"oid": "4e8bbacd3433e185c0fda13c59908d5f22782b03", "url": "https://github.com/trinodb/trino/commit/4e8bbacd3433e185c0fda13c59908d5f22782b03", "message": "Fx bytea[] array exclusion", "committedDate": "2020-08-26T08:11:55Z", "type": "commit"}, {"oid": "f0014b1065a22ba0ff91ad1e95113cea5961a591", "url": "https://github.com/trinodb/trino/commit/f0014b1065a22ba0ff91ad1e95113cea5961a591", "message": "Fix CONVERT_TO_VARCHAR with arrays", "committedDate": "2020-08-26T08:37:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE2MzU3MA==", "url": "https://github.com/trinodb/trino/pull/4983#discussion_r477163570", "bodyText": "testUnsupportedDataTypeConvertedToVarchar and testUnsupportedDataTypeAsIgnored creates a table per each test. Hence it could take a long time to test all use cases. We had this issue before with regular type mapping tests. Maybe we should think to extend that framework to support unsupported type testing.\nWDYT?\nNo change requested, just thinking at loud.", "author": "kokosing", "createdAt": "2020-08-26T09:25:26Z", "path": "presto-postgresql/src/test/java/io/prestosql/plugin/postgresql/TestPostgreSqlTypeMapping.java", "diffHunk": "@@ -819,6 +840,12 @@ public void testArrayAsJson()\n                 .addRoundTrip(arrayAsJsonDataType(\"_text\"), \"[]\")\n                 .execute(getQueryRunner(), session, postgresCreateAndInsert(\"tpch.test_varchar_array_as_json\"));\n \n+        testUnsupportedDataTypeAsIgnored(session, \"bytea[]\", \"ARRAY['binary value'::bytea]\");\n+        testUnsupportedDataTypeAsIgnored(session, \"bytea[]\", \"ARRAY[ARRAY['binary value'::bytea]]\");\n+        testUnsupportedDataTypeAsIgnored(session, \"bytea[]\", \"ARRAY[ARRAY[ARRAY['binary value'::bytea]]]\");\n+        testUnsupportedDataTypeAsIgnored(session, \"_bytea\", \"ARRAY['binary value'::bytea]\");\n+        testUnsupportedDataTypeConvertedToVarchar(session, \"bytea[]\", \"ARRAY['binary value'::bytea]\", \"'{\\\"\\\\\\\\x62696e6172792076616c7565\\\"}'\");", "originalCommit": "f0014b1065a22ba0ff91ad1e95113cea5961a591", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE3MzEzMQ==", "url": "https://github.com/trinodb/trino/pull/4983#discussion_r477173131", "bodyText": "I added a few cases because we they apparently differ in execution flow within PostgreSQL JDBC driver.\ntestArrayAsJson took 3.2s and testArray took 9.8s for me.\n\nMaybe we should think to extend that framework to support unsupported type testing.\n\nLet's defer this until we have more of these.", "author": "findepi", "createdAt": "2020-08-26T09:41:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzE2MzU3MA=="}], "type": "inlineReview"}]}