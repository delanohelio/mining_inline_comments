{"pr_number": 3651, "pr_title": "Move delete analysis to the analyzer", "pr_createdAt": "2020-05-06T18:03:03Z", "pr_url": "https://github.com/trinodb/trino/pull/3651", "timeline": [{"oid": "52dd92eef6175093c1ab63a689a5a42448176eac", "url": "https://github.com/trinodb/trino/commit/52dd92eef6175093c1ab63a689a5a42448176eac", "message": "Move delete analysis to the analyzer\n\nThe derivation of the row id field was being done during planning\ninstead of analysis. This also resulted in having to special-case\nthe planning of the source table plan.", "committedDate": "2020-05-07T16:53:36Z", "type": "commit"}, {"oid": "52dd92eef6175093c1ab63a689a5a42448176eac", "url": "https://github.com/trinodb/trino/commit/52dd92eef6175093c1ab63a689a5a42448176eac", "message": "Move delete analysis to the analyzer\n\nThe derivation of the row id field was being done during planning\ninstead of analysis. This also resulted in having to special-case\nthe planning of the source table plan.", "committedDate": "2020-05-07T16:53:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg3OTMzNQ==", "url": "https://github.com/trinodb/trino/pull/3651#discussion_r421879335", "bodyText": "Should we add a check afterwards that the count matches unless it is a delete query?", "author": "dain", "createdAt": "2020-05-08T01:06:04Z", "path": "presto-main/src/main/java/io/prestosql/sql/analyzer/Analysis.java", "diffHunk": "@@ -783,6 +787,7 @@ public void addColumnMask(Table table, String column, Expression mask)\n                     NodeRef<Table> table = entry.getKey();\n \n                     List<ColumnInfo> columns = referencedFields.get(table).stream()\n+                            .filter(field -> field.getName().isPresent()) // For DELETE queries, the synthetic column for row id doesn't have a name", "originalCommit": "52dd92eef6175093c1ab63a689a5a42448176eac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg4OTY3MA==", "url": "https://github.com/trinodb/trino/pull/3651#discussion_r421889670", "bodyText": "No, I don't think so. This piece of code doesn't particularly care about whether it's a DELETE. It should work generically for any case where fields without a name are synthesized. The comment is there to clarify why that might happen.", "author": "martint", "createdAt": "2020-05-08T01:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTg3OTMzNQ=="}], "type": "inlineReview"}]}