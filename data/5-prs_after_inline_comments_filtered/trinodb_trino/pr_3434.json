{"pr_number": 3434, "pr_title": "Allow using temporary staging path for writing sorted files", "pr_createdAt": "2020-04-14T23:09:26Z", "pr_url": "https://github.com/trinodb/trino/pull/3434", "timeline": [{"oid": "df0c056eec3a4279665b27ce3b189bb46312cda6", "url": "https://github.com/trinodb/trino/commit/df0c056eec3a4279665b27ce3b189bb46312cda6", "message": "Allow using temporary staging path for writing sorted files", "committedDate": "2020-08-16T07:00:04Z", "type": "commit"}, {"oid": "414846c0bdae2c43b6f992ef72dd166f00efbd5a", "url": "https://github.com/trinodb/trino/commit/414846c0bdae2c43b6f992ef72dd166f00efbd5a", "message": "Document hive temporary staging directory configs", "committedDate": "2020-08-16T07:00:05Z", "type": "commit"}, {"oid": "414846c0bdae2c43b6f992ef72dd166f00efbd5a", "url": "https://github.com/trinodb/trino/commit/414846c0bdae2c43b6f992ef72dd166f00efbd5a", "message": "Document hive temporary staging directory configs", "committedDate": "2020-08-16T07:00:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxMjQ3OA==", "url": "https://github.com/trinodb/trino/pull/3434#discussion_r471412478", "bodyText": "don't you need to use io.prestosql.plugin.hive.util.HiveWriteUtils#createTemporaryPath?", "author": "kokosing", "createdAt": "2020-08-17T11:21:58Z", "path": "presto-hive/src/test/java/io/prestosql/plugin/hive/AbstractTestHive.java", "diffHunk": "@@ -2335,9 +2337,17 @@ private void doTestBucketSortedTables(SchemaTableName table)\n                 sink.appendPage(builder.build().toPage());\n             }\n \n-            // verify we have enough temporary files per bucket to require multiple passes\n-            Path stagingPathRoot = getStagingPathRoot(outputHandle);\n             HdfsContext context = new HdfsContext(session, table.getSchemaName(), table.getTableName());\n+            // verify we have enough temporary files per bucket to require multiple passes\n+            Path stagingPathRoot;\n+            if (isTemporaryStagingDirectoryEnabled(session)) {\n+                stagingPathRoot = new Path(getTemporaryStagingDirectoryPath(session)", "originalCommit": "df0c056eec3a4279665b27ce3b189bb46312cda6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQ1NzA5MA==", "url": "https://github.com/trinodb/trino/pull/3434#discussion_r471457090", "bodyText": "metadata.beginCreateTable (a few lines above) calls locationService.forNewTable, this has a call to createTemporaryPath. Here we are just setting up the right path for listing staged files for verification.", "author": "raunaqmorarka", "createdAt": "2020-08-17T12:52:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTQxMjQ3OA=="}], "type": "inlineReview"}]}