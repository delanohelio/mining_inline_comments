{"pr_number": 2826, "pr_title": "Throw meaningful error when accessing ACID on Hive < 3", "pr_createdAt": "2020-02-13T20:28:44Z", "pr_url": "https://github.com/trinodb/trino/pull/2826", "timeline": [{"oid": "1685cc4f1498d1d99cc6021ffd77d3edada49a8f", "url": "https://github.com/trinodb/trino/commit/1685cc4f1498d1d99cc6021ffd77d3edada49a8f", "message": "Handle ConfigValSecurityException in get_config_value thrift call", "committedDate": "2020-02-28T20:36:32Z", "type": "commit"}, {"oid": "cb9fc46dbd2bd4b25c075c06b470a8c427d32cc8", "url": "https://github.com/trinodb/trino/commit/cb9fc46dbd2bd4b25c075c06b470a8c427d32cc8", "message": "Throw meaningful error when accessing ACID on Hive < 3", "committedDate": "2020-02-28T20:36:32Z", "type": "commit"}, {"oid": "cb9fc46dbd2bd4b25c075c06b470a8c427d32cc8", "url": "https://github.com/trinodb/trino/commit/cb9fc46dbd2bd4b25c075c06b470a8c427d32cc8", "message": "Throw meaningful error when accessing ACID on Hive < 3", "committedDate": "2020-02-28T20:36:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNzIxNA==", "url": "https://github.com/trinodb/trino/pull/2826#discussion_r386337214", "bodyText": "Is it possible to have a test for that?", "author": "kokosing", "createdAt": "2020-03-02T11:24:46Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/ThriftHiveMetastore.java", "diffHunk": "@@ -1651,6 +1652,10 @@ public String getValidWriteIds(HiveIdentity identity, List<SchemaTableName> tabl\n                         }\n                     });\n         }\n+        catch (ConfigValSecurityException e) {", "originalCommit": "1685cc4f1498d1d99cc6021ffd77d3edada49a8f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQwMTcwMw==", "url": "https://github.com/trinodb/trino/pull/2826#discussion_r386401703", "bodyText": "It's tested by running Hive ACID with Hive <3 metastore.", "author": "findepi", "createdAt": "2020-03-02T13:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzNzIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODEwMw==", "url": "https://github.com/trinodb/trino/pull/2826#discussion_r386338103", "bodyText": "should we verify if it is the case before raising an exception with below message.\nIn case of other communication errors it could be misleading.", "author": "kokosing", "createdAt": "2020-03-02T11:26:44Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/metastore/thrift/ThriftHiveMetastore.java", "diffHunk": "@@ -1633,7 +1633,9 @@ public String getValidWriteIds(HiveIdentity identity, List<SchemaTableName> tabl\n                     }));\n         }\n         catch (TException e) {\n-            throw new PrestoException(HIVE_METASTORE_ERROR, e);\n+            // When calling Hive metastore < 3, the call fails with\n+            // Required field 'open_txns' is unset! Struct:GetOpenTxnsResponse(txn_high_water_mark:4, open_txns:null, min_open_txn:4, abortedBits:null)", "originalCommit": "cb9fc46dbd2bd4b25c075c06b470a8c427d32cc8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjQwMjI1Nw==", "url": "https://github.com/trinodb/trino/pull/2826#discussion_r386402257", "bodyText": "This is an individual call, so there is small risk of mis-handling it, if all previous calls worked.", "author": "findepi", "createdAt": "2020-03-02T13:49:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjMzODEwMw=="}], "type": "inlineReview"}]}