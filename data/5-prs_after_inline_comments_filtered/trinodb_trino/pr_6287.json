{"pr_number": 6287, "pr_title": "Support metadata DELETE in JDBC connectors", "pr_createdAt": "2020-12-10T14:54:06Z", "pr_url": "https://github.com/trinodb/trino/pull/6287", "timeline": [{"oid": "4851774f0069616d3f960ed6e7852bf43d25fc84", "url": "https://github.com/trinodb/trino/commit/4851774f0069616d3f960ed6e7852bf43d25fc84", "message": "Extract complex delete tests to separate test methods\n\nSome connector might have partial support for DELETE statement.", "committedDate": "2021-06-29T07:59:01Z", "type": "commit"}, {"oid": "2d9a11362385b1b8624c0efaa1ca252a82a4113c", "url": "https://github.com/trinodb/trino/commit/2d9a11362385b1b8624c0efaa1ca252a82a4113c", "message": "Support metadata DELETE in JDBC connectors", "committedDate": "2021-06-29T09:41:37Z", "type": "commit"}, {"oid": "2d9a11362385b1b8624c0efaa1ca252a82a4113c", "url": "https://github.com/trinodb/trino/commit/2d9a11362385b1b8624c0efaa1ca252a82a4113c", "message": "Support metadata DELETE in JDBC connectors", "committedDate": "2021-06-29T09:41:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg2MDUyNg==", "url": "https://github.com/trinodb/trino/pull/6287#discussion_r663860526", "bodyText": "@kokosing In case of connectors where the test infra is shared this can lead to test data being deleted.\nOr is the assumption that if the hasBehavior is implemented correctly it shouldn't matter since the actual test performs deletions against copies of tables?", "author": "hashhar", "createdAt": "2021-07-05T11:33:55Z", "path": "plugin/trino-base-jdbc/src/test/java/io/trino/plugin/jdbc/BaseJdbcConnectorTest.java", "diffHunk": "@@ -1146,4 +1162,120 @@ protected TestView createSleepingView(Duration minimalSleepDuration)\n     {\n         throw new UnsupportedOperationException();\n     }\n+\n+    @Test\n+    public void testDeleteWithBigintEqualityPredicate()\n+    {\n+        if (!hasBehavior(SUPPORTS_DELETE)) {\n+            assertQueryFails(\"DELETE FROM region WHERE regionkey = 1\", \"This connector does not support deletes\");", "originalCommit": "2d9a11362385b1b8624c0efaa1ca252a82a4113c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg2MTA0OQ==", "url": "https://github.com/trinodb/trino/pull/6287#discussion_r663861049", "bodyText": "I'm submitting a PR to change this to follow the approach in testDeleteWithVarcharEqualityPredicate where an explicit TestTable is created for the negative test case.", "author": "hashhar", "createdAt": "2021-07-05T11:34:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg2MDUyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg4ODA2Nw==", "url": "https://github.com/trinodb/trino/pull/6287#discussion_r663888067", "bodyText": "Thanks!", "author": "kokosing", "createdAt": "2021-07-05T12:20:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg2MDUyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODAwODE0NA==", "url": "https://github.com/trinodb/trino/pull/6287#discussion_r668008144", "bodyText": "@hashhar if you're concerned about that, there are other cases like that in tests, where negative test cases are \"dangerous\".\n(i was not concerned as much as you are ...)", "author": "findepi", "createdAt": "2021-07-12T14:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg2MDUyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2ODAzMTg0MA==", "url": "https://github.com/trinodb/trino/pull/6287#discussion_r668031840", "bodyText": "eg \n  \n    \n      trino/testing/trino-testing/src/main/java/io/trino/testing/BaseConnectorTest.java\n    \n    \n         Line 700\n      in\n      96be8f2\n    \n    \n    \n    \n\n        \n          \n           assertQueryFails(\"ALTER TABLE nation RENAME TO other_schema.yyyy\", \"This connector does not support renaming tables across schemas\");", "author": "findepi", "createdAt": "2021-07-12T15:26:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDY2Mzg2MDUyNg=="}], "type": "inlineReview"}]}