{"pr_number": 4889, "pr_title": "Refactor ABFS tests to be more extensible", "pr_createdAt": "2020-08-19T21:10:39Z", "pr_url": "https://github.com/trinodb/trino/pull/4889", "timeline": [{"oid": "a2b42c13a9b567bb15c0337c78b930e1ddc01af8", "url": "https://github.com/trinodb/trino/commit/a2b42c13a9b567bb15c0337c78b930e1ddc01af8", "message": "Add tests for PrestoAzureConfigurationInitializer", "committedDate": "2020-09-09T15:39:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MzQxNg==", "url": "https://github.com/trinodb/trino/pull/4889#discussion_r485973416", "bodyText": "Private helper methods should go after public methods", "author": "electrum", "createdAt": "2020-09-09T23:19:32Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/azure/PrestoAzureConfigurationInitializer.java", "diffHunk": "@@ -36,39 +36,37 @@\n     private final Optional<String> abfsAccessKey;\n     private final Optional<String> abfsStorageAccount;\n \n+    private static Optional<String> dropEmpty(Optional<String> optional)", "originalCommit": "5a65ddf606cb6befe3fc3e68945adb193eef437b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTk3MzU4OA==", "url": "https://github.com/trinodb/trino/pull/4889#discussion_r485973588", "bodyText": "Don't end messages in a period, unless there are multiple sentences", "author": "electrum", "createdAt": "2020-09-09T23:20:07Z", "path": "presto-hive/src/main/java/io/prestosql/plugin/hive/azure/PrestoAzureConfigurationInitializer.java", "diffHunk": "@@ -36,39 +36,37 @@\n     private final Optional<String> abfsAccessKey;\n     private final Optional<String> abfsStorageAccount;\n \n+    private static Optional<String> dropEmpty(Optional<String> optional)\n+    {\n+        return optional.filter(value -> !value.isEmpty());\n+    }\n+\n     @Inject\n-    public PrestoAzureConfigurationInitializer(HiveAzureConfig hiveAzureConfig)\n+    public PrestoAzureConfigurationInitializer(HiveAzureConfig config)\n     {\n-        this.wasbAccessKey = hiveAzureConfig.getWasbAccessKey();\n-        this.wasbStorageAccount = hiveAzureConfig.getWasbStorageAccount();\n+        this.wasbAccessKey = dropEmpty(config.getWasbAccessKey());\n+        this.wasbStorageAccount = dropEmpty(config.getWasbStorageAccount());\n         if (wasbAccessKey.isPresent() || wasbStorageAccount.isPresent()) {\n             checkArgument(\n-                    wasbAccessKey.isPresent() && !wasbAccessKey.get().isEmpty(),\n-                    \"hive.azure.wasb-storage-account is set, but hive.azure.wasb-access-key is not\");\n-            checkArgument(\n-                    wasbStorageAccount.isPresent() && !wasbStorageAccount.get().isEmpty(),\n-                    \"hive.azure.wasb-access-key is set, but hive.azure.wasb-storage-account is not\");\n+                    wasbAccessKey.isPresent() && wasbStorageAccount.isPresent(),\n+                    \"If WASB storage account or access key is set, both must be set.\");", "originalCommit": "5a65ddf606cb6befe3fc3e68945adb193eef437b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d395e71a24a3035e9f509adedaa8b2507c508a0f", "url": "https://github.com/trinodb/trino/commit/d395e71a24a3035e9f509adedaa8b2507c508a0f", "message": "Clean up PrestoAzureConfigurationInitializer\n\n- Rename 'hiveAzureConfig' parameter to 'config'\n- Add method to convert empty strings to empty optionals\n- Make error messages more uniform", "committedDate": "2020-09-11T00:10:18Z", "type": "commit"}, {"oid": "3ff97f9db2eea5faaa87d74fe51ce4177c743992", "url": "https://github.com/trinodb/trino/commit/3ff97f9db2eea5faaa87d74fe51ce4177c743992", "message": "Fix indentation and line continuations in hive test scripts", "committedDate": "2020-09-11T00:10:22Z", "type": "commit"}, {"oid": "c25aa63a2abfc55a94eef76d7309e202bfb26f4c", "url": "https://github.com/trinodb/trino/commit/c25aa63a2abfc55a94eef76d7309e202bfb26f4c", "message": "Add tests for PrestoAzureConfigurationInitializer", "committedDate": "2020-09-11T03:06:29Z", "type": "forcePushed"}, {"oid": "60ec5d357a3244bf846b3af1ffc957c8961959f9", "url": "https://github.com/trinodb/trino/commit/60ec5d357a3244bf846b3af1ffc957c8961959f9", "message": "Share more setup code between hive test scripts", "committedDate": "2020-09-14T20:35:32Z", "type": "commit"}, {"oid": "c843802bbb92b0a90b0f40e8d20d19d88816c17b", "url": "https://github.com/trinodb/trino/commit/c843802bbb92b0a90b0f40e8d20d19d88816c17b", "message": "Rename ABFS tests as ABFS access key tests", "committedDate": "2020-09-14T20:35:36Z", "type": "commit"}, {"oid": "baf442855b324212544bece9e46cce164db7bdc6", "url": "https://github.com/trinodb/trino/commit/baf442855b324212544bece9e46cce164db7bdc6", "message": "Add superclass for tests using different ABFS authentication methods", "committedDate": "2020-09-14T20:35:36Z", "type": "commit"}, {"oid": "34fa1a12644d866099520cdd026b9217a785918b", "url": "https://github.com/trinodb/trino/commit/34fa1a12644d866099520cdd026b9217a785918b", "message": "Move TestHiveAzureConfig to azure package", "committedDate": "2020-09-14T20:35:36Z", "type": "commit"}, {"oid": "989a130f5f58391397425ea8993a1ecf53562d88", "url": "https://github.com/trinodb/trino/commit/989a130f5f58391397425ea8993a1ecf53562d88", "message": "Add tests for PrestoAzureConfigurationInitializer", "committedDate": "2020-09-14T20:35:36Z", "type": "commit"}, {"oid": "989a130f5f58391397425ea8993a1ecf53562d88", "url": "https://github.com/trinodb/trino/commit/989a130f5f58391397425ea8993a1ecf53562d88", "message": "Add tests for PrestoAzureConfigurationInitializer", "committedDate": "2020-09-14T20:35:36Z", "type": "forcePushed"}]}