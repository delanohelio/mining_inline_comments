{"pr_number": 6368, "pr_title": "Avoid listing all indexes to check for existence", "pr_createdAt": "2020-12-16T21:55:05Z", "pr_url": "https://github.com/trinodb/trino/pull/6368", "timeline": [{"oid": "034afb61047fa3d52aae44d1399e2224121e488d", "url": "https://github.com/trinodb/trino/commit/034afb61047fa3d52aae44d1399e2224121e488d", "message": "Avoid listing all indexes to check for existence", "committedDate": "2020-12-16T21:41:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzODI0Nw==", "url": "https://github.com/trinodb/trino/pull/6368#discussion_r546938247", "bodyText": "I the client.getIndexMetadata(table).getSchema().getFields().isEmpty() case covered by tests?", "author": "losipiuk", "createdAt": "2020-12-21T21:28:56Z", "path": "presto-elasticsearch/src/main/java/io/prestosql/elasticsearch/ElasticsearchMetadata.java", "diffHunk": "@@ -152,7 +152,7 @@ public ElasticsearchTableHandle getTableHandle(ConnectorSession session, SchemaT\n                 }\n             }\n \n-            if (listTables(session, Optional.of(schemaName)).contains(new SchemaTableName(schemaName, table))) {\n+            if (client.indexExists(table) && !client.getIndexMetadata(table).getSchema().getFields().isEmpty()) {", "originalCommit": "034afb61047fa3d52aae44d1399e2224121e488d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzAyNjAxMQ==", "url": "https://github.com/trinodb/trino/pull/6368#discussion_r547026011", "bodyText": "Yes", "author": "martint", "createdAt": "2020-12-22T02:06:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkzODI0Nw=="}], "type": "inlineReview"}]}