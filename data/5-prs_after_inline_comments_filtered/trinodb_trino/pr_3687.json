{"pr_number": 3687, "pr_title": "Add support for showing view definition in BigQuery", "pr_createdAt": "2020-05-10T08:15:54Z", "pr_url": "https://github.com/trinodb/trino/pull/3687", "timeline": [{"oid": "b5bb8c8a83bd0a3b3be4f9d4f430880e920fc3cc", "url": "https://github.com/trinodb/trino/commit/b5bb8c8a83bd0a3b3be4f9d4f430880e920fc3cc", "message": "Add support for showing view definition in BigQuery", "committedDate": "2020-05-11T02:32:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE3OTA0MQ==", "url": "https://github.com/trinodb/trino/pull/3687#discussion_r423179041", "bodyText": "Is the second call to viewDefinition.getQuery() needed?", "author": "davidrabinowitz", "createdAt": "2020-05-11T16:52:02Z", "path": "presto-bigquery/src/main/java/io/prestosql/plugin/bigquery/BigQueryMetadata.java", "diffHunk": "@@ -118,6 +123,30 @@ public BigQueryMetadata(BigQueryClient bigQueryClient, BigQueryConfig config)\n         return tableNames.build();\n     }\n \n+    @Override\n+    public Optional<ConnectorViewDefinition> getView(ConnectorSession session, SchemaTableName viewName)\n+    {\n+        TableInfo tableInfo = getBigQueryTable(viewName);\n+\n+        if (tableInfo.getDefinition() instanceof ViewDefinition) {\n+            List<BigQueryColumnHandle> columns = getTableColumns(tableInfo);\n+            ViewDefinition viewDefinition = tableInfo.getDefinition();\n+            ConnectorViewDefinition definition = new ConnectorViewDefinition(\n+                    viewDefinition.getQuery(),\n+                    Optional.of(catalogName.toString()),\n+                    Optional.of(viewName.getSchemaName()),\n+                    columns.stream()\n+                            .map(column -> new ConnectorViewDefinition.ViewColumn(column.getName(), column.getPrestoType().getTypeId()))\n+                            .collect(toImmutableList()),\n+                    Optional.ofNullable(tableInfo.getDescription()),\n+                    Optional.empty(),\n+                    false);\n+            viewDefinition.getQuery();", "originalCommit": "b5bb8c8a83bd0a3b3be4f9d4f430880e920fc3cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzM4MDM4Nw==", "url": "https://github.com/trinodb/trino/pull/3687#discussion_r423380387", "bodyText": "It's my mistake. Let me remove.", "author": "ebyhr", "createdAt": "2020-05-11T23:40:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE3OTA0MQ=="}], "type": "inlineReview"}, {"oid": "5630b2af6ec952381f4153b94b52b7e768c21893", "url": "https://github.com/trinodb/trino/commit/5630b2af6ec952381f4153b94b52b7e768c21893", "message": "Add view_definition system table for BigQuery view", "committedDate": "2021-02-07T05:56:42Z", "type": "commit"}, {"oid": "5630b2af6ec952381f4153b94b52b7e768c21893", "url": "https://github.com/trinodb/trino/commit/5630b2af6ec952381f4153b94b52b7e768c21893", "message": "Add view_definition system table for BigQuery view", "committedDate": "2021-02-07T05:56:42Z", "type": "forcePushed"}]}