{"pr_number": 5264, "pr_title": "Test LIMIT pushdown", "pr_createdAt": "2020-09-22T13:33:39Z", "pr_url": "https://github.com/trinodb/trino/pull/5264", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjczNjkzNg==", "url": "https://github.com/trinodb/trino/pull/5264#discussion_r492736936", "bodyText": "#5263", "author": "findepi", "createdAt": "2020-09-22T13:33:49Z", "path": "presto-memsql/src/test/java/io/prestosql/plugin/memsql/TestMemSqlIntegrationSmokeTest.java", "diffHunk": "@@ -181,6 +182,19 @@ public void testInsertIntoNotNullColumn()\n         assertUpdate(\"DROP TABLE test_insert_not_null\");\n     }\n \n+    @Test\n+    public void testLimitPushdown()\n+    {\n+        assertThat(query(\"SELECT name FROM nation LIMIT 30\")).isCorrectlyPushedDown(); // Use high limit for result determinism\n+\n+        // with filter over numeric column\n+        assertThat(query(\"SELECT name FROM nation WHERE regionkey = 3 LIMIT 5\")).isCorrectlyPushedDown();\n+\n+        // with filter over varchar column\n+        // TODO (https://github.com/prestosql/presto/issues/5263) should be `.isNotFullyPushedDown(FilterNode.class)`", "originalCommit": "aad2e55bfc95d6769303709b4276702e3dd857ab", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI1NzMyOA==", "url": "https://github.com/trinodb/trino/pull/5264#discussion_r493257328", "bodyText": "what about aggregation and project? We have at the moment 4 variables (predicate, limit, projection and aggregation).\nHaving dedicated tests per each pushdown gives 4 tests, for pairs another 12 tests, for triples another test 4 tests, and for all cases at once another 1 tests. 21 in total.\nWhat are your thoughts to tackle that?", "author": "kokosing", "createdAt": "2020-09-23T07:29:08Z", "path": "presto-druid/src/test/java/io/prestosql/plugin/druid/TestDruidIntegrationSmokeTest.java", "diffHunk": "@@ -272,4 +272,17 @@ public void testFilteringForTablesAndColumns()\n         actualColumns = computeActual(\"DESCRIBE \" + datasourceB);\n         Assert.assertEquals(actualColumns, expectedColumns);\n     }\n+\n+    @Test\n+    public void testLimitPushdown()\n+    {\n+        assertThat(query(\"SELECT name FROM nation LIMIT 30\")).isCorrectlyPushedDown(); // Use high limit for result determinism\n+\n+        // with filter over numeric column\n+        assertThat(query(\"SELECT name FROM nation WHERE regionkey = 3 LIMIT 5\")).isCorrectlyPushedDown();\n+\n+        // with filter over varchar column\n+        assertThat(query(\"SELECT name FROM nation WHERE name < 'EEE' LIMIT 5\")).isCorrectlyPushedDown();\n+    }", "originalCommit": "aad2e55bfc95d6769303709b4276702e3dd857ab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ0MjYxMw==", "url": "https://github.com/trinodb/trino/pull/5264#discussion_r493442613", "bodyText": "what about aggregation and project?\n\nagg pushdown with limit does not work today -- #5261\n\nWhat are your thoughts to tackle that?\n\ni want to organize pushdown test around top level thing that is pushed down (eg agg pushdown tests won't cover LIMIT (applied after agg), unless the LIMIT is in subquery)\ni also want to order them by the ordering in which they are appledi in JdbcTableHandle", "author": "findepi", "createdAt": "2020-09-23T10:49:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzI1NzMyOA=="}], "type": "inlineReview"}, {"oid": "06b742c5dd075b8910aa8879a3e1edb216d84b7c", "url": "https://github.com/trinodb/trino/commit/06b742c5dd075b8910aa8879a3e1edb216d84b7c", "message": "Fix test method name typo", "committedDate": "2020-09-23T10:59:11Z", "type": "commit"}, {"oid": "f79fe7d42f64e7e9c41a24efad48942f26a80617", "url": "https://github.com/trinodb/trino/commit/f79fe7d42f64e7e9c41a24efad48942f26a80617", "message": "Test LIMIT pushdown", "committedDate": "2020-09-23T11:52:59Z", "type": "commit"}, {"oid": "f79fe7d42f64e7e9c41a24efad48942f26a80617", "url": "https://github.com/trinodb/trino/commit/f79fe7d42f64e7e9c41a24efad48942f26a80617", "message": "Test LIMIT pushdown", "committedDate": "2020-09-23T11:52:59Z", "type": "forcePushed"}]}