{"pr_number": 3417, "pr_title": "Enable testDataMappingSmokeTest for Kudu", "pr_createdAt": "2020-04-12T21:38:33Z", "pr_url": "https://github.com/trinodb/trino/pull/3417", "timeline": [{"oid": "382a8dcbdade199cb306fcb93268e3c62fab2817", "url": "https://github.com/trinodb/trino/commit/382a8dcbdade199cb306fcb93268e3c62fab2817", "message": "Fix and improve exception message\n\nPreviously message was misleading as to what was actually expected.", "committedDate": "2020-04-12T22:42:51Z", "type": "commit"}, {"oid": "c3128c4c74c816170d9aeb1bb22e71efcc5d996a", "url": "https://github.com/trinodb/trino/commit/c3128c4c74c816170d9aeb1bb22e71efcc5d996a", "message": "Fix formatting", "committedDate": "2020-04-12T22:42:53Z", "type": "commit"}, {"oid": "79efcf732bf4c1edc440e5f6700cbda6f40b400e", "url": "https://github.com/trinodb/trino/commit/79efcf732bf4c1edc440e5f6700cbda6f40b400e", "message": "Remove unintentional override", "committedDate": "2020-04-12T22:42:54Z", "type": "commit"}, {"oid": "7214cf3c2538d9c2d0db990bff2ea2b2510d57fe", "url": "https://github.com/trinodb/trino/commit/7214cf3c2538d9c2d0db990bff2ea2b2510d57fe", "message": "Add generic test for pushdown with nullable domain", "committedDate": "2020-04-12T22:42:55Z", "type": "commit"}, {"oid": "87157ac5c2ec510f841a9444664c1c88f3b731f1", "url": "https://github.com/trinodb/trino/commit/87157ac5c2ec510f841a9444664c1c88f3b731f1", "message": "Throw PrestoException when unsupported type in CTAS in Hive\n\nPreviously a CREATE TABLE AS .. with an unsupported type would fail with\na non-PrestoException:\n\n    java.lang.IllegalArgumentException: Unsupported type: time\n            at io.prestosql.plugin.hive.metastore.thrift.ThriftMetastoreUtil.getSupportedColumnStatistics(ThriftMetastoreUtil.java:974)\n            at io.prestosql.plugin.hive.metastore.file.FileHiveMetastore.getSupportedColumnStatistics(FileHiveMetastore.java:320)\n            at io.prestosql.plugin.hive.metastore.cache.CachingHiveMetastore.getSupportedColumnStatistics(CachingHiveMetastore.java:302)\n            at io.prestosql.plugin.hive.HiveMetastoreClosure.getSupportedColumnStatistics(HiveMetastoreClosure.java:76)\n            at io.prestosql.plugin.hive.metastore.SemiTransactionalHiveMetastore.getSupportedColumnStatistics(SemiTransactionalHiveMetastore.java:203)\n            at io.prestosql.plugin.hive.HiveMetadata.getColumnStatisticMetadata(HiveMetadata.java:2287)\n            at java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:193)\n            at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n            at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n            at java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:175)\n            at java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1382)\n            at java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)\n            at java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)\n            at java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\n            at java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n            at java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:566)\n            at io.prestosql.plugin.hive.HiveMetadata.getStatisticsCollectionMetadata(HiveMetadata.java:2279)\n            at io.prestosql.plugin.hive.HiveMetadata.getStatisticsCollectionMetadataForWrite(HiveMetadata.java:2261)\n            at io.prestosql.plugin.base.classloader.ClassLoaderSafeConnectorMetadata.getStatisticsCollectionMetadataForWrite(ClassLoaderSafeConnectorMetadata.java:141)\n            at io.prestosql.metadata.MetadataManager.getStatisticsCollectionMetadataForWrite(MetadataManager.java:706)\n            at io.prestosql.sql.planner.LogicalPlanner.createTableCreationPlan(LogicalPlanner.java:330)\n            at io.prestosql.sql.planner.LogicalPlanner.planStatementWithoutOutput(LogicalPlanner.java:235)\n            at io.prestosql.sql.planner.LogicalPlanner.planStatement(LogicalPlanner.java:226)\n            at io.prestosql.sql.planner.LogicalPlanner.plan(LogicalPlanner.java:192)\n            at io.prestosql.sql.planner.LogicalPlanner.plan(LogicalPlanner.java:187)\n            at io.prestosql.sql.planner.LogicalPlanner.plan(LogicalPlanner.java:182)\n            at io.prestosql.execution.SqlQueryExecution.doPlanQuery(SqlQueryExecution.java:393)\n            at io.prestosql.execution.SqlQueryExecution.planQuery(SqlQueryExecution.java:381)\n            at io.prestosql.execution.SqlQueryExecution.start(SqlQueryExecution.java:336)\n            at io.prestosql.execution.SqlQueryManager.createQuery(SqlQueryManager.java:237)\n            at io.prestosql.dispatcher.LocalDispatchQuery.lambda$startExecution$7(LocalDispatchQuery.java:132)\n            at io.prestosql.$gen.Presto_2496c42__testversion____20200412_214808_2015.run(Unknown Source)\n            ... 3 more", "committedDate": "2020-04-12T22:42:56Z", "type": "commit"}, {"oid": "ef80382228a976475861e4fea4fa55ce7cd28ec7", "url": "https://github.com/trinodb/trino/commit/ef80382228a976475861e4fea4fa55ce7cd28ec7", "message": "Use CTAS in testDataMappingSmokeTest\n\nSome connectors, e.g. Kudu, allow CREATE TABLE AS SELECT but do not\nallow CREATE TABLE.", "committedDate": "2020-04-12T22:42:57Z", "type": "commit"}, {"oid": "639ba2b21f569dc8f34ceda77b59ef9c37bbcda9", "url": "https://github.com/trinodb/trino/commit/639ba2b21f569dc8f34ceda77b59ef9c37bbcda9", "message": "Enable testDataMappingSmokeTest for Kudu", "committedDate": "2020-04-12T22:42:58Z", "type": "commit"}, {"oid": "639ba2b21f569dc8f34ceda77b59ef9c37bbcda9", "url": "https://github.com/trinodb/trino/commit/639ba2b21f569dc8f34ceda77b59ef9c37bbcda9", "message": "Enable testDataMappingSmokeTest for Kudu", "committedDate": "2020-04-12T22:42:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEwMjc2OA==", "url": "https://github.com/trinodb/trino/pull/3417#discussion_r411102768", "bodyText": "Add this to previous commit (the one that removes @Overwrite)", "author": "kokosing", "createdAt": "2020-04-20T05:29:49Z", "path": "presto-kudu/src/test/java/io/prestosql/plugin/kudu/TestKuduDistributedQueries.java", "diffHunk": "@@ -79,6 +79,7 @@ public void testDataMappingSmokeTest(DataMappingTestSetup dataMappingTestSetup)\n     }\n \n     @Test\n+    @Deprecated // TODO remove when testDataMappingSmokeTest is enabled for Kudu", "originalCommit": "7214cf3c2538d9c2d0db990bff2ea2b2510d57fe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEzMjMyMg==", "url": "https://github.com/trinodb/trino/pull/3417#discussion_r411132322", "bodyText": "I add @Deprecated in Add generic test for pushdown with nullable domain commit because only after this commit the testDataMappingSmokeTest covers the use case being covered here", "author": "findepi", "createdAt": "2020-04-20T06:46:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEwMjc2OA=="}], "type": "inlineReview"}]}