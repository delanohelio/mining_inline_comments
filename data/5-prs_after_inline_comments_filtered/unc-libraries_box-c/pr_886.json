{"pr_number": 886, "pr_title": "Index collection id", "pr_createdAt": "2020-01-22T17:52:46Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/886", "timeline": [{"oid": "27adbb07a3901810f2ccee9861eec3e4cd2bc374", "url": "https://github.com/UNC-Libraries/box-c/commit/27adbb07a3901810f2ccee9861eec3e4cd2bc374", "message": "Index collection id", "committedDate": "2020-01-27T20:14:18Z", "type": "commit"}, {"oid": "51a13193b2358c9e878d331bf4bc1f60984df75f", "url": "https://github.com/UNC-Libraries/box-c/commit/51a13193b2358c9e878d331bf4bc1f60984df75f", "message": "Display collection id", "committedDate": "2020-01-27T20:14:18Z", "type": "commit"}, {"oid": "c4c59af17c077625482e97e2c229ac12b3c1071c", "url": "https://github.com/UNC-Libraries/box-c/commit/c4c59af17c077625482e97e2c229ac12b3c1071c", "message": "Display collection id in search results", "committedDate": "2020-01-27T20:14:18Z", "type": "commit"}, {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1", "url": "https://github.com/UNC-Libraries/box-c/commit/17da831009c12c3f1283573cfd489386cfd18aa1", "message": "* Index collection id\n* Don't display collection id if there isn't one, or any coll info if record is a collection", "committedDate": "2020-01-27T21:19:39Z", "type": "commit"}, {"oid": "17da831009c12c3f1283573cfd489386cfd18aa1", "url": "https://github.com/UNC-Libraries/box-c/commit/17da831009c12c3f1283573cfd489386cfd18aa1", "message": "* Index collection id\n* Don't display collection id if there isn't one, or any coll info if record is a collection", "committedDate": "2020-01-27T21:19:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2MDYwOQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373160609", "bodyText": "You could keep using resourceType instead of going back to briefObject.getResourceType()", "author": "bbpennel", "createdAt": "2020-01-30T19:53:24Z", "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FullRecordController.java", "diffHunk": "@@ -214,7 +214,9 @@ public String getFullRecord(String pidString, Model model, HttpServletRequest re\n             model.addAttribute(\"facetFields\", resultResponse.getFacetFields());\n         }\n \n-        if (resourceType.equals(searchSettings.resourceTypeFolder)) {\n+        if (resourceType.equals(searchSettings.resourceTypeFolder) ||\n+                briefObject.getResourceType().equals(searchSettings.resourceTypeFile) ||", "originalCommit": "17da831009c12c3f1283573cfd489386cfd18aa1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE4Njc2Ng==", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373186766", "bodyText": "weird, not sure why I did that", "author": "lfarrell", "createdAt": "2020-01-30T20:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2MDYwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2MzkxOA==", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373163918", "bodyText": "I think a bunch of the processing in this class was written against any older version of jdom. These days you can store List<Element> directly from getChildren rather than having to cast things below. Same could be said for almost all the other extract methods in this class though.", "author": "bbpennel", "createdAt": "2020-01-30T19:59:52Z", "path": "solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java", "diffHunk": "@@ -253,6 +255,33 @@ private void extractAbstract(Element mods, IndexDocumentBean idb) {\n         }\n     }\n \n+    private void extractCollectionId(Element mods, IndexDocumentBean idb) {\n+        List<?> identifiers = mods.getChildren(\"identifier\", JDOMNamespaceUtil.MODS_V3_NS);", "originalCommit": "17da831009c12c3f1283573cfd489386cfd18aa1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE2NDkxMw==", "url": "https://github.com/UNC-Libraries/box-c/pull/886#discussion_r373164913", "bodyText": "if you only care about the first one, you could break out of the loop when it finds the collection number rather than continuing to look. In that case you wouldn't need a List either.", "author": "bbpennel", "createdAt": "2020-01-30T20:01:58Z", "path": "solr-ingest/src/main/java/edu/unc/lib/dl/data/ingest/solr/filter/SetDescriptiveMetadataFilter.java", "diffHunk": "@@ -253,6 +255,33 @@ private void extractAbstract(Element mods, IndexDocumentBean idb) {\n         }\n     }\n \n+    private void extractCollectionId(Element mods, IndexDocumentBean idb) {\n+        List<?> identifiers = mods.getChildren(\"identifier\", JDOMNamespaceUtil.MODS_V3_NS);\n+        List<String> collectionId = new ArrayList<>();\n+\n+        if (identifiers != null && identifiers.size() > 0) {\n+            for (Object id: identifiers) {\n+                Element aid = (Element) id;\n+                Attribute type = aid.getAttribute(\"type\");\n+                Attribute collection = aid.getAttribute(\"displayLabel\");\n+\n+                if (type == null || collection == null) {\n+                    continue;\n+                }\n+\n+                if (collection.getValue().equals(\"Collection Number\") && type.getValue().equals(\"local\")) {\n+                    collectionId.add(aid.getValue());\n+                }\n+            }\n+        }\n+\n+        if (collectionId.size() > 0) {\n+            idb.setCollectionId(collectionId.get(0));", "originalCommit": "17da831009c12c3f1283573cfd489386cfd18aa1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5e7b9c556fc539412190d9b2e8e6b9e3ccd3ca95", "url": "https://github.com/UNC-Libraries/box-c/commit/5e7b9c556fc539412190d9b2e8e6b9e3ccd3ca95", "message": "* Clean up view page\n* Remove list for finding collectionId", "committedDate": "2020-01-30T21:14:41Z", "type": "commit"}]}