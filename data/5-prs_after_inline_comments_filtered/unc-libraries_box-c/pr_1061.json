{"pr_number": 1061, "pr_title": "BXC-2744 - Improve recovery of binary transfer jobs", "pr_createdAt": "2020-07-31T21:50:41Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/1061", "timeline": [{"oid": "736847055270d6400f76973056912a7f656020fa", "url": "https://github.com/UNC-Libraries/box-c/commit/736847055270d6400f76973056912a7f656020fa", "message": "Improved error handling of binary transfers during deposit in cases where a binary already exists at the transfer destination. Removed redis tracking of binary transfers as having the JVM terminate will result in losing storage uris recorded in jena. Resuming now determines which files need to be transferred by trying and failing to transfer, then seeing if the file had already been transferred", "committedDate": "2020-07-31T21:43:23Z", "type": "commit"}, {"oid": "441deee422c20465b67f96ae3c32857a39183f92", "url": "https://github.com/UNC-Libraries/box-c/commit/441deee422c20465b67f96ae3c32857a39183f92", "message": "Fix line length", "committedDate": "2020-07-31T22:47:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4MjU4OQ==", "url": "https://github.com/UNC-Libraries/box-c/pull/1061#discussion_r464382589", "bodyText": "Do the isObjectCompleted and markObjectCompleted methods in AbstractDepositJob need to be removed?", "author": "lfarrell", "createdAt": "2020-08-03T12:31:22Z", "path": "deposit/src/main/java/edu/unc/lib/deposit/transfer/TransferBinariesToStorageJob.java", "diffHunk": "@@ -187,13 +179,38 @@ private void transferDepositManifests(PID objPid, Resource resc, BinaryTransferS\n             }\n \n             PID manifestPid = getDepositManifestPid(objPid, manifestFile.getName());\n+            transferFile(manifestPid, manifestUri, transferSession, resc, CdrDeposit.storageUri);\n+        }\n+    }\n+\n+    private void transferFile(PID binPid, URI stagingUri, BinaryTransferSession transferSession,\n+            Resource resc, Property storageProperty) {\n \n-            if (!isObjectCompleted(manifestPid)) {", "originalCommit": "441deee422c20465b67f96ae3c32857a39183f92", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDQzNjE5Ng==", "url": "https://github.com/UNC-Libraries/box-c/pull/1061#discussion_r464436196", "bodyText": "No, they are still being used by other jobs. It is reasonable to use objectCompleted in cases where the jena model isn't being updated, since those can get lost in cases where the jvm shuts down or the jena transactions are interrupted at the wrong time.", "author": "bbpennel", "createdAt": "2020-08-03T14:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDM4MjU4OQ=="}], "type": "inlineReview"}]}