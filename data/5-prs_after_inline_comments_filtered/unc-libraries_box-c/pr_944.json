{"pr_number": 944, "pr_title": "Check if download is a work. If so, use its primary object's PID", "pr_createdAt": "2020-03-27T19:04:19Z", "pr_url": "https://github.com/UNC-Libraries/box-c/pull/944", "timeline": [{"oid": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "url": "https://github.com/UNC-Libraries/box-c/commit/e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "message": "Check if download is a work. If so, use its primary object's PID", "committedDate": "2020-03-27T18:58:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk0MTAyNA==", "url": "https://github.com/UNC-Libraries/box-c/pull/944#discussion_r400941024", "bodyText": "use instanceof", "author": "bbpennel", "createdAt": "2020-03-31T14:05:47Z", "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FedoraContentController.java", "diffHunk": "@@ -87,6 +92,11 @@ private void streamData(String pidString, String datastream, boolean asAttachmen\n         PID pid = PIDs.get(pidString);\n         AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n \n+        RepositoryObject updatedPid = repoObjLoader.getRepositoryObject(pid);\n+        if (updatedPid.getClass() == WorkObject.class) {", "originalCommit": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk0MTY3NA==", "url": "https://github.com/UNC-Libraries/box-c/pull/944#discussion_r400941674", "bodyText": "since this isn't really a pid object, i'd suggest a different variable name", "author": "bbpennel", "createdAt": "2020-03-31T14:06:41Z", "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FedoraContentController.java", "diffHunk": "@@ -87,6 +92,11 @@ private void streamData(String pidString, String datastream, boolean asAttachmen\n         PID pid = PIDs.get(pidString);\n         AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n \n+        RepositoryObject updatedPid = repoObjLoader.getRepositoryObject(pid);", "originalCommit": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk0MjIyOA==", "url": "https://github.com/UNC-Libraries/box-c/pull/944#discussion_r400942228", "bodyText": "not all works are guaranteed to have a primary object, so you should check that its null before getting the pid", "author": "bbpennel", "createdAt": "2020-03-31T14:07:24Z", "path": "access/src/main/java/edu/unc/lib/dl/ui/controller/FedoraContentController.java", "diffHunk": "@@ -87,6 +92,11 @@ private void streamData(String pidString, String datastream, boolean asAttachmen\n         PID pid = PIDs.get(pidString);\n         AccessGroupSet principals = getAgentPrincipals().getPrincipals();\n \n+        RepositoryObject updatedPid = repoObjLoader.getRepositoryObject(pid);\n+        if (updatedPid.getClass() == WorkObject.class) {\n+            pid = ((WorkObject) updatedPid).getPrimaryObject().getPid();", "originalCommit": "e0e0b4c89d0305b4847672445d2f70e55fe1f5bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eda7cdd2f7983bf636c4056bba87e8eea1813021", "url": "https://github.com/UNC-Libraries/box-c/commit/eda7cdd2f7983bf636c4056bba87e8eea1813021", "message": "Update to check for no primary object", "committedDate": "2020-03-31T17:32:42Z", "type": "commit"}]}