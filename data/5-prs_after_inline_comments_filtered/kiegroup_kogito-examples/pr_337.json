{"pr_number": 337, "pr_title": "[KOGITO-2893] Update tests with new API changes", "pr_createdAt": "2020-08-13T14:12:37Z", "pr_url": "https://github.com/kiegroup/kogito-examples/pull/337", "timeline": [{"oid": "a8a6020e7d5682b1927464fd303fe1e0796dfd63", "url": "https://github.com/kiegroup/kogito-examples/commit/a8a6020e7d5682b1927464fd303fe1e0796dfd63", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-13T15:10:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExMTc3Ng==", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r470111776", "bodyText": "why it was expecting and error 500 before and now success?", "author": "tiagodolphine", "createdAt": "2020-08-13T17:19:55Z", "path": "process-quarkus-example/src/test/java/org/kie/kogito/examples/OrdersRestIT.java", "diffHunk": "@@ -98,8 +138,16 @@ public void testOrdersWithErrorRest() {\n \n         // test adding new order\n         String addOrderPayload = \"{\\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(addOrderPayload).when()\n-                .post(\"/orders\").then().statusCode(500).body(\"id\", notNullValue()).extract().path(\"id\");\n+        String firstCreatedId = given()\n+                .contentType(ContentType.JSON)\n+                .accept(ContentType.JSON)\n+                .body(addOrderPayload).when()\n+                .post(\"/orders\")\n+            .then()\n+                .statusCode(201)", "originalCommit": "a8a6020e7d5682b1927464fd303fe1e0796dfd63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEyNDYwNw==", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r470124607", "bodyText": "minor, since there is no way to check but shouldn't we keep the business key on the query param since it remains in this way?", "author": "tiagodolphine", "createdAt": "2020-08-13T17:33:45Z", "path": "process-quarkus-example/src/test/java/org/kie/kogito/examples/OrdersRestIT.java", "diffHunk": "@@ -212,60 +264,41 @@ public void testOrdersWithOrderItemsAbortedRest() {\n         given().accept(ContentType.JSON).when().get(\"/orderItems\").then().statusCode(200)\n                 .body(\"$.size()\", is(0));\n     }\n-    \n-\n-    @Test\n-    public void testCreateAndGetOrderByBusinessKey() {\n-        String orderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders?businessKey=ORD-0001\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n \n-        assertNotNull(firstCreatedId);\n-\n-        // get order by its business key and test\n-        given().accept(ContentType.JSON).body(orderPayload).when().get(\"/orders/ORD-0001\").then()\n-                .statusCode(200).body(\"id\",\n-                                      is(firstCreatedId));\n-        \n-        // test deleting order items by business key\n-        given().accept(ContentType.JSON).when().delete(\"/orders/ORD-0001\").then().statusCode(200);\n-        \n-        // get all orders make sure there is zero\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\", is(0));\n-    }\n-    \n     @Test\n-    public void testCreateDuplicateOrders() {\n+    public void testCreateAndUpdateOrders() {\n         String orderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders?businessKey=ORD-0001\").then().statusCode(200).body(\"id\",\n+        String id = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n+                .post(\"/orders\").then().statusCode(201).body(\"id\",", "originalCommit": "a8a6020e7d5682b1927464fd303fe1e0796dfd63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTg1MzcwMg==", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r471853702", "bodyText": "+1", "author": "cristianonicolai", "createdAt": "2020-08-18T00:58:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEyNDYwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjg2NjYxNA==", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r472866614", "bodyText": "I don't see any benefit as businessKeys are tested in many other places and here doesn't bring any benefit.Besides as you mention, there is no way to verify it.", "author": "ruromero", "createdAt": "2020-08-19T08:47:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEyNDYwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEyNjk4Mg==", "url": "https://github.com/kiegroup/kogito-examples/pull/337#discussion_r470126982", "bodyText": "is it necessary to set the body on the get request?", "author": "tiagodolphine", "createdAt": "2020-08-13T17:36:16Z", "path": "process-springboot-example/src/test/java/org/kie/kogito/examples/demo/OrdersRestIT.java", "diffHunk": "@@ -71,120 +71,131 @@ public void setUp() {\n     }\n \n     @Test\n-    public void testCreateNewOrder() {\n-        // create order\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(firstCreatedId);\n-    }\n-\n-    @Test\n-    public void testGetOrders() {\n-        // create two orders\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n+    public void testOrdersRest() {\n+        assertNotNull(orderProcess);\n \n-        assertNotNull(firstCreatedId);\n-\n-        String secondCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(secondCreatedId);\n+        // test adding new order\n+        String addOrderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n+        String firstCreatedId = given()\n+                    .contentType(ContentType.JSON)\n+                    .accept(ContentType.JSON)\n+                    .body(addOrderPayload).when()\n+                    .post(\"/orders\")\n+                .then()\n+                    .statusCode(201)\n+                    .header(\"Location\", notNullValue())\n+                .extract().path(\"id\");\n \n-        // get all orders\n+        // test getting the created order\n         given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\",\n-                      is(2));\n-    }\n-\n-    @Test\n-    public void testGetOrderById() {\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(firstCreatedId);\n-\n-        // get order by its id and test\n-        given().accept(ContentType.JSON).body(orderPayload).when().get(\"/orders/\" + firstCreatedId).then()\n-                .statusCode(200).body(\"id\",\n-                                      is(firstCreatedId));\n-    }\n-\n-    @Test\n-    public void testDeleteOrder() {\n-        // create two orders\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(firstCreatedId);\n-\n-        String secondCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(orderPayload).when()\n-                .post(\"/orders\").then().statusCode(200).body(\"id\",\n-                                                             notNullValue()).extract().path(\"id\");\n-\n-        assertNotNull(secondCreatedId);\n-\n-        // delete first order\n-        given().accept(ContentType.JSON).when().delete(\"/orders/\" + firstCreatedId).then().statusCode(200);\n+                .body(\"$.size()\", is(1), \"[0].id\", is(firstCreatedId));\n \n+        // test getting order by id\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .get(\"/orders/{id}\", firstCreatedId)\n+            .then()\n+                .statusCode(200)\n+                .body(\"id\", is(firstCreatedId));\n+\n+        // test delete order\n+        // first add second order...\n+        String secondCreatedId =\n+                given()\n+                    .contentType(ContentType.JSON)\n+                    .accept(ContentType.JSON)\n+                    .body(addOrderPayload)\n+                .when()\n+                    .post(\"/orders\")\n+                .then()\n+                    .statusCode(201)\n+                .extract()\n+                    .path(\"id\");\n+        // now delete the first order created\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .delete(\"/orders/{id}\", firstCreatedId)\n+            .then()\n+                .statusCode(200);\n         // get all orders make sure there is only one\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\",\n-                      is(1),\n-                      \"[0].id\",\n-                      is(secondCreatedId));\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .get(\"/orders\")\n+            .then()\n+                .statusCode(200)\n+                .body(\"$.size()\", is(1), \"[0].id\", is(secondCreatedId));\n \n         // delete second before finishing\n-        given().accept(ContentType.JSON).when().delete(\"/orders/\" + secondCreatedId).then().statusCode(200);\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .delete(\"/orders/{id}\", secondCreatedId)\n+            .then()\n+                .statusCode(200);\n         // get all orders make sure there is zero\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n-                .body(\"$.size()\",\n-                      is(0));\n+        given()\n+                .accept(ContentType.JSON)\n+            .when()\n+                .get(\"/orders\")\n+            .then()\n+                .statusCode(200)\n+                .body(\"$.size()\", is(0));\n     }\n \n     @Test\n     public void testOrdersWithErrorRest() {\n+        assertNotNull(orderProcess);\n \n         // test adding new order\n         String addOrderPayload = \"{\\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        String firstCreatedId = given().contentType(ContentType.JSON).accept(ContentType.JSON).body(addOrderPayload).when()\n-                .post(\"/orders\").then().statusCode(500).body(\"id\", notNullValue()).extract().path(\"id\");\n+        String firstCreatedId = given()\n+                .contentType(ContentType.JSON)\n+                .accept(ContentType.JSON)\n+                .body(addOrderPayload).when()\n+                .post(\"/orders\")\n+            .then()\n+                .statusCode(201)\n+                .body(\"id\", notNullValue())\n+            .extract()\n+                .path(\"id\");\n \n         // test getting the created order\n         given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n                 .body(\"$.size()\", is(1), \"[0].id\", is(firstCreatedId));\n \n         // test retrieving error info using process management addon\n         given().accept(ContentType.JSON).when().get(\"/management/processes/demo.orders/instances/\" + firstCreatedId + \"/error\").then()\n-                .statusCode(200).body(\"id\", is(firstCreatedId));\n+        .statusCode(200).body(\"id\", is(firstCreatedId));\n \n         String fixedOrderPayload = \"{\\\"approver\\\" : \\\"john\\\", \\\"order\\\" : {\\\"orderNumber\\\" : \\\"12345\\\", \\\"shipped\\\" : false}}\";\n-        given().contentType(ContentType.JSON).accept(ContentType.JSON).body(fixedOrderPayload).when().post(\"/orders/\" + firstCreatedId).then()\n-                .statusCode(200).body(\"id\", is(firstCreatedId));\n+        given().contentType(ContentType.JSON).accept(ContentType.JSON).body(fixedOrderPayload).when().put(\"/orders/\" + firstCreatedId).then()\n+        .statusCode(200)\n+                .body(\"id\", is(firstCreatedId))\n+                .body(\"approver\", equalTo(\"john\"))\n+                .body(\"order.orderNumber\", equalTo(\"12345\"))\n+                .body(\"order.shipped\", equalTo(false));\n \n         given().accept(ContentType.JSON).when().post(\"/management/processes/demo.orders/instances/\" + firstCreatedId + \"/retrigger\").then()\n-                .statusCode(200);\n+        .statusCode(200);\n \n         // delete second before finishing\n         given().accept(ContentType.JSON).when().delete(\"/orders/\" + firstCreatedId).then().statusCode(200);\n         // get all orders make sure there is zero\n-        given().accept(ContentType.JSON).when().get(\"/orders\").then().statusCode(200)\n+        given().accept(ContentType.JSON).body(addOrderPayload).when().get(\"/orders\").then().statusCode(200)", "originalCommit": "a8a6020e7d5682b1927464fd303fe1e0796dfd63", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3dbe1399b89d3ff9b98d9cab775b88aa1bb4271b", "url": "https://github.com/kiegroup/kogito-examples/commit/3dbe1399b89d3ff9b98d9cab775b88aa1bb4271b", "message": "[KOGITO-2893] Remove body from get request\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-19T09:11:00Z", "type": "forcePushed"}, {"oid": "7b71e56482cb732f6de3d6846a9d9b42f484a202", "url": "https://github.com/kiegroup/kogito-examples/commit/7b71e56482cb732f6de3d6846a9d9b42f484a202", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-19T09:23:01Z", "type": "forcePushed"}, {"oid": "d2f29e90ededcdbb2474f541b9d0abadc502a255", "url": "https://github.com/kiegroup/kogito-examples/commit/d2f29e90ededcdbb2474f541b9d0abadc502a255", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-24T10:50:43Z", "type": "forcePushed"}, {"oid": "ed89a338ed7660bdb0d2ab8d0001c146dcb140e8", "url": "https://github.com/kiegroup/kogito-examples/commit/ed89a338ed7660bdb0d2ab8d0001c146dcb140e8", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-24T16:51:25Z", "type": "forcePushed"}, {"oid": "f2f77143e76e665d29e47715ff65a63496a19603", "url": "https://github.com/kiegroup/kogito-examples/commit/f2f77143e76e665d29e47715ff65a63496a19603", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-25T09:44:20Z", "type": "commit"}, {"oid": "f2f77143e76e665d29e47715ff65a63496a19603", "url": "https://github.com/kiegroup/kogito-examples/commit/f2f77143e76e665d29e47715ff65a63496a19603", "message": "[KOGITO-2893] Update tests with new API changes\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-25T09:44:20Z", "type": "forcePushed"}, {"oid": "fbf8e1ba0bd8e7f60d33b4931c625799184be938", "url": "https://github.com/kiegroup/kogito-examples/commit/fbf8e1ba0bd8e7f60d33b4931c625799184be938", "message": "[KOGITO-2893] Update missing references in the README\n\nSigned-off-by: ruromero <rromerom@redhat.com>", "committedDate": "2020-08-25T14:50:24Z", "type": "commit"}]}