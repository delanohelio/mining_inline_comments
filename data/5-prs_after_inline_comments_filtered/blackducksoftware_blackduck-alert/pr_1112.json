{"pr_number": 1112, "pr_title": "Enhance MessageResult", "pr_createdAt": "2020-08-13T17:03:37Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112", "timeline": [{"oid": "6d06499440900d58aab331883d9d8cf0e67ea0de", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/6d06499440900d58aab331883d9d8cf0e67ea0de", "message": "Feat(MessageResult): Include field statuses in message result rather than exception", "committedDate": "2020-08-13T14:16:55Z", "type": "commit"}, {"oid": "957a7b54e319b809ccbc481a3c2ad6a9b7e4d11f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/957a7b54e319b809ccbc481a3c2ad6a9b7e4d11f", "message": "Feat(MessageResult): Update JobConfigActions to utilize MessageResult fieldStatuses", "committedDate": "2020-08-13T15:37:22Z", "type": "commit"}, {"oid": "b402e4b54f679cae942b5e6ef352c75539e2e915", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b402e4b54f679cae942b5e6ef352c75539e2e915", "message": "Feat(JobConfigActions): Combine field statuses when testing job config to maximize feedback per request", "committedDate": "2020-08-13T16:59:22Z", "type": "commit"}, {"oid": "1e427afa86e9a0bd2794fc2630e8d3713a4be233", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/1e427afa86e9a0bd2794fc2630e8d3713a4be233", "message": "Fix(MessageResult): Remove unnecessary static initializer", "committedDate": "2020-08-13T17:52:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470143303", "bodyText": "This is done in multiple places, we should add a method that performs this check and throws the exception to the MessageResult object.", "author": "bamandel", "createdAt": "2020-08-13T17:57:36Z", "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -129,8 +131,13 @@ public void deleteJobById(UUID id) throws AlertException {\n     }\n \n     public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "originalCommit": "b402e4b54f679cae942b5e6ef352c75539e2e915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1NDU4NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470154585", "bodyText": "I was hesitant to do this because I eventually want to get rid of AlertFieldException and just return the results object.", "author": "gkillough", "createdAt": "2020-08-13T18:17:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1NTI0NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470155245", "bodyText": "I agree with that sentiment, but it doesn't hurt to have the method right now then remove it when it's no longer needed", "author": "bamandel", "createdAt": "2020-08-13T18:18:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzMwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NDExMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470144112", "bodyText": "Another example of the exception throwing.", "author": "bamandel", "createdAt": "2020-08-13T17:58:55Z", "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -152,7 +159,11 @@ public JobFieldModel saveJob(JobFieldModel jobFieldModel) throws AlertException\n     }\n \n     public JobFieldModel updateJob(UUID id, JobFieldModel jobFieldModel) throws AlertException {\n-        validateJob(jobFieldModel);\n+        MessageResult validationResult = validateJob(jobFieldModel);\n+        List<AlertFieldStatus> fieldStatuses = validationResult.getFieldStatuses();\n+        if (!fieldStatuses.isEmpty()) {\n+            throw new AlertFieldException(fieldStatuses);\n+        }", "originalCommit": "1e427afa86e9a0bd2794fc2630e8d3713a4be233", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjI4NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470146285", "bodyText": "I think this could be converted into a stream.", "author": "bamandel", "createdAt": "2020-08-13T18:02:20Z", "path": "src/main/java/com/synopsys/integration/alert/web/config/JobConfigActions.java", "diffHunk": "@@ -226,37 +237,41 @@ private boolean filterOutMatchingJobs(@Nullable UUID currentJobId, Configuration\n         }\n     }\n \n-    public String validateJob(JobFieldModel jobFieldModel) throws AlertFieldException {\n-        List<AlertFieldStatus> fieldErrors = new ArrayList<>();\n+    public MessageResult validateJob(JobFieldModel jobFieldModel) {\n+        List<AlertFieldStatus> fieldStatuses = new ArrayList<>();\n         for (FieldModel fieldModel : jobFieldModel.getFieldModels()) {\n-            fieldErrors.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n+            fieldStatuses.addAll(fieldModelProcessor.validateFieldModel(fieldModel));\n         }\n \n-        if (!fieldErrors.isEmpty()) {\n-            throw new AlertFieldException(fieldErrors);\n+        if (!fieldStatuses.isEmpty()) {\n+            return new MessageResult(\"Invalid\", fieldStatuses);\n         }\n-        return \"Valid\";\n+        return new MessageResult(\"Valid\");", "originalCommit": "1e427afa86e9a0bd2794fc2630e8d3713a4be233", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NzYwMA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470147600", "bodyText": "Should this field be an instance of JobFieldStatuses? and the helper methods moved into the JobFieldStatuses class?", "author": "jamesrichard91", "createdAt": "2020-08-13T18:04:49Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/message/model/MessageResult.java", "diffHunk": "@@ -22,21 +22,63 @@\n  */\n package com.synopsys.integration.alert.common.message.model;\n \n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.FieldStatusSeverity;\n import com.synopsys.integration.alert.common.rest.model.AlertSerializableModel;\n \n public class MessageResult extends AlertSerializableModel {\n-    private String statusMessage;\n+    private final String statusMessage;\n+    private final List<AlertFieldStatus> fieldStatuses;", "originalCommit": "1e427afa86e9a0bd2794fc2630e8d3713a4be233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE3NTk1OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470175959", "bodyText": "JobFieldStatues would be a subset of the use case intended for this class.", "author": "gkillough", "createdAt": "2020-08-13T18:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NzYwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0ODQ5NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1112#discussion_r470148494", "bodyText": "This could be confusing to handle further down the line, since the message will say success but there could be errors", "author": "jamesrichard91", "createdAt": "2020-08-13T18:06:29Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/actions/BlackDuckDistributionTestAction.java", "diffHunk": "@@ -78,22 +79,22 @@ public MessageResult testConfig(String configId, FieldModel fieldModel, FieldAcc\n \n                 BlackDuckApiTokenValidator blackDuckAPITokenValidator = new BlackDuckApiTokenValidator(blackDuckProperties);\n                 if (!blackDuckAPITokenValidator.isApiTokenValid()) {\n-                    throw AlertFieldException.singleFieldError(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"User permission failed, cannot read notifications from Black Duck.\");\n+                    fieldStatuses.add(AlertFieldStatus.error(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"User permission failed, cannot read notifications from Black Duck.\"));\n                 }\n             }\n         } else {\n-            throw AlertFieldException.singleFieldError(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"A provider configuration is required\");\n+            fieldStatuses.add(AlertFieldStatus.error(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME, \"A provider configuration is required\"));\n         }\n-\n-        return new MessageResult(\"Successfully tested BlackDuck provider fields\");\n+        return new MessageResult(\"Successfully tested BlackDuck provider fields\", fieldStatuses);", "originalCommit": "1e427afa86e9a0bd2794fc2630e8d3713a4be233", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "40d5d2c90a625cff7af93551738f7e3b1025a53a", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/40d5d2c90a625cff7af93551738f7e3b1025a53a", "message": "Fix(JobConfigActions): Replace duplicate code with helper method", "committedDate": "2020-08-13T18:53:47Z", "type": "commit"}, {"oid": "ec649384f011be49d17891929a72ed820599156d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ec649384f011be49d17891929a72ed820599156d", "message": "Fix(BlackDuckDistributionTestAction): Change result message if fieldStatuses contain errors", "committedDate": "2020-08-13T19:17:26Z", "type": "commit"}, {"oid": "8496de05e031edf62ee4a71c1396fc10e33b8666", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/8496de05e031edf62ee4a71c1396fc10e33b8666", "message": "Merge branch '6.2.0' into gk_enhance_message_result", "committedDate": "2020-08-13T19:38:48Z", "type": "commit"}]}