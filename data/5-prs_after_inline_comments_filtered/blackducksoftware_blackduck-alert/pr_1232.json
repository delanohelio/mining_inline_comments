{"pr_number": 1232, "pr_title": "Increase test coverage for JobConfigActions and JobConfigControllers", "pr_createdAt": "2020-10-27T17:12:21Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232", "timeline": [{"oid": "7eab437f300d72b355ababee919e669fb0989baa", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7eab437f300d72b355ababee919e669fb0989baa", "message": "test: Move JobConfigControllerTestIT and improve coverage for JobConfigActionsTest", "committedDate": "2020-10-20T18:23:40Z", "type": "commit"}, {"oid": "b9b428d89ecffc3476971a0864bd0e0d07970b89", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/b9b428d89ecffc3476971a0864bd0e0d07970b89", "message": "test: Add delete tests", "committedDate": "2020-10-21T17:07:57Z", "type": "commit"}, {"oid": "9327c865df18e4a3131074017d97a5dbf34f628b", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/9327c865df18e4a3131074017d97a5dbf34f628b", "message": "Merge branch 'master' into mc_job_config_tests", "committedDate": "2020-10-21T17:09:09Z", "type": "commit"}, {"oid": "e8d8b19ee1a846a3ac6668b02cec7aa43d467c2d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e8d8b19ee1a846a3ac6668b02cec7aa43d467c2d", "message": "test: Increase test coverage for JobConfigActions", "committedDate": "2020-10-26T17:43:17Z", "type": "commit"}, {"oid": "f08718cb1188ce953cbf10363148b3557b9090c0", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/f08718cb1188ce953cbf10363148b3557b9090c0", "message": "refactor: remove unused blank string check from JobConfigActions", "committedDate": "2020-10-26T17:45:39Z", "type": "commit"}, {"oid": "9cd7434ba1c2c2b26b7a3b7575f6e768809472ed", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/9cd7434ba1c2c2b26b7a3b7575f6e768809472ed", "message": "test: Remove extra validation from JobConfigController integration tests", "committedDate": "2020-10-27T13:34:14Z", "type": "commit"}, {"oid": "a96491cc92fdb8782c0f093f089d01003a468429", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/a96491cc92fdb8782c0f093f089d01003a468429", "message": "Merge branch 'master' into mc_job_config_tests", "committedDate": "2020-10-27T13:35:01Z", "type": "commit"}, {"oid": "26120398141d6d629c383682c9d2d7713b970d2d", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/26120398141d6d629c383682c9d2d7713b970d2d", "message": "test: Remove outdated test in JobConfigControllerTestIT and update jobAccessor mocks", "committedDate": "2020-10-27T15:54:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4MTc5Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512881793", "bodyText": "This should index from zero for the back-end.", "author": "gkillough", "createdAt": "2020-10-27T17:22:17Z", "path": "src/test/java/com/synopsys/integration/alert/web/api/job/JobConfigControllerTestIT.java", "diffHunk": "@@ -84,27 +71,16 @@ public void setup() {\n \n     @Test\n     @WithMockUser(roles = AlertIntegrationTest.ROLE_ALERT_ADMIN)\n-    // FIXME replace with paged request equivalent\n-    @Ignore\n-    public void testGetConfig() throws Exception {\n-        ConfigurationJobModel emptyConfigurationModel = addJob(slackChannelKey.getUniversalKey(), blackDuckProviderKey.getUniversalKey(), Map.of());\n-        String configId = String.valueOf(emptyConfigurationModel.getJobId());\n+    public void testGetPage() throws Exception {\n+        int pageNumber = 1;", "originalCommit": "26120398141d6d629c383682c9d2d7713b970d2d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NjEzMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512886132", "bodyText": "Looks like some strange formatting here. We should keep them all one line or put them all on separate lines", "author": "bamandel", "createdAt": "2020-10-27T17:27:18Z", "path": "src/test/java/com/synopsys/integration/alert/web/api/job/JobConfigActionsTest.java", "diffHunk": "@@ -0,0 +1,856 @@\n+package com.synopsys.integration.alert.web.api.job;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.TestAction;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.Descriptor;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorProcessor;\n+import com.synopsys.integration.alert.common.descriptor.ProviderDescriptor;\n+import com.synopsys.integration.alert.common.descriptor.config.GlobalConfigExistsValidator;\n+import com.synopsys.integration.alert.common.descriptor.config.field.ConfigField;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.ChannelDistributionUIConfig;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.UIConfig;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertFieldException;\n+import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n+import com.synopsys.integration.alert.common.message.model.MessageResult;\n+import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldUtility;\n+import com.synopsys.integration.alert.common.persistence.accessor.JobAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.FieldModelProcessor;\n+import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.JobIdsValidationRequestModel;\n+import com.synopsys.integration.alert.common.rest.model.JobPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.component.certificates.web.PKIXErrorResponseFactory;\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n+\n+public class JobConfigActionsTest {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+    private ConfigurationAccessor configurationAccessor;\n+    private JobAccessor jobAccessor;\n+    private FieldModelProcessor fieldModelProcessor;\n+    private DescriptorProcessor descriptorProcessor;\n+    private ConfigurationFieldModelConverter configurationFieldModelConverter;\n+    private GlobalConfigExistsValidator globalConfigExistsValidator;\n+    private PKIXErrorResponseFactory pkixErrorResponseFactory;\n+    private DescriptorMap descriptorMap;\n+\n+    @BeforeEach\n+    public void init() {\n+        authorizationManager = Mockito.mock(AuthorizationManager.class);\n+        descriptorAccessor = Mockito.mock(DescriptorAccessor.class);\n+        configurationAccessor = Mockito.mock(ConfigurationAccessor.class);\n+        jobAccessor = Mockito.mock(JobAccessor.class);\n+        fieldModelProcessor = Mockito.mock(FieldModelProcessor.class);\n+        descriptorProcessor = Mockito.mock(DescriptorProcessor.class);\n+        configurationFieldModelConverter = Mockito.mock(ConfigurationFieldModelConverter.class);\n+        globalConfigExistsValidator = Mockito.mock(GlobalConfigExistsValidator.class);\n+        pkixErrorResponseFactory = Mockito.mock(PKIXErrorResponseFactory.class);\n+        descriptorMap = Mockito.mock(DescriptorMap.class);\n+\n+        Mockito.when(authorizationManager.hasCreatePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasReadPermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.anyReadPermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasWritePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasDeletePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasExecutePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+    }\n+\n+    @Test\n+    public void createTest() throws Exception {\n+        UUID jobId = UUID.randomUUID();\n+        FieldModel fieldModel = createFieldModel();\n+        JobFieldModel jobFieldModel = new JobFieldModel(jobId.toString(), Set.of(fieldModel));\n+        ConfigurationFieldModel configurationFieldModel = ConfigurationFieldModel.create(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME);\n+        ConfigurationJobModel configurationJobModel = new ConfigurationJobModel(jobId, Set.of(createConfigurationModel()));\n+\n+        Mockito.when(fieldModelProcessor.performBeforeSaveAction(Mockito.any())).thenReturn(fieldModel);\n+        Mockito.when(configurationFieldModelConverter.convertToConfigurationFieldModelMap(Mockito.any())).thenReturn(Map.of(\"Key\", configurationFieldModel));\n+        Mockito.when(jobAccessor.createJob(Mockito.anyCollection(), Mockito.anyCollection())).thenReturn(configurationJobModel);\n+        Mockito.when(configurationFieldModelConverter.convertToFieldModel(Mockito.any())).thenReturn(fieldModel);\n+        Mockito.when(fieldModelProcessor.performAfterSaveAction(Mockito.any())).thenReturn(fieldModel);\n+\n+        JobConfigActions jobConfigActions = new JobConfigActions(authorizationManager, descriptorAccessor, configurationAccessor, jobAccessor, fieldModelProcessor, descriptorProcessor, configurationFieldModelConverter,\n+            globalConfigExistsValidator,\n+            pkixErrorResponseFactory, descriptorMap);", "originalCommit": "26120398141d6d629c383682c9d2d7713b970d2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4ODYyOA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512888628", "bodyText": "save actions for some reason broke them up, I changed it manually and it seems to remain. I will update it for all of the cases its used in.", "author": "ChomickiM", "createdAt": "2020-10-27T17:30:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NjEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NzAyOA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512887028", "bodyText": "Weird formatting here too.", "author": "bamandel", "createdAt": "2020-10-27T17:28:20Z", "path": "src/test/java/com/synopsys/integration/alert/web/api/job/JobConfigActionsTest.java", "diffHunk": "@@ -0,0 +1,856 @@\n+package com.synopsys.integration.alert.web.api.job;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.TestAction;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.Descriptor;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorProcessor;\n+import com.synopsys.integration.alert.common.descriptor.ProviderDescriptor;\n+import com.synopsys.integration.alert.common.descriptor.config.GlobalConfigExistsValidator;\n+import com.synopsys.integration.alert.common.descriptor.config.field.ConfigField;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.ChannelDistributionUIConfig;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.UIConfig;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertFieldException;\n+import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n+import com.synopsys.integration.alert.common.message.model.MessageResult;\n+import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldUtility;\n+import com.synopsys.integration.alert.common.persistence.accessor.JobAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.FieldModelProcessor;\n+import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.JobIdsValidationRequestModel;\n+import com.synopsys.integration.alert.common.rest.model.JobPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.component.certificates.web.PKIXErrorResponseFactory;\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n+\n+public class JobConfigActionsTest {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+    private ConfigurationAccessor configurationAccessor;\n+    private JobAccessor jobAccessor;\n+    private FieldModelProcessor fieldModelProcessor;\n+    private DescriptorProcessor descriptorProcessor;\n+    private ConfigurationFieldModelConverter configurationFieldModelConverter;\n+    private GlobalConfigExistsValidator globalConfigExistsValidator;\n+    private PKIXErrorResponseFactory pkixErrorResponseFactory;\n+    private DescriptorMap descriptorMap;\n+\n+    @BeforeEach\n+    public void init() {\n+        authorizationManager = Mockito.mock(AuthorizationManager.class);\n+        descriptorAccessor = Mockito.mock(DescriptorAccessor.class);\n+        configurationAccessor = Mockito.mock(ConfigurationAccessor.class);\n+        jobAccessor = Mockito.mock(JobAccessor.class);\n+        fieldModelProcessor = Mockito.mock(FieldModelProcessor.class);\n+        descriptorProcessor = Mockito.mock(DescriptorProcessor.class);\n+        configurationFieldModelConverter = Mockito.mock(ConfigurationFieldModelConverter.class);\n+        globalConfigExistsValidator = Mockito.mock(GlobalConfigExistsValidator.class);\n+        pkixErrorResponseFactory = Mockito.mock(PKIXErrorResponseFactory.class);\n+        descriptorMap = Mockito.mock(DescriptorMap.class);\n+\n+        Mockito.when(authorizationManager.hasCreatePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasReadPermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.anyReadPermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasWritePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasDeletePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasExecutePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+    }\n+\n+    @Test\n+    public void createTest() throws Exception {\n+        UUID jobId = UUID.randomUUID();\n+        FieldModel fieldModel = createFieldModel();\n+        JobFieldModel jobFieldModel = new JobFieldModel(jobId.toString(), Set.of(fieldModel));\n+        ConfigurationFieldModel configurationFieldModel = ConfigurationFieldModel.create(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME);\n+        ConfigurationJobModel configurationJobModel = new ConfigurationJobModel(jobId, Set.of(createConfigurationModel()));\n+\n+        Mockito.when(fieldModelProcessor.performBeforeSaveAction(Mockito.any())).thenReturn(fieldModel);\n+        Mockito.when(configurationFieldModelConverter.convertToConfigurationFieldModelMap(Mockito.any())).thenReturn(Map.of(\"Key\", configurationFieldModel));\n+        Mockito.when(jobAccessor.createJob(Mockito.anyCollection(), Mockito.anyCollection())).thenReturn(configurationJobModel);\n+        Mockito.when(configurationFieldModelConverter.convertToFieldModel(Mockito.any())).thenReturn(fieldModel);\n+        Mockito.when(fieldModelProcessor.performAfterSaveAction(Mockito.any())).thenReturn(fieldModel);\n+\n+        JobConfigActions jobConfigActions = new JobConfigActions(authorizationManager, descriptorAccessor, configurationAccessor, jobAccessor, fieldModelProcessor, descriptorProcessor, configurationFieldModelConverter,\n+            globalConfigExistsValidator,\n+            pkixErrorResponseFactory, descriptorMap);\n+\n+        ActionResponse<JobFieldModel> jobFieldModelActionResponse = jobConfigActions.create(jobFieldModel);\n+\n+        assertTrue(jobFieldModelActionResponse.isSuccessful());\n+        assertTrue(jobFieldModelActionResponse.hasContent());\n+        assertEquals(HttpStatus.OK, jobFieldModelActionResponse.getHttpStatus());\n+    }\n+\n+    @Test\n+    public void createServerErrorTest() throws Exception {\n+        UUID jobId = UUID.randomUUID();\n+        FieldModel fieldModel = createFieldModel();\n+        JobFieldModel jobFieldModel = new JobFieldModel(jobId.toString(), Set.of(fieldModel));\n+\n+        Mockito.doThrow(new AlertException(\"Exception for test\")).when(fieldModelProcessor).performBeforeSaveAction(Mockito.any());\n+\n+        JobConfigActions jobConfigActions = new JobConfigActions(authorizationManager, descriptorAccessor, configurationAccessor, jobAccessor, fieldModelProcessor, descriptorProcessor, configurationFieldModelConverter,\n+            globalConfigExistsValidator,\n+            pkixErrorResponseFactory, descriptorMap);", "originalCommit": "26120398141d6d629c383682c9d2d7713b970d2d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NzQ3Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512887476", "bodyText": "formatting", "author": "bamandel", "createdAt": "2020-10-27T17:28:56Z", "path": "src/test/java/com/synopsys/integration/alert/web/api/job/JobConfigActionsTest.java", "diffHunk": "@@ -0,0 +1,856 @@\n+package com.synopsys.integration.alert.web.api.job;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.TestAction;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.Descriptor;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorProcessor;\n+import com.synopsys.integration.alert.common.descriptor.ProviderDescriptor;\n+import com.synopsys.integration.alert.common.descriptor.config.GlobalConfigExistsValidator;\n+import com.synopsys.integration.alert.common.descriptor.config.field.ConfigField;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.ChannelDistributionUIConfig;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.UIConfig;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertFieldException;\n+import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n+import com.synopsys.integration.alert.common.message.model.MessageResult;\n+import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldUtility;\n+import com.synopsys.integration.alert.common.persistence.accessor.JobAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.FieldModelProcessor;\n+import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.JobIdsValidationRequestModel;\n+import com.synopsys.integration.alert.common.rest.model.JobPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.component.certificates.web.PKIXErrorResponseFactory;\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n+\n+public class JobConfigActionsTest {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+    private ConfigurationAccessor configurationAccessor;\n+    private JobAccessor jobAccessor;\n+    private FieldModelProcessor fieldModelProcessor;\n+    private DescriptorProcessor descriptorProcessor;\n+    private ConfigurationFieldModelConverter configurationFieldModelConverter;\n+    private GlobalConfigExistsValidator globalConfigExistsValidator;\n+    private PKIXErrorResponseFactory pkixErrorResponseFactory;\n+    private DescriptorMap descriptorMap;\n+\n+    @BeforeEach\n+    public void init() {\n+        authorizationManager = Mockito.mock(AuthorizationManager.class);\n+        descriptorAccessor = Mockito.mock(DescriptorAccessor.class);\n+        configurationAccessor = Mockito.mock(ConfigurationAccessor.class);\n+        jobAccessor = Mockito.mock(JobAccessor.class);\n+        fieldModelProcessor = Mockito.mock(FieldModelProcessor.class);\n+        descriptorProcessor = Mockito.mock(DescriptorProcessor.class);\n+        configurationFieldModelConverter = Mockito.mock(ConfigurationFieldModelConverter.class);\n+        globalConfigExistsValidator = Mockito.mock(GlobalConfigExistsValidator.class);\n+        pkixErrorResponseFactory = Mockito.mock(PKIXErrorResponseFactory.class);\n+        descriptorMap = Mockito.mock(DescriptorMap.class);\n+\n+        Mockito.when(authorizationManager.hasCreatePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasReadPermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.anyReadPermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasWritePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasDeletePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+        Mockito.when(authorizationManager.hasExecutePermission(Mockito.any(), Mockito.any())).thenReturn(true);\n+    }\n+\n+    @Test\n+    public void createTest() throws Exception {\n+        UUID jobId = UUID.randomUUID();\n+        FieldModel fieldModel = createFieldModel();\n+        JobFieldModel jobFieldModel = new JobFieldModel(jobId.toString(), Set.of(fieldModel));\n+        ConfigurationFieldModel configurationFieldModel = ConfigurationFieldModel.create(ProviderDescriptor.KEY_PROVIDER_CONFIG_NAME);\n+        ConfigurationJobModel configurationJobModel = new ConfigurationJobModel(jobId, Set.of(createConfigurationModel()));\n+\n+        Mockito.when(fieldModelProcessor.performBeforeSaveAction(Mockito.any())).thenReturn(fieldModel);\n+        Mockito.when(configurationFieldModelConverter.convertToConfigurationFieldModelMap(Mockito.any())).thenReturn(Map.of(\"Key\", configurationFieldModel));\n+        Mockito.when(jobAccessor.createJob(Mockito.anyCollection(), Mockito.anyCollection())).thenReturn(configurationJobModel);\n+        Mockito.when(configurationFieldModelConverter.convertToFieldModel(Mockito.any())).thenReturn(fieldModel);\n+        Mockito.when(fieldModelProcessor.performAfterSaveAction(Mockito.any())).thenReturn(fieldModel);\n+\n+        JobConfigActions jobConfigActions = new JobConfigActions(authorizationManager, descriptorAccessor, configurationAccessor, jobAccessor, fieldModelProcessor, descriptorProcessor, configurationFieldModelConverter,\n+            globalConfigExistsValidator,\n+            pkixErrorResponseFactory, descriptorMap);\n+\n+        ActionResponse<JobFieldModel> jobFieldModelActionResponse = jobConfigActions.create(jobFieldModel);\n+\n+        assertTrue(jobFieldModelActionResponse.isSuccessful());\n+        assertTrue(jobFieldModelActionResponse.hasContent());\n+        assertEquals(HttpStatus.OK, jobFieldModelActionResponse.getHttpStatus());\n+    }\n+\n+    @Test\n+    public void createServerErrorTest() throws Exception {\n+        UUID jobId = UUID.randomUUID();\n+        FieldModel fieldModel = createFieldModel();\n+        JobFieldModel jobFieldModel = new JobFieldModel(jobId.toString(), Set.of(fieldModel));\n+\n+        Mockito.doThrow(new AlertException(\"Exception for test\")).when(fieldModelProcessor).performBeforeSaveAction(Mockito.any());\n+\n+        JobConfigActions jobConfigActions = new JobConfigActions(authorizationManager, descriptorAccessor, configurationAccessor, jobAccessor, fieldModelProcessor, descriptorProcessor, configurationFieldModelConverter,\n+            globalConfigExistsValidator,\n+            pkixErrorResponseFactory, descriptorMap);\n+\n+        ActionResponse<JobFieldModel> jobFieldModelActionResponse = jobConfigActions.create(jobFieldModel);\n+\n+        assertTrue(jobFieldModelActionResponse.isError());\n+        assertFalse(jobFieldModelActionResponse.hasContent());\n+        assertEquals(HttpStatus.INTERNAL_SERVER_ERROR, jobFieldModelActionResponse.getHttpStatus());\n+    }\n+\n+    @Test\n+    public void getPageTest() throws Exception {\n+        int totalPages = 1;\n+        int pageNumber = 0;\n+        int pageSize = 10;\n+        DescriptorType descriptorType = DescriptorType.CHANNEL;\n+        RegisteredDescriptorModel registeredDescriptorModel = new RegisteredDescriptorModel(1L, \"descriptorName\", descriptorType.name());\n+        UUID jobId = UUID.randomUUID();\n+        FieldModel fieldModel = createFieldModel();\n+        ConfigurationJobModel configurationJobModel = new ConfigurationJobModel(jobId, Set.of(createConfigurationModel()));\n+        AlertPagedModel<ConfigurationJobModel> pageOfJobs = new AlertPagedModel(totalPages, pageNumber, pageSize, List.of(configurationJobModel));\n+\n+        Mockito.when(descriptorAccessor.getRegisteredDescriptors()).thenReturn(List.of(registeredDescriptorModel));\n+        Mockito.when(jobAccessor.getPageOfJobs(Mockito.anyInt(), Mockito.anyInt(), Mockito.anyCollection())).thenReturn(pageOfJobs);\n+        Mockito.when(configurationFieldModelConverter.convertToFieldModel(Mockito.any())).thenReturn(fieldModel);\n+\n+        JobConfigActions jobConfigActions = new JobConfigActions(authorizationManager, descriptorAccessor, configurationAccessor, jobAccessor, fieldModelProcessor, descriptorProcessor, configurationFieldModelConverter,\n+            globalConfigExistsValidator,\n+            pkixErrorResponseFactory, descriptorMap);", "originalCommit": "26120398141d6d629c383682c9d2d7713b970d2d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4Nzc3Mw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512887773", "bodyText": "Looks like it's for all instances of jobConfigActions", "author": "bamandel", "createdAt": "2020-10-27T17:29:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg4NzQ3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg5MDM4Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1232#discussion_r512890382", "bodyText": "It might be better to add a JobConfigAction member to this class then initialize the object here. Cut down on some duplicate code.", "author": "bamandel", "createdAt": "2020-10-27T17:32:21Z", "path": "src/test/java/com/synopsys/integration/alert/web/api/job/JobConfigActionsTest.java", "diffHunk": "@@ -0,0 +1,856 @@\n+package com.synopsys.integration.alert.web.api.job;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertFalse;\n+import static org.junit.jupiter.api.Assertions.assertTrue;\n+\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.UUID;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mockito;\n+import org.springframework.http.HttpStatus;\n+\n+import com.synopsys.integration.alert.common.action.ActionResponse;\n+import com.synopsys.integration.alert.common.action.TestAction;\n+import com.synopsys.integration.alert.common.action.ValidationActionResponse;\n+import com.synopsys.integration.alert.common.descriptor.Descriptor;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorKey;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorMap;\n+import com.synopsys.integration.alert.common.descriptor.DescriptorProcessor;\n+import com.synopsys.integration.alert.common.descriptor.ProviderDescriptor;\n+import com.synopsys.integration.alert.common.descriptor.config.GlobalConfigExistsValidator;\n+import com.synopsys.integration.alert.common.descriptor.config.field.ConfigField;\n+import com.synopsys.integration.alert.common.descriptor.config.field.errors.AlertFieldStatus;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.ChannelDistributionUIConfig;\n+import com.synopsys.integration.alert.common.descriptor.config.ui.UIConfig;\n+import com.synopsys.integration.alert.common.enumeration.ConfigContextEnum;\n+import com.synopsys.integration.alert.common.enumeration.DescriptorType;\n+import com.synopsys.integration.alert.common.exception.AlertDatabaseConstraintException;\n+import com.synopsys.integration.alert.common.exception.AlertException;\n+import com.synopsys.integration.alert.common.exception.AlertFieldException;\n+import com.synopsys.integration.alert.common.exception.AlertMethodNotAllowedException;\n+import com.synopsys.integration.alert.common.message.model.MessageResult;\n+import com.synopsys.integration.alert.common.persistence.accessor.ConfigurationAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.DescriptorAccessor;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldUtility;\n+import com.synopsys.integration.alert.common.persistence.accessor.JobAccessor;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationFieldModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationJobModel;\n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n+import com.synopsys.integration.alert.common.persistence.model.RegisteredDescriptorModel;\n+import com.synopsys.integration.alert.common.persistence.util.ConfigurationFieldModelConverter;\n+import com.synopsys.integration.alert.common.rest.FieldModelProcessor;\n+import com.synopsys.integration.alert.common.rest.model.AlertPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldModel;\n+import com.synopsys.integration.alert.common.rest.model.FieldValueModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldModel;\n+import com.synopsys.integration.alert.common.rest.model.JobFieldStatuses;\n+import com.synopsys.integration.alert.common.rest.model.JobIdsValidationRequestModel;\n+import com.synopsys.integration.alert.common.rest.model.JobPagedModel;\n+import com.synopsys.integration.alert.common.rest.model.ValidationResponseModel;\n+import com.synopsys.integration.alert.common.security.authorization.AuthorizationManager;\n+import com.synopsys.integration.alert.component.certificates.web.PKIXErrorResponseFactory;\n+import com.synopsys.integration.exception.IntegrationException;\n+import com.synopsys.integration.rest.exception.IntegrationRestException;\n+\n+public class JobConfigActionsTest {\n+    private AuthorizationManager authorizationManager;\n+    private DescriptorAccessor descriptorAccessor;\n+    private ConfigurationAccessor configurationAccessor;\n+    private JobAccessor jobAccessor;\n+    private FieldModelProcessor fieldModelProcessor;\n+    private DescriptorProcessor descriptorProcessor;\n+    private ConfigurationFieldModelConverter configurationFieldModelConverter;\n+    private GlobalConfigExistsValidator globalConfigExistsValidator;\n+    private PKIXErrorResponseFactory pkixErrorResponseFactory;\n+    private DescriptorMap descriptorMap;\n+\n+    @BeforeEach\n+    public void init() {\n+        authorizationManager = Mockito.mock(AuthorizationManager.class);\n+        descriptorAccessor = Mockito.mock(DescriptorAccessor.class);\n+        configurationAccessor = Mockito.mock(ConfigurationAccessor.class);\n+        jobAccessor = Mockito.mock(JobAccessor.class);\n+        fieldModelProcessor = Mockito.mock(FieldModelProcessor.class);\n+        descriptorProcessor = Mockito.mock(DescriptorProcessor.class);\n+        configurationFieldModelConverter = Mockito.mock(ConfigurationFieldModelConverter.class);\n+        globalConfigExistsValidator = Mockito.mock(GlobalConfigExistsValidator.class);\n+        pkixErrorResponseFactory = Mockito.mock(PKIXErrorResponseFactory.class);\n+        descriptorMap = Mockito.mock(DescriptorMap.class);\n+", "originalCommit": "26120398141d6d629c383682c9d2d7713b970d2d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "61a5351b1dda46a4ce261dd1d8ef0ff7a7eb5a11", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/61a5351b1dda46a4ce261dd1d8ef0ff7a7eb5a11", "message": "test: Change index and simplify some JobConfig tests", "committedDate": "2020-10-27T17:38:21Z", "type": "commit"}, {"oid": "7cd5855fede6d4d4294ab51c6a57abfa4f46743f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7cd5855fede6d4d4294ab51c6a57abfa4f46743f", "message": "test: Clean up some duplicate code", "committedDate": "2020-10-27T19:10:59Z", "type": "commit"}, {"oid": "e0cde6f85630caeadeda60020a615f4eab1e1a71", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/e0cde6f85630caeadeda60020a615f4eab1e1a71", "message": "test: Remove unnecessary mocks from JobConfigActionsTest", "committedDate": "2020-10-28T13:38:34Z", "type": "commit"}, {"oid": "7c0b3c9de0b38dec012b086af854dc2e2d56d8af", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/7c0b3c9de0b38dec012b086af854dc2e2d56d8af", "message": "Merge branch 'master' into mc_job_config_tests", "committedDate": "2020-10-28T13:38:57Z", "type": "commit"}]}