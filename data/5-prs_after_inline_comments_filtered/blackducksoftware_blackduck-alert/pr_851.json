{"pr_number": 851, "pr_title": "Ps properties factory", "pr_createdAt": "2020-02-12T12:53:11Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/851", "timeline": [{"oid": "496145b928b15232f2ad570116d359fd2f7fca53", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/496145b928b15232f2ad570116d359fd2f7fca53", "message": "feat(provider): Implement BlackDuckProperties creation via a factory.", "committedDate": "2020-02-11T21:06:47Z", "type": "commit"}, {"oid": "715d74441c355d86ae123e2aff969937a2eee993", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/715d74441c355d86ae123e2aff969937a2eee993", "message": "refactor(provider): Decouple BlackDuckProperties from components.", "committedDate": "2020-02-12T12:50:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI1ODk4NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378258985", "bodyText": "Might want to add a TODO here.", "author": "gkillough", "createdAt": "2020-02-12T13:46:39Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/workflow/processor/NotificationProcessor.java", "diffHunk": "@@ -82,7 +84,9 @@ public NotificationProcessor(ConfigurationAccessor configurationAccessor, List<P\n         }\n \n         Provider provider = providerKeyToProvider.get(job.getProviderName());\n-        ProviderDistributionFilter distributionFilter = provider.createDistributionFilter();\n+        ConfigurationModel providerConfig = null;", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MDEyOA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378260128", "bodyText": "I think we can get away without this. The implementing class should be able to specify the correct type.", "author": "gkillough", "createdAt": "2020-02-12T13:48:37Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/provider/Provider.java", "diffHunk": "@@ -24,12 +24,13 @@\n \n import java.util.List;\n \n+import com.synopsys.integration.alert.common.persistence.model.ConfigurationModel;\n import com.synopsys.integration.alert.common.provider.lifecycle.ProviderTask;\n import com.synopsys.integration.alert.common.provider.notification.ProviderDistributionFilter;\n import com.synopsys.integration.alert.common.provider.notification.ProviderNotificationClassMap;\n import com.synopsys.integration.alert.common.workflow.processor.ProviderMessageContentCollector;\n \n-public abstract class Provider {\n+public abstract class Provider<T extends ProviderProperties> {", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MDc5Ng==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378260796", "bodyText": "Should we add a TODO here?", "author": "gkillough", "createdAt": "2020-02-12T13:49:46Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/BlackDuckValidator.java", "diffHunk": "@@ -43,15 +41,13 @@\n import com.synopsys.integration.log.IntLogger;\n import com.synopsys.integration.log.Slf4jIntLogger;\n \n-@Component\n public class BlackDuckValidator extends ProviderValidator {", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI3NzI4MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378277281", "bodyText": "I have created a Factory class to instantiate the validator.", "author": "psantos1113", "createdAt": "2020-02-12T14:17:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MDc5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMwOTM1Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378309357", "bodyText": "I've removed the need for the factory", "author": "psantos1113", "createdAt": "2020-02-12T15:06:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MDc5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MTU2MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378261560", "bodyText": "Should the validate() method take a properties object rather than having a factory for it?", "author": "gkillough", "createdAt": "2020-02-12T13:51:07Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/BlackDuckValidator.java", "diffHunk": "@@ -43,15 +41,13 @@\n import com.synopsys.integration.log.IntLogger;\n import com.synopsys.integration.log.Slf4jIntLogger;\n \n-@Component\n public class BlackDuckValidator extends ProviderValidator {\n     private static final Logger logger = LoggerFactory.getLogger(BlackDuckValidator.class);\n \n     private final AlertProperties alertProperties;\n     private final BlackDuckProperties blackDuckProperties;\n     private final SystemMessageUtility systemMessageUtility;\n \n-    @Autowired\n     public BlackDuckValidator(AlertProperties alertProperties, BlackDuckProperties blackDuckProperties, SystemMessageUtility systemMessageUtility) {", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI5MDM5NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378290395", "bodyText": "I can make those changes.", "author": "psantos1113", "createdAt": "2020-02-12T14:37:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MTU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MjMwMQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378262301", "bodyText": "Should we also have a createProperties(...) method that takes a ConfigurationModel?", "author": "gkillough", "createdAt": "2020-02-12T13:52:27Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/factories/BlackDuckPropertiesFactory.java", "diffHunk": "@@ -0,0 +1,52 @@\n+/**\n+ * blackduck-alert\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.provider.blackduck.factories;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import com.google.gson.Gson;\n+import com.synopsys.integration.alert.common.AlertProperties;\n+import com.synopsys.integration.alert.common.persistence.accessor.FieldAccessor;\n+import com.synopsys.integration.alert.common.provider.lifecycle.ProviderPropertiesFactory;\n+import com.synopsys.integration.alert.common.rest.ProxyManager;\n+import com.synopsys.integration.alert.provider.blackduck.BlackDuckProperties;\n+\n+@Component\n+public class BlackDuckPropertiesFactory extends ProviderPropertiesFactory<BlackDuckProperties> {\n+    private final Gson gson;\n+    private final AlertProperties alertProperties;\n+    private final ProxyManager proxyManager;\n+\n+    @Autowired\n+    public BlackDuckPropertiesFactory(Gson gson, AlertProperties alertProperties, ProxyManager proxyManager) {\n+        this.gson = gson;\n+        this.alertProperties = alertProperties;\n+        this.proxyManager = proxyManager;\n+    }\n+\n+    @Override\n+    public BlackDuckProperties createProperties(Long configId, FieldAccessor fieldAccessor) {", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MjY4Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378262687", "bodyText": "Can we put a TODO here to revisit this approach once we have everything else working?", "author": "gkillough", "createdAt": "2020-02-12T13:53:04Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/factories/BlackDuckValidatorFactory.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * blackduck-alert\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.alert.provider.blackduck.factories;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import com.synopsys.integration.alert.common.AlertProperties;\n+import com.synopsys.integration.alert.common.persistence.accessor.SystemMessageUtility;\n+import com.synopsys.integration.alert.provider.blackduck.BlackDuckProperties;\n+import com.synopsys.integration.alert.provider.blackduck.BlackDuckValidator;\n+\n+@Component\n+public class BlackDuckValidatorFactory {\n+    private final AlertProperties alertProperties;\n+    private final SystemMessageUtility systemMessageUtility;\n+\n+    @Autowired\n+    public BlackDuckValidatorFactory(AlertProperties alertProperties, SystemMessageUtility systemMessageUtility) {\n+        this.alertProperties = alertProperties;\n+        this.systemMessageUtility = systemMessageUtility;\n+    }\n+\n+    public BlackDuckValidator createValidator(BlackDuckProperties properties) {", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMwOTY3Nw==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378309677", "bodyText": "no longer needed.", "author": "psantos1113", "createdAt": "2020-02-12T15:06:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2MjY4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2Mzg2MQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378263861", "bodyText": "Can we Autowire the BlackDuckPropertiesFactory?", "author": "gkillough", "createdAt": "2020-02-12T13:55:00Z", "path": "src/main/java/com/synopsys/integration/alert/provider/blackduck/web/PolicyNotificationFilterCustomEndpoint.java", "diffHunk": "@@ -97,6 +96,8 @@ private boolean isFilterablePolicy(Collection<String> notificationTypes) {\n     }\n \n     private List<NotificationFilterModel> retrieveBlackDuckPolicyOptions() throws IntegrationException {\n+        //FIXME have to figure out how to create the properties for this endpoint.", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2NDE3OQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378264179", "bodyText": "I realize we still need to have the config.", "author": "gkillough", "createdAt": "2020-02-12T13:55:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2Mzg2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI5MzgzNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378293835", "bodyText": "I can autowire the factory.", "author": "psantos1113", "createdAt": "2020-02-12T14:43:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2Mzg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODI2NDQ0NQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378264445", "bodyText": "Add a FIXME here.", "author": "gkillough", "createdAt": "2020-02-12T13:55:54Z", "path": "src/main/java/com/synopsys/integration/alert/workflow/scheduled/PhoneHomeTask.java", "diffHunk": "@@ -198,6 +197,7 @@ private PhoneHomeRequestBody addBDDataAndBuild(PhoneHomeRequestBody.Builder phon\n         String blackDuckUrl = PhoneHomeRequestBody.Builder.UNKNOWN_ID;\n         String blackDuckVersion = PhoneHomeRequestBody.Builder.UNKNOWN_ID;\n         try {\n+            BlackDuckProperties blackDuckProperties = new BlackDuckProperties(null, null, null, null, new FieldAccessor(Map.of()));", "originalCommit": "715d74441c355d86ae123e2aff969937a2eee993", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "317a4874e695b02a5b806e6adf55a615554f09ce", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/317a4874e695b02a5b806e6adf55a615554f09ce", "message": "refactor(provider): Implement PR feedback.", "committedDate": "2020-02-12T15:10:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODMxNDI3Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/851#discussion_r378314272", "bodyText": "I'm not 100% sure that we need a generic here.", "author": "gkillough", "createdAt": "2020-02-12T15:13:51Z", "path": "alert-common/src/main/java/com/synopsys/integration/alert/common/provider/ProviderValidator.java", "diffHunk": "@@ -22,7 +22,7 @@\n  */\n package com.synopsys.integration.alert.common.provider;\n \n-public abstract class ProviderValidator {\n+public abstract class ProviderValidator<T extends ProviderProperties> {", "originalCommit": "317a4874e695b02a5b806e6adf55a615554f09ce", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "838337ec2cb8d7e3bd71feebe49aef135bec5d1f", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/838337ec2cb8d7e3bd71feebe49aef135bec5d1f", "message": "Merge remote-tracking branch 'origin/feat_provider_lifecycle_management' into ps_properties_factory", "committedDate": "2020-02-12T15:30:55Z", "type": "commit"}]}