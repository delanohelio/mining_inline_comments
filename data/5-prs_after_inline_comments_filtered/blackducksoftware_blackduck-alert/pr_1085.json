{"pr_number": 1085, "pr_title": "New Azure Services for Custom Field Interaction", "pr_createdAt": "2020-07-27T16:53:57Z", "pr_url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085", "timeline": [{"oid": "ea51692d3af9bb24095e5ff149f50a50e2f41522", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/ea51692d3af9bb24095e5ff149f50a50e2f41522", "message": "Feat(Azure Library): Add process service for the purpose of adding custom fields", "committedDate": "2020-07-27T16:02:56Z", "type": "commit"}, {"oid": "26559443d31d39b94ab65ae444f7d47dc8cc6222", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/26559443d31d39b94ab65ae444f7d47dc8cc6222", "message": "Feat(Azure Library): Add project service methods for inferring processId and creating fields", "committedDate": "2020-07-27T16:49:22Z", "type": "commit"}, {"oid": "627ecfcd80bf8763b1f73658766a26eacd68cd11", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/627ecfcd80bf8763b1f73658766a26eacd68cd11", "message": "Chore(Azure Library): Add license headers", "committedDate": "2020-07-27T16:53:03Z", "type": "commit"}, {"oid": "d24cab713112c2e4cee12afc4ba6ca43eb1fb22e", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/d24cab713112c2e4cee12afc4ba6ca43eb1fb22e", "message": "Fix(Azure Library): Extract common replacement strings as constants", "committedDate": "2020-07-27T16:59:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MTY2Mg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461041662", "bodyText": "Why not put the 3rd variable directly in the string?", "author": "bamandel", "createdAt": "2020-07-27T17:10:51Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/service/process/AzureProcessService.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/**\n+ * azure-boards-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.azure.boards.common.service.process;\n+\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+\n+import com.google.gson.reflect.TypeToken;\n+import com.synopsys.integration.azure.boards.common.http.AzureHttpService;\n+import com.synopsys.integration.azure.boards.common.http.HttpServiceException;\n+import com.synopsys.integration.azure.boards.common.model.AzureArrayResponseModel;\n+import com.synopsys.integration.azure.boards.common.util.AzureSpecTemplate;\n+\n+/**\n+ * <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/devops/processes/work%20item%20types/list?view=azure-devops-rest-5.1\">Work Item Types</a>\n+ * <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/devops/processes/fields/add?view=azure-devops-rest-5.1\">Fields</a>\n+ */\n+public class AzureProcessService {\n+    public static final AzureSpecTemplate API_SPEC_ORGANIZATION_PROCESS_WORKITEMTYPES = new AzureSpecTemplate(\"/{organization}/_apis/work/processes/{processId}/workItemTypes\");\n+    public static final AzureSpecTemplate API_SPEC_ORGANIZATION_PROCESS_WORKITEMTYPE_FIELDS = new AzureSpecTemplate(\"/{organization}/_apis/work/processes/{processId}/workItemTypes/{witRefName}/fields\");\n+    public static final String PATH_ORGANIZATION_REPLACEMENT = \"{organization}\";\n+    public static final String PATH_PROCESS_ID_REPLACEMENT = \"{processId}\";\n+\n+    private final AzureHttpService azureHttpService;\n+\n+    public AzureProcessService(AzureHttpService azureHttpService) {\n+        this.azureHttpService = azureHttpService;\n+    }\n+\n+    public AzureArrayResponseModel<ProcessWorkItemTypesResponseModel> getWorkItemTypes(String organizationName, String processId) throws HttpServiceException {\n+        String requestSpec = API_SPEC_ORGANIZATION_PROCESS_WORKITEMTYPES\n+                                 .defineReplacement(PATH_ORGANIZATION_REPLACEMENT, organizationName)\n+                                 .defineReplacement(PATH_PROCESS_ID_REPLACEMENT, processId)\n+                                 .populateSpec();\n+        requestSpec = appendApiVersionQueryParam(requestSpec);\n+        Type responseType = new TypeToken<AzureArrayResponseModel<ProcessWorkItemTypesResponseModel>>() {}.getType();\n+        return azureHttpService.get(requestSpec, responseType);\n+    }\n+\n+    public ProcessFieldResponseModel addFieldToWorkItemType(String organizationName, String processId, String workItemTypeRefName, ProcessFieldRequestModel requestBody) throws IOException, HttpServiceException {\n+        String requestSpec = API_SPEC_ORGANIZATION_PROCESS_WORKITEMTYPE_FIELDS\n+                                 .defineReplacement(PATH_ORGANIZATION_REPLACEMENT, organizationName)\n+                                 .defineReplacement(PATH_PROCESS_ID_REPLACEMENT, processId)\n+                                 .defineReplacement(\"{witRefName}\", workItemTypeRefName)\n+                                 .populateSpec();\n+        requestSpec = appendApiVersionQueryParam(requestSpec);\n+        return azureHttpService.post(requestSpec, requestBody, ProcessFieldResponseModel.class);\n+    }\n+\n+    private String appendApiVersionQueryParam(String requestSpec) {\n+        return String.format(\"%s?%s=%s\", requestSpec, AzureHttpService.AZURE_API_VERSION_QUERY_PARAM_NAME, \"5.1-preview.2\");", "originalCommit": "d24cab713112c2e4cee12afc4ba6ca43eb1fb22e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MTgxNQ==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461041815", "bodyText": "And if it's important that it's separate, then we should make it into a static variable", "author": "bamandel", "createdAt": "2020-07-27T17:11:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MTY2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MzE3NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461043174", "bodyText": "Should this have projectId instead of project?", "author": "bamandel", "createdAt": "2020-07-27T17:13:37Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/service/project/AzureProjectService.java", "diffHunk": "@@ -22,20 +22,29 @@\n  */\n package com.synopsys.integration.azure.boards.common.service.project;\n \n+import java.io.IOException;\n import java.lang.reflect.Type;\n \n+import com.google.gson.JsonObject;\n import com.google.gson.reflect.TypeToken;\n import com.synopsys.integration.azure.boards.common.http.AzureHttpService;\n import com.synopsys.integration.azure.boards.common.http.HttpServiceException;\n import com.synopsys.integration.azure.boards.common.model.AzureArrayResponseModel;\n import com.synopsys.integration.azure.boards.common.util.AzureSpecTemplate;\n \n /**\n- * <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/devops/core/projects?view=azure-devops-rest-5.1\">Documentation</a>\n+ * <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/devops/core/projects?view=azure-devops-rest-5.1\">Projects</a>\n+ * <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/devops/core/projects/get%20project%20properties?view=azure-devops-rest-5.1\">Project Properties</a>\n+ * <a href=\"https://docs.microsoft.com/en-us/rest/api/azure/devops/wit/fields/create?view=azure-devops-rest-5.1\">Project Fields</a>\n  */\n public class AzureProjectService {\n     public static final AzureSpecTemplate API_SPEC_ORGANIZATION_PROJECTS = new AzureSpecTemplate(\"/{organization}/_apis/projects\");\n     public static final AzureSpecTemplate API_SPEC_ORGANIZATION_PROJECTS_INDIVIDUAL = new AzureSpecTemplate(\"/{organization}/_apis/projects/{projectId}\");\n+    public static final AzureSpecTemplate API_SPEC_ORGANIZATION_PROJECT_PROPERTIES = new AzureSpecTemplate(\"/{organization}/_apis/projects/{projectId}/properties\");\n+    public static final AzureSpecTemplate API_SPEC_ORGANIZATION_PROJECT_FIELDS = new AzureSpecTemplate(\"/{organization}/{project}/_apis/wit/fields\");", "originalCommit": "d24cab713112c2e4cee12afc4ba6ca43eb1fb22e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0NDI3MA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461044270", "bodyText": "nvm I found its replacement", "author": "bamandel", "createdAt": "2020-07-27T17:15:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MzE3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTA0MzY0NA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461043644", "bodyText": "I think the third variable should be removed here as well or replaced with a static variable", "author": "bamandel", "createdAt": "2020-07-27T17:14:27Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/service/project/AzureProjectService.java", "diffHunk": "@@ -45,19 +54,37 @@ public AzureProjectService(AzureHttpService azureHttpService) {\n \n     public AzureArrayResponseModel<TeamProjectReferenceResponseModel> getProjects(String organizationName) throws HttpServiceException {\n         String requestSpec = API_SPEC_ORGANIZATION_PROJECTS\n-                                 .defineReplacement(\"{organization}\", organizationName)\n+                                 .defineReplacement(PATH_ORGANIZATION_REPLACEMENT, organizationName)\n                                  .populateSpec();\n         Type responseType = new TypeToken<AzureArrayResponseModel<TeamProjectReferenceResponseModel>>() {}.getType();\n         return azureHttpService.get(requestSpec, responseType);\n     }\n \n     public TeamProjectResponseModel getProject(String organizationName, String projectId) throws HttpServiceException {\n         String requestSpec = API_SPEC_ORGANIZATION_PROJECTS_INDIVIDUAL\n-                                 .defineReplacement(\"{organization}\", organizationName)\n-                                 .defineReplacement(\"{projectId}\", projectId)\n+                                 .defineReplacement(PATH_ORGANIZATION_REPLACEMENT, organizationName)\n+                                 .defineReplacement(PATH_PROJECT_ID_REPLACEMENT, projectId)\n                                  .populateSpec();\n         Type responseType = new TypeToken<TeamProjectResponseModel>() {}.getType();\n         return azureHttpService.get(requestSpec, responseType);\n     }\n \n+    public AzureArrayResponseModel<ProjectPropertyResponseModel> getProjectProperties(String organizationName, String projectId) throws HttpServiceException {\n+        String requestSpec = API_SPEC_ORGANIZATION_PROJECT_PROPERTIES\n+                                 .defineReplacement(PATH_ORGANIZATION_REPLACEMENT, organizationName)\n+                                 .defineReplacement(PATH_PROJECT_ID_REPLACEMENT, projectId)\n+                                 .populateSpec();\n+        requestSpec = String.format(\"%s?%s=%s\", requestSpec, AzureHttpService.AZURE_API_VERSION_QUERY_PARAM_NAME, \"5.1-preview.1\");", "originalCommit": "d24cab713112c2e4cee12afc4ba6ca43eb1fb22e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bec2dd41b37bcc66083182ae4dce8fde1d98eea0", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/bec2dd41b37bcc66083182ae4dce8fde1d98eea0", "message": "Fix(Azure Library): Extract API version parameter value into its own variable", "committedDate": "2020-07-27T17:40:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4MzUwMg==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461483502", "bodyText": "Is this used at all?  Does this need to be a generic object type or is there a specific object representation for the default value?", "author": "psantos1113", "createdAt": "2020-07-28T10:35:19Z", "path": "azure-boards-common/src/main/java/com/synopsys/integration/azure/boards/common/service/process/ProcessFieldResponseModel.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/**\n+ * azure-boards-common\n+ *\n+ * Copyright (c) 2020 Synopsys, Inc.\n+ *\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements. See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership. The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License. You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied. See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package com.synopsys.integration.azure.boards.common.service.process;\n+\n+public class ProcessFieldResponseModel {\n+    private Boolean allowGroups;\n+    private String customization;\n+    private Object defaultValue;", "originalCommit": "bec2dd41b37bcc66083182ae4dce8fde1d98eea0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTUzMDIyNA==", "url": "https://github.com/blackducksoftware/blackduck-alert/pull/1085#discussion_r461530224", "bodyText": "According to the docs, it is an Object, but I should probably change it to JsonObject just in case we ever need to drill down into its contents.", "author": "gkillough", "createdAt": "2020-07-28T12:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTQ4MzUwMg=="}], "type": "inlineReview"}, {"oid": "544c48ee481101302f5b410b6ce35d5bad5c114b", "url": "https://github.com/blackducksoftware/blackduck-alert/commit/544c48ee481101302f5b410b6ce35d5bad5c114b", "message": "Fix(Azure Library): Migrate ProcessFieldResponseModel's defaultValue to JsonObject", "committedDate": "2020-07-28T12:13:11Z", "type": "commit"}]}