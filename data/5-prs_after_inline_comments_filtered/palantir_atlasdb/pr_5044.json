{"pr_number": 5044, "pr_title": "Upgrade gradle-baseline", "pr_createdAt": "2020-10-18T19:03:04Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5044", "timeline": [{"oid": "454fad002d23c248634f720d1cd7b21a1280bc76", "url": "https://github.com/palantir/atlasdb/commit/454fad002d23c248634f720d1cd7b21a1280bc76", "message": "Sort gradle plugins", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "a755de561133a41fc79afd228d9c0aa2fde4f36d", "url": "https://github.com/palantir/atlasdb/commit/a755de561133a41fc79afd228d9c0aa2fde4f36d", "message": "Add gradle-palantir-java-format", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "087ca49d116365b491a259777f7a12b7276b07d2", "url": "https://github.com/palantir/atlasdb/commit/087ca49d116365b491a259777f7a12b7276b07d2", "message": "Use gradle-baseline-java:3.43.0", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "4695062fa3a0a80a215fec2aabf6dadae90e2368", "url": "https://github.com/palantir/atlasdb/commit/4695062fa3a0a80a215fec2aabf6dadae90e2368", "message": "Run baselineUpdateConfig", "committedDate": "2020-10-19T15:32:01Z", "type": "commit"}, {"oid": "0bd984c7cdd92f6bdef0cf4e37882eaa0c0fe962", "url": "https://github.com/palantir/atlasdb/commit/0bd984c7cdd92f6bdef0cf4e37882eaa0c0fe962", "message": "Standardize baseline configuration in build.gradle", "committedDate": "2020-10-19T15:36:06Z", "type": "forcePushed"}, {"oid": "9d3b2d1b3141339a23018665630962e90dea9a8f", "url": "https://github.com/palantir/atlasdb/commit/9d3b2d1b3141339a23018665630962e90dea9a8f", "message": "Apply gradle-palantir-java-format", "committedDate": "2020-10-19T16:08:34Z", "type": "commit"}, {"oid": "a8a2938ca3348ed1734a705cad764ee99f2a4180", "url": "https://github.com/palantir/atlasdb/commit/a8a2938ca3348ed1734a705cad764ee99f2a4180", "message": "Use com.google.errorprone 2.4.0 and org.immutables 2.8.8", "committedDate": "2020-10-19T16:08:44Z", "type": "commit"}, {"oid": "ccf4cba94bfc7825506a3e184f4401e898258184", "url": "https://github.com/palantir/atlasdb/commit/ccf4cba94bfc7825506a3e184f4401e898258184", "message": "Apply error-prone automated refactorings", "committedDate": "2020-10-19T16:08:44Z", "type": "commit"}, {"oid": "c84902feecf118529012f4a8d9b00a6659f324b1", "url": "https://github.com/palantir/atlasdb/commit/c84902feecf118529012f4a8d9b00a6659f324b1", "message": "Temporarily relax error-prone constraints until we can fix all violations", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "5a79e245d7f9c0ed80f3af484e5b2d024b7fa16c", "url": "https://github.com/palantir/atlasdb/commit/5a79e245d7f9c0ed80f3af484e5b2d024b7fa16c", "message": "Use method reference to workaround error-prone compilation failure\n\n/Volumes/git/palantir/atlasdb/atlasdb-tests-shared/src/test/java/com/palantir/atlasdb/transaction/impl/SnapshotTransactionTest.java:1378: error: An unhandled exception was thrown by the Error Prone static analysis plugin.\n        assertThatExceptionOfType(TransactionLockTimeoutException.class).isThrownBy(() -> transaction.commit());\n                                                                                    ^\n     Please report this at https://github.com/google/error-prone/issues/new and include the following:\n\n     error-prone version: 2.4.0\n     BugPattern: LambdaMethodReference\n     Stack Trace:\n     java.lang.NullPointerException\n        at com.google.errorprone.fixes.SuggestedFixes.compilesWithFix(SuggestedFixes.java:1214)\n        at com.google.errorprone.fixes.SuggestedFixes.compilesWithFix(SuggestedFixes.java:1100)\n        at com.google.errorprone.fixes.SuggestedFixes.compilesWithFix(SuggestedFixes.java:1082)\n        at com.palantir.baseline.errorprone.LambdaMethodReference.lambda$convertMethodInvocations$1(LambdaMethodReference.java:170)", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "70e4d102be2104e628dff663b7922cbd4025aa15", "url": "https://github.com/palantir/atlasdb/commit/70e4d102be2104e628dff663b7922cbd4025aa15", "message": "Add generated changelog entries", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "f51a1e16ca368b349423665ebd5e7f6aad486ee2", "url": "https://github.com/palantir/atlasdb/commit/f51a1e16ca368b349423665ebd5e7f6aad486ee2", "message": "Unpin checkstyle version", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "6df76a1caaf7ccec5d89caf8b2b85f17bb76aec1", "url": "https://github.com/palantir/atlasdb/commit/6df76a1caaf7ccec5d89caf8b2b85f17bb76aec1", "message": "Rely on gradle-baseline IntelliJ Idea defaults\n\nRemove IntelliJ Idea overrides", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "7095dc440d70005a250a6d4a75ab396816d28dc8", "url": "https://github.com/palantir/atlasdb/commit/7095dc440d70005a250a6d4a75ab396816d28dc8", "message": "Suppress some checkstyle rules until they can be remediated\n\nFix up minor checkstyle violations", "committedDate": "2020-10-19T16:08:49Z", "type": "commit"}, {"oid": "a5c70cca662ce45f233fcb2ac100d03a80e2ae18", "url": "https://github.com/palantir/atlasdb/commit/a5c70cca662ce45f233fcb2ac100d03a80e2ae18", "message": "Upgrade to gradle 6.7", "committedDate": "2020-10-19T16:08:59Z", "type": "commit"}, {"oid": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "url": "https://github.com/palantir/atlasdb/commit/84fc524ef2d555cadf7ef92a7051bbe247a6db90", "message": "Standardize baseline configuration in build.gradle", "committedDate": "2020-10-19T16:08:59Z", "type": "commit"}, {"oid": "84fc524ef2d555cadf7ef92a7051bbe247a6db90", "url": "https://github.com/palantir/atlasdb/commit/84fc524ef2d555cadf7ef92a7051bbe247a6db90", "message": "Standardize baseline configuration in build.gradle", "committedDate": "2020-10-19T16:08:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3OTcxMw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507879713", "bodyText": "nice", "author": "carterkozak", "createdAt": "2020-10-19T16:14:16Z", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/keyvalue/impl/TableSplittingKeyValueService.java", "diffHunk": "@@ -377,8 +378,7 @@ public void compactInternally(TableReference tableRef, boolean inMaintenanceMode\n     public ClusterAvailabilityStatus getClusterAvailabilityStatus() {\n         return delegates.stream()\n                 .map(kvs -> kvs.getClusterAvailabilityStatus())\n-                .sorted()\n-                .findFirst()\n+                .min(Comparator.naturalOrder())", "originalCommit": "ccf4cba94bfc7825506a3e184f4401e898258184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkwNjM5Mw==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r507906393", "bodyText": "This was an automated gradle-baseline refactor", "author": "schlosna", "createdAt": "2020-10-19T16:55:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg3OTcxMw=="}], "type": "inlineReview"}, {"oid": "37e7ab5569cd946cf7abcdde6aa4e85302924e99", "url": "https://github.com/palantir/atlasdb/commit/37e7ab5569cd946cf7abcdde6aa4e85302924e99", "message": "Remove changelog", "committedDate": "2020-10-19T16:58:19Z", "type": "commit"}, {"oid": "ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "url": "https://github.com/palantir/atlasdb/commit/ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "message": "Update error-prone configuration (#5048)\n\n* Update error-prone configuration\n\n* Fix PreferCollectionConstructors\n\n```\n./gradlew compileJava compileTestJava -PerrorProneApply=PreferCollectionConstructors\n./gradlew format\n```\n\n* Fix BracesRequired\n\n`./gradlew compileJava compileTestJava -PerrorProneApply=BracesRequired && ./gradlew format`\n\n* Fix LoggerEnclosingClass\n\n`./gradlew compileJava compileTestJava -PerrorProneApply=LoggerEnclosingClass && ./gradlew format`\n\n* Fix Slf4jLevelCheck\n\n```\n./gradlew compileJava compileTestJava -PerrorProneApply=Slf4jLevelCheck && ./gradlew format\n```\n\n* Fix ExecutorSubmitRunnableFutureIgnored\n\n* Fix RedundantModifier\n\n* Fix MissingOverride\n\n* Fix LambdaMethodReference\n\n* Fix FinalClass\n\n* silence StrictUnusedVariable to avoid losing other signal\n\n* Fix PreferStaticLoggers\n\n* Fix UnnecessaryLambdaArgumentParentheses\n\n* Fix BadImport\n\n* Fix UnnecessaryParentheses\n\n* remove unnecessary comments\n\n* Disable JdkObsolete for now to reduce compilation spam\n\n* More FinalClass fixes\n\n* More MissingOverride\n\n* Fix Incomparable\n\n* Fix CollectionStreamForEach\n\n* Fix StreamOfEmpty\n\n* More LambdaMethodReference\n\n* More BadImport\n\n* More ClassCanBeStatic\n\n* Suppress PreferStaticLoggers in ProfilingTimelockServiceTest\n\n* Suppress static/final class on MaxTimestampsToGiveTimestampService\n\nRequired for mockito spies\n\n* Suppress PreferStaticLoggers in TimestampAllocationFailuresTest\n\n* format\n\nCo-authored-by: Carter Kozak <ckozak@palantir.com>", "committedDate": "2020-10-19T22:02:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1MDEyMQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r508350121", "bodyText": "Is this OK? Lines 114-115 suggests that (authorized) should be indicated on both lines", "author": "jeremyk-91", "createdAt": "2020-10-20T09:29:18Z", "path": "atlasdb-console/src/main/groovy/com/palantir/atlasdb/console/AtlasConsoleBinder.java", "diffHunk": "@@ -99,7 +99,8 @@ public Object call() {\n             System.out.println(\"\\nTopics with help messages:\\n\"); // (authorized)\n             System.out.println(help.keySet().toString()); // (authorized)\n             System.out.println(\"\\nCall help(\\'topic\\') to view information on a specific topic.\\n\"); // (authorized)\n-            System.out.println(\"If you'd like to enable database mutations (not recommended), re-run console with the 'mutations_enabled' flag\\n\"); // (authorized)\n+            System.out.println(\"If you'd like to enable database mutations (not recommended), re-run console with the\"\n+                    + \" 'mutations_enabled' flag\\n\"); // (authorized)", "originalCommit": "ab3a67e66edfc230b0edc8a512a34b052ab7c89c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1OTEwMQ==", "url": "https://github.com/palantir/atlasdb/pull/5044#discussion_r508359101", "bodyText": "Had a look internally - this is probably OK (see e.g. the large internal product's class that inspects atlas's lock service)", "author": "jeremyk-91", "createdAt": "2020-10-20T09:42:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODM1MDEyMQ=="}], "type": "inlineReview"}, {"oid": "e5dabf951b6be2500290651563172f69eff1c5a3", "url": "https://github.com/palantir/atlasdb/commit/e5dabf951b6be2500290651563172f69eff1c5a3", "message": "Merge branch 'develop' into ds/format", "committedDate": "2020-10-20T11:30:35Z", "type": "commit"}, {"oid": "07f875c24519141932db640c264dd51d718f5de9", "url": "https://github.com/palantir/atlasdb/commit/07f875c24519141932db640c264dd51d718f5de9", "message": "Fixup merge formatting", "committedDate": "2020-10-20T11:47:48Z", "type": "commit"}]}