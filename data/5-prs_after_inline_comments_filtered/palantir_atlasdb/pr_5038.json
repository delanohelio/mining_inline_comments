{"pr_number": 5038, "pr_title": "make oracle protocol case insensitive", "pr_createdAt": "2020-10-15T22:46:13Z", "pr_url": "https://github.com/palantir/atlasdb/pull/5038", "timeline": [{"oid": "6f91d3bc36286d4ffc95265678b6a1dab1beedda", "url": "https://github.com/palantir/atlasdb/commit/6f91d3bc36286d4ffc95265678b6a1dab1beedda", "message": "make oracle protocol case insensitive\n\nMakes the protocol (tcp/tcps) case insensitive in oracle configs.\nPreviously oracle connection configs required the protocol to be\nupper-case.", "committedDate": "2020-10-15T22:41:49Z", "type": "commit"}, {"oid": "cc98fef8a6184283972f5a807c38610f6b842432", "url": "https://github.com/palantir/atlasdb/commit/cc98fef8a6184283972f5a807c38610f6b842432", "message": "Add generated changelog entries", "committedDate": "2020-10-15T22:41:49Z", "type": "commit"}, {"oid": "fe5bc6d5ce0bf2ac0c270663430886325298b607", "url": "https://github.com/palantir/atlasdb/commit/fe5bc6d5ce0bf2ac0c270663430886325298b607", "message": "simplify changelog", "committedDate": "2020-10-15T22:47:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg0OTg4OA==", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507849888", "bodyText": "While I agree that equalsIgnoreCase is better than what we were doing before, it should be semantically the same - and indeed, reverting this change resulted in the tests passing.\nI think the fix here is actually @JsonCreator if I am not mistaken - before, it was trying to map directly to one of the enums, whereas now it actually goes through this method - is that right?", "author": "Jolyon-S", "createdAt": "2020-10-19T15:34:14Z", "path": "atlasdb-dbkvs-hikari/src/main/java/com/palantir/nexus/db/pool/config/ConnectionProtocol.java", "diffHunk": "@@ -28,9 +30,10 @@ public String getUrlString() {\n         return urlStr;\n     }\n \n+    @JsonCreator\n     public static ConnectionProtocol fromUrlString(String val) {\n         for (ConnectionProtocol cp : ConnectionProtocol.values()) {\n-            if (cp.getUrlString().toLowerCase().equals(val.toLowerCase())) {\n+            if (cp.getUrlString().equalsIgnoreCase(val)) {", "originalCommit": "fe5bc6d5ce0bf2ac0c270663430886325298b607", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg5ODg3NQ==", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507898875", "bodyText": "yes, this is just a slight optimization, as well as making the code more readable", "author": "berler", "createdAt": "2020-10-19T16:43:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg0OTg4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxMjA5Mw==", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507912093", "bodyText": "it also avoids an extra string allocation for the case that val is not already lowercase", "author": "berler", "createdAt": "2020-10-19T17:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg0OTg4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg1MTY5MA==", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507851690", "bodyText": "Would you mind writing a test that verifies that this does throw if an invalid protocol is passed?", "author": "Jolyon-S", "createdAt": "2020-10-19T15:36:35Z", "path": "atlasdb-dbkvs-hikari/src/test/java/com/palantir/nexus/db/pool/config/OracleConnectionConfigTest.java", "diffHunk": "@@ -163,4 +166,23 @@ public void tcpsSetsTrustStore() throws IOException {\n                 .port(PORT);\n     }\n \n+    @Test\n+    public void protocolCaseInsensitiveTest() throws IOException {", "originalCommit": "fe5bc6d5ce0bf2ac0c270663430886325298b607", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkxMDM1Nw==", "url": "https://github.com/palantir/atlasdb/pull/5038#discussion_r507910357", "bodyText": "Done.", "author": "berler", "createdAt": "2020-10-19T17:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzg1MTY5MA=="}], "type": "inlineReview"}, {"oid": "4a77ca4b025bbc1e9f77ca5c2c6667e9e54af9fd", "url": "https://github.com/palantir/atlasdb/commit/4a77ca4b025bbc1e9f77ca5c2c6667e9e54af9fd", "message": "add test case for ConnectionProtocol", "committedDate": "2020-10-19T17:00:30Z", "type": "commit"}]}