{"pr_number": 4499, "pr_title": "[Timelock Partitioning] Part 44g: Use client scoped metrics registries.", "pr_createdAt": "2020-01-10T10:58:16Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4499", "timeline": [{"oid": "70bd3a63664ec2434304df8169210939e8615ee9", "url": "https://github.com/palantir/atlasdb/commit/70bd3a63664ec2434304df8169210939e8615ee9", "message": "Use client scoped metrics registries.", "committedDate": "2020-01-10T10:51:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgxMTQ3OQ==", "url": "https://github.com/palantir/atlasdb/pull/4499#discussion_r365811479", "bodyText": "This thing feels weird, discussed offline.", "author": "jkozlowski", "createdAt": "2020-01-13T13:47:02Z", "path": "timelock-agent/src/main/java/com/palantir/atlasdb/timelock/paxos/TimelockLeadershipMetrics.java", "diffHunk": "@@ -112,14 +96,11 @@ public static AutobatchingLeadershipObserverFactory createFactory(TimelockPaxosM\n \n     private static Consumer<SetMultimap<LeadershipEvent, Client>> deregisterMetricsForPartitionedLeader(\n             TimelockPaxosMetrics metrics) {\n-        return eventsToDeregister -> {\n-            Map<LeadershipEvent, Set<String>> eventsToClients = Multimaps.asMap(KeyedStream.stream(eventsToDeregister)\n-                    .map(Client::value)\n-                    .collectToSetMultimap());\n-            eventsToClients.forEach((event, clients) -> metrics.asMetricsManager().deregisterTaggedMetrics(\n-                    withTagIsCurrentSuspectedLeader(event.isCurrentSuspectedLeader())\n-                            .and(withClientTag(clients))));\n-        };\n+        return eventsToDeregister ->", "originalCommit": "70bd3a63664ec2434304df8169210939e8615ee9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}