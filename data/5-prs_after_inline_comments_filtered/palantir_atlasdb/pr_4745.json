{"pr_number": 4745, "pr_title": "Log an error if it takes >10 seconds to close executors when shutting down STM", "pr_createdAt": "2020-04-30T14:50:35Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4745", "timeline": [{"oid": "6cd20e49574e4ccff89387e04554cb6433d24bc6", "url": "https://github.com/palantir/atlasdb/commit/6cd20e49574e4ccff89387e04554cb6433d24bc6", "message": "log on slow close", "committedDate": "2020-04-30T14:41:04Z", "type": "commit"}, {"oid": "8317911333bed15a50a512b305ca2dd2b65ff0a9", "url": "https://github.com/palantir/atlasdb/commit/8317911333bed15a50a512b305ca2dd2b65ff0a9", "message": "Add generated changelog entries", "committedDate": "2020-04-30T14:41:04Z", "type": "commit"}, {"oid": "1ab6be4da8186d586da822558d0a9ed2c9a7d327", "url": "https://github.com/palantir/atlasdb/commit/1ab6be4da8186d586da822558d0a9ed2c9a7d327", "message": "Add generated changelog entries", "committedDate": "2020-04-30T14:41:04Z", "type": "commit"}, {"oid": "cf525c29dc0739f8ed4018e1b286dca50d020eed", "url": "https://github.com/palantir/atlasdb/commit/cf525c29dc0739f8ed4018e1b286dca50d020eed", "message": "add test", "committedDate": "2020-04-30T14:51:48Z", "type": "commit"}, {"oid": "f4fb9257a483a96e3640e99ec4dbb15ca8bd01da", "url": "https://github.com/palantir/atlasdb/commit/f4fb9257a483a96e3640e99ec4dbb15ca8bd01da", "message": "Fix whitespace around if", "committedDate": "2020-05-01T08:31:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQzNDg5NQ==", "url": "https://github.com/palantir/atlasdb/pull/4745#discussion_r419434895", "bodyText": "nit: Could we rename this executor service to deleteExecutor (if that's what it's used for)?", "author": "jeremyk-91", "createdAt": "2020-05-04T13:27:51Z", "path": "atlasdb-impl-shared/src/test/java/com/palantir/atlasdb/transaction/impl/SnapshotTransactionManagerTest.java", "diffHunk": "@@ -118,6 +118,12 @@ public void closesCloseableLockServiceOnClosingTransactionManager() throws IOExc\n         verify(closeableLockService, times(1)).close();\n     }\n \n+    @Test\n+    public void closesDeleteExecutorOnClosingTransactionManager() {\n+        snapshotTransactionManager.close();\n+        assertThat(executorService.isTerminated()).isTrue();", "originalCommit": "f4fb9257a483a96e3640e99ec4dbb15ca8bd01da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MDU3Mg==", "url": "https://github.com/palantir/atlasdb/pull/4745#discussion_r419460572", "bodyText": "non-actionable: Your concern is valid, I'm not really sure what I would do if I saw this. Though it could be useful in identifying what might have happened in the context of a broader investigation.", "author": "jeremyk-91", "createdAt": "2020-05-04T14:03:47Z", "path": "atlasdb-impl-shared/src/main/java/com/palantir/atlasdb/transaction/impl/SnapshotTransactionManager.java", "diffHunk": "@@ -353,7 +353,9 @@ public void close() {\n     private static void shutdownExecutor(ExecutorService executor) {\n         executor.shutdown();\n         try {\n-            executor.awaitTermination(10, TimeUnit.SECONDS);\n+            if (!executor.awaitTermination(10, TimeUnit.SECONDS)) {\n+                log.error(\"Failed to shutdown the executor after 10 seconds.\");\n+            }", "originalCommit": "f4fb9257a483a96e3640e99ec4dbb15ca8bd01da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTk0MzE5Mw==", "url": "https://github.com/palantir/atlasdb/pull/4745#discussion_r419943193", "bodyText": "That's the purpose - main aim here is just to help narrow down thread leaks or executor services failing to close.", "author": "Jolyon-S", "createdAt": "2020-05-05T08:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTQ2MDU3Mg=="}], "type": "inlineReview"}, {"oid": "aaf6428b40c4dc2c0b9edd899edc4b7e5148ba40", "url": "https://github.com/palantir/atlasdb/commit/aaf6428b40c4dc2c0b9edd899edc4b7e5148ba40", "message": "Rename executorService to deleteExecutor", "committedDate": "2020-05-05T08:28:28Z", "type": "commit"}]}