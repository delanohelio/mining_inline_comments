{"pr_number": 4737, "pr_title": "[PaxosLog] Expose batch write method", "pr_createdAt": "2020-04-27T14:35:39Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4737", "timeline": [{"oid": "93c165dda003aedd212a3e6fbc6e26e075dbea87", "url": "https://github.com/palantir/atlasdb/commit/93c165dda003aedd212a3e6fbc6e26e075dbea87", "message": "Use JDBI", "committedDate": "2020-04-22T15:53:59Z", "type": "commit"}, {"oid": "2dadde4e2d42e9f5c256e783ab06b2a4fd3407b4", "url": "https://github.com/palantir/atlasdb/commit/2dadde4e2d42e9f5c256e783ab06b2a4fd3407b4", "message": "Package private", "committedDate": "2020-04-22T15:59:19Z", "type": "commit"}, {"oid": "521a3eec0ba99a626c2e899e44336d60e07234cb", "url": "https://github.com/palantir/atlasdb/commit/521a3eec0ba99a626c2e899e44336d60e07234cb", "message": "Prevent test connection from closing so we don't need to have funky factory in production code", "committedDate": "2020-04-23T11:28:13Z", "type": "commit"}, {"oid": "df3cfc6a11b38b3be2ec40c3705953d497038728", "url": "https://github.com/palantir/atlasdb/commit/df3cfc6a11b38b3be2ec40c3705953d497038728", "message": "Add batching support", "committedDate": "2020-04-23T12:55:39Z", "type": "commit"}, {"oid": "b88059c5da41ac7d6d1f7657e564786298ca8c80", "url": "https://github.com/palantir/atlasdb/commit/b88059c5da41ac7d6d1f7657e564786298ca8c80", "message": "Address CR", "committedDate": "2020-04-23T15:35:59Z", "type": "commit"}, {"oid": "7bcb706435d6b1e0dd85495103a6a2a824681d0c", "url": "https://github.com/palantir/atlasdb/commit/7bcb706435d6b1e0dd85495103a6a2a824681d0c", "message": "Merge branch 'psl/jdbi' of github.com:palantir/atlasdb into psl/batch-write", "committedDate": "2020-04-23T15:36:52Z", "type": "commit"}, {"oid": "635cf6eab4d55d3f4a4bfc33d1cc35686e1560df", "url": "https://github.com/palantir/atlasdb/commit/635cf6eab4d55d3f4a4bfc33d1cc35686e1560df", "message": "Fix merge conflicts", "committedDate": "2020-04-27T14:07:02Z", "type": "commit"}, {"oid": "bba27db26f00241b1714126bb42a190768c94e53", "url": "https://github.com/palantir/atlasdb/commit/bba27db26f00241b1714126bb42a190768c94e53", "message": "Oops", "committedDate": "2020-04-27T14:30:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk2OTk4Mw==", "url": "https://github.com/palantir/atlasdb/pull/4737#discussion_r415969983", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                default void writeBatchOfRounds(Iterable<PaxosRound<V>> rounds) {\n          \n          \n            \n                /**\n          \n          \n            \n                 * Implementations of this method MUST obey the following:\n          \n          \n            \n                 * 1) The end state of the log should be equivalent to applying the operations in \n          \n          \n            \n                 *    iteration order.\n          \n          \n            \n                 * 2) Implementations need not be atomic. However, if they fail, they should apply only\n          \n          \n            \n                 *    prefixes of the input iterable.\n          \n          \n            \n                 */\n          \n          \n            \n                default void writeBatchOfRounds(Iterable<PaxosRound<V>> rounds) {", "author": "jeremyk-91", "createdAt": "2020-04-27T16:37:48Z", "path": "leader-election-api/src/main/java/com/palantir/paxos/PaxosStateLog.java", "diffHunk": "@@ -33,6 +33,10 @@\n      */\n     void writeRound(long seq, V round);\n \n+    default void writeBatchOfRounds(Iterable<PaxosRound<V>> rounds) {", "originalCommit": "bba27db26f00241b1714126bb42a190768c94e53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTk3MTk1Mw==", "url": "https://github.com/palantir/atlasdb/pull/4737#discussion_r415971953", "bodyText": "Discussed why this must be boolean[] offline: required because of the signature of execute()", "author": "jeremyk-91", "createdAt": "2020-04-27T16:40:26Z", "path": "leader-election-impl/src/main/java/com/palantir/paxos/SqlitePaxosStateLog.java", "diffHunk": "@@ -100,5 +109,9 @@ public void truncate(long toDeleteInclusive) {\n \n         @SqlUpdate(\"DELETE FROM <table> WHERE seq <= :seq\")\n         boolean truncate(@Define(\"table\") String table, @Bind(\"seq\") long seq);\n+\n+        @SqlBatch(\"INSERT OR REPLACE INTO <table> (seq, val) VALUES (:round.sequence, :round.valueBytes)\")\n+        <V extends Persistable & Versionable> boolean[] writeBatchOfRounds(@Define(\"table\") String table,", "originalCommit": "bba27db26f00241b1714126bb42a190768c94e53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "645d2e849096aa4ea98f1997d1baa11de01e1bae", "url": "https://github.com/palantir/atlasdb/commit/645d2e849096aa4ea98f1997d1baa11de01e1bae", "message": "Update leader-election-api/src/main/java/com/palantir/paxos/PaxosStateLog.java\n\nCo-Authored-By: Jeremy Kong <jeremykong@hotmail.com>", "committedDate": "2020-04-28T09:49:25Z", "type": "commit"}, {"oid": "c0d3b7f78f73ed7e0efac99fcca85ec0eaadc2e6", "url": "https://github.com/palantir/atlasdb/commit/c0d3b7f78f73ed7e0efac99fcca85ec0eaadc2e6", "message": "Checkstyle is a joke", "committedDate": "2020-04-28T10:13:44Z", "type": "commit"}]}