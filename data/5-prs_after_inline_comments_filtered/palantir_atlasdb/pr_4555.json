{"pr_number": 4555, "pr_title": "[PDS-110262] Meter for Cassandra pool exhaustion events", "pr_createdAt": "2020-02-06T16:21:08Z", "pr_url": "https://github.com/palantir/atlasdb/pull/4555", "timeline": [{"oid": "976208e9b713f7e7724ec87e77a4ec2eee6a7caf", "url": "https://github.com/palantir/atlasdb/commit/976208e9b713f7e7724ec87e77a4ec2eee6a7caf", "message": "[pds-110262] Cassandra meter for pool exhaustion events", "committedDate": "2020-02-06T14:43:19Z", "type": "commit"}, {"oid": "88b13ff172c3db47d6f1bd1eebb6a992d3df624c", "url": "https://github.com/palantir/atlasdb/commit/88b13ff172c3db47d6f1bd1eebb6a992d3df624c", "message": "Fix compile silliness", "committedDate": "2020-02-06T16:06:49Z", "type": "commit"}, {"oid": "15e13edff8d575e30d524bb0619620f21c2009aa", "url": "https://github.com/palantir/atlasdb/commit/15e13edff8d575e30d524bb0619620f21c2009aa", "message": "Checkstyle", "committedDate": "2020-02-06T16:17:00Z", "type": "commit"}, {"oid": "20afefd305c7c1e1fc187260ce155756b730cc71", "url": "https://github.com/palantir/atlasdb/commit/20afefd305c7c1e1fc187260ce155756b730cc71", "message": "Add generated changelog entries", "committedDate": "2020-02-06T16:17:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5MDEzMw==", "url": "https://github.com/palantir/atlasdb/pull/4555#discussion_r376290133", "bodyText": "Just a Counter should suffice? We can calculate everything else ourselves", "author": "jkozlowski", "createdAt": "2020-02-07T09:24:28Z", "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/pool/CassandraClientPoolMetrics.java", "diffHunk": "@@ -28,12 +28,18 @@\n \n public class CassandraClientPoolMetrics {\n     private final MetricsManager metricsManager;\n-    private final RequestMetrics aggregateMetrics;\n+    private final RequestMetrics aggregateRequestMetrics;\n     private final Map<InetSocketAddress, RequestMetrics> metricsByHost = new HashMap<>();\n \n+    // Tracks occurrences of client pool exhaustions.\n+    // Not bundled in with request metrics, as we seek to not produce host-level metrics for economic reasons.\n+    private final Meter poolExhaustionMeter;", "originalCommit": "20afefd305c7c1e1fc187260ce155756b730cc71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwMTMxOQ==", "url": "https://github.com/palantir/atlasdb/pull/4555#discussion_r376301319", "bodyText": "Yep, that's right - will change.", "author": "jeremyk-91", "createdAt": "2020-02-07T09:48:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5MDEzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5MDM3Mg==", "url": "https://github.com/palantir/atlasdb/pull/4555#discussion_r376290372", "bodyText": "Do we need to pass the CassandraClientPoolingContainer if it's unused?", "author": "jkozlowski", "createdAt": "2020-02-07T09:25:00Z", "path": "atlasdb-cassandra/src/main/java/com/palantir/atlasdb/keyvalue/cassandra/pool/CassandraClientPoolMetrics.java", "diffHunk": "@@ -61,10 +67,14 @@ public void recordConnectionExceptionOnHost(CassandraClientPoolingContainer host\n         updateMetricOnAggregateAndHost(hostPool, RequestMetrics::markRequestConnectionException);\n     }\n \n+    public void recordPoolExhaustion(CassandraClientPoolingContainer unused) {", "originalCommit": "20afefd305c7c1e1fc187260ce155756b730cc71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjMwNTI2NQ==", "url": "https://github.com/palantir/atlasdb/pull/4555#discussion_r376305265", "bodyText": "I did this more for consistency with the existing methods. Though yeah it might be worth not passing it to not give people the impression that it would be reported", "author": "jeremyk-91", "createdAt": "2020-02-07T09:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI5MDM3Mg=="}], "type": "inlineReview"}, {"oid": "f6fce3351e4e5be3ba491f315b29b61970781c25", "url": "https://github.com/palantir/atlasdb/commit/f6fce3351e4e5be3ba491f315b29b61970781c25", "message": "CR code level changes", "committedDate": "2020-02-07T09:59:44Z", "type": "commit"}, {"oid": "15750fe13f675c837c79bf95a9e16f15f469d434", "url": "https://github.com/palantir/atlasdb/commit/15750fe13f675c837c79bf95a9e16f15f469d434", "message": "Add generated changelog entries", "committedDate": "2020-02-07T09:59:44Z", "type": "commit"}, {"oid": "053d369e5f27aa6bd419208d4635c23adecd76f5", "url": "https://github.com/palantir/atlasdb/commit/053d369e5f27aa6bd419208d4635c23adecd76f5", "message": "Add generated changelog entries", "committedDate": "2020-02-07T09:59:44Z", "type": "commit"}]}