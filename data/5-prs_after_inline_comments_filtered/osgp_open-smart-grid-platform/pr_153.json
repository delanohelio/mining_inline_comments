{"pr_number": 153, "pr_title": "FLEX-5239 ~ Upgrade to Cucumber 5", "pr_createdAt": "2020-01-27T17:51:27Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/153", "timeline": [{"oid": "4ff24975d8300ec66ee178dccdf675d619a8fd10", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/4ff24975d8300ec66ee178dccdf675d619a8fd10", "message": "FLEX-5239 ~ Starts OSGP upgrade to Cucumber 5\n\nRefactors packages of Cucumber classes to the newer API. The core part\nis considered internal and to be used through the java and junit\nprojects.\n\nAdd strict equals true to the AcceptanceTests classes as the non-strict\nmode is deprecated, and will be removed in a future version. This\nprevents warnings in the output logs.\n\nUpdates settings handling in the steps, to get rid of issues because of\nempty cells defaulting to null instead of the empty string as before.\n\nUpdates step method annotations where the step definition text with the\nstep methods is not wrapped between \"^\" and \"$\" and the step has\nparameters. These are now considered Cucumber expressions instead of\nregular expressions. For Cucumber expressions a different syntax is\nneeded to match the arguments.\n\nUpdates the Configurer to no longer implement TypeRegistryConfigurer.\nThe configurers registers some default step data transformers without\nimplementing an interface of which only one implementation is allowed on\nthe glue path. This should offer flexibility in adding custom\ntransformer functionality with other step classes as needed, without\nhaving to configure this in a single class.\n\nAdds the junit-vintage-engine to the POMs of projects with Cucumber\ntests. The current setup of Cucumber depends on JUnit 4.\n\nUncommented and at-skipped a feature in\nTariffSwitchingResponseDataCleanupJob.feature in\ncucumber-tests-platform-publiclighting. A feature file without any\ncontents leads to errors when running the Cucumber tests.", "committedDate": "2020-01-27T17:50:24Z", "type": "commit"}, {"oid": "5bdb9a3ce4fdea1b68bdcabcb09658f77c4b46cf", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/5bdb9a3ce4fdea1b68bdcabcb09658f77c4b46cf", "message": "FLEX-5239 ~ Fixes Cucumber expression steps smart metering\n\nFixes some steps that are Cucumber expressions instead of regular\nexpressions in the smart metering SimulatedConfigurationObjectSteps.\n\nBumps the Cucumber version to the latest release (5.1.2).", "committedDate": "2020-01-28T09:29:00Z", "type": "commit"}, {"oid": "6042c45227f3006cf3a7af9d79bb6f22c6ae9823", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/6042c45227f3006cf3a7af9d79bb6f22c6ae9823", "message": "FLEX-5239 ~ Replaces regex by Cucumber expression", "committedDate": "2020-01-29T07:06:00Z", "type": "commit"}, {"oid": "abcf4d61311ea5108c482524812ed0cde32ef624", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/abcf4d61311ea5108c482524812ed0cde32ef624", "message": "FLEX-5239 ~ Updates triggering the Cucumber tests\n\nCucumber test execution using command line argument cucumber.options has\nbeen deprecated. These changes should make sure the old options that\nwere used are replaced by cucumber.execution.strict and\ncucumber.filter.tags.\n\nFor cucumber.filter.tags, the parsing of tags from the pull request\ndescription, used to restrict the subset of the tests to be executed, is\nupdated, to no longer result in multiple --tag sections, but instead to\nmake an expression using and and or.", "committedDate": "2020-01-30T13:00:01Z", "type": "commit"}, {"oid": "865a7bc04bc045ec23323a89c4837c2c01f716a9", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/865a7bc04bc045ec23323a89c4837c2c01f716a9", "message": "FLEX-5239 ~ Fixes missing escaped backslash in pipeline shell script", "committedDate": "2020-01-30T13:20:37Z", "type": "commit"}, {"oid": "39f28124b47090b0b4e1f23ac8ed9c5cb3d162eb", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/39f28124b47090b0b4e1f23ac8ed9c5cb3d162eb", "message": "Merges branch 'development' into feature/FLEX-5239-upgrade-to-cucumber-5", "committedDate": "2020-02-03T13:50:26Z", "type": "commit"}, {"oid": "228d61324b4066eafd9d1323d9cec4e07c67010f", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/228d61324b4066eafd9d1323d9cec4e07c67010f", "message": "FLEX-5239 ~ Fixes OSLP Configuration scenario\n\nThe OSLP mock server used to be configured with null for the interval\ntype when the matching cell in the step data was empty.\nThis change makes sure the default interval type is only used if there\nis no step data, and null is used if there is empty interval type step\ndata.", "committedDate": "2020-02-03T13:54:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE1MjA0MA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375152040", "bodyText": "The original regex matches a string enclosed in double-quotes. The new Cucumber expression does not take into account the double-quotes. The feature file contains:\nAnd the platform buffers a stop device response message for device \"TEST1024000000001\"\nShould the Cucumber expression be changed?", "author": "kevinsmeets", "createdAt": "2020-02-05T09:46:26Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/StopDeviceSteps.java", "diffHunk": "@@ -76,7 +76,7 @@ public void theStopDeviceResponseContainsSoapFault(final Map<String, String> exp\n         GenericResponseSteps.verifySoapFault(expectedResult);\n     }\n \n-    @Then(\"the platform buffers a stop device response message for device \\\"([^\\\"]*)\\\"\")\n+    @Then(\"the platform buffers a stop device response message for device {string}\")", "originalCommit": "228d61324b4066eafd9d1323d9cec4e07c67010f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4OTcxMg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375189712", "bodyText": "The replaced text was a regex match for the device identification.\nSince the string did not start with ^/end with $ the test is treated as a Cucumber Expression.\nI chose to replace the regex with the Cucumber expression alternative {string} since it looks simpler and does the same thing.", "author": "bvdzwet", "createdAt": "2020-02-05T11:00:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE1MjA0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4MTk0Mg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375181942", "bodyText": "Any matcher for Boolean argument looks like the best alternative, OK.", "author": "kevinsmeets", "createdAt": "2020-02-05T10:44:01Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/basicosgpfunctions/AuthorizeDeviceFunctionsSteps.java", "diffHunk": "@@ -152,7 +152,7 @@ public void receivingADeviceFunctionRequest(final Map<String, String> requestPar\n         }\n     }\n \n-    @Then(\"the device function response is \\\"([^\\\"]*)\\\"\")\n+    @Then(\"the device function response is \\\"{}\\\"\")", "originalCommit": "228d61324b4066eafd9d1323d9cec4e07c67010f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4MzA3Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375183077", "bodyText": "The original regex matches a string enclosed in double-quotes. The new Cucumber expression does not take into account the double-quotes. The feature file contains:\nAnd the platform buffers a device installation get status response message for device \"TEST1024000000001\"\nShould the Cucumber expression be changed?", "author": "kevinsmeets", "createdAt": "2020-02-05T10:46:15Z", "path": "integration-tests/cucumber-tests-platform-common/src/test/java/org/opensmartgridplatform/cucumber/platform/common/glue/steps/ws/core/deviceinstallation/GetStatusSteps.java", "diffHunk": "@@ -71,7 +72,7 @@ public void theDeviceInstallationGetStatusAsyncResponseContains(final Map<String\n                         PlatformDefaults.DEFAULT_ORGANIZATION_IDENTIFICATION));\n     }\n \n-    @Then(\"the platform buffers a device installation get status response message for device \\\"([^\\\"]*)\\\"\")\n+    @Then(\"the platform buffers a device installation get status response message for device {string}\")", "originalCommit": "228d61324b4066eafd9d1323d9cec4e07c67010f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE5MDUxMg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375190512", "bodyText": "The Cucumber expression with {string} does take into account the double quotes (or alternatively single quotes).", "author": "bvdzwet", "createdAt": "2020-02-05T11:01:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4MzA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4ODAwMg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375188002", "bodyText": "The original regex matches a string enclosed in double-quotes. The new Cucumber expression does not take into account the double-quotes.\nI can't find any feature files using this step.", "author": "kevinsmeets", "createdAt": "2020-02-05T10:56:39Z", "path": "integration-tests/cucumber-tests-platform/src/test/java/org/opensmartgridplatform/cucumber/platform/glue/steps/database/core/ScheduledTaskSteps.java", "diffHunk": "@@ -44,7 +44,7 @@\n     @Autowired\n     private ScheduledTaskRepository scheduledTaskRepository;\n \n-    @Given(\"a scheduled \\\"([^\\\"]*)\\\" task\")\n+    @Given(\"a scheduled {string} task\")", "originalCommit": "228d61324b4066eafd9d1323d9cec4e07c67010f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTIxMzE0Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/153#discussion_r375213147", "bodyText": "Most changes were based on failing tests, but near the end I did some regex based searching and found one (I think) more potential regex issue, and replaced it.\nI have intentionally been a bit careful about extra changes beside the upgrade, but if you think this had better been removed, I can take it out.\nI looked into it a bit further to investigate if scheduled task tests are implemented elsewhere or missing and I found a place where this step is used from. It is called from FindScheduledTaskSteps givenScheduledTasks, which is behind scenario Find scheduled tasks from FindScheduledTasks.feature.\nI'd propose to leave it as it is, allowing a feature to use given a scheduled task as well as given scheduled tasks.", "author": "bvdzwet", "createdAt": "2020-02-05T11:55:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTE4ODAwMg=="}], "type": "inlineReview"}]}