{"pr_number": 369, "pr_title": "Feature/oc 578 peak shaving cucumber tests mqtt device", "pr_createdAt": "2020-07-09T05:58:21Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/369", "timeline": [{"oid": "8f42789a98358a6430eb409f9e0c3071c485c5f9", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8f42789a98358a6430eb409f9e0c3071c485c5f9", "message": "OC-578: Provides a way to call the mqtt simulator.", "committedDate": "2020-05-22T14:02:51Z", "type": "commit"}, {"oid": "fd5cbf16878b5c09127393df53e0b2c0e615af98", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/fd5cbf16878b5c09127393df53e0b2c0e615af98", "message": "OC-578 ~ Adds MQTT to osgp_core protocol_info\n\nAdds MQTT 3.1.1 as protocol in the OSGP core database.\n\nChanges startup of the MQTT simulator application, not to start an\nembedded servlet container. There should be no need for Tomcat on 8080\nas the simulator functionality is offered through a broker on a separate\nport.", "committedDate": "2020-07-02T16:19:08Z", "type": "commit"}, {"oid": "8924e22515b0f6fa33d8a5d6b0eec28be0e28060", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/8924e22515b0f6fa33d8a5d6b0eec28be0e28060", "message": "Merges branch 'feature/OC-578_enable_mock_server_for_MQTT_simulator' into feature/OC-578-peak-shaving-cucumber-tests-mqtt-device", "committedDate": "2020-07-03T12:27:30Z", "type": "commit"}, {"oid": "829c42c46747452dcab32805203b62184b0201a3", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/829c42c46747452dcab32805203b62184b0201a3", "message": "Merges branch 'development' into feature/OC-578-peak-shaving-cucumber-tests-mqtt-device", "committedDate": "2020-07-03T12:28:18Z", "type": "commit"}, {"oid": "46737bc52088bb29bfb8f5270d00d0325ca3f6c0", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/46737bc52088bb29bfb8f5270d00d0325ca3f6c0", "message": "OC-578 ~ Updates some code towards MQTT peak shaving Cucumber tests\n\nAdds some not yet implemented steps to the peak shaving feature\nscenario.\n\nMoves version number for Cucumber dependency to the MQTT simulator to\nthe integration tests parent POM.\n\nAdds the device identification in the step to send a measurement report\nso it can be used as part of the topic name.\n\nAdds PAYLOAD to PlatformDistributionAutomationKeys.\n\nAdds mqtt.simulator.startClient to the MQTT simulator properties.\n\nRemoves some empty lines from the simulator spec JSON file.\n\nRefactors Broker to get rid of a Sonar issue modifying the static value\nof running from an instance method.\n\nRenames LnaClient to SimulatorSpecPublishingClient.", "committedDate": "2020-07-03T15:34:45Z", "type": "commit"}, {"oid": "cdc2e3cc29e82bd021c76413c87ef4913f321311", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/cdc2e3cc29e82bd021c76413c87ef4913f321311", "message": "OC-578: Stores the mqtt device in the database, triggers the mqtt\nsimulator and listens to the kafka topic.", "committedDate": "2020-07-07T14:29:35Z", "type": "commit"}, {"oid": "227f7f7062bd6b1bc4137ad01d6df0e600a6edd2", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/227f7f7062bd6b1bc4137ad01d6df0e600a6edd2", "message": "OC-578: Changes the scenario.", "committedDate": "2020-07-07T14:30:36Z", "type": "commit"}, {"oid": "aeb1007a9fb2a10e56e892b4bf24358b4a203c83", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/aeb1007a9fb2a10e56e892b4bf24358b4a203c83", "message": "OC-578 ~ Adds default last communication time in the past\n\nEnsures communication restore task is trying to reconnect sooner.", "committedDate": "2020-07-08T14:43:00Z", "type": "commit"}, {"oid": "3ecc8adeaa9cc91be24a897de5deeea4c9487b0c", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/3ecc8adeaa9cc91be24a897de5deeea4c9487b0c", "message": "OC-578 ~ Updates while loop in message check\n\nEnsures while loop is left when a consumer record is set.", "committedDate": "2020-07-08T14:44:20Z", "type": "commit"}, {"oid": "b397a93c3d5529015ce567df3fdff32232b44f7e", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/b397a93c3d5529015ce567df3fdff32232b44f7e", "message": "OC-578 ~ Updates communication monitoring frequency\n\nEnsures task runs every minute.", "committedDate": "2020-07-08T14:46:07Z", "type": "commit"}, {"oid": "0a16ae4ed0c3e4d105c56e36acb0c79e00c7e17e", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0a16ae4ed0c3e4d105c56e36acb0c79e00c7e17e", "message": "OC-578: Adds tags.", "committedDate": "2020-07-09T05:55:26Z", "type": "commit"}, {"oid": "d2a88ba9a0e93b7f8d3e42c7237506b29e9c0aaa", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d2a88ba9a0e93b7f8d3e42c7237506b29e9c0aaa", "message": "OC-578 ~ Attempts to fix MQTT simulator startup", "committedDate": "2020-07-09T07:31:02Z", "type": "commit"}, {"oid": "a556b97442b314545549e6be5669269f60338809", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a556b97442b314545549e6be5669269f60338809", "message": "Merge branch 'feature/OC-578-peak-shaving-cucumber-tests-mqtt-device' of github.com:OSGP/open-smart-grid-platform into feature/OC-578-peak-shaving-cucumber-tests-mqtt-device", "committedDate": "2020-07-09T07:33:06Z", "type": "commit"}, {"oid": "5d61a564ac6b24616b941bf02a642186a3455932", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/5d61a564ac6b24616b941bf02a642186a3455932", "message": "OC-578 ~ Temporarily disables destroying AWS EC2", "committedDate": "2020-07-09T11:04:37Z", "type": "commit"}, {"oid": "a8a473afa7f6f5ff42f309f964d4f31dc4871abd", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/a8a473afa7f6f5ff42f309f964d4f31dc4871abd", "message": "OC-578 ~ Reenables destroying AWS system at end of pipeline", "committedDate": "2020-07-09T14:13:06Z", "type": "commit"}, {"oid": "af755fae76d70e1b79d053b2c0918f448a5d876b", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/af755fae76d70e1b79d053b2c0918f448a5d876b", "message": "OC-578 ~ Fixes alignment in pom", "committedDate": "2020-07-09T14:14:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMwMTg4NA==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369#discussion_r452301884", "bodyText": "2020", "author": "smvdheijden", "createdAt": "2020-07-09T15:26:04Z", "path": "integration-tests/cucumber-tests-platform-distributionautomation/src/test/java/org/opensmartgridplatform/cucumber/platform/distributionautomation/config/AdapterProtocolMqttPersistenceConfig.java", "diffHunk": "@@ -0,0 +1,83 @@\n+/**\n+ * Copyright 2019 Smart Society Services B.V.", "originalCommit": "af755fae76d70e1b79d053b2c0918f448a5d876b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMwNDc1Ng==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/369#discussion_r452304756", "bodyText": "received", "author": "smvdheijden", "createdAt": "2020-07-09T15:30:05Z", "path": "integration-tests/cucumber-tests-platform-distributionautomation/src/test/java/org/opensmartgridplatform/cucumber/platform/distributionautomation/glue/kafka/in/PeakShavingConsumer.java", "diffHunk": "@@ -0,0 +1,47 @@\n+/**\n+ * Copyright 2020 Smart Society Services B.V.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with the License.  You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ */\n+package org.opensmartgridplatform.cucumber.platform.distributionautomation.glue.kafka.in;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import org.apache.kafka.clients.consumer.ConsumerRecord;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.beans.factory.annotation.Value;\n+import org.springframework.kafka.annotation.KafkaListener;\n+import org.springframework.stereotype.Component;\n+\n+@Component\n+public class PeakShavingConsumer {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(PeakShavingConsumer.class);\n+\n+    @Value(\"${peakshaving.kafka.consumer.wait.fail.duration:90000}\")\n+    private long waitFailMillis;\n+\n+    private ConsumerRecord<String, String> consumerRecord;\n+\n+    @KafkaListener(containerFactory = \"peakShavingKafkaListenerContainerFactory\", topics = \"${peakshaving.kafka.topic}\")\n+    public void listen(final ConsumerRecord<String, String> consumerRecord) {\n+        LOGGER.info(\"recevied consumerRecord\");", "originalCommit": "af755fae76d70e1b79d053b2c0918f448a5d876b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be49793508a235d8f08f04c1bcd6fbb7cc2f73a2", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/be49793508a235d8f08f04c1bcd6fbb7cc2f73a2", "message": "OC-578 ~ Fixes year in license header", "committedDate": "2020-07-09T16:20:37Z", "type": "commit"}, {"oid": "580882a6ca7fe8a3ab1e91fce760b1a83c631b93", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/580882a6ca7fe8a3ab1e91fce760b1a83c631b93", "message": "OC-578 ~ Fixes typo in logging", "committedDate": "2020-07-09T16:21:03Z", "type": "commit"}]}