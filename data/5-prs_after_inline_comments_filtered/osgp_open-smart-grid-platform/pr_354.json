{"pr_number": 354, "pr_title": "Make the wildcard functionality consistent inside the operator application", "pr_createdAt": "2020-06-17T12:08:21Z", "pr_url": "https://github.com/OSGP/open-smart-grid-platform/pull/354", "timeline": [{"oid": "c4f6ec1a287c014eba71db0cf410f7d3149c805e", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/c4f6ec1a287c014eba71db0cf410f7d3149c805e", "message": "Replace * and ? for postgres wildcards", "committedDate": "2020-06-16T07:36:12Z", "type": "commit"}, {"oid": "d632bb5e5df17de12a098fa0a3fdfdd820040e65", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d632bb5e5df17de12a098fa0a3fdfdd820040e65", "message": "Escaping % and _ properly", "committedDate": "2020-06-17T11:53:01Z", "type": "commit"}, {"oid": "0be72a7563b5b7850632a84af5bb2199dca8ef82", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/0be72a7563b5b7850632a84af5bb2199dca8ef82", "message": "Correct indentation", "committedDate": "2020-06-17T12:14:21Z", "type": "commit"}, {"oid": "aa452a4714f30183a365742cb16150f77a2a456d", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/aa452a4714f30183a365742cb16150f77a2a456d", "message": "Correct way of indentation", "committedDate": "2020-06-17T12:17:11Z", "type": "commit"}, {"oid": "10bd99f45bff5620eb5937fa1e8d45f9d8af37aa", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/10bd99f45bff5620eb5937fa1e8d45f9d8af37aa", "message": "Correct format. Three times is the charm.", "committedDate": "2020-06-17T12:22:14Z", "type": "commit"}, {"oid": "aac8693da2afbb46c191def904e4b7af90d1205b", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/aac8693da2afbb46c191def904e4b7af90d1205b", "message": "Merge branch 'development' into feature/FLEX-5411-wildcard-functionality-operator-app", "committedDate": "2020-06-18T13:47:30Z", "type": "commit"}, {"oid": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b", "message": "Removed unused import", "committedDate": "2020-06-19T15:17:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM3NjQ4Nw==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r443376487", "bodyText": "A number of criteria, like this one, are not updated correctly yet:\n\ndoes not escape \"_\"\nadds \"%\" at the end. Remove those, because we don't want an implicit wildcard at the end of the string.", "author": "rlemmers", "createdAt": "2020-06-22T07:51:11Z", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -497,32 +500,32 @@ public Organisation findOrganisation(@Identification final String organisationId\n             Specification<Device> specification) throws ArgumentNullOrEmptyException {\n         if (!StringUtils.isEmpty(deviceFilter.getCity())) {\n             specification = specification\n-                    .and(this.deviceSpecifications.hasCity(deviceFilter.getCity().replaceAll(WILDCARD, \"%\") + \"%\"));\n+                    .and(this.deviceSpecifications.hasCity(deviceFilter.getCity().replaceAll(WILDCARD_ALL, \"%\") + \"%\"));", "originalCommit": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5MjAwMQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r443392001", "bodyText": "Put this in a separate utility class for searching. It reduces the complexity of DeviceManagementService and it enables reuse.", "author": "rlemmers", "createdAt": "2020-06-22T08:20:51Z", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -902,4 +905,21 @@ public String enqueueUpdateDeviceCdmaSettingsRequest(final String organisationId\n     public ResponseMessage dequeueUpdateDeviceCdmaSettingsResponse(final String correlationUid) throws OsgpException {\n         return this.commonResponseMessageFinder.findMessage(correlationUid);\n     }\n+\n+    /**\n+     * This method replaces normal wilcards for Postgres wildcards and escapes\n+     * Postgres wildcards that were already present.\n+     * \n+     * @param input\n+     *            String\n+     * @return an output String containing the correct wildcards.\n+     */\n+    private String replaceWildcards(String input) {\n+        return input.replace(ESCAPE, ESCAPE + ESCAPE)\n+                .replace(WILDCARD_ALL_REPLACEMENT, ESCAPE + WILDCARD_ALL_REPLACEMENT)\n+                .replace(WILDCARD_SINGLE_REPLACEMENT, ESCAPE + WILDCARD_SINGLE_REPLACEMENT)\n+                .replace(WILDCARD_ALL, WILDCARD_ALL_REPLACEMENT)\n+                .replace(WILDCARD_SINGLE, WILDCARD_SINGLE_REPLACEMENT)\n+                .toUpperCase();\n+    }", "originalCommit": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM5Mjk1Ng==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r443392956", "bodyText": "Remove the text \"This method\"\nwilcards => wildcards\nfor => by\nPostgres => SQL", "author": "rlemmers", "createdAt": "2020-06-22T08:22:36Z", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -902,4 +905,21 @@ public String enqueueUpdateDeviceCdmaSettingsRequest(final String organisationId\n     public ResponseMessage dequeueUpdateDeviceCdmaSettingsResponse(final String correlationUid) throws OsgpException {\n         return this.commonResponseMessageFinder.findMessage(correlationUid);\n     }\n+\n+    /**\n+     * This method replaces normal wilcards for Postgres wildcards and escapes\n+     * Postgres wildcards that were already present.", "originalCommit": "73d0c6d638bb77ee9e2f1493eec4fddfdb2fc56b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de47b66d47dee9e0a89f90a8d86234b8cae03b7e", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/de47b66d47dee9e0a89f90a8d86234b8cae03b7e", "message": "WildcardUtil class", "committedDate": "2020-06-22T15:42:15Z", "type": "commit"}, {"oid": "d3e5459e2a18414be7fe5c35763e95632c0d3f0a", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/d3e5459e2a18414be7fe5c35763e95632c0d3f0a", "message": "Adding private constructor", "committedDate": "2020-06-22T15:59:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MTI0MQ==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r444281241", "bodyText": "License header is missing.", "author": "rlemmers", "createdAt": "2020-06-23T14:45:16Z", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/utility/WildcardUtil.java", "diffHunk": "@@ -0,0 +1,33 @@\n+package org.opensmartgridplatform.adapter.ws.core.application.utility;", "originalCommit": "d3e5459e2a18414be7fe5c35763e95632c0d3f0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MTcxNg==", "url": "https://github.com/OSGP/open-smart-grid-platform/pull/354#discussion_r444281716", "bodyText": "In other places, we use a \"static import\" to save some characters.", "author": "rlemmers", "createdAt": "2020-06-23T14:45:51Z", "path": "osgp/platform/osgp-adapter-ws-core/src/main/java/org/opensmartgridplatform/adapter/ws/core/application/services/DeviceManagementService.java", "diffHunk": "@@ -416,7 +410,7 @@ public Organisation findOrganisation(@Identification final String organisationId\n             Specification<Device> specification) throws ArgumentNullOrEmptyException {\n         if (!StringUtils.isEmpty(deviceFilter.getFirmwareModuleVersion())) {\n             specification = specification.and(this.deviceSpecifications.forFirmwareModuleVersion(\n-                    deviceFilter.getFirmwareModuleType(), replaceWildcards(deviceFilter.getFirmwareModuleVersion())));\n+                    deviceFilter.getFirmwareModuleType(), WildcardUtil.replaceWildcards(deviceFilter.getFirmwareModuleVersion())));", "originalCommit": "d3e5459e2a18414be7fe5c35763e95632c0d3f0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7bb42f3dd350327c1536f47d0153ed287ac28d8a", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/7bb42f3dd350327c1536f47d0153ed287ac28d8a", "message": "Static import plus license header", "committedDate": "2020-06-23T18:27:46Z", "type": "commit"}, {"oid": "b6131a9acebc466d3b131b5228534630218ef807", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/b6131a9acebc466d3b131b5228534630218ef807", "message": "Corrected the license header", "committedDate": "2020-06-24T06:51:45Z", "type": "commit"}, {"oid": "6acc23dd3b666b8cc711e7734d25ff072e101d1c", "url": "https://github.com/OSGP/open-smart-grid-platform/commit/6acc23dd3b666b8cc711e7734d25ff072e101d1c", "message": "Merge branch 'development' into feature/FLEX-5411-wildcard-functionality-operator-app", "committedDate": "2020-06-24T08:21:15Z", "type": "commit"}]}