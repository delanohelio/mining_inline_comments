{"pr_number": 3978, "pr_title": "feat: Ceiling BlockFamily", "pr_createdAt": "2020-05-23T16:33:26Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3978", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MDcwOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429570709", "bodyText": "At least the method signature changes, so we can spot breaking families easily. I don't see an easy way to make this work in a backwards compatible way, so let's do this step!\nI'll check the Omega workspace for a full list of breaking block families \ud83d\ude48", "author": "skaldarnar", "createdAt": "2020-05-23T19:09:55Z", "path": "engine/src/main/java/org/terasology/world/block/family/BlockFamily.java", "diffHunk": "@@ -42,12 +43,12 @@\n     /**\n      * Get the block that is appropriate for placement in the given situation\n      *\n-     * @param location            The location where the block is going to be placed.\n-     * @param attachmentSide      The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n-     * @param direction           A secondary direction after the attachment side that determines the facing of the block.\n+     * @param location          The location where the block is going to be placed\n+     * @param attachmentSide    The side of the block which this block is being attached to, e.g. Top if the block is being placed on the ground\n+     * @param viewingDirection  The player's viewing direction\n      * @return The appropriate block\n      */\n-    Block getBlockForPlacement(Vector3i location, Side attachmentSide, Side direction);\n+    Block getBlockForPlacement(Vector3i location, Side attachmentSide, Vector3fc viewingDirection);", "originalCommit": "09e99909e70558a66a60d95f6b50fa3ff5e1e189", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjgzMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429572831", "bodyText": "Alright, I'll open a seperate PR for the API change.", "author": "kBlaszczyk", "createdAt": "2020-05-23T19:41:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MDcwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTExOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429571119", "bodyText": "This is a bit more clunky than what you've done HorizontalFamily. What's the difference?\nSide secondaryDirection = Side.inDirection(-viewingDirection.x(), 0, -viewingDirection.z());\nAs I cannot spot any other changes around the Side direction in both cases, shouldn't those two be the same?", "author": "skaldarnar", "createdAt": "2020-05-23T19:16:06Z", "path": "engine/src/main/java/org/terasology/world/block/family/FreeformFamily.java", "diffHunk": "@@ -75,7 +79,10 @@ public FreeformFamily(BlockFamilyDefinition blockFamilyDefinition, BlockBuilderH\n \n \n     @Override\n-    public Block getBlockForPlacement(Vector3i location, Side attachmentSide, Side direction) {\n+    public Block getBlockForPlacement(Vector3i location, Side attachmentSide, Vector3fc viewingDirection) {\n+        Vector3f attachmentSideNormal = new org.joml.Vector3f(attachmentSide.direction());\n+        Side direction = ChunkMath.getSecondaryPlacementDirection(JomlUtil.from(viewingDirection), JomlUtil.from(attachmentSideNormal));", "originalCommit": "09e99909e70558a66a60d95f6b50fa3ff5e1e189", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MzE3MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429573171", "bodyText": "In HorizontalFamily I could improve and simplify the algorithm with the new concept. In this one I didn't want to touch the logic. So what you are seeing here is the exact same as it was originally, with the exception that direction is calculated within the method instead of being passed into it.", "author": "kBlaszczyk", "createdAt": "2020-05-23T19:47:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTExOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MzU1NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429573555", "bodyText": "Is the definition of the free form family to use the archetype or behave like the horizontal family?\nI guess they could be using the same logic, but note that the calculation of direction works slightly different here than it currently does in HorizontalFamily.", "author": "kBlaszczyk", "createdAt": "2020-05-23T19:52:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTExOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY2OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429571669", "bodyText": "What's this about - just better naming? Please move/copy the JavaDoc over to the non-deprecated method if you want to leave this change in.", "author": "skaldarnar", "createdAt": "2020-05-23T19:24:32Z", "path": "engine/src/main/java/org/terasology/math/Rotation.java", "diffHunk": "@@ -218,8 +218,15 @@ public int hashCode() {\n      * Returns all possible rotations for each yaw, pitch & roll combination, including duplicates.\n      *\n      * @return All possible rotations for each yaw, pitch & roll combination.\n+     *\n+     * @deprecated use `allRotations` instead\n      */\n+    @Deprecated\n     public static Iterable<Rotation> allValues() {\n+        return allRotations();\n+    }\n+\n+    public static Iterable<Rotation> allRotations() {", "originalCommit": "09e99909e70558a66a60d95f6b50fa3ff5e1e189", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MjY5OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429572699", "bodyText": "This is part of the old PR, it's not used or anything. I thought about removing it but since I'm aiming to replace the other PR I kept everything in. (if I'm not mistaken, it was you who committed this btw :)", "author": "kBlaszczyk", "createdAt": "2020-05-23T19:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3ODUwNg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r429578506", "bodyText": "I must had a reason for that that is long forgotten now \ud83d\ude44 \ud83d\ude48", "author": "skaldarnar", "createdAt": "2020-05-23T21:09:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjM0OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432846349", "bodyText": "Let's remove this change if not used...", "author": "skaldarnar", "createdAt": "2020-05-30T14:37:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU3MTY2OQ=="}], "type": "inlineReview"}, {"oid": "e3ebeb3de4f4d6af54f7f51498b8d4c5372b57e8", "url": "https://github.com/MovingBlocks/Terasology/commit/e3ebeb3de4f4d6af54f7f51498b8d4c5372b57e8", "message": "Add in a family that almost works.", "committedDate": "2020-05-29T20:40:58Z", "type": "commit"}, {"oid": "5a075726e67fc122dd86faf7f6b36105674a3e5d", "url": "https://github.com/MovingBlocks/Terasology/commit/5a075726e67fc122dd86faf7f6b36105674a3e5d", "message": "* Add Rotation.allRotations() and deprecate allValues()\n* Add in new documentation for the BlockBuilderHelper class.", "committedDate": "2020-05-29T21:32:29Z", "type": "commit"}, {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11", "url": "https://github.com/MovingBlocks/Terasology/commit/4ad020b96b50e490eabfa675432a49ed1d0b3c11", "message": "Add BlockFamily providing upside down block rotation", "committedDate": "2020-05-30T11:53:02Z", "type": "commit"}, {"oid": "4ad020b96b50e490eabfa675432a49ed1d0b3c11", "url": "https://github.com/MovingBlocks/Terasology/commit/4ad020b96b50e490eabfa675432a49ed1d0b3c11", "message": "Add BlockFamily providing upside down block rotation", "committedDate": "2020-05-30T11:53:02Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjI5MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432846291", "bodyText": "What does this do? We are in an interface, where should we inherit from?", "author": "skaldarnar", "createdAt": "2020-05-30T14:36:34Z", "path": "engine/src/main/java/org/terasology/world/block/BlockBuilderHelper.java", "diffHunk": "@@ -21,23 +21,101 @@\n import org.terasology.world.block.loader.SectionDefinitionData;\n import org.terasology.world.block.shapes.BlockShape;\n \n+/**\n+ * A helper class for building and registering blocks with specific properties.\n+ * Intended for use with Block Family related code.\n+ * <p>\n+ * The core features of this helper is to convert from definition data, into a Block\n+ * and to register this block into the engine for use.\n+ */\n public interface BlockBuilderHelper {\n \n+    /**\n+     * {@inheritDoc}", "originalCommit": "4ad020b96b50e490eabfa675432a49ed1d0b3c11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2MzczMg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432863732", "bodyText": "Nothing useful, I removed it.", "author": "kBlaszczyk", "createdAt": "2020-05-30T15:26:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjI5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjQzNw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432846437", "bodyText": "What are \"reasonable defaults\"? What kind of defaults are we talking about/defaults for what?", "author": "skaldarnar", "createdAt": "2020-05-30T14:38:58Z", "path": "engine/src/main/java/org/terasology/world/block/BlockBuilderHelper.java", "diffHunk": "@@ -21,23 +21,101 @@\n import org.terasology.world.block.loader.SectionDefinitionData;\n import org.terasology.world.block.shapes.BlockShape;\n \n+/**\n+ * A helper class for building and registering blocks with specific properties.\n+ * Intended for use with Block Family related code.\n+ * <p>\n+ * The core features of this helper is to convert from definition data, into a Block\n+ * and to register this block into the engine for use.\n+ */\n public interface BlockBuilderHelper {\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * @see #constructSimpleBlock(BlockFamilyDefinition, BlockShape, String, BlockUri, BlockFamily)\n+     */\n     Block constructSimpleBlock(BlockFamilyDefinition definition, BlockUri uri, BlockFamily blockFamily);\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * @see #constructSimpleBlock(BlockFamilyDefinition, BlockShape, String, BlockUri, BlockFamily)\n+     */\n     Block constructSimpleBlock(BlockFamilyDefinition definition, BlockShape shape, BlockUri uri, BlockFamily blockFamily);\n \n+    /**\n+     * {@inheritDoc}\n+     *\n+     * @see #constructSimpleBlock(BlockFamilyDefinition, BlockShape, String, BlockUri, BlockFamily)\n+     */\n     Block constructSimpleBlock(BlockFamilyDefinition definition, String section, BlockUri uri, BlockFamily blockFamily);\n \n+    /**\n+     * Constructs a basic block from the data provided. This block is assumed to have no rotations, and to use reasonable defaults", "originalCommit": "4ad020b96b50e490eabfa675432a49ed1d0b3c11", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg2MzY4Mg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3978#discussion_r432863682", "bodyText": "I don't know enough about block creation to answer this adequately. All kinds of things are setup using the parameters. I assume there are block properties independent of the specified parameters that would be initialized \"using reasonable defaults\". It's an interface method, therefore it has an abstract description. The claim is to produce a useful block without having to specify all the properties its gonna have.", "author": "kBlaszczyk", "createdAt": "2020-05-30T15:26:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg0NjQzNw=="}], "type": "inlineReview"}, {"oid": "d7f2582d8e8000f0c8297f6f540f9603671c4438", "url": "https://github.com/MovingBlocks/Terasology/commit/d7f2582d8e8000f0c8297f6f540f9603671c4438", "message": "Fix Javadoc in BlockBuilderHelper", "committedDate": "2020-05-30T14:52:33Z", "type": "commit"}, {"oid": "122ebc375526daf709fa8077df074cbc958ffd85", "url": "https://github.com/MovingBlocks/Terasology/commit/122ebc375526daf709fa8077df074cbc958ffd85", "message": "Revert change in Rotation", "committedDate": "2020-05-30T14:54:56Z", "type": "commit"}]}