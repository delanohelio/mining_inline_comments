{"pr_number": 4333, "pr_title": "feat(JOML): migrate world renderer", "pr_createdAt": "2020-12-26T23:55:21Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/4333", "timeline": [{"oid": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "url": "https://github.com/MovingBlocks/Terasology/commit/91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "message": "feat(JOML): migrate world renderer", "committedDate": "2020-12-26T23:51:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA0NDE0Mg==", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r549044142", "bodyText": "we don't have a subtract anymore so hopefully I implemented this correctly.", "author": "pollend", "createdAt": "2020-12-26T23:55:52Z", "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {\n+                if (!newRenderableRegion.contains(toRemove)) {\n+                    Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n+                    for (Iterator<RenderableChunk> it = nearbyChunks; it.hasNext(); ) {\n+                        chunk = it.next();\n+                        if (chunk.getPosition(new org.joml.Vector3i()).equals(toRemove)) {\n+                            chunk.disposeMesh();\n+                            nearbyChunks.remove();\n+                            break;\n+                        }\n \n-            Iterator<Vector3i> chunksToRemove = renderableRegion.subtract(newRenderableRegion);\n-            while (chunksToRemove.hasNext()) {\n-                chunkPosition = chunksToRemove.next();\n-                Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n-                while (nearbyChunks.hasNext()) {\n-                    chunk = nearbyChunks.next();\n-                    if (chunk.getPosition().equals(chunkPosition)) {\n-                        chunk.disposeMesh();\n-                        nearbyChunks.remove();\n-                        break;\n                     }\n                 }\n             }\n-\n             boolean chunksHaveBeenAdded = false;\n-            Iterator<Vector3i> chunksToAdd = newRenderableRegion.subtract(renderableRegion);\n-            while (chunksToAdd.hasNext()) {\n-                chunkPosition = chunksToAdd.next();\n-                chunk = chunkProvider.getChunk(chunkPosition);\n-                if (chunk != null) {\n-                    chunksInProximityOfCamera.add(chunk);\n-                    chunksHaveBeenAdded = true;\n+            for (Vector3ic toAdd : newRenderableRegion) {\n+                if (!renderableRegion.contains(toAdd)) {\n+                    chunk = chunkProvider.getChunk(JomlUtil.from(toAdd));\n+                    if (chunk != null) {\n+                        chunksInProximityOfCamera.add(chunk);\n+                        chunksHaveBeenAdded = true;\n+                    }", "originalCommit": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM0ODYyMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r550348623", "bodyText": "I think you did, yes.", "author": "jdrueckert", "createdAt": "2020-12-30T22:48:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTA0NDE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM0ODU1Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r550348557", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (Vector3ic toAdd : newRenderableRegion) {\n          \n          \n            \n                        for (Vector3ic chunkPositionToAdd : newRenderableRegion) {", "author": "jdrueckert", "createdAt": "2020-12-30T22:48:13Z", "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {\n+                if (!newRenderableRegion.contains(toRemove)) {\n+                    Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n+                    for (Iterator<RenderableChunk> it = nearbyChunks; it.hasNext(); ) {\n+                        chunk = it.next();\n+                        if (chunk.getPosition(new org.joml.Vector3i()).equals(toRemove)) {\n+                            chunk.disposeMesh();\n+                            nearbyChunks.remove();\n+                            break;\n+                        }\n \n-            Iterator<Vector3i> chunksToRemove = renderableRegion.subtract(newRenderableRegion);\n-            while (chunksToRemove.hasNext()) {\n-                chunkPosition = chunksToRemove.next();\n-                Iterator<RenderableChunk> nearbyChunks = chunksInProximityOfCamera.iterator();\n-                while (nearbyChunks.hasNext()) {\n-                    chunk = nearbyChunks.next();\n-                    if (chunk.getPosition().equals(chunkPosition)) {\n-                        chunk.disposeMesh();\n-                        nearbyChunks.remove();\n-                        break;\n                     }\n                 }\n             }\n-\n             boolean chunksHaveBeenAdded = false;\n-            Iterator<Vector3i> chunksToAdd = newRenderableRegion.subtract(renderableRegion);\n-            while (chunksToAdd.hasNext()) {\n-                chunkPosition = chunksToAdd.next();\n-                chunk = chunkProvider.getChunk(chunkPosition);\n-                if (chunk != null) {\n-                    chunksInProximityOfCamera.add(chunk);\n-                    chunksHaveBeenAdded = true;\n+            for (Vector3ic toAdd : newRenderableRegion) {", "originalCommit": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDM0ODY3OQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/4333#discussion_r550348679", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for (Vector3ic toRemove : renderableRegion) {\n          \n          \n            \n                        for (Vector3ic chunkPositionToRemove : renderableRegion) {", "author": "jdrueckert", "createdAt": "2020-12-30T22:48:52Z", "path": "engine/src/main/java/org/terasology/rendering/world/RenderableWorldImpl.java", "diffHunk": "@@ -196,33 +196,31 @@ public void update() {\n      * @return True if the list was changed\n      */\n     @Override\n-    public boolean updateChunksInProximity(Region3i newRenderableRegion) {\n+    public boolean updateChunksInProximity(BlockRegion newRenderableRegion) {\n         if (!newRenderableRegion.equals(renderableRegion)) {\n-            Vector3i chunkPosition;\n             RenderableChunk chunk;\n+            for (Vector3ic toRemove : renderableRegion) {", "originalCommit": "91b5112e5e825ffae51f81eebf57a4f7bf720ee3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37d80df62ca4d8a23221b6385ea2c2b49e39a4e3", "url": "https://github.com/MovingBlocks/Terasology/commit/37d80df62ca4d8a23221b6385ea2c2b49e39a4e3", "message": "update position names", "committedDate": "2020-12-31T03:20:05Z", "type": "commit"}, {"oid": "21dd752d90ac46e0c3088c85d32947fa9d7ccd19", "url": "https://github.com/MovingBlocks/Terasology/commit/21dd752d90ac46e0c3088c85d32947fa9d7ccd19", "message": "Merge branch 'develop' into feature/joml-migrate-worldrenderable", "committedDate": "2020-12-31T10:56:03Z", "type": "commit"}]}