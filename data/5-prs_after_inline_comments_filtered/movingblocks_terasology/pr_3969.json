{"pr_number": 3969, "pr_title": "Upgrading LWJGL to version 3", "pr_createdAt": "2020-05-19T06:11:49Z", "pr_url": "https://github.com/MovingBlocks/Terasology/pull/3969", "timeline": [{"oid": "132882ad365c1d8e1fdedbe4aeab8c77c2b61899", "url": "https://github.com/MovingBlocks/Terasology/commit/132882ad365c1d8e1fdedbe4aeab8c77c2b61899", "message": "chore(LWJGL3): expose lwjgl3 libs to modules", "committedDate": "2020-05-21T08:48:18Z", "type": "forcePushed"}, {"oid": "7da81a4c3b8a95e82cc990ba754b36cdfcad8a28", "url": "https://github.com/MovingBlocks/Terasology/commit/7da81a4c3b8a95e82cc990ba754b36cdfcad8a28", "message": "feat(LWJGL3): initial migrate", "committedDate": "2020-06-08T17:52:37Z", "type": "commit"}, {"oid": "7d5d90868a90794f2c457f4e00e48831b731d1df", "url": "https://github.com/MovingBlocks/Terasology/commit/7d5d90868a90794f2c457f4e00e48831b731d1df", "message": "fix: keyboard binding id from lwjgl's to tera's", "committedDate": "2020-06-08T17:52:40Z", "type": "commit"}, {"oid": "c6c7a987e3aca3b5d3f080e251d0f364534cc500", "url": "https://github.com/MovingBlocks/Terasology/commit/c6c7a987e3aca3b5d3f080e251d0f364534cc500", "message": "fix: save window position and window size on exit", "committedDate": "2020-06-08T17:52:40Z", "type": "commit"}, {"oid": "22950e9954fb9d9a99028aad8bc64d27828761b4", "url": "https://github.com/MovingBlocks/Terasology/commit/22950e9954fb9d9a99028aad8bc64d27828761b4", "message": "chore: refactor GL and GLFW debug/error callbacks", "committedDate": "2020-06-08T17:52:40Z", "type": "commit"}, {"oid": "d15eeec65748a5f02e7ad25cbf5a2d7b350724eb", "url": "https://github.com/MovingBlocks/Terasology/commit/d15eeec65748a5f02e7ad25cbf5a2d7b350724eb", "message": "Fix: WindowResizeCallback creates only 1 time on window creation", "committedDate": "2020-06-08T17:52:40Z", "type": "commit"}, {"oid": "9c7cb572030c377437dffcc1812857481a80e381", "url": "https://github.com/MovingBlocks/Terasology/commit/9c7cb572030c377437dffcc1812857481a80e381", "message": "Fix: Return SkySphere! and glu's Sphere related things", "committedDate": "2020-06-08T17:52:43Z", "type": "commit"}, {"oid": "feaa3a19bcf2e40b47ff9184b911c3b07d45abaa", "url": "https://github.com/MovingBlocks/Terasology/commit/feaa3a19bcf2e40b47ff9184b911c3b07d45abaa", "message": "Fix: Settings Resolution restored now!", "committedDate": "2020-06-08T17:52:45Z", "type": "commit"}, {"oid": "3689c8d698e0688ef839f72bdf4472d2a3611fc9", "url": "https://github.com/MovingBlocks/Terasology/commit/3689c8d698e0688ef839f72bdf4472d2a3611fc9", "message": "chore(LWJGL3): expose lwjgl3 libs to modules", "committedDate": "2020-06-08T17:54:11Z", "type": "commit"}, {"oid": "b615a280950d68437dd907d1d4fdb934dad6555d", "url": "https://github.com/MovingBlocks/Terasology/commit/b615a280950d68437dd907d1d4fdb934dad6555d", "message": "fix(LWJGL3): fix disable vSync", "committedDate": "2020-06-08T17:54:13Z", "type": "commit"}, {"oid": "4cde3a866e83f7256f3aed27c2a01c2fa5525184", "url": "https://github.com/MovingBlocks/Terasology/commit/4cde3a866e83f7256f3aed27c2a01c2fa5525184", "message": "fix(LWJGL3): fixed mouse scroll. before was delta=0", "committedDate": "2020-06-08T17:54:13Z", "type": "commit"}, {"oid": "47b2ec149afdf29e3b1ba2114d9ff8ebc24d737d", "url": "https://github.com/MovingBlocks/Terasology/commit/47b2ec149afdf29e3b1ba2114d9ff8ebc24d737d", "message": "fix(Lwjgl3): reordered lwjgl3 natives init and direct implement os detect. otherwise System.setProperty haven't any effect on Lwjgl Configuration.", "committedDate": "2020-06-08T17:54:13Z", "type": "commit"}, {"oid": "cdd628201809b32f6705b46d3530a84cc575ed48", "url": "https://github.com/MovingBlocks/Terasology/commit/cdd628201809b32f6705b46d3530a84cc575ed48", "message": "fix(Lwjgl3): fixed Resolution, switching DesplayModes", "committedDate": "2020-06-08T17:54:13Z", "type": "commit"}, {"oid": "1d4435848384f1aa0bd5143ccbbf29c96e65e542", "url": "https://github.com/MovingBlocks/Terasology/commit/1d4435848384f1aa0bd5143ccbbf29c96e65e542", "message": "chore(LWJGL3): Remove static getter for window/display size", "committedDate": "2020-06-08T17:54:16Z", "type": "commit"}, {"oid": "1e0a8224e3d02e0b3c0a608e2e7617815701c34f", "url": "https://github.com/MovingBlocks/Terasology/commit/1e0a8224e3d02e0b3c0a608e2e7617815701c34f", "message": "fix(LWJGL3): Fix FrameLimit", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "760f8c46c3cd536c398f2839ea386ced5bd0ab86", "url": "https://github.com/MovingBlocks/Terasology/commit/760f8c46c3cd536c398f2839ea386ced5bd0ab86", "message": "fix(LWJGL3): Merge keys and chars from callbacks together.", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "35af4a3c0130553f06f0a33903a025b1e32f588c", "url": "https://github.com/MovingBlocks/Terasology/commit/35af4a3c0130553f06f0a33903a025b1e32f588c", "message": "chore(LWJGL3): refactor Sync(framelimiter) names.", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "ec235660ed47b9713709118d345201f22237ab8f", "url": "https://github.com/MovingBlocks/Terasology/commit/ec235660ed47b9713709118d345201f22237ab8f", "message": "fix(LWJGL3): fix OpenGL's messages", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "f9d94a310892a1ef3ebb055197bd0c026e05f8b9", "url": "https://github.com/MovingBlocks/Terasology/commit/f9d94a310892a1ef3ebb055197bd0c026e05f8b9", "message": "chore(LWJGL3): cleanup commented code/todos. PixelFormat(depth bits) returned", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "8c1499c15faf5e5706e3274c02831f0d84632654", "url": "https://github.com/MovingBlocks/Terasology/commit/8c1499c15faf5e5706e3274c02831f0d84632654", "message": "fix(LWJGL3): revert .idea configs", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "3d78b7ad2af0faea9b093d0a06e2410bf41d57fa", "url": "https://github.com/MovingBlocks/Terasology/commit/3d78b7ad2af0faea9b093d0a06e2410bf41d57fa", "message": "fix(LWJGL3): make OS detection for determinate platform path - lwjgl-independ (it can break writing lwjgl's path natives)", "committedDate": "2020-06-08T17:54:17Z", "type": "commit"}, {"oid": "10f639b21b36a2f59d92d064edeefbe768eb94ee", "url": "https://github.com/MovingBlocks/Terasology/commit/10f639b21b36a2f59d92d064edeefbe768eb94ee", "message": "chore(lwjgl3): update LWJGL3 for DAG", "committedDate": "2020-06-08T19:54:55Z", "type": "commit"}, {"oid": "b377ec148b7904fcce95fe5b1893f2d1b8c09b30", "url": "https://github.com/MovingBlocks/Terasology/commit/b377ec148b7904fcce95fe5b1893f2d1b8c09b30", "message": "Merge remote-tracking branch 'tera/develop' into lwjgl3\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglGraphics.java\n#\tengine/src/main/java/org/terasology/rendering/ShaderManagerLwjgl.java", "committedDate": "2020-06-08T20:04:22Z", "type": "commit"}, {"oid": "b377ec148b7904fcce95fe5b1893f2d1b8c09b30", "url": "https://github.com/MovingBlocks/Terasology/commit/b377ec148b7904fcce95fe5b1893f2d1b8c09b30", "message": "Merge remote-tracking branch 'tera/develop' into lwjgl3\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglGraphics.java\n#\tengine/src/main/java/org/terasology/rendering/ShaderManagerLwjgl.java", "committedDate": "2020-06-08T20:04:22Z", "type": "forcePushed"}, {"oid": "4246b761a4e4dd138563f6da41e5f41d9f285802", "url": "https://github.com/MovingBlocks/Terasology/commit/4246b761a4e4dd138563f6da41e5f41d9f285802", "message": "fix(lwjgl3): Fix lwjgl2's GLContext -> lwjgl3's GL in SpritePraticleRenderer", "committedDate": "2020-06-08T20:15:27Z", "type": "commit"}, {"oid": "7bacf1ca60997df0b89837f207118bdf4a706ee4", "url": "https://github.com/MovingBlocks/Terasology/commit/7bacf1ca60997df0b89837f207118bdf4a706ee4", "message": "feat(lwjgl3): Update for LWJGL3", "committedDate": "2020-07-02T19:37:24Z", "type": "commit"}, {"oid": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "url": "https://github.com/MovingBlocks/Terasology/commit/a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "message": "Merge remote-tracking branch 'tera/develop' into lwjgl3\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/rendering/cameras/OpenVRStereoCamera.java\n#\tengine/src/main/java/org/terasology/rendering/cameras/PerspectiveCamera.java", "committedDate": "2020-07-02T19:41:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NDQ3NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449694474", "bodyText": "A brief bit of class-level javadoc is always nice to have, even if the methods are javadocced :-)", "author": "Cervator", "createdAt": "2020-07-03T20:05:23Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/Lwjgl2Sync.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.engine.subsystem.lwjgl;\n+\n+import org.lwjgl.glfw.GLFW;\n+\n+public final class Lwjgl2Sync {", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NDYyMw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449694623", "bodyText": "Aiieeee brackets here and the next line. What does this class do anyway? Is it copied in from somewhere or original?", "author": "Cervator", "createdAt": "2020-07-03T20:06:16Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/Lwjgl2Sync.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.engine.subsystem.lwjgl;\n+\n+import org.lwjgl.glfw.GLFW;\n+\n+public final class Lwjgl2Sync {\n+\n+    private Lwjgl2Sync() {\n+    }\n+\n+    /**\n+     * number of nano seconds in a second\n+     */\n+    private static final long NANOS_IN_SECOND = 1000L * 1000L * 1000L;\n+\n+    /**\n+     * The time to sleep/yield until the next frame\n+     */\n+    private static long nextFrame = 0;\n+\n+    /**\n+     * whether the initialisation code has run\n+     */\n+    private static boolean initialised = false;\n+\n+    /**\n+     * for calculating the averages the previous sleep/yield times are stored\n+     */\n+    private static RunningAvg sleepDurations = new RunningAvg(10);\n+    private static RunningAvg yieldDurations = new RunningAvg(10);\n+\n+\n+    /**\n+     * An accurate sync method that will attempt to run at a constant frame rate. It should be called once every frame.\n+     *\n+     * @param fps - the desired frame rate, in frames per second\n+     */\n+    public static void sync(int fps) {\n+        if (fps <= 0) return;", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NDczMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449694730", "bodyText": "Howcome! \ud83d\ude01", "author": "Cervator", "createdAt": "2020-07-03T20:06:59Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/Lwjgl2Sync.java", "diffHunk": "@@ -0,0 +1,163 @@\n+/*\n+ * Copyright 2020 MovingBlocks\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.terasology.engine.subsystem.lwjgl;\n+\n+import org.lwjgl.glfw.GLFW;\n+\n+public final class Lwjgl2Sync {\n+\n+    private Lwjgl2Sync() {\n+    }\n+\n+    /**\n+     * number of nano seconds in a second\n+     */\n+    private static final long NANOS_IN_SECOND = 1000L * 1000L * 1000L;\n+\n+    /**\n+     * The time to sleep/yield until the next frame\n+     */\n+    private static long nextFrame = 0;\n+\n+    /**\n+     * whether the initialisation code has run\n+     */\n+    private static boolean initialised = false;\n+\n+    /**\n+     * for calculating the averages the previous sleep/yield times are stored\n+     */\n+    private static RunningAvg sleepDurations = new RunningAvg(10);\n+    private static RunningAvg yieldDurations = new RunningAvg(10);\n+\n+\n+    /**\n+     * An accurate sync method that will attempt to run at a constant frame rate. It should be called once every frame.\n+     *\n+     * @param fps - the desired frame rate, in frames per second\n+     */\n+    public static void sync(int fps) {\n+        if (fps <= 0) return;\n+        if (!initialised) initialise();\n+\n+        try {\n+            // sleep until the average sleep time is greater than the time remaining till nextFrame\n+            for (long t0 = getTime(), t1; (nextFrame - t0) > sleepDurations.avg(); t0 = t1) {\n+                Thread.sleep(1);\n+                sleepDurations.add((t1 = getTime()) - t0); // update average sleep time\n+            }\n+\n+            // slowly dampen sleep average if too high to avoid yielding too much\n+            sleepDurations.dampenForLowResTicker();\n+\n+            // yield until the average yield time is greater than the time remaining till nextFrame\n+            for (long t0 = getTime(), t1; (nextFrame - t0) > yieldDurations.avg(); t0 = t1) {\n+                Thread.yield();\n+                yieldDurations.add((t1 = getTime()) - t0); // update average yield time\n+            }\n+        } catch (InterruptedException e) {\n+\n+        }\n+\n+        // schedule next frame, drop frame(s) if already too late for next frame\n+        nextFrame = Math.max(nextFrame + NANOS_IN_SECOND / fps, getTime());\n+    }\n+\n+    /**\n+     * This method will initialise the sync method by setting initial values for sleepDurations/yieldDurations and\n+     * nextFrame.\n+     * <p>\n+     * If running on windows it will start the sleep timer fix.\n+     */\n+    private static void initialise() {\n+        initialised = true;\n+\n+        sleepDurations.init(1000 * 1000);\n+        yieldDurations.init((int) (-(getTime() - getTime()) * 1.333));\n+\n+        nextFrame = getTime();\n+\n+        String osName = System.getProperty(\"os.name\");\n+\n+        if (osName.startsWith(\"Win\")) {\n+            // On windows the sleep functions can be highly inaccurate by\n+            // over 10ms making in unusable. However it can be forced to\n+            // be a bit more accurate by running a separate sleeping daemon\n+            // thread.\n+            Thread timerAccuracyThread = new Thread(new Runnable() {\n+                public void run() {\n+                    try {\n+                        Thread.sleep(Long.MAX_VALUE);\n+                    } catch (Exception e) {\n+                    }\n+                }\n+            });\n+\n+            timerAccuracyThread.setName(\"LWJGL Timer\");\n+            timerAccuracyThread.setDaemon(true);\n+            timerAccuracyThread.start();\n+        }\n+    }\n+\n+    /**\n+     * Get the system time in nano seconds\n+     *\n+     * @return will return the current time in nano's\n+     */\n+    private static long getTime() {\n+        return (long) (GLFW.glfwGetTime() * NANOS_IN_SECOND);\n+    }\n+\n+    private static class RunningAvg {\n+        private final long[] slots;\n+        private int offset;\n+\n+        private static final long DAMPEN_THRESHOLD = 10 * 1000L * 1000L; // 10ms\n+        private static final float DAMPEN_FACTOR = 0.9f; // don't change: 0.9f is exactly right!", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIyNDYxMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r450224611", "bodyText": "Copy-paste from LWJGL2's class.\nIt is Sync.java - it is exactly right! :D", "author": "DarkWeird", "createdAt": "2020-07-06T13:35:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NDczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NDgxOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449694819", "bodyText": "Howcome this goes API?", "author": "Cervator", "createdAt": "2020-07-03T20:07:37Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/DisplayDevice.java", "diffHunk": "@@ -15,11 +15,13 @@\n  */\n package org.terasology.engine.subsystem;\n \n+import org.terasology.module.sandbox.API;\n import org.terasology.rendering.nui.layers.mainMenu.videoSettings.DisplayModeSetting;\n import org.terasology.utilities.subscribables.Subscribable;\n \n import java.util.List;\n \n+@API", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIzMDA0Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r450230043", "bodyText": "It needs needs for rendering module now.\nThis class provides window width and height.", "author": "DarkWeird", "createdAt": "2020-07-06T13:44:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NDgxOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTA1NA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449695054", "bodyText": "Commented out code? Any reason to not just remove?", "author": "Cervator", "createdAt": "2020-07-03T20:09:18Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglGraphics.java", "diffHunk": "@@ -143,126 +174,187 @@ public void registerCoreAssetTypes(ModuleAwareAssetTypeManager assetTypeManager)\n     public void postInitialise(Context rootContext) {\n         context.put(RenderingSubsystemFactory.class, new LwjglRenderingSubsystemFactory(bufferPool));\n \n-        initDisplay();\n+        initGLFW();\n+        initWindow();\n         initOpenGL(context);\n \n         context.put(CanvasRenderer.class, new LwjglCanvasRenderer(context));\n     }\n \n     @Override\n     public void postUpdate(GameState currentState, float delta) {\n-        Display.update();\n-\n         if (!displayThreadActions.isEmpty()) {\n             List<Runnable> actions = Lists.newArrayListWithExpectedSize(displayThreadActions.size());\n             displayThreadActions.drainTo(actions);\n             actions.forEach(Runnable::run);\n         }\n \n-        int frameLimit = context.get(Config.class).getRendering().getFrameLimit();\n-        if (frameLimit > 0) {\n-            Display.sync(frameLimit);\n-        }\n         currentState.render();\n \n         lwjglDisplay.update();\n-\n+        int frameLimit = context.get(Config.class).getRendering().getFrameLimit();\n+        if (frameLimit > 0) {\n+            Lwjgl2Sync.sync(frameLimit);\n+        }\n         if (lwjglDisplay.isCloseRequested()) {\n             engine.shutdown();\n         }\n     }\n \n     @Override\n     public void preShutdown() {\n-        if (Display.isCreated() && !Display.isFullscreen() && Display.isVisible()) {\n-            config.setWindowPosX(Display.getX());\n-            config.setWindowPosY(Display.getY());\n-\n-            config.setWindowWidth(Display.getWidth());\n-            config.setWindowHeight(Display.getHeight());\n-\n+        long window = GLFW.glfwGetCurrentContext();\n+        if (window != MemoryUtil.NULL) {\n+            boolean isVisible = GLFW.glfwGetWindowAttrib(window, GLFW.GLFW_VISIBLE) == GLFW.GLFW_TRUE;\n+            boolean isFullScreen = lwjglDisplay.isFullscreen();\n+            if (!isFullScreen && isVisible) {\n+                int[] xBuffer = new int[1];\n+                int[] yBuffer = new int[1];\n+                GLFW.glfwGetWindowPos(window, xBuffer, yBuffer);\n+                config.setWindowPosX(xBuffer[0]);\n+                config.setWindowPosY(yBuffer[0]);\n+\n+                int[] widthBuffer = new int[1];\n+                int[] heightBuffer = new int[1];\n+                GLFW.glfwGetWindowSize(window, widthBuffer, heightBuffer);\n+                config.setWindowWidth(widthBuffer[0]);\n+                config.setWindowHeight(heightBuffer[0]);\n+            }\n         }\n     }\n \n     @Override\n     public void shutdown() {\n-        Display.destroy();\n+        GLFW.glfwTerminate();\n     }\n \n-    private void initDisplay() {\n-        logger.info(\"Initializing display (if last line in log then likely the game crashed from an issue with your video card)\");\n-\n-        try {\n+    private void initGLFW() {\n+        if (!GLFW.glfwInit()) {\n+            throw new RuntimeException(\"Failed to initialize GLFW\");\n+        }\n \n-            lwjglDisplay.setDisplayModeSetting(config.getDisplayModeSetting(), false);\n+        GLFW.glfwDefaultWindowHints();\n+        GLFW.glfwWindowHint(GLFW.GLFW_VISIBLE, GLFW.GLFW_FALSE);\n+        GLFW.glfwWindowHint(GLFW.GLFW_COCOA_GRAPHICS_SWITCHING, GLFW.GLFW_TRUE);\n+        GLFW.glfwWindowHint(GLFW.GLFW_DEPTH_BITS, config.getPixelFormat());\n \n-            Display.setTitle(\"Terasology\" + \" | \" + \"Alpha\");\n-            try {\n+//        GLFW.glfwWindowHint(GLFW.GLFW_CLIENT_API, GLFW.GLFW_OPENGL_API);", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTQ4Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449695483", "bodyText": "Eh? Also this reminds me about the rare issues where the mouse cursor gets grabbed funny and won't let go for some devs. No idea if that's related, like if you had commented this out to avoid that while working on the PR?", "author": "Cervator", "createdAt": "2020-07-03T20:11:55Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglInput.java", "diffHunk": "@@ -47,36 +44,25 @@ public void postInitialise(Context rootContext) {\n         this.context = rootContext;\n         initControls();\n         updateInputConfig();\n-        Mouse.setGrabbed(false);\n+        // Mouse.setGrabbed(false);", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTY5MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449695690", "bodyText": "Would be nice with some more details for this - what needs to be fixed? What's broken? Should we submit an issue with details then link to that issue from the TODO? What does this portlet even do?", "author": "Cervator", "createdAt": "2020-07-03T20:13:15Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglPortlet.java", "diffHunk": "@@ -32,11 +30,13 @@ public String getName() {\n \n     @Override\n     public void postInitialise(Context context) {\n-        try {\n-            Display.setParent(customViewPort);\n-        } catch (LWJGLException e) {\n-            throw new RuntimeException(\"Can not initialize graphics device.\", e);\n-        }\n+        // FIXME: LWJGL 3 - reimplement", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NTkwOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449695909", "bodyText": "Very trivial, but a missing space here between ){ - haven't looked too closely for such code style issues elsewhere, but it may be worth doing a little Checkstyle pass per changed class in your IDE", "author": "Cervator", "createdAt": "2020-07-03T20:14:42Z", "path": "engine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglResolution.java", "diffHunk": "@@ -15,42 +15,105 @@\n  */\n package org.terasology.engine.subsystem.lwjgl;\n \n-import org.lwjgl.opengl.DisplayMode;\n+import org.lwjgl.glfw.GLFWVidMode;\n import org.terasology.engine.subsystem.Resolution;\n \n+import java.util.Objects;\n+\n public final class LwjglResolution implements Resolution {\n \n-    private final DisplayMode displayMode;\n+    private int width;\n+    private int height;\n+    private int redBits;\n+    private int greenBits;\n+    private int blueBits;\n+    private int refreshRate;\n+\n+    public LwjglResolution(GLFWVidMode vidMode) {\n+        this.width = vidMode.width();\n+        this.height = vidMode.height();\n+        this.redBits = vidMode.redBits();\n+        this.greenBits = vidMode.greenBits();\n+        this.blueBits = vidMode.blueBits();\n+        this.refreshRate = vidMode.refreshRate();\n+    }\n+\n+    public LwjglResolution(int width, int height, int redBits, int greenBits, int blueBits, int refreshRate) {\n+        this.width = width;\n+        this.height = height;\n+        this.redBits = redBits;\n+        this.greenBits = greenBits;\n+        this.blueBits = blueBits;\n+        this.refreshRate = refreshRate;\n+    }\n+\n+    public int getWidth() {\n+        return width;\n+    }\n+\n+    public int getHeight() {\n+        return height;\n+    }\n+\n+    public int getRedBits() {\n+        return redBits;\n+    }\n \n-    public LwjglResolution(DisplayMode displayMode) {\n-        this.displayMode = displayMode;\n+    public int getGreenBits() {\n+        return greenBits;\n     }\n \n-    public DisplayMode getDisplayMode() {\n-        return displayMode;\n+    public int getBlueBits() {\n+        return blueBits;\n+    }\n+\n+    public int getRefreshRate() {\n+        return refreshRate;\n     }\n \n     @Override\n     public boolean equals(Object o) {\n         if (this == o) {\n             return true;\n         }\n-        if (o == null || getClass() != o.getClass()) {\n+        if (o == null) {\n+            return false;\n+        } else if (o instanceof GLFWVidMode){", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NjA4OA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449696088", "bodyText": "Eeee - more of these old empty javadoc blocks. If you could fill them in with some basic javadoc then cool. If not and you see empty javadoc blocks please just remove them so the code analytics will complain about there being no javadoc", "author": "Cervator", "createdAt": "2020-07-03T20:15:44Z", "path": "engine/src/main/java/org/terasology/input/lwjgl/LwjglKeyboardDevice.java", "diffHunk": "@@ -15,40 +15,249 @@\n  */\n package org.terasology.input.lwjgl;\n \n-import com.google.common.collect.Queues;\n-\n-import org.lwjgl.input.Keyboard;\n+import com.google.common.collect.Lists;\n+import gnu.trove.map.TIntIntMap;\n+import gnu.trove.map.hash.TIntIntHashMap;\n+import gnu.trove.set.TIntSet;\n+import gnu.trove.set.hash.TIntHashSet;\n+import org.lwjgl.glfw.GLFW;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.terasology.input.ButtonState;\n import org.terasology.input.Input;\n import org.terasology.input.InputType;\n+import org.terasology.input.Keyboard;\n import org.terasology.input.device.KeyboardAction;\n import org.terasology.input.device.KeyboardDevice;\n \n+import java.util.Iterator;\n import java.util.Queue;\n \n /**\n+ *", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NjE2Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449696167", "bodyText": "Commented out code - what's a NONE key anyway? \ud83e\udd14 What's remaining to clean up and test", "author": "Cervator", "createdAt": "2020-07-03T20:16:16Z", "path": "engine/src/main/java/org/terasology/input/lwjgl/LwjglKeyboardDevice.java", "diffHunk": "@@ -15,40 +15,249 @@\n  */\n package org.terasology.input.lwjgl;\n \n-import com.google.common.collect.Queues;\n-\n-import org.lwjgl.input.Keyboard;\n+import com.google.common.collect.Lists;\n+import gnu.trove.map.TIntIntMap;\n+import gnu.trove.map.hash.TIntIntHashMap;\n+import gnu.trove.set.TIntSet;\n+import gnu.trove.set.hash.TIntHashSet;\n+import org.lwjgl.glfw.GLFW;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n import org.terasology.input.ButtonState;\n import org.terasology.input.Input;\n import org.terasology.input.InputType;\n+import org.terasology.input.Keyboard;\n import org.terasology.input.device.KeyboardAction;\n import org.terasology.input.device.KeyboardDevice;\n \n+import java.util.Iterator;\n import java.util.Queue;\n \n /**\n+ *\n  */\n public class LwjglKeyboardDevice implements KeyboardDevice {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(LwjglKeyboardDevice.class);\n+    private static final TIntIntMap GLFW_TO_TERA_MAPPING = new TIntIntHashMap();\n+\n+    static {\n+        //TODO: test and cleanup keys\n+//        glfwToTeraMaps.put(GLFW.GLFW_KEY_NONE, Keyboard.KeyId.NONE);", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI0Mjk0Mg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r450242942", "bodyText": "Lwjgl2 had NONE key.. yep strange :D with not used in code... seems, it is for methods like  getKeyPressed()\nI did regex-replace and some manual changes.\ntest all keys :D maybe, i not understood some keys.\nsome keys specified for countries. idk.\ncleanup - remove all commented keys.", "author": "DarkWeird", "createdAt": "2020-07-06T14:03:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NjE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NjMyOQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449696329", "bodyText": "More empty Javadoc", "author": "Cervator", "createdAt": "2020-07-03T20:17:13Z", "path": "engine/src/main/java/org/terasology/input/lwjgl/LwjglMouseDevice.java", "diffHunk": "@@ -32,62 +33,73 @@\n import java.util.Queue;\n \n /**\n+", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NjcyMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449696721", "bodyText": "Should this be noted in an issue somewhere just so it is documented that a button down event for mice won't work?", "author": "Cervator", "createdAt": "2020-07-03T20:19:38Z", "path": "engine/src/main/java/org/terasology/input/lwjgl/LwjglMouseDevice.java", "diffHunk": "@@ -32,62 +33,73 @@\n import java.util.Queue;\n \n /**\n+\n  */\n public class LwjglMouseDevice implements MouseDevice, PropertyChangeListener {\n     private RenderingConfig renderingConfig;\n     private float uiScale;\n     private boolean mouseGrabbed;\n+    private Queue<MouseAction> queue = Lists.newLinkedList();\n+\n+    private double xpos = 0.0;\n+    private double ypos = 0.0;\n+\n+    private double xposDelta = 0.0;\n+    private double yposDelta = 0.0;\n \n     public LwjglMouseDevice(Context context) {\n         this.renderingConfig = context.get(Config.class).getRendering();\n         this.uiScale = this.renderingConfig.getUiScale() / 100f;\n         this.renderingConfig.subscribe(RenderingConfig.UI_SCALE, this);\n+\n+        // GLFW callback\n+        long window = GLFW.glfwGetCurrentContext();\n+        GLFW.glfwSetCursorPosCallback(window, this::cursorPosCallback);\n+        GLFW.glfwSetMouseButtonCallback(window, this::mouseButtonCallback);\n+        GLFW.glfwSetScrollCallback(window, this::scrollCallback);\n+\n     }\n \n     @Override\n     public Vector2i getPosition() {\n-        return new Vector2i(Mouse.getX() / this.uiScale, (Display.getHeight() - Mouse.getY()) / this.uiScale);\n+        return new Vector2i((int) (xpos / this.uiScale), (int)  (ypos/ this.uiScale));\n     }\n \n     @Override\n     public Vector2i getDelta() {\n-        return new Vector2i(Mouse.getDX(), -Mouse.getDY());\n+        Vector2i result = new Vector2i((int) xposDelta, (int) yposDelta);\n+        xposDelta = 0.0;\n+        yposDelta = 0.0;\n+        return result;\n     }\n \n     @Override\n     public boolean isButtonDown(int button) {\n-        return Mouse.isButtonDown(button);\n+        return false; //FIXME: low priority unused method", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5Njc2OA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449696768", "bodyText": "Mystery commented out code", "author": "Cervator", "createdAt": "2020-07-03T20:20:00Z", "path": "engine/src/main/java/org/terasology/input/lwjgl/LwjglMouseDevice.java", "diffHunk": "@@ -96,4 +108,31 @@ public void propertyChange(PropertyChangeEvent evt) {\n             this.uiScale = this.renderingConfig.getUiScale() / 100f;\n         }\n     }\n+\n+    private void cursorPosCallback(long window, double xpos, double ypos) {\n+        xposDelta = xpos - this.xpos;\n+        yposDelta = ypos - this.ypos;\n+        this.xpos = xpos;\n+        this.ypos = ypos;\n+    }\n+\n+    private void mouseButtonCallback(long window, int button, int action, int mods) {\n+        ButtonState state;\n+        if (action == GLFW.GLFW_PRESS) {\n+            state = ButtonState.DOWN;\n+        } else if (action == GLFW.GLFW_RELEASE) {\n+            state = ButtonState.UP;\n+        } else /*if (action == GLFW.GLFW_REPEAT)*/ {", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDI0NTQ1MQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r450245451", "bodyText": "It is some kind a hmm... opaque meaning definition. answer on future question: \"Why a else returns ButtonState.REPEAT?\"", "author": "DarkWeird", "createdAt": "2020-07-06T14:07:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5Njc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5Njg5NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449696895", "bodyText": "More mystery commented out code, made an earlier comment on this specifically, still curious :-)", "author": "Cervator", "createdAt": "2020-07-03T20:20:41Z", "path": "engine/src/main/java/org/terasology/logic/players/DebugControlSystem.java", "diffHunk": "@@ -140,7 +139,7 @@ public void onKeyDown(KeyDownEvent event, EntityRef entity) {\n                 mouseGrabbed = !mouseGrabbed;\n                 DebugProperties debugProperties = (DebugProperties) nuiManager.getHUD().getHUDElement(\"engine:DebugProperties\");\n                 debugProperties.setVisible(!mouseGrabbed);\n-                Mouse.setGrabbed(mouseGrabbed);\n+               // Mouse.setGrabbed(mouseGrabbed);", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NzA3NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449697075", "bodyText": "Empty javadoc", "author": "Cervator", "createdAt": "2020-07-03T20:21:52Z", "path": "engine/src/main/java/org/terasology/rendering/nui/internal/LwjglCanvasRenderer.java", "diffHunk": "@@ -83,6 +83,7 @@\n import static org.lwjgl.opengl.GL11.glTranslatef;\n \n /**\n+ *", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NzE2Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449697167", "bodyText": "?", "author": "Cervator", "createdAt": "2020-07-03T20:22:30Z", "path": "engine/src/main/java/org/terasology/rendering/opengl/LwjglFrameBufferObject.java", "diffHunk": "@@ -85,15 +84,15 @@ public void unbindFrame() {\n         glLoadIdentity();\n         glMatrixMode(GL_PROJECTION);\n         glLoadIdentity();\n-        glOrtho(0, Display.getWidth(), Display.getHeight(), 0, 0, 2048f);\n+        glOrtho(0, 500,500, 0, 0, 2048f);", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDAxODY4Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r450018683", "bodyText": "Forget ^_^ thx", "author": "DarkWeird", "createdAt": "2020-07-06T06:56:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NzE2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5NzM1NQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449697355", "bodyText": "Clarify? Or able to just do it? Or is it waiting for some future change first?", "author": "Cervator", "createdAt": "2020-07-03T20:23:35Z", "path": "engine/src/main/java/org/terasology/rendering/opengl/PBO.java", "diffHunk": "@@ -19,7 +19,7 @@\n \n import java.nio.ByteBuffer;\n \n-import static org.lwjgl.opengl.ARBBufferObject.*;\n+import static org.lwjgl.opengl.ARBVertexBufferObject.*; //TODO change this imports to GL15 (use above)", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5ODExMQ==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449698111", "bodyText": "Assuming this code is copy-pasted in from somewhere we should probably attribute it somehow rather than use author tags, which go against our style code. A link to some webpage covering it would be better? And of course the code license should be compatible for sure :-)\nSame goes for any other similar code in this PR\nAlso: We already have a Color class, but I suppose they're different?", "author": "Cervator", "createdAt": "2020-07-03T20:28:41Z", "path": "facades/PC/src/main/java/org/terasology/engine/splash/graphics/Color.java", "diffHunk": "@@ -0,0 +1,272 @@\n+/*\n+ * The MIT License\n+ *\n+ * Copyright \u00a9 2015, Heiko Brumme\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in\n+ * all copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n+ * THE SOFTWARE.\n+ */\n+\n+package org.terasology.engine.splash.graphics;\n+\n+import org.joml.Vector3f;\n+import org.joml.Vector4f;\n+\n+/**\n+ * This class represents a RGBA color.\n+ *\n+ * @author Heiko Brumme", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY5ODUwMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449698500", "bodyText": "Ah okay so here there are two license headers. Which looks a little odd.\nI do think we can mix them, but maybe we should still include some links, here and/or in the readme?\nOr maybe there's some way we can pull in this code via 3rd party jar or something, to avoid adding it to the repo?", "author": "Cervator", "createdAt": "2020-07-03T20:31:10Z", "path": "facades/PC/src/main/java/org/terasology/engine/splash/graphics/Renderer.java", "diffHunk": "@@ -0,0 +1,481 @@\n+// Copyright 2020 The Terasology Foundation\n+// SPDX-License-Identifier: Apache-2.0\n+\n+/*\n+ * The MIT License (MIT)\n+ *\n+ * Copyright \u00a9 2014-2018, Heiko Brumme\n+ *\n+ * Permission is hereby granted, free of charge, to any person obtaining a copy\n+ * of this software and associated documentation files (the \"Software\"), to deal\n+ * in the Software without restriction, including without limitation the rights\n+ * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+ * copies of the Software, and to permit persons to whom the Software is\n+ * furnished to do so, subject to the following conditions:\n+ *\n+ * The above copyright notice and this permission notice shall be included in all\n+ * copies or substantial portions of the Software.\n+ *\n+ * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+ * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+ * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+ * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+ * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+ * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+ * SOFTWARE.\n+ */\n+package org.terasology.engine.splash.graphics;\n+\n+import org.joml.Matrix4f;\n+import org.lwjgl.glfw.GLFW;\n+import org.lwjgl.system.MemoryStack;\n+import org.lwjgl.system.MemoryUtil;\n+import org.terasology.engine.splash.text.Font;\n+import org.terasology.rendering.dag.RenderGraph;\n+\n+import java.awt.FontFormatException;\n+import java.io.FileInputStream;\n+import java.io.IOException;\n+import java.nio.FloatBuffer;\n+import java.nio.IntBuffer;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+\n+import static org.lwjgl.opengl.GL11.GL_BLEND;\n+import static org.lwjgl.opengl.GL11.GL_COLOR_BUFFER_BIT;\n+import static org.lwjgl.opengl.GL11.GL_DEPTH_BUFFER_BIT;\n+import static org.lwjgl.opengl.GL11.GL_ONE_MINUS_SRC_ALPHA;\n+import static org.lwjgl.opengl.GL11.GL_SRC_ALPHA;\n+import static org.lwjgl.opengl.GL11.GL_TRIANGLES;\n+import static org.lwjgl.opengl.GL11.glBlendFunc;\n+import static org.lwjgl.opengl.GL11.glClear;\n+import static org.lwjgl.opengl.GL11.glDrawArrays;\n+import static org.lwjgl.opengl.GL11.glEnable;\n+import static org.lwjgl.opengl.GL15.GL_ARRAY_BUFFER;\n+import static org.lwjgl.opengl.GL15.GL_DYNAMIC_DRAW;\n+import static org.lwjgl.opengl.GL20.GL_FRAGMENT_SHADER;\n+import static org.lwjgl.opengl.GL20.GL_VERTEX_SHADER;\n+\n+/**\n+ * This class is performing the rendering process.\n+ *\n+ * @author Heiko Brumme", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTcwMDIyNg==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r449700226", "bodyText": "Seeing more of these files makes me think that yeah, maybe we should make this a quick jar file we could build and make available somewhere :-)\nMaybe not right this moment with this PR, but we could write a quick issue and extract it after", "author": "Cervator", "createdAt": "2020-07-03T20:42:54Z", "path": "facades/PC/src/main/java/org/terasology/engine/splash/graphics/Shader.java", "diffHunk": "@@ -0,0 +1,150 @@\n+/*\n+ * The MIT License (MIT)", "originalCommit": "a5401d2c0469fff8fbf2edf0f5e30989f0b7810c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8c53d5f2693c85b3434efa3fc5c5d83d13d8df69", "url": "https://github.com/MovingBlocks/Terasology/commit/8c53d5f2693c85b3434efa3fc5c5d83d13d8df69", "message": "refactor(lwjgl3):JavaDocs, CheckStyle issues, remove unused code", "committedDate": "2020-07-06T14:59:47Z", "type": "commit"}, {"oid": "1d998f6e38bc636ea2502f7a938a8df8be9e5a31", "url": "https://github.com/MovingBlocks/Terasology/commit/1d998f6e38bc636ea2502f7a938a8df8be9e5a31", "message": "refactor(lwjgl3):Remove UnusedCode", "committedDate": "2020-07-06T16:23:23Z", "type": "commit"}, {"oid": "f023fc572254f78e3d0aa5b9085970b9ab73f4d4", "url": "https://github.com/MovingBlocks/Terasology/commit/f023fc572254f78e3d0aa5b9085970b9ab73f4d4", "message": "feat(LWJGL3, NUI): Split \"Raw Input keys\" and \"Char Input\" in InputSystem and NUI.\nInput system and NUI have separate *Char(Event,Action) for text input now.\nUIWidget have onCharInput method now.\nAll Key actions and events haven't inputCharacter(text) now. only raw keys.", "committedDate": "2020-07-09T19:49:19Z", "type": "commit"}, {"oid": "35a226b6a94f3b2ddaa2c82d44cf6b0b4b6ec7fd", "url": "https://github.com/MovingBlocks/Terasology/commit/35a226b6a94f3b2ddaa2c82d44cf6b0b4b6ec7fd", "message": "feat(LWJGL3, NUI): Return OS's input events callback, consume key events is UIText active (Console, Chat)", "committedDate": "2020-07-13T15:55:23Z", "type": "commit"}, {"oid": "0c4eb7f2ac6d4b6c5898b88dc7e5b7bfb3fd5ba3", "url": "https://github.com/MovingBlocks/Terasology/commit/0c4eb7f2ac6d4b6c5898b88dc7e5b7bfb3fd5ba3", "message": "Merge remote-tracking branch 'tera/develop' into lwjgl3", "committedDate": "2020-07-28T17:34:24Z", "type": "commit"}, {"oid": "6ba9cea569f1c9627b66777662a9e514dc5ca4c7", "url": "https://github.com/MovingBlocks/Terasology/commit/6ba9cea569f1c9627b66777662a9e514dc5ca4c7", "message": "chore(lwjgl3): move GLFW SplashScreen code to `splash-screen` library.", "committedDate": "2020-07-28T18:16:47Z", "type": "commit"}, {"oid": "e212aa3802e8d323c4ec6f845bff2cc1f9e64b88", "url": "https://github.com/MovingBlocks/Terasology/commit/e212aa3802e8d323c4ec6f845bff2cc1f9e64b88", "message": "feat(lwjgl3): gradle task determinate Mac now. idea's run configs have run configs for Mac now.", "committedDate": "2020-07-28T19:57:28Z", "type": "commit"}, {"oid": "0883df83b2450ec39811aacbc0b47d355d1cf8d3", "url": "https://github.com/MovingBlocks/Terasology/commit/0883df83b2450ec39811aacbc0b47d355d1cf8d3", "message": "Merge PR #3969\n\n# Conflicts:\n#\tengine/src/main/java/org/terasology/rendering/cameras/OpenVRStereoCamera.java\n#\tengine/src/main/java/org/terasology/rendering/cameras/OrthographicCamera.java\n#\tengine/src/main/java/org/terasology/rendering/cameras/PerspectiveCamera.java", "committedDate": "2020-08-02T01:38:47Z", "type": "commit"}, {"oid": "0bbe546592ebe28006a312d319f059d36f9c6ae8", "url": "https://github.com/MovingBlocks/Terasology/commit/0bbe546592ebe28006a312d319f059d36f9c6ae8", "message": "chore: conflict resolution", "committedDate": "2020-08-02T02:01:17Z", "type": "commit"}, {"oid": "599d487bc1d59c0bc569146832ae0f54a373c6c0", "url": "https://github.com/MovingBlocks/Terasology/commit/599d487bc1d59c0bc569146832ae0f54a373c6c0", "message": "chore: use snapshot splash-screen for now", "committedDate": "2020-08-02T02:01:47Z", "type": "commit"}, {"oid": "9607b98d13e182d6f4f1c4dda4c93450091cf4b4", "url": "https://github.com/MovingBlocks/Terasology/commit/9607b98d13e182d6f4f1c4dda4c93450091cf4b4", "message": "Merge remote-tracking branch 'tera/develop' into lwjgl3", "committedDate": "2020-08-04T17:50:02Z", "type": "commit"}, {"oid": "d6e7fb34350749eee6da56b6eb4aec7a09fa4419", "url": "https://github.com/MovingBlocks/Terasology/commit/d6e7fb34350749eee6da56b6eb4aec7a09fa4419", "message": "Merge remote-tracking branch 'origin/develop' into lwjgl3\n\n# Conflicts:\n#\tengine/build.gradle\n#\tengine/src/main/java/org/terasology/rendering/backdrop/Skysphere.java\n#\tengine/src/main/java/org/terasology/rendering/nui/CoreLayout.java\n#\tengine/src/main/java/org/terasology/rendering/nui/CoreScreenLayer.java\n#\tengine/src/main/java/org/terasology/rendering/nui/CoreWidget.java\n#\tengine/src/main/java/org/terasology/rendering/nui/UIWidget.java\n#\tengine/src/main/java/org/terasology/rendering/nui/events/NUIKeyEvent.java\n#\tengine/src/main/java/org/terasology/rendering/nui/internal/LwjglCanvasRenderer.java\n#\tengine/src/main/java/org/terasology/rendering/nui/internal/NUIManagerInternal.java\n#\tengine/src/main/java/org/terasology/rendering/nui/widgets/UIText.java\n#\tfacades/PC/src/main/java/org/terasology/engine/Terasology.java", "committedDate": "2020-08-31T08:22:55Z", "type": "commit"}, {"oid": "83cc4a08a08773540f4c4a07047907fc0ed46a9f", "url": "https://github.com/MovingBlocks/Terasology/commit/83cc4a08a08773540f4c4a07047907fc0ed46a9f", "message": "fix(nui): NUI extraction compability", "committedDate": "2020-09-02T08:02:59Z", "type": "commit"}, {"oid": "cc3082fdc7de3ec1854fb27a5db8671390807238", "url": "https://github.com/MovingBlocks/Terasology/commit/cc3082fdc7de3ec1854fb27a5db8671390807238", "message": "Bump up teranui's version", "committedDate": "2020-09-02T08:49:47Z", "type": "commit"}, {"oid": "74aa3ccef40cb1d1e53110d25fe4854e3e20f9a3", "url": "https://github.com/MovingBlocks/Terasology/commit/74aa3ccef40cb1d1e53110d25fe4854e3e20f9a3", "message": "Merge remote-tracking branch 'origin/develop' into lwjgl3\n\n# Conflicts:\n#\tengine/build.gradle\n#\tengine/src/main/java/org/terasology/engine/subsystem/lwjgl/BaseLwjglSubsystem.java\n#\tengine/src/main/java/org/terasology/engine/subsystem/lwjgl/LwjglGraphics.java\n#\tengine/src/main/java/org/terasology/utilities/LWJGLHelper.java\n#\tfacades/PC/build.gradle", "committedDate": "2020-10-12T12:18:47Z", "type": "commit"}, {"oid": "6029073c03e41ab044bb8aa27cb468effbbd7a05", "url": "https://github.com/MovingBlocks/Terasology/commit/6029073c03e41ab044bb8aa27cb468effbbd7a05", "message": "chore(lwjgl3): minor refactoring", "committedDate": "2020-10-12T14:19:51Z", "type": "commit"}, {"oid": "9928964d2c3ddc0fb7b49703dae3915a25694daf", "url": "https://github.com/MovingBlocks/Terasology/commit/9928964d2c3ddc0fb7b49703dae3915a25694daf", "message": "fix: fix lwjgl3 running for Mac OS", "committedDate": "2020-10-13T12:49:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAxMjIwOA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r507012208", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    GL11.glLoadMatrixf(MatrixUtils.matrixToFloatBuffer(getViewMatrix()));\n          \n          \n            \n                    GL11.glLoadMatrixf(getViewMatrix().get(BufferUtils.createFloatBuffer(16));", "author": "pollend", "createdAt": "2020-10-18T03:41:05Z", "path": "engine/src/main/java/org/terasology/rendering/cameras/OpenVRStereoCamera.java", "diffHunk": "@@ -193,22 +193,22 @@ public Matrix4f getInverseViewProjectionMatrix() {\n     @Deprecated\n     public void loadProjectionMatrix() {\n         glMatrixMode(GL_PROJECTION);\n-        GL11.glLoadMatrix(getProjectionMatrix().get(BufferUtils.createFloatBuffer(16)));\n+        GL11.glLoadMatrixf(getProjectionMatrix().get(BufferUtils.createFloatBuffer(16)));\n         glMatrixMode(GL11.GL_MODELVIEW);\n     }\n \n     @Override\n     @Deprecated\n     public void loadModelViewMatrix() {\n         glMatrixMode(GL11.GL_MODELVIEW);\n-        GL11.glLoadMatrix(getViewMatrix().get(BufferUtils.createFloatBuffer(16)));\n+        GL11.glLoadMatrixf(MatrixUtils.matrixToFloatBuffer(getViewMatrix()));", "originalCommit": "9928964d2c3ddc0fb7b49703dae3915a25694daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAxMjI4Nw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r507012287", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    GL11.glLoadMatrixf(MatrixUtils.matrixToFloatBuffer(normViewMatrix));\n          \n          \n            \n                    GL11.glLoadMatrixf(normViewMatrix.get(BufferUtils.createFloatBuffer(16)));\n          \n      \n    \n    \n  \n\nMatrixUtils is deprecated.", "author": "pollend", "createdAt": "2020-10-18T03:42:22Z", "path": "engine/src/main/java/org/terasology/rendering/cameras/OpenVRStereoCamera.java", "diffHunk": "@@ -193,22 +193,22 @@ public Matrix4f getInverseViewProjectionMatrix() {\n     @Deprecated\n     public void loadProjectionMatrix() {\n         glMatrixMode(GL_PROJECTION);\n-        GL11.glLoadMatrix(getProjectionMatrix().get(BufferUtils.createFloatBuffer(16)));\n+        GL11.glLoadMatrixf(getProjectionMatrix().get(BufferUtils.createFloatBuffer(16)));\n         glMatrixMode(GL11.GL_MODELVIEW);\n     }\n \n     @Override\n     @Deprecated\n     public void loadModelViewMatrix() {\n         glMatrixMode(GL11.GL_MODELVIEW);\n-        GL11.glLoadMatrix(getViewMatrix().get(BufferUtils.createFloatBuffer(16)));\n+        GL11.glLoadMatrixf(MatrixUtils.matrixToFloatBuffer(getViewMatrix()));\n     }\n \n     @Override\n     @Deprecated\n     public void loadNormalizedModelViewMatrix() {\n         glMatrixMode(GL11.GL_MODELVIEW);\n-        GL11.glLoadMatrix(normViewMatrix.get(BufferUtils.createFloatBuffer(16)));\n+        GL11.glLoadMatrixf(MatrixUtils.matrixToFloatBuffer(normViewMatrix));", "originalCommit": "9928964d2c3ddc0fb7b49703dae3915a25694daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAxMjQ3MA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r507012470", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        GL11.glVertexPointer(2, 0,0, wrap(lineVertex));\n          \n          \n            \n                        GL11.glVertexPointer(2, 0, 0, wrap(lineVertex));", "author": "pollend", "createdAt": "2020-10-18T03:45:06Z", "path": "engine/src/main/java/org/terasology/rendering/nui/internal/LineRenderer.java", "diffHunk": "@@ -248,7 +248,7 @@ public static void draw(float x1, float y1, float x2, float y2, float width, Col\n                     x2 - tx - rx, y2 - ty - ry,\n                     x2 + tx + rx, y2 + ty + ry\n                 };\n-            GL11.glVertexPointer(2, 0, wrap(lineVertex));\n+            GL11.glVertexPointer(2, 0,0, wrap(lineVertex));", "originalCommit": "9928964d2c3ddc0fb7b49703dae3915a25694daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAxMjQ4Mw==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r507012483", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            GL11.glColorPointer(3, 0,0, wrap(lineColor));\n          \n          \n            \n                            GL11.glColorPointer(3, 0, 0, wrap(lineColor));", "author": "pollend", "createdAt": "2020-10-18T03:45:18Z", "path": "engine/src/main/java/org/terasology/rendering/nui/internal/LineRenderer.java", "diffHunk": "@@ -262,7 +262,7 @@ public static void draw(float x1, float y1, float x2, float y2, float width, Col\n                         cRed, cGreen, cBlue,\n                         cRed, cGreen, cBlue\n                     };\n-                GL11.glColorPointer(3, 0, wrap(lineColor));\n+                GL11.glColorPointer(3, 0,0, wrap(lineColor));", "originalCommit": "9928964d2c3ddc0fb7b49703dae3915a25694daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAxMjUxMA==", "url": "https://github.com/MovingBlocks/Terasology/pull/3969#discussion_r507012510", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            GL11.glColorPointer(4, 0,0, wrap(lineColor));\n          \n          \n            \n                            GL11.glColorPointer(4, 0, 0, wrap(lineColor));", "author": "pollend", "createdAt": "2020-10-18T03:45:29Z", "path": "engine/src/main/java/org/terasology/rendering/nui/internal/LineRenderer.java", "diffHunk": "@@ -275,7 +275,7 @@ public static void draw(float x1, float y1, float x2, float y2, float width, Col\n                         cRed, cGreen, cBlue, a,\n                         cRed, cGreen, cBlue, a\n                     };\n-                GL11.glColorPointer(4, 0, wrap(lineColor));\n+                GL11.glColorPointer(4, 0,0, wrap(lineColor));", "originalCommit": "9928964d2c3ddc0fb7b49703dae3915a25694daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d3909c1aa69388f3fbf4b520e3da40fa06db119", "url": "https://github.com/MovingBlocks/Terasology/commit/4d3909c1aa69388f3fbf4b520e3da40fa06db119", "message": "feat(LWGJL3): twaek mouse delta", "committedDate": "2020-10-18T18:39:06Z", "type": "commit"}, {"oid": "ce88be52f632eea4e0d314d314b1edfdf4f1e8d2", "url": "https://github.com/MovingBlocks/Terasology/commit/ce88be52f632eea4e0d314d314b1edfdf4f1e8d2", "message": "Update LwjglMouseDevice.java", "committedDate": "2020-10-18T19:41:48Z", "type": "commit"}, {"oid": "7800b196cb1bcbac5f872f0bc4bd647629c17a24", "url": "https://github.com/MovingBlocks/Terasology/commit/7800b196cb1bcbac5f872f0bc4bd647629c17a24", "message": "Merge pull request #1 from pollend/DwarkWeird-lwgjl3-input-tweak\n\nfeat(LWGJL3): twaek mouse delta", "committedDate": "2020-10-18T19:43:25Z", "type": "commit"}, {"oid": "b123c1ca27c3bdf0c0af0db524a8ad630c280847", "url": "https://github.com/MovingBlocks/Terasology/commit/b123c1ca27c3bdf0c0af0db524a8ad630c280847", "message": "feat(lwjgl3): Fix Gradle's run configuration for MacOS", "committedDate": "2020-10-19T06:40:48Z", "type": "commit"}, {"oid": "e8a4e1b229b06fb72b298c75214a10e3166eaba8", "url": "https://github.com/MovingBlocks/Terasology/commit/e8a4e1b229b06fb72b298c75214a10e3166eaba8", "message": "chore(lwjgl3): Change to usage not depricated code for OpenVRStereoCamera and Reformat LineRenderer", "committedDate": "2020-10-19T07:18:34Z", "type": "commit"}, {"oid": "00506962946adaf42bcee50ac1ac6a42a568d4f5", "url": "https://github.com/MovingBlocks/Terasology/commit/00506962946adaf42bcee50ac1ac6a42a568d4f5", "message": "Merge remote-tracking branch 'origin/develop' into lwjgl3\n\n# Conflicts:\n#\tfacades/PC/build.gradle", "committedDate": "2020-10-21T14:24:06Z", "type": "commit"}, {"oid": "02736ba76324d0e70591772dcf0b6849615193f5", "url": "https://github.com/MovingBlocks/Terasology/commit/02736ba76324d0e70591772dcf0b6849615193f5", "message": "Merge branch 'develop' into lwjgl3", "committedDate": "2020-10-23T06:50:56Z", "type": "commit"}, {"oid": "adb8075fed2516f327f391d830a82774386ad7f8", "url": "https://github.com/MovingBlocks/Terasology/commit/adb8075fed2516f327f391d830a82774386ad7f8", "message": "fix(build): added \"java-platform\" gradle plagin for \"platform\"/BOM dependencies. Seems, broken after upgrading gradle to version 6.7", "committedDate": "2020-10-23T07:47:12Z", "type": "commit"}, {"oid": "c83655fb94c02d68fb8ba31fdb1954e81dde12d6", "url": "https://github.com/MovingBlocks/Terasology/commit/c83655fb94c02d68fb8ba31fdb1954e81dde12d6", "message": "fix(lwjgl3): fix lgtm issues", "committedDate": "2020-10-23T08:08:46Z", "type": "commit"}]}