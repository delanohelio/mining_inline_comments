{"pr_number": 2886, "pr_title": "Introduce tenant qualified url support for accountrecovery endpoint", "pr_createdAt": "2020-04-20T15:55:18Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2886", "timeline": [{"oid": "ce3b8a40ad8fd5f34bfe4f96f7628e8930b2e4b4", "url": "https://github.com/wso2/carbon-identity-framework/commit/ce3b8a40ad8fd5f34bfe4f96f7628e8930b2e4b4", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-20T15:55:58Z", "type": "forcePushed"}, {"oid": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "url": "https://github.com/wso2/carbon-identity-framework/commit/e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-20T16:05:37Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMjU1NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411512554", "bodyText": "Wouldn't it be better to log the error?", "author": "mefarazath", "createdAt": "2020-04-20T16:20:06Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.endpoint.util/src/main/java/org/wso2/carbon/identity/application/authentication/endpoint/util/AuthenticationEndpointUtil.java", "diffHunk": "@@ -193,5 +195,20 @@ public static String customi18n(ResourceBundle resourceBundle, String key) {\n             return i18nBase64(resourceBundle, key);\n         }\n     }\n+\n+    /**\n+     * Build Tenant Qualified Url.\n+     *\n+     * @param context Context.\n+     * @return Tenant Qualified Url.\n+     */\n+    public static String buildTenantQualifiedUrl(String context) {\n+\n+        try {\n+            return ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+        } catch (URLBuilderException e) {\n+            return null;", "originalCommit": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMzQ4MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411513481", "bodyText": "Wouldn't it be better if we throw a wrapped exception and handle at the consuming places?", "author": "mefarazath", "createdAt": "2020-04-20T16:21:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMjU1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NDQ5NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414384495", "bodyText": "Updated the PR as discussed.", "author": "ashensw", "createdAt": "2020-04-24T08:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMjU1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMzgzOA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411513838", "bodyText": "Can't we throw the error and handle at the places where we consume the API?", "author": "mefarazath", "createdAt": "2020-04-20T16:21:54Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -641,4 +643,19 @@ public static void setOptions(ServiceClient client, String accessUsername, Strin\n \n         IdentityManagementServiceUtil.setAutheticationOptions(client, accessUsername, accessPassword);\n     }\n+\n+    /**\n+     * Build Tenant Qualified Url.\n+     *\n+     * @param context Context.\n+     * @return Tenant Qualified Url.\n+     */\n+    public static String buildTenantQualifiedUrl(String context) {\n+\n+        try {\n+            return ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+        } catch (URLBuilderException e) {\n+            throw new IdentityRuntimeException(\"Error while building url for context: \" + context);", "originalCommit": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NTAwOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414385009", "bodyText": "Updated the PR with the fix.", "author": "ashensw", "createdAt": "2020-04-24T08:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxMzgzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxNDQ1Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411514453", "bodyText": "Can't we the buildTenantQualifiedUrl() method here too?", "author": "mefarazath", "createdAt": "2020-04-20T16:22:46Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/SecurityQuestionApi.java", "diffHunk": "@@ -193,9 +194,12 @@ public InitiateAllQuestionResponse securityQuestionsGet(String username, String\n             tenantDomain = MultitenantConstants.SUPER_TENANT_DOMAIN_NAME;\n         }\n \n-        if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n-            basePath = IdentityManagementEndpointUtil.buildEndpointUrl(\"t/\" + tenantDomain +\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            basePath = IdentityManagementEndpointUtil.buildTenantQualifiedUrl(\n                     IdentityManagementEndpointConstants.UserInfoRecovery.RECOVERY_API_RELATIVE_PATH);\n+        } else if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+            basePath = IdentityManagementEndpointUtil.buildEndpointUrl(\"t/\" + tenantDomain", "originalCommit": "e1206ad39be6dd2b7fdc4f721496ce58bfd75539", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU3MTc0Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411571746", "bodyText": "It's already used here.", "author": "ashensw", "createdAt": "2020-04-20T17:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxNDQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxNzA1MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411817050", "bodyText": "What if we move this base path building logic to the util as a whole. Because even the tenant qualified url there is actually not building a tenant qualified url always.\nThe whole segment here is about building the base url of the service", "author": "malithie", "createdAt": "2020-04-21T02:13:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxNDQ1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NDc4NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414384785", "bodyText": "Updated the PR as discussed.", "author": "ashensw", "createdAt": "2020-04-24T08:15:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUxNDQ1Mw=="}], "type": "inlineReview"}, {"oid": "c12964893c9330f741a6031911c5405af9261d43", "url": "https://github.com/wso2/carbon-identity-framework/commit/c12964893c9330f741a6031911c5405af9261d43", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-20T17:44:19Z", "type": "forcePushed"}, {"oid": "f997550670be2707855183e6973da2660b1de5a7", "url": "https://github.com/wso2/carbon-identity-framework/commit/f997550670be2707855183e6973da2660b1de5a7", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-20T18:54:08Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjIzOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411812239", "bodyText": "Actually this is not just building a tenant qualified url right. Based on the mode it may or not. I think we have to rename this method", "author": "malithie", "createdAt": "2020-04-21T01:58:30Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.endpoint.util/src/main/java/org/wso2/carbon/identity/application/authentication/endpoint/util/AuthenticationEndpointUtil.java", "diffHunk": "@@ -193,5 +195,17 @@ public static String customi18n(ResourceBundle resourceBundle, String key) {\n             return i18nBase64(resourceBundle, key);\n         }\n     }\n+\n+    /**\n+     * Build Tenant Qualified Url.\n+     *\n+     * @param context Context.\n+     * @return Tenant Qualified Url.\n+     * @throws URLBuilderException URLBuilderException.\n+     */\n+    public static String buildTenantQualifiedUrl(String context) throws URLBuilderException {", "originalCommit": "f997550670be2707855183e6973da2660b1de5a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NTI3NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414385274", "bodyText": "Renamed the method accordingly.", "author": "ashensw", "createdAt": "2020-04-24T08:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjIzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjk5Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411812996", "bodyText": "At non tenated mode will this API return a tenanted URL.\nUser portal url was always tenanted I guess", "author": "malithie", "createdAt": "2020-04-21T02:00:44Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -140,7 +141,13 @@ public static final String getUserPortalUrl(String userPortalUrl) {\n         if (StringUtils.isNotBlank(userPortalUrl)) {\n             return userPortalUrl;\n         }\n-        return IdentityUtil.getServerURL(IdentityManagementEndpointConstants.USER_PORTAL_URL, true, true);\n+        try {\n+            return ServiceURLBuilder.create().addPath(IdentityManagementEndpointConstants.USER_PORTAL_URL).build()\n+                    .getAbsolutePublicURL();", "originalCommit": "f997550670be2707855183e6973da2660b1de5a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMzk4Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411813983", "bodyText": "Or else has the tenant been appended some where else", "author": "malithie", "createdAt": "2020-04-21T02:03:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NDY2Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413564663", "bodyText": "@ashensw , in legacy way when invoked from a tenant, has the user portal endpoint being tenant qualified appending tenant in path is some where else ?\nIf that's the case, that respective place will have to make sure that tenant is appended only in legacy mode right.\nBecause, the new API will tenant qualify the endpoint internally", "author": "malithie", "createdAt": "2020-04-23T07:07:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzc0MDU1Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413740556", "bodyText": "Nope. I don't see such a place that appends the tenant domain explicitly. This seems to used to get the old dashboard URL actually.", "author": "ashensw", "createdAt": "2020-04-23T11:36:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjk5Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4NjkyNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414486926", "bodyText": "ok. but I think we should further check how user portal worked previously in tenant cases.\nShall we track this and proceed with this fix", "author": "malithie", "createdAt": "2020-04-24T10:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxMjk5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxNzUyMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411817522", "bodyText": "What is this 'isEndpointTenantAware' property is used for ?", "author": "malithie", "createdAt": "2020-04-21T02:14:34Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/UsernameRecoveryApi.java", "diffHunk": "@@ -233,4 +224,17 @@ public void recoverUsernamePost(List<UserClaim> claim, String tenantDomain, Bool\n     return apiClient.invokeAPI(localVarPath, \"GET\", localVarQueryParams, null, localVarHeaderParams, localVarFormParams,\n             localVarAccept, localVarContentType, localVarAuthNames, localVarReturnType);\n   }\n+\n+  private void setBasePath(boolean isEndpointTenantAware, String tenantDomain) {\n+\n+    if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+      basePath = IdentityManagementEndpointUtil\n+              .buildTenantQualifiedUrl(IdentityManagementEndpointConstants.UserInfoRecovery.USER_API_RELATIVE_PATH);\n+    } else if (isEndpointTenantAware && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {", "originalCommit": "f997550670be2707855183e6973da2660b1de5a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NTk2MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414385961", "bodyText": "It's has been used in legacy mode to defend whether the endpoint needs to be tenant qualified.", "author": "ashensw", "createdAt": "2020-04-24T08:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgxNzUyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg3NzYwMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r411877602", "bodyText": "Cant't we make  \"t/\" as a constant? Since it s been used in several places.", "author": "denuwanthi", "createdAt": "2020-04-21T05:22:47Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/SelfRegisterApi.java", "diffHunk": "@@ -240,4 +226,16 @@ public void validateCodePostCall(CodeValidationRequest code) throws ApiException\n         };\n         apiClient.invokeAPI(localVarPath, \"POST\", localVarQueryParams, localVarPostBody, localVarHeaderParams, localVarFormParams, localVarAccept, localVarContentType, localVarAuthNames, localVarReturnType);\n     }\n+\n+    private void setBasePath(String tenantDomain) {\n+\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            basePath = IdentityManagementEndpointUtil.buildTenantQualifiedUrl(\n+                    IdentityManagementEndpointConstants.UserInfoRecovery.USER_API_RELATIVE_PATH);\n+        } else if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+            basePath = IdentityManagementEndpointUtil.buildEndpointUrl(\n+                    \"t/\" + tenantDomain + IdentityManagementEndpointConstants.UserInfoRecovery.USER_API_RELATIVE_PATH);", "originalCommit": "f997550670be2707855183e6973da2660b1de5a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NzExOA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414387118", "bodyText": "This method has been removed.", "author": "ashensw", "createdAt": "2020-04-24T08:19:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg3NzYwMg=="}], "type": "inlineReview"}, {"oid": "8e0ad720c332ee220af8ad53f7feda563431622a", "url": "https://github.com/wso2/carbon-identity-framework/commit/8e0ad720c332ee220af8ad53f7feda563431622a", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-21T11:23:26Z", "type": "forcePushed"}, {"oid": "ad997b026eac17d876d2d6d2cf6617706afa881f", "url": "https://github.com/wso2/carbon-identity-framework/commit/ad997b026eac17d876d2d6d2cf6617706afa881f", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-21T11:31:04Z", "type": "forcePushed"}, {"oid": "a0c479294072596f956ea15e710e3e5e41600d17", "url": "https://github.com/wso2/carbon-identity-framework/commit/a0c479294072596f956ea15e710e3e5e41600d17", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-21T17:41:20Z", "type": "forcePushed"}, {"oid": "b5b87069d988a729cf9efae55d27278790f1ac57", "url": "https://github.com/wso2/carbon-identity-framework/commit/b5b87069d988a729cf9efae55d27278790f1ac57", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-21T20:45:49Z", "type": "forcePushed"}, {"oid": "82904d38da983fc62ef813a624ba46b9dfd49dca", "url": "https://github.com/wso2/carbon-identity-framework/commit/82904d38da983fc62ef813a624ba46b9dfd49dca", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-22T09:19:10Z", "type": "forcePushed"}, {"oid": "9b61a7af6412b27e211e0dcd0bf35463e488b088", "url": "https://github.com/wso2/carbon-identity-framework/commit/9b61a7af6412b27e211e0dcd0bf35463e488b088", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-22T19:44:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NjEwMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413566103", "bodyText": "Rather than depending on the tenant domain passed and addressing the legacy mode, we should rely only on the configuration.\nBecause, later some might use the same method in an unintended way", "author": "malithie", "createdAt": "2020-04-23T07:10:29Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -513,12 +522,34 @@ public static String getURLEncodedCallback(String callbackUrl) throws URISyntaxE\n         return encodedQueryMap;\n     }\n \n+    /**\n+     * Construct the server URL depending on the path and the resource name.\n+     *\n+     * @param tenantDomain tenant Domain.\n+     * @param context      context of the url.\n+     * @return endpoint url.\n+     */\n+    public static String buildServerUrl(String tenantDomain, String context) throws URLBuilderException {\n+\n+        String serverUrl = IdentityManagementServiceUtil.getInstance().getContextURL();\n+        if (StringUtils.isBlank(serverUrl)) {\n+            return ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+        } else if (StringUtils.isBlank(tenantDomain)) {\n+            return serverUrl + context;\n+        } else {\n+            return serverUrl + \"/t/\" + tenantDomain + context;\n+        }", "originalCommit": "9b61a7af6412b27e211e0dcd0bf35463e488b088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NjcyNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413566727", "bodyText": "May be you case pass some fields to decide whether to append tenant in legacy mode or not", "author": "malithie", "createdAt": "2020-04-23T07:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NjEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU3NTYxNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413575614", "bodyText": "From the way this API is being utilized below, seems it is used to build the url at non tenanted mode.\nI don't think we should make this public.\nUnless we can handle this from one public API let's rename this method to denote the case that this is to be invoked at non tenanted mode.", "author": "malithie", "createdAt": "2020-04-23T07:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NjEwMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NjQ1Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414386452", "bodyText": "Changed the method as discussed.", "author": "ashensw", "createdAt": "2020-04-24T08:18:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2NjEwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2OTE2Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413569162", "bodyText": "We are calling an internal method any way right. No need of using 'IdentityManagementEndpointUtil'", "author": "malithie", "createdAt": "2020-04-23T07:15:52Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -641,4 +664,57 @@ public static void setOptions(ServiceClient client, String accessUsername, Strin\n \n         IdentityManagementServiceUtil.setAutheticationOptions(client, accessUsername, accessPassword);\n     }\n+\n+    /**\n+     * Get base path URL for API clients.\n+     *\n+     * @param tenantDomain tenant Domain.\n+     * @param context      URL context.\n+     * @return base path.\n+     * @throws ApiException ApiException.\n+     */\n+    public static String getBasePath(String tenantDomain, String context) throws ApiException {\n+\n+        String basePath = null;\n+        try {\n+            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+            } else {\n+                if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                    basePath = IdentityManagementEndpointUtil.buildServerUrl(tenantDomain, context);", "originalCommit": "9b61a7af6412b27e211e0dcd0bf35463e488b088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NjcyMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414386721", "bodyText": "Yes. Updated the PR accordingly.", "author": "ashensw", "createdAt": "2020-04-24T08:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2OTE2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2OTM0MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r413569340", "bodyText": "Same above applies here", "author": "malithie", "createdAt": "2020-04-23T07:16:06Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -641,4 +664,57 @@ public static void setOptions(ServiceClient client, String accessUsername, Strin\n \n         IdentityManagementServiceUtil.setAutheticationOptions(client, accessUsername, accessPassword);\n     }\n+\n+    /**\n+     * Get base path URL for API clients.\n+     *\n+     * @param tenantDomain tenant Domain.\n+     * @param context      URL context.\n+     * @return base path.\n+     * @throws ApiException ApiException.\n+     */\n+    public static String getBasePath(String tenantDomain, String context) throws ApiException {\n+\n+        String basePath = null;\n+        try {\n+            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+            } else {\n+                if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                    basePath = IdentityManagementEndpointUtil.buildServerUrl(tenantDomain, context);\n+                }\n+            }\n+        } catch (URLBuilderException e) {\n+            throw new ApiException(\"Error while building url for context: \" + context);\n+        }\n+        return basePath;\n+    }\n+\n+    /**\n+     * Get base path URL for API clients.\n+     *\n+     * @param tenantDomain          tenant Domain.\n+     * @param context               URL context.\n+     * @param isEndpointTenantAware whether the endpoint is tenant aware.\n+     * @return base path.\n+     * @throws ApiException ApiException.\n+     */\n+    public static String getBasePath(String tenantDomain, String context, boolean isEndpointTenantAware)\n+            throws ApiException {\n+\n+        String basePath = null;\n+        try {\n+            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n+            } else {\n+                if (isEndpointTenantAware && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME\n+                        .equalsIgnoreCase(tenantDomain)) {\n+                    basePath = IdentityManagementEndpointUtil.buildServerUrl(tenantDomain, context);", "originalCommit": "9b61a7af6412b27e211e0dcd0bf35463e488b088", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM4NjgxNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414386817", "bodyText": "Yes. Updated the PR accordingly.", "author": "ashensw", "createdAt": "2020-04-24T08:18:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzU2OTM0MA=="}], "type": "inlineReview"}, {"oid": "70741561b83a981ba9cc5641a791f0a4a2619158", "url": "https://github.com/wso2/carbon-identity-framework/commit/70741561b83a981ba9cc5641a791f0a4a2619158", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-23T19:40:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4OTU1OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414489558", "bodyText": "Is this kept for the legacy behavior", "author": "malithie", "createdAt": "2020-04-24T11:04:33Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementServiceUtil.java", "diffHunk": "@@ -123,6 +124,7 @@ public void init() {\n                     .APP_PASSWORD).toCharArray();\n             String serviceContextURL = properties\n                     .getProperty(IdentityManagementEndpointConstants.ServiceConfigConstants.SERVICE_CONTEXT_URL);\n+            contextURL = serviceContextURL;\n             this.serviceContextURL = StringUtils.isBlank(serviceContextURL) ? IdentityUtil.getServerURL(\n                     IdentityUtil.getServicePath(), true, true) : serviceContextURL;", "originalCommit": "70741561b83a981ba9cc5641a791f0a4a2619158", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ5MDkyMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414490922", "bodyText": "Yes. This is only used by the deprecated util method.", "author": "ashensw", "createdAt": "2020-04-24T11:07:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQ4OTU1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwMDI1Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414500252", "bodyText": "Not used ?", "author": "malithie", "createdAt": "2020-04-24T11:23:50Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/PasswordRecoveryApi.java", "diffHunk": "@@ -245,6 +235,7 @@ public InitiateAllQuestionResponse securityQuestionsGet(String username, String\n      * @param resetPasswordRequest key, password and optional metadata properties (required)\n      * @throws ApiException if fails to make API call\n      */\n+    @Deprecated", "originalCommit": "70741561b83a981ba9cc5641a791f0a4a2619158", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwNTIwOA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414505208", "bodyText": "No. I checked in the accountrecoveryendpoint. This API has been used as an alternative. \n  \n    \n      carbon-identity-framework/components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/client/api/NotificationApi.java\n    \n    \n         Line 208\n      in\n      7074156\n    \n    \n    \n    \n\n        \n          \n           public void setPasswordPost(ResetPasswordRequest resetPasswordRequest) throws ApiException {", "author": "ashensw", "createdAt": "2020-04-24T11:32:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwMDI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwNjYwNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2886#discussion_r414506605", "bodyText": "https://github.com/wso2/identity-apps/blob/8de1bc2d7e21694046b863e91a66b80ee61bdcb6/apps/recovery-portal/src/main/webapp/password-reset-complete.jsp#L84", "author": "ashensw", "createdAt": "2020-04-24T11:35:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwMDI1Mg=="}], "type": "inlineReview"}, {"oid": "8b88b940f4661b55b23a95bc69519c8a5245cb1f", "url": "https://github.com/wso2/carbon-identity-framework/commit/8b88b940f4661b55b23a95bc69519c8a5245cb1f", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-24T11:36:37Z", "type": "forcePushed"}, {"oid": "fa9721dd8ab266d128d0b71fb0843711ce6add64", "url": "https://github.com/wso2/carbon-identity-framework/commit/fa9721dd8ab266d128d0b71fb0843711ce6add64", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-24T12:30:07Z", "type": "commit"}, {"oid": "fa9721dd8ab266d128d0b71fb0843711ce6add64", "url": "https://github.com/wso2/carbon-identity-framework/commit/fa9721dd8ab266d128d0b71fb0843711ce6add64", "message": "Introduce tenant qualified url support", "committedDate": "2020-04-24T12:30:07Z", "type": "forcePushed"}]}