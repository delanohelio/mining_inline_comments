{"pr_number": 2996, "pr_title": "Deprecate Template Mgt API", "pr_createdAt": "2020-07-02T09:32:56Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2996", "timeline": [{"oid": "ead2ceb5fd4a0f98162e2711687a304b981f0e57", "url": "https://github.com/wso2/carbon-identity-framework/commit/ead2ceb5fd4a0f98162e2711687a304b981f0e57", "message": "Deprecate Template Mgt API", "committedDate": "2020-07-02T09:26:56Z", "type": "commit"}, {"oid": "44305e5a87ea8758157cba00df542b2a676e1a53", "url": "https://github.com/wso2/carbon-identity-framework/commit/44305e5a87ea8758157cba00df542b2a676e1a53", "message": "Remove unnecessary variable", "committedDate": "2020-07-02T09:30:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1ODM3NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r448958374", "bodyText": "do not deprecate template mgt core classes. only deprecate template mgt endpoint.", "author": "emswbandara", "createdAt": "2020-07-02T12:16:08Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt/src/main/java/org/wso2/carbon/identity/template/mgt/TemplateManager.java", "diffHunk": "@@ -30,6 +30,7 @@\n  *\n  * @since 1.0.0\n  */\n+@Deprecated", "originalCommit": "44305e5a87ea8758157cba00df542b2a676e1a53", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAwNjkwNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449006906", "bodyText": "Fixed 51d084a", "author": "GANGANI", "createdAt": "2020-07-02T13:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODk1ODM3NA=="}], "type": "inlineReview"}, {"oid": "51d084a813c79c52636b52d39f06a834dcb09ed1", "url": "https://github.com/wso2/carbon-identity-framework/commit/51d084a813c79c52636b52d39f06a834dcb09ed1", "message": "Remove some deprecated annotations", "committedDate": "2020-07-02T13:35:56Z", "type": "commit"}, {"oid": "4d00a76850571d0a2fa8c9f5dfdb667d1c65e134", "url": "https://github.com/wso2/carbon-identity-framework/commit/4d00a76850571d0a2fa8c9f5dfdb667d1c65e134", "message": "Forbidden error for tempt-mgt API invocation", "committedDate": "2020-07-03T04:56:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MTc0Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449391746", "bodyText": "shall we keep the old code as it is without removing? we can return forbidden from the beginning of the function", "author": "emswbandara", "createdAt": "2020-07-03T06:04:54Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt.endpoint/src/main/java/org/wso2/carbon/identity/template/mgt/endpoint/impl/TemplatesApiServiceImpl.java", "diffHunk": "@@ -47,98 +47,39 @@\n import static org.wso2.carbon.identity.template.mgt.TemplateMgtConstants.ErrorMessages.ERROR_CODE_UNEXPECTED;\n import static org.wso2.carbon.identity.template.mgt.TemplateMgtConstants.ErrorMessages.ERROR_CODE_USER_NOT_AUTHORIZED;\n \n-public class\n-TemplatesApiServiceImpl extends TemplatesApiService {\n+@Deprecated\n+public class TemplatesApiServiceImpl extends TemplatesApiService {\n \n     private static final Log LOG = LogFactory.getLog(TemplatesApiServiceImpl.class);\n \n     @Override\n     public Response addTemplate(TemplateDTO template) {\n \n-        try {\n-            TemplateResponseDTO response = postTemplate(template);", "originalCommit": "4d00a76850571d0a2fa8c9f5dfdb667d1c65e134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ5NzUyNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449497525", "bodyText": "can't keep the old code as it shows error \"unreachable statement\" when returning forbidden from the beginning of the function.", "author": "GANGANI", "createdAt": "2020-07-03T10:01:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MTc0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MjE1Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449392156", "bodyText": "this is also a test class of a core class.. let's keep it", "author": "emswbandara", "createdAt": "2020-07-03T06:06:29Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt/src/test/java/org/wso2/carbon/identity/template/mgt/TemplateManagerImplTest.java", "diffHunk": "@@ -53,6 +53,7 @@\n import static org.wso2.carbon.identity.template.mgt.util.TestUtils.mockDataSource;\n import static org.wso2.carbon.identity.template.mgt.util.TestUtils.spyConnection;\n \n+@Deprecated", "originalCommit": "4d00a76850571d0a2fa8c9f5dfdb667d1c65e134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ5NzU0OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449497549", "bodyText": "Fixed 1aa997d", "author": "GANGANI", "createdAt": "2020-07-03T10:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MjE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MjM2OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449392369", "bodyText": "remove deprecated tag from the classes in org.wso2.carbon.identity.template.mgt module", "author": "emswbandara", "createdAt": "2020-07-03T06:07:18Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt/src/test/java/org/wso2/carbon/identity/template/mgt/dao/impl/TemplateManagerDAOImplTest.java", "diffHunk": "@@ -47,6 +47,7 @@\n import static org.wso2.carbon.identity.template.mgt.util.TestUtils.mockDataSource;\n import static org.wso2.carbon.identity.template.mgt.util.TestUtils.spyConnection;\n \n+@Deprecated", "originalCommit": "4d00a76850571d0a2fa8c9f5dfdb667d1c65e134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ5NzU1NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449497554", "bodyText": "Fixed 1aa997d", "author": "GANGANI", "createdAt": "2020-07-03T10:01:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTM5MjM2OQ=="}], "type": "inlineReview"}, {"oid": "1aa997d374f2254338f5287b2bc2fef815104ff3", "url": "https://github.com/wso2/carbon-identity-framework/commit/1aa997d374f2254338f5287b2bc2fef815104ff3", "message": "Address comments", "committedDate": "2020-07-03T09:59:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzA5MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449523090", "bodyText": "remove unncessary lines", "author": "emswbandara", "createdAt": "2020-07-03T10:59:44Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt/src/test/java/org/wso2/carbon/identity/template/mgt/model/TemplateInfoTest.java", "diffHunk": "@@ -21,6 +21,7 @@\n import org.testng.Assert;\n import org.testng.annotations.Test;\n \n+", "originalCommit": "1aa997d374f2254338f5287b2bc2fef815104ff3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgzNzI3MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449837271", "bodyText": "Fixed 59a2241", "author": "GANGANI", "createdAt": "2020-07-05T05:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzE2NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449523164", "bodyText": "remove unncessary lines", "author": "emswbandara", "createdAt": "2020-07-03T10:59:53Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt/src/test/java/org/wso2/carbon/identity/template/mgt/model/TemplateTest.java", "diffHunk": "@@ -22,6 +22,7 @@\n import org.testng.annotations.Test;\n import org.wso2.carbon.identity.template.mgt.TemplateMgtConstants;\n \n+", "originalCommit": "1aa997d374f2254338f5287b2bc2fef815104ff3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgzNzMxMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449837313", "bodyText": "Fixed 59a2241", "author": "GANGANI", "createdAt": "2020-07-05T05:47:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzE2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzY0OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449523648", "bodyText": "shall we say Template-mgt API is restricted or something similar", "author": "emswbandara", "createdAt": "2020-07-03T11:01:06Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt/src/main/java/org/wso2/carbon/identity/template/mgt/TemplateMgtConstants.java", "diffHunk": "@@ -43,6 +43,9 @@\n     public static final String HEADER_CONTENT_TYPE = \"Content-Type\";\n     public static final String DEFAULT_RESPONSE_CONTENT_TYPE = APPLICATION_JSON;\n     public static final String STATUS_BAD_REQUEST_MESSAGE_DEFAULT = \"Bad Request\";\n+    public static final String FORBIDDEN = \"Forbidden\";\n+    public static final String FORBIDDEN_ERROR_CODE = \"403\";\n+    public static final String FORBIDDEN_ERROR_MESSAGE= \"Template-mgt API is not supported\";", "originalCommit": "1aa997d374f2254338f5287b2bc2fef815104ff3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgzNzMwMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r449837301", "bodyText": "Fixed 59a2241", "author": "GANGANI", "createdAt": "2020-07-05T05:47:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTUyMzY0OA=="}], "type": "inlineReview"}, {"oid": "59a224166a3a049623549bb53ac550322a2eaee0", "url": "https://github.com/wso2/carbon-identity-framework/commit/59a224166a3a049623549bb53ac550322a2eaee0", "message": "Change error message", "committedDate": "2020-07-05T05:38:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxMDA5MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r450210091", "bodyText": "add new line after method declaration", "author": "emswbandara", "createdAt": "2020-07-06T13:12:11Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt.endpoint/src/main/java/org/wso2/carbon/identity/template/mgt/endpoint/impl/TemplatesApiServiceImpl.java", "diffHunk": "@@ -213,6 +154,10 @@ private Response handleBadRequestResponse(TemplateManagementClientException e) {\n         throw TemplateEndpointUtils.buildBadRequestException(e.getMessage(), e.getErrorCode(), LOG, e);\n     }\n \n+    private Response handleForbiddenRequest() {", "originalCommit": "59a224166a3a049623549bb53ac550322a2eaee0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDU3NDg0Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r450574847", "bodyText": "Fixed a88ebda", "author": "GANGANI", "createdAt": "2020-07-07T02:18:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDIxMDA5MQ=="}], "type": "inlineReview"}, {"oid": "a88ebda2efe398dc4a2c32556f7c6a3a3d7ea958", "url": "https://github.com/wso2/carbon-identity-framework/commit/a88ebda2efe398dc4a2c32556f7c6a3a3d7ea958", "message": "Format code", "committedDate": "2020-07-07T02:17:45Z", "type": "commit"}, {"oid": "360b67c018e7e7e32f0b8ab3d8dac625b21de822", "url": "https://github.com/wso2/carbon-identity-framework/commit/360b67c018e7e7e32f0b8ab3d8dac625b21de822", "message": "Update swagger file with deprecated operations", "committedDate": "2020-07-23T10:58:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MDY0Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r486990642", "bodyText": "@GANGANI Any reason to change the access modifier for the method? We only want to deprecate the class right?", "author": "tharindu-bandara", "createdAt": "2020-09-11T11:44:48Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt.endpoint/src/main/java/org/wso2/carbon/identity/template/mgt/endpoint/impl/TemplatesApiServiceImpl.java", "diffHunk": "@@ -47,98 +47,39 @@\n import static org.wso2.carbon.identity.template.mgt.TemplateMgtConstants.ErrorMessages.ERROR_CODE_UNEXPECTED;\n import static org.wso2.carbon.identity.template.mgt.TemplateMgtConstants.ErrorMessages.ERROR_CODE_USER_NOT_AUTHORIZED;\n \n-public class\n-TemplatesApiServiceImpl extends TemplatesApiService {\n+@Deprecated\n+public class TemplatesApiServiceImpl extends TemplatesApiService {", "originalCommit": "360b67c018e7e7e32f0b8ab3d8dac625b21de822", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2OTc4OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r487369789", "bodyText": "I didn't change the access modifier, I set it to one line.", "author": "GANGANI", "createdAt": "2020-09-12T05:14:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MDY0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MTYzOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r486991639", "bodyText": "@GANGANI we are changing the backward compatibility in this deprecating effort. Any particular reasons for this? Can't we only add a depreciate tag?", "author": "tharindu-bandara", "createdAt": "2020-09-11T11:46:56Z", "path": "components/template-mgt/org.wso2.carbon.identity.template.mgt.endpoint/src/main/java/org/wso2/carbon/identity/template/mgt/endpoint/impl/TemplatesApiServiceImpl.java", "diffHunk": "@@ -47,98 +47,39 @@\n import static org.wso2.carbon.identity.template.mgt.TemplateMgtConstants.ErrorMessages.ERROR_CODE_UNEXPECTED;\n import static org.wso2.carbon.identity.template.mgt.TemplateMgtConstants.ErrorMessages.ERROR_CODE_USER_NOT_AUTHORIZED;\n \n-public class\n-TemplatesApiServiceImpl extends TemplatesApiService {\n+@Deprecated\n+public class TemplatesApiServiceImpl extends TemplatesApiService {\n \n     private static final Log LOG = LogFactory.getLog(TemplatesApiServiceImpl.class);\n \n     @Override\n     public Response addTemplate(TemplateDTO template) {\n \n-        try {\n-            TemplateResponseDTO response = postTemplate(template);\n-            return Response.created(getTemplateLocationURI(response.getTemplateName()))\n-                    .lastModified(Calendar.getInstance().getTime())\n-                    .entity(response)\n-                    .build();\n-        } catch (TemplateManagementClientException e) {\n-            return handleBadRequestResponse(e);\n-        } catch (TemplateManagementException e) {\n-            return handleServerErrorResponse(e);\n-        } catch (Throwable throwable) {\n-            return handleUnexpectedServerError(throwable);\n-        }\n+        return handleForbiddenRequest();", "originalCommit": "360b67c018e7e7e32f0b8ab3d8dac625b21de822", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzM2OTk0NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2996#discussion_r487369945", "bodyText": "As per the discussion with @emswbandara and the team, we decide to return the forbidden error.", "author": "GANGANI", "createdAt": "2020-09-12T05:16:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njk5MTYzOQ=="}], "type": "inlineReview"}]}