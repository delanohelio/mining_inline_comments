{"pr_number": 2729, "pr_title": "Add improvement to UserClaimsAuditLogger to log only updated claims", "pr_createdAt": "2020-02-07T04:34:22Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2729", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIxMjU0OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2729#discussion_r376212548", "bodyText": "Shall we change the method name as \"logUpdatedClaims\"?", "author": "nilasini", "createdAt": "2020-02-07T04:45:00Z", "path": "components/user-mgt/org.wso2.carbon.user.mgt/src/main/java/org/wso2/carbon/user/mgt/listeners/UserClaimsAuditLogger.java", "diffHunk": "@@ -114,11 +123,65 @@ public boolean doPreSetUserClaimValues(String userName, Map<String, String> clai\n     public boolean doPostSetUserClaimValues(String userName, Map<String, String> claims, String profileName, UserStoreManager userStoreManager) throws UserStoreException {\n \n         if (isEnable()) {\n-            logClaims(userName, \"doPostSetUserClaimValues\", userStoreManager);\n+            if (isLogUpdatedClaimsOnlyPropertyEnabled()) {\n+                return true;\n+            } else {\n+                logClaims(userName, \"doPostSetUserClaimValues\", userStoreManager);\n+            }\n         }\n         return true;\n     }\n \n+    private boolean isLogUpdatedClaimsOnlyPropertyEnabled() {\n+\n+        Object propertyValue = IdentityUtil.readEventListenerProperty(EVENT_LISTENER_TYPE, this.getClass().getName())\n+                .getProperties().get(LOG_UPDATED_CLAIMS_ONLY_PROPERTY);\n+        if (propertyValue != null) {\n+            return Boolean.parseBoolean(propertyValue.toString());\n+        }\n+\n+        return false;\n+    }\n+\n+    /**\n+     * This will log only the updated user claims rather than logging every claim that is added under the loggable\n+     * claims configuration.\n+     *\n+     * @param userName         Username.\n+     * @param claims           User claims.\n+     * @param action           Action to be logged in the audit log.\n+     * @param userStoreManager Userstore manager.\n+     */\n+    private void logOnlyUpdatedClaims(String userName, Map<String, String> claims, String action,", "originalCommit": "739d2af1184ec9b0581da9694e381ee6d7e98ae5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIxMzIzMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2729#discussion_r376213232", "bodyText": "Shall we add a method comment here", "author": "sarubi", "createdAt": "2020-02-07T04:49:15Z", "path": "components/user-mgt/org.wso2.carbon.user.mgt/src/main/java/org/wso2/carbon/user/mgt/listeners/UserClaimsAuditLogger.java", "diffHunk": "@@ -114,11 +123,65 @@ public boolean doPreSetUserClaimValues(String userName, Map<String, String> clai\n     public boolean doPostSetUserClaimValues(String userName, Map<String, String> claims, String profileName, UserStoreManager userStoreManager) throws UserStoreException {\n \n         if (isEnable()) {\n-            logClaims(userName, \"doPostSetUserClaimValues\", userStoreManager);\n+            if (isLogUpdatedClaimsOnlyPropertyEnabled()) {\n+                return true;\n+            } else {\n+                logClaims(userName, \"doPostSetUserClaimValues\", userStoreManager);\n+            }\n         }\n         return true;\n     }\n \n+    private boolean isLogUpdatedClaimsOnlyPropertyEnabled() {", "originalCommit": "739d2af1184ec9b0581da9694e381ee6d7e98ae5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIyMTY5NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2729#discussion_r376221694", "bodyText": "Added", "author": "sachiniWettasinghe", "createdAt": "2020-02-07T05:37:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjIxMzIzMg=="}], "type": "inlineReview"}, {"oid": "b1bc014f2c5992055ef6a1a4561e62047c987b0a", "url": "https://github.com/wso2/carbon-identity-framework/commit/b1bc014f2c5992055ef6a1a4561e62047c987b0a", "message": "Add improvement to log only updated claims", "committedDate": "2020-02-07T05:34:34Z", "type": "commit"}, {"oid": "b1bc014f2c5992055ef6a1a4561e62047c987b0a", "url": "https://github.com/wso2/carbon-identity-framework/commit/b1bc014f2c5992055ef6a1a4561e62047c987b0a", "message": "Add improvement to log only updated claims", "committedDate": "2020-02-07T05:34:34Z", "type": "forcePushed"}, {"oid": "c1a205aa54e648fa266480635a46659613146dac", "url": "https://github.com/wso2/carbon-identity-framework/commit/c1a205aa54e648fa266480635a46659613146dac", "message": "Add improvement to log set and removed claim values", "committedDate": "2020-02-07T10:45:11Z", "type": "commit"}]}