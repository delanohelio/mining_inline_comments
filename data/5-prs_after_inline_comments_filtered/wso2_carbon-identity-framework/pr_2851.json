{"pr_number": 2851, "pr_title": "Implement serverURL model", "pr_createdAt": "2020-04-01T14:43:40Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2851", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1NTQxMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402055411", "bodyText": "I don't think these properties are needed. Those are just builder properties.\nWe need just the basic components of the URL like host, port, protocol, path, query, fragement, parameters. May be you can have an internal URL object", "author": "malithie", "createdAt": "2020-04-02T05:13:21Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1NTc3NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402055775", "bodyText": "What if we say this as ServiceURL; This actually reflects service endpoints.\n@pulasthi7 @mefarazath @omindu WDYT?", "author": "malithie", "createdAt": "2020-04-02T05:14:31Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1NjAyMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402056023", "bodyText": "Remove  getters related to unnecessary operational properties", "author": "malithie", "createdAt": "2020-04-02T05:15:29Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private ArrayList<String> parameters;\n+    private ArrayList<String> fragments;\n+\n+    private ServerURL(ServerURLBuilder serverURLBuilder) {\n+\n+        this.protocol = serverURLBuilder.protocol;\n+        this.hostName = serverURLBuilder.hostName;\n+        this.port = serverURLBuilder.port;\n+        this.proxyContext = serverURLBuilder.proxyContext;\n+        this.webContext = serverURLBuilder.webContext;\n+        this.addProxyContext = serverURLBuilder.addProxyContext;\n+        this.addWebContext = serverURLBuilder.addWebContext;\n+        this.urlContext = serverURLBuilder.urlContext;\n+        this.appendTenantAsQueryParam = serverURLBuilder.appendTenantAsQueryParam;\n+        this.appendTenantAsPathParam = serverURLBuilder.appendTenantAsPathParam;\n+        this.parameters = serverURLBuilder.parameters;\n+        this.fragments = serverURLBuilder.fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Boolean getAddProxyContext() {\n+\n+        return addProxyContext;\n+    }\n+\n+    public Boolean getAddWebContext() {\n+\n+        return addWebContext;\n+    }\n+\n+    public Boolean getAppendTenantAsQueryParam() {\n+\n+        return appendTenantAsQueryParam;\n+    }\n+\n+    public Boolean getAppendTenantAsPathParam() {\n+\n+        return appendTenantAsPathParam;\n+    }", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1NjQwNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402056407", "bodyText": "Don't return the list which is mutable. Rather return as properties, immutable list, or better to provide the capability to get a specific parameter given a key", "author": "malithie", "createdAt": "2020-04-02T05:16:48Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private ArrayList<String> parameters;\n+    private ArrayList<String> fragments;\n+\n+    private ServerURL(ServerURLBuilder serverURLBuilder) {\n+\n+        this.protocol = serverURLBuilder.protocol;\n+        this.hostName = serverURLBuilder.hostName;\n+        this.port = serverURLBuilder.port;\n+        this.proxyContext = serverURLBuilder.proxyContext;\n+        this.webContext = serverURLBuilder.webContext;\n+        this.addProxyContext = serverURLBuilder.addProxyContext;\n+        this.addWebContext = serverURLBuilder.addWebContext;\n+        this.urlContext = serverURLBuilder.urlContext;\n+        this.appendTenantAsQueryParam = serverURLBuilder.appendTenantAsQueryParam;\n+        this.appendTenantAsPathParam = serverURLBuilder.appendTenantAsPathParam;\n+        this.parameters = serverURLBuilder.parameters;\n+        this.fragments = serverURLBuilder.fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Boolean getAddProxyContext() {\n+\n+        return addProxyContext;\n+    }\n+\n+    public Boolean getAddWebContext() {\n+\n+        return addWebContext;\n+    }\n+\n+    public Boolean getAppendTenantAsQueryParam() {\n+\n+        return appendTenantAsQueryParam;\n+    }\n+\n+    public Boolean getAppendTenantAsPathParam() {\n+\n+        return appendTenantAsPathParam;\n+    }\n+\n+    public ArrayList<String> getParameters() {\n+\n+        return parameters;\n+    }", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1NjcyMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402056720", "bodyText": "Let's not use carbon utils and fetch. This object should be created with all necessary fields populated. Don't invoke other classes utils from this POJO", "author": "malithie", "createdAt": "2020-04-02T05:17:53Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private ArrayList<String> parameters;\n+    private ArrayList<String> fragments;\n+\n+    private ServerURL(ServerURLBuilder serverURLBuilder) {\n+\n+        this.protocol = serverURLBuilder.protocol;\n+        this.hostName = serverURLBuilder.hostName;\n+        this.port = serverURLBuilder.port;\n+        this.proxyContext = serverURLBuilder.proxyContext;\n+        this.webContext = serverURLBuilder.webContext;\n+        this.addProxyContext = serverURLBuilder.addProxyContext;\n+        this.addWebContext = serverURLBuilder.addWebContext;\n+        this.urlContext = serverURLBuilder.urlContext;\n+        this.appendTenantAsQueryParam = serverURLBuilder.appendTenantAsQueryParam;\n+        this.appendTenantAsPathParam = serverURLBuilder.appendTenantAsPathParam;\n+        this.parameters = serverURLBuilder.parameters;\n+        this.fragments = serverURLBuilder.fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Boolean getAddProxyContext() {\n+\n+        return addProxyContext;\n+    }\n+\n+    public Boolean getAddWebContext() {\n+\n+        return addWebContext;\n+    }\n+\n+    public Boolean getAppendTenantAsQueryParam() {\n+\n+        return appendTenantAsQueryParam;\n+    }\n+\n+    public Boolean getAppendTenantAsPathParam() {\n+\n+        return appendTenantAsPathParam;\n+    }\n+\n+    public ArrayList<String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public ArrayList<String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private String fetchProtocol() {\n+\n+        return CarbonUtils.getManagementTransport();\n+    }", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1NzY1Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402057656", "bodyText": "We need a slightly deviated version of this. Builder is the one who should process and get the POJO returned", "author": "malithie", "createdAt": "2020-04-02T05:21:25Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private ArrayList<String> parameters;\n+    private ArrayList<String> fragments;\n+\n+    private ServerURL(ServerURLBuilder serverURLBuilder) {\n+\n+        this.protocol = serverURLBuilder.protocol;\n+        this.hostName = serverURLBuilder.hostName;\n+        this.port = serverURLBuilder.port;\n+        this.proxyContext = serverURLBuilder.proxyContext;\n+        this.webContext = serverURLBuilder.webContext;\n+        this.addProxyContext = serverURLBuilder.addProxyContext;\n+        this.addWebContext = serverURLBuilder.addWebContext;\n+        this.urlContext = serverURLBuilder.urlContext;\n+        this.appendTenantAsQueryParam = serverURLBuilder.appendTenantAsQueryParam;\n+        this.appendTenantAsPathParam = serverURLBuilder.appendTenantAsPathParam;\n+        this.parameters = serverURLBuilder.parameters;\n+        this.fragments = serverURLBuilder.fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Boolean getAddProxyContext() {\n+\n+        return addProxyContext;\n+    }\n+\n+    public Boolean getAddWebContext() {\n+\n+        return addWebContext;\n+    }\n+\n+    public Boolean getAppendTenantAsQueryParam() {\n+\n+        return appendTenantAsQueryParam;\n+    }\n+\n+    public Boolean getAppendTenantAsPathParam() {\n+\n+        return appendTenantAsPathParam;\n+    }\n+\n+    public ArrayList<String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public ArrayList<String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private String fetchProtocol() {\n+\n+        return CarbonUtils.getManagementTransport();\n+    }\n+\n+    private String fetchHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (StringUtils.isBlank(hostName)) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLResolverException(\"Error while trying to resolve the hostname from the system.\", e);\n+        }\n+        return hostName;\n+    }\n+\n+    private Integer fetchPort() {\n+\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int port = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (port <= 0) {\n+            port = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return port;\n+    }\n+\n+    private String fetchProxyContextPath() {\n+\n+        return ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.PROXY_CONTEXT_PATH);\n+    }\n+\n+    private String fetchWebContextRoot() {\n+\n+        return ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.WEB_CONTEXT_ROOT);\n+    }\n+\n+    private String resolveUrlFromStandardContext(String urlContext) {\n+        /**\n+         * TODO\n+         * resolve URL context from the standard context.\n+         *\n+         */\n+        return null;\n+    }\n+\n+    private String resolveUrlFromServerConfig(String urlContext) {\n+        /**\n+         * TODO\n+         * resolve URL context from the server config.\n+         *\n+         */\n+        return null;\n+    }\n+\n+    private void appendURLContext(StringBuilder serverURL, String urlContext) {\n+\n+        if (!serverURL.toString().endsWith(\"/\") && urlContext.trim().charAt(0) != '/') {\n+            serverURL.append(\"/\").append(urlContext.trim());\n+        } else if (serverURL.toString().endsWith(\"/\") && urlContext.trim().charAt(0) == '/') {\n+            serverURL.append(urlContext.trim().substring(1));\n+        } else {\n+            serverURL.append(urlContext.trim());\n+        }\n+    }\n+\n+    public String getAbsoluteUrl() throws URLResolverException {\n+\n+        StringBuilder absoluteUrl = new StringBuilder();\n+        String protocol = this.getProtocol();\n+        if (StringUtils.isBlank(protocol)) {\n+            protocol = this.fetchProtocol();\n+        }\n+        absoluteUrl.append(protocol).append(\"://\");\n+        String hostName = this.getHostName();\n+        if (StringUtils.isBlank(hostName)) {\n+            hostName = this.fetchHostName();\n+        }\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        absoluteUrl.append(hostName.toLowerCase());\n+\n+        Integer port = this.getPort();\n+        if (port == null) {\n+            port = this.fetchPort();\n+        }\n+        if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            absoluteUrl.append(\":\").append(port);\n+        }\n+        appendContext(absoluteUrl, this.getUrlContext());\n+        return absoluteUrl.toString();\n+    }\n+\n+    private void appendContext(StringBuilder serverUrl, String urlContext) {\n+\n+        if (this.getAddProxyContext()) {\n+            String proxyContextPath = this.getProxyContext();\n+            if (StringUtils.isBlank(proxyContextPath)) {\n+                proxyContextPath = fetchProxyContextPath();\n+            }\n+            if (StringUtils.isNotBlank(proxyContextPath)) {\n+                if (proxyContextPath.trim().charAt(0) != '/') {\n+                    serverUrl.append(\"/\").append(proxyContextPath.trim());\n+                } else {\n+                    serverUrl.append(proxyContextPath.trim());\n+                }\n+            }\n+        }\n+\n+        if (this.getAddWebContext()) {\n+            String webContextRoot = this.getWebContext();\n+            if (StringUtils.isBlank(webContextRoot)) {\n+                webContextRoot = fetchWebContextRoot();\n+            }\n+            if (StringUtils.isNotBlank(webContextRoot)) {\n+                if (webContextRoot.trim().charAt(0) != '/') {\n+                    serverUrl.append(\"/\").append(webContextRoot.trim());\n+                } else {\n+                    serverUrl.append(webContextRoot.trim());\n+                }\n+            }\n+        }\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        String resolvedUrlContext = null;\n+        /**\n+         *\n+         * check if tenant-qualified URL support is enabled. If true, add tenant domain to the path param.\n+         * If tenant-qualified URL support is enabled, resolve URL context from the standard context.\n+         * If the URL context is still null, resolve from the server config.\n+         * If tenant-qualified support is not enabled, resolve the URL context for params.\n+         *\n+         */\n+\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                if (serverUrl.toString().endsWith(\"/\")) {\n+                    serverUrl.append(\"t/\").append(tenantDomain);\n+                } else {\n+                    serverUrl.append(\"/t/\").append(tenantDomain);\n+                }\n+            }\n+            resolvedUrlContext = resolveUrlFromStandardContext(urlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && this.getAppendTenantAsPathParam()) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                if (serverUrl.toString().endsWith(\"/\")) {\n+                    serverUrl.append(\"t/\").append(tenantDomain);\n+                } else {\n+                    serverUrl.append(\"/t/\").append(tenantDomain);\n+                }\n+            }\n+        }\n+\n+        if (StringUtils.isBlank(resolvedUrlContext)) {\n+            resolvedUrlContext = resolveUrlFromServerConfig(urlContext);\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            appendURLContext(serverUrl, resolvedUrlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && this.getAppendTenantAsQueryParam()) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                serverUrl.append(\"?\").append(MultitenantConstants.TENANT_DOMAIN).append(\"=\").append(tenantDomain);\n+            }\n+        }\n+\n+        if (serverUrl.toString().endsWith(\"/\")) {\n+            serverUrl.setLength(serverUrl.length() - 1);\n+        }\n+    }\n+\n+    /**\n+     * Server URL builder representation.\n+     */\n+    public static class ServerURLBuilder {\n+\n+        private String protocol;\n+        private String hostName;\n+        private Integer port;\n+        private String proxyContext;\n+        private String webContext;\n+        private Boolean addProxyContext;\n+        private Boolean addWebContext;\n+        private String urlContext;\n+        private Boolean appendTenantAsQueryParam;\n+        private Boolean appendTenantAsPathParam;\n+        private ArrayList<String> parameters;\n+        private ArrayList<String> fragments;\n+\n+        public ServerURLBuilder(String urlContext) {\n+\n+            this.urlContext = urlContext;\n+        }\n+\n+        public ServerURLBuilder protocol(String protocol) {\n+\n+            this.protocol = protocol;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder hostName(String hostName) {\n+\n+            this.hostName = hostName;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder port(Integer port) {\n+\n+            this.port = port;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder proxyContext(String proxyContext) {\n+\n+            this.proxyContext = proxyContext;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder webContext(String webContext) {\n+\n+            this.webContext = webContext;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder addProxyContext() {\n+\n+            this.addProxyContext = true;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder addWebContext() {\n+\n+            this.addWebContext = true;\n+            return this;\n+        }\n+\n+\n+        public ServerURLBuilder appendTenantAsQueryParam() {\n+\n+            this.appendTenantAsQueryParam = true;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder appendTenantAsPathParam() {\n+\n+            this.appendTenantAsPathParam = true;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder parameters(ArrayList<String> parameters) {\n+\n+            this.parameters = parameters;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder fragments(ArrayList<String> fragments) {\n+\n+            this.fragments = fragments;\n+            return this;\n+        }\n+\n+        public ServerURL build() {\n+\n+            return new ServerURL(this);\n+        }\n+    }\n+", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA1ODU0Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402058547", "bodyText": "Also would be better to have a parameter() method that allows adding params one by one.\nAlso shouldn't the input be a map?", "author": "mefarazath", "createdAt": "2020-04-02T05:24:36Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServerURL.java", "diffHunk": "@@ -0,0 +1,411 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.URLResolverException;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.ArrayList;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Server URL representation.\n+ */\n+public class ServerURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private ArrayList<String> parameters;\n+    private ArrayList<String> fragments;\n+\n+    private ServerURL(ServerURLBuilder serverURLBuilder) {\n+\n+        this.protocol = serverURLBuilder.protocol;\n+        this.hostName = serverURLBuilder.hostName;\n+        this.port = serverURLBuilder.port;\n+        this.proxyContext = serverURLBuilder.proxyContext;\n+        this.webContext = serverURLBuilder.webContext;\n+        this.addProxyContext = serverURLBuilder.addProxyContext;\n+        this.addWebContext = serverURLBuilder.addWebContext;\n+        this.urlContext = serverURLBuilder.urlContext;\n+        this.appendTenantAsQueryParam = serverURLBuilder.appendTenantAsQueryParam;\n+        this.appendTenantAsPathParam = serverURLBuilder.appendTenantAsPathParam;\n+        this.parameters = serverURLBuilder.parameters;\n+        this.fragments = serverURLBuilder.fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Boolean getAddProxyContext() {\n+\n+        return addProxyContext;\n+    }\n+\n+    public Boolean getAddWebContext() {\n+\n+        return addWebContext;\n+    }\n+\n+    public Boolean getAppendTenantAsQueryParam() {\n+\n+        return appendTenantAsQueryParam;\n+    }\n+\n+    public Boolean getAppendTenantAsPathParam() {\n+\n+        return appendTenantAsPathParam;\n+    }\n+\n+    public ArrayList<String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public ArrayList<String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private String fetchProtocol() {\n+\n+        return CarbonUtils.getManagementTransport();\n+    }\n+\n+    private String fetchHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (StringUtils.isBlank(hostName)) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLResolverException(\"Error while trying to resolve the hostname from the system.\", e);\n+        }\n+        return hostName;\n+    }\n+\n+    private Integer fetchPort() {\n+\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int port = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (port <= 0) {\n+            port = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return port;\n+    }\n+\n+    private String fetchProxyContextPath() {\n+\n+        return ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.PROXY_CONTEXT_PATH);\n+    }\n+\n+    private String fetchWebContextRoot() {\n+\n+        return ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.WEB_CONTEXT_ROOT);\n+    }\n+\n+    private String resolveUrlFromStandardContext(String urlContext) {\n+        /**\n+         * TODO\n+         * resolve URL context from the standard context.\n+         *\n+         */\n+        return null;\n+    }\n+\n+    private String resolveUrlFromServerConfig(String urlContext) {\n+        /**\n+         * TODO\n+         * resolve URL context from the server config.\n+         *\n+         */\n+        return null;\n+    }\n+\n+    private void appendURLContext(StringBuilder serverURL, String urlContext) {\n+\n+        if (!serverURL.toString().endsWith(\"/\") && urlContext.trim().charAt(0) != '/') {\n+            serverURL.append(\"/\").append(urlContext.trim());\n+        } else if (serverURL.toString().endsWith(\"/\") && urlContext.trim().charAt(0) == '/') {\n+            serverURL.append(urlContext.trim().substring(1));\n+        } else {\n+            serverURL.append(urlContext.trim());\n+        }\n+    }\n+\n+    public String getAbsoluteUrl() throws URLResolverException {\n+\n+        StringBuilder absoluteUrl = new StringBuilder();\n+        String protocol = this.getProtocol();\n+        if (StringUtils.isBlank(protocol)) {\n+            protocol = this.fetchProtocol();\n+        }\n+        absoluteUrl.append(protocol).append(\"://\");\n+        String hostName = this.getHostName();\n+        if (StringUtils.isBlank(hostName)) {\n+            hostName = this.fetchHostName();\n+        }\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        absoluteUrl.append(hostName.toLowerCase());\n+\n+        Integer port = this.getPort();\n+        if (port == null) {\n+            port = this.fetchPort();\n+        }\n+        if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            absoluteUrl.append(\":\").append(port);\n+        }\n+        appendContext(absoluteUrl, this.getUrlContext());\n+        return absoluteUrl.toString();\n+    }\n+\n+    private void appendContext(StringBuilder serverUrl, String urlContext) {\n+\n+        if (this.getAddProxyContext()) {\n+            String proxyContextPath = this.getProxyContext();\n+            if (StringUtils.isBlank(proxyContextPath)) {\n+                proxyContextPath = fetchProxyContextPath();\n+            }\n+            if (StringUtils.isNotBlank(proxyContextPath)) {\n+                if (proxyContextPath.trim().charAt(0) != '/') {\n+                    serverUrl.append(\"/\").append(proxyContextPath.trim());\n+                } else {\n+                    serverUrl.append(proxyContextPath.trim());\n+                }\n+            }\n+        }\n+\n+        if (this.getAddWebContext()) {\n+            String webContextRoot = this.getWebContext();\n+            if (StringUtils.isBlank(webContextRoot)) {\n+                webContextRoot = fetchWebContextRoot();\n+            }\n+            if (StringUtils.isNotBlank(webContextRoot)) {\n+                if (webContextRoot.trim().charAt(0) != '/') {\n+                    serverUrl.append(\"/\").append(webContextRoot.trim());\n+                } else {\n+                    serverUrl.append(webContextRoot.trim());\n+                }\n+            }\n+        }\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        String resolvedUrlContext = null;\n+        /**\n+         *\n+         * check if tenant-qualified URL support is enabled. If true, add tenant domain to the path param.\n+         * If tenant-qualified URL support is enabled, resolve URL context from the standard context.\n+         * If the URL context is still null, resolve from the server config.\n+         * If tenant-qualified support is not enabled, resolve the URL context for params.\n+         *\n+         */\n+\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                if (serverUrl.toString().endsWith(\"/\")) {\n+                    serverUrl.append(\"t/\").append(tenantDomain);\n+                } else {\n+                    serverUrl.append(\"/t/\").append(tenantDomain);\n+                }\n+            }\n+            resolvedUrlContext = resolveUrlFromStandardContext(urlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && this.getAppendTenantAsPathParam()) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                if (serverUrl.toString().endsWith(\"/\")) {\n+                    serverUrl.append(\"t/\").append(tenantDomain);\n+                } else {\n+                    serverUrl.append(\"/t/\").append(tenantDomain);\n+                }\n+            }\n+        }\n+\n+        if (StringUtils.isBlank(resolvedUrlContext)) {\n+            resolvedUrlContext = resolveUrlFromServerConfig(urlContext);\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            appendURLContext(serverUrl, resolvedUrlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && this.getAppendTenantAsQueryParam()) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                serverUrl.append(\"?\").append(MultitenantConstants.TENANT_DOMAIN).append(\"=\").append(tenantDomain);\n+            }\n+        }\n+\n+        if (serverUrl.toString().endsWith(\"/\")) {\n+            serverUrl.setLength(serverUrl.length() - 1);\n+        }\n+    }\n+\n+    /**\n+     * Server URL builder representation.\n+     */\n+    public static class ServerURLBuilder {\n+\n+        private String protocol;\n+        private String hostName;\n+        private Integer port;\n+        private String proxyContext;\n+        private String webContext;\n+        private Boolean addProxyContext;\n+        private Boolean addWebContext;\n+        private String urlContext;\n+        private Boolean appendTenantAsQueryParam;\n+        private Boolean appendTenantAsPathParam;\n+        private ArrayList<String> parameters;\n+        private ArrayList<String> fragments;\n+\n+        public ServerURLBuilder(String urlContext) {\n+\n+            this.urlContext = urlContext;\n+        }\n+\n+        public ServerURLBuilder protocol(String protocol) {\n+\n+            this.protocol = protocol;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder hostName(String hostName) {\n+\n+            this.hostName = hostName;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder port(Integer port) {\n+\n+            this.port = port;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder proxyContext(String proxyContext) {\n+\n+            this.proxyContext = proxyContext;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder webContext(String webContext) {\n+\n+            this.webContext = webContext;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder addProxyContext() {\n+\n+            this.addProxyContext = true;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder addWebContext() {\n+\n+            this.addWebContext = true;\n+            return this;\n+        }\n+\n+\n+        public ServerURLBuilder appendTenantAsQueryParam() {\n+\n+            this.appendTenantAsQueryParam = true;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder appendTenantAsPathParam() {\n+\n+            this.appendTenantAsPathParam = true;\n+            return this;\n+        }\n+\n+        public ServerURLBuilder parameters(ArrayList<String> parameters) {", "originalCommit": "07a75feeab7c39d50e340c087f158efb151b6e64", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3ODY2OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402478669", "bodyText": "Why can't we have the primitive type", "author": "malithie", "createdAt": "2020-04-02T17:18:17Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3OTQ5Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402479496", "bodyText": "We can String as values right. Even if you take servlet API parameters are string isn't it", "author": "malithie", "createdAt": "2020-04-02T17:19:32Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUxODE2NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402518165", "bodyText": "+1", "author": "mefarazath", "createdAt": "2020-04-02T18:17:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3OTQ5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ3OTgzOA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402479838", "bodyText": "Same case applies here. I don't think it's necessary to have an object type", "author": "malithie", "createdAt": "2020-04-02T17:20:02Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4MDY2MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402480661", "bodyText": "This is pending to implement ?", "author": "malithie", "createdAt": "2020-04-02T17:21:13Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;\n+\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, Object value) {\n+\n+        return null;", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4NzYxNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402487614", "bodyText": "Shall we change the exception type", "author": "malithie", "createdAt": "2020-04-02T17:31:10Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;\n+\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, Object value) {\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLResolverException {", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4OTkzNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402489934", "bodyText": "Should pick this up from OSGI service listening", "author": "malithie", "createdAt": "2020-04-02T17:33:39Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        return new DefaultServiceURLBuilder();", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc5MzE2Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r403793166", "bodyText": "@chamathns not fixed still right ?", "author": "malithie", "createdAt": "2020-04-06T01:53:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4OTkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NDkyMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402494923", "bodyText": "I think multiple context paths can be added and you should be building the requestURI", "author": "malithie", "createdAt": "2020-04-02T17:39:08Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        return new DefaultServiceURLBuilder();\n+    }\n+\n+    /**\n+     * This method is called to add the URL context to the builder.\n+     *\n+     * @param context URL context.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addContext(String context);", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjczNDg0OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402734849", "bodyText": "Didn't get what's meant by 'multiple context paths' here. Is it the web context and the proxy context?", "author": "chamathns", "createdAt": "2020-04-03T04:48:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc5OTY5OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402799699", "bodyText": "multiple paths.\nlike addContext(oauth2).addContext(token) should add /oauth2/token", "author": "malithie", "createdAt": "2020-04-03T07:52:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNDExNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402804114", "bodyText": "Maybe it's better to say 'addPath(String... paths)' and provide the capability to add multiple paths with a comma separated string", "author": "malithie", "createdAt": "2020-04-03T07:58:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNTk5OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402805999", "bodyText": "I think addPath approach is better", "author": "mefarazath", "createdAt": "2020-04-03T08:00:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NDkyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5NjU3Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402496572", "bodyText": "This implementation should go to internal package", "author": "malithie", "createdAt": "2020-04-02T17:41:08Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ5ODQzNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402498437", "bodyText": "We might not need this. context is the path, which we will be using to construct the full URL", "author": "malithie", "createdAt": "2020-04-02T17:44:10Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;\n+\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, Object value) {\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLResolverException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        Integer port = fetchPort();\n+        String proxyContext = null;\n+        if (addProxyContext) {\n+            proxyContext = fetchProxyContextPath();\n+        }\n+        String webContext = null;\n+        if (addWebContext) {\n+            webContext = fetchWebContextRoot();\n+        }\n+\n+        String urlContext = this.urlContext;\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+\n+        String resolvedUrlContext = null;\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+            resolvedUrlContext = resolveUrlFromStandardContext(urlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && appendTenantAsPathParam) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+\n+        if (StringUtils.isBlank(resolvedUrlContext)) {\n+            resolvedUrlContext = resolveUrlFromServerConfig(urlContext);\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            resolvedUrlStringBuilder.append(resolvedUrlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && appendTenantAsQueryParam) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"?\").append(MultitenantConstants.TENANT_DOMAIN).append(\"=\")\n+                        .append(tenantDomain);\n+            }\n+        }\n+\n+        Map<String, Object> parameters = this.parameters;\n+        Map<String, Object> fragments = this.fragments;\n+\n+        return new ServiceURL(protocol, hostName, port, proxyContext, webContext, resolvedUrlStringBuilder.toString(),\n+                parameters, fragments);\n+\n+    }\n+\n+    private String fetchProtocol() {\n+\n+        return CarbonUtils.getManagementTransport();\n+    }\n+\n+    private String fetchHostName() throws URLResolverException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (StringUtils.isBlank(hostName)) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLResolverException(\"Error while trying to resolve the hostname from the system.\", e);\n+        }\n+        return hostName;\n+    }\n+\n+    private Integer fetchPort() {\n+\n+        String mgtTransport = CarbonUtils.getManagementTransport();\n+        AxisConfiguration axisConfiguration = IdentityCoreServiceComponent.getConfigurationContextService().\n+                getServerConfigContext().getAxisConfiguration();\n+        int port = CarbonUtils.getTransportProxyPort(axisConfiguration, mgtTransport);\n+        if (port <= 0) {\n+            port = CarbonUtils.getTransportPort(axisConfiguration, mgtTransport);\n+        }\n+        return port;\n+    }\n+\n+    private String fetchProxyContextPath() {\n+\n+        return ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.PROXY_CONTEXT_PATH);\n+    }\n+\n+    private String fetchWebContextRoot() {\n+\n+        return ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.WEB_CONTEXT_ROOT);\n+    }\n+\n+    private String resolveUrlFromStandardContext(String urlContext) {\n+        /**\n+         * TODO\n+         * resolve URL context from the standard context.\n+         *\n+         */\n+        return urlContext;\n+    }", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUwMDgzNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402500835", "bodyText": "If not tenant url supported we should give precedence to load the URL from the config", "author": "malithie", "createdAt": "2020-04-02T17:48:16Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,212 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;\n+\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, Object value) {\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLResolverException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        Integer port = fetchPort();\n+        String proxyContext = null;\n+        if (addProxyContext) {\n+            proxyContext = fetchProxyContextPath();\n+        }\n+        String webContext = null;\n+        if (addWebContext) {\n+            webContext = fetchWebContextRoot();\n+        }\n+\n+        String urlContext = this.urlContext;\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+\n+        String resolvedUrlContext = null;\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+            resolvedUrlContext = resolveUrlFromStandardContext(urlContext);\n+        }\n+\n+        if (!isTenantQualifiedUrlsEnabled() && appendTenantAsPathParam) {\n+            if (StringUtils.isNotBlank(tenantDomain) &&\n+                    !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+        }", "originalCommit": "8aefd5137b5c7cd9364e63f05d32bbb9d38c8d41", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "901c21799fa9f595fdd38b66efde1510e974b985", "url": "https://github.com/wso2/carbon-identity-framework/commit/901c21799fa9f595fdd38b66efde1510e974b985", "message": "resolve issues", "committedDate": "2020-04-03T04:08:13Z", "type": "forcePushed"}, {"oid": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "url": "https://github.com/wso2/carbon-identity-framework/commit/2765d7e8d17c53e1a80172e10de4e908c447a5ac", "message": "implement serverURL model\n\nimplement method to get the absolute url from a url context\n\nadd URL Builder service\n\nadd methods to get absoluteURL and relativeURL\n\nadd method comments and class comments\n\nresolve issues\n\nadd API in the IdentityUtil\n\nfix minor issues", "committedDate": "2020-04-03T05:59:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNjI0OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402806248", "bodyText": "Also let's not make this append right. We can say addTenantQueryParam", "author": "malithie", "createdAt": "2020-04-03T08:00:41Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    /**\n+     * This method is called to add the URL context to the builder.\n+     *\n+     * @param context URL context.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addContext(String context);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a query parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder appendTenantAsQueryParam();", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNjQ5Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402806497", "bodyText": "Also let's not make this append right. We can say addTenantPathParam", "author": "malithie", "createdAt": "2020-04-03T08:00:56Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    /**\n+     * This method is called to add the URL context to the builder.\n+     *\n+     * @param context URL context.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addContext(String context);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a query parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder appendTenantAsQueryParam();\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a path parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder appendTenantAsPathParam();", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgxMDM5Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402810396", "bodyText": "Fragments would not need key value pair I think", "author": "malithie", "createdAt": "2020-04-03T08:05:34Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    /**\n+     * This method is called to add the URL context to the builder.\n+     *\n+     * @param context URL context.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addContext(String context);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a query parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder appendTenantAsQueryParam();\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a path parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder appendTenantAsPathParam();\n+\n+    /**\n+     * This method is called to add the proxy context path to the URL.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addProxyContext();\n+\n+    /**\n+     * This method is called to add the web context root to the URL.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addWebContext();\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addParameter(String key, String value);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with fragments. Fragments should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addFragments(String key, String value);", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgyMjY3MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402822671", "bodyText": "@mefarazath", "author": "malithie", "createdAt": "2020-04-03T08:19:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgxMDM5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgyNzI1Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402827256", "bodyText": "we would not have to resolve the context in this mode", "author": "malithie", "createdAt": "2020-04-03T08:25:02Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,260 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private boolean addProxyContext;\n+    private boolean addWebContext;\n+    private String urlContext;\n+    private boolean appendTenantAsQueryParam;\n+    private boolean appendTenantAsPathParam;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    /**\n+     * This method is called to add the URL context to the builder.\n+     *\n+     * @param context URL context.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called to add the proxy context path to the URL.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called to add the web context root to the URL.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a query parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a path parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        this.parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with fragments. Fragments should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragments(String key, String value) {\n+\n+        this.fragments.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        Integer port = fetchPort();\n+        String proxyContext = null;\n+        if (addProxyContext) {\n+            proxyContext = fetchProxyContextPath();\n+        }\n+        String webContext = null;\n+        if (addWebContext) {\n+            webContext = fetchWebContextRoot();\n+        }\n+\n+        String urlContext = this.urlContext;\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+\n+        String resolvedUrlContext = null;\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+            resolvedUrlContext = resolveUrlFromStandardContext(urlContext);", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0MjE3Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402342177", "bodyText": "Any reason for not using int?", "author": "mefarazath", "createdAt": "2020-04-02T14:08:55Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * <p>\n+ * Builder for {@link ServiceURL} instances.\n+ * When a particular component is not explicitly set this class will use its default implementation.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;\n+\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, Object value) {\n+\n+        return null;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLResolverException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        Integer port = fetchPort();", "originalCommit": "f93ddf794afe856848adc0be642ef8651909cdba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjM0MzIzMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402343232", "bodyText": "Is this correct?", "author": "mefarazath", "createdAt": "2020-04-02T14:10:17Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,214 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+import org.wso2.carbon.utils.multitenancy.MultitenantConstants;\n+\n+import java.net.SocketException;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * <p>\n+ * Builder for {@link ServiceURL} instances.\n+ * When a particular component is not explicitly set this class will use its default implementation.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private Boolean addProxyContext;\n+    private Boolean addWebContext;\n+    private String urlContext;\n+    private Boolean appendTenantAsQueryParam;\n+    private Boolean appendTenantAsPathParam;\n+    private Map<String, Object> parameters;\n+    private Map<String, Object> fragments;\n+\n+    @Override\n+    public ServiceURLBuilder addContext(String context) {\n+\n+        this.urlContext = context;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addProxyContext() {\n+\n+        this.addProxyContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public final ServiceURLBuilder addWebContext() {\n+\n+        this.addWebContext = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsQueryParam() {\n+\n+        this.appendTenantAsQueryParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder appendTenantAsPathParam() {\n+\n+        this.appendTenantAsPathParam = true;\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, Object value) {\n+\n+        return null;", "originalCommit": "f93ddf794afe856848adc0be642ef8651909cdba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNzMwMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402807303", "bodyText": "We need to do URL encoding here", "author": "mefarazath", "createdAt": "2020-04-03T08:01:54Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, Map<String, String> parameters) {\n+\n+        if (MapUtils.isNotEmpty(parameters)) {\n+            for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                serverUrl.append(\"?\").append(entry.getKey()).append(\"=\").append(entry.getValue());", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwNzg4OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402807889", "bodyText": "Shouldn't we handle fragments  here?", "author": "mefarazath", "createdAt": "2020-04-03T08:02:37Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, Map<String, String> parameters) {\n+\n+        if (MapUtils.isNotEmpty(parameters)) {\n+            for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                serverUrl.append(\"?\").append(entry.getKey()).append(\"=\").append(entry.getValue());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the {@link ServiceURL} instance.\n+     */\n+    public String getAbsoluteUrl() {\n+\n+        StringBuilder absoluteUrl = new StringBuilder();\n+        absoluteUrl.append(getProtocol()).append(\"://\");\n+\n+        String hostName = getHostName();\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        absoluteUrl.append(hostName.toLowerCase());\n+\n+        int port = getPort();\n+        // If it's well known HTTPS port, skip adding port.\n+        if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            absoluteUrl.append(\":\").append(port);\n+        }\n+\n+        String proxyContextPath = getProxyContext();\n+        appendContextToUri(absoluteUrl, proxyContextPath);\n+\n+        String webContextRoot = getWebContext();\n+        appendContextToUri(absoluteUrl, webContextRoot);\n+\n+        String urlContext = getUrlContext();\n+        appendContextToUri(absoluteUrl, urlContext);\n+\n+        Map<String, String> parameters = getParameters();\n+        appendParamsToUri(absoluteUrl, parameters);", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwODU4NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402808585", "bodyText": "Need to handle URL fragements", "author": "mefarazath", "createdAt": "2020-04-03T08:03:27Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, Map<String, String> parameters) {\n+\n+        if (MapUtils.isNotEmpty(parameters)) {\n+            for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                serverUrl.append(\"?\").append(entry.getKey()).append(\"=\").append(entry.getValue());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the {@link ServiceURL} instance.\n+     */\n+    public String getAbsoluteUrl() {\n+\n+        StringBuilder absoluteUrl = new StringBuilder();\n+        absoluteUrl.append(getProtocol()).append(\"://\");\n+\n+        String hostName = getHostName();\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        absoluteUrl.append(hostName.toLowerCase());\n+\n+        int port = getPort();\n+        // If it's well known HTTPS port, skip adding port.\n+        if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            absoluteUrl.append(\":\").append(port);\n+        }\n+\n+        String proxyContextPath = getProxyContext();\n+        appendContextToUri(absoluteUrl, proxyContextPath);\n+\n+        String webContextRoot = getWebContext();\n+        appendContextToUri(absoluteUrl, webContextRoot);\n+\n+        String urlContext = getUrlContext();\n+        appendContextToUri(absoluteUrl, urlContext);\n+\n+        Map<String, String> parameters = getParameters();\n+        appendParamsToUri(absoluteUrl, parameters);\n+\n+        if (absoluteUrl.toString().endsWith(\"/\")) {\n+            absoluteUrl.setLength(absoluteUrl.length() - 1);\n+        }\n+        return absoluteUrl.toString();\n+    }\n+\n+    /**\n+     * This method is called to get the relative url from the url context.\n+     *\n+     * @return The relative URL from the {@link ServiceURL} instance.\n+     */\n+    public String getRelativeUrl() {\n+\n+        StringBuilder relativeUrl = new StringBuilder();\n+        String urlContext = getUrlContext();\n+        appendContextToUri(relativeUrl, urlContext);\n+\n+        Map<String, String> parameters = getParameters();", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzgzMzE2OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r403833168", "bodyText": "Should we add fragments to relative URL as well?", "author": "chamathns", "createdAt": "2020-04-06T05:12:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgwODU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgxMjU5MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402812591", "bodyText": "Can't we do this within getHostName() method", "author": "mefarazath", "createdAt": "2020-04-03T08:08:06Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, Map<String, String> parameters) {\n+\n+        if (MapUtils.isNotEmpty(parameters)) {\n+            for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                serverUrl.append(\"?\").append(entry.getKey()).append(\"=\").append(entry.getValue());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the {@link ServiceURL} instance.\n+     */\n+    public String getAbsoluteUrl() {\n+\n+        StringBuilder absoluteUrl = new StringBuilder();\n+        absoluteUrl.append(getProtocol()).append(\"://\");\n+\n+        String hostName = getHostName();\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzNTUyMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402835523", "bodyText": "We should not return the mutable map.\nMake map unmodifiable. Also add a method get the value from the parameter key and a method to get just parameter names", "author": "malithie", "createdAt": "2020-04-03T08:34:27Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzNTc3NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402835775", "bodyText": "Same above applies here", "author": "malithie", "createdAt": "2020-04-03T08:34:44Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzODM3Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402838373", "bodyText": "What if we build this at once with the constructor. Or build at first invocation.\nThere's no way these fields can change later as this class is immutable", "author": "malithie", "createdAt": "2020-04-03T08:37:48Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, Map<String, String> parameters) {\n+\n+        if (MapUtils.isNotEmpty(parameters)) {\n+            for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                serverUrl.append(\"?\").append(entry.getKey()).append(\"=\").append(entry.getValue());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the {@link ServiceURL} instance.\n+     */\n+    public String getAbsoluteUrl() {", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzODYxNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402838617", "bodyText": "Same above applies here", "author": "malithie", "createdAt": "2020-04-03T08:38:06Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.util.Map;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private Integer port;\n+    private String proxyContext;\n+    private String webContext;\n+    private String urlContext;\n+    private Map<String, String> parameters;\n+    private Map<String, String> fragments;\n+\n+    public ServiceURL(String protocol, String hostName, Integer port, String proxyContext, String webContext,\n+                      String urlContext, Map<String, String> parameters, Map<String, String> fragments) {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.proxyContext = proxyContext;\n+        this.webContext = webContext;\n+        this.urlContext = urlContext;\n+        this.parameters = parameters;\n+        this.fragments = fragments;\n+    }\n+\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    public String getHostName() {\n+\n+        return hostName;\n+    }\n+\n+    public Integer getPort() {\n+\n+        return port;\n+    }\n+\n+    public String getProxyContext() {\n+\n+        return proxyContext;\n+    }\n+\n+    public String getWebContext() {\n+\n+        return webContext;\n+    }\n+\n+    public String getUrlContext() {\n+\n+        return urlContext;\n+    }\n+\n+    public Map<String, String> getParameters() {\n+\n+        return parameters;\n+    }\n+\n+    public Map<String, String> getFragments() {\n+\n+        return fragments;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, Map<String, String> parameters) {\n+\n+        if (MapUtils.isNotEmpty(parameters)) {\n+            for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                serverUrl.append(\"?\").append(entry.getKey()).append(\"=\").append(entry.getValue());\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the {@link ServiceURL} instance.\n+     */\n+    public String getAbsoluteUrl() {\n+\n+        StringBuilder absoluteUrl = new StringBuilder();\n+        absoluteUrl.append(getProtocol()).append(\"://\");\n+\n+        String hostName = getHostName();\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        absoluteUrl.append(hostName.toLowerCase());\n+\n+        int port = getPort();\n+        // If it's well known HTTPS port, skip adding port.\n+        if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+            absoluteUrl.append(\":\").append(port);\n+        }\n+\n+        String proxyContextPath = getProxyContext();\n+        appendContextToUri(absoluteUrl, proxyContextPath);\n+\n+        String webContextRoot = getWebContext();\n+        appendContextToUri(absoluteUrl, webContextRoot);\n+\n+        String urlContext = getUrlContext();\n+        appendContextToUri(absoluteUrl, urlContext);\n+\n+        Map<String, String> parameters = getParameters();\n+        appendParamsToUri(absoluteUrl, parameters);\n+\n+        if (absoluteUrl.toString().endsWith(\"/\")) {\n+            absoluteUrl.setLength(absoluteUrl.length() - 1);\n+        }\n+        return absoluteUrl.toString();\n+    }\n+\n+    /**\n+     * This method is called to get the relative url from the url context.\n+     *\n+     * @return The relative URL from the {@link ServiceURL} instance.\n+     */\n+    public String getRelativeUrl() {\n+\n+        StringBuilder relativeUrl = new StringBuilder();\n+        String urlContext = getUrlContext();\n+        appendContextToUri(relativeUrl, urlContext);\n+\n+        Map<String, String> parameters = getParameters();\n+        appendParamsToUri(relativeUrl, parameters);\n+\n+        if (relativeUrl.toString().endsWith(\"/\")) {\n+            relativeUrl.setLength(relativeUrl.length() - 1);\n+        }\n+        return relativeUrl.toString();", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzOTA2Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402839067", "bodyText": "Let's not have this as a public methos", "author": "malithie", "createdAt": "2020-04-03T08:38:38Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -451,12 +453,34 @@ public static String getServerURL(String urlContext, boolean addProxyContextPath\n                                       boolean addTenantQueryParamInLegacyMode, boolean addTenantPathParamInLegacyMode)\n             throws IdentityRuntimeException {\n \n-        URLResolverService urlResolverService = IdentityCoreServiceComponent.getURLResolverService();\n+        return getAbsoluteURL(urlContext, addProxyContextPath, addWebContextRoot, addTenantQueryParamInLegacyMode,\n+                addTenantPathParamInLegacyMode);\n+    }\n+\n+    public static String getAbsoluteURL(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzOTY0MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402839640", "bodyText": "Can't we call, ServiceURLBuilder.create()", "author": "malithie", "createdAt": "2020-04-03T08:39:16Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/util/IdentityUtil.java", "diffHunk": "@@ -451,12 +453,34 @@ public static String getServerURL(String urlContext, boolean addProxyContextPath\n                                       boolean addTenantQueryParamInLegacyMode, boolean addTenantPathParamInLegacyMode)\n             throws IdentityRuntimeException {\n \n-        URLResolverService urlResolverService = IdentityCoreServiceComponent.getURLResolverService();\n+        return getAbsoluteURL(urlContext, addProxyContextPath, addWebContextRoot, addTenantQueryParamInLegacyMode,\n+                addTenantPathParamInLegacyMode);\n+    }\n+\n+    public static String getAbsoluteURL(String urlContext, boolean addProxyContextPath, boolean addWebContextRoot,\n+                                        boolean addTenantQueryParamInLegacyMode, boolean addTenantPathParamInLegacyMode)\n+            throws IdentityRuntimeException {\n+\n+        ServiceURLBuilder serviceURLBuilder = IdentityCoreServiceComponent.getServiceURLBuilder();", "originalCommit": "2765d7e8d17c53e1a80172e10de4e908c447a5ac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg0MDkwMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402840902", "bodyText": "Intention of builder pattern is to write this code with less lines like,\nServiceURLBuilder.create().addPath().addParameter()\nthe respective API should validate for empty and null values", "author": "malithie", "createdAt": "2020-04-03T08:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzOTY0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk4ODQ5MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r402988490", "bodyText": "The builder components doesn't take in any parameters. So, for example, ServiceURLBuilder.create().addPath().addTenantQueryParam() gets called, the ServiceURLBuilder registers this as addTenantQueryParam = true\nSince we don't know the value of the booleans in getServerUrl method, we have to perform a check for the boolean parameters before adding it to the builder.", "author": "chamathns", "createdAt": "2020-04-03T13:02:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgzOTY0MA=="}], "type": "inlineReview"}, {"oid": "9773e58cd4100ea68f1436752c597aeef2384da5", "url": "https://github.com/wso2/carbon-identity-framework/commit/9773e58cd4100ea68f1436752c597aeef2384da5", "message": "resolve minor issues", "committedDate": "2020-04-03T13:08:28Z", "type": "forcePushed"}, {"oid": "3bf1575f8799e3bcdc0c209565f6b85fa7724732", "url": "https://github.com/wso2/carbon-identity-framework/commit/3bf1575f8799e3bcdc0c209565f6b85fa7724732", "message": "add ServiceURL unit tests", "committedDate": "2020-04-04T06:31:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc5MzI4Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r403793287", "bodyText": "Accept as varargs, so you don't need to tokenize", "author": "malithie", "createdAt": "2020-04-06T01:53:38Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.internal.DefaultServiceURLBuilder;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        return new DefaultServiceURLBuilder();\n+    }\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context paths. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addPath(String paths);", "originalCommit": "7098e37034af793273bdd1c1483dc0c75aa2b570", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc5MzYyNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r403793625", "bodyText": "I'm not exactly sure if we should have key value supported as well. An overloaded method may be.\n@mefarazath we are referring to key value pairs in oauth for fragments right", "author": "malithie", "createdAt": "2020-04-06T01:55:20Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,98 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.internal.DefaultServiceURLBuilder;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        return new DefaultServiceURLBuilder();\n+    }\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context paths. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addPath(String paths);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a query parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addTenantAsQueryParam();\n+\n+    /**\n+     * This method is called when the URL needs to be appended with the tenant domain as a path parameter when\n+     * operating in legacy mode.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addTenantAsPathParam();\n+\n+    /**\n+     * This method is called to add the proxy context path to the URL.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addProxyContext();\n+\n+    /**\n+     * This method is called to add the web context root to the URL.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addWebContext();\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addParameter(String key, String value);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addFragment(String fragment);", "originalCommit": "7098e37034af793273bdd1c1483dc0c75aa2b570", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc5Nzc0OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r403797749", "bodyText": "From URL perspective there will be one fragment similar to query string. But we can have a method that accepts key, value pairs in a fragment, which might help building such fragments easily.\nAnd above we can rename as setFragment which will denote that it will set the fragment component of the URL", "author": "malithie", "createdAt": "2020-04-06T02:17:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc5MzYyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3MjQ1MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404272451", "bodyText": "We can add multiple params right\nWhat if we say 'addFragmentParams'", "author": "malithie", "createdAt": "2020-04-06T17:41:05Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.internal.DefaultServiceURLBuilder;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        return new DefaultServiceURLBuilder();\n+    }\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context paths. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addPath(String ... paths);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addParameter(String key, String value);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder setFragment(String fragment);\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addFragmentAsParams(String key, String value);", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3Mjg4NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404272885", "bodyText": "or 'addFragmentParameter'", "author": "malithie", "createdAt": "2020-04-06T17:41:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3MjQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3NDUwNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404274505", "bodyText": "Well the case is if somebody extends 'ServiceURLBuilder' still its create cannot be overloaded and the interface will return an implementation of DefaultURLServiceBuilder.\nWhat if we consume the factory in ServiceURLBuilder.create() ?", "author": "malithie", "createdAt": "2020-04-06T17:44:26Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilderFactory.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+/**\n+ * Service URL Builder Factory representation.\n+ */\n+public class ServiceURLBuilderFactory {\n+\n+    /**\n+     * This method is called to create a {@link ServiceURLBuilder} instance.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    public ServiceURLBuilder getServiceURLBuilderInstance() {\n+\n+        return ServiceURLBuilder.create();", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NTAxNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404285017", "bodyText": "This should return new DefaultServiceURLBuilder();\nand in create() of 'ServiceURLBuilder' you should have,\nif IdentityCoreServiceComponent.getServiceURLBuilderFactory() != null {\nreturn IdentityCoreServiceComponent.getServiceURLBuilderFactory().getServiceURLBuilder();\nelse\nnew DefaultServiceURLBuilder ()", "author": "malithie", "createdAt": "2020-04-06T18:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3NDUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3NzAxMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404277010", "bodyText": "Why create a new hashmap here. It should be pre-initialized.\nThis avoids invoking this method multiple times and adding several parameters", "author": "malithie", "createdAt": "2020-04-06T17:48:37Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters = new HashMap<>();", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI3NzM3OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404277378", "bodyText": "Same above applies here", "author": "malithie", "createdAt": "2020-04-06T17:49:09Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters = new HashMap<>();\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentAsParams(String key, String value) {\n+\n+        fragmentParams = new HashMap<>();", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MTU5Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404281592", "bodyText": "Is this the best way you can remove '/' from end. I think you can use charAt", "author": "malithie", "createdAt": "2020-04-06T17:56:05Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters = new HashMap<>();\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentAsParams(String key, String value) {\n+\n+        fragmentParams = new HashMap<>();\n+        fragmentParams.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        int port = fetchPort();\n+        String resolvedUrlContext = resolveUrlPath(urlPaths);\n+        String tenantDomain = resolveTenantDomain();\n+\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            if (resolvedUrlContext.trim().charAt(0) != '/') {\n+                resolvedUrlStringBuilder.append(\"/\").append(resolvedUrlContext.trim());\n+            } else {\n+                resolvedUrlStringBuilder.append(resolvedUrlContext.trim());\n+            }\n+        }\n+        return new ServiceURL(protocol, hostName, port, resolvedUrlStringBuilder.toString(), parameters, fragment,\n+                fragmentParams);\n+    }\n+\n+    private String resolveTenantDomain() {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        return tenantDomain;\n+    }\n+\n+    private String resolveUrlPath(String[] urlPaths) {\n+\n+        StringBuilder urlPathBuilder = new StringBuilder();\n+        if (ArrayUtils.isNotEmpty(urlPaths)) {\n+            for (String path : urlPaths) {\n+                urlPathBuilder.append(path).append(\"/\");\n+            }\n+            if (urlPathBuilder.toString().endsWith(\"/\")) {\n+                urlPathBuilder.setLength(urlPathBuilder.length() - 1);", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDUzNDMyNQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404534325", "bodyText": "Looked into this and found that setting the length in the above manner is more efficient than using stringbuilder.deleteCharAt(int index)\nref: https://stackoverflow.com/a/10131077/6113775", "author": "chamathns", "createdAt": "2020-04-07T04:54:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MTU5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU3ODY0Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404578642", "bodyText": "mmm but you are creating a string", "author": "malithie", "createdAt": "2020-04-07T07:00:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MTU5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNjIyMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404636220", "bodyText": "This is not a resolving method. This a building URI/URL context", "author": "malithie", "createdAt": "2020-04-07T08:38:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MTU5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4MjE4Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404282182", "bodyText": "Better to log unresolvable host in message so that it makes the message more context aware", "author": "malithie", "createdAt": "2020-04-06T17:56:59Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,188 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters = new HashMap<>();\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentAsParams(String key, String value) {\n+\n+        fragmentParams = new HashMap<>();\n+        fragmentParams.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        int port = fetchPort();\n+        String resolvedUrlContext = resolveUrlPath(urlPaths);\n+        String tenantDomain = resolveTenantDomain();\n+\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            if (resolvedUrlContext.trim().charAt(0) != '/') {\n+                resolvedUrlStringBuilder.append(\"/\").append(resolvedUrlContext.trim());\n+            } else {\n+                resolvedUrlStringBuilder.append(resolvedUrlContext.trim());\n+            }\n+        }\n+        return new ServiceURL(protocol, hostName, port, resolvedUrlStringBuilder.toString(), parameters, fragment,\n+                fragmentParams);\n+    }\n+\n+    private String resolveTenantDomain() {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        return tenantDomain;\n+    }\n+\n+    private String resolveUrlPath(String[] urlPaths) {\n+\n+        StringBuilder urlPathBuilder = new StringBuilder();\n+        if (ArrayUtils.isNotEmpty(urlPaths)) {\n+            for (String path : urlPaths) {\n+                urlPathBuilder.append(path).append(\"/\");\n+            }\n+            if (urlPathBuilder.toString().endsWith(\"/\")) {\n+                urlPathBuilder.setLength(urlPathBuilder.length() - 1);\n+            }\n+        }\n+        return urlPathBuilder.toString();\n+    }\n+\n+    private String fetchProtocol() {\n+\n+        return CarbonUtils.getManagementTransport();\n+    }\n+\n+    private String fetchHostName() throws URLBuilderException {\n+\n+        String hostName = ServerConfiguration.getInstance().getFirstProperty(IdentityCoreConstants.HOST_NAME);\n+        try {\n+            if (StringUtils.isBlank(hostName)) {\n+                hostName = NetworkUtils.getLocalHostname();\n+            }\n+        } catch (SocketException e) {\n+            throw new URLBuilderException(\"Error while trying to resolve the hostname from the system\", e);", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NDkwNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404284904", "bodyText": "Shall we rename as 'getServiceURLBuilder'", "author": "malithie", "createdAt": "2020-04-06T18:01:21Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilderFactory.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+/**\n+ * Service URL Builder Factory representation.\n+ */\n+public class ServiceURLBuilderFactory {\n+\n+    /**\n+     * This method is called to create a {@link ServiceURLBuilder} instance.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    public ServiceURLBuilder getServiceURLBuilderInstance() {", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NTc1Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404285753", "bodyText": "return an array", "author": "malithie", "createdAt": "2020-04-06T18:02:52Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,276 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private int port;\n+    private String urlPath;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+    private String absoluteUrl;\n+    private String relativeUrl;\n+\n+    public ServiceURL(String protocol, String hostName, int port, String urlPath, Map<String, String> parameters,\n+                      String fragment, Map<String, String> fragmentParams) throws URLBuilderException {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.urlPath = urlPath;\n+        this.parameters = parameters;\n+        this.fragment = fragment;\n+        this.fragmentParams = fragmentParams;\n+        this.absoluteUrl = getAbsoluteUrl();\n+        this.relativeUrl = getRelativeUrl();\n+    }\n+\n+    /**\n+     * This method is called to get the protocol of {@link ServiceURL}.\n+     *\n+     * @return String of the protocol.\n+     */\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    /**\n+     * This method is called to get the host name of {@link ServiceURL}.\n+     *\n+     * @return String of the host name.\n+     */\n+    public String getHostName() {\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        return hostName;\n+    }\n+\n+    /**\n+     * This method is called to get the port of {@link ServiceURL}.\n+     *\n+     * @return value of the port.\n+     */\n+    public int getPort() {\n+\n+        return port;\n+    }\n+\n+    /**\n+     * This method is called to get the Url path of {@link ServiceURL}.\n+     *\n+     * @return String of the url path.\n+     */\n+    public String getUrlPath() {\n+\n+        return urlPath;\n+    }\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    public String getParameter(String key) {\n+\n+        return parameters.get(key);\n+    }\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    public ArrayList<String> getParameterKeys() {\n+\n+        ArrayList<String> parameterArrayList = new ArrayList<>();\n+\n+        for (Map.Entry<String, String> entry : this.parameters.entrySet()) {\n+            parameterArrayList.add(entry.getKey());\n+        }\n+        return parameterArrayList;", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NjM5NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404286395", "bodyText": "Why build a URI. Why not return from fragment variable", "author": "malithie", "createdAt": "2020-04-06T18:04:01Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,276 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URI;\n+import java.net.URISyntaxException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private int port;\n+    private String urlPath;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+    private String absoluteUrl;\n+    private String relativeUrl;\n+\n+    public ServiceURL(String protocol, String hostName, int port, String urlPath, Map<String, String> parameters,\n+                      String fragment, Map<String, String> fragmentParams) throws URLBuilderException {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.urlPath = urlPath;\n+        this.parameters = parameters;\n+        this.fragment = fragment;\n+        this.fragmentParams = fragmentParams;\n+        this.absoluteUrl = getAbsoluteUrl();\n+        this.relativeUrl = getRelativeUrl();\n+    }\n+\n+    /**\n+     * This method is called to get the protocol of {@link ServiceURL}.\n+     *\n+     * @return String of the protocol.\n+     */\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    /**\n+     * This method is called to get the host name of {@link ServiceURL}.\n+     *\n+     * @return String of the host name.\n+     */\n+    public String getHostName() {\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        return hostName;\n+    }\n+\n+    /**\n+     * This method is called to get the port of {@link ServiceURL}.\n+     *\n+     * @return value of the port.\n+     */\n+    public int getPort() {\n+\n+        return port;\n+    }\n+\n+    /**\n+     * This method is called to get the Url path of {@link ServiceURL}.\n+     *\n+     * @return String of the url path.\n+     */\n+    public String getUrlPath() {\n+\n+        return urlPath;\n+    }\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    public String getParameter(String key) {\n+\n+        return parameters.get(key);\n+    }\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    public ArrayList<String> getParameterKeys() {\n+\n+        ArrayList<String> parameterArrayList = new ArrayList<>();\n+\n+        for (Map.Entry<String, String> entry : this.parameters.entrySet()) {\n+            parameterArrayList.add(entry.getKey());\n+        }\n+        return parameterArrayList;\n+    }\n+\n+    /**\n+     * This method is called to get the decoded fragment from the url.\n+     *\n+     * @return The decoded fragment.\n+     * @throws URLBuilderException\n+     */\n+    public String getFragment() throws URLBuilderException {\n+\n+        URI uri;\n+        try {\n+            uri = new URI(this.getAbsoluteUrl());\n+        } catch (URISyntaxException e) {\n+            throw new URLBuilderException(\"Error while trying to build the url\", e);\n+        }", "originalCommit": "a3d88d07a1d119aa10fd37fb0e240881de7e951a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDU1MTI3Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404551273", "bodyText": "Went this way because the fragments are set in two ways. Either by setFragment(String fragment) where the fragment is set via a String, or by setFragmentParameters(String key, String value).. When the fragment is added via the second method, we don't store the fragment as a string before we encode it and append to the url. To resolve this, we can introduce a variable to store the fragment as a string before it is encoded and appended to the URL.", "author": "chamathns", "createdAt": "2020-04-07T05:52:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NjM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMTk3Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404631973", "bodyText": "setFragement denotes -> fragement is fully replaced\naddFragementParameter -> denotes key value par is added as to the fragment and you can call it many times to add.", "author": "malithie", "createdAt": "2020-04-07T08:31:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI4NjM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMjYzNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404632637", "bodyText": "remove unnecessary line.\nAlso, hope we checked that factory gets resolved from OSGi service level", "author": "malithie", "createdAt": "2020-04-07T08:32:50Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.internal.DefaultServiceURLBuilder;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        if (IdentityCoreServiceComponent.getServiceURLBuilderFactory() != null) {\n+            return IdentityCoreServiceComponent.getServiceURLBuilderFactory().getServiceURLBuilder();\n+        } else {\n+            return new DefaultServiceURLBuilder();\n+        }\n+", "originalCommit": "7d90cbe5e7b303b6ef5affa22aee974ed1aac8e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDcxODczNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404718736", "bodyText": "Yes, created a dummy method and a test in IdentityUtil and checked this.", "author": "chamathns", "createdAt": "2020-04-07T10:55:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzMjYzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNDA1OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404634058", "bodyText": "As this a factory wouldn't it be better if we say createServiceURLBuilder, else it does not denote at once that a new builder will be created", "author": "malithie", "createdAt": "2020-04-07T08:35:04Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilderFactory.java", "diffHunk": "@@ -0,0 +1,38 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.internal.DefaultServiceURLBuilder;\n+\n+/**\n+ * Service URL Builder Factory representation.\n+ */\n+public class ServiceURLBuilderFactory {\n+\n+    /**\n+     * This method is called to create a {@link ServiceURLBuilder} instance.\n+     *\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    public ServiceURLBuilder getServiceURLBuilder() {", "originalCommit": "7d90cbe5e7b303b6ef5affa22aee974ed1aac8e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNDQ5Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404634496", "bodyText": "open for discussions @mefarazath", "author": "malithie", "createdAt": "2020-04-07T08:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNDA1OA=="}], "type": "inlineReview"}, {"oid": "4d5669512d85c459c670d72dfe0692fa7dddeeda", "url": "https://github.com/wso2/carbon-identity-framework/commit/4d5669512d85c459c670d72dfe0692fa7dddeeda", "message": "add test cases", "committedDate": "2020-04-07T08:35:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYzNTI0Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404635242", "bodyText": "move primitive types for top for readability", "author": "malithie", "createdAt": "2020-04-07T08:37:02Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,187 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.HashMap;\n+import java.util.Map;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private Map<String, String> parameters = new HashMap<>();\n+    private String fragment;\n+    private Map<String, String> fragmentParams = new HashMap<>();", "originalCommit": "4d5669512d85c459c670d72dfe0692fa7dddeeda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY0MTczMA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r404641730", "bodyText": "I don't think this API should accept both fragment and fragment parameters.\nJust keep the fragment here.\nBuild the fragment from builder class", "author": "malithie", "createdAt": "2020-04-07T08:47:16Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,265 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private int port;\n+    private String urlPath;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private Map<String, String> fragmentParams;\n+    private String resolvedFragmentString;\n+    private String resolvedParamsString;\n+    private String absoluteUrl;\n+    private String relativeUrl;\n+\n+    public ServiceURL(String protocol, String hostName, int port, String urlPath, Map<String, String> parameters,\n+                      String fragment, Map<String, String> fragmentParams) throws URLBuilderException {", "originalCommit": "4d5669512d85c459c670d72dfe0692fa7dddeeda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0Nzk5MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405047991", "bodyText": "In each of these methods we should check if the URL is built as expected. Null check is not enough", "author": "malithie", "createdAt": "2020-04-07T19:09:29Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/test/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilderTest.java", "diffHunk": "@@ -0,0 +1,174 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.context.ConfigurationContext;\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.mockito.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.testng.IObjectFactory;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.ObjectFactory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.base.IdentityConstants;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.URLResolverService;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.ConfigurationContextService;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+\n+import static org.mockito.Mockito.mock;\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+import static org.testng.Assert.assertNotNull;\n+\n+@PrepareForTest({ServerConfiguration.class, CarbonUtils.class, IdentityCoreServiceComponent.class, NetworkUtils.class,\n+        IdentityTenantUtil.class, URLResolverService.class, PrivilegedCarbonContext.class})\n+@PowerMockIgnore({\"javax.net.*\", \"javax.security.*\", \"javax.crypto.*\", \"javax.xml.*\", \"org.xml.sax.*\", \"org.w3c.dom\" +\n+        \".*\", \"org.apache.xerces.*\"})\n+public class DefaultServiceURLBuilderTest {\n+\n+    @Mock\n+    private ServerConfiguration mockServerConfiguration;\n+    @Mock\n+    private ConfigurationContextService mockConfigurationContextService;\n+    @Mock\n+    private ConfigurationContext mockConfigurationContext;\n+    @Mock\n+    private AxisConfiguration mockAxisConfiguration;\n+\n+    @BeforeMethod\n+    public void setUp() throws Exception {\n+\n+        mockStatic(CarbonUtils.class);\n+        mockStatic(ServerConfiguration.class);\n+        mockStatic(NetworkUtils.class);\n+        mockStatic(IdentityCoreServiceComponent.class);\n+        mockStatic(IdentityTenantUtil.class);\n+        mockStatic(PrivilegedCarbonContext.class);\n+        PrivilegedCarbonContext privilegedCarbonContext = mock(PrivilegedCarbonContext.class);\n+\n+        when(PrivilegedCarbonContext.getThreadLocalCarbonContext()).thenReturn(privilegedCarbonContext);\n+        when(ServerConfiguration.getInstance()).thenReturn(mockServerConfiguration);\n+        when(IdentityCoreServiceComponent.getConfigurationContextService()).thenReturn(mockConfigurationContextService);\n+        when(mockConfigurationContextService.getServerConfigContext()).thenReturn(mockConfigurationContext);\n+        when(mockConfigurationContext.getAxisConfiguration()).thenReturn(mockAxisConfiguration);\n+        try {\n+            when(NetworkUtils.getLocalHostname()).thenReturn(\"localhost\");\n+        } catch (SocketException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        System.setProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTP_PROPERTY, \"9763\");\n+        System.setProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTPS_PROPERTY, \"9443\");\n+    }\n+\n+    @AfterMethod\n+    public void tearDown() throws Exception {\n+\n+        System.clearProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTP_PROPERTY);\n+        System.clearProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTPS_PROPERTY);\n+    }\n+\n+    @Test\n+    public void testAddPath() {\n+\n+        String testPath = \"/testPath\";\n+        ServiceURL serviceURL = null;\n+        try {\n+            serviceURL = ServiceURLBuilder.create().addPath(testPath).build();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertNotNull(serviceURL.getUrlPath());", "originalCommit": "4d5669512d85c459c670d72dfe0692fa7dddeeda", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0ODcwNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405048706", "bodyText": "basically verify for absolute url, relative url and the respective component like fragment, parameter etc.", "author": "malithie", "createdAt": "2020-04-07T19:10:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0Nzk5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTIxOTI1Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405219256", "bodyText": "That is done in the ServiceURLTest class.\nref: \n  \n    \n      carbon-identity-framework/components/identity-core/org.wso2.carbon.identity.core/src/test/java/org/wso2/carbon/identity/core/model/ServiceURLTest.java\n    \n    \n         Line 182\n      in\n      4d56695\n    \n    \n    \n    \n\n        \n          \n           public void testGetAbsoluteURL(String protocol, String hostName, int port, String urlPath,", "author": "chamathns", "createdAt": "2020-04-08T02:15:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0Nzk5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3MDQ0Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405370442", "bodyText": "Then why check null. Shouldn't the expectation is to verify the path added", "author": "malithie", "createdAt": "2020-04-08T09:03:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTA0Nzk5MQ=="}], "type": "inlineReview"}, {"oid": "c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "url": "https://github.com/wso2/carbon-identity-framework/commit/c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "message": "implement serverURL model\n\nimplement the API to build URL from context/s\n\nadd the legacy getServerURL method\n\nre-structure the API to support only the tenant-qualified mode\n\nregister ServiceURLBuilderFactory as an OSGi service\n\nadd test cases", "committedDate": "2020-04-08T03:59:28Z", "type": "commit"}, {"oid": "c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "url": "https://github.com/wso2/carbon-identity-framework/commit/c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "message": "implement serverURL model\n\nimplement the API to build URL from context/s\n\nadd the legacy getServerURL method\n\nre-structure the API to support only the tenant-qualified mode\n\nregister ServiceURLBuilderFactory as an OSGi service\n\nadd test cases", "committedDate": "2020-04-08T03:59:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2MDM5OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405360399", "bodyText": "Should this check be here ?\nIdeally it hostname here should not set with '/'. It should be validated at the URL builder level", "author": "malithie", "createdAt": "2020-04-08T08:48:26Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,252 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private int port;\n+    private String urlPath;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private String resolvedParamsString;\n+    private String absoluteUrl;\n+    private String relativeUrl;\n+\n+    public ServiceURL(String protocol, String hostName, int port, String urlPath, Map<String, String> parameters,\n+                      String fragment) throws URLBuilderException {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.urlPath = urlPath;\n+        this.parameters = parameters;\n+        this.fragment = fragment;\n+        setParamsString();\n+        this.absoluteUrl = getAbsoluteUrl();\n+        this.relativeUrl = getRelativeUrl();\n+    }\n+\n+    /**\n+     * This method is called to get the protocol of {@link ServiceURL}.\n+     *\n+     * @return String of the protocol.\n+     */\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    /**\n+     * This method is called to get the host name of {@link ServiceURL}.\n+     *\n+     * @return String of the host name.\n+     */\n+    public String getHostName() {\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }", "originalCommit": "c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2Njg3OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405366879", "bodyText": "Yes, will move it to the DefaultServiceURLBuilder class.", "author": "chamathns", "createdAt": "2020-04-08T08:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2MDM5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2NjAwMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405366001", "bodyText": "Having this public will be a problem. Looks like no option here though unless we move packages", "author": "malithie", "createdAt": "2020-04-08T08:57:06Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,252 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private int port;\n+    private String urlPath;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private String resolvedParamsString;\n+    private String absoluteUrl;\n+    private String relativeUrl;\n+\n+    public ServiceURL(String protocol, String hostName, int port, String urlPath, Map<String, String> parameters,", "originalCommit": "c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2NjkzMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405366933", "bodyText": "Add more context info here", "author": "malithie", "createdAt": "2020-04-08T08:58:31Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/model/ServiceURL.java", "diffHunk": "@@ -0,0 +1,252 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.model;\n+\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Service URL representation.\n+ */\n+public class ServiceURL {\n+\n+    private String protocol;\n+    private String hostName;\n+    private int port;\n+    private String urlPath;\n+    private Map<String, String> parameters;\n+    private String fragment;\n+    private String resolvedParamsString;\n+    private String absoluteUrl;\n+    private String relativeUrl;\n+\n+    public ServiceURL(String protocol, String hostName, int port, String urlPath, Map<String, String> parameters,\n+                      String fragment) throws URLBuilderException {\n+\n+        this.protocol = protocol;\n+        this.hostName = hostName;\n+        this.port = port;\n+        this.urlPath = urlPath;\n+        this.parameters = parameters;\n+        this.fragment = fragment;\n+        setParamsString();\n+        this.absoluteUrl = getAbsoluteUrl();\n+        this.relativeUrl = getRelativeUrl();\n+    }\n+\n+    /**\n+     * This method is called to get the protocol of {@link ServiceURL}.\n+     *\n+     * @return String of the protocol.\n+     */\n+    public String getProtocol() {\n+\n+        return protocol;\n+    }\n+\n+    /**\n+     * This method is called to get the host name of {@link ServiceURL}.\n+     *\n+     * @return String of the host name.\n+     */\n+    public String getHostName() {\n+\n+        if (hostName.endsWith(\"/\")) {\n+            hostName = hostName.substring(0, hostName.length() - 1);\n+        }\n+        return hostName;\n+    }\n+\n+    /**\n+     * This method is called to get the port of {@link ServiceURL}.\n+     *\n+     * @return value of the port.\n+     */\n+    public int getPort() {\n+\n+        return port;\n+    }\n+\n+    /**\n+     * This method is called to get the Url path of {@link ServiceURL}.\n+     *\n+     * @return String of the url path.\n+     */\n+    public String getUrlPath() {\n+\n+        return urlPath;\n+    }\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    public String getParameter(String key) {\n+\n+        return parameters.get(key);\n+    }\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    public String[] getParameterKeys() {\n+\n+        ArrayList<String> parameterArrayList = new ArrayList<>();\n+\n+        for (Map.Entry<String, String> entry : this.parameters.entrySet()) {\n+            parameterArrayList.add(entry.getKey());\n+        }\n+        return parameterArrayList.toArray(new String[0]);\n+    }\n+\n+    /**\n+     * This method is called to get the decoded fragment from the url.\n+     *\n+     * @return The decoded fragment.\n+     * @throws URLBuilderException\n+     */\n+    public String getFragment() {\n+\n+        return fragment;\n+    }\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the {@link ServiceURL} instance.\n+     */\n+    public String getAbsoluteURL() {\n+\n+        return this.absoluteUrl;\n+    }\n+\n+    /**\n+     * This method is called to get the relative url from the url context.\n+     *\n+     * @return The relative URL from the {@link ServiceURL} instance.\n+     */\n+    public String getRelativeURL() {\n+\n+        return this.relativeUrl;\n+    }\n+\n+    private void appendContextToUri(StringBuilder serverUrl, String contextPath) {\n+\n+        if (StringUtils.isNotBlank(contextPath)) {\n+            if (contextPath.endsWith(\"/\")) {\n+                contextPath = contextPath.substring(0, contextPath.length() - 1);\n+            }\n+            if (StringUtils.isNotBlank(contextPath) && contextPath.trim().charAt(0) != '/') {\n+                serverUrl.append(\"/\").append(contextPath.trim());\n+            } else {\n+                serverUrl.append(contextPath.trim());\n+            }\n+        }\n+    }\n+\n+    private void appendParamsToUri(StringBuilder serverUrl, String resolvedParamsString, String delimiter)\n+            throws URLBuilderException {\n+\n+        if (serverUrl.length() > 0 && serverUrl.charAt(serverUrl.length() - 1) == '/') {\n+            serverUrl.setLength(serverUrl.length() - 1);\n+        }\n+        if (StringUtils.isNotBlank(resolvedParamsString)) {\n+            try {\n+                serverUrl.append(delimiter).append(URLEncoder.encode(resolvedParamsString,\n+                        StandardCharsets.UTF_8.name()));\n+            } catch (UnsupportedEncodingException e) {\n+                throw new URLBuilderException(\"Error while trying to build the url\", e);", "originalCommit": "c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2NzYwOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405367609", "bodyText": "Shouldn't we return with an error code. @mefarazath what was the approach followed previously. Was it in API level we returned with error codes", "author": "malithie", "createdAt": "2020-04-08T08:59:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM2NjkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3OTQ3NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405379475", "bodyText": "Can there be a situation where we will have both the fragment string and fragment params?", "author": "mefarazath", "createdAt": "2020-04-08T09:17:34Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,213 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.model.ServiceURL;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+import static org.wso2.carbon.identity.core.util.IdentityTenantUtil.isTenantQualifiedUrlsEnabled;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for {@link ServiceURL} instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private String fragment;\n+    private Map<String, String> parameters = new HashMap<>();\n+    private Map<String, String> fragmentParams = new HashMap<>();\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentParameter(String key, String value) {\n+\n+        fragmentParams.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        int port = fetchPort();\n+        String resolvedUrlContext = buildUrlPath(urlPaths);\n+        String resolvedFragment = buildFragment(fragment, fragmentParams);\n+        String tenantDomain = resolveTenantDomain();\n+\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (isTenantQualifiedUrlsEnabled()) {\n+            if (StringUtils.isNotBlank(tenantDomain)) {\n+                resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            if (resolvedUrlContext.trim().charAt(0) != '/') {\n+                resolvedUrlStringBuilder.append(\"/\").append(resolvedUrlContext.trim());\n+            } else {\n+                resolvedUrlStringBuilder.append(resolvedUrlContext.trim());\n+            }\n+        }\n+\n+        return new ServiceURL(protocol, hostName, port, resolvedUrlStringBuilder.toString(), parameters,\n+                resolvedFragment);\n+    }\n+\n+    private String resolveTenantDomain() {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        return tenantDomain;\n+    }\n+\n+    private String buildFragment(String fragment, Map<String, String> fragmentParams) {\n+\n+        if (StringUtils.isNotBlank(fragment)) {", "originalCommit": "c9537e11526020c2f109a77f1ecf4c2c8d2977e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQwNjM5Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405406396", "bodyText": "The spec for URIs [1] says the semantics of the fragment are considered unknown and are effectively unconstrained. So, if we want to accommodate such a case, we can have it. But, we need to rethink the fragment structure then..\nref: https://tools.ietf.org/html/rfc3986#section-3.5", "author": "chamathns", "createdAt": "2020-04-08T10:00:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3OTQ3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NTE3MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405685170", "bodyText": "Let's not have both. setFragment() denotes it overrides. Common practice followed", "author": "malithie", "createdAt": "2020-04-08T17:16:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTM3OTQ3NQ=="}], "type": "inlineReview"}, {"oid": "6f20a0f7394b0e58582cb69fc9bb892bc32d28a3", "url": "https://github.com/wso2/carbon-identity-framework/commit/6f20a0f7394b0e58582cb69fc9bb892bc32d28a3", "message": "resolve minor issues", "committedDate": "2020-04-08T10:08:27Z", "type": "commit"}, {"oid": "e73fa47dbbd6344d346a51c1855078d343ae7f5d", "url": "https://github.com/wso2/carbon-identity-framework/commit/e73fa47dbbd6344d346a51c1855078d343ae7f5d", "message": "Change Service URL to an interface and move its impl to the DefaultServiceURLBuilder", "committedDate": "2020-04-08T13:24:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUyMTI4MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405521280", "bodyText": "Can we make this a list or a set?", "author": "mefarazath", "createdAt": "2020-04-08T13:23:55Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {\n+\n+    /**\n+     * This method is called to get the protocol of Service URL.\n+     *\n+     * @return String of the protocol.\n+     */\n+    String getProtocol();\n+\n+    /**\n+     * This method is called to get the host name of Service URL.\n+     *\n+     * @return String of the host name.\n+     */\n+    String getHostName();\n+\n+    /**\n+     * This method is called to get the port of Service URL.\n+     *\n+     * @return value of the port.\n+     */\n+    int getPort();\n+\n+    /**\n+     * This method is called to get the Url path of Service URL.\n+     *\n+     * @return String of the url path.\n+     */\n+    String getUrlPath();\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    String getParameter(String key);\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    String[] getParameterKeys();", "originalCommit": "48da867a3d8c32bfd82d795476da71929430c82d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU0MjA3MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405542070", "bodyText": "The list we return should be unmodifiable, yes?", "author": "chamathns", "createdAt": "2020-04-08T13:52:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUyMTI4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUyMTg2Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405521862", "bodyText": "Also would be useful to return all parameters as a map.", "author": "mefarazath", "createdAt": "2020-04-08T13:24:42Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {\n+\n+    /**\n+     * This method is called to get the protocol of Service URL.\n+     *\n+     * @return String of the protocol.\n+     */\n+    String getProtocol();\n+\n+    /**\n+     * This method is called to get the host name of Service URL.\n+     *\n+     * @return String of the host name.\n+     */\n+    String getHostName();\n+\n+    /**\n+     * This method is called to get the port of Service URL.\n+     *\n+     * @return value of the port.\n+     */\n+    int getPort();\n+\n+    /**\n+     * This method is called to get the Url path of Service URL.\n+     *\n+     * @return String of the url path.\n+     */\n+    String getUrlPath();\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    String getParameter(String key);", "originalCommit": "48da867a3d8c32bfd82d795476da71929430c82d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUyMjE5OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405522199", "bodyText": "Looks like too many new lines at the end", "author": "mefarazath", "createdAt": "2020-04-08T13:25:07Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {\n+\n+    /**\n+     * This method is called to get the protocol of Service URL.\n+     *\n+     * @return String of the protocol.\n+     */\n+    String getProtocol();\n+\n+    /**\n+     * This method is called to get the host name of Service URL.\n+     *\n+     * @return String of the host name.\n+     */\n+    String getHostName();\n+\n+    /**\n+     * This method is called to get the port of Service URL.\n+     *\n+     * @return value of the port.\n+     */\n+    int getPort();\n+\n+    /**\n+     * This method is called to get the Url path of Service URL.\n+     *\n+     * @return String of the url path.\n+     */\n+    String getUrlPath();\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    String getParameter(String key);\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    String[] getParameterKeys();\n+\n+    /**\n+     * This method is called to get the decoded fragment from the url.\n+     *\n+     * @return The decoded fragment.\n+     */\n+    String getFragment();\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the Service URL instance.\n+     */\n+    String getAbsoluteURL() throws URLBuilderException;\n+\n+    /**\n+     * This method is called to get the relative url from the url context.\n+     *\n+     * @return The relative URL from the Service URL instance.\n+     */\n+    String getRelativeURL() throws URLBuilderException;\n+\n+\n+\n+", "originalCommit": "e73fa47dbbd6344d346a51c1855078d343ae7f5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUyMjkwMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405522903", "bodyText": "How about an API to get the tenant domain?", "author": "mefarazath", "createdAt": "2020-04-08T13:26:13Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {", "originalCommit": "e73fa47dbbd6344d346a51c1855078d343ae7f5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU0OTk2OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405549969", "bodyText": "Since we return the param map, just wondering whether we would have an actual requirement to return the keys. WDYT?", "author": "mefarazath", "createdAt": "2020-04-08T14:03:29Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {\n+\n+    /**\n+     * This method is called to get the protocol of Service URL.\n+     *\n+     * @return String of the protocol.\n+     */\n+    String getProtocol();\n+\n+    /**\n+     * This method is called to get the host name of Service URL.\n+     *\n+     * @return String of the host name.\n+     */\n+    String getHostName();\n+\n+    /**\n+     * This method is called to get the port of Service URL.\n+     *\n+     * @return value of the port.\n+     */\n+    int getPort();\n+\n+    /**\n+     * This method is called to get the Url path of Service URL.\n+     *\n+     * @return String of the url path.\n+     */\n+    String getUrlPath();\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    String getParameter(String key);\n+\n+    /**\n+     * This method is called to get a map of the parameters.\n+     *\n+     * @return The parameters.\n+     */\n+    Map<String, String> getParameters();\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    List<String> getParameterKeys();", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4MjcwNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405682706", "bodyText": "yeh possibly not. let's remove this", "author": "malithie", "createdAt": "2020-04-08T17:12:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU0OTk2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU1MzUwNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405553504", "bodyText": "Would it make sense to name this as getPath()?\ngetPath() is a commonly used https://docs.oracle.com/javase/7/docs/api/java/net/URL.html#getPath()", "author": "mefarazath", "createdAt": "2020-04-08T14:08:31Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {\n+\n+    /**\n+     * This method is called to get the protocol of Service URL.\n+     *\n+     * @return String of the protocol.\n+     */\n+    String getProtocol();\n+\n+    /**\n+     * This method is called to get the host name of Service URL.\n+     *\n+     * @return String of the host name.\n+     */\n+    String getHostName();\n+\n+    /**\n+     * This method is called to get the port of Service URL.\n+     *\n+     * @return value of the port.\n+     */\n+    int getPort();\n+\n+    /**\n+     * This method is called to get the Url path of Service URL.\n+     *\n+     * @return String of the url path.\n+     */\n+    String getUrlPath();", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkyMDY2Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405920667", "bodyText": "+1 to use getPath()", "author": "malithie", "createdAt": "2020-04-09T02:26:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU1MzUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU1NTM4Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405555382", "bodyText": "New line at EOF", "author": "mefarazath", "createdAt": "2020-04-08T14:11:08Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/test/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilderTest.java", "diffHunk": "@@ -0,0 +1,234 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.context.ConfigurationContext;\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.mockito.Mock;\n+import org.powermock.core.classloader.annotations.PowerMockIgnore;\n+import org.powermock.core.classloader.annotations.PrepareForTest;\n+import org.testng.IObjectFactory;\n+import org.testng.annotations.AfterMethod;\n+import org.testng.annotations.BeforeMethod;\n+import org.testng.annotations.ObjectFactory;\n+import org.testng.annotations.Test;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.base.IdentityConstants;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.URLResolverService;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.ConfigurationContextService;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.net.SocketException;\n+import java.util.Arrays;\n+import java.util.List;\n+\n+import static org.mockito.Mockito.mock;\n+import static org.powermock.api.mockito.PowerMockito.mockStatic;\n+import static org.powermock.api.mockito.PowerMockito.when;\n+import static org.testng.Assert.assertEquals;\n+\n+@PrepareForTest({ServerConfiguration.class, CarbonUtils.class, IdentityCoreServiceComponent.class, NetworkUtils.class,\n+        IdentityTenantUtil.class, URLResolverService.class, PrivilegedCarbonContext.class})\n+@PowerMockIgnore({\"javax.net.*\", \"javax.security.*\", \"javax.crypto.*\", \"javax.xml.*\", \"org.xml.sax.*\", \"org.w3c.dom\" +\n+        \".*\", \"org.apache.xerces.*\"})\n+public class DefaultServiceURLBuilderTest {\n+\n+    @Mock\n+    private ServerConfiguration mockServerConfiguration;\n+    @Mock\n+    private ConfigurationContextService mockConfigurationContextService;\n+    @Mock\n+    private ConfigurationContext mockConfigurationContext;\n+    @Mock\n+    private AxisConfiguration mockAxisConfiguration;\n+\n+    @BeforeMethod\n+    public void setUp() throws Exception {\n+\n+        mockStatic(CarbonUtils.class);\n+        mockStatic(ServerConfiguration.class);\n+        mockStatic(NetworkUtils.class);\n+        mockStatic(IdentityCoreServiceComponent.class);\n+        mockStatic(IdentityTenantUtil.class);\n+        mockStatic(PrivilegedCarbonContext.class);\n+        PrivilegedCarbonContext privilegedCarbonContext = mock(PrivilegedCarbonContext.class);\n+\n+        when(PrivilegedCarbonContext.getThreadLocalCarbonContext()).thenReturn(privilegedCarbonContext);\n+        when(ServerConfiguration.getInstance()).thenReturn(mockServerConfiguration);\n+        when(IdentityCoreServiceComponent.getConfigurationContextService()).thenReturn(mockConfigurationContextService);\n+        when(mockConfigurationContextService.getServerConfigContext()).thenReturn(mockConfigurationContext);\n+        when(mockConfigurationContext.getAxisConfiguration()).thenReturn(mockAxisConfiguration);\n+        try {\n+            when(NetworkUtils.getLocalHostname()).thenReturn(\"localhost\");\n+        } catch (SocketException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        System.setProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTP_PROPERTY, \"9763\");\n+        System.setProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTPS_PROPERTY, \"9443\");\n+    }\n+\n+    @AfterMethod\n+    public void tearDown() throws Exception {\n+\n+        System.clearProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTP_PROPERTY);\n+        System.clearProperty(IdentityConstants.CarbonPlaceholders.CARBON_PORT_HTTPS_PROPERTY);\n+    }\n+\n+    @Test\n+    public void testAddPath() {\n+\n+        String testPath = \"/testPath\";\n+        String urlPath = null;\n+        try {\n+            urlPath = ServiceURLBuilder.create().addPath(testPath).build().getUrlPath();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(urlPath, testPath);\n+    }\n+\n+    @Test\n+    public void testAddPaths() {\n+\n+        String testPath1 = \"/testPath1\";\n+        String testPath2 = \"testPath2/\";\n+        String testPath3 = \"/testPath3/\";\n+        String urlPath = null;\n+        try {\n+            urlPath = ServiceURLBuilder.create().addPath(testPath1, testPath2, testPath3).build().getUrlPath();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(urlPath, \"/testPath1/testPath2/testPath3\");\n+    }\n+\n+    @Test\n+    public void testAddParameter() {\n+\n+        String parameterValue = null;\n+        try {\n+            parameterValue = ServiceURLBuilder.create().addParameter(\"key\", \"value\").build().getParameter(\"key\");\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(parameterValue, \"value\");\n+    }\n+\n+    @Test\n+    public void testAddParameters() {\n+\n+        List<String> parameters = null;\n+        try {\n+            parameters =\n+                    ServiceURLBuilder.create().addParameter(\"key1\", \"value1\").addParameter(\"key2\", \"value2\").build().getParameterKeys();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(parameters, Arrays.asList(\"key1\", \"key2\"));\n+    }\n+\n+    @Test\n+    public void testSetFragment() {\n+\n+        when(CarbonUtils.getManagementTransport()).thenReturn(\"https\");\n+        String fragment = null;\n+        try {\n+            fragment = ServiceURLBuilder.create().setFragment(\"fragment\").build().getFragment();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(fragment, \"fragment\");\n+    }\n+\n+    @Test\n+    public void testAddFragmentParameter() {\n+\n+        String fragment = null;\n+\n+        try {\n+            fragment =\n+                    ServiceURLBuilder.create().addFragmentParameter(\"key1\", \"value1\").addFragmentParameter(\"key2\",\n+                            \"value2\").build().getFragment();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(fragment, \"key1=value1&key2=value2\");\n+    }\n+\n+    @Test\n+    public void testAddFragmentParameters() {\n+\n+        String fragment = null;\n+\n+        try {\n+            fragment =\n+                    ServiceURLBuilder.create().addFragmentParameter(\"key1\", \"value1\").addFragmentParameter(\"key2\",\n+                            \"value2\").build().getFragment();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(fragment, \"key1=value1&key2=value2\");\n+    }\n+\n+    @Test\n+    public void testBuild() {\n+\n+        String absoluteUrl = null;\n+        String testPath1 = \"/testPath1\";\n+        String testPath2 = \"testPath2/\";\n+        String testPath3 = \"/testPath3/\";\n+        String[] keysList = {\"key1\", \"key2\", \"key3\"};\n+        String[] valuesList = {\"value1\", \"value2\", \"value3\"};\n+\n+        try {\n+            absoluteUrl =\n+                    ServiceURLBuilder.create().addPath(testPath1, testPath2, testPath3).addParameter(keysList[0],\n+                            valuesList[0]).addParameter(keysList[1], valuesList[1]).addParameter(keysList[2],\n+                            valuesList[2]).addFragmentParameter(keysList[0], valuesList[0])\n+                            .addFragmentParameter(keysList[1], valuesList[1])\n+                            .addFragmentParameter(keysList[2], valuesList[2]).build().getAbsoluteURL();\n+        } catch (URLBuilderException e) {\n+            // Mock behaviour, hence ignored\n+        }\n+\n+        assertEquals(absoluteUrl,\n+                \"null://localhost:0/testPath1/testPath2/testPath3?key1%3Dvalue1%26key2%3Dvalue2%26key3%3Dvalue3#key1%3Dvalue1%26key2%3Dvalue2%26key3%3Dvalue3\");\n+\n+    }\n+\n+    @ObjectFactory\n+    public IObjectFactory getObjectFactory() {\n+\n+        return new org.powermock.modules.testng.PowerMockObjectFactory();\n+    }\n+\n+}", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4MzYwNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405683606", "bodyText": "remove redundant code", "author": "malithie", "createdAt": "2020-04-08T17:13:30Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,426 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURL;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.SocketException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for Service URL instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private String fragment;\n+    private Map<String, String> parameters = new HashMap<>();\n+    private Map<String, String> fragmentParams = new HashMap<>();\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentParameter(String key, String value) {\n+\n+        fragmentParams.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public org.wso2.carbon.identity.core.ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        int port = fetchPort();\n+        String resolvedUrlContext = buildUrlPath(urlPaths);\n+        String resolvedFragment = buildFragment(fragment, fragmentParams);\n+        String tenantDomain = resolveTenantDomain();\n+\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (StringUtils.isNotBlank(tenantDomain)) {\n+            resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            if (resolvedUrlContext.trim().charAt(0) != '/') {\n+                resolvedUrlStringBuilder.append(\"/\").append(resolvedUrlContext.trim());\n+            } else {\n+                resolvedUrlStringBuilder.append(resolvedUrlContext.trim());\n+            }\n+        }\n+\n+//        return new ServiceURL(protocol, hostName, port, resolvedUrlStringBuilder.toString(), parameters,\n+//                resolvedFragment);\n+", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NjM0MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405686341", "bodyText": "It's fine for the builder to throw URLBuilderException while building the URL. But ServiceURL POJO should not throw it when getting absolute URL or relative URL", "author": "malithie", "createdAt": "2020-04-08T17:18:03Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,426 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURL;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.SocketException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for Service URL instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private String fragment;\n+    private Map<String, String> parameters = new HashMap<>();\n+    private Map<String, String> fragmentParams = new HashMap<>();\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentParameter(String key, String value) {\n+\n+        fragmentParams.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public org.wso2.carbon.identity.core.ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        int port = fetchPort();\n+        String resolvedUrlContext = buildUrlPath(urlPaths);\n+        String resolvedFragment = buildFragment(fragment, fragmentParams);\n+        String tenantDomain = resolveTenantDomain();\n+\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (StringUtils.isNotBlank(tenantDomain)) {\n+            resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            if (resolvedUrlContext.trim().charAt(0) != '/') {\n+                resolvedUrlStringBuilder.append(\"/\").append(resolvedUrlContext.trim());\n+            } else {\n+                resolvedUrlStringBuilder.append(resolvedUrlContext.trim());\n+            }\n+        }\n+\n+//        return new ServiceURL(protocol, hostName, port, resolvedUrlStringBuilder.toString(), parameters,\n+//                resolvedFragment);\n+\n+        return new ServiceURL() {\n+\n+            /**\n+             * This method is called to get the protocol of Service URL.\n+             *\n+             * @return String of the protocol.\n+             */\n+            @Override\n+            public String getProtocol() {\n+\n+                return protocol;\n+            }\n+\n+            /**\n+             * This method is called to get the host name of Service URL.\n+             *\n+             * @return String of the host name.\n+             */\n+            @Override\n+            public String getHostName() {\n+\n+                return hostName;\n+            }\n+\n+            /**\n+             * This method is called to get the port of Service URL.\n+             *\n+             * @return value of the port.\n+             */\n+            @Override\n+            public int getPort() {\n+\n+                return port;\n+            }\n+\n+            /**\n+             * This method is called to get the Url path of Service URL.\n+             *\n+             * @return String of the url path.\n+             */\n+            @Override\n+            public String getUrlPath() {\n+\n+                return resolvedUrlStringBuilder.toString();\n+            }\n+\n+            /**\n+             * This method is called to get the parameter value when the key is provided.\n+             *\n+             * @param key Key of the parameter.\n+             * @return The value of the parameter.\n+             */\n+            @Override\n+            public String getParameter(String key) {\n+\n+                return parameters.get(key);\n+            }\n+\n+            /**\n+             * This method is called to get a map of the parameters.\n+             *\n+             * @return The parameters.\n+             */\n+            @Override\n+            public Map<String, String> getParameters() {\n+\n+                return Collections.unmodifiableMap(parameters);\n+            }\n+\n+            /**\n+             * This method is called to get a list of the parameter names.\n+             *\n+             * @return List of parameter keys.\n+             */\n+            @Override\n+            public List<String> getParameterKeys() {\n+\n+                ArrayList<String> parameterArrayList = new ArrayList<>();\n+\n+                for (Map.Entry<String, String> entry : parameters.entrySet()) {\n+                    parameterArrayList.add(entry.getKey());\n+                }\n+                return Collections.unmodifiableList(parameterArrayList);\n+            }\n+\n+            /**\n+             * This method is called to get the decoded fragment from the url.\n+             *\n+             * @return The decoded fragment.\n+             */\n+            @Override\n+            public String getFragment() {\n+\n+                return resolvedFragment;\n+            }\n+\n+            /**\n+             * This method is called to get the tenant domain appended in the URL.\n+             *\n+             * @return The tenant domain.\n+             */\n+            @Override\n+            public String getTenantDomain() {\n+\n+                return tenantDomain;\n+            }\n+\n+            /**\n+             * Concatenate the protocol, host name, port, proxy context path, web context root and url context to\n+             * return the absolute URL.\n+             *\n+             * @return The absolute URL from the Service URL instance.\n+             */\n+            @Override\n+            public String getAbsoluteURL() throws URLBuilderException {", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4NzQxMQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405687411", "bodyText": "This is a long class to implement as an anonymous. Impacts readability", "author": "malithie", "createdAt": "2020-04-08T17:19:49Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,426 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURL;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.SocketException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for Service URL instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String[] urlPaths;\n+    private String fragment;\n+    private Map<String, String> parameters = new HashMap<>();\n+    private Map<String, String> fragmentParams = new HashMap<>();\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context path. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addPath(String ... paths) {\n+\n+        this.urlPaths = paths;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addParameter(String key, String value) {\n+\n+        parameters.put(key, value);\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder setFragment(String fragment) {\n+\n+        this.fragment = fragment;\n+        return this;\n+    }\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    @Override\n+    public ServiceURLBuilder addFragmentParameter(String key, String value) {\n+\n+        fragmentParams.put(key, value);\n+        return this;\n+    }\n+\n+    @Override\n+    public org.wso2.carbon.identity.core.ServiceURL build() throws URLBuilderException {\n+\n+        String protocol = fetchProtocol();\n+        String hostName = fetchHostName();\n+        int port = fetchPort();\n+        String resolvedUrlContext = buildUrlPath(urlPaths);\n+        String resolvedFragment = buildFragment(fragment, fragmentParams);\n+        String tenantDomain = resolveTenantDomain();\n+\n+        StringBuilder resolvedUrlStringBuilder = new StringBuilder();\n+        if (StringUtils.isNotBlank(tenantDomain)) {\n+            resolvedUrlStringBuilder.append(\"/t/\").append(tenantDomain);\n+        }\n+\n+        if (StringUtils.isNotBlank(resolvedUrlContext)) {\n+            if (resolvedUrlContext.trim().charAt(0) != '/') {\n+                resolvedUrlStringBuilder.append(\"/\").append(resolvedUrlContext.trim());\n+            } else {\n+                resolvedUrlStringBuilder.append(resolvedUrlContext.trim());\n+            }\n+        }\n+\n+//        return new ServiceURL(protocol, hostName, port, resolvedUrlStringBuilder.toString(), parameters,\n+//                resolvedFragment);\n+\n+        return new ServiceURL() {", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTY4ODE1OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405688159", "bodyText": "I don't think exceptions should be thrown from here", "author": "malithie", "createdAt": "2020-04-08T17:21:00Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURL.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import java.util.List;\n+import java.util.Map;\n+\n+/**\n+ * Service URL interface.\n+ */\n+public interface ServiceURL {\n+\n+    /**\n+     * This method is called to get the protocol of Service URL.\n+     *\n+     * @return String of the protocol.\n+     */\n+    String getProtocol();\n+\n+    /**\n+     * This method is called to get the host name of Service URL.\n+     *\n+     * @return String of the host name.\n+     */\n+    String getHostName();\n+\n+    /**\n+     * This method is called to get the port of Service URL.\n+     *\n+     * @return value of the port.\n+     */\n+    int getPort();\n+\n+    /**\n+     * This method is called to get the Url path of Service URL.\n+     *\n+     * @return String of the url path.\n+     */\n+    String getUrlPath();\n+\n+    /**\n+     * This method is called to get the parameter value when the key is provided.\n+     *\n+     * @param key Key of the parameter.\n+     * @return The value of the parameter.\n+     */\n+    String getParameter(String key);\n+\n+    /**\n+     * This method is called to get a map of the parameters.\n+     *\n+     * @return The parameters.\n+     */\n+    Map<String, String> getParameters();\n+\n+    /**\n+     * This method is called to get a list of the parameter names.\n+     *\n+     * @return ArrayList of parameter keys.\n+     */\n+    List<String> getParameterKeys();\n+\n+    /**\n+     * This method is called to get the decoded fragment from the url.\n+     *\n+     * @return The decoded fragment.\n+     */\n+    String getFragment();\n+\n+    /**\n+     * This method is called to get the tenant domain appended in the URL.\n+     *\n+     * @return The tenant domain.\n+     */\n+    String getTenantDomain();\n+\n+    /**\n+     * Concatenate the protocol, host name, port, proxy context path, web context root and url context to return the\n+     * absolute URL.\n+     *\n+     * @return The absolute URL from the Service URL instance.\n+     */\n+    String getAbsoluteURL() throws URLBuilderException;", "originalCommit": "447c47842a216c029b82dd400be2523e262c2367", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzNDkyMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405934922", "bodyText": "Let's stick to one exception type. No need to re-wrap and throw. These are not two specific types we should declare. Rather you have been wrapping the same thing.", "author": "malithie", "createdAt": "2020-04-09T03:25:20Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/ServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core;\n+\n+import org.wso2.carbon.identity.core.internal.DefaultServiceURLBuilder;\n+import org.wso2.carbon.identity.core.internal.IdentityCoreServiceComponent;\n+\n+/**\n+ * URL Builder service interface.\n+ */\n+public interface ServiceURLBuilder {\n+\n+    static ServiceURLBuilder create() {\n+\n+        if (IdentityCoreServiceComponent.getServiceURLBuilderFactory() != null) {\n+            return IdentityCoreServiceComponent.getServiceURLBuilderFactory().createServiceURLBuilder();\n+        } else {\n+            return new DefaultServiceURLBuilder();\n+        }\n+    }\n+\n+    /**\n+     * This method is called to add the URL path to the builder.\n+     *\n+     * @param paths Context paths. Can provide multiple context paths with a comma separated string.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addPath(String ... paths);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with other parameters. Such parameters should be\n+     * entered as <k,v> pairs.\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addParameter(String key, String value);\n+\n+    /**\n+     * This method is called when the URL needs to be appended with a fragment.\n+     *\n+     * @param fragment Fragment.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder setFragment(String fragment);\n+\n+    /**\n+     * This method is called when the URL fragment needs to be appended with parameters. Such parameters should be\n+     * entered as <k,v> pairs. These parameters will get appended with an \"&\".\n+     *\n+     * @param key   Key.\n+     * @param value Value.\n+     * @return {@link ServiceURLBuilder}.\n+     */\n+    ServiceURLBuilder addFragmentParameter(String key, String value);\n+\n+    /**\n+     * This method is used to return a ServiceURL with the protocol, hostname, port, proxy context path, a web context\n+     * root and the tenant domain (appended if required).\n+     *\n+     * @return {@link ServiceURL}.\n+     * @throws URLBuilderException If error occurred while constructing the URL.\n+     */\n+    ServiceURL build() throws URLBuilderException, ServiceURLException;", "originalCommit": "efe76f1eb6657639329bc6935226b75850782499", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "56ef4103200bab32e0baa43d04dec0d814a9e232", "url": "https://github.com/wso2/carbon-identity-framework/commit/56ef4103200bab32e0baa43d04dec0d814a9e232", "message": "resolve issues", "committedDate": "2020-04-09T03:54:40Z", "type": "forcePushed"}, {"oid": "c85e9609886b72e4e23750c09e04092ef73e9e60", "url": "https://github.com/wso2/carbon-identity-framework/commit/c85e9609886b72e4e23750c09e04092ef73e9e60", "message": "Change Service URL to an interface and move its impl to the DefaultServiceURLBuilder", "committedDate": "2020-04-09T03:55:33Z", "type": "forcePushed"}, {"oid": "b07d5754583ae939adb48253e370022284f3247e", "url": "https://github.com/wso2/carbon-identity-framework/commit/b07d5754583ae939adb48253e370022284f3247e", "message": "Change Service URL to an interface and move its impl to the DefaultServiceURLBuilder", "committedDate": "2020-04-09T04:00:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTk1NDE3MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2851#discussion_r405954170", "bodyText": "Why we need to wrap this and throw ?\nStill this relates to the same thing right. Let's throw directly one type", "author": "malithie", "createdAt": "2020-04-09T04:48:50Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/internal/DefaultServiceURLBuilder.java", "diffHunk": "@@ -0,0 +1,447 @@\n+/*\n+ * Copyright (c) 2020, WSO2 Inc. (http://www.wso2.org) All Rights Reserved.\n+ *\n+ * WSO2 Inc. licenses this file to you under the Apache License,\n+ * Version 2.0 (the \"License\"); you may not use this file except\n+ * in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.wso2.carbon.identity.core.internal;\n+\n+import org.apache.axis2.engine.AxisConfiguration;\n+import org.apache.commons.collections.MapUtils;\n+import org.apache.commons.lang.ArrayUtils;\n+import org.apache.commons.lang.StringUtils;\n+import org.wso2.carbon.base.ServerConfiguration;\n+import org.wso2.carbon.context.PrivilegedCarbonContext;\n+import org.wso2.carbon.identity.core.ServiceURL;\n+import org.wso2.carbon.identity.core.ServiceURLBuilder;\n+import org.wso2.carbon.identity.core.ServiceURLException;\n+import org.wso2.carbon.identity.core.URLBuilderException;\n+import org.wso2.carbon.identity.core.util.IdentityCoreConstants;\n+import org.wso2.carbon.identity.core.util.IdentityTenantUtil;\n+import org.wso2.carbon.utils.CarbonUtils;\n+import org.wso2.carbon.utils.NetworkUtils;\n+\n+import java.io.UnsupportedEncodingException;\n+import java.net.SocketException;\n+import java.net.URLEncoder;\n+import java.nio.charset.StandardCharsets;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.StringJoiner;\n+\n+/**\n+ * Implementation for {@link ServiceURLBuilder}.\n+ * Builder for Service URL instances.\n+ */\n+public class DefaultServiceURLBuilder implements ServiceURLBuilder {\n+\n+    private String fragment;\n+    private String tenantDomain;\n+    private String[] urlPaths;\n+    private Map<String, String> parameters = new HashMap<>();\n+    private Map<String, String> fragmentParams = new HashMap<>();\n+\n+    private class ServiceURLImpl implements ServiceURL {\n+\n+        private String protocol;\n+        private String hostName;\n+        private int port;\n+        private String urlPath;\n+        private Map<String, String> parameters;\n+        private String fragment;\n+        private String absoluteUrl;\n+        private String relativeUrl;\n+\n+        private ServiceURLImpl(String protocol, String hostName, int port, String urlPath,\n+                               Map<String, String> parameters, String fragment) throws ServiceURLException {\n+\n+            this.protocol = protocol;\n+            this.hostName = hostName;\n+            this.port = port;\n+            this.urlPath = urlPath;\n+            this.parameters = parameters;\n+            this.fragment = fragment;\n+            this.absoluteUrl = fetchAbsoluteUrl();\n+            this.relativeUrl = fetchRelativeUrl();\n+\n+        }\n+\n+        /**\n+         * Returns the protocol of Service URL.\n+         *\n+         * @return String of the protocol.\n+         */\n+        @Override\n+        public String getProtocol() {\n+\n+            return protocol;\n+        }\n+\n+        /**\n+         * Returns the host name of Service URL.\n+         *\n+         * @return String of the host name.\n+         */\n+        @Override\n+        public String getHostName() {\n+\n+            return hostName;\n+        }\n+\n+        /**\n+         * Returns the port of Service URL.\n+         *\n+         * @return value of the port.\n+         */\n+        @Override\n+        public int getPort() {\n+\n+            return port;\n+        }\n+\n+        /**\n+         * Returns the Url path of Service URL.\n+         *\n+         * @return String of the url path.\n+         */\n+        @Override\n+        public String getPath() {\n+\n+            return urlPath;\n+        }\n+\n+        /**\n+         * Returns the parameter value when the key is provided.\n+         *\n+         * @param key Key of the parameter.\n+         * @return The value of the parameter.\n+         */\n+        @Override\n+        public String getParameter(String key) {\n+\n+            return parameters.get(key);\n+        }\n+\n+        /**\n+         * Returns a map of the parameters.\n+         *\n+         * @return The parameters.\n+         */\n+        @Override\n+        public Map<String, String> getParameters() {\n+\n+            return Collections.unmodifiableMap(parameters);\n+        }\n+\n+        /**\n+         * Returns decoded fragment from the url.\n+         *\n+         * @return The decoded fragment.\n+         */\n+        @Override\n+        public String getFragment() {\n+\n+            return fragment;\n+        }\n+\n+        /**\n+         * Returns the tenant domain of the service URL.\n+         *\n+         * @return The tenant domain.\n+         */\n+        @Override\n+        public String getTenantDomain() {\n+\n+            return tenantDomain;\n+        }\n+\n+        /**\n+         * Concatenate the protocol, host name, port, proxy context path, web context root, url context, query params\n+         * and the fragment to return the absolute URL.\n+         *\n+         * @return The absolute URL from the Service URL instance.\n+         */\n+        @Override\n+        public String getAbsoluteURL() {\n+\n+            return absoluteUrl;\n+        }\n+\n+        /**\n+         * Concatenate the url context, query params and the fragment to return the relative URL.\n+         *\n+         * @return The relative URL from the Service URL instance.\n+         */\n+        @Override\n+        public String getRelativeURL() {\n+\n+            return relativeUrl;\n+        }\n+\n+        private String fetchAbsoluteUrl() throws ServiceURLException {\n+\n+            StringBuilder absoluteUrl = new StringBuilder();\n+            absoluteUrl.append(protocol).append(\"://\");\n+\n+            absoluteUrl.append(hostName.toLowerCase());\n+\n+            // If it's well known HTTPS port, skip adding port.\n+            if (port != IdentityCoreConstants.DEFAULT_HTTPS_PORT) {\n+                absoluteUrl.append(\":\").append(port);\n+            }\n+\n+            if (StringUtils.isNotBlank(urlPath)) {\n+                if (urlPath.trim().charAt(0) != '/' && urlPath.trim().charAt(0) != '?') {\n+                    absoluteUrl.append(\"/\").append(urlPath.trim());\n+                } else {\n+                    absoluteUrl.append(urlPath.trim());\n+                }\n+            }\n+            String resolvedParamsString = getResolvedParamString(parameters);\n+            try {\n+                appendParamsToUri(absoluteUrl, resolvedParamsString, \"?\");\n+                appendParamsToUri(absoluteUrl, fragment, \"#\");\n+\n+            } catch (URLBuilderException e) {", "originalCommit": "b07d5754583ae939adb48253e370022284f3247e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d43270f1da4685270257cd8306304ad1fb90166c", "url": "https://github.com/wso2/carbon-identity-framework/commit/d43270f1da4685270257cd8306304ad1fb90166c", "message": "Change Service URL to an interface and move its impl to the DefaultServiceURLBuilder", "committedDate": "2020-04-09T05:25:30Z", "type": "forcePushed"}, {"oid": "cb5ebda2ff0b2d993d5e98f831b0e7052c90fccc", "url": "https://github.com/wso2/carbon-identity-framework/commit/cb5ebda2ff0b2d993d5e98f831b0e7052c90fccc", "message": "Change Service URL to an interface and move its impl to the DefaultServiceURLBuilder", "committedDate": "2020-04-09T06:00:59Z", "type": "commit"}, {"oid": "cb5ebda2ff0b2d993d5e98f831b0e7052c90fccc", "url": "https://github.com/wso2/carbon-identity-framework/commit/cb5ebda2ff0b2d993d5e98f831b0e7052c90fccc", "message": "Change Service URL to an interface and move its impl to the DefaultServiceURLBuilder", "committedDate": "2020-04-09T06:00:59Z", "type": "forcePushed"}]}