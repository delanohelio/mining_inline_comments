{"pr_number": 2832, "pr_title": "Add support for adding the tenant domain as a path param in legacy mode.", "pr_createdAt": "2020-03-19T14:55:52Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2832", "timeline": [{"oid": "d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "url": "https://github.com/wso2/carbon-identity-framework/commit/d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "message": "Add support for adding the tenant domain as a path param in legacy mode.", "committedDate": "2020-03-19T15:00:37Z", "type": "commit"}, {"oid": "d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "url": "https://github.com/wso2/carbon-identity-framework/commit/d9828b205a1c4b7cfa884eb4791d4486b8f601c8", "message": "Add support for adding the tenant domain as a path param in legacy mode.", "committedDate": "2020-03-19T15:00:37Z", "type": "forcePushed"}, {"oid": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb", "url": "https://github.com/wso2/carbon-identity-framework/commit/6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb", "message": "Add tests for resolveURL method", "committedDate": "2020-03-22T07:22:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwMDUyNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#discussion_r396200527", "bodyText": "Better if the conditions are switched so it's more meaningful.", "author": "malithie", "createdAt": "2020-03-23T03:47:16Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -140,7 +141,23 @@ private void appendTenantAsPathParam(StringBuilder serverUrl) {\n         if (StringUtils.isBlank(tenantDomain)) {\n             tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n         }\n-        if (tenantDomain != null) {\n+        if (StringUtils.isNotBlank(tenantDomain)) {\n+            if (serverUrl.toString().endsWith(\"/\")) {\n+                serverUrl.append(\"t/\").append(tenantDomain);\n+            } else {\n+                serverUrl.append(\"/t/\").append(tenantDomain);\n+            }\n+        }\n+    }\n+\n+    private void appendTenantPathParamInLegacyMode(StringBuilder serverUrl) {\n+\n+        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+        }\n+        if (!MultitenantConstants.SUPER_TENANT_DOMAIN_NAME.equalsIgnoreCase(tenantDomain) &&\n+                StringUtils.isNotBlank(tenantDomain)) {", "originalCommit": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjIwMDk4Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2832#discussion_r396200983", "bodyText": "Maybe we can rename this to indicate legacy mode operation as well so that it is consistent", "author": "malithie", "createdAt": "2020-03-23T03:49:54Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -152,7 +169,7 @@ private void appendTenantAsPathParam(StringBuilder serverUrl) {\n     private void appendTenantAsQueryParam(StringBuilder serverUrl) {", "originalCommit": "6d0dea2b88bdd1fe5b98567b5a45ef1224129dcb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f61ab749bb2fda1b6149ea747699118897d0d5ad", "url": "https://github.com/wso2/carbon-identity-framework/commit/f61ab749bb2fda1b6149ea747699118897d0d5ad", "message": "Resolve minor issues", "committedDate": "2020-03-23T04:13:41Z", "type": "commit"}]}