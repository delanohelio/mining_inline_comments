{"pr_number": 2862, "pr_title": "Fix saml endpoints for tenant-qualified mode", "pr_createdAt": "2020-04-09T14:37:33Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2862", "timeline": [{"oid": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "url": "https://github.com/wso2/carbon-identity-framework/commit/5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "message": "fix saml endpoints for tenant-qualified mode\nrevert samlAuthnRequestsSigningEnabled url\nadd default endpoint constants", "committedDate": "2020-04-09T14:31:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2NDI5NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406564295", "bodyText": "Should this be throwing a runtime exception ? Can use IdentityProviderManagementException right", "author": "malithie", "createdAt": "2020-04-10T01:47:18Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -140,10 +143,26 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n         String samlAuthnRequestsSigningEnabled;\n \n         openIdUrl = IdentityUtil.getProperty(IdentityConstants.ServerConfig.OPENID_SERVER_URL);\n-        samlECPUrl = IdentityUtil.resolveURL(IdentityUtil.getProperty(IdentityConstants.ServerConfig.SAML_ECP_URL),\n-                true, true);\n-        samlArtifactUrl = IdentityUtil.resolveURL(IdentityUtil.getProperty(IdentityConstants.ServerConfig\n-                .SSO_ARTIFACT_URL), true, true);\n+\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            try {\n+                samlECPUrl = ServiceURLBuilder.create().addPath(IdPManagementConstants.SAML_ECP_URL).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {\n+                throw IdentityRuntimeException\n+                        .error(\"Error while building URL: \" + IdPManagementConstants.SAML_ECP_URL, e);", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2NDc4Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406564783", "bodyText": "I don't this we would need to handle this exception one by one.", "author": "malithie", "createdAt": "2020-04-10T01:49:25Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -140,10 +143,26 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n         String samlAuthnRequestsSigningEnabled;\n \n         openIdUrl = IdentityUtil.getProperty(IdentityConstants.ServerConfig.OPENID_SERVER_URL);\n-        samlECPUrl = IdentityUtil.resolveURL(IdentityUtil.getProperty(IdentityConstants.ServerConfig.SAML_ECP_URL),\n-                true, true);\n-        samlArtifactUrl = IdentityUtil.resolveURL(IdentityUtil.getProperty(IdentityConstants.ServerConfig\n-                .SSO_ARTIFACT_URL), true, true);\n+\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            try {\n+                samlECPUrl = ServiceURLBuilder.create().addPath(IdPManagementConstants.SAML_ECP_URL).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {\n+                throw IdentityRuntimeException\n+                        .error(\"Error while building URL: \" + IdPManagementConstants.SAML_ECP_URL, e);\n+            }\n+            try {\n+                samlArtifactUrl = ServiceURLBuilder.create().addPath(IdPManagementConstants.SSO_ARTIFACT_URL).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2NTIzNw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406565237", "bodyText": "were these not read from the file before", "author": "malithie", "createdAt": "2020-04-10T01:51:36Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -169,9 +188,24 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n             openIdUrl = IdentityUtil.getServerURL(IdentityConstants.OpenId.OPENID, true, true);\n         }\n \n-        samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true, true, false);\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+\n+            try {\n+                samlSSOUrl = ServiceURLBuilder.create().addPath(IdentityConstants.ServerConfig.SAMLSSO).build()\n+                        .getAbsoluteURL();\n+                samlLogoutUrl = ServiceURLBuilder.create().addPath(IdentityConstants.ServerConfig.SAMLSSO).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {\n+                throw IdentityRuntimeException\n+                        .error(\"Error while building URL: \" + IdentityConstants.ServerConfig.SAMLSSO, e);\n+            }\n+        } else {\n+            samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true)\n+                    + IdPManagementUtil.getTenantParameter();\n \n-        samlLogoutUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true, true, false);\n+            samlLogoutUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true)\n+                    + IdPManagementUtil.getTenantParameter();", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYwMTk0NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406601945", "bodyText": "I reverted the previous changes [1]. There, samlLogoutUrl and samlSSOUrl had been using the IdentityConstants.\n[1] - https://github.com/wso2/carbon-identity-framework/pull/2828/files#diff-98664c0777759c45d183f9180c27614e", "author": "chamathns", "createdAt": "2020-04-10T04:55:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2NTIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2NjM5MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406566391", "bodyText": "A wrong config ? Is there a use of this really", "author": "malithie", "createdAt": "2020-04-10T01:56:04Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -181,8 +215,9 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n             samlECPUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true);\n         }\n \n-        samlAuthnRequestsSigningEnabled = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.\n-                SAML_METADATA_AUTHN_REQUESTS_SIGNING_ENABLED, true, true, true, false);\n+        samlAuthnRequestsSigningEnabled = IdentityUtil\n+                .getServerURL(IdentityConstants.ServerConfig.SAML_METADATA_AUTHN_REQUESTS_SIGNING_ENABLED, true, true) +\n+                IdPManagementUtil.getTenantParameter();", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU4NTQyNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406585426", "bodyText": "I changed this to its original implementation since I had changed it to use the modified getServerURL method. Shall we remove this since it is not used?\nThe property is used here [1]. But it is not set to the FederatedAuthnConfig from the IdentityProviderManager impl.\n[1] - https://github.com/wso2-extensions/identity-metadata-saml2/blob/41cc848d17f32d5fc377557de91f6efe7473ecb2/components/org.wso2.carbon.identity.idp.metadata.saml2/src/main/java/org/wso2/carbon/identity/idp/metadata/saml2/builder/IDPMetadataBuilder.java#L57", "author": "chamathns", "createdAt": "2020-04-10T03:23:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2NjM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODM4Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406568387", "bodyText": "Same is done above right ?", "author": "malithie", "createdAt": "2020-04-10T02:04:16Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2531,15 +2566,34 @@ private void overrideResidentIdpEPUrls(IdentityProvider residentIDP)\n             throws IdentityProviderManagementException {\n \n         // Not all endpoints are persisted. So we need to update only a few properties.\n-\n-        String samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true,\n-                true, true, false);\n+        String samlSSOUrl;\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            try {\n+                samlSSOUrl = ServiceURLBuilder.create().addPath(IdentityConstants.ServerConfig.SAMLSSO).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {\n+                throw IdentityRuntimeException\n+                        .error(\"Error while building URL: \" + IdentityConstants.ServerConfig.SAMLSSO, e);\n+            }\n+        } else {\n+            samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true);\n+        }", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYwNzE4OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406607188", "bodyText": "this is a done for a different method.", "author": "chamathns", "createdAt": "2020-04-10T05:22:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNTA0Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406615046", "bodyText": "ok\nSo all these paths just send the path and construct from old way looks to me we can have a method that will just take the context and URL for the legacy mode and return\nSo handling the exception does not needs to be duplicated, checking tenant qualified does not needs to be duplicated and readability can be improved", "author": "malithie", "createdAt": "2020-04-10T05:58:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYyMjg5MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406622891", "bodyText": "Introduced a method to handle this.", "author": "chamathns", "createdAt": "2020-04-10T06:30:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5MzMxMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406693312", "bodyText": "This logic should not ideally be here. Rather if this is something that should not be persisted it should be fixed at that place rather than overriding again after reading properties from DB.\nYet, in the context of present scope fixing this path is fine.", "author": "malithie", "createdAt": "2020-04-10T10:03:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODQ0OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406568449", "bodyText": "Isn't same done above", "author": "malithie", "createdAt": "2020-04-10T02:04:36Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2531,15 +2566,34 @@ private void overrideResidentIdpEPUrls(IdentityProvider residentIDP)\n             throws IdentityProviderManagementException {\n \n         // Not all endpoints are persisted. So we need to update only a few properties.\n-\n-        String samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true,\n-                true, true, false);\n+        String samlSSOUrl;\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            try {\n+                samlSSOUrl = ServiceURLBuilder.create().addPath(IdentityConstants.ServerConfig.SAMLSSO).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {\n+                throw IdentityRuntimeException\n+                        .error(\"Error while building URL: \" + IdentityConstants.ServerConfig.SAMLSSO, e);\n+            }\n+        } else {\n+            samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true);\n+        }\n         updateFederationAuthenticationConfigProperty(residentIDP,\n                 IdentityApplicationConstants.Authenticator\n                         .SAML2SSO.NAME, IdentityApplicationConstants.Authenticator.SAML2SSO.SSO_URL, samlSSOUrl);\n \n-        String samlLogoutUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true,\n-                true, true, false);\n+        String samlLogoutUrl;\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            try {\n+                samlLogoutUrl = ServiceURLBuilder.create().addPath(IdentityConstants.ServerConfig.SAMLSSO).build()\n+                        .getAbsoluteURL();\n+            } catch (URLBuilderException e) {\n+                throw IdentityRuntimeException\n+                        .error(\"Error while building URL: \" + IdentityConstants.ServerConfig.SAMLSSO, e);\n+            }\n+        } else {\n+            samlLogoutUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true);\n+        }", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODcxOA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406568718", "bodyText": "When giving a path should we really give '/', doesn't the builder handles it.\nEven if we give it should handle IMO", "author": "malithie", "createdAt": "2020-04-10T02:05:50Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/util/IdPManagementConstants.java", "diffHunk": "@@ -74,6 +74,11 @@\n     public static final String PROVISIONING =\n             \"INBOUND_PROV_ENABLED, INBOUND_PROV_USER_STORE_ID, DEFAULT_PRO_CONNECTOR_NAME\";\n \n+    //Default SAML endpoints.\n+    public static final String SSO_ARTIFACT_URL = \"/samlartresolve\";\n+    public static final String SAML_ECP_URL = \"/samlecp\";\n+    public static final String SAMLSSO = \"/samlsso\";", "originalCommit": "5e882f9f98b4f9326fd93ad1b72e6689afe16c72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU3NjczNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406576734", "bodyText": "No we don't need to give \"/\". Builder can handle it.", "author": "chamathns", "createdAt": "2020-04-10T02:41:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU2ODcxOA=="}], "type": "inlineReview"}, {"oid": "5cd821cae58dd480769d3b8e94cf1913fa6b6ed2", "url": "https://github.com/wso2/carbon-identity-framework/commit/5cd821cae58dd480769d3b8e94cf1913fa6b6ed2", "message": "resolve issues", "committedDate": "2020-04-10T05:23:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNDAwMw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406614003", "bodyText": "haven't we read sso url from file", "author": "malithie", "createdAt": "2020-04-10T05:53:50Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -169,9 +186,21 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n             openIdUrl = IdentityUtil.getServerURL(IdentityConstants.OpenId.OPENID, true, true);\n         }\n \n-        samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true, true, false);\n+        if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+            try {\n+                samlSSOUrl = ServiceURLBuilder.create().addPath(IdPManagementConstants.SAMLSSO).build()\n+                        .getAbsoluteURL();\n+                samlLogoutUrl = samlSSOUrl;\n+            } catch (URLBuilderException e) {\n+                throw IdentityProviderManagementException.error(IdentityProviderManagementServerException.class,\n+                        \"Error while building URL: \" + IdPManagementConstants.SAMLSSO, e);\n+            }\n+        } else {\n+            samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true)", "originalCommit": "5cd821cae58dd480769d3b8e94cf1913fa6b6ed2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNjQ0MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406616441", "bodyText": "no", "author": "chamathns", "createdAt": "2020-04-10T06:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjYxNDAwMw=="}], "type": "inlineReview"}, {"oid": "ec77da36cd77ed3b01a39ac5177cd37fac6dab30", "url": "https://github.com/wso2/carbon-identity-framework/commit/ec77da36cd77ed3b01a39ac5177cd37fac6dab30", "message": "introduce method to resolve absolute Url", "committedDate": "2020-04-10T06:30:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MDU0Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406640546", "bodyText": "why we send a tenant parameter here. What's the URL that gets constructed", "author": "malithie", "createdAt": "2020-04-10T07:31:22Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -169,9 +170,11 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n             openIdUrl = IdentityUtil.getServerURL(IdentityConstants.OpenId.OPENID, true, true);\n         }\n \n-        samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true, true, false);\n+        samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true)\n+                + IdPManagementUtil.getTenantParameter();", "originalCommit": "ec77da36cd77ed3b01a39ac5177cd37fac6dab30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MDg1OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406640859", "bodyText": "This was the earlier implementation. Before we used the modified getServerURL method", "author": "chamathns", "createdAt": "2020-04-10T07:32:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MDU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MTE0MA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406641140", "bodyText": "This constructs https://localhost:9443/samlsso?tenantDomain=wso2.com", "author": "chamathns", "createdAt": "2020-04-10T07:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MDU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0NzAxOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406647019", "bodyText": "with the new method, we take the constructed url mentioned above, checks if tenantQualifiedURLs is enabled, and if yes, resets it to https://localhost:9443/t/wso2.com/samlsso", "author": "chamathns", "createdAt": "2020-04-10T07:50:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MDU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY1MTcxMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406651712", "bodyText": "I see, so this has been something existed. +1", "author": "malithie", "createdAt": "2020-04-10T08:04:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY0MDU0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY1MTY0Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406651647", "bodyText": "So which invokes this method and why that tenant param does not need to be applied here", "author": "malithie", "createdAt": "2020-04-10T08:04:03Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -2531,15 +2531,14 @@ private void overrideResidentIdpEPUrls(IdentityProvider residentIDP)\n             throws IdentityProviderManagementException {\n \n         // Not all endpoints are persisted. So we need to update only a few properties.\n+        String samlSSOUrl = IdentityUtil.getServerURL(IdentityConstants.ServerConfig.SAMLSSO, true, true);\n+        samlSSOUrl = resolveAbsoluteURL(IdPManagementConstants.SAMLSSO, samlSSOUrl);", "originalCommit": "ec77da36cd77ed3b01a39ac5177cd37fac6dab30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3NDYyOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406674629", "bodyText": "getResidentIdP invokes this overrideResidentIdpEPUrls(IdentityProvider residentIDP).\nSo, eventually, FederationAuthenticationConfig properties for samlsso are overwritten through this.\nIf the query parameter is needed to be appended to the residentIdP configs for samlsso, we need to append that here.", "author": "chamathns", "createdAt": "2020-04-10T09:09:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY1MTY0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY1NTEzNg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406655136", "bodyText": "Should we add the tenant domain as a query param when the url is read from file?\n@malithie @mefarazath @inthirakumaaran", "author": "chamathns", "createdAt": "2020-04-10T08:14:07Z", "path": "components/idp-mgt/org.wso2.carbon.idp.mgt/src/main/java/org/wso2/carbon/idp/mgt/IdentityProviderManager.java", "diffHunk": "@@ -137,13 +139,16 @@ public IdentityProvider getResidentIdP(String tenantDomain)\n         String scimGroupsEndpoint;\n         String scim2UsersEndpoint;\n         String scim2GroupsEndpoint;\n-        String samlAuthnRequestsSigningEnabled;\n \n         openIdUrl = IdentityUtil.getProperty(IdentityConstants.ServerConfig.OPENID_SERVER_URL);\n-        samlECPUrl = IdentityUtil.resolveURL(IdentityUtil.getProperty(IdentityConstants.ServerConfig.SAML_ECP_URL),\n-                true, true);\n-        samlArtifactUrl = IdentityUtil.resolveURL(IdentityUtil.getProperty(IdentityConstants.ServerConfig\n-                .SSO_ARTIFACT_URL), true, true);\n+        samlSSOUrl = IdentityUtil.getProperty(IdentityConstants.ServerConfig.SSO_IDP_URL) +\n+                IdPManagementUtil.getTenantParameter();", "originalCommit": "a994510b8bab448fcaa61d89dac59465527df77f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY1NzczMg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2862#discussion_r406657732", "bodyText": "we should first read from the file. Then if it's empty we construct then only tenant query param should be appended", "author": "malithie", "createdAt": "2020-04-10T08:22:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY1NTEzNg=="}], "type": "inlineReview"}, {"oid": "77644953fb3f635d669e8e0edd372c7679751613", "url": "https://github.com/wso2/carbon-identity-framework/commit/77644953fb3f635d669e8e0edd372c7679751613", "message": "change samlSSOUrl to read the url from file in legacy mode", "committedDate": "2020-04-10T08:59:23Z", "type": "forcePushed"}, {"oid": "d345710127abc9ad0de12c3ed4a84bc437a628c4", "url": "https://github.com/wso2/carbon-identity-framework/commit/d345710127abc9ad0de12c3ed4a84bc437a628c4", "message": "change samlSSOUrl to read the url from file in legacy mode", "committedDate": "2020-04-10T09:41:57Z", "type": "commit"}, {"oid": "d345710127abc9ad0de12c3ed4a84bc437a628c4", "url": "https://github.com/wso2/carbon-identity-framework/commit/d345710127abc9ad0de12c3ed4a84bc437a628c4", "message": "change samlSSOUrl to read the url from file in legacy mode", "committedDate": "2020-04-10T09:41:57Z", "type": "forcePushed"}]}