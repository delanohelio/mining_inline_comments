{"pr_number": 2901, "pr_title": "Refactor isValidCallbackURL API", "pr_createdAt": "2020-04-28T05:49:59Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2901", "timeline": [{"oid": "0123ffb0291ebf573bb686f2bcd9815e0f963eb9", "url": "https://github.com/wso2/carbon-identity-framework/commit/0123ffb0291ebf573bb686f2bcd9815e0f963eb9", "message": "Refactor isValidCallbackURL API", "committedDate": "2020-04-28T11:08:00Z", "type": "commit"}, {"oid": "020eb987c17bd8bbd9cbdf772fa6aeca44819550", "url": "https://github.com/wso2/carbon-identity-framework/commit/020eb987c17bd8bbd9cbdf772fa6aeca44819550", "message": "Refactor url building logic", "committedDate": "2020-04-28T11:10:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU0MjMzOA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2901#discussion_r416542338", "bodyText": "Let's remove this additional line", "author": "malithie", "createdAt": "2020-04-28T11:36:39Z", "path": "components/identity-mgt/org.wso2.carbon.identity.mgt.endpoint.util/src/main/java/org/wso2/carbon/identity/mgt/endpoint/util/IdentityManagementEndpointUtil.java", "diffHunk": "@@ -660,30 +660,33 @@ public static String getBasePath(String tenantDomain, String context) throws Api\n     /**\n      * Get base path URL for API clients.\n      *\n-     * @param tenantDomain          tenant Domain.\n+     * @param tenantDomain          Tenant Domain.\n      * @param context               URL context.\n-     * @param isEndpointTenantAware whether the endpoint is tenant aware.\n-     * @return base path.\n+     * @param isEndpointTenantAware Whether the endpoint is tenant aware.\n+     * @return Base path.\n      * @throws ApiException ApiException.\n      */\n     public static String getBasePath(String tenantDomain, String context, boolean isEndpointTenantAware)\n             throws ApiException {\n \n         String basePath;\n+        String serverUrl = IdentityManagementServiceUtil.getInstance().getContextURLFromFile();\n         try {\n-            if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n-                basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n-            } else {\n-                String serverUrl = IdentityManagementServiceUtil.getInstance().getContextURLFromFile();\n-                if (StringUtils.isBlank(serverUrl)) {\n-                    serverUrl = ServiceURLBuilder.create().build().getAbsoluteInternalURL();\n-                }\n-                if (StringUtils.isNotBlank(tenantDomain) && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME\n-                        .equalsIgnoreCase(tenantDomain) && isEndpointTenantAware) {\n-                    basePath = serverUrl + \"/t/\" + tenantDomain + context;\n+            if (StringUtils.isBlank(serverUrl)) {\n+                if (IdentityTenantUtil.isTenantQualifiedUrlsEnabled()) {\n+                    basePath = ServiceURLBuilder.create().addPath(context).build().getAbsoluteInternalURL();\n                 } else {\n-                    basePath = serverUrl + context;\n+                    serverUrl = ServiceURLBuilder.create().build().getAbsoluteInternalURL();\n+                    if (StringUtils.isNotBlank(tenantDomain) && !MultitenantConstants.SUPER_TENANT_DOMAIN_NAME\n+                            .equalsIgnoreCase(tenantDomain) && isEndpointTenantAware) {\n+                        basePath = serverUrl + \"/t/\" + tenantDomain + context;\n+                    } else {\n+                        basePath = serverUrl + context;\n+                    }\n                 }\n+", "originalCommit": "020eb987c17bd8bbd9cbdf772fa6aeca44819550", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU0ODE0Nw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2901#discussion_r416548147", "bodyText": "Fixed and updated the PR.", "author": "ashensw", "createdAt": "2020-04-28T11:47:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjU0MjMzOA=="}], "type": "inlineReview"}, {"oid": "5a531917fa1d4ac0034e6add902218b8f8a14f98", "url": "https://github.com/wso2/carbon-identity-framework/commit/5a531917fa1d4ac0034e6add902218b8f8a14f98", "message": "Refactor url building logic", "committedDate": "2020-04-28T11:46:46Z", "type": "commit"}, {"oid": "5a531917fa1d4ac0034e6add902218b8f8a14f98", "url": "https://github.com/wso2/carbon-identity-framework/commit/5a531917fa1d4ac0034e6add902218b8f8a14f98", "message": "Refactor url building logic", "committedDate": "2020-04-28T11:46:46Z", "type": "forcePushed"}]}