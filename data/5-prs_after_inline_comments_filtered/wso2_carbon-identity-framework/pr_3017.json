{"pr_number": 3017, "pr_title": "Add additional authentication related parameters to publish", "pr_createdAt": "2020-07-12T18:47:02Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/3017", "timeline": [{"oid": "e4b57d145c8fad9afae49fdf09d2021387123222", "url": "https://github.com/wso2/carbon-identity-framework/commit/e4b57d145c8fad9afae49fdf09d2021387123222", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-14T11:32:43Z", "type": "forcePushed"}, {"oid": "53e990cacd5b29e7e3abbb108e185bed596355cc", "url": "https://github.com/wso2/carbon-identity-framework/commit/53e990cacd5b29e7e3abbb108e185bed596355cc", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-14T11:36:26Z", "type": "forcePushed"}, {"oid": "5ec3d6e17910c9bd5547cd88823efd8c0de01389", "url": "https://github.com/wso2/carbon-identity-framework/commit/5ec3d6e17910c9bd5547cd88823efd8c0de01389", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-14T11:39:11Z", "type": "forcePushed"}, {"oid": "6fc8713e47078db1e466cfaabda3caa05757dfc7", "url": "https://github.com/wso2/carbon-identity-framework/commit/6fc8713e47078db1e466cfaabda3caa05757dfc7", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-15T05:22:22Z", "type": "forcePushed"}, {"oid": "454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "url": "https://github.com/wso2/carbon-identity-framework/commit/454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-15T05:28:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMTQ3Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454811472", "bodyText": "Changing the method signature will effect several places. Did you able to check those places?", "author": "ShanChathusanda93", "createdAt": "2020-07-15T06:03:11Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -153,43 +155,77 @@ protected boolean isStepHasMultiOption(AuthenticationContext context) {\n         return stepHasMultiOption;\n     }\n \n-    protected void publishAuthenticationStepAttempt(HttpServletRequest request, AuthenticationContext context,\n-                                                  User user, boolean success) {\n+    protected void publishAuthenticationStepAttemptSuccess(HttpServletRequest request, AuthenticationContext context,", "originalCommit": "454aad61e1e1eba5e0446d63bd49db7b42abf7c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMzAyNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454813024", "bodyText": "you shouldn't change the method signature of protected/public methods.", "author": "nilasini", "createdAt": "2020-07-15T06:07:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMTQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMzE3NQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454813175", "bodyText": "yes, I checked in all the places and the tests. Also discussed in the code review.", "author": "Sathiyakugan", "createdAt": "2020-07-15T06:08:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMTQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxNjcxOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454816719", "bodyText": "But customers are using this AbstractApplicationAuthenticator to write their own custom authenticators, so changing the method signature is not acceptable. Is it decided to change the protected method signature in the code review?", "author": "nilasini", "createdAt": "2020-07-15T06:18:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMTQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDkzMTQ5Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r454931493", "bodyText": "ACK and Changed", "author": "Sathiyakugan", "createdAt": "2020-07-15T09:51:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDgxMTQ3Mg=="}], "type": "inlineReview"}, {"oid": "ed25e71b0cba74eade83573b46d7750f8b440747", "url": "https://github.com/wso2/carbon-identity-framework/commit/ed25e71b0cba74eade83573b46d7750f8b440747", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-15T07:37:26Z", "type": "forcePushed"}, {"oid": "3f2f7d1e88585a515f22c7c6bdf5ae07cc242814", "url": "https://github.com/wso2/carbon-identity-framework/commit/3f2f7d1e88585a515f22c7c6bdf5ae07cc242814", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-15T09:34:12Z", "type": "forcePushed"}, {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "url": "https://github.com/wso2/carbon-identity-framework/commit/7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-15T09:36:55Z", "type": "commit"}, {"oid": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "url": "https://github.com/wso2/carbon-identity-framework/commit/7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "message": "Add additional authentication related parameters to publish", "committedDate": "2020-07-15T09:36:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NjQ5OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r502466498", "bodyText": "We can use a multiline comment here.", "author": "ivantha", "createdAt": "2020-10-09T14:28:17Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -179,17 +187,32 @@ protected void publishAuthenticationStepAttempt(HttpServletRequest request, Auth\n             if (success) {\n                 authnDataPublisherProxy.publishAuthenticationStepSuccess(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to null since the step event is Success and for the next\n+                // step event start time will be added in DefaultStepHandler handle method.", "originalCommit": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcwMjY5Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r516702693", "bodyText": "Fixed with #3159", "author": "Sathiyakugan", "createdAt": "2020-11-03T14:23:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NjQ5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NjY3OA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r502466678", "bodyText": "Same as https://github.com/wso2/carbon-identity-framework/pull/3017/files#r502466498", "author": "ivantha", "createdAt": "2020-10-09T14:28:32Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -179,17 +187,32 @@ protected void publishAuthenticationStepAttempt(HttpServletRequest request, Auth\n             if (success) {\n                 authnDataPublisherProxy.publishAuthenticationStepSuccess(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to null since the step event is Success and for the next\n+                // step event start time will be added in DefaultStepHandler handle method.\n+                context.setAnalyticsData(FrameworkConstants.AnalyticsData.CURRENT_AUTHENTICATOR_START_TIME, null);\n \n             } else {\n                 authnDataPublisherProxy.publishAuthenticationStepFailure(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to current time since the step event is failure and retrying\n+                // the event duration will be counted as a new step.", "originalCommit": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcwMjc5OQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r516702799", "bodyText": "Fixed with #3159", "author": "Sathiyakugan", "createdAt": "2020-11-03T14:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NjY3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NzEwNA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r502467104", "bodyText": "It is better to add a doc comment for this method even if it is private.", "author": "ivantha", "createdAt": "2020-10-09T14:29:11Z", "path": "components/authentication-framework/org.wso2.carbon.identity.application.authentication.framework/src/main/java/org/wso2/carbon/identity/application/authentication/framework/AbstractApplicationAuthenticator.java", "diffHunk": "@@ -179,17 +187,32 @@ protected void publishAuthenticationStepAttempt(HttpServletRequest request, Auth\n             if (success) {\n                 authnDataPublisherProxy.publishAuthenticationStepSuccess(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to null since the step event is Success and for the next\n+                // step event start time will be added in DefaultStepHandler handle method.\n+                context.setAnalyticsData(FrameworkConstants.AnalyticsData.CURRENT_AUTHENTICATOR_START_TIME, null);\n \n             } else {\n                 authnDataPublisherProxy.publishAuthenticationStepFailure(request, context,\n                         unmodifiableParamMap);\n+                // Resetting the authenticator start time to current time since the step event is failure and retrying\n+                // the event duration will be counted as a new step.\n+                context.setAnalyticsData(\n+                        FrameworkConstants.AnalyticsData.CURRENT_AUTHENTICATOR_START_TIME, System.currentTimeMillis());\n             }\n         }\n     }\n \n+    private void publishAuthenticationStepAttemptFailure(HttpServletRequest request, AuthenticationContext context,", "originalCommit": "7199b6ef5d88df549011bdaa279ecd6be46c8c8c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjcwMjg0Mg==", "url": "https://github.com/wso2/carbon-identity-framework/pull/3017#discussion_r516702842", "bodyText": "Fixed with #3159", "author": "Sathiyakugan", "createdAt": "2020-11-03T14:23:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ2NzEwNA=="}], "type": "inlineReview"}]}