{"pr_number": 2838, "pr_title": "Add support for including tenant domain as a parameter in URLResolverService", "pr_createdAt": "2020-03-25T19:39:16Z", "pr_url": "https://github.com/wso2/carbon-identity-framework/pull/2838", "timeline": [{"oid": "38f2b0265b5753dfdf67726d5e4e128407fe0237", "url": "https://github.com/wso2/carbon-identity-framework/commit/38f2b0265b5753dfdf67726d5e4e128407fe0237", "message": "Overloading url resolver methods to add tenantDomain param.", "committedDate": "2020-03-25T19:33:17Z", "type": "commit"}, {"oid": "87b59ba1ca0f33796dc641e045fb79dda26c68c6", "url": "https://github.com/wso2/carbon-identity-framework/commit/87b59ba1ca0f33796dc641e045fb79dda26c68c6", "message": "Add tests", "committedDate": "2020-03-26T02:59:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398292664", "bodyText": "Shall we have a new API to accept tenant domain.\nWondering if there is s real necessity of it as well.\nIn addition, we should have an API without legacy mode params as well. So new consumers don't need to worry about populating such.", "author": "malithie", "createdAt": "2020-03-26T03:08:37Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -40,7 +40,7 @@\n public class DefaultURLResolverService implements URLResolverService {\n \n     @Override\n-    public String resolveUrl(String url, boolean addProxyContextPath, boolean addWebContextRoot,\n+    public String resolveUrl(String url, String tenantDomain, boolean addProxyContextPath, boolean addWebContextRoot,", "originalCommit": "87b59ba1ca0f33796dc641e045fb79dda26c68c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5NzA0Ng==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398297046", "bodyText": "We have a new API for this at the IdentityUtil.class\nThere's an another API available at IdentityUtil without legacy mode params. Do we need to have these at the DefaultURLResolverService level too?\nThere is a need for this because there are instances where tenantDomain is directly available as a attribute (for an instance, while tenant creation). So then, with this change, we don't need to meddle with the ThreadLocal or the CarbonContext to get the tenant domain.", "author": "chamathns", "createdAt": "2020-03-26T03:25:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk5NzY0MQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398997641", "bodyText": "But the API should be clean.\nSo looks like this is addressed", "author": "malithie", "createdAt": "2020-03-27T02:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI5MjY2NA=="}], "type": "inlineReview"}, {"oid": "8244288ee50935fdd84f2c6403d35e5a0b233c8e", "url": "https://github.com/wso2/carbon-identity-framework/commit/8244288ee50935fdd84f2c6403d35e5a0b233c8e", "message": "add APIs for URLResolverService", "committedDate": "2020-03-26T06:21:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU0OTgxOQ==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398549819", "bodyText": "Shall we move this tenant resolving logic to a single method and reuse ?", "author": "malithie", "createdAt": "2020-03-26T12:56:30Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -135,11 +168,13 @@ private void appendProxyContextPath(StringBuilder serverUrl) {\n         }\n     }\n \n-    private void appendTenantAsPathParam(StringBuilder serverUrl) {\n+    private void appendTenantAsPathParam(StringBuilder serverUrl, String tenantDomain) {\n \n-        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n         if (StringUtils.isBlank(tenantDomain)) {\n-            tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+            if (StringUtils.isBlank(tenantDomain)) {\n+                tenantDomain = PrivilegedCarbonContext.getThreadLocalCarbonContext().getTenantDomain();\n+            }\n         }", "originalCommit": "8244288ee50935fdd84f2c6403d35e5a0b233c8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d67375248c97f9fd4e107e2177bca7b17bd48a8", "url": "https://github.com/wso2/carbon-identity-framework/commit/4d67375248c97f9fd4e107e2177bca7b17bd48a8", "message": "Fix issues", "committedDate": "2020-03-26T15:29:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODk5ODE5Mw==", "url": "https://github.com/wso2/carbon-identity-framework/pull/2838#discussion_r398998193", "bodyText": "Is there a reason to not use the resolving method.\nLooks like some checks/steps missed here", "author": "malithie", "createdAt": "2020-03-27T02:18:07Z", "path": "components/identity-core/org.wso2.carbon.identity.core/src/main/java/org/wso2/carbon/identity/core/DefaultURLResolverService.java", "diffHunk": "@@ -166,16 +193,29 @@ private void appendTenantPathParamInLegacyMode(StringBuilder serverUrl) {\n         }\n     }\n \n-    private void appendTenantQueryParamInLegacyMode(StringBuilder serverUrl) {\n+    private void appendTenantQueryParamInLegacyMode(StringBuilder serverUrl, String tenantDomain) {\n \n-        String tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        if (StringUtils.isBlank(tenantDomain)) {\n+            tenantDomain = IdentityTenantUtil.getTenantDomainFromContext();\n+        }", "originalCommit": "4d67375248c97f9fd4e107e2177bca7b17bd48a8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "37235681dc38b4c6c0078ecb3a6c22bc67809ae6", "url": "https://github.com/wso2/carbon-identity-framework/commit/37235681dc38b4c6c0078ecb3a6c22bc67809ae6", "message": "Resolve minor issues", "committedDate": "2020-03-27T03:44:15Z", "type": "commit"}]}