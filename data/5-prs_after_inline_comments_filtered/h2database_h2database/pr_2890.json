{"pr_number": 2890, "pr_title": "Fixed possible eternal wait(0)", "pr_createdAt": "2020-09-16T17:12:17Z", "pr_url": "https://github.com/h2database/h2database/pull/2890", "timeline": [{"oid": "a830b9a1faed59acabdb4a61086c3319393889b7", "url": "https://github.com/h2database/h2database/commit/a830b9a1faed59acabdb4a61086c3319393889b7", "message": "Fixed possible eternal wait(0)", "committedDate": "2020-09-16T16:59:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTg3NDUyNg==", "url": "https://github.com/h2database/h2database/pull/2890#discussion_r489874526", "bodyText": "Thank you for your contribution!\nJust replace 0 with 1 here, 50 can be unreasonably large for systems that support small wait values properly.", "author": "katzyn", "createdAt": "2020-09-17T01:58:39Z", "path": "h2/src/main/org/h2/engine/Database.java", "diffHunk": "@@ -1270,9 +1270,11 @@ private synchronized void closeAllSessionsExcept(SessionLocal except) {\n \n         int timeout = 2 * getLockTimeout();\n         long start = System.currentTimeMillis();\n+        // 'sleep' should be strictly greater than zero, otherwise real time is not taken into consideration\n+        // and the thread simply waits until notified\n+        long sleep = Math.max(timeout / 20, 50);", "originalCommit": "a830b9a1faed59acabdb4a61086c3319393889b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDAxMDAwOA==", "url": "https://github.com/h2database/h2database/pull/2890#discussion_r490010008", "bodyText": "OK.", "author": "Silvmike", "createdAt": "2020-09-17T06:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTg3NDUyNg=="}], "type": "inlineReview"}, {"oid": "453b122d98acf9a5ecabe6cc4473b74642da4ed8", "url": "https://github.com/h2database/h2database/commit/453b122d98acf9a5ecabe6cc4473b74642da4ed8", "message": "Decreased minimum wait to 1ms on shutdown", "committedDate": "2020-09-17T06:49:17Z", "type": "commit"}]}