{"pr_number": 2386, "pr_title": "Chunk occupancy mask", "pr_createdAt": "2020-01-09T03:47:41Z", "pr_url": "https://github.com/h2database/h2database/pull/2386", "timeline": [{"oid": "f10fc940a9382b0f9e7bd68ca3eb16e564c887be", "url": "https://github.com/h2database/h2database/commit/f10fc940a9382b0f9e7bd68ca3eb16e564c887be", "message": "Introduce chunk's table of content, switch to explicit page liveliness tracking", "committedDate": "2020-01-08T00:36:19Z", "type": "commit"}, {"oid": "4e8897d7f37f2e2be43b901a43a0590bc62311d1", "url": "https://github.com/h2database/h2database/commit/4e8897d7f37f2e2be43b901a43a0590bc62311d1", "message": "improve chunk rewriting", "committedDate": "2020-01-08T00:36:19Z", "type": "commit"}, {"oid": "5885ef2e740ca28b2318cd6ccb1d61925f7d9d3c", "url": "https://github.com/h2database/h2database/commit/5885ef2e740ca28b2318cd6ccb1d61925f7d9d3c", "message": "backward compatibility", "committedDate": "2020-01-08T00:36:19Z", "type": "commit"}, {"oid": "b8fff5c6c7cdd8f273d139602f5ef432d4937a66", "url": "https://github.com/h2database/h2database/commit/b8fff5c6c7cdd8f273d139602f5ef432d4937a66", "message": "minor fixes, mute assertion", "committedDate": "2020-01-08T00:36:19Z", "type": "commit"}, {"oid": "1439b575b5f93e9e1db69277bccbd7e3b8ca05b1", "url": "https://github.com/h2database/h2database/commit/1439b575b5f93e9e1db69277bccbd7e3b8ca05b1", "message": "prevent infinite loop", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "b61a58abb32c498caadd83d5eb77ce3a7910cb58", "url": "https://github.com/h2database/h2database/commit/b61a58abb32c498caadd83d5eb77ce3a7910cb58", "message": "expose ToC cache hit rate in meta table", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "6591874b53fdf395feba38c9d7c94de080a9b9e0", "url": "https://github.com/h2database/h2database/commit/6591874b53fdf395feba38c9d7c94de080a9b9e0", "message": "Remove faulty assertion. Purge dead chunk/pages from cache", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "b9e0c9f64074186077461ce40ba2a9b9f93f9149", "url": "https://github.com/h2database/h2database/commit/b9e0c9f64074186077461ce40ba2a9b9f93f9149", "message": "Expand DecisionMaker's context. Eliminate unneccessary page rewrites.", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "274db3b430259df47dea7688e4ab0fd997a0e1b2", "url": "https://github.com/h2database/h2database/commit/274db3b430259df47dea7688e4ab0fd997a0e1b2", "message": "fix NPE when cache is disabled", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "97ff43bff3f49efdf8ddc1e2b0f7ac1fd046965b", "url": "https://github.com/h2database/h2database/commit/97ff43bff3f49efdf8ddc1e2b0f7ac1fd046965b", "message": "RewriteDecisionMaker", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "d7c28864e604047c9df77a28b95e9405d9233e8c", "url": "https://github.com/h2database/h2database/commit/d7c28864e604047c9df77a28b95e9405d9233e8c", "message": "empty chunks handling in readStoreHeader", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "68fc8ccc7f647d0f3a0ae529adcccbe93aff80f3", "url": "https://github.com/h2database/h2database/commit/68fc8ccc7f647d0f3a0ae529adcccbe93aff80f3", "message": "rewritable chunks fill rate", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "d85ecddd40b4d45562246523d998da25853aceae", "url": "https://github.com/h2database/h2database/commit/d85ecddd40b4d45562246523d998da25853aceae", "message": "page rewriting for meta did not worked", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "aad5555f7aea985926eaee2ee1d51331a4de23df", "url": "https://github.com/h2database/h2database/commit/aad5555f7aea985926eaee2ee1d51331a4de23df", "message": "move pageNo from ToC into page itself", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "e3a0518132db40e54623219fe80d4b1abe86318f", "url": "https://github.com/h2database/h2database/commit/e3a0518132db40e54623219fe80d4b1abe86318f", "message": "fix failure (chunk reading) in MVStoreTools", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"oid": "94fcfcd387b8b98dff4a4411ba266428a623e265", "url": "https://github.com/h2database/h2database/commit/94fcfcd387b8b98dff4a4411ba266428a623e265", "message": "cope withe case when pageNo == -1 (backward compatibility)", "committedDate": "2020-01-08T00:36:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU1OTgzNQ==", "url": "https://github.com/h2database/h2database/pull/2386#discussion_r364559835", "bodyText": "We have StringUtils.convertBytesToHex() for this purpose.", "author": "katzyn", "createdAt": "2020-01-09T04:59:14Z", "path": "h2/src/main/org/h2/mvstore/DataUtils.java", "diffHunk": "@@ -1106,6 +1149,56 @@ public static int readHexInt(Map<String, ?> map, String key, int defaultValue) {\n         }\n     }\n \n+    public static String hexEncodeBytes(byte[] bytes) {", "originalCommit": "94fcfcd387b8b98dff4a4411ba266428a623e265", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU2MDIyMA==", "url": "https://github.com/h2database/h2database/pull/2386#discussion_r364560220", "bodyText": "StringUtils.convertHexToBytes().", "author": "katzyn", "createdAt": "2020-01-09T05:01:43Z", "path": "h2/src/main/org/h2/mvstore/DataUtils.java", "diffHunk": "@@ -1106,6 +1149,56 @@ public static int readHexInt(Map<String, ?> map, String key, int defaultValue) {\n         }\n     }\n \n+    public static String hexEncodeBytes(byte[] bytes) {\n+        StringBuilder sb = new StringBuilder(bytes.length * 2);\n+        for (byte b : bytes) {\n+            sb.append(getHexDigitFor(b >> 4));\n+            sb.append(getHexDigitFor(b));\n+        }\n+        return sb.toString();\n+    }\n+\n+    private static char getHexDigitFor(int digit) {\n+        digit &= 0xF;\n+        return (char)((digit < 10 ? '0' : 'a' - 10) + digit);\n+    }\n+\n+    public static byte[] parseHexBytes(Map<String, ?> map, String key) {\n+        Object v = map.get(key);\n+        if (v == null) {\n+            return null;\n+        }\n+        String s = (String)v;\n+        try {\n+            int length = s.length();\n+            byte[] data = new byte[length / 2];\n+            for(int i = 0; i < length; i += 2) {\n+                data[i / 2] = (byte)((hexValueOf(s.charAt(i)) << 4)\n+                                    | hexValueOf(s.charAt(i + 1)));\n+            }\n+            return data;\n+        } catch (NumberFormatException e) {\n+            throw newIllegalStateException(ERROR_FILE_CORRUPT,\n+                    \"Error parsing the value {0}\", v, e);\n+        }", "originalCommit": "94fcfcd387b8b98dff4a4411ba266428a623e265", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f78c77a6add42e4e058a1430d1dfaee68b4c5d3", "url": "https://github.com/h2database/h2database/commit/7f78c77a6add42e4e058a1430d1dfaee68b4c5d3", "message": "use StringUtils.convertHexToBytes()/convertBytesToHex()", "committedDate": "2020-01-11T12:52:15Z", "type": "commit"}, {"oid": "cb1edb7569ee43eb8094bbdfb2a94043806e5526", "url": "https://github.com/h2database/h2database/commit/cb1edb7569ee43eb8094bbdfb2a94043806e5526", "message": "Backward compatibility: move pageNo to the end, beyond compressed area and exclude it from pageLength", "committedDate": "2020-01-11T19:16:05Z", "type": "commit"}]}