{"pr_number": 2674, "pr_title": "healthcare API: update fhir/ samples from v1beta1 to v1 ", "pr_createdAt": "2020-04-16T17:48:51Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc0NTUyMA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409745520", "bodyText": "Should be the earliest one.", "author": "lesv", "createdAt": "2020-04-16T17:57:18Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/FhirStoreCreate.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2019-2020 Google LLC", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODcwMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768703", "bodyText": "Done.", "author": "noerog", "createdAt": "2020-04-16T18:36:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc0NTUyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NDkyMQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409754921", "bodyText": "Really should use GSON or JsonObject to create these.", "author": "lesv", "createdAt": "2020-04-16T18:13:14Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/FhirStoreExecuteBundle.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir;\n+\n+// [START healthcare_fhir_execute_bundle]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirStoreExecuteBundle {\n+  private static final String FHIR_NAME = \"projects/%s/locations/%s/datasets/%s/dicomStores/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirStoreExecuteBundle(String fhirStoreName, String data)\n+      throws IOException, URISyntaxException {\n+    // String fhirStoreName =\n+    //    String.format(\n+    //        FHIR_NAME, \"your-project-id\", \"your-region-id\", \"your-dataset-id\", \"your-fhir-id\");\n+    // String data = \"[{\\\"op\\\": \\\"add\\\", \\\"path\\\": \\\"/active\\\", \\\"value\\\": true}]\";", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODczMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768733", "bodyText": "Created b/154240543.", "author": "noerog", "createdAt": "2020-04-16T18:36:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NDkyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NTE0MQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409755141", "bodyText": "should this be v1?", "author": "lesv", "createdAt": "2020-04-16T18:13:36Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/FhirStoreExecuteBundle.java", "diffHunk": "@@ -0,0 +1,111 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir;\n+\n+// [START healthcare_fhir_execute_bundle]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirStoreExecuteBundle {\n+  private static final String FHIR_NAME = \"projects/%s/locations/%s/datasets/%s/dicomStores/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirStoreExecuteBundle(String fhirStoreName, String data)\n+      throws IOException, URISyntaxException {\n+    // String fhirStoreName =\n+    //    String.format(\n+    //        FHIR_NAME, \"your-project-id\", \"your-region-id\", \"your-dataset-id\", \"your-fhir-id\");\n+    // String data = \"[{\\\"op\\\": \\\"add\\\", \\\"path\\\": \\\"/active\\\", \\\"value\\\": true}]\";\n+\n+    // Initialize the client, which will be used to interact with the service.\n+    CloudHealthcare client = createClient();\n+    HttpClient httpClient = HttpClients.createDefault();\n+    String baseUri = String.format(\"%sv1beta1/%s/fhir\", client.getRootUrl(), fhirStoreName);", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODc2NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768764", "bodyText": "Thanks for noticing these. Done.", "author": "noerog", "createdAt": "2020-04-16T18:36:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NTE0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NjQyMA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409756420", "bodyText": "v1?  Not v1beta1", "author": "lesv", "createdAt": "2020-04-16T18:15:42Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/resources/FhirResourceCreate.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir.resources;\n+\n+// [START healthcare_create_resource]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirResourceCreate {\n+  private static final String FHIR_NAME = \"projects/%s/locations/%s/datasets/%s/fhirStores/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirResourceCreate(String fhirStoreName, String resourceType)\n+      throws IOException, URISyntaxException {\n+    // String fhirStoreName =\n+    //    String.format(\n+    //        FHIR_NAME, \"your-project-id\", \"your-region-id\", \"your-dataset-id\", \"your-fhir-id\");\n+    // String resourceType = \"Patient\";\n+\n+    // Initialize the client, which will be used to interact with the service.\n+    CloudHealthcare client = createClient();\n+    HttpClient httpClient = HttpClients.createDefault();\n+    String uri = String.format(\n+        \"%sv1beta1/%s/fhir/%s\", client.getRootUrl(), fhirStoreName, resourceType);", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODc4Ng==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768786", "bodyText": "Done.", "author": "noerog", "createdAt": "2020-04-16T18:36:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1NjQyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1ODI4Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409758287", "bodyText": "v1, not v1beta1?", "author": "lesv", "createdAt": "2020-04-16T18:18:52Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/resources/FhirResourceGetHistory.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir.resources;\n+\n+// [START healthcare_get_resource_history]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirResourceGetHistory {\n+  private static final String FHIR_NAME = \"projects/%s/locations/%s/datasets/%s/fhirStores/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirResourceGetHistory(String resourceName, String versionId)\n+      throws IOException, URISyntaxException {\n+    // String resourceName =\n+    //    String.format(\n+    //        FHIR_NAME, \"project-id\", \"region-id\", \"dataset-id\", \"store-id\", \"fhir-id\");\n+    // String versionId = \"version-uuid\"\n+\n+    // Initialize the client, which will be used to interact with the service.\n+    CloudHealthcare client = createClient();\n+\n+    HttpClient httpClient = HttpClients.createDefault();\n+    String uri = String.format(\n+        \"%sv1beta1/%s/_history/%s\", client.getRootUrl(), resourceName, versionId);", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODgxOQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768819", "bodyText": "Done.", "author": "noerog", "createdAt": "2020-04-16T18:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1ODI4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1OTAxMw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409759013", "bodyText": "s.b. v1 NOT v1beta1?", "author": "lesv", "createdAt": "2020-04-16T18:20:03Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/resources/FhirResourceGetPatientEverything.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir.resources;\n+\n+// [START healthcare_get_patient_everything]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirResourceGetPatientEverything {\n+  private static final String FHIR_NAME =\n+      \"projects/%s/locations/%s/datasets/%s/fhirStores/%s/fhir/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirResourceGetPatientEverything(String resourceName)\n+      throws IOException, URISyntaxException {\n+    // String resourceName =\n+    //    String.format(\n+    //        FHIR_NAME, \"project-id\", \"region-id\", \"dataset-id\", \"store-id\", \"fhir-id\");\n+\n+    // Initialize the client, which will be used to interact with the service.\n+    CloudHealthcare client = createClient();\n+\n+    HttpClient httpClient = HttpClients.createDefault();\n+    String uri = String.format(\n+        \"%sv1beta1/%s/$everything\", client.getRootUrl(), resourceName);", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODg0OQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768849", "bodyText": "Done.", "author": "noerog", "createdAt": "2020-04-16T18:36:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc1OTAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2MDE1NQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409760155", "bodyText": "s.b. v1, not v1beta1", "author": "lesv", "createdAt": "2020-04-16T18:22:03Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/resources/FhirResourceSearchGet.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir.resources;\n+\n+// [START healthcare_search_resources_get]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirResourceSearchGet {\n+  private static final String FHIR_NAME =\n+      \"projects/%s/locations/%s/datasets/%s/fhirStores/%s/fhir/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirResourceSearchGet(String resourceName)\n+      throws IOException, URISyntaxException {\n+    // String resourceName =\n+    //    String.format(\n+    //        FHIR_NAME, \"project-id\", \"region-id\", \"dataset-id\", \"store-id\", \"fhir-id\");\n+\n+    // Initialize the client, which will be used to interact with the service.\n+    CloudHealthcare client = createClient();\n+\n+    HttpClient httpClient = HttpClients.createDefault();\n+    String uri = String.format(\n+        \"%sv1beta1/%s\", client.getRootUrl(), resourceName);", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODg4Nw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768887", "bodyText": "Done.", "author": "noerog", "createdAt": "2020-04-16T18:37:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2MDE1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2MDMzMg==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409760332", "bodyText": "v1", "author": "lesv", "createdAt": "2020-04-16T18:22:20Z", "path": "healthcare/v1/src/main/java/snippets/healthcare/fhir/resources/FhirResourceSearchPost.java", "diffHunk": "@@ -0,0 +1,115 @@\n+/*\n+ * Copyright 2019-2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare.fhir.resources;\n+\n+// [START healthcare_search_resources_post]\n+import com.google.api.client.googleapis.auth.oauth2.GoogleCredential;\n+import com.google.api.client.http.HttpRequestInitializer;\n+import com.google.api.client.http.javanet.NetHttpTransport;\n+import com.google.api.client.json.JsonFactory;\n+import com.google.api.client.json.jackson2.JacksonFactory;\n+import com.google.api.services.healthcare.v1.CloudHealthcare;\n+import com.google.api.services.healthcare.v1.CloudHealthcareScopes;\n+import java.io.IOException;\n+import java.net.URISyntaxException;\n+import java.util.Collections;\n+import org.apache.http.HttpEntity;\n+import org.apache.http.HttpResponse;\n+import org.apache.http.HttpStatus;\n+import org.apache.http.client.HttpClient;\n+import org.apache.http.client.methods.HttpUriRequest;\n+import org.apache.http.client.methods.RequestBuilder;\n+import org.apache.http.client.utils.URIBuilder;\n+import org.apache.http.entity.StringEntity;\n+import org.apache.http.impl.client.HttpClients;\n+\n+public class FhirResourceSearchPost {\n+  private static final String FHIR_NAME =\n+      \"projects/%s/locations/%s/datasets/%s/fhirStores/%s/fhir/%s\";\n+  private static final JsonFactory JSON_FACTORY = new JacksonFactory();\n+  private static final NetHttpTransport HTTP_TRANSPORT = new NetHttpTransport();\n+\n+  public static void fhirResourceSearchPost(String fhirStoreName, String resourceType)\n+      throws IOException, URISyntaxException {\n+    // String resourceName =\n+    //    String.format(\n+    //        FHIR_NAME, \"project-id\", \"region-id\", \"dataset-id\", \"store-id\", \"fhir-id\");\n+    // String resourceType = \"Patient\";\n+\n+    // Initialize the client, which will be used to interact with the service.\n+    CloudHealthcare client = createClient();\n+\n+    HttpClient httpClient = HttpClients.createDefault();\n+    String uri = String.format(\n+        \"%sv1beta1/%s/fhir/%s/_search\", client.getRootUrl(), fhirStoreName, resourceType);", "originalCommit": "e530fd85539318db77917dedf8b1a04b767721e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2ODkxOA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409768918", "bodyText": "Done.", "author": "noerog", "createdAt": "2020-04-16T18:37:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTc2MDMzMg=="}], "type": "inlineReview"}, {"oid": "f7dbeb920cdf575065a6e834e3070ddbacc14eab", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/f7dbeb920cdf575065a6e834e3070ddbacc14eab", "message": "healthcare API: update fhir/ samples from v1beta1 to v1", "committedDate": "2020-04-16T21:12:33Z", "type": "commit"}, {"oid": "441cdde02efca54c782773ba958c82246fa810d7", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/441cdde02efca54c782773ba958c82246fa810d7", "message": "healthcare API: update pom", "committedDate": "2020-04-16T21:12:33Z", "type": "commit"}, {"oid": "7e94a5b83b512e5e93b9308bafea52821c62b7e4", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7e94a5b83b512e5e93b9308bafea52821c62b7e4", "message": "address review comments, branches causing issues", "committedDate": "2020-04-16T21:14:22Z", "type": "commit"}, {"oid": "7e94a5b83b512e5e93b9308bafea52821c62b7e4", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/7e94a5b83b512e5e93b9308bafea52821c62b7e4", "message": "address review comments, branches causing issues", "committedDate": "2020-04-16T21:14:22Z", "type": "forcePushed"}, {"oid": "183df8bdc34ff104c7c7fb9f27c5a029377a6a7c", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/183df8bdc34ff104c7c7fb9f27c5a029377a6a7c", "message": "upgrade to shared-configuration 1.0.17 and fix style issues", "committedDate": "2020-04-16T21:55:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg4MDA0NA==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/2674#discussion_r409880044", "bodyText": "Ok for now, but at some point it would be good if you delete all the resources you create via these tests.", "author": "lesv", "createdAt": "2020-04-16T22:15:36Z", "path": "healthcare/v1/src/test/java/snippets/healthcare/FhirResourceTests.java", "diffHunk": "@@ -0,0 +1,261 @@\n+/*\n+ * Copyright 2019 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package snippets.healthcare;\n+\n+import static junit.framework.TestCase.assertNotNull;\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.junit.Assert.fail;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.JsonArray;\n+import com.google.gson.JsonObject;\n+import com.google.gson.JsonPrimitive;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.PrintStream;\n+import java.net.URISyntaxException;\n+import java.util.UUID;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import org.junit.After;\n+import org.junit.AfterClass;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Ignore;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.JUnit4;\n+import snippets.healthcare.datasets.DatasetCreate;\n+import snippets.healthcare.datasets.DatasetDelete;\n+import snippets.healthcare.fhir.FhirStoreCreate;\n+import snippets.healthcare.fhir.resources.FhirResourceCreate;\n+import snippets.healthcare.fhir.resources.FhirResourceDelete;\n+import snippets.healthcare.fhir.resources.FhirResourceDeletePurge;\n+import snippets.healthcare.fhir.resources.FhirResourceGet;\n+import snippets.healthcare.fhir.resources.FhirResourceGetHistory;\n+import snippets.healthcare.fhir.resources.FhirResourceGetMetadata;\n+import snippets.healthcare.fhir.resources.FhirResourceGetPatientEverything;\n+import snippets.healthcare.fhir.resources.FhirResourceListHistory;\n+import snippets.healthcare.fhir.resources.FhirResourcePatch;\n+import snippets.healthcare.fhir.resources.FhirResourceSearchGet;\n+import snippets.healthcare.fhir.resources.FhirResourceSearchPost;\n+\n+@RunWith(JUnit4.class)\n+public class FhirResourceTests {\n+  private static final String PROJECT_ID = System.getenv(\"GOOGLE_CLOUD_PROJECT\");\n+  private static final String REGION_ID = \"us-central1\";\n+  private static final Gson gson = new Gson();\n+\n+  private static String fhirStoreName;\n+  private static String datasetName;\n+\n+  private String fhirResourceId;\n+  private String fhirResourceName;\n+\n+  private static String patientType = \"Patient\";\n+\n+  private final PrintStream originalOut = System.out;\n+  private ByteArrayOutputStream bout;\n+\n+  private static void requireEnvVar(String varName) {\n+    assertNotNull(\n+        System.getenv(varName),\n+        String.format(\"Environment variable \\\"%s\\\" is required to perform these tests.\", varName));\n+  }\n+\n+  @BeforeClass\n+  public static void checkRequirements() {\n+    requireEnvVar(\"GOOGLE_APPLICATION_CREDENTIALS\");\n+    requireEnvVar(\"GOOGLE_CLOUD_PROJECT\");\n+  }\n+\n+  @BeforeClass\n+  public static void setUp() throws IOException {\n+    String datasetId = \"dataset-\" + UUID.randomUUID().toString().replaceAll(\"-\", \"_\");\n+    datasetName = String.format(\n+        \"projects/%s/locations/%s/datasets/%s\",\n+        PROJECT_ID,\n+        REGION_ID,\n+        datasetId);\n+    DatasetCreate.datasetCreate(PROJECT_ID, REGION_ID, datasetId);\n+\n+    String fhirStoreId = \"fhir-\" + UUID.randomUUID().toString().replaceAll(\"-\", \"_\");\n+    fhirStoreName = String.format(\"%s/fhirStores/%s\", datasetName, fhirStoreId);\n+    FhirStoreCreate.fhirStoreCreate(datasetName, fhirStoreId);\n+  }\n+\n+  @AfterClass\n+  public static void deleteTempItems() throws IOException {\n+    DatasetDelete.datasetDelete(datasetName);\n+  }\n+\n+  @Before\n+  public void beforeTest() throws IOException, URISyntaxException {\n+    bout = new ByteArrayOutputStream();\n+    System.setOut(new PrintStream(bout));\n+\n+    FhirResourceCreate.fhirResourceCreate(fhirStoreName, patientType);\n+\n+    Matcher idMatcher = Pattern.compile(\"\\\"id\\\": \\\"([^\\\"]*)\\\",\").matcher(bout.toString());\n+    if (idMatcher.find()) {\n+      fhirResourceId = idMatcher.group(1);\n+      fhirResourceName = String.format(\"%s/fhir/%s/%s\", fhirStoreName, patientType, fhirResourceId);\n+    }\n+\n+    bout = new ByteArrayOutputStream();\n+    System.setOut(new PrintStream(bout));\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    System.setOut(originalOut);\n+    bout.reset();\n+  }", "originalCommit": "183df8bdc34ff104c7c7fb9f27c5a029377a6a7c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}