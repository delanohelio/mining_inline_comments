{"pr_number": 4304, "pr_title": "Refactor Storage Transfer Service samples", "pr_createdAt": "2020-11-24T21:54:20Z", "pr_url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304", "timeline": [{"oid": "ebbede14802efd3bcff4bbd460bc58041348d352", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/ebbede14802efd3bcff4bbd460bc58041348d352", "message": "Refactor Storage Transfer Service samples", "committedDate": "2020-11-24T21:27:34Z", "type": "commit"}, {"oid": "f7d8f6dab097de24e2bdafa026749cdd635e3bf5", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/f7d8f6dab097de24e2bdafa026749cdd635e3bf5", "message": "Refactor Storage Transfer Service samples", "committedDate": "2020-11-24T21:42:43Z", "type": "commit"}, {"oid": "67a7fcd179f0cab841dd98930779eb263076b788", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/67a7fcd179f0cab841dd98930779eb263076b788", "message": "Merge branch 'refactorstssamples' of github.com:GoogleCloudPlatform/java-docs-samples into refactorstssamples", "committedDate": "2020-11-24T21:42:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTk5Nzg1OQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r529997859", "bodyText": "Is this utility class still needed?\nIf removed, you can close out: #3706", "author": "frankyn", "createdAt": "2020-11-24T23:23:25Z", "path": "storage/storage-transfer/src/test/java/com/google/cloud/storage/storagetransfer/samples/test/TransferJobUtilsTest.java", "diffHunk": "@@ -21,11 +21,9 @@\n import com.google.api.services.storagetransfer.v1.model.Date;\n import com.google.api.services.storagetransfer.v1.model.TimeOfDay;\n import com.google.cloud.storage.storagetransfer.samples.TransferJobUtils;\n-import java.util.Random;\n import org.junit.Test;\n \n public class TransferJobUtilsTest {\n-  private Random rand = new Random();", "originalCommit": "67a7fcd179f0cab841dd98930779eb263076b788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDAwNDgyMQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r530004821", "bodyText": "It's not used by the samples, but I decided to keep it in just in case anyone has a dependency on this package and was using the utils in their code", "author": "JesseLovelace", "createdAt": "2020-11-24T23:30:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTk5Nzg1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM3NDE0Mw==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r534374143", "bodyText": "This package is never released AFAIU, do you mean in other samples?", "author": "frankyn", "createdAt": "2020-12-02T18:04:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTk5Nzg1OQ=="}], "type": "inlineReview"}, {"oid": "63556eb64bd1a7dbfc6c05037c3683a3605ff188", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/63556eb64bd1a7dbfc6c05037c3683a3605ff188", "message": "move utils to test package", "committedDate": "2020-12-04T00:06:49Z", "type": "commit"}, {"oid": "5f0f3a7cb9d95ae8e9546954b5059ef8a0d0a458", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5f0f3a7cb9d95ae8e9546954b5059ef8a0d0a458", "message": "Merge branch 'master' into refactorstssamples", "committedDate": "2020-12-04T00:07:24Z", "type": "commit"}, {"oid": "2fda23c3bdc9111c1b2c57b5362b980fcdb1f807", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/2fda23c3bdc9111c1b2c57b5362b980fcdb1f807", "message": "fix linting issues", "committedDate": "2020-12-09T00:02:47Z", "type": "commit"}, {"oid": "866a949d973cb20f21c2d9f7482802945bc53276", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/866a949d973cb20f21c2d9f7482802945bc53276", "message": "Merge branch 'refactorstssamples' of github.com:GoogleCloudPlatform/java-docs-samples into refactorstssamples", "committedDate": "2020-12-09T00:03:18Z", "type": "commit"}, {"oid": "04f4a4a2f680732a107a9e656e9a790e76f21d22", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/04f4a4a2f680732a107a9e656e9a790e76f21d22", "message": "Merge remote-tracking branch 'origin/master' into refactorstssamples", "committedDate": "2020-12-09T00:06:40Z", "type": "commit"}, {"oid": "dc54f459a56e7d9bbfcca98a22ec50e4bca90b70", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/dc54f459a56e7d9bbfcca98a22ec50e4bca90b70", "message": "Fix import issue after merge", "committedDate": "2020-12-09T00:16:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODkxMDAxOQ==", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/pull/4304#discussion_r538910019", "bodyText": "Newline", "author": "frankyn", "createdAt": "2020-12-09T00:24:05Z", "path": "storage/storage-transfer/src/main/java/com/google/cloud/storage/storagetransfer/samples/TransferToNearline.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright 2020 Google Inc.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.google.cloud.storage.storagetransfer.samples;\n+\n+// [START storagetransfer_transfer_to_nearline]\n+import com.google.api.client.googleapis.util.Utils;\n+import com.google.api.services.storagetransfer.v1.Storagetransfer;\n+import com.google.api.services.storagetransfer.v1.StoragetransferScopes;\n+import com.google.api.services.storagetransfer.v1.model.Date;\n+import com.google.api.services.storagetransfer.v1.model.GcsData;\n+import com.google.api.services.storagetransfer.v1.model.ObjectConditions;\n+import com.google.api.services.storagetransfer.v1.model.Schedule;\n+import com.google.api.services.storagetransfer.v1.model.TimeOfDay;\n+import com.google.api.services.storagetransfer.v1.model.TransferJob;\n+import com.google.api.services.storagetransfer.v1.model.TransferOptions;\n+import com.google.api.services.storagetransfer.v1.model.TransferSpec;\n+import com.google.auth.http.HttpCredentialsAdapter;\n+import com.google.auth.oauth2.GoogleCredentials;\n+import java.io.IOException;\n+import java.util.Calendar;\n+\n+public class TransferToNearline {\n+  /** Creates a one-off transfer job that transfers objects in a standard GCS bucket that are more\n+   *  than 30 days old to a Nearline GCS bucket.\n+   */\n+  public static void transferToNearline(String projectId,\n+      String jobDescription,\n+      String gcsSourceBucket,\n+      String gcsNearlineSinkBucket,\n+      long startDateTime) throws IOException {\n+\n+    // Your Google Cloud Project ID\n+    // String projectId = \"your-project-id\";\n+\n+    // A short description of this job\n+    // String jobDescription = \"Sample transfer job of old objects to a Nearline GCS bucket.\";\n+\n+    // The name of the source GCS bucket to transfer data from\n+    // String gcsSourceBucket = \"your-gcs-source-bucket\";\n+\n+    // The name of the Nearline GCS bucket to transfer old objects to\n+    // String gcsSinkBucket = \"your-nearline-gcs-bucket\";\n+\n+    // What day and time in UTC to start the transfer, expressed as an epoch date timestamp.\n+    // If this is in the past relative to when the job is created, it will run the next day.\n+    // long startDateTime =\n+    //     new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").parse(\"2000-01-01 00:00:00\").getTime();\n+\n+    // Parse epoch timestamp into the model classes\n+    Calendar startCalendar = Calendar.getInstance();\n+    startCalendar.setTimeInMillis(startDateTime);\n+    // Note that this is a Date from the model class package, not a java.util.Date\n+    Date date = new Date()\n+        .setYear(startCalendar.get(Calendar.YEAR))\n+        .setMonth(startCalendar.get(Calendar.MONTH) + 1)\n+        .setDay(startCalendar.get(Calendar.DAY_OF_MONTH));\n+    TimeOfDay time = new TimeOfDay()\n+        .setHours(startCalendar.get(Calendar.HOUR_OF_DAY))\n+        .setMinutes(startCalendar.get(Calendar.MINUTE))\n+        .setSeconds(startCalendar.get(Calendar.SECOND));\n+\n+    TransferJob transferJob =\n+        new TransferJob()\n+            .setDescription(jobDescription)\n+            .setProjectId(projectId)\n+            .setTransferSpec(\n+                new TransferSpec()\n+                    .setGcsDataSource(new GcsData().setBucketName(gcsSourceBucket))\n+                    .setGcsDataSink(new GcsData().setBucketName(gcsNearlineSinkBucket))\n+                    .setObjectConditions(\n+                        new ObjectConditions()\n+                            .setMinTimeElapsedSinceLastModification(\"2592000s\" /* 30 days */))\n+                    .setTransferOptions(\n+                        new TransferOptions().setDeleteObjectsFromSourceAfterTransfer(true)))\n+            .setSchedule(new Schedule().setScheduleStartDate(date).setStartTimeOfDay(time))\n+            .setStatus(\"ENABLED\");\n+\n+    // Create a Transfer Service client\n+    GoogleCredentials credential = GoogleCredentials.getApplicationDefault();\n+    if (credential.createScopedRequired()) {\n+      credential = credential.createScoped(StoragetransferScopes.all());\n+    }\n+    Storagetransfer storageTransfer = new Storagetransfer.Builder(Utils.getDefaultTransport(),\n+        Utils.getDefaultJsonFactory(), new HttpCredentialsAdapter(credential))\n+        .build();\n+\n+    // Create the transfer job\n+    TransferJob response = storageTransfer.transferJobs().create(transferJob).execute();\n+\n+    System.out.println(\"Created transfer job from standard bucket to Nearline bucket:\");\n+    System.out.println(response.toPrettyString());\n+  }\n+}\n+// [END storagetransfer_transfer_to_nearline]", "originalCommit": "dc54f459a56e7d9bbfcca98a22ec50e4bca90b70", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5e316737b0fc387f324d00d5833a7f4df96845b5", "url": "https://github.com/GoogleCloudPlatform/java-docs-samples/commit/5e316737b0fc387f324d00d5833a7f4df96845b5", "message": "Add newline and fix util issues", "committedDate": "2020-12-09T00:34:51Z", "type": "commit"}]}