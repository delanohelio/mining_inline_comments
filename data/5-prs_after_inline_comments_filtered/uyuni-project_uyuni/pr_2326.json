{"pr_number": 2326, "pr_title": "Add \"mgrcompat.module_run\" wrapper for \"module.run\" to avoid future syntax deprecation issues", "pr_createdAt": "2020-06-16T13:06:04Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2326", "timeline": [{"oid": "60dcceb737a471f3fe97730d11c0668908578d07", "url": "https://github.com/uyuni-project/uyuni/commit/60dcceb737a471f3fe97730d11c0668908578d07", "message": "Fix mgrcompat unit tests expectation after latest fixes", "committedDate": "2020-06-23T09:32:49Z", "type": "forcePushed"}, {"oid": "1c5795506af55fe2900bd7155c2b907e856f7ad7", "url": "https://github.com/uyuni-project/uyuni/commit/1c5795506af55fe2900bd7155c2b907e856f7ad7", "message": "Add testsuite scenarios to test mgrcompat with new module.run syntax", "committedDate": "2020-06-24T10:34:49Z", "type": "forcePushed"}, {"oid": "5f9150e8b33ce32ba072b5b00a4e381921fec2f5", "url": "https://github.com/uyuni-project/uyuni/commit/5f9150e8b33ce32ba072b5b00a4e381921fec2f5", "message": "Testsuite: ensure mgrcompat pycache file is removed", "committedDate": "2020-06-25T12:07:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA0MzY2MQ==", "url": "https://github.com/uyuni-project/uyuni/pull/2326#discussion_r449043661", "bodyText": "Isn't this doing a synchronous Salt call reaching out to that minion? Someone who is an expert on the registration code and it's scalability should probably approve this at least, I remember that previously we tried to avoid doing synchronous calls to Salt during the registration as there is a risk of blocking a thread in case the minion is not responding. If there is any option to run this asynchronously it would definitely be preferable from my perspective.", "author": "renner", "createdAt": "2020-07-02T14:29:21Z", "path": "java/code/src/com/suse/manager/reactor/messaging/RegisterMinionEventMessageAction.java", "diffHunk": "@@ -403,6 +403,8 @@ else if (!minion.getOrg().equals(org)) {\n                 return;\n             }\n \n+            MinionList minionTarget = new MinionList(minionId);\n+            systemQuery.syncAll(minionTarget);", "originalCommit": "9c731331546e5cfeecc27c87f38f471741620c22", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTQ1Njg2Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2326#discussion_r449456862", "bodyText": "Hmmm, yeah, this would be a callSync execution in the end. I'll think how we could make this asynchronous \ud83d\udc4d", "author": "meaksh", "createdAt": "2020-07-03T08:40:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA0MzY2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MTQ0MjE0Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2326#discussion_r451442147", "bodyText": "As discussed, I've removed this call during minion registration. After latest SLS refactoring, the custom mgrcompat state module should be automatically deployed while applying any SLS that requires it, particularly, the \"Hardware Refresh\" action triggered at the beginning of registration will also sync the states.", "author": "meaksh", "createdAt": "2020-07-08T10:28:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTA0MzY2MQ=="}], "type": "inlineReview"}, {"oid": "a4f00ba991cd757cca78644a081b9e6cee1068f6", "url": "https://github.com/uyuni-project/uyuni/commit/a4f00ba991cd757cca78644a081b9e6cee1068f6", "message": "Add custom mgrcompat state module to determine module.run syntax", "committedDate": "2020-07-08T10:20:20Z", "type": "commit"}, {"oid": "406592c1ab75f6d88470c9136c6d51140cd30822", "url": "https://github.com/uyuni-project/uyuni/commit/406592c1ab75f6d88470c9136c6d51140cd30822", "message": "Add case for any future Salt release", "committedDate": "2020-07-08T10:20:23Z", "type": "commit"}, {"oid": "cbc7d8232939906093164d9c05a50d1a21892442", "url": "https://github.com/uyuni-project/uyuni/commit/cbc7d8232939906093164d9c05a50d1a21892442", "message": "Add unit tests for mgrcompat custom state module", "committedDate": "2020-07-08T10:20:23Z", "type": "commit"}, {"oid": "ff3d796312268c12bc66c198acecce94a69e21ff", "url": "https://github.com/uyuni-project/uyuni/commit/ff3d796312268c12bc66c198acecce94a69e21ff", "message": "Update susemanager-sls spec to add custom states", "committedDate": "2020-07-08T10:20:23Z", "type": "commit"}, {"oid": "c8540783d50e5bcb249dba8a3a13703334967f40", "url": "https://github.com/uyuni-project/uyuni/commit/c8540783d50e5bcb249dba8a3a13703334967f40", "message": "Adding utf8 encoding to mgrcompat test file", "committedDate": "2020-07-08T10:20:24Z", "type": "commit"}, {"oid": "6f6e80c828c9c9b4542a449efc81556963a8106b", "url": "https://github.com/uyuni-project/uyuni/commit/6f6e80c828c9c9b4542a449efc81556963a8106b", "message": "Add missing __init__ file for custom states", "committedDate": "2020-07-08T10:20:24Z", "type": "commit"}, {"oid": "f152bd953ab10b31037f56f9cf29a22324de6dd8", "url": "https://github.com/uyuni-project/uyuni/commit/f152bd953ab10b31037f56f9cf29a22324de6dd8", "message": "Remove conflictive mockery use on mgrcompat tests", "committedDate": "2020-07-08T10:20:24Z", "type": "commit"}, {"oid": "5c9fcc799e3fca01bb8af3802362e83d103b82f6", "url": "https://github.com/uyuni-project/uyuni/commit/5c9fcc799e3fca01bb8af3802362e83d103b82f6", "message": "Update changelog for susemanager-sls", "committedDate": "2020-07-08T10:20:25Z", "type": "commit"}, {"oid": "2662b4318fe4e98927f4b1046382b2195aa12496", "url": "https://github.com/uyuni-project/uyuni/commit/2662b4318fe4e98927f4b1046382b2195aa12496", "message": "Prevent error when no attributes passed to the execution module", "committedDate": "2020-07-08T10:20:25Z", "type": "commit"}, {"oid": "c72aa64a08672e50589c961b4595dda16b864340", "url": "https://github.com/uyuni-project/uyuni/commit/c72aa64a08672e50589c961b4595dda16b864340", "message": "Enable newer syntax for module.run on minions while bootstrapping", "committedDate": "2020-07-08T10:20:25Z", "type": "commit"}, {"oid": "6f8d2bc0f193e1d9465732d849c85dc3f21d040b", "url": "https://github.com/uyuni-project/uyuni/commit/6f8d2bc0f193e1d9465732d849c85dc3f21d040b", "message": "Add helper for running \"saltutil.sync_all\"", "committedDate": "2020-07-08T10:20:25Z", "type": "commit"}, {"oid": "aaf8eabcd7cc68407aee0cf45be7ee1f36770126", "url": "https://github.com/uyuni-project/uyuni/commit/aaf8eabcd7cc68407aee0cf45be7ee1f36770126", "message": "Sync all grains, state, modules and beacons during registration", "committedDate": "2020-07-08T10:20:26Z", "type": "commit"}, {"oid": "8599d37a6189c991e7fecd0077db0ba34a3c70f0", "url": "https://github.com/uyuni-project/uyuni/commit/8599d37a6189c991e7fecd0077db0ba34a3c70f0", "message": "Add syncAll as expectation while registering a minion", "committedDate": "2020-07-08T10:20:26Z", "type": "commit"}, {"oid": "716d3cd882bf2715b75a199acb1ce2044c71b5b5", "url": "https://github.com/uyuni-project/uyuni/commit/716d3cd882bf2715b75a199acb1ce2044c71b5b5", "message": "Take care of not expected returns from module execution", "committedDate": "2020-07-08T10:20:26Z", "type": "commit"}, {"oid": "43c0d35e5322adbb1e5cae530a4893a7be515530", "url": "https://github.com/uyuni-project/uyuni/commit/43c0d35e5322adbb1e5cae530a4893a7be515530", "message": "Update changelog for spacewalk-java", "committedDate": "2020-07-08T10:20:26Z", "type": "commit"}, {"oid": "2b60bb6494aebfada14a5c263c5ce12874fc535b", "url": "https://github.com/uyuni-project/uyuni/commit/2b60bb6494aebfada14a5c263c5ce12874fc535b", "message": "Adapt expected Salt responses to mgrcompat", "committedDate": "2020-07-08T10:20:28Z", "type": "commit"}, {"oid": "56cd575d620c14db217b95730a487970e06195fe", "url": "https://github.com/uyuni-project/uyuni/commit/56cd575d620c14db217b95730a487970e06195fe", "message": "Handle mgrcompat parameters properly and call module.run state", "committedDate": "2020-07-08T10:20:28Z", "type": "commit"}, {"oid": "01a620ea73bc1b7bed1df42eaa5cca1a69a76ae6", "url": "https://github.com/uyuni-project/uyuni/commit/01a620ea73bc1b7bed1df42eaa5cca1a69a76ae6", "message": "Switch SLS files to use mgrcompat.module_run instead module.run", "committedDate": "2020-07-08T10:20:33Z", "type": "commit"}, {"oid": "c034899eb51911026ce6d05914f2453bcd441c0b", "url": "https://github.com/uyuni-project/uyuni/commit/c034899eb51911026ce6d05914f2453bcd441c0b", "message": "Tailor old format kwargs to newer syntax of module.run", "committedDate": "2020-07-08T10:20:33Z", "type": "commit"}, {"oid": "1f0e99a03a2ad25b6c006bc02e099fee01d79e95", "url": "https://github.com/uyuni-project/uyuni/commit/1f0e99a03a2ad25b6c006bc02e099fee01d79e95", "message": "Do not make mgrcompat state module depending on state.single", "committedDate": "2020-07-08T10:20:33Z", "type": "commit"}, {"oid": "a46780711fc15d24fd02f986f4811842ff01d9df", "url": "https://github.com/uyuni-project/uyuni/commit/a46780711fc15d24fd02f986f4811842ff01d9df", "message": "Add cases for Salt Neon on mgrcompat state module", "committedDate": "2020-07-08T10:20:34Z", "type": "commit"}, {"oid": "ef6b07f252d7a79e49ae08e5b1b327d5dab4783b", "url": "https://github.com/uyuni-project/uyuni/commit/ef6b07f252d7a79e49ae08e5b1b327d5dab4783b", "message": "Fix unit tests for mgrcompat state module", "committedDate": "2020-07-08T10:20:34Z", "type": "commit"}, {"oid": "2d4a8090c66a0649cf534d391be38fa2ee1feafb", "url": "https://github.com/uyuni-project/uyuni/commit/2d4a8090c66a0649cf534d391be38fa2ee1feafb", "message": "Fix remaining SLS files that directly call module.run", "committedDate": "2020-07-08T10:20:34Z", "type": "commit"}, {"oid": "f773d4140efd0247712e927b94c0fdbdaa254e3c", "url": "https://github.com/uyuni-project/uyuni/commit/f773d4140efd0247712e927b94c0fdbdaa254e3c", "message": "Fix remaining reference to module.run on Java code", "committedDate": "2020-07-08T10:20:34Z", "type": "commit"}, {"oid": "88169f79e69a78a8d02c9a82f7b8c49b3449bb56", "url": "https://github.com/uyuni-project/uyuni/commit/88169f79e69a78a8d02c9a82f7b8c49b3449bb56", "message": "Fix mockery and test environment for mgrcompat", "committedDate": "2020-07-08T10:20:35Z", "type": "commit"}, {"oid": "fa7f9ae964ad8fcd9080f1933ae9958452e04a27", "url": "https://github.com/uyuni-project/uyuni/commit/fa7f9ae964ad8fcd9080f1933ae9958452e04a27", "message": "Fix Java issues after last rebase with master branch", "committedDate": "2020-07-08T10:20:35Z", "type": "commit"}, {"oid": "7147c15e9ae1464be13f979725c0015c60916087", "url": "https://github.com/uyuni-project/uyuni/commit/7147c15e9ae1464be13f979725c0015c60916087", "message": "Adapt remaining usage of module.run on Java and tests", "committedDate": "2020-07-08T10:20:35Z", "type": "commit"}, {"oid": "33516bab7e0461cde776bafd22070f253392baa6", "url": "https://github.com/uyuni-project/uyuni/commit/33516bab7e0461cde776bafd22070f253392baa6", "message": "Add syncAll call to RegisterMinionActionTest expectations", "committedDate": "2020-07-08T10:20:35Z", "type": "commit"}, {"oid": "70ab22027c1cd2f33f7bce90e72cc16e19a437b3", "url": "https://github.com/uyuni-project/uyuni/commit/70ab22027c1cd2f33f7bce90e72cc16e19a437b3", "message": "Fix expectations for SaltActionChainGeneratorServiceTest", "committedDate": "2020-07-08T10:20:35Z", "type": "commit"}, {"oid": "a2a712858800e90b080df2d86e189521b6a6760b", "url": "https://github.com/uyuni-project/uyuni/commit/a2a712858800e90b080df2d86e189521b6a6760b", "message": "Always make mgrcompat state module available", "committedDate": "2020-07-08T10:20:36Z", "type": "commit"}, {"oid": "759f6635070727f588668c476c0240343631d6a2", "url": "https://github.com/uyuni-project/uyuni/commit/759f6635070727f588668c476c0240343631d6a2", "message": "Take care of possible kwargs parameters when tailoring to new syntax", "committedDate": "2020-07-08T10:20:36Z", "type": "commit"}, {"oid": "4684bcae8cceb59849803caaa590d3069d6576e2", "url": "https://github.com/uyuni-project/uyuni/commit/4684bcae8cceb59849803caaa590d3069d6576e2", "message": "Refactor checks for new syntax requirements across Salt versions", "committedDate": "2020-07-08T10:20:36Z", "type": "commit"}, {"oid": "1e924a7a49b6b8aa6fa9d10d122032d626f7c6c1", "url": "https://github.com/uyuni-project/uyuni/commit/1e924a7a49b6b8aa6fa9d10d122032d626f7c6c1", "message": "Add debug logging to mgrcompat state module", "committedDate": "2020-07-08T10:20:36Z", "type": "commit"}, {"oid": "8f16010bb87bf17e8a87027a186eebed54e69728", "url": "https://github.com/uyuni-project/uyuni/commit/8f16010bb87bf17e8a87027a186eebed54e69728", "message": "Minor fix on documentation", "committedDate": "2020-07-08T10:20:36Z", "type": "commit"}, {"oid": "3fa093d531bb23d0c51045952b819c5d1032e2d9", "url": "https://github.com/uyuni-project/uyuni/commit/3fa093d531bb23d0c51045952b819c5d1032e2d9", "message": "Update changelog for spacewalk-java", "committedDate": "2020-07-08T10:20:37Z", "type": "commit"}, {"oid": "f5ae175bff78e9e5f615c3f6dc1a5f89cea9f8cf", "url": "https://github.com/uyuni-project/uyuni/commit/f5ae175bff78e9e5f615c3f6dc1a5f89cea9f8cf", "message": "Fix tests for mgrcompat", "committedDate": "2020-07-08T10:20:37Z", "type": "commit"}, {"oid": "416bc86fbc18ddf851399c16e98e3fd0285905e0", "url": "https://github.com/uyuni-project/uyuni/commit/416bc86fbc18ddf851399c16e98e3fd0285905e0", "message": "Fix issue with tailored kwargs to avoid workaround at Salt", "committedDate": "2020-07-08T10:20:37Z", "type": "commit"}, {"oid": "99718c65bdf946676eb86d31c77a4e2f56efe0b6", "url": "https://github.com/uyuni-project/uyuni/commit/99718c65bdf946676eb86d31c77a4e2f56efe0b6", "message": "Do not enable new module.run syntax by default on minion configuration", "committedDate": "2020-07-08T10:20:37Z", "type": "commit"}, {"oid": "d2a881e0da26c6692628679a808e64c1dddd4576", "url": "https://github.com/uyuni-project/uyuni/commit/d2a881e0da26c6692628679a808e64c1dddd4576", "message": "Fix mgrcompat unit tests expectation after latest fixes", "committedDate": "2020-07-08T10:20:38Z", "type": "commit"}, {"oid": "81e00616f35b371113ea62db1249d43a680baeda", "url": "https://github.com/uyuni-project/uyuni/commit/81e00616f35b371113ea62db1249d43a680baeda", "message": "Adapt SLS files to properly sync required states and modules", "committedDate": "2020-07-08T10:20:38Z", "type": "commit"}, {"oid": "314bd8f1a401cd66a551b9e470f295dbf6f7a8df", "url": "https://github.com/uyuni-project/uyuni/commit/314bd8f1a401cd66a551b9e470f295dbf6f7a8df", "message": "Add testsuite scenarios to test mgrcompat with new module.run syntax", "committedDate": "2020-07-08T10:20:38Z", "type": "commit"}, {"oid": "d1152244bf81b4e8741bf34ac33fb3e03e111ae0", "url": "https://github.com/uyuni-project/uyuni/commit/d1152244bf81b4e8741bf34ac33fb3e03e111ae0", "message": "Fix indentation and small issue on delete cleanup scenario", "committedDate": "2020-07-08T10:20:38Z", "type": "commit"}, {"oid": "31597474c72f4b97a37b53258556451e0be3eceb", "url": "https://github.com/uyuni-project/uyuni/commit/31597474c72f4b97a37b53258556451e0be3eceb", "message": "Add min_salt_mgrcompat_state.feature to secondary run_sets", "committedDate": "2020-07-08T10:20:38Z", "type": "commit"}, {"oid": "6aea13a29d5ad03e4242ec079119e9ce319736f3", "url": "https://github.com/uyuni-project/uyuni/commit/6aea13a29d5ad03e4242ec079119e9ce319736f3", "message": "Fix missing requires to use mgrcompat instead of module", "committedDate": "2020-07-08T10:20:39Z", "type": "commit"}, {"oid": "a4db5f4703d1a42ea2459f8bfa365064153dbe29", "url": "https://github.com/uyuni-project/uyuni/commit/a4db5f4703d1a42ea2459f8bfa365064153dbe29", "message": "Fix remaining references to module state instead of mgrcompat", "committedDate": "2020-07-08T10:20:39Z", "type": "commit"}, {"oid": "9c78beb964d3d38fc91548b9ebda9c9618d31c67", "url": "https://github.com/uyuni-project/uyuni/commit/9c78beb964d3d38fc91548b9ebda9c9618d31c67", "message": "Add testsuite scenario where mgrcompat module in not synced", "committedDate": "2020-07-08T10:20:39Z", "type": "commit"}, {"oid": "4a0f247da2e4aa4e92d36b53c37bb100ad2753be", "url": "https://github.com/uyuni-project/uyuni/commit/4a0f247da2e4aa4e92d36b53c37bb100ad2753be", "message": "Remove extra whitespaces from feature file", "committedDate": "2020-07-08T10:20:39Z", "type": "commit"}, {"oid": "b1d7d2013eca317a93375477cad12d1e6300764a", "url": "https://github.com/uyuni-project/uyuni/commit/b1d7d2013eca317a93375477cad12d1e6300764a", "message": "Fix some includes to avoid conflicts in some scenarios", "committedDate": "2020-07-08T10:20:40Z", "type": "commit"}, {"oid": "2318a3319f3d6b2632cd568037822a253aae5273", "url": "https://github.com/uyuni-project/uyuni/commit/2318a3319f3d6b2632cd568037822a253aae5273", "message": "Fix wrong include path to bootstrap/remove_traditional_stack.sls", "committedDate": "2020-07-08T10:20:40Z", "type": "commit"}, {"oid": "5df44f7594bc1939314a14c5dee8eb28fb364e2f", "url": "https://github.com/uyuni-project/uyuni/commit/5df44f7594bc1939314a14c5dee8eb28fb364e2f", "message": "Do some alignment fixes to avoid rendering issues", "committedDate": "2020-07-08T10:20:40Z", "type": "commit"}, {"oid": "843f76a6880b665c2bdea057920e5b5caf95c906", "url": "https://github.com/uyuni-project/uyuni/commit/843f76a6880b665c2bdea057920e5b5caf95c906", "message": "Allow util.syncstates to run when mgrcompat is not yet synced", "committedDate": "2020-07-08T10:20:40Z", "type": "commit"}, {"oid": "390fe1c602837ad723f6a928ee847b607b41a6a6", "url": "https://github.com/uyuni-project/uyuni/commit/390fe1c602837ad723f6a928ee847b607b41a6a6", "message": "Testsuite: ensure mgrcompat pycache file is removed", "committedDate": "2020-07-08T10:20:40Z", "type": "commit"}, {"oid": "c1299194bb660ae3f9867702dc626251078e324c", "url": "https://github.com/uyuni-project/uyuni/commit/c1299194bb660ae3f9867702dc626251078e324c", "message": "Add extra testsuite scenario to check syncstate works on outdated minions", "committedDate": "2020-07-08T10:20:41Z", "type": "commit"}, {"oid": "55ca221ea89b33f2cf75d0a80fd5e73bdb41f97d", "url": "https://github.com/uyuni-project/uyuni/commit/55ca221ea89b33f2cf75d0a80fd5e73bdb41f97d", "message": "Add missing step at mgrcompat testsuite scenario", "committedDate": "2020-07-08T10:20:41Z", "type": "commit"}, {"oid": "65de81d3fc7e8749215bd354c11c359d29af43cc", "url": "https://github.com/uyuni-project/uyuni/commit/65de81d3fc7e8749215bd354c11c359d29af43cc", "message": "Sync custom states when at packages.profileupdate", "committedDate": "2020-07-08T10:20:41Z", "type": "commit"}, {"oid": "f008220bce3cd002be84a255e96bf4eccf94e731", "url": "https://github.com/uyuni-project/uyuni/commit/f008220bce3cd002be84a255e96bf4eccf94e731", "message": "Sync custom states when at images.profileupdate", "committedDate": "2020-07-08T10:20:41Z", "type": "commit"}, {"oid": "e71327c2995f618e974ee1ed1c5cac2844dca82d", "url": "https://github.com/uyuni-project/uyuni/commit/e71327c2995f618e974ee1ed1c5cac2844dca82d", "message": "Sync custom states when srvmonitoring.status", "committedDate": "2020-07-08T10:20:42Z", "type": "commit"}, {"oid": "d41bcf531ffa535ee774c0a722b0b87cbde80f62", "url": "https://github.com/uyuni-project/uyuni/commit/d41bcf531ffa535ee774c0a722b0b87cbde80f62", "message": "Add github workflow to check SLS content: no usage of module.run", "committedDate": "2020-07-08T10:20:42Z", "type": "commit"}, {"oid": "216e7e41a25c2a3285cd913abf030c03f0af74e9", "url": "https://github.com/uyuni-project/uyuni/commit/216e7e41a25c2a3285cd913abf030c03f0af74e9", "message": "Fail to build susemanager-sls if SLS contains contains module.run calls", "committedDate": "2020-07-08T10:20:42Z", "type": "commit"}, {"oid": "f36f621e3002f7bae9636de7b1fe10eac64bfe19", "url": "https://github.com/uyuni-project/uyuni/commit/f36f621e3002f7bae9636de7b1fe10eac64bfe19", "message": "Fix path to .github/config/file-content-checks.toml", "committedDate": "2020-07-08T10:20:42Z", "type": "commit"}, {"oid": "38e6757a5826ee2d830e899dbf536750666bfe7d", "url": "https://github.com/uyuni-project/uyuni/commit/38e6757a5826ee2d830e899dbf536750666bfe7d", "message": "Do not sync all custom Salt modules during registration", "committedDate": "2020-07-08T10:25:31Z", "type": "commit"}, {"oid": "38e6757a5826ee2d830e899dbf536750666bfe7d", "url": "https://github.com/uyuni-project/uyuni/commit/38e6757a5826ee2d830e899dbf536750666bfe7d", "message": "Do not sync all custom Salt modules during registration", "committedDate": "2020-07-08T10:25:31Z", "type": "forcePushed"}]}