{"pr_number": 2611, "pr_title": "Warn user about missing hypervisor or libvirt binding", "pr_createdAt": "2020-09-16T12:35:16Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2611", "timeline": [{"oid": "e195d34e49c632bc7781280ab6c8c9aa83cb0759", "url": "https://github.com/uyuni-project/uyuni/commit/e195d34e49c632bc7781280ab6c8c9aa83cb0759", "message": "Warn user about missing hypervisor or libvirt binding\n\nThe user could add the virtualization entitlement and have none or part\nof the dependencies set up on the virtualization host. A message will\nindicate that the libvirt python binding (and thus the salt virt module)\nis missing.\n\nAlso warn the user if the KVM or Xen modules are not loaded. This could\nmean that they have been installed but the system still needs a reboot.", "committedDate": "2020-09-16T13:38:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA4MTY4Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2611#discussion_r492081682", "bodyText": "I prefer a ternary operator instead:\ndata.put(\"hypervisor\",\n    hasVirtualizationEntitlement() ? virtManager.getHypervisor(server.getMinionId()) : \"\"\n);", "author": "ncounter", "createdAt": "2020-09-21T14:15:53Z", "path": "java/code/src/com/suse/manager/webui/controllers/virtualization/VirtualGuestsController.java", "diffHunk": "@@ -144,6 +144,11 @@ public ModelAndView show(Request request, Response response, User user) {\n         data.put(\"salt_entitled\", server.hasEntitlement(EntitlementManager.SALT));\n         data.put(\"foreign_entitled\", server.hasEntitlement(EntitlementManager.FOREIGN));\n         data.put(\"is_admin\", user.hasRole(RoleFactory.ORG_ADMIN));\n+        String hypervisor = \"\";\n+        if (server.hasVirtualizationEntitlement()) {\n+            hypervisor = virtManager.getHypervisor(server.getMinionId()).orElse(\"\");\n+        }\n+        data.put(\"hypervisor\", hypervisor);", "originalCommit": "e195d34e49c632bc7781280ab6c8c9aa83cb0759", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA4MjE2NA==", "url": "https://github.com/uyuni-project/uyuni/pull/2611#discussion_r492082164", "bodyText": "Ternary operator same as before", "author": "ncounter", "createdAt": "2020-09-21T14:16:17Z", "path": "java/code/src/com/suse/manager/webui/controllers/virtualization/VirtualNetsController.java", "diffHunk": "@@ -86,7 +87,16 @@ public void initRoutes(JadeTemplateEngine jade) {\n      * @return the ModelAndView object to render the page\n      */\n     public ModelAndView show(Request request, Response response, User user) {\n-        return renderPage(request, response, user, \"show\", null);\n+        Server host = getServer(request, user);\n+        return renderPage(request, response, user, \"show\", () -> {\n+            Map<String, Object> extra = new HashMap<>();\n+            String hypervisor = \"\";\n+            if (host.hasVirtualizationEntitlement()) {\n+                hypervisor = virtManager.getHypervisor(host.getMinionId()).orElse(\"\");\n+            }\n+            extra.put(\"hypervisor\", hypervisor);", "originalCommit": "e195d34e49c632bc7781280ab6c8c9aa83cb0759", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA4MjY2Mw==", "url": "https://github.com/uyuni-project/uyuni/pull/2611#discussion_r492082663", "bodyText": "Ternary operator same as before", "author": "ncounter", "createdAt": "2020-09-21T14:16:45Z", "path": "java/code/src/com/suse/manager/webui/controllers/virtualization/VirtualPoolsController.java", "diffHunk": "@@ -120,7 +120,16 @@ public void initRoutes(JadeTemplateEngine jade) {\n      * @return the ModelAndView object to render the page\n      */\n     public ModelAndView show(Request request, Response response, User user) {\n-        return renderPage(request, response, user, \"show\", null);\n+        Server host = getServer(request, user);\n+        return renderPage(request, response, user, \"show\", () -> {\n+            Map<String, Object> extra = new HashMap<>();\n+            String hypervisor = \"\";\n+            if (host.hasVirtualizationEntitlement()) {\n+                hypervisor = virtManager.getHypervisor(host.getMinionId()).orElse(\"\");\n+            }\n+            extra.put(\"hypervisor\", hypervisor);", "originalCommit": "e195d34e49c632bc7781280ab6c8c9aa83cb0759", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4a503bf1c9716293b265f870c569875432bc3c2e", "url": "https://github.com/uyuni-project/uyuni/commit/4a503bf1c9716293b265f870c569875432bc3c2e", "message": "Warn user about missing hypervisor or libvirt binding\n\nThe user could add the virtualization entitlement and have none or part\nof the dependencies set up on the virtualization host. A message will\nindicate that the libvirt python binding (and thus the salt virt module)\nis missing.\n\nAlso warn the user if the KVM or Xen modules are not loaded. This could\nmean that they have been installed but the system still needs a reboot.", "committedDate": "2020-09-22T08:35:17Z", "type": "forcePushed"}, {"oid": "db58c64e38b237f947ab5ada96c6e794e37da24b", "url": "https://github.com/uyuni-project/uyuni/commit/db58c64e38b237f947ab5ada96c6e794e37da24b", "message": "Warn user about missing hypervisor or libvirt binding\n\nThe user could add the virtualization entitlement and have none or part\nof the dependencies set up on the virtualization host. A message will\nindicate that the libvirt python binding (and thus the salt virt module)\nis missing.\n\nAlso warn the user if the KVM or Xen modules are not loaded. This could\nmean that they have been installed but the system still needs a reboot.", "committedDate": "2020-09-22T08:36:52Z", "type": "forcePushed"}, {"oid": "03e458704d22bcae292e3793286471642b1bc4a4", "url": "https://github.com/uyuni-project/uyuni/commit/03e458704d22bcae292e3793286471642b1bc4a4", "message": "Warn user about missing hypervisor or libvirt binding\n\nThe user could add the virtualization entitlement and have none or part\nof the dependencies set up on the virtualization host. A message will\nindicate that the libvirt python binding (and thus the salt virt module)\nis missing.\n\nAlso warn the user if the KVM or Xen modules are not loaded. This could\nmean that they have been installed but the system still needs a reboot.", "committedDate": "2020-09-23T06:18:53Z", "type": "commit"}, {"oid": "03e458704d22bcae292e3793286471642b1bc4a4", "url": "https://github.com/uyuni-project/uyuni/commit/03e458704d22bcae292e3793286471642b1bc4a4", "message": "Warn user about missing hypervisor or libvirt binding\n\nThe user could add the virtualization entitlement and have none or part\nof the dependencies set up on the virtualization host. A message will\nindicate that the libvirt python binding (and thus the salt virt module)\nis missing.\n\nAlso warn the user if the KVM or Xen modules are not loaded. This could\nmean that they have been installed but the system still needs a reboot.", "committedDate": "2020-09-23T06:18:53Z", "type": "forcePushed"}]}