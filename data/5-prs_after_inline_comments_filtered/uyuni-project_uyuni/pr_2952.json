{"pr_number": 2952, "pr_title": "Use sanitized repo label to build reposync repo cache path (bsc#1179410)", "pr_createdAt": "2020-12-01T13:32:49Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2952", "timeline": [{"oid": "8d33d26c138d3132405d0abd4e703d061eb64b29", "url": "https://github.com/uyuni-project/uyuni/commit/8d33d26c138d3132405d0abd4e703d061eb64b29", "message": "Update changelog for spacewalk-backend", "committedDate": "2020-12-02T12:28:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODc0OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2952#discussion_r534338748", "bodyText": "Why is this valid?", "author": "mcalmer", "createdAt": "2020-12-02T17:12:55Z", "path": "java/code/src/com/redhat/rhn/manager/channel/test/BaseRepoCommandTest.java", "diffHunk": "@@ -130,4 +130,82 @@ private void validUrlInput(String url, String type) {\n             fail(\"valid repo type caused error: \" + url);\n         }\n     }\n+\n+    public void testRepoLabelInput() {\n+\n+        // Repository label must contain only letters, hyphens, periods, underscores and numeral\n+\n+        // I N V A L I D\n+        invalidRepoLabelInput(\"\");\n+        invalidRepoLabelInput(\"example/repo\");\n+        invalidRepoLabelInput(\"example;repo\");\n+        invalidRepoLabelInput(\"example_repo$\");\n+        invalidRepoLabelInput(\"my*examplerepo\");\n+        invalidRepoLabelInput(\"example^repo\");\n+\n+        // V A L I D\n+        validRepoLabelInput(\"my example repo\");\n+        validRepoLabelInput(\"my-example-repo\");\n+        validRepoLabelInput(\"my-example_repo\");\n+        validRepoLabelInput(\"my_repo_22\");\n+        validRepoLabelInput(\"My-Example-Repo\");\n+        validRepoLabelInput(\"My/Example/Repo/15\");", "originalCommit": "8d33d26c138d3132405d0abd4e703d061eb64b29", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQyMzI4Nw==", "url": "https://github.com/uyuni-project/uyuni/pull/2952#discussion_r535423287", "bodyText": "I used here the same regex we have for validating the channel names. The slashes will be replaced as non-valid characters in the reposync plugins (as for already created custom repository labels in the database).\nOn the other hand, we could also not accept slashes from the UI to be safer and prevent posible related issues with path maybe even in some other places from the code base where we use the \"repository label\" to build paths in the system.", "author": "meaksh", "createdAt": "2020-12-03T17:09:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQzNTQ5Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/2952#discussion_r535435496", "bodyText": "What I mean is: in Line 140 we have this test:\n    invalidRepoLabelInput(\"example/repo\");\n\nWhy is \"example/repo\" INVALID but \"My/Example/Repo/15\" is VALID ?\nIs it not because of the slash?", "author": "mcalmer", "createdAt": "2020-12-03T17:26:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODc0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTk2MzMzMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2952#discussion_r535963330", "bodyText": "Oh! That's correct.. there should be a problem with the logic of the invalidRepoLabelInput and validRepoLabelInput helpers. I'll fix that.\nWith the current implementation, the \"slashes\" are allowed.", "author": "meaksh", "createdAt": "2020-12-04T09:37:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODc0OA=="}], "type": "inlineReview"}, {"oid": "2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c", "url": "https://github.com/uyuni-project/uyuni/commit/2e7bd0a9f3d13404c874dcdfdb3579ba4b84249c", "message": "Exclude valid repo name from invalid tests", "committedDate": "2020-12-04T10:18:21Z", "type": "forcePushed"}, {"oid": "10765ef6be1dff679049778013102247abd977c6", "url": "https://github.com/uyuni-project/uyuni/commit/10765ef6be1dff679049778013102247abd977c6", "message": "Add validation for custom repository label", "committedDate": "2020-12-14T09:32:50Z", "type": "commit"}, {"oid": "da431cbba973a49134a5ed845a9cb9c4ed0aa8b0", "url": "https://github.com/uyuni-project/uyuni/commit/da431cbba973a49134a5ed845a9cb9c4ed0aa8b0", "message": "Add Java tests for validating custom reposity labels", "committedDate": "2020-12-14T09:32:53Z", "type": "commit"}, {"oid": "8969f8ed7b85f0db66f18d50c7b713816154ba3b", "url": "https://github.com/uyuni-project/uyuni/commit/8969f8ed7b85f0db66f18d50c7b713816154ba3b", "message": "Use channel label to calculate DEB repo cache path (bsc#1179410)\n\nThis also ensures that, in case of failing back to repo name (should not\nhappend), it would exclude non-valid characters from the repo name.", "committedDate": "2020-12-14T09:32:53Z", "type": "commit"}, {"oid": "6bf3a4dd20d05d27c7c5202e0b188bf6df868c20", "url": "https://github.com/uyuni-project/uyuni/commit/6bf3a4dd20d05d27c7c5202e0b188bf6df868c20", "message": "Update changelog for spacewalk-backend", "committedDate": "2020-12-14T09:33:10Z", "type": "commit"}, {"oid": "fa69c8d647aa2b285a13a7e418627ce647f0beb4", "url": "https://github.com/uyuni-project/uyuni/commit/fa69c8d647aa2b285a13a7e418627ce647f0beb4", "message": "Update changelog for spacewalk-java", "committedDate": "2020-12-14T09:33:26Z", "type": "commit"}, {"oid": "5725ee587a0f6c56bd1e0527afd5be5b97f67c97", "url": "https://github.com/uyuni-project/uyuni/commit/5725ee587a0f6c56bd1e0527afd5be5b97f67c97", "message": "Add fixes for checkstyle", "committedDate": "2020-12-14T09:33:27Z", "type": "commit"}, {"oid": "7d263390673560d7855ce9cb622c8e5ae9d1291c", "url": "https://github.com/uyuni-project/uyuni/commit/7d263390673560d7855ce9cb622c8e5ae9d1291c", "message": "Use sanitized repo label to build reposync repo cache path (bsc#1179410)", "committedDate": "2020-12-14T09:33:27Z", "type": "commit"}, {"oid": "c69badd5832ca289fbbb8297f21eccf8538aea4c", "url": "https://github.com/uyuni-project/uyuni/commit/c69badd5832ca289fbbb8297f21eccf8538aea4c", "message": "Update changelog for spacewalk-backend", "committedDate": "2020-12-14T09:33:44Z", "type": "commit"}, {"oid": "062eaaf5894a4706a9ac5ad09baedb3c29afb326", "url": "https://github.com/uyuni-project/uyuni/commit/062eaaf5894a4706a9ac5ad09baedb3c29afb326", "message": "Fix invalidRepoLabelInput to properly fail on invalid repo label", "committedDate": "2020-12-14T09:33:45Z", "type": "commit"}, {"oid": "84012d3879f4ca6a730aadeb17bf367e78113da2", "url": "https://github.com/uyuni-project/uyuni/commit/84012d3879f4ca6a730aadeb17bf367e78113da2", "message": "Exclude valid repo name from invalid tests", "committedDate": "2020-12-14T09:33:45Z", "type": "commit"}, {"oid": "84012d3879f4ca6a730aadeb17bf367e78113da2", "url": "https://github.com/uyuni-project/uyuni/commit/84012d3879f4ca6a730aadeb17bf367e78113da2", "message": "Exclude valid repo name from invalid tests", "committedDate": "2020-12-14T09:33:45Z", "type": "forcePushed"}]}