{"pr_number": 2589, "pr_title": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)", "pr_createdAt": "2020-09-10T13:29:57Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2589", "timeline": [{"oid": "0b868840cdd85bf5ecf8b057a46815c976fffaab", "url": "https://github.com/uyuni-project/uyuni/commit/0b868840cdd85bf5ecf8b057a46815c976fffaab", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-10T13:33:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MTk5Mg==", "url": "https://github.com/uyuni-project/uyuni/pull/2589#discussion_r486361992", "bodyText": "I think we might need to do some recursive lookup here, as the original can also be a clone \ud83d\ude04\n(You can test, that it fails using 2 environments in the CLM project we discussed).\nMaybe there is even some helper method somewhere in the code, I'll try to check that.", "author": "hustodemon", "createdAt": "2020-09-10T13:54:28Z", "path": "java/code/src/com/redhat/rhn/frontend/action/systems/SPMigrationAction.java", "diffHunk": "@@ -521,7 +521,10 @@ private String populateRequestFromAction(HttpServletRequest request, RequestCont\n         List<Long> channelIds = channels.stream().map(Channel::getId).collect(Collectors.toList());\n         List<EssentialChannelDto> childChannels = getChannelDTOs(ctx, baseChannel, channelIds);\n \n-        SUSEProduct baseProduct = SUSEProductFactory.lookupByChannelName(baseChannel.getName()).get(0).getRootProduct();\n+        // Get name of original base channel if channel is cloned\n+        String origBaseChannelName = (baseChannel.isCloned() ? baseChannel.getOriginal() : baseChannel).getName();", "originalCommit": "0b868840cdd85bf5ecf8b057a46815c976fffaab", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM3NzUwNg==", "url": "https://github.com/uyuni-project/uyuni/pull/2589#discussion_r486377506", "bodyText": "You can give the ChannelManager.getOriginalChannela shot!", "author": "hustodemon", "createdAt": "2020-09-10T14:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MTk5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg5NDE1Ng==", "url": "https://github.com/uyuni-project/uyuni/pull/2589#discussion_r486894156", "bodyText": "Indeed you were right. Channel.getOriginal only returns the direct predecessor.\nChannelManager.getOriginalChannel returns the original even in case of nested cloning.\nTYVM for pointing this out. This problem did not come to my mind.", "author": "parlt91", "createdAt": "2020-09-11T09:15:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjM2MTk5Mg=="}], "type": "inlineReview"}, {"oid": "af698ebee982e6adcb2f8a6a0e3002c9a6c49b46", "url": "https://github.com/uyuni-project/uyuni/commit/af698ebee982e6adcb2f8a6a0e3002c9a6c49b46", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-11T09:04:56Z", "type": "forcePushed"}, {"oid": "89c26cc1449dd9747d1d41e156d6f54e13e3914d", "url": "https://github.com/uyuni-project/uyuni/commit/89c26cc1449dd9747d1d41e156d6f54e13e3914d", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-11T09:20:12Z", "type": "forcePushed"}, {"oid": "8a2c2ef2c41041ed48b877546eb1b6cf2405e181", "url": "https://github.com/uyuni-project/uyuni/commit/8a2c2ef2c41041ed48b877546eb1b6cf2405e181", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-11T09:26:16Z", "type": "forcePushed"}, {"oid": "141d011b0ee6b7e99dc6bc3a0a7e070d5f502cf2", "url": "https://github.com/uyuni-project/uyuni/commit/141d011b0ee6b7e99dc6bc3a0a7e070d5f502cf2", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-21T08:02:26Z", "type": "forcePushed"}, {"oid": "ff405635444b4655bb515f992c03220182e160b2", "url": "https://github.com/uyuni-project/uyuni/commit/ff405635444b4655bb515f992c03220182e160b2", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-22T11:34:17Z", "type": "forcePushed"}, {"oid": "377926e6c2d68ddf763632ac5d98c7a88eb4053a", "url": "https://github.com/uyuni-project/uyuni/commit/377926e6c2d68ddf763632ac5d98c7a88eb4053a", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-22T17:35:28Z", "type": "commit"}, {"oid": "377926e6c2d68ddf763632ac5d98c7a88eb4053a", "url": "https://github.com/uyuni-project/uyuni/commit/377926e6c2d68ddf763632ac5d98c7a88eb4053a", "message": "Fix SPMigration after dry run if channel is cloned (bsc#1176307)\n\nWhen scheduling an sp migration after a dry run through\nEvents -> History -> Select successful dry run -> Click run migration\nan ISE was thrown if the channel is a cloned channel.\n\nSigned-off-by: Pascal Arlt <parlt@suse.com>", "committedDate": "2020-09-22T17:35:28Z", "type": "forcePushed"}]}