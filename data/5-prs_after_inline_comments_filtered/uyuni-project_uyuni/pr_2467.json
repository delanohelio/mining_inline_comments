{"pr_number": 2467, "pr_title": "Allow pushing Errata to vendor channels when configured", "pr_createdAt": "2020-07-31T09:21:16Z", "pr_url": "https://github.com/uyuni-project/uyuni/pull/2467", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4NjgxMA==", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471786810", "bodyText": "Comment does not seem to agree with code", "author": "moio", "createdAt": "2020-08-17T21:32:13Z", "path": "java/code/src/com/redhat/rhn/common/conf/ConfigDefaults.java", "diffHunk": "@@ -324,6 +324,11 @@\n      */\n     public static final String AUTOMATIC_SYSTEM_LOCK_CLUSTER_NODES_ENABLED = \"java.automatic_system_lock_cluster_nodes\";\n \n+    /**\n+     * Indicates the salt-api host to connect to (host", "originalCommit": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4OTA2OA==", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471789068", "bodyText": "Maybe you can inline this 2-parameter variant, since it's only called once.", "author": "moio", "createdAt": "2020-08-17T21:37:34Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/errata/ErrataHandler.java", "diffHunk": "@@ -1384,19 +1402,34 @@ public Errata publishAsOriginal(User loggedInUser, String advisory,\n      * @return a List of channel objects\n      */\n     private List<Channel> verifyChannelList(List<String> channelsLabels, User user) {\n+        return verifyChannelList(channelsLabels, user, Collections.emptyList());", "originalCommit": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc4OTIxOA==", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471789218", "bodyText": "Maybe add Javadoc for vendorChannelOverride", "author": "moio", "createdAt": "2020-08-17T21:37:54Z", "path": "java/code/src/com/redhat/rhn/frontend/xmlrpc/errata/ErrataHandler.java", "diffHunk": "@@ -1384,19 +1402,34 @@ public Errata publishAsOriginal(User loggedInUser, String advisory,\n      * @return a List of channel objects\n      */\n     private List<Channel> verifyChannelList(List<String> channelsLabels, User user) {\n+        return verifyChannelList(channelsLabels, user, Collections.emptyList());\n+    }\n+\n+    /**\n+     * Verify a list of channels labels, and populate their corresponding\n+     *      Channel objects into a List.  This is primarily used before publishing\n+     *      to verify all channels are valid before starting the errata creation\n+     * @param channelsLabels the List of channel labels to verify\n+     * @return a List of channel objects", "originalCommit": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc5MTIyNg==", "url": "https://github.com/uyuni-project/uyuni/pull/2467#discussion_r471791226", "bodyText": "I would suggest to add a bit more descriptive string here, such as \"Package IDs ... added to vendor channel...\" (just like you did above for the errata editing).", "author": "moio", "createdAt": "2020-08-17T21:42:37Z", "path": "java/code/src/com/redhat/rhn/manager/channel/ChannelManager.java", "diffHunk": "@@ -2421,16 +2421,27 @@ public static void disassociateChannelEntries(Channel c) {\n     public static void addPackages(Channel chan, List<Long> packageIds, User user) {\n \n         if (!UserManager.verifyChannelAdmin(user, chan)) {\n-            StringBuilder msg = new StringBuilder(\"User: \");\n-            msg.append(user.getLogin());\n-            msg.append(\" does not have channel admin access to channel: \");\n-            msg.append(chan.getLabel());\n-\n-            LocalizationService ls = LocalizationService.getInstance();\n-            PermissionException pex = new PermissionException(msg.toString());\n-            pex.setLocalizedTitle(ls.getMessage(\"permission.jsp.title.channel\"));\n-            pex.setLocalizedSummary(ls.getMessage(\"permission.jsp.summary.channel\"));\n-            throw pex;\n+            List<String> allowedList = Config.get().getList(ConfigDefaults.ALLOW_ADDING_PATCHES_VIA_API);\n+            if (chan.isVendorChannel() && allowedList.contains(chan.getLabel())) {\n+                log.warn(\"Channel: \" + chan.getLabel() +", "originalCommit": "c3e4f2277afb265db4f7772f85b5a9a21049ccfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bc619411bb152f7d1cb9bce5b6f0eb120d214618", "url": "https://github.com/uyuni-project/uyuni/commit/bc619411bb152f7d1cb9bce5b6f0eb120d214618", "message": "add changelog", "committedDate": "2020-08-18T12:14:32Z", "type": "forcePushed"}, {"oid": "94a6756dd011b8eefd52fd1d984cc77f4a30830e", "url": "https://github.com/uyuni-project/uyuni/commit/94a6756dd011b8eefd52fd1d984cc77f4a30830e", "message": "rename isRhelChannel to isVendorChannel to be in line with current terminology", "committedDate": "2020-08-21T08:15:54Z", "type": "commit"}, {"oid": "9936eb955f9199019c4a6f0aabd11550e4ec65cc", "url": "https://github.com/uyuni-project/uyuni/commit/9936eb955f9199019c4a6f0aabd11550e4ec65cc", "message": "add ALLOW_ADDING_PATCHES_VIA_API config parameter", "committedDate": "2020-08-21T08:15:57Z", "type": "commit"}, {"oid": "48289ac0f1b38105761dbe1f964fe525e966aa65", "url": "https://github.com/uyuni-project/uyuni/commit/48289ac0f1b38105761dbe1f964fe525e966aa65", "message": "adapt code to use ALLOW_ADDING_PATCH_VIA_API config parameter", "committedDate": "2020-08-21T08:15:57Z", "type": "commit"}, {"oid": "f21b4e3791c0c12cedf3e4ff05426824bf73b518", "url": "https://github.com/uyuni-project/uyuni/commit/f21b4e3791c0c12cedf3e4ff05426824bf73b518", "message": "add changelog", "committedDate": "2020-08-21T08:16:23Z", "type": "commit"}, {"oid": "d3d2b40779eca4525930fc53307e6bc0f6178abc", "url": "https://github.com/uyuni-project/uyuni/commit/d3d2b40779eca4525930fc53307e6bc0f6178abc", "message": "only allow sat admin users", "committedDate": "2020-08-21T08:16:25Z", "type": "commit"}, {"oid": "d3d2b40779eca4525930fc53307e6bc0f6178abc", "url": "https://github.com/uyuni-project/uyuni/commit/d3d2b40779eca4525930fc53307e6bc0f6178abc", "message": "only allow sat admin users", "committedDate": "2020-08-21T08:16:25Z", "type": "forcePushed"}]}