{"pr_number": 13965, "pr_title": "[FLINK-20018] Allow escaping in 'pipeline.cached-files' and 'pipeline.default-kryo-serializers'", "pr_createdAt": "2020-11-06T12:37:42Z", "pr_url": "https://github.com/apache/flink/pull/13965", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU0ODI5Mw==", "url": "https://github.com/apache/flink/pull/13965#discussion_r520548293", "bodyText": "Could be simplified to use getExecutionEnvironment(Configuration)", "author": "aljoscha", "createdAt": "2020-11-10T13:08:39Z", "path": "flink-streaming-java/src/test/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironmentComplexConfigurationTest.java", "diffHunk": "@@ -66,20 +71,49 @@ public void testLoadingStateBackendFromConfiguration() {\n \t@Test\n \tpublic void testLoadingCachedFilesFromConfiguration() {\n \t\tStreamExecutionEnvironment envFromConfiguration = StreamExecutionEnvironment.getExecutionEnvironment();\n-\t\tenvFromConfiguration.registerCachedFile(\"/tmp3\", \"file3\", true);\n+\t\tenvFromConfiguration.registerCachedFile(\"/tmp4\", \"file4\", true);\n \n \t\tConfiguration configuration = new Configuration();\n-\t\tconfiguration.setString(\"pipeline.cached-files\", \"name:file1,path:/tmp1,executable:true;name:file2,path:/tmp2\");\n+\t\tconfiguration.setString(\n+\t\t\t\"pipeline.cached-files\",\n+\t\t\t\"name:file1,path:/tmp1,executable:true;\"\n+\t\t\t\t+ \"name:file2,path:/tmp2;\"\n+\t\t\t\t+ \"name:file3,path:'oss://bucket/file1'\");\n \n \t\t// mutate config according to configuration\n \t\tenvFromConfiguration.configure(configuration, Thread.currentThread().getContextClassLoader());\n \n \t\tassertThat(envFromConfiguration.getCachedFiles(), equalTo(Arrays.asList(\n \t\t\tTuple2.of(\"file1\", new DistributedCache.DistributedCacheEntry(\"/tmp1\", true)),\n-\t\t\tTuple2.of(\"file2\", new DistributedCache.DistributedCacheEntry(\"/tmp2\", false))\n+\t\t\tTuple2.of(\"file2\", new DistributedCache.DistributedCacheEntry(\"/tmp2\", false)),\n+\t\t\tTuple2.of(\n+\t\t\t\t\"file3\",\n+\t\t\t\tnew DistributedCache.DistributedCacheEntry(\"oss://bucket/file1\", false))\n \t\t)));\n \t}\n \n+\t@Test\n+\tpublic void testLoadingKryoSerializersFromConfiguration() {\n+\t\tStreamExecutionEnvironment envFromConfiguration = StreamExecutionEnvironment.getExecutionEnvironment();\n+\n+\t\tConfiguration configuration = new Configuration();\n+\t\tconfiguration.setString(\n+\t\t\t\"pipeline.default-kryo-serializers\",\n+\t\t\t\"class:'org.apache.flink.streaming.api.environment.StreamExecutionEnvironmentComplexConfigurationTest$CustomPojo'\"\n+\t\t\t\t+ \",serializer:'org.apache.flink.streaming.api.environment.StreamExecutionEnvironmentComplexConfigurationTest$CustomPojoSerializer'\");\n+\n+\t\t// mutate config according to configuration\n+\t\tenvFromConfiguration.configure(\n+\t\t\tconfiguration,\n+\t\t\tThread.currentThread().getContextClassLoader());", "originalCommit": "02c79cac0047f2400647d7a45b343ed8e18d3103", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDU0OTk5MA==", "url": "https://github.com/apache/flink/pull/13965#discussion_r520549990", "bodyText": "I'm doing this just to nitpick, because I think style doesn't matter unless it's enforced:\nI think out style guide says to use two indentation levels for parameters. The .editorconfig file was recently changed to break this so I suggest to use a good .editorconfig file and ignore the one in git using git update-index --skip-worktree .editorconfig.", "author": "aljoscha", "createdAt": "2020-11-10T13:11:16Z", "path": "flink-streaming-java/src/test/java/org/apache/flink/streaming/api/environment/StreamExecutionEnvironmentComplexConfigurationTest.java", "diffHunk": "@@ -156,4 +190,30 @@ public void onJobExecuted(@Nullable JobExecutionResult jobExecutionResult, @Null\n \n \t\t}\n \t}\n+\n+\t/**\n+\t * A dummy class to specify a Kryo serializer for.\n+\t */\n+\tpublic static class CustomPojo {\n+\t}\n+\n+\t/**\n+\t * A dummy Kryo serializer which can be registered.\n+\t */\n+\tpublic static class CustomPojoSerializer extends Serializer<CustomPojo> {\n+\t\t@Override\n+\t\tpublic void write(\n+\t\t\tKryo kryo,", "originalCommit": "02c79cac0047f2400647d7a45b343ed8e18d3103", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4232b761b4f8935a8c3bda86279f860f1d11f1a3", "url": "https://github.com/apache/flink/commit/4232b761b4f8935a8c3bda86279f860f1d11f1a3", "message": "[FLINK-20018] Allow escaping in 'pipeline.cached-files' and 'pipeline.default-kryo-serializers'\n\nThis commit enables escaping in options that expect a map of\nstring-string entries. It lets users pass options such as e.g.\n\npipeline.cached-files=name:file1,path:'oss://bucket/file1'", "committedDate": "2020-11-10T15:30:39Z", "type": "commit"}, {"oid": "4232b761b4f8935a8c3bda86279f860f1d11f1a3", "url": "https://github.com/apache/flink/commit/4232b761b4f8935a8c3bda86279f860f1d11f1a3", "message": "[FLINK-20018] Allow escaping in 'pipeline.cached-files' and 'pipeline.default-kryo-serializers'\n\nThis commit enables escaping in options that expect a map of\nstring-string entries. It lets users pass options such as e.g.\n\npipeline.cached-files=name:file1,path:'oss://bucket/file1'", "committedDate": "2020-11-10T15:30:39Z", "type": "forcePushed"}]}