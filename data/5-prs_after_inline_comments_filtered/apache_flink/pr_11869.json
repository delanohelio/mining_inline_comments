{"pr_number": 11869, "pr_title": "[FLINK-17111][table] Support SHOW VIEWS in Flink SQL", "pr_createdAt": "2020-04-23T04:44:57Z", "pr_url": "https://github.com/apache/flink/pull/11869", "timeline": [{"oid": "546d367f2e3d7c0fdccc1e48e6453429f1fb44bd", "url": "https://github.com/apache/flink/commit/546d367f2e3d7c0fdccc1e48e6453429f1fb44bd", "message": "[FLINK-17111][table] Add show views syntax support in parser", "committedDate": "2020-04-23T03:07:06Z", "type": "commit"}, {"oid": "fe6f4d971e7b0121f2c4a60898ffed7c5bde2551", "url": "https://github.com/apache/flink/commit/fe6f4d971e7b0121f2c4a60898ffed7c5bde2551", "message": "[FLINK-17111][table] Add listViews interface to TableEnvironment", "committedDate": "2020-04-23T03:07:06Z", "type": "commit"}, {"oid": "39fb3f948d2364e8117c35b593ba129ad8f7ce92", "url": "https://github.com/apache/flink/commit/39fb3f948d2364e8117c35b593ba129ad8f7ce92", "message": "[hotfix][table-planner-legacy] Support create/drop view in batch mode", "committedDate": "2020-04-23T04:28:35Z", "type": "commit"}, {"oid": "05288fe00da8854b0c6f2f16d1006d8e2bc11b51", "url": "https://github.com/apache/flink/commit/05288fe00da8854b0c6f2f16d1006d8e2bc11b51", "message": "[FLINK-17111][table-planner-blink] Support SHOW VIEWS in blink planner", "committedDate": "2020-04-23T04:28:46Z", "type": "commit"}, {"oid": "28223e277ee06677a7c973300e3e1c85902874fd", "url": "https://github.com/apache/flink/commit/28223e277ee06677a7c973300e3e1c85902874fd", "message": "[FLINK-17111][table-planner] Support SHOW VIEWS in legacy planner", "committedDate": "2020-04-23T04:32:16Z", "type": "commit"}, {"oid": "425e26536e512e5fec88852a462fdf88e6e1a562", "url": "https://github.com/apache/flink/commit/425e26536e512e5fec88852a462fdf88e6e1a562", "message": "fixup: fix python ut", "committedDate": "2020-04-23T07:22:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDMzOTU1Nw==", "url": "https://github.com/apache/flink/pull/11869#discussion_r414339557", "bodyText": "add @see #listTemporaryViews()", "author": "godfreyhe", "createdAt": "2020-04-24T06:56:02Z", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/api/TableEnvironment.java", "diffHunk": "@@ -756,6 +756,13 @@ default Table fromValues(DataType rowType, Object... values) {\n \t */\n \tString[] listTables();\n \n+\t/**\n+\t * Gets the names of all views available in the current namespace (the current database of the current catalog).\n+\t * It returns both temporary and permanent views.\n+\t * @return A list of the names of all registered views in the current database of the current catalog.\n+\t */", "originalCommit": "425e26536e512e5fec88852a462fdf88e6e1a562", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM0MzM4MQ==", "url": "https://github.com/apache/flink/pull/11869#discussion_r414343381", "bodyText": "add a method listTemporaryViews(String catalogName, String databaseName), listTemporaryViews() method and here can use this method", "author": "godfreyhe", "createdAt": "2020-04-24T07:03:46Z", "path": "flink-table/flink-table-api-java/src/main/java/org/apache/flink/table/catalog/CatalogManager.java", "diffHunk": "@@ -415,6 +415,37 @@ public CatalogBaseTable getTable() {\n \t\t\t});\n \t}\n \n+\t/**\n+\t * Returns an array of names of all views(both temporary and permanent) registered in\n+\t * the namespace of the current catalog and database.\n+\t *\n+\t * @return names of all registered views\n+\t */\n+\tpublic Set<String> listViews() {\n+\t\treturn listViews(getCurrentCatalog(), getCurrentDatabase());\n+\t}\n+\n+\t/**\n+\t * Returns an array of names of all views(both temporary and permanent) registered in\n+\t * the namespace of the current catalog and database.\n+\t *\n+\t * @return names of registered views\n+\t */\n+\tpublic Set<String> listViews(String catalogName, String databaseName) {\n+\t\tCatalog currentCatalog = catalogs.get(getCurrentCatalog());\n+\n+\t\ttry {\n+\t\t\treturn Stream.concat(\n+\t\t\t\tcurrentCatalog.listViews(getCurrentDatabase()).stream(),\n+\t\t\t\tlistTemporaryTablesInternal(catalogName, databaseName)\n+\t\t\t\t\t.filter(e -> e.getValue() instanceof CatalogView)\n+\t\t\t\t\t.map(e -> e.getKey().getObjectName())\n+\t\t\t).collect(Collectors.toSet());", "originalCommit": "425e26536e512e5fec88852a462fdf88e6e1a562", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQwODE2Mg==", "url": "https://github.com/apache/flink/pull/11869#discussion_r414408162", "bodyText": "IMO the private listTemporaryTablesInternal is enough. or we should add listTemporaryTables(String catalogName, String databaseName) for listTemporaryTables(). That's  probably a bit superfluous.", "author": "docete", "createdAt": "2020-04-24T08:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM0MzM4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDUwMDE0OA==", "url": "https://github.com/apache/flink/pull/11869#discussion_r414500148", "bodyText": "listTemporaryTablesInternal already exists", "author": "godfreyhe", "createdAt": "2020-04-24T11:23:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDM0MzM4MQ=="}], "type": "inlineReview"}, {"oid": "a602abb4a2d51262c393a373aa13cb4875b4a7f5", "url": "https://github.com/apache/flink/commit/a602abb4a2d51262c393a373aa13cb4875b4a7f5", "message": "fixup: address godfrey's comments", "committedDate": "2020-04-24T09:15:50Z", "type": "commit"}, {"oid": "7c2c52ba9d217d52576adf6a4bcd3c57ff211ebf", "url": "https://github.com/apache/flink/commit/7c2c52ba9d217d52576adf6a4bcd3c57ff211ebf", "message": "fixup: clarify python docs", "committedDate": "2020-04-26T02:56:03Z", "type": "commit"}, {"oid": "5f791f8202242f80022244ea56428a2bd69d78f7", "url": "https://github.com/apache/flink/commit/5f791f8202242f80022244ea56428a2bd69d78f7", "message": "fixup: wrap an util listTemporaryViewsInternal function", "committedDate": "2020-04-26T03:05:42Z", "type": "commit"}]}