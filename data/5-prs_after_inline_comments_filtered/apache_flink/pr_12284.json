{"pr_number": 12284, "pr_title": "[FLINK-17689][kafka][table] Add integration tests for changelog sourc\u2026", "pr_createdAt": "2020-05-21T13:18:38Z", "pr_url": "https://github.com/apache/flink/pull/12284", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyNTkzMQ==", "url": "https://github.com/apache/flink/pull/12284#discussion_r429925931", "bodyText": "Should we move the check to the constructor ?", "author": "danny0405", "createdAt": "2020-05-25T13:08:43Z", "path": "flink-table/flink-table-planner-blink/src/test/java/org/apache/flink/table/planner/factories/TestValuesTableFactory.java", "diffHunk": "@@ -633,8 +648,11 @@ public SinkRuntimeProvider getSinkRuntimeProvider(Context context) {\n \t\t\t\t\tsinkFunction = new KeyedUpsertingSinkFunction(\n \t\t\t\t\t\ttableName,\n \t\t\t\t\t\tconverter,\n-\t\t\t\t\t\tkeyIndices);\n+\t\t\t\t\t\tkeyIndices,\n+\t\t\t\t\t\texpectedNum);\n \t\t\t\t} else {\n+\t\t\t\t\tcheckArgument(expectedNum == -1,\n+\t\t\t\t\t\t\"Retracting Sink doesn't support '\" + SINK_EXPECTED_MESSAGES_NUM.key() + \"' yet.\");", "originalCommit": "760f994e14c290dd4c31b67e15751862d6ee520f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTk5NjE5NQ==", "url": "https://github.com/apache/flink/pull/12284#discussion_r429996195", "bodyText": "I think there is not much difference. It's more easier to check the expectedNum in the getSinkRuntimeProvider, because we have to check runtimeSink and primaryKey.", "author": "wuchong", "createdAt": "2020-05-25T15:43:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyNTkzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkyNjQ3Mg==", "url": "https://github.com/apache/flink/pull/12284#discussion_r429926472", "bodyText": ">= or = ?", "author": "danny0405", "createdAt": "2020-05-25T13:09:52Z", "path": "flink-table/flink-table-planner-blink/src/test/java/org/apache/flink/table/planner/factories/TestValuesRuntimeFunctions.java", "diffHunk": "@@ -247,6 +265,12 @@ public void invoke(RowData value, Context context) throws Exception {\n \t\t\t\t\t\t\"This is probably an incorrectly implemented test.\");\n \t\t\t\t}\n \t\t\t}\n+\t\t\treceivedNum++;\n+\t\t\tif (expectedSize != -1 && receivedNum >= expectedSize) {\n+\t\t\t\t// some sources are infinite (e.g. kafka),", "originalCommit": "760f994e14c290dd4c31b67e15751862d6ee520f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d72be5f884f7f28247c8144d7b268240a2e4398", "url": "https://github.com/apache/flink/commit/4d72be5f884f7f28247c8144d7b268240a2e4398", "message": "[FLINK-17689][kafka][table] Add integration tests for changelog source and formats\n\nThis closes #12284", "committedDate": "2020-05-28T02:26:44Z", "type": "commit"}, {"oid": "4d72be5f884f7f28247c8144d7b268240a2e4398", "url": "https://github.com/apache/flink/commit/4d72be5f884f7f28247c8144d7b268240a2e4398", "message": "[FLINK-17689][kafka][table] Add integration tests for changelog source and formats\n\nThis closes #12284", "committedDate": "2020-05-28T02:26:44Z", "type": "forcePushed"}]}