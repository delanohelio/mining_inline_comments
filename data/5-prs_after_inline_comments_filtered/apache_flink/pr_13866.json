{"pr_number": 13866, "pr_title": "[FLINK-19907][network] Recover channel state before initializing operators chain", "pr_createdAt": "2020-10-31T17:08:38Z", "pr_url": "https://github.com/apache/flink/pull/13866", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzExMA==", "url": "https://github.com/apache/flink/pull/13866#discussion_r515817110", "bodyText": "Good catch. I was wondering if there is any downside to putting data into buffers before initializing state. Could it be that buffers are processed before state is initialized?", "author": "AHeise", "createdAt": "2020-11-02T08:48:19Z", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java", "diffHunk": "@@ -502,9 +502,9 @@ protected void beforeInvoke() throws Exception {\n \t\t\t// both the following operations are protected by the lock\n \t\t\t// so that we avoid race conditions in the case that initializeState()\n \t\t\t// registers a timer, that fires before the open() is called.\n-\t\t\toperatorChain.initializeStateAndOpenOperators(createStreamTaskStateInitializer());", "originalCommit": "cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMjA1MA==", "url": "https://github.com/apache/flink/pull/13866#discussion_r515832050", "bodyText": "I don't think there are any issues with that, operators are kind of level above on ResultPartitions (and therefore should be initialized later).", "author": "rkhachatryan", "createdAt": "2020-11-02T09:15:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzExMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzI4OQ==", "url": "https://github.com/apache/flink/pull/13866#discussion_r515817289", "bodyText": "Could you please fix commit msg and PR title (\"before\")?", "author": "AHeise", "createdAt": "2020-11-02T08:48:38Z", "path": "flink-streaming-java/src/main/java/org/apache/flink/streaming/runtime/tasks/StreamTask.java", "diffHunk": "@@ -502,9 +502,9 @@ protected void beforeInvoke() throws Exception {\n \t\t\t// both the following operations are protected by the lock", "originalCommit": "cd18c31dd83d9cbaa5601f2fdc6f94ebc76627f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgzMDMyNg==", "url": "https://github.com/apache/flink/pull/13866#discussion_r515830326", "bodyText": "Done)", "author": "rkhachatryan", "createdAt": "2020-11-02T09:12:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzI4OQ=="}], "type": "inlineReview"}, {"oid": "0abd26d7b4279b3855f976f7c0152f62ecb1757c", "url": "https://github.com/apache/flink/commit/0abd26d7b4279b3855f976f7c0152f62ecb1757c", "message": "[FLINK-19907][network] Recover channel state before initializing operators chain\n\nOtherwise, operators in chain can emit watermarks or other data before\nthe old data is being sent to the downstream.", "committedDate": "2020-11-02T09:09:47Z", "type": "commit"}, {"oid": "0abd26d7b4279b3855f976f7c0152f62ecb1757c", "url": "https://github.com/apache/flink/commit/0abd26d7b4279b3855f976f7c0152f62ecb1757c", "message": "[FLINK-19907][network] Recover channel state before initializing operators chain\n\nOtherwise, operators in chain can emit watermarks or other data before\nthe old data is being sent to the downstream.", "committedDate": "2020-11-02T09:09:47Z", "type": "forcePushed"}]}