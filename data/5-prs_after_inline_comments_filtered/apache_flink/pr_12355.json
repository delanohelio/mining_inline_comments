{"pr_number": 12355, "pr_title": "[FLINK-17893] [sql-client] SQL CLI should print the root cause if the statement is invalid", "pr_createdAt": "2020-05-27T09:01:53Z", "pr_url": "https://github.com/apache/flink/pull/12355", "timeline": [{"oid": "578b299f37b20eab2cd6ce64160cbbfc3ba10479", "url": "https://github.com/apache/flink/commit/578b299f37b20eab2cd6ce64160cbbfc3ba10479", "message": "[FLINK-17893] [sql-client] SQL CLI should print the root cause if the statement is invalid", "committedDate": "2020-05-27T08:51:04Z", "type": "forcePushed"}, {"oid": "18758d007d909ad3427c384140bf36a71e06ea1b", "url": "https://github.com/apache/flink/commit/18758d007d909ad3427c384140bf36a71e06ea1b", "message": "fix checkstyle error", "committedDate": "2020-06-02T07:56:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQxNTMwNA==", "url": "https://github.com/apache/flink/pull/12355#discussion_r434415304", "bodyText": "We may never run into this code branch now ~", "author": "danny0405", "createdAt": "2020-06-03T08:58:59Z", "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/cli/CliClient.java", "diffHunk": "@@ -253,7 +253,13 @@ public boolean submitUpdate(String statement) {\n \t// --------------------------------------------------------------------------------------------\n \n \tprivate Optional<SqlCommandCall> parseCommand(String line) {\n-\t\tfinal Optional<SqlCommandCall> parsedLine = SqlCommandParser.parse(executor.getSqlParser(sessionId), line);\n+\t\tfinal Optional<SqlCommandCall> parsedLine;\n+\t\ttry {\n+\t\t\tparsedLine = SqlCommandParser.parse(executor.getSqlParser(sessionId), line);\n+\t\t} catch (SqlExecutionException e) {\n+\t\t\tprintExecutionException(e);\n+\t\t\treturn Optional.empty();\n+\t\t}\n \t\tif (!parsedLine.isPresent()) {\n \t\t\tprintError(CliStrings.MESSAGE_UNKNOWN_SQL);", "originalCommit": "18758d007d909ad3427c384140bf36a71e06ea1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQyNDM0MQ==", "url": "https://github.com/apache/flink/pull/12355#discussion_r434424341", "bodyText": "I think we should keep this. because when TableEnvironment supports new operation but forgets to update SqlCommandParser, we should print error here or throw exception in SqlCommandParser", "author": "godfreyhe", "createdAt": "2020-06-03T09:13:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQxNTMwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTA4NTI1MQ==", "url": "https://github.com/apache/flink/pull/12355#discussion_r435085251", "bodyText": "I think we should keep this. because when TableEnvironment supports new operation but forgets to update SqlCommandParser\n\nI think we should never do this, either to refactor the code to keep SQL_CLI synced with table environment or keep the logic clean.", "author": "danny0405", "createdAt": "2020-06-04T08:34:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQxNTMwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDQxNTc3Mg==", "url": "https://github.com/apache/flink/pull/12355#discussion_r434415772", "bodyText": "Add some comment to explain why to match the SELECT and INSERT keyword explicitly.", "author": "danny0405", "createdAt": "2020-06-03T08:59:43Z", "path": "flink-table/flink-sql-client/src/main/java/org/apache/flink/table/client/cli/SqlCommandParser.java", "diffHunk": "@@ -253,8 +247,10 @@ private SqlCommandParser() {\n \t\t// supports both `explain xx` and `explain plan for xx` now\n \t\t// TODO should keep `explain xx` ?\n \t\tEXPLAIN(\n-\t\t\t\"EXPLAIN\\\\s+(.*)\",\n-\t\t\tSINGLE_OPERAND),\n+\t\t\t\"EXPLAIN\\\\s+(SELECT|INSERT)\\\\s+(.*)\",\n+\t\t\t(operands) -> {\n+\t\t\t\treturn Optional.of(new String[] { operands[0], operands[1] });", "originalCommit": "18758d007d909ad3427c384140bf36a71e06ea1b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "35be5d6088100c8e99655061e13161b7de9b5173", "url": "https://github.com/apache/flink/commit/35be5d6088100c8e99655061e13161b7de9b5173", "message": "address Danny's comments", "committedDate": "2020-06-05T02:22:44Z", "type": "forcePushed"}, {"oid": "d0acf33548d2b0a38e6c757666e20ad988de73a2", "url": "https://github.com/apache/flink/commit/d0acf33548d2b0a38e6c757666e20ad988de73a2", "message": "address Danny's comments", "committedDate": "2020-06-05T11:09:27Z", "type": "forcePushed"}, {"oid": "c7b337a6e2e22337580a7993ad8ced8dcf8adca1", "url": "https://github.com/apache/flink/commit/c7b337a6e2e22337580a7993ad8ced8dcf8adca1", "message": "[FLINK-17893] [sql-client] SQL CLI should print the root cause if the statement is invalid", "committedDate": "2020-06-07T13:12:16Z", "type": "commit"}, {"oid": "bab05936db40722989c25315f90a1016e10a246e", "url": "https://github.com/apache/flink/commit/bab05936db40722989c25315f90a1016e10a246e", "message": "fix checkstyle error", "committedDate": "2020-06-07T13:12:17Z", "type": "commit"}, {"oid": "1d27a26142df7cb72ab663798be9fc7387125321", "url": "https://github.com/apache/flink/commit/1d27a26142df7cb72ab663798be9fc7387125321", "message": "address Danny's comments", "committedDate": "2020-06-07T13:12:17Z", "type": "commit"}, {"oid": "1d27a26142df7cb72ab663798be9fc7387125321", "url": "https://github.com/apache/flink/commit/1d27a26142df7cb72ab663798be9fc7387125321", "message": "address Danny's comments", "committedDate": "2020-06-07T13:12:17Z", "type": "forcePushed"}]}