{"pr_number": 13991, "pr_title": "[FLINK-19983][network] Remove wrong state checking in SortMergeSubpartitionReader", "pr_createdAt": "2020-11-09T03:30:44Z", "pr_url": "https://github.com/apache/flink/pull/13991", "timeline": [{"oid": "c44538769371ce3114274f3322168a9fe18e4875", "url": "https://github.com/apache/flink/commit/c44538769371ce3114274f3322168a9fe18e4875", "message": "[FLINK-19983][network] Release all buffers when releasing the SortMergeSubpartitionReader\n\nBy releasing all buffers read, the SortMergeSubpartitionReader is marked as unavailable.", "committedDate": "2020-11-16T07:19:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2MTAwNA==", "url": "https://github.com/apache/flink/pull/13991#discussion_r524261004", "bodyText": "Could you please also add the component name to the commit message? Also This closes #13991. should probably appear in the last commit.", "author": "AHeise", "createdAt": "2020-11-16T13:19:16Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SortMergeResultPartition.java", "diffHunk": "@@ -317,7 +317,6 @@ public ResultSubpartitionView createSubpartitionView(\n \t\t\t\tavailabilityListener,\n \t\t\t\tresultFile);\n \t\t\treaders.add(reader);\n-\t\t\tavailabilityListener.notifyDataAvailable();", "originalCommit": "f92e8080fd8d3d2d5a13b2c7d30d288460ce9adb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3NTAzNQ==", "url": "https://github.com/apache/flink/pull/13991#discussion_r524275035", "bodyText": "Fixed.", "author": "wsry", "createdAt": "2020-11-16T13:42:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2MTAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NTM3OQ==", "url": "https://github.com/apache/flink/pull/13991#discussion_r524265379", "bodyText": "Do we need to return the segments to the MemoryManager? I guess not since they are unpooled.", "author": "AHeise", "createdAt": "2020-11-16T13:26:25Z", "path": "flink-runtime/src/main/java/org/apache/flink/runtime/io/network/partition/SortMergeSubpartitionReader.java", "diffHunk": "@@ -138,7 +138,9 @@ public void notifyDataAvailable() {\n \n \t@Override\n \tpublic void recycle(MemorySegment segment) {\n-\t\treadBuffers.add(segment);\n+\t\tif (!isReleased) {\n+\t\t\treadBuffers.add(segment);\n+\t\t}", "originalCommit": "c44538769371ce3114274f3322168a9fe18e4875", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI3NjEwNw==", "url": "https://github.com/apache/flink/pull/13991#discussion_r524276107", "bodyText": "You are right, the buffers are unpooled so we do not need to return the segments to the MemoryManager.", "author": "wsry", "createdAt": "2020-11-16T13:43:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDI2NTM3OQ=="}], "type": "inlineReview"}, {"oid": "87d7ab21344940ca46cd51e67da4ada2b45d2745", "url": "https://github.com/apache/flink/commit/87d7ab21344940ca46cd51e67da4ada2b45d2745", "message": "[hotfix][network] Remove redundant data availability notification in SortMergeResultPartition\n\nRemove redundant data availability notification in SortMergeResultPartition for FLINK-19391 has moved the notification to the requester.\n\nThis closes #13991.", "committedDate": "2020-11-16T13:38:53Z", "type": "commit"}, {"oid": "d1684f0815985f317db01f718d00f591d1ccc43d", "url": "https://github.com/apache/flink/commit/d1684f0815985f317db01f718d00f591d1ccc43d", "message": "[hotfix][network] Call releaseAllResources() method directly in close() method of PartitionRequestQueue\n\nOne reason is to reduce code duplication and the other reason is that the availableReaders is also need to be cleared.\n\nThis closes #13991.", "committedDate": "2020-11-16T13:39:31Z", "type": "commit"}, {"oid": "d063a4ac1afd82c3f78e38fbc073f008a3389ee1", "url": "https://github.com/apache/flink/commit/d063a4ac1afd82c3f78e38fbc073f008a3389ee1", "message": "[FLINK-19983][network] Release all buffers when releasing the SortMergeSubpartitionReader\n\nBy releasing all buffers read, the SortMergeSubpartitionReader is marked as unavailable.\n\nThis closes #13991.", "committedDate": "2020-11-16T13:40:08Z", "type": "commit"}, {"oid": "d063a4ac1afd82c3f78e38fbc073f008a3389ee1", "url": "https://github.com/apache/flink/commit/d063a4ac1afd82c3f78e38fbc073f008a3389ee1", "message": "[FLINK-19983][network] Release all buffers when releasing the SortMergeSubpartitionReader\n\nBy releasing all buffers read, the SortMergeSubpartitionReader is marked as unavailable.\n\nThis closes #13991.", "committedDate": "2020-11-16T13:40:08Z", "type": "forcePushed"}]}