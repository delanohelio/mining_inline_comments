{"pr_number": 11080, "pr_title": "[FLINK-15988][json] Make JsonRowSerializationSchema's constructor private", "pr_createdAt": "2020-02-13T08:05:40Z", "pr_url": "https://github.com/apache/flink/pull/11080", "timeline": [{"oid": "d735eb25314fd74ca0520e0ee9b9839ef585b6e7", "url": "https://github.com/apache/flink/commit/d735eb25314fd74ca0520e0ee9b9839ef585b6e7", "message": "[FLINK-15988][json] Make JsonRowSerializationSchema's constructor private", "committedDate": "2020-02-13T06:58:56Z", "type": "commit"}, {"oid": "8bed2dbf577c649ad3e6b411730763c90a898a5d", "url": "https://github.com/apache/flink/commit/8bed2dbf577c649ad3e6b411730763c90a898a5d", "message": "Add error message, and avoid using Builder constructor directly", "committedDate": "2020-02-13T07:52:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4NTM4Ng==", "url": "https://github.com/apache/flink/pull/11080#discussion_r380085386", "bodyText": "Put the @deprecated comment after @param.", "author": "wuchong", "createdAt": "2020-02-17T10:00:42Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowSerializationSchema.java", "diffHunk": "@@ -99,35 +94,66 @@ public JsonRowSerializationSchema(TypeInformation<Row> typeInfo) {\n \t@PublicEvolving\n \tpublic static class Builder {\n \n-\t\tprivate final RowTypeInfo typeInfo;\n+\t\tprivate RowTypeInfo typeInfo;\n+\n+\t\tprivate Builder() {\n+\t\t\t// private constructor\n+\t\t}\n \n \t\t/**\n+\t\t * @deprecated Use {@link JsonRowSerializationSchema#builder()} instead.", "originalCommit": "8bed2dbf577c649ad3e6b411730763c90a898a5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA4NTcxMg==", "url": "https://github.com/apache/flink/pull/11080#discussion_r380085712", "bodyText": "Add a javadoc on this method.", "author": "wuchong", "createdAt": "2020-02-17T10:01:18Z", "path": "flink-formats/flink-json/src/main/java/org/apache/flink/formats/json/JsonRowSerializationSchema.java", "diffHunk": "@@ -99,35 +94,66 @@ public JsonRowSerializationSchema(TypeInformation<Row> typeInfo) {\n \t@PublicEvolving\n \tpublic static class Builder {\n \n-\t\tprivate final RowTypeInfo typeInfo;\n+\t\tprivate RowTypeInfo typeInfo;\n+\n+\t\tprivate Builder() {\n+\t\t\t// private constructor\n+\t\t}\n \n \t\t/**\n+\t\t * @deprecated Use {@link JsonRowSerializationSchema#builder()} instead.\n+\t\t *\n \t\t * Creates a JSON serialization schema for the given type information.\n \t\t *\n \t\t * @param typeInfo Type information describing the result type. The field names of {@link Row}\n \t\t *                 are used to parse the JSON properties.\n \t\t */\n+\t\t@Deprecated\n \t\tpublic Builder(TypeInformation<Row> typeInfo) {\n \t\t\tcheckArgument(typeInfo instanceof RowTypeInfo, \"Only RowTypeInfo is supported\");\n \t\t\tthis.typeInfo = (RowTypeInfo) typeInfo;\n \t\t}\n \n \t\t/**\n+\t\t * @deprecated Use {@link JsonRowSerializationSchema#builder()} instead.\n+\t\t *\n \t\t * Creates a JSON serialization schema for the given JSON schema.\n \t\t *\n \t\t * @param jsonSchema JSON schema describing the result type\n \t\t *\n \t\t * @see <a href=\"http://json-schema.org/\">http://json-schema.org/</a>\n \t\t */\n+\t\t@Deprecated\n \t\tpublic Builder(String jsonSchema) {\n \t\t\tthis(JsonRowSchemaConverter.convert(checkNotNull(jsonSchema)));\n \t\t}\n \n+\t\t/**\n+\t\t * Sets type information for JSON serialization schema.\n+\t\t *\n+\t\t * @param typeInfo Type information describing the result type. The field names of {@link Row}\n+\t\t *                 are used to parse the JSON properties.\n+\t\t */\n+\t\tpublic Builder withTypeInfo(TypeInformation<Row> typeInfo) {\n+\t\t\tcheckArgument(typeInfo instanceof RowTypeInfo, \"Only RowTypeInfo is supported\");\n+\t\t\tthis.typeInfo = (RowTypeInfo) typeInfo;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\t/**\n+\t\t * Finalizes the configuration and checks validity.\n+\t\t * @return Configured {@link JsonRowSerializationSchema}\n+\t\t */\n \t\tpublic JsonRowSerializationSchema build() {\n+\t\t\tcheckArgument(typeInfo != null, \"typeInfo should be set.\");\n \t\t\treturn new JsonRowSerializationSchema(typeInfo);\n \t\t}\n \t}\n \n+\tpublic static Builder builder() {", "originalCommit": "8bed2dbf577c649ad3e6b411730763c90a898a5d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "75ca630c234f01097ac97ccb2257e532490dae51", "url": "https://github.com/apache/flink/commit/75ca630c234f01097ac97ccb2257e532490dae51", "message": "Refine java doc for JsonRowSerializationSchema.Builder", "committedDate": "2020-02-17T10:42:29Z", "type": "commit"}, {"oid": "4d421fec466c39ff97ac208eade8b4f32851cf21", "url": "https://github.com/apache/flink/commit/4d421fec466c39ff97ac208eade8b4f32851cf21", "message": "fix checkstyle", "committedDate": "2020-02-17T15:11:38Z", "type": "commit"}]}