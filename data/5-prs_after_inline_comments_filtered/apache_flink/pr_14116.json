{"pr_number": 14116, "pr_title": "[FLINK-20213][fs-connector] Partition commit is delayed when records keep coming", "pr_createdAt": "2020-11-18T10:28:59Z", "pr_url": "https://github.com/apache/flink/pull/14116", "timeline": [{"oid": "4d59e87c09c2b2718d059804f26c6a5a60374326", "url": "https://github.com/apache/flink/commit/4d59e87c09c2b2718d059804f26c6a5a60374326", "message": "[FLINK-20213][fs-connector] Partition commit is delayed when records keep coming", "committedDate": "2020-11-18T10:25:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE4NjU5NQ==", "url": "https://github.com/apache/flink/pull/14116#discussion_r530186595", "bodyText": "Change to another name to avoid override variable names ?", "author": "gaoyunhaii", "createdAt": "2020-11-25T08:28:51Z", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/stream/StreamingFileWriter.java", "diffHunk": "@@ -134,13 +143,19 @@ public void notifyCheckpointComplete(long checkpointId) throws Exception {\n \n \tprivate void commitUpToCheckpoint(long checkpointId) throws Exception {\n \t\thelper.commitUpToCheckpoint(checkpointId);\n+\n+\t\tNavigableMap<Long, Set<String>> newPartitions = this.newPartitions.headMap(checkpointId, true);", "originalCommit": "4d59e87c09c2b2718d059804f26c6a5a60374326", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE4OTk5OA==", "url": "https://github.com/apache/flink/pull/14116#discussion_r530189998", "bodyText": "Will clear the headMap also cleans the part before the current checkpoint in this.newPartitions ?", "author": "gaoyunhaii", "createdAt": "2020-11-25T08:34:43Z", "path": "flink-table/flink-table-runtime-blink/src/main/java/org/apache/flink/table/filesystem/stream/StreamingFileWriter.java", "diffHunk": "@@ -134,13 +143,19 @@ public void notifyCheckpointComplete(long checkpointId) throws Exception {\n \n \tprivate void commitUpToCheckpoint(long checkpointId) throws Exception {\n \t\thelper.commitUpToCheckpoint(checkpointId);\n+\n+\t\tNavigableMap<Long, Set<String>> newPartitions = this.newPartitions.headMap(checkpointId, true);\n+\t\tSet<String> partitions = new HashSet<>(committablePartitions);\n+\t\tcommittablePartitions.clear();\n+\t\tnewPartitions.values().forEach(partitions::addAll);\n+\t\tnewPartitions.clear();", "originalCommit": "4d59e87c09c2b2718d059804f26c6a5a60374326", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDIzNTI4Mw==", "url": "https://github.com/apache/flink/pull/14116#discussion_r530235283", "bodyText": "Yes", "author": "JingsongLi", "createdAt": "2020-11-25T09:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE4OTk5OA=="}], "type": "inlineReview"}, {"oid": "088811826ab3a6a5a403260556c4f476b4802e2d", "url": "https://github.com/apache/flink/commit/088811826ab3a6a5a403260556c4f476b4802e2d", "message": "Address comment", "committedDate": "2020-11-25T09:44:04Z", "type": "commit"}]}