{"pr_number": 13925, "pr_title": "[FLINK-19868][csv] Csv Serialization schema contains line delimiter", "pr_createdAt": "2020-11-04T08:54:46Z", "pr_url": "https://github.com/apache/flink/pull/13925", "timeline": [{"oid": "7bf259abd7c06ad3dcc5039c0795d5939e3d55c8", "url": "https://github.com/apache/flink/commit/7bf259abd7c06ad3dcc5039c0795d5939e3d55c8", "message": "[FLINK-19868][csv] Csv Serialization schema contains line delimiter", "committedDate": "2020-11-04T14:32:03Z", "type": "forcePushed"}, {"oid": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "url": "https://github.com/apache/flink/commit/23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "message": "[FLINK-19868][csv] Csv Serialization schema contains line delimiter", "committedDate": "2020-11-04T14:42:01Z", "type": "commit"}, {"oid": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "url": "https://github.com/apache/flink/commit/23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "message": "[FLINK-19868][csv] Csv Serialization schema contains line delimiter", "committedDate": "2020-11-04T14:42:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNjI4Ng==", "url": "https://github.com/apache/flink/pull/13925#discussion_r517816286", "bodyText": "Why we hard code \\n ? I think the purpose of this issue is removing the \"\\n\".", "author": "wuchong", "createdAt": "2020-11-05T06:23:30Z", "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvFileSystemFormatFactory.java", "diffHunk": "@@ -194,7 +186,12 @@ private CsvSchema buildCsvSchema(RowType rowType, ReadableConfig options) {\n \n \t\tfinal CsvRowDataSerializationSchema serializationSchema = builder.build();\n \n-\t\treturn Optional.of((record, stream) -> stream.write(serializationSchema.serialize(record)));\n+\t\treturn Optional.of((record, stream) -> {\n+\t\t\tStringBuilder sb = new StringBuilder();\n+\t\t\tsb.append(new String(serializationSchema.serialize(record)));\n+\t\t\tsb.append(\"\\n\");\n+\t\t\tstream.write(sb.toString().getBytes());", "originalCommit": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNzUxMA==", "url": "https://github.com/apache/flink/pull/13925#discussion_r517817510", "bodyText": "I would recommend not changing the legacy csv format.", "author": "wuchong", "createdAt": "2020-11-05T06:27:10Z", "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvRowFormatFactory.java", "diffHunk": "@@ -101,9 +100,6 @@ public CsvRowFormatFactory() {\n \t\tdescriptorProperties.getOptionalCharacter(CsvValidator.FORMAT_FIELD_DELIMITER)\n \t\t\t.ifPresent(schemaBuilder::setFieldDelimiter);\n \n-\t\tdescriptorProperties.getOptionalString(CsvValidator.FORMAT_LINE_DELIMITER)\n-\t\t\t.ifPresent(schemaBuilder::setLineDelimiter);", "originalCommit": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzgxNzYxOQ==", "url": "https://github.com/apache/flink/pull/13925#discussion_r517817619", "bodyText": "ditto. I would recommend not changing the legacy csv format.", "author": "wuchong", "createdAt": "2020-11-05T06:27:30Z", "path": "flink-formats/flink-csv/src/main/java/org/apache/flink/formats/csv/CsvRowSerializationSchema.java", "diffHunk": "@@ -86,8 +86,8 @@ private CsvRowSerializationSchema(\n \t\tthis.typeInfo = typeInfo;\n \t\tthis.runtimeConverter = createRowRuntimeConverter(typeInfo, true);\n \t\tthis.csvMapper = new CsvMapper();\n-\t\tthis.csvSchema = csvSchema;\n-\t\tthis.objectWriter = csvMapper.writer(csvSchema);\n+\t\tthis.csvSchema = csvSchema.withLineSeparator(\"\");", "originalCommit": "23f1d6db28364c2ab4f7c4c368d8034d74dfccc3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a00a1dec1f9e13b04a25b7368faf4df98f138448", "url": "https://github.com/apache/flink/commit/a00a1dec1f9e13b04a25b7368faf4df98f138448", "message": "[FLINK-19868][csv] Csv Serialization schema contains line delimiter", "committedDate": "2020-11-05T10:04:26Z", "type": "commit"}]}