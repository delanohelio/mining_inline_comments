{"pr_number": 11162, "pr_title": "[FLINK-11720][connectors] Bump ElasticSearch5 to 5.3.3", "pr_createdAt": "2020-02-20T15:25:55Z", "pr_url": "https://github.com/apache/flink/pull/11162", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM4MTUwNg==", "url": "https://github.com/apache/flink/pull/11162#discussion_r386381506", "bodyText": "I am fine with how it is now. Did you consider just dropping the types of failed requests we do not know, though?\nAnyway none of those should happen as we only ever send ActionRequests.", "author": "dawidwys", "createdAt": "2020-03-02T13:08:19Z", "path": "flink-connectors/flink-connector-elasticsearch-base/src/main/java/org/apache/flink/streaming/connectors/elasticsearch/ElasticsearchSinkBase.java", "diffHunk": "@@ -407,10 +410,19 @@ public void afterBulk(long executionId, BulkRequest request, BulkResponse respon\n \t\t\t\t\t\t\tLOG.error(\"Failed Elasticsearch item request: {}\", itemResponse.getFailureMessage(), failure);\n \n \t\t\t\t\t\t\trestStatus = itemResponse.getFailure().getStatus();\n+\t\t\t\t\t\t\tactionRequest = request.requests().get(i);\n \t\t\t\t\t\t\tif (restStatus == null) {\n-\t\t\t\t\t\t\t\tfailureHandler.onFailure(request.requests().get(i), failure, -1, failureRequestIndexer);\n+\t\t\t\t\t\t\t\tif (actionRequest instanceof ActionRequest) {", "originalCommit": "60e92ee0c012f278d1820b0c9f5061864afdf15c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM4NDMzNw==", "url": "https://github.com/apache/flink/pull/11162#discussion_r386384337", "bodyText": "As you say, it should never happen. But if it does, it'll be a lot easier to debug, because there's an exception.", "author": "rmetzger", "createdAt": "2020-03-02T13:14:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjM4MTUwNg=="}], "type": "inlineReview"}, {"oid": "e7f9aeddee366612e67fb03e9f4e40b09ccbcea7", "url": "https://github.com/apache/flink/commit/e7f9aeddee366612e67fb03e9f4e40b09ccbcea7", "message": "[FLINK-11720][connectors] Bump ElasticSearch5 to 5.3.3\n\nThe ES5 connector has caused numerous issues in end to end and integration tests (on CI and during release test).", "committedDate": "2020-03-04T10:12:32Z", "type": "forcePushed"}, {"oid": "030f325848025d17f6b99eae6e4df03c20c96dd7", "url": "https://github.com/apache/flink/commit/030f325848025d17f6b99eae6e4df03c20c96dd7", "message": "[FLINK-11720][connectors] Bump ElasticSearch5 to 5.3.3\n\nThe ES5 connector has caused numerous issues in end to end and integration tests (on CI and during release test).\n\nThe NOTICE file has been updated according to this maven shade output:\n\n[INFO] --- maven-shade-plugin:3.1.1:shade (shade-flink) @ flink-connector-elasticsearch5_2.11 ---\n[INFO] Including org.apache.flink:flink-connector-elasticsearch-base_2.11:jar:1.11-SNAPSHOT in the shaded jar.\n[INFO] Including org.elasticsearch.client:transport:jar:5.3.3 in the shaded jar.\n[INFO] Including org.elasticsearch:elasticsearch:jar:5.3.3 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-core:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-analyzers-common:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-backward-codecs:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-grouping:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-highlighter:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-join:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-memory:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-misc:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-queries:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-queryparser:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-sandbox:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-spatial:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-spatial-extras:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-spatial3d:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-suggest:jar:6.4.2 in the shaded jar.\n[INFO] Including org.elasticsearch:securesm:jar:1.1 in the shaded jar.\n[INFO] Including net.sf.jopt-simple:jopt-simple:jar:5.0.2 in the shaded jar.\n[INFO] Including com.carrotsearch:hppc:jar:0.7.1 in the shaded jar.\n[INFO] Including joda-time:joda-time:jar:2.5 in the shaded jar.\n[INFO] Including org.yaml:snakeyaml:jar:1.25 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.core:jackson-core:jar:2.10.1 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.dataformat:jackson-dataformat-smile:jar:2.10.1 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:jar:2.10.1 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.dataformat:jackson-dataformat-cbor:jar:2.10.1 in the shaded jar.\n[INFO] Including com.tdunning:t-digest:jar:3.0 in the shaded jar.\n[INFO] Including org.hdrhistogram:HdrHistogram:jar:2.1.6 in the shaded jar.\n[INFO] Including net.java.dev.jna:jna:jar:4.2.2 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:transport-netty3-client:jar:5.3.3 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:transport-netty4-client:jar:5.3.3 in the shaded jar.\n[INFO] Including io.netty:netty-buffer:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-codec:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-codec-http:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-common:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-handler:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-resolver:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-transport:jar:4.1.7.Final in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:reindex-client:jar:5.3.3 in the shaded jar.\n[INFO] Including org.elasticsearch.client:rest:jar:5.3.3 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpclient:jar:4.5.3 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpcore:jar:4.4.6 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpasyncclient:jar:4.1.2 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpcore-nio:jar:4.4.5 in the shaded jar.\n[INFO] Including commons-codec:commons-codec:jar:1.10 in the shaded jar.\n[INFO] Including commons-logging:commons-logging:jar:1.1.3 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:lang-mustache-client:jar:5.3.3 in the shaded jar.\n[INFO] Including com.github.spullara.mustache.java:compiler:jar:0.9.3 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:percolator-client:jar:5.3.3 in the shaded jar.\n[INFO] Including io.netty:netty:jar:3.10.6.Final in the shaded jar.\n[INFO] Including org.apache.flink:force-shading:jar:1.11-SNAPSHOT in the shaded jar.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[INFO] Replacing original artifact with shaded artifact.\n[INFO] Replacing /Users/robert/Projects/flink/flink-connectors/flink-connector-elasticsearch5/target/flink-connector-elasticsearch5_2.11-1.11-SNAPSHOT.jar with /Users/robert/Projects/flink/flink-connectors/flink-connector-elasticsearch5/target/flink-connector-elasticsearch5_2.11-1.11-SNAPSHOT-shaded.jar\n[INFO] Dependency-reduced POM written at: /Users/robert/Projects/flink/flink-connectors/flink-connector-elasticsearch5/target/dependency-reduced-pom.xml\n[INFO]\n[INFO] --- maven-surefire-plugin:2.22.1:test (integration-tests) @ flink-connector-elasticsearch5_2.11 ---", "committedDate": "2020-03-11T16:17:54Z", "type": "commit"}, {"oid": "030f325848025d17f6b99eae6e4df03c20c96dd7", "url": "https://github.com/apache/flink/commit/030f325848025d17f6b99eae6e4df03c20c96dd7", "message": "[FLINK-11720][connectors] Bump ElasticSearch5 to 5.3.3\n\nThe ES5 connector has caused numerous issues in end to end and integration tests (on CI and during release test).\n\nThe NOTICE file has been updated according to this maven shade output:\n\n[INFO] --- maven-shade-plugin:3.1.1:shade (shade-flink) @ flink-connector-elasticsearch5_2.11 ---\n[INFO] Including org.apache.flink:flink-connector-elasticsearch-base_2.11:jar:1.11-SNAPSHOT in the shaded jar.\n[INFO] Including org.elasticsearch.client:transport:jar:5.3.3 in the shaded jar.\n[INFO] Including org.elasticsearch:elasticsearch:jar:5.3.3 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-core:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-analyzers-common:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-backward-codecs:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-grouping:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-highlighter:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-join:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-memory:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-misc:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-queries:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-queryparser:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-sandbox:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-spatial:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-spatial-extras:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-spatial3d:jar:6.4.2 in the shaded jar.\n[INFO] Including org.apache.lucene:lucene-suggest:jar:6.4.2 in the shaded jar.\n[INFO] Including org.elasticsearch:securesm:jar:1.1 in the shaded jar.\n[INFO] Including net.sf.jopt-simple:jopt-simple:jar:5.0.2 in the shaded jar.\n[INFO] Including com.carrotsearch:hppc:jar:0.7.1 in the shaded jar.\n[INFO] Including joda-time:joda-time:jar:2.5 in the shaded jar.\n[INFO] Including org.yaml:snakeyaml:jar:1.25 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.core:jackson-core:jar:2.10.1 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.dataformat:jackson-dataformat-smile:jar:2.10.1 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.dataformat:jackson-dataformat-yaml:jar:2.10.1 in the shaded jar.\n[INFO] Including com.fasterxml.jackson.dataformat:jackson-dataformat-cbor:jar:2.10.1 in the shaded jar.\n[INFO] Including com.tdunning:t-digest:jar:3.0 in the shaded jar.\n[INFO] Including org.hdrhistogram:HdrHistogram:jar:2.1.6 in the shaded jar.\n[INFO] Including net.java.dev.jna:jna:jar:4.2.2 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:transport-netty3-client:jar:5.3.3 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:transport-netty4-client:jar:5.3.3 in the shaded jar.\n[INFO] Including io.netty:netty-buffer:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-codec:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-codec-http:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-common:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-handler:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-resolver:jar:4.1.7.Final in the shaded jar.\n[INFO] Including io.netty:netty-transport:jar:4.1.7.Final in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:reindex-client:jar:5.3.3 in the shaded jar.\n[INFO] Including org.elasticsearch.client:rest:jar:5.3.3 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpclient:jar:4.5.3 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpcore:jar:4.4.6 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpasyncclient:jar:4.1.2 in the shaded jar.\n[INFO] Including org.apache.httpcomponents:httpcore-nio:jar:4.4.5 in the shaded jar.\n[INFO] Including commons-codec:commons-codec:jar:1.10 in the shaded jar.\n[INFO] Including commons-logging:commons-logging:jar:1.1.3 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:lang-mustache-client:jar:5.3.3 in the shaded jar.\n[INFO] Including com.github.spullara.mustache.java:compiler:jar:0.9.3 in the shaded jar.\n[INFO] Including org.elasticsearch.plugin:percolator-client:jar:5.3.3 in the shaded jar.\n[INFO] Including io.netty:netty:jar:3.10.6.Final in the shaded jar.\n[INFO] Including org.apache.flink:force-shading:jar:1.11-SNAPSHOT in the shaded jar.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[WARNING] Discovered module-info.class. Shading will break its strong encapsulation.\n[INFO] Replacing original artifact with shaded artifact.\n[INFO] Replacing /Users/robert/Projects/flink/flink-connectors/flink-connector-elasticsearch5/target/flink-connector-elasticsearch5_2.11-1.11-SNAPSHOT.jar with /Users/robert/Projects/flink/flink-connectors/flink-connector-elasticsearch5/target/flink-connector-elasticsearch5_2.11-1.11-SNAPSHOT-shaded.jar\n[INFO] Dependency-reduced POM written at: /Users/robert/Projects/flink/flink-connectors/flink-connector-elasticsearch5/target/dependency-reduced-pom.xml\n[INFO]\n[INFO] --- maven-surefire-plugin:2.22.1:test (integration-tests) @ flink-connector-elasticsearch5_2.11 ---", "committedDate": "2020-03-11T16:17:54Z", "type": "forcePushed"}]}