{"pr_number": 976, "pr_title": "feat(CR-UI): Enhancement & Bug fixes", "pr_createdAt": "2020-09-11T05:39:04Z", "pr_url": "https://github.com/eclipse/sw360/pull/976", "timeline": [{"oid": "d60ec04ff414c36149d87c8d93e506cd56fb4767", "url": "https://github.com/eclipse/sw360/commit/d60ec04ff414c36149d87c8d93e506cd56fb4767", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-09-22T01:26:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0MjQxMw==", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498142413", "bodyText": "Use Platform-Independent Line Separators wherever possible.\nSystem.lineSeparator()", "author": "JaideepPalit", "createdAt": "2020-10-01T10:28:28Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -932,6 +940,49 @@ public RequestStatus updateRelease(Release release, User user, Iterable<Release.\n         }\n     }\n \n+    private Runnable addCrCommentForAttachmentUpdatesInRelease(Release release, Set<Attachment> updatedAttachments, User user) {\n+        return () -> {\n+            Set<Attachment> originalAttachments = CommonUtils.nullToEmptySet(release.getAttachments());\n+            // collect the attachment Ids\n+            Set<String> originalAttachmentId = originalAttachments.stream().map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+            Set<String> updatedAttachmentId = updatedAttachments.stream().map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+\n+            // check if attachments are updated\n+            if (!originalAttachmentId.equals(updatedAttachmentId)) {\n+                // fetch all the projects associated with this release and collect the Clearing request Ids\n+                final Set<Project> usingProjects = projectRepository.searchByReleaseId(release.getId());\n+                final Set<String> crIds = CommonUtils.nullToEmptySet(usingProjects).stream()\n+                        .filter(proj -> CommonUtils.isNotNullEmptyOrWhitespace(proj.getClearingRequestId()))\n+                        .map(Project::getClearingRequestId).collect(Collectors.toSet());\n+                if (crIds.size() > 0) {\n+                    Set<String> added = Sets.difference(updatedAttachmentId, originalAttachmentId);\n+                    Set<String> removed = Sets.difference(originalAttachmentId, updatedAttachmentId);\n+                    StringBuilder commentText = new StringBuilder(\"Attachment(s) updated for the release: <b>\")\n+                            .append(SW360Utils.printFullname(release)).append(\"</b> (\").append(release.getId()).append(\")\");\n+                    if (CommonUtils.isNotEmpty(added)) {\n+                        Set<String> attachmentNames = extractAttachmentNameWithType(updatedAttachments, added);\n+                        commentText.append(\"\\nAdded Attachments: \").append(SW360Utils.spaceJoiner.join(attachmentNames));\n+                    }\n+                    if (CommonUtils.isNotEmpty(removed)) {\n+                        Set<String> attachmentNames = extractAttachmentNameWithType(originalAttachments, removed);\n+                        commentText.append(\"\\nRemoved Attachments: \").append(SW360Utils.spaceJoiner.join(attachmentNames));\n+                    }\n+                    for (String cdId : crIds) {\n+                        Comment comment = new Comment().setText(commentText.toString()).setCommentedBy(user.getEmail()).setAutoGenerated(true);\n+                        projectModerator.addCommentToClearingRequest(cdId, comment, user);\n+                    }\n+                }\n+            }\n+        };\n+    }\n+\n+    private Set<String> extractAttachmentNameWithType(Set<Attachment> attachments, Collection<String> filterCriteria) {\n+        return attachments.stream().filter(att -> filterCriteria.contains(att.getAttachmentContentId()))\n+                .map(att -> new StringBuilder(\"\\n\\t\").append(att.getFilename()).append(DatabaseHandlerUtil.SEPARATOR)", "originalCommit": "d60ec04ff414c36149d87c8d93e506cd56fb4767", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0MzkxNg==", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498143916", "bodyText": "Use int to prevent Autoboxing and Unboxing during increment and then convert it to string.", "author": "JaideepPalit", "createdAt": "2020-10-01T10:31:27Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -1145,9 +1181,15 @@ private String extractReleaseNameForClearingEmail(List<Release> releases) {\n         return builder.toString();\n     }\n \n-    private int getTotalReleaseCount(ReleaseClearingStateSummary clearingSummary) {\n-        return clearingSummary.getNewRelease() + clearingSummary.getReportAvailable() + clearingSummary.getUnderClearing()\n-                + clearingSummary.getSentToClearingTool()+ clearingSummary.getApproved();\n+    private String appendCompTypeToReleaseVersion(Collection<Release> releases, Set<String> cotsCompIds) {\n+        Integer count = 0;", "originalCommit": "d60ec04ff414c36149d87c8d93e506cd56fb4767", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODE0ODcyNA==", "url": "https://github.com/eclipse/sw360/pull/976#discussion_r498148724", "bodyText": "indentation", "author": "JaideepPalit", "createdAt": "2020-10-01T10:40:35Z", "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/common/SW360Utils.java", "diffHunk": "@@ -661,6 +662,11 @@ public static EccInformation newDefaultEccInformation(){\n                 .collect(Collectors.toSet());\n     }\n \n+    public static int getTotalReleaseCount(ReleaseClearingStateSummary clearingSummary) {\n+        return clearingSummary.getNewRelease() + clearingSummary.getReportAvailable() + clearingSummary.getUnderClearing()\n+                + clearingSummary.getSentToClearingTool()+ clearingSummary.getApproved();", "originalCommit": "d60ec04ff414c36149d87c8d93e506cd56fb4767", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9326077bfa201fa9ae8798ebe90619d4c42aab02", "url": "https://github.com/eclipse/sw360/commit/9326077bfa201fa9ae8798ebe90619d4c42aab02", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-10-01T16:09:58Z", "type": "forcePushed"}, {"oid": "04020bef3fcf78be506cbe237faa2f5df4206961", "url": "https://github.com/eclipse/sw360/commit/04020bef3fcf78be506cbe237faa2f5df4206961", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-10-07T08:55:02Z", "type": "commit"}, {"oid": "04020bef3fcf78be506cbe237faa2f5df4206961", "url": "https://github.com/eclipse/sw360/commit/04020bef3fcf78be506cbe237faa2f5df4206961", "message": "feat(CR-UI): Enhancement & Bug fixes\n\nSigned-off-by: Abdul Kapti <abdul.mannankapti@siemens.com>", "committedDate": "2020-10-07T08:55:02Z", "type": "forcePushed"}]}