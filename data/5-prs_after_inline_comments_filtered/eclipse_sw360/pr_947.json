{"pr_number": 947, "pr_title": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation", "pr_createdAt": "2020-08-11T07:22:42Z", "pr_url": "https://github.com/eclipse/sw360/pull/947", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI1NjU3Nw==", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471256577", "bodyText": "fix the indentation.", "author": "akapti", "createdAt": "2020-08-17T06:29:40Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -404,6 +406,51 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private void setRequestedDateAndTrimComment(Project project, Project actual, User user) {\n+        Set<String> actualReleaseIds = null;\n+        if (Objects.nonNull(actual)&&Objects.nonNull(actual.getReleaseIdToUsage())) {", "originalCommit": "75724090b28260db9a68f7eaae1610235c6aefdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI2MzkxNg==", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471263916", "bodyText": "please get this map project.getReleaseIdToUsage() once and store in variable, rather than fetching it each time in line 416, 417, 424, 433 and 445.", "author": "akapti", "createdAt": "2020-08-17T06:50:16Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -404,6 +406,51 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private void setRequestedDateAndTrimComment(Project project, Project actual, User user) {\n+        Set<String> actualReleaseIds = null;\n+        if (Objects.nonNull(actual)&&Objects.nonNull(actual.getReleaseIdToUsage())) {\n+            actualReleaseIds = CommonUtils.nullToEmptySet(actual.getReleaseIdToUsage().keySet());\n+        }\n+        final Set<String> actualReleaseIdsFinal = CommonUtils.nullToEmptySet(actualReleaseIds);\n+        Set<String> updatedReleaseIds = null;\n+        if (Objects.nonNull(project.getReleaseIdToUsage())) {\n+            updatedReleaseIds = CommonUtils.nullToEmptySet(project.getReleaseIdToUsage().keySet());\n+        } else {\n+            updatedReleaseIds = new HashSet<>();\n+        }\n+\n+        updatedReleaseIds.stream().filter(updatedReleaseId -> !actualReleaseIdsFinal.contains(updatedReleaseId))\n+                .forEach(updatedReleaseId -> {\n+                    ProjectReleaseRelationship projectReleaseRelationship = project.getReleaseIdToUsage()\n+                            .get(updatedReleaseId);\n+                    if (Objects.nonNull(projectReleaseRelationship))\n+                        projectReleaseRelationship.setCreatedOn(SW360Utils.getCreatedOn());\n+                    projectReleaseRelationship.setCreatedBy(user.getEmail());\n+                });\n+\n+        updatedReleaseIds.stream().filter(commonReleaseId -> actualReleaseIdsFinal.contains(commonReleaseId))\n+                .forEach(commonReleaseId -> {\n+                    ProjectReleaseRelationship projectReleaseRelationship = project.getReleaseIdToUsage()\n+                            .get(commonReleaseId);\n+                    ProjectReleaseRelationship actualProjectReleaseRelationship = actual.getReleaseIdToUsage()\n+                            .get(commonReleaseId);\n+                    if (Objects.nonNull(projectReleaseRelationship)\n+                            && Objects.nonNull(actualProjectReleaseRelationship))\n+                        projectReleaseRelationship\n+                                .setCreatedOn(actualProjectReleaseRelationship.getCreatedOn());\n+                    projectReleaseRelationship\n+                    .setCreatedBy(actualProjectReleaseRelationship.getCreatedBy());\n+                });\n+\n+        if (Objects.nonNull(project.getReleaseIdToUsage())) {", "originalCommit": "75724090b28260db9a68f7eaae1610235c6aefdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI2NzAwNg==", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471267006", "bodyText": "No need to define a variable, we can directly pass empty string in method call (line 1428).", "author": "akapti", "createdAt": "2020-08-17T06:57:46Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -1370,13 +1418,14 @@ private void flattenlinkedReleaseOfRelease(Map<String, ReleaseRelationship> rele\n         releaseIdToRelationship.entrySet().stream().forEach(rl -> wrapTException(() -> {\n             String relation = ThriftEnumUtils.enumToString(rl.getValue());\n             String projectMailLineState = \"\";\n+            String comment = \"\";", "originalCommit": "75724090b28260db9a68f7eaae1610235c6aefdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTI5NjM1NQ==", "url": "https://github.com/eclipse/sw360/pull/947#discussion_r471296355", "bodyText": "please use braces as there are more than one statement inside if clause.\nSame applies to if clause in line 437.", "author": "akapti", "createdAt": "2020-08-17T07:38:00Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ProjectDatabaseHandler.java", "diffHunk": "@@ -404,6 +406,51 @@ public RequestStatus updateProject(Project project, User user) throws SW360Excep\n         }\n     }\n \n+    private void setRequestedDateAndTrimComment(Project project, Project actual, User user) {\n+        Set<String> actualReleaseIds = null;\n+        if (Objects.nonNull(actual)&&Objects.nonNull(actual.getReleaseIdToUsage())) {\n+            actualReleaseIds = CommonUtils.nullToEmptySet(actual.getReleaseIdToUsage().keySet());\n+        }\n+        final Set<String> actualReleaseIdsFinal = CommonUtils.nullToEmptySet(actualReleaseIds);\n+        Set<String> updatedReleaseIds = null;\n+        if (Objects.nonNull(project.getReleaseIdToUsage())) {\n+            updatedReleaseIds = CommonUtils.nullToEmptySet(project.getReleaseIdToUsage().keySet());\n+        } else {\n+            updatedReleaseIds = new HashSet<>();\n+        }\n+\n+        updatedReleaseIds.stream().filter(updatedReleaseId -> !actualReleaseIdsFinal.contains(updatedReleaseId))\n+                .forEach(updatedReleaseId -> {\n+                    ProjectReleaseRelationship projectReleaseRelationship = project.getReleaseIdToUsage()\n+                            .get(updatedReleaseId);\n+                    if (Objects.nonNull(projectReleaseRelationship))\n+                        projectReleaseRelationship.setCreatedOn(SW360Utils.getCreatedOn());\n+                    projectReleaseRelationship.setCreatedBy(user.getEmail());", "originalCommit": "75724090b28260db9a68f7eaae1610235c6aefdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "60f82182115aa465f7a00935428762faa722e549", "url": "https://github.com/eclipse/sw360/commit/60f82182115aa465f7a00935428762faa722e549", "message": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation\n  * comment field is available in UI, REST and Excel\n  * createdOn , createdBy is not available in UI but available in REST and Excel.\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-08-18T03:47:55Z", "type": "commit"}, {"oid": "60f82182115aa465f7a00935428762faa722e549", "url": "https://github.com/eclipse/sw360/commit/60f82182115aa465f7a00935428762faa722e549", "message": "feat(ProjectReleaseRelation): Added new Field comment, createdOn, createdBy in ProjectReleaseRelation\n  * comment field is available in UI, REST and Excel\n  * createdOn , createdBy is not available in UI but available in REST and Excel.\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-08-18T03:47:55Z", "type": "forcePushed"}]}