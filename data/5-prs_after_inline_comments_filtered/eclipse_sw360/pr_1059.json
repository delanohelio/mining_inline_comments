{"pr_number": 1059, "pr_title": "feat(ui-licenseobligation): License obligation changes", "pr_createdAt": "2020-12-01T08:32:38Z", "pr_url": "https://github.com/eclipse/sw360/pull/1059", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzkzMjg5Ng==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r533932896", "bodyText": "indendation", "author": "JaideepPalit", "createdAt": "2020-12-02T06:49:59Z", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/licenses/LicensesPortlet.java", "diffHunk": "@@ -141,8 +142,27 @@ private void prepareEditView(RenderRequest request, RenderResponse response) {\n         LicenseService.Iface client = thriftClients.makeLicenseClient();\n         boolean isAtLeastClearingAdmin = PermissionUtils.isUserAtLeast(UserGroup.CLEARING_ADMIN, user);\n         request.setAttribute(IS_USER_AT_LEAST_CLEARING_ADMIN, isAtLeastClearingAdmin ? \"Yes\" : \"No\");\n+        request.setAttribute(SELECTED_TAB, \"tab-AddLicense\");\n \n         try {\n+            License moderationLicense = client.getByIDWithOwnModerationRequests(id, user.getDepartment(), user);\n+            request.setAttribute(MODERATION_LICENSE_DETAIL, moderationLicense);\n+            List<Obligation> obligations = client.getObligations().stream()\n+                    .filter(Objects::nonNull)\n+                    .filter(Obligation::isSetObligationLevel)\n+                    .filter(obl -> obl.getObligationLevel().equals(ObligationLevel.LICENSE_OBLIGATION))\n+                    .collect(Collectors.toList());\n+            request.setAttribute(KEY_OBLIGATION_LIST, obligations);\n+\n+            final License license = client.getByID(id,user.getDepartment());", "originalCommit": "ae3935ff9190fd9fb53bdf8dee690079ac59dc4b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0NTA4Mg==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r533945082", "bodyText": "Maybe it could be written as licenseOblIds  is not null and empty then only fetch from DB", "author": "JaideepPalit", "createdAt": "2020-12-02T07:21:07Z", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/licenses/LicensesPortlet.java", "diffHunk": "@@ -141,8 +142,27 @@ private void prepareEditView(RenderRequest request, RenderResponse response) {\n         LicenseService.Iface client = thriftClients.makeLicenseClient();\n         boolean isAtLeastClearingAdmin = PermissionUtils.isUserAtLeast(UserGroup.CLEARING_ADMIN, user);\n         request.setAttribute(IS_USER_AT_LEAST_CLEARING_ADMIN, isAtLeastClearingAdmin ? \"Yes\" : \"No\");\n+        request.setAttribute(SELECTED_TAB, \"tab-AddLicense\");\n \n         try {\n+            License moderationLicense = client.getByIDWithOwnModerationRequests(id, user.getDepartment(), user);\n+            request.setAttribute(MODERATION_LICENSE_DETAIL, moderationLicense);\n+            List<Obligation> obligations = client.getObligations().stream()\n+                    .filter(Objects::nonNull)\n+                    .filter(Obligation::isSetObligationLevel)\n+                    .filter(obl -> obl.getObligationLevel().equals(ObligationLevel.LICENSE_OBLIGATION))\n+                    .collect(Collectors.toList());\n+            request.setAttribute(KEY_OBLIGATION_LIST, obligations);\n+\n+            final License license = client.getByID(id,user.getDepartment());\n+            Set<String> licenseOblIds = license.getObligationDatabaseIds();\n+            List<Obligation> obls = new ArrayList<Obligation>();\n+\n+            if (licenseOblIds != null) {\n+                obls = CommonUtils.nullToEmptyList(client.getObligationsByIds(Lists.newArrayList(licenseOblIds)));\n+            }", "originalCommit": "ae3935ff9190fd9fb53bdf8dee690079ac59dc4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk1NTgwMg==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r539955802", "bodyText": "Done", "author": "smrutis1", "createdAt": "2020-12-10T08:06:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0NTA4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0OTE1MA==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r533949150", "bodyText": "This filter could also be removed , since main field is removed", "author": "JaideepPalit", "createdAt": "2020-12-02T07:30:27Z", "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/common/SW360Utils.java", "diffHunk": "@@ -612,7 +612,7 @@ public static Integer parseStringToNumber(String input) {\n         obligationAlreadyPresent.entrySet().stream().forEach(e -> obligationStatusMap.remove(e.getKey()));\n \n         Map<String, ObligationStatusInfo> mapOfObligations = obligations.stream().filter(Objects::nonNull)\n-                .filter(o -> isValidForProjectOptional || o.isValidForProject())\n+                .filter(o -> isValidForProjectOptional)", "originalCommit": "ae3935ff9190fd9fb53bdf8dee690079ac59dc4b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTk1NTI1OQ==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r539955259", "bodyText": "removed", "author": "smrutis1", "createdAt": "2020-12-10T08:05:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzk0OTE1MA=="}], "type": "inlineReview"}, {"oid": "5989133247b5b011e8322404317c2b1a7ab8f0f3", "url": "https://github.com/eclipse/sw360/commit/5989133247b5b011e8322404317c2b1a7ab8f0f3", "message": "feat(ui-licenseobligation): License obligation changes\n\nSigned-off-by: Smruti Prakash Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-12-10T07:53:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDExOTUwMQ==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r540119501", "bodyText": "Is it possible to use CommonUtils.isNotNullEmptyOrWhitespace() same for line 457", "author": "JaideepPalit", "createdAt": "2020-12-10T12:12:57Z", "path": "frontend/sw360-portlet/src/main/java/org/eclipse/sw360/portal/portlets/licenses/LicensesPortlet.java", "diffHunk": "@@ -317,6 +359,9 @@ private License updateLicenseFromRequest(License license, ActionRequest request)\n         license.setGPLv2Compat(gpl2compatibility);\n         license.setGPLv3Compat(gpl3compatibility);\n         license.setChecked(checked);\n+        String obligationIds = request.getParameter(\"obligations\");\n+        List<String> oblIds = obligationIds == null || obligationIds.equals(\"\") ? Lists.newArrayList() : Arrays.asList(obligationIds.split(\",\"));", "originalCommit": "5989133247b5b011e8322404317c2b1a7ab8f0f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE2MzE4Mw==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r540163183", "bodyText": "Have used", "author": "smrutis1", "createdAt": "2020-12-10T13:21:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDExOTUwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDEyMzU5NA==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r540123594", "bodyText": "Should also be removed from method signature.", "author": "JaideepPalit", "createdAt": "2020-12-10T12:19:30Z", "path": "libraries/lib-datahandler/src/main/java/org/eclipse/sw360/datahandler/common/SW360Utils.java", "diffHunk": "@@ -612,7 +612,6 @@ public static Integer parseStringToNumber(String input) {\n         obligationAlreadyPresent.entrySet().stream().forEach(e -> obligationStatusMap.remove(e.getKey()));\n \n         Map<String, ObligationStatusInfo> mapOfObligations = obligations.stream().filter(Objects::nonNull)\n-                .filter(o -> isValidForProjectOptional || o.isValidForProject())", "originalCommit": "5989133247b5b011e8322404317c2b1a7ab8f0f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE2MzM4Mw==", "url": "https://github.com/eclipse/sw360/pull/1059#discussion_r540163383", "bodyText": "Removed it", "author": "smrutis1", "createdAt": "2020-12-10T13:21:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDEyMzU5NA=="}], "type": "inlineReview"}, {"oid": "bdc94955c8a98326319110283f452cf29904d2b1", "url": "https://github.com/eclipse/sw360/commit/bdc94955c8a98326319110283f452cf29904d2b1", "message": "feat(ui-licenseobligation): License obligation changes\n\nSigned-off-by: Smruti Prakash Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-12-10T13:19:09Z", "type": "commit"}, {"oid": "bdc94955c8a98326319110283f452cf29904d2b1", "url": "https://github.com/eclipse/sw360/commit/bdc94955c8a98326319110283f452cf29904d2b1", "message": "feat(ui-licenseobligation): License obligation changes\n\nSigned-off-by: Smruti Prakash Sahoo <smruti.sahoo@siemens.com>", "committedDate": "2020-12-10T13:19:09Z", "type": "forcePushed"}]}