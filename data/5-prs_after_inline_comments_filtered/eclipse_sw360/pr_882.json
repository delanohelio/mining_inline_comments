{"pr_number": 882, "pr_title": "feat(SplitComponentUI): Split Component data like releases and attachments from Source Component to Target Component", "pr_createdAt": "2020-06-10T06:26:35Z", "pr_url": "https://github.com/eclipse/sw360/pull/882", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMjM4MA==", "url": "https://github.com/eclipse/sw360/pull/882#discussion_r439932380", "bodyText": "add assert() methods:\nassertNotNull(component);\nassertId(component.getId());\nassertUser(user);", "author": "akapti", "createdAt": "2020-06-15T05:07:24Z", "path": "backend/src/src-components/src/main/java/org/eclipse/sw360/components/ComponentHandler.java", "diffHunk": "@@ -504,4 +504,9 @@ public RequestSummary importBomFromAttachmentContent(User user, String attachmen\n         assertUser(user);\n         return handler.importBomFromAttachmentContent(user, attachmentContentId);\n     }\n+\n+    @Override\n+    public RequestStatus splitComponent(Component srcComponent, Component targetComponent, User user) throws TException {\n+        return handler.splitComponent(srcComponent, targetComponent, user);", "originalCommit": "23c3205b30698cba4dc3f32e4423399ed7632ea3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAwMDk4Mg==", "url": "https://github.com/eclipse/sw360/pull/882#discussion_r442000982", "bodyText": "Changes done.", "author": "JaideepPalit", "createdAt": "2020-06-18T06:42:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMjM4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc4NTQxNQ==", "url": "https://github.com/eclipse/sw360/pull/882#discussion_r440785415", "bodyText": "Use StringBuilder for concatenation,", "author": "akapti", "createdAt": "2020-06-16T11:40:56Z", "path": "backend/src-common/src/main/java/org/eclipse/sw360/datahandler/db/ComponentDatabaseHandler.java", "diffHunk": "@@ -2055,4 +2123,53 @@ private void removeLeadingTrailingWhitespace(Component component) {\n \n         component.setOperatingSystems(DatabaseHandlerUtil.trimSetOfString(component.getOperatingSystems()));\n     }\n+\n+    private boolean moveAttachmentFromSrcComponentToTargetComponent(Component srcComponent, Component targetComponent,\n+            Component srcComponentFromDB, Component targetComponentFromDB) {\n+        Set<String> srcComponentAttachmentIdsAfter = nullToEmptySet(srcComponent.getAttachments()).stream()\n+                .map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+        Set<String> targetComponentAttachmentIdsAfter = nullToEmptySet(targetComponent.getAttachments()).stream()\n+                .map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+        Map<String, Attachment> srcComponentAttachmentsMapBefore = nullToEmptySet(srcComponentFromDB.getAttachments())\n+                .stream().collect(Collectors.toMap(Attachment::getAttachmentContentId, Function.identity()));\n+\n+        Set<Attachment> targetComponentAttachmentBefore = nullToEmptySet(targetComponentFromDB.getAttachments());\n+        Set<String> targetComponentAttachmentIdsBefore = targetComponentAttachmentBefore.stream()\n+                .map(Attachment::getAttachmentContentId).collect(Collectors.toSet());\n+\n+        targetComponentAttachmentIdsAfter.removeAll(targetComponentAttachmentIdsBefore);\n+        if (CommonUtils.isNotEmpty(targetComponentAttachmentIdsAfter)) {\n+            targetComponentAttachmentIdsAfter.stream().forEach(movedAttachmentId -> targetComponentAttachmentBefore\n+                    .add(srcComponentAttachmentsMapBefore.get(movedAttachmentId)));\n+            targetComponentFromDB.setAttachments(targetComponentAttachmentBefore);\n+\n+            Set<Attachment> srcComponentAttachmentFinal = srcComponentAttachmentsMapBefore.values().stream()\n+                    .filter(attachment -> srcComponentAttachmentIdsAfter.contains(attachment.getAttachmentContentId()))\n+                    .collect(Collectors.toSet());\n+            srcComponentFromDB.setAttachments(srcComponentAttachmentFinal);\n+            return true;\n+        }\n+        return false;\n+    }\n+\n+    private void updateReleaseAfterComponentSplit(Component srcComponentFromDB, Component targetComponentFromDB,\n+            Set<String> srcComponentReleaseIdsMovedFromSrc, Set<String> targetComponentReleaseIdsBefore, User user) throws SW360Exception {\n+        List<Release> targetComponentReleases = getReleasesForClearingStateSummary(targetComponentReleaseIdsBefore);\n+        List<Release> srcComponentReleasesMoved = getReleasesForClearingStateSummary(srcComponentReleaseIdsMovedFromSrc);\n+        Set<String> targetComponentReleaseVersions = targetComponentReleases.stream().map(Release::getVersion)\n+                .collect(Collectors.toSet());\n+\n+        List<Release> releasesToUpdate = srcComponentReleasesMoved.stream().map(r -> {\n+            Release releaseBefore = r.deepCopy();\n+            if (targetComponentReleaseVersions.contains(r.getVersion())) {\n+                r.setVersion(r.getVersion() + \"_conflict (\" + r.getId() + \")\");", "originalCommit": "23c3205b30698cba4dc3f32e4423399ed7632ea3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAwMTA2OA==", "url": "https://github.com/eclipse/sw360/pull/882#discussion_r442001068", "bodyText": "Changes done.", "author": "JaideepPalit", "createdAt": "2020-06-18T06:42:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDc4NTQxNQ=="}], "type": "inlineReview"}, {"oid": "8528ecfe69ade5dba0f793013fbb5d1bfea4e941", "url": "https://github.com/eclipse/sw360/commit/8528ecfe69ade5dba0f793013fbb5d1bfea4e941", "message": "feat(SplitComponentUI): Move Component data like releases and attachments from Source Component to Target Component\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-06-18T06:39:04Z", "type": "commit"}, {"oid": "8528ecfe69ade5dba0f793013fbb5d1bfea4e941", "url": "https://github.com/eclipse/sw360/commit/8528ecfe69ade5dba0f793013fbb5d1bfea4e941", "message": "feat(SplitComponentUI): Move Component data like releases and attachments from Source Component to Target Component\n\nSigned-off-by: Jaideep Palit <jaideep.palit@siemens.com>", "committedDate": "2020-06-18T06:39:04Z", "type": "forcePushed"}]}