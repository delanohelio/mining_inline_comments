{"pr_number": 6356, "pr_title": "Independent schema is set for each consumer generated by topic", "pr_createdAt": "2020-02-18T15:41:39Z", "pr_url": "https://github.com/apache/pulsar/pull/6356", "timeline": [{"oid": "cdf77353a30615e756d45f695411a539e7505780", "url": "https://github.com/apache/pulsar/commit/cdf77353a30615e756d45f695411a539e7505780", "message": "no message", "committedDate": "2019-10-28T07:38:46Z", "type": "commit"}, {"oid": "145f97e6bf1b652c54bfb58f43c8bca8f7489ccf", "url": "https://github.com/apache/pulsar/commit/145f97e6bf1b652c54bfb58f43c8bca8f7489ccf", "message": "Revert \"no message\"\n\nThis reverts commit cdf77353a30615e756d45f695411a539e7505780.", "committedDate": "2019-10-28T07:41:11Z", "type": "commit"}, {"oid": "f27d4152f500055864e1f4cad686c702a2d61d8e", "url": "https://github.com/apache/pulsar/commit/f27d4152f500055864e1f4cad686c702a2d61d8e", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-10-28T08:10:24Z", "type": "commit"}, {"oid": "dc85737481a4bddd07226a85bf24cae904efd527", "url": "https://github.com/apache/pulsar/commit/dc85737481a4bddd07226a85bf24cae904efd527", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-11-08T02:18:40Z", "type": "commit"}, {"oid": "65e6f83a4a1ccab376563e5030d84cd6a23e866f", "url": "https://github.com/apache/pulsar/commit/65e6f83a4a1ccab376563e5030d84cd6a23e866f", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-11-13T10:48:56Z", "type": "commit"}, {"oid": "260b1374d19a96fea4c8beb8dd5afce1f16446ce", "url": "https://github.com/apache/pulsar/commit/260b1374d19a96fea4c8beb8dd5afce1f16446ce", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-11-27T06:15:28Z", "type": "commit"}, {"oid": "09e1e40db21307dcb4c9da5cc38d8e0aa07606d5", "url": "https://github.com/apache/pulsar/commit/09e1e40db21307dcb4c9da5cc38d8e0aa07606d5", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-11-28T02:26:37Z", "type": "commit"}, {"oid": "d8e1c03bed853a2cc378f14f7cd7e8a003bb8196", "url": "https://github.com/apache/pulsar/commit/d8e1c03bed853a2cc378f14f7cd7e8a003bb8196", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-11-29T09:40:03Z", "type": "commit"}, {"oid": "605061bf5d3d854aa28ec4ea8c26888df75c5aca", "url": "https://github.com/apache/pulsar/commit/605061bf5d3d854aa28ec4ea8c26888df75c5aca", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2019-12-10T09:09:12Z", "type": "commit"}, {"oid": "3b39049a556401babdb534306c9cca8079305f8b", "url": "https://github.com/apache/pulsar/commit/3b39049a556401babdb534306c9cca8079305f8b", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-02-18T07:23:30Z", "type": "commit"}, {"oid": "9c1e24bd03249828f9709edd58e543111cf149d0", "url": "https://github.com/apache/pulsar/commit/9c1e24bd03249828f9709edd58e543111cf149d0", "message": "Clone schema to different consumer", "committedDate": "2020-02-18T15:26:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg4MjEwMQ==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r380882101", "bodyText": "missing license header", "author": "sijie", "createdAt": "2020-02-18T19:20:26Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/schema/SchemaTest.java", "diffHunk": "@@ -0,0 +1,119 @@\n+\n+package org.apache.pulsar.schema;", "originalCommit": "9c1e24bd03249828f9709edd58e543111cf149d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg4Mjg4Ng==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r380882886", "bodyText": "I think we need to implement the clone method for each schema implementation. So you can then just call schema.clone() to clone a schema.", "author": "sijie", "createdAt": "2020-02-18T19:21:46Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "diffHunk": "@@ -813,4 +817,22 @@ public TransactionBuilder newTransaction() {\n         return new TransactionBuilderImpl(this);\n     }\n \n+    @SuppressWarnings(\"unchecked\")\n+    private static Schema cloneSchema(Schema schema){", "originalCommit": "9c1e24bd03249828f9709edd58e543111cf149d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f18e24898d19f8fae5649dfd611d1eec807b92d9", "url": "https://github.com/apache/pulsar/commit/f18e24898d19f8fae5649dfd611d1eec807b92d9", "message": "Add the clone method for each schema", "committedDate": "2020-02-19T07:23:44Z", "type": "commit"}, {"oid": "4ef0e8dfedf9a117d8e3a2dc1f6fc8dfc413aa3b", "url": "https://github.com/apache/pulsar/commit/4ef0e8dfedf9a117d8e3a2dc1f6fc8dfc413aa3b", "message": "Fix the clone schema method", "committedDate": "2020-02-19T07:51:57Z", "type": "commit"}, {"oid": "a3285b7fc733dbb6421afdfccc0ef03777bc1088", "url": "https://github.com/apache/pulsar/commit/a3285b7fc733dbb6421afdfccc0ef03777bc1088", "message": "Fix single topic consumer get clone schema", "committedDate": "2020-02-19T14:06:01Z", "type": "commit"}, {"oid": "2c580a1ce1fb0324d15def8f28dceb77b76d9318", "url": "https://github.com/apache/pulsar/commit/2c580a1ce1fb0324d15def8f28dceb77b76d9318", "message": "fix the reader get schema", "committedDate": "2020-02-20T16:55:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxNDUwNw==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r382914507", "bodyText": "Looks the imports are unused.", "author": "codelipenghui", "createdAt": "2020-02-22T13:58:31Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java", "diffHunk": "@@ -70,6 +70,9 @@\n import org.apache.pulsar.client.impl.conf.ReaderConfigurationData;\n import org.apache.pulsar.client.impl.schema.AutoConsumeSchema;\n import org.apache.pulsar.client.impl.schema.AutoProduceBytesSchema;\n+import org.apache.pulsar.client.impl.schema.AvroSchema;\n+import org.apache.pulsar.client.impl.schema.KeyValueSchema;\n+import org.apache.pulsar.client.impl.schema.generic.GenericAvroSchema;", "originalCommit": "2c580a1ce1fb0324d15def8f28dceb77b76d9318", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91471ef48c19c8715a78ce62f3989cd76ae044d4", "url": "https://github.com/apache/pulsar/commit/91471ef48c19c8715a78ce62f3989cd76ae044d4", "message": "delete the unused imports", "committedDate": "2020-02-23T01:21:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ2MjA5Nw==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r383462097", "bodyText": "When you implementing cloneSchema, don't you need to copy the fields to the new instance?", "author": "sijie", "createdAt": "2020-02-24T19:18:35Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/AutoConsumeSchema.java", "diffHunk": "@@ -132,6 +132,11 @@ public void configureSchemaInfo(String topicName,\n         }\n     }\n \n+    @Override\n+    public Schema<GenericRecord> cloneSchema() {\n+        return Schema.AUTO_CONSUME();", "originalCommit": "91471ef48c19c8715a78ce62f3989cd76ae044d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUxMTIyMg==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r385511222", "bodyText": "\ufffdit don't need to copy fields, AutoConsumeSchema represent it can auto consume, if you want clone the fields you can clone the true schema in AutoConsumeSchema. After all, only its schema is changeable.", "author": "congbobo184", "createdAt": "2020-02-28T05:15:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ2MjA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxNzI4Mw==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r386617283", "bodyText": "I understand it can be changed. but cloneSchema is cloning a schema, we should copy the fields when cloning a schema.", "author": "sijie", "createdAt": "2020-03-02T19:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ2MjA5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNTc2NA==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r386905764", "bodyText": "you are right, we should clone the fields when clone a schema", "author": "congbobo184", "createdAt": "2020-03-03T09:50:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzQ2MjA5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5MzY4MQ==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r384793681", "bodyText": "Could you please explain why the access modifiers were switched to public?", "author": "vzhikserg", "createdAt": "2020-02-26T22:01:04Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/schema/Schemas.java", "diffHunk": "@@ -29,36 +29,36 @@\n     @NoArgsConstructor\n     @AllArgsConstructor\n     public static class PersonOne{\n-        int id;\n+        public int id;", "originalCommit": "91471ef48c19c8715a78ce62f3989cd76ae044d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUxMjQ0Nw==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r385512447", "bodyText": "SchemaCompatibilityCheckTest also used it.", "author": "congbobo184", "createdAt": "2020-02-28T05:22:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5MzY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYzNjQ5OA==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r386636498", "bodyText": "This class provides all possible constructors and getters/setters for all fields. Please use them instead of defining fields as public", "author": "vzhikserg", "createdAt": "2020-03-02T20:38:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5MzY4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5ODg0OA==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r384798848", "bodyText": "Did you consider to use the standard Cloneable interface with the clone method?", "author": "vzhikserg", "createdAt": "2020-02-26T22:12:01Z", "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Schema.java", "diffHunk": "@@ -136,6 +136,15 @@ default void configureSchemaInfo(String topic, String componentName,\n         // no-op\n     }\n \n+    /**\n+     * Clone schema.\n+     *\n+     * @return cloned schema.\n+     */\n+    default Schema<T> cloneSchema() {", "originalCommit": "91471ef48c19c8715a78ce62f3989cd76ae044d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUxMjg4OQ==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r385512889", "bodyText": "It seems don't need to add the flag to control it.", "author": "congbobo184", "createdAt": "2020-02-28T05:24:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5ODg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxNzczMA==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r386617730", "bodyText": "@congbobo184 do you mean that Cloneable interface doesn't return Schema<T>?", "author": "sijie", "createdAt": "2020-03-02T19:59:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5ODg0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjgxMDc2OA==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r386810768", "bodyText": "My understanding of what @vzhikserg said deviated, now I understand what he said. I will extends the Cloneable.", "author": "congbobo184", "createdAt": "2020-03-03T05:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5ODg0OA=="}], "type": "inlineReview"}, {"oid": "266cc9e94f9521e8856067c22d0e06dd328d949c", "url": "https://github.com/apache/pulsar/commit/266cc9e94f9521e8856067c22d0e06dd328d949c", "message": "Extend the Cloneable implementation and fix the AutoConsumeSchema", "committedDate": "2020-03-03T15:58:11Z", "type": "commit"}, {"oid": "1da1611f2afe135fa51da166f16cf41077376767", "url": "https://github.com/apache/pulsar/commit/1da1611f2afe135fa51da166f16cf41077376767", "message": "Merge remote-tracking branch 'apache/master' into fix_schemaProvider_be_covered", "committedDate": "2020-03-04T08:34:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU4MjQ3MA==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r387582470", "bodyText": "The Data annotation already includes Getter and Setter", "author": "vzhikserg", "createdAt": "2020-03-04T10:39:14Z", "path": "pulsar-broker/src/test/java/org/apache/pulsar/schema/Schemas.java", "diffHunk": "@@ -16,25 +16,31 @@\n  * specific language governing permissions and limitations\n  * under the License.\n  */\n-package org.apache.pulsar.schema.compatibility;\n+package org.apache.pulsar.schema;\n \n import lombok.AllArgsConstructor;\n import lombok.Data;\n+import lombok.Getter;\n import lombok.NoArgsConstructor;\n+import lombok.Setter;\n import org.apache.avro.reflect.AvroDefault;\n \n public class Schemas {\n \n     @Data\n     @NoArgsConstructor\n     @AllArgsConstructor\n+    @Getter", "originalCommit": "1da1611f2afe135fa51da166f16cf41077376767", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc2MzY0NQ==", "url": "https://github.com/apache/pulsar/pull/6356#discussion_r387763645", "bodyText": "I will fix it, thank for your review:)", "author": "congbobo184", "createdAt": "2020-03-04T15:59:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzU4MjQ3MA=="}], "type": "inlineReview"}, {"oid": "4e4192c31c8ce9cf557441e7770a39d3af539b7d", "url": "https://github.com/apache/pulsar/commit/4e4192c31c8ce9cf557441e7770a39d3af539b7d", "message": "Add the kafkaSchema clone implementation", "committedDate": "2020-03-04T16:10:22Z", "type": "commit"}, {"oid": "e97dece609a4efd9022e4e6cd4ecf28b4c27aab9", "url": "https://github.com/apache/pulsar/commit/e97dece609a4efd9022e4e6cd4ecf28b4c27aab9", "message": "Merge remote-tracking branch 'apache/master' into fix_schemaProvider_be_covered", "committedDate": "2020-03-05T02:59:33Z", "type": "commit"}, {"oid": "54c6782a1617dd43a69641989584fa081f7a0118", "url": "https://github.com/apache/pulsar/commit/54c6782a1617dd43a69641989584fa081f7a0118", "message": "Add the jugement", "committedDate": "2020-03-05T03:00:33Z", "type": "commit"}]}