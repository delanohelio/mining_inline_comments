{"pr_number": 8608, "pr_title": "Improve naming of threads used in batch source", "pr_createdAt": "2020-11-18T08:33:52Z", "pr_url": "https://github.com/apache/pulsar/pull/8608", "timeline": [{"oid": "e6675827e3128bcdb7cd31766f935ab329786ab3", "url": "https://github.com/apache/pulsar/commit/e6675827e3128bcdb7cd31766f935ab329786ab3", "message": "Improve naming of threads used in batch source", "committedDate": "2020-11-18T19:16:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2Mzc2Ng==", "url": "https://github.com/apache/pulsar/pull/8608#discussion_r526363766", "bodyText": "Maybe unrelated, but it would be better to also use awaitTermination() in the shutdown, to ensure all pending tasks are gone before we close the classloader.", "author": "merlimat", "createdAt": "2020-11-18T19:30:34Z", "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/batch/BatchSourceExecutor.java", "diffHunk": "@@ -69,14 +69,19 @@\n   private String intermediateTopicName;\n   private volatile Exception currentError = null;\n   private volatile boolean isRunning = false;\n-  private ExecutorService discoveryThread = Executors.newSingleThreadExecutor(new DefaultThreadFactory(\"batch-source-discovery\"));\n+  private ExecutorService discoveryThread;\n \n   @Override\n   public void open(Map<String, Object> config, SourceContext sourceContext) throws Exception {\n     this.config = config;\n     this.sourceContext = sourceContext;\n     this.intermediateTopicName = SourceConfigUtils.computeBatchSourceIntermediateTopicName(sourceContext.getTenant(),\n       sourceContext.getNamespace(), sourceContext.getSourceName()).toString();\n+    this.discoveryThread = Executors.newSingleThreadExecutor(\n+      new DefaultThreadFactory(\n+        String.format(\"%s-batch-source-discovery\",\n+          FunctionCommon.getFullyQualifiedName(\n+            sourceContext.getTenant(), sourceContext.getNamespace(), sourceContext.getSourceName()))));", "originalCommit": "e6675827e3128bcdb7cd31766f935ab329786ab3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2NTE1Mg==", "url": "https://github.com/apache/pulsar/pull/8608#discussion_r526365152", "bodyText": "@merlimat that is what we are doing today:\nhttps://github.com/apache/pulsar/blob/master/pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/batch/BatchSourceExecutor.java#L223", "author": "jerrypeng", "createdAt": "2020-11-18T19:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2Mzc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2NzM0Ng==", "url": "https://github.com/apache/pulsar/pull/8608#discussion_r526367346", "bodyText": "Gotcha. I missed that", "author": "merlimat", "createdAt": "2020-11-18T19:36:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2Mzc2Ng=="}], "type": "inlineReview"}, {"oid": "9d368716db7f557e05c677bda2bb314e438e86cd", "url": "https://github.com/apache/pulsar/commit/9d368716db7f557e05c677bda2bb314e438e86cd", "message": "Improve naming of threads used in batch source", "committedDate": "2020-11-19T17:22:15Z", "type": "commit"}, {"oid": "9d368716db7f557e05c677bda2bb314e438e86cd", "url": "https://github.com/apache/pulsar/commit/9d368716db7f557e05c677bda2bb314e438e86cd", "message": "Improve naming of threads used in batch source", "committedDate": "2020-11-19T17:22:15Z", "type": "forcePushed"}]}