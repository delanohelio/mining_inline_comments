{"pr_number": 7601, "pr_title": "Add readiness api for the worker leader", "pr_createdAt": "2020-07-19T21:21:43Z", "pr_url": "https://github.com/apache/pulsar/pull/7601", "timeline": [{"oid": "cd7cbe5f12d359c958a5e6611245d1f13d7e093d", "url": "https://github.com/apache/pulsar/commit/cd7cbe5f12d359c958a5e6611245d1f13d7e093d", "message": "Added upgrade notes", "committedDate": "2020-07-07T19:00:43Z", "type": "commit"}, {"oid": "83b4c58c8466a402229de9f1ad4fcdeb4e0b83ef", "url": "https://github.com/apache/pulsar/commit/83b4c58c8466a402229de9f1ad4fcdeb4e0b83ef", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-08T20:35:54Z", "type": "commit"}, {"oid": "a3ba7f344b8056adb759c040f529094f5ca9d67f", "url": "https://github.com/apache/pulsar/commit/a3ba7f344b8056adb759c040f529094f5ca9d67f", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-12T16:17:19Z", "type": "commit"}, {"oid": "89c8048f57e46a0a336d6b59a73aa19fd9bcfe94", "url": "https://github.com/apache/pulsar/commit/89c8048f57e46a0a336d6b59a73aa19fd9bcfe94", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-12T22:43:18Z", "type": "commit"}, {"oid": "b0728460c11e7babb09d47427818bda7092846cd", "url": "https://github.com/apache/pulsar/commit/b0728460c11e7babb09d47427818bda7092846cd", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-13T20:40:54Z", "type": "commit"}, {"oid": "77bb46778d1ef87c5c14694b634ba9d14e945b74", "url": "https://github.com/apache/pulsar/commit/77bb46778d1ef87c5c14694b634ba9d14e945b74", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-13T23:47:34Z", "type": "commit"}, {"oid": "000336c993a9c92871470b5ded18724d94cd41c6", "url": "https://github.com/apache/pulsar/commit/000336c993a9c92871470b5ded18724d94cd41c6", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-14T18:53:11Z", "type": "commit"}, {"oid": "f9231d29d8ec4dc3e4451436ec6f7eaa3aae6cb4", "url": "https://github.com/apache/pulsar/commit/f9231d29d8ec4dc3e4451436ec6f7eaa3aae6cb4", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-15T15:39:38Z", "type": "commit"}, {"oid": "ee44e3ba01e6793331134ac43e7ca636d49a03ab", "url": "https://github.com/apache/pulsar/commit/ee44e3ba01e6793331134ac43e7ca636d49a03ab", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-16T23:33:16Z", "type": "commit"}, {"oid": "4b02b546faad21540133e66b63d9e691561f4c45", "url": "https://github.com/apache/pulsar/commit/4b02b546faad21540133e66b63d9e691561f4c45", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-17T05:44:01Z", "type": "commit"}, {"oid": "edb2f412a5c025c43d122cb34762402070850b1d", "url": "https://github.com/apache/pulsar/commit/edb2f412a5c025c43d122cb34762402070850b1d", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-17T21:01:04Z", "type": "commit"}, {"oid": "4419645fd3675b675afa4b57824c05d9a0731431", "url": "https://github.com/apache/pulsar/commit/4419645fd3675b675afa4b57824c05d9a0731431", "message": "Merge remote-tracking branch 'apache/master'", "committedDate": "2020-07-19T20:33:06Z", "type": "commit"}, {"oid": "8f84d5b1780533c74e5a42da511c03880b728980", "url": "https://github.com/apache/pulsar/commit/8f84d5b1780533c74e5a42da511c03880b728980", "message": "Add new end point to verify leader readiness", "committedDate": "2020-07-19T21:20:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA==", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457570328", "bodyText": "I think the url path would be more clean if it is /cluster/leader/ready.  We can add more API under \"/leader\" in future", "author": "jerrypeng", "createdAt": "2020-07-20T17:20:42Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leaderready\")", "originalCommit": "8f84d5b1780533c74e5a42da511c03880b728980", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDcyMA==", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457570720", "bodyText": "Beside we already have have the url path \"/cluster/leader\"", "author": "jerrypeng", "createdAt": "2020-07-20T17:21:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU4OTE1MQ==", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457589151", "bodyText": "Changed", "author": "srkukarni", "createdAt": "2020-07-20T17:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU3MDMyOA=="}], "type": "inlineReview"}, {"oid": "82572742f80133cf520398f18418211664fe7cd3", "url": "https://github.com/apache/pulsar/commit/82572742f80133cf520398f18418211664fe7cd3", "message": "Address feedback", "committedDate": "2020-07-20T17:53:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg==", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457590322", "bodyText": "I think it is more appropriate to just return 200 for OK or 503 (service not available).  That is more idiomatic for HTTP REST calls", "author": "jerrypeng", "createdAt": "2020-07-20T17:55:13Z", "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Worker.java", "diffHunk": "@@ -129,4 +129,19 @@ public WorkerInfo getClusterLeader() {\n     public void rebalance() {\n         worker.rebalance(uri.getRequestUri(), clientAppId());\n     }\n+\n+    @GET\n+    @ApiOperation(\n+            value = \"Checks if this node is the leader and is ready to service requests\",\n+            response = String.class\n+    )\n+    @ApiResponses(value = {\n+            @ApiResponse(code = 401, message = \"The requester is not authenticated\"),\n+            @ApiResponse(code = 503, message = \"Worker service is not running\")\n+    })\n+    @Path(\"/cluster/leader/ready\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    public String isLeaderReady() {", "originalCommit": "82572742f80133cf520398f18418211664fe7cd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MTMwOA==", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457591308", "bodyText": "Something like\nhttps://github.com/apache/pulsar/blob/master/pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/WorkerReadinessResource.java#L65", "author": "jerrypeng", "createdAt": "2020-07-20T17:56:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5NzgwNQ==", "url": "https://github.com/apache/pulsar/pull/7601#discussion_r457597805", "bodyText": "Changed", "author": "srkukarni", "createdAt": "2020-07-20T18:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzU5MDMyMg=="}], "type": "inlineReview"}, {"oid": "bab58b6a4e757736b956c7fa84043879a2663dcf", "url": "https://github.com/apache/pulsar/commit/bab58b6a4e757736b956c7fa84043879a2663dcf", "message": "Address feedback", "committedDate": "2020-07-20T18:08:20Z", "type": "commit"}, {"oid": "943fe9de2f96733c729e6414b1a1b61b16d3a0f1", "url": "https://github.com/apache/pulsar/commit/943fe9de2f96733c729e6414b1a1b61b16d3a0f1", "message": "Add new end point to verify leader readiness", "committedDate": "2020-07-21T06:28:21Z", "type": "commit"}, {"oid": "cf78f70856e84227cbc8384cf62cd1744ff9c40d", "url": "https://github.com/apache/pulsar/commit/cf78f70856e84227cbc8384cf62cd1744ff9c40d", "message": "Address feedback", "committedDate": "2020-07-21T06:28:21Z", "type": "commit"}, {"oid": "8207aa908a1a32b42d602c9065b858a4d5f6082b", "url": "https://github.com/apache/pulsar/commit/8207aa908a1a32b42d602c9065b858a4d5f6082b", "message": "Address feedback", "committedDate": "2020-07-21T06:28:21Z", "type": "commit"}, {"oid": "3f751a34649e52ee6c46dcfedca2155642ef36fd", "url": "https://github.com/apache/pulsar/commit/3f751a34649e52ee6c46dcfedca2155642ef36fd", "message": "Merge branch 'worker_healthcheck' of github.com:srkukarni/incubator-pulsar into worker_healthcheck", "committedDate": "2020-07-21T06:28:31Z", "type": "commit"}, {"oid": "f910e2ee6636554cb1c84b32c5cc2a3f9d86d878", "url": "https://github.com/apache/pulsar/commit/f910e2ee6636554cb1c84b32c5cc2a3f9d86d878", "message": "Merge branch 'master' into worker_healthcheck", "committedDate": "2020-07-23T08:52:08Z", "type": "commit"}, {"oid": "ac32e9d2399e8484020141f30e1d18bffcff8ee5", "url": "https://github.com/apache/pulsar/commit/ac32e9d2399e8484020141f30e1d18bffcff8ee5", "message": "Merge branch 'master' into worker_healthcheck", "committedDate": "2020-07-24T16:30:44Z", "type": "commit"}]}