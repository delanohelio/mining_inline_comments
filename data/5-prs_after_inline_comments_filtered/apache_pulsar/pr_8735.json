{"pr_number": 8735, "pr_title": "Fix reader always has message available", "pr_createdAt": "2020-11-28T03:00:53Z", "pr_url": "https://github.com/apache/pulsar/pull/8735", "timeline": [{"oid": "6475958012d4c850ea285c39b792173f94f8f4c0", "url": "https://github.com/apache/pulsar/commit/6475958012d4c850ea285c39b792173f94f8f4c0", "message": "fix reader always `hasMessageAvailable`", "committedDate": "2020-11-28T02:19:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjMyMDM5NA==", "url": "https://github.com/apache/pulsar/pull/8735#discussion_r532320394", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                    .thenCompose((msgId)-> seekAsync(msgId).thenApply((ignore)-> msgId))\n          \n          \n            \n                                    .thenCompose((msgId) -> seekAsync(msgId).thenApply((ignore)-> msgId))", "author": "sijie", "createdAt": "2020-11-30T02:48:09Z", "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java", "diffHunk": "@@ -2010,11 +2010,16 @@ public boolean hasMessageAvailable() throws PulsarClientException {\n                     startMessageId.partitionIndex == -1) {\n \n                 getLastMessageIdAsync()\n-                        .thenCompose(this::seekAsync)\n-                        .whenComplete((ignore, e) -> {\n+                        .thenCompose((msgId)-> seekAsync(msgId).thenApply((ignore)-> msgId))", "originalCommit": "6475958012d4c850ea285c39b792173f94f8f4c0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f213878b866ab5e9643f829e4c019514731901d7", "url": "https://github.com/apache/pulsar/commit/f213878b866ab5e9643f829e4c019514731901d7", "message": "Update pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java\n\nCo-authored-by: Sijie Guo <sg@streamnative.io>", "committedDate": "2020-11-30T03:43:26Z", "type": "commit"}, {"oid": "b495527346e53b712eb646112df1c5552174b2a2", "url": "https://github.com/apache/pulsar/commit/b495527346e53b712eb646112df1c5552174b2a2", "message": "close reader", "committedDate": "2020-11-30T03:45:07Z", "type": "commit"}]}