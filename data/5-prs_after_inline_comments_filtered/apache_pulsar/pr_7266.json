{"pr_number": 7266, "pr_title": "[pulsar-broker] Dispatch batch messages according consumer permits", "pr_createdAt": "2020-06-13T01:45:46Z", "pr_url": "https://github.com/apache/pulsar/pull/7266", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMjE5Mw==", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r440532193", "bodyText": "I think we better not add message related concepts to the entry. Maybe we can add a context carrier in the entry. What do you think?", "author": "codelipenghui", "createdAt": "2020-06-16T01:19:18Z", "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/Entry.java", "diffHunk": "@@ -65,4 +65,39 @@\n      */\n     boolean release();\n \n+    /**\n+     * Get number of batch messages into the entry.\n+     * @return\n+     */\n+    int getNumberOfBatchMessages();\n+\n+    /**\n+     * Set number of batch messages into the entry.\n+     * @param numberOfBatchMessages\n+     */\n+    void setNumberOfBatchMessages(int numberOfBatchMessages);\n+\n+    /**\n+     * Set data size of the entry.\n+     * @param totalSizeInBytes\n+     */\n+    void setTotalSizeInBytes(int totalSizeInBytes);\n+\n+    /**\n+     * Set total number of chunked messages in entry.\n+     * @param totalChunkedMessages\n+     */\n+    void setTotalChunkedMessages(int totalChunkedMessages);\n+\n+    /**\n+     * Get total data size of the entry.\n+     * @return\n+     */\n+    int getTotalSizeInBytes();\n+\n+    /**\n+     * Get total number of chuncked messages.\n+     * @return\n+     */\n+    int getTotalChunkedMessages();", "originalCommit": "ed8073efd83226bbb5f4ef06ec2088eb24a7174d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYyMTgxNDY3MQ==", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r621814671", "bodyText": "Hi @codelipenghui , could you please provide a little more detail on what you mean by a \"context carrier\"?", "author": "devinbost", "createdAt": "2021-04-28T04:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMjE5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDYzMTYyMTUwMg==", "url": "https://github.com/apache/pulsar/pull/7266#discussion_r631621502", "bodyText": "I agree with @codelipenghui\nit is unfortunate to add these methods here.\nwe are going to use them (and the underlying fields) only on the Dispatcher.\nit would be better (for instance) to have some EntryWithMetatadata object in Dispatcher that wraps the Entry and adds these fields", "author": "eolivelli", "createdAt": "2021-05-13T07:27:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDUzMjE5Mw=="}], "type": "inlineReview"}, {"oid": "35320be4aa6ee5de0bf960324e59d3be472f2c7e", "url": "https://github.com/apache/pulsar/commit/35320be4aa6ee5de0bf960324e59d3be472f2c7e", "message": "[pulsar-broker] Dispatch batch messages according consumer permits", "committedDate": "2021-05-14T00:43:03Z", "type": "commit"}, {"oid": "b835c350a3ceb4b4506d686d59d89ca23b25b48a", "url": "https://github.com/apache/pulsar/commit/b835c350a3ceb4b4506d686d59d89ca23b25b48a", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-14T17:08:51Z", "type": "forcePushed"}, {"oid": "218c28a69af98aaea45f2bd62f18a132ef04ef85", "url": "https://github.com/apache/pulsar/commit/218c28a69af98aaea45f2bd62f18a132ef04ef85", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-14T17:14:39Z", "type": "forcePushed"}, {"oid": "1a0d784e292043053d1f452f6ac1c4c920792c41", "url": "https://github.com/apache/pulsar/commit/1a0d784e292043053d1f452f6ac1c4c920792c41", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-14T17:16:23Z", "type": "forcePushed"}, {"oid": "cac9f3af35a9bdd4041d71b0de331125787caedd", "url": "https://github.com/apache/pulsar/commit/cac9f3af35a9bdd4041d71b0de331125787caedd", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-14T17:33:31Z", "type": "forcePushed"}, {"oid": "20fbcc97d2c04e91a88be789680693fdd53f4413", "url": "https://github.com/apache/pulsar/commit/20fbcc97d2c04e91a88be789680693fdd53f4413", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-14T22:34:37Z", "type": "forcePushed"}, {"oid": "3cb03346f202ae8a08b0eb108d9c05e221bda914", "url": "https://github.com/apache/pulsar/commit/3cb03346f202ae8a08b0eb108d9c05e221bda914", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-15T01:20:00Z", "type": "forcePushed"}, {"oid": "739c32f0089192fa2cba2016f3f6896a0b5aee81", "url": "https://github.com/apache/pulsar/commit/739c32f0089192fa2cba2016f3f6896a0b5aee81", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-15T01:23:03Z", "type": "commit"}, {"oid": "739c32f0089192fa2cba2016f3f6896a0b5aee81", "url": "https://github.com/apache/pulsar/commit/739c32f0089192fa2cba2016f3f6896a0b5aee81", "message": "Remove entry api and added entry-wrapper", "committedDate": "2021-05-15T01:23:03Z", "type": "forcePushed"}]}