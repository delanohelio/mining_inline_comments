{"pr_number": 6917, "pr_title": "Make ZkBookieRackAffinityMapping work as expected", "pr_createdAt": "2020-05-08T07:46:43Z", "pr_url": "https://github.com/apache/pulsar/pull/6917", "timeline": [{"oid": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13", "url": "https://github.com/apache/pulsar/commit/9c485af1accb3c410ee7e5d06bab2da2d7eccc13", "message": "Refresh the bookie info map when cache misses", "committedDate": "2020-05-08T07:38:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzUxNTU1NQ==", "url": "https://github.com/apache/pulsar/pull/6917#discussion_r423515555", "bodyText": "Do we need to update it here? seems this is a  get operation, If it is not present, there is no need to update?", "author": "jiazhai", "createdAt": "2020-05-12T07:21:47Z", "path": "pulsar-zookeeper-utils/src/main/java/org/apache/pulsar/zookeeper/ZkBookieRackAffinityMapping.java", "diffHunk": "@@ -162,10 +180,19 @@ private String getRack(String bookieAddress) {\n             throw new RuntimeException(e);\n         }\n \n+        BookieInfo bi = bookieInfoMap.get(bookieAddress);\n+        if (bi == null) {\n+            Optional<BookieInfo> biOpt = racksWithHost.getBookie(bookieAddress);\n+            if (biOpt.isPresent()) {\n+                bi = biOpt.get();\n+            } else {\n+                updateRacksWithHost(racksWithHost);", "originalCommit": "9c485af1accb3c410ee7e5d06bab2da2d7eccc13", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "46d761dc74b568abcefa91775a638f66a5b372cb", "url": "https://github.com/apache/pulsar/commit/46d761dc74b568abcefa91775a638f66a5b372cb", "message": "Merge remote-tracking branch 'apache/master' into fix_rack_placement_policy", "committedDate": "2020-05-18T21:36:40Z", "type": "commit"}, {"oid": "b2752d8f543eccd9c01c7f55d485c95a689c82db", "url": "https://github.com/apache/pulsar/commit/b2752d8f543eccd9c01c7f55d485c95a689c82db", "message": "Racks map expects hostname:port pair", "committedDate": "2020-05-18T21:55:40Z", "type": "commit"}]}