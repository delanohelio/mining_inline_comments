{"pr_number": 911, "pr_title": "Fix memory leak and deadlock in record parser", "pr_createdAt": "2020-07-28T17:05:19Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/911", "timeline": [{"oid": "def085c18ca180a3d6649ffc8f6ee4e4904e5f53", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/def085c18ca180a3d6649ffc8f6ee4e4904e5f53", "message": "Fix memory leak and deadlock in record parser\n\nSigned-off-by: Steven Sheehy <steven.sheehy@hedera.com>", "committedDate": "2020-07-28T16:51:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc0ODA3NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/911#discussion_r461748075", "bodyText": "q: Probably outside of the scope of this PR but should this check be here. Would it be better in RecordFileParser before onStart is called?", "author": "Nana-EC", "createdAt": "2020-07-28T17:24:35Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/entity/sql/SqlEntityListener.java", "diffHunk": "@@ -148,17 +120,27 @@ public void onStart(StreamFileData streamFileData) {\n         liveHashes = new ArrayList<>();\n         entityIds = new HashSet<>();\n         topicMessages = new ArrayList<>();\n-        batchCount = 0;\n+    }\n+\n+    @Override\n+    public void onStart(StreamFileData streamFileData) {\n+        String fileName = FilenameUtils.getName(streamFileData.getFilename());\n+\n+        if (recordFileRepository.findByName(fileName).size() > 0) {", "originalCommit": "def085c18ca180a3d6649ffc8f6ee4e4904e5f53", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc2MzM2OQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/911#discussion_r461763369", "bodyText": "No, since currently it is the responsibility of SqlEntityListener to save the record file on end it should also have to responsibility of verying it on start.", "author": "steven-sheehy", "createdAt": "2020-07-28T17:49:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc0ODA3NQ=="}], "type": "inlineReview"}]}