{"pr_number": 1254, "pr_title": "Refactor importer to handle token transfers in crypto transfer", "pr_createdAt": "2020-11-10T16:22:57Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254", "timeline": [{"oid": "87240c3dd51ef593f8d9f95f97f2249cfc2ebcb3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/87240c3dd51ef593f8d9f95f97f2249cfc2ebcb3", "message": "Refactor importer to handle token transfers in crypto transfer\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-10T16:15:49Z", "type": "commit"}, {"oid": "8e3f64829e472a81ea5eb5aa0c0c8beba36dc8f7", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8e3f64829e472a81ea5eb5aa0c0c8beba36dc8f7", "message": "Rework token transfer handling\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-11T06:40:27Z", "type": "commit"}, {"oid": "899e63a578927ca95a957a1c864164d9780f9ba3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/899e63a578927ca95a957a1c864164d9780f9ba3", "message": "Change transactions.js query for token transfers, and fix tests\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-11T06:42:17Z", "type": "commit"}, {"oid": "95f8b86431324adc03b12488d73bf710e2034c67", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/95f8b86431324adc03b12488d73bf710e2034c67", "message": "Revert entity listener token test to only validate tokens\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-11T21:04:34Z", "type": "commit"}, {"oid": "5b6f119c4d96ce4c6088f1fa5ab62c648d635f43", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/5b6f119c4d96ce4c6088f1fa5ab62c648d635f43", "message": "Add migration to delete token transfers transaction type\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-11T21:14:27Z", "type": "commit"}, {"oid": "e7b8249f86bae261dab3c355d6092e7c715cc6c9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e7b8249f86bae261dab3c355d6092e7c715cc6c9", "message": "Update docs first draft\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-11T22:25:24Z", "type": "commit"}, {"oid": "3d84b70cce3417d8ce1437771e3dd94fca06d618", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3d84b70cce3417d8ce1437771e3dd94fca06d618", "message": "Rework rest integration tests to be closer to original intent\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-12T00:24:01Z", "type": "commit"}, {"oid": "ffed69d37d94c5d108bacb4b8245167b2d105619", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ffed69d37d94c5d108bacb4b8245167b2d105619", "message": "Add a comment to record item listener\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-12T00:29:20Z", "type": "commit"}, {"oid": "1609cc38e9fb618a37cb4789406430847c84e147", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/1609cc38e9fb618a37cb4789406430847c84e147", "message": "Bump protobuf to 0.9.0-rc.2\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-12T21:31:57Z", "type": "commit"}, {"oid": "dbca7d7f5af154559989a46267a3e171ac9efa37", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/dbca7d7f5af154559989a46267a3e171ac9efa37", "message": "Merge branch 'master' into support-token-transfer-in-crypto-transfer", "committedDate": "2020-11-12T21:35:01Z", "type": "commit"}, {"oid": "8558c70b3b64c3fc72719d3b4c046ab15308d183", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/8558c70b3b64c3fc72719d3b4c046ab15308d183", "message": "Rename delete token transfer migration\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-12T21:54:48Z", "type": "commit"}, {"oid": "7ddc0b541518e91dc6d73c67361a2d98e13a71a4", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/7ddc0b541518e91dc6d73c67361a2d98e13a71a4", "message": "Refactor REST tests to not have separate tokenTransfers section\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-13T00:24:28Z", "type": "commit"}, {"oid": "99be1e1358a5b4a42d146e58a30473b9ce617e5d", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/99be1e1358a5b4a42d146e58a30473b9ce617e5d", "message": "Rework integration tests further\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-13T00:42:46Z", "type": "commit"}, {"oid": "ac0e733d941f6bf3e6d8447218725262d31e4751", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ac0e733d941f6bf3e6d8447218725262d31e4751", "message": "Fix test\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-13T00:55:05Z", "type": "commit"}, {"oid": "40e3c0f9948660c1374911f86d8bdbbffd278782", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/40e3c0f9948660c1374911f86d8bdbbffd278782", "message": "Fix pubsub messages file for test\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-13T04:06:11Z", "type": "commit"}, {"oid": "62f0653469342879f86efe75c831edd2c6d57213", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/62f0653469342879f86efe75c831edd2c6d57213", "message": "Refactor transactions.js\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-13T20:36:08Z", "type": "commit"}, {"oid": "08d7e81a11f649d2bad027db37332e626db69583", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/08d7e81a11f649d2bad027db37332e626db69583", "message": "Bump to rc.3 for java version\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-16T02:00:58Z", "type": "commit"}, {"oid": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/00f8f47f8ac63d43e9350ad305e4c3788d0148f6", "message": "Update expiry, autorenewal, and tokenID fields in tokens for 0.9.0\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-16T02:56:38Z", "type": "commit"}, {"oid": "3def1b95286628b5ce9ca8b75be663f48a1e4077", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/3def1b95286628b5ce9ca8b75be663f48a1e4077", "message": "Fix other transaction query\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-16T06:00:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NDg2NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524344865", "bodyText": "Wrong time unit. Use Utility.timestampInNanosMax()", "author": "steven-sheehy", "createdAt": "2020-11-16T15:18:28Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/transactionhandler/TokenUpdateTransactionsHandler.java", "diffHunk": "@@ -48,12 +48,12 @@ public void updateEntity(Entities entity, RecordItem recordItem) {\n             entity.setKey(tokenUpdateTransactionBody.getAdminKey().toByteArray());\n         }\n \n-        if (tokenUpdateTransactionBody.getAutoRenewPeriod() != 0) {\n-            entity.setAutoRenewPeriod(tokenUpdateTransactionBody.getAutoRenewPeriod());\n+        if (tokenUpdateTransactionBody.hasAutoRenewPeriod()) {\n+            entity.setAutoRenewPeriod(tokenUpdateTransactionBody.getAutoRenewPeriod().getSeconds());\n         }\n \n-        if (tokenUpdateTransactionBody.getExpiry() != 0) {\n-            entity.setExpiryTimeNs(tokenUpdateTransactionBody.getExpiry());\n+        if (tokenUpdateTransactionBody.hasExpiry()) {\n+            entity.setExpiryTimeNs(tokenUpdateTransactionBody.getExpiry().getSeconds());", "originalCommit": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3NDc2NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524374764", "bodyText": "Fixed.", "author": "ijungmann", "createdAt": "2020-11-16T15:55:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NDg2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3OTU2Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524379562", "bodyText": "Whoops, yep, timestampInNanosMax now, fixed.", "author": "ijungmann", "createdAt": "2020-11-16T16:02:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0NDg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1Mjc5OQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524352799", "bodyText": "Wrong time unit. Use Utility.timestampInNanosMax()", "author": "steven-sheehy", "createdAt": "2020-11-16T15:28:53Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/transactionhandler/TokenCreateTransactionsHandler.java", "diffHunk": "@@ -48,12 +48,12 @@ public void updateEntity(Entities entity, RecordItem recordItem) {\n             entity.setKey(tokenCreateTransactionBody.getAdminKey().toByteArray());\n         }\n \n-        if (tokenCreateTransactionBody.getAutoRenewPeriod() != 0) {\n-            entity.setAutoRenewPeriod(tokenCreateTransactionBody.getAutoRenewPeriod());\n+        if (tokenCreateTransactionBody.hasAutoRenewPeriod()) {\n+            entity.setAutoRenewPeriod(tokenCreateTransactionBody.getAutoRenewPeriod().getSeconds());\n         }\n \n-        if (tokenCreateTransactionBody.getExpiry() != 0) {\n-            entity.setExpiryTimeNs(tokenCreateTransactionBody.getExpiry());\n+        if (tokenCreateTransactionBody.hasExpiry()) {\n+            entity.setExpiryTimeNs(tokenCreateTransactionBody.getExpiry().getSeconds());", "originalCommit": "00f8f47f8ac63d43e9350ad305e4c3788d0148f6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3NDgyNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524374825", "bodyText": "Fixed.", "author": "ijungmann", "createdAt": "2020-11-16T15:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1Mjc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3ODA4Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524378086", "bodyText": "Wrong method", "author": "steven-sheehy", "createdAt": "2020-11-16T16:00:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1Mjc5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM3OTIwNQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1254#discussion_r524379205", "bodyText": "Whoops, yep, timestampInNanosMax now, fixed.", "author": "ijungmann", "createdAt": "2020-11-16T16:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM1Mjc5OQ=="}], "type": "inlineReview"}, {"oid": "93ccd795fcfabf6edb3153fd6fdfc87f23b55e0a", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/93ccd795fcfabf6edb3153fd6fdfc87f23b55e0a", "message": "Fix wrong time unit on expiry\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-16T15:55:48Z", "type": "commit"}, {"oid": "bb172d8c39e6167e178a3b8714a113d7a6b82ae2", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bb172d8c39e6167e178a3b8714a113d7a6b82ae2", "message": "Fix wrong time unit on expiry\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-11-16T16:00:57Z", "type": "commit"}]}