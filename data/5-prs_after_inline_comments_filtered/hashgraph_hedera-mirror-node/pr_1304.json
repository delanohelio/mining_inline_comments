{"pr_number": 1304, "pr_title": "Correct Transaction Suppliers having default values overwritten, and add validation", "pr_createdAt": "2020-12-01T22:52:17Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304", "timeline": [{"oid": "bc2a47890ebfa4cbd307d37a70ebde4141c95a84", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bc2a47890ebfa4cbd307d37a70ebde4141c95a84", "message": "Remove builders from suppliers and add support for getters and setters\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T21:03:46Z", "type": "commit"}, {"oid": "ea134586dfa2ee4efe282aec9fb06d7919ed7aad", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ea134586dfa2ee4efe282aec9fb06d7919ed7aad", "message": "Add initial bean validation support\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T22:21:57Z", "type": "commit"}, {"oid": "345f0c0446541242b5d1953a2a6b09dc3845a782", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/345f0c0446541242b5d1953a2a6b09dc3845a782", "message": "Validation for crypto suppliers\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T22:32:15Z", "type": "commit"}, {"oid": "54864520bad666716ce1ab5ca4b72bca42c648c1", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/54864520bad666716ce1ab5ca4b72bca42c648c1", "message": "HCS suppliers validation\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T22:39:09Z", "type": "commit"}, {"oid": "d64f6be81c6fee5c183b31c6c693ea12fa0f0179", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/d64f6be81c6fee5c183b31c6c693ea12fa0f0179", "message": "HTS Supplier validation\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T22:43:54Z", "type": "commit"}, {"oid": "339bd92fa0d3e34d8c271a43aea6f5f2d1ca1f19", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/339bd92fa0d3e34d8c271a43aea6f5f2d1ca1f19", "message": "Code smells\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T23:08:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4MjAwNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533782006", "bodyText": "I think you can remove the Required/Optional comments now and re-sort all the fields. It should be self documenting what's required from the validation annotations", "author": "steven-sheehy", "createdAt": "2020-12-01T23:05:36Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/account/AccountUpdateTransactionSupplier.java", "diffHunk": "@@ -37,30 +38,28 @@\n import com.hedera.hashgraph.sdk.account.AccountUpdateTransaction;\n import com.hedera.hashgraph.sdk.crypto.ed25519.Ed25519PublicKey;\n \n-@Builder\n-@Value\n-@Log4j2\n+@Data\n public class AccountUpdateTransactionSupplier implements TransactionSupplier<AccountUpdateTransaction> {\n \n     private static final List<String> requiredFields = Arrays.asList(\"accountId\");\n \n     //Required", "originalCommit": "d64f6be81c6fee5c183b31c6c693ea12fa0f0179", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwOTYxMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533809611", "bodyText": "Removed and re-sorted", "author": "ijungmann", "createdAt": "2020-12-02T00:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4MjAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTI5Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533785292", "bodyText": "Should remove this and the manual validation checks.", "author": "steven-sheehy", "createdAt": "2020-12-01T23:13:24Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/account/AccountUpdateTransactionSupplier.java", "diffHunk": "@@ -37,30 +38,28 @@\n import com.hedera.hashgraph.sdk.account.AccountUpdateTransaction;\n import com.hedera.hashgraph.sdk.crypto.ed25519.Ed25519PublicKey;\n \n-@Builder\n-@Value\n-@Log4j2\n+@Data\n public class AccountUpdateTransactionSupplier implements TransactionSupplier<AccountUpdateTransaction> {\n \n     private static final List<String> requiredFields = Arrays.asList(\"accountId\");", "originalCommit": "d64f6be81c6fee5c183b31c6c693ea12fa0f0179", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwNjIyMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533806222", "bodyText": "Removed", "author": "ijungmann", "createdAt": "2020-12-02T00:08:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTI5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwODUxOA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533808518", "bodyText": "Is the TransactionSupplierException in use anywhere now?", "author": "steven-sheehy", "createdAt": "2020-12-02T00:14:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTI5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgxOTk1Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533819957", "bodyText": "Nope, just removed it.", "author": "ijungmann", "createdAt": "2020-12-02T00:47:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTI5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTQ5Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533785493", "bodyText": "nit: Would look more consistent if two newlines between all fields since the annotated fields already do so.", "author": "steven-sheehy", "createdAt": "2020-12-01T23:13:57Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/account/AccountUpdateTransactionSupplier.java", "diffHunk": "@@ -37,30 +38,28 @@\n import com.hedera.hashgraph.sdk.account.AccountUpdateTransaction;\n import com.hedera.hashgraph.sdk.crypto.ed25519.Ed25519PublicKey;\n \n-@Builder\n-@Value\n-@Log4j2\n+@Data\n public class AccountUpdateTransactionSupplier implements TransactionSupplier<AccountUpdateTransaction> {\n \n     private static final List<String> requiredFields = Arrays.asList(\"accountId\");\n \n     //Required\n-    private final String accountId;\n+    @NotBlank\n+    private String accountId;\n \n     //Optional\n-    @Builder.Default\n-    private final Duration autoRenewPeriod = Duration.ofSeconds(8000000);\n+    @NotNull\n+    private Duration autoRenewPeriod = Duration.ofSeconds(8000000);\n \n-    @Builder.Default\n-    private final Instant expirationTime = Instant.now().plus(120, ChronoUnit.DAYS);\n+    @NotNull\n+    private Instant expirationTime = Instant.now().plus(120, ChronoUnit.DAYS);\n \n-    @Builder.Default\n-    private final long maxTransactionFee = 1_000_000_000;\n-    private final String proxyAccountId;\n-    private final String publicKey;\n+    @Min(1)\n+    private long maxTransactionFee = 1_000_000_000;\n \n-    @Builder.Default\n-    private final boolean receiverSignatureRequired = false;\n+    private String proxyAccountId;\n+    private String publicKey;", "originalCommit": "d64f6be81c6fee5c183b31c6c693ea12fa0f0179", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgwNDQ2NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533804465", "bodyText": "Sure, two newlines everywhere now", "author": "ijungmann", "createdAt": "2020-12-02T00:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NTQ5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NjgzMg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533786832", "bodyText": "Use @DurationMin/Max as well for this and other duration fields", "author": "steven-sheehy", "createdAt": "2020-12-01T23:16:25Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/account/AccountUpdateTransactionSupplier.java", "diffHunk": "@@ -37,30 +38,28 @@\n import com.hedera.hashgraph.sdk.account.AccountUpdateTransaction;\n import com.hedera.hashgraph.sdk.crypto.ed25519.Ed25519PublicKey;\n \n-@Builder\n-@Value\n-@Log4j2\n+@Data\n public class AccountUpdateTransactionSupplier implements TransactionSupplier<AccountUpdateTransaction> {\n \n     private static final List<String> requiredFields = Arrays.asList(\"accountId\");\n \n     //Required\n-    private final String accountId;\n+    @NotBlank\n+    private String accountId;\n \n     //Optional\n-    @Builder.Default\n-    private final Duration autoRenewPeriod = Duration.ofSeconds(8000000);\n+    @NotNull\n+    private Duration autoRenewPeriod = Duration.ofSeconds(8000000);", "originalCommit": "339bd92fa0d3e34d8c271a43aea6f5f2d1ca1f19", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzgxOTU1Mw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533819553", "bodyText": "Added @DurationMin for all Durations, as well as @Future for all Instants", "author": "ijungmann", "createdAt": "2020-12-02T00:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc4NjgzMg=="}], "type": "inlineReview"}, {"oid": "9f2cb72031cb70cb91890461fd36020e0e11a7db", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9f2cb72031cb70cb91890461fd36020e0e11a7db", "message": "Fix spacing\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-01T23:25:47Z", "type": "commit"}, {"oid": "9549ff461e7ac05706dc963e012f4f754a013e09", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9549ff461e7ac05706dc963e012f4f754a013e09", "message": "Pom fixes\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T00:02:18Z", "type": "commit"}, {"oid": "197577fb1ae51f0989a8315fe0e64c64df50960e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/197577fb1ae51f0989a8315fe0e64c64df50960e", "message": "Remove manual validation\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T00:08:16Z", "type": "commit"}, {"oid": "e2548124be924c12f2ca522e523ddf33c6a8a9fc", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e2548124be924c12f2ca522e523ddf33c6a8a9fc", "message": "Remove required and optional comments and realphabetize\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T00:17:41Z", "type": "commit"}, {"oid": "6c62dab3010a21501446b21217a4f23486d24ce3", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/6c62dab3010a21501446b21217a4f23486d24ce3", "message": "Add better validation for durations and instants\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T00:44:43Z", "type": "commit"}, {"oid": "e28cd8efa5f8c9af60270d2de931ae37cc4c24dd", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/e28cd8efa5f8c9af60270d2de931ae37cc4c24dd", "message": "Remove unused Supplier Exception\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T00:47:28Z", "type": "commit"}, {"oid": "80629c5bccceb1eed1a655abd3c9998a5c15966e", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/80629c5bccceb1eed1a655abd3c9998a5c15966e", "message": "Fix test that checked for now deleted exception\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T00:54:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg4MjIxOA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533882218", "bodyText": "Later, not part of this PR, we can consider creating a custom annotation and validator for these ID fields. Either that or use a wrapper object to validate.", "author": "steven-sheehy", "createdAt": "2020-12-02T04:03:32Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/account/CryptoTransferTransactionSupplier.java", "diffHunk": "@@ -20,45 +20,37 @@\n  * \u200d\n  */\n \n-import java.util.Arrays;\n-import java.util.List;\n-import lombok.Builder;\n-import lombok.Value;\n+import javax.validation.constraints.Min;\n+import javax.validation.constraints.NotBlank;\n+import lombok.Data;\n import org.apache.commons.lang3.StringUtils;\n \n import com.hedera.datagenerator.common.Utility;\n import com.hedera.datagenerator.sdk.supplier.TransactionSupplier;\n-import com.hedera.datagenerator.sdk.supplier.TransactionSupplierException;\n import com.hedera.hashgraph.sdk.account.AccountId;\n import com.hedera.hashgraph.sdk.account.TransferTransaction;\n import com.hedera.hashgraph.sdk.token.TokenId;\n \n-@Builder\n-@Value\n+@Data\n public class CryptoTransferTransactionSupplier implements TransactionSupplier<TransferTransaction> {\n \n-    private static final List<String> requiredFields = Arrays.asList(\"recipientAccountId\", \"senderAccountId\");\n+    @Min(1)\n+    private long amount = 1;\n \n-    //Required\n-    private final String recipientAccountId;\n-    private final String senderAccountId;\n+    @Min(1)\n+    private long maxTransactionFee = 1_000_000;\n \n-    //Optional\n-    @Builder.Default\n-    private final long amount = 1;\n+    @NotBlank\n+    private String recipientAccountId;\n \n-    @Builder.Default\n-    private final long maxTransactionFee = 1_000_000;\n+    @NotBlank\n+    private String senderAccountId;\n \n-    private final String tokenId;\n+    private String tokenId;", "originalCommit": "80629c5bccceb1eed1a655abd3c9998a5c15966e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg5MDUzMw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533890533", "bodyText": "I actually started looking into that and decided to hold off for now, I like the idea.", "author": "ijungmann", "createdAt": "2020-12-02T04:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg4MjIxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg4MjU0Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533882542", "bodyText": "You need to keep @NotNull as @DurationMin still allows null.", "author": "steven-sheehy", "createdAt": "2020-12-02T04:04:32Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/consensus/ConsensusUpdateTopicTransactionSupplier.java", "diffHunk": "@@ -23,49 +23,41 @@\n import java.time.Duration;\n import java.time.Instant;\n import java.time.temporal.ChronoUnit;\n-import java.util.Arrays;\n-import java.util.List;\n-import lombok.Builder;\n-import lombok.Value;\n-import org.apache.commons.lang3.StringUtils;\n+import javax.validation.constraints.Future;\n+import javax.validation.constraints.Min;\n+import javax.validation.constraints.NotBlank;\n+import lombok.Data;\n+import org.hibernate.validator.constraints.time.DurationMin;\n \n import com.hedera.datagenerator.common.Utility;\n import com.hedera.datagenerator.sdk.supplier.TransactionSupplier;\n-import com.hedera.datagenerator.sdk.supplier.TransactionSupplierException;\n import com.hedera.hashgraph.sdk.account.AccountId;\n import com.hedera.hashgraph.sdk.consensus.ConsensusTopicId;\n import com.hedera.hashgraph.sdk.consensus.ConsensusTopicUpdateTransaction;\n import com.hedera.hashgraph.sdk.crypto.ed25519.Ed25519PublicKey;\n \n-@Builder\n-@Value\n+@Data\n public class ConsensusUpdateTopicTransactionSupplier implements TransactionSupplier<ConsensusTopicUpdateTransaction> {\n \n-    private static final List<String> requiredFields = Arrays.asList(\"topicId\");\n+    private String adminKey;\n \n-    //Required\n-    private final String topicId;\n+    private String autoRenewAccountId;\n \n-    //Optional\n-    private final String adminKey;\n-    private final String autoRenewAccountId;\n+    @DurationMin(seconds = 1)", "originalCommit": "80629c5bccceb1eed1a655abd3c9998a5c15966e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg5MTM2Nw==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533891367", "bodyText": "Ah, did not see that, corrected now.", "author": "ijungmann", "createdAt": "2020-12-02T04:37:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg4MjU0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg4MzExNA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533883114", "bodyText": "Same for @Future", "author": "steven-sheehy", "createdAt": "2020-12-02T04:06:29Z", "path": "hedera-mirror-datagenerator/src/main/java/com/hedera/datagenerator/sdk/supplier/consensus/ConsensusUpdateTopicTransactionSupplier.java", "diffHunk": "@@ -23,49 +23,41 @@\n import java.time.Duration;\n import java.time.Instant;\n import java.time.temporal.ChronoUnit;\n-import java.util.Arrays;\n-import java.util.List;\n-import lombok.Builder;\n-import lombok.Value;\n-import org.apache.commons.lang3.StringUtils;\n+import javax.validation.constraints.Future;\n+import javax.validation.constraints.Min;\n+import javax.validation.constraints.NotBlank;\n+import lombok.Data;\n+import org.hibernate.validator.constraints.time.DurationMin;\n \n import com.hedera.datagenerator.common.Utility;\n import com.hedera.datagenerator.sdk.supplier.TransactionSupplier;\n-import com.hedera.datagenerator.sdk.supplier.TransactionSupplierException;\n import com.hedera.hashgraph.sdk.account.AccountId;\n import com.hedera.hashgraph.sdk.consensus.ConsensusTopicId;\n import com.hedera.hashgraph.sdk.consensus.ConsensusTopicUpdateTransaction;\n import com.hedera.hashgraph.sdk.crypto.ed25519.Ed25519PublicKey;\n \n-@Builder\n-@Value\n+@Data\n public class ConsensusUpdateTopicTransactionSupplier implements TransactionSupplier<ConsensusTopicUpdateTransaction> {\n \n-    private static final List<String> requiredFields = Arrays.asList(\"topicId\");\n+    private String adminKey;\n \n-    //Required\n-    private final String topicId;\n+    private String autoRenewAccountId;\n \n-    //Optional\n-    private final String adminKey;\n-    private final String autoRenewAccountId;\n+    @DurationMin(seconds = 1)\n+    private Duration autoRenewPeriod = Duration.ofSeconds(8000000);\n \n-    @Builder.Default\n-    private final Duration autoRenewPeriod = Duration.ofSeconds(8000000);\n+    @Future", "originalCommit": "80629c5bccceb1eed1a655abd3c9998a5c15966e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg5MTM5Ng==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/1304#discussion_r533891396", "bodyText": "Corrected", "author": "ijungmann", "createdAt": "2020-12-02T04:37:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg4MzExNA=="}], "type": "inlineReview"}, {"oid": "ff7d7ef334ab612a7cf6724ce3e95fa6015dfa92", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/ff7d7ef334ab612a7cf6724ce3e95fa6015dfa92", "message": "Put back @NotNull on Duration and Instant\n\nSigned-off-by: Ian Jungmann <ian.jungmann@hedera.com>", "committedDate": "2020-12-02T04:37:07Z", "type": "commit"}]}