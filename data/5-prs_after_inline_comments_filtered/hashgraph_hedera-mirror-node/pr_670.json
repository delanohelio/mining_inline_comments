{"pr_number": 670, "pr_title": "Remove Events", "pr_createdAt": "2020-04-08T18:58:14Z", "pr_url": "https://github.com/hashgraph/hedera-mirror-node/pull/670", "timeline": [{"oid": "bdb89379e6128d94128a6d62209c7dd4522275b9", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/bdb89379e6128d94128a6d62209c7dd4522275b9", "message": "update docs\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T19:09:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MTQ0Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405751442", "bodyText": "The filter isn't even needed. Looks like legacy of old code. Should be removed (if everyone's okay).", "author": "apeksharma", "createdAt": "2020-04-08T19:08:52Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/parser/record/RecordFileParser.java", "diffHunk": "@@ -299,7 +296,7 @@ public void parse() {\n \n                 // add directory prefix to get full path\n                 List<String> fullPaths = Arrays.asList(files).stream()\n-                        .filter(f -> Utility.isRecordFile(f))", "originalCommit": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc5MDkwMQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405790901", "bodyText": "I guess it's just an extra check in case someone puts some unknown file in /valid? I'm okay either way keeping or removing.", "author": "steven-sheehy", "createdAt": "2020-04-08T20:22:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MTQ0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTgwODk4Mg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405808982", "bodyText": "Removed.", "author": "apeksharma", "createdAt": "2020-04-08T20:54:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1MTQ0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1Mjk5NA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405752994", "bodyText": "better to encapsulate each stream's file helpers separately in future", "author": "apeksharma", "createdAt": "2020-04-08T19:11:47Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/FileDelimiter.java", "diffHunk": "@@ -22,13 +22,6 @@\n \n public class FileDelimiter {\n     public static final String HASH_ALGORITHM = \"SHA-384\";\n-    public static final byte EVENT_TYPE_PREV_HASH = 1;       // next 48 bytes are hash384 or previous files", "originalCommit": "a82abecf68fce13dd7c08ba855d1f0bb50437a0b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NDU1MA==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405754550", "bodyText": "removing if-else and pattern matching on files in favor of directly calling appropriate utility functions from fns overridden by downloader implementations.", "author": "apeksharma", "createdAt": "2020-04-08T19:14:32Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -119,110 +103,18 @@ public static boolean hashMatch(byte[] hash, File rcdFile) {\n     }\n \n     /**\n-     * Calculate SHA384 hash of a binary file\n+     * Calculate SHA384 hash of a balance file\n      *\n      * @param fileName file name\n      * @return byte array of hash value of null if calculating has failed\n      */\n-    public static byte[] getFileHash(String fileName) {\n-        MessageDigest md;\n-        if (getFileExtension(fileName).contentEquals(\"rcd\")) {", "originalCommit": "bdb89379e6128d94128a6d62209c7dd4522275b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NTUxNg==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405755516", "bodyText": "removed this for now since a lot of code here and in EventStreamFileParser (removed) seems sharable when done correctly", "author": "apeksharma", "createdAt": "2020-04-08T19:16:15Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -119,110 +103,18 @@ public static boolean hashMatch(byte[] hash, File rcdFile) {\n     }\n \n     /**\n-     * Calculate SHA384 hash of a binary file\n+     * Calculate SHA384 hash of a balance file\n      *\n      * @param fileName file name\n      * @return byte array of hash value of null if calculating has failed\n      */\n-    public static byte[] getFileHash(String fileName) {\n-        MessageDigest md;\n-        if (getFileExtension(fileName).contentEquals(\"rcd\")) {\n-            return getRecordFileHash(fileName);\n-        } else if (getFileExtension(fileName).contentEquals(\"evt\")) {\n-            return getEventFileHash(fileName);\n-        } else {\n-            try {\n-                md = MessageDigest.getInstance(FileDelimiter.HASH_ALGORITHM);\n-\n-                byte[] array = Files.readAllBytes(Paths.get(fileName));\n-                return md.digest(array);\n-            } catch (NoSuchAlgorithmException | IOException e) {\n-                log.error(\"Exception {}\", e);\n-                return null;\n-            }\n-        }\n-    }\n-\n-    /**\n-     * Calculate SHA384 hash of an event file\n-     *\n-     * @param filename file name\n-     * @return byte array of hash value of null if calculating has failed\n-     */\n-    private static byte[] getEventFileHash(String filename) {", "originalCommit": "bdb89379e6128d94128a6d62209c7dd4522275b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTc1NjE1NQ==", "url": "https://github.com/hashgraph/hedera-mirror-node/pull/670#discussion_r405756155", "bodyText": "next 3 functions are dead code.\ngetAccountIDStringFromFilePath isn't needed due to changes in Downloader at top of this PR.", "author": "apeksharma", "createdAt": "2020-04-08T19:17:34Z", "path": "hedera-mirror-importer/src/main/java/com/hedera/mirror/importer/util/Utility.java", "diffHunk": "@@ -396,98 +282,6 @@ public static String bytesToHex(byte[] bytes) {\n         return Hex.encodeHexString(bytes);\n     }\n \n-    /**", "originalCommit": "bdb89379e6128d94128a6d62209c7dd4522275b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "956eae6864e131d24502dd3cca3c057b2c5fd558", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/956eae6864e131d24502dd3cca3c057b2c5fd558", "message": "Remove EventStream downloader and parser\n\n- Removed unused functions in Utility.\n- Leaving t_events table (so no db migration is needed)\n- Removed is<type>File() functions.\n  The ones for balances and event were not being used.\n  Going forward, rather than calling Utility.function() from Downloader.java\n  (or abstracted out parser code in future) which then does regex match and\n  if-else on filename to call appropriate record/event/balance function, we'll\n  use abstract functions in Downloader/Parser and implementations would directly\n  call correct utility function.\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T20:00:19Z", "type": "commit"}, {"oid": "9a919f0539ee78236a7e08e6644963661e9c7dcc", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/9a919f0539ee78236a7e08e6644963661e9c7dcc", "message": "update docs\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T20:00:35Z", "type": "commit"}, {"oid": "08bf49a940ba7cb596c557020eb315ea6f61135d", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/08bf49a940ba7cb596c557020eb315ea6f61135d", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T21:06:54Z", "type": "forcePushed"}, {"oid": "122e9c949f56baa67c9313ce648b82077e482c57", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/122e9c949f56baa67c9313ce648b82077e482c57", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T21:12:02Z", "type": "commit"}, {"oid": "122e9c949f56baa67c9313ce648b82077e482c57", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/122e9c949f56baa67c9313ce648b82077e482c57", "message": "Db migration to remove unused components\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T21:12:02Z", "type": "forcePushed"}, {"oid": "358b5bca84b14905c0b927214589cb003e6449ce", "url": "https://github.com/hashgraph/hedera-mirror-node/commit/358b5bca84b14905c0b927214589cb003e6449ce", "message": "remove codes from t_application_status\n\nSigned-off-by: Apekshit Sharma <apekshit.sharma@hedera.com>", "committedDate": "2020-04-08T21:19:10Z", "type": "commit"}]}