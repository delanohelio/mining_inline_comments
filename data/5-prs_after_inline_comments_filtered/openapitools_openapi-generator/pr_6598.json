{"pr_number": 6598, "pr_title": "[core] Templating: limit compilation to supported extensions and constrain target paths", "pr_createdAt": "2020-06-09T12:00:45Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6598", "timeline": [{"oid": "d3b28d23951499b6b0cf8570ffd9f7ec7b72261c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d3b28d23951499b6b0cf8570ffd9f7ec7b72261c", "message": "[core] Template: compile only supported files\n\nThis forces the template adapters to only consider files with supported\nextensions, otherwise a direct file copy will occur.\n\nThis also includes recommendation from Sonar analysis to ensure file\nwrites are constrained to the target directory.", "committedDate": "2020-06-08T20:21:34Z", "type": "commit"}, {"oid": "71176ecc9944914f641b4bda7e9e0c9aea34e52f", "url": "https://github.com/OpenAPITools/openapi-generator/commit/71176ecc9944914f641b4bda7e9e0c9aea34e52f", "message": ":art: some Sonar quality fixes", "committedDate": "2020-06-08T20:49:30Z", "type": "commit"}, {"oid": "ea9db3396894f79451bcea05ccdbf4d2ad01d0ed", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ea9db3396894f79451bcea05ccdbf4d2ad01d0ed", "message": "[core] Compile template files supported by engine\n\nThis enables core to only pass files through the templating engine if\nthat file extension is supported by the engine. Otherwise, we do a\ndirect file copy.\n\nThis differs from logic in pre-5.0 in which everything but supporting\nfiles would be passed through the engine, and supporting files had\ndifferent logic.\n\nThis also fixes a bug(?) in pre-5.0 in which supporting files may not have\nhonored resolution rules: template dir libraries, template dir root,\nembedded libraries, embedded root, common dir.", "committedDate": "2020-06-09T04:45:19Z", "type": "commit"}, {"oid": "e021c2b51994b69d1e6bbe66432c902e2470ec44", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e021c2b51994b69d1e6bbe66432c902e2470ec44", "message": "Remove relative directory reference in php-symfony-petstore.sh", "committedDate": "2020-06-09T11:47:01Z", "type": "commit"}, {"oid": "17bfeb0eff4d1e62b03a7e31c85bf639fc184228", "url": "https://github.com/OpenAPITools/openapi-generator/commit/17bfeb0eff4d1e62b03a7e31c85bf639fc184228", "message": "[samples] Regenerate", "committedDate": "2020-06-09T11:47:11Z", "type": "commit"}, {"oid": "b095f14448dd26742647d9cc1f037893100817ba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b095f14448dd26742647d9cc1f037893100817ba", "message": "Merge branch 'master' into path-handling\n\n* master:\n  [ci][cli] Moving ensures script to config-based batch generation of samples (#6509)\n  Add Instana to the list of users (#6584)\n  [rust][reqwest] fix broken export (#6586)", "committedDate": "2020-06-09T11:56:19Z", "type": "commit"}, {"oid": "bbfc66d20ac3e86ec4c0f178d44c42f2b55ab53d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/bbfc66d20ac3e86ec4c0f178d44c42f2b55ab53d", "message": "[samples] Regenerate", "committedDate": "2020-06-09T12:04:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1ODE0OQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6598#discussion_r437358149", "bodyText": "lastIndexOf taking character is more performant", "author": "jimschubert", "createdAt": "2020-06-09T12:09:59Z", "path": "modules/openapi-generator-core/src/main/java/org/openapitools/codegen/api/TemplatingEngineAdapter.java", "diffHunk": "@@ -65,9 +75,10 @@ String compileTemplate(TemplatingExecutor executor, Map<String, Object> bundle,\n      * @param templateFile The original target filename\n      * @return True if the template is available in the template search path, false if it can not be found\n      */\n+    @SuppressWarnings({\"java:S2093\"}) // ignore java:S2093 because we have double-assignment to the closeable\n     default boolean templateExists(TemplatingExecutor generator, String templateFile) {\n         return Arrays.stream(getFileExtensions()).anyMatch(ext -> {\n-            int idx = templateFile.lastIndexOf(\".\");\n+            int idx = templateFile.lastIndexOf('.');", "originalCommit": "bbfc66d20ac3e86ec4c0f178d44c42f2b55ab53d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1ODgyMg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6598#discussion_r437358822", "bodyText": "This fixes what I believe may have been a bug prior to this change\u2026\u00a0supporting files may not have resolved using the libraries path rules appropriately.", "author": "jimschubert", "createdAt": "2020-06-09T12:11:14Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/TemplateManager.java", "diffHunk": "@@ -145,18 +158,32 @@ public Reader getTemplateReader(String name) {\n      */\n     @Override\n     public File write(Map<String, Object> data, String template, File target) throws IOException {\n-        String templateContent = this.engineAdapter.compileTemplate(this, data, template);\n-        return writeToFile(target.getPath(), templateContent);\n+        if (this.engineAdapter.handlesFile(template)) {\n+            // Only pass files with valid endings through template engine\n+            String templateContent = this.engineAdapter.compileTemplate(this, data, template);\n+            return writeToFile(target.getPath(), templateContent);\n+        } else {\n+            // Do a straight copy of the file if not listed as supported by the template engine.\n+            InputStream is;\n+            try {\n+                // look up the file using the same template resolution logic the adapters would use.\n+                String fullTemplatePath = getFullTemplateFile(template);", "originalCommit": "bbfc66d20ac3e86ec4c0f178d44c42f2b55ab53d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzM1OTIyNw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6598#discussion_r437359227", "bodyText": "%n uses system-specific newline rather than newline only.", "author": "jimschubert", "createdAt": "2020-06-09T12:11:54Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/TemplatingEngineLoader.java", "diffHunk": "@@ -37,7 +42,7 @@ public static TemplatingEngineAdapter byIdentifier(String id) {\n             // Attempt to load skipping SPI\n             return (TemplatingEngineAdapter) Class.forName(id).getDeclaredConstructor().newInstance();\n         } catch (Exception e) {\n-            throw new RuntimeException(String.format(Locale.ROOT, \"Couldn't load template engine adapter %s. Available options: \\n%s\", id, sb.toString()), e);\n+            throw new RuntimeException(String.format(Locale.ROOT, \"Couldn't load template engine adapter %s. Available options: %n%s\", id, sb.toString()), e);", "originalCommit": "bbfc66d20ac3e86ec4c0f178d44c42f2b55ab53d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3574e9c1f0b4259ee0c185d50be5815e18fa8903", "url": "https://github.com/OpenAPITools/openapi-generator/commit/3574e9c1f0b4259ee0c185d50be5815e18fa8903", "message": "Merge branch 'master' into path-handling\n\n* master: (142 commits)\n  update python samples\n  clarify direction of py client side validation flag (#6850)\n  fix erronous cmd arg example for docker in readme (#6846)\n  [BUG] [JAVA] Fix multiple files upload (#4803) (#6808)\n  [kotlin][client] fix retrofit dependencies (#6836)\n  [PowerShell] add more fields to be customized (#6835)\n  [Java][WebClient]remove the dead code from java ApiClient.mustache (#6556)\n  [PHP] Better handling of invalid data (array) (#6760)\n  Make ApiClient in retrofit2 be able to use own OkHttpClient (#6699)\n  mark python2 support in flask as deprecated (#6653)\n  update samples\n  [Java][jersey2] Add a getter for the User-Agent header value (#6831)\n  Provides a default nil value for optional init parameters (#6827)\n  [Java] Deprecate feignVersion option (#6824)\n  [R] Enum R6Class Support, closes #3367 (#5728)\n  [Rust][Client] Unify sync/async client structure (#6753)\n  [php-ze-ph] Set required PHP version to ^7.2 (#6763)\n  [Java][client][native][Gradle] Add missing jackson-databind-nullable (#6802)\n  Improve sttpOpenApiClient generator (#6684)\n  Update docker-tag-latest-release.yml\n  ...", "committedDate": "2020-07-03T18:49:51Z", "type": "commit"}, {"oid": "36e8a3b36507860a55424f9542bf089c0e4eef79", "url": "https://github.com/OpenAPITools/openapi-generator/commit/36e8a3b36507860a55424f9542bf089c0e4eef79", "message": "Regenerate samples", "committedDate": "2020-07-03T18:50:45Z", "type": "commit"}, {"oid": "48ca3aa871ed539b4e642d86ec34cfa9b8a30f33", "url": "https://github.com/OpenAPITools/openapi-generator/commit/48ca3aa871ed539b4e642d86ec34cfa9b8a30f33", "message": "Merge branch 'master' into path-handling\n\n* master:\n  Remove jimschubert from C# technical committee (#6865)\n  Add Mock Server client modification feature (#6747)\n  Update documentation with global propperty (#6863)\n  [haskell-http-client] avoid depending on ParseTime,FormatTime (#6861)\n  Update docker-tag-latest-release.yml", "committedDate": "2020-07-07T02:02:31Z", "type": "commit"}, {"oid": "f3db22c6c4770049121e0db59fb209ea66a4cb0c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/f3db22c6c4770049121e0db59fb209ea66a4cb0c", "message": "Merge branch 'master' into path-handling\n\n* master: (129 commits)\n  [typescript-axios] add promise to bearer and oauth tokens (#7132)\n  update doc\n  [REQ] Added enumClassPrefix option to Go server generation (#7008)\n  [Java][jersey2] Add helper methods for oneOf Java classes (#7115)\n  [Kotlin][Retrofit2] fix missing import for file (#7121)\n  adding handling for epoch dates in javascript ApiClient mustache file (#6497) (#6504)\n  update doc\n  comment out cpanm in travis\n  [Kotlin] Rxjava3 support (#6998)\n  [BUG][JAVA] Fix error handling in okhttp-gson async api client (#7089)\n  Update to reset httpRepsonse.Body (#6948)\n  [php-lumen] Set required PHP version to ^7.2.5 (#6949)\n  [contrib][docs] Assert importance of title/description/repro steps (#7103)\n  ISSUE-4222: Prevent conflicts with accept(s) local variables in generated Java RestTemplate ApiClient (#7101)\n  [bug][core] Copy all attributes (not properties) on composed schemas when flattening models (#7106)\n  [core] Add type and format properties to model of inline response (#6153)\n  [PowerShell] better publishing workflow (#7114)\n  [aspnetcore] Typo issues in docs and generated code (#7094)\n  fix http signaure auth in build.sbt (#7110)\n  fix for the issue facing spec invlolving arrayschema structure with ref (#6310)\n  ...", "committedDate": "2020-08-06T00:41:55Z", "type": "commit"}, {"oid": "4c9b64f368e8d10b82204042a24a182007278502", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4c9b64f368e8d10b82204042a24a182007278502", "message": "Merge branch 'master' into path-handling\n\n* master: (27 commits)\n  [WIP][python-exp] Force camelization of imports (#7186)\n  Fixes #6942: Added ability to prepend a basePath to typescript-redux-query generators (#6943)\n  [Typescript] Import path is invalid in windows. (#7175)\n  Fix JaxRS Spec generator additional model types (#7180)\n  [python{,-experimental}] Obey floating point timeouts provided to RESTClientObject.request(...) (#7154)\n  [C#] Switch the spec to OAS v3 from v2 (#7176)\n  [Javascript] Fixing the handling of non primitive types in paramToString (#7171) (#7172)\n  [typescript-node] Fix invalid type when using node@10 and ES5 (#7133)\n  Minor fix to github workflow badge\n  [gradle] Enabling up-to-date checks and gradle caching for openapigenerator tasks (#6716)\n  feat(csharp-netcore): Adding response headers to the ApiException (#7169)\n  [ci] Verify supported JDK versions on master push (#7085)\n  Issue #6830: Java server - Add getter to ApiException templates (#7150)\n  update kotlin samples\n  [Kotlin] Make ApiClient in jvm-retrofit2 be able to use own OkHttpClient (#6999)\n  Sttp - wrap query params (#6884)\n  Add a link to https://medium.com/@everisBrasil blog post (#7160)\n  [C#][netcore] fix regular expression when it contains double quotes (#7147)\n  remove duplicated cancellationToken in comment (#7148)\n  update samples\n  ...", "committedDate": "2020-08-12T01:09:29Z", "type": "commit"}, {"oid": "5e01c65e568bd7b4f888eddb8667c882a065f654", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5e01c65e568bd7b4f888eddb8667c882a065f654", "message": "[php-lumen] Rename mustache templates with correct file extension", "committedDate": "2020-08-12T02:39:13Z", "type": "commit"}, {"oid": "164fd7d5012eb3da4d6ab76bde966e20bf98c449", "url": "https://github.com/OpenAPITools/openapi-generator/commit/164fd7d5012eb3da4d6ab76bde966e20bf98c449", "message": "Merge branch 'master' into path-handling\n\n* master: (89 commits)\n  add structPrefix support to go-experimental (#7327)\n  Add a link to SmartHR Tech Blog (#7324)\n  Revert \"Correct allOf with only one child schema (no discriminator)\" (#7323)\n  Correct allOf with only one child schema (no discriminator) (#6901)\n  [Go]: Interface definitions for api functions (#5914)\n  Update bug_report.md (#7320)\n  update samples\n  [Java][Client] Use java8 OffsetDateTime for clients (#7190)\n  [java] Intro openApiNullable property to enable/disable OpenAPI Jackson Nullable library (#6154)\n  [Spring Boot] update dependencies, mark java8 option as deprecated (#7306)\n  Remove dot in golang type (#7307)\n  [doc] Document usage of post-process file feature (#7315)\n  fix http bear auth documentation for go clinets (#7312)\n  [Extensions][Go][Java] Test x-auth-id-alias (#6642)\n  [php-slim4] Move config to a separate file (#6971)\n  [C][Client][Clang Static Analyzer] Remove the useless free operation for (#7309)\n  Fix typescript-node generation when only models are generated (#7127)\n  update spring config to use java8 (#7308)\n  [C][Client][Clang Static Analyzer] Fix uninitialized argument value (#7305)\n  [Java] remove deprecated jackson classes (#7304)\n  ...", "committedDate": "2020-09-02T01:11:52Z", "type": "commit"}, {"oid": "73d58ac899a6153aaad07d33c07b06541ffaab44", "url": "https://github.com/OpenAPITools/openapi-generator/commit/73d58ac899a6153aaad07d33c07b06541ffaab44", "message": "[samples] Regenerated", "committedDate": "2020-09-02T01:20:10Z", "type": "commit"}, {"oid": "837ff0245c14e35a3e6418bbc34b6232dbf035f9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/837ff0245c14e35a3e6418bbc34b6232dbf035f9", "message": "Add target/outDir to error requiring target under outDir", "committedDate": "2020-09-02T12:16:03Z", "type": "commit"}, {"oid": "37fce4e41ff52f0c67aa458838d3047aa623c468", "url": "https://github.com/OpenAPITools/openapi-generator/commit/37fce4e41ff52f0c67aa458838d3047aa623c468", "message": "[bug][python-blueplanet] Fix docs writing to invalid output when outDir contains period", "committedDate": "2020-09-02T12:30:05Z", "type": "commit"}]}