{"pr_number": 6518, "pr_title": "[Java][Jersey2] various improvements", "pr_createdAt": "2020-06-02T07:58:36Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6518", "timeline": [{"oid": "e05439c46eae0f8415f22f3e294b2d79e43cb9d8", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e05439c46eae0f8415f22f3e294b2d79e43cb9d8", "message": "[java][jersey2] Add support for discriminator, fix nullable typo and nullable deserialization (#6495)\n\n* Mustache template should use invokerPackage tag to generate import\r\n\r\n* fix typo, fix script issue, add log statement for troubleshooting\r\n\r\n* Add java jersey2 samples with OpenAPI doc that has HTTP signature security scheme\r\n\r\n* Add sample for Java jersey2 and HTTP signature scheme\r\n\r\n* Add unit test for oneOf schema deserialization\r\n\r\n* Add unit test for oneOf schema deserialization\r\n\r\n* Add log statements\r\n\r\n* Add profile for jersey2\r\n\r\n* Temporarily disable unit test\r\n\r\n* Temporarily disable unit test\r\n\r\n* support for discriminator in jersey2\r\n\r\n* fix typo in pom.xml\r\n\r\n* disable unit test because jersey2 deserialization is broken\r\n\r\n* disable unit test because jersey2 deserialization is broken\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* Add code comments\r\n\r\n* fix duplicate artifact id\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* run samples scripts\r\n\r\n* resolve merge conflicts\r\n\r\n* Add unit tests\r\n\r\n* fix unit tests\r\n\r\n* continue implementation of discriminator lookup\r\n\r\n* throw deserialization exception when value is null and schema does not allow null value\r\n\r\n* continue implementation of compose schema\r\n\r\n* continue implementation of compose schema\r\n\r\n* continue implementation of compose schema\r\n\r\n* Add more unit tests\r\n\r\n* Add unit tests for anyOf\r\n\r\n* Add unit tests\r\n\r\nCo-authored-by: Vikrant Balyan (vvb) <vvb@cisco.com>", "committedDate": "2020-06-02T07:47:26Z", "type": "commit"}, {"oid": "8adfea73c344c6e03cc5761df79f9ae8a060cd42", "url": "https://github.com/OpenAPITools/openapi-generator/commit/8adfea73c344c6e03cc5761df79f9ae8a060cd42", "message": "update samples", "committedDate": "2020-06-02T07:53:42Z", "type": "commit"}, {"oid": "e87ddc3d0c5d8594a7314f9b196f01f919a738f9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e87ddc3d0c5d8594a7314f9b196f01f919a738f9", "message": "Merge remote-tracking branch 'origin/master' into jersey2-improvement", "committedDate": "2020-06-02T09:19:24Z", "type": "commit"}, {"oid": "b1027672d2e3b5342a8a67aa374e005f033a2f30", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b1027672d2e3b5342a8a67aa374e005f033a2f30", "message": "add tests to oas3 java jersey2 petstore", "committedDate": "2020-06-02T09:57:02Z", "type": "commit"}, {"oid": "d0d267fc5f7362b7d02fcbc66e9736ee86e5c0fd", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d0d267fc5f7362b7d02fcbc66e9736ee86e5c0fd", "message": "comment out jersey2 ensure uptodate", "committedDate": "2020-06-05T00:12:37Z", "type": "commit"}, {"oid": "bbe7976b2ead353084ba7c34492f7a25e12f75fd", "url": "https://github.com/OpenAPITools/openapi-generator/commit/bbe7976b2ead353084ba7c34492f7a25e12f75fd", "message": "Merge remote-tracking branch 'origin/master' into jersey2-improvement", "committedDate": "2020-06-05T06:34:29Z", "type": "commit"}, {"oid": "1bcc917b340cd43cee7d7b6e9cee7de3f367e78a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/1bcc917b340cd43cee7d7b6e9cee7de3f367e78a", "message": "Jersey2 supports additional properties with composed schema (#6523)\n\n* Mustache template should use invokerPackage tag to generate import\r\n\r\n* fix typo, fix script issue, add log statement for troubleshooting\r\n\r\n* Add java jersey2 samples with OpenAPI doc that has HTTP signature security scheme\r\n\r\n* Add sample for Java jersey2 and HTTP signature scheme\r\n\r\n* Add unit test for oneOf schema deserialization\r\n\r\n* Add unit test for oneOf schema deserialization\r\n\r\n* Add log statements\r\n\r\n* Add profile for jersey2\r\n\r\n* Temporarily disable unit test\r\n\r\n* Temporarily disable unit test\r\n\r\n* support for discriminator in jersey2\r\n\r\n* fix typo in pom.xml\r\n\r\n* disable unit test because jersey2 deserialization is broken\r\n\r\n* disable unit test because jersey2 deserialization is broken\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* Add code comments\r\n\r\n* fix duplicate artifact id\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* run samples scripts\r\n\r\n* resolve merge conflicts\r\n\r\n* Add unit tests\r\n\r\n* fix unit tests\r\n\r\n* continue implementation of discriminator lookup\r\n\r\n* throw deserialization exception when value is null and schema does not allow null value\r\n\r\n* continue implementation of compose schema\r\n\r\n* continue implementation of compose schema\r\n\r\n* continue implementation of compose schema\r\n\r\n* Add more unit tests\r\n\r\n* Add unit tests for anyOf\r\n\r\n* Add unit tests\r\n\r\n* Set supportsAdditionalPropertiesWithComposedSchema to true for Java jersey2\r\n\r\n* Support additional properties as nested field\r\n\r\n* Support additional properties as nested field\r\n\r\n* add code comments\r\n\r\n* add customer deserializer\r\n\r\n* Fix 'method too big' error with generated code\r\n\r\n* resolve merge conflicts\r\n\r\nCo-authored-by: Vikrant Balyan (vvb) <vvb@cisco.com>", "committedDate": "2020-06-05T16:06:13Z", "type": "commit"}, {"oid": "477ee406ea33b5a68cd3acfcc9ccb3ce1cca237d", "url": "https://github.com/OpenAPITools/openapi-generator/commit/477ee406ea33b5a68cd3acfcc9ccb3ce1cca237d", "message": "[Jersey2] Fix code generation of 'registerDiscriminator' method for large models (#6535)\n\n* Mustache template should use invokerPackage tag to generate import\r\n\r\n* fix typo, fix script issue, add log statement for troubleshooting\r\n\r\n* Add java jersey2 samples with OpenAPI doc that has HTTP signature security scheme\r\n\r\n* Add sample for Java jersey2 and HTTP signature scheme\r\n\r\n* Add unit test for oneOf schema deserialization\r\n\r\n* Add unit test for oneOf schema deserialization\r\n\r\n* Add log statements\r\n\r\n* Add profile for jersey2\r\n\r\n* Temporarily disable unit test\r\n\r\n* Temporarily disable unit test\r\n\r\n* support for discriminator in jersey2\r\n\r\n* fix typo in pom.xml\r\n\r\n* disable unit test because jersey2 deserialization is broken\r\n\r\n* disable unit test because jersey2 deserialization is broken\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* Add code comments\r\n\r\n* fix duplicate artifact id\r\n\r\n* fix duplicate jersey2 samples\r\n\r\n* run samples scripts\r\n\r\n* resolve merge conflicts\r\n\r\n* Add unit tests\r\n\r\n* fix unit tests\r\n\r\n* continue implementation of discriminator lookup\r\n\r\n* throw deserialization exception when value is null and schema does not allow null value\r\n\r\n* continue implementation of compose schema\r\n\r\n* continue implementation of compose schema\r\n\r\n* continue implementation of compose schema\r\n\r\n* Add more unit tests\r\n\r\n* Add unit tests for anyOf\r\n\r\n* Add unit tests\r\n\r\n* Fix 'method too big' error with generated code\r\n\r\n* resolve merge conflicts\r\n\r\nCo-authored-by: Vikrant Balyan (vvb) <vvb@cisco.com>", "committedDate": "2020-06-05T16:20:20Z", "type": "commit"}, {"oid": "4d5c6c2e5db681679e7a44e7404d02b93a604974", "url": "https://github.com/OpenAPITools/openapi-generator/commit/4d5c6c2e5db681679e7a44e7404d02b93a604974", "message": "update samples", "committedDate": "2020-06-07T00:06:29Z", "type": "commit"}, {"oid": "0d2492faeb0a7cc4fb63287e8cbbddfc76871aab", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0d2492faeb0a7cc4fb63287e8cbbddfc76871aab", "message": "comment out tests", "committedDate": "2020-06-07T00:42:31Z", "type": "commit"}, {"oid": "0e4461c55cb12b63049a702a54824006ba86b6c3", "url": "https://github.com/OpenAPITools/openapi-generator/commit/0e4461c55cb12b63049a702a54824006ba86b6c3", "message": "support additional properties in serialize and deserialize", "committedDate": "2020-06-07T06:25:28Z", "type": "commit"}, {"oid": "9b8af5ef1e1120d0a1bbd2934fd2f59cc0acb6f8", "url": "https://github.com/OpenAPITools/openapi-generator/commit/9b8af5ef1e1120d0a1bbd2934fd2f59cc0acb6f8", "message": "add discriminator lookup", "committedDate": "2020-06-07T13:40:01Z", "type": "commit"}, {"oid": "ebc5a09e30f69743eba44bd45377f23c035e37c9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ebc5a09e30f69743eba44bd45377f23c035e37c9", "message": "remove oneof/anyof logic in apilcient", "committedDate": "2020-06-08T08:29:24Z", "type": "commit"}, {"oid": "2af026006f574340a4fa9e2836d6fdcdd3701248", "url": "https://github.com/OpenAPITools/openapi-generator/commit/2af026006f574340a4fa9e2836d6fdcdd3701248", "message": "add serializer to mammal.java", "committedDate": "2020-06-08T09:03:54Z", "type": "commit"}, {"oid": "ab4941d3463661d567c7b25b4f91550e4602d678", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ab4941d3463661d567c7b25b4f91550e4602d678", "message": "add serialize to oneOf model", "committedDate": "2020-06-08T09:17:39Z", "type": "commit"}, {"oid": "c7f24402b9fe473809efd3ddeda70bfa92a7554c", "url": "https://github.com/OpenAPITools/openapi-generator/commit/c7f24402b9fe473809efd3ddeda70bfa92a7554c", "message": "add serializer to anyof model", "committedDate": "2020-06-08T09:21:04Z", "type": "commit"}, {"oid": "e588568a6acaee3cde28fd180b7a8bc70134991e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/e588568a6acaee3cde28fd180b7a8bc70134991e", "message": "comment out test cases that are subject to further discussion", "committedDate": "2020-06-09T07:49:12Z", "type": "commit"}, {"oid": "ece02d62165ffcebde0572c6b02e36e5063fc94a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/ece02d62165ffcebde0572c6b02e36e5063fc94a", "message": "add back files", "committedDate": "2020-06-09T09:21:28Z", "type": "commit"}, {"oid": "d6b6feefed7261287d396022e21fdfe49fd2b2c9", "url": "https://github.com/OpenAPITools/openapi-generator/commit/d6b6feefed7261287d396022e21fdfe49fd2b2c9", "message": "Merge remote-tracking branch 'origin/master' into jersey2-improvement", "committedDate": "2020-06-09T10:30:53Z", "type": "commit"}, {"oid": "087382196e36b06c9be43221cee2815dd1e68cba", "url": "https://github.com/OpenAPITools/openapi-generator/commit/087382196e36b06c9be43221cee2815dd1e68cba", "message": "update configs, samples", "committedDate": "2020-06-09T12:59:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY2NzkyNg==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6518#discussion_r437667926", "bodyText": "So it looks like this sets this.instance = to the deserialized instance of BasquePig where this is a Pig instance? Is that right?\nWhy include the BasquePig instances in this Pig instance vs just returning the instance of BasquePig?\nYou mentioned a use case when a client may want to change the type of an instance from\nBasquePig to DanishPig.\nThat is possible if one knows about the ancestor class Pig, which the client would know because that is the data type that is being deserialized.\nMy understanding is that you want a client to be able to change a model instance class type(BasquePig/DanishPig) given only the deserialized instance and NOT having to know about the ingested data type, is that right?\nCan you describe a more realistic use case than converting pig types?\nWhy do clients need this ability to change model instance types given a model instance only?", "author": "spacether", "createdAt": "2020-06-09T19:30:13Z", "path": "samples/openapi3/client/petstore/java/jersey2-java8/src/main/java/org/openapitools/client/model/Pig.java", "diffHunk": "@@ -60,12 +88,30 @@ public PigDeserializer(Class<?> vc) {\n         @Override\n         public Pig deserialize(JsonParser jp, DeserializationContext ctxt) throws IOException, JsonProcessingException {\n             JsonNode tree = jp.readValueAsTree();\n+            Object deserialized = null;\n+            Pig newPig = new Pig();\n+            Map<String,Object> result2 = tree.traverse(jp.getCodec()).readValueAs(new TypeReference<Map<String, Object>>() {});\n+            String discriminatorValue = (String)result2.get(\"className\");\n+            switch (discriminatorValue) {\n+                case \"BasquePig\":\n+                    deserialized = tree.traverse(jp.getCodec()).readValueAs(BasquePig.class);\n+                    newPig.setActualInstance(deserialized);\n+                    return newPig;", "originalCommit": "087382196e36b06c9be43221cee2815dd1e68cba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzg0MzMzOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6518#discussion_r437843339", "bodyText": "So it looks like this sets this.instance = to the deserialized instance of BasquePig where this is a Pig instance? Is that right?\n\nYes\n\nWhy include the BasquePig instances in this Pig instance vs just returning the instance of BasquePig?\n\nBecause Pig is an oneOf. Just returning BasqueBig means the client will lose the information that the return type is oneOf and DanishPig is another possibility.\n\nThat is possible if one knows about the ancestor class Pig, which the client would know because that is the data type that is being deserialized.\n\nYou mean DanishPig stores the oneOf schema information (Pig in this case)? What if DanishPig happens to be the oneOf schema node in \"Creature\" or \"Animal\" oneOf schema?\n\nMy understanding is that you want a client to be able to change a model instance class type(BasquePig/DanishPig) given only the deserialized instance and NOT having to know about the ingested data type, is that right?\n\nOne can change the model (DanishPig or BasqueBig) in the client side independent of how \"Pig\" is created - whether it's deserialized from a payload returned by the server or it's created in the client side from scratch.\n\nCan you describe a more realistic use case than converting pig types?\n\n\nThe client calls the petPig and gets a Pig (which happens to be a DanishPig in this example)\nThe client changes the instance from DanishPig to Snake and got an error (which is the expected behaviour according to the spec)\nThe client changes the instance form DanishPig to BasqueBig and got no error\nThe client calls updatePet with the Pig object (originally obtained from getPig) with the underlying instance set to BasqueBig in the above step\nThe server checks the payload (BasqueBig) and accepts it since it conforms to the Pig definition (oneOf)\n\nI would suggest you step back from actual use case as OpenAPI spec is a contract and the implementation should work with respect to the contract. (this is not to say real use cases are bad)", "author": "wing328", "createdAt": "2020-06-10T03:45:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY2NzkyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODE5ODU0OQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6518#discussion_r438198549", "bodyText": "I would suggest you step back from actual use case as OpenAPI spec is a contract and the implementation should work with respect to the contract. (this is not to say real use cases are bad)\n\nCan you point to a section of the OAI spec where the \"contract\" would be broken if the SDK returns a BasquePig instead of Pig? The OAI spec is mostly about validation. I don't see wording that states what kind of implementation objects a client is supposed to return or generate.\nIMO, a client should be able to expose all of the following methods. I don't see anything in the spec that would block a client from exposing useful methods to the application code. There isn't a single \"right\" method.\n\nA method that returns the direct oneOf schema, e.g. Pig in this example.\nA method that returns the most concrete schema instance, e.g. BasquePig in this example\nA method that returns the raw JSON node\nAny other method that the SDK developer think is useful to application developers.", "author": "sebastien-rosset", "createdAt": "2020-06-10T15:09:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzY2NzkyNg=="}], "type": "inlineReview"}]}