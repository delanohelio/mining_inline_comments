{"pr_number": 6458, "pr_title": "[python] Fix date-time parsing", "pr_createdAt": "2020-05-27T20:16:05Z", "pr_url": "https://github.com/OpenAPITools/openapi-generator/pull/6458", "timeline": [{"oid": "7f71c5f4c60cdae5699186319c4666d5b64db899", "url": "https://github.com/OpenAPITools/openapi-generator/commit/7f71c5f4c60cdae5699186319c4666d5b64db899", "message": "Date and date-time examples", "committedDate": "2020-05-27T20:14:23Z", "type": "commit"}, {"oid": "54d14bddaf3615a26242d76381a13efe29d55052", "url": "https://github.com/OpenAPITools/openapi-generator/commit/54d14bddaf3615a26242d76381a13efe29d55052", "message": "[python-experimental] fix date-time processing", "committedDate": "2020-05-27T20:14:23Z", "type": "commit"}, {"oid": "b4192348c8594c23612cdf00e2b20a7655bac423", "url": "https://github.com/OpenAPITools/openapi-generator/commit/b4192348c8594c23612cdf00e2b20a7655bac423", "message": "Apply suggestions from code review", "committedDate": "2020-05-29T16:42:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc0OTIyOA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r432749228", "bodyText": "Can you explain what this code is doing?\nIs it assigning the UTC time zone if the date lacks a time zone?\nIf so I am concerned that we are adding information which is not present.\nIs there a spec which directs us to do this?\nWhat happens when invalid values are set as examples/defaults like \"1-2\" or \"NotADateOrDateTime\"?\nHow about adding a sample spec with invalid dates at:\nhttps://github.com/OpenAPITools/openapi-generator/tree/master/modules/openapi-generator/src/test/resources/2_0/issue-xxx.yaml\nAnd adding a pythonclientexperimentaltest.java test case?", "author": "spacether", "createdAt": "2020-05-29T21:42:50Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -235,15 +235,19 @@ public String toDefaultValue(Schema p) {\n             // convert the example if it exists\n             Object currentExample = p.getExample();\n             if (currentExample != null) {\n-                date = (Date) currentExample;\n+                try {\n+                    date = (OffsetDateTime) currentExample;\n+                } catch (ClassCastException e) {\n+                    date = ((Date) currentExample).toInstant().atOffset(ZoneOffset.UTC);", "originalCommit": "b4192348c8594c23612cdf00e2b20a7655bac423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MjI0Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r432882246", "bodyText": "@spacether this is a common pattern. Whatever the date refers to (LocalDate without offset, UTC with offset), it'll represent a single instant since the epoch. Once you have that instant, the only way to accurately represent it is at UTC offset. That call gives you an OffsetDateTime which can accurately hold ISO8601 date-time as defined in the OpenAPI Specification.", "author": "jimschubert", "createdAt": "2020-05-30T19:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjc0OTIyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MjQ4NA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r432882484", "bodyText": "I'd recommend using DateTimeFormatter.ISO_DATE_TIME, which accurately represents the structure supported by the date-time datatype of OpenAPI Spec.", "author": "jimschubert", "createdAt": "2020-05-30T19:57:55Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -212,20 +213,19 @@ public String toDefaultValue(Schema p) {\n         }\n \n         // convert datetime and date enums if they exist\n-        DateFormat iso8601Date = new SimpleDateFormat(\"yyyy-MM-dd\", Locale.ROOT);\n-        DateFormat iso8601DateTime = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSXXX\", Locale.ROOT);\n-        TimeZone utc = TimeZone.getTimeZone(\"UTC\");\n-        iso8601Date.setTimeZone(utc);\n-        iso8601DateTime.setTimeZone(utc);\n+        DateTimeFormatter iso8601Date = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\", Locale.ROOT);\n+        DateTimeFormatter iso8601DateTime = DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSSXXX\", Locale.ROOT);", "originalCommit": "b4192348c8594c23612cdf00e2b20a7655bac423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4NDI3MA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r433184270", "bodyText": "Thanks! I have changed the formatter.", "author": "jirikuncar", "createdAt": "2020-06-01T11:35:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MjQ4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MjcxNA==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r432882714", "bodyText": "I'd recommend using DateTimeFormatter.ISO_LOCAL_DATE which resolves values strictly. That is, it will fail for invalid dates.", "author": "jimschubert", "createdAt": "2020-05-30T20:01:21Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -212,20 +213,19 @@ public String toDefaultValue(Schema p) {\n         }\n \n         // convert datetime and date enums if they exist\n-        DateFormat iso8601Date = new SimpleDateFormat(\"yyyy-MM-dd\", Locale.ROOT);\n-        DateFormat iso8601DateTime = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSXXX\", Locale.ROOT);\n-        TimeZone utc = TimeZone.getTimeZone(\"UTC\");\n-        iso8601Date.setTimeZone(utc);\n-        iso8601DateTime.setTimeZone(utc);\n+        DateTimeFormatter iso8601Date = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\", Locale.ROOT);", "originalCommit": "b4192348c8594c23612cdf00e2b20a7655bac423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4NDMxOQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r433184319", "bodyText": "Done!", "author": "jirikuncar", "createdAt": "2020-06-01T11:35:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4MjcxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Mjg0NQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r432882845", "bodyText": "I think this and the following line will result in odd conversion if the input is not in UTC?", "author": "jimschubert", "createdAt": "2020-05-30T20:03:25Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -212,20 +213,19 @@ public String toDefaultValue(Schema p) {\n         }\n \n         // convert datetime and date enums if they exist\n-        DateFormat iso8601Date = new SimpleDateFormat(\"yyyy-MM-dd\", Locale.ROOT);\n-        DateFormat iso8601DateTime = new SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ss.SSSXXX\", Locale.ROOT);\n-        TimeZone utc = TimeZone.getTimeZone(\"UTC\");\n-        iso8601Date.setTimeZone(utc);\n-        iso8601DateTime.setTimeZone(utc);\n+        DateTimeFormatter iso8601Date = DateTimeFormatter.ofPattern(\"yyyy-MM-dd\", Locale.ROOT);\n+        DateTimeFormatter iso8601DateTime = DateTimeFormatter.ofPattern(\"yyyy-MM-dd'T'HH:mm:ss.SSSXXX\", Locale.ROOT);\n+        iso8601Date.withZone(ZoneOffset.UTC.normalized());", "originalCommit": "b4192348c8594c23612cdf00e2b20a7655bac423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4NDM5Nw==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r433184397", "bodyText": "I have removed it.", "author": "jirikuncar", "createdAt": "2020-06-01T11:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Mjg0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Mjg4Ng==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r432882886", "bodyText": "This second operation should probably be wrapped in a try/catch with a warning which returns an empty string whenever the value can't be parsed.", "author": "jimschubert", "createdAt": "2020-05-30T20:04:20Z", "path": "modules/openapi-generator/src/main/java/org/openapitools/codegen/languages/PythonClientExperimentalCodegen.java", "diffHunk": "@@ -235,15 +235,19 @@ public String toDefaultValue(Schema p) {\n             // convert the example if it exists\n             Object currentExample = p.getExample();\n             if (currentExample != null) {\n-                date = (Date) currentExample;\n+                try {\n+                    date = (OffsetDateTime) currentExample;\n+                } catch (ClassCastException e) {\n+                    date = ((Date) currentExample).toInstant().atOffset(ZoneOffset.UTC);", "originalCommit": "b4192348c8594c23612cdf00e2b20a7655bac423", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM2NTA5MQ==", "url": "https://github.com/OpenAPITools/openapi-generator/pull/6458#discussion_r433365091", "bodyText": "I have added a warning.", "author": "jirikuncar", "createdAt": "2020-06-01T17:00:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4Mjg4Ng=="}], "type": "inlineReview"}, {"oid": "12ffeb0da503b794e9be7b5eda80f912a86e576a", "url": "https://github.com/OpenAPITools/openapi-generator/commit/12ffeb0da503b794e9be7b5eda80f912a86e576a", "message": "Resolve conflicts", "committedDate": "2020-06-01T11:29:53Z", "type": "commit"}, {"oid": "6eae87fd1cda42670299cbcc3bc475cc470f6497", "url": "https://github.com/OpenAPITools/openapi-generator/commit/6eae87fd1cda42670299cbcc3bc475cc470f6497", "message": "Merge remote-tracking branch 'origin/jirikuncar/python-experimental/date-time-parsing' into jirikuncar/python-experimental/date-time-parsing", "committedDate": "2020-06-01T11:34:18Z", "type": "commit"}, {"oid": "24832a1cc13dd42a5fd2a7df1d02ae8212cc62e2", "url": "https://github.com/OpenAPITools/openapi-generator/commit/24832a1cc13dd42a5fd2a7df1d02ae8212cc62e2", "message": "Fix date(-time) example parsing", "committedDate": "2020-06-01T14:01:46Z", "type": "commit"}, {"oid": "5da6b763eed7304a7ffd59c8e6daa78e3d29c565", "url": "https://github.com/OpenAPITools/openapi-generator/commit/5da6b763eed7304a7ffd59c8e6daa78e3d29c565", "message": "Merge remote-tracking branch 'upstream/master' into jirikuncar/python-experimental/date-time-parsing", "committedDate": "2020-06-01T14:05:51Z", "type": "commit"}, {"oid": "a1ba8b3250ffa23e54d24e5ea9431da0185d997e", "url": "https://github.com/OpenAPITools/openapi-generator/commit/a1ba8b3250ffa23e54d24e5ea9431da0185d997e", "message": "Add unit test for toDefaultValue", "committedDate": "2020-06-01T16:24:09Z", "type": "commit"}]}