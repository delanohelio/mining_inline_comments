{"pr_number": 9810, "pr_title": "Add segment pruning for hash based shard spec", "pr_createdAt": "2020-05-02T13:42:06Z", "pr_url": "https://github.com/apache/druid/pull/9810", "timeline": [{"oid": "6928b6368d48791f2670ddeedd69d08003e9e28c", "url": "https://github.com/apache/druid/commit/6928b6368d48791f2670ddeedd69d08003e9e28c", "message": "Add segment pruning for hash based partitioning", "committedDate": "2020-07-29T19:50:47Z", "type": "commit"}, {"oid": "9d4b76f1072a8175bdfb28d9007c32dfc8370c86", "url": "https://github.com/apache/druid/commit/9d4b76f1072a8175bdfb28d9007c32dfc8370c86", "message": "Update doc", "committedDate": "2020-07-29T19:50:47Z", "type": "commit"}, {"oid": "d1743ff0364074e676ec4713b15c27fce9230d8f", "url": "https://github.com/apache/druid/commit/d1743ff0364074e676ec4713b15c27fce9230d8f", "message": "Add additional test", "committedDate": "2020-07-29T19:50:47Z", "type": "commit"}, {"oid": "df48ebba967a1f2324fb62f7b08deab6f70c9acd", "url": "https://github.com/apache/druid/commit/df48ebba967a1f2324fb62f7b08deab6f70c9acd", "message": "Address comments", "committedDate": "2020-07-29T19:50:47Z", "type": "commit"}, {"oid": "df48ebba967a1f2324fb62f7b08deab6f70c9acd", "url": "https://github.com/apache/druid/commit/df48ebba967a1f2324fb62f7b08deab6f70c9acd", "message": "Address comments", "committedDate": "2020-07-29T19:50:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU5NzA0MA==", "url": "https://github.com/apache/druid/pull/9810#discussion_r462597040", "bodyText": "You can fix the ci failure by adding .randomQueryId() here.", "author": "jihoonson", "createdAt": "2020-07-29T21:22:09Z", "path": "server/src/test/java/org/apache/druid/client/CachingClusteredClientTest.java", "diffHunk": "@@ -1541,6 +1543,135 @@ public void testSingleDimensionPruning()\n     Assert.assertEquals(expected, ((TimeseriesQuery) capture.getValue().getQuery()).getQuerySegmentSpec());\n   }\n \n+  @Test\n+  public void testHashBasedPruning()\n+  {\n+    DimFilter filter = new AndDimFilter(\n+        new SelectorDimFilter(\"dim1\", \"a\", null),\n+        new BoundDimFilter(\"dim2\", \"e\", \"zzz\", true, true, false, null, StringComparators.LEXICOGRAPHIC),\n+        // Equivalent filter of dim3 below is InDimFilter(\"dim3\", Arrays.asList(\"c\"), null)\n+        new AndDimFilter(\n+            new InDimFilter(\"dim3\", Arrays.asList(\"a\", \"c\", \"e\", \"g\"), null),\n+            new BoundDimFilter(\"dim3\", \"aaa\", \"ddd\", false, false, false, null, StringComparators.LEXICOGRAPHIC)\n+        )\n+    );\n+\n+    final Druids.TimeseriesQueryBuilder builder = Druids.newTimeseriesQueryBuilder()\n+                                                        .dataSource(DATA_SOURCE)\n+                                                        .filters(filter)\n+                                                        .granularity(GRANULARITY)\n+                                                        .intervals(SEG_SPEC)\n+                                                        .context(CONTEXT)\n+                                                        .intervals(\"2011-01-05/2011-01-10\")\n+                                                        .aggregators(RENAMED_AGGS)\n+                                                        .postAggregators(RENAMED_POST_AGGS);", "originalCommit": "df48ebba967a1f2324fb62f7b08deab6f70c9acd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYxNDc4Mw==", "url": "https://github.com/apache/druid/pull/9810#discussion_r462614783", "bodyText": "\ud83d\udc4d Pushed a fix. Also thanks for the wiki, I will avoid force pushes in the future.", "author": "wjhypo", "createdAt": "2020-07-29T22:00:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjU5NzA0MA=="}], "type": "inlineReview"}, {"oid": "5384f981f9a7bd66a122d5570e3bd4f83aed8ce5", "url": "https://github.com/apache/druid/commit/5384f981f9a7bd66a122d5570e3bd4f83aed8ce5", "message": "Fix unit test failure", "committedDate": "2020-07-29T21:56:10Z", "type": "commit"}]}