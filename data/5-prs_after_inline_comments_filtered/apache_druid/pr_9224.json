{"pr_number": 9224, "pr_title": "Create new dynamic config to pause coordinator helpers when needed", "pr_createdAt": "2020-01-19T22:32:02Z", "pr_url": "https://github.com/apache/druid/pull/9224", "timeline": [{"oid": "aa280fba5d52ba8662e5138b6ccf1e5e57184289", "url": "https://github.com/apache/druid/commit/aa280fba5d52ba8662e5138b6ccf1e5e57184289", "message": "Create new dynamic config to pause coordinator helpers when needed", "committedDate": "2020-01-19T22:23:26Z", "type": "commit"}, {"oid": "d9bf3f4c70d93e603ee54d45e0c89af2a70d8a83", "url": "https://github.com/apache/druid/commit/d9bf3f4c70d93e603ee54d45e0c89af2a70d8a83", "message": "Fix spelling mistakes flagged in Travis build", "committedDate": "2020-01-20T14:45:33Z", "type": "commit"}, {"oid": "db407935733771cce7f101f6578a0fc951f75960", "url": "https://github.com/apache/druid/commit/db407935733771cce7f101f6578a0fc951f75960", "message": "Add an integration test for coordinator pause dynamic config", "committedDate": "2020-01-22T16:47:01Z", "type": "commit"}, {"oid": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840", "url": "https://github.com/apache/druid/commit/70f4ab334cf76a9133da1b6a58cf6d62e8dbc840", "message": "Merge remote-tracking branch 'origin/master' into implement-coordinator-pause", "committedDate": "2020-01-29T15:06:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExNzM1Nw==", "url": "https://github.com/apache/druid/pull/9224#discussion_r375117357", "bodyText": "I think this if clause should check startingLeaderCounter == coordLeaderSelector.localTerm() as well as in the below if clause. Or maybe, this log can be just printed when the dynamic configuration is updated. Also we are trying to reduce the amount of logs. Do you think it's worth to be the info level? Or can it be the debug level?", "author": "jihoonson", "createdAt": "2020-02-05T08:33:27Z", "path": "server/src/main/java/org/apache/druid/server/coordinator/DruidCoordinator.java", "diffHunk": "@@ -678,9 +678,20 @@ public void run()\n                 .withEmitter(emitter)\n                 .withBalancerStrategy(balancerStrategy)\n                 .build();\n+\n+        boolean coordinationPaused = getDynamicConfigs().getPauseCoordination();\n+        if (coordinationPaused && coordLeaderSelector.isLeader()) {", "originalCommit": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTM2NjkxOQ==", "url": "https://github.com/apache/druid/pull/9224#discussion_r375366919", "bodyText": "I agree that this can be flipped to a debug log. It was nice to have it as info for our initial testing to make sure everything was squared away. I will swap to debug and add to the conditional check to cover the case you mentioned. Now that we know everything works, admins will just need to reference the dynamic config instead of logs for clarity on the state of this (which seems like better admin practice anyways).", "author": "capistrant", "createdAt": "2020-02-05T16:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTExNzM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NTEyMTAxMQ==", "url": "https://github.com/apache/druid/pull/9224#discussion_r375121011", "bodyText": "Thank you for adding this test!", "author": "jihoonson", "createdAt": "2020-02-05T08:42:07Z", "path": "integration-tests/src/test/java/org/apache/druid/tests/indexer/ITTestCoordinatorPausedTest.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.apache.druid.tests.indexer;\n+\n+import com.google.inject.Inject;\n+import org.apache.druid.java.util.common.logger.Logger;\n+import org.apache.druid.server.coordinator.CoordinatorDynamicConfig;\n+import org.apache.druid.testing.clients.CoordinatorResourceTestClient;\n+import org.apache.druid.testing.guice.DruidTestModuleFactory;\n+import org.apache.druid.testing.utils.ITRetryUtil;\n+import org.testng.annotations.Guice;\n+import org.testng.annotations.Test;\n+\n+import java.io.Closeable;\n+import java.util.concurrent.TimeUnit;\n+\n+@Guice(moduleFactory = DruidTestModuleFactory.class)\n+public class ITTestCoordinatorPausedTest extends AbstractITBatchIndexTest", "originalCommit": "70f4ab334cf76a9133da1b6a58cf6d62e8dbc840", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2a7a758c16b4cbad0dc0b864481ef4d9fadf67e9", "url": "https://github.com/apache/druid/commit/2a7a758c16b4cbad0dc0b864481ef4d9fadf67e9", "message": "Improve documentation for new dynamic coordinator config and remove un-needed info logs in favor of debug", "committedDate": "2020-02-05T17:06:21Z", "type": "commit"}, {"oid": "35fba8e198471dcc7a0c7ab177688c7ac3eb585d", "url": "https://github.com/apache/druid/commit/35fba8e198471dcc7a0c7ab177688c7ac3eb585d", "message": "address naming convention of 'deep store' vs 'deep storage' in new configs doc line", "committedDate": "2020-02-05T17:11:46Z", "type": "commit"}, {"oid": "b220b1da71ea903bac7e0d82b0d8db1f7faa2744", "url": "https://github.com/apache/druid/commit/b220b1da71ea903bac7e0d82b0d8db1f7faa2744", "message": "Fix newline at end of configuration index.md", "committedDate": "2020-02-05T17:15:52Z", "type": "commit"}, {"oid": "401e7e2587afc96b47bfff0e4368e650167683b7", "url": "https://github.com/apache/druid/commit/401e7e2587afc96b47bfff0e4368e650167683b7", "message": "Last try to resolve newline issue in configuration readme", "committedDate": "2020-02-05T17:26:13Z", "type": "commit"}, {"oid": "d0f23fd7856ebfe714b35325f6c9c833b0315994", "url": "https://github.com/apache/druid/commit/d0f23fd7856ebfe714b35325f6c9c833b0315994", "message": "fix spell checks from travis build", "committedDate": "2020-02-05T19:34:50Z", "type": "commit"}, {"oid": "5fc064f39712541b3ed3cef91d03376bfcbba8d6", "url": "https://github.com/apache/druid/commit/5fc064f39712541b3ed3cef91d03376bfcbba8d6", "message": "Fix another flagges spelling error from Travis", "committedDate": "2020-02-05T20:28:22Z", "type": "commit"}]}