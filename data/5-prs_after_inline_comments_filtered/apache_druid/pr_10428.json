{"pr_number": 10428, "pr_title": "allow server selection to be aware of query", "pr_createdAt": "2020-09-23T21:17:34Z", "pr_url": "https://github.com/apache/druid/pull/10428", "timeline": [{"oid": "c98cbb232c8cb83c47b72818133bdc7da8a1f455", "url": "https://github.com/apache/druid/commit/c98cbb232c8cb83c47b72818133bdc7da8a1f455", "message": "add query through to server selector", "committedDate": "2020-12-07T20:57:18Z", "type": "commit"}, {"oid": "6d48fdb072b232d3ba852b20c969eda8d64420bf", "url": "https://github.com/apache/druid/commit/6d48fdb072b232d3ba852b20c969eda8d64420bf", "message": "add nullable extensions, deprecate old methods with defaults", "committedDate": "2020-12-07T20:57:18Z", "type": "commit"}, {"oid": "1685caded690252839651353854142344193a63b", "url": "https://github.com/apache/druid/commit/1685caded690252839651353854142344193a63b", "message": "style changes", "committedDate": "2020-12-07T20:57:18Z", "type": "commit"}, {"oid": "682359cf34f744c4debe00ac1a9deb7c6956bb6c", "url": "https://github.com/apache/druid/commit/682359cf34f744c4debe00ac1a9deb7c6956bb6c", "message": "add nullable to ServerSelectorStrategy", "committedDate": "2020-12-07T20:57:18Z", "type": "commit"}, {"oid": "3e1e66066840a93bfdcd104d31944d49855986db", "url": "https://github.com/apache/druid/commit/3e1e66066840a93bfdcd104d31944d49855986db", "message": "fix test coverage", "committedDate": "2020-12-07T20:57:18Z", "type": "commit"}, {"oid": "660aaec66140739c0c4feedc18b7272e760b63a6", "url": "https://github.com/apache/druid/commit/660aaec66140739c0c4feedc18b7272e760b63a6", "message": "missing override in test", "committedDate": "2020-12-07T20:57:18Z", "type": "commit"}, {"oid": "660aaec66140739c0c4feedc18b7272e760b63a6", "url": "https://github.com/apache/druid/commit/660aaec66140739c0c4feedc18b7272e760b63a6", "message": "missing override in test", "committedDate": "2020-12-07T20:57:18Z", "type": "forcePushed"}, {"oid": "6f26ded57e2f1c795f19ed2c6334041d9e48b250", "url": "https://github.com/apache/druid/commit/6f26ded57e2f1c795f19ed2c6334041d9e48b250", "message": "add null check", "committedDate": "2020-12-17T23:16:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ5NTcyNw==", "url": "https://github.com/apache/druid/pull/10428#discussion_r545495727", "bodyText": "nit: I think it should ideally fail if queryableServer is null, because it means there is no server to process this segment. However, this seems OK because this method will return immediately when it's null and fail at here.", "author": "jihoonson", "createdAt": "2020-12-18T00:33:09Z", "path": "server/src/main/java/org/apache/druid/client/CachingClusteredClient.java", "diffHunk": "@@ -812,7 +812,8 @@ String computeResultLevelCachingEtag(\n       Hasher hasher = Hashing.sha1().newHasher();\n       boolean hasOnlyHistoricalSegments = true;\n       for (SegmentServerSelector p : segments) {\n-        if (!p.getServer().pick().getServer().isSegmentReplicationTarget()) {\n+        QueryableDruidServer queryableServer = p.getServer().pick(query);\n+        if (queryableServer == null || !queryableServer.getServer().isSegmentReplicationTarget()) {", "originalCommit": "6f26ded57e2f1c795f19ed2c6334041d9e48b250", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}