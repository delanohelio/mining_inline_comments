{"pr_number": 10680, "pr_title": "integration test for coordinator and overlord leadership client", "pr_createdAt": "2020-12-15T05:58:39Z", "pr_url": "https://github.com/apache/druid/pull/10680", "timeline": [{"oid": "2e605eb0f236c8cb56646d6f518bffd86811af39", "url": "https://github.com/apache/druid/commit/2e605eb0f236c8cb56646d6f518bffd86811af39", "message": "integration test for coordinator and overlord leadership, added sys.servers is_leader column", "committedDate": "2020-12-15T05:26:48Z", "type": "commit"}, {"oid": "be04821d6097e58f6be13efc5014f4e0a5e33810", "url": "https://github.com/apache/druid/commit/be04821d6097e58f6be13efc5014f4e0a5e33810", "message": "docs", "committedDate": "2020-12-15T05:46:32Z", "type": "commit"}, {"oid": "c7e8b1fd1a350dc1b96cc20cc3dced85c0a630c5", "url": "https://github.com/apache/druid/commit/c7e8b1fd1a350dc1b96cc20cc3dced85c0a630c5", "message": "remove not needed", "committedDate": "2020-12-15T05:49:01Z", "type": "commit"}, {"oid": "caa2205aa7956ab2f54870dace78ee551b0b6b97", "url": "https://github.com/apache/druid/commit/caa2205aa7956ab2f54870dace78ee551b0b6b97", "message": "fix comments", "committedDate": "2020-12-15T06:13:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEwNjU3MQ==", "url": "https://github.com/apache/druid/pull/10680#discussion_r543106571", "bodyText": "hmm. shouldn't this always be zero?  Data nodes don't have any leader.", "author": "abhishekagarwal87", "createdAt": "2020-12-15T07:27:22Z", "path": "sql/src/main/java/org/apache/druid/sql/calcite/schema/SystemSchema.java", "diffHunk": "@@ -586,7 +638,8 @@ public TableType getJdbcTableType()\n           StringUtils.toLowerCase(discoveryDruidNode.getNodeRole().toString()),\n           druidServerToUse.getTier(),\n           currentSize,\n-          druidServerToUse.getMaxSize()\n+          druidServerToUse.getMaxSize(),\n+          NullHandling.defaultLongValue()", "originalCommit": "caa2205aa7956ab2f54870dace78ee551b0b6b97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE0NTk4OQ==", "url": "https://github.com/apache/druid/pull/10680#discussion_r543145989", "bodyText": "ideally it should always be null because they don't have the concept of leadership at all and then you can distinguish between things which are leader, are not leader, and which don't have leaders. NullHandling.defaultLongValue() is null when druid.generic.useDefaultValueForNull=false, but in default mode numbers cannot be null so it is 0 there.", "author": "clintropolis", "createdAt": "2020-12-15T08:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEwNjU3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzE3OTEzMg==", "url": "https://github.com/apache/druid/pull/10680#discussion_r543179132", "bodyText": "yeah. that works. \ud83d\udc4d", "author": "abhishekagarwal87", "createdAt": "2020-12-15T09:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzEwNjU3MQ=="}], "type": "inlineReview"}, {"oid": "8b369accf271f06886c94348bd963120fe977350", "url": "https://github.com/apache/druid/commit/8b369accf271f06886c94348bd963120fe977350", "message": "fix compile heh", "committedDate": "2020-12-15T10:29:06Z", "type": "commit"}, {"oid": "c6a917c791d21df8b9e7021c16e3d97599613de0", "url": "https://github.com/apache/druid/commit/c6a917c791d21df8b9e7021c16e3d97599613de0", "message": "oof", "committedDate": "2020-12-15T18:13:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1NTAzNw==", "url": "https://github.com/apache/druid/pull/10680#discussion_r543755037", "bodyText": "not sure why this is a LONG type variable and not STRING type which could have values \"true\", \"false\" and \"not-applicable\" ?", "author": "himanshug", "createdAt": "2020-12-15T23:12:08Z", "path": "sql/src/main/java/org/apache/druid/sql/calcite/schema/SystemSchema.java", "diffHunk": "@@ -159,6 +160,7 @@\n       .add(\"tier\", ValueType.STRING)\n       .add(\"curr_size\", ValueType.LONG)\n       .add(\"max_size\", ValueType.LONG)\n+      .add(\"is_leader\", ValueType.LONG)", "originalCommit": "c6a917c791d21df8b9e7021c16e3d97599613de0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc3ODk1Mg==", "url": "https://github.com/apache/druid/pull/10680#discussion_r543778952", "bodyText": "I guess it's to be consistent with other boolean types such as is_published in the segments table. It is useful for those boolean columns in the segments table to be long so that we can easily compute sums of them. For this column, I think it doesn't have to be long, but I don't mind either.", "author": "jihoonson", "createdAt": "2020-12-16T00:08:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1NTAzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYzMjE4MQ==", "url": "https://github.com/apache/druid/pull/10680#discussion_r544632181", "bodyText": "Yeah, what @jihoonson was my reasoning for using long, to be consistent with other boolean-ish columns, but i'm not super attached to it and can change if that is better", "author": "clintropolis", "createdAt": "2020-12-16T21:22:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1NTAzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDY1NzY2Mg==", "url": "https://github.com/apache/druid/pull/10680#discussion_r544657662", "bodyText": "thanks for explaining, in the big scheme of things it hardly matters... consider it a nit", "author": "himanshug", "createdAt": "2020-12-16T22:07:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Mzc1NTAzNw=="}], "type": "inlineReview"}, {"oid": "ed27049d0a81bf65c05de2b10400bb5b19b7bba7", "url": "https://github.com/apache/druid/commit/ed27049d0a81bf65c05de2b10400bb5b19b7bba7", "message": "revert unintended", "committedDate": "2020-12-15T23:31:26Z", "type": "commit"}, {"oid": "3d1ffcf3c1d7ff5aa6c289b30776dff6e199461f", "url": "https://github.com/apache/druid/commit/3d1ffcf3c1d7ff5aa6c289b30776dff6e199461f", "message": "fix tests, split out docker-compose file selection from starting cluster, use docker-compose down to stop cluster", "committedDate": "2020-12-16T09:46:39Z", "type": "commit"}, {"oid": "b6fcc2f66bf0951725813b55dc93e874db927808", "url": "https://github.com/apache/druid/commit/b6fcc2f66bf0951725813b55dc93e874db927808", "message": "fixes", "committedDate": "2020-12-16T10:28:43Z", "type": "commit"}, {"oid": "9f750cf9230d8f7f319c5598f34d6853214b452a", "url": "https://github.com/apache/druid/commit/9f750cf9230d8f7f319c5598f34d6853214b452a", "message": "style", "committedDate": "2020-12-16T10:29:47Z", "type": "commit"}, {"oid": "216b06a9813bd981b99f83275ab3c294a69c8775", "url": "https://github.com/apache/druid/commit/216b06a9813bd981b99f83275ab3c294a69c8775", "message": "dang", "committedDate": "2020-12-16T10:32:54Z", "type": "commit"}, {"oid": "898948287e0dae8e54de3f6781aabfefca46dffe", "url": "https://github.com/apache/druid/commit/898948287e0dae8e54de3f6781aabfefca46dffe", "message": "heh", "committedDate": "2020-12-16T10:33:25Z", "type": "commit"}, {"oid": "3c3d2cf22c737cfa4ba0d57ae4ae1d76a5e31b5b", "url": "https://github.com/apache/druid/commit/3c3d2cf22c737cfa4ba0d57ae4ae1d76a5e31b5b", "message": "scripts are hard", "committedDate": "2020-12-16T14:08:28Z", "type": "commit"}, {"oid": "4e59bd423af151de1c40c08253c74f085e298fda", "url": "https://github.com/apache/druid/commit/4e59bd423af151de1c40c08253c74f085e298fda", "message": "fix spelling", "committedDate": "2020-12-16T21:26:03Z", "type": "commit"}, {"oid": "433960acd91c285331642082afb5d058cd927282", "url": "https://github.com/apache/druid/commit/433960acd91c285331642082afb5d058cd927282", "message": "fix thing that must not matter since was already wrong ip, log when test fails", "committedDate": "2020-12-16T21:41:35Z", "type": "commit"}, {"oid": "2f36491e2755e7b2c1827355b093ebd36ba695d8", "url": "https://github.com/apache/druid/commit/2f36491e2755e7b2c1827355b093ebd36ba695d8", "message": "needs more heap", "committedDate": "2020-12-16T23:36:00Z", "type": "commit"}, {"oid": "518721dcd17bec4b5d3b4ecadb25b0efaf524433", "url": "https://github.com/apache/druid/commit/518721dcd17bec4b5d3b4ecadb25b0efaf524433", "message": "Merge remote-tracking branch 'upstream/master' into ha-leadership-integration-tests", "committedDate": "2020-12-17T07:09:05Z", "type": "commit"}, {"oid": "5dea9e923958dcdc7c3cf51c4e33b00f5c7637bc", "url": "https://github.com/apache/druid/commit/5dea9e923958dcdc7c3cf51c4e33b00f5c7637bc", "message": "fix merge", "committedDate": "2020-12-17T07:44:05Z", "type": "commit"}, {"oid": "470dec3b1740d54feef6044290de3e8f29809252", "url": "https://github.com/apache/druid/commit/470dec3b1740d54feef6044290de3e8f29809252", "message": "less aggro", "committedDate": "2020-12-17T22:19:25Z", "type": "commit"}, {"oid": "abd5c95bc35cb709ce6263b5ee33780d489d7559", "url": "https://github.com/apache/druid/commit/abd5c95bc35cb709ce6263b5ee33780d489d7559", "message": "Merge remote-tracking branch 'upstream/master' into ha-leadership-integration-tests", "committedDate": "2020-12-18T00:09:30Z", "type": "commit"}]}