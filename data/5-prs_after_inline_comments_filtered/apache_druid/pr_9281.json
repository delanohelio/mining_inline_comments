{"pr_number": 9281, "pr_title": "Add LookupJoinableFactory.", "pr_createdAt": "2020-01-29T02:06:15Z", "pr_url": "https://github.com/apache/druid/pull/9281", "timeline": [{"oid": "a15f8b1ab19d0900aec0b2288e5e755db51c3d8b", "url": "https://github.com/apache/druid/commit/a15f8b1ab19d0900aec0b2288e5e755db51c3d8b", "message": "Add LookupJoinableFactory.\n\nEnables joins where the right-hand side is a lookup. Includes an\nintegration test.\n\nAlso, includes changes to LookupExtractorFactoryContainerProvider:\n\n1) Add \"getAllLookupNames\", which will be needed to eventually connect\n   lookups to Druid's SQL catalog.\n2) Convert \"get\" from nullable to Optional return.\n3) Swap out most usages of LookupReferencesManager in favor of the\n   simpler LookupExtractorFactoryContainerProvider interface.", "committedDate": "2020-01-29T02:04:15Z", "type": "commit"}, {"oid": "82c9f6652c064275fcc7de57c15de01c212fd14e", "url": "https://github.com/apache/druid/commit/82c9f6652c064275fcc7de57c15de01c212fd14e", "message": "Merge branch 'master' into lookup-joinable-factory", "committedDate": "2020-01-29T03:04:07Z", "type": "commit"}, {"oid": "be6feecedad317e8087ddaccb96fb3ff916a4502", "url": "https://github.com/apache/druid/commit/be6feecedad317e8087ddaccb96fb3ff916a4502", "message": "Fixes for tests.", "committedDate": "2020-01-29T03:10:34Z", "type": "commit"}, {"oid": "4a11b6df5794db7a986111680103745120b71bd4", "url": "https://github.com/apache/druid/commit/4a11b6df5794db7a986111680103745120b71bd4", "message": "Fix another test.", "committedDate": "2020-01-29T04:06:07Z", "type": "commit"}, {"oid": "05e76b884ce170871ec8ef78d1d91740f008fb51", "url": "https://github.com/apache/druid/commit/05e76b884ce170871ec8ef78d1d91740f008fb51", "message": "Java 11 message fix.", "committedDate": "2020-01-29T06:10:02Z", "type": "commit"}, {"oid": "06122ea779f3e0df89ae0881b3e4b89c70295d21", "url": "https://github.com/apache/druid/commit/06122ea779f3e0df89ae0881b3e4b89c70295d21", "message": "Fixups.", "committedDate": "2020-01-29T15:10:19Z", "type": "commit"}, {"oid": "512a87a184c5b8a5d467158849fd426f710c2612", "url": "https://github.com/apache/druid/commit/512a87a184c5b8a5d467158849fd426f710c2612", "message": "Merge branch 'master' into lookup-joinable-factory", "committedDate": "2020-01-30T08:31:02Z", "type": "commit"}, {"oid": "33d7908c0bd956129530839cd18b80321c05d768", "url": "https://github.com/apache/druid/commit/33d7908c0bd956129530839cd18b80321c05d768", "message": "Fixup benchmark class.", "committedDate": "2020-01-30T17:05:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MTEzOA==", "url": "https://github.com/apache/druid/pull/9281#discussion_r373171138", "bodyText": "Do you want to add a similar assert below for LookupJoinableFactory?", "author": "ccaominh", "createdAt": "2020-01-30T20:15:46Z", "path": "server/src/test/java/org/apache/druid/guice/JoinableFactoryModuleTest.java", "diffHunk": "@@ -63,7 +66,7 @@ public void testInjectDefaultBindingsShouldBeInjected()\n   {\n     Map<Class<? extends DataSource>, JoinableFactory> joinableFactories =\n         injector.getInstance(Key.get(new TypeLiteral<Map<Class<? extends DataSource>, JoinableFactory>>() {}));\n-    Assert.assertEquals(1, joinableFactories.size());\n+    Assert.assertEquals(2, joinableFactories.size());", "originalCommit": "33d7908c0bd956129530839cd18b80321c05d768", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIzNDgyNw==", "url": "https://github.com/apache/druid/pull/9281#discussion_r373234827", "bodyText": "Sure, that sounds good, I'll add one in a followup.", "author": "gianm", "createdAt": "2020-01-30T22:45:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MTEzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MTc5Ng==", "url": "https://github.com/apache/druid/pull/9281#discussion_r373171796", "bodyText": "Maybe JoinableFactoryModule.FACTORY_MAPPINGS can be made visible for testing so that this can be changed to FACTORY_MAPPINGS.size() + 1 and the test does not need to updated again if another default mapping is added later.", "author": "ccaominh", "createdAt": "2020-01-30T20:17:17Z", "path": "server/src/test/java/org/apache/druid/guice/JoinableFactoryModuleTest.java", "diffHunk": "@@ -75,23 +78,25 @@ public void testJoinableFactoryCanBind()\n             .joinableFactoryBinder(binder).addBinding(NoopDataSource.class).toInstance(NoopJoinableFactory.INSTANCE));\n     Map<Class<? extends DataSource>, JoinableFactory> joinableFactories =\n         injector.getInstance(Key.get(new TypeLiteral<Map<Class<? extends DataSource>, JoinableFactory>>() {}));\n-    Assert.assertEquals(2, joinableFactories.size());\n+    Assert.assertEquals(3, joinableFactories.size());", "originalCommit": "33d7908c0bd956129530839cd18b80321c05d768", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzIzNDkyNw==", "url": "https://github.com/apache/druid/pull/9281#discussion_r373234927", "bodyText": "Sounds reasonable, I'll add that in the same followup.", "author": "gianm", "createdAt": "2020-01-30T22:46:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzE3MTc5Ng=="}], "type": "inlineReview"}]}