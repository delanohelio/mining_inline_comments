{"pr_number": 10432, "pr_title": "add vectorizeVirtualColumns query context parameter", "pr_createdAt": "2020-09-24T08:38:44Z", "pr_url": "https://github.com/apache/druid/pull/10432", "timeline": [{"oid": "e0f2a894801a7ddb97aa6f4a2e14b5c5e425aa08", "url": "https://github.com/apache/druid/commit/e0f2a894801a7ddb97aa6f4a2e14b5c5e425aa08", "message": "add vectorizeVirtualColumns query context parameter", "committedDate": "2020-09-24T08:28:12Z", "type": "commit"}, {"oid": "570cb0a55c62eacb266048a988e227b51f7936ad", "url": "https://github.com/apache/druid/commit/570cb0a55c62eacb266048a988e227b51f7936ad", "message": "oops", "committedDate": "2020-09-24T12:27:37Z", "type": "commit"}, {"oid": "0e0b97a62ece12eca34ba46672f792956f509508", "url": "https://github.com/apache/druid/commit/0e0b97a62ece12eca34ba46672f792956f509508", "message": "spelling", "committedDate": "2020-09-24T18:40:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU0MDk4NA==", "url": "https://github.com/apache/druid/pull/10432#discussion_r494540984", "bodyText": "There's some duplication here between the query engines \u2014 how about creating a helper that takes the query and the virtual columns and creates a Vectorize instance that synthesizes both?", "author": "gianm", "createdAt": "2020-09-24T18:52:02Z", "path": "processing/src/main/java/org/apache/druid/query/groupby/epinephelinae/vector/VectorGroupByEngine.java", "diffHunk": "@@ -76,10 +76,18 @@ public static boolean canVectorize(\n     Function<String, ColumnCapabilities> capabilitiesFunction = name ->\n         query.getVirtualColumns().getColumnCapabilitiesWithFallback(adapter, name);\n \n+    final boolean adapterCanVectorize = adapter.canVectorize(filter, query.getVirtualColumns(), false);\n+    final boolean virtualColumnsCanVectorize;\n+    if (query.getVirtualColumns().getVirtualColumns().length > 0) {", "originalCommit": "0e0b97a62ece12eca34ba46672f792956f509508", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDc1MTc3Mw==", "url": "https://github.com/apache/druid/pull/10432#discussion_r494751773", "bodyText": "I'll see if I can clean this up a bit", "author": "clintropolis", "createdAt": "2020-09-25T05:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU0MDk4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTczNTY3Mg==", "url": "https://github.com/apache/druid/pull/10432#discussion_r495735672", "bodyText": "moved into a static method VirtualColumns.shouldVectorize which I'm not sure is the best place or not, but at least consolidates the logic", "author": "clintropolis", "createdAt": "2020-09-28T07:20:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU0MDk4NA=="}], "type": "inlineReview"}, {"oid": "2ca210866a0905500ea97ed57f6faf968525a6e6", "url": "https://github.com/apache/druid/commit/2ca210866a0905500ea97ed57f6faf968525a6e6", "message": "Merge remote-tracking branch 'upstream/master' into vector-expr-escape-hatch", "committedDate": "2020-09-27T10:45:55Z", "type": "commit"}, {"oid": "d3cb684b607d6ceb42ec3117b213db458b8b6a3d", "url": "https://github.com/apache/druid/commit/d3cb684b607d6ceb42ec3117b213db458b8b6a3d", "message": "default to false, more docs", "committedDate": "2020-09-28T03:53:46Z", "type": "commit"}, {"oid": "95d93af023625f98f3a1cfd2a98595dd4c1daf50", "url": "https://github.com/apache/druid/commit/95d93af023625f98f3a1cfd2a98595dd4c1daf50", "message": "fix test", "committedDate": "2020-09-28T06:49:46Z", "type": "commit"}, {"oid": "f4396dc814fc2e7a4303e396819703bfb5c06c2c", "url": "https://github.com/apache/druid/commit/f4396dc814fc2e7a4303e396819703bfb5c06c2c", "message": "fix spelling", "committedDate": "2020-09-28T20:04:20Z", "type": "commit"}]}