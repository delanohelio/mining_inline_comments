{"pr_number": 9530, "pr_title": "DruidSegmentReader should work if timestamp is specified as a dimension", "pr_createdAt": "2020-03-17T21:40:29Z", "pr_url": "https://github.com/apache/druid/pull/9530", "timeline": [{"oid": "14ccdbac9df0e716672618d8148282e497c8edf3", "url": "https://github.com/apache/druid/commit/14ccdbac9df0e716672618d8148282e497c8edf3", "message": "DruidSegmentReader should work if timestamp is specified as a dimension", "committedDate": "2020-03-25T00:02:57Z", "type": "commit"}, {"oid": "1c98f04c86afa8546586316f5a4c376658db40d3", "url": "https://github.com/apache/druid/commit/1c98f04c86afa8546586316f5a4c376658db40d3", "message": "Add integration tests\n\nTests for compaction and re-indexing a datasource with the timestamp column", "committedDate": "2020-03-25T00:19:25Z", "type": "commit"}, {"oid": "1c98f04c86afa8546586316f5a4c376658db40d3", "url": "https://github.com/apache/druid/commit/1c98f04c86afa8546586316f5a4c376658db40d3", "message": "Add integration tests\n\nTests for compaction and re-indexing a datasource with the timestamp column", "committedDate": "2020-03-25T00:19:25Z", "type": "forcePushed"}, {"oid": "b0b9f32f316378cd49b88f38b399f224fd1f2de4", "url": "https://github.com/apache/druid/commit/b0b9f32f316378cd49b88f38b399f224fd1f2de4", "message": "Instructions to run integration tests against quickstart", "committedDate": "2020-03-25T03:22:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA2NDA5NQ==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398064095", "bodyText": "Could you change this to single-line comments? We don't usually use multi-line comment.", "author": "jihoonson", "createdAt": "2020-03-25T18:06:18Z", "path": "indexing-service/src/main/java/org/apache/druid/indexing/input/DruidSegmentReader.java", "diffHunk": "@@ -270,6 +273,17 @@ public boolean hasNext()\n           theEvent.put(metric, value);\n         }\n       }\n+\n+      /*", "originalCommit": "1c98f04c86afa8546586316f5a4c376658db40d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEwMjgwMw==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398102803", "bodyText": "Done", "author": "suneet-s", "createdAt": "2020-03-25T19:07:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA2NDA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA2NjQ1Ng==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398066456", "bodyText": "Hmm, I think this overwriting should never happen, but it could happen for some reason in practice, e.g., user mistake. How about logging a warning if there are duplicate column names? Doc could say some kind of warning messages can be printed if there are duplicates.", "author": "jihoonson", "createdAt": "2020-03-25T18:09:59Z", "path": "indexing-service/src/main/java/org/apache/druid/indexing/input/DruidSegmentReader.java", "diffHunk": "@@ -270,6 +273,17 @@ public boolean hasNext()\n           theEvent.put(metric, value);\n         }\n       }\n+\n+      /*\n+       * Timestamp is added last because we expect that the time column will always be a date time object.\n+       * If it is added earlier, it can be overwritten by metrics or dimenstions with the same name.\n+       *\n+       * If a user names a metric or dimension `__time` it will be overwritten. This case should be rare since", "originalCommit": "1c98f04c86afa8546586316f5a4c376658db40d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4NDIzNw==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398084237", "bodyText": "I'm worried about log explosion. since this is done per row. I'd have to add explicit checking outside of this next block. Maybe in the constructor? Would that be visible enough in the logs?", "author": "suneet-s", "createdAt": "2020-03-25T18:37:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA2NjQ1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA4OTMxNQ==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398089315", "bodyText": "Ah good point. Now I think we need some schema validation for ingestion which could probably be done in DataSchema. But this would be a larger issue than the bug this PR fixes, and I'm ok with adding it later.", "author": "jihoonson", "createdAt": "2020-03-25T18:45:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA2NjQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NzIxOA==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398077218", "bodyText": "Would you open an issue for this instead of TODO?", "author": "jihoonson", "createdAt": "2020-03-25T18:26:33Z", "path": "integration-tests/src/test/java/org/apache/druid/tests/indexer/ITIndexerTest.java", "diffHunk": "@@ -34,16 +34,25 @@\n   private static final String INDEX_QUERIES_RESOURCE = \"/indexer/wikipedia_index_queries.json\";\n   private static final String INDEX_DATASOURCE = \"wikipedia_index_test\";\n \n+  private static final String INDEX_WITH_TIMESTAMP_TASK = \"/indexer/wikipedia_with_timestamp_index_task.json\";\n+  // TODO: add queries that validate timestamp is different from the __time column since it is a dimension", "originalCommit": "1c98f04c86afa8546586316f5a4c376658db40d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODEwNTE0Nw==", "url": "https://github.com/apache/druid/pull/9530#discussion_r398105147", "bodyText": "Done", "author": "suneet-s", "createdAt": "2020-03-25T19:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODA3NzIxOA=="}], "type": "inlineReview"}, {"oid": "f71e8fcb5f24d8e14c8a359c077f5c9a95029a93", "url": "https://github.com/apache/druid/commit/f71e8fcb5f24d8e14c8a359c077f5c9a95029a93", "message": "address pr", "committedDate": "2020-03-25T19:12:58Z", "type": "commit"}]}