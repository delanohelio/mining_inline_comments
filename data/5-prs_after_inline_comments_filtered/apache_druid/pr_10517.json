{"pr_number": 10517, "pr_title": "Fix compaction integration test CI timeout", "pr_createdAt": "2020-10-18T06:00:09Z", "pr_url": "https://github.com/apache/druid/pull/10517", "timeline": [{"oid": "abf06407d7e70b7f351291371abf7cb398abfb6b", "url": "https://github.com/apache/druid/commit/abf06407d7e70b7f351291371abf7cb398abfb6b", "message": "fix flaky IT Compaction test", "committedDate": "2020-10-14T21:56:47Z", "type": "commit"}, {"oid": "0bd4da71bd17ca1ede3abf6b2cf155768be9250d", "url": "https://github.com/apache/druid/commit/0bd4da71bd17ca1ede3abf6b2cf155768be9250d", "message": "fix flaky IT Compaction test", "committedDate": "2020-10-14T22:03:49Z", "type": "commit"}, {"oid": "9c3c90b8ccfd26a041aff7ee2c2757f5021196be", "url": "https://github.com/apache/druid/commit/9c3c90b8ccfd26a041aff7ee2c2757f5021196be", "message": "test", "committedDate": "2020-10-15T20:36:42Z", "type": "commit"}, {"oid": "06c3e28610d7940837b362f5432c742463bcb46d", "url": "https://github.com/apache/druid/commit/06c3e28610d7940837b362f5432c742463bcb46d", "message": "test", "committedDate": "2020-10-15T20:41:31Z", "type": "commit"}, {"oid": "76356058d4512277906bf4b3054a9f97cb14f41f", "url": "https://github.com/apache/druid/commit/76356058d4512277906bf4b3054a9f97cb14f41f", "message": "test", "committedDate": "2020-10-15T20:42:39Z", "type": "commit"}, {"oid": "e49aef01cbf41cd41aea2a42d7d0a874dc0d1cbf", "url": "https://github.com/apache/druid/commit/e49aef01cbf41cd41aea2a42d7d0a874dc0d1cbf", "message": "test", "committedDate": "2020-10-16T17:54:33Z", "type": "commit"}, {"oid": "d09a5581a1d9bb8f4ca49377299c499634299218", "url": "https://github.com/apache/druid/commit/d09a5581a1d9bb8f4ca49377299c499634299218", "message": "Fix compaction integration test CI timeout", "committedDate": "2020-10-18T05:49:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzAyMTg1MQ==", "url": "https://github.com/apache/druid/pull/10517#discussion_r507021851", "bodyText": "This comment was stale. The compaction slot was always 5. It was not changed in this PR.", "author": "maytasm", "createdAt": "2020-10-18T06:02:14Z", "path": "integration-tests/src/test/java/org/apache/druid/tests/coordinator/duty/ITAutoCompactionTest.java", "diffHunk": "@@ -77,7 +77,7 @@\n   @BeforeMethod\n   public void setup() throws Exception\n   {\n-    // Set comapction slot to 10\n+    // Set comapction slot to 5", "originalCommit": "d09a5581a1d9bb8f4ca49377299c499634299218", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0ca34b7101d1f215d041fc96dc62a27161175cb8", "url": "https://github.com/apache/druid/commit/0ca34b7101d1f215d041fc96dc62a27161175cb8", "message": "address comments", "committedDate": "2020-10-19T19:26:43Z", "type": "commit"}, {"oid": "673c3105a2290d690bc19d371457aaeef242e266", "url": "https://github.com/apache/druid/commit/673c3105a2290d690bc19d371457aaeef242e266", "message": "test", "committedDate": "2020-10-20T05:52:47Z", "type": "commit"}, {"oid": "9eb5b5641deb9a2b3f16a2717808acee972ec5ab", "url": "https://github.com/apache/druid/commit/9eb5b5641deb9a2b3f16a2717808acee972ec5ab", "message": "test", "committedDate": "2020-10-20T05:53:45Z", "type": "commit"}, {"oid": "52b9b7bc1667e267835c3821af65a3b69bd6e02e", "url": "https://github.com/apache/druid/commit/52b9b7bc1667e267835c3821af65a3b69bd6e02e", "message": "Add print logs", "committedDate": "2020-10-20T07:08:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxODEwMg==", "url": "https://github.com/apache/druid/pull/10517#discussion_r509618102", "bodyText": "How about showing a certain amount of logs at the end instead of printing the whole? It will likely kill the Travis job by hitting the max number of logs per job. You can add a offset query parameter when you call the Overlord API.", "author": "jihoonson", "createdAt": "2020-10-21T19:40:51Z", "path": "integration-tests/src/test/java/org/apache/druid/tests/indexer/AbstractIndexerTest.java", "diffHunk": "@@ -69,6 +73,16 @@ protected Closeable unloader(final String dataSource)\n \n   protected void unloadAndKillData(final String dataSource)\n   {\n+    // Get all failed task logs\n+    List<TaskResponseObject> allTasks = indexer.getCompleteTasksForDataSource(dataSource);\n+    for (TaskResponseObject task : allTasks) {\n+      if (task.getStatus().isFailure()) {\n+        LOG.info(\"------- Found failed task. Start log:\");\n+        LOG.info(indexer.getTaskLog(task.getId()));", "originalCommit": "52b9b7bc1667e267835c3821af65a3b69bd6e02e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxOTgxOQ==", "url": "https://github.com/apache/druid/pull/10517#discussion_r509619819", "bodyText": "Any suggestion on the offset value? Another idea I have is to get the errorMsg field in the report API call", "author": "maytasm", "createdAt": "2020-10-21T19:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxODEwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYyMTY3MQ==", "url": "https://github.com/apache/druid/pull/10517#discussion_r509621671", "bodyText": "Maybe the offset could be max(88000, 80% of total log size), where 88000 is an approximate size of the startup logs.", "author": "jihoonson", "createdAt": "2020-10-21T19:45:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxODEwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYzMTY4NQ==", "url": "https://github.com/apache/druid/pull/10517#discussion_r509631685", "bodyText": "Or we can do offset=-16000 which is the same as the Console UI Log window popup thing", "author": "maytasm", "createdAt": "2020-10-21T19:56:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxODEwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTY0NTY2NQ==", "url": "https://github.com/apache/druid/pull/10517#discussion_r509645665", "bodyText": "Oh yeah, forgot that it can be a negative. I think it should be a bit larger than that though. I usually don't find anything interesting from the logs which the UI shows by default.", "author": "jihoonson", "createdAt": "2020-10-21T20:09:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxODEwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTgxOTM5MQ==", "url": "https://github.com/apache/druid/pull/10517#discussion_r509819391", "bodyText": "Set the offset to -88000 and also added a log of the errorMsg so that we are sure we will definitely have the error message", "author": "maytasm", "createdAt": "2020-10-22T01:01:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxODEwMg=="}], "type": "inlineReview"}, {"oid": "ecce6faea781a492e42cf69ae390894b7e2b713c", "url": "https://github.com/apache/druid/commit/ecce6faea781a492e42cf69ae390894b7e2b713c", "message": "add error msg", "committedDate": "2020-10-22T00:54:14Z", "type": "commit"}, {"oid": "59244d6697ae13df01a04ce08204b591ddff1d46", "url": "https://github.com/apache/druid/commit/59244d6697ae13df01a04ce08204b591ddff1d46", "message": "add taskId to logging", "committedDate": "2020-10-22T01:11:37Z", "type": "commit"}]}