{"pr_number": 9655, "pr_title": "Fix wrong cardinality computation in BufferArrayGrouper", "pr_createdAt": "2020-04-09T21:26:22Z", "pr_url": "https://github.com/apache/druid/pull/9655", "timeline": [{"oid": "ca973dd93dd0dbdc0785d8d3a4300886a44cd1ca", "url": "https://github.com/apache/druid/commit/ca973dd93dd0dbdc0785d8d3a4300886a44cd1ca", "message": "Fix wrong cardinality computation in BufferArrayGrouper", "committedDate": "2020-04-09T21:23:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU1MDI2NQ==", "url": "https://github.com/apache/druid/pull/9655#discussion_r406550265", "bodyText": "I think the comment here should have > Integer.MAX_VALUE instead", "author": "jon-wei", "createdAt": "2020-04-10T00:44:59Z", "path": "processing/src/main/java/org/apache/druid/query/groupby/epinephelinae/BufferArrayGrouper.java", "diffHunk": "@@ -69,12 +69,20 @@\n   @Nullable\n   private int[] vAggregationRows = null;\n \n-  static long requiredBufferCapacity(\n-      int cardinality,\n-      AggregatorFactory[] aggregatorFactories\n-  )\n+  /**\n+   * Computes required buffer capacity for a grouping key of the given cardinaltiy and aggregatorFactories.\n+   * This method assumes that the given cardinality doesn't count nulls.\n+   *\n+   * Returns -1 if it cardinality + 1 (for null) = Integer.MAX_VALUE. Returns computed required buffer capacity", "originalCommit": "ca973dd93dd0dbdc0785d8d3a4300886a44cd1ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU1NTIyOQ==", "url": "https://github.com/apache/druid/pull/9655#discussion_r406555229", "bodyText": "Oops, thanks!", "author": "jihoonson", "createdAt": "2020-04-10T01:06:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjU1MDI2NQ=="}], "type": "inlineReview"}, {"oid": "d0b4b7adf17c252057b9959e0b0869aa26025da6", "url": "https://github.com/apache/druid/commit/d0b4b7adf17c252057b9959e0b0869aa26025da6", "message": "fix javadoc", "committedDate": "2020-04-10T01:06:30Z", "type": "commit"}]}