{"pr_number": 10287, "pr_title": "Remove legacy code from LogUsedSegments duty", "pr_createdAt": "2020-08-14T22:43:28Z", "pr_url": "https://github.com/apache/druid/pull/10287", "timeline": [{"oid": "2389128c5deeac438ee3e5e6a49a5e8e463bf2a7", "url": "https://github.com/apache/druid/commit/2389128c5deeac438ee3e5e6a49a5e8e463bf2a7", "message": "allow the LogUsedSegments duty to be skippped", "committedDate": "2020-08-14T22:40:29Z", "type": "commit"}, {"oid": "4b9a54b7aea2d585626649890480e19c0b5636bd", "url": "https://github.com/apache/druid/commit/4b9a54b7aea2d585626649890480e19c0b5636bd", "message": "Fixes for TravisCI coverage checks and documentation spell checking", "committedDate": "2020-08-15T21:56:25Z", "type": "commit"}, {"oid": "e16219b79407b31fb9b33a3d8c5f6784f41953d3", "url": "https://github.com/apache/druid/commit/e16219b79407b31fb9b33a3d8c5f6784f41953d3", "message": "prameterize DruidCoordinatorTest in order to achieve coverage", "committedDate": "2020-08-16T18:11:31Z", "type": "commit"}, {"oid": "71e7aba5bd8474c0d3f5cc50216aa5d6b17471c9", "url": "https://github.com/apache/druid/commit/71e7aba5bd8474c0d3f5cc50216aa5d6b17471c9", "message": "Merge remote-tracking branch 'upstream/master' into logUsedSegmentsDuty-toggle", "committedDate": "2020-10-28T21:46:37Z", "type": "commit"}, {"oid": "d6cf0ec9ad2db4a62b4b5a6b846b4f5bdf4748c4", "url": "https://github.com/apache/druid/commit/d6cf0ec9ad2db4a62b4b5a6b846b4f5bdf4748c4", "message": "update config name to remove duty ref and improve documentation", "committedDate": "2020-10-29T00:06:16Z", "type": "commit"}, {"oid": "60f2067c2b04d75d5e260c4aef0c6009e31a088d", "url": "https://github.com/apache/druid/commit/60f2067c2b04d75d5e260c4aef0c6009e31a088d", "message": "refine documentation for new config with reviewer advice", "committedDate": "2020-10-29T13:27:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY3NTgyNg==", "url": "https://github.com/apache/druid/pull/10287#discussion_r551675826", "bodyText": "nit: Collections.unmodifiableList(duties)", "author": "jihoonson", "createdAt": "2021-01-05T02:07:39Z", "path": "server/src/main/java/org/apache/druid/server/coordinator/DruidCoordinator.java", "diffHunk": "@@ -669,21 +669,31 @@ private void stopBeingLeader()\n \n   private List<CoordinatorDuty> makeHistoricalManagementDuties()\n   {\n-    return ImmutableList.of(\n-        new LogUsedSegments(),\n+    List<CoordinatorDuty> duties = new ArrayList<>();\n+    if (config.isLogUsedSegmentsDutyEnabled()) {\n+      duties.add(new LogUsedSegments());\n+    }\n+    duties.addAll(ImmutableList.of(\n         new UpdateCoordinatorStateAndPrepareCluster(),\n         new RunRules(DruidCoordinator.this),\n         new UnloadUnusedSegments(),\n         new MarkAsUnusedOvershadowedSegments(DruidCoordinator.this),\n         new BalanceSegments(DruidCoordinator.this),\n         new EmitClusterStatsAndMetrics(DruidCoordinator.this)\n+    ));\n+    log.debug(\n+        \"Done making historical management duties %s\",\n+        duties.stream().map(duty -> duty.getClass().getName()).collect(Collectors.toList())\n     );\n+    return duties;", "originalCommit": "60f2067c2b04d75d5e260c4aef0c6009e31a088d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDExOTcwNg==", "url": "https://github.com/apache/druid/pull/10287#discussion_r554119706", "bodyText": "reverting to the original way of doing this now that LogUsedSegments is always used again", "author": "capistrant", "createdAt": "2021-01-08T18:31:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MTY3NTgyNg=="}], "type": "inlineReview"}, {"oid": "20bd6e244827ca5523ca0504360ffa2aefad6bb8", "url": "https://github.com/apache/druid/commit/20bd6e244827ca5523ca0504360ffa2aefad6bb8", "message": "add default column to docs for new config", "committedDate": "2021-01-05T22:08:05Z", "type": "commit"}, {"oid": "1bf750d248802432d52590ec6e0672d3ba25f91e", "url": "https://github.com/apache/druid/commit/1bf750d248802432d52590ec6e0672d3ba25f91e", "message": "Merge branch 'master' into logUsedSegmentsDuty-toggle", "committedDate": "2021-01-06T20:36:16Z", "type": "commit"}, {"oid": "e77b3209ec5b068d19d3f04c448489c686986942", "url": "https://github.com/apache/druid/commit/e77b3209ec5b068d19d3f04c448489c686986942", "message": "remove legacy code in LogUsedSegments and remove config to disbale duty", "committedDate": "2021-01-08T18:24:59Z", "type": "commit"}, {"oid": "c6d3ddf59f619079ef89c8a3eb27293bf6b11e12", "url": "https://github.com/apache/druid/commit/c6d3ddf59f619079ef89c8a3eb27293bf6b11e12", "message": "fix makeHistoricalMangementDuties now that the returned list is always the same", "committedDate": "2021-01-08T18:31:03Z", "type": "commit"}]}