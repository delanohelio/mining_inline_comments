{"pr_number": 327, "pr_title": "Security", "pr_createdAt": "2020-05-26T14:52:20Z", "pr_url": "https://github.com/questdb/questdb/pull/327", "timeline": [{"oid": "1132ce653437690e6b9348f7d9508f13c46e88d8", "url": "https://github.com/questdb/questdb/commit/1132ce653437690e6b9348f7d9508f13c46e88d8", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-19T21:42:33Z", "type": "commit"}, {"oid": "1bc9341c23870b6d6a2b8a546831e475bb3940a9", "url": "https://github.com/questdb/questdb/commit/1bc9341c23870b6d6a2b8a546831e475bb3940a9", "message": "chore: Allow queries that fail for certain exceptions (security) to be cached", "committedDate": "2020-05-20T08:48:32Z", "type": "commit"}, {"oid": "a3e74c41f8f325316b8283662103c837857f49d4", "url": "https://github.com/questdb/questdb/commit/a3e74c41f8f325316b8283662103c837857f49d4", "message": "chore: Allow queries that fail for certain exceptions (security) to be cached", "committedDate": "2020-05-20T10:36:40Z", "type": "commit"}, {"oid": "2670ca1dbe3d02c94707708e4bdf5ad29e0dc286", "url": "https://github.com/questdb/questdb/commit/2670ca1dbe3d02c94707708e4bdf5ad29e0dc286", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-20T13:30:45Z", "type": "commit"}, {"oid": "e46df08a3c5c847e3b5ef542515256f33d7528c3", "url": "https://github.com/questdb/questdb/commit/e46df08a3c5c847e3b5ef542515256f33d7528c3", "message": "chore: Allow queries that fail for certain exceptions (security) to be cached", "committedDate": "2020-05-20T15:47:49Z", "type": "commit"}, {"oid": "f0f4d919fd7691c62cf119c330df048fdba6caff", "url": "https://github.com/questdb/questdb/commit/f0f4d919fd7691c62cf119c330df048fdba6caff", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-20T16:07:45Z", "type": "commit"}, {"oid": "b3dce73c5599ea46c177023eded6378f03037e6d", "url": "https://github.com/questdb/questdb/commit/b3dce73c5599ea46c177023eded6378f03037e6d", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-20T16:45:19Z", "type": "commit"}, {"oid": "45b63cc11c880f8969f6052bff045a41c24a6857", "url": "https://github.com/questdb/questdb/commit/45b63cc11c880f8969f6052bff045a41c24a6857", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-20T21:35:11Z", "type": "commit"}, {"oid": "900655ddb51fbc48f854958fb0ee8125c01f5cdf", "url": "https://github.com/questdb/questdb/commit/900655ddb51fbc48f854958fb0ee8125c01f5cdf", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-20T22:08:41Z", "type": "commit"}, {"oid": "c9e06b1e8d5e066d503718bb853e79a1d7e2ce08", "url": "https://github.com/questdb/questdb/commit/c9e06b1e8d5e066d503718bb853e79a1d7e2ce08", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-26T10:48:18Z", "type": "commit"}, {"oid": "eaadcb463ab0b6fea1e33538c593fae5a3e97ea1", "url": "https://github.com/questdb/questdb/commit/eaadcb463ab0b6fea1e33538c593fae5a3e97ea1", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-26T12:35:34Z", "type": "commit"}, {"oid": "fe61ffb911cb903dd44cb8550a2e6848e475e673", "url": "https://github.com/questdb/questdb/commit/fe61ffb911cb903dd44cb8550a2e6848e475e673", "message": "Merge branch 'master' into test", "committedDate": "2020-05-26T13:26:27Z", "type": "commit"}, {"oid": "58bac4981744402bb683178af10e365483b194da", "url": "https://github.com/questdb/questdb/commit/58bac4981744402bb683178af10e365483b194da", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-26T13:40:16Z", "type": "commit"}, {"oid": "426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e", "url": "https://github.com/questdb/questdb/commit/426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e", "message": "chore: questdb can be configured to limit the number of in memory rows", "committedDate": "2020-05-26T14:04:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ3Nzc3Ng==", "url": "https://github.com/questdb/questdb/pull/327#discussion_r430477776", "bodyText": "i'm a little dubious how does this work?", "author": "bluestreak01", "createdAt": "2020-05-26T14:57:16Z", "path": "core/src/main/java/io/questdb/griffin/engine/orderby/RecordTreeChain.java", "diffHunk": "@@ -160,43 +164,48 @@ public TreeCursor getCursor(RecordCursor base) {\n     }\n \n     public void put(Record record) {\n-        if (root == -1) {\n-            putParent(record);\n-            return;\n-        }\n+        if (size < maxSize) {\n+            size++;\n+            if (root == -1) {\n+                putParent(record);\n+                return;\n+            }\n+\n+            comparator.setLeft(record);\n+\n+            long p = root;\n+            long parent;\n+            int cmp;\n+            do {\n+                parent = p;\n+                long r = refOf(p);\n+                recordChain.recordAt(recordChainRecord, r);\n+                cmp = comparator.compare(recordChainRecord);\n+                if (cmp < 0) {\n+                    p = leftOf(p);\n+                } else if (cmp > 0) {\n+                    p = rightOf(p);\n+                } else {\n+                    setRef(p, recordChain.put(record, r));\n+                    return;\n+                }\n+            } while (p > -1);\n \n-        comparator.setLeft(record);\n+            p = allocateBlock();\n+            setParent(p, parent);\n+            long r = recordChain.put(record, -1L);\n+            setTop(p, r);\n+            setRef(p, r);\n \n-        long p = root;\n-        long parent;\n-        int cmp;\n-        do {\n-            parent = p;\n-            long r = refOf(p);\n-            recordChain.recordAt(recordChainRecord, r);\n-            cmp = comparator.compare(recordChainRecord);\n             if (cmp < 0) {\n-                p = leftOf(p);\n-            } else if (cmp > 0) {\n-                p = rightOf(p);\n+                setLeft(parent, p);\n             } else {\n-                setRef(p, recordChain.put(record, r));\n-                return;\n+                setRight(parent, p);\n             }\n-        } while (p > -1);\n-\n-        p = allocateBlock();\n-        setParent(p, parent);\n-        long r = recordChain.put(record, -1L);\n-        setTop(p, r);\n-        setRef(p, r);\n-\n-        if (cmp < 0) {\n-            setLeft(parent, p);\n+            fix(p);\n         } else {\n-            setRight(parent, p);\n+            throw LimitOverflowException.instance(maxSize);", "originalCommit": "426e2d7bd347d0b0cfb880fc7eac30e3a620aa3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}