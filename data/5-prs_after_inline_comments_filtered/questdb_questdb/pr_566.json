{"pr_number": 566, "pr_title": "PG wire - bound parameters in nodejs fix #290", "pr_createdAt": "2020-08-26T13:17:54Z", "pr_url": "https://github.com/questdb/questdb/pull/566", "timeline": [{"oid": "fb44b00c5827026cb3cced9d54e4719d9a6448ae", "url": "https://github.com/questdb/questdb/commit/fb44b00c5827026cb3cced9d54e4719d9a6448ae", "message": "PG Wire - flush message support, inferring parameter types", "committedDate": "2020-08-23T21:08:43Z", "type": "commit"}, {"oid": "283c534d85522d6f12b43aff60e66afbee0a59c5", "url": "https://github.com/questdb/questdb/commit/283c534d85522d6f12b43aff60e66afbee0a59c5", "message": "PG Wire - fixed text/binary format", "committedDate": "2020-08-24T11:13:33Z", "type": "commit"}, {"oid": "c3987680a323fc8dd2e32901e1f67d7cf5583c54", "url": "https://github.com/questdb/questdb/commit/c3987680a323fc8dd2e32901e1f67d7cf5583c54", "message": "PG Wire - removed commented code", "committedDate": "2020-08-26T12:39:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzNDAxNQ==", "url": "https://github.com/questdb/questdb/pull/566#discussion_r477334015", "bodyText": "This method is introduced but not tested. How does this map to PG type?", "author": "bluestreak01", "createdAt": "2020-08-26T14:13:38Z", "path": "core/src/main/java/io/questdb/cutlass/pgwire/PGConnectionContext.java", "diffHunk": "@@ -518,6 +540,12 @@ private void appendByteColumn(Record record, int columnIndex) {\n         responseAsciiSink.putLenEx(a);\n     }\n \n+    private void appendCharColumn(Record record, int columnIndex) {", "originalCommit": "c3987680a323fc8dd2e32901e1f67d7cf5583c54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE5OTgwNw==", "url": "https://github.com/questdb/questdb/pull/566#discussion_r478199807", "bodyText": "sorry, removed as not used", "author": "jaugsburger", "createdAt": "2020-08-27T07:01:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzNDAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzNDUxMQ==", "url": "https://github.com/questdb/questdb/pull/566#discussion_r477334511", "bodyText": "inferParameterType() is liable to return -1, which is not handled and not tested either.", "author": "bluestreak01", "createdAt": "2020-08-26T14:14:19Z", "path": "core/src/main/java/io/questdb/cutlass/pgwire/PGConnectionContext.java", "diffHunk": "@@ -690,11 +702,50 @@ private void bindVariables(\n                 throw BadProtocolException.INSTANCE;\n             }\n             ensureData(lo, valueLen, msgLimit, j);\n+            //infer type if needed\n+            if (inferTypes) {\n+                int pgType = inferParameterType(lo, valueLen);", "originalCommit": "c3987680a323fc8dd2e32901e1f67d7cf5583c54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE5OTg2OA==", "url": "https://github.com/questdb/questdb/pull/566#discussion_r478199868", "bodyText": "fixed", "author": "jaugsburger", "createdAt": "2020-08-27T07:01:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzNDUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzNDgxNg==", "url": "https://github.com/questdb/questdb/pull/566#discussion_r477334816", "bodyText": "tests don't get here", "author": "bluestreak01", "createdAt": "2020-08-26T14:14:39Z", "path": "core/src/main/java/io/questdb/cutlass/pgwire/PGConnectionContext.java", "diffHunk": "@@ -817,6 +868,16 @@ private CharSequence getStatementName(long lo, long hi) throws BadProtocolExcept\n         return statementName;\n     }\n \n+    private int inferParameterType(long lo, int valueLen) {\n+        for (int i = 0; i < typeManager.getProbeCount(); i++) {\n+            TypeAdapter typeAdapter = typeManager.getProbe(i);\n+            if (typeAdapter.probe(parameterHolder.of(lo, lo + valueLen))) {\n+                return typeOids.get(typeAdapter.getType());\n+            }\n+        }\n+        return -1;", "originalCommit": "c3987680a323fc8dd2e32901e1f67d7cf5583c54", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODE5OTk2Mg==", "url": "https://github.com/questdb/questdb/pull/566#discussion_r478199962", "bodyText": "added test", "author": "jaugsburger", "createdAt": "2020-08-27T07:01:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzMzNDgxNg=="}], "type": "inlineReview"}, {"oid": "7c58ec2c6aa0e4b3fa8eadf35940c2e0c1bc33f3", "url": "https://github.com/questdb/questdb/commit/7c58ec2c6aa0e4b3fa8eadf35940c2e0c1bc33f3", "message": "PG Wire - PR comments", "committedDate": "2020-08-26T22:06:24Z", "type": "commit"}]}