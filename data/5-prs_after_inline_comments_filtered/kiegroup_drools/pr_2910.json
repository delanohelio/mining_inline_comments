{"pr_number": 2910, "pr_title": "Drools 5258 - Use kjar artifact for PMML evaluation", "pr_createdAt": "2020-05-22T11:44:22Z", "pr_url": "https://github.com/kiegroup/drools/pull/2910", "timeline": [{"oid": "835616bde6986f7dc0e0703429d0523f1f08be6d", "url": "https://github.com/kiegroup/drools/commit/835616bde6986f7dc0e0703429d0523f1f08be6d", "message": "[DROOLS-4859] Fixing generic models archetype", "committedDate": "2020-04-15T13:46:02Z", "type": "commit"}, {"oid": "5c128e3cd0eac7ea391897c48e847b42b327d521", "url": "https://github.com/kiegroup/drools/commit/5c128e3cd0eac7ea391897c48e847b42b327d521", "message": "[DROOLS-4859] Implemented model-drools archetype", "committedDate": "2020-04-15T15:07:36Z", "type": "commit"}, {"oid": "225e4f8641a2e25fb4ce84f3b60bc7e998bb4321", "url": "https://github.com/kiegroup/drools/commit/225e4f8641a2e25fb4ce84f3b60bc7e998bb4321", "message": "[DROOLS-4859] Created scorecard stub module", "committedDate": "2020-04-15T15:47:45Z", "type": "commit"}, {"oid": "042d3f7de3662423667e6c792a3c626a6b0d2e74", "url": "https://github.com/kiegroup/drools/commit/042d3f7de3662423667e6c792a3c626a6b0d2e74", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589\n\n# Conflicts:\n#\tkie-pmml-new/kie-pmml-models-drools-archetype/Readme.md\n#\tkie-pmml-new/kie-pmml-models-drools-archetype/pom.xml\n#\tkie-pmml-new/kie-pmml-models-drools-archetype/src/main/resources/archetype-resources/__rootArtifactId__-compiler/src/test/java/__packageModelName__/drools/compiler/executor/__modelName__ModelImplementationProviderTest.java", "committedDate": "2020-04-21T08:25:33Z", "type": "commit"}, {"oid": "7adcdd3c8c096cac30016fe10da0986a2c7a3d7a", "url": "https://github.com/kiegroup/drools/commit/7adcdd3c8c096cac30016fe10da0986a2c7a3d7a", "message": "[DROOLS-5261] Move shared code/classes to common modules/packages", "committedDate": "2020-04-21T12:15:41Z", "type": "commit"}, {"oid": "14941f4e8c434c9699a7bef09805833d1eaec50a", "url": "https://github.com/kiegroup/drools/commit/14941f4e8c434c9699a7bef09805833d1eaec50a", "message": "Merge remote-tracking branch 'gitgabrio/DROOLS-5261' into DROOLS-4589", "committedDate": "2020-04-21T12:20:26Z", "type": "commit"}, {"oid": "abbd37ab37e5855a71f3b68147167dca141c6004", "url": "https://github.com/kiegroup/drools/commit/abbd37ab37e5855a71f3b68147167dca141c6004", "message": "[DROOLS-4589] Begin implementation of AST factories", "committedDate": "2020-04-21T14:15:39Z", "type": "commit"}, {"oid": "f265105d4db3db0056b647b89960839ac7f2585d", "url": "https://github.com/kiegroup/drools/commit/f265105d4db3db0056b647b89960839ac7f2585d", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589", "committedDate": "2020-04-21T14:15:46Z", "type": "commit"}, {"oid": "350dbfe5cff1d04f47a6c53511997eaae99386aa", "url": "https://github.com/kiegroup/drools/commit/350dbfe5cff1d04f47a6c53511997eaae99386aa", "message": "[DROOLS-4589] Basic working status. No expression implemented", "committedDate": "2020-04-22T12:40:48Z", "type": "commit"}, {"oid": "e38cda04a211d7addddeeab913df98d119ecc230", "url": "https://github.com/kiegroup/drools/commit/e38cda04a211d7addddeeab913df98d119ecc230", "message": "[DROOLS-5270] Refactored AST factories to avoid duplication between tree model and scorecard model", "committedDate": "2020-04-23T15:45:35Z", "type": "commit"}, {"oid": "b2ed543945ff67a0593ce26b9c6d53187b329ede", "url": "https://github.com/kiegroup/drools/commit/b2ed543945ff67a0593ce26b9c6d53187b329ede", "message": "Merge remote-tracking branch 'gitgabrio/DROOLS-5270' into DROOLS-4589\n\n# Conflicts:\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/ast/factories/KiePMMLCompoundPredicateASTFactory.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/ast/factories/KiePMMLPredicateASTFactory.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/ast/factories/KiePMMLSimplePredicateASTFactory.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/ast/factories/KiePMMLSimpleSetPredicateASTFactory.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/ast/factories/KiePMMLTruePredicateASTFactory.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/commons/factories/KiePMMLDescrRhsFactory.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/test/java/org/kie/pmml/models/drools/ast/factories/KiePMMLCompoundPredicateASTFactoryTest.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/test/java/org/kie/pmml/models/drools/ast/factories/KiePMMLSimplePredicateASTFactoryTest.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/test/java/org/kie/pmml/models/drools/ast/factories/KiePMMLSimpleSetPredicateASTFactoryTest.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/test/java/org/kie/pmml/models/drools/ast/factories/KiePMMLTruePredicateASTFactoryTest.java\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/main/java/org/kie/pmml/models/drools/tree/compiler/factories/KiePMMLTreeModelNodeASTFactory.java", "committedDate": "2020-04-23T15:53:04Z", "type": "commit"}, {"oid": "50e0eda6781e8250d2b4dd02489067002999f7c7", "url": "https://github.com/kiegroup/drools/commit/50e0eda6781e8250d2b4dd02489067002999f7c7", "message": "[DROOLS-5270] Fixed as per PR suggestin", "committedDate": "2020-04-24T08:27:12Z", "type": "commit"}, {"oid": "597483906ae6b2e85308a58c4c6bb5a83839fd70", "url": "https://github.com/kiegroup/drools/commit/597483906ae6b2e85308a58c4c6bb5a83839fd70", "message": "[DROOLS-4589] Minor fix", "committedDate": "2020-04-24T09:57:19Z", "type": "commit"}, {"oid": "4fe7fe670ea4170be22ac983b475d3c768e44455", "url": "https://github.com/kiegroup/drools/commit/4fe7fe670ea4170be22ac983b475d3c768e44455", "message": "Merge remote-tracking branch 'gitgabrio/DROOLS-5270' into DROOLS-4589", "committedDate": "2020-04-24T09:58:01Z", "type": "commit"}, {"oid": "76aacecf92180069ad7d5654abf452d63bad102b", "url": "https://github.com/kiegroup/drools/commit/76aacecf92180069ad7d5654abf452d63bad102b", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589\n\n# Conflicts:\n#\tkie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/executor/KiePMMLStatusHolder.java", "committedDate": "2020-04-24T13:10:23Z", "type": "commit"}, {"oid": "f28a145b338ec0a37ff309d0801ea4a5c17e182a", "url": "https://github.com/kiegroup/drools/commit/f28a145b338ec0a37ff309d0801ea4a5c17e182a", "message": "[DROOLS-4589] Minor fix", "committedDate": "2020-04-24T13:16:42Z", "type": "commit"}, {"oid": "1d1a0304fafc0acb4f7c997fa8e361d4e2c78ba0", "url": "https://github.com/kiegroup/drools/commit/1d1a0304fafc0acb4f7c997fa8e361d4e2c78ba0", "message": "[DROOLS-4589] Add Release status", "committedDate": "2020-04-24T13:20:13Z", "type": "commit"}, {"oid": "a17602bdf89f87c839634bd7728d3799bfd76341", "url": "https://github.com/kiegroup/drools/commit/a17602bdf89f87c839634bd7728d3799bfd76341", "message": "[DROOLS-4589] Refactored DATA_TYPE to avoid reflection. Implemented PrimitiveBoxedUtils as support", "committedDate": "2020-04-28T09:34:12Z", "type": "commit"}, {"oid": "69fb7fc99d63af83ffa98f9c56d2432a7addca74", "url": "https://github.com/kiegroup/drools/commit/69fb7fc99d63af83ffa98f9c56d2432a7addca74", "message": "[DROOLS-4589] Implemented KiePMMLScorecardModelCharacteristicASTFactoryTest. Implemented missing tests. Refactoring some common classes", "committedDate": "2020-04-28T10:21:03Z", "type": "commit"}, {"oid": "4ddd196f0f3fd084dcd2fb2ec5ebdcbe3a1986a6", "url": "https://github.com/kiegroup/drools/commit/4ddd196f0f3fd084dcd2fb2ec5ebdcbe3a1986a6", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589", "committedDate": "2020-04-28T12:29:48Z", "type": "commit"}, {"oid": "e548de06921b59f16e783c08620481789c8769b2", "url": "https://github.com/kiegroup/drools/commit/e548de06921b59f16e783c08620481789c8769b2", "message": "[DROOLS-4589] Cleanup", "committedDate": "2020-04-28T12:30:09Z", "type": "commit"}, {"oid": "ef39f0f83350d5162c4f4463ef35e7ecc8600cc2", "url": "https://github.com/kiegroup/drools/commit/ef39f0f83350d5162c4f4463ef35e7ecc8600cc2", "message": "[DROOLS-4589] Fixed as per PR suggestions", "committedDate": "2020-04-28T12:56:30Z", "type": "commit"}, {"oid": "47e299560a793700f8f1ee7ad1e1ff54458f83c0", "url": "https://github.com/kiegroup/drools/commit/47e299560a793700f8f1ee7ad1e1ff54458f83c0", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589", "committedDate": "2020-04-29T09:17:17Z", "type": "commit"}, {"oid": "43d17682b77f8e09459d1cdb98cda929838b9e4e", "url": "https://github.com/kiegroup/drools/commit/43d17682b77f8e09459d1cdb98cda929838b9e4e", "message": "[DROOLS-4589] Move drools evaluation inside model itself", "committedDate": "2020-04-29T10:02:17Z", "type": "commit"}, {"oid": "344f7f1a9d140a15b51ce72356c591f609148e9b", "url": "https://github.com/kiegroup/drools/commit/344f7f1a9d140a15b51ce72356c591f609148e9b", "message": "[DROOLS-5239] Simple scorecard test", "committedDate": "2020-04-29T11:33:52Z", "type": "commit"}, {"oid": "dfe93748cd419cc33de30a12ddf337fd979bc157", "url": "https://github.com/kiegroup/drools/commit/dfe93748cd419cc33de30a12ddf337fd979bc157", "message": "[DROOLS-4589] Fixing usage of Attribute partialScore inside generated rules", "committedDate": "2020-04-29T12:59:08Z", "type": "commit"}, {"oid": "fb212d7cf826ca0085dc17237a43e6b2806c59a0", "url": "https://github.com/kiegroup/drools/commit/fb212d7cf826ca0085dc17237a43e6b2806c59a0", "message": "[DROOLS-5239] Fix simple scorecard test", "committedDate": "2020-04-29T13:42:07Z", "type": "commit"}, {"oid": "0febba16cacc586c2fdceb8387b33246f2a1cb28", "url": "https://github.com/kiegroup/drools/commit/0febba16cacc586c2fdceb8387b33246f2a1cb28", "message": "[DROOLS-4589] Fixing OutputField (only for predictedValue feature)", "committedDate": "2020-04-29T14:24:02Z", "type": "commit"}, {"oid": "abef3d79fad32dd64c479f0393d95d898c06ac91", "url": "https://github.com/kiegroup/drools/commit/abef3d79fad32dd64c479f0393d95d898c06ac91", "message": "Merge remote-tracking branch 'gitgabrio/DROOLS-4589' into DROOLS-4589", "committedDate": "2020-04-29T14:24:13Z", "type": "commit"}, {"oid": "2dc39fbbce1400666793c381fa446a1a15c05b0b", "url": "https://github.com/kiegroup/drools/commit/2dc39fbbce1400666793c381fa446a1a15c05b0b", "message": "[DROOLS-5239] Use target fields for tests", "committedDate": "2020-04-29T14:30:44Z", "type": "commit"}, {"oid": "41f3812514aae8413e176ae16faf642156cc7c54", "url": "https://github.com/kiegroup/drools/commit/41f3812514aae8413e176ae16faf642156cc7c54", "message": "[DROOLS-5239] Add test for simple scorecard with categorical variables", "committedDate": "2020-04-29T14:49:13Z", "type": "commit"}, {"oid": "09da97b521f826a43048cfb275c804f3261f67a3", "url": "https://github.com/kiegroup/drools/commit/09da97b521f826a43048cfb275c804f3261f67a3", "message": "[DROOLS-5239] Add simple scorecard test with mixed variables", "committedDate": "2020-04-30T10:53:57Z", "type": "commit"}, {"oid": "d7b6d1a7ccc13b1003e485ff684469b08df9c960", "url": "https://github.com/kiegroup/drools/commit/d7b6d1a7ccc13b1003e485ff684469b08df9c960", "message": "[DROOLS-5239] Add test for compound predicates in scorecards", "committedDate": "2020-04-30T14:25:32Z", "type": "commit"}, {"oid": "8092604c1eef46bac24646928947ff740acd42f2", "url": "https://github.com/kiegroup/drools/commit/8092604c1eef46bac24646928947ff740acd42f2", "message": "[DROOLS-4589] Implemented reason code evaluation", "committedDate": "2020-04-30T15:07:27Z", "type": "commit"}, {"oid": "57f5cf123d76671bfddc74b0785dbc20d7a131a9", "url": "https://github.com/kiegroup/drools/commit/57f5cf123d76671bfddc74b0785dbc20d7a131a9", "message": "Merge branch 'DROOLS-4589' of github.com:gitgabrio/drools into DROOLS-4589", "committedDate": "2020-04-30T15:08:43Z", "type": "commit"}, {"oid": "0f0724040e0e801922ea448d37e3befc42ef3f1f", "url": "https://github.com/kiegroup/drools/commit/0f0724040e0e801922ea448d37e3befc42ef3f1f", "message": "[DROOLS-4589] Fixed evaluation with compound predicates. Fixed reasoncode population", "committedDate": "2020-04-30T15:50:42Z", "type": "commit"}, {"oid": "2041554a4fa2fc319df1d1554695f1523b89961d", "url": "https://github.com/kiegroup/drools/commit/2041554a4fa2fc319df1d1554695f1523b89961d", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589", "committedDate": "2020-04-30T15:51:11Z", "type": "commit"}, {"oid": "88f775a7b65079ef27726f58d5d1727d09efb062", "url": "https://github.com/kiegroup/drools/commit/88f775a7b65079ef27726f58d5d1727d09efb062", "message": "[DROOLS-5239] Add tests for nested compound predicates in scorecards", "committedDate": "2020-05-04T13:28:55Z", "type": "commit"}, {"oid": "2d7f52a16dd8125390428a23dc9cda673c88a6aa", "url": "https://github.com/kiegroup/drools/commit/2d7f52a16dd8125390428a23dc9cda673c88a6aa", "message": "[DROOLS-5239] Add basic test for evaluation of partial score", "committedDate": "2020-05-04T14:47:43Z", "type": "commit"}, {"oid": "6f0688720a922cb10d2877eebcc0a7316e976085", "url": "https://github.com/kiegroup/drools/commit/6f0688720a922cb10d2877eebcc0a7316e976085", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589", "committedDate": "2020-05-05T07:38:13Z", "type": "commit"}, {"oid": "447f49ab863a2f68d6940fcd6386d492d03ab093", "url": "https://github.com/kiegroup/drools/commit/447f49ab863a2f68d6940fcd6386d492d03ab093", "message": "[DROOLS-4589] Fixed CompoundNestedPredicate. Update version", "committedDate": "2020-05-05T13:18:51Z", "type": "commit"}, {"oid": "68c5db7371489d16e3f2872bca7226a76e566213", "url": "https://github.com/kiegroup/drools/commit/68c5db7371489d16e3f2872bca7226a76e566213", "message": "[DROOLS-4589] Ignoring BasicComplexPartialScoreTest since it is using ComplexPartialScore -> Expression (not implemented in this iteration)", "committedDate": "2020-05-05T13:37:00Z", "type": "commit"}, {"oid": "d83c7b702e7c955bcb89ad260d03ba680b0706a7", "url": "https://github.com/kiegroup/drools/commit/d83c7b702e7c955bcb89ad260d03ba680b0706a7", "message": "[DROOLS-5239] Add test for nested complex partial score", "committedDate": "2020-05-05T14:04:21Z", "type": "commit"}, {"oid": "630733ca1504761fdc3896f0fba8af7c09dfda9a", "url": "https://github.com/kiegroup/drools/commit/630733ca1504761fdc3896f0fba8af7c09dfda9a", "message": "[DROOLS-4589] Minor refactoring. Add unit tests.", "committedDate": "2020-05-06T14:21:47Z", "type": "commit"}, {"oid": "46051d7a62218a4f1bf1a493622fc804de1de6a9", "url": "https://github.com/kiegroup/drools/commit/46051d7a62218a4f1bf1a493622fc804de1de6a9", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-4589", "committedDate": "2020-05-06T14:22:20Z", "type": "commit"}, {"oid": "3d8352a8d4fa60112b292ffb6e9c62d51626bf10", "url": "https://github.com/kiegroup/drools/commit/3d8352a8d4fa60112b292ffb6e9c62d51626bf10", "message": "[DROOLS-4589] Fixing as per PR suggestions", "committedDate": "2020-05-07T07:56:49Z", "type": "commit"}, {"oid": "16c151a0e4fc06492a095c5a99bde9ea0f965da8", "url": "https://github.com/kiegroup/drools/commit/16c151a0e4fc06492a095c5a99bde9ea0f965da8", "message": "[DROOLS-4589] Replaced String with OPERATOR inside KiePMMLOperatorValue", "committedDate": "2020-05-07T09:05:58Z", "type": "commit"}, {"oid": "d93f63c903945f2341ec38ec0ac3f65be8721a2b", "url": "https://github.com/kiegroup/drools/commit/d93f63c903945f2341ec38ec0ac3f65be8721a2b", "message": "[DROOLS-4589] Replaced String with BOOLEAN_OPERATOR inside KiePMMLFieldOperatorValue", "committedDate": "2020-05-07T09:05:58Z", "type": "commit"}, {"oid": "a71995a93899d483efe56b4b76c6a8d03e4d6594", "url": "https://github.com/kiegroup/drools/commit/a71995a93899d483efe56b4b76c6a8d03e4d6594", "message": "[DROOLS-5258] Add Readme.md", "committedDate": "2020-05-07T10:19:19Z", "type": "commit"}, {"oid": "7cc995e35948a7e4e49a89713189af8e82b82ce1", "url": "https://github.com/kiegroup/drools/commit/7cc995e35948a7e4e49a89713189af8e82b82ce1", "message": "Merge branch 'DROOLS-5258' of github.com:gitgabrio/drools into DROOLS-5258", "committedDate": "2020-05-07T10:20:47Z", "type": "commit"}, {"oid": "c47d8fecf55dcd7678da39e33199a70e3c3adfd9", "url": "https://github.com/kiegroup/drools/commit/c47d8fecf55dcd7678da39e33199a70e3c3adfd9", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5258", "committedDate": "2020-05-07T12:28:26Z", "type": "commit"}, {"oid": "768c87d0d18ef1d9ca89ac3d97d62b22f8b45319", "url": "https://github.com/kiegroup/drools/commit/768c87d0d18ef1d9ca89ac3d97d62b22f8b45319", "message": "[DROOLS-5258] Removed PackageDescr from KiePMMLDroolsModel. Changed way of KieSession instantiation for Drools model evaluation. Changed package name for generated RegressionModels. Fixed all tests.", "committedDate": "2020-05-15T13:26:18Z", "type": "commit"}, {"oid": "b0557064684e47925762c067cf934a9c90a81ba4", "url": "https://github.com/kiegroup/drools/commit/b0557064684e47925762c067cf934a9c90a81ba4", "message": "[DROOLS-5258] Code-generating KiePMMLScorecardModel inside KiePMMLScorecardModelFactory.getKiePMMLScorecardModel. All tests running. Working status with kjar not verified", "committedDate": "2020-05-18T09:37:01Z", "type": "commit"}, {"oid": "4ff0647a7454c60dbef92250f43d1668bb4b2c56", "url": "https://github.com/kiegroup/drools/commit/4ff0647a7454c60dbef92250f43d1668bb4b2c56", "message": "[DROOLS-5258] Fixing scoremodel code-generation. Code-generating KiePMMLModelFactories.", "committedDate": "2020-05-19T11:20:29Z", "type": "commit"}, {"oid": "7cb9ef09808c3d92e546cdcc76723c4fa7d6e1e6", "url": "https://github.com/kiegroup/drools/commit/7cb9ef09808c3d92e546cdcc76723c4fa7d6e1e6", "message": "[DROOLS-5258] Fixing scoremodel code-generation. Code-generating KiePMMLModelFactories.", "committedDate": "2020-05-19T11:20:56Z", "type": "commit"}, {"oid": "d6541a81e32cedeb2de0816dcb6fb91e70293b88", "url": "https://github.com/kiegroup/drools/commit/d6541a81e32cedeb2de0816dcb6fb91e70293b88", "message": "[DROOLS-5258] Fix package assembling when invoked at runtime. Propagating original kiebase to avoid retrieval of new container.", "committedDate": "2020-05-22T07:33:13Z", "type": "commit"}, {"oid": "4752ce7e5ebf3cbeaa5e0de646912b9aac8b0eed", "url": "https://github.com/kiegroup/drools/commit/4752ce7e5ebf3cbeaa5e0de646912b9aac8b0eed", "message": "[DROOLS-5258] Removing usage of GAV for session retrieval. Using only propagated kiebase", "committedDate": "2020-05-22T08:45:02Z", "type": "commit"}, {"oid": "e059d141b44ed5af369d79f044ec92bdf9538164", "url": "https://github.com/kiegroup/drools/commit/e059d141b44ed5af369d79f044ec92bdf9538164", "message": "[DROOLS-5258] Removing releaseId from signatures.", "committedDate": "2020-05-22T10:50:41Z", "type": "commit"}, {"oid": "7a43e35ba1f60c439ade93dcf487510f5b5b3059", "url": "https://github.com/kiegroup/drools/commit/7a43e35ba1f60c439ade93dcf487510f5b5b3059", "message": "[DROOLS-5258] Removing releaseId from signatures.", "committedDate": "2020-05-22T10:58:09Z", "type": "commit"}, {"oid": "5090b5dfbdcd44c98d9754f41a4f0086c504dcba", "url": "https://github.com/kiegroup/drools/commit/5090b5dfbdcd44c98d9754f41a4f0086c504dcba", "message": "[DROOLS-5258] Implemented KnowledgeBaseUtils.", "committedDate": "2020-05-22T11:31:40Z", "type": "commit"}, {"oid": "4958630e6805076ec56fcb377bb33385b7865bca", "url": "https://github.com/kiegroup/drools/commit/4958630e6805076ec56fcb377bb33385b7865bca", "message": "[DROOLS-5258] Implemented KnowledgeBaseUtils.", "committedDate": "2020-05-22T11:32:03Z", "type": "commit"}, {"oid": "8fb77328113958ca1abc6d3fc33c92435be329e0", "url": "https://github.com/kiegroup/drools/commit/8fb77328113958ca1abc6d3fc33c92435be329e0", "message": "[DROOLS-5258] Add private constructor to KnowledgeBaseUtils.", "committedDate": "2020-05-22T11:32:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMDc2OA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429200768", "bodyText": "What is the reason of this change? Why only Scorecard should be different?", "author": "danielezonca", "createdAt": "2020-05-22T11:48:26Z", "path": "kie-pmml-new/kie-pmml-commons/src/main/java/org/kie/pmml/commons/model/enums/PMML_MODEL.java", "diffHunk": "@@ -40,7 +40,7 @@\n     REGRESSION_MODEL(\"RegressionModel\"),\n     RULESET_MODEL(\"RulesetModel\"),\n     SEQUENCE_MODEL(\"SequenceModel\"),\n-    SCORECARD_MODEL(\"ScorecardModel\"),\n+    SCORECARD_MODEL(\"Scorecard\"),", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0OTIzNA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429749234", "bodyText": "@danielezonca\nThose are the names as defined inside jpmml parser, indicated in the javadoc of the enum itself", "author": "gitgabrio", "createdAt": "2020-05-25T06:17:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMDc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMjQ1Ng==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429202456", "bodyText": "Is there any reason why you are removing _?\nIs this package name visible/known by the user?\nIf it is an implementation detail as I expect I would prefer to avoid name clash so I propose to replace this method as\n        return modelName.replace(\" \", \"_\").replace(\"_\", \"__\");\nWdyt?", "author": "danielezonca", "createdAt": "2020-05-22T11:52:39Z", "path": "kie-pmml-new/kie-pmml-commons/src/main/java/org/kie/pmml/commons/utils/KiePMMLModelUtils.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.commons.utils;\n+\n+public class KiePMMLModelUtils {\n+\n+    private KiePMMLModelUtils() {\n+    }\n+\n+    /**\n+     * Method to be used by <b>every</b> KiePMML implementation to retrieve the <b>package</b> name\n+     * out of the model name\n+     * @param modelName\n+     * @return\n+     */\n+    public static String getSanitizedPackageName(String modelName) {\n+        return modelName.replace(\" \", \"\").replace(\"_\", \"\").toLowerCase();", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc1NTYwMQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429755601", "bodyText": "@danielezonca\nAll those \"generated\" names (package name, class name) should be hidden to final user.\nI do not think such modification is needed, and anyway would not resolve a possible clashing issue if user uses something like \"A B\" and \"A_B\" at the same time (with your modification both will be transformed to \"A__B\")", "author": "gitgabrio", "createdAt": "2020-05-25T06:39:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMjQ1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxMjMwNw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430412307", "bodyText": "@danielezonca\nI've created those two tickets\nhttps://issues.redhat.com/browse/DROOLS-5376\nhttps://issues.redhat.com/browse/DROOLS-5367\nthat should cover the potential issue you are referring to", "author": "gitgabrio", "createdAt": "2020-05-26T13:29:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMjQ1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMjgxNg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429202816", "bodyText": "Same consideration as above\n        return upperCasedInput.replace(\".\", \"___\").replace(\"_\", \"__\").replace(\" \", \"_\");", "author": "danielezonca", "createdAt": "2020-05-22T11:53:33Z", "path": "kie-pmml-new/kie-pmml-commons/src/main/java/org/kie/pmml/commons/utils/KiePMMLModelUtils.java", "diffHunk": "@@ -0,0 +1,42 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.commons.utils;\n+\n+public class KiePMMLModelUtils {\n+\n+    private KiePMMLModelUtils() {\n+    }\n+\n+    /**\n+     * Method to be used by <b>every</b> KiePMML implementation to retrieve the <b>package</b> name\n+     * out of the model name\n+     * @param modelName\n+     * @return\n+     */\n+    public static String getSanitizedPackageName(String modelName) {\n+        return modelName.replace(\" \", \"\").replace(\"_\", \"\").toLowerCase();\n+    }\n+\n+    /**\n+     * Convert the given <code>String</code> in a valid class name (i.e. no dots, no spaces, first letter upper case)\n+     * @param input\n+     * @return\n+     */\n+    public static String getSanitizedClassName(String input) {\n+        String upperCasedInput = input.substring(0, 1).toUpperCase() + input.substring(1);\n+        return upperCasedInput.replace(\".\", \"\").replace(\"_\", \"\").replace(\" \", \"\");", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc1NTg3MA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429755870", "bodyText": "@danielezonca\nAs above, I do not think it is necessary", "author": "gitgabrio", "createdAt": "2020-05-25T06:40:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMjgxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMzMyOA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429203328", "bodyText": "Can you please clarify? Is this a factory? Why does it extend KiePMMLModel?", "author": "danielezonca", "createdAt": "2020-05-22T11:54:56Z", "path": "kie-pmml-new/kie-pmml-commons/src/main/java/org/kie/pmml/commons/model/KiePMMLFactoryModel.java", "diffHunk": "@@ -0,0 +1,56 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.commons.model;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n+\n+/**\n+ * KIE representation of PMML model\n+ */\n+public class KiePMMLFactoryModel extends KiePMMLModel implements HasSourcesMap {", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc1MDMzMw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429750333", "bodyText": "@danielezonca\nKiePMMLFactory model is the model used to generate the \"Factories\" used at runtime to retrieve models from kjar.\nTo avoid proliferation of identical interfaces/subinterfaces, I declare only \"KiePMMLModel\". I'll add explanation to javadoc", "author": "gitgabrio", "createdAt": "2020-05-25T06:22:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwMzMyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwNDkwMg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429204902", "bodyText": "Is there any specific reason why you get the resource from the context classloader instead of JavaParserUtils.class.getResourceAsStream?", "author": "danielezonca", "createdAt": "2020-05-22T11:58:44Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-commons/src/main/java/org/kie/pmml/compiler/commons/utils/JavaParserUtils.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.compiler.commons.utils;\n+\n+import java.io.InputStream;\n+\n+import com.github.javaparser.StaticJavaParser;\n+import com.github.javaparser.ast.CompilationUnit;\n+import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;\n+import com.github.javaparser.ast.expr.StringLiteralExpr;\n+import org.kie.pmml.commons.exceptions.KiePMMLInternalException;\n+\n+public class JavaParserUtils {\n+\n+    private JavaParserUtils() {\n+    }\n+\n+    public static final String MAIN_CLASS_NOT_FOUND = \"Main class not found\";\n+\n+    public static CompilationUnit getFromFileName(String fileName) {\n+        try {\n+            final InputStream resource = Thread.currentThread().getContextClassLoader().getResourceAsStream(fileName);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc2MDk0Nw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429760947", "bodyText": "@danielezonca\nJavaParserUtils.class.getResourceAsStream throws an exception if invoked from maven plugin - originally I wrote as you suggest but then I find out that exception.", "author": "gitgabrio", "createdAt": "2020-05-25T06:54:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwNDkwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwNjc5NA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429206794", "bodyText": "To be removed or at least moved to a different path :)", "author": "danielezonca", "createdAt": "2020-05-22T12:03:27Z", "path": "kie-pmml/src/test/java/org/kie/pmml/pmml_4_2/DroolsAbstractPMMLTest.java", "diffHunk": "@@ -72,12 +73,47 @@\n     protected DataSource<PMMLRequestData> data;\n     protected DataSource<PMML4Result> resultData;\n     protected DataSource<PMML4Data> pmmlData;\n-\n-    private KieSession kSession;\n     protected KieBase kbase;\n+    private KieSession kSession;\n \n     public DroolsAbstractPMMLTest() {\n         super();\n+        Properties props = System.getProperties();\n+        props.setProperty(\"drools.dump.dir\", \"/home/gcardosi/NotBackedUp/old_pmml_dump_dir\");", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwOTYxNQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429209615", "bodyText": "To be removed?", "author": "danielezonca", "createdAt": "2020-05-22T12:10:25Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-regression/kie-pmml-models-regression-compiler/src/test/java/org/kie/pmml/models/regression/compiler/factories/KiePMMLRegressionModelFactoryTest.java", "diffHunk": "@@ -117,7 +117,8 @@ public KiePMMLRegressionModelFactoryTest(String modelName, double tableIntercept\n \n     @Test\n     public void getKiePMMLRegressionModelTest() throws IOException, IllegalAccessException, InstantiationException {\n-        KiePMMLRegressionModel retrieved = getKiePMMLRegressionModel(dataDictionary, regressionModel);\n+//        assertNotNull(getKiePMMLRegressionModelClasses(dataDictionary, regressionModel));", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxODg3NQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430418875", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T13:38:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwOTYxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMTIwNw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429211207", "bodyText": "I would prefer to replace ifPresent with map and then add orElseThrow with an error message so if the template will change an error is raised.", "author": "danielezonca", "createdAt": "2020-05-22T12:14:33Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-commons/src/main/java/org/kie/pmml/compiler/commons/utils/JavaParserUtils.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.compiler.commons.utils;\n+\n+import java.io.InputStream;\n+\n+import com.github.javaparser.StaticJavaParser;\n+import com.github.javaparser.ast.CompilationUnit;\n+import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;\n+import com.github.javaparser.ast.expr.StringLiteralExpr;\n+import org.kie.pmml.commons.exceptions.KiePMMLInternalException;\n+\n+public class JavaParserUtils {\n+\n+    private JavaParserUtils() {\n+    }\n+\n+    public static final String MAIN_CLASS_NOT_FOUND = \"Main class not found\";\n+\n+    public static CompilationUnit getFromFileName(String fileName) {\n+        try {\n+            final InputStream resource = Thread.currentThread().getContextClassLoader().getResourceAsStream(fileName);\n+            return StaticJavaParser.parse(resource);\n+        } catch (Exception e) {\n+            throw new KiePMMLInternalException(String.format(\"Failed to parse %s due to %s\", fileName, e.getMessage()), e);\n+        }\n+    }\n+\n+    public static void setModelName(String modelName, ClassOrInterfaceDeclaration modelTemplate) {\n+        modelTemplate.getFieldByName(\"MODEL_NAME\").ifPresent(fieldDeclaration -> fieldDeclaration.getVariable(0).setInitializer(new StringLiteralExpr(modelName)));", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc2NDIxMg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429764212", "bodyText": "@danielezonca\nReplaced with OrElseThrow (same semantic)\n(update)\nCompletely removed. Turns out it is not needed at all", "author": "gitgabrio", "createdAt": "2020-05-25T07:03:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMTIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMjQ0OA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429212448", "bodyText": "Please remove it or add an if condition logger.isTraceEnabled before", "author": "danielezonca", "createdAt": "2020-05-22T12:17:23Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-regression/kie-pmml-models-regression-compiler/src/main/java/org/kie/pmml/models/regression/compiler/executor/RegressionModelImplementationProvider.java", "diffHunk": "@@ -53,11 +55,22 @@ public PMML_MODEL getPMMLModelType() {\n \n     @Override\n     public KiePMMLRegressionModel getKiePMMLModel(DataDictionary dataDictionary, RegressionModel model, Object kBuilder) {\n-        logger.trace(\"getKiePMMLModel {} {}\", dataDictionary, model);\n+        logger.trace(\"getKiePMMLModel {} {} {}\", dataDictionary, model, kBuilder);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMjQ4Mw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429212483", "bodyText": "Please remove it or add an if condition logger.isTraceEnabled before", "author": "danielezonca", "createdAt": "2020-05-22T12:17:29Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-regression/kie-pmml-models-regression-compiler/src/main/java/org/kie/pmml/models/regression/compiler/executor/RegressionModelImplementationProvider.java", "diffHunk": "@@ -53,11 +55,22 @@ public PMML_MODEL getPMMLModelType() {\n \n     @Override\n     public KiePMMLRegressionModel getKiePMMLModel(DataDictionary dataDictionary, RegressionModel model, Object kBuilder) {\n-        logger.trace(\"getKiePMMLModel {} {}\", dataDictionary, model);\n+        logger.trace(\"getKiePMMLModel {} {} {}\", dataDictionary, model, kBuilder);\n         validate(dataDictionary, model);\n         try {\n-            return KiePMMLRegressionModelFactory.getKiePMMLRegressionModel(dataDictionary, model);\n+            return KiePMMLRegressionModelFactory.getKiePMMLRegressionModelClasses(dataDictionary, model);\n         } catch (IOException | IllegalAccessException | InstantiationException e) {\n+            throw new KiePMMLException(e.getMessage(), e);\n+        }\n+    }\n+\n+    @Override\n+    public KiePMMLRegressionModel getKiePMMLModelFromPlugin(String packageName, DataDictionary dataDictionary, RegressionModel model, Object kBuilder) {\n+        logger.trace(\"getKiePMMLModelFromPlugin {} {} {}\", dataDictionary, model, kBuilder);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMzY2Nw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429213667", "bodyText": "Can you please add a isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:20:19Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/main/java/org/kie/pmml/models/drools/tree/compiler/executor/TreeModelImplementationProvider.java", "diffHunk": "@@ -40,8 +44,20 @@ public PMML_MODEL getPMMLModelType() {\n     }\n \n     @Override\n-    public KiePMMLTreeModel getKiePMMLDroolsModel(DataDictionary dataDictionary, TreeModel model) {\n-        logger.trace(\"getKiePMMLDroolsModel {} {}\", dataDictionary, model);\n-        return KiePMMLTreeModelFactory.getKiePMMLTreeModel(dataDictionary, model);\n+    public KiePMMLTreeModel getKiePMMLDroolsModel(DataDictionary dataDictionary, TreeModel model, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsModel {} {} {}\", dataDictionary, model, fieldTypeMap);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMzcxNA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429213714", "bodyText": "Can you please add a isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:20:26Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/main/java/org/kie/pmml/models/drools/tree/compiler/executor/TreeModelImplementationProvider.java", "diffHunk": "@@ -40,8 +44,20 @@ public PMML_MODEL getPMMLModelType() {\n     }\n \n     @Override\n-    public KiePMMLTreeModel getKiePMMLDroolsModel(DataDictionary dataDictionary, TreeModel model) {\n-        logger.trace(\"getKiePMMLDroolsModel {} {}\", dataDictionary, model);\n-        return KiePMMLTreeModelFactory.getKiePMMLTreeModel(dataDictionary, model);\n+    public KiePMMLTreeModel getKiePMMLDroolsModel(DataDictionary dataDictionary, TreeModel model, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsModel {} {} {}\", dataDictionary, model, fieldTypeMap);\n+        return KiePMMLTreeModelFactory.getKiePMMLTreeModel(dataDictionary, model, fieldTypeMap);\n+    }\n+\n+    @Override\n+    public KiePMMLDroolsAST getKiePMMLDroolsAST(DataDictionary dataDictionary, TreeModel model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsAST {} {} {}\", dataDictionary, model, fieldTypeMap);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMzk1OA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429213958", "bodyText": "Can you please create a ticket for this so we will not forget?", "author": "danielezonca", "createdAt": "2020-05-22T12:20:58Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/main/java/org/kie/pmml/models/drools/tree/compiler/executor/TreeModelImplementationProvider.java", "diffHunk": "@@ -40,8 +44,20 @@ public PMML_MODEL getPMMLModelType() {\n     }\n \n     @Override\n-    public KiePMMLTreeModel getKiePMMLDroolsModel(DataDictionary dataDictionary, TreeModel model) {\n-        logger.trace(\"getKiePMMLDroolsModel {} {}\", dataDictionary, model);\n-        return KiePMMLTreeModelFactory.getKiePMMLTreeModel(dataDictionary, model);\n+    public KiePMMLTreeModel getKiePMMLDroolsModel(DataDictionary dataDictionary, TreeModel model, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsModel {} {} {}\", dataDictionary, model, fieldTypeMap);\n+        return KiePMMLTreeModelFactory.getKiePMMLTreeModel(dataDictionary, model, fieldTypeMap);\n+    }\n+\n+    @Override\n+    public KiePMMLDroolsAST getKiePMMLDroolsAST(DataDictionary dataDictionary, TreeModel model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsAST {} {} {}\", dataDictionary, model, fieldTypeMap);\n+        return KiePMMLTreeModelFactory.getKiePMMLDroolsAST(dataDictionary, model, fieldTypeMap);\n+    }\n+\n+    @Override\n+    public Map<String, String> getKiePMMLDroolsModelSourcesMap(DataDictionary dataDictionary, TreeModel model, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap, String packageName) {\n+        // TODO {gcardosi} to implement\n+        throw new RuntimeException(\"Not implemented, yet\");", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNDE5Mw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430424193", "bodyText": "@danielezonca\nhttps://issues.redhat.com/browse/DROOLS-5381", "author": "gitgabrio", "createdAt": "2020-05-26T13:46:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxMzk1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNDE4MQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429214181", "bodyText": "Are you sure about this change?", "author": "danielezonca", "createdAt": "2020-05-22T12:21:31Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-tests/src/test/java/org/kie/pmml/models/drools/scorecard/tests/CompoundNestedPredicateScorecardTest.java", "diffHunk": "@@ -66,15 +66,15 @@ public static void setupClass() {\n     public static Collection<Object[]> data() {\n         return Arrays.asList(new Object[][]{\n                 { -50, \"classB\", -8, \"characteristic2ReasonCode\", null },\n-                { -50, \"classD\", -8, \"characteristic2ReasonCode\", null },\n-                { -9, \"classB\", 75, \"characteristic1ReasonCode\", null },\n-                { 25.4, \"classB\", 75, \"characteristic1ReasonCode\", null },\n-                { -7, \"classA\", -8, \"characteristic2ReasonCode\", null },\n-                { -7, \"classC\", -15.5, \"characteristic1ReasonCode\", \"characteristic2ReasonCode\" },\n-                { 5, \"classB\", -15.5, \"characteristic1ReasonCode\", \"characteristic2ReasonCode\" },\n-                { 7.4, \"classB\", -15.5, \"characteristic1ReasonCode\", \"characteristic2ReasonCode\" },\n-                { 12, \"classB\", 75, \"characteristic1ReasonCode\", null },\n-                { 12, \"classD\", 75, \"characteristic1ReasonCode\", null },\n+//                { -50, \"classD\", -8, \"characteristic2ReasonCode\", null },\n+//                { -9, \"classB\", 75, \"characteristic1ReasonCode\", null },\n+//                { 25.4, \"classB\", 75, \"characteristic1ReasonCode\", null },\n+//                { -7, \"classA\", -8, \"characteristic2ReasonCode\", null },\n+//                { -7, \"classC\", -15.5, \"characteristic1ReasonCode\", \"characteristic2ReasonCode\" },\n+//                { 5, \"classB\", -15.5, \"characteristic1ReasonCode\", \"characteristic2ReasonCode\" },\n+//                { 7.4, \"classB\", -15.5, \"characteristic1ReasonCode\", \"characteristic2ReasonCode\" },\n+//                { 12, \"classB\", 75, \"characteristic1ReasonCode\", null },\n+//                { 12, \"classD\", 75, \"characteristic1ReasonCode\", null },", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNzczMA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430427730", "bodyText": "@danielezonca\nreverted", "author": "gitgabrio", "createdAt": "2020-05-26T13:51:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNDE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNTc2Nw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429215767", "bodyText": "Can you please add isDebugEnabled check where it is missing?", "author": "danielezonca", "createdAt": "2020-05-22T12:25:21Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/utils/KiePMMLAgendaListenerUtils.java", "diffHunk": "@@ -33,33 +33,51 @@\n \n     public static AgendaEventListener getAgendaEventListener(final Logger logger) {\n         return new AgendaEventListener() {\n-            public void matchCancelled(MatchCancelledEvent event) {/*Not used */}\n+            public void matchCancelled(MatchCancelledEvent event) { if (logger.isDebugEnabled()) {", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjIxNA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429216214", "bodyText": "Comment to be removed?", "author": "danielezonca", "createdAt": "2020-05-22T12:26:26Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/commons/factories/KiePMMLDescrFactory.java", "diffHunk": "@@ -34,7 +34,7 @@\n \n     public static final String PMML4_RESULT = \"PMML4Result\";\n     public static final String PMML4_RESULT_IDENTIFIER = \"$pmml4Result\";\n-    public static final String OUTPUTFIELDS_MAP = \"Map<String, Object>\";\n+    public static final String OUTPUTFIELDS_MAP = \"Map\";/*\"Map<String, Object>\";*/", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyODI1NA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430428254", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T13:51:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjIxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjQ0OQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429216449", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:27:04Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/utils/KnowledgeBaseUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.evaluator.core.utils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.kie.api.KieBase;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.api.container.PMMLPackage;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KnowledgeBaseUtils {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(KnowledgeBaseUtils.class);\n+\n+    private KnowledgeBaseUtils() {\n+        // Avoid instantiation\n+    }\n+\n+    public static List<KiePMMLModel> getModels(final KieBase knowledgeBase) {\n+        logger.trace(\"getModels {}\", knowledgeBase);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjQ5OQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429216499", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:27:11Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/utils/KnowledgeBaseUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.evaluator.core.utils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.kie.api.KieBase;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.api.container.PMMLPackage;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KnowledgeBaseUtils {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(KnowledgeBaseUtils.class);\n+\n+    private KnowledgeBaseUtils() {\n+        // Avoid instantiation\n+    }\n+\n+    public static List<KiePMMLModel> getModels(final KieBase knowledgeBase) {\n+        logger.trace(\"getModels {}\", knowledgeBase);\n+        List<KiePMMLModel> models = new ArrayList<>();\n+        knowledgeBase.getKiePackages().forEach(kpkg -> {\n+            PMMLPackage pmmlPackage = (PMMLPackage) ((InternalKnowledgePackage) kpkg).getResourceTypePackages().get(ResourceType.PMML);\n+            if (pmmlPackage != null) {\n+                models.addAll(pmmlPackage.getAllModels().values());\n+            }\n+        });\n+        return models;\n+    }\n+\n+    public static Optional<KiePMMLModel> getModel(final KieBase knowledgeBase, String modelName) {\n+        logger.trace(\"getModels {} {}\", knowledgeBase, modelName);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjk0NQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429216945", "bodyText": "This code is @jomarko approved \ud83d\ude04", "author": "danielezonca", "createdAt": "2020-05-22T12:28:17Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/utils/KnowledgeBaseUtils.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.evaluator.core.utils;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Optional;\n+\n+import org.drools.core.definitions.InternalKnowledgePackage;\n+import org.kie.api.KieBase;\n+import org.kie.api.io.ResourceType;\n+import org.kie.pmml.commons.model.KiePMMLModel;\n+import org.kie.pmml.evaluator.api.container.PMMLPackage;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+public class KnowledgeBaseUtils {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(KnowledgeBaseUtils.class);\n+\n+    private KnowledgeBaseUtils() {\n+        // Avoid instantiation\n+    }\n+\n+    public static List<KiePMMLModel> getModels(final KieBase knowledgeBase) {\n+        logger.trace(\"getModels {}\", knowledgeBase);\n+        List<KiePMMLModel> models = new ArrayList<>();\n+        knowledgeBase.getKiePackages().forEach(kpkg -> {\n+            PMMLPackage pmmlPackage = (PMMLPackage) ((InternalKnowledgePackage) kpkg).getResourceTypePackages().get(ResourceType.PMML);\n+            if (pmmlPackage != null) {\n+                models.addAll(pmmlPackage.getAllModels().values());\n+            }\n+        });\n+        return models;\n+    }\n+\n+    public static Optional<KiePMMLModel> getModel(final KieBase knowledgeBase, String modelName) {\n+        logger.trace(\"getModels {} {}\", knowledgeBase, modelName);\n+        return getModels(knowledgeBase)\n+                .stream()\n+                .filter(model -> Objects.equals(modelName, model.getName()))", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3ODcwMg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429778702", "bodyText": "Great!", "author": "gitgabrio", "createdAt": "2020-05-25T07:38:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNjk0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNzMwOQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429217309", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:29:12Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/service/PMMLRuntimeImpl.java", "diffHunk": "@@ -15,68 +15,61 @@\n  */\n package org.kie.pmml.evaluator.core.service;\n \n-import java.util.ArrayList;\n import java.util.List;\n import java.util.Map;\n-import java.util.Objects;\n import java.util.Optional;\n \n-import org.drools.core.definitions.InternalKnowledgePackage;\n-import org.kie.api.KieBase;\n-import org.kie.api.io.ResourceType;\n+import org.drools.core.impl.InternalKnowledgeBase;\n import org.kie.api.pmml.PMML4Result;\n import org.kie.api.pmml.PMMLRequestData;\n import org.kie.api.pmml.ParameterInfo;\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n import org.kie.pmml.commons.model.KiePMMLModel;\n import org.kie.pmml.commons.model.enums.PMML_MODEL;\n-import org.kie.pmml.evaluator.api.container.PMMLPackage;\n import org.kie.pmml.evaluator.api.executor.PMMLContext;\n import org.kie.pmml.evaluator.api.executor.PMMLRuntime;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutor;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutorFinderImpl;\n+import org.kie.pmml.evaluator.core.utils.KnowledgeBaseUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n public class PMMLRuntimeImpl implements PMMLRuntime {\n \n     private static final Logger logger = LoggerFactory.getLogger(PMMLRuntimeImpl.class);\n \n-    private final KieBase knowledgeBase;\n+    private final InternalKnowledgeBase knowledgeBase;\n     private final PMMLModelExecutorFinderImpl pmmlModelExecutorFinder;\n \n-    public PMMLRuntimeImpl(KieBase knowledgeBase, PMMLModelExecutorFinderImpl pmmlModelExecutorFinder) {\n+    public PMMLRuntimeImpl(InternalKnowledgeBase knowledgeBase, PMMLModelExecutorFinderImpl pmmlModelExecutorFinder) {\n         this.knowledgeBase = knowledgeBase;\n         this.pmmlModelExecutorFinder = pmmlModelExecutorFinder;\n     }\n \n     @Override\n     public List<KiePMMLModel> getModels() {\n         logger.trace(\"getModels\");\n-        List<KiePMMLModel> models = new ArrayList<>();\n-        knowledgeBase.getKiePackages().forEach(kpkg -> {\n-            PMMLPackage pmmlPackage = (PMMLPackage) ((InternalKnowledgePackage) kpkg).getResourceTypePackages().get(ResourceType.PMML);\n-            if (pmmlPackage != null) {\n-                models.addAll(pmmlPackage.getAllModels().values());\n-            }\n-        });\n-        return models;\n+        return KnowledgeBaseUtils.getModels(knowledgeBase);\n     }\n \n     @Override\n     public Optional<KiePMMLModel> getModel(String modelName) {\n-        logger.trace(\"getModels {}\", modelName);\n-        return getModels()\n-                .stream()\n-                .filter(model -> Objects.equals(modelName, model.getName()))\n-                .findFirst();\n+        logger.trace(\"getModel {}\", modelName);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxNzQwMw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429217403", "bodyText": "Can you please add isDebugEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:29:25Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/service/PMMLRuntimeImpl.java", "diffHunk": "@@ -15,68 +15,61 @@\n  */\n package org.kie.pmml.evaluator.core.service;\n \n-import java.util.ArrayList;\n import java.util.List;\n import java.util.Map;\n-import java.util.Objects;\n import java.util.Optional;\n \n-import org.drools.core.definitions.InternalKnowledgePackage;\n-import org.kie.api.KieBase;\n-import org.kie.api.io.ResourceType;\n+import org.drools.core.impl.InternalKnowledgeBase;\n import org.kie.api.pmml.PMML4Result;\n import org.kie.api.pmml.PMMLRequestData;\n import org.kie.api.pmml.ParameterInfo;\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n import org.kie.pmml.commons.model.KiePMMLModel;\n import org.kie.pmml.commons.model.enums.PMML_MODEL;\n-import org.kie.pmml.evaluator.api.container.PMMLPackage;\n import org.kie.pmml.evaluator.api.executor.PMMLContext;\n import org.kie.pmml.evaluator.api.executor.PMMLRuntime;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutor;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutorFinderImpl;\n+import org.kie.pmml.evaluator.core.utils.KnowledgeBaseUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n public class PMMLRuntimeImpl implements PMMLRuntime {\n \n     private static final Logger logger = LoggerFactory.getLogger(PMMLRuntimeImpl.class);\n \n-    private final KieBase knowledgeBase;\n+    private final InternalKnowledgeBase knowledgeBase;\n     private final PMMLModelExecutorFinderImpl pmmlModelExecutorFinder;\n \n-    public PMMLRuntimeImpl(KieBase knowledgeBase, PMMLModelExecutorFinderImpl pmmlModelExecutorFinder) {\n+    public PMMLRuntimeImpl(InternalKnowledgeBase knowledgeBase, PMMLModelExecutorFinderImpl pmmlModelExecutorFinder) {\n         this.knowledgeBase = knowledgeBase;\n         this.pmmlModelExecutorFinder = pmmlModelExecutorFinder;\n     }\n \n     @Override\n     public List<KiePMMLModel> getModels() {\n         logger.trace(\"getModels\");\n-        List<KiePMMLModel> models = new ArrayList<>();\n-        knowledgeBase.getKiePackages().forEach(kpkg -> {\n-            PMMLPackage pmmlPackage = (PMMLPackage) ((InternalKnowledgePackage) kpkg).getResourceTypePackages().get(ResourceType.PMML);\n-            if (pmmlPackage != null) {\n-                models.addAll(pmmlPackage.getAllModels().values());\n-            }\n-        });\n-        return models;\n+        return KnowledgeBaseUtils.getModels(knowledgeBase);\n     }\n \n     @Override\n     public Optional<KiePMMLModel> getModel(String modelName) {\n-        logger.trace(\"getModels {}\", modelName);\n-        return getModels()\n-                .stream()\n-                .filter(model -> Objects.equals(modelName, model.getName()))\n-                .findFirst();\n+        logger.trace(\"getModel {}\", modelName);\n+        return KnowledgeBaseUtils.getModel(knowledgeBase, modelName);\n     }\n \n     @Override\n-    public PMML4Result evaluate(KiePMMLModel model, PMMLContext context, String releaseId) {\n+    public PMML4Result evaluate(String modelName, PMMLContext context) {\n+        logger.debug(\"evaluate {} {}\", modelName, context);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxODM0OA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429218348", "bodyText": "Do you really need to use the internal interface instead of the public one? After a quick look it seems to me not needed", "author": "danielezonca", "createdAt": "2020-05-22T12:31:41Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/service/PMMLRuntimeImpl.java", "diffHunk": "@@ -15,68 +15,61 @@\n  */\n package org.kie.pmml.evaluator.core.service;\n \n-import java.util.ArrayList;\n import java.util.List;\n import java.util.Map;\n-import java.util.Objects;\n import java.util.Optional;\n \n-import org.drools.core.definitions.InternalKnowledgePackage;\n-import org.kie.api.KieBase;\n-import org.kie.api.io.ResourceType;\n+import org.drools.core.impl.InternalKnowledgeBase;\n import org.kie.api.pmml.PMML4Result;\n import org.kie.api.pmml.PMMLRequestData;\n import org.kie.api.pmml.ParameterInfo;\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n import org.kie.pmml.commons.model.KiePMMLModel;\n import org.kie.pmml.commons.model.enums.PMML_MODEL;\n-import org.kie.pmml.evaluator.api.container.PMMLPackage;\n import org.kie.pmml.evaluator.api.executor.PMMLContext;\n import org.kie.pmml.evaluator.api.executor.PMMLRuntime;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutor;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutorFinderImpl;\n+import org.kie.pmml.evaluator.core.utils.KnowledgeBaseUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n public class PMMLRuntimeImpl implements PMMLRuntime {\n \n     private static final Logger logger = LoggerFactory.getLogger(PMMLRuntimeImpl.class);\n \n-    private final KieBase knowledgeBase;\n+    private final InternalKnowledgeBase knowledgeBase;", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyOTEwNQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430429105", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T13:52:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxODM0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxODY4Nw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429218687", "bodyText": "I would prefer to raise an exception if the model executor is not available. Wdyt?", "author": "danielezonca", "createdAt": "2020-05-22T12:32:29Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/service/PMMLRuntimeImpl.java", "diffHunk": "@@ -15,68 +15,61 @@\n  */\n package org.kie.pmml.evaluator.core.service;\n \n-import java.util.ArrayList;\n import java.util.List;\n import java.util.Map;\n-import java.util.Objects;\n import java.util.Optional;\n \n-import org.drools.core.definitions.InternalKnowledgePackage;\n-import org.kie.api.KieBase;\n-import org.kie.api.io.ResourceType;\n+import org.drools.core.impl.InternalKnowledgeBase;\n import org.kie.api.pmml.PMML4Result;\n import org.kie.api.pmml.PMMLRequestData;\n import org.kie.api.pmml.ParameterInfo;\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n import org.kie.pmml.commons.model.KiePMMLModel;\n import org.kie.pmml.commons.model.enums.PMML_MODEL;\n-import org.kie.pmml.evaluator.api.container.PMMLPackage;\n import org.kie.pmml.evaluator.api.executor.PMMLContext;\n import org.kie.pmml.evaluator.api.executor.PMMLRuntime;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutor;\n import org.kie.pmml.evaluator.core.executor.PMMLModelExecutorFinderImpl;\n+import org.kie.pmml.evaluator.core.utils.KnowledgeBaseUtils;\n import org.slf4j.Logger;\n import org.slf4j.LoggerFactory;\n \n public class PMMLRuntimeImpl implements PMMLRuntime {\n \n     private static final Logger logger = LoggerFactory.getLogger(PMMLRuntimeImpl.class);\n \n-    private final KieBase knowledgeBase;\n+    private final InternalKnowledgeBase knowledgeBase;\n     private final PMMLModelExecutorFinderImpl pmmlModelExecutorFinder;\n \n-    public PMMLRuntimeImpl(KieBase knowledgeBase, PMMLModelExecutorFinderImpl pmmlModelExecutorFinder) {\n+    public PMMLRuntimeImpl(InternalKnowledgeBase knowledgeBase, PMMLModelExecutorFinderImpl pmmlModelExecutorFinder) {\n         this.knowledgeBase = knowledgeBase;\n         this.pmmlModelExecutorFinder = pmmlModelExecutorFinder;\n     }\n \n     @Override\n     public List<KiePMMLModel> getModels() {\n         logger.trace(\"getModels\");\n-        List<KiePMMLModel> models = new ArrayList<>();\n-        knowledgeBase.getKiePackages().forEach(kpkg -> {\n-            PMMLPackage pmmlPackage = (PMMLPackage) ((InternalKnowledgePackage) kpkg).getResourceTypePackages().get(ResourceType.PMML);\n-            if (pmmlPackage != null) {\n-                models.addAll(pmmlPackage.getAllModels().values());\n-            }\n-        });\n-        return models;\n+        return KnowledgeBaseUtils.getModels(knowledgeBase);\n     }\n \n     @Override\n     public Optional<KiePMMLModel> getModel(String modelName) {\n-        logger.trace(\"getModels {}\", modelName);\n-        return getModels()\n-                .stream()\n-                .filter(model -> Objects.equals(modelName, model.getName()))\n-                .findFirst();\n+        logger.trace(\"getModel {}\", modelName);\n+        return KnowledgeBaseUtils.getModel(knowledgeBase, modelName);\n     }\n \n     @Override\n-    public PMML4Result evaluate(KiePMMLModel model, PMMLContext context, String releaseId) {\n+    public PMML4Result evaluate(String modelName, PMMLContext context) {\n+        logger.debug(\"evaluate {} {}\", modelName, context);\n+        KiePMMLModel toEvaluate = getModel(modelName).orElseThrow(() -> new KiePMMLException(\"Failed to retrieve model with name \" + modelName));\n+        return evaluate(toEvaluate, context);\n+    }\n+\n+    protected PMML4Result evaluate(KiePMMLModel model, PMMLContext context) {\n         logger.debug(\"evaluate {} {}\", model, context);\n         addMissingValuesReplacements(model, context);\n         Optional<PMMLModelExecutor> pmmlModelExecutor = getFromPMMLModelType(model.getPmmlMODEL());\n-        return pmmlModelExecutor.isPresent() ? pmmlModelExecutor.get().evaluate(model, context, releaseId) : new PMML4Result();\n+        return pmmlModelExecutor.isPresent() ? pmmlModelExecutor.get().evaluate(knowledgeBase, model, context) : new PMML4Result();", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMTY3MA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430431670", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T13:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxODY4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxOTA0OA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429219048", "bodyText": "Can you mark all the parameters as final (or remove final to knowledgeBase one :) )?", "author": "danielezonca", "createdAt": "2020-05-22T12:33:15Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-core/src/main/java/org/kie/pmml/evaluator/core/executor/PMMLModelExecutor.java", "diffHunk": "@@ -31,11 +32,12 @@\n \n     /**\n      * Evaluate the model, given the context\n+     * @param knowledgeBase The <code>KieBase</code> we are currently working on.\n+     * It may be <code>null</code> for testing purpose for <b>not drools-related</b> models\n      * @param model the model to evaluate\n      * @param context the context with all the input variables\n-     * @param releaseId Used to indirectly retrieve same instance of kiecontainer\n      * @return the result of the evaluation\n      * @throws KiePMMLInternalException\n      */\n-    PMML4Result evaluate(KiePMMLModel model, PMMLContext context, String releaseId);\n+    PMML4Result evaluate(final KieBase knowledgeBase, KiePMMLModel model, PMMLContext context);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMjIwOA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430432208", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T13:57:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxOTA0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxOTQ4MA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429219480", "bodyText": "I would like to preserve cases. It reduces the possibility of name clashes.\nIn any case I think you should use the package sanitizer utils here too to be sure to have it coherent with the rest of the code", "author": "danielezonca", "createdAt": "2020-05-22T12:34:17Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/service/PMMLAssemblerService.java", "diffHunk": "@@ -96,16 +127,57 @@ protected void addModels(KnowledgeBuilderImpl kbuilderImpl, List<KiePMMLModel> t\n      * @throws ExternalException if any other kind of <code>Exception</code> has been thrown during execution\n      */\n     protected List<KiePMMLModel> getKiePMMLModelsFromResource(KnowledgeBuilderImpl kbuilderImpl, Resource resource) {\n+        String[] classNamePackageName = getFactoryClassNamePackageName(resource);\n+        String factoryClassName = classNamePackageName[0];\n+        String packageName = classNamePackageName[1];\n+        try {\n+            final Class<? extends KiePMMLModelFactory> aClass = (Class<? extends KiePMMLModelFactory>) Class.forName(packageName + \".\" + factoryClassName);\n+            return aClass.newInstance().getKiePMMLModels();\n+        } catch (ClassNotFoundException e) {\n+            logger.info(String.format(\"%s not found in kjar, going to compile model\", factoryClassName));\n+        } catch (Exception e) {\n+            throw new KiePMMLException(\"Exception while instantiating \" + factoryClassName, e);\n+        }\n         PMMLCompiler pmmlCompiler = kbuilderImpl.getCachedOrCreate(PMML_COMPILER_CACHE_KEY, () -> getCompiler(kbuilderImpl));\n-        // TODO {gcardosi} replace with dynamically generated one\n-        logger.debug(\"getKiePMMLModelsFromResource releaseId {}\", RELEASE_ID);\n         try {\n-            return pmmlCompiler.getModels(resource.getInputStream(), RELEASE_ID);\n+            return pmmlCompiler.getModels(resource.getInputStream(), kbuilderImpl);\n         } catch (IOException e) {\n             throw new ExternalException(\"ExternalException\", e);\n         }\n     }\n \n+    /**\n+     * @param kbuilderImpl\n+     * @param resource\n+     * @return\n+     */\n+    protected List<KiePMMLModel> getKiePMMLModelsFromResourceFromPlugin(KnowledgeBuilderImpl kbuilderImpl, Resource resource) {\n+        PMMLCompiler pmmlCompiler = kbuilderImpl.getCachedOrCreate(PMML_COMPILER_CACHE_KEY, () -> getCompiler(kbuilderImpl));\n+        String[] classNamePackageName = getFactoryClassNamePackageName(resource);\n+        String factoryClassName = classNamePackageName[0];\n+        String packageName = classNamePackageName[1];\n+        try {\n+            return pmmlCompiler.getModelsFromPlugin(factoryClassName, packageName, resource.getInputStream(), kbuilderImpl);\n+        } catch (IOException e) {\n+            throw new ExternalException(\"ExternalException\", e);\n+        }\n+    }\n+\n+    /**\n+     * Returns an array where the first item is the <b>factory class</b> name and the second item is the <b>package</b> name,\n+     * built starting from the given <code>Resource</code>\n+     * @param resource\n+     * @return\n+     */\n+    private String[] getFactoryClassNamePackageName(Resource resource) {\n+        String sourcePath = resource.getSourcePath();\n+        String fileName = sourcePath.substring(sourcePath.lastIndexOf('/') + 1);\n+        fileName = fileName.replace(\".pmml\", \"\");\n+        String packageName = fileName.toLowerCase();", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMzQ1Mg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430433452", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T13:58:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxOTQ4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyMjAyNw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429222027", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:40:02Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-core/src/main/java/org/kie/pmml/compiler/executor/PMMLCompilerImpl.java", "diffHunk": "@@ -41,7 +49,7 @@\n \n     @Override\n     public List<KiePMMLModel> getModels(InputStream inputStream, Object kbuilder) {\n-        logger.trace(\"getModels {}\", inputStream);\n+        logger.trace(\"getModels {} {}\", inputStream, kbuilder);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc2NDczMg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429764732", "bodyText": "@danielezonca\nSee previous answer: check on the current log level is already implemented by logging framework itself - not needed here", "author": "gitgabrio", "createdAt": "2020-05-25T07:05:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyMjAyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyMjA2Mg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429222062", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:40:07Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-core/src/main/java/org/kie/pmml/compiler/executor/PMMLCompilerImpl.java", "diffHunk": "@@ -54,6 +62,42 @@\n         }\n     }\n \n+    @Override\n+    public List<KiePMMLModel> getModelsFromPlugin(String factoryClassName, String packageName, InputStream inputStream, Object kbuilder) {\n+        logger.trace(\"getModels {} {}\", inputStream, kbuilder);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNTY5NQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429225695", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T12:47:46Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-commons/src/main/java/org/kie/pmml/compiler/commons/factories/KiePMMLFactoryFactory.java", "diffHunk": "@@ -0,0 +1,77 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.compiler.commons.factories;\n+\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+\n+import com.github.javaparser.ast.CompilationUnit;\n+import com.github.javaparser.ast.NodeList;\n+import com.github.javaparser.ast.body.ClassOrInterfaceDeclaration;\n+import com.github.javaparser.ast.body.FieldDeclaration;\n+import com.github.javaparser.ast.body.VariableDeclarator;\n+import com.github.javaparser.ast.expr.Expression;\n+import com.github.javaparser.ast.expr.MethodCallExpr;\n+import com.github.javaparser.ast.expr.NameExpr;\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.kie.pmml.compiler.commons.utils.JavaParserUtils.MAIN_CLASS_NOT_FOUND;\n+import static org.kie.pmml.compiler.commons.utils.JavaParserUtils.getFromFileName;\n+\n+/**\n+ * This class is meant to create source code for PMML file-specific <b>Factory</b>\n+ */\n+public class KiePMMLFactoryFactory {\n+\n+    private static final String KIE_PMML_MODEL_FACTORY_TEMPLATE_JAVA = \"KiePMMLModelFactoryTemplate.tmpl\";\n+    private static final String KIE_PMML_MODEL_FACTORY_TEMPLATE = \"KiePMMLModelFactoryTemplate\";\n+    private static final String KIE_PMML_MODELS_FIELD = \"KIE_PMML_MODELS\";\n+\n+    private static final Logger logger = LoggerFactory.getLogger(KiePMMLFactoryFactory.class.getName());\n+\n+    private KiePMMLFactoryFactory() {\n+        // Avoid instantiation\n+    }\n+\n+    public static Map<String, String> getFactorySourceCode(String factoryClassName, String packageName, Set<String> generatedClasses) {\n+        logger.trace(\"getFactorySourceCode {} {} {}\", factoryClassName, packageName, generatedClasses);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc2MDA4Mw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429760083", "bodyText": "@danielezonca\nThat check is already implemented (behind the scene) in the call itself (otherwise it would have no sense to invoke a \"trace\" method vs debug vs info).\nSuch check is eventually needed if using \"String.format\" - that execute formatting regardless of the log level - or anyway whenever an operation is invoked before actually evaluation of log level\nprivate void formatAndLog(int level, String format, Object arg1, Object arg2) {\n        if (!isLevelEnabled(level)) {\n            return;\n        }\n        FormattingTuple tp = MessageFormatter.format(format, arg1, arg2);\n        log(level, tp.getMessage(), tp.getThrowable());\n    }", "author": "gitgabrio", "createdAt": "2020-05-25T06:52:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNTY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNjg3Mg==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429226872", "bodyText": "I think we should improve this interface: I would like to have at least a marker interface as return value and unify knowledgeBase behavior. Wdyt?\nIf you agree, can you please create a ticket to track it?", "author": "danielezonca", "createdAt": "2020-05-22T12:50:14Z", "path": "kie-pmml-new/kie-pmml-commons/src/main/java/org/kie/pmml/commons/model/KiePMMLModel.java", "diffHunk": "@@ -60,7 +60,24 @@ public String getTargetField() {\n         return Collections.unmodifiableMap(missingValueReplacementMap);\n     }\n \n-    public abstract Object evaluate(Map<String, Object> requestData);\n+    /**\n+     * Method to retrieve the <b>package</b> name to be used inside kiebase/package attribute of\n+     * kmodule.xml and to use for package creation inside PMMLAssemblerService\n+     * By default returns the package name of the current instance\n+     * To be eventually overridden.\n+     * @return\n+     */\n+    public String getKModulePackageName() {\n+        return this.getClass().getPackage().getName();\n+    }\n+\n+    /**\n+     * @param knowledgeBase the knowledgeBase we are working on. Add as <code>Object</code> to avoid direct dependency. It is needed only by <b>Drools-dependent</b>\n+     * models, so it may be <b>ignored</b> by others\n+     * @param requestData\n+     * @return\n+     */\n+    public abstract Object evaluate(final Object knowledgeBase, Map<String, Object> requestData);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc1NDE5NA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429754194", "bodyText": "@danielezonca\nI've already planned other refactoring. After them, I'll see if it is still needed/feasible.", "author": "gitgabrio", "createdAt": "2020-05-25T06:35:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNjg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxODczMw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430418733", "bodyText": "Ok can you please create a ticket to track it? Something like \"Investigate how to improve....\"", "author": "danielezonca", "createdAt": "2020-05-26T13:38:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNjg3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNjMzNw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430436337", "bodyText": "@danielezonca\nhttps://issues.redhat.com/browse/DROOLS-5382", "author": "gitgabrio", "createdAt": "2020-05-26T14:02:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIyNjg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzMjQ4MQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429232481", "bodyText": "If I have understood correctly here we expect to have some models with source map and some not.\nWhy? Can you please clarify?", "author": "danielezonca", "createdAt": "2020-05-22T13:02:06Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-core/src/main/java/org/kie/pmml/compiler/executor/PMMLCompilerImpl.java", "diffHunk": "@@ -54,6 +62,42 @@\n         }\n     }\n \n+    @Override\n+    public List<KiePMMLModel> getModelsFromPlugin(String factoryClassName, String packageName, InputStream inputStream, Object kbuilder) {\n+        logger.trace(\"getModels {} {}\", inputStream, kbuilder);\n+        try {\n+            PMML commonPMMLModel = KiePMMLUtil.load(inputStream);\n+            Set<String> expectedClasses = commonPMMLModel.getModels()\n+                    .stream()\n+                    .map(model -> packageName + \".\" + getSanitizedClassName(model.getModelName()))\n+                    .collect(Collectors.toSet());\n+            List<KiePMMLModel> toReturn = getModelsFromPlugin(packageName, commonPMMLModel, kbuilder);\n+            Set<String> generatedClasses = new HashSet<>();\n+            toReturn.forEach(kiePMMLModel -> {\n+                if (kiePMMLModel instanceof HasSourcesMap) {\n+                    generatedClasses.addAll(((HasSourcesMap) kiePMMLModel).getSourcesMap().keySet());\n+                } else {\n+                    generatedClasses.add(kiePMMLModel.getClass().getName());\n+                }", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc3Nzg5MA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429777890", "bodyText": "@danielezonca\nReplaced with Exception.", "author": "gitgabrio", "createdAt": "2020-05-25T07:36:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzMjQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzMzYzMQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429233631", "bodyText": "This will probably not work with native compilation. Can you please create a ticket to track it so we will verify?", "author": "danielezonca", "createdAt": "2020-05-22T13:04:33Z", "path": "kie-pmml-new/kie-pmml-evaluator/kie-pmml-evaluator-assembler/src/main/java/org/kie/pmml/evaluator/assembler/service/PMMLAssemblerService.java", "diffHunk": "@@ -96,16 +127,57 @@ protected void addModels(KnowledgeBuilderImpl kbuilderImpl, List<KiePMMLModel> t\n      * @throws ExternalException if any other kind of <code>Exception</code> has been thrown during execution\n      */\n     protected List<KiePMMLModel> getKiePMMLModelsFromResource(KnowledgeBuilderImpl kbuilderImpl, Resource resource) {\n+        String[] classNamePackageName = getFactoryClassNamePackageName(resource);\n+        String factoryClassName = classNamePackageName[0];\n+        String packageName = classNamePackageName[1];\n+        try {\n+            final Class<? extends KiePMMLModelFactory> aClass = (Class<? extends KiePMMLModelFactory>) Class.forName(packageName + \".\" + factoryClassName);\n+            return aClass.newInstance().getKiePMMLModels();", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNjk3NA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430436974", "bodyText": "@danielezonca\nThis will be managed inside\nhttps://issues.redhat.com/browse/DROOLS-5373", "author": "gitgabrio", "createdAt": "2020-05-26T14:03:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzMzYzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNDI2OQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429234269", "bodyText": "typo drool -> Drools", "author": "danielezonca", "createdAt": "2020-05-22T13:06:00Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/commons/model/KiePMMLDroolsModelWithSources.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.models.drools.commons.model;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+\n+import org.kie.pmml.commons.exceptions.KiePMMLException;\n+import org.kie.pmml.commons.model.HasSourcesMap;\n+\n+import static org.kie.pmml.commons.utils.KiePMMLModelUtils.getSanitizedPackageName;\n+\n+/**\n+ * KIE representation of PMML model that use <b>drool</b> for implementation", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNzM3OA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430437378", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T14:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNDI2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNTg0Ng==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429235846", "bodyText": "I think we should remove this listener and maybe add it only if log level is debug or similar. Wdyt? Otherwise we will generate tons of log messages", "author": "danielezonca", "createdAt": "2020-05-22T13:09:28Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/utils/KiePMMLSessionUtils.java", "diffHunk": "@@ -36,29 +50,65 @@\n  */\n public class KiePMMLSessionUtils {\n \n-    private final PackageDescr packageDescr;\n-    private final KieSession kieSession;\n-\n-    private KiePMMLSessionUtils(final PackageDescr packageDescr, final PMML4Result pmml4Result) {\n-        this.packageDescr = packageDescr;\n-        kieSession = new KieHelper()\n-                .addContent(packageDescr)\n-                .build(ExecutableModelProject.class)\n-                .newKieSession();\n-        kieSession.insert(new KiePMMLStatusHolder());\n-        kieSession.insert(pmml4Result);\n-        kieSession.setGlobal(PMML4_RESULT_IDENTIFIER, pmml4Result);\n+    private static final Logger logger = LoggerFactory.getLogger(KiePMMLSessionUtils.class.getName());\n+\n+    private static final CommandFactoryServiceImpl COMMAND_FACTORY_SERVICE = new CommandFactoryServiceImpl();\n+    private final StatelessKieSession kieSession;\n+    private final String modelName;\n+    private final String packageName;\n+    private final List<Command> commands;\n+\n+    private KiePMMLSessionUtils(final InternalKnowledgeBase knowledgeBase, final String modelName, final PMML4Result pmml4Result) {\n+        this.modelName = modelName;\n+        packageName = getSanitizedPackageName(modelName);\n+        kieSession = getKieSession(knowledgeBase);\n+        kieSession.addEventListener(new RuleRuntimeEventListener() {\n+            private final Logger logger = LoggerFactory.getLogger(RuleRuntimeEventListener.class);\n+\n+            @Override\n+            public void objectInserted(ObjectInsertedEvent event) {\n+                logger.info(event.toString());\n+            }\n+\n+            @Override\n+            public void objectUpdated(ObjectUpdatedEvent event) {\n+                logger.info(event.toString());\n+            }\n+\n+            @Override\n+            public void objectDeleted(ObjectDeletedEvent event) {\n+                logger.info(event.toString());\n+            }", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzNzk4MQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430437981", "bodyText": "@danielezonca\nremoved", "author": "gitgabrio", "createdAt": "2020-05-26T14:04:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNTg0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNjc5NQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429236795", "bodyText": "Can you verify if it is possible to use KieBase instead of InternalKnowledgeBase?", "author": "danielezonca", "createdAt": "2020-05-22T13:11:24Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/utils/KiePMMLSessionUtils.java", "diffHunk": "@@ -90,16 +140,16 @@ private void addObjectsToSession(final Map<String, Object> unwrappedInputParams,\n      * @param globalName its global name\n      */\n     private void insertObjectInSession(final Object toInsert, final String globalName) {\n-        kieSession.insert(toInsert);\n-        kieSession.setGlobal(globalName, toInsert);\n+        commands.add(COMMAND_FACTORY_SERVICE.newInsert(toInsert));\n+        commands.add(COMMAND_FACTORY_SERVICE.newSetGlobal(globalName, toInsert));\n     }\n \n     public static class Builder {\n \n         private KiePMMLSessionUtils toBuild;\n \n-        private Builder(final PackageDescr packageDescr, final PMML4Result pmml4Result) {\n-            this.toBuild = new KiePMMLSessionUtils(packageDescr, pmml4Result);\n+        private Builder(final InternalKnowledgeBase knowledgeBase, final String modelName, final PMML4Result pmml4Result) {", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzODU2NA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430438564", "bodyText": "@danielezonca\ndone", "author": "gitgabrio", "createdAt": "2020-05-26T14:05:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzNjc5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzODAwMQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429238001", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T13:13:48Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/main/java/org/kie/pmml/models/drools/tree/compiler/factories/KiePMMLTreeModelFactory.java", "diffHunk": "@@ -44,17 +43,28 @@\n     private KiePMMLTreeModelFactory() {\n     }\n \n-    public static KiePMMLTreeModel getKiePMMLTreeModel(DataDictionary dataDictionary, TreeModel model) {\n+    public static KiePMMLTreeModel getKiePMMLTreeModel(DataDictionary dataDictionary, TreeModel model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n         logger.trace(\"getKiePMMLTreeModel {}\", model);\n         String name = model.getModelName();\n         Optional<String> targetFieldName = getTargetFieldName(dataDictionary, model);\n-        final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n-        final KiePMMLDroolsAST kiePMMLDroolsAST = getKiePMMLDroolsAST(dataDictionary, model, fieldTypeMap);\n-        final PackageDescr baseDescr = getBaseDescr(kiePMMLDroolsAST, name.toLowerCase());\n+        final List<KiePMMLOutputField> outputFields = getOutputFields(model);\n         return KiePMMLTreeModel.builder(name, Collections.emptyList(), MINING_FUNCTION.byName(model.getMiningFunction().value()), model.getAlgorithmName())\n-                .withPackageDescr(baseDescr)\n+                .withOutputFields(outputFields)\n                 .withFieldTypeMap(fieldTypeMap)\n                 .withTargetField(targetFieldName.orElse(null))\n                 .build();\n     }\n+\n+    /**\n+     * This method returns a <code>KiePMMLDroolsAST</code> out of the given <code>DataDictionary</code> and <code>TreeModel</code>.\n+     * <b>It also populate the given <code>Map</code> that has to be used for final <code>KiePMMLTreeModel</code></b>\n+     * @param dataDictionary\n+     * @param model\n+     * @param fieldTypeMap\n+     * @return\n+     */\n+    public static KiePMMLDroolsAST getKiePMMLDroolsAST(DataDictionary dataDictionary, TreeModel model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsAST {}\", model);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzODA2Ng==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429238066", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T13:13:56Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-tree/kie-pmml-models-drools-tree-compiler/src/main/java/org/kie/pmml/models/drools/tree/compiler/factories/KiePMMLTreeModelFactory.java", "diffHunk": "@@ -44,17 +43,28 @@\n     private KiePMMLTreeModelFactory() {\n     }\n \n-    public static KiePMMLTreeModel getKiePMMLTreeModel(DataDictionary dataDictionary, TreeModel model) {\n+    public static KiePMMLTreeModel getKiePMMLTreeModel(DataDictionary dataDictionary, TreeModel model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n         logger.trace(\"getKiePMMLTreeModel {}\", model);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzODQzMw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429238433", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T13:14:40Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-compiler/src/main/java/org/kie/pmml/models/drools/scorecard/compiler/factories/KiePMMLScorecardModelFactory.java", "diffHunk": "@@ -44,24 +63,116 @@\n \n     private static final Logger logger = LoggerFactory.getLogger(KiePMMLScorecardModelFactory.class.getName());\n \n+    private static final String KIE_PMML_SCORECARD_MODEL_TEMPLATE_JAVA = \"KiePMMLScorecardModelTemplate.tmpl\";\n+    private static final String KIE_PMML_SCORECARD_MODEL_TEMPLATE = \"KiePMMLScorecardModelTemplate\";\n+\n     private KiePMMLScorecardModelFactory() {\n         // Avoid instantiation\n     }\n \n-    public static KiePMMLScorecardModel getKiePMMLScorecardModel(DataDictionary dataDictionary, Scorecard model) {\n+    public static KiePMMLScorecardModel getKiePMMLScorecardModel(DataDictionary dataDictionary, Scorecard model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) throws IOException, IllegalAccessException, InstantiationException {\n         logger.trace(\"getKiePMMLScorecardModel {}\", model);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzODQ4NQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429238485", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T13:14:46Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-compiler/src/main/java/org/kie/pmml/models/drools/scorecard/compiler/factories/KiePMMLScorecardModelFactory.java", "diffHunk": "@@ -44,24 +63,116 @@\n \n     private static final Logger logger = LoggerFactory.getLogger(KiePMMLScorecardModelFactory.class.getName());\n \n+    private static final String KIE_PMML_SCORECARD_MODEL_TEMPLATE_JAVA = \"KiePMMLScorecardModelTemplate.tmpl\";\n+    private static final String KIE_PMML_SCORECARD_MODEL_TEMPLATE = \"KiePMMLScorecardModelTemplate\";\n+\n     private KiePMMLScorecardModelFactory() {\n         // Avoid instantiation\n     }\n \n-    public static KiePMMLScorecardModel getKiePMMLScorecardModel(DataDictionary dataDictionary, Scorecard model) {\n+    public static KiePMMLScorecardModel getKiePMMLScorecardModel(DataDictionary dataDictionary, Scorecard model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) throws IOException, IllegalAccessException, InstantiationException {\n         logger.trace(\"getKiePMMLScorecardModel {}\", model);\n-        String name = model.getModelName();\n-        Optional<String> targetFieldName = getTargetFieldName(dataDictionary, model);\n-        final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n-        final KiePMMLDroolsAST kiePMMLDroolsAST = getKiePMMLDroolsAST(dataDictionary, model, fieldTypeMap);\n-        String packageName = name.replace(\" \", \"_\").toLowerCase();\n-        final PackageDescr baseDescr = getBaseDescr(kiePMMLDroolsAST, packageName);\n-        final List<KiePMMLOutputField> outputFields = getOutputFields(model);\n-        return KiePMMLScorecardModel.builder(name, Collections.emptyList(), MINING_FUNCTION.byName(model.getMiningFunction().value()))\n-                .withOutputFields(outputFields)\n-                .withPackageDescr(baseDescr)\n-                .withFieldTypeMap(fieldTypeMap)\n-                .withTargetField(targetFieldName.orElse(null))\n-                .build();\n+        String className = getSanitizedClassName(model.getModelName());\n+        String packageName = getSanitizedPackageName(className);\n+        Map<String, String> sourcesMap = getKiePMMLScorecardModelSourcesMap(dataDictionary, model, fieldTypeMap, packageName);\n+        String fullClassName = packageName + \".\" + className;\n+        final Map<String, Class<?>> compiledClasses = KieMemoryCompiler.compile(sourcesMap, Thread.currentThread().getContextClassLoader());\n+        return (KiePMMLScorecardModel) compiledClasses.get(fullClassName).newInstance();\n+    }\n+\n+    public static Map<String, String> getKiePMMLScorecardModelSourcesMap(final DataDictionary dataDictionary, final Scorecard model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap, final String packageName) throws IOException {\n+        logger.trace(\"getKiePMMLScorecardModelSourcesMap {} {} {}\", dataDictionary, model, packageName);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzODU2Nw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429238567", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T13:14:57Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-compiler/src/main/java/org/kie/pmml/models/drools/scorecard/compiler/factories/KiePMMLScorecardModelFactory.java", "diffHunk": "@@ -44,24 +63,116 @@\n \n     private static final Logger logger = LoggerFactory.getLogger(KiePMMLScorecardModelFactory.class.getName());\n \n+    private static final String KIE_PMML_SCORECARD_MODEL_TEMPLATE_JAVA = \"KiePMMLScorecardModelTemplate.tmpl\";\n+    private static final String KIE_PMML_SCORECARD_MODEL_TEMPLATE = \"KiePMMLScorecardModelTemplate\";\n+\n     private KiePMMLScorecardModelFactory() {\n         // Avoid instantiation\n     }\n \n-    public static KiePMMLScorecardModel getKiePMMLScorecardModel(DataDictionary dataDictionary, Scorecard model) {\n+    public static KiePMMLScorecardModel getKiePMMLScorecardModel(DataDictionary dataDictionary, Scorecard model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) throws IOException, IllegalAccessException, InstantiationException {\n         logger.trace(\"getKiePMMLScorecardModel {}\", model);\n-        String name = model.getModelName();\n-        Optional<String> targetFieldName = getTargetFieldName(dataDictionary, model);\n-        final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n-        final KiePMMLDroolsAST kiePMMLDroolsAST = getKiePMMLDroolsAST(dataDictionary, model, fieldTypeMap);\n-        String packageName = name.replace(\" \", \"_\").toLowerCase();\n-        final PackageDescr baseDescr = getBaseDescr(kiePMMLDroolsAST, packageName);\n-        final List<KiePMMLOutputField> outputFields = getOutputFields(model);\n-        return KiePMMLScorecardModel.builder(name, Collections.emptyList(), MINING_FUNCTION.byName(model.getMiningFunction().value()))\n-                .withOutputFields(outputFields)\n-                .withPackageDescr(baseDescr)\n-                .withFieldTypeMap(fieldTypeMap)\n-                .withTargetField(targetFieldName.orElse(null))\n-                .build();\n+        String className = getSanitizedClassName(model.getModelName());\n+        String packageName = getSanitizedPackageName(className);\n+        Map<String, String> sourcesMap = getKiePMMLScorecardModelSourcesMap(dataDictionary, model, fieldTypeMap, packageName);\n+        String fullClassName = packageName + \".\" + className;\n+        final Map<String, Class<?>> compiledClasses = KieMemoryCompiler.compile(sourcesMap, Thread.currentThread().getContextClassLoader());\n+        return (KiePMMLScorecardModel) compiledClasses.get(fullClassName).newInstance();\n+    }\n+\n+    public static Map<String, String> getKiePMMLScorecardModelSourcesMap(final DataDictionary dataDictionary, final Scorecard model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap, final String packageName) throws IOException {\n+        logger.trace(\"getKiePMMLScorecardModelSourcesMap {} {} {}\", dataDictionary, model, packageName);\n+        String className = getSanitizedClassName(model.getModelName());\n+        String targetField = getTargetFieldName(dataDictionary, model).orElse(null);\n+        List<KiePMMLOutputField> outputFields = getOutputFields(model);\n+        CompilationUnit templateCU = getFromFileName(KIE_PMML_SCORECARD_MODEL_TEMPLATE_JAVA);\n+        CompilationUnit cloneCU = templateCU.clone();\n+        cloneCU.setPackageDeclaration(packageName);\n+        ClassOrInterfaceDeclaration modelTemplate = cloneCU.getClassByName(KIE_PMML_SCORECARD_MODEL_TEMPLATE)\n+                .orElseThrow(() -> new RuntimeException(MAIN_CLASS_NOT_FOUND));\n+        modelTemplate.setName(className);\n+        setModelName(className, modelTemplate);\n+        MINING_FUNCTION miningFunction = MINING_FUNCTION.byName(model.getMiningFunction().value());\n+        final ConstructorDeclaration constructorDeclaration = modelTemplate.getDefaultConstructor().orElseThrow(() -> new KiePMMLInternalException(String.format(\"Missing default constructor in ClassOrInterfaceDeclaration %s \", modelTemplate.getName())));\n+        setConstructor(model, constructorDeclaration, modelTemplate.getName(), targetField, miningFunction);\n+        addOutputFieldsPopulation(constructorDeclaration.getBody(), outputFields);\n+        addFieldTypeMapPopulation(constructorDeclaration.getBody(), fieldTypeMap);\n+        Map<String, String> toReturn = new HashMap<>();\n+        String fullClassName = packageName + \".\" + className;\n+        toReturn.put(fullClassName, cloneCU.toString());\n+        return toReturn;\n+    }\n+\n+    /**\n+     * This method returns a <code>KiePMMLDroolsAST</code> out of the given <code>DataDictionary</code> and <code>Scorecard</code>.\n+     * <b>It also populate the given <code>Map</code> that has to be used for final <code>KiePMMLScorecardModel</code></b>\n+     * @param dataDictionary\n+     * @param model\n+     * @param fieldTypeMap\n+     * @return\n+     */\n+    public static KiePMMLDroolsAST getKiePMMLDroolsAST(DataDictionary dataDictionary, Scorecard model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap) {\n+        logger.trace(\"getKiePMMLDroolsAST {}\", model);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzODgwOQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429238809", "bodyText": "Can you please add isTraceEnabled check?", "author": "danielezonca", "createdAt": "2020-05-22T13:15:27Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/commons/model/KiePMMLDroolsModel.java", "diffHunk": "@@ -46,31 +52,29 @@\n \n     private static final AgendaEventListener agendaEventListener = getAgendaEventListener(logger);\n \n-    protected PackageDescr packageDescr;\n-\n-    protected List<KiePMMLOutputField> outputFields;\n+    protected List<KiePMMLOutputField> outputFields = new ArrayList<>();\n \n     /**\n      * Map between the original field name and the generated type.\n      */\n-    protected Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap;\n+    protected Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n \n     protected KiePMMLDroolsModel(String name, List<KiePMMLExtension> extensions) {\n         super(name, extensions);\n     }\n \n-    public PackageDescr getPackageDescr() {\n-        return packageDescr;\n-    }\n-\n     public Map<String, KiePMMLOriginalTypeGeneratedType> getFieldTypeMap() {\n         return fieldTypeMap;\n     }\n \n     @Override\n-    public Object evaluate(Map<String, Object> requestData) {\n+    public Object evaluate(final Object knowledgeBase, Map<String, Object> requestData) {\n+        logger.trace(\"evaluate {} {}\", knowledgeBase, requestData);", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzOTU5Ng==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r429239596", "bodyText": "Can you please revert code formatting?\nIt is really hard to find the few line changed.\nAs alternative, can you please highlight where to look at?", "author": "danielezonca", "createdAt": "2020-05-22T13:17:00Z", "path": "drools-model/drools-model-compiler/src/main/java/org/drools/modelcompiler/CanonicalKieModule.java", "diffHunk": "@@ -82,7 +82,6 @@\n import org.kie.internal.builder.ResourceChangeSet;", "originalCommit": "8fb77328113958ca1abc6d3fc33c92435be329e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQxNTI2Nw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430415267", "bodyText": "@danielezonca\nlines 215-223\nline 231", "author": "gitgabrio", "createdAt": "2020-05-26T13:33:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIzOTU5Ng=="}], "type": "inlineReview"}, {"oid": "f63408c6044d6ada5161afa51e8010a1a588fd25", "url": "https://github.com/kiegroup/drools/commit/f63408c6044d6ada5161afa51e8010a1a588fd25", "message": "[DROOLS-5258] Fixed getKModulePackageName to avoid \"NPE\" (null package\") if class has not already been loaded.", "committedDate": "2020-05-22T14:24:05Z", "type": "commit"}, {"oid": "d30258e0dbea6750b4c3efc5b48e1c24c52cfab0", "url": "https://github.com/kiegroup/drools/commit/d30258e0dbea6750b4c3efc5b48e1c24c52cfab0", "message": "[DROOLS-5258] Revert modifications", "committedDate": "2020-05-22T14:30:16Z", "type": "commit"}, {"oid": "6c5c5a21c895bb509ce3284cf349f9721422ca6e", "url": "https://github.com/kiegroup/drools/commit/6c5c5a21c895bb509ce3284cf349f9721422ca6e", "message": "[DROOLS-5258] Fixed as per PR suggestion", "committedDate": "2020-05-25T07:40:15Z", "type": "commit"}, {"oid": "142b9b6f899eaba317878e032b28700585b31b1c", "url": "https://github.com/kiegroup/drools/commit/142b9b6f899eaba317878e032b28700585b31b1c", "message": "[DROOLS-5258] Replaced Class.byName with classloader.loadClass to found the generated classes regardless of projec-internal or local-repository kjar.", "committedDate": "2020-05-25T08:29:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNDM0Mw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430424343", "bodyText": "Maybe SourceMapFactory would be better name for this interface.", "author": "jiripetrlik", "createdAt": "2020-05-26T13:46:37Z", "path": "kie-pmml-new/kie-pmml-commons/src/main/java/org/kie/pmml/commons/model/HasSourcesMap.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.kie.pmml.commons.model;\n+\n+import java.util.Map;\n+\n+/**\n+ * Interface used to define if a given <code>KiePmmlModel</code> contains a <b>sources map</b>\n+ */\n+public interface HasSourcesMap {", "originalCommit": "142b9b6f899eaba317878e032b28700585b31b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ0NTMwOQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430445309", "bodyText": "@jiripetrlik\nTo be honest, this interface is used to tell that a class contains SourcesMap, that's why I named it that way. Does this make sense?", "author": "gitgabrio", "createdAt": "2020-05-26T14:14:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNDM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk0MzUwMQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430943501", "bodyText": "@gitgabrio\nOk, understand.", "author": "jiripetrlik", "createdAt": "2020-05-27T08:25:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNDM0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNjAzMQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430426031", "bodyText": "Does it make sense to use if here? Is saved time worth of lower readability?", "author": "jiripetrlik", "createdAt": "2020-05-26T13:48:51Z", "path": "kie-pmml-new/kie-pmml-compiler/kie-pmml-compiler-commons/src/main/java/org/kie/pmml/compiler/commons/implementations/ModelImplementationProviderFinderImpl.java", "diffHunk": "@@ -44,7 +44,9 @@\n         Iterator<ModelImplementationProvider> providers = getProviders(refresh);\n         providers.forEachRemaining(toReturn::add);\n         logger.debug(\"toReturn {} {}\", toReturn, toReturn.size());\n-        toReturn.forEach(provider -> logger.trace(\"{} : {}\", provider.getPMMLModelType(), provider));\n+        if (logger.isTraceEnabled()) {", "originalCommit": "142b9b6f899eaba317878e032b28700585b31b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1MTU1Mw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430451553", "bodyText": "@jiripetrlik This has been introduced following similar comments from @danielezonca\nTBH, I like to avoid method executions that are completely wasted: in this situation the list would be looped even if no output would actually be logged.\nI think in both point of view (readability vs performance) there is not a big difference, so my personal approach (for this situation) would be to avoid wasting resource (this approach would be consistent with similar cases where the difference may be relevant).\nTo cut a long story short: I think most of those \"tracing\" will be removed, in the future, when the code is more stable/tested", "author": "gitgabrio", "createdAt": "2020-05-26T14:22:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNjAzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk0MzY5NQ==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430943695", "bodyText": "In that case I have no problem with it.", "author": "jiripetrlik", "createdAt": "2020-05-27T08:26:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyNjAzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyODQyMw==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430428423", "bodyText": "Would it be possible to split long lines in this file? It is very hard to read.", "author": "jiripetrlik", "createdAt": "2020-05-26T13:52:00Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-common/src/main/java/org/kie/pmml/models/drools/provider/DroolsModelProvider.java", "diffHunk": "@@ -35,13 +46,43 @@\n     @Override\n     public E getKiePMMLModel(DataDictionary dataDictionary, T model, Object kBuilder) {\n         logger.trace(\"getKiePMMLModel {} {}\", dataDictionary, model);\n-        E toReturn = getKiePMMLDroolsModel(dataDictionary, model);\n         if (!(kBuilder instanceof KnowledgeBuilder)) {\n             throw new KiePMMLException(String.format(\"Expecting KnowledgeBuilder, received %s\", kBuilder.getClass().getName()));\n         }\n-        ((KnowledgeBuilderImpl) kBuilder).addPackage(toReturn.getPackageDescr());\n+        final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n+        KiePMMLDroolsAST kiePMMLDroolsAST = getKiePMMLDroolsAST(dataDictionary, model, fieldTypeMap);\n+        E toReturn = getKiePMMLDroolsModel(dataDictionary, model, fieldTypeMap);\n+        PackageDescr packageDescr = getPackageDescr(kiePMMLDroolsAST, toReturn.getKModulePackageName());\n+        ((KnowledgeBuilderImpl) kBuilder).addPackage(packageDescr);\n         return toReturn;\n     }\n \n-    public abstract E getKiePMMLDroolsModel(DataDictionary dataDictionary, T model);\n+    @Override\n+    public E getKiePMMLModelFromPlugin(String packageName, DataDictionary dataDictionary, T model, Object kBuilder) {\n+        logger.trace(\"getKiePMMLModelFromPlugin {} {} {}\", dataDictionary, model, kBuilder);\n+        if (!(kBuilder instanceof KnowledgeBuilder)) {\n+            throw new KiePMMLException(String.format(\"Expecting KnowledgeBuilder, received %s\", kBuilder.getClass().getName()));\n+        }\n+        try {\n+            final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap = new HashMap<>();\n+            KiePMMLDroolsAST kiePMMLDroolsAST =  getKiePMMLDroolsAST(dataDictionary, model, fieldTypeMap);\n+            Map<String, String> sourcesMap = getKiePMMLDroolsModelSourcesMap(dataDictionary, model, fieldTypeMap, packageName);\n+            E toReturn = (E) new KiePMMLDroolsModelWithSources(model.getModelName(), packageName, sourcesMap);\n+            PackageDescr packageDescr = getPackageDescr(kiePMMLDroolsAST, packageName);\n+            ((KnowledgeBuilderImpl) kBuilder).addPackage(packageDescr);\n+            return toReturn;\n+        } catch (Exception e) {\n+            throw new RuntimeException(e);\n+        }\n+    }\n+\n+    public abstract E getKiePMMLDroolsModel(DataDictionary dataDictionary, T model, Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap);\n+\n+    public abstract KiePMMLDroolsAST getKiePMMLDroolsAST(DataDictionary dataDictionary, T model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap);\n+\n+    public abstract Map<String, String> getKiePMMLDroolsModelSourcesMap(final DataDictionary dataDictionary, final T model, final Map<String, KiePMMLOriginalTypeGeneratedType> fieldTypeMap, final String packageName) throws IOException;", "originalCommit": "142b9b6f899eaba317878e032b28700585b31b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NDEyOA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430454128", "bodyText": "@jiripetrlik\nSorry for long lines. But since we are talking of that: do you know - by chance - if there is a way to improve our formatting style? This long-line issue happen a lot of times, but IMHO the auto-format should resolve all this kind of situations", "author": "gitgabrio", "createdAt": "2020-05-26T14:26:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyODQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk0NDU4NA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430944584", "bodyText": "I usually check that I don't have long lines in the code visually. It is usually a matter of few second to check that I did not add any long lines. Unfortunately I'm not aware of any automatic tools for this.", "author": "jiripetrlik", "createdAt": "2020-05-27T08:27:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQyODQyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMjQ3MA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430432470", "bodyText": "Does it make sense to change license header format in this PR? I would suggest to do a separate PR with format changes if needed because it is not related with DROOLS-5258 and it harder to review the code.", "author": "jiripetrlik", "createdAt": "2020-05-26T13:57:24Z", "path": "kie-pmml-new/kie-pmml-models/kie-pmml-models-drools/kie-pmml-models-drools-scorecard/kie-pmml-models-drools-scorecard-compiler/src/main/java/org/kie/pmml/models/drools/scorecard/compiler/executor/ScorecardModelImplementationProvider.java", "diffHunk": "@@ -1,41 +1,63 @@\n /*\n-* Copyright 2020 Red Hat, Inc. and/or its affiliates.\n-*\n-* Licensed under the Apache License, Version 2.0 (the \"License\");\n-* you may not use this file except in compliance with the License.\n-* You may obtain a copy of the License at\n-*\n-*     http://www.apache.org/licenses/LICENSE-2.0\n-*\n-* Unless required by applicable law or agreed to in writing, software\n-* distributed under the License is distributed on an \"AS IS\" BASIS,\n-* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-* See the License for the specific language governing permissions and\n-* limitations under the License.\n-*/\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.", "originalCommit": "142b9b6f899eaba317878e032b28700585b31b1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQ1NjE2Ng==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430456166", "bodyText": "@jiripetrlik\nSorry, I can not find the difference. I've configured my IDE to automatically add this header with a template long time ago, and never changed it since then.", "author": "gitgabrio", "createdAt": "2020-05-26T14:28:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMjQ3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDk0NjgxNA==", "url": "https://github.com/kiegroup/drools/pull/2910#discussion_r430946814", "bodyText": "It is probably not important if you add header in your format. But I think it would be good to avoid of editing headers which are already present in the code. It makes review much harder if there is loads of unrelated formatting changes in the old code.", "author": "jiripetrlik", "createdAt": "2020-05-27T08:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDQzMjQ3MA=="}], "type": "inlineReview"}, {"oid": "cd430823b8e9795bd1c90eecbe71ffee4a0d07d3", "url": "https://github.com/kiegroup/drools/commit/cd430823b8e9795bd1c90eecbe71ffee4a0d07d3", "message": "[DROOLS-5258] Fixed as per PR suggestion", "committedDate": "2020-05-26T14:10:30Z", "type": "commit"}, {"oid": "c5a8dde8ba6858a611d22dfda4b60753d0eaaf8d", "url": "https://github.com/kiegroup/drools/commit/c5a8dde8ba6858a611d22dfda4b60753d0eaaf8d", "message": "[DROOLS-5258] Fixed as per PR suggestion", "committedDate": "2020-05-26T14:29:20Z", "type": "commit"}, {"oid": "e90e31fb8cc0efee9799f383fe47da9c902520ba", "url": "https://github.com/kiegroup/drools/commit/e90e31fb8cc0efee9799f383fe47da9c902520ba", "message": "[DROOLS-5258] Fixed as per PR suggestion", "committedDate": "2020-05-26T14:50:56Z", "type": "commit"}, {"oid": "57d0ec21b98f26d55a287019638c09ad4cfb070d", "url": "https://github.com/kiegroup/drools/commit/57d0ec21b98f26d55a287019638c09ad4cfb070d", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5258\n\n# Conflicts:\n#\tkie-pmml-new/kie-pmml-integration-tests/pom.xml", "committedDate": "2020-05-27T06:56:57Z", "type": "commit"}]}