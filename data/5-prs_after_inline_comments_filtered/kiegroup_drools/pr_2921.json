{"pr_number": 2921, "pr_title": "DROOLS-5331 & DROOLS-5078: Support for Enums in Rule Test Scenario", "pr_createdAt": "2020-05-28T15:46:34Z", "pr_url": "https://github.com/kiegroup/drools/pull/2921", "timeline": [{"oid": "0224344744e5f3b137a3cde32c64c58de3153da8", "url": "https://github.com/kiegroup/drools/commit/0224344744e5f3b137a3cde32c64c58de3153da8", "message": "DROOLS-5331: Add isEnum check", "committedDate": "2020-05-27T15:42:03Z", "type": "commit"}, {"oid": "796a1f9a7056b990913835193edb8e3de309f53a", "url": "https://github.com/kiegroup/drools/commit/796a1f9a7056b990913835193edb8e3de309f53a", "message": "DROOLS-5331: Managing Enums", "committedDate": "2020-05-27T22:54:10Z", "type": "commit"}, {"oid": "308e7b9bfc496c76a9b9f48d758b8bcc8c2c4af3", "url": "https://github.com/kiegroup/drools/commit/308e7b9bfc496c76a9b9f48d758b8bcc8c2c4af3", "message": "DROOLS-5331: Managing Enums", "committedDate": "2020-05-28T14:48:28Z", "type": "commit"}, {"oid": "f593b2cd41d3d471878eba074a07aab8ac86ef8b", "url": "https://github.com/kiegroup/drools/commit/f593b2cd41d3d471878eba074a07aab8ac86ef8b", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331", "committedDate": "2020-05-28T14:48:38Z", "type": "commit"}, {"oid": "12a23b2e3ec9eb38401bea121357bf40dc50e581", "url": "https://github.com/kiegroup/drools/commit/12a23b2e3ec9eb38401bea121357bf40dc50e581", "message": "DROOLS-5331: Managing Enums", "committedDate": "2020-05-28T15:42:25Z", "type": "commit"}, {"oid": "b9493bf6382fff15fe9b7d525e7d5b26527c39d5", "url": "https://github.com/kiegroup/drools/commit/b9493bf6382fff15fe9b7d525e7d5b26527c39d5", "message": "DROOLS-5331: Tests", "committedDate": "2020-05-28T15:43:51Z", "type": "commit"}, {"oid": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672", "url": "https://github.com/kiegroup/drools/commit/cfb1ef9377e566a7af5f3a1fe9d98553c5886672", "message": "DROOLS-5331: Tests", "committedDate": "2020-05-28T15:48:56Z", "type": "commit"}, {"oid": "1a31a6631bc882716e23b03109f510910a1fc141", "url": "https://github.com/kiegroup/drools/commit/1a31a6631bc882716e23b03109f510910a1fc141", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331", "committedDate": "2020-05-29T12:55:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432452657", "bodyText": "I think this method is quite misleading compared to similar n this utils (isList, isMap etc): all the others accept \"target\" class while this method works only if the parameter is the parent class. What about at least change the name?", "author": "danielezonca", "createdAt": "2020-05-29T12:34:53Z", "path": "drools-scenario-simulation/drools-scenario-simulation-api/src/main/java/org/drools/scenariosimulation/api/utils/ScenarioSimulationSharedUtils.java", "diffHunk": "@@ -56,4 +60,13 @@ public static boolean isMap(String className) {\n                 HashMap.class.getCanonicalName().equals(className) ||\n                 LinkedHashMap.class.getCanonicalName().equals(className);\n     }\n+\n+    /**\n+     * Returns true if given string equals to canonical name of <code>java.lang.Enum</code>\n+     * @param className\n+     * @return\n+     */\n+    public static boolean isEnum(String className) {\n+        return Enum.class.getCanonicalName().equals(className);\n+    }", "originalCommit": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUwNDIyOA==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432504228", "bodyText": "@danielezonca I don't understand your point. In my opinion is not misleading: it checks if a given className is an Enum, disregarding if is called on a target / parent class.", "author": "yesamer", "createdAt": "2020-05-29T14:04:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU0NjA4Mg==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432546082", "bodyText": "My comment is mainly related comparing this method with the others in the same class:\nisList(\"java.uti.ArrayList\") -> true\nisMap(\"java.util.HashMap\") -> true\nisEnum(\"my.Enum\") -> false\nDo you get what I mean?\nBtw I don't have a better idea in terms of naming, I just find it a bit confusing", "author": "danielezonca", "createdAt": "2020-05-29T15:00:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU1ODUyMQ==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432558521", "bodyText": "@danielezonca Yes, now I got your point. Probably the correct name should be something similar to isEnumCanonicalName() but is very bad.\nOn the others side, I think the scope of the 3 method are the same: you compared 2 case where you passed the exact ArrayList and HashMap canonical names, while in the third you passed a subclass of the Enum.\nYes, you can argue that is not usual to subclass ArrayList or HashMap and it's common to use subclasses of Enum but all 3 methods check the canonical name in the same way.\nOther names I can propose are:\nisEnumClass()\nisExactelyEnum()", "author": "yesamer", "createdAt": "2020-05-29T15:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjU2MzQwMg==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432563402", "bodyText": "isEnumCanonicalName() maybe it's the clearest option, even if ugly: it clarifies which check will be applied.", "author": "yesamer", "createdAt": "2020-05-29T15:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzA2NzMxMA==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433067310", "bodyText": "@danielezonca Change applied.", "author": "yesamer", "createdAt": "2020-06-01T06:43:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ1MjY1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ4MTAxNw==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432481017", "bodyText": "Can you please add DROOLS-5078 to the title of this PR :)", "author": "danielezonca", "createdAt": "2020-05-29T13:26:28Z", "path": "drools-scenario-simulation/drools-scenario-simulation-backend/src/main/java/org/drools/scenariosimulation/backend/util/ScenarioBeanUtil.java", "diffHunk": "@@ -178,13 +178,18 @@ public static Object convertValue(String className, Object cleanValue, ClassLoad\n                 return Short.parseShort(cleanStringForNumberParsing(value));\n             } else if (clazz.isAssignableFrom(LocalDate.class)) {\n                 return LocalDate.parse(value, DateTimeFormatter.ofPattern(\"yyyy-MM-dd\"));\n+            } else if (Enum.class.isAssignableFrom(clazz)) {\n+                return Enum.valueOf(((Class<? extends Enum>) clazz), value);\n             }\n         } catch (RuntimeException e) {\n-            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\").append(value).append(\"' as \").append(className).append(\" [\").append(e.getMessage()).append(\"]\").toString());\n+            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\")\n+                                                       .append(value).append(\"' as \").append(className).append(\" [\")\n+                                                       .append(e.getMessage()).append(\"]\").toString());\n         }\n \n         throw new IllegalArgumentException(new StringBuilder().append(\"Class \").append(className)\n-                                                   .append(\" is not supported\").toString());\n+                                                   .append(\" is not natively supported. Please use an MVEL expression\" +\n+                                                                   \" to use it.\").toString());", "originalCommit": "cfb1ef9377e566a7af5f3a1fe9d98553c5886672", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjUwNDY3MQ==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r432504671", "bodyText": "@danielezonca Done!", "author": "yesamer", "createdAt": "2020-05-29T14:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjQ4MTAxNw=="}], "type": "inlineReview"}, {"oid": "62a533e78703eb62c01107874ef37b049b8f94a0", "url": "https://github.com/kiegroup/drools/commit/62a533e78703eb62c01107874ef37b049b8f94a0", "message": "DROOLS-5331: Changes required after CR", "committedDate": "2020-06-01T06:42:45Z", "type": "commit"}, {"oid": "9c438dfcaf92aaa3b649dc631055fc6792381f32", "url": "https://github.com/kiegroup/drools/commit/9c438dfcaf92aaa3b649dc631055fc6792381f32", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331", "committedDate": "2020-06-01T06:42:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MzQ0NQ==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433163445", "bodyText": "Just an idea: maybe we can provide a link for MVEL expression? BCS well as I understand that not every illegal argument could be replaced by MVEL.", "author": "dupliaka", "createdAt": "2020-06-01T10:43:03Z", "path": "drools-scenario-simulation/drools-scenario-simulation-backend/src/main/java/org/drools/scenariosimulation/backend/util/ScenarioBeanUtil.java", "diffHunk": "@@ -178,13 +178,18 @@ public static Object convertValue(String className, Object cleanValue, ClassLoad\n                 return Short.parseShort(cleanStringForNumberParsing(value));\n             } else if (clazz.isAssignableFrom(LocalDate.class)) {\n                 return LocalDate.parse(value, DateTimeFormatter.ofPattern(\"yyyy-MM-dd\"));\n+            } else if (Enum.class.isAssignableFrom(clazz)) {\n+                return Enum.valueOf(((Class<? extends Enum>) clazz), value);\n             }\n         } catch (RuntimeException e) {\n-            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\").append(value).append(\"' as \").append(className).append(\" [\").append(e.getMessage()).append(\"]\").toString());\n+            throw new IllegalArgumentException(new StringBuilder().append(\"Impossible to parse '\")\n+                                                       .append(value).append(\"' as \").append(className).append(\" [\")\n+                                                       .append(e.getMessage()).append(\"]\").toString());\n         }\n \n         throw new IllegalArgumentException(new StringBuilder().append(\"Class \").append(className)\n-                                                   .append(\" is not supported\").toString());\n+                                                   .append(\" is not natively supported. Please use an MVEL expression\" +", "originalCommit": "9c438dfcaf92aaa3b649dc631055fc6792381f32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2NTIyMg==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433165222", "bodyText": "@dupliaka What do you have in mind? Consider the message is shown inside that popover: https://issues.redhat.com/secure/attachment/12465830/image-2020-02-19-10-13-01-440.png", "author": "yesamer", "createdAt": "2020-06-01T10:47:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MzQ0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI0MTcyOA==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433241728", "bodyText": "I meant to wrap http://mvel.documentnode.com/ link around MVEL expression if that possible?", "author": "dupliaka", "createdAt": "2020-06-01T13:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MzQ0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI0OTk1Nw==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433249957", "bodyText": "Please consider we have users with offline configurations so a link to an external website is not ideal. MVEL is used in the whole platform (for example process editor) so we can assume user knows it or that in general we don't need to solve in a specific editor a problem that is at platform level", "author": "danielezonca", "createdAt": "2020-06-01T13:58:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MzQ0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI3OTg2MQ==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433279861", "bodyText": "@danielezonca thanks for mention it, I was unavare of this.", "author": "dupliaka", "createdAt": "2020-06-01T14:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE2MzQ0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE3OTY5Ng==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433179696", "bodyText": "Suggestion:\nFrom my perspective that looks a bit like code repetition.\nWould you please tell me why cant we use\n        assertTrue(ScenarioSimulationSharedUtils.isEnumCanonicalName(\"java.lang.Enum\")); assertFalse(ScenarioSimulationSharedUtils.isEnumCanonicalName(\"Enum\"));", "author": "dupliaka", "createdAt": "2020-06-01T11:23:56Z", "path": "drools-scenario-simulation/drools-scenario-simulation-api/src/test/java/org/drools/scenariosimulation/api/utils/ScenarioSimulationSharedUtilsTest.java", "diffHunk": "@@ -52,4 +52,9 @@ public void isList() {\n     public void isMap() {\n         assertTrue(mapValues.stream().allMatch(ScenarioSimulationSharedUtils::isMap));\n     }\n+\n+    @Test\n+    public void isEnumCanonicalName() {\n+        assertTrue(ScenarioSimulationSharedUtils.isEnumCanonicalName(Enum.class.getCanonicalName()));\n+    }", "originalCommit": "9c438dfcaf92aaa3b649dc631055fc6792381f32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE4MTgxNg==", "url": "https://github.com/kiegroup/drools/pull/2921#discussion_r433181816", "bodyText": "@dupliaka Of course we can use it :)", "author": "yesamer", "createdAt": "2020-06-01T11:29:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzE3OTY5Ng=="}], "type": "inlineReview"}, {"oid": "8948ec17ad1898864e176ea0d7c022e0ab38bebf", "url": "https://github.com/kiegroup/drools/commit/8948ec17ad1898864e176ea0d7c022e0ab38bebf", "message": "DROOLS-5331: Changes required after CR", "committedDate": "2020-06-01T11:29:57Z", "type": "commit"}, {"oid": "ad761b7109811ebd753397f4d67654d843d41e17", "url": "https://github.com/kiegroup/drools/commit/ad761b7109811ebd753397f4d67654d843d41e17", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331", "committedDate": "2020-06-01T11:30:35Z", "type": "commit"}, {"oid": "1d255651c813f94c4e7ff164191989ea33478188", "url": "https://github.com/kiegroup/drools/commit/1d255651c813f94c4e7ff164191989ea33478188", "message": "Merge remote-tracking branch 'origin/master' into DROOLS-5331", "committedDate": "2020-06-03T09:42:57Z", "type": "commit"}]}