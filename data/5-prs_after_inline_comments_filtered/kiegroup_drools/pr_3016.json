{"pr_number": 3016, "pr_title": "Optimized the AND and OR FEEL operations ", "pr_createdAt": "2020-07-30T12:54:50Z", "pr_url": "https://github.com/kiegroup/drools/pull/3016", "timeline": [{"oid": "af66b83d6d2e0f15094ee984736347b142115b7f", "url": "https://github.com/kiegroup/drools/commit/af66b83d6d2e0f15094ee984736347b142115b7f", "message": "Optimized the AND and OR FEEL operations to not evaluate the right operand if not required", "committedDate": "2020-07-30T12:53:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk3OTYzOQ==", "url": "https://github.com/kiegroup/drools/pull/3016#discussion_r462979639", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return rightAND == Boolean.FALSE ? rightAND : null;\n          \n          \n            \n                                return rightAND == Boolean.FALSE ? false : null;", "author": "tarilabs", "createdAt": "2020-07-30T13:03:18Z", "path": "kie-dmn/kie-dmn-feel/src/main/java/org/kie/dmn/feel/lang/ast/InfixOpNode.java", "diffHunk": "@@ -163,41 +163,63 @@ public Type getResultType() {\n \n     @Override\n     public Object evaluate(EvaluationContext ctx) {\n-        if (left == null) return null;\n-        Object left = this.left.evaluate( ctx );\n-        Object right = this.right.evaluate( ctx );\n+        if (this.left == null) return null;\n         switch ( operator ) {\n             case ADD:\n-                return add( left, right, ctx );\n+                return add(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case SUB:\n-                return sub( left, right, ctx );\n+                return sub(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case MULT:\n-                return mult( left, right, ctx );\n+                return mult(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case DIV:\n-                return div( left, right, ctx );\n+                return div(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case POW:\n-                return math( left, right, ctx, (l, r) -> BigDecimalMath.pow( l, r, MathContext.DECIMAL128 ) );\n+                return math(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx, (l, r) -> BigDecimalMath.pow(l, r, MathContext.DECIMAL128));\n             case AND:\n-                return and( left, right, ctx );\n+                Boolean leftAND = EvalHelper.getBooleanOrNull(this.left.evaluate(ctx));\n+                if (leftAND != null) {\n+                    if (leftAND.booleanValue()) {\n+                        return EvalHelper.getBooleanOrNull(this.right.evaluate(ctx));\n+                    } else {\n+                        return Boolean.FALSE; //left hand operand is false, we do not need to evaluate right side\n+                    }\n+                } else {\n+                    Boolean rightAND = EvalHelper.getBooleanOrNull(this.right.evaluate(ctx));\n+                    return rightAND == Boolean.FALSE ? rightAND : null;", "originalCommit": "af66b83d6d2e0f15094ee984736347b142115b7f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ0NzkyMA==", "url": "https://github.com/kiegroup/drools/pull/3016#discussion_r463447920", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return rightAND == Boolean.FALSE ? rightAND : null;\n          \n          \n            \n                                return rightAND.equals(Boolean.FALSE) ? false : null;", "author": "tarilabs", "createdAt": "2020-07-31T07:24:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk3OTYzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ0OTUzOQ==", "url": "https://github.com/kiegroup/drools/pull/3016#discussion_r463449539", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return rightAND == Boolean.FALSE ? rightAND : null;\n          \n          \n            \n                                return Boolean.FALSE.equals(rightAND) ? Boolean.FALSE : null;", "author": "tarilabs", "createdAt": "2020-07-31T07:27:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk3OTYzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk3OTc3Nw==", "url": "https://github.com/kiegroup/drools/pull/3016#discussion_r462979777", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return rightOR == Boolean.TRUE ? rightOR : null;\n          \n          \n            \n                                return rightOR == Boolean.TRUE ? true : null;", "author": "tarilabs", "createdAt": "2020-07-30T13:03:33Z", "path": "kie-dmn/kie-dmn-feel/src/main/java/org/kie/dmn/feel/lang/ast/InfixOpNode.java", "diffHunk": "@@ -163,41 +163,63 @@ public Type getResultType() {\n \n     @Override\n     public Object evaluate(EvaluationContext ctx) {\n-        if (left == null) return null;\n-        Object left = this.left.evaluate( ctx );\n-        Object right = this.right.evaluate( ctx );\n+        if (this.left == null) return null;\n         switch ( operator ) {\n             case ADD:\n-                return add( left, right, ctx );\n+                return add(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case SUB:\n-                return sub( left, right, ctx );\n+                return sub(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case MULT:\n-                return mult( left, right, ctx );\n+                return mult(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case DIV:\n-                return div( left, right, ctx );\n+                return div(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx);\n             case POW:\n-                return math( left, right, ctx, (l, r) -> BigDecimalMath.pow( l, r, MathContext.DECIMAL128 ) );\n+                return math(this.left.evaluate(ctx), this.right.evaluate(ctx), ctx, (l, r) -> BigDecimalMath.pow(l, r, MathContext.DECIMAL128));\n             case AND:\n-                return and( left, right, ctx );\n+                Boolean leftAND = EvalHelper.getBooleanOrNull(this.left.evaluate(ctx));\n+                if (leftAND != null) {\n+                    if (leftAND.booleanValue()) {\n+                        return EvalHelper.getBooleanOrNull(this.right.evaluate(ctx));\n+                    } else {\n+                        return Boolean.FALSE; //left hand operand is false, we do not need to evaluate right side\n+                    }\n+                } else {\n+                    Boolean rightAND = EvalHelper.getBooleanOrNull(this.right.evaluate(ctx));\n+                    return rightAND == Boolean.FALSE ? rightAND : null;\n+                }\n             case OR:\n-                return or( left, right, ctx );\n+                Boolean leftOR = EvalHelper.getBooleanOrNull(this.left.evaluate(ctx));\n+                if (leftOR != null) {\n+                    if (!leftOR.booleanValue()) {\n+                        return EvalHelper.getBooleanOrNull(this.right.evaluate(ctx));\n+                    } else {\n+                        return Boolean.TRUE; //left hand operand is true, we do not need to evaluate right side\n+                    }\n+                } else {\n+                    Boolean rightOR = EvalHelper.getBooleanOrNull(this.right.evaluate(ctx));\n+                    return rightOR == Boolean.TRUE ? rightOR : null;", "originalCommit": "af66b83d6d2e0f15094ee984736347b142115b7f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ0ODEwNQ==", "url": "https://github.com/kiegroup/drools/pull/3016#discussion_r463448105", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return rightOR == Boolean.TRUE ? rightOR : null;\n          \n          \n            \n                                return rightOR.equals(Boolean.TRUE) ? true : null;", "author": "tarilabs", "createdAt": "2020-07-31T07:24:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk3OTc3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ0OTY2MQ==", "url": "https://github.com/kiegroup/drools/pull/3016#discussion_r463449661", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                return rightOR == Boolean.TRUE ? rightOR : null;\n          \n          \n            \n                                return Boolean.TRUE.equals(rightOR) ? Boolean.TRUE : null;", "author": "tarilabs", "createdAt": "2020-07-31T07:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjk3OTc3Nw=="}], "type": "inlineReview"}, {"oid": "53a3c46197f71b8b0238a917d646086d3454facb", "url": "https://github.com/kiegroup/drools/commit/53a3c46197f71b8b0238a917d646086d3454facb", "message": "Applied @tarilabs suggestions\n\nCo-authored-by: Matteo Mortari <matteo.mortari@gmail.com>", "committedDate": "2020-07-31T12:44:34Z", "type": "commit"}, {"oid": "036defdce5b587bc426e87785680f53efdcddc5a", "url": "https://github.com/kiegroup/drools/commit/036defdce5b587bc426e87785680f53efdcddc5a", "message": "Applied @tarilabs suggestions\n\nCo-authored-by: Matteo Mortari <matteo.mortari@gmail.com>", "committedDate": "2020-07-31T12:44:42Z", "type": "commit"}]}