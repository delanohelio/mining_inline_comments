{"pr_number": 3280, "pr_title": "DROOLS-5879 Optional newline handling in MVEL parser", "pr_createdAt": "2020-12-04T17:56:56Z", "pr_url": "https://github.com/kiegroup/drools/pull/3280", "timeline": [{"oid": "bc230639e644a05701c258560e314a2b5ef92a12", "url": "https://github.com/kiegroup/drools/commit/bc230639e644a05701c258560e314a2b5ef92a12", "message": "DROOLS-5879 Optional newline handling in MVEL parser", "committedDate": "2020-12-03T09:57:38Z", "type": "commit"}, {"oid": "1add45b6120a86b77a2cecd8eeefcddefd06e7c3", "url": "https://github.com/kiegroup/drools/commit/1add45b6120a86b77a2cecd8eeefcddefd06e7c3", "message": "Enable operator+newline test, use overloaded constructor", "committedDate": "2020-12-04T13:55:35Z", "type": "commit"}, {"oid": "6e78433fd5c36202b7884aee88a037fd9f4d5203", "url": "https://github.com/kiegroup/drools/commit/6e78433fd5c36202b7884aee88a037fd9f4d5203", "message": "wip", "committedDate": "2020-12-04T16:31:20Z", "type": "commit"}, {"oid": "1def6bdeed3b833f301bc9f2105dd377a57ff66a", "url": "https://github.com/kiegroup/drools/commit/1def6bdeed3b833f301bc9f2105dd377a57ff66a", "message": "alternative approach", "committedDate": "2020-12-04T17:03:16Z", "type": "commit"}, {"oid": "159cd106662417f812896c90aa5463a4fbec2d09", "url": "https://github.com/kiegroup/drools/commit/159cd106662417f812896c90aa5463a4fbec2d09", "message": "fixes", "committedDate": "2020-12-04T17:56:00Z", "type": "commit"}, {"oid": "f4a4179b43e6d8c08984c324741462fc50630991", "url": "https://github.com/kiegroup/drools/commit/f4a4179b43e6d8c08984c324741462fc50630991", "message": "empty statements collapse to one statement for some reason", "committedDate": "2020-12-04T17:58:45Z", "type": "commit"}, {"oid": "e8e3e84feec3293137edecd7febff63e4fcad442", "url": "https://github.com/kiegroup/drools/commit/e8e3e84feec3293137edecd7febff63e4fcad442", "message": "fix all other cases", "committedDate": "2020-12-04T18:27:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwMDE2Mw==", "url": "https://github.com/kiegroup/drools/pull/3280#discussion_r536300163", "bodyText": "I updated this test because I don't think this parses in a regular java grammar. Field/variable accesses are not statements and this was failing IIRC", "author": "evacchi", "createdAt": "2020-12-04T18:37:54Z", "path": "drools-model/drools-mvel-parser/src/test/java/org/drools/mvel/parser/DroolsMvelParserTest.java", "diffHunk": "@@ -716,14 +722,14 @@ public void testWithConstructor() {\n     @Test\n     public void testWithoutSemicolon() {\n         String expr = \"{             \" +\n-                        \"a\" + newLine() +\n-                        \"b\" + newLine() +\n+                        \"a()\" + newLine() +\n+                        \"b()\" + newLine() +\n                         \"}\";\n \n         BlockStmt expression = MvelParser.parseBlock(expr);\n         assertEquals(\"{\" + newLine() +\n-                             \"    a;\" + newLine() +\n-                             \"    b;\" + newLine() +\n+                             \"    a();\" + newLine() +\n+                             \"    b();\" + newLine() +", "originalCommit": "e8e3e84feec3293137edecd7febff63e4fcad442", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjMwMDQ4Ng==", "url": "https://github.com/kiegroup/drools/pull/3280#discussion_r536300486", "bodyText": "I removed these newlines because they are now treated as whitespace and not empty statements. I think this a good behavior.", "author": "evacchi", "createdAt": "2020-12-04T18:38:31Z", "path": "drools-model/drools-mvel-parser/src/test/java/org/drools/mvel/parser/DroolsMvelParserTest.java", "diffHunk": "@@ -815,8 +821,6 @@ public void commentsWithEmptyStatements() {\n \n         BlockStmt expression = MvelParser.parseBlock(expr);\n         assertEquals(\"{\" + newLine() +\n-                             \"    ;\" + newLine() +\n-                             \"    ;\" + newLine() +", "originalCommit": "e8e3e84feec3293137edecd7febff63e4fcad442", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3a5562d3dde639c8e0ad54b7900554e305cf04a0", "url": "https://github.com/kiegroup/drools/commit/3a5562d3dde639c8e0ad54b7900554e305cf04a0", "message": "fixes, refactor", "committedDate": "2020-12-10T08:10:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjI2MjEwMQ==", "url": "https://github.com/kiegroup/drools/pull/3280#discussion_r542262101", "bodyText": "Nitpick: you could make this constructor to simply call the other, passing true as 2nd argument.", "author": "mariofusco", "createdAt": "2020-12-14T10:09:31Z", "path": "drools-model/drools-mvel-parser/src/main/java/org/drools/mvel/parser/MvelParser.java", "diffHunk": "@@ -91,6 +92,13 @@ public MvelParser() {\n     public MvelParser(ParserConfiguration configuration) {\n         this.configuration = configuration;\n         configuration.getPostProcessors().clear();\n+        this.optionalSemicolon = true;", "originalCommit": "3a5562d3dde639c8e0ad54b7900554e305cf04a0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6bcc094e4a1b265b0b9109bef65df09b5d747972", "url": "https://github.com/kiegroup/drools/commit/6bcc094e4a1b265b0b9109bef65df09b5d747972", "message": "be more consistent with SEMICOLON named token usage", "committedDate": "2020-12-14T13:17:48Z", "type": "commit"}, {"oid": "4447cf9a4a67810d496341c6ddde125da1c1af9d", "url": "https://github.com/kiegroup/drools/commit/4447cf9a4a67810d496341c6ddde125da1c1af9d", "message": "use only one constructor in MvelParser", "committedDate": "2020-12-15T11:29:25Z", "type": "commit"}]}