{"pr_number": 2747, "pr_title": "DROOLS-4942 DMN DT Analysis hit policy recommender", "pr_createdAt": "2020-02-05T09:12:11Z", "pr_url": "https://github.com/kiegroup/drools/pull/2747", "timeline": [{"oid": "4b6f58acbc70c2a6c216a73b47a39ea3d7bdc3c3", "url": "https://github.com/kiegroup/drools/commit/4b6f58acbc70c2a6c216a73b47a39ea3d7bdc3c3", "message": "DROOLS-4942 DMN DT Analysis hit policy recommender\n\nWIP", "committedDate": "2020-02-04T12:59:13Z", "type": "commit"}, {"oid": "e2d3c9be3d21fed7116dae971cd742cb656f646e", "url": "https://github.com/kiegroup/drools/commit/e2d3c9be3d21fed7116dae971cd742cb656f646e", "message": "update according to feedback received", "committedDate": "2020-02-05T09:00:08Z", "type": "commit"}, {"oid": "f35dceb643bbef0c0165af19b2be0a14644382f8", "url": "https://github.com/kiegroup/drools/commit/f35dceb643bbef0c0165af19b2be0a14644382f8", "message": "cleanup", "committedDate": "2020-02-05T09:09:40Z", "type": "commit"}, {"oid": "c88ea2789f80df1d98515772d50bad5691073788", "url": "https://github.com/kiegroup/drools/commit/c88ea2789f80df1d98515772d50bad5691073788", "message": ".", "committedDate": "2020-02-06T15:28:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjI2OTQ3OQ==", "url": "https://github.com/kiegroup/drools/pull/2747#discussion_r376269479", "bodyText": "it could be more readable if the function's name starts with \"get\"", "author": "hellowdan", "createdAt": "2020-02-07T08:37:20Z", "path": "kie-dmn/kie-dmn-validation/src/main/java/org/kie/dmn/validation/dtanalysis/model/DTAnalysis.java", "diffHunk": "@@ -692,4 +694,51 @@ public boolean is2ndNFViolation() {\n         return Collections.unmodifiableCollection(contractionsViolating2ndNF);\n     }\n \n+    public void computeHitPolicyRecommender() {\n+        if (!gaps.isEmpty() || !isHitPolicySingle(sourceDT.getHitPolicy())) {\n+            return;\n+        }\n+        if (overlaps.isEmpty() && sourceDT.getHitPolicy() != HitPolicy.UNIQUE) {\n+            passThruMessages.add(new DMNDTAnalysisMessage(this,\n+                                                          Severity.WARN,\n+                                                          MsgUtil.createMessage(Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_UNIQUE,\n+                                                                                nameOrIDOfTable()),\n+                                                          Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_UNIQUE.getType()));\n+        } else if (!overlaps.isEmpty()) {\n+            boolean overlapsShareSameOutput = true;\n+            for (Overlap ol : overlaps) {\n+                List<Integer> rules = ol.getRules();\n+                Set<List<Comparable<?>>> outputsForOverlap = new HashSet<>();\n+                for (Integer ruleID : rules) {\n+                    outputsForOverlap.add(ddtaTable.getRule().get(ruleID - 1).getOutputEntry());\n+                }\n+                overlapsShareSameOutput &= outputsForOverlap.size() == 1;\n+            }\n+            if (overlapsShareSameOutput && sourceDT.getHitPolicy() != HitPolicy.ANY) {\n+                passThruMessages.add(new DMNDTAnalysisMessage(this,\n+                                                              sourceDT.getHitPolicy() == HitPolicy.UNIQUE ? Severity.ERROR : Severity.WARN,\n+                                                              MsgUtil.createMessage(Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_ANY,\n+                                                                                    nameOrIDOfTable()),\n+                                                              Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_ANY.getType()));\n+            } else if (!overlapsShareSameOutput && sourceDT.getHitPolicy() != HitPolicy.PRIORITY) {\n+                passThruMessages.add(new DMNDTAnalysisMessage(this,\n+                                                              Severity.ERROR,\n+                                                              MsgUtil.createMessage(Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_PRIORITY,\n+                                                                                    nameOrIDOfTable()),\n+                                                              Msg.DTANALYSIS_HITPOLICY_RECOMMENDER_PRIORITY.getType()));\n+            }\n+        }\n+    }\n+\n+    public boolean isHitPolicySingle(HitPolicy hp) {\n+        return hp == HitPolicy.UNIQUE || hp == HitPolicy.ANY || hp == HitPolicy.PRIORITY || hp == HitPolicy.FIRST;\n+    }\n+\n+    private String nameOrIDOfTable() {", "originalCommit": "c88ea2789f80df1d98515772d50bad5691073788", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}