{"pr_number": 6959, "pr_title": "Fix ProgressListenerTests", "pr_createdAt": "2020-06-19T13:06:35Z", "pr_url": "https://github.com/realm/realm-java/pull/6959", "timeline": [{"oid": "a7fd18b40a4c53c67d5f58bb7cd50839a869f10d", "url": "https://github.com/realm/realm-java/commit/a7fd18b40a4c53c67d5f58bb7cd50839a869f10d", "message": "Remove already migrated ProgressListenerTests", "committedDate": "2020-06-19T12:02:28Z", "type": "commit"}, {"oid": "99627bce099144d1e1f1d9d80e02ee712e3855a7", "url": "https://github.com/realm/realm-java/commit/99627bce099144d1e1f1d9d80e02ee712e3855a7", "message": "Fix ProgressListenerTests", "committedDate": "2020-06-19T13:00:06Z", "type": "commit"}, {"oid": "cfb4725e0223a1a7be84b7b60d06881f45907f5c", "url": "https://github.com/realm/realm-java/commit/cfb4725e0223a1a7be84b7b60d06881f45907f5c", "message": "Add timeout to progress listener tests to get indicators of what blocks CI", "committedDate": "2020-06-22T13:34:20Z", "type": "commit"}, {"oid": "b317f5fe67584b3e7ee4c83ecedd68e45eeb1554", "url": "https://github.com/realm/realm-java/commit/b317f5fe67584b3e7ee4c83ecedd68e45eeb1554", "message": "Minor adjustments", "committedDate": "2020-06-23T07:59:59Z", "type": "commit"}, {"oid": "937dd68d943be954c32a6a2141badc7c1151ee59", "url": "https://github.com/realm/realm-java/commit/937dd68d943be954c32a6a2141badc7c1151ee59", "message": "Minor adjustments", "committedDate": "2020-06-23T10:34:05Z", "type": "commit"}, {"oid": "119875d2a77014e71386253dd0cbd5b40a2ea00b", "url": "https://github.com/realm/realm-java/commit/119875d2a77014e71386253dd0cbd5b40a2ea00b", "message": "Minor adjustments", "committedDate": "2020-06-23T10:49:58Z", "type": "commit"}, {"oid": "301b44294b89ee1a518e6da146c6fd75c917f136", "url": "https://github.com/realm/realm-java/commit/301b44294b89ee1a518e6da146c6fd75c917f136", "message": "Merge branch 'v10' into cr/sync-integration-test-progresslisteners", "committedDate": "2020-06-23T13:48:22Z", "type": "commit"}, {"oid": "2fc19be50af75d0fd99a7107939f6c89ef11f167", "url": "https://github.com/realm/realm-java/commit/2fc19be50af75d0fd99a7107939f6c89ef11f167", "message": "Minor adjustments", "committedDate": "2020-06-23T14:35:49Z", "type": "commit"}, {"oid": "d3225a5479efd4bcd98cae196d09759e6e267e5c", "url": "https://github.com/realm/realm-java/commit/d3225a5479efd4bcd98cae196d09759e6e267e5c", "message": "Minor adjustment for CI test", "committedDate": "2020-06-23T14:47:41Z", "type": "commit"}, {"oid": "c6816ae7837d3b99664ba79949c0519810e53627", "url": "https://github.com/realm/realm-java/commit/c6816ae7837d3b99664ba79949c0519810e53627", "message": "Log user exceptions in progress listeners", "committedDate": "2020-06-24T08:27:21Z", "type": "commit"}, {"oid": "3d3bdab6b9433893cfac6127186a7f63130ebe0f", "url": "https://github.com/realm/realm-java/commit/3d3bdab6b9433893cfac6127186a7f63130ebe0f", "message": "Ignoring test until upload is not stalling", "committedDate": "2020-06-24T09:58:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzOTQ3Mw==", "url": "https://github.com/realm/realm-java/pull/6959#discussion_r444839473", "bodyText": "This seems like a behavioral change, where we now swallow the exception?\nNote, it is probably not a bad idea since callbacks generally shouldn't be allowed to crash here, but as a minimum, we would need a test for it + an update to the breaking section of the changelog", "author": "cmelchior", "createdAt": "2020-06-24T11:53:40Z", "path": "realm/realm-library/src/objectServer/java/io/realm/mongodb/sync/SyncSession.java", "diffHunk": "@@ -259,13 +259,21 @@ public boolean isConnected() {\n         return (sessionState == State.ACTIVE || sessionState == State.DYING) && connectionState == ConnectionState.CONNECTED;\n     }\n \n+    /**\n+     * All progress listener events from native Sync are reported to this method.\n+     */\n+    @SuppressWarnings(\"unused\")\n     synchronized void notifyProgressListener(long listenerId, long transferredBytes, long transferableBytes) {\n         Pair<ProgressListener, Progress> listener = listenerIdToProgressListenerMap.get(listenerId);\n         if (listener != null) {\n             Progress newProgressNotification = new Progress(transferredBytes, transferableBytes);\n             if (!newProgressNotification.equals(listener.second)) {\n                 listener.second = newProgressNotification;\n-                listener.first.onChange(newProgressNotification);\n+                try {\n+                    listener.first.onChange(newProgressNotification);\n+                } catch (Exception exception) {\n+                    RealmLog.error(exception);", "originalCommit": "3d3bdab6b9433893cfac6127186a7f63130ebe0f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg0NjMwMA==", "url": "https://github.com/realm/realm-java/pull/6959#discussion_r444846300", "bodyText": "We also swallowed it before, just in Sync.notifyProgressListeners. Since the callback is directly on the SyncSession I just replicated it.\nMaybe this was not that obvious as the Sync.notifyProgressListener is still there even though unused, but I left it as I thought we would/reuse it when fixing the leakage of session objects.", "author": "rorbech", "createdAt": "2020-06-24T12:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzOTQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg0NjY2Ng==", "url": "https://github.com/realm/realm-java/pull/6959#discussion_r444846666", "bodyText": "The reason why I introduced it was that we in fact have a test for it :)", "author": "rorbech", "createdAt": "2020-06-24T12:08:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzOTQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDg1NjQ5NQ==", "url": "https://github.com/realm/realm-java/pull/6959#discussion_r444856495", "bodyText": "Cool \ud83d\udc4d", "author": "cmelchior", "createdAt": "2020-06-24T12:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDgzOTQ3Mw=="}], "type": "inlineReview"}, {"oid": "c95793af14e7d3755633a14ff972d7eb52483188", "url": "https://github.com/realm/realm-java/commit/c95793af14e7d3755633a14ff972d7eb52483188", "message": "Updates according to code review", "committedDate": "2020-06-29T08:06:49Z", "type": "commit"}, {"oid": "fd45e7b1891123848ea8d696ef271ddeacde7ba6", "url": "https://github.com/realm/realm-java/commit/fd45e7b1891123848ea8d696ef271ddeacde7ba6", "message": "Add test for initial progress listener callback on waitForInitialRemoteData", "committedDate": "2020-06-29T08:11:43Z", "type": "commit"}, {"oid": "8554e49f66c63640502fc1c1cea1680aeef0c8df", "url": "https://github.com/realm/realm-java/commit/8554e49f66c63640502fc1c1cea1680aeef0c8df", "message": "Update test server image", "committedDate": "2020-06-29T08:12:11Z", "type": "commit"}, {"oid": "b4f2cc642f2835058cad5a34e09e714f7601fc50", "url": "https://github.com/realm/realm-java/commit/b4f2cc642f2835058cad5a34e09e714f7601fc50", "message": "Ignore failing test but track issue", "committedDate": "2020-06-29T09:49:03Z", "type": "commit"}, {"oid": "579211073da259eecde5ad6fa661d216b5867063", "url": "https://github.com/realm/realm-java/commit/579211073da259eecde5ad6fa661d216b5867063", "message": "Apply suggestions from code review\n\nCo-authored-by: Christian Melchior <christian@ilios.dk>", "committedDate": "2020-06-29T11:11:22Z", "type": "commit"}, {"oid": "6e04e2c395fa1e441eaa922e848cb6ff3c904576", "url": "https://github.com/realm/realm-java/commit/6e04e2c395fa1e441eaa922e848cb6ff3c904576", "message": "Merge branch 'v10' into cr/sync-integration-test-progresslisteners", "committedDate": "2020-06-29T11:24:44Z", "type": "commit"}]}