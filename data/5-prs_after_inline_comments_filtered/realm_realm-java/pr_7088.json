{"pr_number": 7088, "pr_title": "Add support for Realm.executeTransaction using coroutines and RealmResults.toFlow", "pr_createdAt": "2020-09-08T15:08:43Z", "pr_url": "https://github.com/realm/realm-java/pull/7088", "timeline": [{"oid": "9541ea82c174b28e5a748e9e7769ebd2bea2591f", "url": "https://github.com/realm/realm-java/commit/9541ea82c174b28e5a748e9e7769ebd2bea2591f", "message": "Added preliminary versions of executeTransactionAwait, toFlow, tests for these and created a new coroutinesExample project under examples", "committedDate": "2020-09-08T13:23:47Z", "type": "commit"}, {"oid": "f4c584bf4e65df697bb1097306a7fcbb8046a5f8", "url": "https://github.com/realm/realm-java/commit/f4c584bf4e65df697bb1097306a7fcbb8046a5f8", "message": "Cleanup", "committedDate": "2020-09-08T15:04:24Z", "type": "commit"}, {"oid": "a1418317ea3179c9918e002ec697c0b213ab9d00", "url": "https://github.com/realm/realm-java/commit/a1418317ea3179c9918e002ec697c0b213ab9d00", "message": "Enabled android.useAndroidX in examples project", "committedDate": "2020-09-09T08:04:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkwNDQzNg==", "url": "https://github.com/realm/realm-java/pull/7088#discussion_r487904436", "bodyText": "Should we have two thread pools? One for writes and one for Reads? The pool for writes just need 1 thread since you cannot parallelize these anyway.", "author": "cmelchior", "createdAt": "2020-09-14T13:18:04Z", "path": "realm/realm-library/src/main/java/io/realm/BaseRealm.java", "diffHunk": "@@ -73,8 +73,9 @@\n \n     static volatile Context applicationContext;\n \n+    // FIXME: document this\n     // Thread pool for all async operations (Query & transaction)\n-    static final RealmThreadPoolExecutor asyncTaskExecutor = RealmThreadPoolExecutor.newDefaultExecutor();\n+    public static final RealmThreadPoolExecutor asyncTaskExecutor = RealmThreadPoolExecutor.newDefaultExecutor();", "originalCommit": "a1418317ea3179c9918e002ec697c0b213ab9d00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyNjY2NQ==", "url": "https://github.com/realm/realm-java/pull/7088#discussion_r492026665", "bodyText": "I've ended up adding one public thread pool with one thread which is used only for executeTransactionAwait. I don't think it's needed to add an additional one for reads as flows need to be collected on the same thread the query was performed.", "author": "edualonso", "createdAt": "2020-09-21T13:01:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkwNDQzNg=="}], "type": "inlineReview"}, {"oid": "2fca34341185971bcf5d61e43b5a1cc180dba77e", "url": "https://github.com/realm/realm-java/commit/2fca34341185971bcf5d61e43b5a1cc180dba77e", "message": "Addressing comments in PR - part 1", "committedDate": "2020-09-15T10:12:41Z", "type": "commit"}, {"oid": "21b4666c092b9988126bebceef668b5846a87ff7", "url": "https://github.com/realm/realm-java/commit/21b4666c092b9988126bebceef668b5846a87ff7", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-17T11:41:04Z", "type": "commit"}, {"oid": "9cf50f648d4aae8a8f83eed610b23c030c185150", "url": "https://github.com/realm/realm-java/commit/9cf50f648d4aae8a8f83eed610b23c030c185150", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-17T15:45:25Z", "type": "commit"}, {"oid": "5d61a190b3bfd34f87ac54bf46b9a4f588c397c8", "url": "https://github.com/realm/realm-java/commit/5d61a190b3bfd34f87ac54bf46b9a4f588c397c8", "message": "Updated pointer to OS and fixed wrong imports", "committedDate": "2020-09-17T16:21:57Z", "type": "commit"}, {"oid": "c8d32bec5e850cb6d6ce7322a0cdb937e41732c4", "url": "https://github.com/realm/realm-java/commit/c8d32bec5e850cb6d6ce7322a0cdb937e41732c4", "message": "Cleanup", "committedDate": "2020-09-17T20:50:11Z", "type": "commit"}, {"oid": "8b2945fcbb2e720ebfbe1deef1cf7cdc57824e93", "url": "https://github.com/realm/realm-java/commit/8b2945fcbb2e720ebfbe1deef1cf7cdc57824e93", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-17T20:50:35Z", "type": "commit"}, {"oid": "d39dd6425d5defde845c9b960c11009ce2950aa3", "url": "https://github.com/realm/realm-java/commit/d39dd6425d5defde845c9b960c11009ce2950aa3", "message": "Removed multidex dependency", "committedDate": "2020-09-17T22:31:16Z", "type": "commit"}, {"oid": "d5dfeafba20f110ca5dd9948cb8a2058f762a8ba", "url": "https://github.com/realm/realm-java/commit/d5dfeafba20f110ca5dd9948cb8a2058f762a8ba", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-17T22:31:55Z", "type": "commit"}, {"oid": "31a190603d62b39fede08304688eca9a2d6c6106", "url": "https://github.com/realm/realm-java/commit/31a190603d62b39fede08304688eca9a2d6c6106", "message": "Removed unused activity from example manifest", "committedDate": "2020-09-18T07:32:59Z", "type": "commit"}, {"oid": "1c6d623a6b2484a9612286df19406e2064e82811", "url": "https://github.com/realm/realm-java/commit/1c6d623a6b2484a9612286df19406e2064e82811", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-18T07:33:23Z", "type": "commit"}, {"oid": "f01033d7a2a5ca6b8235083e417c43ac8ae56bca", "url": "https://github.com/realm/realm-java/commit/f01033d7a2a5ca6b8235083e417c43ac8ae56bca", "message": "Added missing toFlow versions for RealmObject, RealmList and tentative (not working yet) for RealmModel. Added more tests too.", "committedDate": "2020-09-18T14:29:25Z", "type": "commit"}, {"oid": "291476d3d8ecf107fcc702a0a40a9650d46c3af9", "url": "https://github.com/realm/realm-java/commit/291476d3d8ecf107fcc702a0a40a9650d46c3af9", "message": "Polished toFlow for RealmModel and added isFrozen and freeze extension functions for RealmModel", "committedDate": "2020-09-21T11:43:23Z", "type": "commit"}, {"oid": "fff6170017dc5dac9177da43fb44d2a7e77ee247", "url": "https://github.com/realm/realm-java/commit/fff6170017dc5dac9177da43fb44d2a7e77ee247", "message": "A bit more cleanup plus added some tests on cancellations", "committedDate": "2020-09-21T12:48:24Z", "type": "commit"}, {"oid": "ed2c6cea6cd6cf5acfdf2ea44367c4343fd93270", "url": "https://github.com/realm/realm-java/commit/ed2c6cea6cd6cf5acfdf2ea44367c4343fd93270", "message": "Removed hack for fixing androidx multidexing problem", "committedDate": "2020-09-21T13:15:03Z", "type": "commit"}, {"oid": "e454f5fb8506704a36e833345a702fc012f7f37d", "url": "https://github.com/realm/realm-java/commit/e454f5fb8506704a36e833345a702fc012f7f37d", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-23T08:23:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxMTEyMw==", "url": "https://github.com/realm/realm-java/pull/7088#discussion_r493611123", "bodyText": "We should use WRITE_EXECUTOR since this is public. If we introduce this, we should probably also redirect executeTransactionAsync to use it.", "author": "cmelchior", "createdAt": "2020-09-23T13:53:34Z", "path": "realm/realm-library/src/main/java/io/realm/BaseRealm.java", "diffHunk": "@@ -76,6 +76,12 @@\n     // Thread pool for all async operations (Query & transaction)\n     static final RealmThreadPoolExecutor asyncTaskExecutor = RealmThreadPoolExecutor.newDefaultExecutor();\n \n+    /**\n+     * Thread pool executor used for write operations - only one thread is needed as writes cannot\n+     * be parallelized.\n+     */\n+    public static final RealmThreadPoolExecutor writeExecutor = RealmThreadPoolExecutor.newSingleThreadExecutor();", "originalCommit": "e454f5fb8506704a36e833345a702fc012f7f37d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxMTQwNw==", "url": "https://github.com/realm/realm-java/pull/7088#discussion_r493611407", "bodyText": "But it is fine to create an issue for that and do it in a followup PR", "author": "cmelchior", "createdAt": "2020-09-23T13:53:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYxMTEyMw=="}], "type": "inlineReview"}, {"oid": "09995ce7abcda8db0654578a43a19e701b10fcb4", "url": "https://github.com/realm/realm-java/commit/09995ce7abcda8db0654578a43a19e701b10fcb4", "message": "Merge branch 'v10' into el/coroutine-extensions", "committedDate": "2020-09-23T14:47:51Z", "type": "commit"}, {"oid": "c440975869c08f5c12b528d2733cf2c4e5b18b89", "url": "https://github.com/realm/realm-java/commit/c440975869c08f5c12b528d2733cf2c4e5b18b89", "message": "Implemented changes after review", "committedDate": "2020-09-23T16:02:36Z", "type": "commit"}, {"oid": "6969659810d30ee63b32eb54e8042c772328fbb3", "url": "https://github.com/realm/realm-java/commit/6969659810d30ee63b32eb54e8042c772328fbb3", "message": "Make test more solid with shorter delays for cancellation", "committedDate": "2020-09-24T09:19:12Z", "type": "commit"}, {"oid": "d04d8bc808aea6d4948f241971d9058b3062d454", "url": "https://github.com/realm/realm-java/commit/d04d8bc808aea6d4948f241971d9058b3062d454", "message": "Cannot really count of any number of transactions being executed after some time so it is better to check that not all planned elements were inserted", "committedDate": "2020-09-24T11:10:07Z", "type": "commit"}, {"oid": "e98cfc6505c2afdb12be72718133b9c6d5d5dc30", "url": "https://github.com/realm/realm-java/commit/e98cfc6505c2afdb12be72718133b9c6d5d5dc30", "message": "Fixed wrong OS pointer", "committedDate": "2020-09-24T16:40:36Z", "type": "commit"}, {"oid": "3408d2f81cbe33cdaf26c0b92043461f37a72cc2", "url": "https://github.com/realm/realm-java/commit/3408d2f81cbe33cdaf26c0b92043461f37a72cc2", "message": "Fixed typo in doc", "committedDate": "2020-09-29T08:25:51Z", "type": "commit"}, {"oid": "b9355fbb9731f60bfce48904bc0b18d179f2a153", "url": "https://github.com/realm/realm-java/commit/b9355fbb9731f60bfce48904bc0b18d179f2a153", "message": "Updated changelog", "committedDate": "2020-09-29T08:28:41Z", "type": "commit"}]}