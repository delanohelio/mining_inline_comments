{"pr_number": 2578, "pr_title": "[NETBEANS-5091] PHP - more improvements for constants in code completion", "pr_createdAt": "2020-12-03T22:38:31Z", "pr_url": "https://github.com/apache/netbeans/pull/2578", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1MTg1Mg==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r535751852", "bodyText": "Nitpick: NOI18N", "author": "junichi11", "createdAt": "2020-12-04T00:43:29Z", "path": "php/php.editor/src/org/netbeans/modules/php/editor/model/nodes/ClassConstantDeclarationInfo.java", "diffHunk": "@@ -97,4 +96,61 @@ public PhpModifiers getAccessModifiers() {\n         return PhpModifiers.fromBitMask(constantDeclaration.getModifier());\n     }\n \n+    @CheckForNull\n+    protected static String getConstantValue(Expression expr) {\n+        if (expr instanceof Scalar) {\n+            return ((Scalar) expr).getStringValue();\n+        }\n+        if (expr instanceof UnaryOperation) {\n+            UnaryOperation up = (UnaryOperation) expr;\n+            if (up.getOperator() == UnaryOperation.Operator.MINUS\n+                    && up.getExpression() instanceof Scalar) {\n+                return \"-\" + ((Scalar) up.getExpression()).getStringValue();", "originalCommit": "3732ec28ffb49398e8f43d1cc8a301aec3608a58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjEyMjMxMA==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536122310", "bodyText": "Fixed.", "author": "KacerCZ", "createdAt": "2020-12-04T14:05:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1MTg1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1MjI4MQ==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r535752281", "bodyText": "Why Integer?", "author": "junichi11", "createdAt": "2020-12-04T00:44:28Z", "path": "php/php.editor/src/org/netbeans/modules/php/editor/model/nodes/ClassConstantDeclarationInfo.java", "diffHunk": "@@ -22,20 +22,28 @@\n import java.util.ArrayList;\n import java.util.Iterator;\n import java.util.List;\n+import org.netbeans.api.annotations.common.CheckForNull;\n import org.netbeans.modules.csl.api.OffsetRange;\n import org.netbeans.modules.php.editor.api.PhpModifiers;\n import org.netbeans.modules.php.editor.api.QualifiedName;\n import org.netbeans.modules.php.editor.model.nodes.ASTNodeInfo.Kind;\n+import org.netbeans.modules.php.editor.parser.astnodes.ArrayCreation;\n+import org.netbeans.modules.php.editor.parser.astnodes.ArrayElement;\n import org.netbeans.modules.php.editor.parser.astnodes.ConstantDeclaration;\n import org.netbeans.modules.php.editor.parser.astnodes.Expression;\n import org.netbeans.modules.php.editor.parser.astnodes.Identifier;\n import org.netbeans.modules.php.editor.parser.astnodes.Scalar;\n import org.netbeans.modules.php.editor.parser.astnodes.UnaryOperation;\n+import org.netbeans.modules.php.editor.parser.astnodes.UnpackableArrayElement;\n \n /**\n  * @author Radek Matous\n  */\n public class ClassConstantDeclarationInfo extends ASTNodeInfo<Identifier> {\n+    // Array display is stopped after this length of string is reached.\n+    private static final Integer ARRAY_CUT_LENGTH = 50;", "originalCommit": "3732ec28ffb49398e8f43d1cc8a301aec3608a58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjEyMjY3Nw==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536122677", "bodyText": "Changed type to int.", "author": "KacerCZ", "createdAt": "2020-12-04T14:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTc1MjI4MQ=="}], "type": "inlineReview"}, {"oid": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "url": "https://github.com/apache/netbeans/commit/fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing.", "committedDate": "2020-12-04T14:03:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536878851", "bodyText": "Perhaps instead of ... we could show something like ... (5 more elements)?", "author": "tmysik", "createdAt": "2020-12-05T19:34:26Z", "path": "php/php.editor/src/org/netbeans/modules/php/editor/model/nodes/ClassConstantDeclarationInfo.java", "diffHunk": "@@ -97,4 +96,61 @@ public PhpModifiers getAccessModifiers() {\n         return PhpModifiers.fromBitMask(constantDeclaration.getModifier());\n     }\n \n+    @CheckForNull\n+    protected static String getConstantValue(Expression expr) {\n+        if (expr instanceof Scalar) {\n+            return ((Scalar) expr).getStringValue();\n+        }\n+        if (expr instanceof UnaryOperation) {\n+            UnaryOperation up = (UnaryOperation) expr;\n+            if (up.getOperator() == UnaryOperation.Operator.MINUS\n+                    && up.getExpression() instanceof Scalar) {\n+                return \"-\" + ((Scalar) up.getExpression()).getStringValue(); //NOI18N\n+            }\n+        }\n+        if (expr instanceof ArrayCreation) {\n+            return getConstantValue((ArrayCreation) expr);\n+        }\n+        return null;\n+    }\n+\n+    private static String getConstantValue(ArrayCreation expr) {\n+        String debug = expr.toString();\n+        StringBuilder sb = new StringBuilder(\"[\"); //NOI18N\n+        Integer displayedElements = 0;\n+        List<ArrayElement> elements = expr.getElements();\n+        for (ArrayElement element : elements) {\n+            if (displayedElements > 0) {\n+                sb.append(\", \"); //NOI18N\n+            }\n+            sb.append(getConstantValue(element));\n+            displayedElements++;\n+            if (sb.length() > ARRAY_CUT_LENGTH) {\n+                break;\n+            }\n+        }\n+        if (displayedElements < elements.size()) {\n+            sb.append(\", ...\"); //NOI18N", "originalCommit": "fc7e43902c3a4e19c07749db96f8a73b6afda4b2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3OTIwNg==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536879206", "bodyText": "@KacerCZ @junichi11\nLet me know what you think about my comment. I am ready to merge. Thanks.", "author": "tmysik", "createdAt": "2020-12-05T19:36:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg5NjI2NA==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536896264", "bodyText": "I prefer to give more space for actual elements.\nMaybe use shorter form ... (+5) or ... (5 more).", "author": "KacerCZ", "createdAt": "2020-12-05T21:31:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkxMjAxMQ==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536912011", "bodyText": "... (5 more) sounds good to me.", "author": "tmysik", "createdAt": "2020-12-05T23:19:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjkzNjYzMQ==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536936631", "bodyText": "Agree with @tmysik", "author": "junichi11", "createdAt": "2020-12-06T02:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk2NzUzMA==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536967530", "bodyText": "I made the change and updated image in description.", "author": "KacerCZ", "createdAt": "2020-12-06T06:19:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk2ODQyMg==", "url": "https://github.com/apache/netbeans/pull/2578#discussion_r536968422", "bodyText": "Great, thanks!", "author": "tmysik", "createdAt": "2020-12-06T06:25:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjg3ODg1MQ=="}], "type": "inlineReview"}, {"oid": "d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "url": "https://github.com/apache/netbeans/commit/d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing.", "committedDate": "2020-12-06T06:12:50Z", "type": "commit"}, {"oid": "d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "url": "https://github.com/apache/netbeans/commit/d139f6d1ab0a833407b75e6e419ea0b75ecd6b5e", "message": "[NETBEANS-5091] PHP - more improvements for constants in code completion\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5091\n\n- Improved display of class constants (previous change affected only global constants).\n- Display more values, not only the first one.\n- Unsupported key or value is displayed as \"?\".\n- Conversion code was moved to parent class (`ClassConstantDeclarationInfo`) and child class (`ConstantDeclarationInfo`) uses the same method.\n- Added new tests and updated existing.", "committedDate": "2020-12-06T06:12:50Z", "type": "forcePushed"}]}