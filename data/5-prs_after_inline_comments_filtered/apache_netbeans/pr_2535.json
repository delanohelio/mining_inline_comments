{"pr_number": 2535, "pr_title": "[NETBEANS-5027] PHP - improved display of array parameter", "pr_createdAt": "2020-11-14T16:00:23Z", "pr_url": "https://github.com/apache/netbeans/pull/2535", "timeline": [{"oid": "8e66bfc02425317763717538e6c6ee092396b6e8", "url": "https://github.com/apache/netbeans/commit/8e66bfc02425317763717538e6c6ee092396b6e8", "message": "[NETBEANS-5027] PHP - improved display of array parameter\n\nhttps://issues.apache.org/jira/browse/NETBEANS-5027\n\nImproves display of array used as default parameter value.\nUses short array format, displays first item in array, indicates more elements in array.", "committedDate": "2020-11-14T15:58:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU2NzA2MA==", "url": "https://github.com/apache/netbeans/pull/2535#discussion_r527567060", "bodyText": "Could you please add a test where the array value is an object? I would like to see how the tooltip will look like in such a case. Thanks!", "author": "tmysik", "createdAt": "2020-11-20T09:38:33Z", "path": "php/php.editor/test/unit/src/org/netbeans/modules/php/editor/CodeUtilsTest.java", "diffHunk": "@@ -179,4 +183,43 @@ public void testCommonNamespacePrefixes11() {\n         assertEquals(0, prefixes.size());\n     }\n \n+    public void testGetParamDefaultValueEmptyArray() {\n+        List<ArrayElement> emptyArray = Collections.emptyList();\n+        FormalParameter param = createFormalParameterWithDefaultArray(emptyArray);\n+        assertEquals(\"[]\", CodeUtils.getParamDefaultValue(param));\n+    }\n+\n+    public void testGetParamDefaultValueArrayOneItem() {\n+        Scalar value = new Scalar(1, 1, \"'a'\", Scalar.Type.STRING);\n+        ArrayElement item = new ArrayElement(1, 1, null, value);\n+        List<ArrayElement> array = Arrays.asList(item);\n+        FormalParameter param = createFormalParameterWithDefaultArray(array);\n+        assertEquals(\"['a']\", CodeUtils.getParamDefaultValue(param));\n+    }\n+\n+    public void testGetParamDefaultValueArrayTwoItems() {\n+        Scalar value1 = new Scalar(1, 1, \"'a'\", Scalar.Type.STRING);\n+        ArrayElement item1 = new ArrayElement(1, 1, null, value1);\n+        Scalar value2 = new Scalar(1, 1, \"'b'\", Scalar.Type.STRING);\n+        ArrayElement item2 = new ArrayElement(1, 1, null, value2);\n+        List<ArrayElement> array = Arrays.asList(item1, item2);\n+        FormalParameter param = createFormalParameterWithDefaultArray(array);\n+        assertEquals(\"['a',...]\", CodeUtils.getParamDefaultValue(param));\n+    }\n+\n+    public void testGetParamDefaultValueArrayItemWithKey() {\n+        Scalar key = new Scalar(1, 1, \"3\", Scalar.Type.INT);\n+        Scalar value = new Scalar(1, 1, \"'a'\", Scalar.Type.STRING);\n+        ArrayElement item = new ArrayElement(1, 1, key, value);\n+        List<ArrayElement> array = Arrays.asList(item);\n+        FormalParameter param = createFormalParameterWithDefaultArray(array);\n+        assertEquals(\"[3 => 'a']\", CodeUtils.getParamDefaultValue(param));\n+    }\n+\n+    private FormalParameter createFormalParameterWithDefaultArray(List<ArrayElement> arrayContent) {\n+        ArrayCreation defaultValue = new ArrayCreation(1, 1, arrayContent, ArrayCreation.Type.NEW);\n+        FormalParameter param = new FormalParameter(1, 1, null, null, defaultValue);\n+        return param;\n+    }\n+", "originalCommit": "8e66bfc02425317763717538e6c6ee092396b6e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzY4MTY4MQ==", "url": "https://github.com/apache/netbeans/pull/2535#discussion_r527681681", "bodyText": "If I understand you correctly you mean this case?\n\nfunction printDate(\\DateTime $date = new \\DateTime()) {}\n\nPHP does not support object as default value.", "author": "KacerCZ", "createdAt": "2020-11-20T13:13:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU2NzA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg3NzA3Mg==", "url": "https://github.com/apache/netbeans/pull/2535#discussion_r527877072", "bodyText": "No. I meant how the tooltip would look like for array e.g. [0 => new DateTime()]. Just to verify that it still looks ok. Thanks and sorry for not being clear.", "author": "tmysik", "createdAt": "2020-11-20T17:59:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU2NzA2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzg3OTc1OQ==", "url": "https://github.com/apache/netbeans/pull/2535#discussion_r527879759", "bodyText": "Ha, sorry, I was too fast, now I see it. It is only about the parameters, not all arrays \"everywhere\".", "author": "tmysik", "createdAt": "2020-11-20T18:02:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU2NzA2MA=="}], "type": "inlineReview"}]}