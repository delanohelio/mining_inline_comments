{"pr_number": 1964, "pr_title": "More stabilization fixes for vanilla indexerer - mostly stabilizing b\u2026", "pr_createdAt": "2020-02-23T08:53:31Z", "pr_url": "https://github.com/apache/netbeans/pull/1964", "timeline": [{"oid": "d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e", "url": "https://github.com/apache/netbeans/commit/d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e", "message": "More stabilization fixes for vanilla indexerer - mostly stabilizing broken annotations.", "committedDate": "2020-02-23T08:50:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzExNDYwOA==", "url": "https://github.com/apache/netbeans/pull/1964#discussion_r383114608", "bodyText": "This appears to be duplicate", "author": "mklaehn", "createdAt": "2020-02-24T07:38:37Z", "path": "java/java.source.base/src/org/netbeans/modules/java/source/indexing/VanillaCompileWorker.java", "diffHunk": "@@ -595,19 +608,56 @@ private void clearAnnotations(SymbolMetadata metadata) {\n                 com.sun.tools.javac.util.List<Attribute.Compound> annotations = metadata.getDeclarationAttributes();\n                 com.sun.tools.javac.util.List<Attribute.Compound> prev = null;\n                 while (annotations.nonEmpty()) {\n-                    if (isErroneous(annotations.head.type)) {\n+                    if (isAnnotationErroneous(annotations.head)) {\n                         if (prev == null) {\n                             metadata.reset();\n                             metadata.setDeclarationAttributes(annotations.tail);\n                         } else {\n                             prev.tail = annotations.tail;\n                         }\n+                    } else {\n+                        prev = annotations;\n                     }\n-                    prev = annotations;\n                     annotations = annotations.tail;\n                 }\n             }\n \n+            private boolean isAnnotationErroneous(Attribute annotation) {\n+                if (isErroneous(annotation.type)) {\n+                    return true;\n+                } else if (annotation instanceof Attribute.Array) {\n+                    for (Attribute nested : ((Attribute.Array) annotation).values) {\n+                        if (isAnnotationErroneous(nested)) {\n+                            return true;\n+                        }\n+                    }\n+                    return false;\n+                } else if (annotation instanceof Attribute.Class) {\n+                    if (isErroneous(((Attribute.Class) annotation).classType)) {\n+                        return true;\n+                    }\n+                    return false;\n+                } else if (annotation instanceof Attribute.Compound) {\n+                    for (Pair<MethodSymbol, Attribute> p : ((Attribute.Compound) annotation).values) {\n+                        if (isAnnotationErroneous(p.snd)) {\n+                            return true;\n+                        }\n+                    }\n+                    return false;\n+                } else if (annotation instanceof Attribute.Constant) {\n+                    return false;\n+                } else if (annotation instanceof Attribute.Enum) {\n+                    return false;\n+                } else if (annotation instanceof Attribute.Enum) {", "originalCommit": "d12baa70bfa30627a0ce70e26dfd1b7c1b967a5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9b9122a993a491290aaf48995de4b8733f6391e0", "url": "https://github.com/apache/netbeans/commit/9b9122a993a491290aaf48995de4b8733f6391e0", "message": "Merge branch 'master' into improving-vanilla-indexer-feb-2020", "committedDate": "2020-02-27T21:03:28Z", "type": "commit"}, {"oid": "a1c714e8d90eb661bec9a26168fdccedf62ebd96", "url": "https://github.com/apache/netbeans/commit/a1c714e8d90eb661bec9a26168fdccedf62ebd96", "message": "Removing duplicated branch, as noted on review.", "committedDate": "2020-02-27T21:05:55Z", "type": "commit"}]}