{"pr_number": 2119, "pr_title": "[NETBEANS-4294] Donation of original AutoSave module to Apache NetBeans", "pr_createdAt": "2020-05-02T00:19:52Z", "pr_url": "https://github.com/apache/netbeans/pull/2119", "timeline": [{"oid": "301398cc9036b9666fa32bb3039bd54db759a4cc", "url": "https://github.com/apache/netbeans/commit/301398cc9036b9666fa32bb3039bd54db759a4cc", "message": "[NETBEANS-4294] Donation of original AutoSave module to Apache NetBeans", "committedDate": "2020-05-02T00:10:38Z", "type": "commit"}, {"oid": "1d2191d0b7f7e7e50c287d99edd2e6256209d008", "url": "https://github.com/apache/netbeans/commit/1d2191d0b7f7e7e50c287d99edd2e6256209d008", "message": "[NETBEANS-4294] Fixed incorrect option section name in module description", "committedDate": "2020-05-02T20:15:15Z", "type": "commit"}, {"oid": "a6f8529fd4597526329192aaba1567240ae045ca", "url": "https://github.com/apache/netbeans/commit/a6f8529fd4597526329192aaba1567240ae045ca", "message": "[NETBEANS-4294] Fixed module versioning and added autosave module as editor.kit dependency as well nbbuild/cluster.properties build pipeline", "committedDate": "2020-05-02T20:16:33Z", "type": "commit"}, {"oid": "ea888c2753101322a82aa792db1052dc1178366b", "url": "https://github.com/apache/netbeans/commit/ea888c2753101322a82aa792db1052dc1178366b", "message": "[NETBEANS-4294] Included license information for form file", "committedDate": "2020-05-02T20:19:54Z", "type": "commit"}, {"oid": "b98728887dc68c106b97487e8a2b9c43e3d0fb39", "url": "https://github.com/apache/netbeans/commit/b98728887dc68c106b97487e8a2b9c43e3d0fb39", "message": "[NETBEANS-4294] Included license information", "committedDate": "2020-05-03T13:19:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTY0Ng==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r426299646", "bodyText": "Is this module loaded (and this installer run) only when the autosave functionality is actually enabled?", "author": "eirikbakke", "createdAt": "2020-05-17T20:09:05Z", "path": "ide/editor.autosave/src/org/netbeans/modules/editor/autosave/Installer.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.autosave;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.prefs.PreferenceChangeListener;\n+import org.netbeans.modules.editor.autosave.command.AutoSaveController;\n+import org.openide.modules.ModuleInstall;\n+\n+public class Installer extends ModuleInstall {", "originalCommit": "b98728887dc68c106b97487e8a2b9c43e3d0fb39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwOTMxMw==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r436409313", "bodyText": "Also instead of the Installer http://bits.netbeans.org/dev/javadoc/org-openide-modules/org/openide/modules/package-summary.html see OnStart and OnStop annotation which could be added to two public static Runnable inner classes in AutoSave controller.", "author": "lkishalmi", "createdAt": "2020-06-07T22:49:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTY0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjI5OTg1Ng==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r426299856", "bodyText": "Is this the right way to add a weak listener? Shouldn't we use WeakListener interface? Or wouldn't it be better to explicitly remove the listener when the module is removed?", "author": "eirikbakke", "createdAt": "2020-05-17T20:11:12Z", "path": "ide/editor.autosave/src/org/netbeans/modules/editor/autosave/Installer.java", "diffHunk": "@@ -0,0 +1,40 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.autosave;\n+\n+import java.lang.ref.WeakReference;\n+import java.util.prefs.PreferenceChangeListener;\n+import org.netbeans.modules.editor.autosave.command.AutoSaveController;\n+import org.openide.modules.ModuleInstall;\n+\n+public class Installer extends ModuleInstall {\n+\n+    @Override\n+    public void restored() {\n+        AutoSaveController.getInstance().synchronize();\n+        AutoSaveController.prefs().\n+                addPreferenceChangeListener(new WeakReference<PreferenceChangeListener>(evt ->", "originalCommit": "b98728887dc68c106b97487e8a2b9c43e3d0fb39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjMwMTA5MQ==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r426301091", "bodyText": "Wait... this just creates a WeakReference instance wrapping the listener, gets the listener, and then immediately throws away the WeakReference?", "author": "eirikbakke", "createdAt": "2020-05-17T20:23:45Z", "path": "ide/editor.autosave/src/org/netbeans/modules/editor/autosave/AutoSavePanel.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.autosave;\n+\n+import java.awt.event.ItemEvent;\n+import java.awt.event.ItemListener;\n+import java.lang.ref.WeakReference;\n+import java.util.prefs.PreferenceChangeEvent;\n+import java.util.prefs.PreferenceChangeListener;\n+import javax.swing.BorderFactory;\n+import javax.swing.GroupLayout;\n+import javax.swing.GroupLayout.Alignment;\n+import javax.swing.JCheckBox;\n+import javax.swing.JLabel;\n+import javax.swing.JSpinner;\n+import javax.swing.LayoutStyle.ComponentPlacement;\n+import javax.swing.SpinnerNumberModel;\n+import org.netbeans.modules.editor.autosave.command.AutoSaveController;\n+import org.openide.awt.Mnemonics;\n+import org.openide.util.NbBundle;\n+\n+final class AutoSavePanel extends javax.swing.JPanel {\n+\n+    AutoSavePanel(final AutoSaveOptionsPanelController controller) {\n+        spnModel = new SpinnerNumberModel(10, 0, 999, 1);\n+\n+        initComponents();\n+\n+        AutoSaveController.prefs().\n+                addPreferenceChangeListener(new WeakReference<PreferenceChangeListener>(evt -> {", "originalCommit": "b98728887dc68c106b97487e8a2b9c43e3d0fb39", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MjIyMw==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r429582223", "bodyText": "Just a question org.openide.LifecycleManager.getDefault().saveAll() might make this class obsolete.", "author": "lkishalmi", "createdAt": "2020-05-23T22:13:36Z", "path": "ide/editor.autosave/src/org/netbeans/modules/editor/autosave/command/AutoSaveCommand.java", "diffHunk": "@@ -0,0 +1,33 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.autosave.command;\n+\n+import org.openide.actions.SaveAllAction;\n+import org.openide.util.actions.SystemAction;\n+\n+/**\n+ *\n+ * @author Michel Graciano\n+ */\n+class AutoSaveCommand {", "originalCommit": "b98728887dc68c106b97487e8a2b9c43e3d0fb39", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTY3NTIzOQ==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r429675239", "bodyText": "Agreed.", "author": "mgraciano", "createdAt": "2020-05-24T21:05:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU4MjIyMw=="}], "type": "inlineReview"}, {"oid": "85060b652888add9383bf33730e6c9ea116ace01", "url": "https://github.com/apache/netbeans/commit/85060b652888add9383bf33730e6c9ea116ace01", "message": "[NETBEANS-4294] . Refactored plugin to remove most of the listeners, wrong WeakReferecnes, opted to use Lifecicle saveall option and refactored the Options dialog as review discussion;\n. Removed all OmegaT related files;\n. Removed help files and translations;", "committedDate": "2020-05-24T21:19:27Z", "type": "commit"}, {"oid": "cd9f252a38440b0140b5668251a78eef3e359eab", "url": "https://github.com/apache/netbeans/commit/cd9f252a38440b0140b5668251a78eef3e359eab", "message": "[NETBEANS-4294] Included licenseinfo for binary image file", "committedDate": "2020-05-24T21:43:54Z", "type": "commit"}, {"oid": "95b920130eed59841f221ddc19a5a5d32c311b3c", "url": "https://github.com/apache/netbeans/commit/95b920130eed59841f221ddc19a5a5d32c311b3c", "message": "[NETBEANS-4294] Removed a generated file and menu item registration (user still can add it to the toolbar if wanted)", "committedDate": "2020-06-07T17:30:01Z", "type": "commit"}, {"oid": "392b3eca974c5ad9f79d601eee75e7900c2a1b08", "url": "https://github.com/apache/netbeans/commit/392b3eca974c5ad9f79d601eee75e7900c2a1b08", "message": "[NETBEANS-4294] Included a 24x24 icon and removed unused import", "committedDate": "2020-06-07T18:06:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwOTQ4MQ==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r436409481", "bodyText": "Shall be declared as a static final constant with //NOI18N at the end.\nAlso it could be annotated with @staticResource", "author": "lkishalmi", "createdAt": "2020-06-07T22:51:32Z", "path": "ide/editor.autosave/src/org/netbeans/modules/editor/autosave/ToggleAutoSaveAction.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.autosave;\n+\n+import java.util.prefs.PreferenceChangeListener;\n+import org.openide.awt.ActionID;\n+import org.openide.awt.ActionRegistration;\n+import org.openide.util.HelpCtx;\n+import org.openide.util.NbBundle;\n+import org.openide.util.actions.BooleanStateAction;\n+\n+@ActionID(id = \"org.netbeans.modules.editor.autosave.ToggleAutoSaveAction\", category = \"Edit\")\n+@ActionRegistration(displayName = \"#CTL_AutoSave\", lazy = false)\n+@NbBundle.Messages(\"CTL_AutoSave=Autosave\")\n+public final class ToggleAutoSaveAction extends BooleanStateAction {\n+\n+    private final PreferenceChangeListener pcl = evt -> setBooleanState(AutoSaveController.prefs()\n+            .getBoolean(AutoSaveController.KEY_ACTIVE, AutoSaveController.KEY_ACTIVE_DEFAULT));\n+\n+    @Override\n+    public String getName() {\n+        return NbBundle.getMessage(ToggleAutoSaveAction.class, \"CTL_AutoSave\");\n+    }\n+\n+    @Override\n+    protected void initialize() {\n+        super.initialize();\n+\n+        AutoSaveController.prefs().addPreferenceChangeListener(pcl);\n+\n+        this.addPropertyChangeListener(evt  -> {\n+            if (BooleanStateAction.PROP_BOOLEAN_STATE.equals(evt.getPropertyName())) {\n+                AutoSaveController.prefs().putBoolean(AutoSaveController.KEY_ACTIVE, getBooleanState());\n+            }\n+        });\n+        this.setBooleanState(AutoSaveController.prefs().getBoolean(AutoSaveController.KEY_ACTIVE,\n+                AutoSaveController.KEY_ACTIVE_DEFAULT));\n+    }\n+\n+    @Override\n+    protected String iconResource() {\n+        return \"org/netbeans/modules/editor/autosave/auto_save.png\";", "originalCommit": "392b3eca974c5ad9f79d601eee75e7900c2a1b08", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTc2MjMzNQ==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r439762335", "bodyText": "Done", "author": "mgraciano", "createdAt": "2020-06-13T19:17:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjQwOTQ4MQ=="}], "type": "inlineReview"}, {"oid": "4d3f1cd3dea5b1e213d3567f24bb8b3800334dc7", "url": "https://github.com/apache/netbeans/commit/4d3f1cd3dea5b1e213d3567f24bb8b3800334dc7", "message": "[NETBEANS-4294] . Removed the installer in favor to OnStart and OnStop option;\n. Adjusted icon definition string;\n. Removed unnecessary help properties still in place;\n. Changed the module to be eager;", "committedDate": "2020-06-13T18:55:50Z", "type": "commit"}, {"oid": "837b24b7edf13c1fa066997bd8220185ed44a6fd", "url": "https://github.com/apache/netbeans/commit/837b24b7edf13c1fa066997bd8220185ed44a6fd", "message": "[NETBEANS-4294] . Reduzed the library version to make possible to install in IDE older versions", "committedDate": "2020-06-13T19:01:29Z", "type": "commit"}, {"oid": "67506b04f327d781a3f67da3b43dd954ae6dd259", "url": "https://github.com/apache/netbeans/commit/67506b04f327d781a3f67da3b43dd954ae6dd259", "message": "[NETBEANS-4294] Fixed description text", "committedDate": "2020-06-14T14:32:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg2ODI4MA==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r439868280", "bodyText": "Shall this be a constant? Anyway it is probably shall be false at first.\nRemember people not using this module any more as they wished to use it. It is loaded by default.\nWe can enable autosave to be turned on  by default after circulating this function with the IDE for a while.Also probably autosave on focus lost should be enabled by default then instead of the timed save.", "author": "lkishalmi", "createdAt": "2020-06-14T21:16:25Z", "path": "ide/editor.autosave/src/org/netbeans/modules/editor/autosave/AutoSaveController.java", "diffHunk": "@@ -0,0 +1,160 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.netbeans.modules.editor.autosave;\n+\n+import java.beans.PropertyChangeListener;\n+import java.io.IOException;\n+import java.util.prefs.Preferences;\n+import javax.swing.Timer;\n+import javax.swing.text.Document;\n+import javax.swing.text.JTextComponent;\n+import org.netbeans.api.editor.EditorRegistry;\n+import org.openide.LifecycleManager;\n+import org.openide.cookies.SaveCookie;\n+import org.openide.loaders.DataObject;\n+import org.openide.modules.OnStart;\n+import org.openide.modules.OnStop;\n+import org.openide.util.Exceptions;\n+import org.openide.util.NbPreferences;\n+\n+/**\n+ *\n+ * @author Michel Graciano\n+ */\n+public final class AutoSaveController {\n+\n+    public static final String KEY_ACTIVE = \"autoSaveActive\";\n+    public static final String KEY_INTERVAL = \"autoSaveInterval\";\n+    public static final String KEY_SAVE_ON_FOCUS_LOST = \"autoSaveOnLostFocus\";\n+\n+    public static final boolean KEY_ACTIVE_DEFAULT = true;", "originalCommit": "67506b04f327d781a3f67da3b43dd954ae6dd259", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk3MzM4Mw==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r440973383", "bodyText": "Will we promote this new feature in the release? If so, I agree with you that it could be disabled by default, since users will know that there is this new feature. If not, maybe it is for the best to keep it enabled by default since it is like a feature to prevent people to lose unsaved work.\nI have no objections with what you requested. I will disable both options by default and push it soon.", "author": "mgraciano", "createdAt": "2020-06-16T16:11:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg2ODI4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Mjg1MDAyNQ==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r442850025", "bodyText": "Well, we won't do an ad campaign on this, however it would get a screenshot and a description on the features page.", "author": "lkishalmi", "createdAt": "2020-06-19T13:46:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg2ODI4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzE1NTU4NA==", "url": "https://github.com/apache/netbeans/pull/2119#discussion_r443155584", "bodyText": "Disabled this feature by default in the latest push.", "author": "mgraciano", "createdAt": "2020-06-20T19:52:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTg2ODI4MA=="}], "type": "inlineReview"}, {"oid": "80ea293385f92974556145c1e3a6719dde7096a9", "url": "https://github.com/apache/netbeans/commit/80ea293385f92974556145c1e3a6719dde7096a9", "message": "[NETBEANS-4294] Changed this feature to be disabled by default and fixed the property name", "committedDate": "2020-06-20T19:51:50Z", "type": "commit"}]}