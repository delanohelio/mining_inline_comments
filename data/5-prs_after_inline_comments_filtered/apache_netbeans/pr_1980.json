{"pr_number": 1980, "pr_title": "[NETBEANS-2446] Use *parent* of saved projectFolder as projectLocation", "pr_createdAt": "2020-02-25T18:38:35Z", "pr_url": "https://github.com/apache/netbeans/pull/1980", "timeline": [{"oid": "7172e2b73cdb5bee33a1da0b6d714bc9c104e3d8", "url": "https://github.com/apache/netbeans/commit/7172e2b73cdb5bee33a1da0b6d714bc9c104e3d8", "message": "[NETBEANS-2446] Use *parent* of saved projectFolder as projectLocation", "committedDate": "2020-02-24T06:31:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwODc0NQ==", "url": "https://github.com/apache/netbeans/pull/1980#discussion_r386608745", "bodyText": "This looks like a contradiction to the name of the property in line 562. Could it be, that the property is set to the wrong value?", "author": "matthiasblaesing", "createdAt": "2020-03-02T19:41:35Z", "path": "java/maven/src/org/netbeans/modules/maven/newproject/BasicPanelVisual.java", "diffHunk": "@@ -562,7 +562,9 @@ void read(WizardDescriptor settings) {\n         File projectLocation = (File) settings.getProperty(CommonProjectActions.PROJECT_PARENT_FOLDER); //NOI18N\n         if (projectLocation == null || projectLocation.getParentFile() == null || !projectLocation.getParentFile().isDirectory()) {\n             projectLocation = ProjectChooser.getProjectsFolder();\n-        } \n+        } else {\n+            projectLocation = projectLocation.getParentFile();", "originalCommit": "926c97ade68be0f867eff9732e35bcb732eab9a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYxMjQ2Mw==", "url": "https://github.com/apache/netbeans/pull/1980#discussion_r386612463", "bodyText": "Answering myself, yes this is broken (in BasicPanelVisual#store):\n        String name = projectNameTextField.getText().trim();\n        String folder = createdFolderTextField.getText().trim();\n        final File parentFolder = new File(folder);\n        \n        d.putProperty(CommonProjectActions.PROJECT_PARENT_FOLDER, parentFolder);\nI would rename parentFolder to targetFolder and change the last line to d.putProperty(CommonProjectActions.PROJECT_PARENT_FOLDER, targetFolder.getParentFile());. But that is untested.", "author": "matthiasblaesing", "createdAt": "2020-03-02T19:49:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwODc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjY1MTc5OA==", "url": "https://github.com/apache/netbeans/pull/1980#discussion_r386651798", "bodyText": "The naming caused me considerable confusion.\nNote that your suggestion d.putProperty(\"projdir\", folder.getParentFile()) produces different and incorrect results. The String value of the property name ...PROJECT_PARENT_FOLDER is \"projdir\"; and in older areas of code is a literal string rather than a define. Your suggestion, save folder.getParentFile() as property value was actually my first attempt to fix this. Things got weird and changes started radiating; reverted that attempt. The property \"projdir\" is globally used by the wizard infrastructure and it means the base directory of the new project and not the parent directory of the newly created project directory.\nAfter a circuitous route, I decided to find the the screen for a plain old java project. It is\njava/java.j2seproject/src/org/netbeans/modules/java/j2seproject/ui/wizards/PanelProjectLocationVisual.java\nand it uses the same names and has similar code to its maven counterpart. (Undoubtedly the prototype for this screen)\nSo, while it's tempting to rename things so they make sense. I am hesitant to diverge from the original code. BTW, in the code you quote from the store() method, renaming the variable parentFolder to projectDirectory would be accurate. Then when the two lines are restored it would be like saying projectLocation = projectDirectory.getParentFile(). It could have read like that, but the original code was probably avoiding declaring new variables. Note that in the code in read() projectLocation = ProjectChooser.getProjectsFolder() retrieves the default value for where to put new projects the other branch of the \"if\" statement is working with the value of \"projdir\" and does [\"projdir\"].getParentFile().", "author": "errael", "createdAt": "2020-03-02T21:10:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwODc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzIxMDgzOQ==", "url": "https://github.com/apache/netbeans/pull/1980#discussion_r387210839", "bodyText": "Ok - I might be wrong, but this is awfully lot text to say, that the project parent folder is not the project parent folder. We should at least try to get this straight, there might be more people like me, that read variables and think that they hold what they say. Sorry I can't say this without less irony.", "author": "matthiasblaesing", "createdAt": "2020-03-03T18:29:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwODc0NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyNTM0Mg==", "url": "https://github.com/apache/netbeans/pull/1980#discussion_r387325342", "bodyText": "I'm itching to clean this up, glad you brought it up again. Yes, verbose; just saying 123 != 123 seemed inadequate. And I want to record the situation so I don't have to reconstruct it again. It does seem that simply restoring two lines that were mistakenly removed is consistent with a minimal diff philosophy.\nPROJECT_PARENT_FOLDER should be renamed, maybe PROJECT_BASE_FOLDER (or just PROJECT_FOLDER); but that's an API change. PARENT could be deprecated in favor of BASE.\nHow abut this one? (keeping it local)", "author": "errael", "createdAt": "2020-03-03T22:11:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjYwODc0NQ=="}], "type": "inlineReview"}]}