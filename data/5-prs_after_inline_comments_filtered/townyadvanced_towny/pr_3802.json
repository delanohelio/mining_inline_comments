{"pr_number": 3802, "pr_title": "Small cleanup and microperformance changes.", "pr_createdAt": "2020-03-19T22:53:09Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/3802", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg1OTk3Nw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395859977", "bodyText": "Should probably be this if the casting isn't needed to work. Have you tested this?\n\t\t\t} else { // So it's not from the sender, then it's from the receiver so\n\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n\t\t\t\tif (invite.getReceiver() instanceof Resident) {\n\t\t\t\t\tobject = TownySettings.getLangString(\"town_sing\");\n\t\t\t\t}\n\t\t\t\tif (invite.getReceiver() instanceof Town || invite.getReceiver() instanceof Nation) {\n\t\t\t\t\tobject = TownySettings.getLangString(\"nation_sing\");\n\t\t\t\t}\n\t\t\t}", "author": "LlmDl", "createdAt": "2020-03-20T19:54:18Z", "path": "src/com/palmergames/bukkit/towny/command/InviteCommand.java", "diffHunk": "@@ -309,15 +309,15 @@ public static void sendInviteList(Player player, List<Invite> list, int page, bo\n \t\t\t\t}\n \t\t\t} else { // So it's not from the sender, then it's from the receiver so\n \t\t\t\tif (invite.getReceiver() instanceof Resident) {\n-\t\t\t\t\toutput = Colors.Blue + ((Town) invite.getSender()).getName() + Colors.Gray + \" - \" + Colors.Green + name;\n+\t\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n \t\t\t\t\tobject = TownySettings.getLangString(\"town_sing\");\n \t\t\t\t}\n \t\t\t\tif (invite.getReceiver() instanceof Town) {\n-\t\t\t\t\toutput = Colors.Blue + ((Nation) invite.getSender()).getName() + Colors.Gray + \" - \" + Colors.Green + name;\n+\t\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n \t\t\t\t\tobject = TownySettings.getLangString(\"nation_sing\");\n \t\t\t\t}\n \t\t\t\tif (invite.getReceiver() instanceof Nation) {\n-\t\t\t\t\toutput = Colors.Blue + ((Nation) invite.getSender()).getName() + Colors.Gray + \" - \" + Colors.Green + name;\n+\t\t\t\t\toutput = Colors.Blue + invite.getSender().getName() + Colors.Gray + \" - \" + Colors.Green + name;\n \t\t\t\t\tobject = TownySettings.getLangString(\"nation_sing\");\n \t\t\t\t}", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2MDQ3MQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395860471", "bodyText": "This \\ wasn't doing anything?", "author": "LlmDl", "createdAt": "2020-03-20T19:55:26Z", "path": "src/com/palmergames/bukkit/towny/db/TownySQLSource.java", "diffHunk": "@@ -435,7 +435,7 @@ public boolean QueueDeleteDB(String tb_name, HashMap<String, Object> args) {\n                 Map.Entry<String, Object> me = i.next();\n                 wherecode.append(\"`\").append(me.getKey()).append(\"` = \");\n                 if (me.getValue() instanceof String)\n-                    wherecode.append(\"'\").append(((String) me.getValue()).replace(\"'\", \"\\''\")).append(\"'\");\n+                    wherecode.append(\"'\").append(((String) me.getValue()).replace(\"'\", \"''\")).append(\"'\");", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYyNjMyMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r396626320", "bodyText": "You only need to escape ' when you are using it in a Character definition, this is a String definition, e.g. you need to escape like this: '\\'' to get the Character ' , but in a String you need to escape like this: \"\\\"\" to get a \".", "author": "Articdive", "createdAt": "2020-03-23T17:27:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2MDQ3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTYxMQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395865611", "bodyText": "Wondering if this needs the ints to keep whole numbers. Have you tested the regeneration of blocks?", "author": "LlmDl", "createdAt": "2020-03-20T20:06:49Z", "path": "src/com/palmergames/bukkit/towny/regen/PlotBlockData.java", "diffHunk": "@@ -122,8 +122,8 @@ public boolean restoreNextBlock() {\n \t\twhile (reverse > 0) {\r\n \t\t\treverse--; //regen bottom up to stand a better chance of restoring tree's and plants.\r\n \t\t\ty = height - (reverse % height);\r\n-\t\t\tx = (int) (reverse / height) % size;\r\n-\t\t\tz = ((int) (reverse / height) / size) % size;\r\n+\t\t\tx = (reverse / height) % size;\r\n+\t\t\tz = (reverse / height / size) % size;\r", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzOTQ5Ng==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395939496", "bodyText": "This is fine since modulus cannot return anything but an integer.\nThese statements are essentially\n(int / int) % int)", "author": "silverwolfg11", "createdAt": "2020-03-21T00:14:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTkwOA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395865908", "bodyText": "Was this tested?", "author": "LlmDl", "createdAt": "2020-03-20T20:07:36Z", "path": "src/com/palmergames/bukkit/towny/utils/CombatUtil.java", "diffHunk": "@@ -138,7 +138,7 @@ public static boolean preventDamageCall(Towny plugin, TownyWorld world, Entity a\n \t\t\t * The target is in a TownBlock and...\n \t\t\t * the target is a tame wolf and we are not it's owner\n \t\t\t */\n-\t\t\tif ((defendingPlayer != null) || ((defenderTB != null) && ((defendingEntity instanceof Wolf) && ((Wolf) defendingEntity).isTamed() && !((Wolf) defendingEntity).getOwner().equals((AnimalTamer) attackingEntity)))) {\n+\t\t\tif ((defendingPlayer != null) || ((defenderTB != null) && ((defendingEntity instanceof Wolf) && ((Wolf) defendingEntity).isTamed() && !((Wolf) defendingEntity).getOwner().equals(attackingEntity)))) {", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzMDgzMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r396630830", "bodyText": "The Object stays the same, the equals call does an == anyway, since OfflinePlayer does not nor do any of the interfaces of Player override equals().", "author": "Articdive", "createdAt": "2020-03-23T17:33:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NTkwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NjIzNw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395866237", "bodyText": "I'm assuming this was an IDE thing?", "author": "LlmDl", "createdAt": "2020-03-20T20:08:29Z", "path": "src/com/palmergames/util/TimeMgmt.java", "diffHunk": "@@ -52,12 +52,12 @@ public static String formatCountdownTime(long l) {\n \r\n \t\tString out = \"\";\r\n \t\tif (l >= 3600) {\r\n-\t\t\tint h = (int) Math.floor(l / 3600);\r\n+\t\t\tint h = (int) Math.floor(l / 3600.0);\r\n \t\t\tout = h + TownySettings.getLangString(\"msg_hours\");\r\n \t\t\tl -= h * 3600;\r\n \t\t}\r\n \t\tif (l >= 60) {\r\n-\t\t\tint m = (int) Math.floor(l / 60);\r\n+\t\t\tint m = (int) Math.floor(l / 60.0);\r", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkzODkwMw==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395938903", "bodyText": "Math.floor() in this context isn't necessary at all. Doing something like (int) (l / 60) will automatically truncate the int which is basically flooring it.\nTo prove this, here's a little simple, but seemingly infinite test code:\nfor (long l = 0; l < Long.MAX_VALUE; ++l) {\n    int f = (int) Math.floor(l / 3600.0);\n    int t = (int) (l / 3600);\n    if (f != t) {\n        System.out.println(\"Comparison Inequality\");\n        break;\n    }\n}\nhint: it doesn't output anything.", "author": "silverwolfg11", "createdAt": "2020-03-21T00:10:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NjIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTIxOQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395941219", "bodyText": "I know this was out of scope, but can be replaced with iMax = Math.min(page *10, nations.size());\nSame for TownCommand.", "author": "silverwolfg11", "createdAt": "2020-03-21T00:26:11Z", "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -1250,7 +1250,7 @@ public void sendList(CommandSender sender, List<Nation> nations, int page, int t\n \t\tif ((page * 10) > nations.size()) {\r\n \t\t\tiMax = nations.size();\r\n \t\t}\r", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTM0Mg==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r395941342", "bodyText": "For micro-performance, you could set the initial capacity to iMax - (10*page) + 10", "author": "silverwolfg11", "createdAt": "2020-03-21T00:27:14Z", "path": "src/com/palmergames/bukkit/towny/command/NationCommand.java", "diffHunk": "@@ -1250,7 +1250,7 @@ public void sendList(CommandSender sender, List<Nation> nations, int page, int t\n \t\tif ((page * 10) > nations.size()) {\r\n \t\t\tiMax = nations.size();\r\n \t\t}\r\n-\t\tList<String> nationsordered = new ArrayList();\r\n+\t\tList<String> nationsordered = new ArrayList<>();\r", "originalCommit": "6f49d1ccc3b5683d7652931083b44052ddb0942d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzNDM2NQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/3802#discussion_r396634365", "bodyText": "Can't we set the initialCapacity to 10?\niMax = page*10 (it can at most be this),\ncapacity = iMax - (10*page) + 10\ncapacity = (10*page) - (10*page) + 10\ncapacity = 10.\nIn the general case, this might be quicker than always subtracting for the edge case of there being less than 10 towns (then iMax would be < page*10 and not = page*10).", "author": "Articdive", "createdAt": "2020-03-23T17:39:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk0MTM0Mg=="}], "type": "inlineReview"}, {"oid": "0f52ea27271880a2dbb7561af0cc3bad00087471", "url": "https://github.com/TownyAdvanced/Towny/commit/0f52ea27271880a2dbb7561af0cc3bad00087471", "message": "Small cleanup and microperformance changes.\n\nSigned-off-by: Articdive <13535885+Articdive@users.noreply.github.com>", "committedDate": "2020-03-23T17:20:47Z", "type": "commit"}, {"oid": "0f52ea27271880a2dbb7561af0cc3bad00087471", "url": "https://github.com/TownyAdvanced/Towny/commit/0f52ea27271880a2dbb7561af0cc3bad00087471", "message": "Small cleanup and microperformance changes.\n\nSigned-off-by: Articdive <13535885+Articdive@users.noreply.github.com>", "committedDate": "2020-03-23T17:20:47Z", "type": "forcePushed"}, {"oid": "cc233c5ba8ef6e9c58d05ce42a813d680535de39", "url": "https://github.com/TownyAdvanced/Towny/commit/cc233c5ba8ef6e9c58d05ce42a813d680535de39", "message": "More cleanup and microperformance changes.\n\nSigned-off-by: Articdive <13535885+Articdive@users.noreply.github.com>", "committedDate": "2020-03-23T19:31:38Z", "type": "commit"}, {"oid": "cc233c5ba8ef6e9c58d05ce42a813d680535de39", "url": "https://github.com/TownyAdvanced/Towny/commit/cc233c5ba8ef6e9c58d05ce42a813d680535de39", "message": "More cleanup and microperformance changes.\n\nSigned-off-by: Articdive <13535885+Articdive@users.noreply.github.com>", "committedDate": "2020-03-23T19:31:38Z", "type": "forcePushed"}, {"oid": "ca4908d727b952d9de08401f0d41bf7344f13eaf", "url": "https://github.com/TownyAdvanced/Towny/commit/ca4908d727b952d9de08401f0d41bf7344f13eaf", "message": "Merge branch 'master' of https://github.com/TownyAdvanced/Towny into cleanup\n\n\u0001 Conflicts:\n\u0001\tsrc/com/palmergames/bukkit/towny/command/NationCommand.java\n\u0001\tsrc/com/palmergames/bukkit/towny/command/TownCommand.java", "committedDate": "2020-03-31T08:00:44Z", "type": "commit"}]}