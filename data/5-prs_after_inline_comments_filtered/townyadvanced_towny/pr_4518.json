{"pr_number": 4518, "pr_title": "Cleanup Town Ruin code - Javadoc and other changes.", "pr_createdAt": "2020-12-03T14:52:56Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4518", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1MzI1MQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535353251", "bodyText": "If I'm not mistaken this will result in the msg_reclaim_available message being show in situations where getTownsRuinsReclaimEnabled is not true...", "author": "LlmDl", "createdAt": "2020-12-03T15:48:53Z", "path": "src/com/palmergames/bukkit/towny/TownyFormatter.java", "diffHunk": "@@ -378,11 +378,12 @@ private static void getRanks(Town town, List<String> ranklist) {\n \r\n \t\tif (town.isRuined()) {\r\n \t\t\tout.add(Translation.of(\"msg_time_remaining_before_full_removal\", TownRuinSettings.getTownRuinsMaxDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()) {\r\n-\t\t\t\tif (TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours())\r\n-\t\t\t\t\tout.add(Translation.of(\"msg_time_until_reclaim_available\", TownRuinSettings.getTownRuinsMinDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\t\telse \r\n-\t\t\t\t\tout.add(Translation.of(\"msg_reclaim_available\"));\r\n+\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()\r\n+\t\t\t\t\t&& TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours()) {\r\n+\t\t\t\tout.add(Translation.of(\"msg_time_until_reclaim_available\", TownRuinSettings.getTownRuinsMinDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n+\t\t\t}\r\n+\t\t\telse {\r\n+\t\t\t\tout.add(Translation.of(\"msg_reclaim_available\"));\r", "originalCommit": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM3ODQwNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535378405", "bodyText": "Ah, yeah... This one is human error on my part. Linter never complained about this one. Should be resolved with next commit.", "author": "TheFlagCourier", "createdAt": "2020-12-03T16:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1MzI1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1NTIwOA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535355208", "bodyText": "Because the getTown() is hidden behind a hasTown() we know we can ignore this.", "author": "LlmDl", "createdAt": "2020-12-03T15:50:38Z", "path": "src/com/palmergames/bukkit/towny/war/common/townruin/TownRuinUtil.java", "diffHunk": "@@ -47,7 +50,9 @@ public static boolean isPlayersTownRuined(Player player) {\n \t\t\tif(resident.hasTown() && resident.getTown().isRuined())\n \t\t\t\treturn true;\n \t\t\t\n-\t\t} catch (NotRegisteredException ignored) {}\n+\t\t} catch (NotRegisteredException ignored) {\n+\t\t\t// Ignored - Maybe add to a debug logger later?", "originalCommit": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4NTU5NQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535385595", "bodyText": "While this is true, there's also the possibility of getResident() throwing the NotRegisteredException. As this is a public method, it's accessible to other plugins, so actually giving them something to work with is probably the better course of action, is it not?", "author": "TheFlagCourier", "createdAt": "2020-12-03T16:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1NTIwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM5NDAxOA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535394018", "bodyText": "That's valid, I believe this would also end up being sorted out with @silverwolfg11 's resident UUID map PR as well, depending on what was accepted first.", "author": "LlmDl", "createdAt": "2020-12-03T16:39:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1NTIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1OTEyNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535359125", "bodyText": "Please re-add the TODO: on this, so that it gets dealt with later on.", "author": "LlmDl", "createdAt": "2020-12-03T15:55:15Z", "path": "src/com/palmergames/bukkit/towny/war/common/townruin/TownRuinUtil.java", "diffHunk": "@@ -160,10 +157,17 @@ public static void processRuinedTownReclaimRequest(Player player, Towny plugin)\n \t\t\tBukkit.getPluginManager().callEvent(event);\n \n \t\t\tTownyMessaging.sendGlobalMessage(Translation.of(\"msg_town_reclaimed\", resident.getName(), town.getName()));\n-\t\t} catch (TownyException e) {\n+\t\t} catch (TownyException | EconomyException e) {\n \t\t\tTownyMessaging.sendErrorMsg(player,e.getMessage());\n-\t\t} catch (EconomyException ex) {\n-\t\t\tTownyMessaging.sendErrorMsg(player,ex.getMessage());\n+\t\t}\n+\t}\n+\n+\tprivate static void setMayor(Towny plugin, Town town, String name) {\n+\t\ttry {", "originalCommit": "9c1f072cd0cfa7f9b5b1dbba29a2037fad0be412", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM4NjI3Mw==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535386273", "bodyText": "Will do.", "author": "TheFlagCourier", "createdAt": "2020-12-03T16:29:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM1OTEyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM5NDczMA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535394730", "bodyText": "This can be replaced by the master branch entirely now.", "author": "LlmDl", "createdAt": "2020-12-03T16:40:05Z", "path": "src/com/palmergames/bukkit/towny/TownyFormatter.java", "diffHunk": "@@ -378,11 +378,13 @@ private static void getRanks(Town town, List<String> ranklist) {\n \r\n \t\tif (town.isRuined()) {\r\n \t\t\tout.add(Translation.of(\"msg_time_remaining_before_full_removal\", TownRuinSettings.getTownRuinsMaxDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()) {\r\n-\t\t\t\tif (TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours())\r\n+\t\t\tif (TownRuinSettings.getTownRuinsReclaimEnabled()){\r\n+\t\t\t\tif (TownRuinUtil.getTimeSinceRuining(town) < TownRuinSettings.getTownRuinsMinDurationHours()) {\r\n \t\t\t\t\tout.add(Translation.of(\"msg_time_until_reclaim_available\", TownRuinSettings.getTownRuinsMinDurationHours() - TownRuinUtil.getTimeSinceRuining(town)));\r\n-\t\t\t\telse \r\n+\t\t\t\t}\r\n+\t\t\t\telse {\r\n \t\t\t\t\tout.add(Translation.of(\"msg_reclaim_available\"));\r\n+\t\t\t\t}\r", "originalCommit": "cda64d79e357f32a42d79ea749a682a11cd0475b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTQwNzk4MA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4518#discussion_r535407980", "bodyText": "Ah, yeah.", "author": "TheFlagCourier", "createdAt": "2020-12-03T16:54:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNTM5NDczMA=="}], "type": "inlineReview"}, {"oid": "865d497fe249ae4b25e5fbed6ff964abb0bd6709", "url": "https://github.com/TownyAdvanced/Towny/commit/865d497fe249ae4b25e5fbed6ff964abb0bd6709", "message": "Cleanup Town Ruin Code, amended.\n\nUnwraps previous commits to not even touch TownyFormatter.\n\nPrevious commits: Cleanup Town Ruin Code, amended.\nMade the Javadoc plugin and my IDE linter happy.\n\nFixes/Cleans:\n- Added missing Javadoc parameters\n- Methodized setMayor(), as it was duplicated between both methods (~~Removes TODO statement.~~) Also removed duplicate (inaccurate) inline comment for one of the callers.\n- Collapsed exceptions with identical output\n- Collapsed if() statement with common output.\n- Added a null-check in OnPlayerLogin task where isRuined() is called.", "committedDate": "2020-12-03T16:52:58Z", "type": "forcePushed"}, {"oid": "704cf358362d5f0fef362433abfdb56042ab124f", "url": "https://github.com/TownyAdvanced/Towny/commit/704cf358362d5f0fef362433abfdb56042ab124f", "message": "Cleanup Town Ruin Code, amended.\n\nUnwraps previous commits to not even touch TownyFormatter.\n\nPrevious commits: Cleanup Town Ruin Code, amended.\nMade the Javadoc plugin and my IDE linter happy.\n\nFixes/Cleans:\n- Added missing Javadoc parameters\n- Methodized setMayor(), as it was duplicated between both methods (~~Removes TODO statement.~~) Also removed duplicate (inaccurate) inline comment for one of the callers.\n- Collapsed exceptions with identical output\n- Collapsed if() statement with common output.\n- Added a null-check in OnPlayerLogin task where isRuined() is called.", "committedDate": "2020-12-04T04:44:21Z", "type": "commit"}, {"oid": "704cf358362d5f0fef362433abfdb56042ab124f", "url": "https://github.com/TownyAdvanced/Towny/commit/704cf358362d5f0fef362433abfdb56042ab124f", "message": "Cleanup Town Ruin Code, amended.\n\nUnwraps previous commits to not even touch TownyFormatter.\n\nPrevious commits: Cleanup Town Ruin Code, amended.\nMade the Javadoc plugin and my IDE linter happy.\n\nFixes/Cleans:\n- Added missing Javadoc parameters\n- Methodized setMayor(), as it was duplicated between both methods (~~Removes TODO statement.~~) Also removed duplicate (inaccurate) inline comment for one of the callers.\n- Collapsed exceptions with identical output\n- Collapsed if() statement with common output.\n- Added a null-check in OnPlayerLogin task where isRuined() is called.", "committedDate": "2020-12-04T04:44:21Z", "type": "forcePushed"}]}