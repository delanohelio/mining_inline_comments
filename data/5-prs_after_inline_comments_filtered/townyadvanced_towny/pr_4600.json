{"pr_number": 4600, "pr_title": "Implemented New Plot Events", "pr_createdAt": "2020-12-16T20:11:54Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4600", "timeline": [{"oid": "71799e30b4a0ed7e3265798e58eaf30172e19d13", "url": "https://github.com/TownyAdvanced/Towny/commit/71799e30b4a0ed7e3265798e58eaf30172e19d13", "message": "Implemented New Plot Events", "committedDate": "2020-12-16T20:10:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYyOTkyNg==", "url": "https://github.com/TownyAdvanced/Towny/pull/4600#discussion_r544629926", "bodyText": "revert whitespacing change", "author": "LlmDl", "createdAt": "2020-12-16T21:18:35Z", "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -1111,11 +1115,17 @@ public void plotToggle(Player player, TownBlock townBlock, String[] split) {\n \t\t\t\t\t// Prevent plot pvp from being enabled if admin pvp is disabled\r\n \t\t\t\t\tif (townBlock.getTown().isAdminDisabledPVP() && !townBlock.getPermissions().pvp)\r\n \t\t\t\t\t\tthrow new TownyException(Translation.of(\"msg_err_admin_controlled_pvp_prevents_you_from_changing_pvp\", \"adminDisabledPVP\", \"on\"));\r\n-\t\t\t\t\t\r\n+\r", "originalCommit": "71799e30b4a0ed7e3265798e58eaf30172e19d13", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYyOTk5MA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4600#discussion_r544629990", "bodyText": "revert whitespacing change", "author": "LlmDl", "createdAt": "2020-12-16T21:18:42Z", "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -1125,20 +1135,40 @@ public void plotToggle(Player player, TownBlock townBlock, String[] split) {\n \t\t\t\t} else if (split[0].equalsIgnoreCase(\"explosion\")) {\r\n \t\t\t\t\t// Make sure we are allowed to set these permissions.\r\n \t\t\t\t\ttoggleTest(player, townBlock, StringMgmt.join(split, \" \"));\r\n+\r\n+\t\t\t\t\tPlotToggleExplosionEvent plotToggleExplosionEvent = new PlotToggleExplosionEvent(townBlock.getTown(), player, choice.orElse(!townBlock.getPermissions().explosion));\r\n+\t\t\t\t\tBukkit.getPluginManager().callEvent(plotToggleExplosionEvent);\r\n+\t\t\t\t\tif (plotToggleExplosionEvent.isCancelled()){\r\n+\t\t\t\t\t\treturn;\r\n+\t\t\t\t\t}\r\n+\r\n \t\t\t\t\ttownBlock.getPermissions().explosion = choice.orElse(!townBlock.getPermissions().explosion);\r\n \t\t\t\t\tTownyMessaging.sendMessage(player, Translation.of(\"msg_changed_expl\", \"the Plot\", townBlock.getPermissions().explosion ? Translation.of(\"enabled\") : Translation.of(\"disabled\")));\r\n \r\n \t\t\t\t} else if (split[0].equalsIgnoreCase(\"fire\")) {\r\n \t\t\t\t\t// Make sure we are allowed to set these permissions.\r\n \t\t\t\t\ttoggleTest(player, townBlock, StringMgmt.join(split, \" \"));\r\n+\r\n+\t\t\t\t\tPlotToggleFireEvent plotToggleFireEvent = new PlotToggleFireEvent(townBlock.getTown(), player, choice.orElse(!townBlock.getPermissions().fire));\r\n+\t\t\t\t\tBukkit.getPluginManager().callEvent(plotToggleFireEvent);\r\n+\t\t\t\t\tif (plotToggleFireEvent.isCancelled()){\r\n+\t\t\t\t\t\treturn;\r\n+\t\t\t\t\t}\r\n+\r\n \t\t\t\t\ttownBlock.getPermissions().fire = choice.orElse(!townBlock.getPermissions().fire);\r\n \t\t\t\t\tTownyMessaging.sendMessage(player, Translation.of(\"msg_changed_fire\", \"the Plot\", townBlock.getPermissions().fire ? Translation.of(\"enabled\") : Translation.of(\"disabled\")));\r\n \r\n \t\t\t\t} else if (split[0].equalsIgnoreCase(\"mobs\")) {\r\n \t\t\t\t\t// Make sure we are allowed to set these permissions.\r\n \t\t\t\t\ttoggleTest(player, townBlock, StringMgmt.join(split, \" \"));\r\n+\r\n+\t\t\t\t\tPlotToggleMobsEvent plotToggleMobsEvent= new PlotToggleMobsEvent(townBlock.getTown(), player, choice.orElse(!townBlock.getPermissions().mobs));\r\n+\t\t\t\t\tBukkit.getPluginManager().callEvent(plotToggleMobsEvent);\r\n+\t\t\t\t\tif (plotToggleMobsEvent.isCancelled()){\r\n+\t\t\t\t\t\treturn;\r\n+\t\t\t\t\t}\r\n+\r\n \t\t\t\t\ttownBlock.getPermissions().mobs = choice.orElse(!townBlock.getPermissions().mobs);\r\n-\t\t\t\t\t\r", "originalCommit": "71799e30b4a0ed7e3265798e58eaf30172e19d13", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDYzMDAzNA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4600#discussion_r544630034", "bodyText": "revert whitespacing change", "author": "LlmDl", "createdAt": "2020-12-16T21:18:47Z", "path": "src/com/palmergames/bukkit/towny/command/PlotCommand.java", "diffHunk": "@@ -1155,7 +1185,7 @@ public void plotToggle(Player player, TownBlock townBlock, String[] split) {\n \t\t\t} catch (Exception e) {\r\n \t\t\t\tTownyMessaging.sendErrorMsg(player, e.getMessage());\r\n \t\t\t}\r\n-\t\t\t\r\n+\r", "originalCommit": "71799e30b4a0ed7e3265798e58eaf30172e19d13", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f76416a521be58bb2984393bbb0cdd16231d8ce0", "url": "https://github.com/TownyAdvanced/Towny/commit/f76416a521be58bb2984393bbb0cdd16231d8ce0", "message": "Revert \"Implemented New Plot Events\"\n\nThis reverts commit 71799e30", "committedDate": "2020-12-16T21:44:26Z", "type": "commit"}, {"oid": "62a6380cb6e9c80c504db8fdb52f2b1d4daff30e", "url": "https://github.com/TownyAdvanced/Towny/commit/62a6380cb6e9c80c504db8fdb52f2b1d4daff30e", "message": "Implemented New Plot Events", "committedDate": "2020-12-16T21:52:05Z", "type": "commit"}, {"oid": "952fe0d0133f482fde7a58a0fed5016ffa9c46d8", "url": "https://github.com/TownyAdvanced/Towny/commit/952fe0d0133f482fde7a58a0fed5016ffa9c46d8", "message": "Revert \"Implemented New Plot Events\"\n\nThis reverts commit 62a6380c", "committedDate": "2020-12-16T21:54:15Z", "type": "commit"}, {"oid": "25d921989ede623b1cd05dcfddd08f5ad82a40c8", "url": "https://github.com/TownyAdvanced/Towny/commit/25d921989ede623b1cd05dcfddd08f5ad82a40c8", "message": "Implemented New Plot Events", "committedDate": "2020-12-16T21:57:21Z", "type": "commit"}, {"oid": "284f95276bc4d0f898f8da3bd7a5126f167cf57a", "url": "https://github.com/TownyAdvanced/Towny/commit/284f95276bc4d0f898f8da3bd7a5126f167cf57a", "message": "Revert \"Implemented New Plot Events\"\n\nThis reverts commit 25d92198", "committedDate": "2020-12-16T21:58:28Z", "type": "commit"}, {"oid": "f5b8211cf3d11f7ad6de0eadfadaafe1e694d1f5", "url": "https://github.com/TownyAdvanced/Towny/commit/f5b8211cf3d11f7ad6de0eadfadaafe1e694d1f5", "message": "Implemented New Plot Events", "committedDate": "2020-12-16T22:04:08Z", "type": "commit"}, {"oid": "5810393c56b0bf956c2a2fe4ac1961cf2d8d6044", "url": "https://github.com/TownyAdvanced/Towny/commit/5810393c56b0bf956c2a2fe4ac1961cf2d8d6044", "message": "Revert \"Implemented New Plot Events\"\n\nThis reverts commit f5b8211c", "committedDate": "2020-12-16T22:32:38Z", "type": "commit"}, {"oid": "4dbeaa6712b3a5bc3c4129fa679977c39329e1a6", "url": "https://github.com/TownyAdvanced/Towny/commit/4dbeaa6712b3a5bc3c4129fa679977c39329e1a6", "message": "Revert Implemented New Plot Events", "committedDate": "2020-12-16T22:44:07Z", "type": "commit"}, {"oid": "c6c29a2d4cc2afea1c8ff1eae34a52afd1c6efdd", "url": "https://github.com/TownyAdvanced/Towny/commit/c6c29a2d4cc2afea1c8ff1eae34a52afd1c6efdd", "message": "Implemented New Plot Events", "committedDate": "2020-12-16T22:47:24Z", "type": "commit"}]}