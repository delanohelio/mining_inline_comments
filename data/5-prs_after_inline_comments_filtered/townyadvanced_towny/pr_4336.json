{"pr_number": 4336, "pr_title": "Add discrete toggling to the following commands:", "pr_createdAt": "2020-09-24T22:31:42Z", "pr_url": "https://github.com/TownyAdvanced/Towny/pull/4336", "timeline": [{"oid": "1fb59240821bb5564f40d6c1afce0df5ee1a1e5c", "url": "https://github.com/TownyAdvanced/Towny/commit/1fb59240821bb5564f40d6c1afce0df5ee1a1e5c", "message": "Add discrete toggling to the following commands:\n- /resident toggle\n- /plot toggle\n- /nation toggle\n- /town toggle\n- /townyadmin toggle\n- /townyadmin town toggle\n- /townyadmin nation toggle\n- /townyworld {world} toggle", "committedDate": "2020-09-24T22:37:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxNjA4Ng==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r495216086", "bodyText": "I don't think this needs to be public static. All command classes should extend BaseCommand so this can just be protected.", "author": "silverwolfg11", "createdAt": "2020-09-25T20:29:34Z", "path": "src/com/palmergames/bukkit/towny/command/BaseCommand.java", "diffHunk": "@@ -174,4 +174,15 @@\n \t\t\treturn Collections.emptyList();\r\n \t\t}\r\n \t}\r\n+\r\n+\t/**\r\n+\t * Parses the given string into a boolean choice.\r\n+\t * @param str The string to parse\r\n+\t * @return true for \"ON\", false for \"OFF\", or null if no match.\r\n+\t */\r\n+\tpublic static Boolean parseToggleChoice(String str) {\r", "originalCommit": "1fb59240821bb5564f40d6c1afce0df5ee1a1e5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxOTA2Mg==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r495219062", "bodyText": "Also this is totally optional, but you can return Boolean.TRUE and Boolean.FALSE to remove any autoboxing.\nAm not the biggest fan of returning null for primitives, since it's very easy to hit an NPE that way. Alternatively this could accept a default value and resort to the default if it doesn't match.", "author": "silverwolfg11", "createdAt": "2020-09-25T20:36:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxNjA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTI5NjM5NA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r495296394", "bodyText": "The thing is kinda, we use this method as a tri state boolean, if the boolean is set (true/false), use that as the choice for the toggle and if the boolean is null, we will default back to the old behaviour.", "author": "FrankHeijden", "createdAt": "2020-09-25T22:52:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxNjA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTYxNjM1OQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r495616359", "bodyText": "I have replaced the Boolean value with an Optional of type Boolean, so that it's clear to the user who calls this method the result might be null.", "author": "FrankHeijden", "createdAt": "2020-09-27T21:07:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTIxNjA4Ng=="}], "type": "inlineReview"}, {"oid": "9a4bbb937d0f1627d4ef9be6cbb691738a242769", "url": "https://github.com/TownyAdvanced/Towny/commit/9a4bbb937d0f1627d4ef9be6cbb691738a242769", "message": "Remove autoboxing & change modifier of BaseCommand#parseToggleChoice to protected", "committedDate": "2020-09-25T22:54:02Z", "type": "commit"}, {"oid": "858b89384bb64ea6f92ae7635c9d056c4b8c8980", "url": "https://github.com/TownyAdvanced/Towny/commit/858b89384bb64ea6f92ae7635c9d056c4b8c8980", "message": "Merge branch 'master' into feature/discrete-toggles\n\n# Conflicts:\n#\tsrc/com/palmergames/bukkit/towny/command/TownCommand.java", "committedDate": "2020-09-27T20:31:26Z", "type": "commit"}, {"oid": "a97b2cccb8297296f209b632d92b09772ff12638", "url": "https://github.com/TownyAdvanced/Towny/commit/a97b2cccb8297296f209b632d92b09772ff12638", "message": "Use Optional to clearly distinguish between null values", "committedDate": "2020-09-27T21:34:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg5NTMwOA==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r501895308", "bodyText": "This new residentToggleChoices option isn't needed. All of the existing residentToggleTabCompletes are things that can (and probably should) toggled on/off with the new discrete toggling.", "author": "LlmDl", "createdAt": "2020-10-08T17:36:10Z", "path": "src/com/palmergames/bukkit/towny/command/ResidentCommand.java", "diffHunk": "@@ -132,6 +140,8 @@ public boolean onCommand(CommandSender sender, Command cmd, String commandLabel,\n \t\t\t\tcase \"toggle\":\r\n \t\t\t\t\tif (args.length == 2) {\r\n \t\t\t\t\t\treturn NameUtil.filterByStart(residentToggleTabCompletes, args[1]);\r\n+\t\t\t\t\t} else if (args.length == 3 && residentToggleChoices.contains(args[1].toLowerCase())) {\r\n+\t\t\t\t\t\treturn NameUtil.filterByStart(BaseCommand.setOnOffCompletes, args[2]);\r", "originalCommit": "a97b2cccb8297296f209b632d92b09772ff12638", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTkzOTI2NQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r501939265", "bodyText": "I did this change because for the ones who aren't in the residentToggleChoices array, we expect a \"mode\" value, not an on/off value; this is displayed here:\nhttps://github.com/FrankHeijden/Towny/blob/feature/discrete-toggles/src/com/palmergames/bukkit/towny/command/ResidentCommand.java#L427\nWhich points to here:\nhttps://github.com/FrankHeijden/Towny/blob/feature/discrete-toggles/src/com/palmergames/bukkit/towny/object/Resident.java#L537\nIn that last method, I thought we shouldn't have on/off's there.", "author": "FrankHeijden", "createdAt": "2020-10-08T18:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg5NTMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTk2MjA3OQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r501962079", "bodyText": "Yeah it's a bit confused by the way it was originally done. Before there was any /res toggle all the modes were set using /res set mode but later on (since all modes are just on/offs) they were moved to being accessible via /res toggle' (while still having the original /res set mode`.)\nIdeally all of the modes would have on|off as options through /res toggle but it might be a bit more work to accomplish this. (ex /res toggle townclaim on|off)", "author": "LlmDl", "createdAt": "2020-10-08T19:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg5NTMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjUzMjQzNQ==", "url": "https://github.com/TownyAdvanced/Towny/pull/4336#discussion_r506532435", "bodyText": "Done! Sorry for the holdup, the behaviour for this section is now a bit more dynamic:\n/res toggle townclaim\n/res toggle townclaim on|off ignoreplots\n/res toggle townclaim ignoreplots on|off\nAll of the above commands are valid, if the user didn't specify on|off after a mode, the mode will be toggled (old behaviour).", "author": "FrankHeijden", "createdAt": "2020-10-16T15:14:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTg5NTMwOA=="}], "type": "inlineReview"}, {"oid": "073aa5a32f5a14086900faf880b7a0d20905621f", "url": "https://github.com/TownyAdvanced/Towny/commit/073aa5a32f5a14086900faf880b7a0d20905621f", "message": "Merge branch 'master' into feature/discrete-toggles\n\n# Conflicts:\n#\tsrc/com/palmergames/bukkit/towny/command/TownyWorldCommand.java", "committedDate": "2020-10-16T14:26:45Z", "type": "commit"}, {"oid": "e4507f5f30f2362d8c0d57109a75eceebc1c6d6c", "url": "https://github.com/TownyAdvanced/Towny/commit/e4507f5f30f2362d8c0d57109a75eceebc1c6d6c", "message": "Add discrete toggles for Resident toggle modes", "committedDate": "2020-10-16T15:10:31Z", "type": "commit"}, {"oid": "f2d19cbe75b32169e5fa0f322d5b8494db0c3920", "url": "https://github.com/TownyAdvanced/Towny/commit/f2d19cbe75b32169e5fa0f322d5b8494db0c3920", "message": "Move new language strings to end of lang file & undo whitespace change.", "committedDate": "2020-10-19T22:11:19Z", "type": "commit"}]}