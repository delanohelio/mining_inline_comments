{"pr_number": 1841, "pr_title": "set Charset as 'UTF-8' when posting data to elasticsearch", "pr_createdAt": "2020-03-23T08:39:09Z", "pr_url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841", "timeline": [{"oid": "2be3106735d443639045b696f2356b596ef7c0ce", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/2be3106735d443639045b696f2356b596ef7c0ce", "message": "set Charset as 'UTF-8' when posting data to elasticsearch", "committedDate": "2020-03-23T07:50:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNDkyMg==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396304922", "bodyText": "Leftover comment? In that case, it should be removed.", "author": "fgalan", "createdAt": "2020-03-23T09:15:30Z", "path": "cygnus-common/src/test/java/com/telefonica/iot/cygnus/backends/elasticsearch/ElasticsearchBackendImplTest.java", "diffHunk": "@@ -149,17 +157,18 @@ public void testBulkInsert_woData() {\n         public void testBulkInsert_oneData() {\n             System.out.println(getTestTraceHead(String.format(\"[ElasticsearchBackendImplTest.bulkInsert OK, TLS=%b, Data=1]\", flag)));\n \n+            System.out.println(String.format(\"%s, %b, %s\", schema, flag, msg));\n             List<Map<String, String>> data = new ArrayList<Map<String, String>>();\n             data.add(new HashMap<String, String>(){\n                 {\n                     put(\"recvTimeTs\", \"test_recvTimeTs_1\");\n-                    put(\"data\", \"{\\\"message\\\": \\\"test data 1\\\"}\");\n+                    put(\"data\", msg);\n                 }\n             });\n-            String recvTimeTs1Hash = \"599F4FB6AFDB1BEF51126B47DAC2696F\";\n+            // String recvTimeTs1Hash = \"599F4FB6AFDB1BEF51126B47DAC2696F\";", "originalCommit": "2be3106735d443639045b696f2356b596ef7c0ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNTY3NA==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396305674", "bodyText": "I'm sorry, this is my mistake. I'll remove this line and re-send pull request soon.", "author": "nmatsui", "createdAt": "2020-03-23T09:16:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNDkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM1MDI1MQ==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396350251", "bodyText": "... and re-send pull request soon.\n\nJust to clarify, you could use the same PR, no need of re-sending a new PR. Just commit the fix to the PR branch (and put a \"Fixed in <commithash>\" mark below this comment to resolve it). Thanks!", "author": "fgalan", "createdAt": "2020-03-23T10:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNDkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM1MjU5Nw==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396352597", "bodyText": "Fixed in 7a6730e", "author": "fgalan", "createdAt": "2020-03-23T10:34:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNDkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNjQ5NA==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396306494", "bodyText": "An entry to CHANGES_NEXT_RELEASE file, briefly describing the modifications in this PR and referencing the issue number, should be included. Please have a look to existing CHANGES_NEXT_RELEASE file to see the style we use.", "author": "fgalan", "createdAt": "2020-03-23T09:18:11Z", "path": "cygnus-common/src/main/java/com/telefonica/iot/cygnus/backends/elasticsearch/ElasticsearchBackendImpl.java", "diffHunk": "@@ -25,9 +25,9 @@\n import com.telefonica.iot.cygnus.errors.CygnusPersistenceError;", "originalCommit": "2be3106735d443639045b696f2356b596ef7c0ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM1MjczMA==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396352730", "bodyText": "Fixed in 5101c07", "author": "fgalan", "createdAt": "2020-03-23T10:35:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjMwNjQ5NA=="}], "type": "inlineReview"}, {"oid": "7a6730ec79b7176ae25ae0beea4dd4690fad57be", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/7a6730ec79b7176ae25ae0beea4dd4690fad57be", "message": "remove unnecessary lines", "committedDate": "2020-03-23T09:26:24Z", "type": "commit"}, {"oid": "5101c079eebb49aab8b8627ce40612661d1b0e0a", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/5101c079eebb49aab8b8627ce40612661d1b0e0a", "message": "Update CHANGES_NEXT_RELEASE for fix/1839_elasticsearch_charset", "committedDate": "2020-03-23T10:01:49Z", "type": "commit"}, {"oid": "b225d3a1b09b7bfc6406a1d594d5298d7f248d46", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/b225d3a1b09b7bfc6406a1d594d5298d7f248d46", "message": "Merge master to fix/1839_elasticsearch_charset", "committedDate": "2020-03-23T10:09:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NTgxNQ==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396395815", "bodyText": "\"UTF-8\" should be declared as a String, so that if anytime another content-type is supported it would be easyer to modify it.", "author": "IvanHdzC", "createdAt": "2020-03-23T11:54:02Z", "path": "cygnus-common/src/main/java/com/telefonica/iot/cygnus/backends/elasticsearch/ElasticsearchBackendImpl.java", "diffHunk": "@@ -117,10 +117,10 @@ public JsonResponse bulkInsert(String index, String type, List<Map<String, Strin\n                 jsonLines += String.format(\"{\\\"index\\\":{\\\"_id\\\":\\\"%s-%s\\\"}}\\n\", erecvTimeTs, hash);\n                 jsonLines += String.format(\"%s\\n\", edata);\n             } // for\n-            entity = new StringEntity(jsonLines);\n+            entity = new StringEntity(jsonLines, Charset.forName(\"UTF-8\"));", "originalCommit": "b225d3a1b09b7bfc6406a1d594d5298d7f248d46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njg0MTgxMA==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r396841810", "bodyText": "@IvanHdzC Thank you for your advice. That's right, I think. I'll try to get 'content_type' as a configuration parameter.", "author": "nmatsui", "createdAt": "2020-03-24T00:43:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NTgxNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzA4MzMyMA==", "url": "https://github.com/telefonicaid/fiware-cygnus/pull/1841#discussion_r397083320", "bodyText": "Great! Please don't forget to update your branch.", "author": "IvanHdzC", "createdAt": "2020-03-24T11:30:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjM5NTgxNQ=="}], "type": "inlineReview"}, {"oid": "a29929ac555f3ecaefa361bf64381ba6e5cc5ac8", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/a29929ac555f3ecaefa361bf64381ba6e5cc5ac8", "message": "accept the 'charset' parameter and use it to define the encoding of 'org.apache.http.entity.StringEntity'", "committedDate": "2020-03-25T08:25:34Z", "type": "commit"}, {"oid": "8fc121de5afa6f4fb1126101a2ca9d028477e053", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/8fc121de5afa6f4fb1126101a2ca9d028477e053", "message": "update Dockerfile and configuration files used in docker container", "committedDate": "2020-03-25T08:41:18Z", "type": "commit"}, {"oid": "3f3832d7c49ac1b3677fb8fbe64170ccaf623160", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/3f3832d7c49ac1b3677fb8fbe64170ccaf623160", "message": "updated some documents to explain the  parameter", "committedDate": "2020-03-25T09:30:56Z", "type": "commit"}, {"oid": "9580f461a645b90b5605a947d83fe207741f835f", "url": "https://github.com/telefonicaid/fiware-cygnus/commit/9580f461a645b90b5605a947d83fe207741f835f", "message": "Merge master to fix/1839_elasticsearch_charset", "committedDate": "2020-03-25T09:40:33Z", "type": "commit"}]}