{"pr_number": 279, "pr_title": "Emit warnings for deprecated traits", "pr_createdAt": "2020-02-19T18:46:37Z", "pr_url": "https://github.com/awslabs/smithy/pull/279", "timeline": [{"oid": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "url": "https://github.com/awslabs/smithy/commit/9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "message": "Emit warnings for deprecated traits", "committedDate": "2020-02-19T18:45:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381473148", "bodyText": "hasTrait?", "author": "mtdowling", "createdAt": "2020-02-19T18:48:07Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())", "originalCommit": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMjUwNw==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381602507", "bodyText": "Not sure what the question is on this one.", "author": "srchase", "createdAt": "2020-02-19T23:15:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjA2MQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606061", "bodyText": "I suggest you use hasTrait, not isPresent.", "author": "mtdowling", "createdAt": "2020-02-19T23:25:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMDc2Mw==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381630763", "bodyText": "Fixed.", "author": "srchase", "createdAt": "2020-02-20T00:46:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3MzE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDA5OQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381474099", "bodyText": "For consistency, we usually wrap shape IDs in backticks.\nI'd how the entire shape ID, not just the name.", "author": "mtdowling", "createdAt": "2020-02-19T18:49:54Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+\n+        return model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(deprecatedTrait -> warning(deprecatedTrait, format(\"The %s trait is deprecated.\",", "originalCommit": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMTU0Mw==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381601543", "bodyText": "Fixed in ea47f36\n\n\nThe entire warning is prefixed with the shape ID.", "author": "srchase", "createdAt": "2020-02-19T23:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NDA5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTgyOQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381475829", "bodyText": "This isn't actually detecting when a trait that's marked as deprecated is applied to a shape.\nYou probably need to first get a set of all the shape IDs that are both traits and deprected. Then you would need to emit validation events for every shape that uses any of the deprecated shape IDs.", "author": "mtdowling", "createdAt": "2020-02-19T18:52:56Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.List;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains a trait that has been marked as deprecated.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {", "originalCommit": "9a23747c31d4ac817cc8f0bb1aad9e68500e4490", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwMTk0Mw==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381601943", "bodyText": "Fixed in ea47f36", "author": "srchase", "createdAt": "2020-02-19T23:13:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTQ3NTgyOQ=="}], "type": "inlineReview"}, {"oid": "934de90a7cabc37ea91f371ec24d399d8b6c8276", "url": "https://github.com/awslabs/smithy/commit/934de90a7cabc37ea91f371ec24d399d8b6c8276", "message": "Emit on shapes with deprecated traits", "committedDate": "2020-02-19T23:15:59Z", "type": "forcePushed"}, {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "url": "https://github.com/awslabs/smithy/commit/ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "message": "Emit on shapes with deprecated traits", "committedDate": "2020-02-19T23:17:07Z", "type": "commit"}, {"oid": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "url": "https://github.com/awslabs/smithy/commit/ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "message": "Emit on shapes with deprecated traits", "committedDate": "2020-02-19T23:17:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjUwMA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606500", "bodyText": "Why filter this here? I think the use of a deprecated trait on any shape is useful.", "author": "mtdowling", "createdAt": "2020-02-19T23:26:47Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))", "originalCommit": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMDg1MQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381630851", "bodyText": "Removed this filtering.  Now validating all shapes.", "author": "srchase", "createdAt": "2020-02-20T00:47:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjczOA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381606738", "bodyText": "I'd just use a for loop here. It'll make this code easier to read, and you're already mutating a list in the stream.", "author": "mtdowling", "createdAt": "2020-02-19T23:27:30Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))", "originalCommit": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMDk3MA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381630970", "bodyText": "Fixed.", "author": "srchase", "createdAt": "2020-02-20T00:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNjczOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNzUyOA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381607528", "bodyText": "Don't use .getName(). Show the entire shape ID. Also, you don't need to include the shape ID of the affected shape in the message since that's already part of the validation event. Maybe just say: \"This shape applies a trait that is deprecated: X\". You should probably also include the deprecation message of the @deprecated trait if one is defined.", "author": "mtdowling", "createdAt": "2020-02-19T23:29:50Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.getTrait(DeprecatedTrait.class).isPresent())\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .filter(shape -> !shape.hasTrait(TraitDefinition.class))\n+                .flatMap(nonTraitShape -> validateShape(nonTraitShape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().keySet().stream().filter(trait -> deprecatedTraits.contains(trait.toShapeId()))\n+                .map(boundDeprecatedTrait -> warning(shape, format(\"Shape `%s` uses deprecated trait: %s\",\n+                        shape.getId().getName(), boundDeprecatedTrait.getName())))", "originalCommit": "ea47f366e419ad8f3f9a8821923e8ac47a866ea4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzMTEzMA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381631130", "bodyText": "Added message if present on @deprecated trait.", "author": "srchase", "createdAt": "2020-02-20T00:47:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYwNzUyOA=="}], "type": "inlineReview"}, {"oid": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "url": "https://github.com/awslabs/smithy/commit/204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "message": "Include message if present", "committedDate": "2020-02-20T00:45:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNDc4Mg==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381634782", "bodyText": "No need to use .get() here. Use expectTrait(DeprecatedTrait.class).\nDeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class)", "author": "mtdowling", "createdAt": "2020-02-20T01:00:53Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)", "originalCommit": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwMjA1NQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382102055", "bodyText": "Fixed.", "author": "srchase", "createdAt": "2020-02-20T16:11:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNDc4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTEzOQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381635139", "bodyText": "Nit: with code like this, you can bail early and remove some nesting:\nif (!deprecatedTraits.contains(trait.toShapeId()) {\n    continue;\n}", "author": "mtdowling", "createdAt": "2020-02-20T01:02:17Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {", "originalCommit": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjEwMTgzNg==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382101836", "bodyText": "Fixed with return", "author": "srchase", "createdAt": "2020-02-20T16:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTEzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTYzNTY2Ng==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r381635666", "bodyText": "This should be relative to the trait that was applied to the shape. You can do this by passing then trait in as the second argument.\nevents.add(warning(shape, trait, format(...", "author": "mtdowling", "createdAt": "2020-02-20T01:04:22Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (deprecatedTraits.contains(trait.toShapeId())) {\n+                DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).getTrait(DeprecatedTrait.class)\n+                        .get();\n+                String traitMessage = trait.toShapeId().toString();\n+                if (deprecatedTrait.getMessage().isPresent()) {\n+                    traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());\n+                }\n+                events.add(warning(shape, format(\"This shape applies a trait that is deprecated: %s\", traitMessage)));", "originalCommit": "204cea2f0f50bf783e1ff4a4c2ac05a3640089e7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0cd7347f7856626787d65683da88585ffc37c0c", "url": "https://github.com/awslabs/smithy/commit/f0cd7347f7856626787d65683da88585ffc37c0c", "message": "Refactor, return early", "committedDate": "2020-02-20T16:11:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0Njk1Mg==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382146952", "bodyText": "nit: Using concat is odd", "author": "mtdowling", "createdAt": "2020-02-20T17:26:35Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()\n+                .filter(shape -> shape.hasTrait(TraitDefinition.class))\n+                .filter(trait -> trait.hasTrait(DeprecatedTrait.class))\n+                .map(Shape::getId)\n+                .collect(Collectors.toSet());\n+\n+        return model.shapes()\n+                .flatMap(shape -> validateShape(model, shape, deprecatedTraits).stream())\n+                .collect(Collectors.toList());\n+    }\n+\n+    private List<ValidationEvent> validateShape(Model model, Shape shape, Set<ShapeId> deprecatedTraits) {\n+        List<ValidationEvent> events = new ArrayList<>();\n+        shape.getAllTraits().forEach((shapeId, trait) -> {\n+            if (!deprecatedTraits.contains(trait.toShapeId())) {\n+                return;\n+            }\n+            DeprecatedTrait deprecatedTrait = model.expectShape(trait.toShapeId()).expectTrait(DeprecatedTrait.class);\n+            String traitMessage = trait.toShapeId().toString();\n+            if (deprecatedTrait.getMessage().isPresent()) {\n+                traitMessage = traitMessage.concat(\", \" + deprecatedTrait.getMessage().get());", "originalCommit": "f0cd7347f7856626787d65683da88585ffc37c0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE4MDA4MA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382180080", "bodyText": "Fixed.", "author": "srchase", "createdAt": "2020-02-20T18:30:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0Njk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NzIyMQ==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382147221", "bodyText": "Just remembered that we have https://github.com/awslabs/smithy/blob/master/smithy-model/src/main/java/software/amazon/smithy/model/Model.java#L178, which should probably be used to reduce the duplicated effort of finding these trait shapes in the model.", "author": "mtdowling", "createdAt": "2020-02-20T17:27:06Z", "path": "smithy-linters/src/main/java/software/amazon/smithy/linters/DeprecatedTraitsValidator.java", "diffHunk": "@@ -0,0 +1,73 @@\n+/*\n+ * Copyright 2019 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.linters;\n+\n+import static java.lang.String.format;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Set;\n+import java.util.stream.Collectors;\n+import software.amazon.smithy.model.Model;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.traits.DeprecatedTrait;\n+import software.amazon.smithy.model.traits.TraitDefinition;\n+import software.amazon.smithy.model.validation.AbstractValidator;\n+import software.amazon.smithy.model.validation.ValidationEvent;\n+import software.amazon.smithy.model.validation.ValidatorService;\n+\n+/**\n+ * Emits a validation event if a model contains shapes that are bound to deprecated traits.\n+ */\n+public final class DeprecatedTraitsValidator extends AbstractValidator {\n+\n+    public static final class Provider extends ValidatorService.Provider {\n+        public Provider() {\n+            super(DeprecatedTraitsValidator.class, DeprecatedTraitsValidator::new);\n+        }\n+    }\n+\n+    @Override\n+    public List<ValidationEvent> validate(Model model) {\n+        Set<ShapeId> deprecatedTraits = model.shapes()", "originalCommit": "f0cd7347f7856626787d65683da88585ffc37c0c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE3OTkwOA==", "url": "https://github.com/awslabs/smithy/pull/279#discussion_r382179908", "bodyText": "Thanks. Swapped to getTraitShapes.", "author": "srchase", "createdAt": "2020-02-20T18:29:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0NzIyMQ=="}], "type": "inlineReview"}, {"oid": "23110bcb368b98e5fee0d2fecff9110133a611b2", "url": "https://github.com/awslabs/smithy/commit/23110bcb368b98e5fee0d2fecff9110133a611b2", "message": "Move to model validation", "committedDate": "2020-02-20T18:28:54Z", "type": "commit"}]}