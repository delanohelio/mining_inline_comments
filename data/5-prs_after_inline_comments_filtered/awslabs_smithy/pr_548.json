{"pr_number": 548, "pr_title": "Tracefile creation rebased", "pr_createdAt": "2020-08-31T20:28:52Z", "pr_url": "https://github.com/awslabs/smithy/pull/548", "timeline": [{"oid": "77c8936ccc61d4cc8b2ec372dbf992b6a8d45421", "url": "https://github.com/awslabs/smithy/commit/77c8936ccc61d4cc8b2ec372dbf992b6a8d45421", "message": "Add TracingSymbolProvider", "committedDate": "2020-08-31T21:26:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM3NjQ3Ng==", "url": "https://github.com/awslabs/smithy/pull/548#discussion_r481376476", "bodyText": "nit: add space after //, capitalize first word and end with period.", "author": "srchase", "createdAt": "2020-09-01T19:19:53Z", "path": "smithy-codegen-core/src/test/java/software/amazon/smithy/codegen/core/trace/TracingSymbolProviderTest.java", "diffHunk": "@@ -0,0 +1,161 @@\n+package software.amazon.smithy.codegen.core.trace;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.BiFunction;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import software.amazon.smithy.codegen.core.Symbol;\n+import software.amazon.smithy.codegen.core.SymbolProvider;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.shapes.StringShape;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+class TracingSymbolProviderTest {\n+\n+    @Test\n+    void assertBuildDoesNotThrowWithAllFields() {\n+        Assertions.assertDoesNotThrow(() -> {\n+            TracingSymbolProvider.builder()\n+                    .metadata(constructTraceMetadata())\n+                    .artifactDefinitions(constructArtifactDefinitions())\n+                    .symbolProvider(new TestSymbolProvider())\n+                    .shapeLinkCreator(constructFunction())\n+                    .build();\n+        });\n+    }\n+\n+    @Test\n+    void assertBuildDoesNotThrowWithRequiredFields() {\n+        Assertions.assertDoesNotThrow(() -> {\n+            TracingSymbolProvider.builder()\n+                    .metadata(constructTraceMetadata())\n+                    .symbolProvider(new TestSymbolProvider())\n+                    .shapeLinkCreator(constructFunction())\n+                    .build();\n+        });\n+    }\n+\n+    @Test\n+    void assertBuildDoesNotThrowWithDefaultTraceMetadata() {\n+        Assertions.assertDoesNotThrow(() -> {\n+            TracingSymbolProvider.builder()\n+                    .setTraceMetadataAsDefault(\"Java\")\n+                    .symbolProvider(new TestSymbolProvider())\n+                    .shapeLinkCreator(constructFunction())\n+                    .build();\n+        });\n+    }\n+\n+    @Test\n+    void assertBuildFailsWithoutSymbolProvider() {\n+        Assertions.assertThrows(IllegalStateException.class, () -> TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .shapeLinkCreator(constructFunction())\n+                .build()\n+        );\n+    }\n+\n+    @Test\n+    void assertBuildFailsWithoutTraceMetadata() {\n+        Assertions.assertThrows(IllegalStateException.class, () -> TracingSymbolProvider.builder()\n+                .symbolProvider(new TestSymbolProvider())\n+                .shapeLinkCreator(constructFunction())\n+                .build()\n+        );\n+    }\n+\n+    @Test\n+    void assertBuildFailsWithoutShapeLinkCreator() {\n+        Assertions.assertThrows(IllegalStateException.class, () -> TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .symbolProvider(new TestSymbolProvider())\n+                .build()\n+        );\n+    }\n+\n+    @Test\n+    void assertToSymbolShapeLinkCreatorCreatesShapeLink() {\n+        TracingSymbolProvider tracingSymbolProvider = TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .artifactDefinitions(constructArtifactDefinitions())\n+                .symbolProvider(new TestSymbolProvider())\n+                .shapeLinkCreator(constructFunction())\n+                .build();\n+\n+        Shape shape = StringShape.builder().id(\"namespace.foo#baz\").build();\n+\n+        Symbol symbol = tracingSymbolProvider.toSymbol(shape);\n+\n+        TraceFile traceFile = tracingSymbolProvider.buildTraceFile();\n+\n+        ShapeLink createdShapeLink = traceFile.getShapes().get(ShapeId.from(\"namespace.foo#baz\")).get(0);\n+\n+        assertThat(createdShapeLink.getType(), equalTo(\"TYPE\"));\n+        assertThat(createdShapeLink.getId(), equalTo(symbol.toString()));\n+    }\n+\n+    @Test\n+    void assertToSymbolDoesNotDuplicateShapeLinks() {\n+        TracingSymbolProvider tracingSymbolProvider = TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .artifactDefinitions(constructArtifactDefinitions())\n+                .symbolProvider(new TestSymbolProvider())\n+                .shapeLinkCreator(constructFunction())\n+                .build();\n+\n+        Shape shape = StringShape.builder().id(\"namespace.foo#baz\").build();\n+\n+        //call toSymbol twice to make sure the ShapeId is not added twice", "originalCommit": "77c8936ccc61d4cc8b2ec372dbf992b6a8d45421", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTM3NjU1Mg==", "url": "https://github.com/awslabs/smithy/pull/548#discussion_r481376552", "bodyText": "nit: add space after //, capitalize first word and end with period.", "author": "srchase", "createdAt": "2020-09-01T19:20:01Z", "path": "smithy-codegen-core/src/test/java/software/amazon/smithy/codegen/core/trace/TracingSymbolProviderTest.java", "diffHunk": "@@ -0,0 +1,161 @@\n+package software.amazon.smithy.codegen.core.trace;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.function.BiFunction;\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+import software.amazon.smithy.codegen.core.Symbol;\n+import software.amazon.smithy.codegen.core.SymbolProvider;\n+import software.amazon.smithy.model.shapes.Shape;\n+import software.amazon.smithy.model.shapes.ShapeId;\n+import software.amazon.smithy.model.shapes.StringShape;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+class TracingSymbolProviderTest {\n+\n+    @Test\n+    void assertBuildDoesNotThrowWithAllFields() {\n+        Assertions.assertDoesNotThrow(() -> {\n+            TracingSymbolProvider.builder()\n+                    .metadata(constructTraceMetadata())\n+                    .artifactDefinitions(constructArtifactDefinitions())\n+                    .symbolProvider(new TestSymbolProvider())\n+                    .shapeLinkCreator(constructFunction())\n+                    .build();\n+        });\n+    }\n+\n+    @Test\n+    void assertBuildDoesNotThrowWithRequiredFields() {\n+        Assertions.assertDoesNotThrow(() -> {\n+            TracingSymbolProvider.builder()\n+                    .metadata(constructTraceMetadata())\n+                    .symbolProvider(new TestSymbolProvider())\n+                    .shapeLinkCreator(constructFunction())\n+                    .build();\n+        });\n+    }\n+\n+    @Test\n+    void assertBuildDoesNotThrowWithDefaultTraceMetadata() {\n+        Assertions.assertDoesNotThrow(() -> {\n+            TracingSymbolProvider.builder()\n+                    .setTraceMetadataAsDefault(\"Java\")\n+                    .symbolProvider(new TestSymbolProvider())\n+                    .shapeLinkCreator(constructFunction())\n+                    .build();\n+        });\n+    }\n+\n+    @Test\n+    void assertBuildFailsWithoutSymbolProvider() {\n+        Assertions.assertThrows(IllegalStateException.class, () -> TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .shapeLinkCreator(constructFunction())\n+                .build()\n+        );\n+    }\n+\n+    @Test\n+    void assertBuildFailsWithoutTraceMetadata() {\n+        Assertions.assertThrows(IllegalStateException.class, () -> TracingSymbolProvider.builder()\n+                .symbolProvider(new TestSymbolProvider())\n+                .shapeLinkCreator(constructFunction())\n+                .build()\n+        );\n+    }\n+\n+    @Test\n+    void assertBuildFailsWithoutShapeLinkCreator() {\n+        Assertions.assertThrows(IllegalStateException.class, () -> TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .symbolProvider(new TestSymbolProvider())\n+                .build()\n+        );\n+    }\n+\n+    @Test\n+    void assertToSymbolShapeLinkCreatorCreatesShapeLink() {\n+        TracingSymbolProvider tracingSymbolProvider = TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .artifactDefinitions(constructArtifactDefinitions())\n+                .symbolProvider(new TestSymbolProvider())\n+                .shapeLinkCreator(constructFunction())\n+                .build();\n+\n+        Shape shape = StringShape.builder().id(\"namespace.foo#baz\").build();\n+\n+        Symbol symbol = tracingSymbolProvider.toSymbol(shape);\n+\n+        TraceFile traceFile = tracingSymbolProvider.buildTraceFile();\n+\n+        ShapeLink createdShapeLink = traceFile.getShapes().get(ShapeId.from(\"namespace.foo#baz\")).get(0);\n+\n+        assertThat(createdShapeLink.getType(), equalTo(\"TYPE\"));\n+        assertThat(createdShapeLink.getId(), equalTo(symbol.toString()));\n+    }\n+\n+    @Test\n+    void assertToSymbolDoesNotDuplicateShapeLinks() {\n+        TracingSymbolProvider tracingSymbolProvider = TracingSymbolProvider.builder()\n+                .metadata(constructTraceMetadata())\n+                .artifactDefinitions(constructArtifactDefinitions())\n+                .symbolProvider(new TestSymbolProvider())\n+                .shapeLinkCreator(constructFunction())\n+                .build();\n+\n+        Shape shape = StringShape.builder().id(\"namespace.foo#baz\").build();\n+\n+        //call toSymbol twice to make sure the ShapeId is not added twice\n+        tracingSymbolProvider.toSymbol(shape);\n+        tracingSymbolProvider.toSymbol(shape);\n+\n+        TraceFile traceFile = tracingSymbolProvider.buildTraceFile();\n+\n+        assertThat(traceFile.getShapes().get(ShapeId.from(\"namespace.foo#baz\")).size(), equalTo(1));\n+    }\n+\n+    ArtifactDefinitions constructArtifactDefinitions() {\n+        return ArtifactDefinitions.builder()\n+                .addTag(\"service\", \"Service client\")\n+                .addType(\"TYPE\", \"Class, interface (including annotation type), or enum declaration\")\n+                .build();\n+    }\n+\n+    TraceMetadata constructTraceMetadata() {\n+        return TraceMetadata.builder()\n+                .id(\"software.amazon.awssdk.services:snowball:2.10.79\")\n+                .version(\"2.10.79\")\n+                .type(\"Java\")\n+                .setTimestampAsNow()\n+                .build();\n+    }\n+\n+    BiFunction<Shape, Symbol, List<ShapeLink>> constructFunction() {\n+        return (shape, symbol) -> {\n+            List<ShapeLink> list = new ArrayList<>();\n+            list.add(ShapeLink.builder()\n+                    .id(symbol.toString())\n+                    .type(\"TYPE\")\n+                    .build());\n+            return list;\n+        };\n+    }\n+\n+    //test class that substitutes for language-specific symbol provider", "originalCommit": "77c8936ccc61d4cc8b2ec372dbf992b6a8d45421", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "98b180f0e4df29e54a67f59bd0330268f4643c41", "url": "https://github.com/awslabs/smithy/commit/98b180f0e4df29e54a67f59bd0330268f4643c41", "message": "Add TracingSymbolProvider", "committedDate": "2020-09-01T19:24:29Z", "type": "commit"}, {"oid": "98b180f0e4df29e54a67f59bd0330268f4643c41", "url": "https://github.com/awslabs/smithy/commit/98b180f0e4df29e54a67f59bd0330268f4643c41", "message": "Add TracingSymbolProvider", "committedDate": "2020-09-01T19:24:29Z", "type": "forcePushed"}]}