{"pr_number": 539, "pr_title": "Add :topdown selector to match hierarchically", "pr_createdAt": "2020-08-23T03:36:05Z", "pr_url": "https://github.com/awslabs/smithy/pull/539", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODc2NzYxMQ==", "url": "https://github.com/awslabs/smithy/pull/539#discussion_r478767611", "bodyText": "Nit: rm .", "author": "kstich", "createdAt": "2020-08-28T00:35:35Z", "path": "smithy-model/src/main/java/software/amazon/smithy/model/selector/TopDownSelector.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2020 Amazon.com, Inc. or its affiliates. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\").\n+ * You may not use this file except in compliance with the License.\n+ * A copy of the License is located at\n+ *\n+ *  http://aws.amazon.com/apache2.0\n+ *\n+ * or in the \"license\" file accompanying this file. This file is distributed\n+ * on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either\n+ * express or implied. See the License for the specific language governing\n+ * permissions and limitations under the License.\n+ */\n+\n+package software.amazon.smithy.model.selector;\n+\n+import java.util.List;\n+import software.amazon.smithy.model.neighbor.Relationship;\n+import software.amazon.smithy.model.neighbor.RelationshipType;\n+import software.amazon.smithy.model.shapes.Shape;\n+\n+final class TopDownSelector implements InternalSelector {\n+    private final InternalSelector qualifier;\n+    private final InternalSelector disqualifier;\n+\n+    TopDownSelector(List<InternalSelector> selectors) {\n+        this.qualifier = selectors.get(0);\n+        disqualifier = selectors.size() > 1 ? selectors.get(1) : null;\n+    }\n+\n+    @Override\n+    public boolean push(Context context, Shape shape, Receiver next) {\n+        if (shape.isServiceShape() || shape.isResourceShape() || shape.isOperationShape()) {\n+            return pushMatch(false, context, shape, next);\n+        }\n+\n+        return true;\n+    }\n+\n+    private boolean pushMatch(boolean qualified, Context context, Shape shape, Receiver next) {\n+        // If the flag isn't set, then check if this shape sets it to true.\n+        if (!qualified && context.receivedShapes(shape, qualifier)) {\n+            qualified = true;\n+        }\n+\n+        // If the flag is set, then check if any predicates unset it.\n+        if (qualified && disqualifier != null && context.receivedShapes(shape, disqualifier)) {\n+            qualified = false;\n+        }\n+\n+        // If the shape is matched, then it's sent to the next receiver.\n+        if (qualified && !next.apply(context, shape)) {\n+            return false; // fast-fail if the receiver fast-fails.\n+        }\n+\n+        // Recursively. check each nested resource/operation.", "originalCommit": "0808e7b201b7a9e6ce536cf37c9fafa80769e237", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "661c3164822c94b9dec9cc367f31017d18a6faf6", "url": "https://github.com/awslabs/smithy/commit/661c3164822c94b9dec9cc367f31017d18a6faf6", "message": "Add :topdown selector to match hierarchically\n\nThe topdown selector is used to match shapes hierarchically based on a\n\"qualifier\" selector and optional \"disqualifier\" selector. This can be\nused to match shapes that are marked as controlPlane or dataPlane using\ninheritance from resource/service bindings, match shapes that use\nhttpBasic auth, etc.", "committedDate": "2020-09-09T05:56:40Z", "type": "forcePushed"}, {"oid": "3e2139374919b5309cb571dad6988e640d818995", "url": "https://github.com/awslabs/smithy/commit/3e2139374919b5309cb571dad6988e640d818995", "message": "Add :topdown selector to match hierarchically\n\nThe topdown selector is used to match shapes hierarchically based on a\n\"qualifier\" selector and optional \"disqualifier\" selector. This can be\nused to match shapes that are marked as controlPlane or dataPlane using\ninheritance from resource/service bindings, match shapes that use\nhttpBasic auth, etc.", "committedDate": "2020-09-09T19:02:29Z", "type": "forcePushed"}, {"oid": "27acf7de4efde27062faa09734b79ac2c637cb03", "url": "https://github.com/awslabs/smithy/commit/27acf7de4efde27062faa09734b79ac2c637cb03", "message": "Add :topdown selector to match hierarchically\n\nThe topdown selector is used to match shapes hierarchically based on a\n\"qualifier\" selector and optional \"disqualifier\" selector. This can be\nused to match shapes that are marked as controlPlane or dataPlane using\ninheritance from resource/service bindings, match shapes that use\nhttpBasic auth, etc.", "committedDate": "2020-09-09T19:51:05Z", "type": "forcePushed"}, {"oid": "8a624c1886360a8a354fea6658047c9597b0ea1f", "url": "https://github.com/awslabs/smithy/commit/8a624c1886360a8a354fea6658047c9597b0ea1f", "message": "Add :topdown selector to match hierarchically\n\nThe topdown selector is used to match shapes hierarchically based on a\n\"qualifier\" selector and optional \"disqualifier\" selector. This can be\nused to match shapes that are marked as controlPlane or dataPlane using\ninheritance from resource/service bindings, match shapes that use\nhttpBasic auth, etc.", "committedDate": "2020-09-09T19:52:56Z", "type": "commit"}, {"oid": "8a624c1886360a8a354fea6658047c9597b0ea1f", "url": "https://github.com/awslabs/smithy/commit/8a624c1886360a8a354fea6658047c9597b0ea1f", "message": "Add :topdown selector to match hierarchically\n\nThe topdown selector is used to match shapes hierarchically based on a\n\"qualifier\" selector and optional \"disqualifier\" selector. This can be\nused to match shapes that are marked as controlPlane or dataPlane using\ninheritance from resource/service bindings, match shapes that use\nhttpBasic auth, etc.", "committedDate": "2020-09-09T19:52:56Z", "type": "forcePushed"}]}