{"pr_number": 2168, "pr_title": "Add flag to Search2 api, indicating if search term was found in item attachments", "pr_createdAt": "2020-08-11T05:31:10Z", "pr_url": "https://github.com/openequella/openEQUELLA/pull/2168", "timeline": [{"oid": "fce5858846ebbdb463d5fbaf026262262dc7ad26", "url": "https://github.com/openequella/openEQUELLA/commit/fce5858846ebbdb463d5fbaf026262262dc7ad26", "message": "Add flag to Search2 api, indicating if search term was found in item attachment.", "committedDate": "2020-08-11T05:07:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODM1NTA2Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r468355067", "bodyText": "This method seems to be unused so we can remove it.", "author": "PenghaiZhang", "createdAt": "2020-08-11T06:30:59Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/services/item/StdFreetextResults.java", "diffHunk": "@@ -50,6 +50,10 @@ public StdFreetextResults(ItemService itemService, SearchResults<T> results, Sea\n     return items;\n   }\n \n+  public SearchResults<T> getSearchResult() {", "originalCommit": "fce5858846ebbdb463d5fbaf026262262dc7ad26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwOTI1Ng==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r468409256", "bodyText": "So wouldn't this then modify the model returned from the existing search API? Do we need it here, or can we leave it just in the SearchResultItem on the scala side?", "author": "edalex-ian", "createdAt": "2020-08-11T08:22:25Z", "path": "Source/Plugins/Core/com.equella.base/src/com/tle/web/api/item/interfaces/beans/ItemBean.java", "diffHunk": "@@ -194,4 +195,12 @@ public ItemExportBean getExportDetails() {\n   public void setExportDetails(ItemExportBean exportDetails) {\n     this.exportDetails = exportDetails;\n   }\n+\n+  public boolean isKeyWordFoundInAttachment() {", "originalCommit": "fce5858846ebbdb463d5fbaf026262262dc7ad26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODYyNDM5Mg==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r468624392", "bodyText": "More generally, this seems to be representing the source of where the match was found.\nWould it make sense to have it be a set of enumerables? To allows for the possibilities of more than one source and future search sources.", "author": "ChristianMurphy", "createdAt": "2020-08-11T14:27:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwOTI1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMDI5MA==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r468930290", "bodyText": "So wouldn't this then modify the model returned from the existing search API? Do we need it here, or can we leave it just in the SearchResultItem on the scala side?\n\nYeah, you raise a very valid point. I believe I can come up with a solution that does not modify the ItemBean", "author": "mrblippy", "createdAt": "2020-08-12T00:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODQwOTI1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkzMTgxNQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r468931815", "bodyText": "Because there is so much confusion in this class, I also suggest we put some comments here to explain why we added this new method and why the one in TopicDisplaySection.java returns null.", "author": "PenghaiZhang", "createdAt": "2020-08-12T00:07:41Z", "path": "Source/Plugins/Core/com.equella.core/src/com/tle/core/services/item/StdFreetextResults.java", "diffHunk": "@@ -63,6 +67,11 @@ public ItemKey getItemKey(int index) {\n     return results.getResults().get(index).getItemKey();\n   }\n \n+  @Override\n+  public List<T> getSearchResults() {", "originalCommit": "fce5858846ebbdb463d5fbaf026262262dc7ad26", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a9b05690559e7eb429b02c1d6ce7bfadb1f1e305", "url": "https://github.com/openequella/openEQUELLA/commit/a9b05690559e7eb429b02c1d6ce7bfadb1f1e305", "message": "Remove isKeywordFoundInAttachment boolean from ItemBean, and refactor SearchHelper and SearchResource.\n\nThis ensures that the keywordFoundInAttachment boolean is only returned for the Search2 rest api. The Search api result structure is left alone", "committedDate": "2020-08-12T02:15:59Z", "type": "commit"}, {"oid": "210e86b10193af77aa22f028f8896951e9b0bc32", "url": "https://github.com/openequella/openEQUELLA/commit/210e86b10193af77aa22f028f8896951e9b0bc32", "message": "Create SearchItem, make use of the apply method. Credit for this mainly goes to @PenghaiZhang", "committedDate": "2020-08-12T06:33:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NDg4Nw==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r469074887", "bodyText": "I must be missing something. But... Where is this now set? (I only see it being read.)", "author": "edalex-ian", "createdAt": "2020-08-12T07:56:18Z", "path": "Source/Plugins/Core/com.equella.base/src/com/tle/web/api/item/interfaces/beans/ItemBean.java", "diffHunk": "@@ -47,6 +47,7 @@\n   private List<AttachmentBean> attachments;\n   private NavigationTreeBean navigation;\n   private DrmBean drm;\n+  private boolean isKeyWordFoundInAttachment;", "originalCommit": "210e86b10193af77aa22f028f8896951e9b0bc32", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTYzNTkxMA==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r469635910", "bodyText": "Yeah, this is now unused. And I should remove it", "author": "mrblippy", "createdAt": "2020-08-13T01:05:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTA3NDg4Nw=="}], "type": "inlineReview"}, {"oid": "09ab33914f289ba14c98f3566d6298cef91c77d6", "url": "https://github.com/openequella/openEQUELLA/commit/09ab33914f289ba14c98f3566d6298cef91c77d6", "message": "Remove unused boolean variable from ItemBean", "committedDate": "2020-08-13T01:37:50Z", "type": "commit"}, {"oid": "200cb864c91fe423daf151ce910f570d06af2eb3", "url": "https://github.com/openequella/openEQUELLA/commit/200cb864c91fe423daf151ce910f570d06af2eb3", "message": "Update Search2 api test to check for eywordFoundInAttachment boolean flag", "committedDate": "2020-08-13T05:40:40Z", "type": "commit"}, {"oid": "8770f34c73ca60acfb21d5f05583b14c6a2678ba", "url": "https://github.com/openequella/openEQUELLA/commit/8770f34c73ca60acfb21d5f05583b14c6a2678ba", "message": "Add negative test for searching within attachment content", "committedDate": "2020-08-14T00:22:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDM2MDA0OQ==", "url": "https://github.com/openequella/openEQUELLA/pull/2168#discussion_r470360049", "bodyText": "As discussed, let's add a comment to further explain what's going on here - i.e. using the same item, but now searching for a value in the item vs the attachment.", "author": "edalex-ian", "createdAt": "2020-08-14T01:20:07Z", "path": "autotest/OldTests/src/test/java/io/github/openequella/rest/Search2ApiTest.java", "diffHunk": "@@ -75,6 +75,21 @@ public void startLengthTest() throws IOException {\n     assertEquals(result.get(\"results\").size(), 2);\n   }\n \n+  @Test(description = \"Search for a term that is found inside an attachment\")\n+  public void termFoundInAttachmentTest() throws IOException {\n+    JsonNode itemResult = doSearch(200, new NameValuePair(\"query\", \"frogs\")).get(\"results\").get(0);\n+    assertEquals(itemResult.get(\"keywordFoundInAttachment\").asBoolean(), true);\n+  }\n+\n+  @Test(description = \"Search for a term that is not found inside an attachment\")\n+  public void noTermFoundInAttachmentTest() throws IOException {\n+    JsonNode itemResult =\n+        doSearch(200, new NameValuePair(\"query\", \"Keyword found in attachment test item\"))", "originalCommit": "8770f34c73ca60acfb21d5f05583b14c6a2678ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a9fd780d41acfdadb6b5433795aeb400f2c98e62", "url": "https://github.com/openequella/openEQUELLA/commit/a9fd780d41acfdadb6b5433795aeb400f2c98e62", "message": "Remove duplicated id from institution data, and add additional comments to aid in test readability", "committedDate": "2020-08-14T01:31:10Z", "type": "commit"}]}