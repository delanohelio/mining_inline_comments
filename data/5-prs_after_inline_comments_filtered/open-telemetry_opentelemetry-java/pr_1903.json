{"pr_number": 1903, "pr_title": "Move samplers into samplers package instead of outer class.", "pr_createdAt": "2020-10-28T08:21:36Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903", "timeline": [{"oid": "1651555df9ceca5db2ab2c964ab50dd1f7be217e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/1651555df9ceca5db2ab2c964ab50dd1f7be217e", "message": "Move samplers into samplers package instead of outer class.", "committedDate": "2020-10-28T08:18:24Z", "type": "commit"}, {"oid": "1535b4476c38299eb8db91484de8cdbc984e7cd3", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/1535b4476c38299eb8db91484de8cdbc984e7cd3", "message": "Sampler", "committedDate": "2020-10-28T08:23:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NDMxOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903#discussion_r513254318", "bodyText": "These were only used in this class so moved them here", "author": "anuraaga", "createdAt": "2020-10-28T08:22:02Z", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/SpanBuilderSdk.java", "diffHunk": "@@ -258,4 +258,15 @@ private static Clock getClock(Span parent, Clock clock) {\n       return MonotonicClock.create(clock);\n     }\n   }\n+\n+  @VisibleForTesting\n+  static boolean isRecording(SamplingResult.Decision decision) {", "originalCommit": "1651555df9ceca5db2ab2c964ab50dd1f7be217e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NDc1MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903#discussion_r513254750", "bodyText": "I think we have a pattern of naming an AutoValue class ImmutableBlah so used that but not sure how cosistent are on it currently. It's a private class anyways", "author": "anuraaga", "createdAt": "2020-10-28T08:22:48Z", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/samplers/ImmutableSamplingResult.java", "diffHunk": "@@ -0,0 +1,57 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.sdk.trace.samplers;\n+\n+import static io.opentelemetry.api.common.AttributeKey.doubleKey;\n+\n+import com.google.auto.value.AutoValue;\n+import io.opentelemetry.api.common.AttributeKey;\n+import io.opentelemetry.api.common.Attributes;\n+import javax.annotation.concurrent.Immutable;\n+\n+@Immutable\n+@AutoValue\n+abstract class ImmutableSamplingResult implements SamplingResult {", "originalCommit": "1651555df9ceca5db2ab2c964ab50dd1f7be217e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NTczMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903#discussion_r513255730", "bodyText": "This is top level now instead of class Samplers.ParentBased.\nActually if ParentBasedSamplerBuilder is made top-level, this class could be made private.", "author": "anuraaga", "createdAt": "2020-10-28T08:24:28Z", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/samplers/ParentBasedSampler.java", "diffHunk": "@@ -0,0 +1,202 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.sdk.trace.samplers;\n+\n+import io.opentelemetry.api.common.ReadableAttributes;\n+import io.opentelemetry.api.trace.Span;\n+import io.opentelemetry.api.trace.SpanContext;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.sdk.trace.data.SpanData;\n+import java.util.List;\n+import java.util.Objects;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * A Sampler that uses the sampled flag of the parent Span, if present. If the span has no parent,\n+ * this Sampler will use the \"root\" sampler that it is built with. See documentation on the {@link\n+ * Builder} methods for the details on the various configurable options.\n+ */\n+@Immutable\n+public class ParentBasedSampler implements Sampler {", "originalCommit": "1535b4476c38299eb8db91484de8cdbc984e7cd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NjY3OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903#discussion_r513256679", "bodyText": "This is top level now, Samplers.SamplingResult had some stuttering of \"sampl\"", "author": "anuraaga", "createdAt": "2020-10-28T08:26:08Z", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/samplers/SamplingResult.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.sdk.trace.samplers;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import io.opentelemetry.api.common.Attributes;\n+import io.opentelemetry.api.common.ReadableAttributes;\n+import io.opentelemetry.api.trace.Span;\n+import io.opentelemetry.api.trace.SpanContext;\n+import io.opentelemetry.api.trace.TraceState;\n+import io.opentelemetry.context.Context;\n+import java.util.List;\n+\n+/**\n+ * Sampling result returned by {@link Sampler#shouldSample(Context, String, String, Span.Kind,\n+ * ReadableAttributes, List)}.\n+ */\n+public interface SamplingResult {", "originalCommit": "1535b4476c38299eb8db91484de8cdbc984e7cd3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NjgxMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903#discussion_r513256813", "bodyText": "Factories for SamplingResult moved to the SamplingResult", "author": "anuraaga", "createdAt": "2020-10-28T08:26:20Z", "path": "sdk/tracing/src/main/java/io/opentelemetry/sdk/trace/samplers/SamplingResult.java", "diffHunk": "@@ -0,0 +1,104 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.sdk.trace.samplers;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+import io.opentelemetry.api.common.Attributes;\n+import io.opentelemetry.api.common.ReadableAttributes;\n+import io.opentelemetry.api.trace.Span;\n+import io.opentelemetry.api.trace.SpanContext;\n+import io.opentelemetry.api.trace.TraceState;\n+import io.opentelemetry.context.Context;\n+import java.util.List;\n+\n+/**\n+ * Sampling result returned by {@link Sampler#shouldSample(Context, String, String, Span.Kind,\n+ * ReadableAttributes, List)}.\n+ */\n+public interface SamplingResult {\n+\n+  /**\n+   * Returns a {@link SamplingResult} with no attributes and {@link SamplingResult#getDecision()}\n+   * returning {@code decision}.\n+   *\n+   * <p>This is meant for use by custom {@link Sampler} implementations.\n+   *\n+   * <p>Use {@link #create(Decision, Attributes)} if you need attributes.\n+   *\n+   * @param decision The decision made on the span.\n+   * @return A {@link SamplingResult} with empty attributes and the provided {@code decision}.\n+   */\n+  static SamplingResult create(Decision decision) {", "originalCommit": "1535b4476c38299eb8db91484de8cdbc984e7cd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NzAwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1903#discussion_r513257009", "bodyText": "Also I think using a method overload (same name) seems consistent with our normal style instead of the previous name empty", "author": "anuraaga", "createdAt": "2020-10-28T08:26:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzI1NjgxMw=="}], "type": "inlineReview"}, {"oid": "36fe48c43550b8ab33a46cc7af4cdbd708fde20b", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/36fe48c43550b8ab33a46cc7af4cdbd708fde20b", "message": "Sampler", "committedDate": "2020-10-28T08:31:33Z", "type": "commit"}, {"oid": "79f71b1d96d5f40a44da32d168019ab61221f6a4", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/79f71b1d96d5f40a44da32d168019ab61221f6a4", "message": "Drift", "committedDate": "2020-10-28T08:38:20Z", "type": "commit"}, {"oid": "79f71b1d96d5f40a44da32d168019ab61221f6a4", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/79f71b1d96d5f40a44da32d168019ab61221f6a4", "message": "Drift", "committedDate": "2020-10-28T08:38:20Z", "type": "forcePushed"}]}