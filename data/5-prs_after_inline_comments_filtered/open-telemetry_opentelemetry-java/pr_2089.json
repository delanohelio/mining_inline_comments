{"pr_number": 2089, "pr_title": "Hide default context propagators implementation behind interface.", "pr_createdAt": "2020-11-18T05:33:12Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/2089", "timeline": [{"oid": "60b520f1c6c75713cb79b196c33e5f6386962fc1", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/60b520f1c6c75713cb79b196c33e5f6386962fc1", "message": "Hide default context propagators implementation behind interface.", "committedDate": "2020-11-18T05:21:32Z", "type": "commit"}, {"oid": "7565f9fbef92a01deb3ca0857b146d1eac384c61", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7565f9fbef92a01deb3ca0857b146d1eac384c61", "message": "Deprecate", "committedDate": "2020-11-18T05:45:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MjQxOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2089#discussion_r526242419", "bodyText": "Having an interface for a builder, which is just a list of propagators and a constructor call feels like overkill to me. Is the rationale here to make the agent more easily able to bridge the builder?\nCould we ditch the builder entirely and use a pattern like in #2091 where we just have a static method on the ContextPropagators that takes the list of TextMapPropagators?", "author": "jkwatson", "createdAt": "2020-11-18T16:49:11Z", "path": "context/src/main/java/io/opentelemetry/context/propagation/ContextPropagatorsBuilder.java", "diffHunk": "@@ -0,0 +1,32 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.context.propagation;\n+\n+/**\n+ * A builder of a default {@link ContextPropagators} which can have multiple {@link\n+ * TextMapPropagator} added, and extraction and injection will execute every {@link\n+ * TextMapPropagator} in order.\n+ */\n+public interface ContextPropagatorsBuilder {", "originalCommit": "7565f9fbef92a01deb3ca0857b146d1eac384c61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjUzNDgzNA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2089#discussion_r526534834", "bodyText": "Yup - it came to mind after sending the PR but before also having the idea of killing ContextPropagators completely :) Will do so since now I see the binary propagation idea is probably the main reason for this interface.", "author": "anuraaga", "createdAt": "2020-11-19T01:37:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI0MjQxOQ=="}], "type": "inlineReview"}, {"oid": "94adc4e0d4bfb06686b8e5b285128e391c124c63", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/94adc4e0d4bfb06686b8e5b285128e391c124c63", "message": "Revamp", "committedDate": "2020-11-19T03:41:54Z", "type": "commit"}, {"oid": "f9c8c473612f39c63b99877d33370cb013b96073", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f9c8c473612f39c63b99877d33370cb013b96073", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-java into hide-default-contextpropagators", "committedDate": "2020-11-19T03:45:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5NDUyOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2089#discussion_r526594528", "bodyText": "this usage looks really good to me.  \ud83d\udc4d", "author": "jkwatson", "createdAt": "2020-11-19T04:57:41Z", "path": "context/src/main/java/io/opentelemetry/context/propagation/ContextPropagators.java", "diffHunk": "@@ -71,25 +73,29 @@\n public interface ContextPropagators {\n \n   /**\n-   * Returns a {@link ContextPropagatorsBuilder} used to construct a new {@code ContextPropagators}\n-   * object with the specified propagators.\n-   *\n-   * <p>Invocation order of {@code TextMapPropagator#inject()} and {@code\n-   * TextMapPropagator#extract()} for registered trace propagators is undefined.\n-   *\n-   * <p>This is a example of a {@code ContextPropagators} object being created:\n+   * Returns a {@link ContextPropagators} which can be used to extract and inject context in text\n+   * payloads with the given {@link TextMapPropagator}. Use {@link\n+   * TextMapPropagator#composite(TextMapPropagator...)} to register multiple propagators, which will\n+   * all be executed when extracting or injecting.\n    *\n    * <pre>{@code\n-   * ContextPropagators propagators = DefaultContextPropagators.builder()\n-   *     .addTextMapPropagator(new HttpTraceContext())\n-   *     .addTextMapPropagator(new HttpBaggage())\n-   *     .addTextMapPropagator(new MyCustomContextPropagator())\n-   *     .build();\n+   * ContextPropagators propagators = ContextPropagators.create(\n+   *   TextMapPropagator.composite(\n+   *     HttpTraceContext.getInstance(),\n+   *     W3CBaggagePropagator.getInstance(),\n+   *     new MyCustomContextPropagator()));", "originalCommit": "94adc4e0d4bfb06686b8e5b285128e391c124c63", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMwNjk1Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2089#discussion_r527306957", "bodyText": "I preferred the Builder but hiding the default instance looks great. On that note, TraceMultiPropagator may need to be lifted too, i.e. no Builder.", "author": "carlosalberto", "createdAt": "2020-11-20T00:34:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5NDUyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM0NTI2OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2089#discussion_r527345269", "bodyText": "Thanks for calling out - let me followup with consistency in TraceMultiPropagator in a bit", "author": "anuraaga", "createdAt": "2020-11-20T01:58:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjU5NDUyOA=="}], "type": "inlineReview"}]}