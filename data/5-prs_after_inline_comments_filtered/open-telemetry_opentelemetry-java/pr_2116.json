{"pr_number": 2116, "pr_title": "Rename HttpTraceContext to W3CTraceContextPropagator.", "pr_createdAt": "2020-11-23T13:24:44Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/2116", "timeline": [{"oid": "a1a49f79c31db0346b585d75fe39b7264bdc1ab5", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a1a49f79c31db0346b585d75fe39b7264bdc1ab5", "message": "Rename HttpTraceContext to W3CTraceContextPropagator.", "committedDate": "2020-11-23T13:22:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODcwMDk5MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2116#discussion_r528700991", "bodyText": "Moving these tho the inner class, removing the interface implemenation and declaring getInstance as returning only TextMapPropagator instead of W3CTraceContextPropagator where the only changes here. Unfortunately it seems GitHub does not show that well.", "author": "Oberon00", "createdAt": "2020-11-23T13:25:59Z", "path": "api/src/main/java/io/opentelemetry/api/trace/propagation/W3CTraceContextPropagator.java", "diffHunk": "@@ -0,0 +1,239 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.api.trace.propagation;\n+\n+import static io.opentelemetry.api.internal.Utils.checkArgument;\n+\n+import io.opentelemetry.api.internal.TemporaryBuffers;\n+import io.opentelemetry.api.trace.Span;\n+import io.opentelemetry.api.trace.SpanContext;\n+import io.opentelemetry.api.trace.SpanId;\n+import io.opentelemetry.api.trace.TraceFlags;\n+import io.opentelemetry.api.trace.TraceId;\n+import io.opentelemetry.api.trace.TraceState;\n+import io.opentelemetry.api.trace.TraceStateBuilder;\n+import io.opentelemetry.context.Context;\n+import io.opentelemetry.context.propagation.TextMapPropagator;\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.Set;\n+import java.util.logging.Logger;\n+import java.util.regex.Pattern;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Implementation of the W3C TraceContext propagation protocol. See <a\n+ * href=\"https://www.w3.org/TR/trace-context-1/\">W3C Trace Context</a>.\n+ *\n+ * <p>This is the default propagator for {@link SpanContext}s. The {@link SpanContext} type is\n+ * designed to support all the data propagated via W3C propagation natively.\n+ */\n+@Immutable\n+public final class W3CTraceContextPropagator {\n+  private static final Logger logger = Logger.getLogger(W3CTraceContextPropagator.class.getName());\n+\n+  private static final TraceState TRACE_STATE_DEFAULT = TraceState.builder().build();\n+  static final String TRACE_PARENT = \"traceparent\";\n+  static final String TRACE_STATE = \"tracestate\";\n+  private static final List<String> FIELDS =\n+      Collections.unmodifiableList(Arrays.asList(TRACE_PARENT, TRACE_STATE));\n+\n+  private static final String VERSION = \"00\";\n+  private static final int VERSION_SIZE = 2;\n+  private static final char TRACEPARENT_DELIMITER = '-';\n+  private static final int TRACEPARENT_DELIMITER_SIZE = 1;\n+  private static final int TRACE_ID_HEX_SIZE = TraceId.getHexLength();\n+  private static final int SPAN_ID_HEX_SIZE = SpanId.getHexLength();\n+  private static final int TRACE_OPTION_HEX_SIZE = TraceFlags.getHexLength();\n+  private static final int TRACE_ID_OFFSET = VERSION_SIZE + TRACEPARENT_DELIMITER_SIZE;\n+  private static final int SPAN_ID_OFFSET =\n+      TRACE_ID_OFFSET + TRACE_ID_HEX_SIZE + TRACEPARENT_DELIMITER_SIZE;\n+  private static final int TRACE_OPTION_OFFSET =\n+      SPAN_ID_OFFSET + SPAN_ID_HEX_SIZE + TRACEPARENT_DELIMITER_SIZE;\n+  private static final int TRACEPARENT_HEADER_SIZE = TRACE_OPTION_OFFSET + TRACE_OPTION_HEX_SIZE;\n+  private static final int TRACESTATE_MAX_SIZE = 512;\n+  private static final int TRACESTATE_MAX_MEMBERS = 32;\n+  private static final char TRACESTATE_KEY_VALUE_DELIMITER = '=';\n+  private static final char TRACESTATE_ENTRY_DELIMITER = ',';\n+  private static final Pattern TRACESTATE_ENTRY_DELIMITER_SPLIT_PATTERN =\n+      Pattern.compile(\"[ \\t]*\" + TRACESTATE_ENTRY_DELIMITER + \"[ \\t]*\");\n+  private static final Set<String> VALID_VERSIONS;\n+  private static final String VERSION_00 = \"00\";\n+  private static final TextMapPropagator INSTANCE =", "originalCommit": "a1a49f79c31db0346b585d75fe39b7264bdc1ab5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkxNjIxMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2116#discussion_r528916210", "bodyText": "If you could add some javadoc with a pointer over to what the user should be using, that would be more user-friendly. Also on the getInstance() method, I think.", "author": "jkwatson", "createdAt": "2020-11-23T18:37:02Z", "path": "api/src/main/java/io/opentelemetry/api/trace/propagation/HttpTraceContext.java", "diffHunk": "@@ -5,78 +5,17 @@\n \n package io.opentelemetry.api.trace.propagation;\n \n-import static io.opentelemetry.api.internal.Utils.checkArgument;\n-\n-import io.opentelemetry.api.internal.TemporaryBuffers;\n-import io.opentelemetry.api.trace.Span;\n-import io.opentelemetry.api.trace.SpanContext;\n-import io.opentelemetry.api.trace.SpanId;\n-import io.opentelemetry.api.trace.TraceFlags;\n-import io.opentelemetry.api.trace.TraceId;\n-import io.opentelemetry.api.trace.TraceState;\n-import io.opentelemetry.api.trace.TraceStateBuilder;\n import io.opentelemetry.context.Context;\n import io.opentelemetry.context.propagation.TextMapPropagator;\n-import java.util.Arrays;\n-import java.util.Collections;\n-import java.util.HashSet;\n import java.util.List;\n-import java.util.Objects;\n-import java.util.Set;\n-import java.util.logging.Logger;\n-import java.util.regex.Pattern;\n import javax.annotation.Nullable;\n import javax.annotation.concurrent.Immutable;\n \n-/**\n- * Implementation of the TraceContext propagation protocol. See <a\n- * href=https://github.com/w3c/distributed-tracing>w3c/distributed-tracing</a>.\n- */\n @Immutable\n+@Deprecated", "originalCommit": "a1a49f79c31db0346b585d75fe39b7264bdc1ab5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTMyOTc2Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2116#discussion_r529329767", "bodyText": "Done in 1e27143", "author": "Oberon00", "createdAt": "2020-11-24T09:16:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkxNjIxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODkxNzMzNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2116#discussion_r528917335", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            /** Unit tests for {@link W3CTraceContextPropagator}. */", "author": "jkwatson", "createdAt": "2020-11-23T18:39:11Z", "path": "extensions/trace-propagators/src/test/java/io/opentelemetry/extension/trace/propagation/B3PropagatorTest.java", "diffHunk": "@@ -25,7 +26,7 @@\n import javax.annotation.Nullable;\n import org.junit.jupiter.api.Test;\n \n-/** Unit tests for {@link io.opentelemetry.api.trace.propagation.HttpTraceContext}. */\n+/** Unit tests for {@link W3CTraceContextPropagator}. */", "originalCommit": "a1a49f79c31db0346b585d75fe39b7264bdc1ab5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1e27143450ed0639270e8f7e7639613eee39bd33", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/1e27143450ed0639270e8f7e7639613eee39bd33", "message": "Add javadoc.", "committedDate": "2020-11-24T08:46:53Z", "type": "commit"}, {"oid": "332732ec9ca41208895b2b9cab0e0ff658d9d0b2", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/332732ec9ca41208895b2b9cab0e0ff658d9d0b2", "message": "Merge remote-tracking branch 'upstream/master' into rename-http-trace-context-w3c", "committedDate": "2020-11-24T08:47:15Z", "type": "commit"}]}