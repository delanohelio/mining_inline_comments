{"pr_number": 1124, "pr_title": "Improve propagator performance", "pr_createdAt": "2020-04-21T10:18:43Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1124", "timeline": [{"oid": "50de7d60d96dccd02b0420656eedf18e2b21e644", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/50de7d60d96dccd02b0420656eedf18e2b21e644", "message": "made a couple of quick win performance improvementts to propagators", "committedDate": "2020-04-21T09:47:36Z", "type": "commit"}, {"oid": "bcc56bd54cb59bda8cbb849d51aa5a287e63522a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/bcc56bd54cb59bda8cbb849d51aa5a287e63522a", "message": "tidy up var order", "committedDate": "2020-04-21T09:57:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5OTI3NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1124#discussion_r412199274", "bodyText": "Out of curiosity: is this 1 expected?", "author": "carlosalberto", "createdAt": "2020-04-21T13:47:16Z", "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/JaegerPropagator.java", "diffHunk": "@@ -47,22 +47,36 @@\n \n   private static final Logger logger = Logger.getLogger(JaegerPropagator.class.getName());\n \n-  static final String TRACE_ID_HEADER = \"uber-trace-id\";\n+  static final String PROPAGATION_HEADER = \"uber-trace-id\";\n   // Parent span has been deprecated but Jaeger propagation protocol requires it\n-  static final String DEPRECATED_PARENT_SPAN = \"0\";\n-  static final String SEPARATOR = \":\";\n-\n-  private static final String IS_SAMPLED = \"1\";\n-  private static final String NOT_SAMPLED = \"0\";\n+  static final char DEPRECATED_PARENT_SPAN = '0';\n+  static final char PROPAGATION_HEADER_DELIMITER = ':';\n \n   private static final int MAX_TRACE_ID_LENGTH = 2 * TraceId.getSize();\n   private static final int MAX_SPAN_ID_LENGTH = 2 * SpanId.getSize();\n   private static final int MAX_FLAGS_LENGTH = 2;\n+\n+  private static final char IS_SAMPLED = '1';\n+  private static final char NOT_SAMPLED = '0';\n+  private static final int PROPAGATION_HEADER_DELIMITER_SIZE = 1;\n+\n+  private static final int TRACE_ID_HEX_SIZE = 2 * TraceId.getSize();\n+  private static final int SPAN_ID_HEX_SIZE = 2 * SpanId.getSize();\n+  private static final int PARENT_SPAN_ID_SIZE = 1;", "originalCommit": "bcc56bd54cb59bda8cbb849d51aa5a287e63522a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIwMDEwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1124#discussion_r412200109", "bodyText": "Never mind, I saw it's deprecated ;)", "author": "carlosalberto", "createdAt": "2020-04-21T13:48:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE5OTI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIyMzAwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1124#discussion_r412223009", "bodyText": "URL encoded not UTF-8", "author": "bogdandrutu", "createdAt": "2020-04-21T14:15:06Z", "path": "contrib/trace_propagators/src/main/java/io/opentelemetry/contrib/trace/propagation/JaegerPropagator.java", "diffHunk": "@@ -106,30 +118,33 @@\n \n   @SuppressWarnings(\"StringSplitter\")\n   private static <C> SpanContext getSpanContextFromHeader(C carrier, Getter<C> getter) {\n-    String value = getter.get(carrier, TRACE_ID_HEADER);\n+    String value = getter.get(carrier, PROPAGATION_HEADER);\n     if (StringUtils.isNullOrEmpty(value)) {\n       return SpanContext.getInvalid();\n     }\n \n-    try {\n-      // the propagation value may contain UTF-8 encoded SEPARATOR's (:), so we need to decode it\n-      // before attempting to split it.\n-      value = URLDecoder.decode(value, \"UTF-8\");\n-    } catch (UnsupportedEncodingException e) {\n-      logger.info(\n-          \"Error decoding '\"\n-              + TRACE_ID_HEADER\n-              + \"' with value \"\n-              + value\n-              + \". Returning INVALID span context.\");\n-      return SpanContext.getInvalid();\n+    // if the delimiter (:) cannot be found then the propagation value could be UTF-8\n+    // encoded, so we need to decode it before attempting to split it.", "originalCommit": "bcc56bd54cb59bda8cbb849d51aa5a287e63522a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8737aae908cb1962905eae4da3f5846e6e912128", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/8737aae908cb1962905eae4da3f5846e6e912128", "message": "corrected typo in comment", "committedDate": "2020-04-21T21:26:07Z", "type": "commit"}]}