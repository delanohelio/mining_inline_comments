{"pr_number": 2227, "pr_title": "Detect invalid use of makeCurrent in Kotlin coroutine.", "pr_createdAt": "2020-12-08T09:57:45Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/2227", "timeline": [{"oid": "e971b6322ffdf569e1d5f1047c17bc7451ef6f2f", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e971b6322ffdf569e1d5f1047c17bc7451ef6f2f", "message": "Detect invalid use of makeCurrent in Kotlin coroutine.", "committedDate": "2020-12-08T09:56:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY2NDk2MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2227#discussion_r538664961", "bodyText": "urgh. Any thoughts on how to keep this up-to-date if kotlin renames or changes their continuation implementation? Do we know what versions of kotlin this will work for, at this point?", "author": "jkwatson", "createdAt": "2020-12-08T17:56:45Z", "path": "api/context/src/main/java/io/opentelemetry/context/StrictContextStorage.java", "diffHunk": "@@ -92,6 +92,17 @@ public Scope attach(Context context) {\n     CallerStackTrace caller = new CallerStackTrace(context);\n     StackTraceElement[] stackTrace = caller.getStackTrace();\n \n+    // Detect invalid use from kotlin.\n+    for (StackTraceElement element : stackTrace) {\n+      if (element.getClassName().equals(\"kotlin.coroutines.jvm.internal.BaseContinuationImpl\")", "originalCommit": "e971b6322ffdf569e1d5f1047c17bc7451ef6f2f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY3MDY4NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2227#discussion_r538670685", "bodyText": "as you say...best effort is better than nothing! Just wondering if we can provide some documentation about what is supported by this.", "author": "jkwatson", "createdAt": "2020-12-08T18:02:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY2NDk2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTUxMTM2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2227#discussion_r541511365", "bodyText": "I added some doc to Context about the use of internal details, not sure how better to phrase it.", "author": "anuraaga", "createdAt": "2020-12-12T06:02:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODY2NDk2MQ=="}], "type": "inlineReview"}, {"oid": "d0b78413930a798522ba79cb0c43c13dbdb6ac31", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d0b78413930a798522ba79cb0c43c13dbdb6ac31", "message": "Fix and check suspending function too.", "committedDate": "2020-12-12T05:58:39Z", "type": "commit"}, {"oid": "ec83c1dfa3818d1aff99730e27b4d3da578042b4", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ec83c1dfa3818d1aff99730e27b4d3da578042b4", "message": "Newline", "committedDate": "2020-12-12T05:59:37Z", "type": "commit"}, {"oid": "762c9d7914a382408bde65d2a642717bd8307b20", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/762c9d7914a382408bde65d2a642717bd8307b20", "message": "Doc", "committedDate": "2020-12-12T06:02:27Z", "type": "commit"}, {"oid": "26e8def5ed63757cf068daa8f9c292dd4b5e9b08", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/26e8def5ed63757cf068daa8f9c292dd4b5e9b08", "message": "Some comments", "committedDate": "2020-12-12T06:06:23Z", "type": "commit"}, {"oid": "f2a2cafd1b3f4bda7badc8633cd34f25903981ce", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f2a2cafd1b3f4bda7badc8633cd34f25903981ce", "message": "teency", "committedDate": "2020-12-15T05:58:03Z", "type": "commit"}]}