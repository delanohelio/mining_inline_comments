{"pr_number": 1482, "pr_title": "Fix SpanWrapper snapshot being incomplete.", "pr_createdAt": "2020-07-30T08:22:31Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482", "timeline": [{"oid": "9712a7eb50dae482e492f3aec4858bb3b5c4573e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9712a7eb50dae482e492f3aec4858bb3b5c4573e", "message": "Fix SpanWrapper snapshot being incomplete.", "committedDate": "2020-07-30T08:26:01Z", "type": "commit"}, {"oid": "9712a7eb50dae482e492f3aec4858bb3b5c4573e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9712a7eb50dae482e492f3aec4858bb3b5c4573e", "message": "Fix SpanWrapper snapshot being incomplete.", "committedDate": "2020-07-30T08:26:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg0NzAwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462847009", "bodyText": "Can you please provide more descriptive name for the test? What does it actually test?", "author": "iNikem", "createdAt": "2020-07-30T08:48:11Z", "path": "sdk/src/test/java/io/opentelemetry/sdk/trace/RecordEventsReadableSpanTest.java", "diffHunk": "@@ -253,6 +253,32 @@ public void toSpanData_WithInitialAttributes() {\n     assertThat(spanData.getTotalAttributeCount()).isEqualTo(attributes.size() + 1);\n   }\n \n+  @Test\n+  public void toSpanData_snapshot() {", "originalCommit": "9712a7eb50dae482e492f3aec4858bb3b5c4573e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg0ODM3NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462848375", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              public void toSpanData_snapshot() {\n          \n          \n            \n              public void toSpanData_spanDataDoesNotChangeWhenModifyingSpan() {\n          \n      \n    \n    \n  \n\nwould that be better?", "author": "Oberon00", "createdAt": "2020-07-30T08:50:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg0NzAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg1MTY4OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462851688", "bodyText": "I also updated the PR description.", "author": "Oberon00", "createdAt": "2020-07-30T08:55:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg0NzAwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg1NjMwNw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462856307", "bodyText": "Improved in 9ac9a16.", "author": "Oberon00", "createdAt": "2020-07-30T09:03:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg0NzAwOQ=="}], "type": "inlineReview"}, {"oid": "9ac9a168bf82c7b18abe2b9a1ebbea274dd4be2e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/9ac9a168bf82c7b18abe2b9a1ebbea274dd4be2e", "message": "Improve clarity of unit test.", "committedDate": "2020-07-30T09:02:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NDY4MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462894681", "bodyText": "I think a small comment can help\n// We reduce overhead by using the delegate for all immutable fields. Take care when adding something new to this class when determining whether to delegate or not.", "author": "anuraaga", "createdAt": "2020-07-30T10:12:23Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanWrapper.java", "diffHunk": "@@ -58,9 +64,21 @@ static SpanWrapper create(\n       ReadableAttributes attributes,\n       int totalAttributeCount,\n       int totalRecordedEvents,\n-      Status status) {\n+      Status status,\n+      String name,\n+      long endEpochNanos,\n+      boolean hasEnded) {\n     return new AutoValue_SpanWrapper(\n-        delegate, links, events, attributes, totalAttributeCount, totalRecordedEvents, status);\n+        delegate,", "originalCommit": "9ac9a168bf82c7b18abe2b9a1ebbea274dd4be2e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5OTMzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462899332", "bodyText": "I'm hesistant to add this in this bugfix PR. It might cause lots of discussion on how to word it. That aspect you want me to call out did not really change with this PR.", "author": "Oberon00", "createdAt": "2020-07-30T10:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NDY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMDY0Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462900646", "bodyText": "Well the main reason it came to mind is while reviewing this I had to make sure we didn't miss other fields. I think with this PR you put in the thought so documenting that is worthwhile. If this sort of small comment can cause a bikeshed we're in trouble :(", "author": "anuraaga", "createdAt": "2020-07-30T10:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NDY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwMTI1Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462901257", "bodyText": "OK, I will add it \ud83d\ude04", "author": "Oberon00", "createdAt": "2020-07-30T10:25:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NDY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkwNzA0Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462907047", "bodyText": "Added a javadoc in cc79fdb.", "author": "Oberon00", "createdAt": "2020-07-30T10:36:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NDY4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjkxMTAxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r462911012", "bodyText": "Thanks, I really like it!", "author": "anuraaga", "createdAt": "2020-07-30T10:45:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mjg5NDY4MQ=="}], "type": "inlineReview"}, {"oid": "cc79fdbbda0ffd7cd6372880c4c6b2945e67a56b", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/cc79fdbbda0ffd7cd6372880c4c6b2945e67a56b", "message": "Add javadoc for SpanWrapper.", "committedDate": "2020-07-30T10:36:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzIzNzc0NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1482#discussion_r463237745", "bodyText": "I don't think this is actually a flyweight in the GoF sense, which is more like a multi-singleton. This is a pure delegate.", "author": "jkwatson", "createdAt": "2020-07-30T19:59:17Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/SpanWrapper.java", "diffHunk": "@@ -30,6 +30,17 @@\n import java.util.List;\n import javax.annotation.concurrent.Immutable;\n \n+/**\n+ * Immutable class that stores {@link SpanData} based on a {@link RecordEventsReadableSpan}.\n+ *\n+ * <p>This is a variant of the \"flyweight\" design pattern, to reduce overhead. We store a reference", "originalCommit": "cc79fdbbda0ffd7cd6372880c4c6b2945e67a56b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c0e080925652c7228dfab8daea86f281ff2f74e7", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c0e080925652c7228dfab8daea86f281ff2f74e7", "message": "Remove 'flyweight' from docstring.", "committedDate": "2020-07-30T21:12:25Z", "type": "commit"}]}