{"pr_number": 1218, "pr_title": "Extract SpanData to an interface", "pr_createdAt": "2020-05-14T15:56:54Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218", "timeline": [{"oid": "95392f6eabad087c3749bf4b045790874713aaf7", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/95392f6eabad087c3749bf4b045790874713aaf7", "message": "Extract SpanData to an interface.", "committedDate": "2020-05-14T15:18:06Z", "type": "commit"}, {"oid": "8614675804e6c0c91d5338a5c4caf53455a64de9", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/8614675804e6c0c91d5338a5c4caf53455a64de9", "message": "Move the inner link and event classes to the top level and rename for consistency.", "committedDate": "2020-05-14T15:33:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MTc0NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425251744", "bodyText": "This is not the right annotation", "author": "bogdandrutu", "createdAt": "2020-05-14T16:01:46Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanData.java", "diffHunk": "@@ -16,63 +16,54 @@\n \n package io.opentelemetry.sdk.trace.data;\n \n-import com.google.auto.value.AutoValue;\n import io.opentelemetry.common.AttributeValue;\n import io.opentelemetry.sdk.common.InstrumentationLibraryInfo;\n import io.opentelemetry.sdk.resources.Resource;\n import io.opentelemetry.sdk.trace.config.TraceConfig;\n-import io.opentelemetry.trace.Event;\n import io.opentelemetry.trace.Span.Kind;\n-import io.opentelemetry.trace.SpanContext;\n import io.opentelemetry.trace.SpanId;\n import io.opentelemetry.trace.Status;\n import io.opentelemetry.trace.TraceFlags;\n import io.opentelemetry.trace.TraceId;\n import io.opentelemetry.trace.TraceState;\n-import java.util.ArrayList;\n-import java.util.Collections;\n-import java.util.HashMap;\n-import java.util.LinkedHashMap;\n import java.util.List;\n import java.util.Map;\n-import javax.annotation.concurrent.Immutable;\n+import jdk.nashorn.internal.ir.annotations.Immutable;", "originalCommit": "8614675804e6c0c91d5338a5c4caf53455a64de9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1ODE5NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425258194", "bodyText": "yep. fixed.", "author": "jkwatson", "createdAt": "2020-05-14T16:11:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MTc0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MzMwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425253308", "bodyText": "Use singletonList here?", "author": "bogdandrutu", "createdAt": "2020-05-14T16:04:13Z", "path": "exporters/zipkin/src/test/java/io/opentelemetry/exporters/zipkin/ZipkinSpanExporterTest.java", "diffHunk": "@@ -236,7 +238,7 @@ public void testExport_failed() throws IOException {\n     when(mockZipkinCall.execute()).thenThrow(new IOException());\n \n     ResultCode resultCode =\n-        zipkinSpanExporter.export(Collections.singleton(buildStandardSpan().build()));\n+        zipkinSpanExporter.export(Collections.<SpanData>singleton(buildStandardSpan().build()));", "originalCommit": "8614675804e6c0c91d5338a5c4caf53455a64de9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1NzEwNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425257106", "bodyText": "better than a single-item set? Since it takes Collection, either should work, correct?", "author": "jkwatson", "createdAt": "2020-05-14T16:09:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2MTE2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425261165", "bodyText": "Correct just that list seems lightweight compared to set :)", "author": "bogdandrutu", "createdAt": "2020-05-14T16:15:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2MTgzNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425261835", "bodyText": "if you look at the implementation of singleton, I think it's about as lightweight as it's possible to be. :)", "author": "jkwatson", "createdAt": "2020-05-14T16:16:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2Mjc2Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425262763", "bodyText": "implementation-wise, they're really just a wrapper for a single data item. I like using singleton as it's 4 less characters than singletonList. But, honestly, I don't care all that much, either way.", "author": "jkwatson", "createdAt": "2020-05-14T16:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI2NTM1MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425265350", "bodyText": "Leave it as it is, for me was just reading the code and found this inconsistencies, so was more like this is not what I was expecting.", "author": "bogdandrutu", "createdAt": "2020-05-14T16:21:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTI1MzMwOA=="}], "type": "inlineReview"}, {"oid": "be1e4f40994a78347043f9ec0b2e876fa0587baf", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/be1e4f40994a78347043f9ec0b2e876fa0587baf", "message": "clean up a few errant references to the impl", "committedDate": "2020-05-14T16:08:08Z", "type": "commit"}, {"oid": "5c6cf8b201f43e813c8b2a859230805a0d1aae5a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/5c6cf8b201f43e813c8b2a859230805a0d1aae5a", "message": "use the right annotation", "committedDate": "2020-05-14T16:11:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM3OTYzMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425379630", "bodyText": "What about moving this into a testing package and maybe rename to SpanData or TestingSpanData?", "author": "bogdandrutu", "createdAt": "2020-05-14T19:29:08Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/SpanDataImpl.java", "diffHunk": "@@ -0,0 +1,278 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.sdk.trace.data;\n+\n+import com.google.auto.value.AutoValue;\n+import io.opentelemetry.common.AttributeValue;\n+import io.opentelemetry.sdk.common.InstrumentationLibraryInfo;\n+import io.opentelemetry.sdk.resources.Resource;\n+import io.opentelemetry.trace.Span.Kind;\n+import io.opentelemetry.trace.SpanId;\n+import io.opentelemetry.trace.Status;\n+import io.opentelemetry.trace.TraceFlags;\n+import io.opentelemetry.trace.TraceId;\n+import io.opentelemetry.trace.TraceState;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Immutable representation of all data collected by the {@link io.opentelemetry.trace.Span} class.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+@AutoValue\n+public abstract class SpanDataImpl implements SpanData {", "originalCommit": "5c6cf8b201f43e813c8b2a859230805a0d1aae5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4OTQwNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425389406", "bodyText": "I agree; I'd like to do that when we stop using it as the representation that's used by the RERS. Until then, it is the only implementation we have.", "author": "jkwatson", "createdAt": "2020-05-14T19:47:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM3OTYzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4MDI3OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425380278", "bodyText": "This is inconsistent, SpanData represents the interface to access recorded properties to the Span, but LinkData represents a concrete implementation of the Link interface.", "author": "bogdandrutu", "createdAt": "2020-05-14T19:30:28Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/data/LinkData.java", "diffHunk": "@@ -0,0 +1,97 @@\n+/*\n+ * Copyright 2020, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.sdk.trace.data;\n+\n+import com.google.auto.value.AutoValue;\n+import io.opentelemetry.common.AttributeValue;\n+import io.opentelemetry.sdk.trace.config.TraceConfig;\n+import io.opentelemetry.trace.Link;\n+import io.opentelemetry.trace.SpanContext;\n+import java.util.Collections;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * An immutable implementation of {@link Link}.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+@AutoValue\n+public abstract class LinkData implements Link {", "originalCommit": "5c6cf8b201f43e813c8b2a859230805a0d1aae5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4OTcwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425389705", "bodyText": "Totally agree. Do you have ideas on better naming? I didn't like \"Link\" which is what it was before. And, we already have another class called \"TimedEvent\" for the other case.", "author": "jkwatson", "createdAt": "2020-05-14T19:48:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTM4MDI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2NDc4MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425464780", "bodyText": "Eh, wondering how we ended up with this one here.", "author": "carlosalberto", "createdAt": "2020-05-14T22:24:54Z", "path": "sdk/src/main/java/io/opentelemetry/sdk/trace/export/SimpleSpansProcessor.java", "diffHunk": "@@ -29,7 +29,7 @@\n import java.util.Properties;\n import java.util.logging.Level;\n import java.util.logging.Logger;\n-import jdk.nashorn.internal.ir.annotations.Immutable;", "originalCommit": "5c6cf8b201f43e813c8b2a859230805a0d1aae5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ3NTUxMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1218#discussion_r425475513", "bodyText": "it's easy to have IDEA import the wrong one. I did it early in this PR, myself. :)", "author": "jkwatson", "createdAt": "2020-05-14T22:57:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTQ2NDc4MA=="}], "type": "inlineReview"}, {"oid": "765274d5016782cae656999d89ab6fe9aa26a828", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/765274d5016782cae656999d89ab6fe9aa26a828", "message": "move the Link and Event back into the SpanData and give them simple names.", "committedDate": "2020-05-14T22:35:57Z", "type": "commit"}]}