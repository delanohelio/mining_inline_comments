{"pr_number": 2374, "pr_title": "Add SimpleSpanProcessor.create and deprecate SimpleSpanProcessorBuilder", "pr_createdAt": "2020-12-21T06:16:22Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374", "timeline": [{"oid": "ac36a1ac2e062bd1606dcdfcf2b2e943cc4de8bf", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/ac36a1ac2e062bd1606dcdfcf2b2e943cc4de8bf", "message": "Deprecate SimpleSpanProcessorBuilder", "committedDate": "2020-12-21T06:15:28Z", "type": "commit"}, {"oid": "6a7f82363d2957519370e9a094b3ff5f779921a5", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/6a7f82363d2957519370e9a094b3ff5f779921a5", "message": "Null test", "committedDate": "2020-12-21T06:17:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5NTk5MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r546595990", "bodyText": "Maybe the PR title should be \"Add SimpleSpanProcessor.create()\"?", "author": "Oberon00", "createdAt": "2020-12-21T09:23:37Z", "path": "sdk/trace/src/main/java/io/opentelemetry/sdk/trace/export/SimpleSpanProcessor.java", "diffHunk": "@@ -48,19 +49,30 @@\n   private final boolean sampled;\n   private final AtomicBoolean isShutdown = new AtomicBoolean(false);\n \n+  /**\n+   * Returns a new {@link SimpleSpanProcessor} which exports spans to the {@link SpanExporter}\n+   * synchronously.\n+   */\n+  public static SpanProcessor create(SpanExporter exporter) {", "originalCommit": "6a7f82363d2957519370e9a094b3ff5f779921a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5Njk1MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r546596951", "bodyText": "I have no opinion on this point, but often we hid such classes in the past and instead used a static method in the interface. So what about making this class deprecated and later package-private and instead adding a SpanProcessor.simple(Exporter) method? (or call it wrap)", "author": "Oberon00", "createdAt": "2020-12-21T09:25:34Z", "path": "sdk/trace/src/main/java/io/opentelemetry/sdk/trace/export/SimpleSpanProcessor.java", "diffHunk": "@@ -48,19 +49,30 @@\n   private final boolean sampled;\n   private final AtomicBoolean isShutdown = new AtomicBoolean(false);\n \n+  /**\n+   * Returns a new {@link SimpleSpanProcessor} which exports spans to the {@link SpanExporter}\n+   * synchronously.\n+   */\n+  public static SpanProcessor create(SpanExporter exporter) {", "originalCommit": "6a7f82363d2957519370e9a094b3ff5f779921a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYxNDMwNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r546614306", "bodyText": "I tend to prefer the pattern but I don't know if we want the export package to leak into the top level. It feels a bit weird to me though maybe it's not such a big deal.\nA different option with better grouping would be for SpanExporter to expose the factory. But also weird. Default methods asSimpleSpanProcessor etc seems better.\nAnother idea in my head is to make this private completely and only have SdkTracerProvider.addSpanExporter(exporter, BatchSettings.noBatching()).\nNot sure if it works but is also a reason I wanted to simplify this builder away :)", "author": "anuraaga", "createdAt": "2020-12-21T10:01:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5Njk1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYxOTkyMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r546619921", "bodyText": "I think we should come to a (potentially) final decision here before removing/deprecating any public stuff. The builder is not that big a burden to maintain in the meantime. If we decide to leave the SimpleSpanProcessor public for the foreseeable future then this PR is fine, otherwise I'd prefer we leave the builder as-is for now.", "author": "Oberon00", "createdAt": "2020-12-21T10:13:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5Njk1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjYyMTI3OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r546621278", "bodyText": "I think Exporter.asSimpleSpanProcessor would be fine. Otherwise, if we somehow want to keep SpanProcessor/Exporter statically decoupled (so far the interfaces don't know about each other), we could add an utility class like ExportingSpanProcessor with a static method simple (and batchingBuilder maybe).", "author": "Oberon00", "createdAt": "2020-12-21T10:15:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjU5Njk1MQ=="}], "type": "inlineReview"}, {"oid": "a2c1910fe0e4150b103e9a751746cef97849f997", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/a2c1910fe0e4150b103e9a751746cef97849f997", "message": "Merge branch 'master' of github.com:open-telemetry/opentelemetry-java into deprecate-simplespanprocessor-builder", "committedDate": "2020-12-23T02:48:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzYxNTA5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r547615092", "bodyText": "this might be a very rare case where I would use the full Mockito.reset since I had no idea where this method was coming from without looking at imports.", "author": "jkwatson", "createdAt": "2020-12-23T03:08:58Z", "path": "opencensus-shim/src/test/java/io/opentelemetry/opencensusshim/TraceInteroperabilityTest.java", "diffHunk": "@@ -66,8 +66,20 @@\n   static {\n     spanExporter = spy(SpanExporter.class);\n     when(spanExporter.export(anyList())).thenReturn(CompletableResultCode.ofSuccess());\n+\n     SpanProcessor spanProcessor = SimpleSpanProcessor.create(spanExporter);\n-    OpenTelemetrySdk.getGlobalTracerManagement().addSpanProcessor(spanProcessor);\n+    openTelemetry =\n+        OpenTelemetrySdk.builder()\n+            .setTracerProvider(SdkTracerProvider.builder().addSpanProcessor(spanProcessor).build())\n+            .build();\n+    GlobalOpenTelemetry.set(openTelemetry);\n+  }\n+\n+  @Captor private ArgumentCaptor<Collection<SpanData>> spanDataCaptor;\n+\n+  @BeforeEach\n+  void resetMocks() {\n+    reset(spanExporter);", "originalCommit": "a2c1910fe0e4150b103e9a751746cef97849f997", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzYxOTY5OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2374#discussion_r547619699", "bodyText": "Commenting on the merge commit :)\nNot going to send a PR to rename it but if it feels any better, hopefully the method name resetMocks helps.", "author": "anuraaga", "createdAt": "2020-12-23T03:28:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzYxNTA5Mg=="}], "type": "inlineReview"}]}