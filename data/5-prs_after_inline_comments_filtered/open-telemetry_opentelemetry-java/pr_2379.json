{"pr_number": 2379, "pr_title": "Add a notion of Accumulation as the value passed between Accumulator \u2026", "pr_createdAt": "2020-12-21T20:04:56Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/2379", "timeline": [{"oid": "f80bbc2d8008127b392263ca5a236a8f0a9d5930", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f80bbc2d8008127b392263ca5a236a8f0a9d5930", "message": "Add a notion of Accumulation as the value passed between Accumulator and Processor\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-21T20:07:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkxNzI0MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2379#discussion_r546917241", "bodyText": "Do we need a spec issue for this, or just a Java issue?", "author": "jkwatson", "createdAt": "2020-12-21T20:35:10Z", "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/aggregation/Aggregations.java", "diffHunk": "@@ -186,15 +215,21 @@ public AggregatorFactory getAggregatorFactory(InstrumentValueType instrumentValu\n           : DoubleLastValueAggregator.getFactory();\n     }\n \n+    @Override\n+    public Accumulation merge(Accumulation a1, Accumulation a2) {\n+      // TODO: Define the order between accumulation.", "originalCommit": "f80bbc2d8008127b392263ca5a236a8f0a9d5930", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyMjQ1OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2379#discussion_r546922458", "bodyText": "I think right now go uses a timestamp as well associated with the entry. I left a TODO because I intend to look into this soon.", "author": "bogdandrutu", "createdAt": "2020-12-21T20:48:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkxNzI0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkxODAwNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2379#discussion_r546918006", "bodyText": "urgh. this method name is getting ugly. we should think up a better name at some point.", "author": "jkwatson", "createdAt": "2020-12-21T20:36:53Z", "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/aggregator/AbstractAggregator.java", "diffHunk": "@@ -13,24 +16,17 @@\n   private volatile boolean hasRecordings = false;\n \n   @Override\n-  public void mergeToAndReset(Aggregator other) {\n-    if (!this.getClass().isInstance(other)) {\n-      return;\n+  @Nullable\n+  public Accumulation toAccumulationThenReset() {\n+    if (!hasRecordings) {\n+      return null;\n     }\n-    doMergeAndReset(other);\n     hasRecordings = false;\n+    return doToAccumulationThenReset();\n   }\n \n-  /**\n-   * Merges the current value into the given {@code aggregator} and resets the current value in this\n-   * {@code Aggregator}.\n-   *\n-   * <p>If this method is called, you can assume that the passed in aggregator can be cast to your\n-   * self-type.\n-   *\n-   * @param aggregator The aggregator to merge with.\n-   */\n-  abstract void doMergeAndReset(Aggregator aggregator);\n+  /** Implementation of the {@code toAccumulationThenReset}. */\n+  abstract Accumulation doToAccumulationThenReset();", "originalCommit": "f80bbc2d8008127b392263ca5a236a8f0a9d5930", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkxODI2NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2379#discussion_r546918264", "bodyText": "maybe accumulateAndReset() ?", "author": "jkwatson", "createdAt": "2020-12-21T20:37:33Z", "path": "sdk/metrics/src/main/java/io/opentelemetry/sdk/metrics/aggregator/Aggregator.java", "diffHunk": "@@ -15,23 +14,11 @@\n public interface Aggregator {\n \n   /**\n-   * Merges the current value into the given {@code aggregator} and resets the current value in this\n+   * Returns the current value into as {@link Accumulation} and resets the current value in this\n    * {@code Aggregator}.\n-   *\n-   * @param aggregator value to merge into.\n-   */\n-  void mergeToAndReset(Aggregator aggregator);\n-\n-  /**\n-   * Returns the {@code Point} with the given properties and the value from this Aggregation.\n-   *\n-   * @param startEpochNanos the startEpochNanos for the {@code Point}.\n-   * @param epochNanos the epochNanos for the {@code Point}.\n-   * @param labels the labels for the {@code Point}.\n-   * @return the {@code Point} with the value from this Aggregation.\n    */\n   @Nullable\n-  Point toPoint(long startEpochNanos, long epochNanos, Labels labels);\n+  Accumulation toAccumulationThenReset();", "originalCommit": "f80bbc2d8008127b392263ca5a236a8f0a9d5930", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkyMjk5NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/2379#discussion_r546922994", "bodyText": "I like accumulate, but I would use ThenReset because it is consistent with java stream APIs.", "author": "bogdandrutu", "createdAt": "2020-12-21T20:50:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjkxODI2NA=="}], "type": "inlineReview"}, {"oid": "abcfc6bdb9d92cc8530c262d45bd3d7bfdc954d1", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/abcfc6bdb9d92cc8530c262d45bd3d7bfdc954d1", "message": "Add a notion of Accumulation as the value passed between Accumulator and Processor\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-21T20:52:55Z", "type": "commit"}, {"oid": "707ec5eae68bed7a4cc89064078a8f207d1efaf7", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/707ec5eae68bed7a4cc89064078a8f207d1efaf7", "message": "Fix PR review comments\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-21T20:58:04Z", "type": "commit"}, {"oid": "707ec5eae68bed7a4cc89064078a8f207d1efaf7", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/707ec5eae68bed7a4cc89064078a8f207d1efaf7", "message": "Fix PR review comments\n\nSigned-off-by: Bogdan Drutu <bogdandrutu@gmail.com>", "committedDate": "2020-12-21T20:58:04Z", "type": "forcePushed"}]}