{"pr_number": 1667, "pr_title": "de-duplicate fields in TraceMultiPropagator", "pr_createdAt": "2020-09-21T13:08:03Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667", "timeline": [{"oid": "074a29ae1802b78ebd316d8ed5e5f987ca2615f2", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/074a29ae1802b78ebd316d8ed5e5f987ca2615f2", "message": "de-duplicate fields in TraceMultiPropagator\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-09-21T13:07:22Z", "type": "commit"}, {"oid": "dbf935b7bd319e02c68897a75073603dce10a26f", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/dbf935b7bd319e02c68897a75073603dce10a26f", "message": "reformat\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-09-21T13:11:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Mzg1OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492043858", "bodyText": "Nit: we could skip this since it is already covered by containsOnly\nThe same at line 91", "author": "thisthat", "createdAt": "2020-09-21T13:28:18Z", "path": "extensions/trace_propagators/src/test/java/io/opentelemetry/extensions/trace/propagation/TraceMultiPropagatorTest.java", "diffHunk": "@@ -76,7 +76,20 @@ void fields() {\n \n     List<String> fields = prop.fields();\n     assertThat(fields).hasSize(4);", "originalCommit": "dbf935b7bd319e02c68897a75073603dce10a26f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwMjQ0Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492102442", "bodyText": "no, because containsOnly doesn't check duplicates.\ne.g. assertThat(Lists.newArrayList(\"one\", \"one\")).containsOnly(\"one\"); will pass.", "author": "malafeev", "createdAt": "2020-09-21T14:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Mzg1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjEwNTQ0Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492105447", "bodyText": "there is containsExactlyInAnyOrder(...) which can be used to skip checking size", "author": "malafeev", "createdAt": "2020-09-21T14:45:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Mzg1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ0NzE4Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492447183", "bodyText": "done", "author": "malafeev", "createdAt": "2020-09-22T02:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Mzg1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ3NjQ4Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492476487", "bodyText": "Thx for the clarification! The semantics of the name is misleading \ud83d\ude1d", "author": "thisthat", "createdAt": "2020-09-22T05:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjA0Mzg1OA=="}], "type": "inlineReview"}, {"oid": "63bbfb466f4a028144deae730c0ac0739380e937", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/63bbfb466f4a028144deae730c0ac0739380e937", "message": "de-duplicate fields in DefaultContextPropagators\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-09-22T02:41:44Z", "type": "commit"}, {"oid": "83e6672198827077ca2a5e12018bec274a1ff3fb", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/83e6672198827077ca2a5e12018bec274a1ff3fb", "message": "use containsExactlyInAnyOrder\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-09-22T02:45:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4NjcxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492486712", "bodyText": "Nice catch!", "author": "anuraaga", "createdAt": "2020-09-22T05:49:00Z", "path": "context_prop/src/main/java/io/opentelemetry/context/propagation/DefaultContextPropagators.java", "diffHunk": "@@ -114,7 +118,7 @@ public ContextPropagators build() {\n     private MultiTextMapPropagator(List<TextMapPropagator> textPropagators) {\n       this.textPropagators = new TextMapPropagator[textPropagators.size()];\n       textPropagators.toArray(this.textPropagators);\n-      this.allFields = getAllFields(this.textPropagators);\n+      this.allFields = Collections.unmodifiableList(getAllFields(this.textPropagators));", "originalCommit": "83e6672198827077ca2a5e12018bec274a1ff3fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4Njg5NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492486895", "bodyText": "Let's use LinkedHashSet to preserve order, users may have a reason to iterate in a specified order.", "author": "anuraaga", "createdAt": "2020-09-22T05:49:42Z", "path": "context_prop/src/main/java/io/opentelemetry/context/propagation/DefaultContextPropagators.java", "diffHunk": "@@ -123,12 +127,12 @@ private MultiTextMapPropagator(List<TextMapPropagator> textPropagators) {\n     }\n \n     private static List<String> getAllFields(TextMapPropagator[] textPropagators) {\n-      List<String> fields = new ArrayList<>();\n+      Set<String> fields = new HashSet<>();", "originalCommit": "83e6672198827077ca2a5e12018bec274a1ff3fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4OTQ0Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492489443", "bodyText": "done", "author": "malafeev", "createdAt": "2020-09-22T05:59:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4Njg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4Njk5NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492486995", "bodyText": "Ditto", "author": "anuraaga", "createdAt": "2020-09-22T05:50:02Z", "path": "extensions/trace_propagators/src/main/java/io/opentelemetry/extensions/trace/propagation/TraceMultiPropagator.java", "diffHunk": "@@ -66,11 +70,11 @@ private TraceMultiPropagator(List<TextMapPropagator> propagatorList) {\n     this.propagators = new TextMapPropagator[propagatorList.size()];\n     propagatorList.toArray(this.propagators);\n \n-    List<String> fields = new ArrayList<>();\n+    Set<String> fields = new HashSet<>();", "originalCommit": "83e6672198827077ca2a5e12018bec274a1ff3fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4OTQ3NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1667#discussion_r492489474", "bodyText": "done", "author": "malafeev", "createdAt": "2020-09-22T05:59:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjQ4Njk5NQ=="}], "type": "inlineReview"}, {"oid": "f8fc39d1547265367419cbc44b7ac03e52439329", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f8fc39d1547265367419cbc44b7ac03e52439329", "message": "use LinkedHashSet to preserve order\n\nSigned-off-by: Sergei Malafeev <sergei@malafeev.org>", "committedDate": "2020-09-22T05:59:27Z", "type": "commit"}]}