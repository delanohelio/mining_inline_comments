{"pr_number": 1913, "pr_title": "Add a method to the Baggage interface to return the current baggage in the context", "pr_createdAt": "2020-10-28T23:05:29Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913", "timeline": [{"oid": "f9978818781f6b3a5ccb313bf20605ea28c6f3c4", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f9978818781f6b3a5ccb313bf20605ea28c6f3c4", "message": "Add a method to the Baggage interface to return the current baggage in the context.", "committedDate": "2020-10-28T23:02:18Z", "type": "commit"}, {"oid": "e3fb8908039ae734494429507410b3da92cb4fa2", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/e3fb8908039ae734494429507410b3da92cb4fa2", "message": "formatting", "committedDate": "2020-10-28T23:10:55Z", "type": "commit"}, {"oid": "097d4302ca01b330d7853bb6dcbd7fbbf7bacd3e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/097d4302ca01b330d7853bb6dcbd7fbbf7bacd3e", "message": "Fix tests broken by not clearing state", "committedDate": "2020-10-28T23:31:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjA5OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513852098", "bodyText": "try/resources the scopes - guessing you had to add the root.makeCurrent to the other tests because of missing closing here but we should have tests not interfere with each other :)", "author": "anuraaga", "createdAt": "2020-10-29T01:14:07Z", "path": "api/src/test/java/io/opentelemetry/api/baggage/BaggageTest.java", "diffHunk": "@@ -0,0 +1,27 @@\n+/*\n+ * Copyright The OpenTelemetry Authors\n+ * SPDX-License-Identifier: Apache-2.0\n+ */\n+\n+package io.opentelemetry.api.baggage;\n+\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+import io.opentelemetry.context.Context;\n+import org.junit.jupiter.api.Test;\n+\n+class BaggageTest {\n+  @Test\n+  void current_empty() {\n+    Context.root().makeCurrent();", "originalCommit": "097d4302ca01b330d7853bb6dcbd7fbbf7bacd3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjM1OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513852359", "bodyText": "Though I don't think I'd make the root current here anyways, can leave this out to test \"the default\".", "author": "anuraaga", "createdAt": "2020-10-29T01:14:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjA5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg2NTE4Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513865183", "bodyText": "Though I don't think I'd make the root current here anyways, can leave this out to test \"the default\".\n\nassuming everyone else has properly closed their scopes! unlike me, apparently.", "author": "jkwatson", "createdAt": "2020-10-29T01:36:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjA5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjYwOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513852608", "bodyText": "Ditto, don't make the root current, it's the default.", "author": "anuraaga", "createdAt": "2020-10-29T01:15:07Z", "path": "api/src/test/java/io/opentelemetry/api/baggage/BaggageUtilsTest.java", "diffHunk": "@@ -9,10 +9,16 @@\n \n import io.opentelemetry.context.Context;\n import io.opentelemetry.context.Scope;\n+import org.junit.jupiter.api.BeforeEach;\n import org.junit.jupiter.api.Test;\n \n class BaggageUtilsTest {\n \n+  @BeforeEach\n+  void setUp() {\n+    Context.root().makeCurrent();", "originalCommit": "097d4302ca01b330d7853bb6dcbd7fbbf7bacd3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1ODQzMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513858432", "bodyText": "yeah, this was my tired brain doing something silly. Interestingly, it did fix up all the tests!", "author": "jkwatson", "createdAt": "2020-10-29T01:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1MjYwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg1Mjc5Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513852793", "bodyText": "Ditto", "author": "anuraaga", "createdAt": "2020-10-29T01:15:29Z", "path": "api/src/test/java/io/opentelemetry/api/baggage/ScopedBaggageTest.java", "diffHunk": "@@ -29,6 +31,11 @@\n       EntryMetadata.create(\"unlimited\");\n   private static final EntryMetadata METADATA_NO_PROPAGATION = EntryMetadata.create(\"noprop\");\n \n+  @BeforeEach\n+  void setUp() {", "originalCommit": "097d4302ca01b330d7853bb6dcbd7fbbf7bacd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7d1d4f297dc977a44d39ffc7a5501864ffb26e1c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7d1d4f297dc977a44d39ffc7a5501864ffb26e1c", "message": "don't try to code while overly tired. the result is scopes that aren't closed.", "committedDate": "2020-10-29T01:38:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzg2ODgxMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/1913#discussion_r513868811", "bodyText": "Let's remove the scope - just to make sure to test what happens when makeCurrent hasn't ever been called", "author": "anuraaga", "createdAt": "2020-10-29T01:46:08Z", "path": "api/src/test/java/io/opentelemetry/api/baggage/ScopedBaggageTest.java", "diffHunk": "@@ -31,15 +30,12 @@\n       EntryMetadata.create(\"unlimited\");\n   private static final EntryMetadata METADATA_NO_PROPAGATION = EntryMetadata.create(\"noprop\");\n \n-  @BeforeEach\n-  void setUp() {\n-    Context.root().makeCurrent();\n-  }\n-\n   @Test\n   void emptyBaggage() {\n-    Baggage defaultBaggage = BaggageUtils.getCurrentBaggage();\n-    assertThat(defaultBaggage.getEntries()).isEmpty();\n+    try (Scope s = Context.root().makeCurrent()) {", "originalCommit": "7d1d4f297dc977a44d39ffc7a5501864ffb26e1c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7c23f36cc88b6aef5f1b0291f65e7cf989804c34", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/7c23f36cc88b6aef5f1b0291f65e7cf989804c34", "message": "remove the scope to make sure the root scope has no baggage", "committedDate": "2020-10-29T01:58:02Z", "type": "commit"}]}