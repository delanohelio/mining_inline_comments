{"pr_number": 904, "pr_title": "Initial relocation of ContextUtils classes.", "pr_createdAt": "2020-02-21T04:49:50Z", "pr_url": "https://github.com/open-telemetry/opentelemetry-java/pull/904", "timeline": [{"oid": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/c7ce3ff7ea05f52d8e283924e8506083959618cf", "message": "Initial relocation of ContextUtils classes.\n\nNow they will live within the child `propagation` package,\nwith a prefix based on their cross-cutting concern, to be\nreferenced easily.", "committedDate": "2020-02-21T04:47:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ2MDg3NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382460875", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                return Context.current().withValue(DIST_CONTEXT_KEY, distContext);\n          \n          \n            \n                return withCorrelationContext(distContext, Context.current());", "author": "thisthat", "createdAt": "2020-02-21T08:50:33Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/propagation/CorrelationsContextUtils.java", "diffHunk": "@@ -44,7 +45,7 @@\n    * @return a new context with the given value set.\n    * @since 0.1.0\n    */\n-  public static Context withValue(CorrelationContext distContext) {\n+  public static Context withCorrelationContext(CorrelationContext distContext) {\n     return Context.current().withValue(DIST_CONTEXT_KEY, distContext);", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ2NTQxNg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382465416", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  Context.key(\"opentelemetry-dist-context-key\");\n          \n          \n            \n                  Context.key(\"opentelemetry-correlation-context-key\");", "author": "thisthat", "createdAt": "2020-02-21T09:00:42Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/propagation/CorrelationsContextUtils.java", "diffHunk": "@@ -32,10 +33,10 @@\n  * @since 0.1.0\n  */\n @Immutable\n-public final class ContextUtils {\n+public final class CorrelationsContextUtils {\n   private static final Context.Key<CorrelationContext> DIST_CONTEXT_KEY =\n-      Context.keyWithDefault(\n-          \"opentelemetry-dist-context-key\", EmptyCorrelationContext.getInstance());\n+      Context.key(\"opentelemetry-dist-context-key\");", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ2NjA1MQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382466051", "bodyText": "0.3.0?", "author": "thisthat", "createdAt": "2020-02-21T09:01:54Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/propagation/CorrelationsContextUtils.java", "diffHunk": "@@ -77,10 +78,23 @@ public static CorrelationContext getValue() {\n    * @return the value from the specified {@code Context}.\n    * @since 0.1.0\n    */\n-  public static CorrelationContext getValue(Context context) {\n+  public static CorrelationContext getCorrelationContext(Context context) {\n     return DIST_CONTEXT_KEY.get(context);\n   }\n \n+  /**\n+   * Returns the value from the specified {@code Context}, falling back to a default, no-op {@link\n+   * CorrelationContext}.\n+   *\n+   * @param context the specified {@code Context}.\n+   * @return the value from the specified {@code Context}.\n+   * @since 0.1.0", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3MDYwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382470605", "bodyText": "Since the method name changed, I would s/value/span in this and in the next methods' Javadoc", "author": "thisthat", "createdAt": "2020-02-21T09:12:19Z", "path": "api/src/main/java/io/opentelemetry/trace/propagation/TracingContextUtils.java", "diffHunk": "@@ -0,0 +1,178 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.trace.propagation;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.Scope;\n+import io.opentelemetry.context.propagation.ContextUtils;\n+import io.opentelemetry.trace.DefaultSpan;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.SpanContext;\n+import io.opentelemetry.trace.Tracer;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Util methods/functionality to interact with the {@link io.grpc.Context}.\n+ *\n+ * <p>Users must interact with the current Context via the public APIs in {@link Tracer} and avoid\n+ * accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class TracingContextUtils {\n+  private static final Context.Key<Span> CONTEXT_SPAN_KEY =\n+      Context.<Span>key(\"opentelemetry-trace-span-key\");\n+  private static final Context.Key<SpanContext> CONTEXT_SPANCONTEXT_KEY =\n+      Context.<SpanContext>key(\"opentelemetry-trace-spancontext-key\");\n+  private static final Span DEFAULT_SPAN = DefaultSpan.getInvalid();\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3MzY4OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382473689", "bodyText": "Why DistributedContext in the name?", "author": "thisthat", "createdAt": "2020-02-21T09:18:48Z", "path": "api/src/test/java/io/opentelemetry/correlationcontext/propagation/CorrelationsContextUtilsTest.java", "diffHunk": "@@ -24,40 +24,37 @@\n import org.junit.runner.RunWith;\n import org.junit.runners.JUnit4;\n \n-/** Unit tests for {@link ContextUtils}. */\n+/** Unit tests for {@link CorrelationsContextUtils}. */\n @RunWith(JUnit4.class)\n-public final class ContextUtilsTest {\n+public final class CorrelationsContextUtilsTest {\n   @Test\n-  public void testGetCurrentCorrelationContex_DefaultContext() {\n-    CorrelationContext distContext = ContextUtils.getValue(Context.current());\n-    assertThat(distContext).isNotNull();\n-    assertThat(distContext.getEntries()).isEmpty();\n+  public void testGetCurrentDistributedContext_DefaultContext() {", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY0NTk5OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r383645998", "bodyText": "Oops, one of the remnants of the old code (that I didn't detect)", "author": "carlosalberto", "createdAt": "2020-02-25T03:53:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3MzY4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQ3Mzk0OA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382473948", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                CorrelationContext distContext =\n          \n          \n            \n                CorrelationContext corrContext =", "author": "thisthat", "createdAt": "2020-02-21T09:19:22Z", "path": "api/src/test/java/io/opentelemetry/correlationcontext/propagation/CorrelationsContextUtilsTest.java", "diffHunk": "@@ -24,40 +24,37 @@\n import org.junit.runner.RunWith;\n import org.junit.runners.JUnit4;\n \n-/** Unit tests for {@link ContextUtils}. */\n+/** Unit tests for {@link CorrelationsContextUtils}. */\n @RunWith(JUnit4.class)\n-public final class ContextUtilsTest {\n+public final class CorrelationsContextUtilsTest {\n   @Test\n-  public void testGetCurrentCorrelationContex_DefaultContext() {\n-    CorrelationContext distContext = ContextUtils.getValue(Context.current());\n-    assertThat(distContext).isNotNull();\n-    assertThat(distContext.getEntries()).isEmpty();\n+  public void testGetCurrentDistributedContext_DefaultContext() {\n+    CorrelationContext distContext =", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzI5OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382727299", "bodyText": "I would keep them just in \"trace\".", "author": "bogdandrutu", "createdAt": "2020-02-21T18:07:21Z", "path": "api/src/main/java/io/opentelemetry/trace/propagation/TracingContextUtils.java", "diffHunk": "@@ -0,0 +1,178 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.trace.propagation;", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzY2NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382727665", "bodyText": "Not sure why we need 2 elements in the Context", "author": "bogdandrutu", "createdAt": "2020-02-21T18:08:13Z", "path": "api/src/main/java/io/opentelemetry/trace/propagation/TracingContextUtils.java", "diffHunk": "@@ -0,0 +1,178 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.trace.propagation;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.Scope;\n+import io.opentelemetry.context.propagation.ContextUtils;\n+import io.opentelemetry.trace.DefaultSpan;\n+import io.opentelemetry.trace.Span;\n+import io.opentelemetry.trace.SpanContext;\n+import io.opentelemetry.trace.Tracer;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Util methods/functionality to interact with the {@link io.grpc.Context}.\n+ *\n+ * <p>Users must interact with the current Context via the public APIs in {@link Tracer} and avoid\n+ * accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class TracingContextUtils {\n+  private static final Context.Key<Span> CONTEXT_SPAN_KEY =\n+      Context.<Span>key(\"opentelemetry-trace-span-key\");\n+  private static final Context.Key<SpanContext> CONTEXT_SPANCONTEXT_KEY =\n+      Context.<SpanContext>key(\"opentelemetry-trace-spancontext-key\");\n+  private static final Span DEFAULT_SPAN = DefaultSpan.getInvalid();\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param span the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withSpan(Span span) {\n+    return withSpan(span, Context.current());\n+  }\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param span the value to be set.\n+   * @param context the parent {@code Context}.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withSpan(Span span, Context context) {\n+    return context.withValue(CONTEXT_SPAN_KEY, span);\n+  }\n+\n+  /**\n+   * Creates a new {@code Context} with the given {@code SpanContext} set.\n+   *\n+   * @param spanContext the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.3.0\n+   */\n+  public static Context withSpanContext(SpanContext spanContext) {\n+    return withSpanContext(spanContext, Context.current());\n+  }", "originalCommit": "c7ce3ff7ea05f52d8e283924e8506083959618cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyODE2Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r382728163", "bodyText": "Are we suggesting to add always both of them? It is hard to keep them in sync probably.", "author": "bogdandrutu", "createdAt": "2020-02-21T18:09:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzY1NTIyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r383655223", "bodyText": "Oh, we are simply putting spanContext in Context.current().\nOr maybe you are talking about the possibility to have in a given Context, at some moment, both SpanContext and Span? If that's the case, this can happen, but Span will be preferred (as mentioned in the Specification).", "author": "carlosalberto", "createdAt": "2020-02-25T04:40:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc4MTgwMA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r384781800", "bodyText": "I am not sure that this is the right thing to do, I would stick with only Span in the Context until we prove that it is not possible.", "author": "bogdandrutu", "createdAt": "2020-02-26T21:37:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2ODg4Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r385268887", "bodyText": "Well, at this time we need to store SpanContext when doing extraction:\n// newCtx will contain a SpanContext instance.\nContext newCtx = propagator.extract(...);\nThis is also covered in the specification now - unless you plan to drop SpanContext entirely, and use it always through DefaultSpan for this (which can be used a pseudo parent, that is).", "author": "carlosalberto", "createdAt": "2020-02-27T17:45:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzNTY1MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r385335650", "bodyText": "Let's not add it right now, so that gives me some time to think a bit more. We can for the moment just move what was already available without adding the SpanContext for the moment.", "author": "bogdandrutu", "createdAt": "2020-02-27T19:51:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjcyNzY2NQ=="}], "type": "inlineReview"}, {"oid": "f9a13962c7453d60fc8da9dff194f233fe1e238c", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/f9a13962c7453d60fc8da9dff194f233fe1e238c", "message": "Style/typos/fixes for names.", "committedDate": "2020-02-25T04:36:57Z", "type": "commit"}, {"oid": "93c9698c976a96ec0333f0bfa2d902d9b3596868", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/93c9698c976a96ec0333f0bfa2d902d9b3596868", "message": "Puyt the *ContextUtils at their top-level directories.", "committedDate": "2020-02-25T05:10:06Z", "type": "commit"}, {"oid": "93c9698c976a96ec0333f0bfa2d902d9b3596868", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/93c9698c976a96ec0333f0bfa2d902d9b3596868", "message": "Puyt the *ContextUtils at their top-level directories.", "committedDate": "2020-02-25T05:10:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzE3NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r384757174", "bodyText": "Why not having getCorrelationContext never return null as it was before?", "author": "bogdandrutu", "createdAt": "2020-02-26T20:50:36Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/CorrelationsContextUtils.java", "diffHunk": "@@ -77,21 +76,35 @@ public static CorrelationContext getValue() {\n    * @return the value from the specified {@code Context}.\n    * @since 0.1.0\n    */\n-  public static CorrelationContext getValue(Context context) {\n-    return DIST_CONTEXT_KEY.get(context);\n+  public static CorrelationContext getCorrelationContext(Context context) {\n+    return CORR_CONTEXT_KEY.get(context);\n+  }\n+\n+  /**\n+   * Returns the value from the specified {@code Context}, falling back to a default, no-op {@link\n+   * CorrelationContext}.\n+   *\n+   * @param context the specified {@code Context}.\n+   * @return the value from the specified {@code Context}.\n+   * @since 0.3.0\n+   */\n+  public static CorrelationContext getCorrelationContextWithDefault(Context context) {\n+    CorrelationContext corrContext = CORR_CONTEXT_KEY.get(context);\n+    return corrContext == null ? DEFAULT_VALUE : corrContext;", "originalCommit": "93c9698c976a96ec0333f0bfa2d902d9b3596868", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc5OTAyMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r384799022", "bodyText": "I see the explanation in the description:\n\nI would suggest actually to have a getCorrelationContextWithoutDefault because the version with default will be the most used.\nI would suggest that we do not offer a getCorrelationContextWithoutDefault for the current Context because it will be used only by the propagators so limiting the API.", "author": "bogdandrutu", "createdAt": "2020-02-26T22:12:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTI2OTk2Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r385269963", "bodyText": "Ok, we can do that. Will update the code.\n\nI would suggest that we do not offer a getCorrelationContextWithoutDefault for the current Context because it will be used only by the propagators so limiting the API.\n\nSure, this works as well. We can always add it in the future if/as needed.", "author": "carlosalberto", "createdAt": "2020-02-27T17:47:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzE3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTMzNjIyOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r385336228", "bodyText": "Please update everywhere (span included).", "author": "bogdandrutu", "createdAt": "2020-02-27T19:52:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzE3NA=="}], "type": "inlineReview"}, {"oid": "d3d1b72c00877ac4666929e64ea08f5e6f301dc3", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/d3d1b72c00877ac4666929e64ea08f5e6f301dc3", "message": "Have the default versions of *ContextUtils return no-op values.", "committedDate": "2020-03-05T01:01:55Z", "type": "commit"}, {"oid": "71193e5e9c3eed21ae07d8d8692025fb87462770", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/71193e5e9c3eed21ae07d8d8692025fb87462770", "message": "Remove for now the SpanContext bits from TracingContextUtils.", "committedDate": "2020-03-05T01:09:14Z", "type": "commit"}, {"oid": "acef22237e73a36efca4d49c9fef5230dd682758", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/acef22237e73a36efca4d49c9fef5230dd682758", "message": "Merge branch 'master' into contextutils_relocation", "committedDate": "2020-03-05T01:26:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NzA3Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388387072", "bodyText": "I think you better say:\nempty {@link CorrelationContext}.", "author": "bogdandrutu", "createdAt": "2020-03-05T15:56:06Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/CorrelationsContextUtils.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.correlationcontext;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Utility methods for accessing the {@link CorrelationContext} contained in the {@link\n+ * io.grpc.Context}.\n+ *\n+ * <p>Most code should interact with the current context via the public APIs in {@link\n+ * CorrelationContext} and avoid accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class CorrelationsContextUtils {\n+  private static final Context.Key<CorrelationContext> CORR_CONTEXT_KEY =\n+      Context.key(\"opentelemetry-corr-context-key\");\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext) {\n+    return withCorrelationContext(corrContext, Context.current());\n+  }\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @param context the parent {@code Context}.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext, Context context) {\n+    return context.withValue(CORR_CONTEXT_KEY, corrContext);\n+  }\n+\n+  /**\n+   * Returns the {@link CorrelationContext} from the current {@code Context}, falling back to a\n+   * default, no-op {@link CorrelationContext}.", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NjE1Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388496157", "bodyText": "The intention is the same ;) But lets go with empty CorrelationContext ;)", "author": "carlosalberto", "createdAt": "2020-03-05T18:58:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4NzA3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4ODg3Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388388872", "bodyText": "Not sure I understand this comment. I think I am ok with people using these methods directly.", "author": "bogdandrutu", "createdAt": "2020-03-05T15:58:40Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/CorrelationsContextUtils.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.correlationcontext;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Utility methods for accessing the {@link CorrelationContext} contained in the {@link\n+ * io.grpc.Context}.\n+ *\n+ * <p>Most code should interact with the current context via the public APIs in {@link\n+ * CorrelationContext} and avoid accessing this class directly.", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5NzM5MA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388497390", "bodyText": "Oh, the idea behind this is that users shouldn't use this class(es) directly, but instead use the ones offered by Tracer and CorrelationContextManager (such as getCurrentSpan()), but lets remove this text while the related issue is resolved ;)", "author": "carlosalberto", "createdAt": "2020-03-05T19:00:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM4ODg3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5MDgzMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388390831", "bodyText": "Let's remove this for the moment, people can use the other version.", "author": "bogdandrutu", "createdAt": "2020-03-05T16:00:42Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/CorrelationsContextUtils.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.correlationcontext;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Utility methods for accessing the {@link CorrelationContext} contained in the {@link\n+ * io.grpc.Context}.\n+ *\n+ * <p>Most code should interact with the current context via the public APIs in {@link\n+ * CorrelationContext} and avoid accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class CorrelationsContextUtils {\n+  private static final Context.Key<CorrelationContext> CORR_CONTEXT_KEY =\n+      Context.key(\"opentelemetry-corr-context-key\");\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext) {\n+    return withCorrelationContext(corrContext, Context.current());\n+  }", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5ODgxMg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388498812", "bodyText": "Keep the version returning a Scope?", "author": "carlosalberto", "createdAt": "2020-03-05T19:03:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5MDgzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5MTE1NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388391154", "bodyText": "getCurrentCorrelationContext?", "author": "bogdandrutu", "createdAt": "2020-03-05T16:01:02Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/CorrelationsContextUtils.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.correlationcontext;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Utility methods for accessing the {@link CorrelationContext} contained in the {@link\n+ * io.grpc.Context}.\n+ *\n+ * <p>Most code should interact with the current context via the public APIs in {@link\n+ * CorrelationContext} and avoid accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class CorrelationsContextUtils {\n+  private static final Context.Key<CorrelationContext> CORR_CONTEXT_KEY =\n+      Context.key(\"opentelemetry-corr-context-key\");\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext) {\n+    return withCorrelationContext(corrContext, Context.current());\n+  }\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @param context the parent {@code Context}.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext, Context context) {\n+    return context.withValue(CORR_CONTEXT_KEY, corrContext);\n+  }\n+\n+  /**\n+   * Returns the {@link CorrelationContext} from the current {@code Context}, falling back to a\n+   * default, no-op {@link CorrelationContext}.\n+   *\n+   * @return the {@link CorrelationContext} from the current {@code Context}.\n+   * @since 0.3.0\n+   */\n+  public static CorrelationContext getCorrelationContext() {", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5Nzg0Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388497847", "bodyText": "I'm fine with the proposed change, will change it.", "author": "carlosalberto", "createdAt": "2020-03-05T19:01:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5MTE1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTM2Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388395366", "bodyText": "This needs to signal that it interacts with the \"Current\" Context. Maybe rename:\ncurrentContextWith(CorrelationContext corrContext)", "author": "bogdandrutu", "createdAt": "2020-03-05T16:07:14Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/CorrelationsContextUtils.java", "diffHunk": "@@ -0,0 +1,113 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.correlationcontext;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Utility methods for accessing the {@link CorrelationContext} contained in the {@link\n+ * io.grpc.Context}.\n+ *\n+ * <p>Most code should interact with the current context via the public APIs in {@link\n+ * CorrelationContext} and avoid accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class CorrelationsContextUtils {\n+  private static final Context.Key<CorrelationContext> CORR_CONTEXT_KEY =\n+      Context.key(\"opentelemetry-corr-context-key\");\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext) {\n+    return withCorrelationContext(corrContext, Context.current());\n+  }\n+\n+  /**\n+   * Creates a new {@code Context} with the given value set.\n+   *\n+   * @param corrContext the value to be set.\n+   * @param context the parent {@code Context}.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withCorrelationContext(CorrelationContext corrContext, Context context) {\n+    return context.withValue(CORR_CONTEXT_KEY, corrContext);\n+  }\n+\n+  /**\n+   * Returns the {@link CorrelationContext} from the current {@code Context}, falling back to a\n+   * default, no-op {@link CorrelationContext}.\n+   *\n+   * @return the {@link CorrelationContext} from the current {@code Context}.\n+   * @since 0.3.0\n+   */\n+  public static CorrelationContext getCorrelationContext() {\n+    return getCorrelationContext(Context.current());\n+  }\n+\n+  /**\n+   * Returns the {@link CorrelationContext} from the specified {@code Context}, falling back to a\n+   * default, no-op {@link CorrelationContext}.\n+   *\n+   * @param context the specified {@code Context}.\n+   * @return the {@link CorrelationContext} from the specified {@code Context}.\n+   * @since 0.3.0\n+   */\n+  public static CorrelationContext getCorrelationContext(Context context) {\n+    CorrelationContext corrContext = CORR_CONTEXT_KEY.get(context);\n+    return corrContext == null ? EmptyCorrelationContext.getInstance() : corrContext;\n+  }\n+\n+  /**\n+   * Returns the {@link CorrelationContext} from the specified {@code Context}. If none is found,\n+   * this method returns {code null}.\n+   *\n+   * @param context the specified {@code Context}.\n+   * @return the {@link CorrelationContext} from the specified {@code Context}.\n+   * @since 0.1.0\n+   */\n+  @Nullable\n+  public static CorrelationContext getCorrelationContextWithoutDefault(Context context) {\n+    return CORR_CONTEXT_KEY.get(context);\n+  }\n+\n+  /**\n+   * Returns a new {@link Scope} encapsulating the provided {@link CorrelationContext} added to the\n+   * current {@code Context}.\n+   *\n+   * @param corrContext the {@link CorrelationContext} to be added to the current {@code Context}.\n+   * @return the {@link Scope} for the updated {@code Context}.\n+   * @since 0.1.0\n+   */\n+  public static Scope withScopedCorrelationContext(CorrelationContext corrContext) {\n+    Context context = withCorrelationContext(corrContext);\n+    return ContextUtils.withScopedContext(context);\n+  }", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM4NjU4Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389386582", "bodyText": "Will follow this up in another PR.", "author": "carlosalberto", "createdAt": "2020-03-08T16:54:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTM2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjQ5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388396492", "bodyText": "Can we file an issue to remove these? Also I would suggest removing them because adding them later is backwards  compatible.", "author": "bogdandrutu", "createdAt": "2020-03-05T16:08:50Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/DefaultCorrelationContextManager.java", "diffHunk": "@@ -50,7 +50,7 @@ public static CorrelationContextManager getInstance() {\n \n   @Override\n   public CorrelationContext getCurrentContext() {\n-    return ContextUtils.getValue();\n+    return CorrelationsContextUtils.getCorrelationContext(Context.current());\n   }", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5ODM5Mg==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388498392", "bodyText": "I guess this is what you are talking about? ;) open-telemetry/opentelemetry-specification#455", "author": "carlosalberto", "createdAt": "2020-03-05T19:02:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjQ5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA4MDExOA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389080118", "bodyText": "Is this solved? Or this is something else you are talking about?", "author": "carlosalberto", "createdAt": "2020-03-06T18:51:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjQ5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjkwOQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388396909", "bodyText": "Remove this?", "author": "bogdandrutu", "createdAt": "2020-03-05T16:09:26Z", "path": "api/src/main/java/io/opentelemetry/trace/TracingContextUtils.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.trace;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Util methods/functionality to interact with the {@link io.grpc.Context}.\n+ *\n+ * <p>Users must interact with the current Context via the public APIs in {@link Tracer} and avoid\n+ * accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class TracingContextUtils {\n+  private static final Context.Key<Span> CONTEXT_SPAN_KEY =\n+      Context.<Span>key(\"opentelemetry-trace-span-key\");\n+  private static final Context.Key<SpanContext> CONTEXT_SPANCONTEXT_KEY =\n+      Context.<SpanContext>key(\"opentelemetry-trace-spancontext-key\");", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODQ5ODUyMw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388498523", "bodyText": "Oh, my bad, yes ;)", "author": "carlosalberto", "createdAt": "2020-03-05T19:02:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjkwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NzE3Ng==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r388397176", "bodyText": "Same comments apply here.", "author": "bogdandrutu", "createdAt": "2020-03-05T16:09:51Z", "path": "api/src/main/java/io/opentelemetry/trace/TracingContextUtils.java", "diffHunk": "@@ -0,0 +1,136 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.trace;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Util methods/functionality to interact with the {@link io.grpc.Context}.\n+ *\n+ * <p>Users must interact with the current Context via the public APIs in {@link Tracer} and avoid\n+ * accessing this class directly.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class TracingContextUtils {", "originalCommit": "acef22237e73a36efca4d49c9fef5230dd682758", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b4249cd1f1029a6effe9634cfc25437dc2730b04", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b4249cd1f1029a6effe9634cfc25437dc2730b04", "message": "Remove more SpanContext related bits.", "committedDate": "2020-03-05T19:48:29Z", "type": "commit"}, {"oid": "fb909129ebd720641eca4c3e997df618f5aed0ab", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/fb909129ebd720641eca4c3e997df618f5aed0ab", "message": "Rename the parameterless get*() methods to getCurrent*().", "committedDate": "2020-03-05T19:56:25Z", "type": "commit"}, {"oid": "3e881bd64de1021fd239a6380183e6bb994d276b", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/3e881bd64de1021fd239a6380183e6bb994d276b", "message": "State we use an empty CorrelationContext if there's no an active one.", "committedDate": "2020-03-05T19:59:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODQ4Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389068483", "bodyText": "Remove this as we did in the CorrelationContext.", "author": "bogdandrutu", "createdAt": "2020-03-06T18:27:18Z", "path": "api/src/main/java/io/opentelemetry/trace/TracingContextUtils.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright 2019, OpenTelemetry Authors\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.opentelemetry.trace;\n+\n+import io.grpc.Context;\n+import io.opentelemetry.context.ContextUtils;\n+import io.opentelemetry.context.Scope;\n+import javax.annotation.Nullable;\n+import javax.annotation.concurrent.Immutable;\n+\n+/**\n+ * Util methods/functionality to interact with the {@link io.grpc.Context}.\n+ *\n+ * @since 0.1.0\n+ */\n+@Immutable\n+public final class TracingContextUtils {\n+  private static final Context.Key<Span> CONTEXT_SPAN_KEY =\n+      Context.<Span>key(\"opentelemetry-trace-span-key\");\n+\n+  /**\n+   * Creates a new {@code Context} with the given {@link Span} set.\n+   *\n+   * @param span the value to be set.\n+   * @return a new context with the given value set.\n+   * @since 0.1.0\n+   */\n+  public static Context withSpan(Span span) {\n+    return withSpan(span, Context.current());\n+  }\n+", "originalCommit": "3e881bd64de1021fd239a6380183e6bb994d276b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA3OTI1Mw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389079253", "bodyText": "We still have Context withCorrelationContext(Correlation Context) there. Maybe you are talking about removing the one of the overloads of these methods?", "author": "carlosalberto", "createdAt": "2020-03-06T18:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODQ4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExMDU3OQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389110579", "bodyText": "Yes, let's keep only the version that accepts both the object (span, correlation) and the Context.", "author": "bogdandrutu", "createdAt": "2020-03-06T19:48:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODQ4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTM4NjM5Nw==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389386397", "bodyText": "Done. Lets definitely add them again if/as needed.", "author": "carlosalberto", "createdAt": "2020-03-08T16:51:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODY4NA==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389068684", "bodyText": "getCurrentCorrelationContext?", "author": "bogdandrutu", "createdAt": "2020-03-06T18:27:42Z", "path": "api/src/main/java/io/opentelemetry/correlationcontext/DefaultCorrelationContextManager.java", "diffHunk": "@@ -50,7 +50,7 @@ public static CorrelationContextManager getInstance() {\n \n   @Override\n   public CorrelationContext getCurrentContext() {\n-    return ContextUtils.getValue();\n+    return CorrelationsContextUtils.getCorrelationContext(Context.current());", "originalCommit": "3e881bd64de1021fd239a6380183e6bb994d276b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA3OTMzMQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389079331", "bodyText": "Gotcha.", "author": "carlosalberto", "createdAt": "2020-03-06T18:49:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODY4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODc5NQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389068795", "bodyText": "getCurrentSpan()?", "author": "bogdandrutu", "createdAt": "2020-03-06T18:27:58Z", "path": "api/src/main/java/io/opentelemetry/trace/DefaultTracer.java", "diffHunk": "@@ -46,12 +46,12 @@ public static Tracer getInstance() {\n \n   @Override\n   public Span getCurrentSpan() {\n-    return ContextUtils.getValue();\n+    return TracingContextUtils.getSpan(Context.current());", "originalCommit": "3e881bd64de1021fd239a6380183e6bb994d276b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA3OTQwNQ==", "url": "https://github.com/open-telemetry/opentelemetry-java/pull/904#discussion_r389079405", "bodyText": "Will update as well.", "author": "carlosalberto", "createdAt": "2020-03-06T18:49:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTA2ODc5NQ=="}], "type": "inlineReview"}, {"oid": "6ad93c45c211041936b7d0f7720091b471b5e83d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/6ad93c45c211041936b7d0f7720091b471b5e83d", "message": "Use the getCurrent*() overloads whenever possible.", "committedDate": "2020-03-06T19:00:00Z", "type": "commit"}, {"oid": "da1a7e9124151609aabc8203ed623dc7fe555c3d", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/da1a7e9124151609aabc8203ed623dc7fe555c3d", "message": "Remove the with*() overloads without Context as a parameter.", "committedDate": "2020-03-08T16:32:08Z", "type": "commit"}, {"oid": "b49a43207cdbdaa8764707b05ff7b66bbe2c2e8e", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/b49a43207cdbdaa8764707b05ff7b66bbe2c2e8e", "message": "Merge branch 'master' into contextutils_relocation", "committedDate": "2020-03-08T16:46:48Z", "type": "commit"}, {"oid": "58a66b64495c72f221dc2248b43381ae1c12ad3a", "url": "https://github.com/open-telemetry/opentelemetry-java/commit/58a66b64495c72f221dc2248b43381ae1c12ad3a", "message": "Remove outdated warnings.", "committedDate": "2020-03-08T16:58:37Z", "type": "commit"}]}