{"pr_number": 4207, "pr_title": "Plfm 6390", "pr_createdAt": "2020-09-23T22:16:34Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207", "timeline": [{"oid": "e7e0b801c7e5ba2d2ed96baff9f9b4e07d0c4956", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e7e0b801c7e5ba2d2ed96baff9f9b4e07d0c4956", "message": "throw exception, validate", "committedDate": "2020-09-18T20:08:23Z", "type": "commit"}, {"oid": "97e073ae0a1ddc497c66aa45b6950df1cc17a31f", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/97e073ae0a1ddc497c66aa45b6950df1cc17a31f", "message": " added get Team to check valid team", "committedDate": "2020-09-23T20:05:10Z", "type": "commit"}, {"oid": "c298820f9899f8190c417c2c7c72155385f62178", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/c298820f9899f8190c417c2c7c72155385f62178", "message": " merge conflict -- resolved", "committedDate": "2020-09-23T20:15:10Z", "type": "commit"}, {"oid": "ec17dc094c78627c111e833b215a992a9e45d436", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ec17dc094c78627c111e833b215a992a9e45d436", "message": "minor change", "committedDate": "2020-09-23T21:31:55Z", "type": "commit"}, {"oid": "503b92d6c2a48bbe0101f6f84b6b5fdbc2ef1e47", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/503b92d6c2a48bbe0101f6f84b6b5fdbc2ef1e47", "message": " added more tests", "committedDate": "2020-09-24T18:00:33Z", "type": "commit"}, {"oid": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/76ad3ed56514b86aad2cc4a45134bf74396124f3", "message": " call under test", "committedDate": "2020-09-24T18:05:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4NDc5Mw==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494584793", "bodyText": "If we want to use a more friendly message, it makes sense to do this at the DAO so that the message is coherent wherever it is used.", "author": "marcomarasca", "createdAt": "2020-09-24T20:15:35Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/team/TeamManagerImpl.java", "diffHunk": "@@ -437,8 +439,12 @@ public PaginatedTeamIds listIdsByMember(String teamMemberId, String nextPageToke\n \t * @see org.sagebionetworks.repo.manager.team.TeamManager#get(java.lang.String)\n \t */\n \t@Override\n-\tpublic Team get(String id) throws DatastoreException, NotFoundException {\n-\t\treturn teamDAO.get(id);\n+\tpublic Team get(String teamId) throws DatastoreException, NotFoundException {\n+\t\ttry {\n+\t\t\treturn teamDAO.get(teamId);\n+\t\t} catch (NotFoundException e) {\n+\t\t\tthrow new NotFoundException(\"Team does not exist for teamId: \" + teamId ,e);", "originalCommit": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4OTcxNA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494589714", "bodyText": "Could be a better approach to create a dedicated validation method that takes in input the id of the team and checks its existence, maybe without fetching the whole team data from the database.", "author": "marcomarasca", "createdAt": "2020-09-24T20:25:20Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/team/TeamManagerImpl.java", "diffHunk": "@@ -335,7 +335,8 @@ private void bindTeamName(String name, Long teamId){\n \n \t@Override\n \tpublic PaginatedResults<TeamMember> listMembers(String teamId, TeamMemberTypeFilterOptions memberType, long limit,\n-\t\t\tlong offset) throws DatastoreException {\n+\t\t\tlong offset) throws DatastoreException, NotFoundException {\n+\t\tget(teamId);", "originalCommit": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NDA5Mg==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494594092", "bodyText": "Let us upgrade to Junit 5, make sure the class extends AbstractAutowiredControllerJunit5TestBase", "author": "marcomarasca", "createdAt": "2020-09-24T20:33:31Z", "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -64,4 +68,27 @@ public void testListTeams() throws Exception {\n \tpublic void testGetTeamIdsByMember() throws Exception {\n \t\tservletTestHelper.getTeamIdsByMember(dispatchServlet, 1L, TeamSortOrder.TEAM_NAME, true);\n \t}\n+\n+\t/**\n+\t * PLFM-6390\n+\t * @throws Exception\n+\t */\n+\t@Test", "originalCommit": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NDU3OA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494594578", "bodyText": "Might be worth adding a test to the TeamServiceAutowireTest.", "author": "marcomarasca", "createdAt": "2020-09-24T20:34:25Z", "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -64,4 +68,27 @@ public void testListTeams() throws Exception {\n \tpublic void testGetTeamIdsByMember() throws Exception {\n \t\tservletTestHelper.getTeamIdsByMember(dispatchServlet, 1L, TeamSortOrder.TEAM_NAME, true);\n \t}\n+\n+\t/**\n+\t * PLFM-6390\n+\t * @throws Exception\n+\t */\n+\t@Test\n+\tpublic void testGetTeamMembersByInvalidId() throws Exception {", "originalCommit": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5NTU3MQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r494595571", "bodyText": "Let us extract the expected message to its own variable.", "author": "marcomarasca", "createdAt": "2020-09-24T20:36:25Z", "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -64,4 +68,27 @@ public void testListTeams() throws Exception {\n \tpublic void testGetTeamIdsByMember() throws Exception {\n \t\tservletTestHelper.getTeamIdsByMember(dispatchServlet, 1L, TeamSortOrder.TEAM_NAME, true);\n \t}\n+\n+\t/**\n+\t * PLFM-6390\n+\t * @throws Exception\n+\t */\n+\t@Test\n+\tpublic void testGetTeamMembersByInvalidId() throws Exception {\n+\t\tString invalidTeamId = \"000\";\n+\t\tNotFoundException exception = Assertions.assertThrows(NotFoundException.class, () -> {\n+\t\t\t// Call under test\n+\t\t\tservletTestHelper.getTeamMembersWithTeamId(dispatchServlet, adminUserId, invalidTeamId);\n+\t\t});\n+\t\tAssert.assertEquals(\"{\\\"reason\\\":\\\"Team does not exist for teamId: \" + invalidTeamId + \"\\\"}\", exception.getMessage());", "originalCommit": "76ad3ed56514b86aad2cc4a45134bf74396124f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dbaee031beb05f416b3697fca298fc45b84908ed", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/dbaee031beb05f416b3697fca298fc45b84908ed", "message": " added checkTeamExists teamDAO", "committedDate": "2020-09-25T00:51:39Z", "type": "commit"}, {"oid": "37f59c33216c4fcde6b9a9722f9fabdcb576a6fe", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/37f59c33216c4fcde6b9a9722f9fabdcb576a6fe", "message": " junit 5", "committedDate": "2020-09-25T17:11:26Z", "type": "commit"}, {"oid": "cf0fc27b0f4d110b5e6a6b8aec2a4418ebe5f60c", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/cf0fc27b0f4d110b5e6a6b8aec2a4418ebe5f60c", "message": " junit 5 autowire", "committedDate": "2020-09-25T17:12:54Z", "type": "commit"}, {"oid": "d6e0a3b14217e3fc2bf25ba52c8894c4b0632f4e", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/d6e0a3b14217e3fc2bf25ba52c8894c4b0632f4e", "message": "pull request changes, junit5, tests", "committedDate": "2020-09-25T21:19:25Z", "type": "commit"}, {"oid": "37fe1e3eda7c89b72566b6757cda4d5f9f312ab1", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/37fe1e3eda7c89b72566b6757cda4d5f9f312ab1", "message": "Merge branch 'develop' into PLFM-6390", "committedDate": "2020-09-25T21:21:30Z", "type": "commit"}, {"oid": "1f99def6ffe28782fa0b81ccce5f32d37666d725", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/1f99def6ffe28782fa0b81ccce5f32d37666d725", "message": "minor changes", "committedDate": "2020-09-25T21:26:05Z", "type": "commit"}, {"oid": "13f897f0fa4a84b7ffc968727ea00c7740ef682d", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/13f897f0fa4a84b7ffc968727ea00c7740ef682d", "message": "small change", "committedDate": "2020-09-25T21:28:15Z", "type": "commit"}, {"oid": "8a5b95f17729cea5bf60c44e704f582c427432e0", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/8a5b95f17729cea5bf60c44e704f582c427432e0", "message": " validateam getfileHandleId", "committedDate": "2020-09-25T21:43:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEyOTA4Nw==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496129087", "bodyText": "The limit 1 is not required, this query will always return 1 value.", "author": "marcomarasca", "createdAt": "2020-09-28T17:49:22Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -193,6 +193,8 @@\n \t\t\t\t+\" FROM \"+TeamUtils.ALL_TEAMS_AND_ADMIN_MEMBERS_CORE\n \t\t\t\t+\" AND gm.\"+COL_GROUP_MEMBERS_MEMBER_ID+\"=:\"+COL_GROUP_MEMBERS_MEMBER_ID;\n \n+\tprivate static final String SELECT_CHECK_TEAM_EXISTS = \"SELECT COUNT(*) FROM \" + TABLE_TEAM + \" WHERE \" + COL_TEAM_ID + \" = ? LIMIT 1\";", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzMTY1OA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496131658", "bodyText": "Missing @OverRide annotation", "author": "marcomarasca", "createdAt": "2020-09-28T17:53:42Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -316,6 +318,13 @@ public Team get(String id) throws DatastoreException, NotFoundException {\n \t\tTeam dto = TeamUtils.copyDboToDto(dbo);\n \t\treturn dto;\n \t}\n+\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException {", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzMjU3NA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496132574", "bodyText": "As previously noted, if you want to have a consistent message this can be applied to the get in the dao", "author": "marcomarasca", "createdAt": "2020-09-28T17:55:17Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -316,6 +318,13 @@ public Team get(String id) throws DatastoreException, NotFoundException {\n \t\tTeam dto = TeamUtils.copyDboToDto(dbo);\n \t\treturn dto;\n \t}\n+\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException {\n+\t\tLong exists = jdbcTemplate.queryForObject(SELECT_CHECK_TEAM_EXISTS, Long.class, teamId);\n+\t\tif (exists == 0) {\n+\t\t\tthrow new NotFoundException(\"Team does not exist for teamId: \" + teamId);", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzMzkwNA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496133904", "bodyText": "You can return a boolean from your query", "author": "marcomarasca", "createdAt": "2020-09-28T17:57:33Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImpl.java", "diffHunk": "@@ -316,6 +318,13 @@ public Team get(String id) throws DatastoreException, NotFoundException {\n \t\tTeam dto = TeamUtils.copyDboToDto(dbo);\n \t\treturn dto;\n \t}\n+\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException {\n+\t\tLong exists = jdbcTemplate.queryForObject(SELECT_CHECK_TEAM_EXISTS, Long.class, teamId);", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNDcxOQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496134719", "bodyText": "You can import statically the needed assertion methods.", "author": "marcomarasca", "createdAt": "2020-09-28T17:59:02Z", "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/DBOTeamDAOImplTest.java", "diffHunk": "@@ -349,10 +349,10 @@ public void testGetAllTeamsAndMembers() {\n \t\tfor (Team t : expectedAllTeamsAndMembers.keySet()) {\n \t\t\tCollection<TeamMember> expectedTeamMembers = expectedAllTeamsAndMembers.get(t);\n \t\t\tCollection<TeamMember> actualTeamMembers = actualAllTeamsAndMembers.get(t);\n-\t\t\tassertNotNull(\"Missing key \"+t, actualTeamMembers);\n+\t\t\tAssertions.assertNotNull(actualTeamMembers, \"Missing key \"+t);", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNTc5Nw==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496135797", "bodyText": "The public modifier is not needed", "author": "marcomarasca", "createdAt": "2020-09-28T18:00:54Z", "path": "lib/models/src/main/java/org/sagebionetworks/repo/model/TeamDAO.java", "diffHunk": "@@ -25,7 +25,18 @@\n \t * @throws NotFoundException\n \t */\n \tpublic Team get(String id) throws DatastoreException, NotFoundException;\n-\t\n+\n+\n+\t/**\n+\t * Validates that team exists, if the team does not exist, throws an exception\n+\t *\n+\t * @param teamId\n+\t * @return\n+\t * @throws DatastoreException\n+\t * @throws NotFoundException\n+\t */\n+\tpublic void validateTeamExists(String teamId) throws DatastoreException, NotFoundException;", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNTk3Mg==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496135972", "bodyText": "\"throws a NotFoundException\"", "author": "marcomarasca", "createdAt": "2020-09-28T18:01:12Z", "path": "lib/models/src/main/java/org/sagebionetworks/repo/model/TeamDAO.java", "diffHunk": "@@ -25,7 +25,18 @@\n \t * @throws NotFoundException\n \t */\n \tpublic Team get(String id) throws DatastoreException, NotFoundException;\n-\t\n+\n+\n+\t/**\n+\t * Validates that team exists, if the team does not exist, throws an exception", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzNjAzOQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496136039", "bodyText": "When is this thrown?", "author": "marcomarasca", "createdAt": "2020-09-28T18:01:20Z", "path": "lib/models/src/main/java/org/sagebionetworks/repo/model/TeamDAO.java", "diffHunk": "@@ -25,7 +25,18 @@\n \t * @throws NotFoundException\n \t */\n \tpublic Team get(String id) throws DatastoreException, NotFoundException;\n-\t\n+\n+\n+\t/**\n+\t * Validates that team exists, if the team does not exist, throws an exception\n+\t *\n+\t * @param teamId\n+\t * @return\n+\t * @throws DatastoreException", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzODQ2Mg==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496138462", "bodyText": "We should test the logic of the method and not that a single line of code is invoked.", "author": "marcomarasca", "createdAt": "2020-09-28T18:05:42Z", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/team/TeamManagerImplTest.java", "diffHunk": "@@ -974,60 +963,47 @@ public void testListAllMembersWithPrefix() {\n \n \t\twhen(mockPrincipalPrefixDao.listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID),10L, 0L)).thenReturn(Arrays.asList(adminMemberId, nonAdminMemberId));\t\t\n \t\twhen(mockTeamDAO.listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId))).thenReturn(ListWrapper.wrap(Arrays.asList(adminMember, nonAdminMember), TeamMember.class));\n-\t\t\n+\n \t\tList<TeamMember> actual = teamManagerImpl.listMembersForPrefix(prefix, TEAM_ID, TeamMemberTypeFilterOptions.ALL, 10L, 0L).getResults();\n \t\t\n \t\tverify(mockPrincipalPrefixDao, times(1)).listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID), 10L, 0L);\n \t\tverify(mockTeamDAO, times(1)).listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId));\n \t\tassertEquals(Arrays.asList(adminMember, nonAdminMember), actual);\n \t}\n \n+\n \t@Test\n-\tpublic void testListMembersForPrefixInvalidTeam() {\n+\tpublic void testListMembersForPrefixCheckTeamExists() {", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjEzOTIwMQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496139201", "bodyText": "Good practice is to setup the mock for this call.", "author": "marcomarasca", "createdAt": "2020-09-28T18:07:06Z", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/team/TeamManagerImplTest.java", "diffHunk": "@@ -974,60 +963,47 @@ public void testListAllMembersWithPrefix() {\n \n \t\twhen(mockPrincipalPrefixDao.listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID),10L, 0L)).thenReturn(Arrays.asList(adminMemberId, nonAdminMemberId));\t\t\n \t\twhen(mockTeamDAO.listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId))).thenReturn(ListWrapper.wrap(Arrays.asList(adminMember, nonAdminMember), TeamMember.class));\n-\t\t\n+\n \t\tList<TeamMember> actual = teamManagerImpl.listMembersForPrefix(prefix, TEAM_ID, TeamMemberTypeFilterOptions.ALL, 10L, 0L).getResults();\n \t\t\n \t\tverify(mockPrincipalPrefixDao, times(1)).listTeamMembersForPrefix(prefix, Long.parseLong(TEAM_ID), 10L, 0L);\n \t\tverify(mockTeamDAO, times(1)).listMembers(Collections.singletonList(Long.parseLong(TEAM_ID)), Arrays.asList(adminMemberId, nonAdminMemberId));\n \t\tassertEquals(Arrays.asList(adminMember, nonAdminMember), actual);\n \t}\n \n+\n \t@Test\n-\tpublic void testListMembersForPrefixInvalidTeam() {\n+\tpublic void testListMembersForPrefixCheckTeamExists() {\n+\t\tArrayList<Long> list = new ArrayList<Long>();\n+\t\tlist.add(Long.parseLong(TEAM_ID));\n+\t\twhen(mockTeamDAO.listMembers(list, Arrays.asList())).thenReturn(ListWrapper.wrap(Arrays.asList(), TeamMember.class));\n \t\tString prefix = \"pfx\";\n-\t\tString invalidTeamId = \"000\";\n-\t\tNotFoundException ex = new NotFoundException(\"teamDAO\");\n-\t\twhen(mockTeamDAO.get(invalidTeamId)).thenThrow(ex);\n-\t\tNotFoundException exception = Assertions.assertThrows(NotFoundException.class, () -> {\n-\t\t\t// Call under test\n-\t\t\tteamManagerImpl.listMembersForPrefix(prefix, invalidTeamId, null, 10L, 0L);\n-\t\t});\n-\t\tassertEquals(\"Team does not exist for teamId: \" + invalidTeamId, exception.getMessage());\n-        assertEquals(ex, exception.getCause());\n+\t\t// Call under test\n+\t\tteamManagerImpl.listMembersForPrefix(prefix, TEAM_ID, TeamMemberTypeFilterOptions.ALL, 10L, 0L);\n+\t\tverify(mockTeamDAO).validateTeamExists(TEAM_ID);", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE0MTUyMA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496141520", "bodyText": "You are making an additional query that is not necessary, the get(teamId) already throws an exception.", "author": "marcomarasca", "createdAt": "2020-09-28T18:11:23Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/team/TeamManagerImpl.java", "diffHunk": "@@ -730,6 +726,7 @@ public String getIconPreviewURL(UserInfo userInfo, String teamId) throws NotFoun\n \t}\n \n \tString getFileHandleId(String teamId) throws NotFoundException {\n+\t\tteamDAO.validateTeamExists(teamId);", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjE0MjQ5Mg==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4207#discussion_r496142492", "bodyText": "Assertions. is not needed as the assertion methods are statically imported.", "author": "marcomarasca", "createdAt": "2020-09-28T18:13:19Z", "path": "services/repository/src/test/java/org/sagebionetworks/repo/web/controller/TeamControllerAutowiredTest.java", "diffHunk": "@@ -75,12 +79,13 @@ public void testGetTeamIdsByMember() throws Exception {\n \t */\n \t@Test\n \tpublic void testGetTeamMembersByInvalidId() throws Exception {\n-\t\tString invalidTeamId = \"000\";\n+\t\tString invalidTeamId = \"404\";\n+\t\tString expectedResponse = \"{\\\"reason\\\":\\\"Team does not exist for teamId: \" + invalidTeamId + \"\\\"}\";\n \t\tNotFoundException exception = Assertions.assertThrows(NotFoundException.class, () -> {\n \t\t\t// Call under test\n \t\t\tservletTestHelper.getTeamMembersWithTeamId(dispatchServlet, adminUserId, invalidTeamId);\n \t\t});\n-\t\tAssert.assertEquals(\"{\\\"reason\\\":\\\"Team does not exist for teamId: \" + invalidTeamId + \"\\\"}\", exception.getMessage());\n+\t\tAssertions.assertEquals(expectedResponse, exception.getMessage());", "originalCommit": "8a5b95f17729cea5bf60c44e704f582c427432e0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6249af246872babd1b07b0e69f277c493f38ff9d", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/6249af246872babd1b07b0e69f277c493f38ff9d", "message": "add tests, add exception to get function", "committedDate": "2020-09-29T02:43:35Z", "type": "commit"}, {"oid": "530eb80bb4fb9665eb92f4bcc220df0e978fe443", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/530eb80bb4fb9665eb92f4bcc220df0e978fe443", "message": " testing", "committedDate": "2020-09-29T20:27:18Z", "type": "commit"}, {"oid": "751e032863bed724a659030d7bcf8ac654d6ed00", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/751e032863bed724a659030d7bcf8ac654d6ed00", "message": "added tests in TeamManagerImpl", "committedDate": "2020-09-30T17:32:57Z", "type": "commit"}, {"oid": "39a3dc0c3ec3bfa42a7081862efe276088d870a6", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/39a3dc0c3ec3bfa42a7081862efe276088d870a6", "message": "Merge branch 'develop' into PLFM-6390", "committedDate": "2020-09-30T17:37:26Z", "type": "commit"}, {"oid": "9086a6c9c9859e968b6bd860ff369aaffab928c3", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/9086a6c9c9859e968b6bd860ff369aaffab928c3", "message": "verify TeamDAO.get()", "committedDate": "2020-09-30T19:13:55Z", "type": "commit"}, {"oid": "30573e257952c5fb5f3e17bdd0be5c71d21e152d", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/30573e257952c5fb5f3e17bdd0be5c71d21e152d", "message": " minor change", "committedDate": "2020-09-30T19:18:17Z", "type": "commit"}, {"oid": "82e71e25aad7dc2ac3434d5751026871cefcf0df", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/82e71e25aad7dc2ac3434d5751026871cefcf0df", "message": " verify number of times", "committedDate": "2020-09-30T20:08:59Z", "type": "commit"}, {"oid": "e81caf17b933b7163b97a34b838190a61af3ba5f", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/e81caf17b933b7163b97a34b838190a61af3ba5f", "message": " teamserviceautowire", "committedDate": "2020-09-30T20:36:52Z", "type": "commit"}, {"oid": "087f5c2a96699e7a7700eced6303aff2561b200e", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/087f5c2a96699e7a7700eced6303aff2561b200e", "message": " mock error", "committedDate": "2020-09-30T21:01:06Z", "type": "commit"}, {"oid": "ed6d6c37cc7e393ef4c0b6d84e4272a1dd935937", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ed6d6c37cc7e393ef4c0b6d84e4272a1dd935937", "message": "intellij", "committedDate": "2020-09-30T21:42:36Z", "type": "commit"}]}