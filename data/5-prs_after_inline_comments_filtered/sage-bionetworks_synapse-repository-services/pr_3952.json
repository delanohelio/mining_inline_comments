{"pr_number": 3952, "pr_title": "PLFM-3590: Extend owner.txt to multiple users", "pr_createdAt": "2020-02-21T03:22:23Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3952", "timeline": [{"oid": "95650d4ff8a3cea1328b809505d377bb36df9fd0", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/95650d4ff8a3cea1328b809505d377bb36df9fd0", "message": "PLFM-3590: Allows multiple users in owner.txt", "committedDate": "2020-02-21T01:46:39Z", "type": "commit"}, {"oid": "3307f94e8b8f6b8439b11cc588f06b4985f4acf2", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3307f94e8b8f6b8439b11cc588f06b4985f4acf2", "message": "PLFM-3590: Additional integration test", "committedDate": "2020-02-21T02:11:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM3MTEzNg==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3952#discussion_r385371136", "bodyText": "teamId and userId only.", "author": "john-hill", "createdAt": "2020-02-27T21:06:19Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/storagelocation/BucketOwnerVerifierImpl.java", "diffHunk": "@@ -19,14 +22,24 @@\n import org.springframework.beans.factory.annotation.Autowired;\r\n import org.springframework.stereotype.Service;\r\n \r\n+import com.google.common.collect.ImmutableSet;\r\n+\r\n @Service\r\n public class BucketOwnerVerifierImpl implements BucketOwnerVerifier {\r\n-\r\n+\t\r\n \tpublic static final String EXTERNAL_STORAGE_HELP = \"http://docs.synapse.org/articles/custom_storage_location.html for more information on how to create a new external upload destination.\";\r\n \r\n-\tprivate static final String SECURITY_EXPLANATION = \"For security purposes, Synapse needs to establish that %s has permission to write to the bucket. Please create an object in bucket '%s' with key '%s' that contains the text '%s'. Also see \"\r\n+\tprivate static final String SECURITY_EXPLANATION = \"For security purposes, Synapse needs to establish that the user has permission to write to the bucket. Please create an object in bucket '%s' with key '%s' that contains a \"\r\n+\t\t\t+ \"line separated list of identifiers for the user. Valid identifiers are the id of the user, its username, email address or id of a team the user is part of. Also see \"\r", "originalCommit": "3307f94e8b8f6b8439b11cc588f06b4985f4acf2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTM3NDI5OQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/3952#discussion_r385374299", "bodyText": "verify negative case", "author": "john-hill", "createdAt": "2020-02-27T21:13:15Z", "path": "services/repository-managers/src/test/java/org/sagebionetworks/repo/manager/storagelocation/BucketOwnerVerifierImplAutowireTest.java", "diffHunk": "@@ -46,4 +84,86 @@ public void testUnsupportedStorageLocation() {\n \t\tassertEquals(\"Unsupported storage location type: \" + storageLocation.getClass().getSimpleName(), e.getMessage());\r\n \t}\r\n \t\r\n+\t@Test\r\n+\tpublic void testVerificationWithMultipleUsers() throws Exception {\r\n+\t\tUserInfo user1 = createUser();\r\n+\t\tUserInfo user2 = createUser();\r\n+\t\t\r\n+\t\tList<String> ownerList = ImmutableList.of(user1.getId().toString(), user2.getId().toString());\r\n+\t\t\r\n+\t\tBucketOwnerStorageLocationSetting storageLocation = linkBucket(ownerList);\r\n+\t\t\r\n+\t\tbucketOwnerVerifier.verifyBucketOwnership(user1, storageLocation);\r\n+\t\tbucketOwnerVerifier.verifyBucketOwnership(user2, storageLocation);\r", "originalCommit": "3307f94e8b8f6b8439b11cc588f06b4985f4acf2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}