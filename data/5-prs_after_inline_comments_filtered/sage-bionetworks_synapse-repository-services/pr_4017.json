{"pr_number": 4017, "pr_title": "Add new maxListLength field to ColumnModel allowing users to specify their own list size restriction (PLFM-6168)", "pr_createdAt": "2020-04-23T23:26:14Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017", "timeline": [{"oid": "af2ebf7e729f337379498b4fff89a08716d0dbce", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/af2ebf7e729f337379498b4fff89a08716d0dbce", "message": "listmax length to help estimate row query max size", "committedDate": "2020-04-23T01:16:24Z", "type": "commit"}, {"oid": "eb393cbe4e066f4f6b58d70f7af70dc4edd66886", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/eb393cbe4e066f4f6b58d70f7af70dc4edd66886", "message": "test fix", "committedDate": "2020-04-23T02:07:12Z", "type": "commit"}, {"oid": "ebf513a1415081033144ee860e6039764e5d2422", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/ebf513a1415081033144ee860e6039764e5d2422", "message": "fix test", "committedDate": "2020-04-23T03:05:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzNDAwOQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414834009", "bodyText": "at least two", "author": "john-hill", "createdAt": "2020-04-24T20:09:41Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/persistence/table/ColumnModelUtils.java", "diffHunk": "@@ -235,6 +239,19 @@ public static ColumnModel createNormalizedClone(ColumnModel toClone, int maxEnum\n \t\t}\r\n \t}\r\n \r\n+\tstatic void validateListLengthForClone(ColumnModel clone){\r\n+\t\tif(clone.getMaximumListLength() == null){\r\n+\t\t\t// Use the default value\r\n+\t\t\tclone.setMaximumListLength(ColumnConstants.DEFAULT_LIST_LENGTH);\r\n+\t\t}else if(clone.getMaximumListLength() > ColumnConstants.MAX_ALLOWED_LIST_LENGTH){\r\n+\t\t\t// The max is beyond the allowed size\r\n+\t\t\tthrow new IllegalArgumentException(\"ColumnModel.maximumListLength for a LIST column cannot exceed: \"+ColumnConstants.MAX_ALLOWED_LIST_LENGTH);\r\n+\t\t} else if (clone.getMaximumListLength() < 0) {\r", "originalCommit": "ebf513a1415081033144ee860e6039764e5d2422", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDgzODUxOQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414838519", "bodyText": "let  ColumnModelUtils.createDTOFromDBO(backup); handle the set to default (not setting it here)", "author": "john-hill", "createdAt": "2020-04-24T20:18:35Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/persistence/table/DBOColumnModel.java", "diffHunk": "@@ -116,7 +121,20 @@ public MigrationType getMigratableTableType() {\n \r\n \t@Override\r\n \tpublic MigratableTableTranslation<DBOColumnModel, DBOColumnModel> getTranslator() {\r\n-\t\treturn new BasicMigratableTableTranslation<DBOColumnModel>();\r\n+\t\treturn new BasicMigratableTableTranslation<DBOColumnModel>(){\r\n+\t\t\t@TemporaryCode(author=\"ziming\", comment = \"one-time migration change. remove after stack 309\")\r\n+\t\t\t@Override\r\n+\t\t\tpublic DBOColumnModel createDatabaseObjectFromBackup(DBOColumnModel backup) {\r\n+\t\t\t\t//doing this round trip will assign default value to maxListLength\r\n+\t\t\t\tColumnModel columnModel = ColumnModelUtils.createDTOFromDBO(backup);\r", "originalCommit": "ebf513a1415081033144ee860e6039764e5d2422", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDg0NTIwMA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4017#discussion_r414845200", "bodyText": "eliminate the default and just use the max (100)", "author": "john-hill", "createdAt": "2020-04-24T20:31:09Z", "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/persistence/table/DBOColumnModelTempTest.java", "diffHunk": "@@ -0,0 +1,57 @@\n+package org.sagebionetworks.repo.model.dbo.persistence.table;\n+\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertNotEquals;\n+\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.sagebionetworks.StackConfigurationSingleton;\n+import org.sagebionetworks.repo.model.dbo.migration.MigratableTableTranslation;\n+import org.sagebionetworks.repo.model.table.ColumnConstants;\n+import org.sagebionetworks.repo.model.table.ColumnModel;\n+import org.sagebionetworks.repo.model.table.ColumnType;\n+import org.sagebionetworks.util.TemporaryCode;\n+\n+@TemporaryCode(author = \"ziming\", comment = \"one-time migration change. remove after stack 309\")\n+public class DBOColumnModelTempTest {\n+\n+\tprivate MigratableTableTranslation<DBOColumnModel, DBOColumnModel> translator;\n+\n+\t@BeforeEach\n+\tpublic void setup() {\n+\t\ttranslator = new DBOColumnModel().getTranslator();\n+\t}\n+\n+\t@Test\n+\tpublic void testTranslator_noMaxListLength() {\n+\t\tColumnModel noMaxListLength = new ColumnModel();\n+\t\tnoMaxListLength.setId(\"123\");\n+\t\tnoMaxListLength.setColumnType(ColumnType.INTEGER_LIST);\n+\t\tnoMaxListLength.setName(\"name\");\n+\n+\t\tColumnModel modifiedColumnModel = translateColumnModel(noMaxListLength);\n+\n+\t\tassertNotEquals(noMaxListLength, modifiedColumnModel);\n+\t\tassertEquals(ColumnConstants.MAX_ALLOWED_LIST_LENGTH, modifiedColumnModel.getMaximumListLength());", "originalCommit": "ebf513a1415081033144ee860e6039764e5d2422", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b0dc5a953926c5a2e9beb49be30bfd0c79c8b683", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/b0dc5a953926c5a2e9beb49be30bfd0c79c8b683", "message": "code review changes", "committedDate": "2020-04-24T21:42:30Z", "type": "commit"}]}