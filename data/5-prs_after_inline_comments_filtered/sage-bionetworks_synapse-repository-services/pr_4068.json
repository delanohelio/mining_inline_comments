{"pr_number": 4068, "pr_title": "Plfm 6161 j", "pr_createdAt": "2020-06-01T18:14:21Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068", "timeline": [{"oid": "06f011e5c1754b6bbd77685c5a06c57de782c967", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/06f011e5c1754b6bbd77685c5a06c57de782c967", "message": "controller, service and managers for binding schemas", "committedDate": "2020-05-30T01:45:37Z", "type": "commit"}, {"oid": "4b2b30769fa9ac3e7357f4bdbdfe5c56e57bb1a8", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/4b2b30769fa9ac3e7357f4bdbdfe5c56e57bb1a8", "message": "clean imports", "committedDate": "2020-05-30T01:47:44Z", "type": "commit"}, {"oid": "6cc28f22752d1c01a825e456bb88fca8ac8354c9", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/6cc28f22752d1c01a825e456bb88fca8ac8354c9", "message": "removed formatting", "committedDate": "2020-06-01T18:12:34Z", "type": "commit"}, {"oid": "f3b5dd0b098b38f624993b2d46a9e5d234762bfc", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/f3b5dd0b098b38f624993b2d46a9e5d234762bfc", "message": "support clear schema from entity and list organizations, schemas ans versions", "committedDate": "2020-06-01T19:54:37Z", "type": "commit"}, {"oid": "4dc8a9221a85352037700da57ecccc17b12c872c", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/4dc8a9221a85352037700da57ecccc17b12c872c", "message": "added integration tests", "committedDate": "2020-06-01T20:52:18Z", "type": "commit"}, {"oid": "71ca201336cbfc4dd69657388704ee0bff3b9fd1", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/71ca201336cbfc4dd69657388704ee0bff3b9fd1", "message": "fixed schema list controllers", "committedDate": "2020-06-01T21:14:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA3ODU3MQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068#discussion_r434078571", "bodyText": "Might want to consider simplifying the URL to just /entity/{id}/schema/binding or /entity/{id}/jsonschema/binding", "author": "marcomarasca", "createdAt": "2020-06-02T18:11:46Z", "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/UrlHelpers.java", "diffHunk": "@@ -232,6 +232,7 @@\n \tpublic static final String COPY = \"/copy\";\n \tpublic static final String FILE_HANDLES_COPY = FILE_HANDLES + COPY;\n \tpublic static final String ENTITY_DATA_TYPE = ENTITY_ID+\"/datatype\";\n+\tpublic static final String ENTITY_BIND_JSON_SCHEMA = ENTITY_ID+\"/bound/json/schema\";", "originalCommit": "71ca201336cbfc4dd69657388704ee0bff3b9fd1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA4ODEzOA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068#discussion_r434088138", "bodyText": "Might want to rename to boundEntityId, also the name of the method findFirstBoundJsonSchema might be findFirstNodeIdBoundJsonSchema", "author": "marcomarasca", "createdAt": "2020-06-02T18:22:24Z", "path": "lib/jdomodels/src/test/java/org/sagebionetworks/repo/model/dbo/dao/NodeDAOImplTest.java", "diffHunk": "@@ -4214,4 +4222,84 @@ public void testGetNameNotFound() {\n \t\t\tnodeDao.getNodeName(\"syn999999\");\r\n \t\t});\r\n \t}\r\n+\t\r\n+\t@Test\r\n+\tpublic void testFindFirstBoundJsonSchema() throws JSONObjectAdapterException {\r\n+\t\tjsonSchemaTestHelper.truncateAll();\r\n+\t\t// Setup some hierarchy.\r\n+\t\t// grandparent\r\n+\t\tNode grandparent = NodeTestUtils.createNew(\"grandparent\", creatorUserGroupId);\r\n+\t\tgrandparent = nodeDao.createNewNode(grandparent);\r\n+\t\tLong grandId = KeyFactory.stringToKey(grandparent.getId());\r\n+\t\ttoDelete.add(grandparent.getId());\r\n+\t\t// parent\r\n+\t\tNode parent = NodeTestUtils.createNew(\"parent\", creatorUserGroupId);\r\n+\t\tparent.setParentId(grandparent.getId());\r\n+\t\tparent = nodeDao.createNewNode(parent);\r\n+\t\tLong parentId = KeyFactory.stringToKey(parent.getId());\r\n+\t\ttoDelete.add(parent.getId());\r\n+\t\t// child\r\n+\t\tNode child = NodeTestUtils.createNew(\"child\", creatorUserGroupId);\r\n+\t\tchild.setParentId(parent.getId());\r\n+\t\tchild = nodeDao.createNewNode(child);\r\n+\t\tLong childId = KeyFactory.stringToKey(child.getId());\r\n+\t\ttoDelete.add(child.getId());\r\n+\r\n+\t\tString schema$id = \"my.org/foo.bar/1.2.3\";\r\n+\t\tint index = 0;\r\n+\t\tJsonSchemaVersionInfo schemaInfo = jsonSchemaTestHelper.createNewSchemaVersion(creatorUserGroupId, schema$id,\r\n+\t\t\t\tindex);\r\n+\t\t// bind the schema to the grand parent\r\n+\t\tJsonSchemaObjectBinding binding = jsonSchemaTestHelper.bindSchemaToObject(creatorUserGroupId, schema$id,\r\n+\t\t\t\tgrandId, BoundObjectType.entity);\r\n+\r\n+\t\t// call under test\r\n+\t\tLong boundId = nodeDao.findFirstBoundJsonSchema(childId);\r", "originalCommit": "71ca201336cbfc4dd69657388704ee0bff3b9fd1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNDA4OTQ2NA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4068#discussion_r434089464", "bodyText": "We might want to expose the max depth as a parameter so we can test it and set the default at the manager level", "author": "marcomarasca", "createdAt": "2020-06-02T18:23:50Z", "path": "lib/jdomodels/src/main/java/org/sagebionetworks/repo/model/dbo/dao/NodeDAOImpl.java", "diffHunk": "@@ -2034,5 +2039,29 @@ public String getNodeName(String nodeId) {\n \t\t\tthrow new NotFoundException();\n \t\t}\n \t}\n+\t\n+\n+\t@Override\n+\tpublic Long findFirstBoundJsonSchema(Long nodeId) {", "originalCommit": "71ca201336cbfc4dd69657388704ee0bff3b9fd1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}