{"pr_number": 4101, "pr_title": "Plfm 6284", "pr_createdAt": "2020-06-17T18:02:55Z", "pr_url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101", "timeline": [{"oid": "69730dc2349a1cc113ca4b3eda82ec60be87efaf", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/69730dc2349a1cc113ca4b3eda82ec60be87efaf", "message": "changed parser for semantic version prefix to dash", "committedDate": "2020-06-15T23:12:43Z", "type": "commit"}, {"oid": "5c1701b846615e9046927887485775649500167c", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/5c1701b846615e9046927887485775649500167c", "message": "changed test to accout for dash instead of slash", "committedDate": "2020-06-15T23:45:02Z", "type": "commit"}, {"oid": "88e1b7323ac62664a75705ad432d4e71d3199ff0", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/88e1b7323ac62664a75705ad432d4e71d3199ff0", "message": "manager level tests", "committedDate": "2020-06-16T00:06:28Z", "type": "commit"}, {"oid": "973798df2a78c150a32843b3a7ea9b9cf5343bc5", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/973798df2a78c150a32843b3a7ea9b9cf5343bc5", "message": "changed Synapse schema boostrap to use dash and include concreteType for object types", "committedDate": "2020-06-16T01:13:39Z", "type": "commit"}, {"oid": "3813e36439c5be705e0df58349a7a1310ad83381", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3813e36439c5be705e0df58349a7a1310ad83381", "message": "more test fixes", "committedDate": "2020-06-16T18:53:44Z", "type": "commit"}, {"oid": "3086fc81f71f38d3e95f09e1b3bf05fe82cec7db", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/3086fc81f71f38d3e95f09e1b3bf05fe82cec7db", "message": "fix IT test, java client, and manager to parse the  for controller methods", "committedDate": "2020-06-17T01:46:10Z", "type": "commit"}, {"oid": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/commit/753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "message": "fix client delete", "committedDate": "2020-06-17T03:37:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MTYxMQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441741611", "bodyText": "schema id?", "author": "marcomarasca", "createdAt": "2020-06-17T18:22:46Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManagerImpl.java", "diffHunk": "@@ -301,33 +293,28 @@ public void truncateAll() {\n \n \t@WriteTransaction\n \t@Override\n-\tpublic void deleteSchemaAllVersion(UserInfo user, String organizationName, String schemaName) {\n+\tpublic void deleteSchemaById(UserInfo user, String $id) {\n \t\tValidateArgument.required(user, \"user\");\n-\t\tValidateArgument.required(organizationName, \"organizationName\");\n-\t\tValidateArgument.required(schemaName, \"schemaName\");\n-\t\tJsonSchemaVersionInfo versionInfo = jsonSchemaDao.getVersionLatestInfo(organizationName, schemaName);\n-\t\t// Must have delete on the organization\n-\t\tif (!user.isAdmin()) {\n-\t\t\taclDao.canAccess(user, versionInfo.getOrganizationId(), ObjectType.ORGANIZATION, ACCESS_TYPE.DELETE)\n-\t\t\t\t\t.checkAuthorizationOrElseThrow();\n+\t\tValidateArgument.required($id, \"organizationName\");", "originalCommit": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc0MzI2OQ==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441743269", "bodyText": "There is a missing @OverRide in the implementation", "author": "marcomarasca", "createdAt": "2020-06-17T18:25:45Z", "path": "services/repository-managers/src/main/java/org/sagebionetworks/repo/manager/schema/JsonSchemaManager.java", "diffHunk": "@@ -82,24 +82,7 @@\n \t * @param semanticVersion\n \t * @return\n \t */\n-\tJsonSchema getSchema(String organizationName, String schemaName, String semanticVersion);\n-\n-\t/**\n-\t * Attempt to delete all version of a schema.\n-\t * @param user\n-\t * @param organizationName\n-\t * @param schemaName\n-\t */\n-\tpublic void deleteSchemaAllVersion(UserInfo user, String organizationName, String schemaName);\n-\t\n-\t/**\n-\t * Delete a specific version of a schema.\n-\t * @param user\n-\t * @param organizationName\n-\t * @param schemaName\n-\t * @param semanticVersion\n-\t */\n-\tvoid deleteSchemaVersion(UserInfo user, String organizationName, String schemaName, String semanticVersion);\n+\tJsonSchema getSchema(String $id);", "originalCommit": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2ODEyNA==", "url": "https://github.com/Sage-Bionetworks/Synapse-Repository-Services/pull/4101#discussion_r441768124", "bodyText": "Please make sure that the published BNF in the controller docs (schema create?) for the schema is aligned with the dash.", "author": "marcomarasca", "createdAt": "2020-06-17T18:59:51Z", "path": "services/repository/src/main/java/org/sagebionetworks/repo/web/controller/JsonSchemaController.java", "diffHunk": "@@ -275,38 +277,24 @@ public void deleteOrganization(@RequestParam(value = AuthorizationConstants.USER\n \t}\n \n \t/**\n-\t * Get a registered JSON schema using its $id. This method excludes the semantic\n-\t * version, and will return the latest version of the schema.\n+\t * Get a registered JSON schema using its $id.\n \t * \n \t * @param userId\n-\t * @param id     The $if of the schema to get.\n+\t * @param organizationName The organization name of the schema.\n+\t * @param schemaNameDashSemanticVersion The schema name with an optional dash semantic version.\n \t * @return\n \t */\n \t@RequiredScope({ view })\n \t@ResponseStatus(HttpStatus.OK)\n \t@RequestMapping(value = { UrlHelpers.JSON_SHCEMA_TYPE_REG_ORG_NAME }, method = RequestMethod.GET)\n-\tpublic @ResponseBody JsonSchema getJsonSchemaNoVersion(@PathVariable String organizationName,\n-\t\t\t@PathVariable String schemaName) {\n-\t\tString semanticVersion = null;\n-\t\treturn serviceProvider.getSchemaServices().getSchema(organizationName, schemaName, semanticVersion);\n+\tpublic @ResponseBody JsonSchema getJsonSchemaNoVersion(@PathVariable(required = true) String organizationName,", "originalCommit": "753ca374faf501b6c0fd0b3f9fb96abcdee555ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}