{"pr_number": 188, "pr_title": "KOGITO-1108 [Jobs Service] API to allow updating the callback for a Job", "pr_createdAt": "2020-04-16T20:27:04Z", "pr_url": "https://github.com/kiegroup/kogito-apps/pull/188", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU1MTI5NQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411551295", "bodyText": "PATCH (like PUT) should target a specific ID, present as a path param.http://restcookbook.com/HTTP%20Methods/patch/", "author": "radtriste", "createdAt": "2020-04-20T17:16:14Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +65,17 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(Job job) {", "originalCommit": "03a97a1ea13248a4b03913135f07aa4cf615f915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU5MDQ1OQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411590459", "bodyText": "yep, I agree, added under the path \"/{id}\"", "author": "tiagodolphine", "createdAt": "2020-04-20T18:16:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTU1MTI5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4Mzg5Mw==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r411983893", "bodyText": "This should not be needed on a patch.\nthe job structure contains only the fields which need to be updated\nso id is not present in it", "author": "radtriste", "createdAt": "2020-04-21T08:31:48Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +66,25 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Path(\"/{id}\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+        LOGGER.debug(\"REST patch update {}\", job);\n+\n+        //validate parameters for job and id\n+        Optional.ofNullable(job)", "originalCommit": "ebbf90fa5feb6b688f7444098dd199ef1df6a2af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDM4ODQ2Mw==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420388463", "bodyText": "updated", "author": "tiagodolphine", "createdAt": "2020-05-05T20:33:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTk4Mzg5Mw=="}], "type": "inlineReview"}, {"oid": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "url": "https://github.com/kiegroup/kogito-apps/commit/f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "message": "Use job id on path to apply the patch method and rebase with master", "committedDate": "2020-05-05T20:32:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420629005", "bodyText": "ScheduledJob.builder().job(job).build()\ncould we have something like ScheduledJob.from(job) instead that is hiding this implementation ?", "author": "radtriste", "createdAt": "2020-05-06T08:36:42Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/resource/JobResource.java", "diffHunk": "@@ -64,6 +66,18 @@\n                 .thenApply(j -> j.orElseThrow(() -> new RuntimeException(\"Failed to schedule job \" + job)));\n     }\n \n+    @PATCH\n+    @Path(\"/{id}\")\n+    @Produces(MediaType.APPLICATION_JSON)\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    public CompletionStage<ScheduledJob> patch(@PathParam(\"id\") String id, @RequestBody Job job) {\n+        LOGGER.debug(\"REST patch update {}\", job);\n+        return jobRepository.merge(id, ScheduledJob.builder().job(job).build())", "originalCommit": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAwOTAyNA==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r423009024", "bodyText": "I didn't get, basically, it is building a new instance of ScheduledJob based on a Job, that's a superclass, the approach of using the builder is to keep immutability. The jobRepository is based on ScheduledJob that's why it was necessary.", "author": "tiagodolphine", "createdAt": "2020-05-11T12:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzAxNTMxNQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r423015315", "bodyText": "yeah. I was just thinking about creating a direct method ScheduledJob.from(job) instead of the whole ScheduledJob.builder().job(job).build().\nIt would avoid the long line. it is just esthetic I would say", "author": "radtriste", "createdAt": "2020-05-11T12:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYyOTAwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzMTI5MA==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420631290", "bodyText": "could we have that on one line ?\nmake it in fact hard to read like that whereas it is a simple thing...", "author": "radtriste", "createdAt": "2020-05-06T08:40:47Z", "path": "jobs-service/src/main/java/org/kie/kogito/jobs/service/repository/impl/BaseReactiveJobRepository.java", "diffHunk": "@@ -66,4 +69,23 @@ public BaseReactiveJobRepository(Vertx vertx, JobStreams jobStreams) {\n         return delete(job.getId())\n                 .thenApply(j -> jobStreams.publishJobStatusChange(job));\n     }\n+\n+    @Override\n+    public CompletionStage<ScheduledJob> merge(String id, ScheduledJob job) {\n+        return Optional.ofNullable(id)\n+                .filter(StringUtils::isNotBlank)\n+                .filter(s -> StringUtils.isBlank(job.getId()) || s.equals(job.getId()))\n+                .map(s -> get(s)\n+                        .thenApply(Optional::ofNullable)\n+                        .thenApply(current -> current\n+                                .map(j -> ScheduledJob", "originalCommit": "f0d735bbfef0184cccdb8930f4abcd9047f1bb45", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc1NDQ4OQ==", "url": "https://github.com/kiegroup/kogito-apps/pull/188#discussion_r420754489", "bodyText": "I reformatted the method extracting the merge operation into a new method, take a look it is now more clear IMO.", "author": "tiagodolphine", "createdAt": "2020-05-06T12:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDYzMTI5MA=="}], "type": "inlineReview"}, {"oid": "602130b5faf42dbb43b534ba0171288bb7785709", "url": "https://github.com/kiegroup/kogito-apps/commit/602130b5faf42dbb43b534ba0171288bb7785709", "message": "KOGITO-1108 [Jobs Service] API to allow updating the callback for a Job", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "d2a4d5321fde4dc716d2b06c55a195d644b391a6", "url": "https://github.com/kiegroup/kogito-apps/commit/d2a4d5321fde4dc716d2b06c55a195d644b391a6", "message": "Handle job not found on merge", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "d0afd13229052f4c1584e68078268f05f13aa69e", "url": "https://github.com/kiegroup/kogito-apps/commit/d0afd13229052f4c1584e68078268f05f13aa69e", "message": "Inserting id on the patch path", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "ad7ffdbadf168286d543119dcea34d0a0df30ba1", "url": "https://github.com/kiegroup/kogito-apps/commit/ad7ffdbadf168286d543119dcea34d0a0df30ba1", "message": "Use job id on path to apply the patch method and rebase with master", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "url": "https://github.com/kiegroup/kogito-apps/commit/dd2640abd6b5bdf2b51432ee0531c0dd7d557cb9", "message": "Reformatting merge method on BaseReactiveJobRepository", "committedDate": "2020-05-11T12:53:13Z", "type": "commit"}, {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "url": "https://github.com/kiegroup/kogito-apps/commit/03e959bdf786efc2da5160adf761f0bbfa1edbaf", "message": "Adding a helper method to create a ScheduledJob based on Job", "committedDate": "2020-05-11T13:12:42Z", "type": "commit"}, {"oid": "03e959bdf786efc2da5160adf761f0bbfa1edbaf", "url": "https://github.com/kiegroup/kogito-apps/commit/03e959bdf786efc2da5160adf761f0bbfa1edbaf", "message": "Adding a helper method to create a ScheduledJob based on Job", "committedDate": "2020-05-11T13:12:42Z", "type": "forcePushed"}]}