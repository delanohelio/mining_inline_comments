{"pr_number": 9185, "pr_title": "Add GranteeService.getVisibleUsers()", "pr_createdAt": "2020-10-16T12:43:31Z", "pr_url": "https://github.com/Graylog2/graylog2-server/pull/9185", "timeline": [{"oid": "fc3de58ac72286a32fa1c36e6354d2d555e6994c", "url": "https://github.com/Graylog2/graylog2-server/commit/fc3de58ac72286a32fa1c36e6354d2d555e6994c", "message": "Add GranteeService.getVisibleUsers()\n\nGraylog users are visible to other users if the user that is running\nthe query has either the `users:list` permission, or explicit\n`users:view` permissions on certain users.\n\nThe `users:list` permission can be conveniently assigned by using the\nnew `User Inspector` role.", "committedDate": "2020-10-19T14:12:45Z", "type": "commit"}, {"oid": "a388de0f7363fcdfd2761cdfca98333c526e34f2", "url": "https://github.com/Graylog2/graylog2-server/commit/a388de0f7363fcdfd2761cdfca98333c526e34f2", "message": "Add UserServiceExtension for junit5 tests", "committedDate": "2020-10-19T14:12:45Z", "type": "commit"}, {"oid": "2ba1dd73d6d2b568e1ba527f258c40476609979c", "url": "https://github.com/Graylog2/graylog2-server/commit/2ba1dd73d6d2b568e1ba527f258c40476609979c", "message": "Simplify permissions", "committedDate": "2020-10-19T14:12:45Z", "type": "commit"}, {"oid": "2ba1dd73d6d2b568e1ba527f258c40476609979c", "url": "https://github.com/Graylog2/graylog2-server/commit/2ba1dd73d6d2b568e1ba527f258c40476609979c", "message": "Simplify permissions", "committedDate": "2020-10-19T14:12:45Z", "type": "forcePushed"}, {"oid": "a1869416ab6e2e6eeab18f91d38ba822cfc3a477", "url": "https://github.com/Graylog2/graylog2-server/commit/a1869416ab6e2e6eeab18f91d38ba822cfc3a477", "message": "Rename EventNotification GRNType in frontend\n\nPrior to this change, the dependency resolution which is using the\ncontent pack mechanism tried to find the event notification type with\n'event_notification' which is not a registered type in content pack.\n\nThis change will rename the type to `notification` so the dependency\nresolution via content packs works again.", "committedDate": "2020-10-19T14:44:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3MDE1Ng==", "url": "https://github.com/Graylog2/graylog2-server/pull/9185#discussion_r507970156", "bodyText": "Should we only inject TestUserService instances? That would make it clear that the user of the extension gets a TestUserService and not a fully featured UserServiceImpl. (we might want to rename the extension to TestUserServiceExtension in that case, too)\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (UserService.class.equals(parameterType)) {\n          \n          \n            \n                    if (TeamUserService.class.equals(parameterType)) {", "author": "bernd", "createdAt": "2020-10-19T18:22:43Z", "path": "graylog2-server/src/test/java/org/graylog/testing/UserServiceExtension.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/**\n+ * This file is part of Graylog.\n+ *\n+ * Graylog is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * Graylog is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with Graylog.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package org.graylog.testing;\n+\n+import org.graylog.testing.mongodb.MongoDBExtension;\n+import org.graylog.testing.mongodb.MongoDBTestService;\n+import org.graylog2.shared.users.UserService;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+import org.junit.jupiter.api.extension.ParameterContext;\n+import org.junit.jupiter.api.extension.ParameterResolutionException;\n+import org.junit.jupiter.api.extension.ParameterResolver;\n+\n+import java.util.Objects;\n+\n+import static java.util.Objects.requireNonNull;\n+\n+public class UserServiceExtension implements ParameterResolver {\n+    @Override\n+    public boolean supportsParameter(ParameterContext parameterContext, ExtensionContext extensionContext) throws ParameterResolutionException {\n+        return Objects.equals(UserService.class, parameterContext.getParameter().getType());\n+    }\n+\n+    @Override\n+    public Object resolveParameter(ParameterContext parameterContext, ExtensionContext extensionContext) throws ParameterResolutionException {\n+        final Class<?> parameterType = parameterContext.getParameter().getType();\n+\n+        if (UserService.class.equals(parameterType)) {", "originalCommit": "2ba1dd73d6d2b568e1ba527f258c40476609979c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAxMzYwNw==", "url": "https://github.com/Graylog2/graylog2-server/pull/9185#discussion_r508013607", "bodyText": "Makes sense \ud83d\udc4d", "author": "mpfz0r", "createdAt": "2020-10-19T19:36:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzk3MDE1Ng=="}], "type": "inlineReview"}, {"oid": "93144b621b0a142a12c885c2c0dd8c06bad591a1", "url": "https://github.com/Graylog2/graylog2-server/commit/93144b621b0a142a12c885c2c0dd8c06bad591a1", "message": "user permissions are still checked against the username", "committedDate": "2020-10-19T18:52:58Z", "type": "commit"}, {"oid": "f77edf5dc7b62f127b9b0347d74ce949fefac914", "url": "https://github.com/Graylog2/graylog2-server/commit/f77edf5dc7b62f127b9b0347d74ce949fefac914", "message": "Fix review comments", "committedDate": "2020-10-19T19:36:21Z", "type": "commit"}, {"oid": "7523e010d8922e9c3b1439535a58b88a70b2ff74", "url": "https://github.com/Graylog2/graylog2-server/commit/7523e010d8922e9c3b1439535a58b88a70b2ff74", "message": "rename to TestUserServiceExtension", "committedDate": "2020-10-19T19:42:54Z", "type": "commit"}]}