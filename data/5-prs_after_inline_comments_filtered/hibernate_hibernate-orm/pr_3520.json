{"pr_number": 3520, "pr_title": "on H2 after 2.0 don't need column type workaround (H5)", "pr_createdAt": "2020-08-25T10:52:14Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3520", "timeline": [{"oid": "0142cebf9c7f543eb24fb063b2156eb0b657976b", "url": "https://github.com/hibernate/hibernate-orm/commit/0142cebf9c7f543eb24fb063b2156eb0b657976b", "message": "on H2 after 2.0 don't need column type workaround\n\nApparently H2 correctly reports column types via JDBC metadata\nsince 2.0, so this workaround is unnecessary.\n\nAlso add a default mapping for DECIMAL in superclass, just for\ncompleteness.\n\ncc @famod", "committedDate": "2020-08-25T10:50:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIzNjMzOQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3520#discussion_r482236339", "bodyText": "btw, there is a related ticket for the above `float' issue: #2855", "author": "NathanQingyangXu", "createdAt": "2020-09-02T17:15:25Z", "path": "hibernate-core/src/main/java/org/hibernate/dialect/H2Dialect.java", "diffHunk": "@@ -122,7 +122,7 @@ public H2Dialect() {\n \t\tregisterColumnType( Types.BIT, \"boolean\" );\n \t\tregisterColumnType( Types.CHAR, \"char($l)\" );\n \t\tregisterColumnType( Types.DATE, \"date\" );\n-\t\tregisterColumnType( Types.DECIMAL, buildId >= 201 ? \"numeric($p,$s)\" : \"decimal($p,$s)\" );\n+\t\tregisterColumnType( Types.DECIMAL, \"decimal($p,$s)\" );\n \t\tregisterColumnType( Types.NUMERIC, buildId >= 201 ? \"numeric($p,$s)\" : \"decimal($p,$s)\" );\n \t\tregisterColumnType( Types.DOUBLE, \"double\" );\n \t\tregisterColumnType( Types.FLOAT, \"float\" );", "originalCommit": "0142cebf9c7f543eb24fb063b2156eb0b657976b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1Nzg4MA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3520#discussion_r482257880", "bodyText": "The more I see issues like this, the more I think the problem isn't in the Dialects, it's in the stupid schema validation that doesn't realize that float and real and double are all the same thing, and that numeric and decimal are the same thing. We could easily fix this whole class of idiotic bugs in one swoop by making the schema validator/update tools non-stupid.", "author": "gavinking", "createdAt": "2020-09-02T17:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIzNjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI1OTYwMQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3520#discussion_r482259601", "bodyText": "AbstractSchemaValidator.validateColumnType() is the culprit here.", "author": "gavinking", "createdAt": "2020-09-02T17:55:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIzNjMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjI2MjI1Mw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3520#discussion_r482262253", "bodyText": "And Table.validateColumns(), I suppose, except that that method doesn't seem to be called anywhere.", "author": "gavinking", "createdAt": "2020-09-02T18:00:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MjIzNjMzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2MTY1OA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3520#discussion_r483961658", "bodyText": "I'm confused. Does this mean a part of #3405 was not necessary at all?\nOr do we have the same problem as here: #3519 (comment)?", "author": "famod", "createdAt": "2020-09-05T15:37:41Z", "path": "hibernate-core/src/main/java/org/hibernate/dialect/H2Dialect.java", "diffHunk": "@@ -122,7 +122,7 @@ public H2Dialect() {\n \t\tregisterColumnType( Types.BIT, \"boolean\" );\n \t\tregisterColumnType( Types.CHAR, \"char($l)\" );\n \t\tregisterColumnType( Types.DATE, \"date\" );\n-\t\tregisterColumnType( Types.DECIMAL, buildId >= 201 ? \"numeric($p,$s)\" : \"decimal($p,$s)\" );\n+\t\tregisterColumnType( Types.DECIMAL, \"decimal($p,$s)\" );", "originalCommit": "0142cebf9c7f543eb24fb063b2156eb0b657976b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2NjQwNg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3520#discussion_r483966406", "bodyText": "Well that was the result of the long discussion we just had, wasn't it? I mean, honestly I found it pretty hard to understand what he was saying, but after much back and forth it seems to me we agreed that the workaround wasn't required at all from .200 on.", "author": "gavinking", "createdAt": "2020-09-05T16:35:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Mzk2MTY1OA=="}], "type": "inlineReview"}]}