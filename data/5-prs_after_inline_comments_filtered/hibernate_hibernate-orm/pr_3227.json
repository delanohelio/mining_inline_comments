{"pr_number": 3227, "pr_title": "HHH-13853 - Pass the merged Integration settings and Persistence Unit properties to buildBootstrapServiceRegistry", "pr_createdAt": "2020-02-07T14:58:30Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3227", "timeline": [{"oid": "0ca1464ca52200ea49bc10ec2b3c4ab3575ef97c", "url": "https://github.com/hibernate/hibernate-orm/commit/0ca1464ca52200ea49bc10ec2b3c4ab3575ef97c", "message": "HHH-13853 - Pass the merged Integration settings and Persistence Unit properties to buildBootstrapServiceRegistry", "committedDate": "2020-02-18T16:33:27Z", "type": "commit"}, {"oid": "0ca1464ca52200ea49bc10ec2b3c4ab3575ef97c", "url": "https://github.com/hibernate/hibernate-orm/commit/0ca1464ca52200ea49bc10ec2b3c4ab3575ef97c", "message": "HHH-13853 - Pass the merged Integration settings and Persistence Unit properties to buildBootstrapServiceRegistry", "committedDate": "2020-02-18T16:33:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMTk1Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3227#discussion_r380831952", "bodyText": "I think at least we can reuse properties at the above statement to improve code readability a little bit.\nif (properties != null ) {\n    mergedIntegrationSettings = new HashMap( properties );\n    ... ...\n}", "author": "NathanQingyangXu", "createdAt": "2020-02-18T17:44:17Z", "path": "hibernate-core/src/main/java/org/hibernate/jpa/boot/internal/EntityManagerFactoryBuilderImpl.java", "diffHunk": "@@ -196,8 +196,19 @@ private EntityManagerFactoryBuilderImpl(\n \t\t\tintegrationSettings = Collections.emptyMap();\n \t\t}\n \n+\t\tMap mergedIntegrationSettings = null;\n+\t\tProperties properties = persistenceUnit.getProperties();\n+\t\tif ( properties != null ) {\n+\t\t\tmergedIntegrationSettings = new HashMap( persistenceUnit.getProperties() );", "originalCommit": "0ca1464ca52200ea49bc10ec2b3c4ab3575ef97c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0MDk4Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3227#discussion_r380840982", "bodyText": "+1 good catch", "author": "sebersole", "createdAt": "2020-02-18T18:01:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg0NDk4NQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3227#discussion_r380844985", "bodyText": "@NathanQingyangXu do you want to create a PR for that since it was your catch?", "author": "sebersole", "createdAt": "2020-02-18T18:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg3NDQ4OQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3227#discussion_r380874489", "bodyText": "There is another subtle bug that if the passed 'integrationSettings' is null the entries from PU might be added to Collections.emptyMap() ending up with UnsupportedOperationException.\nYeah, I am gonna create a PR to fix all such issues.", "author": "NathanQingyangXu", "createdAt": "2020-02-18T19:05:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMTk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg4MDM2Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3227#discussion_r380880362", "bodyText": "PR created at: #3246. It might be a little bit aggressive, but I do think we can improve code readability besides fixing a subtle potential bug.", "author": "NathanQingyangXu", "createdAt": "2020-02-18T19:17:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDgzMTk1Mg=="}], "type": "inlineReview"}]}