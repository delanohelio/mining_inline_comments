{"pr_number": 3581, "pr_title": "HHH-14227 fix some ActionQueue insert ordering regression issues", "pr_createdAt": "2020-10-05T10:51:16Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3581", "timeline": [{"oid": "7080717ef614a8d093ced2edb33423aa9c6e621a", "url": "https://github.com/hibernate/hibernate-orm/commit/7080717ef614a8d093ced2edb33423aa9c6e621a", "message": "HHH-14227 Insert statements are not ordered with entities that use inheritance and reference a subclass", "committedDate": "2020-10-05T10:48:09Z", "type": "commit"}, {"oid": "46de4d5dcd19487eb08a1d3a6cada49e1fc8247c", "url": "https://github.com/hibernate/hibernate-orm/commit/46de4d5dcd19487eb08a1d3a6cada49e1fc8247c", "message": "HHH-14227 Some additional typos and message improvements", "committedDate": "2020-10-05T10:48:25Z", "type": "commit"}, {"oid": "e770b0b7d1ce57c1becdd9ede564f6b9a3bb7ade", "url": "https://github.com/hibernate/hibernate-orm/commit/e770b0b7d1ce57c1becdd9ede564f6b9a3bb7ade", "message": "HHH-14227 Add some more tests to cover order of batched insert executions", "committedDate": "2020-10-05T10:48:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU3ODg5NQ==", "url": "https://github.com/hibernate/hibernate-orm/pull/3581#discussion_r499578895", "bodyText": "I suppose this change should be replicated in Hibernate Reactive's ReactiveActionQueue.\nIs it just this one line, @NathanQingyangXu ?", "author": "gavinking", "createdAt": "2020-10-05T12:58:56Z", "path": "hibernate-core/src/main/java/org/hibernate/engine/spi/ActionQueue.java", "diffHunk": "@@ -1268,7 +1268,9 @@ private void addParentChildEntityNames(AbstractEntityInsertAction action, BatchI\n \t\t\t\tfor ( int i = 0; i < propertyValues.length; i++ ) {\n \t\t\t\t\tObject value = propertyValues[i];\n \t\t\t\t\tType type = propertyTypes[i];\n-\t\t\t\t\taddParentChildEntityNameByPropertyAndValue( action, batchIdentifier, type, value );\n+\t\t\t\t\tif ( value != null ) {\n+\t\t\t\t\t\taddParentChildEntityNameByPropertyAndValue( action, batchIdentifier, type, value );\n+\t\t\t\t\t}", "originalCommit": "e770b0b7d1ce57c1becdd9ede564f6b9a3bb7ade", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU4MTA2Mg==", "url": "https://github.com/hibernate/hibernate-orm/pull/3581#discussion_r499581062", "bodyText": "it is", "author": "Sanne", "createdAt": "2020-10-05T13:02:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU3ODg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTY1ODMzNw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3581#discussion_r499658337", "bodyText": "alright I will just copy it over then", "author": "gavinking", "createdAt": "2020-10-05T14:51:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU3ODg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTczNTg2MA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3581#discussion_r499735860", "bodyText": "Ah, I failed to notice we should also remove the unnecessary nullness checking in addParentChildEntityNameByPropertyAndValue private method (which has been done in my original PR). It would hurt the code readability. IMHO, the ActionQueue has big room for improvement. I am gonna create another ticket and PR to include the above code change mentioned, together with many other minor issues.", "author": "NathanQingyangXu", "createdAt": "2020-10-05T16:47:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU3ODg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc0MDc4Nw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3581#discussion_r499740787", "bodyText": "I created a ticket here: https://hibernate.atlassian.net/browse/HHH-14248. Will work on it soon.", "author": "NathanQingyangXu", "createdAt": "2020-10-05T16:55:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU3ODg5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDI4NzczNA==", "url": "https://github.com/hibernate/hibernate-orm/pull/3581#discussion_r500287734", "bodyText": "It is my fault. @Sanne 's code change is correct. Removing the nullness checking in addParentChildEntityNameByPropertyAndValue breaks FumTest for there is other entrance to the method bring null value in.", "author": "NathanQingyangXu", "createdAt": "2020-10-06T13:41:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTU3ODg5NQ=="}], "type": "inlineReview"}]}