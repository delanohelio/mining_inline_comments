{"pr_number": 3260, "pr_title": "HHH-13879 - Slow query log should use System#nanoTime not System#currentTimeMillis", "pr_createdAt": "2020-02-25T14:59:29Z", "pr_url": "https://github.com/hibernate/hibernate-orm/pull/3260", "timeline": [{"oid": "f5b2aca26d1891c0544973a923d3f7154cdf7209", "url": "https://github.com/hibernate/hibernate-orm/commit/f5b2aca26d1891c0544973a923d3f7154cdf7209", "message": "HHH-13879 - Slow query log should use System#nanoTime not System#currentTimeMillis", "committedDate": "2020-02-25T15:29:06Z", "type": "commit"}, {"oid": "f5b2aca26d1891c0544973a923d3f7154cdf7209", "url": "https://github.com/hibernate/hibernate-orm/commit/f5b2aca26d1891c0544973a923d3f7154cdf7209", "message": "HHH-13879 - Slow query log should use System#nanoTime not System#currentTimeMillis", "committedDate": "2020-02-25T15:29:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk2NDEyNw==", "url": "https://github.com/hibernate/hibernate-orm/pull/3260#discussion_r383964127", "bodyText": "I would suggest providing more clue about  the exception like\nthrow new IllegalArgumentException( \"startTimeNanos [\" + startTimeNanos + \"] should be greater than 0!\" );\n\nto help debugger a little bit.", "author": "NathanQingyangXu", "createdAt": "2020-02-25T15:46:49Z", "path": "hibernate-core/src/main/java/org/hibernate/engine/jdbc/spi/SqlStatementLogger.java", "diffHunk": "@@ -134,34 +135,34 @@ public void logStatement(String statement, Formatter formatter) {\n \t * Log a slow SQL query\n \t *\n \t * @param statement SQL statement.\n-\t * @param startTime Start time in milliseconds.\n+\t * @param startTimeNanos Start time in nanoseconds.\n \t */\n-\tpublic void logSlowQuery(Statement statement, long startTime) {\n+\tpublic void logSlowQuery(Statement statement, long startTimeNanos) {\n \t\tif ( logSlowQuery < 1 ) {\n \t\t\treturn;\n \t\t}\n-\t\tlogSlowQuery( statement.toString(), startTime );\n+\t\tlogSlowQuery( statement.toString(), startTimeNanos );\n \t}\n \n \t/**\n \t * Log a slow SQL query\n \t *\n \t * @param sql The SQL query.\n-\t * @param startTime Start time in milliseconds.\n+\t * @param startTimeNanos Start time in nanoseconds.\n \t */\n \t@AllowSysOut\n-\tpublic void logSlowQuery(String sql, long startTime) {\n+\tpublic void logSlowQuery(String sql, long startTimeNanos) {\n \t\tif ( logSlowQuery < 1 ) {\n \t\t\treturn;\n \t\t}\n-\t\tassert startTime > 0 : \"startTime is invalid!\";\n-\n-\t\tlong spent = System.currentTimeMillis() - startTime;\n+\t\tif ( startTimeNanos <= 0 ) {\n+\t\t\tthrow new IllegalArgumentException( \"startTimeNanos should be greater than 0!\" );", "originalCommit": "f5b2aca26d1891c0544973a923d3f7154cdf7209", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3dcbc442b10be96360beed8f2fe56346a4a9b97a", "url": "https://github.com/hibernate/hibernate-orm/commit/3dcbc442b10be96360beed8f2fe56346a4a9b97a", "message": "Changes according to PR review. Requires rebase!", "committedDate": "2020-02-25T16:29:43Z", "type": "commit"}]}