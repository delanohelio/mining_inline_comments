{"pr_number": 4576, "pr_title": "Harvester timezone setting", "pr_createdAt": "2020-04-03T10:29:15Z", "pr_url": "https://github.com/geonetwork/core-geonetwork/pull/4576", "timeline": [{"oid": "993bf901a5757a97efe4811a4f71cec7189d6592", "url": "https://github.com/geonetwork/core-geonetwork/commit/993bf901a5757a97efe4811a4f71cec7189d6592", "message": "Library / Moment.js / Update to 2.24.0", "committedDate": "2020-04-03T10:24:36Z", "type": "commit"}, {"oid": "aececd1762d534ccae8b624456c69458ec6d0370", "url": "https://github.com/geonetwork/core-geonetwork/commit/aececd1762d534ccae8b624456c69458ec6d0370", "message": "Use a timezone from settings to run harvesters\n\nThe admin can now set a timezone in the settings and it will be used to interpret the\ncron expressions set in harvester settings. For example, setting Europe/Madrid in the\ntimezone setting and the expression `0 15 5 * * ?` in the cron will cause that the cron\nruns at 05:15 in the timezone, corresponding to:\n* 04:15 GMT in winter time\n* 03:15 GMT in summer saving daylight time.", "committedDate": "2020-04-03T10:24:36Z", "type": "commit"}, {"oid": "d7f122fc9e7605700c6ddd97d491fc7e547759aa", "url": "https://github.com/geonetwork/core-geonetwork/commit/d7f122fc9e7605700c6ddd97d491fc7e547759aa", "message": "Add more info to `system/harvesting/timeZonez help text", "committedDate": "2020-04-03T10:24:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxODYzMw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4576#discussion_r402918633", "bodyText": "Why not setting a global timezone? This could be a start of fixing #1970. We also have other cron tasks that are not harvester and may also be affected by that change?", "author": "fxprunayre", "createdAt": "2020-04-03T10:44:48Z", "path": "core/src/main/java/org/fao/geonet/kernel/setting/Settings.java", "diffHunk": "@@ -112,6 +112,7 @@\n     public static final String SYSTEM_HARVESTING_MAIL_TEMPLATE_WARNING = \"system/harvesting/mail/templateWarning\";\n     public static final String SYSTEM_HARVESTING_MAIL_TEMPLATE_ERROR = \"system/harvesting/mail/templateError\";\n     public static final String SYSTEM_HARVESTING_MAIL_TEMPLATE = \"system/harvesting/mail/template\";\n+    public static final String SYSTEM_HARVESTING_TIMEZONE = \"system/harvesting/timeZone\";", "originalCommit": "d7f122fc9e7605700c6ddd97d491fc7e547759aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkyMzExMg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4576#discussion_r402923112", "bodyText": "QuartzSchedulerUtils.getTrigger(..., TimeZone tz) is only used in AbstractParams.getTrigger() function, so no other jobs are affected apart of the harvesters.", "author": "juanluisrp", "createdAt": "2020-04-03T10:53:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxODYzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkyNzkyMg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4576#discussion_r402927922", "bodyText": "Why not setting a global timezone? This could be a start of fixing #1970\n\nIt would be a bit confusing if we set as a global timezone and we don't fix all the issues described in #1970 yet, wouldn't it?", "author": "juanluisrp", "createdAt": "2020-04-03T11:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxODYzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkyOTMwNg==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4576#discussion_r402929306", "bodyText": "It could be a good start (and if we don't have resources to do more than the harvesting) let's add in the settings help text that the timezone only applies to harvester schedule for now ?", "author": "fxprunayre", "createdAt": "2020-04-03T11:05:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxODYzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjk0MzkxNw==", "url": "https://github.com/geonetwork/core-geonetwork/pull/4576#discussion_r402943917", "bodyText": "+1 to use a global timezone setting\ni wonder if it makes sense if specific users would like to set the timezone specific to their local situation (for global portals)\nhaving it as a global setting first would allow us to specify it for specific users later?\nconsidering that use case, it would make sense to introduce a database setting for it and not an xml setting.", "author": "pvgenuchten", "createdAt": "2020-04-03T11:36:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjkxODYzMw=="}], "type": "inlineReview"}, {"oid": "6f83e8df9846c79ab4dec66a3377de7475750745", "url": "https://github.com/geonetwork/core-geonetwork/commit/6f83e8df9846c79ab4dec66a3377de7475750745", "message": "Remove unused html directive template", "committedDate": "2020-04-03T10:55:58Z", "type": "commit"}, {"oid": "1f040701c07d7319b96d81681f467b65ffaddba2", "url": "https://github.com/geonetwork/core-geonetwork/commit/1f040701c07d7319b96d81681f467b65ffaddba2", "message": "Change the harvesters timezone setting name\n\n* Now the setting is `system/server/timeZone`.\n* Reschedule the harvesters when timezone setting changes.", "committedDate": "2020-04-15T13:45:36Z", "type": "commit"}, {"oid": "f0866a74dc7c7c52e26d819372c943bdcbad12f2", "url": "https://github.com/geonetwork/core-geonetwork/commit/f0866a74dc7c7c52e26d819372c943bdcbad12f2", "message": "Fix setting name after renaming", "committedDate": "2020-04-15T15:37:33Z", "type": "commit"}]}