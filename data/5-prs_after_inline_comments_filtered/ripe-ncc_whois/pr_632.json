{"pr_number": 632, "pr_title": "Rdap query limit", "pr_createdAt": "2020-05-18T13:15:15Z", "pr_url": "https://github.com/RIPE-NCC/whois/pull/632", "timeline": [{"oid": "a6aef43f80102e61597c164d0f386ac782624177", "url": "https://github.com/RIPE-NCC/whois/commit/a6aef43f80102e61597c164d0f386ac782624177", "message": "rdap limit query result", "committedDate": "2020-05-15T14:13:43Z", "type": "commit"}, {"oid": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d", "url": "https://github.com/RIPE-NCC/whois/commit/3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d", "message": "add test cases and notice banner for rdap", "committedDate": "2020-05-18T11:51:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjY3Njk1NQ==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r426676955", "bodyText": "Typo performace -> performance", "author": "sbusk", "createdAt": "2020-05-18T14:41:33Z", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {\n+            final Notice notice = new Notice();\n+            notice.setTitle(\"Search result cap to \" + maxResultSize);\n+            notice.getDescription().add(\"Due to performace issue, we have capped the maximum search result to \" + maxResultSize);", "originalCommit": "3cea3f0e35a939ba7e1c46bfbe9ef4af9aebd49d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "46a93297dfa6b2d5ba001eec9aa3d67260a765aa", "url": "https://github.com/RIPE-NCC/whois/commit/46a93297dfa6b2d5ba001eec9aa3d67260a765aa", "message": "correct typo mistake", "committedDate": "2020-05-18T15:39:58Z", "type": "commit"}, {"oid": "f47c8fb4d2ed05ffe47d964ea80bd0ed4960d8b2", "url": "https://github.com/RIPE-NCC/whois/commit/f47c8fb4d2ed05ffe47d964ea80bd0ed4960d8b2", "message": "fulltext search limit 100", "committedDate": "2020-05-19T11:21:36Z", "type": "commit"}, {"oid": "4f8e0f0f64ad6831fb190dcfe140cbde462083e4", "url": "https://github.com/RIPE-NCC/whois/commit/4f8e0f0f64ad6831fb190dcfe140cbde462083e4", "message": "add test", "committedDate": "2020-05-19T14:17:13Z", "type": "commit"}, {"oid": "217f9d802d14678817ce490fcc39663310fe1b6a", "url": "https://github.com/RIPE-NCC/whois/commit/217f9d802d14678817ce490fcc39663310fe1b6a", "message": "Merge branch 'fulltext_limit_rows' into rdap_query_limit", "committedDate": "2020-05-19T14:17:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430053532", "bodyText": "Is it possible that objects.size() can be larger than maxResultSize ?", "author": "eshryane", "createdAt": "2020-05-25T19:23:23Z", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {", "originalCommit": "217f9d802d14678817ce490fcc39663310fe1b6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIxODcwNg==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430218706", "bodyText": "it can be smaller than max result size, this condition is used to add a notice in case it is above the limit. if the result is smaller we donot need to add a notice", "author": "maggarwal13", "createdAt": "2020-05-26T07:47:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIyMTg3NQ==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430221875", "bodyText": "Thanks!", "author": "eshryane", "createdAt": "2020-05-26T07:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1MzUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1Mzk0MA==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430053940", "bodyText": "I suggest simplifying the text as 'limited search results to ... maximum' (s/capped/limited/g) and no need for details in the description.", "author": "eshryane", "createdAt": "2020-05-25T19:25:04Z", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/RdapObjectMapper.java", "diffHunk": "@@ -138,6 +137,14 @@ public Object mapSearch(final String requestUrl, final List<RpslObject> objects,\n             }\n         }\n \n+        if(objects.size() == maxResultSize) {\n+            final Notice notice = new Notice();\n+            notice.setTitle(\"Search result cap to \" + maxResultSize);", "originalCommit": "217f9d802d14678817ce490fcc39663310fe1b6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1NDEzMA==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430054130", "bodyText": "Prefix with 'sort consistently ... for predictable search results'", "author": "eshryane", "createdAt": "2020-05-25T19:26:00Z", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapService.java", "diffHunk": "@@ -73,7 +77,11 @@\n     private static final String CONTENT_TYPE_RDAP_JSON = \"application/rdap+json\";\n     private static final Joiner COMMA_JOINER = Joiner.on(\",\");\n \n-    private static final int SEARCH_MAX_RESULTS = 100;\n+    //necessary for predictable search results", "originalCommit": "217f9d802d14678817ce490fcc39663310fe1b6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDA1NDMxNQ==", "url": "https://github.com/RIPE-NCC/whois/pull/632#discussion_r430054315", "bodyText": "Change your IDE settings to not use asterisk for importing packages (it's harder to see what's imported, and what changes)", "author": "eshryane", "createdAt": "2020-05-25T19:26:59Z", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapQueryLimitTestIntegration.java", "diffHunk": "@@ -0,0 +1,261 @@\n+package net.ripe.db.whois.api.rdap;\n+\n+import com.google.common.collect.Lists;\n+import com.google.common.net.HttpHeaders;\n+import net.ripe.db.whois.api.fulltextsearch.FullTextIndex;\n+import net.ripe.db.whois.api.rdap.domain.Action;\n+import net.ripe.db.whois.api.rdap.domain.Autnum;\n+import net.ripe.db.whois.api.rdap.domain.Domain;\n+import net.ripe.db.whois.api.rdap.domain.Entity;\n+import net.ripe.db.whois.api.rdap.domain.Event;\n+import net.ripe.db.whois.api.rdap.domain.Ip;\n+import net.ripe.db.whois.api.rdap.domain.Link;\n+import net.ripe.db.whois.api.rdap.domain.Nameserver;\n+import net.ripe.db.whois.api.rdap.domain.Notice;\n+import net.ripe.db.whois.api.rdap.domain.RdapObject;\n+import net.ripe.db.whois.api.rdap.domain.Remark;\n+import net.ripe.db.whois.api.rdap.domain.Role;\n+import net.ripe.db.whois.api.rdap.domain.SearchResult;\n+import net.ripe.db.whois.common.IntegrationTest;\n+import net.ripe.db.whois.query.support.TestWhoisLog;\n+import org.hamcrest.Matchers;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+import org.junit.experimental.categories.Category;\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.test.annotation.DirtiesContext;\n+\n+import javax.ws.rs.BadRequestException;\n+import javax.ws.rs.HttpMethod;\n+import javax.ws.rs.NotFoundException;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.time.LocalDateTime;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.stream.Collectors;\n+\n+import static org.hamcrest.Matchers.*;", "originalCommit": "217f9d802d14678817ce490fcc39663310fe1b6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7bb5f0d8ca92fc9ede0ef8e5281c5a54268a798b", "url": "https://github.com/RIPE-NCC/whois/commit/7bb5f0d8ca92fc9ede0ef8e5281c5a54268a798b", "message": "implement Ed suggestions", "committedDate": "2020-05-26T08:14:58Z", "type": "commit"}, {"oid": "13f9f1e2e61d3bb35c39e983c7ba859379c34fb4", "url": "https://github.com/RIPE-NCC/whois/commit/13f9f1e2e61d3bb35c39e983c7ba859379c34fb4", "message": "change comment text", "committedDate": "2020-05-26T08:20:46Z", "type": "commit"}]}