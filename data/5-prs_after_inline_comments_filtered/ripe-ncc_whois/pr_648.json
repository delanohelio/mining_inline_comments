{"pr_number": 648, "pr_title": "Rdap cors changes", "pr_createdAt": "2020-08-04T09:34:43Z", "pr_url": "https://github.com/RIPE-NCC/whois/pull/648", "timeline": [{"oid": "6b8f4998d91f9257f46dbccf37dd466df903e360", "url": "https://github.com/RIPE-NCC/whois/commit/6b8f4998d91f9257f46dbccf37dd466df903e360", "message": "rdap cors changes", "committedDate": "2020-08-03T11:15:48Z", "type": "commit"}, {"oid": "99e154f55e7e9673fd9daca62fe9054ba3b6b57b", "url": "https://github.com/RIPE-NCC/whois/commit/99e154f55e7e9673fd9daca62fe9054ba3b6b57b", "message": "fix tests", "committedDate": "2020-08-03T13:00:51Z", "type": "commit"}, {"oid": "f06efd931bb98d2be88965e3430a576e369caf3a", "url": "https://github.com/RIPE-NCC/whois/commit/f06efd931bb98d2be88965e3430a576e369caf3a", "message": "Resolved TODO", "committedDate": "2020-08-04T13:02:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAyNjgwNw==", "url": "https://github.com/RIPE-NCC/whois/pull/648#discussion_r465026807", "bodyText": "Remove setting ALLOWED_ORIGINS_PARAM if \"*\" already the default", "author": "eshryane", "createdAt": "2020-08-04T12:52:37Z", "path": "whois-api/src/main/java/net/ripe/db/whois/api/rdap/WhoisRdapServletDeployer.java", "diffHunk": "@@ -33,7 +35,10 @@ public void deploy(final WebAppContext context) {\n         rdapJsonProvider.configure(SerializationFeature.INDENT_OUTPUT, true);\n \n         // allow cross-origin requests from ANY origin (by default)\n-        context.addFilter(org.eclipse.jetty.servlets.CrossOriginFilter.class, \"/rdap/*\", EnumSet.allOf(DispatcherType.class));\n+        final FilterHolder crossOriginFilterHolder = context.addFilter(org.eclipse.jetty.servlets.CrossOriginFilter.class, \"/rdap/*\", EnumSet.allOf(DispatcherType.class));\n+        crossOriginFilterHolder.setInitParameter(CrossOriginFilter.ALLOW_CREDENTIALS_PARAM, \"false\");\n+        crossOriginFilterHolder.setInitParameter(CrossOriginFilter.ALLOWED_METHODS_PARAM, \"GET, OPTIONS\");\n+        crossOriginFilterHolder.setInitParameter(CrossOriginFilter.ALLOWED_ORIGINS_PARAM, \"*\");", "originalCommit": "99e154f55e7e9673fd9daca62fe9054ba3b6b57b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAyNzcyNw==", "url": "https://github.com/RIPE-NCC/whois/pull/648#discussion_r465027727", "bodyText": "Can you use the same pattern as the other tests, i.e.\nassertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS), is(nullValue());", "author": "eshryane", "createdAt": "2020-08-04T12:54:07Z", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapServiceTestIntegration.java", "diffHunk": "@@ -1778,7 +1779,7 @@ public void cross_origin_preflight_request_from_apps_db_ripe_net_is_allowed() {\n                 .options();\n \n         assertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_ORIGIN), is(\"https://apps.db.ripe.net\"));\n-        assertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS), is(\"true\"));\n+        assertNull(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS));", "originalCommit": "99e154f55e7e9673fd9daca62fe9054ba3b6b57b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAyODExNA==", "url": "https://github.com/RIPE-NCC/whois/pull/648#discussion_r465028114", "bodyText": "Use assertThat.. nullValue() rather than assertNull", "author": "eshryane", "createdAt": "2020-08-04T12:54:41Z", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapServiceTestIntegration.java", "diffHunk": "@@ -1790,7 +1791,7 @@ public void cross_origin_preflight_request_from_outside_ripe_net_is_allowed() {\n                 .options();\n \n         assertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_ORIGIN), is(\"http://www.foo.net\"));\n-        assertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS), is(\"true\"));\n+        assertNull(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS));", "originalCommit": "99e154f55e7e9673fd9daca62fe9054ba3b6b57b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTAzMzkxMA==", "url": "https://github.com/RIPE-NCC/whois/pull/648#discussion_r465033910", "bodyText": "N.B. I changed this test method as POST is not allowed", "author": "eshryane", "createdAt": "2020-08-04T13:04:03Z", "path": "whois-api/src/test/java/net/ripe/db/whois/api/rdap/WhoisRdapServiceTestIntegration.java", "diffHunk": "@@ -1790,20 +1792,49 @@ public void cross_origin_preflight_request_from_outside_ripe_net_is_allowed() {\n                 .options();\n \n         assertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_ORIGIN), is(\"http://www.foo.net\"));\n-        assertThat(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS), is(\"true\"));\n+        assertNull(response.getHeaderString(HttpHeaders.ACCESS_CONTROL_ALLOW_CREDENTIALS));\n     }\n \n     @Test\n-    public void cross_origin_preflight_post_request_from_outside_ripe_net_is_allowed() {\n+    public void cross_origin_preflight_post_request_from_outside_ripe_net_is_not_allowed() {", "originalCommit": "f06efd931bb98d2be88965e3430a576e369caf3a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5be68ee699cb3442bc669bc72599929f0ac12569", "url": "https://github.com/RIPE-NCC/whois/commit/5be68ee699cb3442bc669bc72599929f0ac12569", "message": "Implement Ed suggestions", "committedDate": "2020-08-04T13:12:46Z", "type": "commit"}]}