{"pr_number": 7514, "pr_title": "IGNITE-12773 : Reduce number of cluster deactivation methods in internal API.", "pr_createdAt": "2020-03-11T17:08:58Z", "pr_url": "https://github.com/apache/ignite/pull/7514", "timeline": [{"oid": "75d69e56fea1d1486ba372eaa414a07d95fd866a", "url": "https://github.com/apache/ignite/commit/75d69e56fea1d1486ba372eaa414a07d95fd866a", "message": "first impl.", "committedDate": "2020-03-11T17:02:04Z", "type": "commit"}, {"oid": "f7546f02209f332e5725fd36599abb977c38d68d", "url": "https://github.com/apache/ignite/commit/f7546f02209f332e5725fd36599abb977c38d68d", "message": "IGNITE-12773 : minority.", "committedDate": "2020-03-11T17:06:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5MjQ4Mg==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391592482", "bodyText": "There is no cluster deactivation, forceDeactivation should be false.", "author": "NSAmelchev", "createdAt": "2020-03-12T12:39:36Z", "path": "modules/clients/src/test/java/org/apache/ignite/internal/processors/rest/ChangeStateCommandHandlerTest.java", "diffHunk": "@@ -87,23 +89,23 @@\n     public void testActivateDeActivate() throws GridClientException {\n         GridClientClusterState state = client.state();\n \n-        boolean active = state.active();\n+        boolean active = state.state() == ACTIVE;\n \n         assertTrue(active);\n \n-        state.active(false);\n+        state.state(INACTIVE, true);\n \n         IgniteEx ig1 = grid(0);\n         IgniteEx ig2 = grid(1);\n \n         assertFalse(ig1.active());\n         assertFalse(ig2.active());\n-        assertFalse(state.active());\n+        assertEquals(state.state(), INACTIVE);\n \n-        state.active(true);\n+        state.state(ACTIVE, true);", "originalCommit": "f7546f02209f332e5725fd36599abb977c38d68d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwMjU5Ng==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391602596", "bodyText": "There is no cluster deactivation, forceDeactivation should be false.\n\nPrevious invocations were considered forced regardless of certain state. Shouldn't we do the same way?", "author": "Vladsz83", "createdAt": "2020-03-12T12:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5MjQ4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY0MDY2Mw==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391640663", "bodyText": "Previous deprecated call was forced internally for both cases. I suggest do not forcing new public method call to cluster activation.", "author": "NSAmelchev", "createdAt": "2020-03-12T14:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5MjQ4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5MzgwNA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391593804", "bodyText": "Can static import be used? like previuos test used", "author": "NSAmelchev", "createdAt": "2020-03-12T12:42:01Z", "path": "modules/clients/src/test/java/org/apache/ignite/jdbc/thin/MvccJdbcTransactionFinishOnDeactivatedClusterSelfTest.java", "diffHunk": "@@ -153,7 +154,7 @@ private void deactivateThroughClient() throws Exception {\n \n             log.info(\">>> Try to deactivate ...\");\n \n-            state.active(false);\n+            state.state(ClusterState.INACTIVE, true);", "originalCommit": "f7546f02209f332e5725fd36599abb977c38d68d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwMzI2OA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391603268", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-12T12:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5MzgwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5NDc1NA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391594754", "bodyText": "GridClientConnection::currentState now unused. Seems can be removed too", "author": "NSAmelchev", "createdAt": "2020-03-12T12:43:44Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/client/impl/GridClientClusterStateImpl.java", "diffHunk": "@@ -54,16 +53,6 @@ public GridClientClusterStateImpl(\n         super(client, nodes, filter, balancer);\n     }\n \n-    /** {@inheritDoc} */\n-    @Override public void active(final boolean active) throws GridClientException {\n-        state(active ? ACTIVE : INACTIVE, true);\n-    }\n-\n-    /** {@inheritDoc} */\n-    @Override public boolean active() throws GridClientException {\n-        return withReconnectHandling(GridClientConnection::currentState).get();", "originalCommit": "f7546f02209f332e5725fd36599abb977c38d68d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwNDk4Mg==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391604982", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-12T13:03:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5NDc1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5NjYzNA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391596634", "bodyText": "Why forceDeactivation should be true for cluster activate?", "author": "NSAmelchev", "createdAt": "2020-03-12T12:47:25Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/cluster/IgniteClusterImpl.java", "diffHunk": "@@ -313,7 +315,7 @@ public IgniteClusterImpl(GridKernalContext ctx) {\n         guard();\n \n         try {\n-            ctx.state().changeGlobalState(active, serverNodes(), false).get();\n+            ctx.state().changeGlobalState(active ? ACTIVE : INACTIVE, true, serverNodes(), false, false).get();", "originalCommit": "f7546f02209f332e5725fd36599abb977c38d68d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwNTg0Mw==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391605843", "bodyText": "All previous internal invocations were considered forced. I think we should not change it where not required. Not-forced call are considered only for user commands through command.sh/Rest .", "author": "Vladsz83", "createdAt": "2020-03-12T13:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5NjYzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5NzU0Mg==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391597542", "bodyText": "Why forceDeactivation should be true for cluster activate?", "author": "NSAmelchev", "createdAt": "2020-03-12T12:49:05Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/commandline/ActivateCommand.java", "diffHunk": "@@ -49,7 +50,7 @@\n         try (GridClient client = Command.startClient(cfg)) {\n             GridClientClusterState state = client.state();\n \n-            state.active(true);\n+            state.state(ACTIVE, true);", "originalCommit": "f7546f02209f332e5725fd36599abb977c38d68d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTYwNjE1Ng==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391606156", "bodyText": "Same. Previous invocations were considered forced. I think we should not change it where not required.", "author": "Vladsz83", "createdAt": "2020-03-12T13:05:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTU5NzU0Mg=="}], "type": "inlineReview"}, {"oid": "15ca05bc3cb4b8f2346250e758df3512a0d09c96", "url": "https://github.com/apache/ignite/commit/15ca05bc3cb4b8f2346250e758df3512a0d09c96", "message": "IGNITE-12773 : fixes", "committedDate": "2020-03-12T13:06:26Z", "type": "commit"}, {"oid": "fa783a5cca19309d38c304e55b025e4ac90caa76", "url": "https://github.com/apache/ignite/commit/fa783a5cca19309d38c304e55b025e4ac90caa76", "message": "IGNITE-12773 : false flag for cluster activation.", "committedDate": "2020-03-12T14:20:24Z", "type": "commit"}, {"oid": "846e4c67d5f1e6bb772125df74d61ab2bff6ed03", "url": "https://github.com/apache/ignite/commit/846e4c67d5f1e6bb772125df74d61ab2bff6ed03", "message": "IGNITE-12773 : fix of param description order.", "committedDate": "2020-03-12T14:27:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2NTQzMw==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391665433", "bodyText": "Mixed up expected-actual", "author": "NSAmelchev", "createdAt": "2020-03-12T14:37:00Z", "path": "modules/clients/src/test/java/org/apache/ignite/internal/processors/rest/ChangeStateCommandHandlerTest.java", "diffHunk": "@@ -87,23 +89,23 @@\n     public void testActivateDeActivate() throws GridClientException {\n         GridClientClusterState state = client.state();\n \n-        boolean active = state.active();\n+        boolean active = state.state() == ACTIVE;\n \n         assertTrue(active);\n \n-        state.active(false);\n+        state.state(INACTIVE, true);\n \n         IgniteEx ig1 = grid(0);\n         IgniteEx ig2 = grid(1);\n \n         assertFalse(ig1.active());\n         assertFalse(ig2.active());\n-        assertFalse(state.active());\n+        assertEquals(state.state(), INACTIVE);", "originalCommit": "846e4c67d5f1e6bb772125df74d61ab2bff6ed03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2ODQ3MA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391668470", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-12T14:41:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2NTQzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2NTQ5Mw==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391665493", "bodyText": "Mixed up expected-actual", "author": "NSAmelchev", "createdAt": "2020-03-12T14:37:05Z", "path": "modules/clients/src/test/java/org/apache/ignite/internal/processors/rest/ChangeStateCommandHandlerTest.java", "diffHunk": "@@ -87,23 +89,23 @@\n     public void testActivateDeActivate() throws GridClientException {\n         GridClientClusterState state = client.state();\n \n-        boolean active = state.active();\n+        boolean active = state.state() == ACTIVE;\n \n         assertTrue(active);\n \n-        state.active(false);\n+        state.state(INACTIVE, true);\n \n         IgniteEx ig1 = grid(0);\n         IgniteEx ig2 = grid(1);\n \n         assertFalse(ig1.active());\n         assertFalse(ig2.active());\n-        assertFalse(state.active());\n+        assertEquals(state.state(), INACTIVE);\n \n-        state.active(true);\n+        state.state(ACTIVE, false);\n \n         assertTrue(ig1.active());\n         assertTrue(ig2.active());\n-        assertTrue(state.active());\n+        assertEquals(state.state(), ACTIVE);", "originalCommit": "846e4c67d5f1e6bb772125df74d61ab2bff6ed03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2ODQxOA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391668418", "bodyText": "Fixed.", "author": "Vladsz83", "createdAt": "2020-03-12T14:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY2NTQ5Mw=="}], "type": "inlineReview"}, {"oid": "854df30c311f42b9b066a036d1ec30b79e42c635", "url": "https://github.com/apache/ignite/commit/854df30c311f42b9b066a036d1ec30b79e42c635", "message": "IGNITE-12779 : small fix in tests", "committedDate": "2020-03-12T14:40:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3MTI5NA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391671294", "bodyText": "ClusterState.active(ClusterState state) was used.", "author": "NSAmelchev", "createdAt": "2020-03-12T14:45:29Z", "path": "modules/clients/src/test/java/org/apache/ignite/internal/processors/rest/ChangeStateCommandHandlerTest.java", "diffHunk": "@@ -87,23 +89,23 @@\n     public void testActivateDeActivate() throws GridClientException {\n         GridClientClusterState state = client.state();\n \n-        boolean active = state.active();\n+        boolean active = state.state() == ACTIVE;", "originalCommit": "854df30c311f42b9b066a036d1ec30b79e42c635", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3NjU5NA==", "url": "https://github.com/apache/ignite/pull/7514#discussion_r391676594", "bodyText": "ClusterState.active(ClusterState state) was used.\n\nGridClientClusterState.active() was used, no? Changed to GridClientClusterState.state(). Isn't is ok?", "author": "Vladsz83", "createdAt": "2020-03-12T14:53:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTY3MTI5NA=="}], "type": "inlineReview"}, {"oid": "5cc1072566e64ed233486cb0cf68638116a9f016", "url": "https://github.com/apache/ignite/commit/5cc1072566e64ed233486cb0cf68638116a9f016", "message": "IGNITE-12773 : minor fix in test.", "committedDate": "2020-03-12T15:01:10Z", "type": "commit"}, {"oid": "857c4ba4406374f03ad89a494441f0f409c2c707", "url": "https://github.com/apache/ignite/commit/857c4ba4406374f03ad89a494441f0f409c2c707", "message": "IGNITE-12773 : minor fix2 in test.", "committedDate": "2020-03-12T15:02:35Z", "type": "commit"}, {"oid": "26c7a9eec319a32060cd953051d3fab8a0e01211", "url": "https://github.com/apache/ignite/commit/26c7a9eec319a32060cd953051d3fab8a0e01211", "message": "IGNITE-12773 : better diff.", "committedDate": "2020-03-19T11:06:06Z", "type": "commit"}, {"oid": "26f903cee5c29d5dcd0c81392efbf62d62b36792", "url": "https://github.com/apache/ignite/commit/26f903cee5c29d5dcd0c81392efbf62d62b36792", "message": "IGNITE-12773 : reverted call without isAutoAdjust.", "committedDate": "2020-03-19T13:15:30Z", "type": "commit"}, {"oid": "fe4b225e21c621c08514ff9c82c70a2bf6503874", "url": "https://github.com/apache/ignite/commit/fe4b225e21c621c08514ff9c82c70a2bf6503874", "message": "IGNITE-12773 : removed call with isAutoAdjust from the itf.", "committedDate": "2020-03-19T15:06:29Z", "type": "commit"}, {"oid": "403cbc2c8053644184f4cfc393c49bd5be2ddcde", "url": "https://github.com/apache/ignite/commit/403cbc2c8053644184f4cfc393c49bd5be2ddcde", "message": "IGNITE-12773 : checkstyle fix.", "committedDate": "2020-03-19T20:18:47Z", "type": "commit"}, {"oid": "d2627dab3573f91b83e9297539d34bbc8cf10a1d", "url": "https://github.com/apache/ignite/commit/d2627dab3573f91b83e9297539d34bbc8cf10a1d", "message": "IGNITE-12773 : + comment.", "committedDate": "2020-03-20T05:54:39Z", "type": "commit"}]}