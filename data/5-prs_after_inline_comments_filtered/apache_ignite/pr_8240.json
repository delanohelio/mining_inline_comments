{"pr_number": 8240, "pr_title": "IGNITE-13427 Fix Metastore view iteration on unmarshalleable keys", "pr_createdAt": "2020-09-10T17:26:04Z", "pr_url": "https://github.com/apache/ignite/pull/8240", "timeline": [{"oid": "5015fc6b1f0824cdafcf64901158da8f7d265392", "url": "https://github.com/apache/ignite/commit/5015fc6b1f0824cdafcf64901158da8f7d265392", "message": "IGNITE-13427: Fix iteration on unmarshalleable keys", "committedDate": "2020-09-10T17:25:36Z", "type": "commit"}, {"oid": "5c46c86673afa103ffd270141d2b78155b14f20a", "url": "https://github.com/apache/ignite/commit/5c46c86673afa103ffd270141d2b78155b14f20a", "message": "IGNITE-13427: Fix iteration on unmarshalleable keys", "committedDate": "2020-09-10T17:26:32Z", "type": "commit"}, {"oid": "cd1f1e3311e323a7930324d979a90e6406f5b808", "url": "https://github.com/apache/ignite/commit/cd1f1e3311e323a7930324d979a90e6406f5b808", "message": "IGNITE-13427: Fix iteration on unmarshalleable keys", "committedDate": "2020-09-10T17:27:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4Njg3NjM4MA==", "url": "https://github.com/apache/ignite/pull/8240#discussion_r486876380", "bodyText": "I suggest to add to javadoc info about that null value is can be raw data.\nAs alternative way show something like [Raw data] instead of null.", "author": "NSAmelchev", "createdAt": "2020-09-11T08:57:51Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/cache/persistence/GridCacheDatabaseSharedManager.java", "diffHunk": "@@ -412,8 +413,16 @@ private void registerSystemView() {\n                 try {\n                     List<MetastorageView> data = new ArrayList<>();\n \n-                    metaStorage.iterate(\"\", (key, val) ->\n-                        data.add(new MetastorageView(key, IgniteUtils.toStringSafe(val))), true);\n+                    metaStorage.iterate(\"\", (key, valBytes) -> {\n+                        try {\n+                            Serializable val = metaStorage.marshaller().unmarshal((byte[])valBytes, U.gridClassLoader());\n+\n+                            data.add(new MetastorageView(key, IgniteUtils.toStringSafe(val)));\n+                        }\n+                        catch (IgniteCheckedException ignored) {\n+                            data.add(new MetastorageView(key, null));", "originalCommit": "cd1f1e3311e323a7930324d979a90e6406f5b808", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6ac0ff917d16fe6d838766d463ea90f19827b5d8", "url": "https://github.com/apache/ignite/commit/6ac0ff917d16fe6d838766d463ea90f19827b5d8", "message": "IGNITE-13427 Unmarshallable data displayed as \"[Raw data. n bytes]\"", "committedDate": "2020-09-11T12:15:11Z", "type": "commit"}, {"oid": "9e8a90d58e03af52f25369cab5b84ecd8edfbd2f", "url": "https://github.com/apache/ignite/commit/9e8a90d58e03af52f25369cab5b84ecd8edfbd2f", "message": "IGNITE-13427 Unmarshallable data displayed as \"[Raw data. n bytes]\"", "committedDate": "2020-09-11T12:17:44Z", "type": "commit"}, {"oid": "78935332cf2b054e1b6a5b95cfa2cf1550afce45", "url": "https://github.com/apache/ignite/commit/78935332cf2b054e1b6a5b95cfa2cf1550afce45", "message": "IGNITE-13427 Unmarshallable data displayed as \"[Raw data. n bytes]\"", "committedDate": "2020-09-11T12:32:36Z", "type": "commit"}, {"oid": "0fefe1ea00e919ceadd035316af688b8ce5af42b", "url": "https://github.com/apache/ignite/commit/0fefe1ea00e919ceadd035316af688b8ce5af42b", "message": "IGNITE-13427 Unmarshallable data displayed as \"[Raw data. n bytes]\"", "committedDate": "2020-09-11T12:53:18Z", "type": "commit"}]}