{"pr_number": 3690, "pr_title": "#3660 Adding multiple term create view API", "pr_createdAt": "2020-09-25T12:33:09Z", "pr_url": "https://github.com/odpi/egeria/pull/3690", "timeline": [{"oid": "ef19cdcf51b0b196294705a86046ac761e13eedf", "url": "https://github.com/odpi/egeria/commit/ef19cdcf51b0b196294705a86046ac761e13eedf", "message": "#3660 Adding multiple term create view API\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-09-25T12:31:38Z", "type": "commit"}, {"oid": "840cee61bec66c38b2e37496e382f139828e1c47", "url": "https://github.com/odpi/egeria/commit/840cee61bec66c38b2e37496e382f139828e1c47", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3660", "committedDate": "2020-09-25T12:33:43Z", "type": "commit"}, {"oid": "b44db9fd133a4963c8183ab963a784f9b871fef7", "url": "https://github.com/odpi/egeria/commit/b44db9fd133a4963c8183ab963a784f9b871fef7", "message": "#3660 Adding multiple term create view API\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-09-25T12:48:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk3OTE2Mg==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r494979162", "bodyText": "Could you make it like this. I would you it like this.\n    public SubjectAreaOMASAPIResponse<Term> createMultipleTermsInAGlossary(String serverName, String userId, String guid, Term[] terms) {\n        final String methodName = \"createMultipleTermsInAGlossary\";\n        RESTCallToken token = restCallLogger.logRESTCall(serverName, userId, methodName);\n        SubjectAreaOMASAPIResponse<Term> response = new SubjectAreaOMASAPIResponse<>();\n        AuditLog auditLog = null;\n        \n        try {\n            SubjectAreaNodeClients clients = instanceHandler.getSubjectAreaNodeClients(serverName, userId, methodName);\n            auditLog = instanceHandler.getAuditLog(userId, serverName, methodName);\n            for (Term term : terms) {\n                GlossarySummary glossarySummary = new GlossarySummary();\n                glossarySummary.setGuid(guid);\n                term.setGlossary(glossarySummary);\n                Term createdTerm = clients.terms().create(userId, term);\n                response.addResult(createdTerm);\n            }\n        } catch (Throwable error) {\n            response = getResponseForError(error, auditLog, className, methodName);\n        }\n        restCallLogger.logRESTCallReturn(token, response.toString());\n        return response;\n    }", "author": "immmus", "createdAt": "2020-09-25T13:15:33Z", "path": "open-metadata-implementation/view-services/glossary-author-view/glossary-author-view-server/src/main/java/org/odpi/openmetadata/viewservices/glossaryauthor/services/GlossaryAuthorViewGlossaryRESTServices.java", "diffHunk": "@@ -361,10 +364,60 @@ public GlossaryAuthorViewGlossaryRESTServices() {\n             SubjectAreaNodeClients clients = instanceHandler.getSubjectAreaNodeClients(serverName, userId, methodName);\n             Glossary glossary = clients.glossaries().restore(userId, guid);\n             response.addResult(glossary);\n-        }  catch (Throwable error) {\n-            response =  getResponseForError(error, auditLog, className, methodName);\n+        } catch (Throwable error) {\n+            response = getResponseForError(error, auditLog, className, methodName);\n         }\n         restCallLogger.logRESTCallReturn(token, response.toString());\n         return response;\n     }\n+    /**\n+     * Create the supplied list of Terms in the glossary, identified by the supplied guid. Each term does not need to specify a glossary.\n+     *\n+     * @param serverName       local UI server name\n+     * @param userId           user identifier\n+     * @param guid             guid of the glossary under which the Terms will be created\n+     * @param terms            terms to create\n+     * @return a response which when successful contains a list of the responses from the Term creates (successful or otherwise). The order of the responses is the same as the supplied terms order.\n+     *\n+     * when not successful the following Exception responses can occur\n+     * <ul>\n+     * <li> UnrecognizedGUIDException            the supplied guid was not recognised</li>\n+     * <li> UserNotAuthorizedException           the requesting user is not authorized to issue this request.</li>\n+     * <li> FunctionNotSupportedException        Function not supported</li>\n+     * <li> InvalidParameterException            one of the parameters is null or invalid.</li>\n+     * <li> MetadataServerUncontactableException not able to communicate with a Metadata respository service.</li>\n+     * </ul>\n+     */\n+    public SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> createMultipleTermsInAGlossary(String serverName, String userId, String guid, Term[] terms) {", "originalCommit": "b44db9fd133a4963c8183ab963a784f9b871fef7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk4MzU3OQ==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r494983579", "bodyText": "In general, if I were you, I would solve this problem on the UI by sending several requests to this method -> public SubjectAreaOMASAPIResponse<Term> createTerm(String serverName, String userId, Term suppliedTerm), since in fact we are doing the same thing here.", "author": "immmus", "createdAt": "2020-09-25T13:22:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk3OTE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA1OTQ0NQ==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495059445", "bodyText": "@immmus thanks for your feedback.  In terms of your suggestion to do this in the UI, we have had extensive discussions and the consensus is that we should push this sort of business logic into the view server. This makes it very easy to issue one call in the UI. In general this sort of change is what the View services are for, surfacing UI specific artefacts that can be easily consumed.  I started doing this in the UI layer, the code would have been quite involved (I looked at solutions involving promise all, a new context and reducer for this, either way there is state to be managed in the Ui code); it is much neater to have it all in this little java method.\nI notice that you have suggested I change the response type to SubjectAreaOMASAPIResponse  Term . but I need to have the Term responses, so I can tell which ones completed successfully and the errors for those that failed. I notice also you are using the audit log , which I missed , I am looking to rework the fix to use the audit log for errors.", "author": "davidradl", "createdAt": "2020-09-25T15:18:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk3OTE2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTA3MDEzMw==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495070133", "bodyText": "@immmus the new fix is ready for review again.", "author": "davidradl", "createdAt": "2020-09-25T15:36:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDk3OTE2Mg=="}], "type": "inlineReview"}, {"oid": "2dec1ca3ac62fa88d54d27325436de84063ea2b6", "url": "https://github.com/odpi/egeria/commit/2dec1ca3ac62fa88d54d27325436de84063ea2b6", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3660", "committedDate": "2020-09-25T15:19:07Z", "type": "commit"}, {"oid": "9c54b13260127ead44b47581731fef03944a48ec", "url": "https://github.com/odpi/egeria/commit/9c54b13260127ead44b47581731fef03944a48ec", "message": "#3660 add audit log for error in response to review feedback\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-09-25T15:35:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxNjg4NA==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495416884", "bodyText": "AuditLog is not initialized. You need this call -> auditLog = instanceHandler.getAuditLog(userId, serverName, methodName); in try catch construction.", "author": "immmus", "createdAt": "2020-09-26T05:16:27Z", "path": "open-metadata-implementation/view-services/glossary-author-view/glossary-author-view-server/src/main/java/org/odpi/openmetadata/viewservices/glossaryauthor/services/GlossaryAuthorViewGlossaryRESTServices.java", "diffHunk": "@@ -390,10 +390,12 @@ public GlossaryAuthorViewGlossaryRESTServices() {\n      */\n     public SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> createMultipleTermsInAGlossary(String serverName, String userId, String guid, Term[] terms) {\n         final String methodName = \"createMultipleTermsInAGlossary\";\n+        RESTCallToken token = restCallLogger.logRESTCall(serverName, userId, methodName);\n+\n         List<SubjectAreaOMASAPIResponse<Term>> termList = new ArrayList<>();\n         SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> response = new SubjectAreaOMASAPIResponse<>();\n+        AuditLog auditLog = null;", "originalCommit": "9c54b13260127ead44b47581731fef03944a48ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNDc2Mw==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495434763", "bodyText": ":-) Good catch @immmus", "author": "davidradl", "createdAt": "2020-09-26T08:56:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxNjg4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNTM1Nw==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495435357", "bodyText": "changed", "author": "davidradl", "createdAt": "2020-09-26T09:04:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxNjg4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxNzM5OA==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495417398", "bodyText": "You are not need this collection. Use response.addResult(termResponse); instead of code in 413 line and remove collection.", "author": "immmus", "createdAt": "2020-09-26T05:23:05Z", "path": "open-metadata-implementation/view-services/glossary-author-view/glossary-author-view-server/src/main/java/org/odpi/openmetadata/viewservices/glossaryauthor/services/GlossaryAuthorViewGlossaryRESTServices.java", "diffHunk": "@@ -361,8 +364,57 @@ public GlossaryAuthorViewGlossaryRESTServices() {\n             SubjectAreaNodeClients clients = instanceHandler.getSubjectAreaNodeClients(serverName, userId, methodName);\n             Glossary glossary = clients.glossaries().restore(userId, guid);\n             response.addResult(glossary);\n-        }  catch (Throwable error) {\n-            response =  getResponseForError(error, auditLog, className, methodName);\n+        } catch (Throwable error) {\n+            response = getResponseForError(error, auditLog, className, methodName);\n+        }\n+        restCallLogger.logRESTCallReturn(token, response.toString());\n+        return response;\n+    }\n+    /**\n+     * Create the supplied list of Terms in the glossary, identified by the supplied guid. Each term does not need to specify a glossary.\n+     *\n+     * @param serverName       local UI server name\n+     * @param userId           user identifier\n+     * @param guid             guid of the glossary under which the Terms will be created\n+     * @param terms            terms to create\n+     * @return a response which when successful contains a list of the responses from the Term creates (successful or otherwise). The order of the responses is the same as the supplied terms order.\n+     *\n+     * when not successful the following Exception responses can occur\n+     * <ul>\n+     * <li> UnrecognizedGUIDException            the supplied guid was not recognised</li>\n+     * <li> UserNotAuthorizedException           the requesting user is not authorized to issue this request.</li>\n+     * <li> FunctionNotSupportedException        Function not supported</li>\n+     * <li> InvalidParameterException            one of the parameters is null or invalid.</li>\n+     * <li> MetadataServerUncontactableException not able to communicate with a Metadata respository service.</li>\n+     * </ul>\n+     */\n+    public SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> createMultipleTermsInAGlossary(String serverName, String userId, String guid, Term[] terms) {\n+        final String methodName = \"createMultipleTermsInAGlossary\";\n+        RESTCallToken token = restCallLogger.logRESTCall(serverName, userId, methodName);\n+\n+        List<SubjectAreaOMASAPIResponse<Term>> termList = new ArrayList<>();", "originalCommit": "9c54b13260127ead44b47581731fef03944a48ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNTM0MA==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495435340", "bodyText": "changed", "author": "davidradl", "createdAt": "2020-09-26T09:04:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxNzM5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxODA4Ng==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495418086", "bodyText": "I think not need this here because we already doing this action in SubjectAreaTermHandler during create term on the server. We also dont do this action in GlossaryAuthorViewTermRESTServices during create term.", "author": "immmus", "createdAt": "2020-09-26T05:32:21Z", "path": "open-metadata-implementation/view-services/glossary-author-view/glossary-author-view-server/src/main/java/org/odpi/openmetadata/viewservices/glossaryauthor/services/GlossaryAuthorViewGlossaryRESTServices.java", "diffHunk": "@@ -361,8 +364,57 @@ public GlossaryAuthorViewGlossaryRESTServices() {\n             SubjectAreaNodeClients clients = instanceHandler.getSubjectAreaNodeClients(serverName, userId, methodName);\n             Glossary glossary = clients.glossaries().restore(userId, guid);\n             response.addResult(glossary);\n-        }  catch (Throwable error) {\n-            response =  getResponseForError(error, auditLog, className, methodName);\n+        } catch (Throwable error) {\n+            response = getResponseForError(error, auditLog, className, methodName);\n+        }\n+        restCallLogger.logRESTCallReturn(token, response.toString());\n+        return response;\n+    }\n+    /**\n+     * Create the supplied list of Terms in the glossary, identified by the supplied guid. Each term does not need to specify a glossary.\n+     *\n+     * @param serverName       local UI server name\n+     * @param userId           user identifier\n+     * @param guid             guid of the glossary under which the Terms will be created\n+     * @param terms            terms to create\n+     * @return a response which when successful contains a list of the responses from the Term creates (successful or otherwise). The order of the responses is the same as the supplied terms order.\n+     *\n+     * when not successful the following Exception responses can occur\n+     * <ul>\n+     * <li> UnrecognizedGUIDException            the supplied guid was not recognised</li>\n+     * <li> UserNotAuthorizedException           the requesting user is not authorized to issue this request.</li>\n+     * <li> FunctionNotSupportedException        Function not supported</li>\n+     * <li> InvalidParameterException            one of the parameters is null or invalid.</li>\n+     * <li> MetadataServerUncontactableException not able to communicate with a Metadata respository service.</li>\n+     * </ul>\n+     */\n+    public SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> createMultipleTermsInAGlossary(String serverName, String userId, String guid, Term[] terms) {\n+        final String methodName = \"createMultipleTermsInAGlossary\";\n+        RESTCallToken token = restCallLogger.logRESTCall(serverName, userId, methodName);\n+\n+        List<SubjectAreaOMASAPIResponse<Term>> termList = new ArrayList<>();\n+        SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> response = new SubjectAreaOMASAPIResponse<>();\n+        AuditLog auditLog = null;\n+\n+        try {\n+\n+            SubjectAreaNodeClients clients = instanceHandler.getSubjectAreaNodeClients(serverName, userId, methodName);\n+            for (Term term : terms) {\n+                GlossarySummary glossarySummary = new GlossarySummary();", "originalCommit": "9c54b13260127ead44b47581731fef03944a48ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNTY2Mg==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495435662", "bodyText": "The idea was that the terms that are submitted need not have the glossary set in them, so I could set it here. This is an API under a particular glossary so all the terms should be associated with that glossary, which is why I have done it this way.", "author": "davidradl", "createdAt": "2020-09-26T09:07:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxODA4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNzg0Mg==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495437842", "bodyText": "I think it is not good idea because bring additional responsibility to this method. He already implies that all terms will be created in this glossary...", "author": "immmus", "createdAt": "2020-09-26T09:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxODA4Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxOTU2MQ==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495419561", "bodyText": "You need remove parameter \"guid\" after changes.", "author": "immmus", "createdAt": "2020-09-26T05:50:46Z", "path": "open-metadata-implementation/view-services/glossary-author-view/glossary-author-view-spring/src/main/java/org/odpi/openmetadata/viewservices/glossaryauthor/server/GlossaryAuthorViewGlossaryRESTResource.java", "diffHunk": "@@ -164,6 +166,33 @@ public GlossaryAuthorViewGlossaryRESTResource() {\n         return restAPI.getGlossaryRelationships(serverName, userId, guid, asOfTime, offset, pageSize, sequencingOrder, sequencingProperty);\n     }\n \n+    /**\n+     * Create the supplied list of Terms in the glossary, identified by the supplied guid. Each term does not need to specify a glossary.\n+     *\n+     * @param serverName       local UI server name\n+     * @param userId           user identifier\n+     * @param guid             guid of the glossary under which the Terms will be created\n+     * @param terms            terms to create\n+     * @return a response which when successful contains a list of the responses from the Term creates (successful or otherwise). The order of the responses is the same as the supplied terms order.\n+     *\n+     * when not successful the following Exception responses can occur\n+     * <ul>\n+     * <li> UnrecognizedGUIDException            the supplied guid was not recognised</li>\n+     * <li> UserNotAuthorizedException           the requesting user is not authorized to issue this request.</li>\n+     * <li> FunctionNotSupportedException        Function not supported</li>\n+     * <li> InvalidParameterException            one of the parameters is null or invalid.</li>\n+     * <li> MetadataServerUncontactableException not able to communicate with a Metadata respository service.</li>\n+     * </ul>\n+     */\n+    @PostMapping(path = \"/{guid}/terms\")\n+    public SubjectAreaOMASAPIResponse<SubjectAreaOMASAPIResponse<Term>> createMultipleTermsInAGlossary(@PathVariable String serverName,\n+                                                                                                   @PathVariable String userId,\n+                                                                                                   @PathVariable String guid,\n+                                                                                                   @RequestBody  Term[] terms\n+                                                                                                  ) {\n+        return restAPI.createMultipleTermsInAGlossary(serverName, userId, guid, terms);", "originalCommit": "9c54b13260127ead44b47581731fef03944a48ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQzNTcyMQ==", "url": "https://github.com/odpi/egeria/pull/3690#discussion_r495435721", "bodyText": "As above - I think we need it.", "author": "davidradl", "createdAt": "2020-09-26T09:08:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTQxOTU2MQ=="}], "type": "inlineReview"}, {"oid": "6e4967155c24f238c3fbf318072f05aacf3ae549", "url": "https://github.com/odpi/egeria/commit/6e4967155c24f238c3fbf318072f05aacf3ae549", "message": "Merge branch 'master' of https://github.com/odpi/egeria into git3660", "committedDate": "2020-09-26T08:57:48Z", "type": "commit"}, {"oid": "92fcf049ed0923b6a62cfec557127c6472476724", "url": "https://github.com/odpi/egeria/commit/92fcf049ed0923b6a62cfec557127c6472476724", "message": "#3660 initialise audit log and remove use of collection as per review feedback\n\nSigned-off-by: David Radley <david_radley@uk.ibm.com>", "committedDate": "2020-09-26T09:03:37Z", "type": "commit"}]}