{"pr_number": 3968, "pr_title": "Janus Connector - Adding transaction commits to lineage queries", "pr_createdAt": "2020-10-27T09:50:47Z", "pr_url": "https://github.com/odpi/egeria/pull/3968", "timeline": [{"oid": "87f248613b714cf433d7ada044c8adbfcaf78d5b", "url": "https://github.com/odpi/egeria/commit/87f248613b714cf433d7ada044c8adbfcaf78d5b", "message": "Adding transaction commits to lineage queries\n\nSigned-off-by: Liviu Popa <liviu-constantin.popa@ing.com>", "committedDate": "2020-10-27T09:47:30Z", "type": "commit"}, {"oid": "ea85837efc818d297e9a1b8a6c40a3c0a98e563c", "url": "https://github.com/odpi/egeria/commit/ea85837efc818d297e9a1b8a6c40a3c0a98e563c", "message": "Merge branch 'master' of https://github.com/odpi/egeria", "committedDate": "2020-10-27T10:10:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU1MDcyOA==", "url": "https://github.com/odpi/egeria/pull/3968#discussion_r512550728", "bodyText": "Lets remove e.printStackTrace();", "author": "lpalashevski", "createdAt": "2020-10-27T09:53:11Z", "path": "open-metadata-implementation/adapters/open-connectors/governance-daemon-connectors/open-lineage-connectors/open-lineage-janus-connector/src/main/java/org/odpi/openmetadata/openconnectors/governancedaemonconnectors/openlineageconnectors/janusconnector/graph/LineageGraphConnectorHelper.java", "diffHunk": "@@ -113,17 +119,32 @@ public LineageGraphConnectorHelper(GraphTraversalSource graphTraversalSource) {\n             return Optional.empty();\n         }\n         String edgeLabel = edgeLabelOptional.get();\n-\n-        Graph sourceGraph = (Graph)\n-                g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n-                        until(inE(edgeLabel).count().is(0)).\n-                        repeat((Traversal) inE(edgeLabel).subgraph(\"subGraph\").outV().simplePath()).\n-                        cap(\"subGraph\").next();\n-\n-        List<Vertex> sourcesList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n-                until(inE(edgeLabel).count().is(0)).\n-                repeat(inE(edgeLabel).outV().simplePath()).\n-                dedup().toList();\n+        Graph sourceGraph = null;\n+        List<Vertex> sourcesList = null;\n+\n+        try {\n+            sourceGraph = (Graph)\n+                    g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n+                            until(inE(edgeLabel).count().is(0)).\n+                            repeat((Traversal) inE(edgeLabel).subgraph(\"subGraph\").outV().simplePath()).\n+                            cap(\"subGraph\").next();\n+\n+            sourcesList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n+                    until(inE(edgeLabel).count().is(0)).\n+                    repeat(inE(edgeLabel).outV().simplePath()).\n+                    dedup().toList();\n+\n+            if(supportingTransactions){\n+                g.tx().commit();\n+            }\n+        }catch (Exception e){\n+            if(supportingTransactions) {\n+                g.tx().rollback();\n+            }\n+            log.error(\"Exception while querying ultimate source horizontal lineage of guid \" + guid + \". Executed rollback.\");\n+            log.error(\"Message: \" + e.getMessage());\n+            e.printStackTrace();", "originalCommit": "87f248613b714cf433d7ada044c8adbfcaf78d5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjU1MDk5NQ==", "url": "https://github.com/odpi/egeria/pull/3968#discussion_r512550995", "bodyText": "same here, lets remove e.printStackTrace() from all related methods", "author": "lpalashevski", "createdAt": "2020-10-27T09:53:35Z", "path": "open-metadata-implementation/adapters/open-connectors/governance-daemon-connectors/open-lineage-connectors/open-lineage-janus-connector/src/main/java/org/odpi/openmetadata/openconnectors/governancedaemonconnectors/openlineageconnectors/janusconnector/graph/LineageGraphConnectorHelper.java", "diffHunk": "@@ -142,17 +163,32 @@ public LineageGraphConnectorHelper(GraphTraversalSource graphTraversalSource) {\n             return Optional.empty();\n         }\n         String edgeLabel = edgeLabelOptional.get();\n-\n-        Graph destinationGraph = (Graph)\n-                g.V().has(PROPERTY_KEY_ENTITY_GUID, guid)\n-                        .until(outE(edgeLabel).count().is(0))\n-                        .repeat((Traversal) outE(edgeLabel).subgraph(\"subGraph\").inV().simplePath())\n-                        .cap(\"subGraph\").next();\n-\n-        List<Vertex> destinationsList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n-                until(outE(edgeLabel).count().is(0)).\n-                repeat(outE(edgeLabel).inV().simplePath()).\n-                dedup().toList();\n+        Graph destinationGraph = null;\n+        List<Vertex> destinationsList = null;\n+\n+        try{\n+            destinationGraph = (Graph)\n+                    g.V().has(PROPERTY_KEY_ENTITY_GUID, guid)\n+                            .until(outE(edgeLabel).count().is(0))\n+                            .repeat((Traversal) outE(edgeLabel).subgraph(\"subGraph\").inV().simplePath())\n+                            .cap(\"subGraph\").next();\n+\n+            destinationsList = g.V().has(PROPERTY_KEY_ENTITY_GUID, guid).\n+                    until(outE(edgeLabel).count().is(0)).\n+                    repeat(outE(edgeLabel).inV().simplePath()).\n+                    dedup().toList();\n+\n+            if(supportingTransactions){\n+                g.tx().commit();\n+            }\n+        }catch (Exception e){\n+            if(supportingTransactions) {\n+                g.tx().rollback();\n+            }\n+            log.error(\"Exception while querying ultimate destination horizontal lineage of guid \" + guid + \". Executed rollback.\");\n+            log.error(\"Message: \" + e.getMessage());\n+            e.printStackTrace();", "originalCommit": "87f248613b714cf433d7ada044c8adbfcaf78d5b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a0e6f6c27040ac2c080e02fef90cb3791dee8974", "url": "https://github.com/odpi/egeria/commit/a0e6f6c27040ac2c080e02fef90cb3791dee8974", "message": "Adding transaction commits to lineage queries\n\nSigned-off-by: Liviu Popa <liviu-constantin.popa@ing.com>", "committedDate": "2020-10-27T10:52:49Z", "type": "commit"}]}