{"pr_number": 1584, "pr_title": "JBTM-3261 Merge LRA branch to the master branch", "pr_createdAt": "2020-04-02T11:48:58Z", "pr_url": "https://github.com/jbosstm/narayana/pull/1584", "timeline": [{"oid": "f54f9656b7be11e7752f5127720a871b676351e9", "url": "https://github.com/jbosstm/narayana/commit/f54f9656b7be11e7752f5127720a871b676351e9", "message": "JBTM-3204 Upgrade LRA TCK recovery handling to accommodate specification changes", "committedDate": "2020-04-02T09:48:06Z", "type": "commit"}, {"oid": "affbb9cc0089a95c3233e067cc1f6f812fdd6f73", "url": "https://github.com/jbosstm/narayana/commit/affbb9cc0089a95c3233e067cc1f6f812fdd6f73", "message": "JBTM-3217 Take Compensate and Complete timeout information from the LRA annotation in the same class", "committedDate": "2020-04-02T10:02:25Z", "type": "commit"}, {"oid": "945f17a4c80eea8ed89dd22b87de587fa38727e8", "url": "https://github.com/jbosstm/narayana/commit/945f17a4c80eea8ed89dd22b87de587fa38727e8", "message": "JBTM-3221 Refactor NarayanaLRARecovery according to the specification upgrades", "committedDate": "2020-04-02T10:02:27Z", "type": "commit"}, {"oid": "6550b8fbeb4340df750ccc5eaba29ded9a63287e", "url": "https://github.com/jbosstm/narayana/commit/6550b8fbeb4340df750ccc5eaba29ded9a63287e", "message": "JBTM-3229 Allow to enlist AfterLRA listeners after the LRA enters the ending phase", "committedDate": "2020-04-02T10:13:59Z", "type": "commit"}, {"oid": "869bea81896d6c68eb7f9abcb5cd70bd42f66983", "url": "https://github.com/jbosstm/narayana/commit/869bea81896d6c68eb7f9abcb5cd70bd42f66983", "message": "JBTM-3229 Fix up previous commit", "committedDate": "2020-04-02T10:14:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxNDkwNw==", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402414907", "bodyText": "Implementations of third party interfaces still need a copyright.", "author": "mmusgrov", "createdAt": "2020-04-02T15:42:51Z", "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -1,57 +1,27 @@\n-/*", "originalCommit": "f4d347bf84580bd5eb2fb9ff707337481a18efbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQxNzE2OA==", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402417168", "bodyText": "Superfluous extra line.", "author": "mmusgrov", "createdAt": "2020-04-02T15:46:05Z", "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -81,6 +51,7 @@ private boolean recoverLRAs(String host, int port, URI lraId) {\n             String json = response.readEntity(String.class);\n             response.close();\n \n+", "originalCommit": "f4d347bf84580bd5eb2fb9ff707337481a18efbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNDAxMA==", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402424010", "bodyText": "I know it's not part of the PR but the reason we don't need an implementation is that callbacks are invoked synchronously (to the application logic via a JAX-RS server side filter), ie speed is not the reason. And the reason for doing it synchronously is that JAX-RS does not support asynchronous filters. Will you either update or delete the comment altogether.\nBut Resteasy does support them (https://docs.jboss.org/resteasy/docs/3.9.1.Final/userguide/html/Interceptors.html#d4e1983). I will dig out an earlier implementation that did do this to see if it can still be made to work.", "author": "mmusgrov", "createdAt": "2020-04-02T15:55:18Z", "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -1,57 +1,27 @@\n-/*\n- * JBoss, Home of Professional Open Source.\n- * Copyright 2020, Red Hat, Inc., and individual contributors\n- * as indicated by the @author tags. See the copyright.txt file in the\n- * distribution for a full listing of individual contributors.\n- *\n- * This is free software; you can redistribute it and/or modify it\n- * under the terms of the GNU Lesser General Public License as\n- * published by the Free Software Foundation; either version 2.1 of\n- * the License, or (at your option) any later version.\n- *\n- * This software is distributed in the hope that it will be useful,\n- * but WITHOUT ANY WARRANTY; without even the implied warranty of\n- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n- * Lesser General Public License for more details.\n- *\n- * You should have received a copy of the GNU Lesser General Public\n- * License along with this software; if not, write to the Free\n- * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n- */\n-\n package io.narayana.lra.arquillian.spi;\n \n import io.narayana.lra.LRAConstants;\n-import io.narayana.lra.logging.LRALogger;\n+import org.eclipse.microprofile.lra.tck.service.spi.LRARecoveryService;\n \n import javax.ws.rs.client.Client;\n import javax.ws.rs.client.ClientBuilder;\n import javax.ws.rs.client.WebTarget;\n import javax.ws.rs.core.Response;\n import java.net.URI;\n \n-public class NarayanaLRARecovery {\n+public class NarayanaLRARecovery implements LRARecoveryService {\n \n+    @Override\n     public void waitForCallbacks(URI lraId) {\n         // no action is needed, tck callbacks calls are sufficiently fast for TCK", "originalCommit": "f4d347bf84580bd5eb2fb9ff707337481a18efbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQyNDIwNg==", "url": "https://github.com/jbosstm/narayana/pull/1584#discussion_r402424206", "bodyText": "typo", "author": "mmusgrov", "createdAt": "2020-04-02T15:55:35Z", "path": "rts/lra/lra-test/lra-test-arquillian-extension/src/main/java/io/narayana/lra/arquillian/spi/NarayanaLRARecovery.java", "diffHunk": "@@ -1,57 +1,27 @@\n-/*\n- * JBoss, Home of Professional Open Source.\n- * Copyright 2020, Red Hat, Inc., and individual contributors\n- * as indicated by the @author tags. See the copyright.txt file in the\n- * distribution for a full listing of individual contributors.\n- *\n- * This is free software; you can redistribute it and/or modify it\n- * under the terms of the GNU Lesser General Public License as\n- * published by the Free Software Foundation; either version 2.1 of\n- * the License, or (at your option) any later version.\n- *\n- * This software is distributed in the hope that it will be useful,\n- * but WITHOUT ANY WARRANTY; without even the implied warranty of\n- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU\n- * Lesser General Public License for more details.\n- *\n- * You should have received a copy of the GNU Lesser General Public\n- * License along with this software; if not, write to the Free\n- * Software Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA\n- * 02110-1301 USA, or see the FSF site: http://www.fsf.org.\n- */\n-\n package io.narayana.lra.arquillian.spi;\n \n import io.narayana.lra.LRAConstants;\n-import io.narayana.lra.logging.LRALogger;\n+import org.eclipse.microprofile.lra.tck.service.spi.LRARecoveryService;\n \n import javax.ws.rs.client.Client;\n import javax.ws.rs.client.ClientBuilder;\n import javax.ws.rs.client.WebTarget;\n import javax.ws.rs.core.Response;\n import java.net.URI;\n \n-public class NarayanaLRARecovery {\n+public class NarayanaLRARecovery implements LRARecoveryService {\n \n+    @Override\n     public void waitForCallbacks(URI lraId) {\n         // no action is needed, tck callbacks calls are sufficiently fast for TCK\n     }\n \n-    // TODO remove once this class implements LRARecoveryService\n-    public void waitForRecovery(URI lraId) {\n-        int counter = 0;\n-\n-        do {\n-            LRALogger.logger.info(\"Recovery attempt #\" + ++counter);\n-        } while (!waitForEndPhaseReplay(lraId));\n-        LRALogger.logger.info(\"LRA \" + lraId + \" has finished the recovery \" + counter);\n-    }\n-\n+    @Override\n     public boolean waitForEndPhaseReplay(URI lraId) {\n         String host = lraId.getHost();\n         int port = lraId.getPort();\n         if (!recoverLRAs(host, port, lraId)) {\n-            // first recovery scan probably collided with periodic recovery which started\n+            // first recovery scan probably collided with periodic recovevery which started", "originalCommit": "f4d347bf84580bd5eb2fb9ff707337481a18efbc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a2b008be4577d9340c024d04a2e90819424ffd5c", "url": "https://github.com/jbosstm/narayana/commit/a2b008be4577d9340c024d04a2e90819424ffd5c", "message": "JBTM-3261 Merge LRA branch to the master branch", "committedDate": "2020-04-02T17:22:51Z", "type": "forcePushed"}, {"oid": "852a561025d48f562c8715bf9b2d37c1dbe5b193", "url": "https://github.com/jbosstm/narayana/commit/852a561025d48f562c8715bf9b2d37c1dbe5b193", "message": "JBTM-3261 Merge LRA branch to the master branch", "committedDate": "2020-04-03T12:46:04Z", "type": "forcePushed"}, {"oid": "8717da178db8edc8f795ebf14ea02eff36842130", "url": "https://github.com/jbosstm/narayana/commit/8717da178db8edc8f795ebf14ea02eff36842130", "message": "JBTM-3261 Merge LRA branch to the master branch", "committedDate": "2020-04-03T13:15:17Z", "type": "forcePushed"}, {"oid": "0d31194430ddd30ccb11b61aba780e8836d7ac9f", "url": "https://github.com/jbosstm/narayana/commit/0d31194430ddd30ccb11b61aba780e8836d7ac9f", "message": "JBTM-3261 Merge LRA branch to the master branch", "committedDate": "2020-04-04T06:01:57Z", "type": "commit"}, {"oid": "0d31194430ddd30ccb11b61aba780e8836d7ac9f", "url": "https://github.com/jbosstm/narayana/commit/0d31194430ddd30ccb11b61aba780e8836d7ac9f", "message": "JBTM-3261 Merge LRA branch to the master branch", "committedDate": "2020-04-04T06:01:57Z", "type": "forcePushed"}]}