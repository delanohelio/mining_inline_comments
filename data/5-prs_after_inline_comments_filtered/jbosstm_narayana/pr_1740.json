{"pr_number": 1740, "pr_title": "JBTM-3402 Stop creating unnamed thread pools", "pr_createdAt": "2020-12-08T15:28:35Z", "pr_url": "https://github.com/jbosstm/narayana/pull/1740", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0NDc1MQ==", "url": "https://github.com/jbosstm/narayana/pull/1740#discussion_r539144751", "bodyText": "@mmusgrov - if we go ahead with this kind of change then I think maybe the threads would be prefixed with something like \"Narayana\" instead", "author": "tomjenkinson", "createdAt": "2020-12-09T09:27:46Z", "path": "ArjunaJTA/jta/classes/com/arjuna/ats/internal/jta/transaction/arjunacore/BaseTransaction.java", "diffHunk": "@@ -308,6 +310,21 @@ public Void call() throws InvalidTransactionException,\n \n \tprivate static final int _asyncCommitPoolSize = jtaPropertyManager.getJTAEnvironmentBean().getAsyncCommitPoolSize();\n \n-\tprivate static final ThreadPoolExecutor tpe = new ThreadPoolExecutor(1, _asyncCommitPoolSize, 10, TimeUnit.SECONDS, new ArrayBlockingQueue<Runnable>(3));\n+\tstatic class NamedThreadFactory implements ThreadFactory {\n+\t\tprivate final String name;\n+\t\tprivate final AtomicInteger counter = new AtomicInteger();\n+\n+\t\tNamedThreadFactory(String name) {\n+\t\t\tthis.name = name;\n+\t\t}\n+\n+\t\tpublic Thread newThread(Runnable r) {\n+\t\t\treturn new Thread(r, name + \"-Thread_\" + counter.incrementAndGet());\n+\t\t}\n+\t}\n+\n+\tprivate static final ThreadFactory transactionThreadFactory = new NamedThreadFactory(\"Arjuna-Transaction\");", "originalCommit": "3d32a763c0062b103b939fac843ce08ce0b907d2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM2NDgwOA==", "url": "https://github.com/jbosstm/narayana/pull/1740#discussion_r539364808", "bodyText": "@tomjenkinson so you think the code needs to be:\nnew NamedThreadFactory(\"Narayana\");", "author": "mmusgrov", "createdAt": "2020-12-09T14:44:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0NDc1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTM4MTUxNQ==", "url": "https://github.com/jbosstm/narayana/pull/1740#discussion_r539381515", "bodyText": "I think if we want this general type of behaviour from this PR then specifically in this are then it could be more appropriate to use \"Narayana\" than \"Arjuna\" in the wording. I then guess \"Narayana\" rather than \"Narayana-Transaction\" - if the \"-Transaction\" suffix can help that could be considered.", "author": "tomjenkinson", "createdAt": "2020-12-09T15:03:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0NDc1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjM5MDUzNw==", "url": "https://github.com/jbosstm/narayana/pull/1740#discussion_r542390537", "bodyText": "@krosenvold can you please use as the prefix just word Narayana?", "author": "ochaloup", "createdAt": "2020-12-14T13:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTE0NDc1MQ=="}], "type": "inlineReview"}, {"oid": "f20bd2b53eedb89a44f7568f5b0700e9bc331eb5", "url": "https://github.com/jbosstm/narayana/commit/f20bd2b53eedb89a44f7568f5b0700e9bc331eb5", "message": "JBTM-3402 Stop creating unnamed thread pools\n\nAdded thread name to transaction manager thread pool.", "committedDate": "2021-01-26T06:15:17Z", "type": "commit"}, {"oid": "f20bd2b53eedb89a44f7568f5b0700e9bc331eb5", "url": "https://github.com/jbosstm/narayana/commit/f20bd2b53eedb89a44f7568f5b0700e9bc331eb5", "message": "JBTM-3402 Stop creating unnamed thread pools\n\nAdded thread name to transaction manager thread pool.", "committedDate": "2021-01-26T06:15:17Z", "type": "forcePushed"}]}