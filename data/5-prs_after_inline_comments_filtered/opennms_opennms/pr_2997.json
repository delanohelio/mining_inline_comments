{"pr_number": 2997, "pr_title": "NMS-12688: Use custom thread pool to run the Startup of consumers", "pr_createdAt": "2020-05-05T03:35:04Z", "pr_url": "https://github.com/OpenNMS/opennms/pull/2997", "timeline": [{"oid": "98ebfee193799b6ef7e1d6110a69999bcdea9de9", "url": "https://github.com/OpenNMS/opennms/commit/98ebfee193799b6ef7e1d6110a69999bcdea9de9", "message": "NMS-12688: Use custom thread pool to run the start of consumers\n\nWithout using the custom thread pool, the thread that is going to run\nrunAsync seems to be coming from thread pool that is using different\nclassloader (may be custom classloader from osgi) than default class loader.", "committedDate": "2020-05-05T03:27:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA1MzUwNA==", "url": "https://github.com/OpenNMS/opennms/pull/2997#discussion_r420053504", "bodyText": "Let's make sure this thread pool gets shutdown.", "author": "j-white", "createdAt": "2020-05-05T11:57:50Z", "path": "core/ipc/sink/common/src/main/java/org/opennms/core/ipc/sink/common/AbstractMessageConsumerManager.java", "diffHunk": "@@ -44,13 +47,20 @@\n import com.google.common.collect.LinkedListMultimap;\n import com.google.common.collect.Lists;\n import com.google.common.collect.Multimap;\n+import com.google.common.util.concurrent.ThreadFactoryBuilder;\n \n public abstract class AbstractMessageConsumerManager implements MessageConsumerManager {\n \n     private static final Logger LOG = LoggerFactory.getLogger(AbstractMessageConsumerManager.class);\n \n     public static final String SINK_INITIAL_SLEEP_TIME = \"org.opennms.core.ipc.sink.initialSleepTime\";\n \n+    private final ThreadFactory threadFactory = new ThreadFactoryBuilder()\n+            .setNameFormat(\"consumer-starter-%d\")\n+            .build();\n+\n+    protected final ExecutorService startupExecutor = Executors.newCachedThreadPool(threadFactory);", "originalCommit": "98ebfee193799b6ef7e1d6110a69999bcdea9de9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA3MTM4OQ==", "url": "https://github.com/OpenNMS/opennms/pull/2997#discussion_r420071389", "bodyText": "We can merge without this, but let's make sure to circle back.", "author": "j-white", "createdAt": "2020-05-05T12:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDA1MzUwNA=="}], "type": "inlineReview"}]}