{"pr_number": 1148, "pr_title": "[plugin-browserstack] Save network log into context", "pr_createdAt": "2020-11-16T15:12:03Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1148", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0MTYxNQ==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r524341615", "bodyText": "add info how to use saved logs", "author": "valfirst", "createdAt": "2020-11-16T15:14:07Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -62,11 +70,30 @@ public DebugSteps(BrowserStackAutomateClient appAutomateClient, IBddVariableCont\n      */\n     @When(\"I save BrowserStack network logs to $scopes variable `$variableName`\")\n     public void saveNetworkLogs(Set<VariableScope> scopes, String variableName) throws BrowserStackException\n+    {\n+        getNetworkLogs(logs -> bddVariableContext.putVariable(scopes, variableName, logs));\n+    }\n+\n+    /**\n+     * Saves network logs from an application session into JSON context. The application session must be closed before", "originalCommit": "788f3ee29133704c4887d5c5f39f73814f35ecef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDM0MjMwNQ==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r524342305", "bodyText": "BrowserStack network logs.json ?", "author": "valfirst", "createdAt": "2020-11-16T15:15:02Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -62,11 +70,30 @@ public DebugSteps(BrowserStackAutomateClient appAutomateClient, IBddVariableCont\n      */\n     @When(\"I save BrowserStack network logs to $scopes variable `$variableName`\")\n     public void saveNetworkLogs(Set<VariableScope> scopes, String variableName) throws BrowserStackException\n+    {\n+        getNetworkLogs(logs -> bddVariableContext.putVariable(scopes, variableName, logs));\n+    }\n+\n+    /**\n+     * Saves network logs from an application session into JSON context. The application session must be closed before\n+     * network logs can be saved.\n+     * @throws BrowserStackException if error occurred while interacting with BrowserStack\n+     */\n+    @When(\"I save BrowserStack network logs to JSON context\")\n+    public void saveNetworkLogsToJsonContext() throws BrowserStackException\n+    {\n+        getNetworkLogs(logs ->\n+        {\n+            jsonContext.putJsonContext(logs);\n+            attachmentPublisher.publishAttachment(logs.getBytes(StandardCharsets.UTF_8), \"network-logs.json\");", "originalCommit": "788f3ee29133704c4887d5c5f39f73814f35ecef", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "187fa2774225421bb2833bb61773999b93208733", "url": "https://github.com/vividus-framework/vividus/commit/187fa2774225421bb2833bb61773999b93208733", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-11T12:45:07Z", "type": "forcePushed"}, {"oid": "172ba8c9b91d3a77e9ee219351b1c391e28017f1", "url": "https://github.com/vividus-framework/vividus/commit/172ba8c9b91d3a77e9ee219351b1c391e28017f1", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-11T12:48:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk1MjMwOQ==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r540952309", "bodyText": "is it har?", "author": "valfirst", "createdAt": "2020-12-11T13:38:17Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -62,11 +70,39 @@ public DebugSteps(BrowserStackAutomateClient appAutomateClient, IBddVariableCont\n      */\n     @When(\"I save BrowserStack network logs to $scopes variable `$variableName`\")\n     public void saveNetworkLogs(Set<VariableScope> scopes, String variableName) throws BrowserStackException\n+    {\n+        getNetworkLogs(logs -> bddVariableContext.putVariable(scopes, variableName, logs));\n+    }\n+\n+    /**\n+     * Saves network logs from an application session into JSON context. The application session must be closed before\n+     * network logs can be saved.\n+     * <br/>\n+     * The following steps can be used to work with data in JSON context:\n+     * <ul>\n+     * <li>Then JSON element by JSON path `$jsonPath` is equal to `$expectedData`$options</li>\n+     * <li>Then number of JSON elements by JSON path `$jsonPath` is $comparisonRule $elementsNumber</li>\n+     * <li>When I save JSON element from context by JSON path `$jsonPath` to $scopes variable `$variableName`</li>\n+     * <li>When I set number of elements found by JSON path `$jsonPath` to $scopes variable `$variableName`</li>\n+     * </ul>\n+     * @throws BrowserStackException if error occurred while interacting with BrowserStack\n+     */\n+    @When(\"I save BrowserStack network logs to JSON context\")\n+    public void saveNetworkLogsToJsonContext() throws BrowserStackException\n+    {\n+        getNetworkLogs(logs ->\n+        {\n+            jsonContext.putJsonContext(logs);\n+            attachmentPublisher.publishAttachment(logs.getBytes(StandardCharsets.UTF_8),\n+                    \"BrowserStack network logs.json\");", "originalCommit": "172ba8c9b91d3a77e9ee219351b1c391e28017f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk4ODg3OA==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r540988878", "bodyText": "in browser stack it's just txt, by its structure it corresponds to HAR format, should I rename it to ....har?", "author": "uarlouski", "createdAt": "2020-12-11T14:31:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk1MjMwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk1MjY1Nw==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r540952657", "bodyText": "just return the value instead of using consumer", "author": "valfirst", "createdAt": "2020-12-11T13:38:48Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -62,11 +70,39 @@ public DebugSteps(BrowserStackAutomateClient appAutomateClient, IBddVariableCont\n      */\n     @When(\"I save BrowserStack network logs to $scopes variable `$variableName`\")\n     public void saveNetworkLogs(Set<VariableScope> scopes, String variableName) throws BrowserStackException\n+    {\n+        getNetworkLogs(logs -> bddVariableContext.putVariable(scopes, variableName, logs));\n+    }\n+\n+    /**\n+     * Saves network logs from an application session into JSON context. The application session must be closed before\n+     * network logs can be saved.\n+     * <br/>\n+     * The following steps can be used to work with data in JSON context:\n+     * <ul>\n+     * <li>Then JSON element by JSON path `$jsonPath` is equal to `$expectedData`$options</li>\n+     * <li>Then number of JSON elements by JSON path `$jsonPath` is $comparisonRule $elementsNumber</li>\n+     * <li>When I save JSON element from context by JSON path `$jsonPath` to $scopes variable `$variableName`</li>\n+     * <li>When I set number of elements found by JSON path `$jsonPath` to $scopes variable `$variableName`</li>\n+     * </ul>\n+     * @throws BrowserStackException if error occurred while interacting with BrowserStack\n+     */\n+    @When(\"I save BrowserStack network logs to JSON context\")\n+    public void saveNetworkLogsToJsonContext() throws BrowserStackException\n+    {\n+        getNetworkLogs(logs ->\n+        {\n+            jsonContext.putJsonContext(logs);\n+            attachmentPublisher.publishAttachment(logs.getBytes(StandardCharsets.UTF_8),\n+                    \"BrowserStack network logs.json\");\n+        });\n+    }\n+\n+    private void getNetworkLogs(Consumer<String> networkLogsConsumer) throws BrowserStackException\n     {\n         String sessionId = testContext.get(PREVIOUS_SESSION_ID);\n         isTrue(sessionId != null, \"Unable to find a previous session\");\n-        String networkLogs = appAutomateClient.getNetworkLogs(sessionId);\n-        bddVariableContext.putVariable(scopes, variableName, networkLogs);\n+        networkLogsConsumer.accept(appAutomateClient.getNetworkLogs(sessionId));", "originalCommit": "172ba8c9b91d3a77e9ee219351b1c391e28017f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAwMTU3Mw==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r541001573", "bodyText": "okay, but with the consumer code looks much bette, we do not need declare additional variable + benefits coming from usage of inokedynamic", "author": "uarlouski", "createdAt": "2020-12-11T14:51:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDk1MjY1Nw=="}], "type": "inlineReview"}, {"oid": "f21705d1ee1d0e2c753827c1e1b3d374e11ad078", "url": "https://github.com/vividus-framework/vividus/commit/f21705d1ee1d0e2c753827c1e1b3d374e11ad078", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-11T14:53:59Z", "type": "forcePushed"}, {"oid": "4963256c5fdc2606f4955a7be3481d54d8c8a645", "url": "https://github.com/vividus-framework/vividus/commit/4963256c5fdc2606f4955a7be3481d54d8c8a645", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-14T09:14:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjMyNjIzOA==", "url": "https://github.com/vividus-framework/vividus/pull/1148#discussion_r542326238", "bodyText": "I propose to remove this list of steps, just describe them in general words", "author": "valfirst", "createdAt": "2020-12-14T11:52:15Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -62,11 +69,36 @@ public DebugSteps(BrowserStackAutomateClient appAutomateClient, IBddVariableCont\n      */\n     @When(\"I save BrowserStack network logs to $scopes variable `$variableName`\")\n     public void saveNetworkLogs(Set<VariableScope> scopes, String variableName) throws BrowserStackException\n+    {\n+        bddVariableContext.putVariable(scopes, variableName, getNetworkLogs());\n+    }\n+\n+    /**\n+     * Saves network logs from an application session into JSON context. The application session must be closed before\n+     * network logs can be saved.\n+     * <br>\n+     * The following steps can be used to work with data in JSON context:\n+     * <ul>\n+     * <li>Then JSON element by JSON path `$jsonPath` is equal to `$expectedData`$options</li>\n+     * <li>Then number of JSON elements by JSON path `$jsonPath` is $comparisonRule $elementsNumber</li>\n+     * <li>When I save JSON element from context by JSON path `$jsonPath` to $scopes variable `$variableName`</li>\n+     * <li>When I set number of elements found by JSON path `$jsonPath` to $scopes variable `$variableName`</li>\n+     * </ul>", "originalCommit": "4963256c5fdc2606f4955a7be3481d54d8c8a645", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c3e4f1bd8b4bcf21d3a33443f94b8498af65e556", "url": "https://github.com/vividus-framework/vividus/commit/c3e4f1bd8b4bcf21d3a33443f94b8498af65e556", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-14T12:21:46Z", "type": "forcePushed"}, {"oid": "21319a99ff3a7616f40ff020027fcce18bad01a9", "url": "https://github.com/vividus-framework/vividus/commit/21319a99ff3a7616f40ff020027fcce18bad01a9", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-15T12:34:30Z", "type": "commit"}, {"oid": "21319a99ff3a7616f40ff020027fcce18bad01a9", "url": "https://github.com/vividus-framework/vividus/commit/21319a99ff3a7616f40ff020027fcce18bad01a9", "message": "[plugin-browserstack] Save network log into context", "committedDate": "2020-12-15T12:34:30Z", "type": "forcePushed"}]}