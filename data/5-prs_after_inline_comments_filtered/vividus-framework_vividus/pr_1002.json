{"pr_number": 1002, "pr_title": "[vividus] Add while-like step", "pr_createdAt": "2020-10-08T15:17:52Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1002", "timeline": [{"oid": "871959bfe0bfb92d0085285450c0038b92f4d87c", "url": "https://github.com/vividus-framework/vividus/commit/871959bfe0bfb92d0085285450c0038b92f4d87c", "message": "[vividus] Add while-like step", "committedDate": "2020-10-08T15:19:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMjg4MQ==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501812881", "bodyText": "doesVariableValueMatch", "author": "valfirst", "createdAt": "2020-10-08T15:28:53Z", "path": "vividus/src/main/java/org/vividus/bdd/steps/ExecutableSteps.java", "diffHunk": "@@ -81,6 +81,54 @@ public void ifVariableNotSetPerformSteps(String name, SubSteps stepsToExecute)\n         }\n     }\n \n+    /**\n+     * Executes the steps while variable doesn't have a value fitting defined rules or limit is reached.\n+     * <br>\n+     * <b>Example:</b>\n+     * <br>\n+     * <code>\n+     * When I execute steps at most 5 times while `var` is &lt; `3`:\n+     * <br>\n+     * |step                                                                        |\n+     * <br>\n+     * |When I click on element located `id(counter)`                               |\n+     * <br>\n+     * |When I set the text found in search context to the 'scenario' variable 'var'|\n+     * <br>\n+     * </code>\n+     * @param max Maximum iteration number\n+     * @param name Variable name to check\n+     * @param comparisonRule The rule to compare values\n+     * (&lt;i&gt;Possible values:&lt;b&gt; LESS_THAN, LESS_THAN_OR_EQUAL_TO, GREATER_THAN, GREATER_THAN_OR_EQUAL_TO,\n+     * EQUAL_TO&lt;/b&gt;&lt;/i&gt;)\n+     * @param expectedValue The expected value of the variable\n+     * @param stepsToExecute The examples table with the steps to execute\n+     */\n+    @When(\"I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExeute\")\n+    @Alias(\n+        \"I execute steps at most $max times while '$variableName' is $comparisonRule '$expectedValue':$stepsToExeute\")\n+    public void executeStepsWhile(int max, String name, ComparisonRule comparisonRule, String expectedValue,\n+            SubSteps stepsToExecute)\n+    {\n+        Matcher<String> valueVerifier = comparisonRule.getComparisonRule(expectedValue);\n+        int iterationsLeft = max;\n+        while (iterationsLeft > 0 && variableValueFits(name, valueVerifier))\n+        {\n+            --iterationsLeft;\n+            stepsToExecute.execute(Optional.empty());\n+        }\n+    }\n+\n+    private boolean variableValueFits(String name, Matcher<String> verifier)", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTgxMzI4Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1002#discussion_r501813286", "bodyText": "return variable == null || verifier.matches(variable);", "author": "valfirst", "createdAt": "2020-10-08T15:29:26Z", "path": "vividus/src/main/java/org/vividus/bdd/steps/ExecutableSteps.java", "diffHunk": "@@ -81,6 +81,54 @@ public void ifVariableNotSetPerformSteps(String name, SubSteps stepsToExecute)\n         }\n     }\n \n+    /**\n+     * Executes the steps while variable doesn't have a value fitting defined rules or limit is reached.\n+     * <br>\n+     * <b>Example:</b>\n+     * <br>\n+     * <code>\n+     * When I execute steps at most 5 times while `var` is &lt; `3`:\n+     * <br>\n+     * |step                                                                        |\n+     * <br>\n+     * |When I click on element located `id(counter)`                               |\n+     * <br>\n+     * |When I set the text found in search context to the 'scenario' variable 'var'|\n+     * <br>\n+     * </code>\n+     * @param max Maximum iteration number\n+     * @param name Variable name to check\n+     * @param comparisonRule The rule to compare values\n+     * (&lt;i&gt;Possible values:&lt;b&gt; LESS_THAN, LESS_THAN_OR_EQUAL_TO, GREATER_THAN, GREATER_THAN_OR_EQUAL_TO,\n+     * EQUAL_TO&lt;/b&gt;&lt;/i&gt;)\n+     * @param expectedValue The expected value of the variable\n+     * @param stepsToExecute The examples table with the steps to execute\n+     */\n+    @When(\"I execute steps at most $max times while `$variableName` is $comparisonRule `$expectedValue`:$stepsToExeute\")\n+    @Alias(\n+        \"I execute steps at most $max times while '$variableName' is $comparisonRule '$expectedValue':$stepsToExeute\")\n+    public void executeStepsWhile(int max, String name, ComparisonRule comparisonRule, String expectedValue,\n+            SubSteps stepsToExecute)\n+    {\n+        Matcher<String> valueVerifier = comparisonRule.getComparisonRule(expectedValue);\n+        int iterationsLeft = max;\n+        while (iterationsLeft > 0 && variableValueFits(name, valueVerifier))\n+        {\n+            --iterationsLeft;\n+            stepsToExecute.execute(Optional.empty());\n+        }\n+    }\n+\n+    private boolean variableValueFits(String name, Matcher<String> verifier)\n+    {\n+        String variable = bddVariableContext.getVariable(name);\n+        if (variable == null)\n+        {\n+            return true;\n+        }\n+        return verifier.matches(variable);", "originalCommit": "871959bfe0bfb92d0085285450c0038b92f4d87c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "96e2112f7fa4d537a02d494725cc3a21ecc20e3c", "url": "https://github.com/vividus-framework/vividus/commit/96e2112f7fa4d537a02d494725cc3a21ecc20e3c", "message": "[vividus] Add while-like step", "committedDate": "2020-10-09T07:06:19Z", "type": "forcePushed"}, {"oid": "26248ece2276f0c9ac9506a5afeef65398121f97", "url": "https://github.com/vividus-framework/vividus/commit/26248ece2276f0c9ac9506a5afeef65398121f97", "message": "[vividus] Add while-like step", "committedDate": "2020-10-09T08:16:14Z", "type": "commit"}, {"oid": "26248ece2276f0c9ac9506a5afeef65398121f97", "url": "https://github.com/vividus-framework/vividus/commit/26248ece2276f0c9ac9506a5afeef65398121f97", "message": "[vividus] Add while-like step", "committedDate": "2020-10-09T08:16:14Z", "type": "forcePushed"}]}