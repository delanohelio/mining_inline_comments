{"pr_number": 1030, "pr_title": "[extension-selenium] Add set variable steps", "pr_createdAt": "2020-10-15T13:05:39Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1030", "timeline": [{"oid": "c6e60faeabf3fa784b1e40632ddcc9df02c1863e", "url": "https://github.com/vividus-framework/vividus/commit/c6e60faeabf3fa784b1e40632ddcc9df02c1863e", "message": "[extension-selenium] Template for message", "committedDate": "2020-10-15T13:31:55Z", "type": "forcePushed"}, {"oid": "bc11d85b88a9a4162549b0a4c8efbe75a436f216", "url": "https://github.com/vividus-framework/vividus/commit/bc11d85b88a9a4162549b0a4c8efbe75a436f216", "message": "[extension-selenium] Add set variable steps\n\n- When I set text found in search context to $scopes variable `$variableName`\n- When I set `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I set `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T13:54:06Z", "type": "forcePushed"}, {"oid": "0d82c288eab21eebf32e395b9713b10743453926", "url": "https://github.com/vividus-framework/vividus/commit/0d82c288eab21eebf32e395b9713b10743453926", "message": "[extension-selenium] Add set variable steps\n\n- When I set text found in search context to $scopes variable `$variableName`\n- When I set `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I set `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T13:58:56Z", "type": "forcePushed"}, {"oid": "37e15ffce4e39d9f53e33fff96e48cd1af69fb4c", "url": "https://github.com/vividus-framework/vividus/commit/37e15ffce4e39d9f53e33fff96e48cd1af69fb4c", "message": "[extension-selenium] Add set variable steps\n\n- When I set text found in search context to $scopes variable `$variableName`\n- When I set `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I set `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T14:16:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwODMwNQ==", "url": "https://github.com/vividus-framework/vividus/pull/1030#discussion_r505608305", "bodyText": "we should init variable with either value or null (to avoid cases when previously created variable contains old value)\nI see that it's not a part of this PR, but it should be fixed", "author": "valfirst", "createdAt": "2020-10-15T14:53:15Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericSetVariableSteps.java", "diffHunk": "@@ -0,0 +1,148 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.ui;\n+\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.jbehave.core.annotations.When;\n+import org.openqa.selenium.WebElement;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.monitor.TakeScreenshotOnFailure;\n+import org.vividus.bdd.steps.ui.validation.IBaseValidations;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.softassert.ISoftAssert;\n+import org.vividus.ui.action.IElementActions;\n+import org.vividus.ui.action.search.Locator;\n+import org.vividus.ui.action.search.Visibility;\n+import org.vividus.ui.context.IUiContext;\n+\n+@TakeScreenshotOnFailure\n+public class GenericSetVariableSteps\n+{\n+    private final ISoftAssert softAssert;\n+    private final IBaseValidations baseValidations;\n+    private final IBddVariableContext bddVariableContext;\n+    private final IElementActions elementActions;\n+    private final IUiContext uiContext;\n+\n+    public GenericSetVariableSteps(ISoftAssert softAssert, IBaseValidations baseValidations,\n+            IBddVariableContext bddVariableContext, IElementActions elementActions, IUiContext uiContext)\n+    {\n+        this.softAssert = softAssert;\n+        this.baseValidations = baseValidations;\n+        this.bddVariableContext = bddVariableContext;\n+        this.elementActions = elementActions;\n+        this.uiContext = uiContext;\n+    }\n+\n+    /**\n+     * Extracts the <b>text</b> of element found in the context and saves it to the <b>variable</b> with the specified\n+     * <b>variableName</b>\n+     * Actions performed at this step:\n+     * <ul>\n+     * <li>Saves the text of element into the <i>variable name</i>\n+     * </ul>\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario\n+     * <li><b>STORY</b> - the variable will be available within the whole story\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A name under which the value should be saved\n+     */\n+    @When(\"I set text found in search context to $scopes variable `$variableName`\")\n+    public void saveContextElementTextToVariable(Set<VariableScope> scopes, String variableName)\n+    {\n+        saveVariableIfContextElementPresent(elementActions::getElementText, scopes, variableName);\n+    }\n+\n+    /**\n+     * Extracts the value of <b>attribute</b> of element found in the context and saves it to the <b>variable</b> with\n+     * the specified <b>variableName</b>\n+     * Actions performed at this step:\n+     * <ul>\n+     * <li>Saves the value of attribute with name <i>attributeName</i> to the <i>variableName</i>\n+     * </ul>\n+     * @param attributeName the name of the attribute (for ex. 'name', 'id')\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario\n+     * <li><b>STORY</b> - the variable will be available within the whole story\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A name under which the value should be saved\n+     */\n+    @When(\"I set `$attributeName` attribute value of context element to $scopes variable `$variableName`\")\n+    public void saveContextElementAttributeValueToVariable(String attributeName, Set<VariableScope> scopes,\n+            String variableName)\n+    {\n+        saveVariableIfContextElementPresent(contextElement -> getAssertedAttributeValue(contextElement, attributeName),\n+                scopes, variableName);\n+    }\n+\n+    /**\n+     * Extracts the value of <b>attribute</b> of element found by <b>locator</b> and saves it to the <b>variable</b>\n+     * with the specified <b>variableName</b>\n+     * Actions performed at this step:\n+     * <ul>\n+     * <li>Saves the value of attribute with name <i>attributeName</i> to the <i>variableName</i>\n+     * </ul>\n+     * @param attributeName the name of the attribute (for ex. 'name', 'id')\n+     * @param locator locator to find an element\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario\n+     * <li><b>STORY</b> - the variable will be available within the whole story\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A name under which the value should be saved\n+     */\n+    @When(\"I set `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`\")\n+    public void saveAttributeValueOfElementByLocatorToVariable(String attributeName, Locator locator,\n+            Set<VariableScope> scopes, String variableName)\n+    {\n+        locator.getSearchParameters().setVisibility(Visibility.ALL);\n+        baseValidations.assertElementExists(\"The element to extract the attribute\", locator)\n+                .map(element -> getAssertedAttributeValue(element, attributeName))\n+                .ifPresent(attributeValue -> bddVariableContext.putVariable(scopes, variableName, attributeValue));", "originalCommit": "37e15ffce4e39d9f53e33fff96e48cd1af69fb4c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTYwODY3OQ==", "url": "https://github.com/vividus-framework/vividus/pull/1030#discussion_r505608679", "bodyText": "ElementActions", "author": "valfirst", "createdAt": "2020-10-15T14:53:41Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/ui/action/IElementActions.java", "diffHunk": "@@ -0,0 +1,30 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.ui.action;\n+\n+import org.openqa.selenium.WebElement;\n+\n+public interface IElementActions", "originalCommit": "37e15ffce4e39d9f53e33fff96e48cd1af69fb4c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68e2d9506ae33efb0864e92ea5ba43d3d72e5c3b", "url": "https://github.com/vividus-framework/vividus/commit/68e2d9506ae33efb0864e92ea5ba43d3d72e5c3b", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T19:25:01Z", "type": "forcePushed"}, {"oid": "c4b655deacf53681925d9903f7439bd658572361", "url": "https://github.com/vividus-framework/vividus/commit/c4b655deacf53681925d9903f7439bd658572361", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T20:12:06Z", "type": "forcePushed"}, {"oid": "2a7f426b2c66eb0d7b53b1cc4d2ec0ac6c0d7885", "url": "https://github.com/vividus-framework/vividus/commit/2a7f426b2c66eb0d7b53b1cc4d2ec0ac6c0d7885", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T20:19:02Z", "type": "forcePushed"}, {"oid": "c9ce1869056d0ef06c24b41830faf44ec9db79a0", "url": "https://github.com/vividus-framework/vividus/commit/c9ce1869056d0ef06c24b41830faf44ec9db79a0", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T20:21:38Z", "type": "forcePushed"}, {"oid": "e7e3d5de5a5c32eb5b105b27f4d5f408b54df692", "url": "https://github.com/vividus-framework/vividus/commit/e7e3d5de5a5c32eb5b105b27f4d5f408b54df692", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T20:48:28Z", "type": "forcePushed"}, {"oid": "8eeeb795f511f8a84d10ca66de6ad901b0092b9a", "url": "https://github.com/vividus-framework/vividus/commit/8eeeb795f511f8a84d10ca66de6ad901b0092b9a", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-15T21:11:11Z", "type": "forcePushed"}, {"oid": "35e32c04517b7c5c19ca00f03996e73ceea4d923", "url": "https://github.com/vividus-framework/vividus/commit/35e32c04517b7c5c19ca00f03996e73ceea4d923", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-16T06:01:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjA3NzcxNw==", "url": "https://github.com/vividus-framework/vividus/pull/1030#discussion_r506077717", "bodyText": "not expected change", "author": "valfirst", "createdAt": "2020-10-16T06:18:27Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/action/TouchActions.java", "diffHunk": "@@ -154,6 +154,20 @@ public void swipeUntil(SwipeDirection direction, Duration swipeDuration, Boolean\n         }\n     }\n \n+    /**\n+     * Performs swipe based on <b>swipeCoordinates</b> passed as argument\n+     * @param swipeCoordinates coordinates to swipe, must not be {@code null}\n+     * @param duration between an element is pressed and released in\n+     * <a href=\"https://en.wikipedia.org/wiki/ISO_8601\">ISO 8601</a> format, must not be {@code null}\n+     */\n+    public void swipe(SwipeCoordinates swipeCoordinates, Duration duration)", "originalCommit": "35e32c04517b7c5c19ca00f03996e73ceea4d923", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjEwMjU4OQ==", "url": "https://github.com/vividus-framework/vividus/pull/1030#discussion_r506102589", "bodyText": "the part of the code can be extracted to a new method, and then re-used:\nprivate void putVariable(Optional<WebElement> element, Function<WebElement, Object> variableMapper, Set<VariableScope> scopes, String variableName)\n{\n    Object value = element.map(variableMapper).orElse(null);\n    bddVariableContext.putVariable(scopes, variableName, value);\n}", "author": "valfirst", "createdAt": "2020-10-16T06:59:10Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericSetVariableSteps.java", "diffHunk": "@@ -0,0 +1,149 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.steps.ui;\n+\n+import java.util.Optional;\n+import java.util.Set;\n+import java.util.function.Function;\n+\n+import org.jbehave.core.annotations.When;\n+import org.openqa.selenium.WebElement;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.monitor.TakeScreenshotOnFailure;\n+import org.vividus.bdd.steps.ui.validation.IBaseValidations;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.softassert.ISoftAssert;\n+import org.vividus.ui.action.ElementActions;\n+import org.vividus.ui.action.search.Locator;\n+import org.vividus.ui.action.search.Visibility;\n+import org.vividus.ui.context.IUiContext;\n+\n+@TakeScreenshotOnFailure\n+public class GenericSetVariableSteps\n+{\n+    private final ISoftAssert softAssert;\n+    private final IBaseValidations baseValidations;\n+    private final IBddVariableContext bddVariableContext;\n+    private final ElementActions elementActions;\n+    private final IUiContext uiContext;\n+\n+    public GenericSetVariableSteps(ISoftAssert softAssert, IBaseValidations baseValidations,\n+            IBddVariableContext bddVariableContext, ElementActions elementActions, IUiContext uiContext)\n+    {\n+        this.softAssert = softAssert;\n+        this.baseValidations = baseValidations;\n+        this.bddVariableContext = bddVariableContext;\n+        this.elementActions = elementActions;\n+        this.uiContext = uiContext;\n+    }\n+\n+    /**\n+     * Extracts the <b>text</b> of element found in the context and saves it to the <b>variable</b> with the specified\n+     * <b>variableName</b>\n+     * Actions performed at this step:\n+     * <ul>\n+     * <li>Saves the text of element into the <i>variable name</i>\n+     * </ul>\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario\n+     * <li><b>STORY</b> - the variable will be available within the whole story\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A name under which the value should be saved\n+     */\n+    @When(\"I save text of context element to $scopes variable `$variableName`\")\n+    public void saveContextElementTextToVariable(Set<VariableScope> scopes, String variableName)\n+    {\n+        saveVariableIfContextElementPresent(elementActions::getElementText, scopes, variableName);\n+    }\n+\n+    /**\n+     * Extracts the value of <b>attribute</b> of element found in the context and saves it to the <b>variable</b> with\n+     * the specified <b>variableName</b>\n+     * Actions performed at this step:\n+     * <ul>\n+     * <li>Saves the value of attribute with name <i>attributeName</i> to the <i>variableName</i>\n+     * </ul>\n+     * @param attributeName the name of the attribute (for ex. 'name', 'id')\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario\n+     * <li><b>STORY</b> - the variable will be available within the whole story\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A name under which the value should be saved\n+     */\n+    @When(\"I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\")\n+    public void saveContextElementAttributeValueToVariable(String attributeName, Set<VariableScope> scopes,\n+            String variableName)\n+    {\n+        saveVariableIfContextElementPresent(contextElement -> getAssertedAttributeValue(contextElement, attributeName),\n+                scopes, variableName);\n+    }\n+\n+    /**\n+     * Extracts the value of <b>attribute</b> of element found by <b>locator</b> and saves it to the <b>variable</b>\n+     * with the specified <b>variableName</b>\n+     * Actions performed at this step:\n+     * <ul>\n+     * <li>Saves the value of attribute with name <i>attributeName</i> to the <i>variableName</i>\n+     * </ul>\n+     * @param attributeName the name of the attribute (for ex. 'name', 'id')\n+     * @param locator locator to find an element\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario\n+     * <li><b>STORY</b> - the variable will be available within the whole story\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A name under which the value should be saved\n+     */\n+    @When(\"I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`\")\n+    public void saveAttributeValueOfElementByLocatorToVariable(String attributeName, Locator locator,\n+            Set<VariableScope> scopes, String variableName)\n+    {\n+        locator.getSearchParameters().setVisibility(Visibility.ALL);\n+        Object value = baseValidations.assertElementExists(\"The element to extract the attribute\", locator)\n+                                      .map(element -> getAssertedAttributeValue(element, attributeName))\n+                                      .orElse(null);\n+        bddVariableContext.putVariable(scopes, variableName, value);", "originalCommit": "35e32c04517b7c5c19ca00f03996e73ceea4d923", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9684ab17238b134888c06357e8fb679c53df2f1d", "url": "https://github.com/vividus-framework/vividus/commit/9684ab17238b134888c06357e8fb679c53df2f1d", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-16T07:31:45Z", "type": "commit"}, {"oid": "9684ab17238b134888c06357e8fb679c53df2f1d", "url": "https://github.com/vividus-framework/vividus/commit/9684ab17238b134888c06357e8fb679c53df2f1d", "message": "[extension-selenium] Add set variable steps\n\n- When I save text of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of context element to $scopes variable `$variableName`\n- When I save `$attributeName` attribute value of element located `$locator` to $scopes variable `$variableName`", "committedDate": "2020-10-16T07:31:45Z", "type": "forcePushed"}]}