{"pr_number": 1266, "pr_title": "1252", "pr_createdAt": "2020-12-22T20:16:35Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1266", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwMjYwOQ==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547502609", "bodyText": "use lazy logging", "author": "uarlouski", "createdAt": "2020-12-22T20:53:38Z", "path": "vividus-plugin-web-app/src/main/java/org/vividus/bdd/steps/ui/web/PageSteps.java", "diffHunk": "@@ -327,6 +331,25 @@ public void assertPageTitle(StringComparisonRule comparisonRule, String text)\n         descriptiveSoftAssert.assertThat(PAGE_TITLE, getWebDriver().getTitle(), comparisonRule.createMatcher(text));\n     }\n \n+    /**\n+     * Stop the loading of page using javascript method:\n+     * <code>window.stop();</code>\n+     */\n+    @When(\"I stop page loading\")\n+    public void stopPageLoading()\n+    {\n+        try\n+        {\n+            Map<String, String> pageStates = javascriptActions.stopPageLoading();\n+            LOGGER.info(\"Page ready state before stop: {}, after stop:{}\", pageStates.get(\"before\"),\n+                    pageStates.get(\"after\"));", "originalCommit": "5a9ec07e891eac8f6c44d3dbc5a28ff5196758e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzUwMzA3MA==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547503070", "bodyText": "inOrder.verifyNoMoreInteractions should work", "author": "uarlouski", "createdAt": "2020-12-22T20:54:49Z", "path": "vividus-plugin-web-app/src/test/java/org/vividus/bdd/steps/ui/web/PageStepsTests.java", "diffHunk": "@@ -330,8 +336,13 @@ void testRefreshPage()\n     @Test\n     void testOpenPageUrlInNewWindow()\n     {\n+        InOrder inOrder = Mockito.inOrder(setContextSteps, navigateActions, javascriptActions, uiContext);\n         pageSteps.openPageUrlInNewWindow(URL);\n-        verify(javascriptActions).openPageUrlInNewWindow(URL);\n+        inOrder.verify(javascriptActions).openNewWindow();\n+        inOrder.verify(setContextSteps).switchingToWindow();\n+        inOrder.verify(uiContext).reset();\n+        inOrder.verify(navigateActions).loadPage(URL);\n+        verifyNoMoreInteractions(setContextSteps, navigateActions, javascriptActions, uiContext);", "originalCommit": "5a9ec07e891eac8f6c44d3dbc5a28ff5196758e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzcxNDYxNQ==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547714615", "bodyText": "let before = document.readyState;\nwindow.stop();\nreturn {before: before, after: document.readyState};\n?", "author": "valfirst", "createdAt": "2020-12-23T06:40:31Z", "path": "vividus-plugin-web-app/src/main/java/org/vividus/ui/web/action/WebJavascriptActions.java", "diffHunk": "@@ -161,6 +160,16 @@ public String getPageText()\n         return getFormattedInnerText(\"document.body\");\n     }\n \n+    public Map<String, String> stopPageLoading()\n+    {\n+        return executeScript(\n+            \"let result = {};\"\n+          + \"result.before = document.readyState;\"\n+          + \"window.stop();\"\n+          + \"result.after = document.readyState;\"\n+          + \"return result;\");", "originalCommit": "5a9ec07e891eac8f6c44d3dbc5a28ff5196758e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzcxNjI3NQ==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547716275", "bodyText": "inOrder -> ordered (PMD doesn't like variables prefixed with in and out)", "author": "valfirst", "createdAt": "2020-12-23T06:42:37Z", "path": "vividus-plugin-web-app/src/test/java/org/vividus/bdd/steps/ui/web/PageStepsTests.java", "diffHunk": "@@ -330,8 +336,13 @@ void testRefreshPage()\n     @Test\n     void testOpenPageUrlInNewWindow()\n     {\n+        InOrder inOrder = Mockito.inOrder(setContextSteps, navigateActions, javascriptActions, uiContext);", "originalCommit": "5a9ec07e891eac8f6c44d3dbc5a28ff5196758e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzcxNjc0NQ==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547716745", "bodyText": "Table -> Tab", "author": "valfirst", "createdAt": "2020-12-23T06:43:10Z", "path": "vividus-plugin-web-app/src/test/java/org/vividus/ui/web/action/WebJavascriptActionsTests.java", "diffHunk": "@@ -158,11 +158,10 @@ void testScrollToStartOf()\n     }\n \n     @Test\n-    void testOpenPageUrlInNewWindow()\n+    void testOpenNewTable()", "originalCommit": "5a9ec07e891eac8f6c44d3dbc5a28ff5196758e5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bd73d16858309d4c8c9c6b301b90749c5d7d2954", "url": "https://github.com/vividus-framework/vividus/commit/bd73d16858309d4c8c9c6b301b90749c5d7d2954", "message": "[plugin-web-app] Rework opening URL in new tab to use selenium for navigation", "committedDate": "2020-12-23T08:46:45Z", "type": "commit"}, {"oid": "b62f1dc0682ce0e70f6933980cb7163caa2ea204", "url": "https://github.com/vividus-framework/vividus/commit/b62f1dc0682ce0e70f6933980cb7163caa2ea204", "message": "[plugin-web-app] Add step to stop page loading", "committedDate": "2020-12-23T08:54:39Z", "type": "forcePushed"}, {"oid": "5852b5925f1686b357b209fb7b99827b9e1ccd43", "url": "https://github.com/vividus-framework/vividus/commit/5852b5925f1686b357b209fb7b99827b9e1ccd43", "message": "[plugin-web-app] Add step to stop page loading", "committedDate": "2020-12-23T11:47:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk0NDAxMA==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547944010", "bodyText": "logger verification is missing :)", "author": "uarlouski", "createdAt": "2020-12-23T12:51:32Z", "path": "vividus-plugin-web-app/src/test/java/org/vividus/bdd/steps/ui/web/PageStepsTests.java", "diffHunk": "@@ -464,4 +475,27 @@ void testPageTitleContainsText()\n         verify(softAssert).assertThat(eq(PAGE_TITLE), eq(text),\n                 argThat(matcher -> \"a string containing \\\"text\\\"\".equals(matcher.toString())));\n     }\n+\n+    @Test\n+    void shouldStopThePageAndLogStatuses()\n+    {\n+        String interactive = \"interactive\";\n+        String complete = \"complete\";\n+        Map<String, String> result = Map.of(\"before\", interactive, \"after\", complete);\n+        when(javascriptActions.stopPageLoading()).thenReturn(result);\n+        pageSteps.stopPageLoading();\n+        assertThat(logger.getLoggingEvents(),\n+                is(List.of(info(\"Page ready state before stop: {}, after stop:{}\", interactive, complete))));\n+        verifyNoMoreInteractions(javascriptActions);\n+    }\n+\n+    @Test\n+    void shouldRecordFailedAssertionInCaseOfJavascriptException()\n+    {\n+        JavascriptException javascriptException = new JavascriptException(\"I can't take this any moooore\");\n+        when(javascriptActions.stopPageLoading()).thenThrow(javascriptException);\n+        pageSteps.stopPageLoading();\n+        softAssert.recordFailedAssertion(\"Unable to stop page loading\", javascriptException);\n+        verifyNoMoreInteractions(javascriptActions);", "originalCommit": "5852b5925f1686b357b209fb7b99827b9e1ccd43", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk0ODEzOA==", "url": "https://github.com/vividus-framework/vividus/pull/1266#discussion_r547948138", "bodyText": "Wow :)", "author": "ikalinin1", "createdAt": "2020-12-23T13:02:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0Nzk0NDAxMA=="}], "type": "inlineReview"}, {"oid": "4e2074877aab5fc4ac206dac63984966c5fbe65a", "url": "https://github.com/vividus-framework/vividus/commit/4e2074877aab5fc4ac206dac63984966c5fbe65a", "message": "[plugin-web-app] Add step to stop page loading", "committedDate": "2020-12-23T13:09:05Z", "type": "commit"}, {"oid": "4e2074877aab5fc4ac206dac63984966c5fbe65a", "url": "https://github.com/vividus-framework/vividus/commit/4e2074877aab5fc4ac206dac63984966c5fbe65a", "message": "[plugin-web-app] Add step to stop page loading", "committedDate": "2020-12-23T13:09:05Z", "type": "forcePushed"}]}