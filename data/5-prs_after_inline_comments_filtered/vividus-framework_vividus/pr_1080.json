{"pr_number": 1080, "pr_title": "[extension-selenium] Add ability to verify elements order", "pr_createdAt": "2020-10-30T17:56:34Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1080", "timeline": [{"oid": "39dc6ac4d1ee17704ec5fac25694a4ab0175f291", "url": "https://github.com/vividus-framework/vividus/commit/39dc6ac4d1ee17704ec5fac25694a4ab0175f291", "message": "draft", "committedDate": "2020-10-30T21:36:04Z", "type": "forcePushed"}, {"oid": "901df0530c10a875509fc6b3764bc1c662906776", "url": "https://github.com/vividus-framework/vividus/commit/901df0530c10a875509fc6b3764bc1c662906776", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-01T12:42:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYyODk2Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515628966", "bodyText": "ComparisonRule rule = ComparisonRule.GREATER_THAN;\n        int requiredNumber = 1;\n?", "author": "valfirst", "createdAt": "2020-11-01T14:28:27Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericElementSteps.java", "diffHunk": "@@ -77,4 +95,52 @@ public void assertElementsNumberInState(State state, Locator locator, Comparison\n         assertElementsNumber(locator, comparisonRule, quantity)\n                 .forEach(e -> baseValidations.assertElementState(description, state, e));\n     }\n+\n+    /**\n+     * Verifies if the elements located by the <b>locator</b> are sorted in <b>sortingOrder</b> order by their text\n+     * @param locator locator to locate elements\n+     * @param sortingOrder sorting order, can be either <b>ASCENDING</b> or <b>DESCENDING</b>\n+     */\n+    @Then(\"elements located `$locator` are sorted by text in $sortingOrder order\")\n+    public void areElementSorted(Locator locator, StringSortingOrder sortingOrder)\n+    {\n+        ComparisonRule rule = ComparisonRule.GREATER_THAN_OR_EQUAL_TO;\n+        int requiredNumber = 2;", "originalCommit": "901df0530c10a875509fc6b3764bc1c662906776", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYyOTAzMA==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515629030", "bodyText": "\"The elements to check the sorting\"?", "author": "valfirst", "createdAt": "2020-11-01T14:29:03Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericElementSteps.java", "diffHunk": "@@ -77,4 +95,52 @@ public void assertElementsNumberInState(State state, Locator locator, Comparison\n         assertElementsNumber(locator, comparisonRule, quantity)\n                 .forEach(e -> baseValidations.assertElementState(description, state, e));\n     }\n+\n+    /**\n+     * Verifies if the elements located by the <b>locator</b> are sorted in <b>sortingOrder</b> order by their text\n+     * @param locator locator to locate elements\n+     * @param sortingOrder sorting order, can be either <b>ASCENDING</b> or <b>DESCENDING</b>\n+     */\n+    @Then(\"elements located `$locator` are sorted by text in $sortingOrder order\")\n+    public void areElementSorted(Locator locator, StringSortingOrder sortingOrder)\n+    {\n+        ComparisonRule rule = ComparisonRule.GREATER_THAN_OR_EQUAL_TO;\n+        int requiredNumber = 2;\n+\n+        String order = sortingOrder.name().toLowerCase();\n+        List<WebElement> elements = baseValidations.assertNumberOfElementsFound(\n+                format(\"The elements to check the %s order\", order), locator,", "originalCommit": "901df0530c10a875509fc6b3764bc1c662906776", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYyOTEzMg==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515629132", "bodyText": "simple loop is better here", "author": "valfirst", "createdAt": "2020-11-01T14:29:51Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericElementSteps.java", "diffHunk": "@@ -77,4 +95,52 @@ public void assertElementsNumberInState(State state, Locator locator, Comparison\n         assertElementsNumber(locator, comparisonRule, quantity)\n                 .forEach(e -> baseValidations.assertElementState(description, state, e));\n     }\n+\n+    /**\n+     * Verifies if the elements located by the <b>locator</b> are sorted in <b>sortingOrder</b> order by their text\n+     * @param locator locator to locate elements\n+     * @param sortingOrder sorting order, can be either <b>ASCENDING</b> or <b>DESCENDING</b>\n+     */\n+    @Then(\"elements located `$locator` are sorted by text in $sortingOrder order\")\n+    public void areElementSorted(Locator locator, StringSortingOrder sortingOrder)\n+    {\n+        ComparisonRule rule = ComparisonRule.GREATER_THAN_OR_EQUAL_TO;\n+        int requiredNumber = 2;\n+\n+        String order = sortingOrder.name().toLowerCase();\n+        List<WebElement> elements = baseValidations.assertNumberOfElementsFound(\n+                format(\"The elements to check the %s order\", order), locator,\n+                requiredNumber, rule);\n+\n+        Matcher<Integer> requiredSizeMatcher = rule.getComparisonRule(requiredNumber);\n+        if (requiredSizeMatcher.matches(elements.size()))\n+        {\n+            IntStream.range(0, elements.size())\n+                     .mapToObj(index -> entry(index, getText(elements.get(index))))", "originalCommit": "901df0530c10a875509fc6b3764bc1c662906776", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTc3MDc1NQ==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515770755", "bodyText": "why? if it's because of separate method for getting text I can use Pair which is not null safe", "author": "uarlouski", "createdAt": "2020-11-02T06:59:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYyOTEzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTYyOTI3Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515629276", "bodyText": "validateRule", "author": "valfirst", "createdAt": "2020-11-01T14:31:11Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/validation/BaseValidations.java", "diffHunk": "@@ -381,6 +386,19 @@ public boolean assertIfElementDoesNotExist(String businessDescription, String sy\n         }, List.of());\n     }\n \n+    private static void verifyRule(Locator locator, int number, ComparisonRule comparisonRule)", "originalCommit": "901df0530c10a875509fc6b3764bc1c662906776", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "65c211901303dc88f61a77edd74c68fb5cc6a06e", "url": "https://github.com/vividus-framework/vividus/commit/65c211901303dc88f61a77edd74c68fb5cc6a06e", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-02T06:47:02Z", "type": "forcePushed"}, {"oid": "83beedbe8e7cb387300c332cb15b937eed35502a", "url": "https://github.com/vividus-framework/vividus/commit/83beedbe8e7cb387300c332cb15b937eed35502a", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-02T07:03:21Z", "type": "forcePushed"}, {"oid": "5e3bae6ea9bed4b31714a15f203f6d61f5954122", "url": "https://github.com/vividus-framework/vividus/commit/5e3bae6ea9bed4b31714a15f203f6d61f5954122", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-02T08:27:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMDY3Mg==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515810672", "bodyText": "just size() > 1 ?", "author": "ikalinin1", "createdAt": "2020-11-02T08:36:22Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericElementSteps.java", "diffHunk": "@@ -77,4 +90,45 @@ public void assertElementsNumberInState(State state, Locator locator, Comparison\n         assertElementsNumber(locator, comparisonRule, quantity)\n                 .forEach(e -> baseValidations.assertElementState(description, state, e));\n     }\n+\n+    /**\n+     * Verifies if the elements located by the <b>locator</b> are sorted in <b>sortingOrder</b> order by their text\n+     * @param locator locator to locate elements\n+     * @param sortingOrder sorting order, can be either <b>ASCENDING</b> or <b>DESCENDING</b>\n+     */\n+    @Then(\"elements located `$locator` are sorted by text in $sortingOrder order\")\n+    public void areElementSorted(Locator locator, StringSortingOrder sortingOrder)\n+    {\n+        ComparisonRule rule = ComparisonRule.GREATER_THAN;\n+        int requiredNumber = 1;\n+\n+        List<WebElement> elements = baseValidations.assertNumberOfElementsFound(\"The elements to check the sorting\",\n+                locator, requiredNumber, rule);\n+\n+        Matcher<Integer> requiredSizeMatcher = rule.getComparisonRule(requiredNumber);\n+        if (requiredSizeMatcher.matches(elements.size()))", "originalCommit": "5e3bae6ea9bed4b31714a15f203f6d61f5954122", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMTI2NA==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515811264", "bodyText": "Why should we consider a single element as a fail?", "author": "ikalinin1", "createdAt": "2020-11-02T08:37:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMDY3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNzk4Mg==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515817982", "bodyText": "from end users side it makes sense to sort more than one element, on the other hand, if we sort even one element, empty collections should be also allowed because this is not prohibited from programatic side", "author": "uarlouski", "createdAt": "2020-11-02T08:49:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMDY3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxMzkyMg==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515813922", "bodyText": "I think this way of assertion produces unclear messages in the report\nI propose to refactor in the following way:\n\"The element with index %d contains not empty text\"", "author": "valfirst", "createdAt": "2020-11-02T08:42:12Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericElementSteps.java", "diffHunk": "@@ -77,4 +90,45 @@ public void assertElementsNumberInState(State state, Locator locator, Comparison\n         assertElementsNumber(locator, comparisonRule, quantity)\n                 .forEach(e -> baseValidations.assertElementState(description, state, e));\n     }\n+\n+    /**\n+     * Verifies if the elements located by the <b>locator</b> are sorted in <b>sortingOrder</b> order by their text\n+     * @param locator locator to locate elements\n+     * @param sortingOrder sorting order, can be either <b>ASCENDING</b> or <b>DESCENDING</b>\n+     */\n+    @Then(\"elements located `$locator` are sorted by text in $sortingOrder order\")\n+    public void areElementSorted(Locator locator, StringSortingOrder sortingOrder)\n+    {\n+        ComparisonRule rule = ComparisonRule.GREATER_THAN;\n+        int requiredNumber = 1;\n+\n+        List<WebElement> elements = baseValidations.assertNumberOfElementsFound(\"The elements to check the sorting\",\n+                locator, requiredNumber, rule);\n+\n+        Matcher<Integer> requiredSizeMatcher = rule.getComparisonRule(requiredNumber);\n+        if (requiredSizeMatcher.matches(elements.size()))\n+        {\n+            List<String> texts = new ArrayList<>();\n+            for (int index = 0; index < elements.size(); index++)\n+            {\n+                String text = elementActions.getElementText(elements.get(index));\n+                if (softAssert.assertTrue(format(\"The element with index %d contains empty text\", index + 1),\n+                        isNotEmpty(text)))", "originalCommit": "5e3bae6ea9bed4b31714a15f203f6d61f5954122", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTgxNTUzMA==", "url": "https://github.com/vividus-framework/vividus/pull/1080#discussion_r515815530", "bodyText": "\"There are not enough elements with text to check sorting: \"", "author": "valfirst", "createdAt": "2020-11-02T08:45:09Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/bdd/steps/ui/GenericElementSteps.java", "diffHunk": "@@ -77,4 +90,45 @@ public void assertElementsNumberInState(State state, Locator locator, Comparison\n         assertElementsNumber(locator, comparisonRule, quantity)\n                 .forEach(e -> baseValidations.assertElementState(description, state, e));\n     }\n+\n+    /**\n+     * Verifies if the elements located by the <b>locator</b> are sorted in <b>sortingOrder</b> order by their text\n+     * @param locator locator to locate elements\n+     * @param sortingOrder sorting order, can be either <b>ASCENDING</b> or <b>DESCENDING</b>\n+     */\n+    @Then(\"elements located `$locator` are sorted by text in $sortingOrder order\")\n+    public void areElementSorted(Locator locator, StringSortingOrder sortingOrder)\n+    {\n+        ComparisonRule rule = ComparisonRule.GREATER_THAN;\n+        int requiredNumber = 1;\n+\n+        List<WebElement> elements = baseValidations.assertNumberOfElementsFound(\"The elements to check the sorting\",\n+                locator, requiredNumber, rule);\n+\n+        Matcher<Integer> requiredSizeMatcher = rule.getComparisonRule(requiredNumber);\n+        if (requiredSizeMatcher.matches(elements.size()))\n+        {\n+            List<String> texts = new ArrayList<>();\n+            for (int index = 0; index < elements.size(); index++)\n+            {\n+                String text = elementActions.getElementText(elements.get(index));\n+                if (softAssert.assertTrue(format(\"The element with index %d contains empty text\", index + 1),\n+                        isNotEmpty(text)))\n+                {\n+                    texts.add(text);\n+                }\n+            }\n+\n+            if (requiredSizeMatcher.matches(texts.size()))\n+            {\n+                softAssert.assertEquals(\n+                        String.format(\"The elements are sorted in %s order\", sortingOrder.name().toLowerCase()), texts,\n+                        texts.stream().sorted(sortingOrder.getSortingType()).collect(toList()));\n+            }\n+            else\n+            {\n+                softAssert.recordFailedAssertion(\"There are not enough elements to check sorting: \" + texts);", "originalCommit": "5e3bae6ea9bed4b31714a15f203f6d61f5954122", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e4834f956f28147dde88e9010d630e4e30c05942", "url": "https://github.com/vividus-framework/vividus/commit/e4834f956f28147dde88e9010d630e4e30c05942", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-02T09:04:59Z", "type": "forcePushed"}, {"oid": "ad4fd9c31b486e7b8c2b453d5c4fe28709f76b7d", "url": "https://github.com/vividus-framework/vividus/commit/ad4fd9c31b486e7b8c2b453d5c4fe28709f76b7d", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-02T10:15:24Z", "type": "commit"}, {"oid": "ad4fd9c31b486e7b8c2b453d5c4fe28709f76b7d", "url": "https://github.com/vividus-framework/vividus/commit/ad4fd9c31b486e7b8c2b453d5c4fe28709f76b7d", "message": "[extension-selenium] Add ability to verify elements order", "committedDate": "2020-11-02T10:15:24Z", "type": "forcePushed"}]}