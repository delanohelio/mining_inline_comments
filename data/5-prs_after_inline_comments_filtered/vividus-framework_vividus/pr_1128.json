{"pr_number": 1128, "pr_title": "[plugin-browserstack] Capture network logs", "pr_createdAt": "2020-11-12T09:39:26Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/1128", "timeline": [{"oid": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "url": "https://github.com/vividus-framework/vividus/commit/d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T10:02:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNTg5Mg==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522015892", "bodyText": "the variable name should be updated", "author": "valfirst", "createdAt": "2020-11-12T10:54:38Z", "path": "vividus-extension-selenium/src/test/java/org/vividus/selenium/WebDriverProviderTests.java", "diffHunk": "@@ -66,7 +71,7 @@\n     private RemoteWebDriver driver;\n \n     @Mock(extraInterfaces = WrapsDriver.class)\n-    private WebDriver wrapsDriver;\n+    private RemoteWebDriver wrapsDriver;", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNjMwOQ==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522016309", "bodyText": "use TestContext to store such data", "author": "valfirst", "createdAt": "2020-11-12T10:55:18Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.browserstack.steps;\n+\n+import static org.apache.commons.lang3.Validate.isTrue;\n+\n+import java.util.Set;\n+\n+import com.browserstack.client.exception.BrowserStackException;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.browserstack.BrowserStackAppAutomateClient;\n+import org.vividus.selenium.event.WebDriverQuitEvent;\n+\n+public class DebugSteps\n+{\n+    private final ThreadLocal<String> lastSessionId = ThreadLocal.withInitial(() -> null);", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNjQ2Mw==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522016463", "bodyText": "lastSessionId  -> previousSessionId", "author": "valfirst", "createdAt": "2020-11-12T10:55:35Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.browserstack.steps;\n+\n+import static org.apache.commons.lang3.Validate.isTrue;\n+\n+import java.util.Set;\n+\n+import com.browserstack.client.exception.BrowserStackException;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.browserstack.BrowserStackAppAutomateClient;\n+import org.vividus.selenium.event.WebDriverQuitEvent;\n+\n+public class DebugSteps\n+{\n+    private final ThreadLocal<String> lastSessionId = ThreadLocal.withInitial(() -> null);", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNjcxMA==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522016710", "bodyText": "useless", "author": "valfirst", "createdAt": "2020-11-12T10:56:00Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.browserstack.steps;\n+\n+import static org.apache.commons.lang3.Validate.isTrue;\n+\n+import java.util.Set;\n+\n+import com.browserstack.client.exception.BrowserStackException;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.browserstack.BrowserStackAppAutomateClient;\n+import org.vividus.selenium.event.WebDriverQuitEvent;\n+\n+public class DebugSteps\n+{\n+    private final ThreadLocal<String> lastSessionId = ThreadLocal.withInitial(() -> null);\n+\n+    private final BrowserStackAppAutomateClient appAutomateClient;\n+    private final IBddVariableContext bddVariableContext;\n+\n+    public DebugSteps(EventBus eventBus, BrowserStackAppAutomateClient appAutomateClient,\n+            IBddVariableContext bddVariableContext)\n+    {\n+        eventBus.register(this);", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxNjg3Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522016876", "bodyText": "useless @SuppressWarnings", "author": "valfirst", "createdAt": "2020-11-12T10:56:16Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/bdd/browserstack/steps/DebugSteps.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.browserstack.steps;\n+\n+import static org.apache.commons.lang3.Validate.isTrue;\n+\n+import java.util.Set;\n+\n+import com.browserstack.client.exception.BrowserStackException;\n+import com.google.common.eventbus.EventBus;\n+import com.google.common.eventbus.Subscribe;\n+\n+import org.jbehave.core.annotations.When;\n+import org.vividus.bdd.context.IBddVariableContext;\n+import org.vividus.bdd.variable.VariableScope;\n+import org.vividus.browserstack.BrowserStackAppAutomateClient;\n+import org.vividus.selenium.event.WebDriverQuitEvent;\n+\n+public class DebugSteps\n+{\n+    private final ThreadLocal<String> lastSessionId = ThreadLocal.withInitial(() -> null);\n+\n+    private final BrowserStackAppAutomateClient appAutomateClient;\n+    private final IBddVariableContext bddVariableContext;\n+\n+    public DebugSteps(EventBus eventBus, BrowserStackAppAutomateClient appAutomateClient,\n+            IBddVariableContext bddVariableContext)\n+    {\n+        eventBus.register(this);\n+        this.appAutomateClient = appAutomateClient;\n+        this.bddVariableContext = bddVariableContext;\n+    }\n+\n+    /**\n+     * Saves network logs from an application sesssion. The application session must be closed before network logs\n+     * can be saved.\n+     * @param scopes The set (comma separated list of scopes e.g.: STORY, NEXT_BATCHES) of variable's scope<br>\n+     * <i>Available scopes:</i>\n+     * <ul>\n+     * <li><b>STEP</b> - the variable will be available only within the step,\n+     * <li><b>SCENARIO</b> - the variable will be available only within the scenario,\n+     * <li><b>STORY</b> - the variable will be available within the whole story,\n+     * <li><b>NEXT_BATCHES</b> - the variable will be available starting from next batch\n+     * </ul>\n+     * @param variableName A variable name\n+     * @throws BrowserStackException if error occurred while interacting with BrowserStack\n+     */\n+    @When(\"I save BrowserStack network logs to $scopes variable `$variableName`\")\n+    public void saveNetworkLogs(Set<VariableScope> scopes, String variableName) throws BrowserStackException\n+    {\n+        String sessionId = lastSessionId.get();\n+        isTrue(sessionId != null, \"Unable to find a previous session\");\n+        String networkLogs = appAutomateClient.getNetworkLogs(sessionId);\n+        bddVariableContext.putVariable(scopes, variableName, networkLogs);\n+    }\n+\n+    @Subscribe\n+    public void onWebDriverQuit(@SuppressWarnings(\"unused\") WebDriverQuitEvent event)", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxODQwNQ==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522018405", "bodyText": "do you really need a custom instance instead of existing bean?", "author": "valfirst", "createdAt": "2020-11-12T10:58:47Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/browserstack/BrowserStackAppAutomateClient.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019-2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.browserstack;\n+\n+import java.net.URI;\n+import java.time.Duration;\n+import java.util.List;\n+\n+import com.browserstack.appautomate.AppAutomateClient;\n+import com.browserstack.client.BrowserStackRequest;\n+import com.browserstack.client.exception.BrowserStackException;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.vividus.util.UriUtils;\n+import org.vividus.util.json.JsonUtils;\n+import org.vividus.util.wait.DurationBasedWaiter;\n+import org.vividus.util.wait.WaitMode;\n+import org.vividus.util.wait.Waiter;\n+\n+public class BrowserStackAppAutomateClient extends AppAutomateClient\n+{\n+    private static final int DEFAULT_RETRY = 5;\n+    private static final int DEFAULT_SECONDS = 25;\n+\n+    private final JsonUtils jsonUtils = new JsonUtils();", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAzOTE2Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522039166", "bodyText": "we need this just to handle simple corner case, I think it's better to pass into the client only those values that are logically suitable for it, like username and password, in case of jsonutil it's not clear why we even need it", "author": "uarlouski", "createdAt": "2020-11-12T11:34:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxODQwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA0NTExMg==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522045112", "bodyText": "instantiation of ObjectMapper is quite expensive, that's why it's better to reuse the bean", "author": "valfirst", "createdAt": "2020-11-12T11:44:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxODQwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA0OTgwMw==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522049803", "bodyText": "so between ugly api and 0.001 sec saving we use the second choice, right?", "author": "uarlouski", "createdAt": "2020-11-12T11:53:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxODQwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyMDQ0Mg==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522020442", "bodyText": "do you need inheritance? can't you use composition here?", "author": "valfirst", "createdAt": "2020-11-12T11:02:00Z", "path": "vividus-plugin-browserstack/src/main/java/org/vividus/browserstack/BrowserStackAppAutomateClient.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright 2019-2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.browserstack;\n+\n+import java.net.URI;\n+import java.time.Duration;\n+import java.util.List;\n+\n+import com.browserstack.appautomate.AppAutomateClient;\n+import com.browserstack.client.BrowserStackRequest;\n+import com.browserstack.client.exception.BrowserStackException;\n+\n+import org.apache.commons.lang3.StringUtils;\n+import org.vividus.util.UriUtils;\n+import org.vividus.util.json.JsonUtils;\n+import org.vividus.util.wait.DurationBasedWaiter;\n+import org.vividus.util.wait.WaitMode;\n+import org.vividus.util.wait.Waiter;\n+\n+public class BrowserStackAppAutomateClient extends AppAutomateClient", "originalCommit": "d126b831cf0de9d39ce026d3bad34b6a13d1a1c2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA0OTE3Ng==", "url": "https://github.com/vividus-framework/vividus/pull/1128#discussion_r522049176", "bodyText": "This client will be used later for getting logs for running test suite", "author": "uarlouski", "createdAt": "2020-11-12T11:52:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAyMDQ0Mg=="}], "type": "inlineReview"}, {"oid": "b94e1b09c80aa729f586139a80528c81c663750d", "url": "https://github.com/vividus-framework/vividus/commit/b94e1b09c80aa729f586139a80528c81c663750d", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T13:46:44Z", "type": "forcePushed"}, {"oid": "0dd5657936278e695c0e616f161accc2f83c8871", "url": "https://github.com/vividus-framework/vividus/commit/0dd5657936278e695c0e616f161accc2f83c8871", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T13:56:35Z", "type": "forcePushed"}, {"oid": "4addcacbbc32067c974b093746a7165e7a8e0500", "url": "https://github.com/vividus-framework/vividus/commit/4addcacbbc32067c974b093746a7165e7a8e0500", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T14:19:43Z", "type": "forcePushed"}, {"oid": "fe5f36dbc82dbc4d6f7df35292d19d17ca97a018", "url": "https://github.com/vividus-framework/vividus/commit/fe5f36dbc82dbc4d6f7df35292d19d17ca97a018", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T14:39:31Z", "type": "forcePushed"}, {"oid": "cc6727b738238841bd905a7f7d308e8385952065", "url": "https://github.com/vividus-framework/vividus/commit/cc6727b738238841bd905a7f7d308e8385952065", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T16:04:05Z", "type": "forcePushed"}, {"oid": "01eaf880f8a584499ae42e66ea1e7fec4c9ae742", "url": "https://github.com/vividus-framework/vividus/commit/01eaf880f8a584499ae42e66ea1e7fec4c9ae742", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T17:24:57Z", "type": "forcePushed"}, {"oid": "ff35ba1154d53869e79c2df6025ddf3a0722f812", "url": "https://github.com/vividus-framework/vividus/commit/ff35ba1154d53869e79c2df6025ddf3a0722f812", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T17:25:46Z", "type": "forcePushed"}, {"oid": "32083bfbf2ee589e939827defad264bc62d3678b", "url": "https://github.com/vividus-framework/vividus/commit/32083bfbf2ee589e939827defad264bc62d3678b", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T17:27:51Z", "type": "commit"}, {"oid": "32083bfbf2ee589e939827defad264bc62d3678b", "url": "https://github.com/vividus-framework/vividus/commit/32083bfbf2ee589e939827defad264bc62d3678b", "message": "[plugin-browserstack] Capture network logs", "committedDate": "2020-11-12T17:27:51Z", "type": "forcePushed"}]}