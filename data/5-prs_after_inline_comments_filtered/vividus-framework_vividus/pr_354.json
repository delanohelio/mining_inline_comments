{"pr_number": 354, "pr_title": "Add applitools integration", "pr_createdAt": "2020-02-28T12:32:08Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/354", "timeline": [{"oid": "cf0c8b0c5bea7c788abc1ed60ded041eed80b9b2", "url": "https://github.com/vividus-framework/vividus/commit/cf0c8b0c5bea7c788abc1ed60ded041eed80b9b2", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-02-29T08:23:03Z", "type": "forcePushed"}, {"oid": "0fe2ec6bff5b270de990c78991d59c6e773c3705", "url": "https://github.com/vividus-framework/vividus/commit/0fe2ec6bff5b270de990c78991d59c6e773c3705", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-01T18:43:52Z", "type": "forcePushed"}, {"oid": "1992383defd1e519842f1bb1f4f5551bf2b27be7", "url": "https://github.com/vividus-framework/vividus/commit/1992383defd1e519842f1bb1f4f5551bf2b27be7", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-02T07:24:01Z", "type": "forcePushed"}, {"oid": "1d0ce98115d51333e26fda71411cfcfdb2366ecd", "url": "https://github.com/vividus-framework/vividus/commit/1d0ce98115d51333e26fda71411cfcfdb2366ecd", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-02T10:03:02Z", "type": "forcePushed"}, {"oid": "f3119a6e0a133e22ed75b3a5f8bd0387f5020e36", "url": "https://github.com/vividus-framework/vividus/commit/f3119a6e0a133e22ed75b3a5f8bd0387f5020e36", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-02T10:07:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MjYyOA==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r387492628", "bodyText": "please format comment properly", "author": "valfirst", "createdAt": "2020-03-04T07:40:52Z", "path": "vividus-extension-visual-testing/src/main/java/org/vividus/visual/model/VisualCheck.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.visual.model;\n+\n+import java.util.Map;\n+import java.util.Optional;\n+import java.util.Set;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.SearchContext;\n+import org.vividus.selenium.screenshot.ScreenshotConfiguration;\n+import org.vividus.visual.screenshot.IgnoreStrategy;\n+\n+public class VisualCheck\n+{\n+    private String baselineName;\n+    private VisualActionType action;\n+    private Map<IgnoreStrategy, Set<By>> elementsToIgnore = Map.of();\n+    private Optional<ScreenshotConfiguration> screenshotConfiguration = Optional.empty();\n+    private SearchContext searchContext;\n+\n+    public VisualCheck()\n+    {\n+      //Necessary for JBehave object instantiation;", "originalCommit": "f3119a6e0a133e22ed75b3a5f8bd0387f5020e36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUwNjkzNw==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r387506937", "bodyText": "please format comment properly", "author": "valfirst", "createdAt": "2020-03-04T08:18:02Z", "path": "vividus-plugin-applitools/src/main/java/org/vividus/eyes/model/ApplitoolsVisualCheck.java", "diffHunk": "@@ -0,0 +1,165 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.eyes.model;\n+\n+import java.net.URI;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import com.applitools.eyes.MatchLevel;\n+\n+import org.openqa.selenium.By;\n+import org.vividus.visual.model.VisualActionType;\n+import org.vividus.visual.model.VisualCheck;\n+import org.vividus.visual.screenshot.IgnoreStrategy;\n+\n+public class ApplitoolsVisualCheck extends VisualCheck\n+{\n+    private String executeApiKey;\n+    private String readApiKey;\n+    private String hostApp;\n+    private String hostOS;\n+    private String viewportSize;\n+    private MatchLevel matchLevel;\n+    private URI serverUri;\n+    private String appName;\n+    private String batchName;\n+    private String baselineEnvName;\n+    private Set<By> elementsToIgnore = Set.of();\n+    private Set<By> areasToIgnore = Set.of();\n+\n+    public ApplitoolsVisualCheck()\n+    {\n+        //Necessary for JBehave object instantiation;", "originalCommit": "f3119a6e0a133e22ed75b3a5f8bd0387f5020e36", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "70e2a02178a5f6488a54a0d15066c5512e677e37", "url": "https://github.com/vividus-framework/vividus/commit/70e2a02178a5f6488a54a0d15066c5512e677e37", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-05T11:37:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0MjU3NA==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r388242574", "bodyText": "use method ref", "author": "uarlouski", "createdAt": "2020-03-05T11:44:29Z", "path": "vividus-extension-visual-testing/src/main/java/org/vividus/visual/VisualCheckFactory.java", "diffHunk": "@@ -42,6 +42,16 @@ public VisualCheck create(String baselineName, VisualActionType actionType)\n         return new VisualCheck(indexedBaselineName, actionType);\n     }\n \n+    @Override\n+    public <T extends VisualCheck> T create(String baselineName, VisualActionType actionType,\n+            BiFunction<String, VisualActionType, T> checkFactory)\n+    {\n+        String indexedBaselineName = screenshotIndexer.map(in -> indexers.get(in))", "originalCommit": "70e2a02178a5f6488a54a0d15066c5512e677e37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0Njk0Mw==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r388246943", "bodyText": "actually testers do not know what means eyes here, does it make sense to rename it to applitools?", "author": "uarlouski", "createdAt": "2020-03-05T11:54:16Z", "path": "vividus-plugin-applitools/src/main/java/org/vividus/visual/eyes/VisualTestingSteps.java", "diffHunk": "@@ -0,0 +1,189 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.visual.eyes;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javax.inject.Inject;\n+\n+import org.jbehave.core.annotations.When;\n+import org.vividus.reporter.event.IAttachmentPublisher;\n+import org.vividus.selenium.screenshot.ScreenshotConfiguration;\n+import org.vividus.softassert.ISoftAssert;\n+import org.vividus.ui.web.context.IWebUiContext;\n+import org.vividus.visual.bdd.AbstractVisualSteps;\n+import org.vividus.visual.eyes.factory.ApplitoolsVisualCheckFactory;\n+import org.vividus.visual.eyes.model.ApplitoolsVisualCheck;\n+import org.vividus.visual.eyes.service.VisualTestingService;\n+import org.vividus.visual.model.VisualActionType;\n+import org.vividus.visual.model.VisualCheckResult;\n+\n+public class VisualTestingSteps extends AbstractVisualSteps\n+{\n+    @Inject private VisualTestingService visualTestingService;\n+    @Inject private ISoftAssert softAssert;\n+    @Inject private ApplitoolsVisualCheckFactory applitoolsVisualCheckFactory;\n+\n+    public VisualTestingSteps(IWebUiContext webUiContext, IAttachmentPublisher attachmentPublisher)\n+    {\n+        super(webUiContext, attachmentPublisher);\n+    }\n+\n+    /**\n+     * Performs visual check on the Applitools service;\n+     * @param actionType ESTABLISH or COMPARE_AGAINST\n+     * @param testName name of the test.\n+     * @param batchName name of the batch. Batch acts as group of tests.\n+     */\n+    @When(\"I $action eyes baseline `$testName` in batch `$batchName`\")\n+    public void performCheck(VisualActionType actionType, String testName, String batchName)\n+    {\n+        ApplitoolsVisualCheck visualCheck = applitoolsVisualCheckFactory.create(batchName, testName, actionType);\n+        runApplitoolsTest(visualCheck);\n+    }\n+\n+    /**\n+     * Perform visual check on the Applitools service and provides possibility to use custom configuration eyes;<br>\n+     * <table border=\"1\">\n+     *    <caption>Example of eyes configuration:</caption>\n+     *    <thead>\n+     *      <tr>\n+     *        <th>readApiKey</th>\n+     *        <th>hostApp</th>\n+     *        <th>hostOS</th>\n+     *        <th>viewportSize</th>\n+     *        <th>matchLevel</th>\n+     *        <th>serverUri</th>\n+     *        <th>appName</th>\n+     *        <th>batchName</th>\n+     *        <th>baselineEnvName</th>\n+     *        <th>baselineName</th>\n+     *        <th>action</th>\n+     *      </tr>\n+     *    </thead>\n+     *    <tbody>\n+     *      <tr>\n+     *        <td>key</td>\n+     *        <td>Chrome</td>\n+     *        <td>Windows 95</td>\n+     *        <td>1x1</td>\n+     *        <td>EXACT</td>\n+     *        <td>https://eyesapi.applitools.com</td>\n+     *        <td>AUT</td>\n+     *        <td>UAT</td>\n+     *        <td>PREDEV</td>\n+     *        <td>someName</td>\n+     *        <td>ESTABLISH</td>\n+     *      </tr>\n+     *    </tbody>\n+     *  </table>\n+     *  <br> Mind that: batchName, baselineName, action are mandatory parameters;\n+     * @param applitoolsVisualChecks custom eyes configuration\n+     */\n+    @When(\"I run eyes test using:$eyesConfiguration\")\n+    public void performCheck(List<ApplitoolsVisualCheck> applitoolsVisualChecks)\n+    {\n+        applitoolsVisualChecks.forEach(this::runApplitoolsTest);\n+    }\n+\n+    /**\n+     * Perform visual check on the Applitools service and provides possibility to use custom configurations for\n+     * the checks and screenshot strategy;<br>\n+     * <table border=\"1\">\n+     *    <caption>Example of eyes configuration:</caption>\n+     *    <thead>\n+     *      <tr>\n+     *        <th>readApiKey</th>\n+     *        <th>hostApp</th>\n+     *        <th>hostOS</th>\n+     *        <th>viewportSize</th>\n+     *        <th>matchLevel</th>\n+     *        <th>serverUri</th>\n+     *        <th>appName</th>\n+     *        <th>batchName</th>\n+     *        <th>baselineEnvName</th>\n+     *        <th>baselineName</th>\n+     *        <th>action</th>\n+     *      </tr>\n+     *    </thead>\n+     *    <tbody>\n+     *      <tr>\n+     *        <td>key</td>\n+     *        <td>Chrome</td>\n+     *        <td>Windows 95</td>\n+     *        <td>1x1</td>\n+     *        <td>EXACT</td>\n+     *        <td>https://eyesapi.applitools.com</td>\n+     *        <td>AUT</td>\n+     *        <td>UAT</td>\n+     *        <td>PREDEV</td>\n+     *        <td>someName</td>\n+     *        <td>ESTABLISH</td>\n+     *      </tr>\n+     *    </tbody>\n+     *  </table>\n+     *  <br> Mind that: batchName, baselineName, action are mandatory parameters;<br>\n+     * <table border=\"1\">\n+     *    <caption>Example of screenshot configuration:</caption>\n+     *    <thead>\n+     *      <tr>\n+     *        <th>webHeaderToCut</th>\n+     *        <th>webFooterToCut</th>\n+     *        <th>nativeHeaderToCut</th>\n+     *        <th>nativeFooterToCut</th>\n+     *        <th>scrollableElement</th>\n+     *        <th>coordsProvider</th>\n+     *        <th>scrollTimeout</th>\n+     *        <th>screenshotShootingStrategy</th>\n+     *      </tr>\n+     *    </thead>\n+     *    <tbody>\n+     *      <tr>\n+     *        <td>100</td>\n+     *        <td>10</td>\n+     *        <td>20</td>\n+     *        <td>20</td>\n+     *        <td>By.id(scrollable)</td>\n+     *        <td>WEB_DRIVER</td>\n+     *        <td>500</td>\n+     *        <td>SIMPLE</td>\n+     *      </tr>\n+     *    </tbody>\n+     *  </table>\n+     * @param applitoolsVisualChecks custom eyes configuration\n+     * @param screenshotConfiguration custom shooting strategy configuration\n+     */\n+    @When(value = \"I run eyes test using:$eyesConfiguration and screenshot config:$screenshotConfiguration\",", "originalCommit": "70e2a02178a5f6488a54a0d15066c5512e677e37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0Njk3Ng==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r388246976", "bodyText": "actually testers do not know what means eyes here, does it make sense to rename it to applitools?", "author": "uarlouski", "createdAt": "2020-03-05T11:54:20Z", "path": "vividus-plugin-applitools/src/main/java/org/vividus/visual/eyes/VisualTestingSteps.java", "diffHunk": "@@ -0,0 +1,189 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.visual.eyes;\n+\n+import java.util.List;\n+import java.util.Optional;\n+\n+import javax.inject.Inject;\n+\n+import org.jbehave.core.annotations.When;\n+import org.vividus.reporter.event.IAttachmentPublisher;\n+import org.vividus.selenium.screenshot.ScreenshotConfiguration;\n+import org.vividus.softassert.ISoftAssert;\n+import org.vividus.ui.web.context.IWebUiContext;\n+import org.vividus.visual.bdd.AbstractVisualSteps;\n+import org.vividus.visual.eyes.factory.ApplitoolsVisualCheckFactory;\n+import org.vividus.visual.eyes.model.ApplitoolsVisualCheck;\n+import org.vividus.visual.eyes.service.VisualTestingService;\n+import org.vividus.visual.model.VisualActionType;\n+import org.vividus.visual.model.VisualCheckResult;\n+\n+public class VisualTestingSteps extends AbstractVisualSteps\n+{\n+    @Inject private VisualTestingService visualTestingService;\n+    @Inject private ISoftAssert softAssert;\n+    @Inject private ApplitoolsVisualCheckFactory applitoolsVisualCheckFactory;\n+\n+    public VisualTestingSteps(IWebUiContext webUiContext, IAttachmentPublisher attachmentPublisher)\n+    {\n+        super(webUiContext, attachmentPublisher);\n+    }\n+\n+    /**\n+     * Performs visual check on the Applitools service;\n+     * @param actionType ESTABLISH or COMPARE_AGAINST\n+     * @param testName name of the test.\n+     * @param batchName name of the batch. Batch acts as group of tests.\n+     */\n+    @When(\"I $action eyes baseline `$testName` in batch `$batchName`\")\n+    public void performCheck(VisualActionType actionType, String testName, String batchName)\n+    {\n+        ApplitoolsVisualCheck visualCheck = applitoolsVisualCheckFactory.create(batchName, testName, actionType);\n+        runApplitoolsTest(visualCheck);\n+    }\n+\n+    /**\n+     * Perform visual check on the Applitools service and provides possibility to use custom configuration eyes;<br>\n+     * <table border=\"1\">\n+     *    <caption>Example of eyes configuration:</caption>\n+     *    <thead>\n+     *      <tr>\n+     *        <th>readApiKey</th>\n+     *        <th>hostApp</th>\n+     *        <th>hostOS</th>\n+     *        <th>viewportSize</th>\n+     *        <th>matchLevel</th>\n+     *        <th>serverUri</th>\n+     *        <th>appName</th>\n+     *        <th>batchName</th>\n+     *        <th>baselineEnvName</th>\n+     *        <th>baselineName</th>\n+     *        <th>action</th>\n+     *      </tr>\n+     *    </thead>\n+     *    <tbody>\n+     *      <tr>\n+     *        <td>key</td>\n+     *        <td>Chrome</td>\n+     *        <td>Windows 95</td>\n+     *        <td>1x1</td>\n+     *        <td>EXACT</td>\n+     *        <td>https://eyesapi.applitools.com</td>\n+     *        <td>AUT</td>\n+     *        <td>UAT</td>\n+     *        <td>PREDEV</td>\n+     *        <td>someName</td>\n+     *        <td>ESTABLISH</td>\n+     *      </tr>\n+     *    </tbody>\n+     *  </table>\n+     *  <br> Mind that: batchName, baselineName, action are mandatory parameters;\n+     * @param applitoolsVisualChecks custom eyes configuration\n+     */\n+    @When(\"I run eyes test using:$eyesConfiguration\")\n+    public void performCheck(List<ApplitoolsVisualCheck> applitoolsVisualChecks)\n+    {\n+        applitoolsVisualChecks.forEach(this::runApplitoolsTest);\n+    }\n+\n+    /**\n+     * Perform visual check on the Applitools service and provides possibility to use custom configurations for\n+     * the checks and screenshot strategy;<br>\n+     * <table border=\"1\">\n+     *    <caption>Example of eyes configuration:</caption>\n+     *    <thead>\n+     *      <tr>\n+     *        <th>readApiKey</th>\n+     *        <th>hostApp</th>\n+     *        <th>hostOS</th>\n+     *        <th>viewportSize</th>\n+     *        <th>matchLevel</th>\n+     *        <th>serverUri</th>\n+     *        <th>appName</th>\n+     *        <th>batchName</th>\n+     *        <th>baselineEnvName</th>\n+     *        <th>baselineName</th>\n+     *        <th>action</th>\n+     *      </tr>\n+     *    </thead>\n+     *    <tbody>\n+     *      <tr>\n+     *        <td>key</td>\n+     *        <td>Chrome</td>\n+     *        <td>Windows 95</td>\n+     *        <td>1x1</td>\n+     *        <td>EXACT</td>\n+     *        <td>https://eyesapi.applitools.com</td>\n+     *        <td>AUT</td>\n+     *        <td>UAT</td>\n+     *        <td>PREDEV</td>\n+     *        <td>someName</td>\n+     *        <td>ESTABLISH</td>\n+     *      </tr>\n+     *    </tbody>\n+     *  </table>\n+     *  <br> Mind that: batchName, baselineName, action are mandatory parameters;<br>\n+     * <table border=\"1\">\n+     *    <caption>Example of screenshot configuration:</caption>\n+     *    <thead>\n+     *      <tr>\n+     *        <th>webHeaderToCut</th>\n+     *        <th>webFooterToCut</th>\n+     *        <th>nativeHeaderToCut</th>\n+     *        <th>nativeFooterToCut</th>\n+     *        <th>scrollableElement</th>\n+     *        <th>coordsProvider</th>\n+     *        <th>scrollTimeout</th>\n+     *        <th>screenshotShootingStrategy</th>\n+     *      </tr>\n+     *    </thead>\n+     *    <tbody>\n+     *      <tr>\n+     *        <td>100</td>\n+     *        <td>10</td>\n+     *        <td>20</td>\n+     *        <td>20</td>\n+     *        <td>By.id(scrollable)</td>\n+     *        <td>WEB_DRIVER</td>\n+     *        <td>500</td>\n+     *        <td>SIMPLE</td>\n+     *      </tr>\n+     *    </tbody>\n+     *  </table>\n+     * @param applitoolsVisualChecks custom eyes configuration\n+     * @param screenshotConfiguration custom shooting strategy configuration\n+     */\n+    @When(value = \"I run eyes test using:$eyesConfiguration and screenshot config:$screenshotConfiguration\",", "originalCommit": "70e2a02178a5f6488a54a0d15066c5512e677e37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODI0Nzk0MQ==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r388247941", "bodyText": "boolean saveTests = applitoolsVisualCheck.getAction() == VisualActionType.ESTABLISH;\neyes.setSaveFailedTests(saveTests);\n eyes.setSaveNewTests(saveTests);\n\nmaybe", "author": "uarlouski", "createdAt": "2020-03-05T11:56:26Z", "path": "vividus-plugin-applitools/src/main/java/org/vividus/visual/eyes/factory/ImageEyesFactory.java", "diffHunk": "@@ -0,0 +1,71 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.visual.eyes.factory;\n+\n+import java.util.Map;\n+import java.util.concurrent.ConcurrentHashMap;\n+\n+import javax.inject.Named;\n+\n+import com.applitools.eyes.BatchInfo;\n+import com.applitools.eyes.LogHandler;\n+import com.applitools.eyes.RectangleSize;\n+import com.applitools.eyes.images.Eyes;\n+\n+import org.vividus.visual.eyes.model.ApplitoolsVisualCheck;\n+import org.vividus.visual.model.VisualActionType;\n+\n+@Named\n+public class ImageEyesFactory\n+{\n+    private final LogHandler logHandler;\n+    private final Map<String, BatchInfo> batchStorage = new ConcurrentHashMap<>();\n+\n+    public ImageEyesFactory(LogHandler logHandler)\n+    {\n+        this.logHandler = logHandler;\n+    }\n+\n+    public Eyes createEyes(ApplitoolsVisualCheck applitoolsVisualCheck)\n+    {\n+        Eyes eyes = new Eyes();\n+        eyes.setApiKey(applitoolsVisualCheck.getExecuteApiKey());\n+        String viewporSize = applitoolsVisualCheck.getViewportSize();\n+        //Environment\n+        eyes.setExplicitViewportSize(viewporSize == null ? null : RectangleSize.parse(viewporSize));\n+        eyes.setHostApp(applitoolsVisualCheck.getHostApp());\n+        eyes.setHostOS(applitoolsVisualCheck.getHostOS());\n+        eyes.setBaselineEnvName(applitoolsVisualCheck.getBaselineEnvName());\n+\n+        eyes.setMatchLevel(applitoolsVisualCheck.getMatchLevel());\n+        eyes.setServerUrl(applitoolsVisualCheck.getServerUri());\n+        eyes.setLogHandler(logHandler);\n+        if (applitoolsVisualCheck.getAction() == VisualActionType.ESTABLISH)\n+        {\n+            eyes.setSaveFailedTests(true);\n+            eyes.setSaveNewTests(true);\n+        }\n+        else\n+        {\n+            eyes.setSaveFailedTests(false);\n+            eyes.setSaveNewTests(false);\n+        }", "originalCommit": "70e2a02178a5f6488a54a0d15066c5512e677e37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bd6a6769a3bba196249cd4a40afcb2f18fa7a581", "url": "https://github.com/vividus-framework/vividus/commit/bd6a6769a3bba196249cd4a40afcb2f18fa7a581", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-06T12:57:00Z", "type": "forcePushed"}, {"oid": "5e2d62f814f323aead1735cdaefed6a8a6c05418", "url": "https://github.com/vividus-framework/vividus/commit/5e2d62f814f323aead1735cdaefed6a8a6c05418", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-06T13:30:21Z", "type": "forcePushed"}, {"oid": "2475ac9eb510d9a4b4042762eae541d852eac2f2", "url": "https://github.com/vividus-framework/vividus/commit/2475ac9eb510d9a4b4042762eae541d852eac2f2", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-06T13:52:20Z", "type": "forcePushed"}, {"oid": "8f281c1eac669fe9d8876f0bdc5875d3e36e3f6c", "url": "https://github.com/vividus-framework/vividus/commit/8f281c1eac669fe9d8876f0bdc5875d3e36e3f6c", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-06T14:22:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4MDgxMw==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r388980813", "bodyText": "this interaction should be excluded from the Allure report, we don't need Eyes API HTTP request/response -s", "author": "valfirst", "createdAt": "2020-03-06T15:48:57Z", "path": "vividus-plugin-applitools/src/main/java/org/vividus/visual/eyes/service/ImageVisualTestingService.java", "diffHunk": "@@ -0,0 +1,119 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.visual.eyes.service;\n+\n+import java.io.IOException;\n+import java.net.URI;\n+import java.util.Base64;\n+\n+import javax.inject.Named;\n+\n+import com.applitools.eyes.StepInfo;\n+import com.applitools.eyes.StepInfo.ApiUrls;\n+import com.applitools.eyes.TestResults;\n+import com.applitools.eyes.images.Eyes;\n+\n+import org.apache.http.HttpStatus;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.vividus.http.client.HttpResponse;\n+import org.vividus.http.client.IHttpClient;\n+import org.vividus.visual.eyes.factory.ImageEyesFactory;\n+import org.vividus.visual.eyes.model.ApplitoolsVisualCheck;\n+import org.vividus.visual.eyes.model.ApplitoolsVisualCheckResult;\n+import org.vividus.visual.screenshot.ScreenshotProvider;\n+\n+@Named\n+public class ImageVisualTestingService implements VisualTestingService\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ImageVisualTestingService.class);\n+\n+    private final ImageEyesFactory eyesFactory;\n+    private final ScreenshotProvider screenshotProvider;\n+    private final IHttpClient httpClient;\n+\n+    public ImageVisualTestingService(ImageEyesFactory eyesFactory, ScreenshotProvider screenshotProvider,\n+            IHttpClient httpClient)\n+    {\n+        this.eyesFactory = eyesFactory;\n+        this.screenshotProvider = screenshotProvider;\n+        this.httpClient = httpClient;\n+    }\n+\n+    @Override\n+    public ApplitoolsVisualCheckResult run(ApplitoolsVisualCheck applitoolsVisualCheck)\n+    {\n+        Eyes eyes = eyesFactory.createEyes(applitoolsVisualCheck);\n+        TestResults testResults = null;\n+        try\n+        {\n+            eyes.open(applitoolsVisualCheck.getAppName(), applitoolsVisualCheck.getBaselineName());\n+            eyes.checkImage(screenshotProvider.take(applitoolsVisualCheck).getImage());\n+        }\n+        finally\n+        {\n+            testResults = eyes.close(false);\n+        }\n+        return createVisualCheckResult(testResults, applitoolsVisualCheck);\n+    }\n+\n+    private ApplitoolsVisualCheckResult createVisualCheckResult(TestResults testResults,\n+            ApplitoolsVisualCheck applitoolsVisualCheck)\n+    {\n+        ApplitoolsVisualCheckResult visualCheckResult = new ApplitoolsVisualCheckResult(applitoolsVisualCheck);\n+        visualCheckResult.setBatchUrl(testResults.getUrl());\n+        visualCheckResult.setPassed(testResults.isPassed());\n+        StepInfo stepInfo = testResults.getStepsInfo()[0];\n+        visualCheckResult.setStepUrl(stepInfo.getAppUrls().getStepEditor());\n+        setImages(applitoolsVisualCheck.getReadApiKey(), visualCheckResult, stepInfo);\n+        return visualCheckResult;\n+    }\n+\n+    private void setImages(String readKey, ApplitoolsVisualCheckResult visualCheckResult, StepInfo stepInfo)\n+    {\n+        ApiUrls apiUrls = stepInfo.getApiUrls();\n+        visualCheckResult.setBaseline(getImageAsBase64(apiUrls.getBaselineImage(), readKey));\n+        visualCheckResult.setCheckpoint(getImageAsBase64(apiUrls.getCheckpointImage(), readKey));\n+        visualCheckResult.setDiff(getImageAsBase64(apiUrls.getDiffImage(), readKey));\n+    }\n+\n+    private String getImageAsBase64(String url, String readKey)\n+    {\n+        if (url != null)\n+        {\n+            URI imageUrl = URI.create(addKeyToUrl(url, readKey));\n+            try\n+            {\n+                HttpResponse response = httpClient.doHttpGet(imageUrl);", "originalCommit": "8f281c1eac669fe9d8876f0bdc5875d3e36e3f6c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTExNTUzNA==", "url": "https://github.com/vividus-framework/vividus/pull/354#discussion_r389115534", "bodyText": "Since it requires some refactoring -> change aspect based solution to the interceptors based, can we introduce it as a separate PR? I believe this case also not covered in resource checking steps; So it might require even more changes", "author": "ikalinin1", "createdAt": "2020-03-06T19:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4MDgxMw=="}], "type": "inlineReview"}, {"oid": "aff6bfd2e856b70bb2415e52bee3016aa873264e", "url": "https://github.com/vividus-framework/vividus/commit/aff6bfd2e856b70bb2415e52bee3016aa873264e", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-06T19:57:00Z", "type": "forcePushed"}, {"oid": "ad124d97aeaf7e6d7775e3679ddd16a51ad6971b", "url": "https://github.com/vividus-framework/vividus/commit/ad124d97aeaf7e6d7775e3679ddd16a51ad6971b", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-06T20:01:43Z", "type": "forcePushed"}, {"oid": "64883dc89457e8617335c2c9843935fec8d288cc", "url": "https://github.com/vividus-framework/vividus/commit/64883dc89457e8617335c2c9843935fec8d288cc", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-07T08:53:14Z", "type": "forcePushed"}, {"oid": "ebbdc27831b0be2fb2749b778bd40d599cb22e7c", "url": "https://github.com/vividus-framework/vividus/commit/ebbdc27831b0be2fb2749b778bd40d599cb22e7c", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-09T07:14:48Z", "type": "forcePushed"}, {"oid": "e975769d9ddbce1f1b53d614d56cdd970c60c339", "url": "https://github.com/vividus-framework/vividus/commit/e975769d9ddbce1f1b53d614d56cdd970c60c339", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-09T07:24:28Z", "type": "forcePushed"}, {"oid": "576a048178fd944c4f1bd7c02f67968b8b9da173", "url": "https://github.com/vividus-framework/vividus/commit/576a048178fd944c4f1bd7c02f67968b8b9da173", "message": "Increase Metaspace task for gradle build", "committedDate": "2020-03-09T09:24:24Z", "type": "forcePushed"}, {"oid": "9e4580e18f00766bde6411cfce733c2e5cf54425", "url": "https://github.com/vividus-framework/vividus/commit/9e4580e18f00766bde6411cfce733c2e5cf54425", "message": "[vividus-plugin-applitools] Intorduce Vividus Applitools plugin", "committedDate": "2020-03-09T09:54:07Z", "type": "commit"}, {"oid": "6ab0202e83d003c9c26e1a58ac33089b4f17711a", "url": "https://github.com/vividus-framework/vividus/commit/6ab0202e83d003c9c26e1a58ac33089b4f17711a", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-09T09:54:07Z", "type": "commit"}, {"oid": "6ab0202e83d003c9c26e1a58ac33089b4f17711a", "url": "https://github.com/vividus-framework/vividus/commit/6ab0202e83d003c9c26e1a58ac33089b4f17711a", "message": "Cover Applitools plugin with system tests", "committedDate": "2020-03-09T09:54:07Z", "type": "forcePushed"}]}