{"pr_number": 489, "pr_title": "Mobile app support", "pr_createdAt": "2020-04-17T18:29:08Z", "pr_url": "https://github.com/vividus-framework/vividus/pull/489", "timeline": [{"oid": "5c28d62c8ba3e1b636fd13718d93c7ad44bccddc", "url": "https://github.com/vividus-framework/vividus/commit/5c28d62c8ba3e1b636fd13718d93c7ad44bccddc", "message": "check build", "committedDate": "2020-04-17T18:43:10Z", "type": "forcePushed"}, {"oid": "759fbad018a4bf37383e4b4a255e92c1f5fc9405", "url": "https://github.com/vividus-framework/vividus/commit/759fbad018a4bf37383e4b4a255e92c1f5fc9405", "message": "check build", "committedDate": "2020-04-17T21:00:13Z", "type": "forcePushed"}, {"oid": "679e5200d857e7397e1570563aaabf58845be145", "url": "https://github.com/vividus-framework/vividus/commit/679e5200d857e7397e1570563aaabf58845be145", "message": "check build", "committedDate": "2020-07-01T15:31:38Z", "type": "forcePushed"}, {"oid": "a6bbce20b59af92569ae410a326bf1cfb21ddd94", "url": "https://github.com/vividus-framework/vividus/commit/a6bbce20b59af92569ae410a326bf1cfb21ddd94", "message": "check build", "committedDate": "2020-07-01T16:02:59Z", "type": "forcePushed"}, {"oid": "e8847fcba5bed4f262a9d03af00b5b8a0f4c6ad9", "url": "https://github.com/vividus-framework/vividus/commit/e8847fcba5bed4f262a9d03af00b5b8a0f4c6ad9", "message": "Mobile app support", "committedDate": "2020-07-03T11:58:36Z", "type": "forcePushed"}, {"oid": "497ee7e0c3cd4912299e58b45af02ca1dcbd7556", "url": "https://github.com/vividus-framework/vividus/commit/497ee7e0c3cd4912299e58b45af02ca1dcbd7556", "message": "Mobile app support", "committedDate": "2020-07-03T14:49:28Z", "type": "forcePushed"}, {"oid": "3cfe48a4a0b1449a1a0f531da7ee86e399c15dff", "url": "https://github.com/vividus-framework/vividus/commit/3cfe48a4a0b1449a1a0f531da7ee86e399c15dff", "message": "Mobile app support", "committedDate": "2020-07-06T08:26:52Z", "type": "forcePushed"}, {"oid": "8401ee25f3da11d1decd197d21aeeac774af5fc8", "url": "https://github.com/vividus-framework/vividus/commit/8401ee25f3da11d1decd197d21aeeac774af5fc8", "message": "Mobile app support", "committedDate": "2020-07-06T08:55:15Z", "type": "forcePushed"}, {"oid": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "url": "https://github.com/vividus-framework/vividus/commit/dc8988a150f443f550d9ca492cb0d25ec2d5d415", "message": "Mobile app support", "committedDate": "2020-07-06T09:19:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE3NzIyOA==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450177228", "bodyText": "AbstractVividusDriverFactory -> AbstractVividusWebDriverFactory", "author": "valfirst", "createdAt": "2020-07-06T12:10:46Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/AbstractVividusDriverFactory.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.selenium;\n+\n+import org.jbehave.core.model.Meta;\n+import org.jbehave.core.model.Scenario;\n+import org.jbehave.core.model.Story;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.vividus.bdd.context.IBddRunContext;\n+import org.vividus.bdd.model.MetaWrapper;\n+import org.vividus.bdd.model.RunningStory;\n+import org.vividus.selenium.manager.IWebDriverManagerContext;\n+import org.vividus.selenium.manager.WebDriverManagerParameter;\n+\n+public abstract class AbstractVividusDriverFactory implements IVividusDriverFactory", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE3ODAwMw==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450178003", "bodyText": "DriverFactory -> WebDriverFactory", "author": "valfirst", "createdAt": "2020-07-06T12:12:19Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/DriverFactory.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.selenium;\n+\n+import static java.util.stream.Collectors.toMap;\n+import static org.apache.commons.lang3.StringUtils.equalsAnyIgnoreCase;\n+\n+import java.net.URL;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import com.google.common.base.Suppliers;\n+import com.google.common.cache.CacheBuilder;\n+import com.google.common.cache.CacheLoader;\n+import com.google.common.cache.LoadingCache;\n+\n+import org.openqa.selenium.HasCapabilities;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.vividus.selenium.driver.TextFormattingWebDriver;\n+import org.vividus.util.json.JsonUtils;\n+import org.vividus.util.property.IPropertyParser;\n+\n+public class DriverFactory implements IDriverFactory", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4MDM0Ng==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450180346", "bodyText": "I recommend to make this method abstract and keep empty implementation in child classes", "author": "valfirst", "createdAt": "2020-07-06T12:16:49Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/DriverFactory.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.selenium;\n+\n+import static java.util.stream.Collectors.toMap;\n+import static org.apache.commons.lang3.StringUtils.equalsAnyIgnoreCase;\n+\n+import java.net.URL;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import com.google.common.base.Suppliers;\n+import com.google.common.cache.CacheBuilder;\n+import com.google.common.cache.CacheLoader;\n+import com.google.common.cache.LoadingCache;\n+\n+import org.openqa.selenium.HasCapabilities;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.vividus.selenium.driver.TextFormattingWebDriver;\n+import org.vividus.util.json.JsonUtils;\n+import org.vividus.util.property.IPropertyParser;\n+\n+public class DriverFactory implements IDriverFactory\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(DriverFactory.class);\n+\n+    private static final String SELENIUM_GRID_PROPERTY_PREFIX = \"selenium.grid.capabilities.\";\n+    private static final String LOCAL_DRIVER_PROPERTY_PREFIX = \"selenium.capabilities.\";\n+\n+    private final IRemoteWebDriverFactory remoteWebDriverFactory;\n+    private final IPropertyParser propertyParser;\n+    private final JsonUtils jsonUtils;\n+\n+    private URL remoteDriverUrl;\n+\n+    private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX));\n+\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByPrefix(LOCAL_DRIVER_PROPERTY_PREFIX));\n+\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                @Override\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (Boolean.TRUE.equals(local))\n+                    {\n+                        return localCapabilities;\n+                    }\n+                    return merge(localCapabilities, seleniumGridDesiredCapabilities.get());\n+                }\n+            });\n+\n+    public DriverFactory(IRemoteWebDriverFactory remoteWebDriverFactory, IPropertyParser propertyParser,\n+            JsonUtils jsonUtils)\n+    {\n+        this.remoteWebDriverFactory = remoteWebDriverFactory;\n+        this.propertyParser = propertyParser;\n+        this.jsonUtils = jsonUtils;\n+    }\n+\n+    private DesiredCapabilities getCapabilitiesByPrefix(String prefix)\n+    {\n+        return propertyParser.getPropertyValuesTreeByPrefix(prefix)\n+            .entrySet()\n+            .stream()\n+            .map(e -> isBoolean(e.getValue())\n+                ? Map.entry(e.getKey(), Boolean.parseBoolean((String) e.getValue()))\n+                : e)\n+            .collect(Collectors.collectingAndThen(toMap(Entry::getKey, Entry::getValue), DesiredCapabilities::new));\n+    }\n+\n+    private boolean isBoolean(Object value)\n+    {\n+        return value instanceof String && equalsAnyIgnoreCase((String) value, \"true\", \"false\");\n+    }\n+\n+    @Override\n+    public WebDriver getRemoteWebDriver(DesiredCapabilities desiredCapabilities)\n+    {\n+        DesiredCapabilities mergedDesiredCapabilities = getWebDriverCapabilities(false, desiredCapabilities);\n+        return createWebDriver(remoteWebDriverFactory.getRemoteWebDriver(remoteDriverUrl,\n+                updateDesiredCapabilities(mergedDesiredCapabilities)));\n+    }\n+\n+    protected WebDriver createWebDriver(WebDriver webDriver)\n+    {\n+        WebDriver driver = new TextFormattingWebDriver(webDriver);\n+        configureWebDriver(driver);\n+\n+        LOGGER.atInfo()\n+              .addArgument(() -> jsonUtils\n+                      .toPrettyJson(WebDriverUtil.unwrap(driver, HasCapabilities.class).getCapabilities().asMap()))\n+              .log(\"Session capabilities:\\n{}\");\n+        return driver;\n+    }\n+\n+    protected DesiredCapabilities updateDesiredCapabilities(DesiredCapabilities desiredCapabilities)\n+    {\n+        return desiredCapabilities;\n+    }\n+\n+    protected void configureWebDriver(WebDriver webDriver)", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NjEzNg==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450186136", "bodyText": "Given(\"I start mobile application located at $location\")?\nWhy are capabilities needed?", "author": "valfirst", "createdAt": "2020-07-06T12:28:17Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/bdd/steps/ApplicationSteps.java", "diffHunk": "@@ -0,0 +1,58 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.mobileapp.bdd.steps;\n+\n+import java.util.List;\n+\n+import org.jbehave.core.annotations.Given;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.vividus.mobileapp.bdd.model.DesiredCapability;\n+import org.vividus.selenium.IWebDriverProvider;\n+import org.vividus.selenium.SauceLabsCapabilityType;\n+import org.vividus.selenium.manager.IWebDriverManagerContext;\n+import org.vividus.selenium.manager.WebDriverManagerParameter;\n+\n+import io.appium.java_client.HasSessionDetails;\n+\n+public class ApplicationSteps\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(ApplicationSteps.class);\n+\n+    private final IWebDriverProvider webDriverProvider;\n+    private final IWebDriverManagerContext webDriverManagerContext;\n+\n+    public ApplicationSteps(IWebDriverProvider webDriverProvider, IWebDriverManagerContext webDriverManagerContext)\n+    {\n+        this.webDriverProvider = webDriverProvider;\n+        this.webDriverManagerContext = webDriverManagerContext;\n+    }\n+\n+    @Given(\"I run the application located at `$location` and capabilities:$capabilities\")", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM4MDczMQ==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450380731", "bodyText": "Although we have an opportunity to set desired capabilities thorough meta at story level, by setting desired capabilities at step level we could use it in conjunction with lifecycle ET to run the same story several times on different devices\nImho this is more clear way to setup properties than at meta level", "author": "uarlouski", "createdAt": "2020-07-06T17:41:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NjEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5MzU3MQ==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450393571", "bodyText": "would not it better to name it\nGiven I start mobile application with capabilities: capabilities\n?", "author": "uarlouski", "createdAt": "2020-07-06T18:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE4NjEzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5MjM3Mg==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450192372", "bodyText": "I think we'll remove SauceLabsCapabilityType.java at some point, so I don't recommend to keep using it", "author": "valfirst", "createdAt": "2020-07-06T12:40:25Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/SauceLabsCapabilityType.java", "diffHunk": "@@ -28,4 +28,5 @@\n     String DEVICE = \"device\";\n     String CAPABILITIES = \"capabilities\";\n     String SELENIUM_VERSION = \"seleniumVersion\";\n+    String APP = \"app\";", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5MjczMQ==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450192731", "bodyText": "there are both setter and @Inject, something is redundant", "author": "valfirst", "createdAt": "2020-07-06T12:41:08Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/WebDriverProvider.java", "diffHunk": "@@ -23,16 +23,16 @@\n import com.google.common.eventbus.EventBus;\n \n import org.openqa.selenium.WebDriver;\n+import org.vividus.selenium.event.WebDriverCreateEvent;\n+import org.vividus.selenium.event.WebDriverQuitEvent;\n import org.vividus.testcontext.TestContext;\n-import org.vividus.ui.web.event.WebDriverCreateEvent;\n-import org.vividus.ui.web.event.WebDriverQuitEvent;\n \n public class WebDriverProvider implements IWebDriverProvider\n {\n-    private IVividusWebDriverFactory vividusWebDriverFactory;\n+    @Inject private IVividusDriverFactory vividusWebDriverFactory;", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5Mjk5MA==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450192990", "bodyText": "DESIRED_CAPABILITIES_KEY", "author": "valfirst", "createdAt": "2020-07-06T12:41:38Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/manager/DriverManager.java", "diffHunk": "@@ -0,0 +1,285 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.selenium.manager;\n+\n+import java.util.Map;\n+import java.util.Set;\n+import java.util.function.BooleanSupplier;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.stream.Stream;\n+\n+import javax.inject.Inject;\n+\n+import org.openqa.selenium.Capabilities;\n+import org.openqa.selenium.ContextAware;\n+import org.openqa.selenium.Dimension;\n+import org.openqa.selenium.HasCapabilities;\n+import org.openqa.selenium.Platform;\n+import org.openqa.selenium.Rotatable;\n+import org.openqa.selenium.ScreenOrientation;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.remote.BrowserType;\n+import org.openqa.selenium.remote.CapabilityType;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.vividus.selenium.IWebDriverProvider;\n+import org.vividus.selenium.SauceLabsCapabilityType;\n+import org.vividus.selenium.WebDriverUtil;\n+\n+import io.appium.java_client.MobileDriver;\n+import io.appium.java_client.MobileElement;\n+import io.appium.java_client.remote.MobilePlatform;\n+\n+public class DriverManager implements IDriverManager\n+{\n+    private static final String DESIREDCAPABILITIES_KEY = \"desired\";", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5NDE0Mw==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450194143", "bodyText": "org.vividus.selenium.mobileapp the same for all other similar places", "author": "valfirst", "createdAt": "2020-07-06T12:43:52Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/selenium/VividusMobileAppDriverFactory.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.mobileapp.selenium;", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDE5NDU5NA==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r450194594", "bodyText": "NAME - is SL specific capability, I don't think we should use it in generic modules", "author": "valfirst", "createdAt": "2020-07-06T12:44:43Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/mobileapp/selenium/VividusMobileAppDriverFactory.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.mobileapp.selenium;\n+\n+import org.jbehave.core.model.Scenario;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.vividus.bdd.context.IBddRunContext;\n+import org.vividus.bdd.model.MetaWrapper;\n+import org.vividus.bdd.model.RunningStory;\n+import org.vividus.selenium.AbstractVividusDriverFactory;\n+import org.vividus.selenium.IDriverFactory;\n+import org.vividus.selenium.SauceLabsCapabilityType;\n+import org.vividus.selenium.VividusWebDriver;\n+import org.vividus.selenium.manager.IWebDriverManagerContext;\n+\n+public class VividusMobileAppDriverFactory extends AbstractVividusDriverFactory\n+{\n+    private final IDriverFactory driverFactory;\n+\n+    public VividusMobileAppDriverFactory(IBddRunContext bddRunContext, IWebDriverManagerContext webDriverManagerContext,\n+            IDriverFactory driverFactory)\n+    {\n+        super(bddRunContext, webDriverManagerContext);\n+        this.driverFactory = driverFactory;\n+    }\n+\n+    @Override\n+    protected void configureVividusWebDriver(VividusWebDriver vividusWebDriver)\n+    {\n+        DesiredCapabilities capabilities = vividusWebDriver.getDesiredCapabilities();\n+        vividusWebDriver.setWebDriver(driverFactory.getRemoteWebDriver(capabilities));\n+        vividusWebDriver.setRemote(false);\n+    }\n+\n+    @Override\n+    protected void setDesiredCapabilities(DesiredCapabilities desiredCapabilities, RunningStory runningStory,\n+            Scenario scenario, MetaWrapper metaWrapper)\n+    {\n+        desiredCapabilities.setCapability(SauceLabsCapabilityType.NAME, runningStory.getName());", "originalCommit": "dc8988a150f443f550d9ca492cb0d25ec2d5d415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8be748cee581e3db27a66a64c88d5edfc5551d5f", "url": "https://github.com/vividus-framework/vividus/commit/8be748cee581e3db27a66a64c88d5edfc5551d5f", "message": "Fix comments [1]", "committedDate": "2020-07-07T11:46:12Z", "type": "forcePushed"}, {"oid": "fee7530497b90fdc8c5dd589cd10660f2cc2a1eb", "url": "https://github.com/vividus-framework/vividus/commit/fee7530497b90fdc8c5dd589cd10660f2cc2a1eb", "message": "Mobile app support", "committedDate": "2020-07-10T11:18:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU0NzQ4OQ==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r453547489", "bodyText": "don't you mind to align it with getPropertyValuesTreeByPrefix?", "author": "ikalinin1", "createdAt": "2020-07-13T10:18:58Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/AbstractWebDriverFactory.java", "diffHunk": "@@ -0,0 +1,175 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.selenium;\n+\n+import static java.util.stream.Collectors.toMap;\n+import static org.apache.commons.lang3.StringUtils.equalsAnyIgnoreCase;\n+\n+import java.net.URL;\n+import java.util.HashMap;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.function.Supplier;\n+import java.util.stream.Collectors;\n+\n+import com.google.common.base.Suppliers;\n+import com.google.common.cache.CacheBuilder;\n+import com.google.common.cache.CacheLoader;\n+import com.google.common.cache.LoadingCache;\n+\n+import org.openqa.selenium.HasCapabilities;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.remote.DesiredCapabilities;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.vividus.selenium.driver.TextFormattingWebDriver;\n+import org.vividus.util.json.JsonUtils;\n+import org.vividus.util.property.IPropertyParser;\n+\n+public abstract class AbstractWebDriverFactory implements IGenericWebDriverFactory\n+{\n+    private static final Logger LOGGER = LoggerFactory.getLogger(AbstractWebDriverFactory.class);\n+\n+    private static final String SELENIUM_GRID_PROPERTY_PREFIX = \"selenium.grid.capabilities.\";\n+    private static final String LOCAL_DRIVER_PROPERTY_PREFIX = \"selenium.capabilities.\";\n+\n+    private final IRemoteWebDriverFactory remoteWebDriverFactory;\n+    private final IPropertyParser propertyParser;\n+    private final JsonUtils jsonUtils;\n+\n+    private URL remoteDriverUrl;\n+\n+    private final Supplier<DesiredCapabilities> seleniumGridDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByPrefix(SELENIUM_GRID_PROPERTY_PREFIX));\n+\n+    private final Supplier<DesiredCapabilities> localDriverDesiredCapabilities = Suppliers.memoize(\n+        () -> getCapabilitiesByPrefix(LOCAL_DRIVER_PROPERTY_PREFIX));\n+\n+    private final LoadingCache<Boolean, DesiredCapabilities> webDriverCapabilities = CacheBuilder.newBuilder()\n+            .build(new CacheLoader<Boolean, DesiredCapabilities>()\n+            {\n+                @Override\n+                public DesiredCapabilities load(Boolean local)\n+                {\n+                    DesiredCapabilities localCapabilities = localDriverDesiredCapabilities.get();\n+                    if (Boolean.TRUE.equals(local))\n+                    {\n+                        return localCapabilities;\n+                    }\n+                    return merge(localCapabilities, seleniumGridDesiredCapabilities.get());\n+                }\n+            });\n+\n+    public AbstractWebDriverFactory(IRemoteWebDriverFactory remoteWebDriverFactory, IPropertyParser propertyParser,\n+            JsonUtils jsonUtils)\n+    {\n+        this.remoteWebDriverFactory = remoteWebDriverFactory;\n+        this.propertyParser = propertyParser;\n+        this.jsonUtils = jsonUtils;\n+    }\n+\n+    private DesiredCapabilities getCapabilitiesByPrefix(String prefix)\n+    {\n+        return propertyParser.getPropertyValuesTreeByPrefix(prefix)\n+            .entrySet()", "originalCommit": "fee7530497b90fdc8c5dd589cd10660f2cc2a1eb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU0ODc4Mw==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r453548783", "bodyText": "Why it can't be part of mobile-app plugin?\nIf you starting web profile you will have RemoteDriverFactory if you starting the mobile app profile you will have an available factory for ios/android", "author": "ikalinin1", "createdAt": "2020-07-13T10:21:24Z", "path": "vividus-extension-selenium/src/main/java/org/vividus/selenium/RemoteWebDriverFactory.java", "diffHunk": "@@ -30,11 +30,11 @@\n     @Override\n     public RemoteWebDriver getRemoteWebDriver(URL url, Capabilities capabilities)\n     {\n-        if (WebDriverManager.isIOS(capabilities))\n+        if (GenericWebDriverManager.isIOS(capabilities))", "originalCommit": "fee7530497b90fdc8c5dd589cd10660f2cc2a1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTYyNDI0Mg==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r455624242", "bodyText": "Discussed privately", "author": "uarlouski", "createdAt": "2020-07-16T08:43:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU0ODc4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU1MTcyMw==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r453551723", "bodyText": "why it is necessary?", "author": "ikalinin1", "createdAt": "2020-07-13T10:26:44Z", "path": "vividus-plugin-applitools/src/main/java/org/vividus/bdd/converter/ExamplesTableToApplitoolsVisualChecksConverter.java", "diffHunk": "@@ -20,15 +20,12 @@\n import java.util.List;\n import java.util.stream.Collectors;\n \n-import javax.inject.Named;\n-\n import org.apache.commons.lang3.Validate;\n import org.jbehave.core.model.ExamplesTable;\n import org.jbehave.core.steps.ParameterConverters.AbstractChainableParameterConverter;\n import org.vividus.visual.eyes.factory.ApplitoolsVisualCheckFactory;\n import org.vividus.visual.eyes.model.ApplitoolsVisualCheck;\n \n-@Named", "originalCommit": "fee7530497b90fdc8c5dd589cd10660f2cc2a1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0NTY0Mw==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r455145643", "bodyText": "due to @nAmed and generic package that we scan converters are loaded regardless of the current profile, so when we start up mobile_app profile this converter is registered as a bean, but since it has dependencies on beans from web profile, the spring context startup fails", "author": "uarlouski", "createdAt": "2020-07-15T15:35:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU1MTcyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU1Mzk4NA==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r453553984", "bodyText": "why not name?\nDesiredCapability capability = new DC...;\ncapability.setName() vs capability.setCapabilityName()", "author": "ikalinin1", "createdAt": "2020-07-13T10:30:56Z", "path": "vividus-plugin-mobile-app/src/main/java/org/vividus/bdd/mobileapp/model/DesiredCapability.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * Copyright 2019-2020 the original author or authors.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.vividus.bdd.mobileapp.model;\n+\n+import org.jbehave.core.annotations.AsParameters;\n+\n+@AsParameters\n+public class DesiredCapability\n+{\n+    private String capabilityName;", "originalCommit": "fee7530497b90fdc8c5dd589cd10660f2cc2a1eb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU1NDE2OQ==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r453554169", "bodyText": "It's like\nList.getListSize()", "author": "ikalinin1", "createdAt": "2020-07-13T10:31:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU1Mzk4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTE0OTEwNg==", "url": "https://github.com/vividus-framework/vividus/pull/489#discussion_r455149106", "bodyText": "followed the same name as declared in DesiredCapabilities class", "author": "uarlouski", "createdAt": "2020-07-15T15:40:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzU1Mzk4NA=="}], "type": "inlineReview"}, {"oid": "24e9f741c870c2650cc6ba41c2d8063ffb015e88", "url": "https://github.com/vividus-framework/vividus/commit/24e9f741c870c2650cc6ba41c2d8063ffb015e88", "message": "Mobile app support", "committedDate": "2020-07-16T08:39:14Z", "type": "forcePushed"}, {"oid": "3b5522fdaebd8d5c49b7160d7231076764db8dc2", "url": "https://github.com/vividus-framework/vividus/commit/3b5522fdaebd8d5c49b7160d7231076764db8dc2", "message": "Mobile app support", "committedDate": "2020-07-16T08:55:10Z", "type": "forcePushed"}, {"oid": "c17c42ca867f7e683e09955836e9c27d2673682c", "url": "https://github.com/vividus-framework/vividus/commit/c17c42ca867f7e683e09955836e9c27d2673682c", "message": "Mobile app support", "committedDate": "2020-07-16T08:59:11Z", "type": "forcePushed"}, {"oid": "c42ae38caf1b6cacfb4e10aace7c1ba4ff0fe4fd", "url": "https://github.com/vividus-framework/vividus/commit/c42ae38caf1b6cacfb4e10aace7c1ba4ff0fe4fd", "message": "Mobile app support", "committedDate": "2020-07-16T10:29:30Z", "type": "forcePushed"}, {"oid": "c07f568165a4e7c21c59091e9eb2a23ca55f6d35", "url": "https://github.com/vividus-framework/vividus/commit/c07f568165a4e7c21c59091e9eb2a23ca55f6d35", "message": "Mobile app support", "committedDate": "2020-07-22T19:46:29Z", "type": "commit"}, {"oid": "c07f568165a4e7c21c59091e9eb2a23ca55f6d35", "url": "https://github.com/vividus-framework/vividus/commit/c07f568165a4e7c21c59091e9eb2a23ca55f6d35", "message": "Mobile app support", "committedDate": "2020-07-22T19:46:29Z", "type": "forcePushed"}]}