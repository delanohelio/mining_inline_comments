{"pr_number": 743, "pr_title": "feat(engine): set removal time to authorization on creation", "pr_createdAt": "2020-03-19T14:43:13Z", "pr_url": "https://github.com/camunda/camunda-bpm-platform/pull/743", "timeline": [{"oid": "04bd1a280714a158452d1dc13e4be4b2575b5e8d", "url": "https://github.com/camunda/camunda-bpm-platform/commit/04bd1a280714a158452d1dc13e4be4b2575b5e8d", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-20T14:52:23Z", "type": "forcePushed"}, {"oid": "5854b7d876c5eb3274b44147c1eb9695a6770fc1", "url": "https://github.com/camunda/camunda-bpm-platform/commit/5854b7d876c5eb3274b44147c1eb9695a6770fc1", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-23T17:27:19Z", "type": "forcePushed"}, {"oid": "d070123bf4d2c45cef52e19afc747fd885cfae35", "url": "https://github.com/camunda/camunda-bpm-platform/commit/d070123bf4d2c45cef52e19afc747fd885cfae35", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-24T10:35:59Z", "type": "forcePushed"}, {"oid": "f0d39dbd7a896c5b3c5a57a13a7bcab067745164", "url": "https://github.com/camunda/camunda-bpm-platform/commit/f0d39dbd7a896c5b3c5a57a13a7bcab067745164", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-25T16:58:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1NDg0Nw==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/743#discussion_r399154847", "bodyText": "Why does this use a supplier as the method parameter? The first thing the method does is call #get.", "author": "ThorbenLindhauer", "createdAt": "2020-03-27T10:04:08Z", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/SaveAuthorizationCmd.java", "diffHunk": "@@ -50,6 +56,10 @@ public Authorization execute(CommandContext commandContext) {\n \n     authorizationManager.validateResourceCompatibility(authorization);\n \n+    if (isHistoricTaskInstanceResource()) {\n+      provideRemovalTime(() -> getHistoricTaskInstance(commandContext));", "originalCommit": "f0d39dbd7a896c5b3c5a57a13a7bcab067745164", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2NTIxOA==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/743#discussion_r399165218", "bodyText": "This is to resuse the provideRemovalTime method when tackling the Historic Process Instance feature.", "author": "tasso94", "createdAt": "2020-03-27T10:22:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1NDg0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE4NzM4OQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/743#discussion_r399187389", "bodyText": "Not sure I can follow. Couldn't the historic process instance feature also just pass a HistoryEvent to the method?", "author": "ThorbenLindhauer", "createdAt": "2020-03-27T11:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1NDg0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE5MzY3Ng==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/743#discussion_r399193676", "bodyText": "You are right! Might be a left over from an intermediate implementation state.", "author": "tasso94", "createdAt": "2020-03-27T11:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1NDg0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1NTQ4Nw==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/743#discussion_r399155487", "bodyText": "We can also skip the query if the resourceId is *", "author": "ThorbenLindhauer", "createdAt": "2020-03-27T10:05:18Z", "path": "engine/src/main/java/org/camunda/bpm/engine/impl/cmd/SaveAuthorizationCmd.java", "diffHunk": "@@ -65,4 +75,36 @@ public Authorization execute(CommandContext commandContext) {\n     return authorization;\n   }\n \n+  protected void provideRemovalTime(Supplier<HistoryEvent> supplier) {\n+    HistoryEvent historicInstance = supplier.get();\n+\n+    if (historicInstance != null) {\n+      String rootProcessInstanceId = historicInstance.getRootProcessInstanceId();\n+      authorization.setRootProcessInstanceId(rootProcessInstanceId);\n+\n+      Date removalTime = historicInstance.getRemovalTime();\n+      authorization.setRemovalTime(removalTime);\n+\n+    } else { // reset\n+      authorization.setRootProcessInstanceId(null);\n+      authorization.setRemovalTime(null);\n+\n+    }\n+  }\n+\n+  protected HistoryEvent getHistoricTaskInstance(CommandContext commandContext) {\n+    String historicTaskInstanceId = authorization.getResourceId();\n+\n+    if (historicTaskInstanceId == null) {", "originalCommit": "f0d39dbd7a896c5b3c5a57a13a7bcab067745164", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE2NTQxOQ==", "url": "https://github.com/camunda/camunda-bpm-platform/pull/743#discussion_r399165419", "bodyText": "\ud83d\udc4d", "author": "tasso94", "createdAt": "2020-03-27T10:23:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTE1NTQ4Nw=="}], "type": "inlineReview"}, {"oid": "690fcd719220ead190169a43af038579a185e112", "url": "https://github.com/camunda/camunda-bpm-platform/commit/690fcd719220ead190169a43af038579a185e112", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-30T13:30:53Z", "type": "forcePushed"}, {"oid": "832c3a1c894a5e739a7399f9c68ec70302900745", "url": "https://github.com/camunda/camunda-bpm-platform/commit/832c3a1c894a5e739a7399f9c68ec70302900745", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-31T07:29:00Z", "type": "forcePushed"}, {"oid": "00ba6e0343c4c03d20af3a1afb90ebdcf415adec", "url": "https://github.com/camunda/camunda-bpm-platform/commit/00ba6e0343c4c03d20af3a1afb90ebdcf415adec", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-31T11:45:54Z", "type": "commit"}, {"oid": "00ba6e0343c4c03d20af3a1afb90ebdcf415adec", "url": "https://github.com/camunda/camunda-bpm-platform/commit/00ba6e0343c4c03d20af3a1afb90ebdcf415adec", "message": "feat(engine): set removal time to authorization on creation\n\nrelated to CAM-11617", "committedDate": "2020-03-31T11:45:54Z", "type": "forcePushed"}]}