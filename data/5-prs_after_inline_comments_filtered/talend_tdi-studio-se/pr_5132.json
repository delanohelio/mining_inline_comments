{"pr_number": 5132, "pr_title": "TalendExcel: read password protected files.", "pr_createdAt": "2020-08-25T11:56:06Z", "pr_url": "https://github.com/Talend/tdi-studio-se/pull/5132", "timeline": [{"oid": "095e7b0a94e6530931a37acfddddd3575cb7e569", "url": "https://github.com/Talend/tdi-studio-se/commit/095e7b0a94e6530931a37acfddddd3575cb7e569", "message": "fix(TDI-44743): read password protected files.", "committedDate": "2020-08-25T11:50:44Z", "type": "commit"}, {"oid": "ca1394890dc637f0ebcec7c4d9979569b9a78a64", "url": "https://github.com/Talend/tdi-studio-se/commit/ca1394890dc637f0ebcec7c4d9979569b9a78a64", "message": "fix(TDI-44743): use new library.", "committedDate": "2020-08-25T12:27:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYxODk4Mw==", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#discussion_r476618983", "bodyText": "IMO plain old Incorrect password would be better", "author": "dmytro-sylaiev", "createdAt": "2020-08-25T17:27:54Z", "path": "main/plugins/org.talend.designer.components.libs/libs_src/talendExcel/src/main/java/org/talend/ExcelTool.java", "diffHunk": "@@ -185,10 +191,27 @@ public int getStartRow() {\n     }\r\n \r\n     private void initPreXlsx(String fileName) throws Exception {\r\n-        InputStream preIns = new FileInputStream(fileName);\r\n-        preWb = WorkbookFactory.create(preIns);\r\n+        if(password == null) {\r\n+            InputStream preIns = new FileInputStream(fileName);\r\n+            preWb = WorkbookFactory.create(preIns);\r\n+        } else {\r\n+            preWb = readEncryptedFile(fileName);\r\n+        }\r\n         preSheet = preWb.getSheet(sheetName);\r\n     }\r\n+    \r\n+    private Workbook readEncryptedFile(String fileName)\r\n+            throws IOException, GeneralSecurityException {\r\n+        InputStream inp = new FileInputStream(fileName);\r\n+        POIFSFileSystem fs = new POIFSFileSystem(inp);\r\n+        EncryptionInfo info = new EncryptionInfo(fs);\r\n+        Decryptor decryptor = Decryptor.getInstance(info);\r\n+        if (!decryptor.verifyPassword(password)) {\r\n+            throw new GeneralSecurityException(\"Error: Wrong password provided!\");\r", "originalCommit": "ca1394890dc637f0ebcec7c4d9979569b9a78a64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYzMTY2Ng==", "url": "https://github.com/Talend/tdi-studio-se/pull/5132#discussion_r476631666", "bodyText": "Done.", "author": "dmytrogrygorenko", "createdAt": "2020-08-25T17:49:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYxODk4Mw=="}], "type": "inlineReview"}, {"oid": "c667069c07da3d45b80e88e6896fcc481ae9be38", "url": "https://github.com/Talend/tdi-studio-se/commit/c667069c07da3d45b80e88e6896fcc481ae9be38", "message": "fix(TDI-44743): Error message changed.", "committedDate": "2020-08-25T17:48:40Z", "type": "commit"}]}