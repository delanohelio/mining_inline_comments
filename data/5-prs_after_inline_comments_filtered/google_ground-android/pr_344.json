{"pr_number": 344, "pr_title": "[Observation list] Remove form tab header", "pr_createdAt": "2020-02-03T05:52:48Z", "pr_url": "https://github.com/google/ground-android/pull/344", "timeline": [{"oid": "ee1282c21220e2fd70f2ecebbef69e4f85956d5d", "url": "https://github.com/google/ground-android/commit/ee1282c21220e2fd70f2ecebbef69e4f85956d5d", "message": "Remove form selector in feature sheet", "committedDate": "2020-02-01T14:31:54Z", "type": "commit"}, {"oid": "11836382a257535a78d57fce9486a9d5de38a4e6", "url": "https://github.com/google/ground-android/commit/11836382a257535a78d57fce9486a9d5de38a4e6", "message": "Add separator line to feature sheet", "committedDate": "2020-02-02T04:42:08Z", "type": "commit"}, {"oid": "665ebeeab3f013a4d4d8b4bf5d1b20c32497bac5", "url": "https://github.com/google/ground-android/commit/665ebeeab3f013a4d4d8b4bf5d1b20c32497bac5", "message": "Increase feature sheet header cutout size", "committedDate": "2020-02-02T04:42:45Z", "type": "commit"}, {"oid": "14976e0c7c7917ab6548c2a536fd066316dc99ff", "url": "https://github.com/google/ground-android/commit/14976e0c7c7917ab6548c2a536fd066316dc99ff", "message": "Increase feature sheet header height", "committedDate": "2020-02-02T04:43:40Z", "type": "commit"}, {"oid": "ce1604f5daf6a9b1ce2ddcf573b30b3416429751", "url": "https://github.com/google/ground-android/commit/ce1604f5daf6a9b1ce2ddcf573b30b3416429751", "message": "Set activity background color to help debugging layouts", "committedDate": "2020-02-03T03:11:48Z", "type": "commit"}, {"oid": "660df352cd682ee202caa36909cb6f2a1474b496", "url": "https://github.com/google/ground-android/commit/660df352cd682ee202caa36909cb6f2a1474b496", "message": "Delete form tab pager", "committedDate": "2020-02-03T03:12:50Z", "type": "commit"}, {"oid": "2bce2f1a5935a6165c8ff51f3272a7b1034375e8", "url": "https://github.com/google/ground-android/commit/2bce2f1a5935a6165c8ff51f3272a7b1034375e8", "message": "Reposition obs list progress spinner", "committedDate": "2020-02-03T05:38:34Z", "type": "commit"}, {"oid": "57e155e11e5427826285459f4eaad62cca98b63e", "url": "https://github.com/google/ground-android/commit/57e155e11e5427826285459f4eaad62cca98b63e", "message": "Tweak Gradle build args", "committedDate": "2020-02-03T05:39:26Z", "type": "commit"}, {"oid": "27b85d61bdcc01cb92eda043a25b0421ce1b13fb", "url": "https://github.com/google/ground-android/commit/27b85d61bdcc01cb92eda043a25b0421ce1b13fb", "message": "Fix obs list background", "committedDate": "2020-02-03T05:40:49Z", "type": "commit"}, {"oid": "125479e5bd0e5eebae1b7e35eca4041f4e0b7a3f", "url": "https://github.com/google/ground-android/commit/125479e5bd0e5eebae1b7e35eca4041f4e0b7a3f", "message": "Remove form change logic", "committedDate": "2020-02-03T06:22:49Z", "type": "commit"}, {"oid": "f0e764d73824e925d660c65874868525b3f211d9", "url": "https://github.com/google/ground-android/commit/f0e764d73824e925d660c65874868525b3f211d9", "message": "Add comment", "committedDate": "2020-02-03T06:31:35Z", "type": "commit"}, {"oid": "bb56545b594dfebafd9230fcf9d43e77f66ac524", "url": "https://github.com/google/ground-android/commit/bb56545b594dfebafd9230fcf9d43e77f66ac524", "message": "Merge branch 'master' into rm-multi-form", "committedDate": "2020-02-03T07:23:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxOTU0OA==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374319548", "bodyText": "Add TODO to show a message to the user?", "author": "scolsen", "createdAt": "2020-02-03T20:19:19Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/HomeScreenViewModel.java", "diffHunk": "@@ -148,31 +147,28 @@ public void onBottomSheetHidden() {\n     addObservationButtonVisibility.setValue(View.GONE);\n   }\n \n-  public void onFormChange(Form form) {\n-    this.selectedForm = form;\n-  }\n-\n   public void addObservation() {\n     FeatureSheetState state = featureSheetState.getValue();\n     if (state == null) {\n       Log.e(TAG, \"Missing featureSheetState\");\n       return;\n     }\n-    if (selectedForm == null) {\n-      Log.e(TAG, \"Missing form\");\n-      return;\n-    }\n     Feature feature = state.getFeature();\n     if (feature == null) {\n       Log.e(TAG, \"Missing feature\");\n       return;\n     }\n+    ImmutableList<Form> forms = feature.getLayer().getForms();\n+    if (forms.isEmpty()) {", "originalCommit": "bb56545b594dfebafd9230fcf9d43e77f66ac524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ4MTYwNQ==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374481605", "bodyText": "Added TODO to hide Add Observation button instead, since it shouldn't be shown if form is not defined (i.e., this case should never happen).", "author": "gino-m", "createdAt": "2020-02-04T05:33:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMxOTU0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyMjA3MA==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374322070", "bodyText": "This method is redundant now -- delete?", "author": "scolsen", "createdAt": "2020-02-03T20:24:47Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/featuresheet/FeatureSheetFragment.java", "diffHunk": "@@ -76,23 +69,13 @@ public View onCreateView(\n   @Override\n   public void onViewCreated(@NonNull View view, @Nullable Bundle savedInstanceState) {\n     super.onViewCreated(view, savedInstanceState);", "originalCommit": "bb56545b594dfebafd9230fcf9d43e77f66ac524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ4MDI5MA==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374480290", "bodyText": "Fixed!", "author": "gino-m", "createdAt": "2020-02-04T05:27:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyMjA3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNDM4MA==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374324380", "bodyText": "Are we eventually going to support multiple forms again, or will forms eventually become form?", "author": "scolsen", "createdAt": "2020-02-03T20:30:08Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/featuresheet/ObservationListViewModel.java", "diffHunk": "@@ -59,14 +59,22 @@ public ObservationListViewModel(ObservationRepository observationRepository) {\n   }\n \n   /** Loads a list of observations associated with a given feature. */\n-  public void loadObservationList(Feature feature, Form form) {\n+  public void loadObservationList(Feature feature) {\n+    ImmutableList<Form> forms = feature.getLayer().getForms();\n     loadObservations(\n-        feature.getProject(), feature.getLayer().getId(), form.getId(), feature.getId());\n+        feature.getProject(),\n+        forms.isEmpty() ? Optional.empty() : Optional.of(forms.get(0).getId()),", "originalCommit": "bb56545b594dfebafd9230fcf9d43e77f66ac524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ4MTgwMg==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374481802", "bodyText": "The idea is that we'll keep it in the data store schema, but not in the UIs. This way custom or future clients can use multiple forms without breaking the database.", "author": "gino-m", "createdAt": "2020-02-04T05:34:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNDM4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDczNDcyMw==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374734723", "bodyText": "Gotcha, maybe this is worthy of a helper method to make sure we always call .get(0) for now to fetch only the first form and don't accidentally call .get(0\u00b1n)? (Not that I anticipate us needing to call this in many other places in the app atm).", "author": "scolsen", "createdAt": "2020-02-04T15:19:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNDM4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDgzMjQ1OQ==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374832459", "bodyText": "I'll go you one better - pushing the cardinality change to the persistence layers, so that the application model doesn't reflect this idiosyncrasy in the data models. Please see latest commit 56cfa3d.", "author": "gino-m", "createdAt": "2020-02-04T18:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNDM4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNTY0Ng==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374325646", "bodyText": "nit: Parallelize parameter positions?\nloadObservations:: project, formId, featureId\nObservationListRequest: project, featureId, formId\nSwap feature and form in one or the other?", "author": "scolsen", "createdAt": "2020-02-03T20:33:00Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/featuresheet/ObservationListViewModel.java", "diffHunk": "@@ -76,22 +84,16 @@ public void loadObservationList(Feature feature, Form form) {\n     return Single.just(ImmutableList.of());\n   }\n \n-  private void loadObservations(Project project, String layerId, String formId, String featureId) {\n-    Optional<Form> form = project.getLayer(layerId).flatMap(pt -> pt.getForm(formId));\n-    if (!form.isPresent()) {\n-      // TODO: Show error.\n-      return;\n-    }\n-    // TODO: Use project id instead of object.\n+  private void loadObservations(Project project, Optional<String> formId, String featureId) {", "originalCommit": "bb56545b594dfebafd9230fcf9d43e77f66ac524", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDQ4MDc1Mg==", "url": "https://github.com/google/ground-android/pull/344#discussion_r374480752", "bodyText": "Good catch. Done!", "author": "gino-m", "createdAt": "2020-02-04T05:29:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDMyNTY0Ng=="}], "type": "inlineReview"}, {"oid": "f2ff242e3f65a593502804a2f59c6afd7d8fa988", "url": "https://github.com/google/ground-android/commit/f2ff242e3f65a593502804a2f59c6afd7d8fa988", "message": "Restore accidentally deleted checkCode trigger", "committedDate": "2020-02-04T05:25:56Z", "type": "commit"}, {"oid": "48ba1b763941beff0615739b64366edea6bd681a", "url": "https://github.com/google/ground-android/commit/48ba1b763941beff0615739b64366edea6bd681a", "message": "Delete redundant override", "committedDate": "2020-02-04T05:27:04Z", "type": "commit"}, {"oid": "3af513c6c790cefb67f00a5a2f66527c05158515", "url": "https://github.com/google/ground-android/commit/3af513c6c790cefb67f00a5a2f66527c05158515", "message": "Consistent order of method args", "committedDate": "2020-02-04T05:29:09Z", "type": "commit"}, {"oid": "3c0828038426b52cba476303c13f43a870431491", "url": "https://github.com/google/ground-android/commit/3c0828038426b52cba476303c13f43a870431491", "message": "Restore final newline", "committedDate": "2020-02-04T05:29:55Z", "type": "commit"}, {"oid": "66f2baa1bd9de08ffbcbbce650cf15e37afbedcd", "url": "https://github.com/google/ground-android/commit/66f2baa1bd9de08ffbcbbce650cf15e37afbedcd", "message": "Merge branch 'rm-multi-form' of https://github.com/gino-m/ground-android into rm-multi-form", "committedDate": "2020-02-04T05:30:55Z", "type": "commit"}, {"oid": "8ceaef7015953b7a3f4bd174742361a824bf27e2", "url": "https://github.com/google/ground-android/commit/8ceaef7015953b7a3f4bd174742361a824bf27e2", "message": "Add TODO", "committedDate": "2020-02-04T05:32:55Z", "type": "commit"}, {"oid": "56cfa3df66cd7312961db3633c0fd06e919750c1", "url": "https://github.com/google/ground-android/commit/56cfa3df66cd7312961db3633c0fd06e919750c1", "message": "Move support for multiple forms to persistence layers", "committedDate": "2020-02-04T18:03:15Z", "type": "commit"}, {"oid": "7f55159ad71f7ac0e00fc88c7ba2d013385a66bc", "url": "https://github.com/google/ground-android/commit/7f55159ad71f7ac0e00fc88c7ba2d013385a66bc", "message": "Revert \"Set activity background color to help debugging layouts\"\n\nThis reverts commit ce1604f5", "committedDate": "2020-02-07T06:14:44Z", "type": "commit"}, {"oid": "fccd716be68b368f54f4506a6882e0430716a376", "url": "https://github.com/google/ground-android/commit/fccd716be68b368f54f4506a6882e0430716a376", "message": "Merge branch 'master' into rm-multi-form", "committedDate": "2020-02-11T02:29:20Z", "type": "commit"}, {"oid": "8a81f9eb957f823af765682de83dc926ac6b436b", "url": "https://github.com/google/ground-android/commit/8a81f9eb957f823af765682de83dc926ac6b436b", "message": "Merge branch 'master' of https://github.com/google/ground-android into rm-multi-form\n\n# Conflicts:\n#\tgnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/LayerDoc.java\n#\tgnd/src/main/res/layout/feature_sheet_frag.xml\n#\tgradle.properties", "committedDate": "2020-02-24T16:29:51Z", "type": "commit"}, {"oid": "d78377b6e5e1d31060a41dc0148dd4566693e8df", "url": "https://github.com/google/ground-android/commit/d78377b6e5e1d31060a41dc0148dd4566693e8df", "message": "Merge remote-tracking branch 'origin/rm-multi-form' into rm-multi-form", "committedDate": "2020-02-24T16:29:59Z", "type": "commit"}, {"oid": "f0a3234f8e001774d70cb4fe909c851486048a01", "url": "https://github.com/google/ground-android/commit/f0a3234f8e001774d70cb4fe909c851486048a01", "message": "Fix duplicate namespace added on merge", "committedDate": "2020-02-24T16:31:35Z", "type": "commit"}, {"oid": "77c43648ffbe024116564687a9fd032869c5b117", "url": "https://github.com/google/ground-android/commit/77c43648ffbe024116564687a9fd032869c5b117", "message": "Update to latest Layer model, warn on multiple forms", "committedDate": "2020-02-24T16:37:10Z", "type": "commit"}, {"oid": "beefe26d0b5d2d339ec7e058b55428a94c6e113f", "url": "https://github.com/google/ground-android/commit/beefe26d0b5d2d339ec7e058b55428a94c6e113f", "message": "Merge branch 'master' into rm-multi-form", "committedDate": "2020-02-24T21:59:07Z", "type": "commit"}, {"oid": "1416852e88bc9b12980cf01618e4844c51a9a50d", "url": "https://github.com/google/ground-android/commit/1416852e88bc9b12980cf01618e4844c51a9a50d", "message": "Merge branch 'master' into rm-multi-form", "committedDate": "2020-02-24T22:01:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk5NDExMQ==", "url": "https://github.com/google/ground-android/pull/344#discussion_r383994111", "bodyText": "Doesn't the fact that this is nullable obviate the use of the ArrayList or any type with an empty state? Is it possible for us to remove the potential null--or is that necessary because of unknowns in the firebase side (random data wipes, etc.)\nI'm guessing it's the latter, so not blocking on this.", "author": "scolsen", "createdAt": "2020-02-25T16:48:58Z", "path": "gnd/src/main/java/com/google/android/gnd/persistence/remote/firestore/schema/LayerConverter.java", "diffHunk": "@@ -33,10 +35,12 @@ static Layer toLayer(String id, LayerNestedObject obj) {\n     if (obj.getDefaultStyle() != null) {\n       layer.setDefaultStyle(StyleConverter.toStyle(obj.getDefaultStyle()));\n     }\n-    if (obj.getForms() != null) {\n-      Maps.forEach(\n-          obj.getForms(),\n-          (formId, formDoc) -> layer.addForm(FormConverter.toForm(formId, formDoc)));\n+    if (obj.getForms() != null && !obj.getForms().isEmpty()) {", "originalCommit": "1416852e88bc9b12980cf01618e4844c51a9a50d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDA1NTE3Nw==", "url": "https://github.com/google/ground-android/pull/344#discussion_r384055177", "bodyText": "That's exactly right.. It would if we controlled how the field was populated, but since we don't know if the Firebase API will set a null or empty we need to check both.", "author": "gino-m", "createdAt": "2020-02-25T18:47:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk5NDExMQ=="}], "type": "inlineReview"}]}