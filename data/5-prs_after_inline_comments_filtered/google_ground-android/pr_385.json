{"pr_number": 385, "pr_title": "[Map] Refactor map adapter", "pr_createdAt": "2020-03-09T00:55:43Z", "pr_url": "https://github.com/google/ground-android/pull/385", "timeline": [{"oid": "dd090bbba03d80e5065aa3a1f109e6af91e415a2", "url": "https://github.com/google/ground-android/commit/dd090bbba03d80e5065aa3a1f109e6af91e415a2", "message": "Move conversion to/from GMS LatLng into Maps SDK adapter class", "committedDate": "2020-03-07T23:59:27Z", "type": "commit"}, {"oid": "725a4a8c37d69873c15729e41f0968b3f0a226c3", "url": "https://github.com/google/ground-android/commit/725a4a8c37d69873c15729e41f0968b3f0a226c3", "message": "Rename updateMarkers to setFeatures", "committedDate": "2020-03-08T22:30:55Z", "type": "commit"}, {"oid": "c3c629d6f72222c2f97849cbe4e6a1113947d6a2", "url": "https://github.com/google/ground-android/commit/c3c629d6f72222c2f97849cbe4e6a1113947d6a2", "message": "Add Javadoc", "committedDate": "2020-03-08T22:33:28Z", "type": "commit"}, {"oid": "052a84781b52d7ea1108bbdec16d2d7aafe86c6a", "url": "https://github.com/google/ground-android/commit/052a84781b52d7ea1108bbdec16d2d7aafe86c6a", "message": "Rename getCameraPosition to getCameraMoves", "committedDate": "2020-03-08T22:35:11Z", "type": "commit"}, {"oid": "2cae2f80738d3304cfe0c0c15004c840eabc46b6", "url": "https://github.com/google/ground-android/commit/2cae2f80738d3304cfe0c0c15004c840eabc46b6", "message": "Rename getCenter to getCameraTarget", "committedDate": "2020-03-08T22:37:54Z", "type": "commit"}, {"oid": "c9aae682a368a427b6a370f055ec3337b5e0bc6c", "url": "https://github.com/google/ground-android/commit/c9aae682a368a427b6a370f055ec3337b5e0bc6c", "message": "Update Javadoc", "committedDate": "2020-03-08T22:43:24Z", "type": "commit"}, {"oid": "b176702193825e69e2f39c9e9e952901ab51acf0", "url": "https://github.com/google/ground-android/commit/b176702193825e69e2f39c9e9e952901ab51acf0", "message": "Move MapAdapter to top level", "committedDate": "2020-03-08T23:12:41Z", "type": "commit"}, {"oid": "5272e8b409361e2e0e93c947d88a96a5f05fd0e8", "url": "https://github.com/google/ground-android/commit/5272e8b409361e2e0e93c947d88a96a5f05fd0e8", "message": "Add JavaDoc", "committedDate": "2020-03-08T23:19:39Z", "type": "commit"}, {"oid": "c3658321379bdf273538ee57cdc92dfc28c48097", "url": "https://github.com/google/ground-android/commit/c3658321379bdf273538ee57cdc92dfc28c48097", "message": "Rename MapMarker to MapPin to disambiguate with GMS Marker class", "committedDate": "2020-03-08T23:47:04Z", "type": "commit"}, {"oid": "cf1935f20068410498a08183ca4e7979cd184d97", "url": "https://github.com/google/ground-android/commit/cf1935f20068410498a08183ca4e7979cd184d97", "message": "Make Feature required in MapPin, make MapPin required in Marker", "committedDate": "2020-03-08T23:47:16Z", "type": "commit"}, {"oid": "fd2788c4d7ee286bd0ceb5977b1320d7e1d2be89", "url": "https://github.com/google/ground-android/commit/fd2788c4d7ee286bd0ceb5977b1320d7e1d2be89", "message": "Replace marker cache with Set, since we never access by id", "committedDate": "2020-03-08T23:56:11Z", "type": "commit"}, {"oid": "0b833c479f0c227e5f5cbe4163242c4bbd52d061", "url": "https://github.com/google/ground-android/commit/0b833c479f0c227e5f5cbe4163242c4bbd52d061", "message": "Inline getMapPin method", "committedDate": "2020-03-08T23:57:45Z", "type": "commit"}, {"oid": "ff7b92fb42f0a4be5264e144f421464409e5c81c", "url": "https://github.com/google/ground-android/commit/ff7b92fb42f0a4be5264e144f421464409e5c81c", "message": "Remove unused highlighted and pendingWrites marker states", "committedDate": "2020-03-09T00:02:02Z", "type": "commit"}, {"oid": "231f01e87ec81174ab3f6dd3621efdf7ca8674a4", "url": "https://github.com/google/ground-android/commit/231f01e87ec81174ab3f6dd3621efdf7ca8674a4", "message": "Fix Javadoc typo", "committedDate": "2020-03-09T00:42:40Z", "type": "commit"}, {"oid": "f16d3a96b0485c58e92858a208611ed12ae7ec22", "url": "https://github.com/google/ground-android/commit/f16d3a96b0485c58e92858a208611ed12ae7ec22", "message": "Update MapsAdapter to accept MapPins instead of Features", "committedDate": "2020-03-09T00:43:42Z", "type": "commit"}, {"oid": "5c7dbb8b599bc5e4480bbe578d1e222b21b3e314", "url": "https://github.com/google/ground-android/commit/5c7dbb8b599bc5e4480bbe578d1e222b21b3e314", "message": "Move creation of MapPins into ViewModel", "committedDate": "2020-03-09T00:52:40Z", "type": "commit"}, {"oid": "f9416796a64c6b840f9a0fde539fd44c7402c70d", "url": "https://github.com/google/ground-android/commit/f9416796a64c6b840f9a0fde539fd44c7402c70d", "message": "Fix PMD warnings", "committedDate": "2020-03-10T02:05:31Z", "type": "commit"}, {"oid": "f3a75fd4c6fb18a500d53361ce8f5337502401d0", "url": "https://github.com/google/ground-android/commit/f3a75fd4c6fb18a500d53361ce8f5337502401d0", "message": "Merge branch 'master' into refactor-map-adapter", "committedDate": "2020-03-12T16:54:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MDgxOA==", "url": "https://github.com/google/ground-android/pull/385#discussion_r394480818", "bodyText": "I'm guessing we can't use this::toMapPins here because it's a static method? gtk!", "author": "scolsen", "createdAt": "2020-03-18T16:29:49Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -78,12 +81,13 @@\n     // TODO: Clear feature markers when project is deactivated.\n     // TODO: Since we depend on project stream from repo anyway, this transformation can be moved\n     // into the repo?\n-    this.features =\n+    this.mapPins =\n         LiveDataReactiveStreams.fromPublisher(\n             projectRepository\n                 .getActiveProjectOnceAndStream()\n                 .map(Loadable::value)\n-                .switchMap(this::getFeaturesStream));\n+                .switchMap(this::getFeaturesStream)\n+                .map(MapContainerViewModel::toMapPins));", "originalCommit": "f3a75fd4c6fb18a500d53361ce8f5337502401d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4NDAzMQ==", "url": "https://github.com/google/ground-android/pull/385#discussion_r394484031", "bodyText": "Right! It also makes it clear that a reference to the current instance is not passed to the method impliciltly", "author": "gino-m", "createdAt": "2020-03-18T16:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MDgxOA=="}], "type": "inlineReview"}, {"oid": "9c89834addd438e03ffc4dab4ec50adc370cf6a2", "url": "https://github.com/google/ground-android/commit/9c89834addd438e03ffc4dab4ec50adc370cf6a2", "message": "Merge branch 'master' into refactor-map-adapter", "committedDate": "2020-03-18T16:33:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MTY1Mg==", "url": "https://github.com/google/ground-android/pull/385#discussion_r394481652", "bodyText": "Rename mapMarker to mapPin?", "author": "scolsen", "createdAt": "2020-03-18T16:31:10Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -162,7 +179,7 @@ public void onMapDrag(Point newCameraPosition) {\n     }\n   }\n \n-  public void onMarkerClick(MapMarker mapMarker) {\n+  public void onMarkerClick(MapPin mapMarker) {", "originalCommit": "f3a75fd4c6fb18a500d53361ce8f5337502401d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDUwMzYyOA==", "url": "https://github.com/google/ground-android/pull/385#discussion_r394503628", "bodyText": "Good catch!", "author": "gino-m", "createdAt": "2020-03-18T17:03:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4MTY1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4Njc2Ng==", "url": "https://github.com/google/ground-android/pull/385#discussion_r394486766", "bodyText": "The getViewport method didn't get ported over to the MapAdapter!  I'll need it for offlineareas. It was unused up to this PR tough, so I'm happy to reimplement. Just an FYI.", "author": "scolsen", "createdAt": "2020-03-18T16:38:47Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/map/MapProvider.java", "diffHunk": "@@ -32,36 +25,4 @@\n   Fragment getFragment();\n \n   Single<MapAdapter> getMapAdapter();\n-\n-  /**\n-   * Interface defining map interactions and events. This a separate class from {@link MapProvider}\n-   * so that it can be returned asynchronously by {@link MapProvider#getMapAdapter()} if necessary.\n-   */\n-  interface MapAdapter {\n-\n-    Observable<MapMarker> getMarkerClicks();\n-\n-    Observable<Point> getDragInteractions();\n-\n-    Observable<Point> getCameraPosition();\n-\n-    void enable();\n-\n-    void disable();\n-\n-    void moveCamera(Point point);\n-\n-    void moveCamera(Point point, float zoomLevel);\n-\n-    Point getCenter();\n-\n-    float getCurrentZoomLevel();\n-\n-    @SuppressLint(\"MissingPermission\")\n-    void enableCurrentLocationIndicator();\n-\n-    void updateMarkers(ImmutableSet<Feature> features);\n-\n-    LatLngBounds getViewport();", "originalCommit": "9c89834addd438e03ffc4dab4ec50adc370cf6a2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDU2MTU2MA==", "url": "https://github.com/google/ground-android/pull/385#discussion_r394561560", "bodyText": "Oops, sorry! Added it back!", "author": "gino-m", "createdAt": "2020-03-18T18:37:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDQ4Njc2Ng=="}], "type": "inlineReview"}, {"oid": "2f1aabf9cc09e6b5c2ff255c4f274eee6c68d2e2", "url": "https://github.com/google/ground-android/commit/2f1aabf9cc09e6b5c2ff255c4f274eee6c68d2e2", "message": "Merge branch 'master' into refactor-map-adapter", "committedDate": "2020-03-18T17:58:22Z", "type": "commit"}, {"oid": "8d714255ac0af0766a1f5f3c5b0bb2b8234d71d8", "url": "https://github.com/google/ground-android/commit/8d714255ac0af0766a1f5f3c5b0bb2b8234d71d8", "message": "Rename variable to \"pin\"", "committedDate": "2020-03-18T18:34:21Z", "type": "commit"}, {"oid": "0e09b346da79c59b64376e9c8dea350f66924847", "url": "https://github.com/google/ground-android/commit/0e09b346da79c59b64376e9c8dea350f66924847", "message": "Merge remote-tracking branch 'origin/refactor-map-adapter' into refactor-map-adapter", "committedDate": "2020-03-18T18:34:38Z", "type": "commit"}, {"oid": "f4c29f71b4db8510d844283177aa1a5067d9687e", "url": "https://github.com/google/ground-android/commit/f4c29f71b4db8510d844283177aa1a5067d9687e", "message": "Fix missing import", "committedDate": "2020-03-18T18:35:03Z", "type": "commit"}, {"oid": "07a062465f3c7cbbfa670d155f178980e81fe29a", "url": "https://github.com/google/ground-android/commit/07a062465f3c7cbbfa670d155f178980e81fe29a", "message": "Restore getViewPort() MapAdapter interface method", "committedDate": "2020-03-18T18:37:38Z", "type": "commit"}, {"oid": "50ce8fa307213cf5d9e0dc702fdc228bc0dee659", "url": "https://github.com/google/ground-android/commit/50ce8fa307213cf5d9e0dc702fdc228bc0dee659", "message": "Add missing period in JavaDoc", "committedDate": "2020-03-18T18:40:08Z", "type": "commit"}]}