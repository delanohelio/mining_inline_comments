{"pr_number": 406, "pr_title": "[Feature] Add button to switch map type", "pr_createdAt": "2020-03-20T12:19:47Z", "pr_url": "https://github.com/google/ground-android/pull/406", "timeline": [{"oid": "c452a7da90fefe617ae4f1f2cbb317d33a594660", "url": "https://github.com/google/ground-android/commit/c452a7da90fefe617ae4f1f2cbb317d33a594660", "message": "Move static methods and final variables to the top", "committedDate": "2020-03-20T10:30:45Z", "type": "commit"}, {"oid": "e970f971e5f5c59bee34bded71d14636aaa434b2", "url": "https://github.com/google/ground-android/commit/e970f971e5f5c59bee34bded71d14636aaa434b2", "message": "Log -> Timber", "committedDate": "2020-03-20T10:32:25Z", "type": "commit"}, {"oid": "d49d91191d8d821eb3ff103dba703ebcea621070", "url": "https://github.com/google/ground-android/commit/d49d91191d8d821eb3ff103dba703ebcea621070", "message": "Add map type button", "committedDate": "2020-03-20T10:39:52Z", "type": "commit"}, {"oid": "7f4419826934c5156ef99c33aeab5a80d19c177a", "url": "https://github.com/google/ground-android/commit/7f4419826934c5156ef99c33aeab5a80d19c177a", "message": "Add getter/setter for map type", "committedDate": "2020-03-20T11:07:51Z", "type": "commit"}, {"oid": "ce8db1df1d0223ef2c5e2c2e4b00c62e7fc62895", "url": "https://github.com/google/ground-android/commit/ce8db1df1d0223ef2c5e2c2e4b00c62e7fc62895", "message": "Create alert dialog on button click and display map types", "committedDate": "2020-03-20T11:08:20Z", "type": "commit"}, {"oid": "a184c310659d38d4a45964228f88c229884461cf", "url": "https://github.com/google/ground-android/commit/a184c310659d38d4a45964228f88c229884461cf", "message": "Store list of map types in GoogleMapsMapProvider", "committedDate": "2020-03-20T11:38:00Z", "type": "commit"}, {"oid": "45bc8d505c7c35720738aeff4a312091ec58a260", "url": "https://github.com/google/ground-android/commit/45bc8d505c7c35720738aeff4a312091ec58a260", "message": "Cleanup and null checks", "committedDate": "2020-03-20T11:43:42Z", "type": "commit"}, {"oid": "14442defbacb41a95562ce869c5f184554426e71", "url": "https://github.com/google/ground-android/commit/14442defbacb41a95562ce869c5f184554426e71", "message": "Add map layer icon", "committedDate": "2020-03-20T12:07:12Z", "type": "commit"}, {"oid": "dcb09e68422f21c8c4d549545e04fe892d36717b", "url": "https://github.com/google/ground-android/commit/dcb09e68422f21c8c4d549545e04fe892d36717b", "message": "Replace HashMap with interface Map\nInvert if conditions for simplification", "committedDate": "2020-03-20T12:37:55Z", "type": "commit"}, {"oid": "b3a7bb62e4917238a41f3085c9093508e6929bea", "url": "https://github.com/google/ground-android/commit/b3a7bb62e4917238a41f3085c9093508e6929bea", "message": "Merge branch 'master' into map-type", "committedDate": "2020-03-20T17:52:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgwMTU1Mw==", "url": "https://github.com/google/ground-android/pull/406#discussion_r395801553", "bodyText": "Please use an ImmutableMap<> defined in a constant instead. The constant can then be returned from this method.", "author": "gino-m", "createdAt": "2020-03-20T17:54:28Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/map/gms/GoogleMapsMapProvider.java", "diffHunk": "@@ -73,29 +74,28 @@ public Fragment getFragment() {\n \n   @Override\n   public int getMapType() {\n-    if (map != null) {\n-      return map.getValue().getMapType();\n+    if (map == null) {\n+      throw new IllegalStateException(\"MapAdapter is null\");\n     }\n-    throw new IllegalStateException(\"MapAdapter is null\");\n+    return map.getValue().getMapType();\n   }\n \n   @Override\n   public void setMapType(int mapType) {\n-    if (map != null) {\n-      map.getValue().setMapType(mapType);\n-    } else {\n+    if (map == null) {\n       throw new IllegalStateException(\"MapAdapter is null\");\n     }\n+    map.getValue().setMapType(mapType);\n   }\n \n   @Override\n-  public HashMap<Integer, String> getMapTypes() {\n-    HashMap<Integer, String> hashMap = new HashMap<>();\n-    hashMap.put(GoogleMap.MAP_TYPE_NONE, \"None\");\n-    hashMap.put(GoogleMap.MAP_TYPE_NORMAL, \"Normal\");\n-    hashMap.put(GoogleMap.MAP_TYPE_SATELLITE, \"Satellite\");\n-    hashMap.put(GoogleMap.MAP_TYPE_TERRAIN, \"Terrain\");\n-    hashMap.put(GoogleMap.MAP_TYPE_HYBRID, \"Hybrid\");\n-    return hashMap;\n+  public Map<Integer, String> getMapTypes() {", "originalCommit": "dcb09e68422f21c8c4d549545e04fe892d36717b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgwMTY0OA==", "url": "https://github.com/google/ground-android/pull/406#discussion_r395801648", "bodyText": "Also add // TODO: i18n.", "author": "gino-m", "createdAt": "2020-03-20T17:54:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTgwMTU1Mw=="}], "type": "inlineReview"}, {"oid": "076d3d0be28277f77a3fac2c2c58f9b9ac794cc6", "url": "https://github.com/google/ground-android/commit/076d3d0be28277f77a3fac2c2c58f9b9ac794cc6", "message": "Replace Map with ImmutableMap", "committedDate": "2020-03-20T18:20:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY2NjQ5OA==", "url": "https://github.com/google/ground-android/pull/406#discussion_r396666498", "bodyText": "We're trying to move away from Butterknife in favor of Data Binding to ViewModels - could we do that here instead?", "author": "gino-m", "createdAt": "2020-03-23T18:26:09Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerFragment.java", "diffHunk": "@@ -72,6 +74,26 @@\n   private HomeScreenViewModel homeScreenViewModel;\n   private MainViewModel mainViewModel;\n \n+  @OnClick(R.id.map_type_btn)", "originalCommit": "076d3d0be28277f77a3fac2c2c58f9b9ac794cc6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3MDk0Ng==", "url": "https://github.com/google/ground-android/pull/406#discussion_r396670946", "bodyText": "I agree that the class needs a refactor, but doing that in the same PR would broaden the scope of this PR. We can open a new refactor bug to handle that independently. Wdyt?", "author": "shobhitagarwal1612", "createdAt": "2020-03-23T18:33:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY2NjQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY3NDIzNQ==", "url": "https://github.com/google/ground-android/pull/406#discussion_r396674235", "bodyText": "I mainly didn't want to add a new instance of Butterknife binding if we could avoid it, esp. since we already have a MapContainerViewModel. Is it just a question of defining onMapTypeButtonClick() in the view model and exposing an Observable<Event<Nil>> to trigger the dialog in the view? If so I'd prefer to add it straight away if possible. If you have your hands full atm though please lmk and I can try to send a PR to your branch with the recommended changes!", "author": "gino-m", "createdAt": "2020-03-23T18:38:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY2NjQ5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjcwMDQwOA==", "url": "https://github.com/google/ground-android/pull/406#discussion_r396700408", "bodyText": "Done", "author": "shobhitagarwal1612", "createdAt": "2020-03-23T19:24:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY2NjQ5OA=="}], "type": "inlineReview"}, {"oid": "f531eb72201fcaa61c22c49fd7dd3a166e40f6e5", "url": "https://github.com/google/ground-android/commit/f531eb72201fcaa61c22c49fd7dd3a166e40f6e5", "message": "Don't use Title casing", "committedDate": "2020-03-23T18:30:53Z", "type": "commit"}, {"oid": "4a1323dd8d46da5bcdafa132cc9cd4dd09380f2e", "url": "https://github.com/google/ground-android/commit/4a1323dd8d46da5bcdafa132cc9cd4dd09380f2e", "message": "Replace ButterKnife with DataBinding", "committedDate": "2020-03-23T19:23:39Z", "type": "commit"}, {"oid": "8bdd8d4bb39ef7700943a300bdce5c31b3281a0f", "url": "https://github.com/google/ground-android/commit/8bdd8d4bb39ef7700943a300bdce5c31b3281a0f", "message": "Fix pmd issues", "committedDate": "2020-03-23T20:36:12Z", "type": "commit"}, {"oid": "b88b0a07edc50463fb53ef887442efa7c11bf66d", "url": "https://github.com/google/ground-android/commit/b88b0a07edc50463fb53ef887442efa7c11bf66d", "message": "Merge branch 'master' into map-type", "committedDate": "2020-03-24T06:24:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjM1MQ==", "url": "https://github.com/google/ground-android/pull/406#discussion_r398726351", "bodyText": "Instead of using int here directly should we abstract away the particular map types of a given Map impl and introduce an enum and some conversion functions to allow us to set the types regardless of the underlying adapter?\n@gino-m wdyt?\ne.g. on the adapter we'd have some FN setMapType(TypeENUM) instead of int.\nNo need to do this now.", "author": "scolsen", "createdAt": "2020-03-26T16:46:59Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/map/MapAdapter.java", "diffHunk": "@@ -70,6 +70,12 @@\n   /** Update map pins shown on map. */\n   void setMapPins(ImmutableSet<MapPin> pins);\n \n+  /** Get current map type. */\n+  int getMapType();\n+\n+  /** Update map type. */\n+  void setMapType(int mapType);", "originalCommit": "b88b0a07edc50463fb53ef887442efa7c11bf66d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUyNDU4Nw==", "url": "https://github.com/google/ground-android/pull/406#discussion_r399524587", "bodyText": "It may make sense to define an enum at the interface level with a superset of basemap types, yes. Also +1 that it can be done in a follow up (please add a TODO)?\nAlso, somewhere we should clarify that Map Type refers to the basemap shown below map features and offline satellite imagery - they're called \"map styles\" in Mapbox and \"basemaps\" in Leaflet.", "author": "gino-m", "createdAt": "2020-03-27T20:35:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjM1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY0MDcxMA==", "url": "https://github.com/google/ground-android/pull/406#discussion_r399640710", "bodyText": "Thanks @scolsen and @gino-m! Done", "author": "shobhitagarwal1612", "createdAt": "2020-03-28T09:22:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODcyNjM1MQ=="}], "type": "inlineReview"}, {"oid": "5a2902391bdcd8591579caaaf6367e922dc2f7c4", "url": "https://github.com/google/ground-android/commit/5a2902391bdcd8591579caaaf6367e922dc2f7c4", "message": "Merge branch 'master' into map-type", "committedDate": "2020-03-26T16:58:02Z", "type": "commit"}, {"oid": "55c175284dee5381a6d73d7fd86cd47cdf7ad476", "url": "https://github.com/google/ground-android/commit/55c175284dee5381a6d73d7fd86cd47cdf7ad476", "message": "Add newline", "committedDate": "2020-03-26T16:58:46Z", "type": "commit"}, {"oid": "9817ec4577f0f3c6cbddb98b2f5c77c6ebe3206b", "url": "https://github.com/google/ground-android/commit/9817ec4577f0f3c6cbddb98b2f5c77c6ebe3206b", "message": "Merge branch 'master' into map-type", "committedDate": "2020-03-28T09:10:23Z", "type": "commit"}, {"oid": "372a3604c7ff3112380ff08a20b74ded333f16b7", "url": "https://github.com/google/ground-android/commit/372a3604c7ff3112380ff08a20b74ded333f16b7", "message": "Add comments and TODO", "committedDate": "2020-03-28T09:21:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0OTk5MQ==", "url": "https://github.com/google/ground-android/pull/406#discussion_r399849991", "bodyText": "Can we simplify this by eliminating mapLayerTypeClicks and just making mapLayerUpdateRequests a MutableLiveData that gets a new Event on each click (.setValue(Event.create(..)))?", "author": "gino-m", "createdAt": "2020-03-29T20:33:48Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -88,6 +94,9 @@\n                 .map(Loadable::value)\n                 .switchMap(this::getFeaturesStream)\n                 .map(MapContainerViewModel::toMapPins));\n+    this.mapLayerUpdateRequests =", "originalCommit": "372a3604c7ff3112380ff08a20b74ded333f16b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzOTc5NA==", "url": "https://github.com/google/ground-android/pull/406#discussion_r399939794", "bodyText": "Thanks! Done", "author": "shobhitagarwal1612", "createdAt": "2020-03-30T05:46:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg0OTk5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1MDEzMw==", "url": "https://github.com/google/ground-android/pull/406#discussion_r399850133", "bodyText": "Would showMapTypeSelectorRequests be more correct here?", "author": "gino-m", "createdAt": "2020-03-29T20:34:46Z", "path": "gnd/src/main/java/com/google/android/gnd/ui/home/mapcontainer/MapContainerViewModel.java", "diffHunk": "@@ -29,34 +28,40 @@\n import com.google.android.gnd.repository.FeatureRepository;\n import com.google.android.gnd.repository.ProjectRepository;\n import com.google.android.gnd.rx.BooleanOrError;\n+import com.google.android.gnd.rx.Event;\n import com.google.android.gnd.rx.Loadable;\n+import com.google.android.gnd.rx.Nil;\n import com.google.android.gnd.system.LocationManager;\n import com.google.android.gnd.ui.common.AbstractViewModel;\n import com.google.android.gnd.ui.common.SharedViewModel;\n import com.google.android.gnd.ui.map.MapPin;\n import com.google.common.collect.ImmutableSet;\n import io.reactivex.BackpressureStrategy;\n import io.reactivex.Flowable;\n+import io.reactivex.Single;\n+import io.reactivex.processors.PublishProcessor;\n import io.reactivex.subjects.PublishSubject;\n import io.reactivex.subjects.Subject;\n import java.util.concurrent.TimeUnit;\n import java8.util.Optional;\n import javax.inject.Inject;\n+import timber.log.Timber;\n \n @SharedViewModel\n public class MapContainerViewModel extends AbstractViewModel {\n \n-  private static final String TAG = MapContainerViewModel.class.getSimpleName();\n   private static final float DEFAULT_ZOOM_LEVEL = 20.0f;\n   private final LiveData<Loadable<Project>> activeProject;\n   private final LiveData<ImmutableSet<MapPin>> mapPins;\n   private final LiveData<BooleanOrError> locationLockState;\n   private final LiveData<CameraUpdate> cameraUpdateRequests;\n   private final MutableLiveData<Point> cameraPosition;\n+  private final LiveData<Event<Nil>> mapLayerUpdateRequests;", "originalCommit": "372a3604c7ff3112380ff08a20b74ded333f16b7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkzOTgyNQ==", "url": "https://github.com/google/ground-android/pull/406#discussion_r399939825", "bodyText": "Done", "author": "shobhitagarwal1612", "createdAt": "2020-03-30T05:46:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTg1MDEzMw=="}], "type": "inlineReview"}, {"oid": "50a8adc5b50475d8fd728e9262ea2fc12f383f0b", "url": "https://github.com/google/ground-android/commit/50a8adc5b50475d8fd728e9262ea2fc12f383f0b", "message": "Merge branch 'master' into map-type", "committedDate": "2020-03-30T05:37:49Z", "type": "commit"}, {"oid": "a1b26df99db02f9e719f0bffa27bf0c761f329c6", "url": "https://github.com/google/ground-android/commit/a1b26df99db02f9e719f0bffa27bf0c761f329c6", "message": "Convert LiveData into MutableLiveData and cleanup", "committedDate": "2020-03-30T05:45:53Z", "type": "commit"}, {"oid": "a1b26df99db02f9e719f0bffa27bf0c761f329c6", "url": "https://github.com/google/ground-android/commit/a1b26df99db02f9e719f0bffa27bf0c761f329c6", "message": "Convert LiveData into MutableLiveData and cleanup", "committedDate": "2020-03-30T05:45:53Z", "type": "forcePushed"}]}