{"pr_number": 565, "pr_title": "[View/add/edit observations] Sort fields by `index` defined in form", "pr_createdAt": "2020-08-14T21:43:05Z", "pr_url": "https://github.com/google/ground-android/pull/565", "timeline": [{"oid": "4444870e623031ee006da223e6569ae476d0ece5", "url": "https://github.com/google/ground-android/commit/4444870e623031ee006da223e6569ae476d0ece5", "message": "Add `index` to form field elements", "committedDate": "2020-08-14T21:16:49Z", "type": "commit"}, {"oid": "7b29a3812e92f61bb051c35407c7f3b5df4f2f1e", "url": "https://github.com/google/ground-android/commit/7b29a3812e92f61bb051c35407c7f3b5df4f2f1e", "message": "Sort form elements by index in UIs", "committedDate": "2020-08-14T21:41:15Z", "type": "commit"}, {"oid": "75ad60c373d7704a7aac0798450e1eda356c4918", "url": "https://github.com/google/ground-android/commit/75ad60c373d7704a7aac0798450e1eda356c4918", "message": "Merge branch 'master' of https://github.com/google/ground-android into fix-field-order", "committedDate": "2020-08-14T21:41:33Z", "type": "commit"}, {"oid": "edd0d8154c25897c2d9c404265421bb1ff62d787", "url": "https://github.com/google/ground-android/commit/edd0d8154c25897c2d9c404265421bb1ff62d787", "message": "Merge branch 'master' into fix-field-order", "committedDate": "2020-08-15T10:07:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MjU2OQ==", "url": "https://github.com/google/ground-android/pull/565#discussion_r470962569", "bodyText": "How about getElementsSorted() --> getSortedElements()?", "author": "shobhitagarwal1612", "createdAt": "2020-08-15T10:17:17Z", "path": "gnd/src/main/java/com/google/android/gnd/model/form/Form.java", "diffHunk": "@@ -35,6 +37,12 @@\n \n   public abstract ImmutableList<Element> getElements();\n \n+  public ImmutableList<Element> getElementsSorted() {", "originalCommit": "edd0d8154c25897c2d9c404265421bb1ff62d787", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMyOTIwNA==", "url": "https://github.com/google/ground-android/pull/565#discussion_r472329204", "bodyText": "The naming was chosen to emphasize that this is a variant of the getElements() method -  it also returns elements, but sorted. I've seen this naming convention used elsewhere but can't find it now. I don't feel strongly about it though. Is there precedency for this pattern that you know of?", "author": "gino-m", "createdAt": "2020-08-18T16:34:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MjU2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMzOTg3OQ==", "url": "https://github.com/google/ground-android/pull/565#discussion_r472339879", "bodyText": "I don't know if there is a rule/pattern for that. It just seemed more natural to add \"sorted\" first. I am fine with either as it is just a minor nit. Let's keep it the same way.", "author": "shobhitagarwal1612", "createdAt": "2020-08-18T16:51:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MjU2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2Mjc3Ng==", "url": "https://github.com/google/ground-android/pull/565#discussion_r470962776", "bodyText": "Can we please make this @NonNull? It would remove the extra complexity of having to deal with all fallbacks", "author": "shobhitagarwal1612", "createdAt": "2020-08-15T10:20:05Z", "path": "gnd/src/main/java/com/google/android/gnd/persistence/local/room/entity/FieldEntity.java", "diffHunk": "@@ -52,6 +52,11 @@\n   @ColumnInfo(name = \"id\")\n   public abstract String getId();\n \n+  @CopyAnnotations\n+  @Nullable\n+  @ColumnInfo(name = \"index\")\n+  public abstract Integer getIndex();", "originalCommit": "edd0d8154c25897c2d9c404265421bb1ff62d787", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjMzMDE5Mg==", "url": "https://github.com/google/ground-android/pull/565#discussion_r472330192", "bodyText": "Done!", "author": "gino-m", "createdAt": "2020-08-18T16:35:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2Mjc3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MzI4MA==", "url": "https://github.com/google/ground-android/pull/565#discussion_r470963280", "bodyText": "What if we make index a required field? If the online form generator always adds an index then there would be no need to take care of adding this attribute manually. Wdyt?", "author": "shobhitagarwal1612", "createdAt": "2020-08-15T10:26:39Z", "path": "gnd/src/main/java/com/google/android/gnd/model/form/Element.java", "diffHunk": "@@ -30,6 +31,21 @@\n     FIELD\n   }\n \n+  public int getIndex() {\n+    switch (getType()) {\n+      case FIELD:\n+        // Fall back to hash code id on missing index; the order won't necessarily be correct\n+        // but at least it will be stable.\n+        return Optional.ofNullable(getField().getIndex())\n+            .orElseGet(() -> getField().getId().hashCode());\n+      case UNKNOWN:\n+        // Intentional fall-through.\n+      default:\n+        // Fall back for unknown / bad index.\n+        return hashCode();", "originalCommit": "edd0d8154c25897c2d9c404265421bb1ff62d787", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM1NjQ3Mg==", "url": "https://github.com/google/ground-android/pull/565#discussion_r472356472", "bodyText": "Good idea. Let's handle missing index in remote closer to the source: eff2520.", "author": "gino-m", "createdAt": "2020-08-18T17:17:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk2MzI4MA=="}], "type": "inlineReview"}, {"oid": "21fdeb73356333852d956d5e837fb432224fb919", "url": "https://github.com/google/ground-android/commit/21fdeb73356333852d956d5e837fb432224fb919", "message": "Make field index in local db required / non-null", "committedDate": "2020-08-18T16:35:42Z", "type": "commit"}, {"oid": "eff2520c74fd4db0ac66837d5479965f1b9c40ef", "url": "https://github.com/google/ground-android/commit/eff2520c74fd4db0ac66837d5479965f1b9c40ef", "message": "Make field index required in model", "committedDate": "2020-08-18T17:16:37Z", "type": "commit"}, {"oid": "bd905a23d86e6234cd599390aa69744dfaec1c1b", "url": "https://github.com/google/ground-android/commit/bd905a23d86e6234cd599390aa69744dfaec1c1b", "message": "Merge remote-tracking branch 'origin/fix-field-order' into fix-field-order", "committedDate": "2020-08-18T17:16:45Z", "type": "commit"}, {"oid": "46f3236c7518a035afb498334927a6c4f5282aed", "url": "https://github.com/google/ground-android/commit/46f3236c7518a035afb498334927a6c4f5282aed", "message": "Merge branch 'master' into fix-field-order", "committedDate": "2020-08-19T15:14:09Z", "type": "commit"}, {"oid": "a5358f57369c026d92e36eca11658366460be82c", "url": "https://github.com/google/ground-android/commit/a5358f57369c026d92e36eca11658366460be82c", "message": "Remove unused import", "committedDate": "2020-08-19T15:28:16Z", "type": "commit"}, {"oid": "9a512bf4cd994670d0d8bb5e116c4384e5b67d71", "url": "https://github.com/google/ground-android/commit/9a512bf4cd994670d0d8bb5e116c4384e5b67d71", "message": "Merge remote-tracking branch 'origin/fix-field-order' into fix-field-order", "committedDate": "2020-08-19T15:37:20Z", "type": "commit"}, {"oid": "49e854384b015d19cd1d6f40c2afa8ac32312397", "url": "https://github.com/google/ground-android/commit/49e854384b015d19cd1d6f40c2afa8ac32312397", "message": "Add comment to getIndex()", "committedDate": "2020-08-19T19:46:40Z", "type": "commit"}, {"oid": "b78793bf045446f96c030032ab30bb1b8fbe3fb1", "url": "https://github.com/google/ground-android/commit/b78793bf045446f96c030032ab30bb1b8fbe3fb1", "message": "Fix missing index field in test Field object", "committedDate": "2020-08-19T20:18:07Z", "type": "commit"}]}