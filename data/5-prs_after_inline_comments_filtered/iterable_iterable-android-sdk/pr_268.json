{"pr_number": 268, "pr_title": "Feature/mob 2054 in app animation poc", "pr_createdAt": "2020-10-09T05:54:27Z", "pr_url": "https://github.com/Iterable/iterable-android-sdk/pull/268", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwNTUxNg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r503505516", "bodyText": "Why is it on webViewClient? It's probably better to have everything related to animation in one place, either in IterableInAppFragmentHTMLNotification or a separate class.", "author": "vbabenkoru", "createdAt": "2020-10-12T20:00:33Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -138,7 +156,18 @@ public Dialog onCreateDialog(Bundle savedInstanceState) {\n             @Override\n             public void onBackPressed() {\n                 IterableInAppFragmentHTMLNotification.this.onBackPressed();\n-                super.onBackPressed();\n+                Runnable dismissFragmentRunnable = new Runnable() {\n+                    @Override\n+                    public void run() {\n+                        getInstance().dismiss();\n+                    }\n+                };\n+\n+                if (webView != null && webView.webViewClient != null) {\n+                    webView.webViewClient.animateClose(webView, dismissFragmentRunnable);", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUwOTg1Mw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r503509853", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String ITERABLE_IN_APP_DEFAULT_ANIMATION         = \"shouldAnimate\";\n          \n          \n            \n                public static final String ITERABLE_IN_APP_SHOULD_ANIMATE         = \"shouldAnimate\";", "author": "vbabenkoru", "createdAt": "2020-10-12T20:11:17Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableConstants.java", "diffHunk": "@@ -204,6 +207,7 @@\n     public static final String ITERABLE_INBOX_IMPRESSIONS                = \"impressions\";\n     public static final String ITERABLE_INBOX_IMP_DISPLAY_COUNT          = \"displayCount\";\n     public static final String ITERABLE_INBOX_IMP_DISPLAY_DURATION       = \"displayDuration\";\n+    public static final String ITERABLE_IN_APP_DEFAULT_ANIMATION         = \"shouldAnimate\";", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzUxNDg2MA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r503514860", "bodyText": "webView.webViewClient.htmlView is the same as webView. To understand why this code is checking this state, you'd have to read WebViewClient code. This is generally fragile, I'd rely on more explicit checks.", "author": "vbabenkoru", "createdAt": "2020-10-12T20:23:26Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -213,11 +245,15 @@ public void run() {\n \n     private void showDialogView() {\n         try {\n-            getDialog().getWindow().getDecorView().setAlpha(1.0f);\n+            webView.setAlpha(1.0f);\n+            if (webView.webViewClient.htmlView == null) {", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyNjQyNg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504126426", "bodyText": "Formatting is different in this value (starts with a lowercase letter).", "author": "vbabenkoru", "createdAt": "2020-10-13T17:16:19Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -40,6 +40,9 @@\n     private static final String CALLBACK_ON_CANCEL = \"CallbackOnCancel\";\n     private static final String MESSAGE_ID = \"MessageId\";\n     private static final String INAPP_OPEN_TRACKED = \"InAppOpenTracked\";\n+    private static final String INAPP_BGALPHA = \"InAppBgAlpha\";\n+    private static final String INAPP_BGCOLOR = \"InAppBgColor\";\n+    private static final String INAPP_SHOULD_ANIMATE = \"shouldAnimate\";", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyNzk4Mw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504127983", "bodyText": "Use IterableConstants.* instead of importing every constant statically.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:19:04Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -12,6 +12,11 @@\n \n import java.util.Date;\n \n+import static com.iterable.iterableapi.IterableConstants.ITERABLE_IN_APP_BGCOLOR;", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyODQ3NQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504128475", "bodyText": "The field is called inAppDisplaySettings (plural).", "author": "vbabenkoru", "createdAt": "2020-10-13T17:19:50Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -142,6 +149,26 @@ public int hashCode() {\n         }\n     }\n \n+    public static class InAppDisplaySetting {", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyOTA1NQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504129055", "bodyText": "Looks like something temporary.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:20:50Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -303,11 +330,22 @@ static IterableInAppMessage fromJSONObject(@NonNull JSONObject messageJson, @Nul\n         Date expiresAt = expiresAtLong != 0 ? new Date(expiresAtLong) : null;\n \n         String html = contentJson.optString(IterableConstants.ITERABLE_IN_APP_HTML, null);\n-\n-        JSONObject paddingOptions = contentJson.optJSONObject(IterableConstants.ITERABLE_IN_APP_DISPLAY_SETTINGS);\n-        Rect padding = getPaddingFromPayload(paddingOptions);\n+        JSONObject inAppDisplaySettingsJson = contentJson.optJSONObject(IterableConstants.ITERABLE_IN_APP_DISPLAY_SETTINGS);\n+        Rect padding = getPaddingFromPayload(inAppDisplaySettingsJson);\n         double backgroundAlpha = contentJson.optDouble(IterableConstants.ITERABLE_IN_APP_BACKGROUND_ALPHA, 0);\n+        boolean shouldAnimate = inAppDisplaySettingsJson.optBoolean(ITERABLE_IN_APP_DEFAULT_ANIMATION, true);\n+        JSONObject bgColorSetting = inAppDisplaySettingsJson.optJSONObject(ITERABLE_IN_APP_BGCOLOR);\n+\n+//        String bgColorInHex = \"#00D3D3D3\";", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwNzM0OA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504307348", "bodyText": "Yes.. kept for test convenience... Easy to uncomment and see in app animation working..\nWill remove it too", "author": "Ayyanchira", "createdAt": "2020-10-13T23:03:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyOTA1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEyOTM1Mg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504129352", "bodyText": "To match the convention used in this method, I'd name it bgColorJson.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:21:20Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -303,11 +330,22 @@ static IterableInAppMessage fromJSONObject(@NonNull JSONObject messageJson, @Nul\n         Date expiresAt = expiresAtLong != 0 ? new Date(expiresAtLong) : null;\n \n         String html = contentJson.optString(IterableConstants.ITERABLE_IN_APP_HTML, null);\n-\n-        JSONObject paddingOptions = contentJson.optJSONObject(IterableConstants.ITERABLE_IN_APP_DISPLAY_SETTINGS);\n-        Rect padding = getPaddingFromPayload(paddingOptions);\n+        JSONObject inAppDisplaySettingsJson = contentJson.optJSONObject(IterableConstants.ITERABLE_IN_APP_DISPLAY_SETTINGS);\n+        Rect padding = getPaddingFromPayload(inAppDisplaySettingsJson);\n         double backgroundAlpha = contentJson.optDouble(IterableConstants.ITERABLE_IN_APP_BACKGROUND_ALPHA, 0);\n+        boolean shouldAnimate = inAppDisplaySettingsJson.optBoolean(ITERABLE_IN_APP_DEFAULT_ANIMATION, true);\n+        JSONObject bgColorSetting = inAppDisplaySettingsJson.optJSONObject(ITERABLE_IN_APP_BGCOLOR);", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzMDAwNQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504130005", "bodyText": "If there is no bgColor in the payload, do we want to create an InAppBgColor with null values? It might be better to not create one and just pass null.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:22:31Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -303,11 +330,22 @@ static IterableInAppMessage fromJSONObject(@NonNull JSONObject messageJson, @Nul\n         Date expiresAt = expiresAtLong != 0 ? new Date(expiresAtLong) : null;\n \n         String html = contentJson.optString(IterableConstants.ITERABLE_IN_APP_HTML, null);\n-\n-        JSONObject paddingOptions = contentJson.optJSONObject(IterableConstants.ITERABLE_IN_APP_DISPLAY_SETTINGS);\n-        Rect padding = getPaddingFromPayload(paddingOptions);\n+        JSONObject inAppDisplaySettingsJson = contentJson.optJSONObject(IterableConstants.ITERABLE_IN_APP_DISPLAY_SETTINGS);\n+        Rect padding = getPaddingFromPayload(inAppDisplaySettingsJson);\n         double backgroundAlpha = contentJson.optDouble(IterableConstants.ITERABLE_IN_APP_BACKGROUND_ALPHA, 0);\n+        boolean shouldAnimate = inAppDisplaySettingsJson.optBoolean(ITERABLE_IN_APP_DEFAULT_ANIMATION, true);\n+        JSONObject bgColorSetting = inAppDisplaySettingsJson.optJSONObject(ITERABLE_IN_APP_BGCOLOR);\n+\n+//        String bgColorInHex = \"#00D3D3D3\";\n+//        double bgAlpha = 0.3f;\n+        String bgColorInHex = null;\n+        double bgAlpha = 0.0f;\n+        if (bgColorSetting != null) {\n+            bgColorInHex = bgColorSetting.optString(ITERABLE_IN_APP_BGCOLOR_HEX);\n+            bgAlpha = bgColorSetting.optDouble(ITERABLE_IN_APP_BGCOLOR_ALPHA);\n+        }\n \n+        InAppDisplaySetting inAppDisplaySetting = new InAppDisplaySetting(shouldAnimate, new InAppBgColor(bgColorInHex, bgAlpha));", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzMTQ0MQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504131441", "bodyText": "A WebViewClient ideally should not know anything about the view hierarchy.. As I mentioned in an earlier comment, it is probably better to move it up to the *HTMLNotification class.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:24:53Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableWebViewClient.java", "diffHunk": "@@ -34,12 +45,87 @@ public boolean shouldOverrideUrlLoading(WebView view, String url) {\n      */\n     @Override\n     public void onPageFinished(WebView view, String url) {\n+        htmlView = view;\n         inAppHTMLNotification.setLoaded(true);\n         view.loadUrl(RESIZE_SCRIPT);\n     }\n \n+    void showWebView() {", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDEzMTg3OQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504131879", "bodyText": "\ud83d\udc4d\nI'd also move this up to the in-app html notification class since that is where we manage the layout.", "author": "vbabenkoru", "createdAt": "2020-10-13T17:25:37Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableWebViewClient.java", "diffHunk": "@@ -34,12 +45,87 @@ public boolean shouldOverrideUrlLoading(WebView view, String url) {\n      */\n     @Override\n     public void onPageFinished(WebView view, String url) {\n+        htmlView = view;\n         inAppHTMLNotification.setLoaded(true);\n         view.loadUrl(RESIZE_SCRIPT);\n     }\n \n+    void showWebView() {\n+        if (htmlView != null) {\n+            if (shouldAnimate) {\n+                animate(htmlView);\n+            } else {\n+                htmlView.setVisibility(View.VISIBLE);\n+            }\n+            //Might need this line.\n+            htmlView.setVisibility(View.VISIBLE);\n+        }\n+    }\n+\n+    private void animate(final WebView view) {\n+        int animationResource;\n+        switch (inAppLayout) {\n+            case TOP:\n+                animationResource = R.anim.slide_down_custom;\n+                break;\n+            case CENTER:\n+            case FULLSCREEN:\n+                animationResource = R.anim.fade_in_custom;\n+                break;\n+            case BOTTOM:\n+                animationResource = R.anim.slide_up_custom;\n+                break;\n+            default:\n+                animationResource = R.anim.fade_in_custom;\n+        }\n+        Animation anim = AnimationUtils.loadAnimation(IterableApi.getInstance().getMainActivityContext(),\n+                animationResource);\n+        view.startAnimation(anim);\n+    }\n+\n+    public void animateClose(final WebView view, Runnable parentViewDismissRunnable) {\n+        if (!shouldAnimate) {\n+            parentViewDismissRunnable.run();\n+            return;\n+        }\n+\n+        int animationResource;\n+        switch (inAppLayout) {\n+            case TOP:\n+                animationResource = R.anim.top_exit;\n+                break;\n+            case CENTER:\n+            case FULLSCREEN:\n+                animationResource = R.anim.fade_out_custom;\n+                break;\n+            case BOTTOM:\n+                animationResource = R.anim.bottom_exit;\n+                break;\n+            default:\n+                animationResource = R.anim.fade_out_custom;\n+        }\n+        Animation anim = AnimationUtils.loadAnimation(IterableApi.getInstance().getMainActivityContext(),\n+                animationResource);\n+        view.startAnimation(anim);\n+\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {\n+            view.postOnAnimationDelayed(parentViewDismissRunnable, 400);\n+        } else {\n+            parentViewDismissRunnable.run();\n+        }\n+    }\n+\n     interface HTMLNotificationCallbacks {\n         void onUrlClicked(String url);\n+\n         void setLoaded(boolean loaded);\n     }\n+\n }\n+\n+enum InAppLayout {", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NDE5MQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504164191", "bodyText": "InAppBgColor isn't actually used yet for background color, right?", "author": "vbabenkoru", "createdAt": "2020-10-13T18:17:26Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -142,6 +149,26 @@ public int hashCode() {\n         }\n     }\n \n+    public static class InAppDisplaySetting {\n+        boolean shouldAnimate;\n+        InAppBgColor inAppBgColor;\n+\n+        public InAppDisplaySetting(boolean shouldAnimate, InAppBgColor inAppBgColor) {\n+            this.shouldAnimate = shouldAnimate;\n+            this.inAppBgColor = inAppBgColor;\n+        }\n+    }\n+\n+    public static class InAppBgColor {\n+        String bgHexColor;", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDMwNjM0Mg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r504306342", "bodyText": "Yes, it is used.. In createInstance of IterableInAppFragmentHTMLNotification.", "author": "Ayyanchira", "createdAt": "2020-10-13T23:00:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE2NDE5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NzM4MQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r505077381", "bodyText": "We'll get a IllegalArgumentException if the color string is invalid here.. Can it possibly be invalid?", "author": "vbabenkoru", "createdAt": "2020-10-14T23:46:14Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -297,27 +333,20 @@ public void run() {\n                     if (insetPadding.bottom == 0 && insetPadding.top == 0) {\n                         //Handle full screen\n                         window.setLayout(webViewWidth, webViewHeight);\n-\n                         getDialog().getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);\n                     } else {\n-                        // Calculates the dialog size\n-                        double notificationWidth = 100 - (insetPadding.left + insetPadding.right);\n-                        float widthPercentage = (float) notificationWidth / 100;\n-                        int maxHeight = Math.min((int) (height * displayMetrics.scaledDensity), webViewHeight);\n-                        int maxWidth = Math.min(webViewWidth, (int) (webViewWidth * widthPercentage));\n-                        window.setLayout(maxWidth, maxHeight);\n-\n-                        //Calculates the horizontal position based on the dialog size\n-                        double center = (insetPadding.left + notificationWidth / 2f);\n-                        int offset = (int) ((center - 50) / 100f * webViewWidth);\n-\n-                        //Set the window properties\n-                        WindowManager.LayoutParams wlp = window.getAttributes();\n-                        wlp.x = offset;\n-                        wlp.gravity = getVerticalLocation(insetPadding);\n-                        wlp.dimAmount = (float) notification.backgroundAlpha;\n-                        wlp.flags = WindowManager.LayoutParams.FLAG_DIM_BEHIND;\n-                        window.setAttributes(wlp);\n+                        //Set background window fading if animation and backgroundAlpha/opacity configured\n+                        if (shouldAnimate && (inAppBackgroundColor != null)) {\n+                            window.setBackgroundDrawable(new ColorDrawable(Color.parseColor(inAppBackgroundColor)));", "originalCommit": "6eb309fed268f35cfb3603ac3353056080349361", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTQ5MTM5Mw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r505491393", "bodyText": "We would only get hex strings which should be passed from UI.. probably from a color selection..Shouldnt go wrong.. However, we can default it to transparent though if at all error occurs", "author": "Ayyanchira", "createdAt": "2020-10-15T12:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA3NzM4MQ=="}], "type": "inlineReview"}, {"oid": "897b4815d8a865586e1e01b080aaabfab8deec87", "url": "https://github.com/Iterable/iterable-android-sdk/commit/897b4815d8a865586e1e01b080aaabfab8deec87", "message": "Made Recommended Changes", "committedDate": "2020-10-15T12:14:05Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTExNQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508021115", "bodyText": "Hmm wondering if it's possible to replace these delays with something else..", "author": "vbabenkoru", "createdAt": "2020-10-19T19:50:00Z", "path": "app/src/androidTest/java/com/iterable/iterableapi/MainActivityTest.java", "diffHunk": "@@ -143,6 +143,7 @@ public void checkIfMessageShownAsPopUpForImproperIntent() throws Exception {\n         rule.launchActivity(intent);\n \n         onView(withText(\"Tips and tricks 2\")).perform(click());\n+        waitFor(500);", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODEwNDAxMg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508104012", "bodyText": "Other best alternative this code I found is waitFor(300)\n\ud83d\ude01\nJokes apart..\nThis looked like a different case than our regular threading issues where we could flush background Threads..\nMay be I can looking optimizing it in tomorrow's test day", "author": "Ayyanchira", "createdAt": "2020-10-19T22:41:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTExNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTUwNw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508021507", "bodyText": "Do you want to keep the duration here or move to xml? I think either option is valid.", "author": "vbabenkoru", "createdAt": "2020-10-19T19:50:39Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableConstants.java", "diffHunk": "@@ -204,6 +207,8 @@\n     public static final String ITERABLE_INBOX_IMPRESSIONS                = \"impressions\";\n     public static final String ITERABLE_INBOX_IMP_DISPLAY_COUNT          = \"displayCount\";\n     public static final String ITERABLE_INBOX_IMP_DISPLAY_DURATION       = \"displayDuration\";\n+    public static final String ITERABLE_IN_APP_SHOULD_ANIMATE            = \"shouldAnimate\";\n+    public static final int ITERABLE_IN_APP_ANIMATION_DURATION           = 500;", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTkwMA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508021900", "bodyText": "Yeah.. lets keep it here..", "author": "Ayyanchira", "createdAt": "2020-10-19T19:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTUwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTkzMw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508021933", "bodyText": "Is anything preventing us from removing it now? (Not necessarily in this PR)", "author": "vbabenkoru", "createdAt": "2020-10-19T19:51:25Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -53,8 +61,13 @@\n     private boolean callbackOnCancel = false;\n     private String htmlString;\n     private String messageId;\n+\n+    //TODO: To delete this variable in future iterations", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDU5OQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508024599", "bodyText": "We were skeptical if backend would ever send that value. But now that we know nothing had been implemented on backend side to send any old backgroundAlpha values, we can delete it right away.. But just to be safe not this time.", "author": "Ayyanchira", "createdAt": "2020-10-19T19:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTkzMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA2MTg5Nw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508061897", "bodyText": "Sounds good!", "author": "vbabenkoru", "createdAt": "2020-10-19T21:05:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMTkzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMzMzOA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508023338", "bodyText": "If we're converting padding to InAppLayout here anyway, I think it's better to also replace the condition 2 lines above that is still using insetPadding.", "author": "vbabenkoru", "createdAt": "2020-10-19T19:54:10Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -151,6 +155,8 @@ public void onBackPressed() {\n         dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\n         if (insetPadding.bottom == 0 && insetPadding.top == 0) {\n             dialog.getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);\n+        } else if (getInAppLayout(insetPadding) != InAppLayout.TOP) {", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMzgwNg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508023806", "bodyText": "Why are we only setting this if it's centered or bottom?", "author": "vbabenkoru", "createdAt": "2020-10-19T19:55:02Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -151,6 +155,8 @@ public void onBackPressed() {\n         dialog.requestWindowFeature(Window.FEATURE_NO_TITLE);\n         if (insetPadding.bottom == 0 && insetPadding.top == 0) {\n             dialog.getWindow().setFlags(WindowManager.LayoutParams.FLAG_FULLSCREEN, WindowManager.LayoutParams.FLAG_FULLSCREEN);\n+        } else if (getInAppLayout(insetPadding) != InAppLayout.TOP) {\n+            dialog.getWindow().setFlags(WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS, WindowManager.LayoutParams.FLAG_TRANSLUCENT_STATUS);", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNjc2Nw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508026767", "bodyText": "If we do translucent status for TOP, there is a small overlap of in app content and status bar which we discussed earlier. So to avoid that, TOP in apps will have opaque status bar with content starting right after it", "author": "Ayyanchira", "createdAt": "2020-10-19T20:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMzgwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA2MTc0Nw==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508061747", "bodyText": "I think it'd be helpful to add a comment here explaining this, so that next time someone looks at it, there is context for why it's done this way.", "author": "vbabenkoru", "createdAt": "2020-10-19T21:05:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyMzgwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDY5Ng==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508024696", "bodyText": "Background color is dependent on shouldAnimate being enabled. Is that what we want?", "author": "vbabenkoru", "createdAt": "2020-10-19T19:56:30Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -254,6 +261,108 @@ public void onBackPressed() {\n         IterableApi.sharedInstance.trackInAppClose(messageId, BACK_BUTTON, IterableInAppCloseAction.BACK, location);\n     }\n \n+    private void prepareToShowWebView() {\n+        try {\n+            webView.setAlpha(0.0f);\n+            webView.postDelayed(new Runnable() {\n+                @Override\n+                public void run() {\n+                    showAndAnimateWebView();\n+                }\n+            }, DELAY_THRESHOLD_MS);\n+            loadBackground();\n+        } catch (NullPointerException e) {\n+            IterableLogger.e(TAG, \"View not present. Failed to hide before resizing inapp\");\n+        }\n+    }\n+\n+    private void loadBackground() {\n+        if (shouldAnimate && (inAppBackgroundColor != null)) {", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNzcxOA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508027718", "bodyText": "I did mentioned it on Slab.. will followup on it urgently", "author": "Ayyanchira", "createdAt": "2020-10-19T20:01:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNDY5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyNTg3Mg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508025872", "bodyText": "Does this mean we don't animate on Android 4.2 and lower?", "author": "vbabenkoru", "createdAt": "2020-10-19T19:58:34Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -254,6 +261,108 @@ public void onBackPressed() {\n         IterableApi.sharedInstance.trackInAppClose(messageId, BACK_BUTTON, IterableInAppCloseAction.BACK, location);\n     }\n \n+    private void prepareToShowWebView() {\n+        try {\n+            webView.setAlpha(0.0f);\n+            webView.postDelayed(new Runnable() {\n+                @Override\n+                public void run() {\n+                    showAndAnimateWebView();\n+                }\n+            }, DELAY_THRESHOLD_MS);\n+            loadBackground();\n+        } catch (NullPointerException e) {\n+            IterableLogger.e(TAG, \"View not present. Failed to hide before resizing inapp\");\n+        }\n+    }\n+\n+    private void loadBackground() {\n+        if (shouldAnimate && (inAppBackgroundColor != null)) {\n+            ColorDrawable transparentDrawable = new ColorDrawable(Color.TRANSPARENT);\n+            int backgroundColorWithAlpha;\n+            try {\n+                backgroundColorWithAlpha = ColorUtils.setAlphaComponent(Color.parseColor(inAppBackgroundColor), (int) (inAppBackgroundAlpha * 255));\n+            } catch (IllegalArgumentException e) {\n+                IterableLogger.e(TAG, \"Background color could not be identified for input string \\\"\" + inAppBackgroundColor + \"\\\". Failed to animate background.\");\n+                return;\n+            }\n+\n+            ColorDrawable backgroundColorDrawable = new ColorDrawable(backgroundColorWithAlpha);\n+            Drawable[] layers = new Drawable[2];\n+            layers[0] = transparentDrawable;\n+            layers[1] = backgroundColorDrawable;\n+            TransitionDrawable transitionDrawable = new TransitionDrawable(layers);\n+            getDialog().getWindow().setBackgroundDrawable(transitionDrawable);\n+            transitionDrawable.startTransition(300);\n+        }\n+    }\n+\n+    private void showAndAnimateWebView() {\n+        webView.setAlpha(1.0f);\n+        webView.setVisibility(View.VISIBLE);\n+        if (shouldAnimate) {\n+            int animationResource;\n+            InAppLayout inAppLayout = getInAppLayout(insetPadding);\n+            switch (inAppLayout) {\n+                case TOP:\n+                    animationResource = R.anim.slide_down_custom;\n+                    break;\n+                case CENTER:\n+                case FULLSCREEN:\n+                    animationResource = R.anim.fade_in_custom;\n+                    break;\n+                case BOTTOM:\n+                    animationResource = R.anim.slide_up_custom;\n+                    break;\n+                default:\n+                    animationResource = R.anim.fade_in_custom;\n+            }\n+            Animation anim = AnimationUtils.loadAnimation(getContext(), animationResource);\n+            anim.setDuration(IterableConstants.ITERABLE_IN_APP_ANIMATION_DURATION);\n+            webView.startAnimation(anim);\n+        }\n+    }\n+\n+    private void hideWebView() {\n+        if (shouldAnimate) {\n+            int animationResource;\n+            InAppLayout inAppLayout = getInAppLayout(insetPadding);\n+\n+            switch (inAppLayout) {\n+                case TOP:\n+                    animationResource = R.anim.top_exit;\n+                    break;\n+                case CENTER:\n+                case FULLSCREEN:\n+                    animationResource = R.anim.fade_out_custom;\n+                    break;\n+                case BOTTOM:\n+                    animationResource = R.anim.bottom_exit;\n+                    break;\n+                default:\n+                    animationResource = R.anim.fade_out_custom;\n+            }\n+            Animation anim = AnimationUtils.loadAnimation(getContext(),\n+                    animationResource);\n+            anim.setDuration(IterableConstants.ITERABLE_IN_APP_ANIMATION_DURATION);\n+            webView.startAnimation(anim);\n+        }\n+\n+        Runnable dismissWebviewRunnable = new Runnable() {\n+            @Override\n+            public void run() {\n+                IterableInAppFragmentHTMLNotification.super.dismiss();\n+            }\n+        };\n+\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyODExNg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508028116", "bodyText": "Hmm, if we store padding values within inAppDisplaySettings, maybe it makes sense to move the padding values here as well? (Not necessarily within this PR)", "author": "vbabenkoru", "createdAt": "2020-10-19T20:02:26Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppMessage.java", "diffHunk": "@@ -142,6 +144,26 @@ public int hashCode() {\n         }\n     }\n \n+    public static class InAppDisplaySettings {", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODA5NzY2Ng==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508097666", "bodyText": "I think html and padding can go together at similar level and we can reserve inAppDisplaySettings for higher functionalities.. (May be custom animation parameters in future).", "author": "Ayyanchira", "createdAt": "2020-10-19T22:24:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAyODExNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzMDY3Mg==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508030672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        dismissWebviewRunnable.run();\n          \n          \n            \n                        webView.postDelayed(dismissWebviewRunnable, 400);", "author": "vbabenkoru", "createdAt": "2020-10-19T20:07:17Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableInAppFragmentHTMLNotification.java", "diffHunk": "@@ -254,6 +261,108 @@ public void onBackPressed() {\n         IterableApi.sharedInstance.trackInAppClose(messageId, BACK_BUTTON, IterableInAppCloseAction.BACK, location);\n     }\n \n+    private void prepareToShowWebView() {\n+        try {\n+            webView.setAlpha(0.0f);\n+            webView.postDelayed(new Runnable() {\n+                @Override\n+                public void run() {\n+                    showAndAnimateWebView();\n+                }\n+            }, DELAY_THRESHOLD_MS);\n+            loadBackground();\n+        } catch (NullPointerException e) {\n+            IterableLogger.e(TAG, \"View not present. Failed to hide before resizing inapp\");\n+        }\n+    }\n+\n+    private void loadBackground() {\n+        if (shouldAnimate && (inAppBackgroundColor != null)) {\n+            ColorDrawable transparentDrawable = new ColorDrawable(Color.TRANSPARENT);\n+            int backgroundColorWithAlpha;\n+            try {\n+                backgroundColorWithAlpha = ColorUtils.setAlphaComponent(Color.parseColor(inAppBackgroundColor), (int) (inAppBackgroundAlpha * 255));\n+            } catch (IllegalArgumentException e) {\n+                IterableLogger.e(TAG, \"Background color could not be identified for input string \\\"\" + inAppBackgroundColor + \"\\\". Failed to animate background.\");\n+                return;\n+            }\n+\n+            ColorDrawable backgroundColorDrawable = new ColorDrawable(backgroundColorWithAlpha);\n+            Drawable[] layers = new Drawable[2];\n+            layers[0] = transparentDrawable;\n+            layers[1] = backgroundColorDrawable;\n+            TransitionDrawable transitionDrawable = new TransitionDrawable(layers);\n+            getDialog().getWindow().setBackgroundDrawable(transitionDrawable);\n+            transitionDrawable.startTransition(300);\n+        }\n+    }\n+\n+    private void showAndAnimateWebView() {\n+        webView.setAlpha(1.0f);\n+        webView.setVisibility(View.VISIBLE);\n+        if (shouldAnimate) {\n+            int animationResource;\n+            InAppLayout inAppLayout = getInAppLayout(insetPadding);\n+            switch (inAppLayout) {\n+                case TOP:\n+                    animationResource = R.anim.slide_down_custom;\n+                    break;\n+                case CENTER:\n+                case FULLSCREEN:\n+                    animationResource = R.anim.fade_in_custom;\n+                    break;\n+                case BOTTOM:\n+                    animationResource = R.anim.slide_up_custom;\n+                    break;\n+                default:\n+                    animationResource = R.anim.fade_in_custom;\n+            }\n+            Animation anim = AnimationUtils.loadAnimation(getContext(), animationResource);\n+            anim.setDuration(IterableConstants.ITERABLE_IN_APP_ANIMATION_DURATION);\n+            webView.startAnimation(anim);\n+        }\n+    }\n+\n+    private void hideWebView() {\n+        if (shouldAnimate) {\n+            int animationResource;\n+            InAppLayout inAppLayout = getInAppLayout(insetPadding);\n+\n+            switch (inAppLayout) {\n+                case TOP:\n+                    animationResource = R.anim.top_exit;\n+                    break;\n+                case CENTER:\n+                case FULLSCREEN:\n+                    animationResource = R.anim.fade_out_custom;\n+                    break;\n+                case BOTTOM:\n+                    animationResource = R.anim.bottom_exit;\n+                    break;\n+                default:\n+                    animationResource = R.anim.fade_out_custom;\n+            }\n+            Animation anim = AnimationUtils.loadAnimation(getContext(),\n+                    animationResource);\n+            anim.setDuration(IterableConstants.ITERABLE_IN_APP_ANIMATION_DURATION);\n+            webView.startAnimation(anim);\n+        }\n+\n+        Runnable dismissWebviewRunnable = new Runnable() {\n+            @Override\n+            public void run() {\n+                IterableInAppFragmentHTMLNotification.super.dismiss();\n+            }\n+        };\n+\n+        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {\n+            webView.postOnAnimationDelayed(dismissWebviewRunnable, 400);\n+        } else {\n+            dismissWebviewRunnable.run();", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzMTk2MA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508031960", "bodyText": "assertTrue?", "author": "vbabenkoru", "createdAt": "2020-10-19T20:09:21Z", "path": "iterableapi/src/test/java/com/iterable/iterableapi/IterableInAppMessageTest.java", "diffHunk": "@@ -37,11 +37,19 @@ public void testInAppMessageDeserialization() throws Exception {\n                 //Stripping out HTML content from the copy\n                 JSONObject messageJsonHTMLStripped = new JSONObject(messageJson.toString());\n                 JSONObject content = (JSONObject) messageJsonHTMLStripped.get(\"content\");\n+                JSONObject inAppDisplaySettings = content.getJSONObject(\"inAppDisplaySettings\");\n+                assertEquals((Boolean) inAppDisplaySettings.get(\"shouldAnimate\"), true);", "originalCommit": "0cea9fbd82be4659a8cda72eb4e09a2d12cc317d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzNjc3OA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508036778", "bodyText": "Actually, you don't need any new code in this file.", "author": "vbabenkoru", "createdAt": "2020-10-19T20:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODAzMTk2MA=="}], "type": "inlineReview"}, {"oid": "64ee11ec10c10a40f9c79a42e8fc92d584db8a07", "url": "https://github.com/Iterable/iterable-android-sdk/commit/64ee11ec10c10a40f9c79a42e8fc92d584db8a07", "message": "[MOB-2054] - POC in-App Animation\n\nNot tested on real device, but it fails to show the smooth animation the very first time. But the consequent inapps have the animation.", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "5187880ad056671420e87d043edc87e08e2aee28", "url": "https://github.com/Iterable/iterable-android-sdk/commit/5187880ad056671420e87d043edc87e08e2aee28", "message": "[MOB-2047] - In-App animation\n\nAdded parameter to message content - shouldAnimate\nThis should be sent by the backend.\nBased on the flag, the animation will be shown/not shown", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "e6f60a138393d9894d2e654453d6b3d146d01c2e", "url": "https://github.com/Iterable/iterable-android-sdk/commit/e6f60a138393d9894d2e654453d6b3d146d01c2e", "message": "Resize WebView\n\nUse relative layout gravity instead to place the in-app in desired location.\nResizing logic indirectly moved to webview instead of its holding parent fragment.\nTODO: Need to delete out the commented code and Log comments before merging it to master.\nKept it for direct reference for changes to come.\nenum Layout is introduced for webviewClient to understand and animate accordingly. Changes will be added in next commits", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "273902f3aea5b9c565fc5f83995472b9cd8d1c33", "url": "https://github.com/Iterable/iterable-android-sdk/commit/273902f3aea5b9c565fc5f83995472b9cd8d1c33", "message": "passing hide/show functionality to webview\n\nInstead of parent fragment hiding and showing itself, making webview do it. This way, parent fragment can be free to just do the alpha transition.\nYes.. uncommented the alpha transition line to parent dimAmount", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "ed2cdf53a5730afe09db2a474d428610309fbc0a", "url": "https://github.com/Iterable/iterable-android-sdk/commit/ed2cdf53a5730afe09db2a474d428610309fbc0a", "message": "Conditional animation\n\n1. Adjusted the magic numbers which worked on most of the cases on emulator and actual device.\n2. Added sliding animations to top and bottom type in-apps.\n3. Added new animations to the suite as mentioned in the Figma doc.\n4. Adjusted the parent view dismissal roughly almost after the animation is performed.", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "45fbd2c11f342ac078d1ae8f264c377c38d350e4", "url": "https://github.com/Iterable/iterable-android-sdk/commit/45fbd2c11f342ac078d1ae8f264c377c38d350e4", "message": "Incorporated proposed parameters for inapp settings\n\n1. Removed unnecessary debug print codes\n2. Refactored some code\n3. Introduced InAppDisplaySetting inside Content field in Message. Although accurate JSON mapping is still not implemented\n4. Background Color implemented", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "20a6114597d569bd96501f605e0140ee4de5799b", "url": "https://github.com/Iterable/iterable-android-sdk/commit/20a6114597d569bd96501f605e0140ee4de5799b", "message": "Made Recommended Changes", "committedDate": "2020-10-19T22:50:36Z", "type": "commit"}, {"oid": "0c79d28949bdc40a9bada721bb43917899f67b32", "url": "https://github.com/Iterable/iterable-android-sdk/commit/0c79d28949bdc40a9bada721bb43917899f67b32", "message": "Some more refactoring", "committedDate": "2020-10-19T22:51:12Z", "type": "commit"}, {"oid": "825563d90d5f24d5c19174463b08561aee4f0f6d", "url": "https://github.com/Iterable/iterable-android-sdk/commit/825563d90d5f24d5c19174463b08561aee4f0f6d", "message": "Incorporated Alpha value correctly", "committedDate": "2020-10-19T22:51:12Z", "type": "commit"}, {"oid": "422c3edad98d83a20c10af1923c07454ea83dcff", "url": "https://github.com/Iterable/iterable-android-sdk/commit/422c3edad98d83a20c10af1923c07454ea83dcff", "message": "Added wait for inapp tests", "committedDate": "2020-10-19T22:51:12Z", "type": "commit"}, {"oid": "e40d7d1724a225219b20729d51ac6660042527fd", "url": "https://github.com/Iterable/iterable-android-sdk/commit/e40d7d1724a225219b20729d51ac6660042527fd", "message": "Found the real culprit hiding", "committedDate": "2020-10-19T22:51:12Z", "type": "commit"}, {"oid": "99dab8904e72342efade5e400bc550727695315a", "url": "https://github.com/Iterable/iterable-android-sdk/commit/99dab8904e72342efade5e400bc550727695315a", "message": "Using colorutils to set alpha value", "committedDate": "2020-10-19T22:51:12Z", "type": "commit"}, {"oid": "e0687cac64d24f4a8c23b6b5a29d2b7150816db8", "url": "https://github.com/Iterable/iterable-android-sdk/commit/e0687cac64d24f4a8c23b6b5a29d2b7150816db8", "message": "Review Revision 3\n\n1. Removed changes in test method as it is covered by the existing code already.\n2. Used getInAppLayout across the class there fullscreen condition using insetpadding was manually checked\n3. Added comments to why we do not show translucent status bar for TOP in-app\n4. Dismiss animation will now be triggered on in-app click\n5. Background will animate regardless of shouldAnimate variable\n6. Dismiss animation will work on older versions as well. Thanks for the commit suggestion", "committedDate": "2020-10-19T22:51:12Z", "type": "commit"}, {"oid": "e6133574331ce46a954209e9c90b39dcf445702d", "url": "https://github.com/Iterable/iterable-android-sdk/commit/e6133574331ce46a954209e9c90b39dcf445702d", "message": "Resolving merge conflict with master branch", "committedDate": "2020-10-19T22:57:06Z", "type": "commit"}, {"oid": "e0687cac64d24f4a8c23b6b5a29d2b7150816db8", "url": "https://github.com/Iterable/iterable-android-sdk/commit/e0687cac64d24f4a8c23b6b5a29d2b7150816db8", "message": "Review Revision 3\n\n1. Removed changes in test method as it is covered by the existing code already.\n2. Used getInAppLayout across the class there fullscreen condition using insetpadding was manually checked\n3. Added comments to why we do not show translucent status bar for TOP in-app\n4. Dismiss animation will now be triggered on in-app click\n5. Background will animate regardless of shouldAnimate variable\n6. Dismiss animation will work on older versions as well. Thanks for the commit suggestion", "committedDate": "2020-10-19T22:51:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcxNDA4Ng==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508714086", "bodyText": "Why do we set it to GONE here?", "author": "vbabenkoru", "createdAt": "2020-10-20T17:34:52Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableWebViewClient.java", "diffHunk": "@@ -24,6 +25,7 @@\n     @Override\n     public boolean shouldOverrideUrlLoading(WebView view, String url) {\n         inAppHTMLNotification.onUrlClicked(url);\n+        view.setVisibility(View.GONE);", "originalCommit": "f375965e2500b4d788967a66ba26fd93a98f46e3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcyNDAwOQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508724009", "bodyText": "Wow.. thank you so much! I dont think we need that code here. Totally forgot to remove this..", "author": "Ayyanchira", "createdAt": "2020-10-20T17:50:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODcxNDA4Ng=="}], "type": "inlineReview"}, {"oid": "a603586b2aa7e058679d2e759ecc9f418fe5aa1c", "url": "https://github.com/Iterable/iterable-android-sdk/commit/a603586b2aa7e058679d2e759ecc9f418fe5aa1c", "message": "Removing wait 500ms and unneccessary code\n\n1. The default state for message is to not show animation. And hence these test pass without needing to wait\n2. Removed unnecessary code: setting of webview visibility to GONE in shouldOverrideUrlLoading method in IterableWebViewClient", "committedDate": "2020-10-20T17:53:39Z", "type": "forcePushed"}, {"oid": "c9a10acae7adb88aac443cd1ece8c44812285b60", "url": "https://github.com/Iterable/iterable-android-sdk/commit/c9a10acae7adb88aac443cd1ece8c44812285b60", "message": "Removing wait 500ms and unneccessary code\n\n1. The default state for message is to not show animation. And hence these test pass without needing to wait\n2. Removed unnecessary code: setting of webview visibility to GONE in shouldOverrideUrlLoading method in IterableWebViewClient", "committedDate": "2020-10-20T18:06:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODczNjQxNQ==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508736415", "bodyText": "You can also revert this, since we don't use webViewClient field externally anymore.", "author": "vbabenkoru", "createdAt": "2020-10-20T18:10:42Z", "path": "iterableapi/src/main/java/com/iterable/iterableapi/IterableWebView.java", "diffHunk": "@@ -24,7 +25,7 @@\n      * @param html\n      */\n     void createWithHtml(IterableWebViewClient.HTMLNotificationCallbacks notificationDialog, String html) {\n-        IterableWebViewClient webViewClient = new IterableWebViewClient(notificationDialog);\n+        webViewClient = new IterableWebViewClient(notificationDialog);", "originalCommit": "c9a10acae7adb88aac443cd1ece8c44812285b60", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc0NDY5OA==", "url": "https://github.com/Iterable/iterable-android-sdk/pull/268#discussion_r508744698", "bodyText": "Missed out this one too... Thanks again", "author": "Ayyanchira", "createdAt": "2020-10-20T18:24:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODczNjQxNQ=="}], "type": "inlineReview"}, {"oid": "49a1462a5f700deef2a69aa706f7adc23b31be6a", "url": "https://github.com/Iterable/iterable-android-sdk/commit/49a1462a5f700deef2a69aa706f7adc23b31be6a", "message": "Review Revision 3\n\n1. The default state for message is to not show animation. And hence these test pass without needing to wait\n2. Removed unnecessary code: setting of webview visibility to GONE in shouldOverrideUrlLoading method in IterableWebViewClient\n3. Removed code from Iterable WebView to have global variable access to IterableWebViewClient", "committedDate": "2020-10-20T18:23:19Z", "type": "commit"}, {"oid": "49a1462a5f700deef2a69aa706f7adc23b31be6a", "url": "https://github.com/Iterable/iterable-android-sdk/commit/49a1462a5f700deef2a69aa706f7adc23b31be6a", "message": "Review Revision 3\n\n1. The default state for message is to not show animation. And hence these test pass without needing to wait\n2. Removed unnecessary code: setting of webview visibility to GONE in shouldOverrideUrlLoading method in IterableWebViewClient\n3. Removed code from Iterable WebView to have global variable access to IterableWebViewClient", "committedDate": "2020-10-20T18:23:19Z", "type": "forcePushed"}]}