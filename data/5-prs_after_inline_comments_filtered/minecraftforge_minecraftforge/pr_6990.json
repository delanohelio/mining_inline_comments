{"pr_number": 6990, "pr_title": "Fixed modded overworld biomes not spawning [1.16.x]", "pr_createdAt": "2020-07-18T16:10:51Z", "pr_url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990", "timeline": [{"oid": "e4fd29811a60c8692961d92595d0921e057c1845", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/e4fd29811a60c8692961d92595d0921e057c1845", "message": "Added support for modded forge biomes to the overworld through BiomeLayer", "committedDate": "2020-07-18T16:07:25Z", "type": "commit"}, {"oid": "377473e45d051a9f9f2c65180a8043ffda9f578d", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/377473e45d051a9f9f2c65180a8043ffda9f578d", "message": "Fixed formatting and fingers crossed fixed the hunk target errors", "committedDate": "2020-07-18T19:29:38Z", "type": "commit"}, {"oid": "96f1169676aa24e912646eb045af5cedadc34cff", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/96f1169676aa24e912646eb045af5cedadc34cff", "message": "Re-added fields due to request", "committedDate": "2020-07-18T21:12:42Z", "type": "commit"}, {"oid": "d7e07d68e5e56f3b2556149f802a4eebc1470b01", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/d7e07d68e5e56f3b2556149f802a4eebc1470b01", "message": "Cleaned useless vanilla biome check in `getWeightedBiomeEntry`", "committedDate": "2020-07-21T22:07:22Z", "type": "commit"}, {"oid": "7741b6e61a6d6223d7f8c23f3d815b373a6e3151", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/7741b6e61a6d6223d7f8c23f3d815b373a6e3151", "message": "Revert \"Cleaned useless vanilla biome check in `getWeightedBiomeEntry`\"\n\nThis reverts commit d7e07d68e5e56f3b2556149f802a4eebc1470b01.", "committedDate": "2020-07-23T00:46:30Z", "type": "commit"}, {"oid": "636d70e0ba92093254d25e3f9515df4bfea5ebcd", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/636d70e0ba92093254d25e3f9515df4bfea5ebcd", "message": "Requested changes made", "committedDate": "2020-07-23T12:57:04Z", "type": "commit"}, {"oid": "031669276e87628634113079678ec58fbd3454ad", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/031669276e87628634113079678ec58fbd3454ad", "message": "Test mod", "committedDate": "2020-07-23T15:17:06Z", "type": "commit"}, {"oid": "ea12219d1011210430499929c9dee0a29009def4", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ea12219d1011210430499929c9dee0a29009def4", "message": "Moved `getWeightedBiomeEntry` to `BiomeManager`, can be reverted if needed.", "committedDate": "2020-07-23T19:13:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg2OTMzNw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990#discussion_r459869337", "bodyText": "This method can probably be renamed to getWeightedBiome and just return the Biome, since the weight value is only needed here and not in BiomeLayer.", "author": "srs-bsns", "createdAt": "2020-07-24T06:14:34Z", "path": "src/main/java/net/minecraftforge/common/BiomeManager.java", "diffHunk": "@@ -154,6 +155,16 @@ public BiomeEntry(Biome biome, int weight)\n         }\n     }\n \n+    public static BiomeEntry getWeightedBiomeEntry(BiomeType type, INoiseRandom context)\n+    {\n+        List<BiomeEntry> biomeList = biomes[type.ordinal()];\n+\n+        int totalWeight = WeightedRandom.getTotalWeight(biomeList);\n+        int weight = isTypeListModded(type) ? context.random(totalWeight) : context.random(totalWeight / 10) * 10;\n+\n+        return WeightedRandom.getRandomItem(biomeList, weight);\n+    }", "originalCommit": "ea12219d1011210430499929c9dee0a29009def4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAyMjE0OA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990#discussion_r460022148", "bodyText": "True, but it may be useful for other things that we haven't thought about to use this method and get the weight", "author": "RiverHaven", "createdAt": "2020-07-24T12:29:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg2OTMzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI2OTg1Mg==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990#discussion_r460269852", "bodyText": "Even if the weight value is useful for other processes, those other processes should probably be handled within BiomeManager or in other processes called from it, and not done within BiomeLayer, which would also require further patching it. At the point that this method returns, it should only be the Biome, since that it all that is consequential in BiomeLayer.", "author": "srs-bsns", "createdAt": "2020-07-24T20:21:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg2OTMzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI3NzQwNg==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990#discussion_r460277406", "bodyText": "@Xerousso You can leave it like this.\nIt does not hurt to have it return BiomeEntry instead of biome.", "author": "OrionDevelopment", "createdAt": "2020-07-24T20:39:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTg2OTMzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI3Nzg1MA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990#discussion_r460277850", "bodyText": "See the other mods on how todo these. Most notably missing is a way to disable a given testmod.", "author": "OrionDevelopment", "createdAt": "2020-07-24T20:40:58Z", "path": "src/test/java/net/minecraftforge/debug/world/ModdedOverworldBiomesTest.java", "diffHunk": "@@ -0,0 +1,52 @@\n+package net.minecraftforge.debug.world;\n+\n+import net.minecraft.world.biome.Biome;\n+import net.minecraft.world.biome.Biome.Category;\n+import net.minecraft.world.biome.Biome.RainType;\n+import net.minecraft.world.biome.BiomeAmbience;\n+import net.minecraft.world.biome.MoodSoundAmbience;\n+import net.minecraft.world.gen.surfacebuilders.SurfaceBuilder;\n+import net.minecraftforge.common.BiomeManager;\n+import net.minecraftforge.common.BiomeManager.BiomeEntry;\n+import net.minecraftforge.common.BiomeManager.BiomeType;\n+import net.minecraftforge.eventbus.api.IEventBus;\n+import net.minecraftforge.fml.RegistryObject;\n+import net.minecraftforge.fml.common.Mod;\n+import net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent;\n+import net.minecraftforge.fml.javafmlmod.FMLJavaModLoadingContext;\n+import net.minecraftforge.registries.DeferredRegister;\n+import net.minecraftforge.registries.ForgeRegistries;\n+\n+@Mod(value = ModdedOverworldBiomesTest.MOD_ID)\n+public class ModdedOverworldBiomesTest\n+{\n+    public static final String MOD_ID = \"modded_overworld_biomes_test\";\n+\n+    private static DeferredRegister<Biome> BIOMES = DeferredRegister.create(ForgeRegistries.BIOMES, MOD_ID);\n+    private static RegistryObject<Biome> redBiome = BIOMES.register(\"red_biome\", () -> new Biome(new Biome.Builder()\n+            .surfaceBuilder(SurfaceBuilder.DEFAULT, SurfaceBuilder.GRASS_DIRT_GRAVEL_CONFIG).precipitation(RainType.RAIN)\n+            .depth(1f).scale(1f).temperature(1f).downfall(1f).category(Category.PLAINS)\n+            .func_235097_a_(new BiomeAmbience.Builder().func_235246_b_(4159204).func_235248_c_(329011)\n+                    .func_235239_a_(12638463).func_235243_a_(MoodSoundAmbience.field_235027_b_).func_235238_a_())\n+            .parent((String) null))\n+    {\n+        @Override\n+        public int getGrassColor(double posX, double posZ)\n+        {\n+            return 0xff0000;\n+        }\n+    });\n+\n+    public ModdedOverworldBiomesTest()\n+    {\n+        FMLJavaModLoadingContext.get().getModEventBus().addListener(this::setup);\n+        IEventBus modBus = FMLJavaModLoadingContext.get().getModEventBus();\n+        BIOMES.register(modBus);\n+    }\n+\n+    private void setup(final FMLCommonSetupEvent event)\n+    {\n+        BiomeManager.addBiome(BiomeType.WARM, new BiomeEntry(redBiome.get(), 200));\n+    }", "originalCommit": "ea12219d1011210430499929c9dee0a29009def4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDMwMzUzNA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6990#discussion_r460303534", "bodyText": "Done.", "author": "RiverHaven", "createdAt": "2020-07-24T21:51:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI3Nzg1MA=="}], "type": "inlineReview"}, {"oid": "86e1700d025dfd49dc881a05a8aac7cb02003166", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/86e1700d025dfd49dc881a05a8aac7cb02003166", "message": "Updated test mod", "committedDate": "2020-07-24T21:50:17Z", "type": "commit"}, {"oid": "577a07b3efea3a9780fe87a05d53eb362035a9bc", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/577a07b3efea3a9780fe87a05d53eb362035a9bc", "message": "Removed @Deprecated annotation on private fields", "committedDate": "2020-07-25T11:34:03Z", "type": "commit"}]}