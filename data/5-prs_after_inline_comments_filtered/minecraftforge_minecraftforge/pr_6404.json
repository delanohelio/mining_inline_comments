{"pr_number": 6404, "pr_title": "[1.15] Reimplemented the ITeleporter interface", "pr_createdAt": "2020-01-02T17:18:14Z", "pr_url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404", "timeline": [{"oid": "ef459be2889520a052e6fc23d73948d7295b2b53", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/ef459be2889520a052e6fc23d73948d7295b2b53", "message": "reimplemented ITeleporter interface", "committedDate": "2020-01-02T17:10:58Z", "type": "commit"}, {"oid": "18810fc77c6b2b07658df7a85dd15226bc1e293e", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/18810fc77c6b2b07658df7a85dd15226bc1e293e", "message": "added licence header", "committedDate": "2020-01-02T17:13:07Z", "type": "commit"}, {"oid": "de3dd89041abcdf6dbcd151c4f4b6c93d30c85e4", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/de3dd89041abcdf6dbcd151c4f4b6c93d30c85e4", "message": "added forge.exc entry", "committedDate": "2020-01-02T17:36:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc2OTY1NQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r362769655", "bodyText": "We use 4 spaces in forge, and please put the brace on a newline for consistency in this class", "author": "ichttt", "createdAt": "2020-01-03T10:51:17Z", "path": "src/main/java/net/minecraftforge/server/command/PortallessTeleporter.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2019.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.server.command;\n+\n+import java.util.function.Function;\n+\n+import net.minecraft.entity.Entity;\n+import net.minecraft.world.server.ServerWorld;\n+import net.minecraftforge.common.util.ITeleporter;\n+\n+public class PortallessTeleporter implements ITeleporter \n+{\n+\n+   @Override\n+   public Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {", "originalCommit": "de3dd89041abcdf6dbcd151c4f4b6c93d30c85e4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc3MTk3OA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r362771978", "bodyText": "I don't see this used anywhere, is this still needed when using the new placeEntity semantics?", "author": "ichttt", "createdAt": "2020-01-03T10:59:42Z", "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -0,0 +1,66 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2019.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.common.util;\n+\n+import java.util.function.Function;\n+\n+import net.minecraft.entity.Entity;\n+import net.minecraft.world.Teleporter;\n+import net.minecraft.world.dimension.Dimension;\n+import net.minecraft.world.server.ServerWorld;\n+\n+/**\n+ * Interface for handling the placement of entities during dimension change.\n+ *\n+ * An implementation of this interface can be used to place the entity\n+ * in a safe location, or generate a return portal, for instance.\n+ *\n+ * See the {@link net.minecraft.world.Teleporter} class, which has\n+ * been patched to implement this interface, for a vanilla example.\n+ */\n+public interface ITeleporter {\n+\n+    /**\n+     * Called to handle placing the entity in the new world.\n+     *\n+     * The initial position of the entity will be its\n+     * position in the origin world, multiplied horizontally\n+     * by the computed cross-dimensional movement factor\n+     * (see {@link Dimension#getMovementFactor()}).\n+     *\n+     * Note that the supplied entity has not yet been spawned\n+     * in the destination world at the time.\n+     *\n+     * @param entity           the entity to be placed\n+     * @param currentWorld     the entity's origin\n+     * @param destWorld        the entity's destination\n+     * @param yaw              the suggested yaw value to apply\n+     * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     */\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {\n+       return repositionEntity.apply(true);\n+    }\n+\n+    // used internally to handle vanilla hardcoding\n+    default boolean isVanilla()", "originalCommit": "de3dd89041abcdf6dbcd151c4f4b6c93d30c85e4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc5MTAyMA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r362791020", "bodyText": "Right this is not needed anymore", "author": "mcenderdragon", "createdAt": "2020-01-03T12:21:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjc3MTk3OA=="}], "type": "inlineReview"}, {"oid": "398770ef5e99b4babad8f088826cdfb580ca080d", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/398770ef5e99b4babad8f088826cdfb580ca080d", "message": "fixed indention", "committedDate": "2020-01-03T16:06:57Z", "type": "commit"}, {"oid": "3987b33832df93bac3d38fdafb19202a149864cf", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/3987b33832df93bac3d38fdafb19202a149864cf", "message": "fixed changeDimension in overriding entities", "committedDate": "2020-01-03T16:14:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk3NzMxMw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r363977313", "bodyText": "You don't describe what the return should be, so the docs are incomplete.", "author": "LexManos", "createdAt": "2020-01-07T22:13:32Z", "path": "src/main/java/net/minecraftforge/common/util/ITeleporter.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Minecraft Forge\n+ * Copyright (c) 2016-2019.\n+ *\n+ * This library is free software; you can redistribute it and/or\n+ * modify it under the terms of the GNU Lesser General Public\n+ * License as published by the Free Software Foundation version 2.1\n+ * of the License.\n+ *\n+ * This library is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU\n+ * Lesser General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU Lesser General Public\n+ * License along with this library; if not, write to the Free Software\n+ * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301  USA\n+ */\n+\n+package net.minecraftforge.common.util;\n+\n+import java.util.function.Function;\n+\n+import net.minecraft.entity.Entity;\n+import net.minecraft.world.Teleporter;\n+import net.minecraft.world.dimension.Dimension;\n+import net.minecraft.world.server.ServerWorld;\n+\n+/**\n+ * Interface for handling the placement of entities during dimension change.\n+ *\n+ * An implementation of this interface can be used to place the entity\n+ * in a safe location, or generate a return portal, for instance.\n+ *\n+ * See the {@link net.minecraft.world.Teleporter} class, which has\n+ * been patched to implement this interface, for a vanilla example.\n+ */\n+public interface ITeleporter {\n+\n+    /**\n+     * Called to handle placing the entity in the new world.\n+     *\n+     * The initial position of the entity will be its\n+     * position in the origin world, multiplied horizontally\n+     * by the computed cross-dimensional movement factor\n+     * (see {@link Dimension#getMovementFactor()}).\n+     *\n+     * Note that the supplied entity has not yet been spawned\n+     * in the destination world at the time.\n+     *\n+     * @param entity           the entity to be placed\n+     * @param currentWorld     the entity's origin\n+     * @param destWorld        the entity's destination\n+     * @param yaw              the suggested yaw value to apply\n+     * @param repositionEntity a function to reposition the entity, which returns the new entity in the new dimension. This is the vanilla implementation of the dimension travel logic. If the supplied boolean is true, it is attempted to spawn a new portal.\n+     */\n+    default Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) {", "originalCommit": "3987b33832df93bac3d38fdafb19202a149864cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2MzcyNQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r365263725", "bodyText": "I fixed this.", "author": "mcenderdragon", "createdAt": "2020-01-10T14:38:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk3NzMxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk3NzQzMA==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r363977430", "bodyText": "Shouldn't need to recreate this every invocation.  Or at the very least, just make it a lambda", "author": "LexManos", "createdAt": "2020-01-07T22:13:53Z", "path": "src/main/java/net/minecraftforge/server/command/CommandSetDimension.java", "diffHunk": "@@ -64,7 +64,7 @@ private static int execute(CommandSource sender, Collection<? extends Entity> en\n         //    throw INVALID_DIMENSION.create(dim);\n \n         entities.stream().filter(e -> e.dimension == dim).forEach(e -> sender.sendFeedback(new TranslationTextComponent(\"commands.forge.setdim.invalid.nochange\", e.getDisplayName().getFormattedText(), dim), true));\n-        entities.stream().filter(e -> e.dimension != dim).forEach(e ->  e.changeDimension(dim));\n+        entities.stream().filter(e -> e.dimension != dim).forEach(e ->  e.changeDimension(dim, new PortallessTeleporter()));", "originalCommit": "3987b33832df93bac3d38fdafb19202a149864cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTI2MzgyMw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r365263823", "bodyText": "fixed.", "author": "mcenderdragon", "createdAt": "2020-01-10T14:38:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk3NzQzMA=="}], "type": "inlineReview"}, {"oid": "fe3b84b8509027f15e9499613fd7a60d3f549af0", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/fe3b84b8509027f15e9499613fd7a60d3f549af0", "message": "fixed description of ITeleporter", "committedDate": "2020-01-10T14:34:20Z", "type": "commit"}, {"oid": "36fee8a578c70d8da77e5b0727000eadb3d7215d", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/36fee8a578c70d8da77e5b0727000eadb3d7215d", "message": "no longer make a new instance of PortallessTeleporter each time.", "committedDate": "2020-01-10T14:35:02Z", "type": "commit"}, {"oid": "470028b4377ed440adf2ae51a48812f77e565644", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/470028b4377ed440adf2ae51a48812f77e565644", "message": "added player instacne test & comments", "committedDate": "2020-01-10T14:38:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NDM3OQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r367174379", "bodyText": "Remove, replace with lambda, (_,_,_,_,repos) -> repos.apply(false)", "author": "LexManos", "createdAt": "2020-01-16T00:19:18Z", "path": "src/main/java/net/minecraftforge/server/command/PortallessTeleporter.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Minecraft Forge", "originalCommit": "470028b4377ed440adf2ae51a48812f77e565644", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzM3MDAwMw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r367370003", "bodyText": "This is not possible since ITeleporter would need to be a functional interface then, and functional interfaces are not allowed to be only a default method.", "author": "mcenderdragon", "createdAt": "2020-01-16T11:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NDM3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzUwOTQxNw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r367509417", "bodyText": "Should I increase patch size of the Teleporter class to make it a functional interface?", "author": "mcenderdragon", "createdAt": "2020-01-16T16:11:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NDM3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzU5NDI1OQ==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r367594259", "bodyText": "Lambda should be possible if the interface is a single method even with a default. I'd have to check later but I could of sworn that I've done that before... But the point is I dont want this 'PortalessTeleporter' class as public api we have to maintain.", "author": "LexManos", "createdAt": "2020-01-16T19:00:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NDM3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Nzg4Njc2Mw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r367886763", "bodyText": "unterstandable, would a anonymous inner class be better?\nso something like\nprivate static ITeleporter portalless = new ITeleporter(){\n    @Override\n    public Entity placeEntity(Entity entity, ServerWorld currentWorld, ServerWorld destWorld, float yaw, Function<Boolean, Entity> repositionEntity) \n    {\n        return repositionEntity.apply(false);\n    }\n}", "author": "mcenderdragon", "createdAt": "2020-01-17T11:15:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NDM3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA3NzcwMw==", "url": "https://github.com/MinecraftForge/MinecraftForge/pull/6404#discussion_r370077703", "bodyText": "Now it is no longer public api.", "author": "mcenderdragon", "createdAt": "2020-01-23T11:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzE3NDM3OQ=="}], "type": "inlineReview"}, {"oid": "a54ee7417b896e7f040ad86c07a959d4fa6e7dd5", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/a54ee7417b896e7f040ad86c07a959d4fa6e7dd5", "message": "deleted PortallessTeleporterand replaced with lambda", "committedDate": "2020-01-16T11:29:03Z", "type": "commit"}, {"oid": "b95ac359e635a11cb063e38b1f39d8381faaaacc", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/b95ac359e635a11cb063e38b1f39d8381faaaacc", "message": "Revert \"deleted PortallessTeleporterand replaced with lambda\" - ITeleporter is not a functional interface\n\nThis reverts commit a54ee7417b896e7f040ad86c07a959d4fa6e7dd5.", "committedDate": "2020-01-16T11:35:50Z", "type": "commit"}, {"oid": "629d1a9339a659317fa2c0317fb0d329c0336bbd", "url": "https://github.com/MinecraftForge/MinecraftForge/commit/629d1a9339a659317fa2c0317fb0d329c0336bbd", "message": "changed PortallessTeleporter to anonymous inner class", "committedDate": "2020-01-23T11:56:07Z", "type": "commit"}]}