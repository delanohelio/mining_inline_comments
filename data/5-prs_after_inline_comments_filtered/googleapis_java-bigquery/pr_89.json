{"pr_number": 89, "pr_title": "feat: new sample - Tables: Relax column", "pr_createdAt": "2020-01-08T22:17:42Z", "pr_url": "https://github.com/googleapis/java-bigquery/pull/89", "timeline": [{"oid": "f5955bc5be4c5d1d7f542814ad23d134b0bcae06", "url": "https://github.com/googleapis/java-bigquery/commit/f5955bc5be4c5d1d7f542814ad23d134b0bcae06", "message": "feat: new sample - Tables: Relax column", "committedDate": "2020-01-08T22:17:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg0MTgzOQ==", "url": "https://github.com/googleapis/java-bigquery/pull/89#discussion_r364841839", "bodyText": "nit: Probably don't need this comment in the test?", "author": "kurtisvg", "createdAt": "2020-01-09T16:37:31Z", "path": "samples/src/test/java/com/example/bigquery/RelaxColumnModeIT.java", "diffHunk": "@@ -0,0 +1,91 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static junit.framework.TestCase.assertNotNull;\n+\n+import com.google.cloud.bigquery.Field;\n+import com.google.cloud.bigquery.Field.Mode;\n+import com.google.cloud.bigquery.LegacySQLTypeName;\n+import com.google.cloud.bigquery.Schema;\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.util.UUID;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+public class RelaxColumnModeIT {\n+  private ByteArrayOutputStream bout;\n+  private PrintStream out;\n+\n+  private static final String BIGQUERY_DATASET_NAME = System.getenv(\"BIGQUERY_DATASET_NAME\");\n+\n+  private static void requireEnvVar(String varName) {\n+    assertNotNull(\n+        \"Environment variable \" + varName + \" is required to perform these tests.\",\n+        System.getenv(varName));\n+  }\n+\n+  @BeforeClass\n+  public static void checkRequirements() {\n+    requireEnvVar(\"BIGQUERY_DATASET_NAME\");\n+  }\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    bout = new ByteArrayOutputStream();\n+    out = new PrintStream(bout);\n+    System.setOut(out);\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    System.setOut(null);\n+  }\n+\n+  @Test\n+  public void testRelaxColumnMode() {\n+    // Create a new table with REQUIRED columns for each test to relax its column mode since this is\n+    // a one-way operation\n+    String generatedTableName =\n+        \"gcloud_test_table_temp_\" + UUID.randomUUID().toString().replace('-', '_');\n+    Schema originalSchema =\n+        Schema.of(\n+            // The only supported modification you can make to a column's mode is changing it from\n+            // REQUIRED to NULLABLE\n+            // Changing a column's mode from REQUIRED to NULLABLE is also called column relaxation\n+            // INFO: LegacySQLTypeName will be updated to StandardSQLTypeName in release 1.103.0", "originalCommit": "f5955bc5be4c5d1d7f542814ad23d134b0bcae06", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDg1NzM4OA==", "url": "https://github.com/googleapis/java-bigquery/pull/89#discussion_r364857388", "bodyText": "nit: This seems to imply that you are modifying an existing Schema, but really you are rebuilding a new schema from scratch here. Would it be better to show the users how to retrieve the current Schema, and then modify the necessary fields instead of rebuilding from scratch?", "author": "kurtisvg", "createdAt": "2020-01-09T17:05:14Z", "path": "samples/src/main/java/com/example/bigquery/RelaxColumnMode.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.Field;\n+import com.google.cloud.bigquery.LegacySQLTypeName;\n+import com.google.cloud.bigquery.Schema;\n+import com.google.cloud.bigquery.StandardTableDefinition;\n+import com.google.cloud.bigquery.Table;\n+\n+// [START bigquery_relax_column]\n+public class RelaxColumnMode {\n+\n+  public static void runRelaxColumnMode() {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String datasetName = \"MY_DATASET_NAME\";\n+    String tableId = \"MY_TABLE_NAME\";\n+    relaxColumnMode(datasetName, tableId);\n+  }\n+\n+  public static void relaxColumnMode(String datasetName, String tableId) {\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery = BigQueryOptions.getDefaultInstance().getService();\n+\n+      Table table = bigquery.getTable(datasetName, tableId);\n+\n+      // Create new relaxed schema based on the existing table schema", "originalCommit": "f5955bc5be4c5d1d7f542814ad23d134b0bcae06", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}