{"pr_number": 763, "pr_title": "docs(samples): add query external bigtable using temp table", "pr_createdAt": "2020-09-30T11:55:19Z", "pr_url": "https://github.com/googleapis/java-bigquery/pull/763", "timeline": [{"oid": "0e269f42a4f957ef55039aaeec60ce64f28d27b4", "url": "https://github.com/googleapis/java-bigquery/commit/0e269f42a4f957ef55039aaeec60ce64f28d27b4", "message": "docs(samples): add query external bigtable using temp table", "committedDate": "2020-09-30T11:53:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNjMwNQ==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r497736305", "bodyText": "we have a sample schema for bigtable we've been using that would be good to include here so it feels a little more realistic. I'll send you a doc with the schema\ntable name: mobile-time-series\ncolumn families: stats_summary\ncolumns: os_build (STRING), os_name (STRING)", "author": "billyjacobson", "createdAt": "2020-09-30T19:04:31Z", "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalBigtableTemp.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_query_external_bigtable_temp]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.BigtableColumn;\n+import com.google.cloud.bigquery.BigtableColumnFamily;\n+import com.google.cloud.bigquery.BigtableOptions;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.TableResult;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.codec.binary.Base64;\n+\n+// Sample to queries an external bigtable data source using a temporary table\n+public class QueryExternalBigtableTemp {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String instanceId = \"MY_INSTANCE_ID\";\n+    String bigtableName = \"MY_BIGTABLE_NAME\";\n+    String tableName = \"MY_TABLE_NAME\";\n+    String sourceUri =\n+        \"https://googleapis.com/bigtable/projects/\"\n+            + projectId\n+            + \"/instances/\"\n+            + instanceId\n+            + \"/tables/\"\n+            + bigtableName;\n+    String query = String.format(\"SELECT * FROM %s \", tableName);\n+    queryExternalBigtableTemp(tableName, sourceUri, query);\n+  }\n+\n+  public static void queryExternalBigtableTemp(String tableName, String sourceUri, String query) {", "originalCommit": "0e269f42a4f957ef55039aaeec60ce64f28d27b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzMzM1NQ==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r498933355", "bodyText": "https://github.com/googleapis/java-bigtable/blob/master/samples/snippets/src/test/java/com/example/bigtable/ReadsTest.java\nLet's stick to the existing table schema as shown above instead of using our own schema and stream in data in the beforeClass() method. We can keep the table name as bigquery-samples-test", "author": "stephaniewang526", "createdAt": "2020-10-02T16:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNjMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNjg3OA==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r497736878", "bodyText": "Could you define the column family first and then add the columns and build after? It will make more sense for someone from Bigtable following since column families are the higher level grouping", "author": "billyjacobson", "createdAt": "2020-09-30T19:05:33Z", "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalBigtableTemp.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_query_external_bigtable_temp]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.BigtableColumn;\n+import com.google.cloud.bigquery.BigtableColumnFamily;\n+import com.google.cloud.bigquery.BigtableOptions;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.TableResult;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.codec.binary.Base64;\n+\n+// Sample to queries an external bigtable data source using a temporary table\n+public class QueryExternalBigtableTemp {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String instanceId = \"MY_INSTANCE_ID\";\n+    String bigtableName = \"MY_BIGTABLE_NAME\";\n+    String tableName = \"MY_TABLE_NAME\";\n+    String sourceUri =\n+        \"https://googleapis.com/bigtable/projects/\"\n+            + projectId\n+            + \"/instances/\"\n+            + instanceId\n+            + \"/tables/\"\n+            + bigtableName;\n+    String query = String.format(\"SELECT * FROM %s \", tableName);\n+    queryExternalBigtableTemp(tableName, sourceUri, query);\n+  }\n+\n+  public static void queryExternalBigtableTemp(String tableName, String sourceUri, String query) {\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery = BigQueryOptions.getDefaultInstance().getService();\n+\n+      BigtableColumn name =\n+          BigtableColumn.newBuilder()\n+              .setQualifierEncoded(Base64.encodeBase64String(\"name\".getBytes()))\n+              .setFieldName(\"name\")\n+              .setType(\"STRING\")\n+              .setEncoding(\"TEXT\")\n+              .build();\n+      BigtableColumn postAbbr =\n+          BigtableColumn.newBuilder()\n+              .setQualifierEncoded(Base64.encodeBase64String(\"post_abbr\".getBytes()))\n+              .setFieldName(\"post_abbr\")\n+              .setType(\"STRING\")\n+              .setEncoding(\"TEXT\")\n+              .build();\n+      BigtableColumnFamily usStates =", "originalCommit": "0e269f42a4f957ef55039aaeec60ce64f28d27b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODIxNTIzNA==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r498215234", "bodyText": "@billyjacobson It's not possible to main order, because first we need to create an object of BigtableColumn then we can set those columns in BigtableColumnFamily.", "author": "pmakani", "createdAt": "2020-10-01T12:45:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNjg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzMjA1Mg==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r498932052", "bodyText": "we could first instantiate an empty BigtableColumnFamily object and then add columns to it.", "author": "stephaniewang526", "createdAt": "2020-10-02T16:42:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNjg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNzE0Mw==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r497737143", "bodyText": "s/Configure/Configuring", "author": "billyjacobson", "createdAt": "2020-09-30T19:06:05Z", "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalBigtableTemp.java", "diffHunk": "@@ -0,0 +1,110 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_query_external_bigtable_temp]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.BigtableColumn;\n+import com.google.cloud.bigquery.BigtableColumnFamily;\n+import com.google.cloud.bigquery.BigtableOptions;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.TableResult;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.codec.binary.Base64;\n+\n+// Sample to queries an external bigtable data source using a temporary table\n+public class QueryExternalBigtableTemp {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String instanceId = \"MY_INSTANCE_ID\";\n+    String bigtableName = \"MY_BIGTABLE_NAME\";\n+    String tableName = \"MY_TABLE_NAME\";\n+    String sourceUri =\n+        \"https://googleapis.com/bigtable/projects/\"\n+            + projectId\n+            + \"/instances/\"\n+            + instanceId\n+            + \"/tables/\"\n+            + bigtableName;\n+    String query = String.format(\"SELECT * FROM %s \", tableName);\n+    queryExternalBigtableTemp(tableName, sourceUri, query);\n+  }\n+\n+  public static void queryExternalBigtableTemp(String tableName, String sourceUri, String query) {\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery = BigQueryOptions.getDefaultInstance().getService();\n+\n+      BigtableColumn name =\n+          BigtableColumn.newBuilder()\n+              .setQualifierEncoded(Base64.encodeBase64String(\"name\".getBytes()))\n+              .setFieldName(\"name\")\n+              .setType(\"STRING\")\n+              .setEncoding(\"TEXT\")\n+              .build();\n+      BigtableColumn postAbbr =\n+          BigtableColumn.newBuilder()\n+              .setQualifierEncoded(Base64.encodeBase64String(\"post_abbr\".getBytes()))\n+              .setFieldName(\"post_abbr\")\n+              .setType(\"STRING\")\n+              .setEncoding(\"TEXT\")\n+              .build();\n+      BigtableColumnFamily usStates =\n+          BigtableColumnFamily.newBuilder()\n+              .setColumns(ImmutableList.of(name, postAbbr))\n+              .setFamilyID(\"us-states\")\n+              .setOnlyReadLatest(true)\n+              .setEncoding(\"TEXT\")\n+              .setType(\"STRING\")\n+              .build();\n+\n+      // Configure BigtableOptions is optional.", "originalCommit": "0e269f42a4f957ef55039aaeec60ce64f28d27b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk3NDMzOA==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r498974338", "bodyText": "done", "author": "stephaniewang526", "createdAt": "2020-10-02T18:11:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczNzE0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczODc4NA==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r497738784", "bodyText": "how will this test work? Is this just going to be an existing bigtable instance that gets used for all the tests?\nIt might be better to create/tear down an instance during the test, but we can discuss and I have code that you can copy/paste that will take care of it all for you. Let me know what you want to do", "author": "billyjacobson", "createdAt": "2020-09-30T19:09:09Z", "path": "samples/snippets/src/test/java/com/example/bigquery/QueryExternalBigtableTempIT.java", "diffHunk": "@@ -0,0 +1,79 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static junit.framework.TestCase.assertNotNull;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.PrintStream;\n+import java.util.UUID;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+public class QueryExternalBigtableTempIT {\n+\n+  private final Logger log = Logger.getLogger(this.getClass().getName());\n+  private ByteArrayOutputStream bout;\n+  private PrintStream out;\n+  private PrintStream originalPrintStream;\n+\n+  private static final String BIGTABLE_URI = requireEnvVar(\"BIGTABLE_URI\");\n+\n+  private static String requireEnvVar(String varName) {\n+    String value = System.getenv(varName);\n+    assertNotNull(\n+        \"Environment variable \" + varName + \" is required to perform these tests.\",\n+        System.getenv(varName));\n+    return value;\n+  }\n+\n+  @BeforeClass\n+  public static void checkRequirements() {\n+    requireEnvVar(\"BIGTABLE_URI\");", "originalCommit": "0e269f42a4f957ef55039aaeec60ce64f28d27b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MjI1NQ==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r498942255", "bodyText": "As discussed offline, we will keep out existing instance created for samples testing and the IT format.", "author": "stephaniewang526", "createdAt": "2020-10-02T17:03:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzczODc4NA=="}], "type": "inlineReview"}, {"oid": "8d5e1511474c5223527bea65d1bf8ef6ff8d5ed2", "url": "https://github.com/googleapis/java-bigquery/commit/8d5e1511474c5223527bea65d1bf8ef6ff8d5ed2", "message": "docs(samples): address feedback", "committedDate": "2020-10-01T12:40:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkzNDY4Mw==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r498934683", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  // Configure BigtableOptions is optional.\n          \n          \n            \n                  // Configuring BigtableOptions is optional.", "author": "stephaniewang526", "createdAt": "2020-10-02T16:47:37Z", "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalBigtableTemp.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_query_external_bigtable_temp]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.BigtableColumn;\n+import com.google.cloud.bigquery.BigtableColumnFamily;\n+import com.google.cloud.bigquery.BigtableOptions;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.TableResult;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.codec.binary.Base64;\n+\n+// Sample to queries an external bigtable data source using a temporary table\n+public class QueryExternalBigtableTemp {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String bigtableInstanceId = \"MY_INSTANCE_ID\";\n+    String bigtableTableName = \"MY_BIGTABLE_NAME\";\n+    String bigqueryTableName = \"MY_TABLE_NAME\";\n+    String sourceUri =\n+        String.format(\n+            \"https://googleapis.com/bigtable/projects/%s/instances/%s/tables/%s\",\n+            projectId, bigtableInstanceId, bigtableTableName);\n+    String query = String.format(\"SELECT * FROM %s \", bigqueryTableName);\n+    queryExternalBigtableTemp(bigqueryTableName, sourceUri, query);\n+  }\n+\n+  public static void queryExternalBigtableTemp(String tableName, String sourceUri, String query) {\n+    try {\n+      // Initialize client that will be used to send requests. This client only needs to be created\n+      // once, and can be reused for multiple requests.\n+      BigQuery bigquery = BigQueryOptions.getDefaultInstance().getService();\n+\n+      BigtableColumn name =\n+          BigtableColumn.newBuilder()\n+              .setQualifierEncoded(Base64.encodeBase64String(\"name\".getBytes()))\n+              .setFieldName(\"name\")\n+              .setType(\"STRING\")\n+              .setEncoding(\"TEXT\")\n+              .build();\n+      BigtableColumn postAbbr =\n+          BigtableColumn.newBuilder()\n+              .setQualifierEncoded(Base64.encodeBase64String(\"post_abbr\".getBytes()))\n+              .setFieldName(\"post_abbr\")\n+              .setType(\"STRING\")\n+              .setEncoding(\"TEXT\")\n+              .build();\n+      BigtableColumnFamily usStates =\n+          BigtableColumnFamily.newBuilder()\n+              .setColumns(ImmutableList.of(name, postAbbr))\n+              .setFamilyID(\"us-states\")\n+              .setOnlyReadLatest(true)\n+              .setEncoding(\"TEXT\")\n+              .setType(\"STRING\")\n+              .build();\n+\n+      // Configure BigtableOptions is optional.", "originalCommit": "8d5e1511474c5223527bea65d1bf8ef6ff8d5ed2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0dd2386f9d3b55d062051910e928689a3cf5ab16", "url": "https://github.com/googleapis/java-bigquery/commit/0dd2386f9d3b55d062051910e928689a3cf5ab16", "message": "nit", "committedDate": "2020-10-02T16:47:48Z", "type": "commit"}, {"oid": "ed68887e7aa653d96b1c55c7c74a7093e56560f8", "url": "https://github.com/googleapis/java-bigquery/commit/ed68887e7aa653d96b1c55c7c74a7093e56560f8", "message": "docs(samples): address comments", "committedDate": "2020-10-05T11:22:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwMDUzNQ==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r500400535", "bodyText": "This seems to be causing issue:\ncom.google.api.gax.rpc.NotFoundException: io.grpc.StatusRuntimeException: NOT_FOUND: Failed to read: projects/{779844219229}/instances/bigquery-samples-instance\nCaused by: io.grpc.StatusRuntimeException: NOT_FOUND: Failed to read: projects/{779844219229}/instances/bigquery-samples-instance ```", "author": "stephaniewang526", "createdAt": "2020-10-06T15:39:13Z", "path": "samples/snippets/src/main/java/com/example/bigquery/QueryExternalBigtableTemp.java", "diffHunk": "@@ -0,0 +1,118 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+// [START bigquery_query_external_bigtable_temp]\n+import com.google.cloud.bigquery.BigQuery;\n+import com.google.cloud.bigquery.BigQueryException;\n+import com.google.cloud.bigquery.BigQueryOptions;\n+import com.google.cloud.bigquery.BigtableColumn;\n+import com.google.cloud.bigquery.BigtableColumnFamily;\n+import com.google.cloud.bigquery.BigtableOptions;\n+import com.google.cloud.bigquery.ExternalTableDefinition;\n+import com.google.cloud.bigquery.QueryJobConfiguration;\n+import com.google.cloud.bigquery.TableResult;\n+import com.google.common.collect.ImmutableList;\n+import org.apache.commons.codec.binary.Base64;\n+\n+// Sample to queries an external bigtable data source using a temporary table\n+public class QueryExternalBigtableTemp {\n+\n+  public static void main(String[] args) {\n+    // TODO(developer): Replace these variables before running the sample.\n+    String projectId = \"MY_PROJECT_ID\";\n+    String bigtableInstanceId = \"MY_INSTANCE_ID\";\n+    String bigtableTableName = \"MY_BIGTABLE_NAME\";\n+    String bigqueryTableName = \"MY_TABLE_NAME\";\n+    String sourceUri =\n+        String.format(\n+            \"https://googleapis.com/bigtable/projects/%s/instances/%s/tables/%s\",", "originalCommit": "ed68887e7aa653d96b1c55c7c74a7093e56560f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQwMzA5Ng==", "url": "https://github.com/googleapis/java-bigquery/pull/763#discussion_r500403096", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              private static final String PROJECT = requireEnvVar(\"GOOGLE_CLOUD_PROJECT\");\n          \n          \n            \n              private static final String PROJECT = requireEnvVar(\"SAMPLES_TESTING_PROJECT\");", "author": "stephaniewang526", "createdAt": "2020-10-06T15:42:17Z", "path": "samples/snippets/src/test/java/com/example/bigquery/QueryExternalBigtableTempIT.java", "diffHunk": "@@ -0,0 +1,186 @@\n+/*\n+ * Copyright 2020 Google LLC\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.example.bigquery;\n+\n+import static com.google.common.truth.Truth.assertThat;\n+import static junit.framework.TestCase.assertNotNull;\n+\n+import com.google.cloud.bigtable.admin.v2.BigtableTableAdminClient;\n+import com.google.cloud.bigtable.admin.v2.models.CreateTableRequest;\n+import com.google.cloud.bigtable.data.v2.BigtableDataClient;\n+import com.google.cloud.bigtable.data.v2.models.BulkMutation;\n+import com.google.cloud.bigtable.data.v2.models.Mutation;\n+import com.google.protobuf.ByteString;\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.PrintStream;\n+import java.util.UUID;\n+import java.util.logging.Level;\n+import java.util.logging.Logger;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+public class QueryExternalBigtableTempIT {\n+\n+  private final Logger log = Logger.getLogger(this.getClass().getName());\n+  private static final String ID = UUID.randomUUID().toString().substring(0, 8);\n+  private static final String TABLE_ID = \"bigquery-samples-test\" + ID;\n+  private static final String COLUMN_FAMILY_NAME = \"stats_summary\";\n+  private static final long TIMESTAMP = System.currentTimeMillis() * 1000;\n+  private static final String CONNECTED_CELL = \"connected_cell\";\n+  private static final String CONNECTED_WIFI = \"connected_wifi\";\n+  private static final String OS_BUILD = \"os_build\";\n+  private ByteArrayOutputStream bout;\n+  private PrintStream out;\n+  private PrintStream originalPrintStream;\n+\n+  private static final String INSTANCE = requireEnvVar(\"BIGTABLE_TESTING_INSTANCE\");\n+  private static final String PROJECT = requireEnvVar(\"GOOGLE_CLOUD_PROJECT\");", "originalCommit": "ed68887e7aa653d96b1c55c7c74a7093e56560f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "691519b2b117e3627e8495379fb3332346abfe8d", "url": "https://github.com/googleapis/java-bigquery/commit/691519b2b117e3627e8495379fb3332346abfe8d", "message": "update projectId", "committedDate": "2020-10-06T15:43:41Z", "type": "commit"}]}