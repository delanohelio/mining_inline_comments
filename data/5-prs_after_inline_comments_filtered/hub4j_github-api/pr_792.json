{"pr_number": 792, "pr_title": "Fix Gist getId() and deleteFile(), add getGistId()", "pr_createdAt": "2020-04-22T20:20:01Z", "pr_url": "https://github.com/hub4j/github-api/pull/792", "timeline": [{"oid": "09977ba71977f7bd4468ff0062f5c00bd8263445", "url": "https://github.com/hub4j/github-api/commit/09977ba71977f7bd4468ff0062f5c00bd8263445", "message": "Fix Gist getId() and add getGistId()\n\nFixes #682", "committedDate": "2020-04-22T20:37:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE2OTY2NA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414169664", "bodyText": "\"Gitthat\" typo?", "author": "martinvanzijl", "createdAt": "2020-04-23T22:37:02Z", "path": "src/main/java/org/kohsuke/github/GHGist.java", "diffHunk": "@@ -50,6 +50,27 @@ private GHGist(@JacksonInject GitHub root,\n         this.owner = root.getUser(owner);\n     }\n \n+    /**\n+     * Gets the numeric id, if possible. If id is not numeric this will throw a runtime {@link NumberFormatException}.\n+     *\n+     * @return id of the Gitthat owns this Gist.", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MTcyOA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414191728", "bodyText": "I would mention in the comments that the ID for a Gist can be non-numeric, e.g. \"aa5a315d61ae9438b18d\" - that is why we have special behaviour for getId() in this class.", "author": "martinvanzijl", "createdAt": "2020-04-23T23:32:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE2OTY2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE3MTAwOQ==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414171009", "bodyText": "Should this have a justification = \"...\" setting?", "author": "martinvanzijl", "createdAt": "2020-04-23T22:40:18Z", "path": "src/main/java/org/kohsuke/github/GHGistUpdater.java", "diffHunk": "@@ -12,13 +17,31 @@\n public class GHGistUpdater {\n     private final GHGist base;\n     private final Requester builder;\n-    LinkedHashMap<String, Object> files;\n+    private final GistUpdate updateRecord;\n+\n+    @SuppressFBWarnings(\"URF_UNREAD_FIELD\")", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE3MzAwNg==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414173006", "bodyText": "Needs justification?", "author": "martinvanzijl", "createdAt": "2020-04-23T22:44:58Z", "path": "src/main/java/org/kohsuke/github/GitHubHttpUrlConnectionClient.java", "diffHunk": "@@ -126,6 +127,7 @@ static HttpURLConnection setupConnection(@Nonnull GitHubClient client, @Nonnull\n         /**\n          * Set up the request parameters or POST payload.\n          */\n+        @SuppressFBWarnings(\"RCN_REDUNDANT_NULLCHECK_OF_NONNULL_VALUE\")", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE3MzkwNA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414173904", "bodyText": "Do the unit tests include both null and not null scenarios?", "author": "martinvanzijl", "createdAt": "2020-04-23T22:47:05Z", "path": "src/main/java/org/kohsuke/github/GitHubHttpUrlConnectionClient.java", "diffHunk": "@@ -137,24 +139,28 @@ private static void buildRequest(GitHubRequest request, HttpURLConnection connec\n             if (request.inBody()) {\n                 connection.setDoOutput(true);\n \n-                try (InputStream body = request.body()) {\n-                    if (body != null) {\n+                Object body = request.body();\n+                if (body instanceof InputStream) {\n+                    try (InputStream stream = (InputStream) body) {\n                         connection.setRequestProperty(\"Content-type\",\n                                 defaultString(request.contentType(), \"application/x-www-form-urlencoded\"));\n                         byte[] bytes = new byte[32768];\n                         int read;\n-                        while ((read = body.read(bytes)) != -1) {\n+                        while ((read = stream.read(bytes)) != -1) {\n                             connection.getOutputStream().write(bytes, 0, read);\n                         }\n-                    } else {\n-                        connection.setRequestProperty(\"Content-type\",\n-                                defaultString(request.contentType(), \"application/json\"));\n+                    }\n+                } else {\n+                    connection.setRequestProperty(\"Content-type\",\n+                            defaultString(request.contentType(), \"application/json\"));\n+                    if (body == null) {", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIzOTcwMA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414239700", "bodyText": "Yes. Most scenarios are null.  Only the Gist scenario are not null here.", "author": "bitwiseman", "createdAt": "2020-04-24T02:04:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE3MzkwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5NTUyNw==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414195527", "bodyText": "Maybe mention the purpose of this class in a comment, e.g. a helper class to update the Gist, since it is more convenient than using a LinkedHashMap, etc.", "author": "martinvanzijl", "createdAt": "2020-04-23T23:41:57Z", "path": "src/main/java/org/kohsuke/github/GHGistUpdater.java", "diffHunk": "@@ -12,13 +17,31 @@\n public class GHGistUpdater {\n     private final GHGist base;\n     private final Requester builder;\n-    LinkedHashMap<String, Object> files;\n+    private final GistUpdate updateRecord;\n+\n+    @SuppressFBWarnings(\"URF_UNREAD_FIELD\")\n+    private static class GistUpdate {\n+", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5NjU3MQ==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414196571", "bodyText": "Maybe mention the purpose of this class in a comment.", "author": "martinvanzijl", "createdAt": "2020-04-23T23:44:50Z", "path": "src/main/java/org/kohsuke/github/GHGistUpdater.java", "diffHunk": "@@ -12,13 +17,31 @@\n public class GHGistUpdater {\n     private final GHGist base;\n     private final Requester builder;\n-    LinkedHashMap<String, Object> files;\n+    private final GistUpdate updateRecord;\n+\n+    @SuppressFBWarnings(\"URF_UNREAD_FIELD\")\n+    private static class GistUpdate {\n+\n+        @JsonInclude(JsonInclude.Include.NON_NULL)\n+        String description = null;\n+\n+        @JsonInclude\n+        Map<String, GistFileUpdate> files = new HashMap<>();\n+    }\n+\n+    @SuppressFBWarnings(\"URF_UNREAD_FIELD\")\n+    private static class GistFileUpdate {", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5ODM1Ng==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414198356", "bodyText": "Maybe mention what is the expected final type/content of \"body\"?", "author": "martinvanzijl", "createdAt": "2020-04-23T23:49:28Z", "path": "src/main/java/org/kohsuke/github/GitHubRequest.java", "diffHunk": "@@ -496,7 +496,19 @@ public B with(String key, Map<?, ?> value) {\n          *            the body\n          * @return the request builder\n          */\n-        public B with(@WillClose /* later */ InputStream body) {\n+        public B withBodyStream(@WillClose /* later */ InputStream body) {\n+            this.body = body;\n+            return (B) this;\n+        }\n+\n+        /**\n+         * With requester.\n+         *\n+         * @param body\n+         *            the body", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5OTA0Ng==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414199046", "bodyText": "Would this cast ever fail? I.e. do we need the try? If so, is a catch required?", "author": "martinvanzijl", "createdAt": "2020-04-23T23:51:28Z", "path": "src/main/java/org/kohsuke/github/GitHubHttpUrlConnectionClient.java", "diffHunk": "@@ -137,24 +139,28 @@ private static void buildRequest(GitHubRequest request, HttpURLConnection connec\n             if (request.inBody()) {\n                 connection.setDoOutput(true);\n \n-                try (InputStream body = request.body()) {\n-                    if (body != null) {\n+                Object body = request.body();\n+                if (body instanceof InputStream) {\n+                    try (InputStream stream = (InputStream) body) {", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIzOTIwMA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414239200", "bodyText": "No, it can never fail.", "author": "bitwiseman", "createdAt": "2020-04-24T02:02:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5OTA0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5OTYyMA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414199620", "bodyText": "Loses some clarity if it is just \"Object\" instead of \"InputStream\".", "author": "martinvanzijl", "createdAt": "2020-04-23T23:53:08Z", "path": "src/main/java/org/kohsuke/github/GitHubRequest.java", "diffHunk": "@@ -45,7 +45,7 @@\n     private final String apiUrl;\n     private final String urlPath;\n     private final String method;\n-    private final InputStream body;\n+    private final Object body;", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI0MjUxOQ==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414242519", "bodyText": "It needs to be object, unless what you mean is that we should add a separate field for private final Object bodyObject; and keep the InputStream body as well.   I don't really see the point of the that though. You can't have both.\nThe alternative would be to have to allow the addition of an object to args with the key \"\".  This would a signal to set the root object to passed as body.", "author": "bitwiseman", "createdAt": "2020-04-24T02:14:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5OTYyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMDM5NQ==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414200395", "bodyText": "Could it break existing client code to introduce a possible exception?\nMind you, if clients are currently using this method they are probably getting an incorrect result, anyhow.", "author": "martinvanzijl", "createdAt": "2020-04-23T23:55:15Z", "path": "src/main/java/org/kohsuke/github/GHGist.java", "diffHunk": "@@ -50,6 +50,27 @@ private GHGist(@JacksonInject GitHub root,\n         this.owner = root.getUser(owner);\n     }\n \n+    /**\n+     * Gets the numeric id, if possible. If id is not numeric this will throw a runtime {@link NumberFormatException}.\n+     *\n+     * @return id of the Gitthat owns this Gist.\n+     * @deprecated Use {@link #getGistId()} instead.\n+     */\n+    @Deprecated\n+    @Override\n+    public long getId() {", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDI0Mjg3NA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414242874", "bodyText": "It is possible, but as you say if they are using this now they are getting useless results.", "author": "bitwiseman", "createdAt": "2020-04-24T02:16:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMDM5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMTc4MA==", "url": "https://github.com/hub4j/github-api/pull/792#discussion_r414201780", "bodyText": "Javadoc for method?", "author": "martinvanzijl", "createdAt": "2020-04-23T23:58:58Z", "path": "src/main/java/org/kohsuke/github/GHGistUpdater.java", "diffHunk": "@@ -70,11 +93,43 @@ public GHGistUpdater renameFile(String fileName, String newFileName) throws IOEx\n      * @throws IOException\n      *             the io exception\n      */\n-    public GHGistUpdater updateFile(String fileName, String content) throws IOException {\n-        files.put(fileName, Collections.singletonMap(\"content\", content));\n+    public GHGistUpdater updateFile(@Nonnull String fileName, @Nonnull String content) throws IOException {\n+        GistFileUpdate file = getGistFileUpdate(fileName);\n+        file.content = content;\n         return this;\n     }\n \n+    /**\n+     * Update file name and content\n+     *\n+     * @param fileName\n+     *            the file name\n+     * @param newFileName\n+     *            the new file name\n+     * @param content\n+     *            the content\n+     * @return the gh gist updater\n+     * @throws IOException\n+     *             the io exception\n+     */\n+    public GHGistUpdater updateFile(@Nonnull String fileName, @Nonnull String newFileName, @Nonnull String content)\n+            throws IOException {\n+        GistFileUpdate file = getGistFileUpdate(fileName);\n+        file.filename = newFileName;\n+        file.content = content;\n+        return this;\n+    }\n+\n+    @Nonnull", "originalCommit": "eb05ec8ae9e26ad73c7eb50bb02b82cdeec8d4ba", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "44dcbe773d0e4c14b864d84866e1ba632e1cd977", "url": "https://github.com/hub4j/github-api/commit/44dcbe773d0e4c14b864d84866e1ba632e1cd977", "message": "Fix Gist getId() and add getGistId()\n\nFixes #682", "committedDate": "2020-04-26T03:16:58Z", "type": "commit"}, {"oid": "4b71a74a3fe638803c7c05140a81985eb154bf5b", "url": "https://github.com/hub4j/github-api/commit/4b71a74a3fe638803c7c05140a81985eb154bf5b", "message": "Add deleteFile() to GHGist\n\nRelated to #466 and #484", "committedDate": "2020-04-26T03:40:14Z", "type": "forcePushed"}, {"oid": "eab3b393a8b68019adffc55c48da83de0694798c", "url": "https://github.com/hub4j/github-api/commit/eab3b393a8b68019adffc55c48da83de0694798c", "message": "Add deleteFile() to GHGist\n\nRelated to #466 and #484", "committedDate": "2020-04-27T17:24:30Z", "type": "forcePushed"}, {"oid": "16e0099a0d8bfc4a4ecfe10556ad0a22abc587c2", "url": "https://github.com/hub4j/github-api/commit/16e0099a0d8bfc4a4ecfe10556ad0a22abc587c2", "message": "Add deleteFile() to GHGist\n\nRelated to #466 and #484", "committedDate": "2020-04-27T17:44:25Z", "type": "commit"}, {"oid": "16e0099a0d8bfc4a4ecfe10556ad0a22abc587c2", "url": "https://github.com/hub4j/github-api/commit/16e0099a0d8bfc4a4ecfe10556ad0a22abc587c2", "message": "Add deleteFile() to GHGist\n\nRelated to #466 and #484", "committedDate": "2020-04-27T17:44:25Z", "type": "forcePushed"}, {"oid": "eff4f4f601d979a3f37a28d2b242b25e63d700ae", "url": "https://github.com/hub4j/github-api/commit/eff4f4f601d979a3f37a28d2b242b25e63d700ae", "message": "Merge branch 'master' into issue/682", "committedDate": "2020-04-27T20:20:35Z", "type": "commit"}]}