{"pr_number": 1694, "pr_title": "GG-31205: Fixed ContinuousQueryMarshallerTest", "pr_createdAt": "2020-12-30T21:28:49Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1694", "timeline": [{"oid": "e86820935d9761f685b875988c36d8d0e7df66a5", "url": "https://github.com/gridgain/gridgain/commit/e86820935d9761f685b875988c36d8d0e7df66a5", "message": "GG-31205: Fixed ContinuousQueryMarshallerTest", "committedDate": "2020-12-30T21:27:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI1NTExMg==", "url": "https://github.com/gridgain/gridgain/pull/1694#discussion_r555255112", "bodyText": "In accordance with https://cwiki.apache.org/confluence/display/IGNITE/Abbreviation+Rules cnt should be used instead of count", "author": "sk0x50", "createdAt": "2021-01-11T18:31:16Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/processors/cache/query/continuous/ContinuousQueryMarshallerTest.java", "diffHunk": "@@ -104,31 +112,32 @@ private void check(String node1Name, String node2Name) throws Exception {\n \n         qry.setRemoteFilterFactory(new DummyEventFilterFactory<>());\n \n-        final CountDownLatch latch = new CountDownLatch(15);\n+        final CountDownLatch latch = new CountDownLatch(NUM_OF_UPDATES);\n \n         qry.setLocalListener(new CacheEntryUpdatedListener<Integer, MarshallerCheckingEntry>() {\n             @Override public void onUpdated(\n                 final Iterable<CacheEntryEvent<? extends Integer, ? extends MarshallerCheckingEntry>> evts)\n                 throws CacheEntryListenerException {\n \n-                System.out.println(\">> Client 1 events \" + evts);\n-\n                 for (CacheEntryEvent<? extends Integer, ? extends MarshallerCheckingEntry> evt : evts)\n                     latch.countDown();\n             }\n         });\n \n         final IgniteCache<Integer, MarshallerCheckingEntry> cache1 = node2.cache(CACHE_NAME);\n \n+        int count = 0;", "originalCommit": "e86820935d9761f685b875988c36d8d0e7df66a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI1NTY0Nw==", "url": "https://github.com/gridgain/gridgain/pull/1694#discussion_r555255647", "bodyText": "Please remove unnecessary brackets.", "author": "sk0x50", "createdAt": "2021-01-11T18:32:11Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/processors/cache/query/continuous/ContinuousQueryMarshallerTest.java", "diffHunk": "@@ -104,31 +112,32 @@ private void check(String node1Name, String node2Name) throws Exception {\n \n         qry.setRemoteFilterFactory(new DummyEventFilterFactory<>());\n \n-        final CountDownLatch latch = new CountDownLatch(15);\n+        final CountDownLatch latch = new CountDownLatch(NUM_OF_UPDATES);\n \n         qry.setLocalListener(new CacheEntryUpdatedListener<Integer, MarshallerCheckingEntry>() {\n             @Override public void onUpdated(\n                 final Iterable<CacheEntryEvent<? extends Integer, ? extends MarshallerCheckingEntry>> evts)\n                 throws CacheEntryListenerException {\n \n-                System.out.println(\">> Client 1 events \" + evts);\n-\n                 for (CacheEntryEvent<? extends Integer, ? extends MarshallerCheckingEntry> evt : evts)\n                     latch.countDown();\n             }\n         });\n \n         final IgniteCache<Integer, MarshallerCheckingEntry> cache1 = node2.cache(CACHE_NAME);\n \n+        int count = 0;\n         for (Cache.Entry<Integer, MarshallerCheckingEntry> entry : cache1.query(qry)) {\n-            latch.countDown();\n-            System.out.println(\">> Initial entry \" + entry);\n+            count++;", "originalCommit": "e86820935d9761f685b875988c36d8d0e7df66a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NTI1NjY0OA==", "url": "https://github.com/gridgain/gridgain/pull/1694#discussion_r555256648", "bodyText": "Please add whitespace before CACHE_SIZE.", "author": "sk0x50", "createdAt": "2021-01-11T18:33:54Z", "path": "modules/core/src/test/java/org/apache/ignite/internal/processors/cache/query/continuous/ContinuousQueryMarshallerTest.java", "diffHunk": "@@ -104,31 +112,32 @@ private void check(String node1Name, String node2Name) throws Exception {\n \n         qry.setRemoteFilterFactory(new DummyEventFilterFactory<>());\n \n-        final CountDownLatch latch = new CountDownLatch(15);\n+        final CountDownLatch latch = new CountDownLatch(NUM_OF_UPDATES);\n \n         qry.setLocalListener(new CacheEntryUpdatedListener<Integer, MarshallerCheckingEntry>() {\n             @Override public void onUpdated(\n                 final Iterable<CacheEntryEvent<? extends Integer, ? extends MarshallerCheckingEntry>> evts)\n                 throws CacheEntryListenerException {\n \n-                System.out.println(\">> Client 1 events \" + evts);\n-\n                 for (CacheEntryEvent<? extends Integer, ? extends MarshallerCheckingEntry> evt : evts)\n                     latch.countDown();\n             }\n         });\n \n         final IgniteCache<Integer, MarshallerCheckingEntry> cache1 = node2.cache(CACHE_NAME);\n \n+        int count = 0;\n         for (Cache.Entry<Integer, MarshallerCheckingEntry> entry : cache1.query(qry)) {\n-            latch.countDown();\n-            System.out.println(\">> Initial entry \" + entry);\n+            count++;\n         }\n \n-        for (int i = 10; i < 20; i++)\n+        assertEquals(\"Unexpected number of entries scanned\",CACHE_SIZE / 2, count);", "originalCommit": "e86820935d9761f685b875988c36d8d0e7df66a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6c60eb4fcf6a0323972731fa23cb80ffc2589c07", "url": "https://github.com/gridgain/gridgain/commit/6c60eb4fcf6a0323972731fa23cb80ffc2589c07", "message": "GG-31205: Fix review comments.", "committedDate": "2021-01-18T19:17:33Z", "type": "commit"}]}