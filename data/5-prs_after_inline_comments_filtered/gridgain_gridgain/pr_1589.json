{"pr_number": 1589, "pr_title": "GG-30867 Hide redundant Spring logs to the lower(DEBUG) level", "pr_createdAt": "2020-11-23T04:59:00Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1589", "timeline": [{"oid": "a19b28b0661338024c07b9608752b30d4a058400", "url": "https://github.com/gridgain/gridgain/commit/a19b28b0661338024c07b9608752b30d4a058400", "message": "GG-30867 Hide redundant Spring logs.", "committedDate": "2020-11-23T04:56:03Z", "type": "commit"}, {"oid": "a37d9ec80594572639c047ffcaa6cb0a41613431", "url": "https://github.com/gridgain/gridgain/commit/a37d9ec80594572639c047ffcaa6cb0a41613431", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-03T09:32:26Z", "type": "commit"}, {"oid": "05e846cad508b3184d59e614df54a451f66fef1f", "url": "https://github.com/gridgain/gridgain/commit/05e846cad508b3184d59e614df54a451f66fef1f", "message": "GG-30867 Add jcl bridge for slf4j.", "committedDate": "2020-12-03T10:11:08Z", "type": "commit"}, {"oid": "4ef8d32b22eaf279669d8ca39624ca670cd05c33", "url": "https://github.com/gridgain/gridgain/commit/4ef8d32b22eaf279669d8ca39624ca670cd05c33", "message": "GG-30867 Added jul bridge to slf4j.", "committedDate": "2020-12-03T10:40:01Z", "type": "commit"}, {"oid": "9bf338d51eb345b0d3e9af173140a4f33fccee44", "url": "https://github.com/gridgain/gridgain/commit/9bf338d51eb345b0d3e9af173140a4f33fccee44", "message": "GG-30867 Added log4j-jul bridge.", "committedDate": "2020-12-04T05:27:48Z", "type": "commit"}, {"oid": "e8712cbdd2fb1e15b905efc92419bcdd0f10f660", "url": "https://github.com/gridgain/gridgain/commit/e8712cbdd2fb1e15b905efc92419bcdd0f10f660", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-04T05:27:56Z", "type": "commit"}, {"oid": "ddc08e40d81519537f5740b412d418d4fe275779", "url": "https://github.com/gridgain/gridgain/commit/ddc08e40d81519537f5740b412d418d4fe275779", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-09T04:03:00Z", "type": "commit"}, {"oid": "5b6f0efb6b4f34d5bf1922c1cbeac65a3eef63a8", "url": "https://github.com/gridgain/gridgain/commit/5b6f0efb6b4f34d5bf1922c1cbeac65a3eef63a8", "message": "GG-31817 Added tests.", "committedDate": "2020-12-09T10:41:19Z", "type": "commit"}, {"oid": "83646d2332c5ab4f12c5bacf6777da032c30299d", "url": "https://github.com/gridgain/gridgain/commit/83646d2332c5ab4f12c5bacf6777da032c30299d", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-11T09:21:02Z", "type": "commit"}, {"oid": "ed0b01fcc848390e218b526841363854462a96c8", "url": "https://github.com/gridgain/gridgain/commit/ed0b01fcc848390e218b526841363854462a96c8", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-14T05:08:18Z", "type": "commit"}, {"oid": "4641639deb2024743f285ed178d3d62f644f8737", "url": "https://github.com/gridgain/gridgain/commit/4641639deb2024743f285ed178d3d62f644f8737", "message": "GG-30867 Cleanup.", "committedDate": "2020-12-14T08:52:04Z", "type": "commit"}, {"oid": "2b5c6a469169d67e3a02a7d2fc146f7f094d3493", "url": "https://github.com/gridgain/gridgain/commit/2b5c6a469169d67e3a02a7d2fc146f7f094d3493", "message": "GG-30867 Fixed test.", "committedDate": "2020-12-14T11:24:36Z", "type": "commit"}, {"oid": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "url": "https://github.com/gridgain/gridgain/commit/250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-14T13:44:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTM3NQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544235375", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log1.info(\"Text that should be presence in logs\");\n          \n          \n            \n                    log1.info(\"Text that should be present in logs\");", "author": "dmekhanikov", "createdAt": "2020-12-16T11:49:33Z", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjM1Mw==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544236353", "bodyText": "Let's move log messages into a String variable, so that the strings are not duplicated in code.", "author": "dmekhanikov", "createdAt": "2020-12-16T11:51:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTU2NDc0Mw==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r549564743", "bodyText": "done", "author": "nva", "createdAt": "2020-12-29T04:36:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNTg3Mg==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544235872", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n          \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be present in logs\"));", "author": "dmekhanikov", "createdAt": "2020-12-16T11:50:23Z", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjY3OQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544236679", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    log1.info(\"Text that should be presence in logs\");\n          \n          \n            \n                    log1.info(\"Text that should be present in logs\");", "author": "dmekhanikov", "createdAt": "2020-12-16T11:51:43Z", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n+\n+        assertFalse(\"JUL INFO logs for org.springframework package are present in log file\",\n+            logContent.contains(\"INFO logs from org.springframework package should be excluded from logs\"));\n+    }\n+\n+    /**\n+     * Check that Apache Commons Logging is redirected to Log4j2.\n+     *\n+     * Start the local node and check for presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using Apache Commons Logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using Apache Commons Logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJCLIsRedirectedToLog4j2() throws Exception {\n+        File logFile = checkOneNode(0);\n+\n+        Log log1 = LogFactory.getLog(this.getClass());\n+        log1.info(\"Text that should be presence in logs\");", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzNjg5Mw==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544236893", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n          \n          \n            \n                        logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be present in logs\"));", "author": "dmekhanikov", "createdAt": "2020-12-16T11:52:00Z", "path": "modules/log4j2/src/test/java/org/apache/ignite/logger/log4j2/Log4j2LoggerSelfTest.java", "diffHunk": "@@ -152,14 +157,79 @@ public void testLogFilesTwoNodes() throws Exception {\n         checkOneNode(1);\n     }\n \n+    /**\n+     * Check that JUL is redirected to Log4j2 .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToLog4j2() throws Exception {\n+        assertEquals(\"org.apache.logging.log4j.jul.LogManager\", LogManager.getLogManager().getClass().getName());\n+        \n+        File logFile = checkOneNode(0);\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));\n+\n+        assertFalse(\"JUL INFO logs for org.springframework package are present in log file\",\n+            logContent.contains(\"INFO logs from org.springframework package should be excluded from logs\"));\n+    }\n+\n+    /**\n+     * Check that Apache Commons Logging is redirected to Log4j2.\n+     *\n+     * Start the local node and check for presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using Apache Commons Logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using Apache Commons Logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJCLIsRedirectedToLog4j2() throws Exception {\n+        File logFile = checkOneNode(0);\n+\n+        Log log1 = LogFactory.getLog(this.getClass());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Log log2 = LogFactory.getLog(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JCL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Log4j2LoggerSelfTest] Text that should be presence in logs\"));", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTMyMA==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544265320", "bodyText": "What does this thing do? Is it required?\nThe comment looks confusing. It says \"Optionally\", meaning that this step is not really required. We decided to perform it, but kept the \"Optionally\" word.", "author": "dmekhanikov", "createdAt": "2020-12-16T12:38:30Z", "path": "modules/slf4j/src/main/java/org/apache/ignite/logger/slf4j/Slf4jLogger.java", "diffHunk": "@@ -65,7 +66,12 @@ public Slf4jLogger(Logger impl) {\n \n         this.impl = impl;\n \n-        quiet = Boolean.valueOf(System.getProperty(IGNITE_QUIET, \"true\"));\n+        quiet = Boolean.parseBoolean(System.getProperty(IGNITE_QUIET, \"true\"));\n+\n+        // Optionally remove existing handlers attached to j.u.l root logger (since SLF4J 1.6.5)\n+        SLF4JBridgeHandler.removeHandlersForRootLogger();", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMjg4Ng==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544812886", "bodyText": "Remove all other handlers that can catch logs from JUL. I think it required.\nRemove \"Optionally\" word.", "author": "nva", "createdAt": "2020-12-17T04:58:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTMyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTEzMzk0Nw==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r545133947", "bodyText": "Let's remove the \"(since SLF4J 1.6.5)\" part as well then.", "author": "dmekhanikov", "createdAt": "2020-12-17T14:31:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NTMyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NjAzMQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544266031", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        logContent.contains(\"[INFO ][main][Slf4jLoggerSelfTest] Text that should be presence in logs\"));\n          \n          \n            \n                        logContent.contains(\"[INFO ][main][Slf4jLoggerSelfTest] Text that should be present in logs\"));", "author": "dmekhanikov", "createdAt": "2020-12-16T12:39:39Z", "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "diffHunk": "@@ -0,0 +1,181 @@\n+/*\n+ * Copyright 2020 GridGain Systems, Inc. and Contributors.\n+ *\n+ * Licensed under the GridGain Community Edition License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.gridgain.com/products/software/community-edition/gridgain-community-edition-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.logger.slf4j;\n+\n+import java.io.File;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.logging.Logger;\n+import java.util.stream.Stream;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.configuration.IgniteConfiguration;\n+import org.apache.ignite.internal.util.typedef.G;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi;\n+import org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder;\n+import org.apache.logging.log4j.LogManager;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Grid Slf4j SPI test.\n+ */\n+public class Slf4jLoggerSelfTest {\n+    /** Path to full log. */\n+    private static final String LOG_ALL = \"work/log/all.log\";\n+\n+    /** Path to filtered log. */\n+    private static final String LOG_FILTERED = \"work/log/filtered.log\";\n+\n+    /** */\n+    @Before\n+    public void setUp() {\n+        deleteLogs();\n+\n+        LogManager.shutdown();\n+    }\n+\n+    /** */\n+    @After\n+    public void tearDown() {\n+        deleteLogs();\n+    }\n+\n+    /**\n+     * Check that JUL is redirected to Slf4j .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.\n+     * Check that logs aren\u2019t present in log file.\n+     *\n+     * @throws Exception If error occurs.\n+     */\n+    @Test\n+    public void testJULIsRedirectedToSlf4j() throws Exception {\n+        File logFile = checkOneNode();\n+\n+        Logger log1 = Logger.getLogger(this.getClass().getName());\n+        log1.info(\"Text that should be presence in logs\");\n+\n+        Logger log2 = Logger.getLogger(\"org.springframework.context.ApplicationContext\");\n+        log2.info(\"INFO logs from org.springframework package should be excluded from logs\");\n+\n+        String logContent = U.readFileToString(logFile.getAbsolutePath(), \"UTF-8\");\n+\n+        assertTrue(\"Logs from JUL logger should be present in log file\",\n+            logContent.contains(\"[INFO ][main][Slf4jLoggerSelfTest] Text that should be presence in logs\"));", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2OTE4OQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544269189", "bodyText": "Why do we say about log4j2 here? Is SLF backed by log4j? Let's clarify it somewhere in the comments.", "author": "dmekhanikov", "createdAt": "2020-12-16T12:44:50Z", "path": "modules/slf4j/src/test/java/org/apache/ignite/logger/slf4j/Slf4jLoggerSelfTest.java", "diffHunk": "@@ -0,0 +1,181 @@\n+/*\n+ * Copyright 2020 GridGain Systems, Inc. and Contributors.\n+ *\n+ * Licensed under the GridGain Community Edition License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.gridgain.com/products/software/community-edition/gridgain-community-edition-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.logger.slf4j;\n+\n+import java.io.File;\n+import java.util.Collections;\n+import java.util.Objects;\n+import java.util.logging.Logger;\n+import java.util.stream.Stream;\n+import org.apache.commons.logging.Log;\n+import org.apache.commons.logging.LogFactory;\n+import org.apache.ignite.Ignite;\n+import org.apache.ignite.configuration.IgniteConfiguration;\n+import org.apache.ignite.internal.util.typedef.G;\n+import org.apache.ignite.internal.util.typedef.internal.U;\n+import org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi;\n+import org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder;\n+import org.apache.logging.log4j.LogManager;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.slf4j.LoggerFactory;\n+\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertTrue;\n+\n+/**\n+ * Grid Slf4j SPI test.\n+ */\n+public class Slf4jLoggerSelfTest {\n+    /** Path to full log. */\n+    private static final String LOG_ALL = \"work/log/all.log\";\n+\n+    /** Path to filtered log. */\n+    private static final String LOG_FILTERED = \"work/log/filtered.log\";\n+\n+    /** */\n+    @Before\n+    public void setUp() {\n+        deleteLogs();\n+\n+        LogManager.shutdown();\n+    }\n+\n+    /** */\n+    @After\n+    public void tearDown() {\n+        deleteLogs();\n+    }\n+\n+    /**\n+     * Check that JUL is redirected to Slf4j .\n+     *\n+     * Start the local node and check presence of log file.\n+     * Check that this is really a log of a started node.\n+     * Log something using JUL logging.\n+     * Check that logs present in log file.\n+     * Log something in INFO level from package that is blocked in log4j2 configuration using JUL logging.", "originalCommit": "250f1df226fe6539b3cdeb0f66d9612d73f4dae7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDgxMTIxOQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r544811219", "bodyText": "Fixed to slf4j. I don't think such details should be in the test description.", "author": "nva", "createdAt": "2020-12-17T04:53:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2OTE4OQ=="}], "type": "inlineReview"}, {"oid": "c11f7fe38802458033b1b995283d516f91a9d25d", "url": "https://github.com/gridgain/gridgain/commit/c11f7fe38802458033b1b995283d516f91a9d25d", "message": "GG-30867 Apply suggestions from code review\n\nCo-authored-by: Denis Mekhanikov <dmekhanikov@users.noreply.github.com>", "committedDate": "2020-12-17T04:37:28Z", "type": "commit"}, {"oid": "e30b8bbaf7d791798f7c93d6c05f5dfe836967cf", "url": "https://github.com/gridgain/gridgain/commit/e30b8bbaf7d791798f7c93d6c05f5dfe836967cf", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-17T04:38:55Z", "type": "commit"}, {"oid": "9474874c222f10e8608e97a8ae36845ec71888cf", "url": "https://github.com/gridgain/gridgain/commit/9474874c222f10e8608e97a8ae36845ec71888cf", "message": "GG-30867 Fixed typo.", "committedDate": "2020-12-17T04:48:20Z", "type": "commit"}, {"oid": "1329c324652cc791e38b6524b4513e9f288c5ab9", "url": "https://github.com/gridgain/gridgain/commit/1329c324652cc791e38b6524b4513e9f288c5ab9", "message": "GG-30867 Fixed javadoc.", "committedDate": "2020-12-17T05:03:06Z", "type": "commit"}, {"oid": "245a91d4a2f678e2db87d2583fb841b6856db3a0", "url": "https://github.com/gridgain/gridgain/commit/245a91d4a2f678e2db87d2583fb841b6856db3a0", "message": "GG-30867 Fixed javadoc.", "committedDate": "2020-12-18T10:26:41Z", "type": "commit"}, {"oid": "ea440c8b444db173fc395f5690f402e0d1618431", "url": "https://github.com/gridgain/gridgain/commit/ea440c8b444db173fc395f5690f402e0d1618431", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-18T10:26:50Z", "type": "commit"}, {"oid": "26a8ec64a26b60f2e011d354aa79e8e19b754ca4", "url": "https://github.com/gridgain/gridgain/commit/26a8ec64a26b60f2e011d354aa79e8e19b754ca4", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-29T04:14:33Z", "type": "commit"}, {"oid": "2ac5b710cc78ec852475f98a76125e4b0469f772", "url": "https://github.com/gridgain/gridgain/commit/2ac5b710cc78ec852475f98a76125e4b0469f772", "message": "GG-30867 Apply suggestions from review notes.", "committedDate": "2020-12-29T04:29:31Z", "type": "commit"}, {"oid": "0e035b6ade2f402c57f663ad652b968240240d6e", "url": "https://github.com/gridgain/gridgain/commit/0e035b6ade2f402c57f663ad652b968240240d6e", "message": "GG-30867 Added Log4jBridgeHandler.", "committedDate": "2020-12-30T04:28:54Z", "type": "commit"}, {"oid": "71925c15f999657b990aea400ecde6303d5d1c06", "url": "https://github.com/gridgain/gridgain/commit/71925c15f999657b990aea400ecde6303d5d1c06", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2020-12-30T04:29:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTAwOTQ3NQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r561009475", "bodyText": "As far as I can see, you removed all handlers attached to the j.u.l root logger. Can you explain why? As I can see from the examples, you can simply add your handler via Log4jBridgeHandler.install().\nIf I understood this correctly after calling this method, all other handlers (logs appenders) configured by the client, for example, will be removed. Please correct me because I am not close to these methods, but it looks dangerous.", "author": "aealeksandrov", "createdAt": "2021-01-20T14:38:34Z", "path": "modules/log4j2/src/main/java/org/apache/ignite/logger/log4j2/Log4J2Logger.java", "diffHunk": "@@ -131,6 +131,11 @@ public Log4J2Logger() {\n \n         quiet = quiet0;\n         cfg = null;\n+\n+        // Remove existing handlers attached to j.u.l root logger.\n+        Log4jBridgeHandler.removeHandlersForRootLogger();", "originalCommit": "71925c15f999657b990aea400ecde6303d5d1c06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTYwOTk2OQ==", "url": "https://github.com/gridgain/gridgain/pull/1589#discussion_r561609969", "bodyText": "This was an optional step from the examples. Let's not install the same handler twice and remove java.util.logging.ConsoleHandler which duplicate output to log. This can happen if you start/stop a node in the same jvm", "author": "nva", "createdAt": "2021-01-21T05:23:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTAwOTQ3NQ=="}], "type": "inlineReview"}, {"oid": "0e9bd56517526028f8baf8a9d290a2271236056e", "url": "https://github.com/gridgain/gridgain/commit/0e9bd56517526028f8baf8a9d290a2271236056e", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2021-01-21T04:16:07Z", "type": "commit"}, {"oid": "9207e4ec042294423cdfbfd8524418eca1ad736c", "url": "https://github.com/gridgain/gridgain/commit/9207e4ec042294423cdfbfd8524418eca1ad736c", "message": "GG-30867 Apply suggestion from review notes.", "committedDate": "2021-01-21T04:38:11Z", "type": "commit"}, {"oid": "9d9e7ca1f3066eb8aa998feaeaa1eb453ffea783", "url": "https://github.com/gridgain/gridgain/commit/9d9e7ca1f3066eb8aa998feaeaa1eb453ffea783", "message": "GG-30867 Do not install same handler twice.", "committedDate": "2021-01-21T05:23:36Z", "type": "commit"}, {"oid": "17154d420ecf9f128c499aefe0b9f68aced84802", "url": "https://github.com/gridgain/gridgain/commit/17154d420ecf9f128c499aefe0b9f68aced84802", "message": "GG-30867 Remove ConsoleHandler when slf4j or log4j integrations are used.", "committedDate": "2021-01-21T12:13:12Z", "type": "commit"}, {"oid": "e474f528aeb77e44d949352553e86526872d7681", "url": "https://github.com/gridgain/gridgain/commit/e474f528aeb77e44d949352553e86526872d7681", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2021-01-26T08:39:06Z", "type": "commit"}, {"oid": "d5a46664bfeb5a19c287e430f2e9437d586a1576", "url": "https://github.com/gridgain/gridgain/commit/d5a46664bfeb5a19c287e430f2e9437d586a1576", "message": "Merge branch 'master' of https://github.com/gridgain/gridgain into gg-30867", "committedDate": "2021-01-27T03:22:06Z", "type": "commit"}]}