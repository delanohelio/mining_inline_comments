{"pr_number": 1370, "pr_title": "GG-30462 Server node fails on remote filter deployment after client reconnect with new node id", "pr_createdAt": "2020-08-13T23:25:33Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1370", "timeline": [{"oid": "70d9cc7b154e88219e7d816e2c876926016d1132", "url": "https://github.com/gridgain/gridgain/commit/70d9cc7b154e88219e7d816e2c876926016d1132", "message": "GG-30462 local routines registration, after client reconnect, moved to localJoinFuture listener for p2p case", "committedDate": "2020-08-11T13:23:05Z", "type": "commit"}, {"oid": "fb96e1ee6a0f94f17d0c4f178a1979e3059d5f38", "url": "https://github.com/gridgain/gridgain/commit/fb96e1ee6a0f94f17d0c4f178a1979e3059d5f38", "message": "GG-30462 routine registration on node start used only for CQ routines with p2p marshalled data", "committedDate": "2020-08-11T14:45:03Z", "type": "commit"}, {"oid": "74ea7c3a0d539c67934b3d0713bae36f9202878c", "url": "https://github.com/gridgain/gridgain/commit/74ea7c3a0d539c67934b3d0713bae36f9202878c", "message": "GG-30462 check for empty locInfos0 added", "committedDate": "2020-08-11T15:04:47Z", "type": "commit"}, {"oid": "bb556957e8de9c692b229aab6e504876422d946a", "url": "https://github.com/gridgain/gridgain/commit/bb556957e8de9c692b229aab6e504876422d946a", "message": "Merge branch 'master' into gg-30462", "committedDate": "2020-08-12T09:54:50Z", "type": "commit"}, {"oid": "b4f75dbfeb9c1625624a4c05327d2de8020aa39c", "url": "https://github.com/gridgain/gridgain/commit/b4f75dbfeb9c1625624a4c05327d2de8020aa39c", "message": "GG-30462 validation for CacheContinuousQueryDeployableObject added", "committedDate": "2020-08-12T15:16:33Z", "type": "commit"}, {"oid": "b10bd42805f4d7253281fd1859cd6b5c2e577f8c", "url": "https://github.com/gridgain/gridgain/commit/b10bd42805f4d7253281fd1859cd6b5c2e577f8c", "message": "GG-30462 check for joiningNodeId added", "committedDate": "2020-08-12T17:19:06Z", "type": "commit"}, {"oid": "5e11d7d186f6c7ab13f0dc4714be6d1f059ed0d2", "url": "https://github.com/gridgain/gridgain/commit/5e11d7d186f6c7ab13f0dc4714be6d1f059ed0d2", "message": "GG-30462 routines registration moved to onReconnected method", "committedDate": "2020-08-13T18:22:06Z", "type": "commit"}, {"oid": "ebc07422fae549dcd3af3ace5cc08c0afd359094", "url": "https://github.com/gridgain/gridgain/commit/ebc07422fae549dcd3af3ace5cc08c0afd359094", "message": "GG-30462 tests fixed", "committedDate": "2020-08-13T21:24:48Z", "type": "commit"}, {"oid": "1473fcd765b687773ae9b55bbbe27e34762bb80e", "url": "https://github.com/gridgain/gridgain/commit/1473fcd765b687773ae9b55bbbe27e34762bb80e", "message": "GG-30462 failure handler check added to CacheContinuousQueryOperationP2PTest. GridCompoundFuture usage added.", "committedDate": "2020-08-13T23:23:13Z", "type": "commit"}, {"oid": "d8f0f989034d5e5b4f183e01ea7416222ff6f902", "url": "https://github.com/gridgain/gridgain/commit/d8f0f989034d5e5b4f183e01ea7416222ff6f902", "message": "GG-30462 isMarshalledObjectValid check added for discoProtoVer2", "committedDate": "2020-08-14T15:22:57Z", "type": "commit"}, {"oid": "9b03c9b198b160689851cdfd0594dcfd37a69e71", "url": "https://github.com/gridgain/gridgain/commit/9b03c9b198b160689851cdfd0594dcfd37a69e71", "message": "GG-30462 logging changed", "committedDate": "2020-08-16T22:39:04Z", "type": "commit"}, {"oid": "93ac65fb787d8b507157175671619b975708cf7b", "url": "https://github.com/gridgain/gridgain/commit/93ac65fb787d8b507157175671619b975708cf7b", "message": "Merge branch 'master' into gg-30462", "committedDate": "2020-08-17T18:29:22Z", "type": "commit"}, {"oid": "54526f7c1defd9575760f3749412d8d13f7c5acc", "url": "https://github.com/gridgain/gridgain/commit/54526f7c1defd9575760f3749412d8d13f7c5acc", "message": "GG-30462 p2p deployment context validation added for Messaging and Events", "committedDate": "2020-08-25T12:46:00Z", "type": "commit"}, {"oid": "b0020b087bce3b2a5405d1d1de528e97a0b61306", "url": "https://github.com/gridgain/gridgain/commit/b0020b087bce3b2a5405d1d1de528e97a0b61306", "message": "Merge branch 'master' into gg-30462\n\n# Conflicts:\n#\tmodules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java", "committedDate": "2020-08-25T12:53:04Z", "type": "commit"}, {"oid": "96e3d75af04e0547d566fafda4b91193629544cb", "url": "https://github.com/gridgain/gridgain/commit/96e3d75af04e0547d566fafda4b91193629544cb", "message": "Merge branch 'master' into gg-30462", "committedDate": "2020-09-01T08:28:50Z", "type": "commit"}, {"oid": "fe68b4419a7c2f57c4e526c6e23e1b946e03d05d", "url": "https://github.com/gridgain/gridgain/commit/fe68b4419a7c2f57c4e526c6e23e1b946e03d05d", "message": "GG-30462 continuous routine registration with the same routineId on reconnect implemented", "committedDate": "2020-09-17T16:50:03Z", "type": "commit"}, {"oid": "db8d29fa1058f02b3cfdafa9a24a0f77fc6b2f81", "url": "https://github.com/gridgain/gridgain/commit/db8d29fa1058f02b3cfdafa9a24a0f77fc6b2f81", "message": "Merge branch 'master' into gg-30462\n\n# Conflicts:\n#\tmodules/core/src/main/java/org/apache/ignite/internal/util/IgniteUtils.java", "committedDate": "2020-09-17T16:55:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjUxMDM3Ng==", "url": "https://github.com/gridgain/gridgain/pull/1370#discussion_r492510376", "bodyText": "Should be on new line", "author": "ascherbakoff", "createdAt": "2020-09-22T06:56:03Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/continuous/GridContinuousProcessor.java", "diffHunk": "@@ -487,8 +514,22 @@ private Serializable getDiscoveryData(UUID joiningNodeId) {\n     private Map<UUID, LocalRoutineInfo> copyLocalInfos(Map<UUID, LocalRoutineInfo> locInfos) {\n         Map<UUID, LocalRoutineInfo> res = U.newHashMap(locInfos.size());\n \n-        for (Map.Entry<UUID, LocalRoutineInfo> e : locInfos.entrySet())\n+        for (Map.Entry<UUID, LocalRoutineInfo> e : locInfos.entrySet()) {\n+            if (ctx.config().isPeerClassLoadingEnabled()) {\n+                GridContinuousHandler hnd = e.getValue().handler();\n+\n+                try {\n+                    if (!hnd.p2pContextValid(ctx))\n+                        continue;\n+                } catch (IgniteCheckedException ex) {", "originalCommit": "db8d29fa1058f02b3cfdafa9a24a0f77fc6b2f81", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "01caf675cd8bd32ca19316e97c8a132ee1e224a2", "url": "https://github.com/gridgain/gridgain/commit/01caf675cd8bd32ca19316e97c8a132ee1e224a2", "message": "GG-30462 formatting fixed", "committedDate": "2020-09-28T07:47:12Z", "type": "commit"}, {"oid": "351647538b544007255f68503a9fb5e89214550f", "url": "https://github.com/gridgain/gridgain/commit/351647538b544007255f68503a9fb5e89214550f", "message": "Merge branch 'master' into gg-30462", "committedDate": "2020-09-28T10:14:42Z", "type": "commit"}]}