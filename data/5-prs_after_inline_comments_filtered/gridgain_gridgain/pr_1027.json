{"pr_number": 1027, "pr_title": "GG-28205 Implement of sending a snapshot informations from the grid through agent", "pr_createdAt": "2020-04-03T07:21:56Z", "pr_url": "https://github.com/gridgain/gridgain/pull/1027", "timeline": [{"oid": "04e04480d4a94bb2014d7a1f0f9295fe144215c5", "url": "https://github.com/gridgain/gridgain/commit/04e04480d4a94bb2014d7a1f0f9295fe144215c5", "message": "GG-28205 Collect and send snapshots.", "committedDate": "2020-04-03T05:55:37Z", "type": "commit"}, {"oid": "6625bcf9f52609b7695980e02071a822b88e5b1e", "url": "https://github.com/gridgain/gridgain/commit/6625bcf9f52609b7695980e02071a822b88e5b1e", "message": "GG-28205 Apply suggestions from review notes.", "committedDate": "2020-04-03T12:53:32Z", "type": "commit"}, {"oid": "84d041c4788f9b65cd3d83c568fbb250976d4cc9", "url": "https://github.com/gridgain/gridgain/commit/84d041c4788f9b65cd3d83c568fbb250976d4cc9", "message": "GG-28205: Fix typo.", "committedDate": "2020-04-06T14:39:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r404989481", "bodyText": "Why do we need this method? Can we replace its only usage with a constructor invocation?", "author": "dmekhanikov", "createdAt": "2020-04-07T17:33:33Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/processor/ClusterInfoProcessor.java", "diffHunk": "@@ -129,25 +129,23 @@ void sendClusterInfo(Event evt) {\n         if (log.isDebugEnabled())\n             log.debug(\"Sending cluster info to Control Center\");\n \n-        ClusterInfo clusterInfo = createClusterInfo();\n-\n-        populateClusterInfo(clusterInfo);\n-\n-        mgr.send(buildClusterDest(cluster.id()), clusterInfo);\n+        mgr.send(buildClusterDest(cluster.id()), buildClusterInfo());\n     }\n \n     /**\n      * @return Create cluster info.\n      */\n     protected ClusterInfo createClusterInfo() {", "originalCommit": "84d041c4788f9b65cd3d83c568fbb250976d4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAxMTQ4NQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405011485", "bodyText": "It seems that buildClusterInfo() should be made protected and overloaded in the ancestor, not createClusterInfo.", "author": "dmekhanikov", "createdAt": "2020-04-07T18:08:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUxMjU3NQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405512575", "bodyText": "In this case we will copy-paste  follow part of code:\n.setId(cluster.id())\n            .setTag(cluster.tag())\n            .setActive(cluster.active())\n            .setPersistenceEnabled(CU.isPersistenceEnabled(ctx.config()))\n            .setBaselineParameters(\n                new BaselineInfo(\n                    cluster.isBaselineAutoAdjustEnabled(),\n                    cluster.baselineAutoAdjustTimeout()\n                )\n            )\n            .setSecure(ctx.authentication().enabled() || ctx.security().enabled())\n            .setFeatures(getClusterFeatures(ctx, ctx.cluster().get().nodes()));", "author": "somjik-api", "createdAt": "2020-04-08T13:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU5NjY0MA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405596640", "bodyText": "Just use super.buildClusterInfo() to construct an instance of ClusterInfo in the ancestor.", "author": "dmekhanikov", "createdAt": "2020-04-08T15:07:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEzNDEyNA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411134124", "bodyText": "We can't do this because if we call super.buildClusterInfo() we construct ClusterInfo which doesn't contains additional fields. In this case we need to copy all it's fields to new GridGainClusterInfo which may leads to unexpected errors if we add some field to ClusterInfo and don't copy it to GridGainClusterInfo", "author": "nva", "createdAt": "2020-04-20T06:49:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI1MjI3Ng==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411252276", "bodyText": "Oh, yeah, you are right. Sorry, I missed that.\nBut it's still hard to tell the difference between these two methods. What's the difference between \"create\" and \"build\"?\nOne method creates an empty instance of ClusterInfo, another one creates AND populates it. But GridGainClusterInfoProcessor#createClusterInfo actually does both of those things, while it's supposed to do only creating, judging by the name.\nI like the previous design when you had two separate methods for creating and populating the ClusterInfo instances more. I suggest falling back to it.", "author": "dmekhanikov", "createdAt": "2020-04-20T10:02:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjE0NzI4MA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412147280", "bodyText": "Partial revert", "author": "nva", "createdAt": "2020-04-21T12:38:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk4OTQ4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MzM5Mg==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r404993392", "bodyText": "Unchecked cast warning. Add @SuppressWarnings(\"unchecked\") if you are sure about this.", "author": "dmekhanikov", "createdAt": "2020-04-07T17:39:47Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/utils/AgentUtils.java", "diffHunk": "@@ -226,6 +226,45 @@ public static void quiteStop(GridProcessor proc) {\n         }\n     }\n \n+    /**\n+     * Creates agent processor.\n+     *\n+     * @param clsName Processor class name.\n+     * @param paramTypes The parameter array.\n+     * @param args array of objects to be passed as arguments to the constructor call.\n+     * @return Agent processor.\n+     */\n+    public static <T extends GridProcessor> T createProcessor(String clsName, Class<?>[] paramTypes, Object... args) {\n+        ClassLoader ldr = U.gridClassLoader();\n+\n+        try {\n+            Class<?> mgrCls = ldr.loadClass(clsName);\n+\n+            return (T)mgrCls.getConstructor(paramTypes).newInstance(args);", "originalCommit": "84d041c4788f9b65cd3d83c568fbb250976d4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUxNDgwMg==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405514802", "bodyText": "IDEA disagree with you :)", "author": "somjik-api", "createdAt": "2020-04-08T13:14:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MzM5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU1NTM2Nw==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405555367", "bodyText": "Apparently, our custom inspections ignore such warnings: https://github.com/ggprivate/ggprivate/blob/8.7-master/idea/gridgain_inspections.xml#L256\nThey weren't configured in my environment properly, sorry about that.\nPlease ignore the comment.", "author": "dmekhanikov", "createdAt": "2020-04-08T14:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5MzM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5NjY1NA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r404996654", "bodyText": "Such exception handling is evil. With such approach you will miss a failure to instantiate a component. Failures to execute commands will follow, but you won't notice the root cause. You should at least log an error message here.", "author": "dmekhanikov", "createdAt": "2020-04-07T17:44:58Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/utils/AgentUtils.java", "diffHunk": "@@ -226,6 +226,45 @@ public static void quiteStop(GridProcessor proc) {\n         }\n     }\n \n+    /**\n+     * Creates agent processor.\n+     *\n+     * @param clsName Processor class name.\n+     * @param paramTypes The parameter array.\n+     * @param args array of objects to be passed as arguments to the constructor call.\n+     * @return Agent processor.\n+     */\n+    public static <T extends GridProcessor> T createProcessor(String clsName, Class<?>[] paramTypes, Object... args) {\n+        ClassLoader ldr = U.gridClassLoader();\n+\n+        try {\n+            Class<?> mgrCls = ldr.loadClass(clsName);\n+\n+            return (T)mgrCls.getConstructor(paramTypes).newInstance(args);\n+        }\n+        catch (Exception ignored) {\n+            // No-op.", "originalCommit": "84d041c4788f9b65cd3d83c568fbb250976d4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU0OTU2NQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405549565", "bodyText": "Add warn log", "author": "somjik-api", "createdAt": "2020-04-08T14:02:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5NjY1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU5NzE5Nw==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405597197", "bodyText": "It looks more like an error to me", "author": "dmekhanikov", "createdAt": "2020-04-08T15:07:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5NjY1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5NzY3Ng==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r404997676", "bodyText": "I don't think we should ever start quietly. Issues during processor's initialization are quite important to register.", "author": "dmekhanikov", "createdAt": "2020-04-07T17:46:41Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/utils/AgentUtils.java", "diffHunk": "@@ -226,6 +226,45 @@ public static void quiteStop(GridProcessor proc) {\n         }\n     }\n \n+    /**\n+     * Creates agent processor.\n+     *\n+     * @param clsName Processor class name.\n+     * @param paramTypes The parameter array.\n+     * @param args array of objects to be passed as arguments to the constructor call.\n+     * @return Agent processor.\n+     */\n+    public static <T extends GridProcessor> T createProcessor(String clsName, Class<?>[] paramTypes, Object... args) {\n+        ClassLoader ldr = U.gridClassLoader();\n+\n+        try {\n+            Class<?> mgrCls = ldr.loadClass(clsName);\n+\n+            return (T)mgrCls.getConstructor(paramTypes).newInstance(args);\n+        }\n+        catch (Exception ignored) {\n+            // No-op.\n+        }\n+\n+        return null;\n+    }\n+\n+    /**\n+     * Quietly start given processor ignoring possible checked exception.\n+     *\n+     * @param proc Processor.\n+     */\n+    public static void quietStart(GridProcessor proc) {", "originalCommit": "84d041c4788f9b65cd3d83c568fbb250976d4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTU0OTYxNQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405549615", "bodyText": "Add warn log", "author": "somjik-api", "createdAt": "2020-04-08T14:02:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDk5NzY3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAwMDkxNg==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405000916", "bodyText": "What is the logic behind this rearrangement?", "author": "dmekhanikov", "createdAt": "2020-04-07T17:51:51Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/agent/ManagementConsoleAgent.java", "diffHunk": "@@ -87,17 +87,20 @@\n     /** Discovery event on restart agent. */\n     private static final int[] EVTS_DISCOVERY = new int[] {EVT_NODE_FAILED, EVT_NODE_LEFT, EVT_NODE_SEGMENTED};\n \n-    /** Management configuration instance. */\n-    private ManagementConfiguration cfg = new ManagementConfiguration();\n-\n     /** Websocket manager. */\n     protected WebSocketManager mgr;\n \n     /** Cluster processor. */\n-    private ClusterInfoProcessor clusterProc;\n+    protected ClusterInfoProcessor clusterProc;\n \n-    /** Span exporter. */\n-    private SpanExporter spanExporter;\n+    /** Actions dispatcher. */\n+    private ActionDispatcher actDispatcher;", "originalCommit": "84d041c4788f9b65cd3d83c568fbb250976d4cc9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTUxNTk1NQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r405515955", "bodyText": "I don't know, let's ask @nva", "author": "somjik-api", "createdAt": "2020-04-08T13:16:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAwMDkxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTEzMDA4NA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411130084", "bodyText": "Revert", "author": "nva", "createdAt": "2020-04-20T06:41:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTAwMDkxNg=="}], "type": "inlineReview"}, {"oid": "36466197cfe98fe71466017d4e4f514daba6cf23", "url": "https://github.com/gridgain/gridgain/commit/36466197cfe98fe71466017d4e4f514daba6cf23", "message": "GG-28205: Fix tests and licence.", "committedDate": "2020-04-08T12:42:52Z", "type": "commit"}, {"oid": "36d7d137c7dec7f50977680d2af81e023d437bd0", "url": "https://github.com/gridgain/gridgain/commit/36d7d137c7dec7f50977680d2af81e023d437bd0", "message": "GG-28205: Review fixes.", "committedDate": "2020-04-08T14:02:19Z", "type": "commit"}, {"oid": "d76d167d1adfba30f1d421abbbca53c9358de8f3", "url": "https://github.com/gridgain/gridgain/commit/d76d167d1adfba30f1d421abbbca53c9358de8f3", "message": "GG-28205: Review fixes.", "committedDate": "2020-04-08T14:04:23Z", "type": "commit"}, {"oid": "6747784310216d514f4b7d91a8706e8891848689", "url": "https://github.com/gridgain/gridgain/commit/6747784310216d514f4b7d91a8706e8891848689", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205\n\n\u0001 Conflicts:\n\u0001\tmodules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/ManagementConsoleAgent.java\n\u0001\tmodules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/processor/ManagementConsoleMessagesProcessor.java\n\u0001\tmodules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/utils/AgentUtils.java", "committedDate": "2020-04-20T04:02:55Z", "type": "commit"}, {"oid": "2f3290fd791bb8ecc1ac9df02828a8b415fb4fa3", "url": "https://github.com/gridgain/gridgain/commit/2f3290fd791bb8ecc1ac9df02828a8b415fb4fa3", "message": "GG-28205 Revert unneeded changes.", "committedDate": "2020-04-20T06:36:18Z", "type": "commit"}, {"oid": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "url": "https://github.com/gridgain/gridgain/commit/d84a7c05fd577ed3ac9736b345ac02f04605c313", "message": "GG-28205 Improve log message.", "committedDate": "2020-04-20T06:55:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDAyNQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411260025", "bodyText": "It doesn't do it quietly.", "author": "dmekhanikov", "createdAt": "2020-04-20T10:14:54Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/utils/AgentUtils.java", "diffHunk": "@@ -214,14 +215,56 @@ public static void authorizeIfNeeded(IgniteSecurity security, String name, Secur\n      * Quietly closes given processor ignoring possible checked exception.\n      *\n      * @param proc Process.\n+     * @param log Logger.\n      */\n-    public static void quiteStop(GridProcessor proc) {\n+    public static void stopProcessor(GridProcessor proc, IgniteLogger log) {\n         if (proc != null) {\n             try {\n                 proc.stop(true);\n             }\n-            catch (Exception ignored) {\n-                // No-op.\n+            catch (Exception ex) {\n+                U.warn(log, ex.getMessage(), ex);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Creates agent processor.\n+     *\n+     * @param log Logger.\n+     * @param clsName Processor class name.\n+     * @param paramTypes The parameter array.\n+     * @param args array of objects to be passed as arguments to the constructor call.\n+     * @return Agent processor.\n+     */\n+    public static <T extends GridProcessor> T createProcessor(IgniteLogger log, String clsName, Class<?>[] paramTypes, Object... args) {\n+        ClassLoader ldr = U.gridClassLoader();\n+\n+        try {\n+            Class<?> mgrCls = ldr.loadClass(clsName);\n+\n+            return (T)mgrCls.getConstructor(paramTypes).newInstance(args);\n+        }\n+        catch (Exception ex) {\n+            U.warn(log, \"Failed to initialize GridGain Control Center agent processor: \" + clsName, ex);\n+        }\n+\n+        return null;\n+    }\n+\n+    /**\n+     * Quietly start given processor ignoring possible checked exception.", "originalCommit": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg1NzgzMg==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411857832", "bodyText": "Fixed", "author": "nva", "createdAt": "2020-04-21T04:23:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDAyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDI3MA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411260270", "bodyText": "Impossibility to start a processor sounds more like an ERROR to me.", "author": "dmekhanikov", "createdAt": "2020-04-20T10:15:21Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/utils/AgentUtils.java", "diffHunk": "@@ -214,14 +215,56 @@ public static void authorizeIfNeeded(IgniteSecurity security, String name, Secur\n      * Quietly closes given processor ignoring possible checked exception.\n      *\n      * @param proc Process.\n+     * @param log Logger.\n      */\n-    public static void quiteStop(GridProcessor proc) {\n+    public static void stopProcessor(GridProcessor proc, IgniteLogger log) {\n         if (proc != null) {\n             try {\n                 proc.stop(true);\n             }\n-            catch (Exception ignored) {\n-                // No-op.\n+            catch (Exception ex) {\n+                U.warn(log, ex.getMessage(), ex);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Creates agent processor.\n+     *\n+     * @param log Logger.\n+     * @param clsName Processor class name.\n+     * @param paramTypes The parameter array.\n+     * @param args array of objects to be passed as arguments to the constructor call.\n+     * @return Agent processor.\n+     */\n+    public static <T extends GridProcessor> T createProcessor(IgniteLogger log, String clsName, Class<?>[] paramTypes, Object... args) {\n+        ClassLoader ldr = U.gridClassLoader();\n+\n+        try {\n+            Class<?> mgrCls = ldr.loadClass(clsName);\n+\n+            return (T)mgrCls.getConstructor(paramTypes).newInstance(args);\n+        }\n+        catch (Exception ex) {\n+            U.warn(log, \"Failed to initialize GridGain Control Center agent processor: \" + clsName, ex);\n+        }\n+\n+        return null;\n+    }\n+\n+    /**\n+     * Quietly start given processor ignoring possible checked exception.\n+     *\n+     * @param proc Processor.\n+     * @param log Logger.\n+     */\n+    public static void startProcessor(GridProcessor proc, IgniteLogger log) {\n+        if (proc != null) {\n+            try {\n+                proc.start();\n+            }\n+            catch (Exception ex) {\n+                U.warn(log, ex.getMessage(), ex);", "originalCommit": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDQyMQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411260421", "bodyText": "Also some message would be nice.", "author": "dmekhanikov", "createdAt": "2020-04-20T10:15:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDI3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg1NzkxNQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411857915", "bodyText": "Fixed", "author": "nva", "createdAt": "2020-04-21T04:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDI3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDYwNg==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411260606", "bodyText": "Looks more like an ERROR.", "author": "dmekhanikov", "createdAt": "2020-04-20T10:15:57Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/utils/AgentUtils.java", "diffHunk": "@@ -214,14 +215,56 @@ public static void authorizeIfNeeded(IgniteSecurity security, String name, Secur\n      * Quietly closes given processor ignoring possible checked exception.\n      *\n      * @param proc Process.\n+     * @param log Logger.\n      */\n-    public static void quiteStop(GridProcessor proc) {\n+    public static void stopProcessor(GridProcessor proc, IgniteLogger log) {\n         if (proc != null) {\n             try {\n                 proc.stop(true);\n             }\n-            catch (Exception ignored) {\n-                // No-op.\n+            catch (Exception ex) {\n+                U.warn(log, ex.getMessage(), ex);\n+            }\n+        }\n+    }\n+\n+    /**\n+     * Creates agent processor.\n+     *\n+     * @param log Logger.\n+     * @param clsName Processor class name.\n+     * @param paramTypes The parameter array.\n+     * @param args array of objects to be passed as arguments to the constructor call.\n+     * @return Agent processor.\n+     */\n+    public static <T extends GridProcessor> T createProcessor(IgniteLogger log, String clsName, Class<?>[] paramTypes, Object... args) {\n+        ClassLoader ldr = U.gridClassLoader();\n+\n+        try {\n+            Class<?> mgrCls = ldr.loadClass(clsName);\n+\n+            return (T)mgrCls.getConstructor(paramTypes).newInstance(args);\n+        }\n+        catch (Exception ex) {\n+            U.warn(log, \"Failed to initialize GridGain Control Center agent processor: \" + clsName, ex);", "originalCommit": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg1ODEwMg==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411858102", "bodyText": "Change log level", "author": "nva", "createdAt": "2020-04-21T04:23:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MDYwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MTYwNQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411261605", "bodyText": "I would say, that errors reported during stopping are not that critical. I would change the logging level to DEBUG. What do you think?", "author": "dmekhanikov", "createdAt": "2020-04-20T10:17:31Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/utils/AgentUtils.java", "diffHunk": "@@ -214,14 +215,56 @@ public static void authorizeIfNeeded(IgniteSecurity security, String name, Secur\n      * Quietly closes given processor ignoring possible checked exception.\n      *\n      * @param proc Process.\n+     * @param log Logger.\n      */\n-    public static void quiteStop(GridProcessor proc) {\n+    public static void stopProcessor(GridProcessor proc, IgniteLogger log) {\n         if (proc != null) {\n             try {\n                 proc.stop(true);\n             }\n-            catch (Exception ignored) {\n-                // No-op.\n+            catch (Exception ex) {\n+                U.warn(log, ex.getMessage(), ex);", "originalCommit": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg2MTkxOA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411861918", "bodyText": "I disagree with you. IgniteLogger with logging level to DEBUG can't print stacktrace. I think we need stacktrace for debug.", "author": "nva", "createdAt": "2020-04-21T04:35:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MTYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjI5Njk3MA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412296970", "bodyText": "OK, I see. So, the issue is that we don't have such method in IgniteLogger. I created a ticket for this improvement: https://ggsystems.atlassian.net/browse/GG-28856\nSuch error handling will lead to a lot of exceptions printed when a node is stopped. As far as I can see, these errors can only occur when a node is stopped, so the reason behind it is almost always in something else. Let's keep it as warning for now.", "author": "dmekhanikov", "createdAt": "2020-04-21T16:00:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2MTYwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2Mzk0OQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411263949", "bodyText": "Could you clarify in the javadoc, what this interface is for. Where is it supposed to be used?", "author": "dmekhanikov", "createdAt": "2020-04-20T10:21:17Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/management/ManagementConsoleSender.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2019 GridGain Systems, Inc. and Contributors.\n+ *\n+ * Licensed under the GridGain Community Edition License (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     https://www.gridgain.com/products/software/community-edition/gridgain-community-edition-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.ignite.internal.processors.management;\n+\n+/**\n+ * Control Center sender.\n+ */\n+public interface ManagementConsoleSender {", "originalCommit": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg2NDA5Mw==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411864093", "bodyText": "Improve javadoc and reuse this interface in all agent processors", "author": "nva", "createdAt": "2020-04-21T04:42:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2Mzk0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2OTY1Ng==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411269656", "bodyText": "It doesn't do it quietly.", "author": "dmekhanikov", "createdAt": "2020-04-20T10:30:54Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/utils/AgentUtils.java", "diffHunk": "@@ -214,14 +215,56 @@ public static void authorizeIfNeeded(IgniteSecurity security, String name, Secur\n      * Quietly closes given processor ignoring possible checked exception.", "originalCommit": "d84a7c05fd577ed3ac9736b345ac02f04605c313", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTg2OTE0NQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r411869145", "bodyText": "Fixed javadoc", "author": "nva", "createdAt": "2020-04-21T04:57:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTI2OTY1Ng=="}], "type": "inlineReview"}, {"oid": "b6db3c09535b0d09e1f52dc12474ade525e002a3", "url": "https://github.com/gridgain/gridgain/commit/b6db3c09535b0d09e1f52dc12474ade525e002a3", "message": "GG-28205 Revert changes.", "committedDate": "2020-04-21T03:09:29Z", "type": "commit"}, {"oid": "e076b3d308551e33738afe3c92704c11eb335628", "url": "https://github.com/gridgain/gridgain/commit/e076b3d308551e33738afe3c92704c11eb335628", "message": "GG-28205 Apply suggestions from review notes.", "committedDate": "2020-04-21T04:22:33Z", "type": "commit"}, {"oid": "6e5b39b4686b27e9af3468a15e138b0da7b1b6f7", "url": "https://github.com/gridgain/gridgain/commit/6e5b39b4686b27e9af3468a15e138b0da7b1b6f7", "message": "GG-28205 Use interface instead of implementation.", "committedDate": "2020-04-21T04:55:11Z", "type": "commit"}, {"oid": "b6d601ec515b0624c3e3f63ee54b94609f436c91", "url": "https://github.com/gridgain/gridgain/commit/b6d601ec515b0624c3e3f63ee54b94609f436c91", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-21T05:04:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyNDA1OA==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412324058", "bodyText": "As I remember there was a message from Goncharuk, that we start using 2020 instead of 2019 in Copyrights, please investigate and fix if needed.", "author": "akuznetsov-gridgain", "createdAt": "2020-04-21T16:52:34Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/management/ControlCenterSender.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright 2019 GridGain Systems, Inc. and Contributors.", "originalCommit": "b6d601ec515b0624c3e3f63ee54b94609f436c91", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjYzMjcxNw==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412632717", "bodyText": "Fixed", "author": "nva", "createdAt": "2020-04-22T02:59:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyNDA1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMzMjQ3MQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412332471", "bodyText": "Lets use static import for StandardCharsets.UTF_8 ?", "author": "akuznetsov-gridgain", "createdAt": "2020-04-21T17:03:20Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/ws/WebSocketManager.java", "diffHunk": "@@ -336,7 +331,7 @@ private void addAuthentication(ClientManager mgr) {\n             Map<String, String> proxyHeaders = new HashMap<>();\n \n             proxyHeaders.put(\"Proxy-Authorization\", \"Basic \" +\n-                encodeToString((user + ':' + pwd).getBytes(Charset.forName(\"UTF-8\"))));\n+                encodeToString((user + ':' + pwd).getBytes(StandardCharsets.UTF_8)));", "originalCommit": "b6d601ec515b0624c3e3f63ee54b94609f436c91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1941657c366680d1839d62339cc4ed9e0a8f2c44", "url": "https://github.com/gridgain/gridgain/commit/1941657c366680d1839d62339cc4ed9e0a8f2c44", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-22T02:52:08Z", "type": "commit"}, {"oid": "1bce203325e07ed94b7ff7fc2795461b7788be1e", "url": "https://github.com/gridgain/gridgain/commit/1bce203325e07ed94b7ff7fc2795461b7788be1e", "message": "GG-28205 Apply suggestions from review notes.", "committedDate": "2020-04-22T02:58:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgzMTI3NQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412831275", "bodyText": "Please clarify, that this sender is responsible for communication with the backend.", "author": "dmekhanikov", "createdAt": "2020-04-22T09:40:22Z", "path": "modules/core/src/main/java/org/apache/ignite/internal/processors/management/ManagementConsoleProcessor.java", "diffHunk": "@@ -35,4 +35,9 @@\n      * @return Management configuration instance.\n      */\n     public ManagementConfiguration configuration();\n+\n+    /**\n+     * @return Control Center sender.\n+     */\n+    public ControlCenterSender sender();", "originalCommit": "1bce203325e07ed94b7ff7fc2795461b7788be1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjgzMzE0OQ==", "url": "https://github.com/gridgain/gridgain/pull/1027#discussion_r412833149", "bodyText": "The javadoc is wrong.", "author": "dmekhanikov", "createdAt": "2020-04-22T09:43:07Z", "path": "modules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/processor/ClusterInfoProcessor.java", "diffHunk": "@@ -65,18 +65,18 @@\n     protected IgniteClusterEx cluster;\n \n     /** Manager. */", "originalCommit": "1bce203325e07ed94b7ff7fc2795461b7788be1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3e38c279af9c1e99a2fb5a0651068650b3b9dbe1", "url": "https://github.com/gridgain/gridgain/commit/3e38c279af9c1e99a2fb5a0651068650b3b9dbe1", "message": "GG-28205 Apply suggestions from review notes.", "committedDate": "2020-04-22T11:34:24Z", "type": "commit"}, {"oid": "18cee515dc3461481d3fe0075c1196510600ebe5", "url": "https://github.com/gridgain/gridgain/commit/18cee515dc3461481d3fe0075c1196510600ebe5", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-23T03:38:54Z", "type": "commit"}, {"oid": "f4561239eefa8c496cb5252d4d1c02e89712e4a0", "url": "https://github.com/gridgain/gridgain/commit/f4561239eefa8c496cb5252d4d1c02e89712e4a0", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-23T08:59:02Z", "type": "commit"}, {"oid": "5f4da68f310454b6a8a1745c283a918b59f7aa37", "url": "https://github.com/gridgain/gridgain/commit/5f4da68f310454b6a8a1745c283a918b59f7aa37", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-24T03:14:15Z", "type": "commit"}, {"oid": "f05386cab8c3bc4d63ca241d8260f623d601c260", "url": "https://github.com/gridgain/gridgain/commit/f05386cab8c3bc4d63ca241d8260f623d601c260", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-27T02:20:48Z", "type": "commit"}, {"oid": "412632e81c62380c277fb828e2a5f9d608ed8b01", "url": "https://github.com/gridgain/gridgain/commit/412632e81c62380c277fb828e2a5f9d608ed8b01", "message": "Merge branches '8.7-master' and 'gg-28205' of https://github.com/gridgain/gridgain into gg-28205\n\n\u0001 Conflicts:\n\u0001\tmodules/management-console-agent/src/main/java/org/apache/ignite/internal/agent/processor/ClusterInfoProcessor.java", "committedDate": "2020-04-28T02:23:48Z", "type": "commit"}, {"oid": "a22081153ded3bb7a4b732bc3d7b04f7c56e9d7b", "url": "https://github.com/gridgain/gridgain/commit/a22081153ded3bb7a4b732bc3d7b04f7c56e9d7b", "message": "Merge branch '8.7-master' of https://github.com/gridgain/gridgain into gg-28205", "committedDate": "2020-04-30T02:43:24Z", "type": "commit"}]}