{"pr_number": 309, "pr_title": "Improve stream extractor tests & various fixes", "pr_createdAt": "2020-04-09T20:37:06Z", "pr_url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MTA3NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406671075", "bodyText": "Why are you using a regex for conferences while using substring() for API URLs here and using URL#getPath() + substring() for non-API URLs here?", "author": "wb9688", "createdAt": "2020-04-10T09:00:01Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/media_ccc/linkHandler/MediaCCCStreamLinkHandlerFactory.java", "diffHunk": "@@ -9,10 +8,12 @@\n import java.net.URL;\n \n public class MediaCCCStreamLinkHandlerFactory extends LinkHandlerFactory {\n+    public static final String VIDEO_API_ENDPOINT = \"https://api.media.ccc.de/public/events/\";\n+    private static final String VIDEO_PATH = \"https://media.ccc.de/v/\";\n \n     @Override\n     public String getId(String urlString) throws ParsingException {\n-        if (urlString.startsWith(\"https://api.media.ccc.de/public/events/\") &&\n+        if (urlString.startsWith(VIDEO_API_ENDPOINT) &&\n                 !urlString.contains(\"?q=\")) {\n             return urlString.substring(39); //remove api\u2026/public/events part\n         }", "originalCommit": "051e3fa5aa43417ac221ac030aa33ae2e3359cc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5ODg0OQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406698849", "bodyText": "I left everything as it was before, I only replaced the hardcoded url. Will fix this", "author": "Stypox", "createdAt": "2020-04-10T10:22:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MTA3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MTgzMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406671830", "bodyText": "Please also handle the API URLs in getId() here", "author": "wb9688", "createdAt": "2020-04-10T09:02:01Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/peertube/linkHandler/PeertubeChannelLinkHandlerFactory.java", "diffHunk": "@@ -31,7 +32,7 @@ public String getUrl(String id, List<String> contentFilters, String searchFilter\n     @Override", "originalCommit": "051e3fa5aa43417ac221ac030aa33ae2e3359cc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NDUxMg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r407064512", "bodyText": "Fixed while rebasing with the latest changes about accounts and channels", "author": "Stypox", "createdAt": "2020-04-11T13:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MTgzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MjI3MA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406672270", "bodyText": "Please also handle the API URLs in getId() here", "author": "wb9688", "createdAt": "2020-04-10T09:03:00Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/peertube/linkHandler/PeertubeStreamLinkHandlerFactory.java", "diffHunk": "@@ -27,7 +28,7 @@ public String getUrl(String id) {\n \n     @Override\n     public String getUrl(String id, String baseUrl) {\n-        return baseUrl + VIDEO_ENDPOINT + id;\n+        return baseUrl + VIDEO_PATH + id;\n     }\n \n     @Override", "originalCommit": "051e3fa5aa43417ac221ac030aa33ae2e3359cc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5OTI1OA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406699258", "bodyText": "Oh right, for some reason I thought they were already being handled in some strange way", "author": "Stypox", "createdAt": "2020-04-10T10:23:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MjI3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NDM3OA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r407064378", "bodyText": "Those are already handled by the regex: /videos/(watch/)?([^/?&#]*)\nBoth \"framatube.org/api/v1/videos/id\" and \"framatube.org/videos/id\" match it and the second group is obtained correctly", "author": "Stypox", "createdAt": "2020-04-11T13:31:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MjI3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MjYyOQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406672629", "bodyText": "Could be final", "author": "wb9688", "createdAt": "2020-04-10T09:03:54Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -258,7 +258,14 @@ public long getLength() throws ParsingException {\n      */\n     @Override\n     public long getTimeStamp() throws ParsingException {\n-        return getTimestampSeconds(\"((#|&|\\\\?)t=\\\\d{0,3}h?\\\\d{0,3}m?\\\\d{1,3}s?)\");\n+        long timestamp = getTimestampSeconds(\"((#|&|\\\\?)t=\\\\d{0,3}h?\\\\d{0,3}m?\\\\d{1,3}s?)\");", "originalCommit": "051e3fa5aa43417ac221ac030aa33ae2e3359cc0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3Mjc2Ng==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406672766", "bodyText": "Why was this changed?", "author": "wb9688", "createdAt": "2020-04-10T09:04:14Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/extractors/YoutubeStreamExtractor.java", "diffHunk": "@@ -579,7 +586,7 @@ public String getErrorMessage() {\n         try {\n             return getTextFromObject(initialAjaxJson.getObject(2).getObject(\"playerResponse\").getObject(\"playabilityStatus\")\n                     .getObject(\"errorScreen\").getObject(\"playerErrorMessageRenderer\").getObject(\"reason\"));\n-        } catch (ParsingException e) {\n+        } catch (Exception e) {", "originalCommit": "051e3fa5aa43417ac221ac030aa33ae2e3359cc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5ODAzOQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406698039", "bodyText": "So that it also catches NullPointerExceptions, which are generated when there is no error message. In that case null should be returned", "author": "Stypox", "createdAt": "2020-04-10T10:19:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3Mjc2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzA2NTAxNA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r407065014", "bodyText": "Then why aren't you catching (ParsingException | NullPointerException e)?", "author": "B0pol", "createdAt": "2020-04-11T13:37:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3Mjc2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MzU3MQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406673571", "bodyText": "Could be final, just like a lot of variables in this class", "author": "wb9688", "createdAt": "2020-04-10T09:06:24Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,289 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        Description description = extractor().getDescription();", "originalCommit": "051e3fa5aa43417ac221ac030aa33ae2e3359cc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY5ODA4Mg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r406698082", "bodyText": "Ok, will fix this in all modified files", "author": "Stypox", "createdAt": "2020-04-10T10:19:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjY3MzU3MQ=="}], "type": "inlineReview"}, {"oid": "b6ae05794f0ec1620706af5df3c55ccfcbb3f091", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/b6ae05794f0ec1620706af5df3c55ccfcbb3f091", "message": "[Test] Optimize imports", "committedDate": "2020-04-11T13:26:05Z", "type": "forcePushed"}, {"oid": "6dd5f016b1c9de508bc2d99105221aa8383a53c8", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/6dd5f016b1c9de508bc2d99105221aa8383a53c8", "message": "[YouTube] Fix livestream test actually having video streams\n\nAlso fix description test that was not valid anymore", "committedDate": "2020-04-20T06:41:23Z", "type": "forcePushed"}, {"oid": "ab85fcb91ec4b916e7074fad565e2624e78c0cd1", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/ab85fcb91ec4b916e7074fad565e2624e78c0cd1", "message": "[MediaCCC] Return empty list of video-only streams instead of null", "committedDate": "2020-04-20T07:01:51Z", "type": "forcePushed"}, {"oid": "505f19c4db56f23a5a08d1cba66c2e9043b4964f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/505f19c4db56f23a5a08d1cba66c2e9043b4964f", "message": "[MediaCCC] Return empty list of video-only streams instead of null", "committedDate": "2020-05-06T19:19:21Z", "type": "forcePushed"}, {"oid": "e4ace2b0dc97db6df467f41a74219776304dac6f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/e4ace2b0dc97db6df467f41a74219776304dac6f", "message": "[MediaCCC] Return empty list of video-only streams instead of null", "committedDate": "2020-05-09T14:23:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3MjQwMw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r425072403", "bodyText": "final", "author": "wb9688", "createdAt": "2020-05-14T11:42:03Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,297 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+            expectedDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            actualDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                int formatId = stream.getFormatId();", "originalCommit": "e4ace2b0dc97db6df467f41a74219776304dac6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3MjQ1NA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r425072454", "bodyText": "final", "author": "wb9688", "createdAt": "2020-05-14T11:42:09Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,297 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+            expectedDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            actualDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit a video stream: \" + formatId,\n+                        0 <= formatId && formatId < 0x100);\n+            }\n+        } else {\n+            assertTrue(videoStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAudioStreams() throws Exception {\n+        final List<AudioStream> audioStreams = extractor().getAudioStreams();\n+        assertNotNull(audioStreams);\n+\n+        if (expectedHasAudioStreams()) {\n+            assertFalse(audioStreams.isEmpty());\n+\n+            for (AudioStream stream : audioStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();", "originalCommit": "e4ace2b0dc97db6df467f41a74219776304dac6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3MjUyNQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r425072525", "bodyText": "final", "author": "wb9688", "createdAt": "2020-05-14T11:42:16Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,297 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+            expectedDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            actualDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit a video stream: \" + formatId,\n+                        0 <= formatId && formatId < 0x100);\n+            }\n+        } else {\n+            assertTrue(videoStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAudioStreams() throws Exception {\n+        final List<AudioStream> audioStreams = extractor().getAudioStreams();\n+        assertNotNull(audioStreams);\n+\n+        if (expectedHasAudioStreams()) {\n+            assertFalse(audioStreams.isEmpty());\n+\n+            for (AudioStream stream : audioStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x100 <= formatId && formatId < 0x1000);\n+            }\n+        } else {\n+            assertTrue(audioStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubtitles() throws Exception {\n+        List<SubtitlesStream> subtitles = extractor().getSubtitlesDefault();", "originalCommit": "e4ace2b0dc97db6df467f41a74219776304dac6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3MjU3NQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r425072575", "bodyText": "final", "author": "wb9688", "createdAt": "2020-05-14T11:42:21Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,297 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+            expectedDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            actualDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit a video stream: \" + formatId,\n+                        0 <= formatId && formatId < 0x100);\n+            }\n+        } else {\n+            assertTrue(videoStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAudioStreams() throws Exception {\n+        final List<AudioStream> audioStreams = extractor().getAudioStreams();\n+        assertNotNull(audioStreams);\n+\n+        if (expectedHasAudioStreams()) {\n+            assertFalse(audioStreams.isEmpty());\n+\n+            for (AudioStream stream : audioStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x100 <= formatId && formatId < 0x1000);\n+            }\n+        } else {\n+            assertTrue(audioStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubtitles() throws Exception {\n+        List<SubtitlesStream> subtitles = extractor().getSubtitlesDefault();\n+        assertNotNull(subtitles);\n+\n+        if (expectedHasSubtitles()) {\n+            assertFalse(subtitles.isEmpty());\n+\n+            for (SubtitlesStream stream : subtitles) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();", "originalCommit": "e4ace2b0dc97db6df467f41a74219776304dac6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3MjYxNA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r425072614", "bodyText": "final", "author": "wb9688", "createdAt": "2020-05-14T11:42:26Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,297 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+            expectedDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            actualDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit a video stream: \" + formatId,\n+                        0 <= formatId && formatId < 0x100);\n+            }\n+        } else {\n+            assertTrue(videoStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAudioStreams() throws Exception {\n+        final List<AudioStream> audioStreams = extractor().getAudioStreams();\n+        assertNotNull(audioStreams);\n+\n+        if (expectedHasAudioStreams()) {\n+            assertFalse(audioStreams.isEmpty());\n+\n+            for (AudioStream stream : audioStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x100 <= formatId && formatId < 0x1000);\n+            }\n+        } else {\n+            assertTrue(audioStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubtitles() throws Exception {\n+        List<SubtitlesStream> subtitles = extractor().getSubtitlesDefault();\n+        assertNotNull(subtitles);\n+\n+        if (expectedHasSubtitles()) {\n+            assertFalse(subtitles.isEmpty());\n+\n+            for (SubtitlesStream stream : subtitles) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x1000 <= formatId && formatId < 0x10000);\n+            }\n+        } else {\n+            assertTrue(subtitles.isEmpty());\n+\n+            MediaFormat[] formats = {MediaFormat.VTT, MediaFormat.TTML, MediaFormat.TRANSCRIPT1,", "originalCommit": "e4ace2b0dc97db6df467f41a74219776304dac6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTA3MzQyMA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r425073420", "bodyText": "Make this a variable that's declared here, because this is imho unclear", "author": "wb9688", "createdAt": "2020-05-14T11:43:58Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,297 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.List;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; }; // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public boolean expectedHasNextStream() { return true; } // default: there is a next video\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+            expectedDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            actualDate.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit a video stream: \" + formatId,\n+                        0 <= formatId && formatId < 0x100);\n+            }\n+        } else {\n+            assertTrue(videoStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAudioStreams() throws Exception {\n+        final List<AudioStream> audioStreams = extractor().getAudioStreams();\n+        assertNotNull(audioStreams);\n+\n+        if (expectedHasAudioStreams()) {\n+            assertFalse(audioStreams.isEmpty());\n+\n+            for (AudioStream stream : audioStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x100 <= formatId && formatId < 0x1000);\n+            }\n+        } else {\n+            assertTrue(audioStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubtitles() throws Exception {\n+        List<SubtitlesStream> subtitles = extractor().getSubtitlesDefault();\n+        assertNotNull(subtitles);\n+\n+        if (expectedHasSubtitles()) {\n+            assertFalse(subtitles.isEmpty());\n+\n+            for (SubtitlesStream stream : subtitles) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x1000 <= formatId && formatId < 0x10000);\n+            }\n+        } else {\n+            assertTrue(subtitles.isEmpty());\n+\n+            MediaFormat[] formats = {MediaFormat.VTT, MediaFormat.TTML, MediaFormat.TRANSCRIPT1,\n+                    MediaFormat.TRANSCRIPT2, MediaFormat.TRANSCRIPT3, MediaFormat.SRT};\n+            for (MediaFormat format : formats) {\n+                subtitles = extractor().getSubtitles(format);", "originalCommit": "e4ace2b0dc97db6df467f41a74219776304dac6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fa29b78f77e1e323ec0512643f3bcaaf6bd13df0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/fa29b78f77e1e323ec0512643f3bcaaf6bd13df0", "message": "[Test] Add sub channel name, url and thumbnail tests", "committedDate": "2020-05-16T18:27:58Z", "type": "forcePushed"}, {"oid": "d22a9638af630257daeab920f1adfb8aabc159b6", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d22a9638af630257daeab920f1adfb8aabc159b6", "message": "[Test] Add sub channel name, url and thumbnail tests", "committedDate": "2020-05-16T18:29:42Z", "type": "forcePushed"}, {"oid": "d216b051dc5da6c63d601d243c8fa85492430894", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d216b051dc5da6c63d601d243c8fa85492430894", "message": "[YouTube] Consider dates as GMT and not as local", "committedDate": "2020-05-16T19:19:18Z", "type": "forcePushed"}, {"oid": "95367dd038ba04e680290a2b56a7c34216c3dab1", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/95367dd038ba04e680290a2b56a7c34216c3dab1", "message": "[YouTube/MediaCCC] Consider dates as GMT and not as local", "committedDate": "2020-05-16T19:23:38Z", "type": "forcePushed"}, {"oid": "1ef0687e766dfa9a792039856052800adc61cc23", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/1ef0687e766dfa9a792039856052800adc61cc23", "message": "[YouTube/MediaCCC] Consider dates as GMT and not as local", "committedDate": "2020-06-14T08:20:19Z", "type": "forcePushed"}, {"oid": "abbeacb312e1765afd9008cb61e6808c4544b701", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/abbeacb312e1765afd9008cb61e6808c4544b701", "message": "[PeerTube] Change age restricted video in tests\n\nThe old one wasn't available anymore", "committedDate": "2020-06-14T18:19:43Z", "type": "forcePushed"}, {"oid": "1d7a86e664717d09e33371bc87c289903b19feb2", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/1d7a86e664717d09e33371bc87c289903b19feb2", "message": "[Test] Add base classes for stream extractor tests\n\nRefactor all stream extractor tests to use new base class.\n\nRemove check if upload date is in the past: this does not have to hold true: youtube premieres turn up in search results even though they are in the future", "committedDate": "2020-10-24T16:22:44Z", "type": "commit"}, {"oid": "7fb867c1662457c51d6579f2803c913f356126bf", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7fb867c1662457c51d6579f2803c913f356126bf", "message": "[YouTube] Fix error message obtaining when there is none", "committedDate": "2020-10-24T16:22:44Z", "type": "commit"}, {"oid": "7cd410f3fc304a9eb620fa28ba39f938e4565c2b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7cd410f3fc304a9eb620fa28ba39f938e4565c2b", "message": "[YouTube] Return 0 when there is no timestamp, not -2, as per javadoc", "committedDate": "2020-10-24T16:23:45Z", "type": "commit"}, {"oid": "072bae321fdf9cca340d154d02b388623fadcc8a", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/072bae321fdf9cca340d154d02b388623fadcc8a", "message": "[YouTube] Fix frame extraction for livestreams\n\nUse saved playerResponse instead of parsing json every time", "committedDate": "2020-10-24T16:23:46Z", "type": "commit"}, {"oid": "3b2cfb4ca2e9fbe9457e2a4551d97f7fa8bc6fec", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3b2cfb4ca2e9fbe9457e2a4551d97f7fa8bc6fec", "message": "[SoundCloud] Return empty video stream list instead of null\n\nAlso replace every instance of `return new ArrayList<>();` with `return Collections.emptyList();`", "committedDate": "2020-10-24T16:23:46Z", "type": "commit"}, {"oid": "4349be13af66aaf9af4c244d53cce1702b3a0782", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/4349be13af66aaf9af4c244d53cce1702b3a0782", "message": "[PeerTube] Return empty audio stream list instead of null", "committedDate": "2020-10-24T16:25:56Z", "type": "commit"}, {"oid": "7ae3cb6d07cea6abb71d9c69eb2b1b276e5b795f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/7ae3cb6d07cea6abb71d9c69eb2b1b276e5b795f", "message": "[PeerTube] Fix link handler inconsistency providing API links", "committedDate": "2020-10-24T16:33:11Z", "type": "commit"}, {"oid": "aeeae87641f8ca41e62b985ad20f0cf1ed565aa6", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/aeeae87641f8ca41e62b985ad20f0cf1ed565aa6", "message": "[PeerTube] Parse timestamp from url (previously unimplemented)", "committedDate": "2020-10-24T16:33:42Z", "type": "commit"}, {"oid": "b461da792f375a8527587ff13ff8a6ed8c6f43b4", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/b461da792f375a8527587ff13ff8a6ed8c6f43b4", "message": "[MediaCCC] Fix link handler inconsistency providing API links", "committedDate": "2020-10-24T16:34:34Z", "type": "commit"}, {"oid": "3b2a1829d466e0f1b3d0b6c5a43de49bfde5a287", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3b2a1829d466e0f1b3d0b6c5a43de49bfde5a287", "message": "[MediaCCC] Extract tags", "committedDate": "2020-10-24T16:34:57Z", "type": "commit"}, {"oid": "492db83ccff20a71a24aaab94e8968be3d4fffcd", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/492db83ccff20a71a24aaab94e8968be3d4fffcd", "message": "[MediaCCC] Return null instead of empty items collector\n\nAs per the documentation in the base getRelatedStreams()", "committedDate": "2020-10-24T16:34:57Z", "type": "commit"}, {"oid": "d130fd79c31338293134f8416500f135fc57a63a", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d130fd79c31338293134f8416500f135fc57a63a", "message": "[PeerTube] Prepend \"accounts/\" to channel id for backward compatibility", "committedDate": "2020-10-24T16:36:21Z", "type": "commit"}, {"oid": "0c980b2d648b7eb72fa22482a390114da1d3f5ae", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/0c980b2d648b7eb72fa22482a390114da1d3f5ae", "message": "[PeerTube] Improve channel and stream link handler tests", "committedDate": "2020-10-24T16:36:21Z", "type": "commit"}, {"oid": "07a90d116a0059a027f158f59b5fe9d2720f361f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/07a90d116a0059a027f158f59b5fe9d2720f361f", "message": "[MediaCCC] Use regex to parse stream and conference urls", "committedDate": "2020-10-24T16:36:21Z", "type": "commit"}, {"oid": "af5b8b1915a5ca4d7a79341e550ca64eda5e94e4", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/af5b8b1915a5ca4d7a79341e550ca64eda5e94e4", "message": "[MediaCCC] Add tests for stream and conference link handlers", "committedDate": "2020-10-24T16:36:21Z", "type": "commit"}, {"oid": "fcb9b6f855ddd5345a6cefcc9b82a0f5138719dd", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/fcb9b6f855ddd5345a6cefcc9b82a0f5138719dd", "message": "[MediaCCC] Use final when possible, ide refactorings\n\nRefactorings on `throws` clause", "committedDate": "2020-10-24T16:36:22Z", "type": "commit"}, {"oid": "06430c4749295309727f72c6ac18f036f22bdc19", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/06430c4749295309727f72c6ac18f036f22bdc19", "message": "[PeerTube] Use final when possible, ide refactorings", "committedDate": "2020-10-24T16:39:06Z", "type": "commit"}, {"oid": "55bc01d1ce48404d6cb11cc419685696ba02eac5", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/55bc01d1ce48404d6cb11cc419685696ba02eac5", "message": "[SoundCloud] Use final when possible, ide refactorings", "committedDate": "2020-10-24T16:39:55Z", "type": "commit"}, {"oid": "3191bd6c703e1a410a03b50c2d0e4cbe7b30d7b8", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3191bd6c703e1a410a03b50c2d0e4cbe7b30d7b8", "message": "[YouTube] Use final when possible", "committedDate": "2020-10-24T16:39:55Z", "type": "commit"}, {"oid": "68d23defba04e3db08462d8268903ec23056fd5f", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/68d23defba04e3db08462d8268903ec23056fd5f", "message": "[YouTube] Do not catch every exception on getErrorMessage\n\n@B0pol suggestion", "committedDate": "2020-10-24T16:39:55Z", "type": "commit"}, {"oid": "8dc3f28618d38c692f3abee1ae612e54ac1de3ee", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8dc3f28618d38c692f3abee1ae612e54ac1de3ee", "message": "[PeerTube] Test one channel url with api and one without", "committedDate": "2020-10-24T16:39:55Z", "type": "commit"}, {"oid": "a4097d8d0119cfc71a3b969aa117df924af60e3d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/a4097d8d0119cfc71a3b969aa117df924af60e3d", "message": "[MediaCCC] Return empty list of video-only streams instead of null", "committedDate": "2020-10-24T16:39:55Z", "type": "commit"}, {"oid": "a087b092b401977bd58b279a3f285549db0e2160", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/a087b092b401977bd58b279a3f285549db0e2160", "message": "[Test] Improve code style and add final", "committedDate": "2020-10-24T16:39:55Z", "type": "commit"}, {"oid": "6127826571a9041cc9d9d264ac97239249f2aff9", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/6127826571a9041cc9d9d264ac97239249f2aff9", "message": "[Test] Add stream metadata tests", "committedDate": "2020-10-24T16:41:41Z", "type": "commit"}, {"oid": "8ce711f40fe3667a9184da513a794d83c098985d", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/8ce711f40fe3667a9184da513a794d83c098985d", "message": "[Test] Add sub channel name, url and thumbnail tests", "committedDate": "2020-10-24T16:41:41Z", "type": "commit"}, {"oid": "d0b14644bb9937d73137a4b8c0121a13defe9b56", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/d0b14644bb9937d73137a4b8c0121a13defe9b56", "message": "[YouTube/MediaCCC] Consider dates as GMT and not as local", "committedDate": "2020-10-24T16:41:41Z", "type": "commit"}, {"oid": "880ff04a5c17086711c0d6d14d6aa46cf1943c54", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/880ff04a5c17086711c0d6d14d6aa46cf1943c54", "message": "[Test] Add stream dash mpd url test", "committedDate": "2020-10-24T16:41:41Z", "type": "commit"}, {"oid": "3c55ea93216a1bb1d75e16abf0509cdb9b42c61b", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/3c55ea93216a1bb1d75e16abf0509cdb9b42c61b", "message": "[PeerTube] Change age restricted video in tests\n\nThe old one wasn't available anymore", "committedDate": "2020-10-24T16:41:41Z", "type": "commit"}, {"oid": "f11fe87688beb27a051608c4f0facb2d8214b6d1", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f11fe87688beb27a051608c4f0facb2d8214b6d1", "message": "[YouTube] Replace outdated PewDiePie video test with another one\n\nThe old video was made private, and this video (wedding) is probably never going to be removed.", "committedDate": "2020-10-24T16:41:41Z", "type": "commit"}, {"oid": "f11fe87688beb27a051608c4f0facb2d8214b6d1", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/f11fe87688beb27a051608c4f0facb2d8214b6d1", "message": "[YouTube] Replace outdated PewDiePie video test with another one\n\nThe old video was made private, and this video (wedding) is probably never going to be removed.", "committedDate": "2020-10-24T16:41:41Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ5MTU1NA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511491554", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n          \n          \n            \n                        final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");", "author": "TobiGr", "createdAt": "2020-10-24T16:51:40Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/media_ccc/extractors/MediaCCCParsingHelper.java", "diffHunk": "@@ -6,14 +6,17 @@\n import java.text.SimpleDateFormat;\n import java.util.Calendar;\n import java.util.Date;\n+import java.util.TimeZone;\n \n public final class MediaCCCParsingHelper {\n     private MediaCCCParsingHelper() { }\n \n     public static Calendar parseDateFrom(final String textualUploadDate) throws ParsingException {\n         Date date;\n         try {\n-            date = new SimpleDateFormat(\"yyyy-MM-dd\").parse(textualUploadDate);\n+            SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");", "originalCommit": "f11fe87688beb27a051608c4f0facb2d8214b6d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ5MzY3Mg==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511493672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");\n          \n          \n            \n                        final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");", "author": "TobiGr", "createdAt": "2020-10-24T17:14:31Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/youtube/YoutubeParsingHelper.java", "diffHunk": "@@ -185,7 +185,9 @@ public static String getFeedUrlFrom(final String channelIdOrUser) {\n     public static Calendar parseDateFrom(String textualUploadDate) throws ParsingException {\n         Date date;\n         try {\n-            date = new SimpleDateFormat(\"yyyy-MM-dd\").parse(textualUploadDate);\n+            SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd\");", "originalCommit": "f11fe87688beb27a051608c4f0facb2d8214b6d1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUwNjAyNA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511506024", "bodyText": "Did you test against NewPipe this part? Will it create NullPointerException or there is already a null check?", "author": "B0pol", "createdAt": "2020-10-24T19:28:06Z", "path": "extractor/src/main/java/org/schabi/newpipe/extractor/services/media_ccc/extractors/MediaCCCStreamExtractor.java", "diffHunk": "@@ -216,7 +219,7 @@ public StreamType getStreamType() {\n \n     @Override\n     public StreamInfoItemsCollector getRelatedStreams() {\n-        return new StreamInfoItemsCollector(getServiceId());\n+        return null;", "originalCommit": "d007fb31dead50952899a87ed7facb590c18b829", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1NjYyNQ==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511556625", "bodyText": "This was done as per the documentation in the base getRelatedStreams(), and also to prevent creating new objects at random. I tested in NewPipe and it works as expected (there are null checks), but the code which takes care of it being null actually lies in the extractor, where the collector is turned into a list. I now added @nullable to all of the functions, as it was missing.", "author": "Stypox", "createdAt": "2020-10-25T07:02:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUwNjAyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1NzA1OA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511557058", "bodyText": "Oh, and also, YouTube already returns null for age restricted videos.", "author": "Stypox", "createdAt": "2020-10-25T07:07:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUwNjAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUwOTc4NA==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511509784", "bodyText": "Could you explain why 0x100 <= formatId < 0x1000 and also above (video streams) or below (subtitles) and add comments for it?", "author": "B0pol", "createdAt": "2020-10-24T20:10:54Z", "path": "extractor/src/test/java/org/schabi/newpipe/extractor/services/DefaultStreamExtractorTest.java", "diffHunk": "@@ -0,0 +1,382 @@\n+package org.schabi.newpipe.extractor.services;\n+\n+import org.junit.Test;\n+import org.schabi.newpipe.extractor.MediaFormat;\n+import org.schabi.newpipe.extractor.localization.DateWrapper;\n+import org.schabi.newpipe.extractor.stream.AudioStream;\n+import org.schabi.newpipe.extractor.stream.Description;\n+import org.schabi.newpipe.extractor.stream.Frameset;\n+import org.schabi.newpipe.extractor.stream.StreamExtractor;\n+import org.schabi.newpipe.extractor.stream.StreamInfoItemsCollector;\n+import org.schabi.newpipe.extractor.stream.StreamType;\n+import org.schabi.newpipe.extractor.stream.SubtitlesStream;\n+import org.schabi.newpipe.extractor.stream.VideoStream;\n+\n+import java.text.SimpleDateFormat;\n+import java.util.Calendar;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Locale;\n+import java.util.TimeZone;\n+\n+import javax.annotation.Nullable;\n+\n+import static org.hamcrest.CoreMatchers.containsString;\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.junit.Assert.assertEquals;\n+import static org.junit.Assert.assertFalse;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertTrue;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertAtLeast;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertEqualsOrderIndependent;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsSecureUrl;\n+import static org.schabi.newpipe.extractor.ExtractorAsserts.assertIsValidUrl;\n+import static org.schabi.newpipe.extractor.services.DefaultTests.defaultTestListOfItems;\n+\n+/**\n+ * Test for {@link StreamExtractor}\n+ */\n+public abstract class DefaultStreamExtractorTest extends DefaultExtractorTest<StreamExtractor>\n+        implements BaseStreamExtractorTest {\n+\n+    public abstract StreamType expectedStreamType();\n+    public abstract String expectedUploaderName();\n+    public abstract String expectedUploaderUrl();\n+    public String expectedSubChannelName() { return \"\"; } // default: there is no subchannel\n+    public String expectedSubChannelUrl() { return \"\"; } // default: there is no subchannel\n+    public abstract List<String> expectedDescriptionContains(); // e.g. for full links\n+    public abstract long expectedLength();\n+    public long expectedTimestamp() { return 0; } // default: there is no timestamp\n+    public abstract long expectedViewCountAtLeast();\n+    @Nullable public abstract String expectedUploadDate(); // format: \"yyyy-MM-dd HH:mm:ss.SSS\"\n+    @Nullable public abstract String expectedTextualUploadDate();\n+    public abstract long expectedLikeCountAtLeast(); // return -1 if ratings are disabled\n+    public abstract long expectedDislikeCountAtLeast(); // return -1 if ratings are disabled\n+    public boolean expectedHasRelatedStreams() { return true; } // default: there are related videos\n+    public int expectedAgeLimit() { return StreamExtractor.NO_AGE_LIMIT; } // default: no limit\n+    @Nullable public String expectedErrorMessage() { return null; } // default: no error message\n+    public boolean expectedHasVideoStreams() { return true; } // default: there are video streams\n+    public boolean expectedHasAudioStreams() { return true; } // default: there are audio streams\n+    public boolean expectedHasSubtitles() { return true; } // default: there are subtitles streams\n+    @Nullable public String expectedDashMpdUrlContains() { return null; } // default: no dash mpd\n+    public boolean expectedHasFrames() { return true; } // default: there are frames\n+    public String expectedHost() { return \"\"; } // default: no host for centralized platforms\n+    public String expectedPrivacy() { return \"\"; } // default: no privacy policy available\n+    public String expectedCategory() { return \"\"; } // default: no category\n+    public String expectedLicence() { return \"\"; } // default: no licence\n+    public Locale expectedLanguageInfo() { return null; } // default: no language info available\n+    public List<String> expectedTags() { return Collections.emptyList(); } // default: no tags\n+    public String expectedSupportInfo() { return \"\"; } // default: no support info available\n+\n+    @Test\n+    @Override\n+    public void testStreamType() throws Exception {\n+        assertEquals(expectedStreamType(), extractor().getStreamType());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderName() throws Exception {\n+        assertEquals(expectedUploaderName(), extractor().getUploaderName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderUrl() throws Exception {\n+        final String uploaderUrl = extractor().getUploaderUrl();\n+        assertIsSecureUrl(uploaderUrl);\n+        assertEquals(expectedUploaderUrl(), uploaderUrl);\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploaderAvatarUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getUploaderAvatarUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubChannelName() throws Exception {\n+        assertEquals(expectedSubChannelName(), extractor().getSubChannelName());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubChannelUrl() throws Exception {\n+        final String subChannelUrl = extractor().getSubChannelUrl();\n+        assertEquals(expectedSubChannelUrl(), subChannelUrl);\n+\n+        if (!expectedSubChannelUrl().isEmpty()) {\n+            // this stream has a subchannel\n+            assertIsSecureUrl(subChannelUrl);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testSubChannelAvatarUrl() throws Exception {\n+        if (expectedSubChannelName().isEmpty() && expectedSubChannelUrl().isEmpty()) {\n+            // this stream has no subchannel\n+            assertEquals(\"\", extractor().getSubChannelAvatarUrl());\n+        } else {\n+            // this stream has a subchannel\n+            assertIsSecureUrl(extractor().getSubChannelAvatarUrl());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testThumbnailUrl() throws Exception {\n+        assertIsSecureUrl(extractor().getThumbnailUrl());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDescription() throws Exception {\n+        final Description description = extractor().getDescription();\n+        assertNotNull(description);\n+        assertFalse(\"description is empty\", description.getContent().isEmpty());\n+\n+        for (final String s : expectedDescriptionContains()) {\n+            assertThat(description.getContent(), containsString(s));\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLength() throws Exception {\n+        assertEquals(expectedLength(), extractor().getLength());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTimestamp() throws Exception {\n+        assertEquals(expectedTimestamp(), extractor().getTimeStamp());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testViewCount() throws Exception {\n+        assertAtLeast(expectedViewCountAtLeast(), extractor().getViewCount());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testUploadDate() throws Exception {\n+        final DateWrapper dateWrapper = extractor().getUploadDate();\n+\n+        if (expectedUploadDate() == null) {\n+            assertNull(dateWrapper);\n+        } else {\n+            assertNotNull(dateWrapper);\n+\n+            final Calendar expectedDate = Calendar.getInstance();\n+            final Calendar actualDate = dateWrapper.date();\n+\n+            final SimpleDateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss.S\");\n+            sdf.setTimeZone(TimeZone.getTimeZone(\"GMT\"));\n+            expectedDate.setTime(sdf.parse(expectedUploadDate()));\n+            assertEquals(expectedDate, actualDate);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testTextualUploadDate() throws Exception {\n+        assertEquals(expectedTextualUploadDate(), extractor().getTextualUploadDate());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testLikeCount() throws Exception {\n+        if (expectedLikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getLikeCount());\n+        } else {\n+            assertAtLeast(expectedLikeCountAtLeast(), extractor().getLikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testDislikeCount() throws Exception {\n+        if (expectedDislikeCountAtLeast() == -1) {\n+            assertEquals(-1, extractor().getDislikeCount());\n+        } else {\n+            assertAtLeast(expectedDislikeCountAtLeast(), extractor().getDislikeCount());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testRelatedStreams() throws Exception {\n+        final StreamInfoItemsCollector relatedStreams = extractor().getRelatedStreams();\n+\n+        if (expectedHasRelatedStreams()) {\n+            defaultTestListOfItems(extractor().getService(), relatedStreams.getItems(),\n+                    relatedStreams.getErrors());\n+        } else {\n+            assertNull(relatedStreams);\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAgeLimit() throws Exception {\n+        assertEquals(expectedAgeLimit(), extractor().getAgeLimit());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testErrorMessage() throws Exception {\n+        assertEquals(expectedErrorMessage(), extractor().getErrorMessage());\n+    }\n+\n+    @Test\n+    @Override\n+    public void testVideoStreams() throws Exception {\n+        final List<VideoStream> videoStreams = extractor().getVideoStreams();\n+        final List<VideoStream> videoOnlyStreams = extractor().getVideoOnlyStreams();\n+        assertNotNull(videoStreams);\n+        assertNotNull(videoOnlyStreams);\n+        videoStreams.addAll(videoOnlyStreams);\n+\n+        if (expectedHasVideoStreams()) {\n+            assertFalse(videoStreams.isEmpty());\n+\n+            for (final VideoStream stream : videoStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+                assertFalse(stream.getResolution().isEmpty());\n+\n+                final int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit a video stream: \" + formatId,\n+                        0 <= formatId && formatId < 0x100);\n+            }\n+        } else {\n+            assertTrue(videoStreams.isEmpty());\n+        }\n+    }\n+\n+    @Test\n+    @Override\n+    public void testAudioStreams() throws Exception {\n+        final List<AudioStream> audioStreams = extractor().getAudioStreams();\n+        assertNotNull(audioStreams);\n+\n+        if (expectedHasAudioStreams()) {\n+            assertFalse(audioStreams.isEmpty());\n+\n+            for (final AudioStream stream : audioStreams) {\n+                assertIsSecureUrl(stream.getUrl());\n+\n+                final int formatId = stream.getFormatId();\n+                assertTrue(\"format id does not fit an audio stream: \" + formatId,\n+                        0x100 <= formatId && formatId < 0x1000);", "originalCommit": "d007fb31dead50952899a87ed7facb590c18b829", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTU1NjY0Mw==", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/pull/309#discussion_r511556643", "bodyText": "Ok", "author": "Stypox", "createdAt": "2020-10-25T07:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTUwOTc4NA=="}], "type": "inlineReview"}, {"oid": "cd32e7436ea4781939608c8a9ed36b72f2173bc0", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/cd32e7436ea4781939608c8a9ed36b72f2173bc0", "message": "Add some missing finals and nullables", "committedDate": "2020-10-25T07:09:53Z", "type": "forcePushed"}, {"oid": "57e7994c9e46d068ba53cb320c91c22ec24f76de", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/57e7994c9e46d068ba53cb320c91c22ec24f76de", "message": "Add some missing finals, nullables and comments", "committedDate": "2020-10-25T07:12:41Z", "type": "commit"}, {"oid": "57e7994c9e46d068ba53cb320c91c22ec24f76de", "url": "https://github.com/TeamNewPipe/NewPipeExtractor/commit/57e7994c9e46d068ba53cb320c91c22ec24f76de", "message": "Add some missing finals, nullables and comments", "committedDate": "2020-10-25T07:12:41Z", "type": "forcePushed"}]}