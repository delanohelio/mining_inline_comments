{"pr_number": 2302, "pr_title": "[#2029] Refactor CommandConsumerFactory in the Command Router", "pr_createdAt": "2020-11-17T13:15:22Z", "pr_url": "https://github.com/eclipse/hono/pull/2302", "timeline": [{"oid": "4e2a7cda4a2401081f3655afaaaa2e7e532b2ca6", "url": "https://github.com/eclipse/hono/commit/4e2a7cda4a2401081f3655afaaaa2e7e532b2ca6", "message": "[#2029] Refactor CommandConsumerFactory in the Command Router.\n\nSigned-off-by: Carsten Lohmann <carsten.lohmann@bosch.io>", "committedDate": "2020-11-17T13:12:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE3MTE0OA==", "url": "https://github.com/eclipse/hono/pull/2302#discussion_r525171148", "bodyText": "Regarding the interface name and the comment that it might get confused with org.eclipse.hono.client.adapter.command.CommandConsumerFactory:\nI thought about naming it CommandRouterCommandConsumerFactory instead, but then the name for the implementation class would get even longer still.\nAs the Command Router module isn't added as dependency in any other module, the confusion could only arise in the Command Router module itself. But I don't think it's much of an issue there.", "author": "calohmn", "createdAt": "2020-11-17T13:53:58Z", "path": "services/command-router/src/main/java/org/eclipse/hono/commandrouter/CommandConsumerFactory.java", "diffHunk": "@@ -13,49 +13,20 @@\n \n package org.eclipse.hono.commandrouter;\n \n-import java.time.Duration;\n-\n import org.eclipse.hono.client.CommandTargetMapper;\n-import org.eclipse.hono.client.ConnectionLifecycle;\n-import org.eclipse.hono.client.HonoConnection;\n-import org.eclipse.hono.client.SendMessageSampler;\n import org.eclipse.hono.client.ServiceInvocationException;\n-import org.eclipse.hono.commandrouter.impl.amqp.ProtonBasedCommandConsumerFactoryImpl;\n+import org.eclipse.hono.util.Lifecycle;\n \n import io.opentracing.SpanContext;\n import io.vertx.core.Future;\n \n /**\n- * A factory for creating clients for the <em>AMQP 1.0 Messaging Network</em> to\n- * receive commands and send responses.\n+ * A factory for creating consumers of command &amp; control messages.\n  */\n-public interface CommandConsumerFactory extends ConnectionLifecycle<HonoConnection> {\n-\n-    /**\n-     * Creates a new factory for an existing connection.\n-     *\n-     * @param connection The connection to the AMQP network.\n-     * @return The factory.\n-     * @throws NullPointerException if connection or gatewayMapper is {@code null}.\n-     */\n-    static CommandConsumerFactory create(final HonoConnection connection) {\n-        return create(connection, SendMessageSampler.Factory.noop());\n-    }\n+public interface CommandConsumerFactory extends Lifecycle {", "originalCommit": "4e2a7cda4a2401081f3655afaaaa2e7e532b2ca6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyNTAxOQ==", "url": "https://github.com/eclipse/hono/pull/2302#discussion_r525225019", "bodyText": "ok", "author": "sophokles73", "createdAt": "2020-11-17T15:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE3MTE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyODcyMA==", "url": "https://github.com/eclipse/hono/pull/2302#discussion_r525228720", "bodyText": "I do not really see the value of the initialize method. It only seems to make implementation harder. Why don't we simply pass in the mapper in the implementation class's constructor? The factory interface itself doesn't require the mapper anyway ...", "author": "sophokles73", "createdAt": "2020-11-17T15:08:21Z", "path": "services/command-router/src/main/java/org/eclipse/hono/commandrouter/CommandConsumerFactory.java", "diffHunk": "@@ -13,49 +13,20 @@\n \n package org.eclipse.hono.commandrouter;\n \n-import java.time.Duration;\n-\n import org.eclipse.hono.client.CommandTargetMapper;\n-import org.eclipse.hono.client.ConnectionLifecycle;\n-import org.eclipse.hono.client.HonoConnection;\n-import org.eclipse.hono.client.SendMessageSampler;\n import org.eclipse.hono.client.ServiceInvocationException;\n-import org.eclipse.hono.commandrouter.impl.amqp.ProtonBasedCommandConsumerFactoryImpl;\n+import org.eclipse.hono.util.Lifecycle;\n \n import io.opentracing.SpanContext;\n import io.vertx.core.Future;\n \n /**\n- * A factory for creating clients for the <em>AMQP 1.0 Messaging Network</em> to\n- * receive commands and send responses.\n+ * A factory for creating consumers of command &amp; control messages.\n  */\n-public interface CommandConsumerFactory extends ConnectionLifecycle<HonoConnection> {\n-\n-    /**\n-     * Creates a new factory for an existing connection.\n-     *\n-     * @param connection The connection to the AMQP network.\n-     * @return The factory.\n-     * @throws NullPointerException if connection or gatewayMapper is {@code null}.\n-     */\n-    static CommandConsumerFactory create(final HonoConnection connection) {\n-        return create(connection, SendMessageSampler.Factory.noop());\n-    }\n+public interface CommandConsumerFactory extends Lifecycle {\n \n     /**\n-     * Creates a new factory for an existing connection.\n-     *\n-     * @param connection The connection to the AMQP network.\n-     * @param samplerFactory The sampler factory to use.\n-     * @return The factory.\n-     * @throws NullPointerException if connection or gatewayMapper is {@code null}.\n-     */\n-    static CommandConsumerFactory create(final HonoConnection connection, final SendMessageSampler.Factory samplerFactory) {\n-        return new ProtonBasedCommandConsumerFactoryImpl(connection, samplerFactory);\n-    }\n-\n-    /**\n-     * Initializes the ProtocolAdapterCommandConsumerFactory with the given components.\n+     * Initializes the CommandConsumerFactory with the given commandTargetMapper.", "originalCommit": "4e2a7cda4a2401081f3655afaaaa2e7e532b2ca6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMwMjAyNA==", "url": "https://github.com/eclipse/hono/pull/2302#discussion_r525302024", "bodyText": "That will be a bigger change. I'd rather do this in a separate commit/PR.", "author": "calohmn", "createdAt": "2020-11-17T16:30:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyODcyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTMzNDYwOQ==", "url": "https://github.com/eclipse/hono/pull/2302#discussion_r525334609", "bodyText": "ok", "author": "sophokles73", "createdAt": "2020-11-17T17:08:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTIyODcyMA=="}], "type": "inlineReview"}]}