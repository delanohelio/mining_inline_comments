{"pr_number": 2287, "pr_title": "[#2053] Adding registry-internal auto-provisioning properties to devi\u2026", "pr_createdAt": "2020-11-09T12:15:16Z", "pr_url": "https://github.com/eclipse/hono/pull/2287", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzMzMwNw==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r519833307", "bodyText": "isAutoProvisioned ?", "author": "sophokles73", "createdAt": "2020-11-09T13:58:42Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceDto.java", "diffHunk": "@@ -159,6 +173,22 @@ protected final void setDeviceId(final String deviceId) {\n         this.deviceId = Objects.requireNonNull(deviceId);\n     }\n \n+    protected void setAutoProvisioned(final Boolean autoProvisioned) {", "originalCommit": "4283b799062a81f11f2b4b928433916db1591340", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzMzYzMg==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r519833632", "bodyText": "isAutoProvisioningNotificationSent?", "author": "sophokles73", "createdAt": "2020-11-09T13:59:11Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceDto.java", "diffHunk": "@@ -159,6 +173,22 @@ protected final void setDeviceId(final String deviceId) {\n         this.deviceId = Objects.requireNonNull(deviceId);\n     }\n \n+    protected void setAutoProvisioned(final Boolean autoProvisioned) {\n+        this.autoProvisioned = autoProvisioned;\n+    }\n+\n+    public Boolean getAutoProvisioned() {\n+        return autoProvisioned;\n+    }\n+\n+    public void setAutoProvisioningNotificationSent(final Boolean autoProvisioningNotificationSent) {", "originalCommit": "4283b799062a81f11f2b4b928433916db1591340", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzNDQzNw==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r519834437", "bodyText": "is it important that these are not of the primitive type? IMHO the code will be easier to understand if we do not need to account for null values all over the place ...", "author": "sophokles73", "createdAt": "2020-11-09T14:00:18Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceDto.java", "diffHunk": "@@ -32,6 +32,12 @@\n     @JsonProperty(value = RegistryManagementConstants.FIELD_PAYLOAD_DEVICE_ID)\n     private String deviceId;\n \n+    @JsonProperty(RegistryManagementConstants.FIELD_AUTO_PROVISIONED)\n+    private Boolean autoProvisioned;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_AUTO_PROVISIONING_NOTIFICATION_SENT)\n+    private Boolean autoProvisioningNotificationSent;", "originalCommit": "4283b799062a81f11f2b4b928433916db1591340", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDM5MDI5Nw==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r520390297", "bodyText": "I see. Then how about letting the isAutoProvisioned and isAutoProvisioningNotificationSent methods return a primitive boolean instead?", "author": "sophokles73", "createdAt": "2020-11-10T08:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzNDQzNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxMzE1NA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521913154", "bodyText": "wouldn't it be easier to keep a DeviceStatus typed field instead of duplicating the DeviceStatus properties here?", "author": "sophokles73", "createdAt": "2020-11-12T08:18:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTgzNDQzNw=="}], "type": "inlineReview"}, {"oid": "6f3c60b003ce4871fc676dea926df7f5f5ab30a2", "url": "https://github.com/eclipse/hono/commit/6f3c60b003ce4871fc676dea926df7f5f5ab30a2", "message": "Review Suggestions:\n- Fixing setter names\n- Adding accidentally left out DeviceStatus class\n\nChanges:\n- Adapting JSON property names for status (device properties are camel-cased in contrast to tenant or credential property names)\n- Adding unit test making sure that auto provisioning properties are serialized with the expected name\n\nSigned-off-by: Florian Kaltner <florian.kaltner@bosch.io>", "committedDate": "2020-11-10T08:30:12Z", "type": "forcePushed"}, {"oid": "7dc3fd198a2305efd70b34900cc8ce5975585813", "url": "https://github.com/eclipse/hono/commit/7dc3fd198a2305efd70b34900cc8ce5975585813", "message": "[#2053] Adding registry-internal auto-provisioning properties to device status.\n\nThese properties are implemented as a preparation for the implementation of the auto-provisionoing of edge devices connected to gateways which relies on those properties in order to increase the robustness of the implementation.\n\nSigned-off-by: Florian Kaltner <florian.kaltner@bosch.io>", "committedDate": "2020-11-10T14:04:39Z", "type": "commit"}, {"oid": "7dc3fd198a2305efd70b34900cc8ce5975585813", "url": "https://github.com/eclipse/hono/commit/7dc3fd198a2305efd70b34900cc8ce5975585813", "message": "[#2053] Adding registry-internal auto-provisioning properties to device status.\n\nThese properties are implemented as a preparation for the implementation of the auto-provisionoing of edge devices connected to gateways which relies on those properties in order to increase the robustness of the implementation.\n\nSigned-off-by: Florian Kaltner <florian.kaltner@bosch.io>", "committedDate": "2020-11-10T14:04:39Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDAwMQ==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521900001", "bodyText": "please rename to setAutoProvisioned in order to follow the naming scheme used throughout Hono ...\nwhy should we accept null here? Why don't we simply change the param to the primitive type. In the end, that is also what is returned by the corresponding getter ...", "author": "sophokles73", "createdAt": "2020-11-12T07:54:39Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceStatus.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.service.management.device;\n+\n+import java.util.Optional;\n+\n+import org.eclipse.hono.util.RegistryManagementConstants;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * A status used in Device value object.\n+ */\n+@JsonInclude(value = JsonInclude.Include.NON_NULL)\n+public class DeviceStatus extends Status<DeviceStatus> {\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_AUTO_PROVISIONED)\n+    private Boolean autoProvisioned;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_AUTO_PROVISIONING_NOTIFICATION_SENT)\n+    private Boolean autoProvisioningNotificationSent;\n+\n+    /**\n+     * Checks if this device was created by Hono's auto-provisioning capability.\n+     * <p>\n+     * The default value of this property is {@code false}.\n+     *\n+     * @return {@code true} if this device was auto-provisioned.\n+     */\n+    public boolean isAutoProvisioned() {\n+        return Optional.ofNullable(autoProvisioned).orElse(false);\n+    }\n+\n+    /**\n+     * Marks this device as auto-provisioned/manually provisioned.\n+     *\n+     * @param autoProvisioned {@code true}, if auto-provisioned. May be {@code null} which then defaults to false.\n+     *\n+     * @return a reference to this for fluent use.\n+     */\n+    public DeviceStatus setIsAutoProvisioned(final Boolean autoProvisioned) {", "originalCommit": "7dc3fd198a2305efd70b34900cc8ce5975585813", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkzNzQ5OQ==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521937499", "bodyText": "Okay, will rename.\nThe reason for accepting null are device registrations which were made before these two properties were introduced.\nFor MongoDb this means that there are documents which do not contain that property and for the JDBC registry it depends on how the migration is done (either adding two columns and setting all present values to false or null).", "author": "fkaltner", "createdAt": "2020-11-12T08:53:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDAwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDA3NA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521900074", "bodyText": "see above", "author": "sophokles73", "createdAt": "2020-11-12T07:54:46Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceStatus.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.service.management.device;\n+\n+import java.util.Optional;\n+\n+import org.eclipse.hono.util.RegistryManagementConstants;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * A status used in Device value object.\n+ */\n+@JsonInclude(value = JsonInclude.Include.NON_NULL)\n+public class DeviceStatus extends Status<DeviceStatus> {\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_AUTO_PROVISIONED)\n+    private Boolean autoProvisioned;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_AUTO_PROVISIONING_NOTIFICATION_SENT)\n+    private Boolean autoProvisioningNotificationSent;\n+\n+    /**\n+     * Checks if this device was created by Hono's auto-provisioning capability.\n+     * <p>\n+     * The default value of this property is {@code false}.\n+     *\n+     * @return {@code true} if this device was auto-provisioned.\n+     */\n+    public boolean isAutoProvisioned() {\n+        return Optional.ofNullable(autoProvisioned).orElse(false);\n+    }\n+\n+    /**\n+     * Marks this device as auto-provisioned/manually provisioned.\n+     *\n+     * @param autoProvisioned {@code true}, if auto-provisioned. May be {@code null} which then defaults to false.\n+     *\n+     * @return a reference to this for fluent use.\n+     */\n+    public DeviceStatus setIsAutoProvisioned(final Boolean autoProvisioned) {\n+        this.autoProvisioned = autoProvisioned;\n+        return this;\n+    }\n+\n+    /**\n+     * Checks if a notification of this device having been auto-provisioned has been sent to the northbound application.\n+     * <p>\n+     * The default value of this property is {@code false}.\n+     *\n+     * @return {@code true} if the notification has been sent.\n+     */\n+    public boolean isAutoProvisioningNotificationSent() {\n+        return Optional.ofNullable(autoProvisioningNotificationSent).orElse(false);\n+    }\n+\n+    /**\n+     * Marks this device's auto-provisioning as having been sent.\n+     *\n+     * @param autoProvisioningNotificationSent {@code true}, if the notification has been sent.\n+     *                                                     May be {@code null} which then defaults to false.\n+     *\n+     * @return a reference to this for fluent use.\n+     */\n+    public DeviceStatus setIsAutoProvisioningNotificationSent(final Boolean autoProvisioningNotificationSent) {", "originalCommit": "7dc3fd198a2305efd70b34900cc8ce5975585813", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDIzMQ==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521900231", "bodyText": "is this class or its methods supposed to be extended/overridden?", "author": "sophokles73", "createdAt": "2020-11-12T07:55:07Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceStatus.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.service.management.device;\n+\n+import java.util.Optional;\n+\n+import org.eclipse.hono.util.RegistryManagementConstants;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * A status used in Device value object.\n+ */\n+@JsonInclude(value = JsonInclude.Include.NON_NULL)\n+public class DeviceStatus extends Status<DeviceStatus> {", "originalCommit": "7dc3fd198a2305efd70b34900cc8ce5975585813", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjAxMzk4OA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r522013988", "bodyText": "No, added final modifier.", "author": "fkaltner", "createdAt": "2020-11-12T10:51:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDIzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkwMDU0OQ==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521900549", "bodyText": "if the class itself is no longer final, then maybe its methods should be?", "author": "sophokles73", "createdAt": "2020-11-12T07:55:49Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/Status.java", "diffHunk": "@@ -22,9 +22,11 @@\n import com.fasterxml.jackson.annotation.JsonProperty;\n \n /**\n- * A status used in Device value object.\n+ * A status base object of a model entity.\n+ *\n+ * @param <T> The concrete type of the status object for a model entity.\n  */\n-public final class Status {\n+public class Status<T extends Status<T>> {", "originalCommit": "7dc3fd198a2305efd70b34900cc8ce5975585813", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxMTYxMQ==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521911611", "bodyText": "there doesn't seem to be any P involved in this method, or am I mistaken?", "author": "sophokles73", "createdAt": "2020-11-12T08:15:19Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceDto.java", "diffHunk": "@@ -53,12 +61,13 @@ public DeviceDto() {\n      *\n      * @return A DTO instance for creating a new entry.\n      */\n-    public static <P extends Device, T extends DeviceDto> T forCreation(final Supplier<T> supplier, final String tenantId, final String deviceId, final Device device, final String version) {\n+    public static <P extends Device, T extends DeviceDto> T forCreation(final Supplier<T> supplier, final String tenantId, final String deviceId, final Boolean autoProvisioned, final Device device, final String version) {", "originalCommit": "7dc3fd198a2305efd70b34900cc8ce5975585813", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTk0NDg3OA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r521944878", "bodyText": "No, you're right. Thanks for spotting \ud83d\udc4d", "author": "fkaltner", "createdAt": "2020-11-12T09:05:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTkxMTYxMQ=="}], "type": "inlineReview"}, {"oid": "ea558c422b4a3cc85002902894803949bb18f8ed", "url": "https://github.com/eclipse/hono/commit/ea558c422b4a3cc85002902894803949bb18f8ed", "message": "Review Suggestions:\n- Renaming setters in DeviceStatus\n- Adding final modifier for DeviceStatus class and for methods of previously final Status class\n- Removing obsolete generic type parameter \"P\" from DeviceDto\n- Using DeviceStatus field in DeviceDto\n\nSigned-off-by: Florian Kaltner <florian.kaltner@bosch.io>", "committedDate": "2020-11-12T10:48:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkzMzE3Mg==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r524933172", "bodyText": "is there a particular reason why we do not simply pass a DeviceStatus instance as a parameter to this method? Or do you want to hide the existence of DeviceStatus to client code?", "author": "sophokles73", "createdAt": "2020-11-17T07:28:15Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceDto.java", "diffHunk": "@@ -91,8 +89,10 @@ public static DeviceDto forRead(final String tenantId, final String deviceId, fi\n         final DeviceDto deviceDto = BaseDto.forRead(DeviceDto::new, device, created, updated, version);\n         deviceDto.setTenantId(tenantId);\n         deviceDto.setDeviceId(deviceId);\n-        deviceDto.setIsAutoProvisioned(autoProvisioned);\n-        deviceDto.setIsAutoProvisioningNotificationSent(autoProvisioningNotificationSent);\n+        deviceDto.setDeviceStatus(new DeviceStatus()", "originalCommit": "ea558c422b4a3cc85002902894803949bb18f8ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk0NTMxMA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r524945310", "bodyText": "No, I hadn't information hiding in mind when I implemented this. Thinking a second time about this, your proposal makes sense as it shortens the parameter list.", "author": "fkaltner", "createdAt": "2020-11-17T07:54:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkzMzE3Mg=="}], "type": "inlineReview"}, {"oid": "1b6349b461999d368f65a9fe756dc24566cb038e", "url": "https://github.com/eclipse/hono/commit/1b6349b461999d368f65a9fe756dc24566cb038e", "message": "Review Suggestions:\n- Refactoring DeviceDto.forRead() so that it takes a DeviceStatus instance in order to shorten parameter list\n\nSigned-off-by: Florian Kaltner <florian.kaltner@bosch.io>", "committedDate": "2020-11-17T07:53:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk0NjgyOA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r524946828", "bodyText": "what about forCreation and forUpdate? It seems odd that one method accepts the DeviceStatus as arg but the others require DeviceStatus' properties explicitly, doesn't it?", "author": "sophokles73", "createdAt": "2020-11-17T07:58:11Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/DeviceDto.java", "diffHunk": "@@ -76,23 +76,19 @@ public DeviceDto() {\n      * @param tenantId The id of the tenant.\n      * @param deviceId The id of the device.\n      * @param device The data of the DTO.\n-     * @param autoProvisioned Marks this device as being auto-provisioned.\n-     * @param autoProvisioningNotificationSent Marks the auto-provisioning notification for this device as sent.\n+     * @param deviceStatus The registry internal status of the device.\n      * @param created The instant when the object was created.\n      * @param updated The instant of the most recent update.\n      * @param version The version of the DTO\n      *\n      * @return A DTO instance for reading an entry.\n      */\n     public static DeviceDto forRead(final String tenantId, final String deviceId, final Device device,\n-                                    final Boolean autoProvisioned, final Boolean autoProvisioningNotificationSent, final Instant created, final Instant updated, final String version) {\n+                                    final DeviceStatus deviceStatus, final Instant created, final Instant updated, final String version) {", "originalCommit": "1b6349b461999d368f65a9fe756dc24566cb038e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk3NDcyOA==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r524974728", "bodyText": "forCreation only should set the autoProvisioned flag, forUpdate only the autoProvisioningNotificationSent flag.\nIf we made the method accept a DeviceStatus instance we would invoke the impression to the caller that one can set both flags in those calls which isn't true.", "author": "fkaltner", "createdAt": "2020-11-17T08:40:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk0NjgyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk3OTE3OQ==", "url": "https://github.com/eclipse/hono/pull/2287#discussion_r524979179", "bodyText": "I see", "author": "sophokles73", "createdAt": "2020-11-17T08:47:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk0NjgyOA=="}], "type": "inlineReview"}]}