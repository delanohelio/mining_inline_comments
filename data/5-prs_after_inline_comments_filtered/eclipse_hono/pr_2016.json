{"pr_number": 2016, "pr_title": "[#1960] add status section for devices in API spec", "pr_createdAt": "2020-06-04T10:20:07Z", "pr_url": "https://github.com/eclipse/hono/pull/2016", "timeline": [{"oid": "62d7eede360592c91db4e4619521b0ee8c20e512", "url": "https://github.com/eclipse/hono/commit/62d7eede360592c91db4e4619521b0ee8c20e512", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-06-04T12:25:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzE5ODkyNQ==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r437198925", "bodyText": "My understanding is that the status is a generic concept which will most likely also be added to other entities (Tenant, Credentials), right? If so, I wonder if it deserves to be represented by a dedicated class instead of a map. In particular, since the type is defined to allow no additional properties in the API spec ...", "author": "sophokles73", "createdAt": "2020-06-09T07:39:03Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/Device.java", "diffHunk": "@@ -61,6 +61,10 @@\n     @JsonFormat(with = JsonFormat.Feature.ACCEPT_SINGLE_VALUE_AS_ARRAY)\n     private List<String> memberOf = new LinkedList<>();\n \n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS)\n+    @JsonInclude(value = Include.NON_EMPTY)\n+    private Map<String, Object> status = new HashMap<>();\n+", "originalCommit": "587a42aab7524ea07c556688a53c156fd07f6f44", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkzOTM1NQ==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r437939355", "bodyText": "I guess this should be JsonInclude.Include.NOT_NULL. AFAIK JsonInclude.Include.NON_EMPTY is used for collections only, isn't it?", "author": "sophokles73", "createdAt": "2020-06-10T08:09:22Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/Status.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.service.management.device;\n+\n+import java.time.Instant;\n+\n+import org.eclipse.hono.annotation.HonoTimestamp;\n+import org.eclipse.hono.util.RegistryManagementConstants;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * A status used in Device value object.\n+ */\n+public final class Status {\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_CREATION_DATE)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)", "originalCommit": "63afeb804e6a6a3eee5f710536ef8eb32695b656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQwMzMyNw==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r441403327", "bodyText": "Non empty is not limited to collections, it's simply that when serializing the object, if the value is empty, the field will be omitted. With NOT_NULL the field won't be omitted as long as it's not null.", "author": "jbtrystram", "createdAt": "2020-06-17T09:16:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzkzOTM1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0MDE2Mw==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r437940163", "bodyText": "how about passing in the user who performs the update as a parameter and remove the setLastUser method as well?\nThe constructor should then also accept the user parameter ...\nWDYT?", "author": "sophokles73", "createdAt": "2020-06-10T08:10:43Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/Status.java", "diffHunk": "@@ -0,0 +1,75 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.service.management.device;\n+\n+import java.time.Instant;\n+\n+import org.eclipse.hono.annotation.HonoTimestamp;\n+import org.eclipse.hono.util.RegistryManagementConstants;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * A status used in Device value object.\n+ */\n+public final class Status {\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_CREATION_DATE)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)\n+    @HonoTimestamp\n+    private final Instant creationTime;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_LAST_UPDATE)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)\n+    @HonoTimestamp\n+    private Instant lastUpdate;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_LAST_USER)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)\n+    private String lastUser;\n+\n+    /**\n+     * Create a new Status initialised at the creation time.\n+     */\n+    public Status() {\n+\n+        this.creationTime = Instant.now();\n+        this.lastUpdate = creationTime;\n+    }\n+\n+    public Instant getCreationTime() {\n+        return creationTime;\n+    }\n+\n+    public Instant getLastUpdate() {\n+        return lastUpdate;\n+    }\n+\n+\n+    /**\n+     * Update the lastUpdate field with the current time.\n+     */\n+    public void update() {", "originalCommit": "63afeb804e6a6a3eee5f710536ef8eb32695b656", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTQxMDg1Mw==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r441410853", "bodyText": "that makes a lot of sense ! I updated with your suggestion.", "author": "jbtrystram", "createdAt": "2020-06-17T09:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNzk0MDE2Mw=="}], "type": "inlineReview"}, {"oid": "44abae7a71490d7828974b3404df3c25459fc4db", "url": "https://github.com/eclipse/hono/commit/44abae7a71490d7828974b3404df3c25459fc4db", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-06-25T13:27:56Z", "type": "forcePushed"}, {"oid": "e367a8f9ccb410ac5c5b74ee03dd5968217dfb6e", "url": "https://github.com/eclipse/hono/commit/e367a8f9ccb410ac5c5b74ee03dd5968217dfb6e", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-07-01T07:01:02Z", "type": "forcePushed"}, {"oid": "6323d31b071ec53b4337c40cabf0a538d711b768", "url": "https://github.com/eclipse/hono/commit/6323d31b071ec53b4337c40cabf0a538d711b768", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-07-01T08:39:19Z", "type": "forcePushed"}, {"oid": "6ffe10798eddc25c97da8f4ac273f11978a250b3", "url": "https://github.com/eclipse/hono/commit/6ffe10798eddc25c97da8f4ac273f11978a250b3", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-07-01T08:42:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNjc3Ng==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r448316776", "bodyText": "2020?", "author": "sophokles73", "createdAt": "2020-07-01T12:05:41Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/Status.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Contributors to the Eclipse Foundation", "originalCommit": "6ffe10798eddc25c97da8f4ac273f11978a250b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMxNzcwOA==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r448317708", "bodyText": "Updates ...\n\nplease add an empty line between the description and the parameters and remove the empty line between the parameters and the return value", "author": "sophokles73", "createdAt": "2020-07-01T12:07:39Z", "path": "services/device-registry-base/src/main/java/org/eclipse/hono/service/management/device/Status.java", "diffHunk": "@@ -0,0 +1,78 @@\n+/*******************************************************************************\n+ * Copyright (c) 2019 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.service.management.device;\n+\n+import java.time.Instant;\n+\n+import org.eclipse.hono.annotation.HonoTimestamp;\n+import org.eclipse.hono.util.RegistryManagementConstants;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+\n+/**\n+ * A status used in Device value object.\n+ */\n+public final class Status {\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_CREATION_DATE)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)\n+    @HonoTimestamp\n+    private final Instant creationTime;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_LAST_UPDATE)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)\n+    @HonoTimestamp\n+    private Instant lastUpdate;\n+\n+    @JsonProperty(RegistryManagementConstants.FIELD_STATUS_LAST_USER)\n+    @JsonInclude(value = JsonInclude.Include.NON_EMPTY)\n+    private String lastUser;\n+\n+    /**\n+     * Create a new Status initialised at the creation time.\n+     */\n+    public Status() {\n+\n+        this.creationTime = Instant.now();\n+        this.lastUpdate = creationTime;\n+    }\n+\n+    public Instant getCreationTime() {\n+        return creationTime;\n+    }\n+\n+    public Instant getLastUpdate() {\n+        return lastUpdate;\n+    }\n+\n+\n+    /**\n+     * Update the lastUpdate and lastUser fields with the current time and user.", "originalCommit": "6ffe10798eddc25c97da8f4ac273f11978a250b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0ODMyMDE2Nw==", "url": "https://github.com/eclipse/hono/pull/2016#discussion_r448320167", "bodyText": "nice \ud83d\udc4d", "author": "sophokles73", "createdAt": "2020-07-01T12:12:34Z", "path": "tests/src/test/java/org/eclipse/hono/tests/registry/DeviceManagementIT.java", "diffHunk": "@@ -468,6 +470,11 @@ private static void assertRegistrationInformation(\n             final String expectedDeviceId,\n             final Device expectedData) {\n \n-        assertThat(response).usingRecursiveComparison().isEqualTo(expectedData);\n+        final Comparator<Instant> close = (Instant d1, Instant d2) -> d1.compareTo(d2) < 1000 ? 0 : 1;\n+\n+        assertThat(response)\n+                .usingRecursiveComparison()\n+                .withComparatorForFields(close, \"status.creationTime\", \"status.lastUpdate\")\n+                .isEqualTo(expectedData);", "originalCommit": "6ffe10798eddc25c97da8f4ac273f11978a250b3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cd004a5d88ad9acf55b8c0d091416ff05144845e", "url": "https://github.com/eclipse/hono/commit/cd004a5d88ad9acf55b8c0d091416ff05144845e", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-07-02T13:18:05Z", "type": "forcePushed"}, {"oid": "392aafd0ff44636d1068f159f5d38715830a8f72", "url": "https://github.com/eclipse/hono/commit/392aafd0ff44636d1068f159f5d38715830a8f72", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-07-03T06:31:26Z", "type": "commit"}, {"oid": "392aafd0ff44636d1068f159f5d38715830a8f72", "url": "https://github.com/eclipse/hono/commit/392aafd0ff44636d1068f159f5d38715830a8f72", "message": "[1960] add status section for devices in API spec\n\nSigned-off-by: Jean-Baptiste Trystram <jbtrystram@redhat.com>", "committedDate": "2020-07-03T06:31:26Z", "type": "forcePushed"}]}