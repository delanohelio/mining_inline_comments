{"pr_number": 2168, "pr_title": "[#2156] Add Hono API client interfaces for protocol adapters", "pr_createdAt": "2020-09-10T14:42:20Z", "pr_url": "https://github.com/eclipse/hono/pull/2168", "timeline": [{"oid": "d828cf3f93418a85beb0147e83e698661ed07195", "url": "https://github.com/eclipse/hono/commit/d828cf3f93418a85beb0147e83e698661ed07195", "message": "[#2156] Add Hono API client interfaces for protocol adapters\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-09-10T15:54:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMDEwNQ==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487100105", "bodyText": "I am not sure what the idea is of having two methods here. Do AMQP-based clients only implement the method that returns Future<ProtonDelivery> and other clients only the other one? If so, how does the invocation look like in the protocol adapter? Btw., I used Future<?> as return type there in the refactorings I did for my experiments with Kafka. This way I can return always a result, at the price that I have to check it with instanceof in the calling code.", "author": "b-abel", "createdAt": "2020-09-11T14:53:26Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/EventSender.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+import java.util.Map;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing events originating from devices to downstream consumers.\n+ */\n+public interface EventSender {\n+\n+    /**\n+     * Sends an event originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the event has been sent downstream .\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the event\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.\n+     */\n+    Future<Void> sendEvent(\n+            String tenantId,\n+            String deviceId,\n+            Buffer payload,\n+            String contentType,\n+            SpanContext context);\n+\n+    /**\n+     * Sends an event originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param properties Additional meta data that should be included in the downstream message.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the event has been sent downstream.\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the data\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.\n+     */\n+    Future<ProtonDelivery> sendEvent(", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ4OTQ1Mw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488489453", "bodyText": "This is a typo. Both variants should return a Future.", "author": "sophokles73", "createdAt": "2020-09-15T08:38:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMDEwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMTY2Ng==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487101666", "bodyText": "Why does this method does not have the properties parameter? In the other method, it is optional anyway. For Kafka I would also want to set metadata, 'Map<String, ?>' would work (although I am thinking about limiting the values to strings).", "author": "b-abel", "createdAt": "2020-09-11T14:55:45Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/EventSender.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+import java.util.Map;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing events originating from devices to downstream consumers.\n+ */\n+public interface EventSender {\n+\n+    /**\n+     * Sends an event originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the event has been sent downstream .\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the event\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.\n+     */\n+    Future<Void> sendEvent(", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5MDgzMw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488490833", "bodyText": "That is indeed arguable. So we either make the properties param in the second variant mandatory or we keep the first variant only. Which one would you prefer?", "author": "sophokles73", "createdAt": "2020-09-15T08:40:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMTY2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTE3NzQ0Nw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r489177447", "bodyText": "I expect metadata to be set wherever messages are sent in the protocol adapters. Then the variant without the properties parameter would be obsolete. But I am having a hard time figuring out all the metadata currently set in the messages, so I could be wrong about their usage frequency.\nIn general, I would provide as few overloaded methods as possible in advance and prefer to extend the interface later, if the need arises.", "author": "b-abel", "createdAt": "2020-09-16T05:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMTY2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI3OTc3Mg==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r502279772", "bodyText": "Ok, then let's remove the variant without the properties for the time being and allow the properties map to be null.", "author": "sophokles73", "createdAt": "2020-10-09T08:44:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMTY2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjMwMTUyOA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r502301528", "bodyText": "\ud83d\udc4d", "author": "b-abel", "createdAt": "2020-10-09T09:22:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMTY2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMjkxMw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487102913", "bodyText": "I do not see why this method is necessary when the parameter clientContext is optional in the other one.", "author": "b-abel", "createdAt": "2020-09-11T14:57:44Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/registry/CredentialsClient.java", "diffHunk": "@@ -0,0 +1,84 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.client.registry;\n+\n+import org.eclipse.hono.util.CredentialsObject;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.json.JsonObject;\n+\n+/**\n+ * A client for accessing Hono's Credentials API.\n+ * <p>\n+ * See Hono's <a href=\"https://www.eclipse.org/hono/docs/api/credentials/\">\n+ * Credentials API</a> for a description of the status codes returned.\n+ * </p>\n+ */\n+public interface CredentialsClient {\n+\n+    /**\n+     * Gets credentials for a device by type and authentication identifier.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param type The type of credentials to retrieve.\n+     * @param authId The authentication identifier used in the credentials to retrieve.\n+     * @param spanContext The currently active OpenTracing span (may be {@code null}). An implementation\n+     *                    should use this as the parent for any span it creates for tracing\n+     *                    the execution of this operation.\n+     * @return A future indicating the result of the operation.\n+     *         <p>\n+     *         The future will succeed if a response with a status code in the [200, 300) range\n+     *         has been received from the Credentials service. The JSON object will then contain values as\n+     *         defined in <a href=\"https://www.eclipse.org/hono/docs/api/credentials/#get-credentials\">\n+     *         Get Credentials</a>.\n+     *         <p>\n+     *         Otherwise, the future will fail with a {@link org.eclipse.hono.client.ServiceInvocationException}\n+     *         containing the (error) status code returned by the service.\n+     * @throws NullPointerException if tenant ID, type or auth ID are {@code null}.\n+     */\n+    Future<CredentialsObject> get(", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5MTY2Nw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488491667", "bodyText": "It is not strictly necessary but its presence allows invoking a method that is specific to the use case at hand without providing null params ...", "author": "sophokles73", "createdAt": "2020-09-15T08:41:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwMjkxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwNTI5Mw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487105293", "bodyText": "I haven't spent much time on the interfaces for the registry clients. We haven't talked about whether we want registry clients with other transport protocols. But the way the interfaces look, there is nothing AMQP-specific in them anyway.", "author": "b-abel", "createdAt": "2020-09-11T15:01:35Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/registry/DeviceRegistrationClient.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.registry;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.json.JsonObject;\n+\n+/**\n+ * A client for accessing Hono's Device Registration API.\n+ * <p>\n+ * See Hono's <a href=\"https://www.eclipse.org/hono/docs/api/device-registration/\">\n+ * Device Registration API</a> for a description of the status codes returned.\n+ */\n+public interface DeviceRegistrationClient {", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5MjA4Ng==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488492086", "bodyText": "Yes, that was the intention. So, in the future we might as well implement the interfaces based on HTTP ...", "author": "sophokles73", "createdAt": "2020-09-15T08:42:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwNTI5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwNjEzMA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487106130", "bodyText": "The interfaces in the upstream package still depend heavily on AMQP. Do we change them completely again if we want to support Kafka for commands? I think that if you use Kafka for downstream messaging, you might want to use Hono in the future entirely without AMQP.", "author": "b-abel", "createdAt": "2020-09-11T15:02:51Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/upstream/CommandResponseSender.java", "diffHunk": "@@ -0,0 +1,41 @@\n+/*******************************************************************************\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+package org.eclipse.hono.client.upstream;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing a device's response to a command received from a downstream application.\n+ */\n+public interface CommandResponseSender {", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5MjY4Ng==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488492686", "bodyText": "Yes, that is true. We might want to create Command and CommandResponse to be independent from the underlying transport.", "author": "sophokles73", "createdAt": "2020-09-15T08:43:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzEwNjEzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxMzQ0NQ==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487913445", "bodyText": "I would expect that the content type is optional but the payload required (empty events could provide an empty buffer). At least for MQTT, the content type is usually null in the current code.\nAnd my expectation is that optional parameters come after the required ones.", "author": "b-abel", "createdAt": "2020-09-14T13:30:22Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/EventSender.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+import java.util.Map;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing events originating from devices to downstream consumers.\n+ */\n+public interface EventSender {\n+\n+    /**\n+     * Sends an event originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the event has been sent downstream .\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the event\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5NTA1MA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488495050", "bodyText": "Currently, the Telemetry API defines the content-type to be mandatory. If a device wants to send an empty notification, then the content-type to use is application/vnd.eclipse-hono-empty-notification. If a (device) transport does not support content type, then the protocol adapter should use application/octet-stream ...", "author": "sophokles73", "createdAt": "2020-09-15T08:46:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxMzQ0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxNTIyNA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487915224", "bodyText": "What about adding a close method to EventSender and TelemetrySender (or extending a separate interface defining it)? That way there would be no need to depend on the implementation type to close the sender.", "author": "b-abel", "createdAt": "2020-09-14T13:31:58Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/EventSender.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+import java.util.Map;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing events originating from devices to downstream consumers.\n+ */\n+public interface EventSender {", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODQ5NjAwMA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488496000", "bodyText": "Yes, that might be a good idea. I would prefer extending a separate interface for that purpose.", "author": "sophokles73", "createdAt": "2020-09-15T08:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxNTIyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkxNjYyMg==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487916622", "bodyText": "JavaDoc is missing for context.", "author": "b-abel", "createdAt": "2020-09-14T13:33:17Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/EventSender.java", "diffHunk": "@@ -0,0 +1,76 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+import java.util.Map;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing events originating from devices to downstream consumers.\n+ */\n+public interface EventSender {\n+\n+    /**\n+     * Sends an event originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the event has been sent downstream .\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the event\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.\n+     */\n+    Future<Void> sendEvent(\n+            String tenantId,\n+            String deviceId,\n+            Buffer payload,\n+            String contentType,\n+            SpanContext context);\n+\n+    /**\n+     * Sends an event originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param properties Additional meta data that should be included in the downstream message.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the event has been sent downstream.\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the data\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.\n+     */\n+    Future<ProtonDelivery> sendEvent(\n+            String tenantId,\n+            String deviceId,\n+            Map<String, ?> properties,\n+            Buffer payload,\n+            String contentType,\n+            SpanContext context);", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkzNjUwNA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r487936504", "bodyText": "A boolean or an enum instead of the int would be more obvious for me (the QoS numbers are only obvious if one knows MQTT).", "author": "b-abel", "createdAt": "2020-09-14T13:52:18Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/TelemetrySender.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+import java.util.Map;\n+\n+import io.opentracing.SpanContext;\n+import io.vertx.core.Future;\n+import io.vertx.core.buffer.Buffer;\n+import io.vertx.proton.ProtonDelivery;\n+\n+/**\n+ * A client for publishing telemetry data originating from devices to downstream consumers.\n+ */\n+public interface TelemetrySender {\n+\n+    /**\n+     * Sends telemetry data originating from a device to downstream consumers.\n+     *\n+     * @param tenantId The ID of the tenant that the device belongs to.\n+     * @param deviceId The ID of the device that the data originates from.\n+     * @param payload The data to send.\n+     * @param contentType The content type of the data.\n+     * @param qos The delivery semantics to use for sending the data.\n+     *            A value of 0 indicates <em>at most once</em> semantics while\n+     *            1 indicates <em>at least once</em> semantics.\n+     * @return A future indicating the outcome of the operation.\n+     *         <p>\n+     *         The future will be succeeded if the data has been sent downstream according to\n+     *         the delivery semantics indicated by the qos parameter.\n+     *         <p>\n+     *         The future will be failed with a {@link org.eclipse.hono.client.ServerErrorException} if the data\n+     *         could not be sent. The error code contained in the exception indicates the\n+     *         cause of the failure.\n+     * @throws NullPointerException tenant ID, device ID or contentType are {@code null}.\n+     * @throws IllegalArgumentException if qos is neither 0 nor 1.", "originalCommit": "d828cf3f93418a85beb0147e83e698661ed07195", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODUwMTMwMQ==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r488501301", "bodyText": "That is true. We should probably define an enum ...", "author": "sophokles73", "createdAt": "2020-09-15T08:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkzNjUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzYyOA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r490727628", "bodyText": "Sticking to the downstream/upstream structure, I think this class as well as CommandResponseSender should be in the downstream package.", "author": "calohmn", "createdAt": "2020-09-18T06:24:35Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/upstream/CommandResponse.java", "diffHunk": "@@ -0,0 +1,195 @@\n+/*******************************************************************************\n+ * Copyright (c) 2018, 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ *******************************************************************************/\n+\n+package org.eclipse.hono.client.upstream;", "originalCommit": "e632b951cadfac3fbcd703b9b716c29de6cbae62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTgzMjgzMg==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r491832832", "bodyText": "I see your point. However, my idea was not so much to organize by technical aspects but rather by means of communication patterns. Most devices will support the telemetry (downstream) direction, i.e. they will report sensor readings etc. Some will additionally support receiving commands (upstream) and (optionally) responding to commands.\nMaybe it would be better to rename the packages to org.eclipse.hono.client.telemetry and org.eclipse.hono.client.command respectively? WDYT @calohmn", "author": "sophokles73", "createdAt": "2020-09-21T07:15:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzYyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjAyMTU2MA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r492021560", "bodyText": "I think I would still prefer the downstream/upstream packages, with \"CommandResponseSender\" in the downstream package.\nTo me, grouping classes by message flow direction offers more value here than using the communication pattern as the grouping theme. For the request/response pattern (#1276) we might also reuse the existing senders/consumers, so the Hono communication patterns wouldn't be directly reflected in the packages here anyway.\nAnd having org.eclipse.hono.client.telemetry contain telemetry and event senders is also a bit odd. A different term encompassing both telemetry and events would be better, although I guess we don't have that.", "author": "calohmn", "createdAt": "2020-09-21T12:55:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzYyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTkyNTY4NA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r495925684", "bodyText": "And having org.eclipse.hono.client.telemetry contain telemetry and event senders is also a bit odd. A different term encompassing both telemetry and events would be better, although I guess we don't have that.\n\nWe have been calling it the telemetry direction from the very beginning ...\n\nFor the request/response pattern (#1276) we might also reuse the existing senders/consumers, so the Hono communication patterns wouldn't be directly reflected in the packages here anyway.\n\nWell, FMPOV re-designing the client provides us with the opportunity to provide interfaces that are taylored to the the use case at hand. If we want to support a request/response pattern then FMPOV we should add a new package with new interfaces that contain method names and wording describing the actual problem being addressed. This should make it much easier to understand the exchange pattern compared to re-using the Telemetry and Command related interfaces for this purpose.", "author": "sophokles73", "createdAt": "2020-09-28T13:09:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzYyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjI4MzAwOA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r502283008", "bodyText": "@calohmn can we agree to group the interfaces into packages based on semantics instead of (technical) message flow direction? And then rename packages downstream and upstream to telemetry and command respectively for the time being and see if we find better names in the future?", "author": "sophokles73", "createdAt": "2020-10-09T08:50:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzYyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjQ4MTY4NA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r502481684", "bodyText": "Yes, I'm ok with using telemetry and command for now.", "author": "calohmn", "createdAt": "2020-10-09T14:48:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDcyNzYyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc1NjU2Ng==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r500756566", "bodyText": "Just stumbled upon this via #2216 : there's already a QoS class in org.eclipse.hono.util (and another one in org.eclipse.hono.service.metric). I think we could use the one in org.eclipse.hono.util here. It looks similar to me.", "author": "fkaltner", "createdAt": "2020-10-07T06:02:59Z", "path": "clients/adapter/src/main/java/org/eclipse/hono/client/downstream/QoS.java", "diffHunk": "@@ -0,0 +1,26 @@\n+/**\n+ * Copyright (c) 2020 Contributors to the Eclipse Foundation\n+ *\n+ * See the NOTICE file(s) distributed with this work for additional\n+ * information regarding copyright ownership.\n+ *\n+ * This program and the accompanying materials are made available under the\n+ * terms of the Eclipse Public License 2.0 which is available at\n+ * http://www.eclipse.org/legal/epl-2.0\n+ *\n+ * SPDX-License-Identifier: EPL-2.0\n+ */\n+\n+\n+package org.eclipse.hono.client.downstream;\n+\n+\n+/**\n+ * A definition of the delivery semantics used for transferring messages.\n+ *\n+ */\n+public enum QoS {", "originalCommit": "e632b951cadfac3fbcd703b9b716c29de6cbae62", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc2ODUzNw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r500768537", "bodyText": "nice catch \ud83d\udc4d I'll replace it with the org.eclipse.hono.util.QoS enum", "author": "sophokles73", "createdAt": "2020-10-07T06:35:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc1NjU2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDgzMTYzMw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r500831633", "bodyText": "I thought you created a new one on purpose because they are actually quite different: org.eclipse.hono.util.QoS additionally contains UNKNOWN. I think you should set a valid QoS when invoking the client and I do not see value in opening the possibility of a new error case.", "author": "b-abel", "createdAt": "2020-10-07T08:30:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc1NjU2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg2OTQxMw==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r500869413", "bodyText": "@b-abel That might be true. However, I think we can also easily get rid of the existing QoS.UNKNOWN value as it doesn't add much value anyway.", "author": "sophokles73", "createdAt": "2020-10-07T09:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc1NjU2Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk1NTEzOA==", "url": "https://github.com/eclipse/hono/pull/2168#discussion_r500955138", "bodyText": "See #2233", "author": "sophokles73", "createdAt": "2020-10-07T12:02:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDc1NjU2Ng=="}], "type": "inlineReview"}, {"oid": "8220a121ae18065999cd86f6b693963f0e686bbb", "url": "https://github.com/eclipse/hono/commit/8220a121ae18065999cd86f6b693963f0e686bbb", "message": "Remove duplicate class\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-07T06:34:20Z", "type": "forcePushed"}, {"oid": "c1f320a82a301b21fe4260c79e1eee4627bed9ef", "url": "https://github.com/eclipse/hono/commit/c1f320a82a301b21fe4260c79e1eee4627bed9ef", "message": "[#2156] Add Hono API client interfaces for protocol adapters\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-09T08:34:53Z", "type": "commit"}, {"oid": "7913d9b2f7c265f97a830d5845f20176a785a8f4", "url": "https://github.com/eclipse/hono/commit/7913d9b2f7c265f97a830d5845f20176a785a8f4", "message": "Incorporate feedback\n\n- extend io.vertx.core.Closeable\n- add missing JavaDoc\n- use enum for QoS\n- fix parameter types\n- put mandatory args to beginning of arg list\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-09T08:34:53Z", "type": "commit"}, {"oid": "0d58b1ac6788117ef16b5abf892da2951b429f6b", "url": "https://github.com/eclipse/hono/commit/0d58b1ac6788117ef16b5abf892da2951b429f6b", "message": "Small improvements\n\n- remove method variants\n- remove unused imports\n- add value object for registration assertion\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-09T10:24:50Z", "type": "commit"}, {"oid": "0d58b1ac6788117ef16b5abf892da2951b429f6b", "url": "https://github.com/eclipse/hono/commit/0d58b1ac6788117ef16b5abf892da2951b429f6b", "message": "Small improvements\n\n- remove method variants\n- remove unused imports\n- add value object for registration assertion\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-09T10:24:50Z", "type": "forcePushed"}, {"oid": "bc6a70d1ed82976f1ffcb1f739814b900417b705", "url": "https://github.com/eclipse/hono/commit/bc6a70d1ed82976f1ffcb1f739814b900417b705", "message": "Rename packages\n\n- added *adapter* level in order to prevent package name clash with\npackage holding the application side client\n- renamed packages to better reflect semantics of clients\n\nSigned-off-by: Kai Hudalla <kai.hudalla@bosch.io>", "committedDate": "2020-10-09T12:49:36Z", "type": "commit"}]}