{"pr_number": 1309, "pr_title": "TINKERPOP-2369 Replace Connection on server initiated Channel close", "pr_createdAt": "2020-08-08T17:46:48Z", "pr_url": "https://github.com/apache/tinkerpop/pull/1309", "timeline": [{"oid": "a690e50cc065536e72ddb2d06d19a8b7cbd6f671", "url": "https://github.com/apache/tinkerpop/commit/a690e50cc065536e72ddb2d06d19a8b7cbd6f671", "message": "TINKERPOP-2369 Replace Connection on server initiated Channel close\n\nWith this change, the following behaviour are modified:\n1. If server closes a Channel, the client would detect it and replace\n   the Connection. Prior to this change, the client would do nothing on\n   server initiated Channel close (applicable for cases when there were\n   no active requests on the channel).\n2. Do not throw a NPE when server sends a response for a request\n   which is not registered with the client. Ignore it silently.\n3. Ensure that replcement of a connection is done only once. Prior to\n   this change, for each failure of request using the connect, a new\n   connection was being created.", "committedDate": "2020-08-08T17:32:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NzQ4Nzk4MA==", "url": "https://github.com/apache/tinkerpop/pull/1309#discussion_r467487980", "bodyText": "This is an unused function. Removed to simplify code.", "author": "divijvaidya", "createdAt": "2020-08-08T17:48:10Z", "path": "gremlin-driver/src/main/java/org/apache/tinkerpop/gremlin/driver/Connection.java", "diffHunk": "@@ -191,14 +209,6 @@ Client getClient() {\n         return future;\n     }\n \n-    public void close() {", "originalCommit": "a690e50cc065536e72ddb2d06d19a8b7cbd6f671", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eab2d58d1931ff1dc5321a81beda155b6ddb8d22", "url": "https://github.com/apache/tinkerpop/commit/eab2d58d1931ff1dc5321a81beda155b6ddb8d22", "message": "Do not block executor thread to replace connection", "committedDate": "2020-08-08T19:10:56Z", "type": "commit"}, {"oid": "2ee3d9596cca640ae900e40909988ba445d02a74", "url": "https://github.com/apache/tinkerpop/commit/2ee3d9596cca640ae900e40909988ba445d02a74", "message": "Do not replace connection if genuine closure", "committedDate": "2020-08-08T21:13:49Z", "type": "commit"}, {"oid": "28387d0a844a09ce449438ab421a8f0a921a241e", "url": "https://github.com/apache/tinkerpop/commit/28387d0a844a09ce449438ab421a8f0a921a241e", "message": "Register to recycle closed connection after first successfully connected", "committedDate": "2020-08-09T00:46:18Z", "type": "commit"}, {"oid": "6cbaee0b1793732894088e7b7442bdb4d05410d3", "url": "https://github.com/apache/tinkerpop/commit/6cbaee0b1793732894088e7b7442bdb4d05410d3", "message": "Revert some refactored changes", "committedDate": "2020-08-09T05:21:05Z", "type": "commit"}, {"oid": "cfc5ffd06cdcedcfde94e306113b38a1c5981126", "url": "https://github.com/apache/tinkerpop/commit/cfc5ffd06cdcedcfde94e306113b38a1c5981126", "message": "Make isBeingReplaced thread safe", "committedDate": "2020-08-10T20:55:34Z", "type": "commit"}, {"oid": "6b42ac5b2012f45acfcb989a4082d935cd361db8", "url": "https://github.com/apache/tinkerpop/commit/6b42ac5b2012f45acfcb989a4082d935cd361db8", "message": "Merge branch '3.4-dev' into TINKERPOP-2369", "committedDate": "2020-08-10T21:21:15Z", "type": "commit"}, {"oid": "92813ba3e4f12f6f620e87684d78c15739782d43", "url": "https://github.com/apache/tinkerpop/commit/92813ba3e4f12f6f620e87684d78c15739782d43", "message": "Adding debug logs to test integ failures", "committedDate": "2020-08-11T01:16:33Z", "type": "commit"}, {"oid": "8652e6944056dc99a58fff8ea673a5cab3c3659d", "url": "https://github.com/apache/tinkerpop/commit/8652e6944056dc99a58fff8ea673a5cab3c3659d", "message": "Merge branch 'TINKERPOP-2369' of github.com:divijvaidya/tinkerpop into TINKERPOP-2369", "committedDate": "2020-08-11T01:16:48Z", "type": "commit"}, {"oid": "fef829769442173b3aff01c358a9730ec46d5cb9", "url": "https://github.com/apache/tinkerpop/commit/fef829769442173b3aff01c358a9730ec46d5cb9", "message": "Add debugging code", "committedDate": "2020-08-11T02:03:52Z", "type": "commit"}, {"oid": "963c21135f78eaa6e9bcd0149a13366252cf4a29", "url": "https://github.com/apache/tinkerpop/commit/963c21135f78eaa6e9bcd0149a13366252cf4a29", "message": "Fix typo", "committedDate": "2020-08-11T02:04:43Z", "type": "commit"}, {"oid": "63e9fbd7229cdf719e2ff15244aa5c92aaf673d7", "url": "https://github.com/apache/tinkerpop/commit/63e9fbd7229cdf719e2ff15244aa5c92aaf673d7", "message": "Add debug logs", "committedDate": "2020-08-11T19:39:56Z", "type": "commit"}, {"oid": "488c81f7f4aac8a9927094c63da1aa920ce97348", "url": "https://github.com/apache/tinkerpop/commit/488c81f7f4aac8a9927094c63da1aa920ce97348", "message": "don't use event loop to process response", "committedDate": "2020-08-11T21:23:46Z", "type": "commit"}, {"oid": "9503a64901a6e8bff25214678dd9c0006a7163cb", "url": "https://github.com/apache/tinkerpop/commit/9503a64901a6e8bff25214678dd9c0006a7163cb", "message": "Add more debug logs", "committedDate": "2020-08-11T21:29:57Z", "type": "commit"}, {"oid": "536dc31afae480f4382d517678f3c58e69af6cd8", "url": "https://github.com/apache/tinkerpop/commit/536dc31afae480f4382d517678f3c58e69af6cd8", "message": "Debug logs", "committedDate": "2020-08-11T23:05:01Z", "type": "commit"}, {"oid": "1368ed3d9edf441101f585de5ad491eb5cac4ada", "url": "https://github.com/apache/tinkerpop/commit/1368ed3d9edf441101f585de5ad491eb5cac4ada", "message": "Revert cconnect close code to debug", "committedDate": "2020-08-12T00:44:32Z", "type": "commit"}, {"oid": "8501850bcc311810e2795b49761b53f73a9c8318", "url": "https://github.com/apache/tinkerpop/commit/8501850bcc311810e2795b49761b53f73a9c8318", "message": "Add back on close channel code", "committedDate": "2020-08-12T01:14:19Z", "type": "commit"}, {"oid": "93fe2be98da8929efd9f7dbe4bd8903f8764c95b", "url": "https://github.com/apache/tinkerpop/commit/93fe2be98da8929efd9f7dbe4bd8903f8764c95b", "message": "Selective addition of code", "committedDate": "2020-08-12T01:52:07Z", "type": "commit"}, {"oid": "1365234e8a4b190435c4a076a1d710eaeec2b380", "url": "https://github.com/apache/tinkerpop/commit/1365234e8a4b190435c4a076a1d710eaeec2b380", "message": "add more code", "committedDate": "2020-08-12T02:28:47Z", "type": "commit"}, {"oid": "da21f3afcd0df6df1d1cc6ba2a917dd639c9f633", "url": "https://github.com/apache/tinkerpop/commit/da21f3afcd0df6df1d1cc6ba2a917dd639c9f633", "message": "add more code", "committedDate": "2020-08-12T03:09:32Z", "type": "commit"}, {"oid": "11d4b7a857b53f592252e434fdb622f157eafe84", "url": "https://github.com/apache/tinkerpop/commit/11d4b7a857b53f592252e434fdb622f157eafe84", "message": "Add debug lines", "committedDate": "2020-08-12T20:37:06Z", "type": "commit"}, {"oid": "e8eca4b14d43f6baebf2b9e29f32b1196f3dc763", "url": "https://github.com/apache/tinkerpop/commit/e8eca4b14d43f6baebf2b9e29f32b1196f3dc763", "message": "adddebug logs", "committedDate": "2020-08-12T20:42:21Z", "type": "commit"}, {"oid": "877b8161077fd77d999c66c9bc63e95de9b41bd2", "url": "https://github.com/apache/tinkerpop/commit/877b8161077fd77d999c66c9bc63e95de9b41bd2", "message": "Only destroy broken connection and not recycle", "committedDate": "2020-08-12T22:00:07Z", "type": "commit"}, {"oid": "9558a744e5d82135935f8a7cf1f8821d9285dc99", "url": "https://github.com/apache/tinkerpop/commit/9558a744e5d82135935f8a7cf1f8821d9285dc99", "message": "Add atomic boolen to determine a connectio ppol status", "committedDate": "2020-08-12T22:46:08Z", "type": "commit"}, {"oid": "92884e27e62797a72584eb69cbba1dbea69139b2", "url": "https://github.com/apache/tinkerpop/commit/92884e27e62797a72584eb69cbba1dbea69139b2", "message": "revert code for onclose destroy", "committedDate": "2020-08-12T23:35:29Z", "type": "commit"}, {"oid": "9b435657501653f5075e3dc6ce5f6eb439fa7ae3", "url": "https://github.com/apache/tinkerpop/commit/9b435657501653f5075e3dc6ce5f6eb439fa7ae3", "message": "Fix bug", "committedDate": "2020-08-12T23:58:27Z", "type": "commit"}, {"oid": "a575f45e7226c4e92a2d6a3d4bff1e57c2681b37", "url": "https://github.com/apache/tinkerpop/commit/a575f45e7226c4e92a2d6a3d4bff1e57c2681b37", "message": "Disable all tests except server kerberos", "committedDate": "2020-08-13T00:55:47Z", "type": "commit"}, {"oid": "952b79c633a261a24599247cb4922effa328274d", "url": "https://github.com/apache/tinkerpop/commit/952b79c633a261a24599247cb4922effa328274d", "message": "Add back on close behaviour", "committedDate": "2020-08-13T01:19:33Z", "type": "commit"}, {"oid": "b5b050c7428c90b64a096e55aed7d4206fd9664c", "url": "https://github.com/apache/tinkerpop/commit/b5b050c7428c90b64a096e55aed7d4206fd9664c", "message": "add exception to debug logs", "committedDate": "2020-08-13T01:22:14Z", "type": "commit"}, {"oid": "07ae33e754fdcadfa5a8a6ed44df9aaa8c7764b5", "url": "https://github.com/apache/tinkerpop/commit/07ae33e754fdcadfa5a8a6ed44df9aaa8c7764b5", "message": "Add more tests", "committedDate": "2020-08-13T01:37:07Z", "type": "commit"}, {"oid": "096ccf11bd0112d1d77623659372bbca4b4d118c", "url": "https://github.com/apache/tinkerpop/commit/096ccf11bd0112d1d77623659372bbca4b4d118c", "message": "Enable all kerberos tests", "committedDate": "2020-08-13T01:55:19Z", "type": "commit"}, {"oid": "0043a6e8bb724c61bd09f0cdccc029dace580ce1", "url": "https://github.com/apache/tinkerpop/commit/0043a6e8bb724c61bd09f0cdccc029dace580ce1", "message": "Code clean up", "committedDate": "2020-08-13T23:11:53Z", "type": "commit"}, {"oid": "dbc58845eafad53f67189c97309f66f8e20ee8d7", "url": "https://github.com/apache/tinkerpop/commit/dbc58845eafad53f67189c97309f66f8e20ee8d7", "message": "Remove unnecessary changes", "committedDate": "2020-08-13T23:35:40Z", "type": "commit"}, {"oid": "d68bdb6e13a5832f0bd97fc43399c1e9ef2c1ac5", "url": "https://github.com/apache/tinkerpop/commit/d68bdb6e13a5832f0bd97fc43399c1e9ef2c1ac5", "message": "Remove a new behaviour in throwing exceptions", "committedDate": "2020-08-14T00:55:33Z", "type": "commit"}, {"oid": "98e28387229d62890ae34cbd9f97d48172324514", "url": "https://github.com/apache/tinkerpop/commit/98e28387229d62890ae34cbd9f97d48172324514", "message": "Fix integ tests which don't close clients", "committedDate": "2020-08-14T20:02:15Z", "type": "commit"}, {"oid": "aace59212264632340824435e80f42f20f136ba8", "url": "https://github.com/apache/tinkerpop/commit/aace59212264632340824435e80f42f20f136ba8", "message": "Fix bug in promise completion", "committedDate": "2020-08-14T20:40:50Z", "type": "commit"}, {"oid": "2e0ce6a96d27dcb5aceb7e61ec73ece08dffd1ed", "url": "https://github.com/apache/tinkerpop/commit/2e0ce6a96d27dcb5aceb7e61ec73ece08dffd1ed", "message": "Only destroy the connection. don't replace", "committedDate": "2020-08-14T21:55:33Z", "type": "commit"}, {"oid": "52ddb1581f54b954448faa2354ec2f77f877ed2f", "url": "https://github.com/apache/tinkerpop/commit/52ddb1581f54b954448faa2354ec2f77f877ed2f", "message": "cosmetic changes", "committedDate": "2020-08-15T00:05:03Z", "type": "commit"}, {"oid": "235257b991d098d61ec298b78b4835a3099647c3", "url": "https://github.com/apache/tinkerpop/commit/235257b991d098d61ec298b78b4835a3099647c3", "message": "changelog update", "committedDate": "2020-08-15T00:19:26Z", "type": "commit"}, {"oid": "f9bfc027a53d1725a0900936501d9b5cd2c04e01", "url": "https://github.com/apache/tinkerpop/commit/f9bfc027a53d1725a0900936501d9b5cd2c04e01", "message": "Rename tests", "committedDate": "2020-08-20T16:55:18Z", "type": "commit"}]}