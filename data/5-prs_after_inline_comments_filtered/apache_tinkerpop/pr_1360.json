{"pr_number": 1360, "pr_title": "TINKERPOP-2445 Parallelize connection creation", "pr_createdAt": "2020-11-17T19:45:21Z", "pr_url": "https://github.com/apache/tinkerpop/pull/1360", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA3MDM4NA==", "url": "https://github.com/apache/tinkerpop/pull/1360#discussion_r526070384", "bodyText": "If we expect an exception here (i.e. i see it's meant to be ignored) should the test fail() if the request succeeds?", "author": "spmallette", "createdAt": "2020-11-18T13:05:33Z", "path": "gremlin-server/src/test/java/org/apache/tinkerpop/gremlin/server/GremlinDriverIntegrateTest.java", "diffHunk": "@@ -861,12 +864,28 @@ public void shouldMarkHostDeadSinceServerIsDown() throws Exception {\n         final Cluster cluster = TestClientFactory.open();\n         try {\n             assertEquals(0, cluster.availableHosts().size());\n-            cluster.connect().init();\n+            final Client client1 = cluster.connect().init();\n             assertEquals(1, cluster.availableHosts().size());\n \n             stopServer();\n \n+            // We create a new client here which will fail to initialize but the original client still has\n+            // host marked as connected. Since the second client failed during initialization, it has no way to\n+            // test if a host is indeed unreachable because it doesn't have any established connections. It will not add\n+            // the host to load balancer but it will also not remove it if it already exists there. Leave that\n+            // responsibility to a client that added it. In this case, let the second client perform it's own mechanism\n+            // to mark host as unavailable. The first client will discover that the host has failed either with next\n+            // keepAlive message or the next request, whichever is earlier. In this case, we will simulate the second\n+            // scenario by sending a new request on first client. The request would fail (since server is down) and\n+            // client should mark the host unavailable.\n             cluster.connect().init();\n+\n+            try {\n+                client1.submit(\"1+1\").all().join();", "originalCommit": "b8ba840d87f85714380f978d1f5678e5fa8832d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM3MDQxNA==", "url": "https://github.com/apache/tinkerpop/pull/1360#discussion_r526370414", "bodyText": "Good point. Added.", "author": "divijvaidya", "createdAt": "2020-11-18T19:41:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA3MDM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA3MjYxNQ==", "url": "https://github.com/apache/tinkerpop/pull/1360#discussion_r526072615", "bodyText": "nit: we tend to prefer to statically import the assertion method and to avoid assertTrue() which provides a terrible failure message, thus we would typically prefer: assertThat(new ReflectionEquals(person).matches(actual), is(true))", "author": "spmallette", "createdAt": "2020-11-18T13:09:20Z", "path": "gremlin-driver/src/test/java/org/apache/tinkerpop/gremlin/driver/ser/binary/types/sample/SamplePersonSerializerTest.java", "diffHunk": "@@ -93,7 +93,7 @@ public void readValueAndWriteValueShouldBeSymmetric() throws IOException {\n             writer.writeValue(person, buffer, nullable);\n             final SamplePerson actual = reader.readValue(buffer, SamplePerson.class, nullable);\n \n-            assertThat(actual, new ReflectionEquals(person));\n+            Assert.assertTrue(new ReflectionEquals(person).matches(actual));", "originalCommit": "b8ba840d87f85714380f978d1f5678e5fa8832d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjM2ODM5OA==", "url": "https://github.com/apache/tinkerpop/pull/1360#discussion_r526368398", "bodyText": "Oh yes. This is a side effect of the change when I upgraded mockito to 2.x so that we could use it to mock final classes. It's not required in current review since we are using powermock. I will revert it back.", "author": "divijvaidya", "createdAt": "2020-11-18T19:38:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjA3MjYxNQ=="}], "type": "inlineReview"}, {"oid": "6f0cb18390c429b7d88edc9f11d4a30c5aebf576", "url": "https://github.com/apache/tinkerpop/commit/6f0cb18390c429b7d88edc9f11d4a30c5aebf576", "message": "add changelog", "committedDate": "2020-11-18T20:09:51Z", "type": "forcePushed"}, {"oid": "83a1df177865ad23d78a11efa8abd9afc037e3ee", "url": "https://github.com/apache/tinkerpop/commit/83a1df177865ad23d78a11efa8abd9afc037e3ee", "message": "Change exceptions thrown to user", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "0655720644240119625ffbad0e2f94906e7243fb", "url": "https://github.com/apache/tinkerpop/commit/0655720644240119625ffbad0e2f94906e7243fb", "message": "fix a unit test", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "9d0df856d3acd67da94fc43db4e55fa9c9fb38b2", "url": "https://github.com/apache/tinkerpop/commit/9d0df856d3acd67da94fc43db4e55fa9c9fb38b2", "message": "Fix unit test", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "0e1c21a68a79f2d00475f7f01f599321b3242a2e", "url": "https://github.com/apache/tinkerpop/commit/0e1c21a68a79f2d00475f7f01f599321b3242a2e", "message": "Revert some test changes", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "b0022cac0f1793111e52c4220993e55d1d78fca9", "url": "https://github.com/apache/tinkerpop/commit/b0022cac0f1793111e52c4220993e55d1d78fca9", "message": "add fail if no exception", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "c7a4fd599b2ef4d54741df278faad39bf83a5998", "url": "https://github.com/apache/tinkerpop/commit/c7a4fd599b2ef4d54741df278faad39bf83a5998", "message": "revert asserttrue", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "21205d0410f91fae1c8da7333dc52b4c2d915f5a", "url": "https://github.com/apache/tinkerpop/commit/21205d0410f91fae1c8da7333dc52b4c2d915f5a", "message": "fix test", "committedDate": "2020-11-25T19:18:00Z", "type": "commit"}, {"oid": "59a43ef8c3936db0d75d3f341cf3f482d1cb802c", "url": "https://github.com/apache/tinkerpop/commit/59a43ef8c3936db0d75d3f341cf3f482d1cb802c", "message": "add changelog", "committedDate": "2020-11-25T19:18:50Z", "type": "commit"}, {"oid": "59a43ef8c3936db0d75d3f341cf3f482d1cb802c", "url": "https://github.com/apache/tinkerpop/commit/59a43ef8c3936db0d75d3f341cf3f482d1cb802c", "message": "add changelog", "committedDate": "2020-11-25T19:18:50Z", "type": "forcePushed"}]}