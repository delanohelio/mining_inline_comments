{"pr_number": 506, "pr_title": "refactor: WordPress data import", "pr_createdAt": "2020-01-18T14:03:44Z", "pr_url": "https://github.com/halo-dev/halo/pull/506", "timeline": [{"oid": "17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "url": "https://github.com/halo-dev/halo/commit/17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "message": "refactor: WordPress data import", "committedDate": "2020-01-18T13:57:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyODkzMA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368228930", "bodyText": "\u8fd9\u91cc\u7684\u53c2\u6570\u4ee5\u540e\u8003\u8651\u66f4\u6539\u4e86\uff0c\u4e0d\u80fd\u4f7f\u7528 MultipartFile file\u3002\u6216\u8005\u521b\u5efa\u4e00\u4e2a\u9002\u914d\u5668\u6765\u517c\u5bb9\u5b83\u3002", "author": "JohnNiang", "createdAt": "2020-01-18T14:12:54Z", "path": "src/main/java/run/halo/app/handler/migrate/WordPressMigrateHandler.java", "diffHunk": "@@ -90,136 +84,18 @@ public WordPressMigrateHandler(AttachmentService attachmentService,\n     public void migrate(MultipartFile file) {", "originalCommit": "17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDE5NA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230194", "bodyText": "\u8fd9\u91cc\u8001\u6c6a\u5199\u7684  \u6211\u6cbf\u7528\u4e86", "author": "guqing", "createdAt": "2020-01-18T14:41:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyODkzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDI0Mg==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230242", "bodyText": "\u8fd9\u91cc\u8001\u6c6a\u5199\u7684 \u6211\u6cbf\u7528\u4e86\n\n\u55ef\u55ef\uff0c\u8fd9\u4e0d\u662f\u4f60\u7684\u9505\uff0c\u662f\u6211\u4eec\u5f53\u65f6\u8bbe\u8ba1\u7684\u65f6\u5019\u6ca1\u6709\u8003\u8651\u597d\u3002", "author": "JohnNiang", "createdAt": "2020-01-18T14:42:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyODkzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyOTg3OA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368229878", "bodyText": "\u5efa\u8bae\u6b64 Convert \u652f\u6301\u53cc\u5411\u8f6c\u6362 \uff1aP", "author": "JohnNiang", "createdAt": "2020-01-18T14:34:02Z", "path": "src/main/java/run/halo/app/handler/migrate/converter/Converter.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package run.halo.app.handler.migrate.converter;\n+\n+import java.util.List;\n+import java.util.function.Function;\n+import java.util.stream.Collectors;\n+\n+/**\n+ * \u535a\u5ba2\u8fc1\u79fb\u6570\u636e\u8f6c\u6362\u5668,\u53ea\u5b9a\u4e49\u4eceT\u8f6cU\u7684\u5355\u5411\u8f6c\u6362\n+ * @author guqing\n+ * @date 2020-01-18 16:45\n+ */\n+public class Converter<T, U> {", "originalCommit": "17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDI4MA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230280", "bodyText": "\u4e4b\u524d\u652f\u6301\u4f46\u662f\u6211\u60f3\u4e86\u4e00\u4e0b\u5e76\u4e0d\u9700\u8981\u5c06\u6570\u636e\u5e93\u7684\u6587\u7ae0\u6620\u5c04\u5230wordpress\u7684\u5b9e\u4f53  \u5982\u679c\u6dfb\u52a0\u53cc\u5411\u9700\u8981\u5728\u6784\u9020\u91cc\u5728\u5199\u4e00\u4e2aFunction\u5e76\u4e0d\u597d\u5b9e\u73b0   \u5f88\u7d2f\u8d58\u6240\u4ee5\u5c31\u5220\u9664\u4e86", "author": "guqing", "createdAt": "2020-01-18T14:43:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyOTg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDMzMA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230330", "bodyText": "\u4e4b\u524d\u652f\u6301\u4f46\u662f\u6211\u60f3\u4e86\u4e00\u4e0b\u5e76\u4e0d\u9700\u8981\u5c06\u6570\u636e\u5e93\u7684\u6587\u7ae0\u6620\u5c04\u5230wordpress\u7684\u5b9e\u4f53 \u5982\u679c\u6dfb\u52a0\u53cc\u5411\u9700\u8981\u5728\u6784\u9020\u91cc\u5728\u5199\u4e00\u4e2aFunction\u5e76\u4e0d\u597d\u5b9e\u73b0 \u5f88\u7d2f\u8d58\u6240\u4ee5\u5c31\u5220\u9664\u4e86\n\n\u53ea\u662f\u4e00\u4e2a\u4e34\u65f6\u7684\u60f3\u6cd5\uff0c\u54c8\u54c8\u54c8\uff0c\u4e0d\u8fc7\u5efa\u8bae\u9884\u7559\u8fd9\u4e2a\u63a5\u53e3\u3002", "author": "JohnNiang", "createdAt": "2020-01-18T14:44:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyOTg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDUyOA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230528", "bodyText": "public class Converter<T, U> {\n    \n    // \u4ece T \u8f6c\u6362\u4e3a U\n    private Function<T, U> fromDto;\n \n    // \u4ece U \u8f6c\u6362\u4e3a T\n    private Function<U, T> fromEntity;\n \n    public Converter(final Function<T, U> fromDto, final Function<U, T> fromEntity) {\n        this.fromDto = fromDto;\n        this.fromEntity = fromEntity;\n    }\n \n    public final U converterFromDto(final T dto){\n        return fromDto.apply(dto);\n    }\n \n    public final T converterFromEntity(final U entity){\n        return fromEntity.apply(entity);\n    }\n \n    public final List<U> batchConverterFromDto(final List<T> dtos){\n        return dtos.stream().map(this::converterFromDto).collect(Collectors.toList());\n    }\n \n    public final List<T> batchConverterFromEntity(final List<U> entities){\n        return entities.stream().map(this::converterFromEntity).collect(Collectors.toList());\n    }\n}\n\u4e4b\u524d\u662f\u8fd9\u4e48\u5199\u7684, \u5982\u679c\u7528\u5f97\u4e0a\u540e\u9762\u4e5f\u53ef\u4ee5,\u73b0\u5728\u6dfb\u52a0\u4e5f\u884c, \u9664\u975e\u6709\u4eba\u60f3\u628ahalo\u7684\u6570\u636e\u8fc1\u79fb\u5230wordpress,\u54c8\u54c8\u54c8", "author": "guqing", "createdAt": "2020-01-18T14:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyOTg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDYwNQ==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230605", "bodyText": "\u5efa\u8bae\u5c06 Converter \u58f0\u660e\u4e3a\u63a5\u53e3\uff0c\u53ef\u4ee5\u63d0\u4f9b\u4e00\u4e9b\u9ed8\u8ba4\u7684\u5b9e\u73b0\u3002", "author": "JohnNiang", "createdAt": "2020-01-18T14:49:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyOTg3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMDY0MA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368230640", "bodyText": "\u597d\uff0c\u6211\u6539\u4e00\u4e0b", "author": "guqing", "createdAt": "2020-01-18T14:50:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIyOTg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzE3Mg==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368233172", "bodyText": "\u8fd9\u91cc\u6700\u597d\u7ed9\u6bcf\u4e2a\u5c5e\u6027\u52a0\u4e0a java doc \u6ce8\u91ca\uff0c\u540e\u9762 Wordpress \u53ef\u80fd\u4f1a\u6539\u4e00\u4e9b\u4e1c\u897f\uff0c\u514d\u5f97\u540e\u9762\u4e0d\u6e05\u695a\u3002", "author": "ruibaby", "createdAt": "2020-01-18T15:43:30Z", "path": "src/main/java/run/halo/app/handler/migrate/support/wordpress/Channel.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package run.halo.app.handler.migrate.support.wordpress;\n+\n+import com.alibaba.fastjson.annotation.JSONField;\n+import lombok.Data;\n+\n+import java.util.List;\n+\n+/**\n+ * <p>  </p>\n+ *\n+ * @author guqing\n+ * @date 2019-11-17 13:57\n+ */\n+@Data\n+public class Channel {", "originalCommit": "17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzM5MA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368233390", "bodyText": "\u597d", "author": "guqing", "createdAt": "2020-01-18T15:48:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzE3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzE3OA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368233178", "bodyText": "\u540c\u4e0a\u3002", "author": "ruibaby", "createdAt": "2020-01-18T15:43:40Z", "path": "src/main/java/run/halo/app/handler/migrate/support/wordpress/Comment.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package run.halo.app.handler.migrate.support.wordpress;\n+\n+import com.alibaba.fastjson.annotation.JSONField;\n+import lombok.Data;\n+\n+/**\n+ * <p>  </p>\n+ *\n+ * @author guqing\n+ * @date 2019-11-17 14:01\n+ */\n+@Data\n+public class Comment {", "originalCommit": "17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzE5NQ==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368233195", "bodyText": "\u751a\u81f3\u53ef\u4ee5\u94fe\u63a5\u6211\u4eec\u5bf9\u5e94\u7684\u7c7b\u548c\u5c5e\u6027\u3002", "author": "ruibaby", "createdAt": "2020-01-18T15:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzE3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzQxMw==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368233413", "bodyText": "\u597d", "author": "guqing", "createdAt": "2020-01-18T15:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzE3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODIzMzIxMA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368233210", "bodyText": "\u540c\u4e0a\uff0c\u52a0\u4e0a java doc\u3002", "author": "ruibaby", "createdAt": "2020-01-18T15:44:22Z", "path": "src/main/java/run/halo/app/handler/migrate/support/wordpress/Item.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package run.halo.app.handler.migrate.support.wordpress;\n+\n+import com.alibaba.fastjson.annotation.JSONField;\n+import lombok.Data;\n+\n+import java.util.List;\n+\n+/**\n+ * <p> wordpress\u6587\u7ae0\u9879 </p>\n+ *\n+ * @author guqing\n+ * @date 2019-11-17 13:59\n+ */\n+@Data\n+public class Item {", "originalCommit": "17f68cd9f8b05f50f59651e4126260d2cfa5bf6b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "541d79d7828e97a00a2ddb434a4477c41cc641f8", "url": "https://github.com/halo-dev/halo/commit/541d79d7828e97a00a2ddb434a4477c41cc641f8", "message": "refactor: change wordpress convert class to interface and add wordpress convert null judgment", "committedDate": "2020-01-18T16:36:46Z", "type": "commit"}, {"oid": "80d16bc8c23e72323275bbd7e069ef1a7126376f", "url": "https://github.com/halo-dev/halo/commit/80d16bc8c23e72323275bbd7e069ef1a7126376f", "message": "fix: add some class doc", "committedDate": "2020-01-18T16:52:06Z", "type": "commit"}, {"oid": "19becb3e30bcbb4e48f8b410aedf53275d465d50", "url": "https://github.com/halo-dev/halo/commit/19becb3e30bcbb4e48f8b410aedf53275d465d50", "message": "fix: exclude commons io", "committedDate": "2020-01-18T17:06:25Z", "type": "commit"}, {"oid": "2988fbb7db9e3ccd3fc5251c08b8ebb8ab4c192c", "url": "https://github.com/halo-dev/halo/commit/2988fbb7db9e3ccd3fc5251c08b8ebb8ab4c192c", "message": "feat: add custom annotation: @PropertyMappingTo and reflection utils, It can be used to mapping the relationship between source model and target model", "committedDate": "2020-01-19T05:55:09Z", "type": "commit"}, {"oid": "517ef9ff95c8e5aba8d783a32f2c9e35c84116e9", "url": "https://github.com/halo-dev/halo/commit/517ef9ff95c8e5aba8d783a32f2c9e35c84116e9", "message": "feat: replace the original wordpressconvert implementation with a custom annotation", "committedDate": "2020-01-19T08:36:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3ODQ4Nw==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368278487", "bodyText": "converterFromDto ---> convertFrom.\nThe following also needs to be rectified.", "author": "JohnNiang", "createdAt": "2020-01-19T09:22:36Z", "path": "src/main/java/run/halo/app/handler/migrate/converter/Converter.java", "diffHunk": "@@ -5,26 +5,41 @@\n import java.util.stream.Collectors;\n \n /**\n- * \u535a\u5ba2\u8fc1\u79fb\u6570\u636e\u8f6c\u6362\u5668,\u53ea\u5b9a\u4e49\u4eceT\u8f6cU\u7684\u5355\u5411\u8f6c\u6362\n+ * \u535a\u5ba2\u8fc1\u79fb\u6570\u636e\u8f6c\u6362\u5668,\u53ea\u5b9a\u4e49\u4eceSOURCE\u8f6cTARGET\u7684\u5355\u5411\u8f6c\u6362\n+ *\n  * @author guqing\n  * @date 2020-01-18 16:45\n  */\n-public class Converter<T, U> {\n+public interface Converter<SOURCE, TARGET> {\n+\n     /**\n-     *  \u4ece T \u8f6c\u6362\u4e3a U\n+     * \u5c06source\u8f6c\u6362\u4e3atarget\n+     *\n+     * @param s \u9700\u8981\u8f6c\u6362\u7684\u6e90\u5bf9\u8c61\n+     * @return \u8fd4\u56de\u8f6c\u6362\u5f97\u5230\u7684\u7ed3\u679c\u5bf9\u8c61\n      */\n-    private Function<T, U> fromDto;\n-\n-    public Converter(final Function<T, U> fromDto) {\n-        this.fromDto = fromDto;\n-    }\n+    TARGET converterFromDto(SOURCE s);\n \n-    public final U converterFromDto(final T dto){", "originalCommit": "541d79d7828e97a00a2ddb434a4477c41cc641f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MDIyMg==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368280222", "bodyText": "\u597d\u7684\ud83d\ude02\u7684\u786e\u662f \u8fd9\u4e2a\u540d\u5b57  \u4e0d\u592a\u5408\u9002", "author": "guqing", "createdAt": "2020-01-19T09:47:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3ODQ4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3ODc4Ng==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368278786", "bodyText": "We do not recommend the use of Assert#notNull from here. Because the items is not a parameter, and this check may throw java.lang.IllegalArgumentException.", "author": "JohnNiang", "createdAt": "2020-01-19T09:27:47Z", "path": "src/main/java/run/halo/app/handler/migrate/converter/WordPressConverter.java", "diffHunk": "@@ -17,128 +18,144 @@\n import java.time.LocalDateTime;\n import java.time.ZoneId;\n import java.time.format.DateTimeFormatter;\n-import java.util.ArrayList;\n-import java.util.Date;\n-import java.util.List;\n+import java.util.*;\n import java.util.function.Function;\n \n /**\n  * WordPress\u535a\u5ba2\u6570\u636e\u8fc1\u79fb\u8f6c\u6362\u5668\n+ *\n  * @author guqing\n  * @date 2020-01-18 16:50\n  */\n-public class WordPressConverter extends Converter<Rss, List<PostVO>> {\n+public class WordPressConverter implements Converter<Rss, List<PostVO>> {\n \n-    public WordPressConverter() {\n-        super(new PostVoFunction());\n+    @Override\n+    public List<PostVO> converterFromDto(Rss rss) {\n+        return converterFromDto(rss, this::apply);\n     }\n \n     /**\n      * \u81ea\u5b9a\u4e49\u8f6c\u6362\u89c4\u5219\n      */\n-    private static class PostVoFunction implements Function<Rss, List<PostVO>> {\n-        @Override\n-        public List<PostVO> apply(Rss rss) {\n-            Channel channel = rss.getChannel();\n-            List<Item> items = channel.getItems();\n-            Assert.notNull(items, \"\u89e3\u6790\u51fa\u9519,\u6587\u7ae0item\u9879\u4e0d\u80fd\u4e3anull\");\n-\n-            return  getBasePost(items);\n+    public List<PostVO> apply(Rss rss) {\n+        if(Objects.isNull(rss) || Objects.isNull(rss.getChannel())) {\n+            return new ArrayList<>();\n         }\n \n-        private List<PostVO> getBasePost(List<Item> items) {\n-            List<PostVO> posts = new ArrayList<>();\n-            items.forEach(item -> {\n-                PostVO postVo = new PostVO();\n+        Channel channel = rss.getChannel();\n \n-                // \u8bbe\u7f6e\u6587\u7ae0\n-                BasePost post = getBasePostFromItem(item);\n-                postVo.setBasePost(post);\n+        List<Item> items = channel.getItems();\n+        Assert.notNull(items, \"\u89e3\u6790\u51fa\u9519,\u6587\u7ae0item\u9879\u4e0d\u80fd\u4e3anull\");", "originalCommit": "541d79d7828e97a00a2ddb434a4477c41cc641f8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI4MDE0OA==", "url": "https://github.com/halo-dev/halo/pull/506#discussion_r368280148", "bodyText": "\u6328\u4e0d\u5bf9\u554a  \u8fd9\u91cc\u6211\u5df2\u7ecf\u6539\u8fc7\u4e86\u96be\u9053\u6ca1\u540c\u6b65\u8fc7\u53bb\nWordPressConvert", "author": "guqing", "createdAt": "2020-01-19T09:47:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODI3ODc4Ng=="}], "type": "inlineReview"}, {"oid": "19044b6fd85d370d08b4d6041eff2f62fcca2efd", "url": "https://github.com/halo-dev/halo/commit/19044b6fd85d370d08b4d6041eff2f62fcca2efd", "message": "fix: change wordpress convert method name", "committedDate": "2020-01-20T06:37:57Z", "type": "commit"}, {"oid": "d14f6ead279f3ef3dc77f5074a1db6c4181eede1", "url": "https://github.com/halo-dev/halo/commit/d14f6ead279f3ef3dc77f5074a1db6c4181eede1", "message": "fix: change wordpress convert method name", "committedDate": "2020-01-20T06:43:41Z", "type": "commit"}, {"oid": "37f0d30133aeb93731a77eefa8fb2c0ed398274f", "url": "https://github.com/halo-dev/halo/commit/37f0d30133aeb93731a77eefa8fb2c0ed398274f", "message": "fix: merger conflict", "committedDate": "2020-01-20T06:55:42Z", "type": "commit"}, {"oid": "c5dac64d03c2272e9fe33cb4cc97bfbada4a750e", "url": "https://github.com/halo-dev/halo/commit/c5dac64d03c2272e9fe33cb4cc97bfbada4a750e", "message": "fix: merger conflict", "committedDate": "2020-01-20T07:03:45Z", "type": "commit"}]}