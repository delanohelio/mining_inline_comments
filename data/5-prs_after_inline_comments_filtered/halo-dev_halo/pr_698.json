{"pr_number": 698, "pr_title": "Refactor get database version.", "pr_createdAt": "2020-03-20T12:29:41Z", "pr_url": "https://github.com/halo-dev/halo/pull/698", "timeline": [{"oid": "4b22df063522da2fbf35118c6381dfb2b4db1db0", "url": "https://github.com/halo-dev/halo/commit/4b22df063522da2fbf35118c6381dfb2b4db1db0", "message": "refactor: get database version.", "committedDate": "2020-03-20T12:27:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTYwNjQ5Mw==", "url": "https://github.com/halo-dev/halo/pull/698#discussion_r395606493", "bodyText": "\u5176\u5b9e\u6211\u4e0d\u77e5\u9053\u8fd9\u91cc\u5173\u95ed\u540e\u6709\u6ca1\u6709\u5565\u5f71\u54cd\u3002\u4f46\u662f flyway \u7684 DatabaseMetaData \u662f\u5185\u90e8\u53d8\u91cf\uff0c\u6ca1\u6cd5\u83b7\u53d6\uff0c\u53ea\u80fd\u83b7\u53d6 flyway \u521b\u5efa\u7684 Connection \u4e86\u3002", "author": "ruibaby", "createdAt": "2020-03-20T12:34:24Z", "path": "src/main/java/run/halo/app/listener/StartedListener.java", "diffHunk": "@@ -88,6 +98,19 @@ private void migrate() {\n             .load();\n         flyway.repair();\n         flyway.migrate();\n+\n+        // Gets database connection\n+        Connection connection = flyway.getConfiguration().getDataSource().getConnection();\n+\n+        // Gets database metadata\n+        DatabaseMetaData databaseMetaData = JdbcUtils.getDatabaseMetaData(connection);\n+\n+        // Gets database product name\n+        HaloConst.DATABASE_PRODUCT_NAME = databaseMetaData.getDatabaseProductName() + \" \" + databaseMetaData.getDatabaseProductVersion();\n+\n+        // Close connection.\n+        connection.close();", "originalCommit": "4b22df063522da2fbf35118c6381dfb2b4db1db0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}