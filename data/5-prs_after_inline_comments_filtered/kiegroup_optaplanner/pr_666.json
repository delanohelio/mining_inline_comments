{"pr_number": 666, "pr_title": "PLANNER-1788 ifExists()/ifNotExists() for BiStream", "pr_createdAt": "2020-01-29T14:49:09Z", "pr_url": "https://github.com/kiegroup/optaplanner/pull/666", "timeline": [{"oid": "f133ae52344aba2a6e72d6dc6cdb4be92152b1c2", "url": "https://github.com/kiegroup/optaplanner/commit/f133ae52344aba2a6e72d6dc6cdb4be92152b1c2", "message": "Add the API", "committedDate": "2020-01-29T09:26:41Z", "type": "commit"}, {"oid": "147346e64d00e9c269f7606c0596bf5338064730", "url": "https://github.com/kiegroup/optaplanner/commit/147346e64d00e9c269f7606c0596bf5338064730", "message": "Add the scaffolding", "committedDate": "2020-01-29T09:37:39Z", "type": "commit"}, {"oid": "fb326dd2172d0a3fe6aeedd8b5b1e3ee9568995e", "url": "https://github.com/kiegroup/optaplanner/commit/fb326dd2172d0a3fe6aeedd8b5b1e3ee9568995e", "message": "Add the implementation", "committedDate": "2020-01-29T09:57:46Z", "type": "commit"}, {"oid": "053b43c5674f994ad1f303113a41f3d836b7ee99", "url": "https://github.com/kiegroup/optaplanner/commit/053b43c5674f994ad1f303113a41f3d836b7ee99", "message": "Update Javadoc", "committedDate": "2020-01-29T11:36:40Z", "type": "commit"}, {"oid": "fcda2cb9cbcc6e1fefd48173e85cec49f541b334", "url": "https://github.com/kiegroup/optaplanner/commit/fcda2cb9cbcc6e1fefd48173e85cec49f541b334", "message": "Refactor justification list processing", "committedDate": "2020-01-29T13:50:18Z", "type": "commit"}, {"oid": "31926e923f85c5e3e3040d30688092fe6234ac8a", "url": "https://github.com/kiegroup/optaplanner/commit/31926e923f85c5e3e3040d30688092fe6234ac8a", "message": "Add all basic tests", "committedDate": "2020-01-29T14:35:23Z", "type": "commit"}, {"oid": "2552e31c3913ec137777315c42d3560ea1ad15e4", "url": "https://github.com/kiegroup/optaplanner/commit/2552e31c3913ec137777315c42d3560ea1ad15e4", "message": "Add additional test coverage", "committedDate": "2020-01-29T14:44:20Z", "type": "commit"}, {"oid": "d6135deec6f1875b35db7606420b40d7eccbc664", "url": "https://github.com/kiegroup/optaplanner/commit/d6135deec6f1875b35db7606420b40d7eccbc664", "message": "Remove obsolete comment", "committedDate": "2020-01-29T14:53:57Z", "type": "commit"}, {"oid": "7cd2c38ff0f994c0385662c3063024c1de433192", "url": "https://github.com/kiegroup/optaplanner/commit/7cd2c38ff0f994c0385662c3063024c1de433192", "message": "Alter comment", "committedDate": "2020-01-29T14:59:16Z", "type": "commit"}, {"oid": "f2db10997f0e8c829f1a9641fb4ad5b1667cbe42", "url": "https://github.com/kiegroup/optaplanner/commit/f2db10997f0e8c829f1a9641fb4ad5b1667cbe42", "message": "Fix Revapi", "committedDate": "2020-01-29T15:07:19Z", "type": "commit"}, {"oid": "3e303c49328fc52f12b7f6ecfb037c23237df0c4", "url": "https://github.com/kiegroup/optaplanner/commit/3e303c49328fc52f12b7f6ecfb037c23237df0c4", "message": "Minor cleanups I just noticed", "committedDate": "2020-01-29T20:00:55Z", "type": "commit"}, {"oid": "7d44250756e0df73ba036c2d3ebeb13a05aeaee5", "url": "https://github.com/kiegroup/optaplanner/commit/7d44250756e0df73ba036c2d3ebeb13a05aeaee5", "message": "Change naming", "committedDate": "2020-01-29T20:39:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1MzgyNw==", "url": "https://github.com/kiegroup/optaplanner/pull/666#discussion_r373053827", "bodyText": "I just experimented with this, and if called like ifNotExists(Visit.class) - without the joiners - this gives varargs warnings in IDE. Not sure what to do about this method (and its likes here and in UniStream).", "author": "triceo", "createdAt": "2020-01-30T16:27:09Z", "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/stream/bi/BiConstraintStream.java", "diffHunk": "@@ -198,6 +198,166 @@\n         return join(otherClass, AbstractTriJoiner.merge(joiners));\n     }\n \n+    // ************************************************************************\n+    // If (Not) Exists\n+    // ************************************************************************\n+\n+    /**\n+     * Create a new {@link BiConstraintStream} for every pair of A and B where C exists for which the {@link TriJoiner}\n+     * is true (for the properties it extracts from the facts).\n+     * <p>\n+     * This method has overloaded methods with multiple {@link TriJoiner} parameters.\n+     * @param otherClass never null\n+     * @param joiner never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C exists for which the {@link TriJoiner}\n+     * is true\n+     */\n+    default <C> BiConstraintStream<A, B> ifExists(Class<C> otherClass, TriJoiner<A, B, C> joiner) {\n+        return ifExists(otherClass, new TriJoiner[] { joiner });\n+    }\n+\n+    /**\n+     * As defined by {@link #ifExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * @param otherClass never null\n+     * @param joiner1 never null\n+     * @param joiner2 never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C exists for which the {@link TriJoiner}s\n+     * are true\n+     */\n+    default <C> BiConstraintStream<A, B> ifExists(Class<C> otherClass, TriJoiner<A, B, C> joiner1,\n+            TriJoiner<A, B, C> joiner2) {\n+        return ifExists(otherClass, new TriJoiner[] {joiner1, joiner2});\n+    }\n+\n+    /**\n+     * As defined by {@link #ifExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * @param otherClass never null\n+     * @param joiner1 never null\n+     * @param joiner2 never null\n+     * @param joiner3 never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C exists for which the {@link TriJoiner}s\n+     * are true\n+     */\n+    default <C> BiConstraintStream<A, B> ifExists(Class<C> otherClass, TriJoiner<A, B, C> joiner1,\n+            TriJoiner<A, B, C> joiner2, TriJoiner<A, B, C> joiner3) {\n+        return ifExists(otherClass, new TriJoiner[] {joiner1, joiner2, joiner3});\n+    }\n+\n+    /**\n+     * As defined by {@link #ifExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * @param otherClass never null\n+     * @param joiner1 never null\n+     * @param joiner2 never null\n+     * @param joiner3 never null\n+     * @param joiner4 never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C exists for which the {@link TriJoiner}s\n+     * are true\n+     */\n+    default <C> BiConstraintStream<A, B> ifExists(Class<C> otherClass, TriJoiner<A, B, C> joiner1,\n+            TriJoiner<A, B, C> joiner2, TriJoiner<A, B, C> joiner3, TriJoiner<A, B, C> joiner4) {\n+        return ifExists(otherClass, new TriJoiner[] {joiner1, joiner2, joiner3, joiner4});\n+    }\n+\n+    /**\n+     * As defined by {@link #ifExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * <p>\n+     * This method causes <i>Unchecked generics array creation for varargs parameter</i> warnings,\n+     * but we can't fix it with a {@link SafeVarargs} annotation because it's an interface method.\n+     * Therefore, there are overloaded methods with up to 4 {@link TriJoiner} parameters.\n+     * @param otherClass never null\n+     * @param joiners never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C exists for which the {@link TriJoiner}s\n+     * are true\n+     */\n+    <C> BiConstraintStream<A, B> ifExists(Class<C> otherClass, TriJoiner<A, B, C>... joiners);\n+\n+    /**\n+     * Create a new {@link BiConstraintStream} for every pair of A and B where C does not exist for which the\n+     * {@link TriJoiner} is true (for the properties it extracts from the facts).\n+     * <p>\n+     * This method has overloaded methods with multiple {@link TriJoiner} parameters.\n+     * @param otherClass never null\n+     * @param joiner never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C does not exist for which the\n+     * {@link TriJoiner} is true\n+     */\n+    default <C> BiConstraintStream<A, B> ifNotExists(Class<C> otherClass, TriJoiner<A, B, C> joiner) {\n+        return ifNotExists(otherClass, new TriJoiner[] { joiner });\n+    }\n+\n+    /**\n+     * As defined by {@link #ifNotExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * @param otherClass never null\n+     * @param joiner1 never null\n+     * @param joiner2 never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C does not exist for which the\n+     * {@link TriJoiner}s are true\n+     */\n+    default <C> BiConstraintStream<A, B> ifNotExists(Class<C> otherClass, TriJoiner<A, B, C> joiner1,\n+            TriJoiner<A, B, C> joiner2) {\n+        return ifNotExists(otherClass, new TriJoiner[] {joiner1, joiner2});\n+    }\n+\n+    /**\n+     * As defined by {@link #ifNotExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * @param otherClass never null\n+     * @param joiner1 never null\n+     * @param joiner2 never null\n+     * @param joiner3 never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C does not exist for which the\n+     * {@link TriJoiner}s are true\n+     */\n+    default <C> BiConstraintStream<A, B> ifNotExists(Class<C> otherClass, TriJoiner<A, B, C> joiner1,\n+            TriJoiner<A, B, C> joiner2, TriJoiner<A, B, C> joiner3) {\n+        return ifNotExists(otherClass, new TriJoiner[] {joiner1, joiner2, joiner3});\n+    }\n+\n+    /**\n+     * As defined by {@link #ifNotExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * @param otherClass never null\n+     * @param joiner1 never null\n+     * @param joiner2 never null\n+     * @param joiner3 never null\n+     * @param joiner4 never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C does not exist for which the\n+     * {@link TriJoiner}s are true\n+     */\n+    default <C> BiConstraintStream<A, B> ifNotExists(Class<C> otherClass, TriJoiner<A, B, C> joiner1,\n+            TriJoiner<A, B, C> joiner2, TriJoiner<A, B, C> joiner3, TriJoiner<A, B, C> joiner4) {\n+        return ifNotExists(otherClass, new TriJoiner[] {joiner1, joiner2, joiner3, joiner4});\n+    }\n+\n+    /**\n+     * As defined by {@link #ifNotExists(Class, TriJoiner)}. For performance reasons, indexing joiners must be placed\n+     * before filtering joiners.\n+     * <p>\n+     * This method causes <i>Unchecked generics array creation for varargs parameter</i> warnings,\n+     * but we can't fix it with a {@link SafeVarargs} annotation because it's an interface method.\n+     * Therefore, there are overloaded methods with up to 4 {@link TriJoiner} parameters.\n+     * @param otherClass never null\n+     * @param joiners never null\n+     * @param <C> the type of the third matched fact\n+     * @return never null, a stream that matches every pair of A and B where C does not exist for which the\n+     * {@link TriJoiner}s are true\n+     */\n+    <C> BiConstraintStream<A, B> ifNotExists(Class<C> otherClass, TriJoiner<A, B, C>... joiners);", "originalCommit": "7d44250756e0df73ba036c2d3ebeb13a05aeaee5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MDgyOA==", "url": "https://github.com/kiegroup/optaplanner/pull/666#discussion_r373970828", "bodyText": "In the javadoc it says:\n* This method causes Unchecked generics array creation for varargs parameter warnings,\n* but we can't fix it with a {@link SafeVarargs} annotation because it's an interface method.\n* Therefore, there are overloaded methods with up to 4 {@link TriJoiner} parameters.\nI've seen that issue on all other varargs methods before (including join etc) - is this the same issue as what you are seeing?\nIf it is, ignore it: this javadoc is the lesser evil. If it's not, let's discuss it.", "author": "ge0ffrey", "createdAt": "2020-02-03T08:28:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1MzgyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MTQ2Ng==", "url": "https://github.com/kiegroup/optaplanner/pull/666#discussion_r373971466", "bodyText": "Yeah, it is the same with joins etc. Ok, leaving it as it is.", "author": "triceo", "createdAt": "2020-02-03T08:29:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MzA1MzgyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk2OTkyMA==", "url": "https://github.com/kiegroup/optaplanner/pull/666#discussion_r373969920", "bodyText": "style: Not and Exists without capital. only first word has capital in comments", "author": "ge0ffrey", "createdAt": "2020-02-03T08:25:45Z", "path": "optaplanner-core/src/main/java/org/optaplanner/core/api/score/stream/bi/BiConstraintStream.java", "diffHunk": "@@ -198,6 +198,166 @@\n         return join(otherClass, AbstractTriJoiner.merge(joiners));\n     }\n \n+    // ************************************************************************\n+    // If (Not) Exists", "originalCommit": "7d44250756e0df73ba036c2d3ebeb13a05aeaee5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk3MDE5NQ==", "url": "https://github.com/kiegroup/optaplanner/pull/666#discussion_r373970195", "bodyText": "BTW, in general for titles (including docs), we're now following scientific titles, not newspaper titles. So basically only the first word has a capital.", "author": "ge0ffrey", "createdAt": "2020-02-03T08:26:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Mzk2OTkyMA=="}], "type": "inlineReview"}, {"oid": "1bf9d930116a8bb254e29d29cca8536bda5ff71c", "url": "https://github.com/kiegroup/optaplanner/commit/1bf9d930116a8bb254e29d29cca8536bda5ff71c", "message": "Fix Javadoc", "committedDate": "2020-02-03T08:40:21Z", "type": "commit"}]}