{"pr_number": 54057, "pr_title": "Reindex negative TimeValue fix", "pr_createdAt": "2020-03-24T07:59:52Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54057", "timeline": [{"oid": "d3ad55cb4977af8c8ba1b117a476bc4b76f27bc3", "url": "https://github.com/elastic/elasticsearch/commit/d3ad55cb4977af8c8ba1b117a476bc4b76f27bc3", "message": "Reindex negative TimeValue fix\n\nReindex would use timeValueNanos(System.nanoTime()). The intended use\nfor TimeValue is as a duration, not as absolute time. In particular,\nthis could result in negative TimeValue's, being unsupported in #53913.", "committedDate": "2020-03-24T07:58:41Z", "type": "commit"}, {"oid": "c4991a5c8b5b466cb8ac73e5386f3d265c059e6d", "url": "https://github.com/elastic/elasticsearch/commit/c4991a5c8b5b466cb8ac73e5386f3d265c059e6d", "message": "Fix compilation", "committedDate": "2020-03-24T10:26:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ3MzgzOA==", "url": "https://github.com/elastic/elasticsearch/pull/54057#discussion_r397473838", "bodyText": "This was interesting anyway since this constructor TimeValue(long) is intended to be passed a value that represents milliseconds, which System#nanoTime does not.", "author": "jasontedor", "createdAt": "2020-03-24T21:31:37Z", "path": "modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java", "diffHunk": "@@ -247,16 +247,16 @@ public void start() {\n     void onScrollResponse(ScrollableHitSource.AsyncResponse asyncResponse) {\n         // lastBatchStartTime is essentially unused (see WorkerBulkByScrollTaskState.throttleWaitTime. Leaving it for now, since it seems\n         // like a bug?\n-        onScrollResponse(new TimeValue(System.nanoTime()), this.lastBatchSize, asyncResponse);", "originalCommit": "c4991a5c8b5b466cb8ac73e5386f3d265c059e6d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ3NDQyMg==", "url": "https://github.com/elastic/elasticsearch/pull/54057#discussion_r397474422", "bodyText": "Yeah, I double checked that and I introduced that \"bug\" when refactoring this last year. It never showed up, since the variable ends up unused anyway...", "author": "henningandersen", "createdAt": "2020-03-24T21:32:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ3MzgzOA=="}], "type": "inlineReview"}]}