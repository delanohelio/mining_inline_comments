{"pr_number": 54460, "pr_title": "NodeInfo response should use a collection rather than fields", "pr_createdAt": "2020-03-30T18:55:06Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54460", "timeline": [{"oid": "de00abcba1eacc1227aa742e6f7a15caef2c90f4", "url": "https://github.com/elastic/elasticsearch/commit/de00abcba1eacc1227aa742e6f7a15caef2c90f4", "message": "Use flexible structure for OsInfo in NodeInfo\n\nThis is a first cut at giving NodeInfo the ability to carry a flexible\nlist of heterogeneous info responses. The trick is to be able to\nserialize and deserialize an arbitrary list of blocks of information. It\nis convenient to be able to deserialize into usable Java objects so that\nwe can aggregate nodes stats for the cluster stats endpoint.\n\nIn order to provide a little bit of clarity about which objects can and\ncan't be used as info blocks, I've introduced a new interface called\n\"ReportingService.\"", "committedDate": "2020-03-25T00:54:44Z", "type": "commit"}, {"oid": "10f6f9b119fad1816464a56bbc78eb457d97b75a", "url": "https://github.com/elastic/elasticsearch/commit/10f6f9b119fad1816464a56bbc78eb457d97b75a", "message": "Add other info blocks to service info map", "committedDate": "2020-03-26T13:11:24Z", "type": "commit"}, {"oid": "928fd53846daa3ce899bb158b0993957b039cf35", "url": "https://github.com/elastic/elasticsearch/commit/928fd53846daa3ce899bb158b0993957b039cf35", "message": "Merge branch 'master' into nodes-info-response-transport-refactor", "committedDate": "2020-03-26T13:11:45Z", "type": "commit"}, {"oid": "28c285d1470db4a52ee684e9cd0b360bd418e074", "url": "https://github.com/elastic/elasticsearch/commit/28c285d1470db4a52ee684e9cd0b360bd418e074", "message": "Use helper method to filter nulls", "committedDate": "2020-03-26T18:14:26Z", "type": "commit"}, {"oid": "458e5eafa71a829f9bc477524ee63c30b8983fe1", "url": "https://github.com/elastic/elasticsearch/commit/458e5eafa71a829f9bc477524ee63c30b8983fe1", "message": "Remove unused imports", "committedDate": "2020-03-27T11:21:50Z", "type": "commit"}, {"oid": "5b9dc646c92322e44447dee4a7425ef162dd2df3", "url": "https://github.com/elastic/elasticsearch/commit/5b9dc646c92322e44447dee4a7425ef162dd2df3", "message": "Merge branch 'master' into nodes-info-response-transport-refactor", "committedDate": "2020-03-27T11:22:25Z", "type": "commit"}, {"oid": "ada09b335a18233f827cba7d021bf44c87079947", "url": "https://github.com/elastic/elasticsearch/commit/ada09b335a18233f827cba7d021bf44c87079947", "message": "Remove transport refactor and hardcoded getters\n\nI tried a different serialization for NodeInfo that would allow writing\nflexible, arbitrary lists of node info blocks, but it seems too early in\nthe process to commit to anything definite, so I've backed out the\nchange.\n\nI have removed the hard-coded getters (e.g., getOs()) in favor of a\nflexible method that can return heterogeneous kinds of info blocks\n(e.g., getInfo(OsInfo.class)). Taking a class as an argument removes the\nneed to cast in the client code.", "committedDate": "2020-03-27T19:44:58Z", "type": "commit"}, {"oid": "084d585a6579c2a631a61c063b45db8163604972", "url": "https://github.com/elastic/elasticsearch/commit/084d585a6579c2a631a61c063b45db8163604972", "message": "Merge branch 'master' into nodes-info-response-fields-to-collection", "committedDate": "2020-03-30T17:05:03Z", "type": "commit"}, {"oid": "a7be9a18d8d781b4a661a2a27ec1d0de92bbc027", "url": "https://github.com/elastic/elasticsearch/commit/a7be9a18d8d781b4a661a2a27ec1d0de92bbc027", "message": "ReportingService.Info should just be Writeable", "committedDate": "2020-03-30T17:48:52Z", "type": "commit"}, {"oid": "32b0e59c3f8c81f100fa0a1fe5724e9692a130a8", "url": "https://github.com/elastic/elasticsearch/commit/32b0e59c3f8c81f100fa0a1fe5724e9692a130a8", "message": "Add a few unit tests", "committedDate": "2020-03-30T19:07:59Z", "type": "commit"}, {"oid": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1", "url": "https://github.com/elastic/elasticsearch/commit/376d74c5fdd4798d7bc58a6947311a063a4aa1a1", "message": "Adhere to testing conventions", "committedDate": "2020-03-30T20:55:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDgyNDYxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/54460#discussion_r400824619", "bodyText": "Maybename it maybeAddInfo(...)? I'm unsure if that's an improvement.", "author": "pugnascotia", "createdAt": "2020-03-31T11:02:26Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java", "diffHunk": "@@ -147,60 +129,22 @@ public Settings getSettings() {\n         return this.settings;\n     }\n \n-    /**\n-     * Operating System level information.\n-     */\n-    @Nullable\n-    public OsInfo getOs() {\n-        return this.os;\n-    }\n-\n-    /**\n-     * Process level information.\n-     */\n-    @Nullable\n-    public ProcessInfo getProcess() {\n-        return process;\n-    }\n-\n-    /**\n-     * JVM level information.\n-     */\n-    @Nullable\n-    public JvmInfo getJvm() {\n-        return jvm;\n-    }\n-\n-    @Nullable\n-    public ThreadPoolInfo getThreadPool() {\n-        return this.threadPool;\n-    }\n-\n-    @Nullable\n-    public TransportInfo getTransport() {\n-        return transport;\n-    }\n-\n-    @Nullable\n-    public HttpInfo getHttp() {\n-        return http;\n-    }\n-\n-    @Nullable\n-    public PluginsAndModules getPlugins() {\n-        return this.plugins;\n-    }\n-\n-    @Nullable\n-    public IngestInfo getIngest() {\n-        return ingest;\n+    // TODO: javadoc on the utility of a method that hides casting\n+    public <T extends ReportingService.Info> T getInfo(Class<T> clazz) {\n+        return clazz.cast(infoMap.get(clazz));\n     }\n \n     @Nullable\n     public ByteSizeValue getTotalIndexingBuffer() {\n         return totalIndexingBuffer;\n     }\n \n+    private void addInfoIfNonNull(Class<? extends ReportingService.Info> clazz, ReportingService.Info info) {", "originalCommit": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ4OTQwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/54460#discussion_r404489401", "bodyText": "Can this java doc be added before committing?", "author": "rjernst", "createdAt": "2020-04-07T01:48:49Z", "path": "server/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java", "diffHunk": "@@ -147,60 +129,22 @@ public Settings getSettings() {\n         return this.settings;\n     }\n \n-    /**\n-     * Operating System level information.\n-     */\n-    @Nullable\n-    public OsInfo getOs() {\n-        return this.os;\n-    }\n-\n-    /**\n-     * Process level information.\n-     */\n-    @Nullable\n-    public ProcessInfo getProcess() {\n-        return process;\n-    }\n-\n-    /**\n-     * JVM level information.\n-     */\n-    @Nullable\n-    public JvmInfo getJvm() {\n-        return jvm;\n-    }\n-\n-    @Nullable\n-    public ThreadPoolInfo getThreadPool() {\n-        return this.threadPool;\n-    }\n-\n-    @Nullable\n-    public TransportInfo getTransport() {\n-        return transport;\n-    }\n-\n-    @Nullable\n-    public HttpInfo getHttp() {\n-        return http;\n-    }\n-\n-    @Nullable\n-    public PluginsAndModules getPlugins() {\n-        return this.plugins;\n-    }\n-\n-    @Nullable\n-    public IngestInfo getIngest() {\n-        return ingest;\n+    // TODO: javadoc on the utility of a method that hides casting", "originalCommit": "376d74c5fdd4798d7bc58a6947311a063a4aa1a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzUzMDI0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/54460#discussion_r407530246", "bodyText": "Javadoc added!", "author": "williamrandolph", "createdAt": "2020-04-13T15:13:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDQ4OTQwMQ=="}], "type": "inlineReview"}, {"oid": "65ec0f7f38841aa11ff87592dee035cee0540bfc", "url": "https://github.com/elastic/elasticsearch/commit/65ec0f7f38841aa11ff87592dee035cee0540bfc", "message": "Merge branch 'master' into nodes-info-response-fields-to-collection", "committedDate": "2020-04-13T14:57:39Z", "type": "commit"}, {"oid": "5f9a767ab20f25e38441def1712b2f13bab30536", "url": "https://github.com/elastic/elasticsearch/commit/5f9a767ab20f25e38441def1712b2f13bab30536", "message": "Add javadoc for heterogeneous typesafe access", "committedDate": "2020-04-13T15:12:07Z", "type": "commit"}]}