{"pr_number": 56329, "pr_title": "Fix Noisy Logging during Snapshot Delete (#56264)", "pr_createdAt": "2020-05-07T10:19:02Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56329", "timeline": [{"oid": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf", "url": "https://github.com/elastic/elasticsearch/commit/ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf", "message": "Fix Noisy Logging during Snapshot Delete (#56264)\n\nWe were logging the cleanup of the snap- and meta- blobs for every snapshot delete\r\nwhich is needlessly noisy and confusing to users. We should only log actual stale/unexpected\r\nblobs here.", "committedDate": "2020-05-07T10:15:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw==", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421399123", "bodyText": "I think it would be helpful to continue to log all the blobs at TRACE level; I'd do both if there are unexpected ones as it's interesting to know that they were unexpected.", "author": "DaveCTurner", "createdAt": "2020-05-07T10:22:07Z", "path": "server/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java", "diffHunk": "@@ -912,12 +916,24 @@ public void cleanup(long repositoryStateId, Version repositoryMetaVersion, Actio\n         ).collect(Collectors.toList());\n     }\n \n-    private List<String> cleanupStaleRootFiles(List<String> blobsToDelete) {\n+    private List<String> cleanupStaleRootFiles(Collection<SnapshotId> deletedSnapshots, List<String> blobsToDelete) {\n         if (blobsToDelete.isEmpty()) {\n             return blobsToDelete;\n         }\n         try {\n-            logger.info(\"[{}] Found stale root level blobs {}. Cleaning them up\", metadata.name(), blobsToDelete);\n+            if (logger.isInfoEnabled()) {", "originalCommit": "ce1803f50cd951ba8a3d9501cb9be6f38c0d9ccf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwMjMzNA==", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421402334", "bodyText": "D'oh just spotted this was a backport and already approved in master, sorry \ud83d\ude15", "author": "DaveCTurner", "createdAt": "2020-05-07T10:28:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwNzkwOA==", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421407908", "bodyText": "No worries, I'll do a follow-up for this shortly, I wanted to add some other trace logging as well anyway :)", "author": "original-brownbear", "createdAt": "2020-05-07T10:38:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQwOTk4MA==", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421409980", "bodyText": "the more \ud83d\udc40 the better", "author": "tlrx", "createdAt": "2020-05-07T10:42:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTU0MjA0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/56329#discussion_r421542045", "bodyText": "#56336 :)", "author": "original-brownbear", "createdAt": "2020-05-07T14:20:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM5OTEyMw=="}], "type": "inlineReview"}]}