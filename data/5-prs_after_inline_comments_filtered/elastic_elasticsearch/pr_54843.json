{"pr_number": 54843, "pr_title": "EQL: Add cascading search cancellation", "pr_createdAt": "2020-04-06T19:56:49Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54843", "timeline": [{"oid": "2a75e8825affddbb99ddcb823f61f77ab1fa5788", "url": "https://github.com/elastic/elasticsearch/commit/2a75e8825affddbb99ddcb823f61f77ab1fa5788", "message": "EQL: Add cascading search cancellation\n\nEQL search cancellation now propagates cancellation to underlying search\noperations.\n\nRelates to #49638", "committedDate": "2020-04-06T19:53:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExODI1Ng==", "url": "https://github.com/elastic/elasticsearch/pull/54843#discussion_r406118256", "bodyText": "Since nodeId and EqlSearchTask are coupled, maybe they can be assembled into a compound object?", "author": "costin", "createdAt": "2020-04-09T10:45:21Z", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/session/Configuration.java", "diffHunk": "@@ -21,12 +22,13 @@\n     private final String clientId;\n     private final boolean includeFrozenIndices;\n     private final EqlSearchTask task;\n+    private final TaskId taskId;\n \n     @Nullable\n     private QueryBuilder filter;\n \n     public Configuration(String[] indices, ZoneId zi, String username, String clusterName, QueryBuilder filter, TimeValue requestTimeout,\n-                         int size, boolean includeFrozen, String clientId, EqlSearchTask task) {\n+                         int size, boolean includeFrozen, String clientId, String nodeId, EqlSearchTask task) {", "originalCommit": "2a75e8825affddbb99ddcb823f61f77ab1fa5788", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjIxMDQwNw==", "url": "https://github.com/elastic/elasticsearch/pull/54843#discussion_r406210407", "bodyText": "Yes, I agree. The problem here that we really need TaskId (nodeID, id)  and we need a cancellation flag. The cancellation flag and id are coming from EqlSearchTask, but in order to assemble TaskId we need to also know the node. The EqlSearchTask is basically CancellableTasks and shouldn't really care about the node id. I tried to clean it up a bit and removed dependency on EqlSearchTask for now. We will see how it goes. We might need to bring it back for progress updates, but I am not 100% sure that will be necessary.", "author": "imotov", "createdAt": "2020-04-09T13:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExODI1Ng=="}], "type": "inlineReview"}, {"oid": "00c14b034224d1424d18edc8ba49a37791fcce71", "url": "https://github.com/elastic/elasticsearch/commit/00c14b034224d1424d18edc8ba49a37791fcce71", "message": "Refactor passing task cancellation flag and task id", "committedDate": "2020-04-09T13:33:06Z", "type": "commit"}, {"oid": "b0fd25a025de344346ba0a33242519ddf15fe1a6", "url": "https://github.com/elastic/elasticsearch/commit/b0fd25a025de344346ba0a33242519ddf15fe1a6", "message": "Add integration tests for cancellation", "committedDate": "2020-04-09T18:29:19Z", "type": "commit"}, {"oid": "130f6d2dfbdd4d683d86fb84311b58967277827d", "url": "https://github.com/elastic/elasticsearch/commit/130f6d2dfbdd4d683d86fb84311b58967277827d", "message": "Merge remote-tracking branch 'elastic/master' into issue-49638-eql-cascading-cancellations", "committedDate": "2020-04-09T18:29:28Z", "type": "commit"}]}