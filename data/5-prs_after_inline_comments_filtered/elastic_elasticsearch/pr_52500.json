{"pr_number": 52500, "pr_title": "Fix geo_shape centroid calculation for downgraded shapes", "pr_createdAt": "2020-02-19T03:29:28Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52500", "timeline": [{"oid": "4f0d6404e1fcab64eaebf0a2aec9ae11b86b104d", "url": "https://github.com/elastic/elasticsearch/commit/4f0d6404e1fcab64eaebf0a2aec9ae11b86b104d", "message": "Fix geo_shape centroid calculation for downgraded shapes\n\nThis commit modifies the centroid-calculator/dimensional-shape-type\nto properly support the instances of polygons that have no area\nand lines that have no length. Beforehand N/A were returned for the\ncentroid values, but it is best to downcast the shape type to\nthe appropriate type.\n\nCloses #52303.", "committedDate": "2020-02-19T03:26:02Z", "type": "commit"}, {"oid": "3ad5ce73750bf724e186ec0e53c2794eaec52e88", "url": "https://github.com/elastic/elasticsearch/commit/3ad5ce73750bf724e186ec0e53c2794eaec52e88", "message": "fix test bug", "committedDate": "2020-02-19T04:03:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI3ODYyOA==", "url": "https://github.com/elastic/elasticsearch/pull/52500#discussion_r381278628", "bodyText": "Shouldn't we make these private as we have getters for them?", "author": "iverase", "createdAt": "2020-02-19T13:09:01Z", "path": "server/src/main/java/org/elasticsearch/common/geo/CentroidCalculator.java", "diffHunk": "@@ -31,29 +31,45 @@\n import org.elasticsearch.geometry.Point;\n import org.elasticsearch.geometry.Polygon;\n import org.elasticsearch.geometry.Rectangle;\n+import org.elasticsearch.search.aggregations.metrics.CompensatedSum;\n+\n+import static org.elasticsearch.common.geo.DimensionalShapeType.LINE;\n+import static org.elasticsearch.common.geo.DimensionalShapeType.POINT;\n+import static org.elasticsearch.common.geo.DimensionalShapeType.POLYGON;\n \n /**\n  * This class keeps a running Kahan-sum of coordinates\n  * that are to be averaged in {@link TriangleTreeWriter} for use\n  * as the centroid of a shape.\n  */\n public class CentroidCalculator {\n-    private double compX;\n-    private double compY;\n-    private double sumX;\n-    private double sumY;\n-    private double sumWeight;\n+    CompensatedSum compSumX;\n+    CompensatedSum compSumY;\n+    CompensatedSum compSumWeight;\n+", "originalCommit": "3ad5ce73750bf724e186ec0e53c2794eaec52e88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTM3NDAwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/52500#discussion_r381374001", "bodyText": "I've removed the getters! thanks", "author": "talevy", "createdAt": "2020-02-19T16:06:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTI3ODYyOA=="}], "type": "inlineReview"}, {"oid": "7779dfb5fffbe7d59d444661daa13cd1827e27d1", "url": "https://github.com/elastic/elasticsearch/commit/7779dfb5fffbe7d59d444661daa13cd1827e27d1", "message": "remove gettings for compsums in centroidcalculator", "committedDate": "2020-02-19T15:46:54Z", "type": "commit"}, {"oid": "394c163be8a9208add7ba87d7d9103e761d0abe5", "url": "https://github.com/elastic/elasticsearch/commit/394c163be8a9208add7ba87d7d9103e761d0abe5", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-fix-centroid", "committedDate": "2020-02-20T00:25:38Z", "type": "commit"}, {"oid": "8bcf81a41863d5786c63f5e7eba0584d5149d3ee", "url": "https://github.com/elastic/elasticsearch/commit/8bcf81a41863d5786c63f5e7eba0584d5149d3ee", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-fix-centroid", "committedDate": "2020-02-20T15:52:25Z", "type": "commit"}, {"oid": "59272a123b65a053ce723453a359259769071e6c", "url": "https://github.com/elastic/elasticsearch/commit/59272a123b65a053ce723453a359259769071e6c", "message": "Merge remote-tracking branch 'elastic/geoshape-doc-values' into gdv-fix-centroid", "committedDate": "2020-02-24T16:30:49Z", "type": "commit"}]}