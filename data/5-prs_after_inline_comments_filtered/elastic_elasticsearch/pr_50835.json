{"pr_number": 50835, "pr_title": "Deprecate synced flush", "pr_createdAt": "2020-01-10T02:54:29Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/50835", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyNzM4OA==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365427388", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Please use normal {@link #flush(FlushRequest, RequestOptions)} instead.\n          \n          \n            \n                 * Use {@link #flush(FlushRequest, RequestOptions)} instead.\n          \n      \n    \n    \n  \n\nWhile \"please\" is polite, I think brevity is more important here.\nI also think we can just say \"flush\" instead of \"normal flush.\"", "author": "jrodewig", "createdAt": "2020-01-10T20:57:55Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/IndicesClient.java", "diffHunk": "@@ -423,7 +423,10 @@ public Cancellable flushAsync(FlushRequest flushRequest, RequestOptions options,\n      * @param options the request options (e.g. headers), use {@link RequestOptions#DEFAULT} if nothing needs to be customized\n      * @return the response\n      * @throws IOException in case there is a problem sending the request or parsing back the response\n+     * @deprecated synced flush is deprecated and will be removed in future Elasticsearch versions.\n+     * Please use normal {@link #flush(FlushRequest, RequestOptions)} instead.", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyNzg2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365427863", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Please use normal {@link #flushAsync(FlushRequest, RequestOptions, ActionListener)} instead.\n          \n          \n            \n                 * Use {@link #flushAsync(FlushRequest, RequestOptions, ActionListener)} instead.", "author": "jrodewig", "createdAt": "2020-01-10T20:59:18Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/IndicesClient.java", "diffHunk": "@@ -437,7 +440,10 @@ public SyncedFlushResponse flushSynced(SyncedFlushRequest syncedFlushRequest, Re\n      * @param options the request options (e.g. headers), use {@link RequestOptions#DEFAULT} if nothing needs to be customized\n      * @param listener the listener to be notified upon request completion\n      * @return cancellable that may be used to cancel the request\n+     * @deprecated synced flush is deprecated and will be removed in future Elasticsearch versions.\n+     * Please use normal {@link #flushAsync(FlushRequest, RequestOptions, ActionListener)} instead.", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyNzk3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365427972", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @deprecated synced flush is deprecated and will be removed in future Elasticsearch versions.\n          \n          \n            \n                 * @deprecated Synced flush is deprecated and will be removed in a future version.", "author": "jrodewig", "createdAt": "2020-01-10T20:59:36Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/IndicesClient.java", "diffHunk": "@@ -437,7 +440,10 @@ public SyncedFlushResponse flushSynced(SyncedFlushRequest syncedFlushRequest, Re\n      * @param options the request options (e.g. headers), use {@link RequestOptions#DEFAULT} if nothing needs to be customized\n      * @param listener the listener to be notified upon request completion\n      * @return cancellable that may be used to cancel the request\n+     * @deprecated synced flush is deprecated and will be removed in future Elasticsearch versions.", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyODExOQ==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365428119", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +\n          \n          \n            \n                            \"Synced flush is deprecated and will be removed in a future version. \" +", "author": "jrodewig", "createdAt": "2020-01-10T21:00:08Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -1018,7 +1018,10 @@ public void testSyncedFlushIndex() throws Exception {\n             // end::flush-synced-request-indicesOptions\n \n             // tag::flush-synced-execute\n-            SyncedFlushResponse flushSyncedResponse = client.indices().flushSynced(request, RequestOptions.DEFAULT);\n+            SyncedFlushResponse flushSyncedResponse = client.indices().flushSynced(request, expectWarnings(\n+                \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQyOTM5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365429395", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"Please use normal flush at _/flush or /{index}/_flush instead.\"\n          \n          \n            \n                            \"Use _/flush or /{index}/_flush instead.\"", "author": "jrodewig", "createdAt": "2020-01-10T21:03:46Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -1018,7 +1018,10 @@ public void testSyncedFlushIndex() throws Exception {\n             // end::flush-synced-request-indicesOptions\n \n             // tag::flush-synced-execute\n-            SyncedFlushResponse flushSyncedResponse = client.indices().flushSynced(request, RequestOptions.DEFAULT);\n+            SyncedFlushResponse flushSyncedResponse = client.indices().flushSynced(request, expectWarnings(\n+                \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +\n+                \"Please use normal flush at _/flush or /{index}/_flush instead.\"", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ0OTgwNw==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365449807", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"Please use normal flush at _/flush or /{index}/_flush instead.\"\n          \n          \n            \n                            \"Use _/flush or /{index}/_flush instead.\"", "author": "jrodewig", "createdAt": "2020-01-10T22:08:18Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -1062,7 +1065,10 @@ public void onFailure(Exception e) {\n             listener = new LatchedActionListener<>(listener, latch);\n \n             // tag::flush-synced-execute-async\n-            client.indices().flushSyncedAsync(request, RequestOptions.DEFAULT, listener); // <1>\n+            client.indices().flushSyncedAsync(request, expectWarnings(\n+                \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +\n+                \"Please use normal flush at _/flush or /{index}/_flush instead.\"", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ0OTg4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365449882", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +\n          \n          \n            \n                            \"Synced flush is deprecated and will be removed in future a version. \" +", "author": "jrodewig", "createdAt": "2020-01-10T22:08:32Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/IndicesClientDocumentationIT.java", "diffHunk": "@@ -1062,7 +1065,10 @@ public void onFailure(Exception e) {\n             listener = new LatchedActionListener<>(listener, latch);\n \n             // tag::flush-synced-execute-async\n-            client.indices().flushSyncedAsync(request, RequestOptions.DEFAULT, listener); // <1>\n+            client.indices().flushSyncedAsync(request, expectWarnings(\n+                \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1MDI4OA==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365450288", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +\n          \n          \n            \n                    \"Synced flush is deprecated and will be removed in a future version. \" +", "author": "jrodewig", "createdAt": "2020-01-10T22:09:52Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportSyncedFlushAction.java", "diffHunk": "@@ -32,7 +34,14 @@\n  */\n public class TransportSyncedFlushAction extends HandledTransportAction<SyncedFlushRequest, SyncedFlushResponse> {\n \n-    SyncedFlushService syncedFlushService;\n+    private final SyncedFlushService syncedFlushService;\n+\n+    private static final DeprecationLogger DEPRECATION_LOGGER =\n+        new DeprecationLogger(LogManager.getLogger(TransportSyncedFlushAction.class));\n+\n+    public static final String SYNCED_FLUSH_DEPRECATION_MESSAGE =\n+        \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTQ1MDMwNQ==", "url": "https://github.com/elastic/elasticsearch/pull/50835#discussion_r365450305", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        \"Please use normal flush at _/flush or /{index}/_flush instead.\";\n          \n          \n            \n                        \"Please use _/flush or /{index}/_flush instead.\";", "author": "jrodewig", "createdAt": "2020-01-10T22:09:56Z", "path": "server/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportSyncedFlushAction.java", "diffHunk": "@@ -32,7 +34,14 @@\n  */\n public class TransportSyncedFlushAction extends HandledTransportAction<SyncedFlushRequest, SyncedFlushResponse> {\n \n-    SyncedFlushService syncedFlushService;\n+    private final SyncedFlushService syncedFlushService;\n+\n+    private static final DeprecationLogger DEPRECATION_LOGGER =\n+        new DeprecationLogger(LogManager.getLogger(TransportSyncedFlushAction.class));\n+\n+    public static final String SYNCED_FLUSH_DEPRECATION_MESSAGE =\n+        \"Synced flush is deprecated and will be removed in future Elasticsearch versions. \" +\n+            \"Please use normal flush at _/flush or /{index}/_flush instead.\";", "originalCommit": "c5d37882ba22064a928d553d454db11fe6174b04", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f6f453fb17d7b2ab9d144194c340ed78efd99bf6", "url": "https://github.com/elastic/elasticsearch/commit/f6f453fb17d7b2ab9d144194c340ed78efd99bf6", "message": "Deprecate synced flush", "committedDate": "2020-01-13T14:52:48Z", "type": "commit"}, {"oid": "f6f453fb17d7b2ab9d144194c340ed78efd99bf6", "url": "https://github.com/elastic/elasticsearch/commit/f6f453fb17d7b2ab9d144194c340ed78efd99bf6", "message": "Deprecate synced flush", "committedDate": "2020-01-13T14:52:48Z", "type": "forcePushed"}, {"oid": "e9e209deb1bf7ee047eadfc23febc91df1a9b6ee", "url": "https://github.com/elastic/elasticsearch/commit/e9e209deb1bf7ee047eadfc23febc91df1a9b6ee", "message": "Remove in 8.0", "committedDate": "2020-01-13T15:09:37Z", "type": "commit"}]}