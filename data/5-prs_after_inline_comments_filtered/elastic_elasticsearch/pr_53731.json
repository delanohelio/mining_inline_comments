{"pr_number": 53731, "pr_title": "Emit deprecation warning when TermsLookup contains a type", "pr_createdAt": "2020-03-18T14:31:58Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53731", "timeline": [{"oid": "32d46525c413196b227a159665940e96776b0f45", "url": "https://github.com/elastic/elasticsearch/commit/32d46525c413196b227a159665940e96776b0f45", "message": "Emit deprecation warning when TermsLookup contains a type", "committedDate": "2020-03-18T14:28:11Z", "type": "commit"}, {"oid": "9ffe71311554c6de764b9c465ea7029987138ba5", "url": "https://github.com/elastic/elasticsearch/commit/9ffe71311554c6de764b9c465ea7029987138ba5", "message": "Check warnings in YAML tests", "committedDate": "2020-03-18T15:02:03Z", "type": "commit"}, {"oid": "b83ec59e29c870e04fd38d87e1a1e6eabd418148", "url": "https://github.com/elastic/elasticsearch/commit/b83ec59e29c870e04fd38d87e1a1e6eabd418148", "message": "precommit", "committedDate": "2020-03-18T15:14:38Z", "type": "commit"}, {"oid": "0e4908306b8c94fbe08d55ea1f2144f357bd5694", "url": "https://github.com/elastic/elasticsearch/commit/0e4908306b8c94fbe08d55ea1f2144f357bd5694", "message": "tests; termsquery doesn't need extra warnings", "committedDate": "2020-03-18T15:39:33Z", "type": "commit"}, {"oid": "aa7fa91bc96a5d18a92427416fd2b56d7712b9ee", "url": "https://github.com/elastic/elasticsearch/commit/aa7fa91bc96a5d18a92427416fd2b56d7712b9ee", "message": "precommit", "committedDate": "2020-03-18T15:56:22Z", "type": "commit"}, {"oid": "41b7247edd0ec15290521d9dfbfd4ae868320cbb", "url": "https://github.com/elastic/elasticsearch/commit/41b7247edd0ec15290521d9dfbfd4ae868320cbb", "message": "BWC filtering", "committedDate": "2020-03-18T16:17:42Z", "type": "commit"}, {"oid": "500fc61fa6db19937ccebcf15930bb8eab07ec5d", "url": "https://github.com/elastic/elasticsearch/commit/500fc61fa6db19937ccebcf15930bb8eab07ec5d", "message": "Allow for BWC tests against 6x", "committedDate": "2020-03-18T17:21:45Z", "type": "commit"}, {"oid": "87c1cfe6a4ef0f5dae1567325f50e35569e675e9", "url": "https://github.com/elastic/elasticsearch/commit/87c1cfe6a4ef0f5dae1567325f50e35569e675e9", "message": "yml", "committedDate": "2020-03-18T17:56:30Z", "type": "commit"}, {"oid": "ce72cb31dfed8afac6f8bd66c5855c01c850cfd0", "url": "https://github.com/elastic/elasticsearch/commit/ce72cb31dfed8afac6f8bd66c5855c01c850cfd0", "message": "Merge remote-tracking branch 'origin/7.x' into deprecation/termslookup-7x", "committedDate": "2020-03-19T15:12:06Z", "type": "commit"}, {"oid": "64602aad1378668ae6bd7f1a31c1388e5212c834", "url": "https://github.com/elastic/elasticsearch/commit/64602aad1378668ae6bd7f1a31c1388e5212c834", "message": "Used allowed_warnings instead of skipping", "committedDate": "2020-03-19T15:16:05Z", "type": "commit"}, {"oid": "84b6890252fd1ad0dfc6bc45049c98bf6355378e", "url": "https://github.com/elastic/elasticsearch/commit/84b6890252fd1ad0dfc6bc45049c98bf6355378e", "message": "skip allowed_warnings", "committedDate": "2020-03-19T15:29:11Z", "type": "commit"}, {"oid": "fddd0021095ad921341f58335b772285e0a8a800", "url": "https://github.com/elastic/elasticsearch/commit/fddd0021095ad921341f58335b772285e0a8a800", "message": "Merge branch '7.x' into deprecation/termslookup-7x", "committedDate": "2020-03-20T11:53:39Z", "type": "commit"}, {"oid": "c7a5f4ed309eeeff86bab1ea4b76dfea0fac043b", "url": "https://github.com/elastic/elasticsearch/commit/c7a5f4ed309eeeff86bab1ea4b76dfea0fac043b", "message": "Merge branch '7.x' into deprecation/termslookup-7x", "committedDate": "2020-03-20T12:22:55Z", "type": "commit"}, {"oid": "8cbbc2d7cd846185c20b646fcfe35b48fe888fd5", "url": "https://github.com/elastic/elasticsearch/commit/8cbbc2d7cd846185c20b646fcfe35b48fe888fd5", "message": "tests", "committedDate": "2020-03-20T12:47:50Z", "type": "commit"}, {"oid": "ff32c3f96fb2b32092a6a42835812f8f366fc891", "url": "https://github.com/elastic/elasticsearch/commit/ff32c3f96fb2b32092a6a42835812f8f366fc891", "message": "precommit", "committedDate": "2020-03-20T13:23:45Z", "type": "commit"}, {"oid": "4a2bb3c28a7a684ca091cbe7bb77ba029f821f48", "url": "https://github.com/elastic/elasticsearch/commit/4a2bb3c28a7a684ca091cbe7bb77ba029f821f48", "message": "re-add skip parameters", "committedDate": "2020-03-20T14:15:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MDY1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/53731#discussion_r396680651", "bodyText": "@romseygeek sorry for the late review, I'm wondering why this check wasn't sufficient for emitting a deprecation warning? Was it not triggered on all the relevant code paths?\nIt would be nice to keep this strategy if possible, since it's consistent with all our other types deprecation warnings (deprecatedAndMaybeLog(\"api_name_with_types\", TYPES_DEPRECATION_MESSAGE);). It also lets us avoid adding an allowed_warnings section to the yml tests, since in 7.x we already ignore all warnings in yml tests that start with [types removal] ... .", "author": "jtibshirani", "createdAt": "2020-03-23T18:49:29Z", "path": "server/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java", "diffHunk": "@@ -402,15 +395,9 @@ public static TermsQueryBuilder fromXContent(XContentParser parser) throws IOExc\n                     \"followed by array of terms or a document lookup specification\");\n         }\n \n-        TermsQueryBuilder builder = new TermsQueryBuilder(fieldName, values, termsLookup)\n+        return new TermsQueryBuilder(fieldName, values, termsLookup)\n             .boost(boost)\n             .queryName(queryName);\n-\n-        if (builder.isTypeless() == false) {", "originalCommit": "4a2bb3c28a7a684ca091cbe7bb77ba029f821f48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk5NjAxNw==", "url": "https://github.com/elastic/elasticsearch/pull/53731#discussion_r396996017", "bodyText": "There was a path that didn't trigger the warning, but I can't find it now, so it may have been refactored away elsewhere.  I'll have a look, it would be good to remove some of these extra allowed_warnings messages.", "author": "romseygeek", "createdAt": "2020-03-24T09:05:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4MDY1MQ=="}], "type": "inlineReview"}]}