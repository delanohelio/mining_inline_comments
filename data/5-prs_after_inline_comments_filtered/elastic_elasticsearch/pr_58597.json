{"pr_number": 58597, "pr_title": "Week based parsing for ingest date processor", "pr_createdAt": "2020-06-26T13:09:31Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58597", "timeline": [{"oid": "e12bd95e59891b6f6330377de973a26010c95274", "url": "https://github.com/elastic/elasticsearch/commit/e12bd95e59891b6f6330377de973a26010c95274", "message": "Week based parsing for ingest date processor\n\nDate processor was incorrectly parsing week based dates as when a\nweekbased year was provided ingest module was thinking year was not\non a date and was trying to applying the logic for `dd/MM` type of\ndates.\nFor testing ingest has to have access to ISOCalendarDataProvider in\norder to correctly calculate week based dates with ISO rules.\nDate Processor is also allowing users to specify locale parameter. It\nshould be taken into account when parsing dates - currently only used\nfor formatting. If someone specifies 'en-us' locale, then calendar data\nrules for that locale should be used.\n\ncloses https://github.com/elastic/elasticsearch/issues/58479", "committedDate": "2020-06-26T13:01:54Z", "type": "commit"}, {"oid": "d83791602f4937224aa6220cec67c44e99f9f0ae", "url": "https://github.com/elastic/elasticsearch/commit/d83791602f4937224aa6220cec67c44e99f9f0ae", "message": "do not allow chaning locale for iso8601 date format", "committedDate": "2020-06-26T13:14:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjQxMQ==", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447272411", "bodyText": "unfinished comment?", "author": "rjernst", "createdAt": "2020-06-29T21:45:31Z", "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/DateFormat.java", "diffHunk": "@@ -45,8 +46,13 @@\n     Iso8601 {\n         @Override\n         Function<String, ZonedDateTime> getFunction(String format, ZoneId timezone, Locale locale) {\n-            return (date) -> DateFormatters.from(DateFormatter.forPattern(\"iso8601\").parse(date), timezone)\n-                                            .withZoneSameInstant(timezone);\n+            //", "originalCommit": "d83791602f4937224aa6220cec67c44e99f9f0ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MjIwOA==", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447442208", "bodyText": "will remove", "author": "pgomulka", "createdAt": "2020-06-30T06:34:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjQxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjUyNg==", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447272526", "bodyText": "nit: extra newlines?", "author": "rjernst", "createdAt": "2020-06-29T21:45:47Z", "path": "modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateFormatTests.java", "diffHunk": "@@ -126,4 +143,6 @@ public void testFromString() {\n         assertThat(DateFormat.fromString(\"tai64n\"), equalTo(DateFormat.Java));\n         assertThat(DateFormat.fromString(\"prefix-\" + randomAlphaOfLengthBetween(1, 10)), equalTo(DateFormat.Java));\n     }\n+", "originalCommit": "d83791602f4937224aa6220cec67c44e99f9f0ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ0MjUzOQ==", "url": "https://github.com/elastic/elasticsearch/pull/58597#discussion_r447442539", "bodyText": "will remove", "author": "pgomulka", "createdAt": "2020-06-30T06:35:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzI3MjUyNg=="}], "type": "inlineReview"}, {"oid": "be15503d09f7c10d9980f586bc46d13bedb76551", "url": "https://github.com/elastic/elasticsearch/commit/be15503d09f7c10d9980f586bc46d13bedb76551", "message": "cleanup after review", "committedDate": "2020-06-30T06:39:46Z", "type": "commit"}, {"oid": "554881794a723153b9b0f638289773f846990fc9", "url": "https://github.com/elastic/elasticsearch/commit/554881794a723153b9b0f638289773f846990fc9", "message": "Merge branch 'master' into date_processor_weeks_and_locale", "committedDate": "2020-06-30T11:00:35Z", "type": "commit"}, {"oid": "baf45e71ec0e7997645d237946e171ee5b1f8691", "url": "https://github.com/elastic/elasticsearch/commit/baf45e71ec0e7997645d237946e171ee5b1f8691", "message": "api", "committedDate": "2020-06-30T11:23:47Z", "type": "commit"}, {"oid": "59ee920f0ccd78a560817fdc8e8780754b0d20a2", "url": "https://github.com/elastic/elasticsearch/commit/59ee920f0ccd78a560817fdc8e8780754b0d20a2", "message": "move isocalendardataprovider back to server and remove dependency", "committedDate": "2020-06-30T12:52:46Z", "type": "commit"}]}