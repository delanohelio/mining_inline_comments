{"pr_number": 66168, "pr_title": "Count the number of shadowing runtime fields in telemetry", "pr_createdAt": "2020-12-10T13:46:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66168", "timeline": [{"oid": "ab440f5a91b517e81b2aea9a1492d02939e8958c", "url": "https://github.com/elastic/elasticsearch/commit/ab440f5a91b517e81b2aea9a1492d02939e8958c", "message": "Count the number of shadowing runtime fields in telemetry", "committedDate": "2020-12-10T13:44:51Z", "type": "commit"}, {"oid": "4e0939bbd2ab8c824165c6492c00ac8276d42a58", "url": "https://github.com/elastic/elasticsearch/commit/4e0939bbd2ab8c824165c6492c00ac8276d42a58", "message": "Merge remote-tracking branch 'origin/master' into runtime/shadowed-telemetry", "committedDate": "2020-12-10T13:45:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE5MTQ1OA==", "url": "https://github.com/elastic/elasticsearch/pull/66168#discussion_r540191458", "bodyText": "I think that you need to handle multi-fields as well? Is that it?", "author": "javanna", "createdAt": "2020-12-10T14:01:12Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/runtimefields/RuntimeFieldsFeatureSetUsage.java", "diffHunk": "@@ -89,6 +98,21 @@ public static RuntimeFieldsFeatureSetUsage fromMetadata(Iterable<IndexMetadata>\n         return new RuntimeFieldsFeatureSetUsage(Collections.unmodifiableList(runtimeFieldStats));\n     }\n \n+    @SuppressWarnings(\"unchecked\")\n+    private static void findFieldNames(Map<String, Object> mappings, String path, Consumer<String> fieldNameConsumer) {\n+        Object o = mappings.get(\"properties\");", "originalCommit": "ab440f5a91b517e81b2aea9a1492d02939e8958c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE5MjEzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/66168#discussion_r540192135", "bodyText": "It would be really great to reuse MappingVisitor here, as it does the right thing, only a shame that it does a fundamentally different thing, as in it does not allow you to consume the name, but rather the content of the field mappings.", "author": "javanna", "createdAt": "2020-12-10T14:02:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE5MTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0MTI5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66168#discussion_r540241293", "bodyText": "I've rewritten to use MappingVisitor, which handles objects and multifields.", "author": "romseygeek", "createdAt": "2020-12-10T15:04:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDE5MTQ1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIxMTQ4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66168#discussion_r540211481", "bodyText": "is it shadowed, or is it shadowing, or? :)", "author": "javanna", "createdAt": "2020-12-10T14:27:35Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/runtimefields/RuntimeFieldsFeatureSetUsage.java", "diffHunk": "@@ -217,6 +244,7 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n             builder.field(\"count\", count);\n             builder.field(\"index_count\", indexCount);\n             builder.field(\"scriptless_count\", scriptLessCount);\n+            builder.field(\"shadowed_count\", shadowedCount);", "originalCommit": "ab440f5a91b517e81b2aea9a1492d02939e8958c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0MjIyMA==", "url": "https://github.com/elastic/elasticsearch/pull/66168#discussion_r540242220", "bodyText": "Well the runtime fields is doing the shadowing, but we're also counting the number of fields shadowed by the runtime section, so \ud83e\udd37 - I can change to shadowing_count if you think that's clearer.  Or maybe have another name altogether...", "author": "romseygeek", "createdAt": "2020-12-10T15:05:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIxMTQ4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDI0NDI2NA==", "url": "https://github.com/elastic/elasticsearch/pull/66168#discussion_r540244264", "bodyText": "it's fine as-is thanks", "author": "javanna", "createdAt": "2020-12-10T15:07:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDIxMTQ4MQ=="}], "type": "inlineReview"}, {"oid": "4d8b2453a0bd970dfbf9e2a1658f174bdb961f2f", "url": "https://github.com/elastic/elasticsearch/commit/4d8b2453a0bd970dfbf9e2a1658f174bdb961f2f", "message": "deef", "committedDate": "2020-12-10T15:03:28Z", "type": "commit"}]}