{"pr_number": 63599, "pr_title": "Provide an extract only distribution configuration for bwc configurations", "pr_createdAt": "2020-10-13T10:31:47Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63599", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MDI3NA==", "url": "https://github.com/elastic/elasticsearch/pull/63599#discussion_r504860274", "bodyText": "Doesn't just depending on the configuration itself work? Why the need to explicitly reference the build dependencies?", "author": "mark-vieira", "createdAt": "2020-10-14T17:45:25Z", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/internal/InternalDistributionArchiveSetupPlugin.java", "diffHunk": "@@ -85,11 +87,16 @@ private void registerAndConfigureDistributionArchivesExtension(Project project)\n             project.project(subProjectName, sub -> {\n                 sub.getPlugins().apply(BasePlugin.class);\n                 sub.getArtifacts().add(DEFAULT_CONFIGURATION_NAME, distributionArchive.getArchiveTask());\n-                var extractedConfiguration = sub.getConfigurations().create(\"extracted\");\n+                var extractedConfiguration = sub.getConfigurations().create(EXTRACTED_CONFIGURATION_NAME);\n                 extractedConfiguration.setCanBeResolved(false);\n                 extractedConfiguration.getAttributes().attribute(ARTIFACT_FORMAT, ArtifactTypeDefinition.DIRECTORY_TYPE);\n                 sub.getArtifacts().add(EXTRACTED_CONFIGURATION_NAME, distributionArchive.getExpandedDistTask());\n-\n+                sub.getTasks().register(\"extractedAssemble\", new Action<Task>() {\n+                    @Override\n+                    public void execute(Task task) {\n+                        task.dependsOn(extractedConfiguration.getAllArtifacts().getBuildDependencies());", "originalCommit": "7973156e4bc274470e49bf2de2f50fbf6d57ee4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MzY2NQ==", "url": "https://github.com/elastic/elasticsearch/pull/63599#discussion_r504863665", "bodyText": "I think you're right \ud83e\udd26", "author": "breskeby", "createdAt": "2020-10-14T17:50:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDg2MDI3NA=="}], "type": "inlineReview"}, {"oid": "f195ef9ee0c84bd1e51dd479242b77fe0cf22885", "url": "https://github.com/elastic/elasticsearch/commit/f195ef9ee0c84bd1e51dd479242b77fe0cf22885", "message": "Some minor polishing", "committedDate": "2020-12-02T10:19:16Z", "type": "forcePushed"}, {"oid": "62d89fab83c69ea73b75a2346dba5f2abdb656fd", "url": "https://github.com/elastic/elasticsearch/commit/62d89fab83c69ea73b75a2346dba5f2abdb656fd", "message": "An extracted dist only configuration for bwc test setup is available\n\nThis PR provides a configuration that can be used for bwc setups that allows\nbwc setups to create an extracted bwc version es distribution without creating a tar\nconfiguration as done by the default _assemble_ configuration\n\nA later PR will change the bwc setup configuration to rely on this extractedAssemble\nconfiguration when building distributions for bwc testing", "committedDate": "2020-12-02T13:28:41Z", "type": "commit"}, {"oid": "fc09dcbae198d22a4b1fcfe6d6bfe4a47c5fac8e", "url": "https://github.com/elastic/elasticsearch/commit/fc09dcbae198d22a4b1fcfe6d6bfe4a47c5fac8e", "message": "Some minor polishing", "committedDate": "2020-12-02T13:28:42Z", "type": "commit"}, {"oid": "b6a4f2b7a3edec0bcf4625bc9c2ddd3c44abad7e", "url": "https://github.com/elastic/elasticsearch/commit/b6a4f2b7a3edec0bcf4625bc9c2ddd3c44abad7e", "message": "Make spotless happy", "committedDate": "2020-12-02T13:28:42Z", "type": "commit"}, {"oid": "b6a4f2b7a3edec0bcf4625bc9c2ddd3c44abad7e", "url": "https://github.com/elastic/elasticsearch/commit/b6a4f2b7a3edec0bcf4625bc9c2ddd3c44abad7e", "message": "Make spotless happy", "committedDate": "2020-12-02T13:28:42Z", "type": "forcePushed"}]}