{"pr_number": 59755, "pr_title": "Remove sporadic min/max usage estimates from stats", "pr_createdAt": "2020-07-17T08:43:14Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59755", "timeline": [{"oid": "c2159ccd4a07485994549b363edb76701338c00a", "url": "https://github.com/elastic/elasticsearch/commit/c2159ccd4a07485994549b363edb76701338c00a", "message": "Remove sporadic min/max usage estimates from stats\n\nToday `GET _nodes/stats/fs` includes `{least,most}_usage_estimate`\nfields for some nodes. These fields have rather strange semantics. They\nare only reported on the elected master and on nodes that have been the\nelected master since they were last restarted; when a node stops being\nthe elected master these stats remain in place but we stop updating them\nso they may become arbitrarily stale.\n\nThis means that these statistics are pretty meaningless and impossible\nto use correctly. Even if they were kept up to date they're never\nreported for data-only nodes anyway, despite the fact that data nodes\nare the ones where we care most about disk usage. The information needed\nto compute the path with the least/most available space is already\nprovided in the rest the stats output, so we can treat the inclusion of\nthese stats as a bug and fix it by simply removing them in this commit.\nSince these stats were always optional and mostly omitted (for opaque\nreasons) this is not considered a breaking change.", "committedDate": "2020-07-17T08:37:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMwNjE3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/59755#discussion_r456306179", "bodyText": "Unrelated unused method", "author": "DaveCTurner", "createdAt": "2020-07-17T08:43:36Z", "path": "server/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java", "diffHunk": "@@ -119,19 +120,6 @@ private long addLong(long current, long other) {\n             return current + other;\n         }\n \n-        private double addDouble(double current, double other) {", "originalCommit": "c2159ccd4a07485994549b363edb76701338c00a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjMwNjQ0OA==", "url": "https://github.com/elastic/elasticsearch/pull/59755#discussion_r456306448", "bodyText": "Unrelated but logger was always the static field so no need to pass it in.", "author": "DaveCTurner", "createdAt": "2020-07-17T08:44:09Z", "path": "server/src/main/java/org/elasticsearch/monitor/fs/FsService.java", "diffHunk": "@@ -49,23 +44,22 @@\n             TimeValue.timeValueSeconds(1),\n             Property.NodeScope);\n \n-    public FsService(final Settings settings, final NodeEnvironment nodeEnvironment, ClusterInfoService clusterInfoService) {\n+    public FsService(final Settings settings, final NodeEnvironment nodeEnvironment) {\n         this.probe = new FsProbe(nodeEnvironment);\n-        this.clusterInfoService = clusterInfoService;\n-        refreshInterval = REFRESH_INTERVAL_SETTING.get(settings);\n+        final TimeValue refreshInterval = REFRESH_INTERVAL_SETTING.get(settings);\n         logger.debug(\"using refresh_interval [{}]\", refreshInterval);\n-        cache = new FsInfoCache(refreshInterval, stats(probe, null, logger, null));\n+        cache = new FsInfoCache(refreshInterval, stats(probe, null));\n     }\n \n     public FsInfo stats() {\n         return cache.getOrRefresh();\n     }\n \n-    private static FsInfo stats(FsProbe probe, FsInfo initialValue, Logger logger, @Nullable ClusterInfo clusterInfo) {", "originalCommit": "c2159ccd4a07485994549b363edb76701338c00a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb1ac4bcf842b708c47ad1118f14b63275a5a1ea", "url": "https://github.com/elastic/elasticsearch/commit/eb1ac4bcf842b708c47ad1118f14b63275a5a1ea", "message": "Merge branch 'master' into 2020-07-17-remove-path-estimates-from-fs-stats", "committedDate": "2020-07-17T09:13:49Z", "type": "commit"}]}