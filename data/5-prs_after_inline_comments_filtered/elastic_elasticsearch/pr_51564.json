{"pr_number": 51564, "pr_title": "Add autoscaling API skelton", "pr_createdAt": "2020-01-28T20:32:18Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51564", "timeline": [{"oid": "85e351a030f038edb66d6c4040566a930476e54e", "url": "https://github.com/elastic/elasticsearch/commit/85e351a030f038edb66d6c4040566a930476e54e", "message": "Add autoscaling API skelton\n\nThe main purpose of this commit is to add a single autoscaling REST\nendpoint skeleton, for the purpose of starting to build out the build\nand testing infrastructure that will surround it. For example, rather\nthan commiting a fully-functioning autoscaling API, we introduce here\nthe skeleton so that we can start wiring up the build and testing\ninfrastructure, establish security roles/permissions, an so on. This\nway, in a forthcoming PR that introduces actual functionality, that PR\nwill be smaller and have less distractions around that sort of\ninfrastructure.", "committedDate": "2020-01-28T20:30:36Z", "type": "commit"}, {"oid": "c64955e9aeaee05f4a9170201a0626dc013a7c7d", "url": "https://github.com/elastic/elasticsearch/commit/c64955e9aeaee05f4a9170201a0626dc013a7c7d", "message": "Fix privilege tests", "committedDate": "2020-01-28T23:00:09Z", "type": "commit"}, {"oid": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "url": "https://github.com/elastic/elasticsearch/commit/2ee28d8ca1b11961675aa255cb1a1d317d47672a", "message": "Fix docs", "committedDate": "2020-01-28T23:03:09Z", "type": "commit"}, {"oid": "5dc8917f85f950b485dceac63640512c29b1dcb0", "url": "https://github.com/elastic/elasticsearch/commit/5dc8917f85f950b485dceac63640512c29b1dcb0", "message": "g1;95;0Merge branch 'master' of github.com:elastic/elasticsearch into autoscaling-decision-api-skeleton", "committedDate": "2020-01-28T23:38:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyMjc5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372222796", "bodyText": "This is probably fine, only wanted to be sure we want xpack in the name. Seems most xpack components have that, except ilm, slm and transform, so I am guessing yes?", "author": "henningandersen", "createdAt": "2020-01-29T07:21:38Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/GetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+\n+public class GetAutoscalingDecisionAction extends ActionType<GetAutoscalingDecisionAction.Response> {\n+\n+    public static final GetAutoscalingDecisionAction INSTANCE = new GetAutoscalingDecisionAction();\n+    public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjEwNDkzNA==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r376104934", "bodyText": "I'm good leaving it out. I pushed 0db163a.", "author": "jasontedor", "createdAt": "2020-02-06T21:57:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyMjc5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyMzUwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372223501", "bodyText": "I would opt to remove the second autoscaling in the name, i.e., just:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";\n          \n          \n            \n                public static final String NAME = \"cluster:admin/xpack/autoscaling/get_decision\";", "author": "henningandersen", "createdAt": "2020-01-29T07:24:25Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/GetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+\n+public class GetAutoscalingDecisionAction extends ActionType<GetAutoscalingDecisionAction.Response> {\n+\n+    public static final GetAutoscalingDecisionAction INSTANCE = new GetAutoscalingDecisionAction();\n+    public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyNTMzNw==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372225337", "bodyText": "nit: whitespace", "author": "henningandersen", "createdAt": "2020-01-29T07:30:54Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/GetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+\n+public class GetAutoscalingDecisionAction extends ActionType<GetAutoscalingDecisionAction.Response> {\n+\n+    public static final GetAutoscalingDecisionAction INSTANCE = new GetAutoscalingDecisionAction();\n+    public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";\n+\n+    private GetAutoscalingDecisionAction() {\n+        super(NAME, Response::new);\n+    }\n+\n+    public static class Request extends AcknowledgedRequest<GetAutoscalingDecisionAction.Request> implements ToXContentObject {\n+\n+        public Request() {\n+\n+        }\n+\n+        public Request(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) throws IOException {\n+            super.writeTo(out);\n+        }\n+\n+        @Override\n+        public ActionRequestValidationException validate() {\n+            return null;\n+        }\n+\n+        @Override\n+        public XContentBuilder toXContent(final XContentBuilder builder, final Params params) throws IOException {\n+            builder.startObject();\n+            {\n+\n+            }\n+            builder.endObject();\n+            return builder;\n+        }\n+\n+    }\n+\n+    public static class Response extends ActionResponse implements ToXContentObject {\n+\n+        public Response() {\n+\n+        }\n+\n+        public Response(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) {\n+", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyNTM4OQ==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372225389", "bodyText": "nit: whitespace", "author": "henningandersen", "createdAt": "2020-01-29T07:31:07Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/GetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+\n+public class GetAutoscalingDecisionAction extends ActionType<GetAutoscalingDecisionAction.Response> {\n+\n+    public static final GetAutoscalingDecisionAction INSTANCE = new GetAutoscalingDecisionAction();\n+    public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";\n+\n+    private GetAutoscalingDecisionAction() {\n+        super(NAME, Response::new);\n+    }\n+\n+    public static class Request extends AcknowledgedRequest<GetAutoscalingDecisionAction.Request> implements ToXContentObject {\n+\n+        public Request() {\n+\n+        }\n+\n+        public Request(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) throws IOException {\n+            super.writeTo(out);\n+        }\n+\n+        @Override\n+        public ActionRequestValidationException validate() {\n+            return null;\n+        }\n+\n+        @Override\n+        public XContentBuilder toXContent(final XContentBuilder builder, final Params params) throws IOException {\n+            builder.startObject();\n+            {\n+\n+            }\n+            builder.endObject();\n+            return builder;\n+        }\n+\n+    }\n+\n+    public static class Response extends ActionResponse implements ToXContentObject {\n+\n+        public Response() {\n+", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyNTQ0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372225441", "bodyText": "nit: whitespace", "author": "henningandersen", "createdAt": "2020-01-29T07:31:17Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/GetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+\n+public class GetAutoscalingDecisionAction extends ActionType<GetAutoscalingDecisionAction.Response> {\n+\n+    public static final GetAutoscalingDecisionAction INSTANCE = new GetAutoscalingDecisionAction();\n+    public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";\n+\n+    private GetAutoscalingDecisionAction() {\n+        super(NAME, Response::new);\n+    }\n+\n+    public static class Request extends AcknowledgedRequest<GetAutoscalingDecisionAction.Request> implements ToXContentObject {\n+\n+        public Request() {\n+\n+        }\n+\n+        public Request(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) throws IOException {\n+            super.writeTo(out);\n+        }\n+\n+        @Override\n+        public ActionRequestValidationException validate() {\n+            return null;\n+        }\n+\n+        @Override\n+        public XContentBuilder toXContent(final XContentBuilder builder, final Params params) throws IOException {\n+            builder.startObject();\n+            {\n+\n+            }\n+            builder.endObject();\n+            return builder;\n+        }\n+\n+    }\n+\n+    public static class Response extends ActionResponse implements ToXContentObject {\n+\n+        public Response() {\n+\n+        }\n+\n+        public Response(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) {\n+\n+        }\n+\n+        @Override\n+        public XContentBuilder toXContent(final XContentBuilder builder, final Params params) throws IOException {\n+            builder.startObject();\n+            {\n+\n+            }\n+            builder.endObject();\n+            return builder;\n+        }\n+\n+    }\n+", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyNTUwOA==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372225508", "bodyText": "nit: whitespace", "author": "henningandersen", "createdAt": "2020-01-29T07:31:37Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/GetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,88 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionRequestValidationException;\n+import org.elasticsearch.action.ActionResponse;\n+import org.elasticsearch.action.ActionType;\n+import org.elasticsearch.action.support.master.AcknowledgedRequest;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.common.io.stream.StreamOutput;\n+import org.elasticsearch.common.xcontent.ToXContentObject;\n+import org.elasticsearch.common.xcontent.XContentBuilder;\n+\n+import java.io.IOException;\n+\n+public class GetAutoscalingDecisionAction extends ActionType<GetAutoscalingDecisionAction.Response> {\n+\n+    public static final GetAutoscalingDecisionAction INSTANCE = new GetAutoscalingDecisionAction();\n+    public static final String NAME = \"cluster:admin/xpack/autoscaling/get_autoscaling_decision\";\n+\n+    private GetAutoscalingDecisionAction() {\n+        super(NAME, Response::new);\n+    }\n+\n+    public static class Request extends AcknowledgedRequest<GetAutoscalingDecisionAction.Request> implements ToXContentObject {\n+\n+        public Request() {\n+\n+        }\n+\n+        public Request(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) throws IOException {\n+            super.writeTo(out);\n+        }\n+\n+        @Override\n+        public ActionRequestValidationException validate() {\n+            return null;\n+        }\n+\n+        @Override\n+        public XContentBuilder toXContent(final XContentBuilder builder, final Params params) throws IOException {\n+            builder.startObject();\n+            {\n+\n+            }\n+            builder.endObject();\n+            return builder;\n+        }\n+\n+    }\n+\n+    public static class Response extends ActionResponse implements ToXContentObject {\n+\n+        public Response() {\n+\n+        }\n+\n+        public Response(final StreamInput in) throws IOException {\n+            super(in);\n+        }\n+\n+        @Override\n+        public void writeTo(final StreamOutput out) {\n+\n+        }\n+\n+        @Override\n+        public XContentBuilder toXContent(final XContentBuilder builder, final Params params) throws IOException {\n+            builder.startObject();\n+            {\n+\n+            }\n+            builder.endObject();\n+            return builder;\n+        }\n+", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MjIyNTU4Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51564#discussion_r372225586", "bodyText": "nit: whitespace", "author": "henningandersen", "createdAt": "2020-01-29T07:31:54Z", "path": "x-pack/plugin/autoscaling/src/main/java/org/elasticsearch/xpack/autoscaling/action/TransportGetAutoscalingDecisionAction.java", "diffHunk": "@@ -0,0 +1,72 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.autoscaling.action;\n+\n+import org.elasticsearch.action.ActionListener;\n+import org.elasticsearch.action.support.ActionFilters;\n+import org.elasticsearch.action.support.master.TransportMasterNodeAction;\n+import org.elasticsearch.cluster.ClusterState;\n+import org.elasticsearch.cluster.block.ClusterBlockException;\n+import org.elasticsearch.cluster.metadata.IndexNameExpressionResolver;\n+import org.elasticsearch.cluster.service.ClusterService;\n+import org.elasticsearch.common.inject.Inject;\n+import org.elasticsearch.common.io.stream.StreamInput;\n+import org.elasticsearch.tasks.Task;\n+import org.elasticsearch.threadpool.ThreadPool;\n+import org.elasticsearch.transport.TransportService;\n+\n+import java.io.IOException;\n+\n+public class TransportGetAutoscalingDecisionAction extends TransportMasterNodeAction<\n+    GetAutoscalingDecisionAction.Request,\n+    GetAutoscalingDecisionAction.Response> {\n+\n+    @Inject\n+    public TransportGetAutoscalingDecisionAction(\n+        final TransportService transportService,\n+        final ClusterService clusterService,\n+        final ThreadPool threadPool,\n+        final ActionFilters actionFilters,\n+        final IndexNameExpressionResolver indexNameExpressionResolver\n+    ) {\n+        super(\n+            GetAutoscalingDecisionAction.NAME,\n+            transportService,\n+            clusterService,\n+            threadPool,\n+            actionFilters,\n+            GetAutoscalingDecisionAction.Request::new,\n+            indexNameExpressionResolver\n+        );\n+    }\n+\n+    @Override\n+    protected String executor() {\n+        return ThreadPool.Names.SAME;\n+    }\n+\n+    @Override\n+    protected GetAutoscalingDecisionAction.Response read(final StreamInput in) throws IOException {\n+        return new GetAutoscalingDecisionAction.Response(in);\n+    }\n+\n+    @Override\n+    protected void masterOperation(\n+        final Task task,\n+        final GetAutoscalingDecisionAction.Request request,\n+        final ClusterState state,\n+        final ActionListener<GetAutoscalingDecisionAction.Response> listener\n+    ) {\n+        listener.onResponse(new GetAutoscalingDecisionAction.Response());\n+    }\n+\n+    @Override\n+    protected ClusterBlockException checkBlock(final GetAutoscalingDecisionAction.Request request, final ClusterState state) {\n+        return null;\n+    }\n+", "originalCommit": "2ee28d8ca1b11961675aa255cb1a1d317d47672a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "842a21f09076c7c00a4916294d23b751766ff4dd", "url": "https://github.com/elastic/elasticsearch/commit/842a21f09076c7c00a4916294d23b751766ff4dd", "message": "Merge branch 'master' into autoscaling-decision-api-skeleton", "committedDate": "2020-02-06T21:55:31Z", "type": "commit"}, {"oid": "0db163aee3bf5192bd9e786e3a1116b30bcf2b3b", "url": "https://github.com/elastic/elasticsearch/commit/0db163aee3bf5192bd9e786e3a1116b30bcf2b3b", "message": "Simplify action name", "committedDate": "2020-02-06T21:57:09Z", "type": "commit"}, {"oid": "aecb0336a49d4ef49e19904b517a841ef56260ca", "url": "https://github.com/elastic/elasticsearch/commit/aecb0336a49d4ef49e19904b517a841ef56260ca", "message": "Remove accidental inclusion", "committedDate": "2020-02-06T23:20:39Z", "type": "commit"}]}