{"pr_number": 53458, "pr_title": "Make classification evaluation metrics work when there is field mapping type mismatch", "pr_createdAt": "2020-03-12T09:10:48Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53458", "timeline": [{"oid": "b75cbbef35769ff57cff6a82a95c803053cd4fe2", "url": "https://github.com/elastic/elasticsearch/commit/b75cbbef35769ff57cff6a82a95c803053cd4fe2", "message": "Make accuracy evaluation metric work when there is field mapping type mismatch", "committedDate": "2020-03-12T14:23:30Z", "type": "forcePushed"}, {"oid": "b05927cbd61318a84ec2077e1bad0088920074b7", "url": "https://github.com/elastic/elasticsearch/commit/b05927cbd61318a84ec2077e1bad0088920074b7", "message": "Make accuracy evaluation metric work when there is field mapping type mismatch", "committedDate": "2020-03-12T14:31:49Z", "type": "forcePushed"}, {"oid": "8e66ea305ca4e7d0dfc5072cec80fc814e7b37aa", "url": "https://github.com/elastic/elasticsearch/commit/8e66ea305ca4e7d0dfc5072cec80fc814e7b37aa", "message": "Make accuracy evaluation metric work when there is field mapping type mismatch", "committedDate": "2020-03-16T08:46:57Z", "type": "commit"}, {"oid": "8e66ea305ca4e7d0dfc5072cec80fc814e7b37aa", "url": "https://github.com/elastic/elasticsearch/commit/8e66ea305ca4e7d0dfc5072cec80fc814e7b37aa", "message": "Make accuracy evaluation metric work when there is field mapping type mismatch", "committedDate": "2020-03-16T08:46:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1NTIxNg==", "url": "https://github.com/elastic/elasticsearch/pull/53458#discussion_r392955216", "bodyText": "I think buildIsEqualScript or something makes more sense. We are verifying the two fields are equal, not just comparing them. Comparing could also mean gt, or gte which we are not doing.", "author": "benwtrent", "createdAt": "2020-03-16T11:37:35Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/dataframe/evaluation/classification/PainlessScripts.java", "diffHunk": "@@ -0,0 +1,34 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+package org.elasticsearch.xpack.core.ml.dataframe.evaluation.classification;\n+\n+import org.elasticsearch.script.Script;\n+\n+import java.text.MessageFormat;\n+import java.util.Locale;\n+\n+/**\n+ * Painless scripts used by classification metrics in this package.\n+ */\n+final class PainlessScripts {\n+\n+    /**\n+     * Template for the comparison script.\n+     * It uses \"String.valueOf\" method in case the mapping types of the two fields are different.\n+     */\n+    private static final MessageFormat COMPARISON_SCRIPT_TEMPLATE =\n+        new MessageFormat(\"String.valueOf(doc[''{0}''].value).equals(String.valueOf(doc[''{1}''].value))\", Locale.ROOT);\n+\n+    /**\n+     * Builds field comparison script for the given actual and predicted field names.\n+     * @param actualField name of the actual field\n+     * @param predictedField name of the predicted field\n+     * @return script that compares values of actualField and predictedField\n+     */\n+    static Script buildComparisonScript(String actualField, String predictedField) {", "originalCommit": "8e66ea305ca4e7d0dfc5072cec80fc814e7b37aa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1NjY3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/53458#discussion_r392956673", "bodyText": "Good suggestion!\nDone.", "author": "przemekwitek", "createdAt": "2020-03-16T11:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mjk1NTIxNg=="}], "type": "inlineReview"}, {"oid": "0c4b06f47830ecd109f5952d8c95a122aeb99c54", "url": "https://github.com/elastic/elasticsearch/commit/0c4b06f47830ecd109f5952d8c95a122aeb99c54", "message": "Apply review comments and add unit test", "committedDate": "2020-03-16T11:49:14Z", "type": "commit"}]}