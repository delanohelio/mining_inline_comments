{"pr_number": 53882, "pr_title": "Add pre-configured \u201clowercase\u201d normalizer", "pr_createdAt": "2020-03-20T15:57:23Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53882", "timeline": [{"oid": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "url": "https://github.com/elastic/elasticsearch/commit/562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "message": "Doc changes to reference new lowercase normalizer.", "committedDate": "2020-03-20T17:40:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjY4NDcwNA==", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r396684704", "bodyText": "Small note, this could just be TokenStream stream = new LowerCaseFilter(tokenizer);.", "author": "jtibshirani", "createdAt": "2020-03-23T18:56:21Z", "path": "server/src/main/java/org/elasticsearch/index/analysis/LowercaseNormalizer.java", "diffHunk": "@@ -0,0 +1,43 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.analysis;\n+\n+import org.apache.lucene.analysis.Analyzer;\n+import org.apache.lucene.analysis.LowerCaseFilter;\n+import org.apache.lucene.analysis.TokenStream;\n+import org.apache.lucene.analysis.Tokenizer;\n+import org.apache.lucene.analysis.core.KeywordTokenizer;\n+\n+/** Normalizer used to lowercase values */\n+public final class LowercaseNormalizer extends Analyzer {\n+\n+    @Override\n+    protected TokenStreamComponents createComponents(String s) {\n+        final Tokenizer tokenizer = new KeywordTokenizer();\n+        TokenStream stream = tokenizer;", "originalCommit": "562a7301dfff96eb610ae87afc3cb61d0a2f56ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "93c96725da3757a64ebe3b5641c156b51c6ffefc", "url": "https://github.com/elastic/elasticsearch/commit/93c96725da3757a64ebe3b5641c156b51c6ffefc", "message": "Address review comments - typo and test for new in-built normalizer", "committedDate": "2020-03-30T10:27:09Z", "type": "forcePushed"}, {"oid": "814155567fc31749cd100a63ddf332516ed29012", "url": "https://github.com/elastic/elasticsearch/commit/814155567fc31749cd100a63ddf332516ed29012", "message": "Address review comments - typo and test for new in-built normalizer", "committedDate": "2020-03-30T11:10:24Z", "type": "forcePushed"}, {"oid": "37a3d022c629f8f0dce9e8369ccb3734d7ab1572", "url": "https://github.com/elastic/elasticsearch/commit/37a3d022c629f8f0dce9e8369ccb3734d7ab1572", "message": "Address review comments - typo and test for new in-built normalizer", "committedDate": "2020-03-30T12:45:07Z", "type": "forcePushed"}, {"oid": "9f07520ac69c824ae9acf844804e595d6e5f1cf0", "url": "https://github.com/elastic/elasticsearch/commit/9f07520ac69c824ae9acf844804e595d6e5f1cf0", "message": "Address review comments - typo and test for new in-built normalizer", "committedDate": "2020-03-30T13:48:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTIwMjEzMg==", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r401202132", "bodyText": "I think it'd make sense for this check to live in AnalysisRegistryTests, because it is really testing our analyzer registration behavior instead of anything specific to the keyword field mapper. I took a look and it seems straightforward to add a test there.", "author": "jtibshirani", "createdAt": "2020-03-31T20:41:57Z", "path": "server/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java", "diffHunk": "@@ -381,6 +391,54 @@ public void testNormalizer() throws IOException {\n         assertThat(fieldType.indexOptions(), equalTo(IndexOptions.NONE));\n         assertEquals(DocValuesType.SORTED_SET, fieldType.docValuesType());\n     }\n+    \n+    // Test that a name clash with a custom normalizer will favour the index's normalizer rather than the out-of-the-box \n+    // one of the same name. (However this \"feature\" will be removed with https://github.com/elastic/elasticsearch/issues/22263 ) \n+    public void testNameClashNormalizer() throws IOException {", "originalCommit": "835b1f95b484b6be065f25b4c8112f8573e55c37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7125f23fb46b061f1d4c8a7fb599651d2a6df184", "url": "https://github.com/elastic/elasticsearch/commit/7125f23fb46b061f1d4c8a7fb599651d2a6df184", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests", "committedDate": "2020-04-01T12:34:32Z", "type": "forcePushed"}, {"oid": "de9f454587829667639bf0557a59bc22410844b4", "url": "https://github.com/elastic/elasticsearch/commit/de9f454587829667639bf0557a59bc22410844b4", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests", "committedDate": "2020-04-01T14:09:57Z", "type": "forcePushed"}, {"oid": "5387a514debd5455ac15772d13d28564ce38a54e", "url": "https://github.com/elastic/elasticsearch/commit/5387a514debd5455ac15772d13d28564ce38a54e", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests", "committedDate": "2020-04-01T15:35:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTcxNTEzOA==", "url": "https://github.com/elastic/elasticsearch/pull/53882#discussion_r401715138", "bodyText": "Super small comment, extra whitespace.", "author": "jtibshirani", "createdAt": "2020-04-01T15:42:28Z", "path": "server/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java", "diffHunk": "@@ -381,7 +389,7 @@ public void testNormalizer() throws IOException {\n         assertThat(fieldType.indexOptions(), equalTo(IndexOptions.NONE));\n         assertEquals(DocValuesType.SORTED_SET, fieldType.docValuesType());\n     }\n-\n+    ", "originalCommit": "5387a514debd5455ac15772d13d28564ce38a54e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5a411ee699be3491cf73169a9d17bfe83b068de2", "url": "https://github.com/elastic/elasticsearch/commit/5a411ee699be3491cf73169a9d17bfe83b068de2", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests", "committedDate": "2020-04-01T16:18:36Z", "type": "forcePushed"}, {"oid": "e8e7f83ed4a4a052743ac0ce697629179b780841", "url": "https://github.com/elastic/elasticsearch/commit/e8e7f83ed4a4a052743ac0ce697629179b780841", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x", "committedDate": "2020-04-02T16:21:45Z", "type": "forcePushed"}, {"oid": "56731ca2d89ee3dcd3821a11908bc70a788c54e9", "url": "https://github.com/elastic/elasticsearch/commit/56731ca2d89ee3dcd3821a11908bc70a788c54e9", "message": "Add pre-configured \u201clowercase\u201d normalizer\n\nCloses #53872", "committedDate": "2020-04-03T08:06:49Z", "type": "commit"}, {"oid": "67da5d4fdcfacfb2d860b0047e62f4a71c3cff99", "url": "https://github.com/elastic/elasticsearch/commit/67da5d4fdcfacfb2d860b0047e62f4a71c3cff99", "message": "Doc changes to reference new lowercase normalizer.", "committedDate": "2020-04-03T08:06:49Z", "type": "commit"}, {"oid": "cb86000148b2d74efced59c8575aaddb588a9930", "url": "https://github.com/elastic/elasticsearch/commit/cb86000148b2d74efced59c8575aaddb588a9930", "message": "Address review comments - typo and test for new in-built normalizer", "committedDate": "2020-04-03T08:06:49Z", "type": "commit"}, {"oid": "b58b2b7d36e9a0ec776a8d46265c03d91021760c", "url": "https://github.com/elastic/elasticsearch/commit/b58b2b7d36e9a0ec776a8d46265c03d91021760c", "message": "Added name-clash test for normalizer, migration change and removed superfluous TODO.", "committedDate": "2020-04-03T08:06:49Z", "type": "commit"}, {"oid": "e4962a7d42eef5f9d5b03c461342a12b7557f714", "url": "https://github.com/elastic/elasticsearch/commit/e4962a7d42eef5f9d5b03c461342a12b7557f714", "message": "Shifted name-clash test logic from KeywordFieldMapperTests to AnalysisRegistryTests", "committedDate": "2020-04-03T08:06:49Z", "type": "commit"}, {"oid": "a6d319b29a53801315785060d90a74b88d767aef", "url": "https://github.com/elastic/elasticsearch/commit/a6d319b29a53801315785060d90a74b88d767aef", "message": "Whitespace fix", "committedDate": "2020-04-03T08:06:49Z", "type": "commit"}, {"oid": "88f5f72b766f78073ac49b8fb5928112b8f523c9", "url": "https://github.com/elastic/elasticsearch/commit/88f5f72b766f78073ac49b8fb5928112b8f523c9", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x", "committedDate": "2020-04-03T08:06:50Z", "type": "commit"}, {"oid": "88f5f72b766f78073ac49b8fb5928112b8f523c9", "url": "https://github.com/elastic/elasticsearch/commit/88f5f72b766f78073ac49b8fb5928112b8f523c9", "message": "Reverse this comment now that we\u2019re introducing lowercase normalizer first in 7x", "committedDate": "2020-04-03T08:06:50Z", "type": "forcePushed"}]}