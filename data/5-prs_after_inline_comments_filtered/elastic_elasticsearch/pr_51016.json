{"pr_number": 51016, "pr_title": "Fix AllocateRoutedStepTests reusing keys for random values", "pr_createdAt": "2020-01-15T00:09:13Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51016", "timeline": [{"oid": "3f1955b7bc81d22905f7d67d97f2ba48f97ed517", "url": "https://github.com/elastic/elasticsearch/commit/3f1955b7bc81d22905f7d67d97f2ba48f97ed517", "message": "Fix AllocateRoutedStepTests reusing keys for random values\n\nIn these tests there was a very small chance that keys could collide,\nwhich causes test failures.\n\nResolves #49307", "committedDate": "2020-01-15T00:07:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxMjY5Mg==", "url": "https://github.com/elastic/elasticsearch/pull/51016#discussion_r366812692", "bodyText": "what's the reason behind this change?", "author": "andreidan", "createdAt": "2020-01-15T10:54:12Z", "path": "x-pack/plugin/core/src/test/java/org/elasticsearch/xpack/core/ilm/AllocateActionTests.java", "diffHunk": "@@ -114,7 +114,7 @@ public void testInvalidNumberOfReplicas() {\n         Map<String, String> map = new HashMap<>();\n         int numIncludes = randomIntBetween(minEntries, maxEntries);\n         for (int i = 0; i < numIncludes; i++) {\n-            map.put(randomAlphaOfLengthBetween(1, 20), randomAlphaOfLengthBetween(1, 20));\n+            map.put(randomAlphaOfLengthBetween(2, 20), randomAlphaOfLengthBetween(2, 20));", "originalCommit": "3f1955b7bc81d22905f7d67d97f2ba48f97ed517", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Njk2Mzk0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/51016#discussion_r366963945", "bodyText": "So the test that actually caused the failure generated n as the key in the map, by increasing it to at least 2, we decrease the chance of collisions. The other changes make sure we don't have collisions, but this at least decreases the amount of retries since it's less likely to collide.", "author": "dakrone", "createdAt": "2020-01-15T16:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjgxMjY5Mg=="}], "type": "inlineReview"}, {"oid": "f0d7cf4a8efac1fe0cc263f1b257b3834f92b2f2", "url": "https://github.com/elastic/elasticsearch/commit/f0d7cf4a8efac1fe0cc263f1b257b3834f92b2f2", "message": "Merge remote-tracking branch 'origin/master' into fix-allocate-action-tests-49307", "committedDate": "2020-01-15T16:52:37Z", "type": "commit"}]}