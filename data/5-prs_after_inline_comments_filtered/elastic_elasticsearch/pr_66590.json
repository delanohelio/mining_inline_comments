{"pr_number": 66590, "pr_title": "Ensure we verify versioned dir for es bwc builds", "pr_createdAt": "2020-12-18T12:52:59Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66590", "timeline": [{"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "url": "https://github.com/elastic/elasticsearch/commit/dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "message": "Ensure we verify versioned dir for es bwc builds", "committedDate": "2020-12-18T17:30:56Z", "type": "commit"}, {"oid": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "url": "https://github.com/elastic/elasticsearch/commit/dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "message": "Ensure we verify versioned dir for es bwc builds", "committedDate": "2020-12-18T17:30:56Z", "type": "forcePushed"}, {"oid": "18c2297b87f06da4b23a70fd178aaa1f635a29e3", "url": "https://github.com/elastic/elasticsearch/commit/18c2297b87f06da4b23a70fd178aaa1f635a29e3", "message": "Fix checking versioned folder", "committedDate": "2020-12-18T19:20:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzMwNg==", "url": "https://github.com/elastic/elasticsearch/pull/66590#discussion_r546053306", "bodyText": "We need to include the distribution type in the path as well (i.e. -oss for the OSS distro). That's what's causing these errors:\nCaused by: java.nio.file.NoSuchFileException: /dev/shm/elastic+elasticsearch+pull-request-bwc/distribution/bwc/minor/build/bwc/checkout-7.x/distribution/archives/oss-linux-tar/build/install/elasticsearch-7.12.0-SNAPSHOT/plugins/config", "author": "mark-vieira", "createdAt": "2020-12-18T19:39:42Z", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/internal/InternalDistributionBwcSetupPlugin.java", "diffHunk": "@@ -279,7 +279,9 @@ static void createBuildBwcTask(\n                         + \".\"\n                         + extension\n                 ),\n-                expandedDistDirSupport ? new File(checkoutDir, baseDir + \"/\" + name + \"/build/install/\") : null\n+                expandedDistDirSupport\n+                    ? new File(checkoutDir, baseDir + \"/\" + name + \"/build/install/elasticsearch-\" + version + \"-SNAPSHOT\")", "originalCommit": "dee3e0ac3e6b376b25f8c239c83ddaa96a2581e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzYyOA==", "url": "https://github.com/elastic/elasticsearch/pull/66590#discussion_r546053628", "bodyText": "And posibly architecture too? Essentially, we need to use the same logic for building that dir name as we do for the file name as I \"think\" we add all those qualifiers there as well.", "author": "mark-vieira", "createdAt": "2020-12-18T19:40:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzMwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA5OTQyMw==", "url": "https://github.com/elastic/elasticsearch/pull/66590#discussion_r546099423", "bodyText": "I fixed the issue with the file not found above. The problem was not with the folder name but with the right declaration of the target install root which is still \"build/install\". The distro base folder name doesn't contain oss or anything arch specific as far as I see.", "author": "breskeby", "createdAt": "2020-12-18T21:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NjA1MzMwNg=="}], "type": "inlineReview"}, {"oid": "48168357b5d6e77c16456cdefba4b160fba3ffb0", "url": "https://github.com/elastic/elasticsearch/commit/48168357b5d6e77c16456cdefba4b160fba3ffb0", "message": "Make spotless happy", "committedDate": "2020-12-18T19:59:23Z", "type": "commit"}, {"oid": "863cadad7868d2aad0a23f773ea6df53433c4117", "url": "https://github.com/elastic/elasticsearch/commit/863cadad7868d2aad0a23f773ea6df53433c4117", "message": "Update integ test", "committedDate": "2020-12-18T22:09:07Z", "type": "commit"}]}