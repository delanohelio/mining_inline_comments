{"pr_number": 64727, "pr_title": "[ML] Fix bug with data frame analytics classification test data sampling when using custom feature processors", "pr_createdAt": "2020-11-06T15:31:12Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64727", "timeline": [{"oid": "247ce03f3824857cf9ea464f8821404526c8e82a", "url": "https://github.com/elastic/elasticsearch/commit/247ce03f3824857cf9ea464f8821404526c8e82a", "message": "[ML] Fix bug with data frame analytics classification test data sampling when using custom feature processors", "committedDate": "2020-11-06T15:23:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzODY5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/64727#discussion_r518838697", "bodyText": "I wonder if it would make sense for this and extractProcessedFeatureNames to become member methods of ExtractedFields and get them unit tested too.", "author": "dimitris-athanasiou", "createdAt": "2020-11-06T15:49:12Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/dataframe/extractor/DataFrameDataExtractorFactory.java", "diffHunk": "@@ -94,8 +97,30 @@ public static DataFrameDataExtractorFactory createForSourceIndices(Client client\n \n     private static TrainTestSplitterFactory createTrainTestSplitterFactory(Client client, DataFrameAnalyticsConfig config,\n                                                                            ExtractedFields extractedFields) {\n-        return new TrainTestSplitterFactory(client, config,\n-            extractedFields.getAllFields().stream().map(ExtractedField::getName).collect(Collectors.toList()));\n+        return new TrainTestSplitterFactory(\n+            client,\n+            config,\n+            Stream.concat(Arrays.stream(\n+                extractOrganicFeatureNames(extractedFields)),\n+                Arrays.stream(extractProcessedFeatureNames(extractedFields))\n+            ).collect(Collectors.toList()));\n+    }\n+\n+    static String[] extractOrganicFeatureNames(ExtractedFields extractedFields) {", "originalCommit": "247ce03f3824857cf9ea464f8821404526c8e82a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk3MTkxMw==", "url": "https://github.com/elastic/elasticsearch/pull/64727#discussion_r519971913", "bodyText": "Yeah, member methods make sense as they only touch internal data", "author": "benwtrent", "createdAt": "2020-11-09T17:02:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODgzODY5Nw=="}], "type": "inlineReview"}, {"oid": "f4e5d52a47b71e35fa952775e7f162ba0b40fce5", "url": "https://github.com/elastic/elasticsearch/commit/f4e5d52a47b71e35fa952775e7f162ba0b40fce5", "message": "Merge branch 'master' into bugfix/ml-dfa-custom-proc-sampling", "committedDate": "2020-11-06T15:51:08Z", "type": "commit"}, {"oid": "a0f3f4f982ef50bbbc68e03a238a04d128c2b917", "url": "https://github.com/elastic/elasticsearch/commit/a0f3f4f982ef50bbbc68e03a238a04d128c2b917", "message": "Merge remote-tracking branch 'upstream/master' into bugfix/ml-dfa-custom-proc-sampling", "committedDate": "2020-11-06T16:26:37Z", "type": "commit"}, {"oid": "badccc2bcfd2b4b1414bd9175a3d546fe70be9de", "url": "https://github.com/elastic/elasticsearch/commit/badccc2bcfd2b4b1414bd9175a3d546fe70be9de", "message": "addressing PR comments", "committedDate": "2020-11-09T18:13:18Z", "type": "commit"}, {"oid": "b6e7f2a0ce928086e5ba83b08d28f56fc1df5645", "url": "https://github.com/elastic/elasticsearch/commit/b6e7f2a0ce928086e5ba83b08d28f56fc1df5645", "message": "Merge remote-tracking branch 'upstream/master' into bugfix/ml-dfa-custom-proc-sampling", "committedDate": "2020-11-09T18:13:35Z", "type": "commit"}, {"oid": "962ba254457feb03fd765a2e43de8954a942be4e", "url": "https://github.com/elastic/elasticsearch/commit/962ba254457feb03fd765a2e43de8954a942be4e", "message": "Merge branch 'bugfix/ml-dfa-custom-proc-sampling' of github.com:benwtrent/elasticsearch into bugfix/ml-dfa-custom-proc-sampling", "committedDate": "2020-11-09T18:13:48Z", "type": "commit"}]}