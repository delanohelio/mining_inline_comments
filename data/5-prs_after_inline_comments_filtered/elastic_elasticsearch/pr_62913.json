{"pr_number": 62913, "pr_title": "Avoid Redundantly Loading Monitoring Templates on CS Applier Thread", "pr_createdAt": "2020-09-25T19:13:46Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62913", "timeline": [{"oid": "96eecb1c2c00d2dfa883b508611b327ebef8f07b", "url": "https://github.com/elastic/elasticsearch/commit/96eecb1c2c00d2dfa883b508611b327ebef8f07b", "message": "Avoid Redundantly Loading Monitoring Templates on CS Applier Thread\n\nThis refactors the loading of monitoring templates slightly so that they aren't loaded over and\nover again (from disk) on CS updates. This isn't an important optimization in production for obvious\nreasons since it only affects the install stage, but this turned out to cause some slow CS applies\nin tests.\n\nRelates #62853", "committedDate": "2020-09-25T19:10:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTE4MzUyMQ==", "url": "https://github.com/elastic/elasticsearch/pull/62913#discussion_r495183521", "bodyText": "Non master doesn't need to load this in the first place, master only needs to load it once. The current code loads it on every CS update until monitoring templates are fully initialized. In x-pack ITs that spin up 6 nodes this can lead to slowness.", "author": "original-brownbear", "createdAt": "2020-09-25T19:14:46Z", "path": "x-pack/plugin/monitoring/src/main/java/org/elasticsearch/xpack/monitoring/exporter/local/LocalExporter.java", "diffHunk": "@@ -203,17 +202,13 @@ LocalBulk resolveBulk(ClusterState clusterState, boolean clusterStateChange) {\n             return null;\n         }\n \n-        // List of templates\n-        final Map<String, String> templates = Arrays.stream(MonitoringTemplateUtils.TEMPLATE_IDS)", "originalCommit": "96eecb1c2c00d2dfa883b508611b327ebef8f07b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}