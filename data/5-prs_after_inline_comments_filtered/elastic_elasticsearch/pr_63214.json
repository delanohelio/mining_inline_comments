{"pr_number": 63214, "pr_title": "Convert TypeFieldType to a constant field type", "pr_createdAt": "2020-10-03T08:41:10Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63214", "timeline": [{"oid": "5eae4d149f23efd7ce5c5caa219f3807139c7e8b", "url": "https://github.com/elastic/elasticsearch/commit/5eae4d149f23efd7ce5c5caa219f3807139c7e8b", "message": "Convert TypeFieldType to a constant field type", "committedDate": "2020-10-03T08:31:02Z", "type": "commit"}, {"oid": "9b2cd6ccf9675cd90d6a9a9671d9c83851084f21", "url": "https://github.com/elastic/elasticsearch/commit/9b2cd6ccf9675cd90d6a9a9671d9c83851084f21", "message": "imports", "committedDate": "2020-10-03T15:46:24Z", "type": "commit"}, {"oid": "8f83d602c1a2ead80a99b214b2ba721576bd9be4", "url": "https://github.com/elastic/elasticsearch/commit/8f83d602c1a2ead80a99b214b2ba721576bd9be4", "message": "checkstyle", "committedDate": "2020-10-05T08:50:39Z", "type": "commit"}, {"oid": "afdb478820a7f7840d5d35017cd0fd22a674c233", "url": "https://github.com/elastic/elasticsearch/commit/afdb478820a7f7840d5d35017cd0fd22a674c233", "message": "nested docs corner cases", "committedDate": "2020-10-05T17:41:25Z", "type": "commit"}, {"oid": "8fc59d7c4e2b258ae773d5592e3cbaf7cac67292", "url": "https://github.com/elastic/elasticsearch/commit/8fc59d7c4e2b258ae773d5592e3cbaf7cac67292", "message": "tests", "committedDate": "2020-10-06T07:53:28Z", "type": "commit"}, {"oid": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724", "url": "https://github.com/elastic/elasticsearch/commit/fb2f02aa033fc2ea8e7e992f1697ce9113aab724", "message": "Merge remote-tracking branch 'origin/7.x' into typefieldtype-7x", "committedDate": "2020-10-06T07:54:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500120747", "bodyText": "for my understanding: does this mean that the field type does not come back with the below field type lookup? Did it before?", "author": "javanna", "createdAt": "2020-10-06T09:05:41Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/MapperService.java", "diffHunk": "@@ -593,6 +593,11 @@ public DocumentMapperForType documentMapperWithAutoCreate(String type) {\n      * Given the full name of a field, returns its {@link MappedFieldType}.\n      */\n     public MappedFieldType fieldType(String fullName) {\n+        if (fullName.equals(TypeFieldMapper.NAME)) {\n+            String type = mapper == null ? null : mapper.type();\n+            return new TypeFieldMapper.TypeFieldType(type);\n+        }", "originalCommit": "fb2f02aa033fc2ea8e7e992f1697ce9113aab724", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMjA5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500122099", "bodyText": "It does come back with the lookup, but it may not have the correct type set on it (for example, if the index in question did not have any mappings set when the MapperService was originally built).  This way we know we always have the correct type.", "author": "romseygeek", "createdAt": "2020-10-06T09:07:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyNTAyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500125025", "bodyText": "ok, so could there be places where the type field mapper is retrieved in some way that could expose the wrong type then?", "author": "javanna", "createdAt": "2020-10-06T09:12:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyODY4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500128682", "bodyText": "From a quick review:\n\nthe only other way to access field types is via MapperService#documentMapper#fieldTypes() directly\nthis is exposed via MapperService#fieldTypes()\nMapperService#fieldTypes() is only called by the index warming code, and the type field does not use global ordinals so is unaffected\n\nSo I think we're safe.  We should probably remove MapperService#fieldTypes() at some point though, as it is indeed asking for trouble to expose this to the outside world.", "author": "romseygeek", "createdAt": "2020-10-06T09:18:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMTk2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500131969", "bodyText": "ok thanks for double checking", "author": "javanna", "createdAt": "2020-10-06T09:24:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMzk5MA==", "url": "https://github.com/elastic/elasticsearch/pull/63214#discussion_r500133990", "bodyText": "Thanks for keeping me honest :)", "author": "romseygeek", "createdAt": "2020-10-06T09:27:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyMDc0Nw=="}], "type": "inlineReview"}]}