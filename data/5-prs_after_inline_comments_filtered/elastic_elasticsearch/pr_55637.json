{"pr_number": 55637, "pr_title": "Test: fix SSLReloadDuringStartupIntegTests", "pr_createdAt": "2020-04-23T02:28:51Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/55637", "timeline": [{"oid": "0e60f5c75cd1c4b90d210d9b0b77d232af963f0c", "url": "https://github.com/elastic/elasticsearch/commit/0e60f5c75cd1c4b90d210d9b0b77d232af963f0c", "message": "Test: fix SSLReloadDuringStartupIntegTests\n\nThis commit fixes reproducible test failures with the\nSSLReloadDuringStartupIntegTests on the 7.x branch. The failures only\noccur on 7.x due to the existence of the transport client and its usage\nin our test infrastructure. This change removes the randomized usage of\ntransport clients when retrieving a client from a node in the internal\ncluster. Transport clients do not support the reloading of files for\nTLS configuration changes but if we build one from the nodes settings\nand attempt to use it after the files have been changed, the client\nwill not know about the changes and the TLS connection will fail.\n\nCloses #55524", "committedDate": "2020-04-22T18:35:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzQ4Mjg1Nw==", "url": "https://github.com/elastic/elasticsearch/pull/55637#discussion_r413482857", "bodyText": "Didn't know this customization exist. TIL.", "author": "ywangd", "createdAt": "2020-04-23T03:31:54Z", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/ssl/SSLReloadDuringStartupIntegTests.java", "diffHunk": "@@ -21,6 +22,10 @@\n import java.nio.file.StandardCopyOption;\n import java.util.concurrent.CountDownLatch;\n \n+// transport clients do not support reloading of files so failures can occur if we allow the use\n+// of transport clients in tests when we are changing files and a transport client is built from\n+// the node we change the files on\n+@ClusterScope(transportClientRatio = 0)", "originalCommit": "0e60f5c75cd1c4b90d210d9b0b77d232af963f0c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}