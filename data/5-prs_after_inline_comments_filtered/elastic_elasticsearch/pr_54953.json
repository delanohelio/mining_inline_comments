{"pr_number": 54953, "pr_title": "Check for negative \"from\" values in search request body", "pr_createdAt": "2020-04-08T13:06:56Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54953", "timeline": [{"oid": "2859e51d51c8709e66907dcbd62ede5c78db1c89", "url": "https://github.com/elastic/elasticsearch/commit/2859e51d51c8709e66907dcbd62ede5c78db1c89", "message": "Forbid negative \"from\" in search request body\n\nToday we already disallow negative values for the \"from\" parameter in the search\nAPI when it is set as a request parameter and setting it on the\nSearchSourceBuilder, but it is still parsed without complaint from a search\nbody, leading to differing exceptions later. This PR changes this behavior to be\nthe same regardless of setting the value directly, as url parameter or in the\nsearch body. Values of -1 are still allowed as the current default, meaning an\nunset value, in order not to break existing searches and templates using this.\n\nCloses #54897", "committedDate": "2020-04-08T13:04:34Z", "type": "commit"}, {"oid": "9b9784c100f52eaa7f0d9a822e50f2a316361f3d", "url": "https://github.com/elastic/elasticsearch/commit/9b9784c100f52eaa7f0d9a822e50f2a316361f3d", "message": "checkstyle", "committedDate": "2020-04-08T13:26:59Z", "type": "commit"}, {"oid": "c696cc882edbb8ffa21625e6b6750e72c1ae318c", "url": "https://github.com/elastic/elasticsearch/commit/c696cc882edbb8ffa21625e6b6750e72c1ae318c", "message": "skip on mixed cluster for now", "committedDate": "2020-04-08T13:32:59Z", "type": "commit"}, {"oid": "9e631cb2713da3448f65bf33f2a52c23774727b3", "url": "https://github.com/elastic/elasticsearch/commit/9e631cb2713da3448f65bf33f2a52c23774727b3", "message": "Merge branch 'master' into fix-54897", "committedDate": "2020-04-08T15:31:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjU4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r405706581", "bodyText": "Can we set the default early so that we can refuse any negative values ?", "author": "jimczi", "createdAt": "2020-04-08T17:52:16Z", "path": "server/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java", "diffHunk": "@@ -336,10 +336,13 @@ public QueryBuilder postFilter() {\n \n     /**\n      * From index to start the search from. Defaults to {@code 0}.\n+     * A value of -1 is interpreted as an unset value equivalent to 0.\n+     * Any other negative value is forbidden.\n      */\n     public SearchSourceBuilder from(int from) {\n-        if (from < 0) {\n-            throw new IllegalArgumentException(\"[from] parameter cannot be negative\");\n+        // accept -1 as the default unset value without error", "originalCommit": "9e631cb2713da3448f65bf33f2a52c23774727b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjExNzYxNw==", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r406117617", "bodyText": "I think for SearchSourceBuilder I would prefer to keep the notion of an \"unset\" value and interpret that in any way necessary later. I think this class should represent the user request body, e.g. in innerToXContent we only output values that are explicitely set by the user. Maybe @javanna has some preferences there as well?", "author": "cbuescher", "createdAt": "2020-04-09T10:44:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjU4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjE0MjY3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/54953#discussion_r406142673", "bodyText": "I'd agree if \"unset\" had different semantics depending on the context but we always set it to the default value.\nWe could forbid setting negative value but keep the initial value to -1 ?", "author": "jimczi", "createdAt": "2020-04-09T11:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwNjU4MQ=="}], "type": "inlineReview"}, {"oid": "7d1602ae4683138e8fbf42a7336d31cae6822f9f", "url": "https://github.com/elastic/elasticsearch/commit/7d1602ae4683138e8fbf42a7336d31cae6822f9f", "message": "change wording", "committedDate": "2020-04-09T10:50:21Z", "type": "commit"}, {"oid": "aa1efcfae8de551dca9f54ef400e14e6e470ec5d", "url": "https://github.com/elastic/elasticsearch/commit/aa1efcfae8de551dca9f54ef400e14e6e470ec5d", "message": "Merge branch 'master' into fix-54897", "committedDate": "2020-05-27T13:04:51Z", "type": "commit"}, {"oid": "33838e03cbbb01a262e77cddb77e8ca309c337d0", "url": "https://github.com/elastic/elasticsearch/commit/33838e03cbbb01a262e77cddb77e8ca309c337d0", "message": "Make -1 an invalid  parameter setting", "committedDate": "2020-05-27T16:51:49Z", "type": "commit"}, {"oid": "a2ddd1fd67c91fb949d931b8f3f97e1ca6eef3c4", "url": "https://github.com/elastic/elasticsearch/commit/a2ddd1fd67c91fb949d931b8f3f97e1ca6eef3c4", "message": "Merge branch 'master' into fix-54897", "committedDate": "2020-05-28T09:03:52Z", "type": "commit"}]}