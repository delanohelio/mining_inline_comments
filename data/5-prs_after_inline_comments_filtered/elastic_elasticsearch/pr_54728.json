{"pr_number": 54728, "pr_title": "Wipe data streams in each REST test", "pr_createdAt": "2020-04-03T16:12:49Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54728", "timeline": [{"oid": "4949a01da52323b1f6e3eda252fdebf840f599c6", "url": "https://github.com/elastic/elasticsearch/commit/4949a01da52323b1f6e3eda252fdebf840f599c6", "message": "wipe data streams in each REST test", "committedDate": "2020-04-03T16:11:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE4Mzg3Mg==", "url": "https://github.com/elastic/elasticsearch/pull/54728#discussion_r403183872", "bodyText": "This will likely have to catch the exception when datastreams aren't available (think BWC tests with 7.7 or earlier)", "author": "dakrone", "createdAt": "2020-04-03T17:41:33Z", "path": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java", "diffHunk": "@@ -600,6 +614,10 @@ protected static void wipeAllIndices() throws IOException {\n         }\n     }\n \n+    protected static void wipeDataStreams() throws IOException {\n+        adminClient().performRequest(new Request(\"DELETE\", \"_data_stream/*\"));", "originalCommit": "4949a01da52323b1f6e3eda252fdebf840f599c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE5OTUzOA==", "url": "https://github.com/elastic/elasticsearch/pull/54728#discussion_r403199538", "bodyText": "Thanks, I'll add that", "author": "danhermann", "createdAt": "2020-04-03T17:59:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE4Mzg3Mg=="}], "type": "inlineReview"}, {"oid": "335da059c5dfac0d2dc0a18b7bc81e203b962100", "url": "https://github.com/elastic/elasticsearch/commit/335da059c5dfac0d2dc0a18b7bc81e203b962100", "message": "accommodate situations where data streams are enabled", "committedDate": "2020-04-03T21:05:09Z", "type": "commit"}, {"oid": "345caf5729cb25eb77322bb1aa596c58ccd5ca7f", "url": "https://github.com/elastic/elasticsearch/commit/345caf5729cb25eb77322bb1aa596c58ccd5ca7f", "message": "Merge branch 'master' into wipe_data_streams_in_rest_tests", "committedDate": "2020-04-03T21:16:05Z", "type": "commit"}, {"oid": "46632b21fc1ad8865b94874e99fbde4670d726c9", "url": "https://github.com/elastic/elasticsearch/commit/46632b21fc1ad8865b94874e99fbde4670d726c9", "message": "broaden failure exclusion", "committedDate": "2020-04-03T21:35:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzg0NTIxNw==", "url": "https://github.com/elastic/elasticsearch/pull/54728#discussion_r403845217", "bodyText": "Maybe also check that the response code is 405? This is what we return in the case a rest action hasn't been implemented.", "author": "martijnvg", "createdAt": "2020-04-06T05:57:36Z", "path": "test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java", "diffHunk": "@@ -600,6 +614,14 @@ protected static void wipeAllIndices() throws IOException {\n         }\n     }\n \n+    protected static void wipeDataStreams() throws IOException {\n+        try {\n+            adminClient().performRequest(new Request(\"DELETE\", \"_data_stream/*\"));\n+        } catch (ResponseException e) {\n+            // We hit a version of ES that doesn't have data streams enabled so it's safe to ignore", "originalCommit": "46632b21fc1ad8865b94874e99fbde4670d726c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "39f84dbf1e0921d8654a8aa4e6074e574c800f4b", "url": "https://github.com/elastic/elasticsearch/commit/39f84dbf1e0921d8654a8aa4e6074e574c800f4b", "message": "check for response code", "committedDate": "2020-04-06T14:07:57Z", "type": "commit"}]}