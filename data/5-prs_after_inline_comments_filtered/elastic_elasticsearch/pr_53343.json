{"pr_number": 53343, "pr_title": "Support array for all string ingest processors", "pr_createdAt": "2020-03-10T14:36:17Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53343", "timeline": [{"oid": "3080ca8ae877a586dbd9ec283c1faa67a21547ae", "url": "https://github.com/elastic/elasticsearch/commit/3080ca8ae877a586dbd9ec283c1faa67a21547ae", "message": "Support array for string ingest processors", "committedDate": "2020-03-10T11:22:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzE5NzYzMw==", "url": "https://github.com/elastic/elasticsearch/pull/53343#discussion_r393197633", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                throw new IllegalArgumentException(\"field [\" + field + \"] of type [\" + value.getClass().getName() +\n          \n          \n            \n                                    \"] cannot be cast to [\" + String.class.getName() + \"]\");\n          \n          \n            \n                                throw new IllegalArgumentException(\"value [\" + value + \"] of type [\" + value.getClass().getName() +\n          \n          \n            \n                                    \"] in list field [\" + field + \"] cannot be cast to [\" + String.class.getName() + \"]\");", "author": "danhermann", "createdAt": "2020-03-16T17:35:29Z", "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AbstractStringProcessor.java", "diffHunk": "@@ -58,15 +60,38 @@ String getTargetField() {\n \n     @Override\n     public final IngestDocument execute(IngestDocument document) {\n-        String val = document.getFieldValue(field, String.class, ignoreMissing);\n+        Object val = document.getFieldValue(field, Object.class, ignoreMissing);\n+        Object newValue;\n \n         if (val == null && ignoreMissing) {\n             return document;\n         } else if (val == null) {\n             throw new IllegalArgumentException(\"field [\" + field + \"] is null, cannot process it.\");\n         }\n \n-        document.setFieldValue(targetField, process(val));\n+        if (val instanceof List) {\n+            List<?> list = (List<?>) val;\n+            List<Object> newList = new ArrayList<>(list.size());\n+            for (Object value : list) {\n+                if (value instanceof String) {\n+                    newList.add(process((String) value));\n+                } else {\n+                    throw new IllegalArgumentException(\"field [\" + field + \"] of type [\" + value.getClass().getName() +\n+                        \"] cannot be cast to [\" + String.class.getName() + \"]\");", "originalCommit": "3080ca8ae877a586dbd9ec283c1faa67a21547ae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e35d1f274b7c620548ac3513e3332333c58b3532", "url": "https://github.com/elastic/elasticsearch/commit/e35d1f274b7c620548ac3513e3332333c58b3532", "message": "Update docs/reference/ingest/processors/bytes.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:26:58Z", "type": "commit"}, {"oid": "ec399aaa268f0ece411d690489061495f471aba2", "url": "https://github.com/elastic/elasticsearch/commit/ec399aaa268f0ece411d690489061495f471aba2", "message": "Update docs/reference/ingest/processors/gsub.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:27:26Z", "type": "commit"}, {"oid": "10bc702c1e54c2b6e8773ad88023446b35ca90c7", "url": "https://github.com/elastic/elasticsearch/commit/10bc702c1e54c2b6e8773ad88023446b35ca90c7", "message": "Update docs/reference/ingest/processors/html_strip.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:28:07Z", "type": "commit"}, {"oid": "3770c3863ddcb3928e04fa160635860c4c44b107", "url": "https://github.com/elastic/elasticsearch/commit/3770c3863ddcb3928e04fa160635860c4c44b107", "message": "Update docs/reference/ingest/processors/lowercase.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:28:45Z", "type": "commit"}, {"oid": "097add095bbdd778e50dffb8fca264733732d6b4", "url": "https://github.com/elastic/elasticsearch/commit/097add095bbdd778e50dffb8fca264733732d6b4", "message": "Update docs/reference/ingest/processors/trim.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:29:01Z", "type": "commit"}, {"oid": "60568b9c6157c4a02655dc203ed34bab9367aa8a", "url": "https://github.com/elastic/elasticsearch/commit/60568b9c6157c4a02655dc203ed34bab9367aa8a", "message": "Update docs/reference/ingest/processors/uppercase.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:29:23Z", "type": "commit"}, {"oid": "f93eef5d2f714540e1faa2a71a6c4ebfc6143360", "url": "https://github.com/elastic/elasticsearch/commit/f93eef5d2f714540e1faa2a71a6c4ebfc6143360", "message": "Update docs/reference/ingest/processors/url-decode.asciidoc\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:29:37Z", "type": "commit"}, {"oid": "cf6256d8b71a5cd0b025cc622dd6a0572a23cea8", "url": "https://github.com/elastic/elasticsearch/commit/cf6256d8b71a5cd0b025cc622dd6a0572a23cea8", "message": "Update modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AbstractStringProcessor.java\n\nCo-Authored-By: Dan Hermann <danhermann@users.noreply.github.com>", "committedDate": "2020-03-17T02:30:28Z", "type": "commit"}, {"oid": "7bc26cdf72fa011d0432790165c7ff4219a8f6d9", "url": "https://github.com/elastic/elasticsearch/commit/7bc26cdf72fa011d0432790165c7ff4219a8f6d9", "message": "modify error message of the test code", "committedDate": "2020-03-17T07:58:33Z", "type": "commit"}, {"oid": "fe00bf0aea75e0b96de0a61896f0b79f715d6999", "url": "https://github.com/elastic/elasticsearch/commit/fe00bf0aea75e0b96de0a61896f0b79f715d6999", "message": "Merge remote-tracking branch 'origin/master' into patch#51087", "committedDate": "2020-03-17T08:02:03Z", "type": "commit"}]}