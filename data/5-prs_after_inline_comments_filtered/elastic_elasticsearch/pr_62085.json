{"pr_number": 62085, "pr_title": "Wildcard field bug fix for term queries. Wildcard syntax should not be supported in plain term queries.", "pr_createdAt": "2020-09-08T10:23:04Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62085", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgzMTY4NA==", "url": "https://github.com/elastic/elasticsearch/pull/62085#discussion_r484831684", "bodyText": "I don't think we need the link on the issue. The test name is descriptive enough imo.", "author": "jimczi", "createdAt": "2020-09-08T11:00:49Z", "path": "x-pack/plugin/wildcard/src/test/java/org/elasticsearch/xpack/wildcard/mapper/WildcardFieldMapperTests.java", "diffHunk": "@@ -179,6 +179,41 @@ public void testTooBigQueryField() throws IOException {\n         reader.close();\n         dir.close();\n     }\n+    \n+    \n+    public void testTermQueryIgnoresWildcardSyntax() throws IOException {\n+        // Test for bug https://github.com/elastic/elasticsearch/issues/62081\n+        // where term queries honoured wildcard quwery syntax", "originalCommit": "8895eddbec6e113f6d3e36f25ee62325524c32c5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgzMjUzNA==", "url": "https://github.com/elastic/elasticsearch/pull/62085#discussion_r484832534", "bodyText": "Isn't it the same problem with prefix query ? Maybe we can just escape ? and * in the value and continue to use the wildcardQuery ?", "author": "jimczi", "createdAt": "2020-09-08T11:02:36Z", "path": "x-pack/plugin/wildcard/src/main/java/org/elasticsearch/xpack/wildcard/mapper/WildcardFieldMapper.java", "diffHunk": "@@ -844,7 +845,36 @@ public Query existsQuery(QueryShardContext context) {\n \n         @Override\n         public Query termQuery(Object value, QueryShardContext context) {\n-            return wildcardQuery(BytesRefs.toString(value), MultiTermQuery.CONSTANT_SCORE_REWRITE, context);", "originalCommit": "8895eddbec6e113f6d3e36f25ee62325524c32c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDg5NjA5NA==", "url": "https://github.com/elastic/elasticsearch/pull/62085#discussion_r484896094", "bodyText": "Good point. I'll try that approach.", "author": "markharwood", "createdAt": "2020-09-08T13:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDgzMjUzNA=="}], "type": "inlineReview"}, {"oid": "03225727b47e4c89539d4f831a4c108e26063fb2", "url": "https://github.com/elastic/elasticsearch/commit/03225727b47e4c89539d4f831a4c108e26063fb2", "message": "Wildcard field bug fix for term queries. Wildcard syntax should not have special treatment in plain term queries.\nReplaced the simple logic that delegated to wildcardQuery() method with dedicated exact-match query logic for term queries.\n\nCloses #62081", "committedDate": "2020-09-09T08:14:37Z", "type": "commit"}, {"oid": "d66f4c8d65ec182358da5d59d31eec2ed9bb132b", "url": "https://github.com/elastic/elasticsearch/commit/d66f4c8d65ec182358da5d59d31eec2ed9bb132b", "message": "Opted to escape any wildcard syntax in term and prefix queries to keep the one search implementation", "committedDate": "2020-09-09T08:14:37Z", "type": "commit"}, {"oid": "8c67667ffe1639ce03f6bb3c03f51734c67a610f", "url": "https://github.com/elastic/elasticsearch/commit/8c67667ffe1639ce03f6bb3c03f51734c67a610f", "message": "Removed comment", "committedDate": "2020-09-09T08:14:37Z", "type": "commit"}, {"oid": "0ddbaacbcc4357e5718dca5e79cec3f4bc5888f4", "url": "https://github.com/elastic/elasticsearch/commit/0ddbaacbcc4357e5718dca5e79cec3f4bc5888f4", "message": "Unused import", "committedDate": "2020-09-09T08:14:37Z", "type": "commit"}, {"oid": "56304a8433696990066e5db286b54fb52751c3e8", "url": "https://github.com/elastic/elasticsearch/commit/56304a8433696990066e5db286b54fb52751c3e8", "message": "Fix test", "committedDate": "2020-09-09T08:14:37Z", "type": "commit"}, {"oid": "56304a8433696990066e5db286b54fb52751c3e8", "url": "https://github.com/elastic/elasticsearch/commit/56304a8433696990066e5db286b54fb52751c3e8", "message": "Fix test", "committedDate": "2020-09-09T08:14:37Z", "type": "forcePushed"}]}