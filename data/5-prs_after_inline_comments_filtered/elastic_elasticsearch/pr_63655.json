{"pr_number": 63655, "pr_title": "Simplify Snapshot ITs Further", "pr_createdAt": "2020-10-14T09:23:35Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63655", "timeline": [{"oid": "2867748916cf3dc70ad3e8e063fcc4e2e62d9c49", "url": "https://github.com/elastic/elasticsearch/commit/2867748916cf3dc70ad3e8e063fcc4e2e62d9c49", "message": "Simplify Snapshot ITs Further\n\nRemoving some more duplication and redundant logic.", "committedDate": "2020-10-14T09:20:01Z", "type": "commit"}, {"oid": "ca166ae096d1b24d827e5f0a590a4235031791ee", "url": "https://github.com/elastic/elasticsearch/commit/ca166ae096d1b24d827e5f0a590a4235031791ee", "message": "Merge remote-tracking branch 'elastic/master' into simplify-snapshot-tests", "committedDate": "2020-10-14T10:42:59Z", "type": "commit"}, {"oid": "039d4f6bd2c63de7eb86baa5cf0eff1225fd34d0", "url": "https://github.com/elastic/elasticsearch/commit/039d4f6bd2c63de7eb86baa5cf0eff1225fd34d0", "message": "fixes", "committedDate": "2020-10-14T10:58:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4NzM5MQ==", "url": "https://github.com/elastic/elasticsearch/pull/63655#discussion_r504587391", "bodyText": "This actually fixes a bug, we just didn't see the bug in practice yet because we only used this method in tests with a single master node ...", "author": "original-brownbear", "createdAt": "2020-10-14T11:00:06Z", "path": "test/framework/src/main/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java", "diffHunk": "@@ -582,7 +538,7 @@ protected SnapshotInfo getSnapshot(String repository, String snapshot) {\n \n     protected void awaitMasterFinishRepoOperations() throws Exception {\n         logger.info(\"--> waiting for master to finish all repo operations on its SNAPSHOT pool\");\n-        final ThreadPool masterThreadPool = internalCluster().getMasterNodeInstance(ThreadPool.class);\n+        final ThreadPool masterThreadPool = internalCluster().getCurrentMasterNodeInstance(ThreadPool.class);", "originalCommit": "039d4f6bd2c63de7eb86baa5cf0eff1225fd34d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4ODkwNA==", "url": "https://github.com/elastic/elasticsearch/pull/63655#discussion_r504588904", "bodyText": "Yeah, I noticed similar issue in DiskThresholdDeciderIT. getMasterNodeInstance() is trappy and should be renamed.", "author": "tlrx", "createdAt": "2020-10-14T11:02:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDU4NzM5MQ=="}], "type": "inlineReview"}]}