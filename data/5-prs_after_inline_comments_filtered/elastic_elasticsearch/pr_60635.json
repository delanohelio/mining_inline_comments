{"pr_number": 60635, "pr_title": "Make `FetchPhase` logic more readable. ", "pr_createdAt": "2020-08-04T00:25:44Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/60635", "timeline": [{"oid": "07ad1ffdceeabd42cecc789021c7b42e5ce8b9b6", "url": "https://github.com/elastic/elasticsearch/commit/07ad1ffdceeabd42cecc789021c7b42e5ce8b9b6", "message": "Factor out FieldsVisitor#postProcess call.", "committedDate": "2020-08-04T00:08:26Z", "type": "commit"}, {"oid": "fba36c97c23b0c8f6869f2b10f28da80fc55f3dc", "url": "https://github.com/elastic/elasticsearch/commit/fba36c97c23b0c8f6869f2b10f28da80fc55f3dc", "message": "Swap logical order for normal and nested documents.", "committedDate": "2020-08-04T00:08:38Z", "type": "commit"}, {"oid": "bfa57ff1a39ab4d7a4fa8dec59c58591102260d9", "url": "https://github.com/elastic/elasticsearch/commit/bfa57ff1a39ab4d7a4fa8dec59c58591102260d9", "message": "Extract the method createStoredFieldsVisitor.", "committedDate": "2020-08-04T00:19:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMyMTg3OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60635#discussion_r465321879", "bodyText": "do we want to make this function static?", "author": "mayya-sharipova", "createdAt": "2020-08-04T20:49:38Z", "path": "server/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java", "diffHunk": "@@ -209,6 +163,54 @@ public int compareTo(DocIdToIndex o) {\n         }\n     }\n \n+    private FieldsVisitor createStoredFieldsVisitor(SearchContext context, Map<String, Set<String>> storedToRequestedFields) {", "originalCommit": "bfa57ff1a39ab4d7a4fa8dec59c58591102260d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NzM0OA==", "url": "https://github.com/elastic/elasticsearch/pull/60635#discussion_r465347348", "bodyText": "\ud83d\udc4d", "author": "jtibshirani", "createdAt": "2020-08-04T21:43:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMyMTg3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM1MjczMA==", "url": "https://github.com/elastic/elasticsearch/pull/60635#discussion_r465352730", "bodyText": "On second thought, would you be okay keeping these as instance methods for consistency? It looks like all the other helper methods (findRootDocumentIfNested, prepareHitContext, etc.) are not static.", "author": "jtibshirani", "createdAt": "2020-08-04T21:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMyMTg3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTY0OTA5Ng==", "url": "https://github.com/elastic/elasticsearch/pull/60635#discussion_r465649096", "bodyText": "I don't mind keeping them instance methods for consistency.", "author": "mayya-sharipova", "createdAt": "2020-08-05T11:11:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMyMTg3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMyMjAzNQ==", "url": "https://github.com/elastic/elasticsearch/pull/60635#discussion_r465322035", "bodyText": "do we want to make this function static?", "author": "mayya-sharipova", "createdAt": "2020-08-04T20:49:55Z", "path": "server/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java", "diffHunk": "@@ -438,13 +437,17 @@ private void prepareNestedHitContext(FetchSubPhase.HitContext hitContext,\n         return nestedIdentity;\n     }\n \n-    private void loadStoredFields(SearchShardTarget shardTarget, LeafReaderContext readerContext, FieldsVisitor fieldVisitor, int docId) {\n+    private void loadStoredFields(SearchShardTarget shardTarget,", "originalCommit": "bfa57ff1a39ab4d7a4fa8dec59c58591102260d9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTM0NzM2OQ==", "url": "https://github.com/elastic/elasticsearch/pull/60635#discussion_r465347369", "bodyText": "\ud83d\udc4d", "author": "jtibshirani", "createdAt": "2020-08-04T21:43:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTMyMjAzNQ=="}], "type": "inlineReview"}]}