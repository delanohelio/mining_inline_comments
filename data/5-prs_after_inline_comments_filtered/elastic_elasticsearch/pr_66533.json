{"pr_number": 66533, "pr_title": "A node with roles [ml, remote_cluster_client] is still dedicated ML", "pr_createdAt": "2020-12-17T15:26:42Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66533", "timeline": [{"oid": "0e0d970866a75a3b9dc21531a3c79172c274a95c", "url": "https://github.com/elastic/elasticsearch/commit/0e0d970866a75a3b9dc21531a3c79172c274a95c", "message": "A node with roles [ml, remote_cluster_client] is still dedicated ML\n\nWhere CCS is being used it makes sense for ML nodes to have the\nremote_cluster_client role.  This single extra role is not\nsignificant enough to stop an ML node being considered a\n\"dedicated ML node\".", "committedDate": "2020-12-17T15:22:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwNzc4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/66533#discussion_r545207782", "bodyText": "This can be simplified to else if (containsOnly(roles, \"ml\", \"remote_cluster_client\"). That simply asserts that only the listed roles area llowd to be in the given collection, but a subset is fine as well.", "author": "mark-vieira", "createdAt": "2020-12-17T16:05:31Z", "path": "distribution/tools/launchers/src/main/java/org/elasticsearch/tools/launchers/MachineDependentHeap.java", "diffHunk": "@@ -142,7 +142,7 @@ public static MachineNodeRole parse(InputStream config) {\n                         return MachineNodeRole.DATA;\n                     } else if (containsOnly(roles, \"master\")) {\n                         return MachineNodeRole.MASTER_ONLY;\n-                    } else if (containsOnly(roles, \"ml\")) {\n+                    } else if (containsOnly(roles, \"ml\") || containsOnly(roles, \"ml\", \"remote_cluster_client\")) {", "originalCommit": "0e0d970866a75a3b9dc21531a3c79172c274a95c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwOTM4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66533#discussion_r545209383", "bodyText": "Thinking now, this would also be true in a case where a node had only the remote_cluster_client role, so maybe we might want to assert roles.contains(\"ml\") && containsOnly(roles, \"ml\", \"remote_cluster_client\")", "author": "mark-vieira", "createdAt": "2020-12-17T16:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwNzc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIyMTUxMg==", "url": "https://github.com/elastic/elasticsearch/pull/66533#discussion_r545221512", "bodyText": "Thanks.  I did that and also added a test to prove remote_cluster_client on its own isn't an ML node.", "author": "droberts195", "createdAt": "2020-12-17T16:23:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTIwNzc4Mg=="}], "type": "inlineReview"}, {"oid": "0db908c3be52d32c2ae41a8213b85bba5e51b47e", "url": "https://github.com/elastic/elasticsearch/commit/0db908c3be52d32c2ae41a8213b85bba5e51b47e", "message": "Fix logic to exclude remote_cluster_client on its own", "committedDate": "2020-12-17T16:22:30Z", "type": "commit"}]}