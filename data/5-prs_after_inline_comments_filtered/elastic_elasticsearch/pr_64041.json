{"pr_number": 64041, "pr_title": "Remove type handling in LeafFieldsLookup", "pr_createdAt": "2020-10-22T08:42:37Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64041", "timeline": [{"oid": "426e2c4c492461ed567ef8054bf13be12f1ac347", "url": "https://github.com/elastic/elasticsearch/commit/426e2c4c492461ed567ef8054bf13be12f1ac347", "message": "Remove type handling in LeafFieldsLookup", "committedDate": "2020-10-22T08:41:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509985737", "bodyText": "Is this what you meant @romseygeek ? Are we sure that we can drop this? Looks like a breaking change to me, wondering if it's worth leaving it around although it is constant, not sure.", "author": "javanna", "createdAt": "2020-10-22T08:44:34Z", "path": "server/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java", "diffHunk": "@@ -137,21 +135,12 @@ private FieldLookup loadFieldData(String name) {\n             cachedFieldData.put(name, data);\n         }\n         if (data.fields() == null) {\n-            List<Object> values;\n-            if (TypeFieldType.NAME.equals(data.fieldType().name())) {\n-                values = new ArrayList<>(1);\n-                final DocumentMapper mapper = mapperService.documentMapper();\n-                if (mapper != null) {\n-                    values.add(mapper.type());\n-                }", "originalCommit": "426e2c4c492461ed567ef8054bf13be12f1ac347", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4Nzc1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509987751", "bodyText": "It is a breaking change, but I think it comes under the general umbrella of types removal so probably doesn't need a specific call-out.  If you try and use _type in a script in 7x you get a deprecation warning so I think it's fine to remove it.", "author": "romseygeek", "createdAt": "2020-10-22T08:47:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4OTc1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509989759", "bodyText": "the problem here may be that the field type does come up by name, but then it fails to retrieve values from lucene, or is that ok?", "author": "javanna", "createdAt": "2020-10-22T08:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk5Mjg0NA==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r509992844", "bodyText": "I see what you mean.  Maybe we should be removing the special-casing in MapperService.fieldType() in master as well, given that it's deprecated generally in 7.x. @jtibshirani what do you think?", "author": "romseygeek", "createdAt": "2020-10-22T08:54:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMTA1OQ==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510311059", "bodyText": "I just caught up on the code and was surprised to see we still have TypeFieldType in master. Is there a reason we added this special logic instead of removing TypeFieldType entirely, which would disallow all search operations on _type?", "author": "jtibshirani", "createdAt": "2020-10-22T16:47:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxMzE4NQ==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510313185", "bodyText": "I think I added this as a stop-gap while backporting the various type field deprecations.  I'll open a PR to remove it entirely in master.", "author": "romseygeek", "createdAt": "2020-10-22T16:51:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxNDc0Mg==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510314742", "bodyText": "One question I had -- does removing this have an implication for our API version compatibility efforts? I'm not up-to-date on our collaborations there.", "author": "jtibshirani", "createdAt": "2020-10-22T16:53:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDMxODI4NA==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510318284", "bodyText": "Version compatibility only applies to the 'shape' of the request, as I understand it.  So we need to support type queries, but we don't need to support queries against the field _type (otherwise we'd never be able to deprecate types at all...)", "author": "romseygeek", "createdAt": "2020-10-22T16:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDM5NjY0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/64041#discussion_r510396647", "bodyText": "thanks for the input. It looks like this can go in then, and as a follow-up we will also remove TypeFieldType completely, which sounds like a good plan to me.", "author": "javanna", "createdAt": "2020-10-22T19:12:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTk4NTczNw=="}], "type": "inlineReview"}, {"oid": "5f0d29ca583e664e54def4160f41f563201c7fa4", "url": "https://github.com/elastic/elasticsearch/commit/5f0d29ca583e664e54def4160f41f563201c7fa4", "message": "iter", "committedDate": "2020-10-22T19:11:55Z", "type": "commit"}, {"oid": "a9383b13e99fed19f14191c965c12d77a4552be0", "url": "https://github.com/elastic/elasticsearch/commit/a9383b13e99fed19f14191c965c12d77a4552be0", "message": "Merge branch 'master' into refactoring/remove_type_leaf_lookup", "committedDate": "2020-10-26T10:45:24Z", "type": "commit"}]}