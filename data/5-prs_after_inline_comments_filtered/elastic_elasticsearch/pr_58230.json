{"pr_number": 58230, "pr_title": "Add text search information to MappedFieldType", "pr_createdAt": "2020-06-17T09:03:25Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58230", "timeline": [{"oid": "18c1d83069b83bb0bc2d5ffde5d0c46ec59cbaf8", "url": "https://github.com/elastic/elasticsearch/commit/18c1d83069b83bb0bc2d5ffde5d0c46ec59cbaf8", "message": "Add TextSearchInfo class to wrap up text search details", "committedDate": "2020-06-17T08:53:43Z", "type": "commit"}, {"oid": "1ba04c835fff053e19891e9bfefd292f189d7398", "url": "https://github.com/elastic/elasticsearch/commit/1ba04c835fff053e19891e9bfefd292f189d7398", "message": "Merge remote-tracking branch 'origin/master' into mapper/textsearchinfo", "committedDate": "2020-06-17T08:53:53Z", "type": "commit"}, {"oid": "9852fcd7c0214b627884e2e4b772c79d52c68944", "url": "https://github.com/elastic/elasticsearch/commit/9852fcd7c0214b627884e2e4b772c79d52c68944", "message": "javadocs", "committedDate": "2020-06-17T08:59:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5Njg0NQ==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r441396845", "bodyText": "This is a bit weird, but geometry fields currently let you go all the way through to calling termQuery before throwing an error, so this preserves the current behaviour.  It might allow us to support match queries against geometry fields via WKT or something similar in the future, so I think we should leave it in for now.", "author": "romseygeek", "createdAt": "2020-06-17T09:06:10Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/AbstractGeometryFieldMapper.java", "diffHunk": "@@ -185,7 +184,7 @@ public T parse(String name, Map<String, Object> node, ParserContext parserContex\n         protected QueryProcessor geometryQueryBuilder;\n \n         protected AbstractGeometryFieldType(String name, boolean indexed, boolean hasDocValues, Map<String, String> meta) {\n-            super(name, indexed, hasDocValues, meta);\n+            super(name, indexed, hasDocValues, TextSearchInfo.GEOMETRY, meta);", "originalCommit": "9852fcd7c0214b627884e2e4b772c79d52c68944", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5OTU5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r441399599", "bodyText": "TextSearchInfo.NUMERIC always returns stored as false.  I thought about making this configurable, but the only place in the code that uses this is in highlighting, and numeric fields can't be highlighted, so I think it's OK to be slightly incorrect here.", "author": "romseygeek", "createdAt": "2020-06-17T09:10:47Z", "path": "server/src/test/java/org/elasticsearch/index/mapper/GenericStoreDynamicTemplateTests.java", "diffHunk": "@@ -51,16 +51,13 @@ public void testSimple() throws Exception {\n         assertThat(f.stringValue(), equalTo(\"some name\"));\n         assertThat(f.fieldType().stored(), equalTo(true));\n \n-        FieldType fieldType = mapperService.getLuceneFieldType(\"name\");\n+        FieldType fieldType = mapperService.fieldType(\"name\").getTextSearchInfo().getLuceneFieldType();\n         assertThat(fieldType.stored(), equalTo(true));\n \n         boolean stored = false;\n         for (IndexableField field : doc.getFields(\"age\")) {\n             stored |=  field.fieldType().stored();\n         }\n         assertTrue(stored);\n-", "originalCommit": "9852fcd7c0214b627884e2e4b772c79d52c68944", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2NjM3MA==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r442466370", "bodyText": "does it make sense to add this as a comment somewhere?", "author": "javanna", "createdAt": "2020-06-18T19:52:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5OTU5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDExMDAzNw==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r444110037", "bodyText": "I added a comment to TextSearchInfo.NUMERIC javadocs", "author": "romseygeek", "createdAt": "2020-06-23T10:03:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTM5OTU5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY2NTM2NA==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r441665364", "bodyText": "Add javadocs explaining what are the implications of a null return value?", "author": "jpountz", "createdAt": "2020-06-17T16:14:52Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java", "diffHunk": "@@ -411,4 +408,8 @@ public static Term extractTerm(Query termQuery) {\n     public void updateMeta(Map<String, String> meta) {\n         this.meta = Map.copyOf(Objects.requireNonNull(meta));\n     }\n+\n+    public TextSearchInfo getTextSearchInfo() {", "originalCommit": "9852fcd7c0214b627884e2e4b772c79d52c68944", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9d304670ce8c87be4208aaf967ae90468ecd96cb", "url": "https://github.com/elastic/elasticsearch/commit/9d304670ce8c87be4208aaf967ae90468ecd96cb", "message": "Merge remote-tracking branch 'origin/master' into mapper/textsearchinfo", "committedDate": "2020-06-18T13:01:23Z", "type": "commit"}, {"oid": "842883d440daff35e6c3605ae4c90ebac239e357", "url": "https://github.com/elastic/elasticsearch/commit/842883d440daff35e6c3605ae4c90ebac239e357", "message": "Don't expose lucene FieldType directly", "committedDate": "2020-06-18T14:47:07Z", "type": "commit"}, {"oid": "cedf0cfaaa66fa17b1fa7badc4826e45b54d899a", "url": "https://github.com/elastic/elasticsearch/commit/cedf0cfaaa66fa17b1fa7badc4826e45b54d899a", "message": "rationalise; javadocs", "committedDate": "2020-06-18T15:17:10Z", "type": "commit"}, {"oid": "cedf0cfaaa66fa17b1fa7badc4826e45b54d899a", "url": "https://github.com/elastic/elasticsearch/commit/cedf0cfaaa66fa17b1fa7badc4826e45b54d899a", "message": "rationalise; javadocs", "committedDate": "2020-06-18T15:17:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2NTQ4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r442465481", "bodyText": "would it make sense to avoid null values and replace them with a TestSearchInfo.NONE that always returns false? I feel like that may make it easier to trace where it's used and it will avoid NPEs :)", "author": "javanna", "createdAt": "2020-06-18T19:50:22Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/TextSearchInfo.java", "diffHunk": "@@ -0,0 +1,107 @@\n+/*\n+ * Licensed to Elasticsearch under one or more contributor\n+ * license agreements. See the NOTICE file distributed with\n+ * this work for additional information regarding copyright\n+ * ownership. Elasticsearch licenses this file to you under\n+ * the Apache License, Version 2.0 (the \"License\"); you may\n+ * not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+\n+package org.elasticsearch.index.mapper;\n+\n+import org.apache.lucene.document.FieldType;\n+import org.apache.lucene.index.IndexOptions;\n+\n+/**\n+ * Encapsulates information about how to perform text searches over a field\n+ */\n+public class TextSearchInfo {", "originalCommit": "cedf0cfaaa66fa17b1fa7badc4826e45b54d899a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDExMDI2MA==", "url": "https://github.com/elastic/elasticsearch/pull/58230#discussion_r444110260", "bodyText": "++, this makes things much cleaner.", "author": "romseygeek", "createdAt": "2020-06-23T10:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjQ2NTQ4MQ=="}], "type": "inlineReview"}, {"oid": "0dcbc22a2fa84c7611303a8c694de9df686ffd6f", "url": "https://github.com/elastic/elasticsearch/commit/0dcbc22a2fa84c7611303a8c694de9df686ffd6f", "message": "Merge remote-tracking branch 'origin/master' into mapper/textsearchinfo", "committedDate": "2020-06-23T09:12:23Z", "type": "commit"}, {"oid": "c44158f900627fcdbe0e14ccb87678f95b428f5b", "url": "https://github.com/elastic/elasticsearch/commit/c44158f900627fcdbe0e14ccb87678f95b428f5b", "message": "Add TextSearchInfo.NONE", "committedDate": "2020-06-23T09:33:19Z", "type": "commit"}]}