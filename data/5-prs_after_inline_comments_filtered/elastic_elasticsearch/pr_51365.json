{"pr_number": 51365, "pr_title": "Flush instead of synced-flush inactive shards", "pr_createdAt": "2020-01-23T17:57:20Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51365", "timeline": [{"oid": "4e0eed1cb09873a8b0664c02b644aa847db37397", "url": "https://github.com/elastic/elasticsearch/commit/4e0eed1cb09873a8b0664c02b644aa847db37397", "message": "Flush instead of synced-flush inactive shards", "committedDate": "2020-01-23T16:57:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5MzkwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/51365#discussion_r370293901", "bodyText": "clusterService.state().nodes().getMinNodeVersion().onOrAfter(Version.V_7_6_0)?", "author": "ywelsch", "createdAt": "2020-01-23T18:51:25Z", "path": "server/src/main/java/org/elasticsearch/indices/flush/SyncedFlushService.java", "diffHunk": "@@ -111,8 +113,13 @@ public SyncedFlushService(IndicesService indicesService,\n \n     @Override\n     public void onShardInactive(final IndexShard indexShard) {\n-        // we only want to call sync flush once, so only trigger it when we are on a primary\n-        if (indexShard.routingEntry().primary()) {\n+        // A normal flush has the same effect as a synced flush if all nodes are on 7.6 or later.\n+        final boolean preferNormalFlush = StreamSupport.stream(clusterService.state().nodes().spliterator(), false)", "originalCommit": "4e0eed1cb09873a8b0664c02b644aa847db37397", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDMyMDAzOA==", "url": "https://github.com/elastic/elasticsearch/pull/51365#discussion_r370320038", "bodyText": "thanks, pushed ab93b7f.", "author": "dnhatn", "createdAt": "2020-01-23T19:47:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDI5MzkwMQ=="}], "type": "inlineReview"}, {"oid": "ab93b7fd0ce392b9712f4c2af3052865b245a1b2", "url": "https://github.com/elastic/elasticsearch/commit/ab93b7fd0ce392b9712f4c2af3052865b245a1b2", "message": "getMinNodeVersion", "committedDate": "2020-01-23T19:46:23Z", "type": "commit"}]}