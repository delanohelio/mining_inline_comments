{"pr_number": 59008, "pr_title": "[7.x] Add include_data_streams flag for authorization", "pr_createdAt": "2020-07-03T11:48:03Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/59008", "timeline": [{"oid": "01cfe20c015c52c3b4078ce4528c2ff0877c4581", "url": "https://github.com/elastic/elasticsearch/commit/01cfe20c015c52c3b4078ce4528c2ff0877c4581", "message": "Add include_data_streams flag for authorization (#58154)", "committedDate": "2020-07-03T11:45:16Z", "type": "commit"}, {"oid": "31e0252030d1e5fc01a080fb4e41297838e7cd2d", "url": "https://github.com/elastic/elasticsearch/commit/31e0252030d1e5fc01a080fb4e41297838e7cd2d", "message": "Merge branch '7.x' into backport_7x_58154_ds_auth", "committedDate": "2020-07-03T12:43:47Z", "type": "commit"}, {"oid": "c1780b1d11b5ba20db7aae3c33f34330d8911eec", "url": "https://github.com/elastic/elasticsearch/commit/c1780b1d11b5ba20db7aae3c33f34330d8911eec", "message": "tricky, tricky", "committedDate": "2020-07-03T15:50:24Z", "type": "commit"}, {"oid": "90e710c2f19b2858b742f5a69f8e3476be85abea", "url": "https://github.com/elastic/elasticsearch/commit/90e710c2f19b2858b742f5a69f8e3476be85abea", "message": "Merge branch 'backport_7x_58154_ds_auth' of https://github.com/danhermann/elasticsearch into backport_7x_58154_ds_auth", "committedDate": "2020-07-03T15:51:00Z", "type": "commit"}, {"oid": "b2b644495ccda226a950c43add837b1658ad8646", "url": "https://github.com/elastic/elasticsearch/commit/b2b644495ccda226a950c43add837b1658ad8646", "message": "java8 syntax", "committedDate": "2020-07-03T15:59:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY0OTYyMw==", "url": "https://github.com/elastic/elasticsearch/pull/59008#discussion_r449649623", "bodyText": "\ud83d\ude31 , but luckily assertions tripped!", "author": "martijnvg", "createdAt": "2020-07-03T16:15:21Z", "path": "server/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java", "diffHunk": "@@ -207,7 +207,7 @@ public ClusterState execute(ClusterState currentState) {\n                     throw new ConcurrentSnapshotExecutionException(repositoryName, snapshotName, \" a snapshot is already running\");\n                 }\n                 // Store newSnapshot here to be processed in clusterStateProcessed\n-                List<String> indices = Arrays.asList(indexNameExpressionResolver.concreteIndexNames(currentState, request));\n+                indices = Arrays.asList(indexNameExpressionResolver.concreteIndexNames(currentState, request));", "originalCommit": "c1780b1d11b5ba20db7aae3c33f34330d8911eec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY0OTgzMg==", "url": "https://github.com/elastic/elasticsearch/pull/59008#discussion_r449649832", "bodyText": "why is this commented out?", "author": "martijnvg", "createdAt": "2020-07-03T16:16:03Z", "path": "server/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java", "diffHunk": "@@ -1702,26 +1717,26 @@ public void testIndicesAliasesRequestTargetDataStreams() {\n         {\n             IndicesAliasesRequest.AliasActions aliasActions = IndicesAliasesRequest.AliasActions.add().index(dataStreamName);\n             IllegalArgumentException iae = expectThrows(IllegalArgumentException.class,\n-                () -> indexNameExpressionResolver.concreteIndexNames(state, aliasActions, false));\n+                () -> indexNameExpressionResolver.concreteIndexNames(state, aliasActions));\n             assertEquals(\"The provided expression [\" + dataStreamName + \"] matches a data stream, specify the corresponding \" +\n                 \"concrete indices instead.\", iae.getMessage());\n         }\n \n         {\n             IndicesAliasesRequest.AliasActions aliasActions = IndicesAliasesRequest.AliasActions.add().index(\"my-data-*\").alias(\"my-data\");\n             IllegalArgumentException iae = expectThrows(IllegalArgumentException.class,\n-                () -> indexNameExpressionResolver.concreteIndexNames(state, aliasActions, false));\n+                () -> indexNameExpressionResolver.concreteIndexNames(state, aliasActions));\n             assertEquals(\"The provided expression [my-data-*] matches a data stream, specify the corresponding concrete indices instead.\",\n                 iae.getMessage());\n         }\n \n-        {\n-            IndicesAliasesRequest.AliasActions aliasActions = IndicesAliasesRequest.AliasActions.add().index(dataStreamName)\n-                .alias(\"my-data\");\n-            String[] indices = indexNameExpressionResolver.concreteIndexNames(state, aliasActions, true);\n-            assertEquals(1, indices.length);\n-            assertEquals(backingIndex.getIndex().getName(), indices[0]);\n-        }\n+        //{", "originalCommit": "b2b644495ccda226a950c43add837b1658ad8646", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY1MTY5NA==", "url": "https://github.com/elastic/elasticsearch/pull/59008#discussion_r449651694", "bodyText": "I missed that in an earlier commit. The backport of #57900 will un-comment it.", "author": "danhermann", "createdAt": "2020-07-03T16:23:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTY0OTgzMg=="}], "type": "inlineReview"}]}