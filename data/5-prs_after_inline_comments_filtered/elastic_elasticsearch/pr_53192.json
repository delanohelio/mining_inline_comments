{"pr_number": 53192, "pr_title": "[ML] fixing data frame analysis test when two jobs are started in succession quickly", "pr_createdAt": "2020-03-05T21:39:32Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53192", "timeline": [{"oid": "bcaa4255f432f260aa7482d5bf62aea7353209b2", "url": "https://github.com/elastic/elasticsearch/commit/bcaa4255f432f260aa7482d5bf62aea7353209b2", "message": "[ML] fixing data frame analysis test when two jobs are started in succession quickly", "committedDate": "2020-03-05T21:36:53Z", "type": "commit"}, {"oid": "603d23d033bc4ad224ab3f865684b920c7e76c34", "url": "https://github.com/elastic/elasticsearch/commit/603d23d033bc4ad224ab3f865684b920c7e76c34", "message": "allow multiple assignment attempts when primary shards are inactive", "committedDate": "2020-03-06T13:51:12Z", "type": "commit"}, {"oid": "04909d3a2998f3cfb3a8a4d375606c217978f00b", "url": "https://github.com/elastic/elasticsearch/commit/04909d3a2998f3cfb3a8a4d375606c217978f00b", "message": "Merge branch 'master' into feature/ml-dataframe-fix-test-53188", "committedDate": "2020-03-06T15:47:04Z", "type": "commit"}, {"oid": "150a5211809cbd04c6c6eb135fab2ce45f7058b0", "url": "https://github.com/elastic/elasticsearch/commit/150a5211809cbd04c6c6eb135fab2ce45f7058b0", "message": "unmuting classificationit test", "committedDate": "2020-03-06T15:47:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4Njg1OA==", "url": "https://github.com/elastic/elasticsearch/pull/53192#discussion_r388986858", "bodyText": "The risk of mistakes in future maintenance would be reduced if the string \"], because not all primary shards are active for the following indices [\" from old line 587 was put in a constant and that same constant was used here too.", "author": "droberts195", "createdAt": "2020-03-06T15:59:06Z", "path": "x-pack/plugin/ml/src/main/java/org/elasticsearch/xpack/ml/action/TransportStartDataFrameAnalyticsAction.java", "diffHunk": "@@ -450,9 +470,15 @@ public boolean test(PersistentTasksCustomMetaData.PersistentTask<?> persistentTa\n                 return true;\n             }\n \n-            if (assignment != null && assignment.equals(PersistentTasksCustomMetaData.INITIAL_ASSIGNMENT) == false &&\n-                assignment.isAssigned() == false) {\n-                // Assignment has failed despite passing our \"fast fail\" validation\n+            if (assignment != null\n+                && assignment.equals(PersistentTasksCustomMetaData.INITIAL_ASSIGNMENT) == false\n+                && assignment.isAssigned() == false) {\n+                assignmentExplanation = assignment.getExplanation();\n+                // Assignment failed due to primary shard check.\n+                // This is hopefully intermittent and we should allow another assignment attempt.\n+                if (assignmentExplanation.contains(\"not all primary shards are active\")) {", "originalCommit": "150a5211809cbd04c6c6eb135fab2ce45f7058b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTAxOTM0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/53192#discussion_r389019349", "bodyText": "For sure!", "author": "benwtrent", "createdAt": "2020-03-06T16:52:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODk4Njg1OA=="}], "type": "inlineReview"}, {"oid": "65aac0a611b0e5d5a483a36a87c8c55fb5376ea3", "url": "https://github.com/elastic/elasticsearch/commit/65aac0a611b0e5d5a483a36a87c8c55fb5376ea3", "message": "Merge branch 'master' into feature/ml-dataframe-fix-test-53188", "committedDate": "2020-03-06T18:02:15Z", "type": "commit"}, {"oid": "41826834c47bc0ef6c1ea9b279fb25fce09f4ee5", "url": "https://github.com/elastic/elasticsearch/commit/41826834c47bc0ef6c1ea9b279fb25fce09f4ee5", "message": "extracting active shards message", "committedDate": "2020-03-06T18:06:04Z", "type": "commit"}, {"oid": "235638e54a43be870fdc08f5b30bd91f58bd6b4a", "url": "https://github.com/elastic/elasticsearch/commit/235638e54a43be870fdc08f5b30bd91f58bd6b4a", "message": "Merge branch 'master' into feature/ml-dataframe-fix-test-53188", "committedDate": "2020-03-09T12:56:16Z", "type": "commit"}, {"oid": "8e1084bc68f981ddb9f1bde89daf71f3bd4568fb", "url": "https://github.com/elastic/elasticsearch/commit/8e1084bc68f981ddb9f1bde89daf71f3bd4568fb", "message": "Merge branch 'master' into feature/ml-dataframe-fix-test-53188", "committedDate": "2020-03-09T17:03:33Z", "type": "commit"}]}