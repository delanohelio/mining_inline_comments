{"pr_number": 63566, "pr_title": "[ML] use node.roles as node.ml is deprecated in test external cluster", "pr_createdAt": "2020-10-12T14:25:58Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63566", "timeline": [{"oid": "92c470ca503678fe318637496cafdbfd00fdeb54", "url": "https://github.com/elastic/elasticsearch/commit/92c470ca503678fe318637496cafdbfd00fdeb54", "message": "[ML] use node.roles as node.ml is deprecated in test external cluster", "committedDate": "2020-10-12T14:23:38Z", "type": "commit"}, {"oid": "95845efefb6b90232c620e13d65dcab5dde19020", "url": "https://github.com/elastic/elasticsearch/commit/95845efefb6b90232c620e13d65dcab5dde19020", "message": "Merge branch 'master' into test/ml-adjust-external-cluster-settings", "committedDate": "2020-10-12T16:48:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMTUxMw==", "url": "https://github.com/elastic/elasticsearch/pull/63566#discussion_r503421513", "bodyText": "node.data, node.master and node.ingest defaulted to true.  So previously we were saying that the node had these roles but not node.ml.  Does an explicitly empty list mean \"use the defaults\" or \"no roles\"?  Either way this appears to be changing the logic:\n\nIf an explicitly empty list means \"use the defaults\" then we're now defaulting the roles to master, data, ingest, ml, and remote_cluster_client, i.e. including ml when we weren't before\nIf an explicitly empty list means \"no roles\" then that's different to before because master, data, ingest, and remote_cluster_client used to default to true", "author": "droberts195", "createdAt": "2020-10-12T16:57:07Z", "path": "x-pack/plugin/ml/qa/native-multi-node-tests/src/javaRestTest/java/org/elasticsearch/xpack/ml/integration/MlNativeIntegTestCase.java", "diffHunk": "@@ -156,7 +156,7 @@ protected Settings externalClusterClientSettings() {\n         }\n \n         Settings.Builder builder = Settings.builder();\n-        builder.put(\"node.ml\", false);\n+        builder.putList(\"node.roles\", Collections.emptyList());", "originalCommit": "95845efefb6b90232c620e13d65dcab5dde19020", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMzY1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/63566#discussion_r503423651", "bodyText": "Yes, I tested it with an empty list and it seemed to work? I will see whats up. The original external cluster build settings seems to have all default roles set to false.", "author": "benwtrent", "createdAt": "2020-10-12T17:01:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMTUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ2NTU0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/63566#discussion_r503465546", "bodyText": "@droberts195 I understood from the beginning that an empty array means \"no roles\". I thought this was the current behavior given how the base settings looked in ExternalTestCluster.java and our updates to them. It seems that \"no roles\" is what we want. Or at least, how I read it.\nThe tests obviously passed. So, \ud83e\udd37", "author": "benwtrent", "createdAt": "2020-10-12T18:28:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMTUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk0MzY0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/63566#discussion_r503943647", "bodyText": "@droberts195 tests pass if a use an empty list or if I supply master, data, and ingest.", "author": "benwtrent", "createdAt": "2020-10-13T13:18:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMTUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzk3NDM3OA==", "url": "https://github.com/elastic/elasticsearch/pull/63566#discussion_r503974378", "bodyText": "tests pass if a use an empty list or if I supply master, data, and ingest\n\nOh, is this just for the test client?  I guess we set the roles of the nodes in the cluster somewhere else.  If it's just for the test client then no roles is probably best.", "author": "droberts195", "createdAt": "2020-10-13T13:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMTUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDAxMzg0MA==", "url": "https://github.com/elastic/elasticsearch/pull/63566#discussion_r504013840", "bodyText": "Yeah, this is for externalClusterClientSettings so, it's the client :). No roles necessary.", "author": "benwtrent", "createdAt": "2020-10-13T14:46:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQyMTUxMw=="}], "type": "inlineReview"}]}