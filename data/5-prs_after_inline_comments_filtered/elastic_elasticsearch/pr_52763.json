{"pr_number": 52763, "pr_title": "[ML] Adds the class_assignment_objective parameter to classification", "pr_createdAt": "2020-02-25T13:34:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52763", "timeline": [{"oid": "0eee38b0c6cb9dec84a63ddf875cd89d073853c6", "url": "https://github.com/elastic/elasticsearch/commit/0eee38b0c6cb9dec84a63ddf875cd89d073853c6", "message": "Add a new classification parameter: class assignment objective", "committedDate": "2020-02-25T12:29:51Z", "type": "commit"}, {"oid": "edfebc27dfa95dca28110351d7e25bcaa0add610", "url": "https://github.com/elastic/elasticsearch/commit/edfebc27dfa95dca28110351d7e25bcaa0add610", "message": "Assorted fixes", "committedDate": "2020-02-26T16:17:42Z", "type": "commit"}, {"oid": "edfebc27dfa95dca28110351d7e25bcaa0add610", "url": "https://github.com/elastic/elasticsearch/commit/edfebc27dfa95dca28110351d7e25bcaa0add610", "message": "Assorted fixes", "committedDate": "2020-02-26T16:17:42Z", "type": "forcePushed"}, {"oid": "d8c4a770263ccee17a66e38d751441ee6024a53d", "url": "https://github.com/elastic/elasticsearch/commit/d8c4a770263ccee17a66e38d751441ee6024a53d", "message": "Merge branch 'master' into add-class-assignment-objective", "committedDate": "2020-02-26T20:55:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNDE4Mg==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387634182", "bodyText": "Is there a reason for not adding it as the last param of the constructor (and possibly the members list above too)? If not, I think it'd be best to move it last as it would make it simpler for users of the client to address upon upgrading.", "author": "dimitris-athanasiou", "createdAt": "2020-03-04T12:28:08Z", "path": "client/rest-high-level/src/main/java/org/elasticsearch/client/ml/dataframe/Classification.java", "diffHunk": "@@ -92,13 +102,15 @@ public static Builder builder(String dependentVariable) {\n     private final Integer numTopFeatureImportanceValues;\n     private final String predictionFieldName;\n     private final Double trainingPercent;\n+    private final ClassAssignmentObjective classAssignmentObjective;\n     private final Integer numTopClasses;\n     private final Long randomizeSeed;\n \n     private Classification(String dependentVariable, @Nullable Double lambda, @Nullable Double gamma, @Nullable Double eta,\n                            @Nullable Integer maximumNumberTrees, @Nullable Double featureBagFraction,\n                            @Nullable Integer numTopFeatureImportanceValues, @Nullable String predictionFieldName,\n-                           @Nullable Double trainingPercent, @Nullable Integer numTopClasses, @Nullable Long randomizeSeed) {\n+                           @Nullable Double trainingPercent, @Nullable ClassAssignmentObjective classAssignmentObjective,\n+                           @Nullable Integer numTopClasses, @Nullable Long randomizeSeed) {", "originalCommit": "d8c4a770263ccee17a66e38d751441ee6024a53d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY2NTc5Mw==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387665793", "bodyText": "No good point.", "author": "tveasey", "createdAt": "2020-03-04T13:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNDE4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc1NTYwNg==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387755606", "bodyText": "4e0ded7", "author": "tveasey", "createdAt": "2020-03-04T15:48:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNDE4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNjg4MA==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387636880", "bodyText": "Do we need the qualification here?", "author": "dimitris-athanasiou", "createdAt": "2020-03-04T12:33:48Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/MachineLearningIT.java", "diffHunk": "@@ -1336,6 +1336,8 @@ public void testPutDataFrameAnalyticsConfig_GivenClassification() throws Excepti\n                 .setPredictionFieldName(\"my_dependent_variable_prediction\")\n                 .setTrainingPercent(80.0)\n                 .setRandomizeSeed(42L)\n+                .setClassAssignmentObjective(\n+                    org.elasticsearch.client.ml.dataframe.Classification.ClassAssignmentObjective.MAXIMIZE_ACCURACY)", "originalCommit": "d8c4a770263ccee17a66e38d751441ee6024a53d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY2NDQ1MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387664451", "bodyText": "Unfortunately, yes. I tried importing but it created a name clash.", "author": "tveasey", "createdAt": "2020-03-04T13:27:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNjg4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY5MDEyOA==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387690128", "bodyText": "It clashes with evaluation. Fair enough!", "author": "dimitris-athanasiou", "createdAt": "2020-03-04T14:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzNjg4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzOTE0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387639147", "bodyText": "Both this and the one in the write function will have to be changed to version 8.0.0 initially. We'll change them back to 7.7.0 after backporting to the 7.x branch.", "author": "dimitris-athanasiou", "createdAt": "2020-03-04T12:38:34Z", "path": "x-pack/plugin/core/src/main/java/org/elasticsearch/xpack/core/ml/dataframe/analyses/Classification.java", "diffHunk": "@@ -108,19 +120,26 @@ public Classification(String dependentVariable,\n         this.dependentVariable = ExceptionsHelper.requireNonNull(dependentVariable, DEPENDENT_VARIABLE);\n         this.boostedTreeParams = ExceptionsHelper.requireNonNull(boostedTreeParams, BoostedTreeParams.NAME);\n         this.predictionFieldName = predictionFieldName == null ? dependentVariable + \"_prediction\" : predictionFieldName;\n+        this.classAssignmentObjective = classAssignmentObjective == null ?\n+            ClassAssignmentObjective.MAXIMIZE_MINIMUM_RECALL : classAssignmentObjective;\n         this.numTopClasses = numTopClasses == null ? DEFAULT_NUM_TOP_CLASSES : numTopClasses;\n         this.trainingPercent = trainingPercent == null ? 100.0 : trainingPercent;\n         this.randomizeSeed = randomizeSeed == null ? Randomness.get().nextLong() : randomizeSeed;\n     }\n \n     public Classification(String dependentVariable) {\n-        this(dependentVariable, BoostedTreeParams.builder().build(), null, null, null, null);\n+        this(dependentVariable, BoostedTreeParams.builder().build(), null, null, null, null, null);\n     }\n \n     public Classification(StreamInput in) throws IOException {\n         dependentVariable = in.readString();\n         boostedTreeParams = new BoostedTreeParams(in);\n         predictionFieldName = in.readOptionalString();\n+        if (in.getVersion().onOrAfter(Version.V_7_7_0)) {", "originalCommit": "d8c4a770263ccee17a66e38d751441ee6024a53d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY2NTU0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387665549", "bodyText": "Are right, for backwards compatibility tests?", "author": "tveasey", "createdAt": "2020-03-04T13:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzOTE0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzY3NjU2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387676561", "bodyText": "Yes. In fact, it'd also be great to add the parameter in the classification BWC tests. I'll ping you to show you where they are.", "author": "dimitris-athanasiou", "createdAt": "2020-03-04T13:48:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzOTE0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzc1OTQ3OA==", "url": "https://github.com/elastic/elasticsearch/pull/52763#discussion_r387759478", "bodyText": "I added the tests in d635bde and temporarily switched the version to 8.0 in a1b5e2b.", "author": "tveasey", "createdAt": "2020-03-04T15:54:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzYzOTE0Nw=="}], "type": "inlineReview"}, {"oid": "beaf0604114c81529211a72de5db637510661438", "url": "https://github.com/elastic/elasticsearch/commit/beaf0604114c81529211a72de5db637510661438", "message": "Typo", "committedDate": "2020-03-04T14:21:50Z", "type": "commit"}, {"oid": "d635bde1762e1cbff76d1a95dd168b26807f10b0", "url": "https://github.com/elastic/elasticsearch/commit/d635bde1762e1cbff76d1a95dd168b26807f10b0", "message": "Backwards compatibility tests", "committedDate": "2020-03-04T14:22:06Z", "type": "commit"}, {"oid": "ed57848ff489345e4ab23d38fb1ed65f13e5c767", "url": "https://github.com/elastic/elasticsearch/commit/ed57848ff489345e4ab23d38fb1ed65f13e5c767", "message": "Merge branch 'master' into add-class-assignment-objective", "committedDate": "2020-03-04T14:22:46Z", "type": "commit"}, {"oid": "854fdf734bb5841364b098c79fb9a44e1b26e2eb", "url": "https://github.com/elastic/elasticsearch/commit/854fdf734bb5841364b098c79fb9a44e1b26e2eb", "message": "Quotes", "committedDate": "2020-03-04T14:25:21Z", "type": "commit"}, {"oid": "4e0ded77b33c9699553bc1a6e5df1216433fc3a0", "url": "https://github.com/elastic/elasticsearch/commit/4e0ded77b33c9699553bc1a6e5df1216433fc3a0", "message": "Move new parameter to end of constructor", "committedDate": "2020-03-04T15:47:04Z", "type": "commit"}, {"oid": "a1b5e2b90b30d20cebbf9febe8a78be8f73e9404", "url": "https://github.com/elastic/elasticsearch/commit/a1b5e2b90b30d20cebbf9febe8a78be8f73e9404", "message": "Only in version 8.0 at present", "committedDate": "2020-03-04T15:52:06Z", "type": "commit"}, {"oid": "ed56c5058993cffd893f0adc3ed512649eac62e1", "url": "https://github.com/elastic/elasticsearch/commit/ed56c5058993cffd893f0adc3ed512649eac62e1", "message": "Correct order in which fields are added to the parser", "committedDate": "2020-03-05T11:00:03Z", "type": "commit"}, {"oid": "08b2614ab1de436766f7d7717a4b43d68d799e62", "url": "https://github.com/elastic/elasticsearch/commit/08b2614ab1de436766f7d7717a4b43d68d799e62", "message": "Missing setup in bwc tests", "committedDate": "2020-03-05T11:09:48Z", "type": "commit"}, {"oid": "60189eeb9a3474d9ce90f9957ffb4a96863fff39", "url": "https://github.com/elastic/elasticsearch/commit/60189eeb9a3474d9ce90f9957ffb4a96863fff39", "message": "Always write to JSON", "committedDate": "2020-03-05T12:44:08Z", "type": "commit"}, {"oid": "b4aed75bf28324d8270cb1dd82bd689c60ab3701", "url": "https://github.com/elastic/elasticsearch/commit/b4aed75bf28324d8270cb1dd82bd689c60ab3701", "message": "Merge branch 'master' into add-class-assignment-objective", "committedDate": "2020-03-05T16:15:04Z", "type": "commit"}, {"oid": "4dfefc485287ac24ad2def60660d996b008ec057", "url": "https://github.com/elastic/elasticsearch/commit/4dfefc485287ac24ad2def60660d996b008ec057", "message": "Merge branch 'master' into add-class-assignment-objective", "committedDate": "2020-03-12T14:31:03Z", "type": "commit"}, {"oid": "47c3f98c814881ecbe82f3377aee278dd6807fa7", "url": "https://github.com/elastic/elasticsearch/commit/47c3f98c814881ecbe82f3377aee278dd6807fa7", "message": "Test fix", "committedDate": "2020-03-12T17:18:58Z", "type": "commit"}]}