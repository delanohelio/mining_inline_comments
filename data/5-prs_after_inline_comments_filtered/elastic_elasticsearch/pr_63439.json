{"pr_number": 63439, "pr_title": "Move helper into painless", "pr_createdAt": "2020-10-07T19:15:26Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63439", "timeline": [{"oid": "076ba03b7b945a573237c0d9b6be132ab3cac537", "url": "https://github.com/elastic/elasticsearch/commit/076ba03b7b945a573237c0d9b6be132ab3cac537", "message": "Move helper into painless\n\nThis moves `TemporalAccessor#toEpochMillis` out of runtime fields and\ninto painless directly so all contexts can use it. Now something like:\n```\nZonedDateTime.parse('2020-10-07T19:02:56.782Z').toEpochMilli()\n```\nis possible.", "committedDate": "2020-10-07T19:15:23Z", "type": "commit"}, {"oid": "8ecabcaec8bc537175163e0b220b8a9891987ff1", "url": "https://github.com/elastic/elasticsearch/commit/8ecabcaec8bc537175163e0b220b8a9891987ff1", "message": "Oh checkstyle, you skamp", "committedDate": "2020-10-07T19:22:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2MzQwNw==", "url": "https://github.com/elastic/elasticsearch/pull/63439#discussion_r501263407", "bodyText": "No suggestions here. Just surprised this is the best way to do it :).", "author": "jdconrad", "createdAt": "2020-10-07T19:38:57Z", "path": "modules/lang-painless/src/main/java/org/elasticsearch/painless/api/Augmentation.java", "diffHunk": "@@ -712,4 +715,13 @@ public static Matcher matcher(Pattern receiver, int limitFactor, CharSequence in\n         }\n         return receiver.matcher(new LimitedCharSequence(input, receiver, limitFactor));\n     }\n+\n+    /**\n+     * Convert a {@link TemporalAccessor} into millis since epoch like {@link Instant#toEpochMilli()}.\n+     */\n+    public static long toEpochMilli(TemporalAccessor v) {\n+        long millis = Math.multiplyExact(v.getLong(ChronoField.INSTANT_SECONDS), 1_000);\n+        millis = Math.addExact(millis, v.get(ChronoField.NANO_OF_SECOND) / 1_000_000);\n+        return millis;", "originalCommit": "8ecabcaec8bc537175163e0b220b8a9891987ff1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI3NTA3MQ==", "url": "https://github.com/elastic/elasticsearch/pull/63439#discussion_r501275071", "bodyText": "Its not exactly the clearest thing, no. If you know that you have a ZonedDateTime you can do zdt.toInstant().toEpochMilli() which does about the same thing but you have to worry about if the JVM can skip allocating the Instant.... And we're not sure we have a ZonedDateTime here either.", "author": "nik9000", "createdAt": "2020-10-07T20:00:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2MzQwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI4MDU5OQ==", "url": "https://github.com/elastic/elasticsearch/pull/63439#discussion_r501280599", "bodyText": "Makes sense. Thanks for the explanation!", "author": "jdconrad", "createdAt": "2020-10-07T20:11:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2MzQwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI5NTkwNg==", "url": "https://github.com/elastic/elasticsearch/pull/63439#discussion_r501295906", "bodyText": "Why the Math. calls instead of actual math?", "author": "rjernst", "createdAt": "2020-10-07T20:39:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI2MzQwNw=="}], "type": "inlineReview"}, {"oid": "2fc67a8efc76fa8a369af7a89ffee8d42c23f96f", "url": "https://github.com/elastic/elasticsearch/commit/2fc67a8efc76fa8a369af7a89ffee8d42c23f96f", "message": "Merge branch 'master' into to_epoch_millis_in_core", "committedDate": "2020-10-08T17:49:20Z", "type": "commit"}, {"oid": "813cae780f5cafad580208dd4676ca6b6504294f", "url": "https://github.com/elastic/elasticsearch/commit/813cae780f5cafad580208dd4676ca6b6504294f", "message": "Normal math and checkstyle", "committedDate": "2020-10-08T18:06:32Z", "type": "commit"}]}