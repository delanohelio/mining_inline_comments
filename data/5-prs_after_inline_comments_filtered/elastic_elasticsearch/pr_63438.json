{"pr_number": 63438, "pr_title": "Add factory methods for common value fetchers.", "pr_createdAt": "2020-10-07T18:51:34Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63438", "timeline": [{"oid": "f7b6422db08d3a16b6d14b5451cb719bb3a15fd2", "url": "https://github.com/elastic/elasticsearch/commit/f7b6422db08d3a16b6d14b5451cb719bb3a15fd2", "message": "Add a method SourceValueFetcher.identity.", "committedDate": "2020-10-07T18:50:28Z", "type": "commit"}, {"oid": "b3f2a839c5c6c068dd36539f63d7fb22d98cef00", "url": "https://github.com/elastic/elasticsearch/commit/b3f2a839c5c6c068dd36539f63d7fb22d98cef00", "message": "Add a method SourceValueFetcher.toString.", "committedDate": "2020-10-07T18:50:36Z", "type": "commit"}, {"oid": "5fa85c405eb31a4ba19c6a21b79557b898df438e", "url": "https://github.com/elastic/elasticsearch/commit/5fa85c405eb31a4ba19c6a21b79557b898df438e", "message": "Fix test failures.", "committedDate": "2020-10-07T19:29:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTI1ODk2Mg==", "url": "https://github.com/elastic/elasticsearch/pull/63438#discussion_r501258962", "bodyText": "Through this refactor I discovered that we were incorrectly applying nullValue to the root flattened field. I'll open another PR to clean up value fetching for flattened fields, which should be reviewed/ merged first.\nAn update: I opened #63443 to fix this.", "author": "jtibshirani", "createdAt": "2020-10-07T19:30:39Z", "path": "x-pack/plugin/mapper-flattened/src/main/java/org/elasticsearch/xpack/flattened/mapper/FlatObjectFieldMapper.java", "diffHunk": "@@ -471,15 +471,7 @@ public Object valueForDisplay(Object value) {\n \n         @Override\n         public ValueFetcher valueFetcher(MapperService mapperService, SearchLookup searchLookup, String format) {\n-            if (format != null) {\n-                throw new IllegalArgumentException(\"Field [\" + name() + \"] of type [\" + typeName() + \"] doesn't support formats.\");\n-            }\n-            return new SourceValueFetcher(name(), mapperService, nullValue) {", "originalCommit": "5fa85c405eb31a4ba19c6a21b79557b898df438e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2bbf7f64c2fa75366bfd59e18e557695777cd043", "url": "https://github.com/elastic/elasticsearch/commit/2bbf7f64c2fa75366bfd59e18e557695777cd043", "message": "Merge remote-tracking branch 'upstream/master' into fetcher-factories", "committedDate": "2020-10-08T17:11:22Z", "type": "commit"}]}