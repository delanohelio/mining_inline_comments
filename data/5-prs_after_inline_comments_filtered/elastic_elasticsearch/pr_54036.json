{"pr_number": 54036, "pr_title": "Add version guards around Transform hidden index settings", "pr_createdAt": "2020-03-23T22:28:04Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/54036", "timeline": [{"oid": "ef3f7bd414b3bd7cfaf619f50298786be36d3494", "url": "https://github.com/elastic/elasticsearch/commit/ef3f7bd414b3bd7cfaf619f50298786be36d3494", "message": "Revert \"[TEST] Mute transforms rolling upgrade tests (#53932)\"\n\nThis reverts commit 076ba02e9c41118d0c5615c59e7f3628363644b2.", "committedDate": "2020-03-23T15:39:33Z", "type": "commit"}, {"oid": "679e32618637e48b83b3c9f83e601a9ada28101d", "url": "https://github.com/elastic/elasticsearch/commit/679e32618637e48b83b3c9f83e601a9ada28101d", "message": "Add version guards around Transform hidden index settings\n\nThis commit ensures that the hidden index settings are only applied to the\nTransform index templates when the cluster can support those settings.", "committedDate": "2020-03-23T18:05:03Z", "type": "commit"}, {"oid": "9d79527e76256f39fbaf2f7db0ce5d2a9a604f8f", "url": "https://github.com/elastic/elasticsearch/commit/9d79527e76256f39fbaf2f7db0ce5d2a9a604f8f", "message": "Merge branch '7.x' into 7x/hidden/fix-transforms", "committedDate": "2020-03-24T00:19:46Z", "type": "commit"}, {"oid": "8507327c8f6c57337dc9ddfe2d073884868ce02f", "url": "https://github.com/elastic/elasticsearch/commit/8507327c8f6c57337dc9ddfe2d073884868ce02f", "message": "Revert \"Mute TransformSurvivesUpgradeIT.testTransformRollingUpgrade (#54037)\"\n\nThis reverts commit e225f08613a33afb75e4aa7e4b6aa550e14e5871.", "committedDate": "2020-03-24T00:25:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NDQ4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/54036#discussion_r396944487", "bodyText": "spelling nit: compatabilityVersion -> compatibilityVersion", "author": "hendrikmuhs", "createdAt": "2020-03-24T07:23:46Z", "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/persistence/TransformInternalIndex.java", "diffHunk": "@@ -96,19 +99,22 @@ public static IndexTemplateMetaData getIndexTemplateMetaData() throws IOExceptio\n         return transformTemplate;\n     }\n \n-    public static IndexTemplateMetaData getAuditIndexTemplateMetaData() throws IOException {\n+    public static IndexTemplateMetaData getAuditIndexTemplateMetaData(Version compatabilityVersion) throws IOException {", "originalCommit": "8507327c8f6c57337dc9ddfe2d073884868ce02f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzQ0NzA0MQ==", "url": "https://github.com/elastic/elasticsearch/pull/54036#discussion_r397447041", "bodyText": "Thanks, good catch.", "author": "gwbrown", "createdAt": "2020-03-24T20:40:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk0NDQ4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Njk4MTI3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/54036#discussion_r396981276", "bodyText": "FWIW, for later readers: I think this is the important change of this PR as this is the place where a (potentially new) non-master calls the (potentially old) master.", "author": "hendrikmuhs", "createdAt": "2020-03-24T08:40:14Z", "path": "x-pack/plugin/transform/src/main/java/org/elasticsearch/xpack/transform/persistence/TransformInternalIndex.java", "diffHunk": "@@ -399,7 +405,7 @@ protected static void installLatestAuditIndexTemplateIfRequired(\n \n         // Installing the template involves communication with the master node, so it's more expensive but much rarer\n         try {\n-            IndexTemplateMetaData indexTemplateMetaData = getAuditIndexTemplateMetaData();\n+            IndexTemplateMetaData indexTemplateMetaData = getAuditIndexTemplateMetaData(clusterService.state().nodes().getMinNodeVersion());", "originalCommit": "8507327c8f6c57337dc9ddfe2d073884868ce02f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "02a39a984e74688fbdf859e3a5709583b76ccaad", "url": "https://github.com/elastic/elasticsearch/commit/02a39a984e74688fbdf859e3a5709583b76ccaad", "message": "Spelling fix per review", "committedDate": "2020-03-24T20:39:33Z", "type": "commit"}]}