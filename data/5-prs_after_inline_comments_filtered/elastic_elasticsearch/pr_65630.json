{"pr_number": 65630, "pr_title": "[ML] Resume reassigning datafeed from loaded model snapshot", "pr_createdAt": "2020-11-30T19:34:34Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65630", "timeline": [{"oid": "1f413bfa2c4710e069f683b3b618f2353430ee18", "url": "https://github.com/elastic/elasticsearch/commit/1f413bfa2c4710e069f683b3b618f2353430ee18", "message": "[ML] Resume reassigning datafeed from loaded model snapshot\n\nThis fixes a long outstanding issue with the resume behaviour\nof a datafeed that has been reassigned on a node.\n\nWhen we resume a datafeed, we start from the latest result time\nor the latest record time, whichever is greater. This makes sense\nwhen a job had been closed gracefully previously.\n\nIn the scenario when a job is being reassigned, it is highly likely\nthat the job has seen data after the latest snapshot was persisted.\nThis means that with the current behaviour, we load that snapshot and\nthen we resume sending data from the point the job had reached previously.\nThis results to the model having a knowledge gap.\n\nThis commit addresses this by checking whether a reassining datafeed\nhas gone past its job's model snapshot and reverting the job to\nthat snapshot while deleting intervening results. Then we resume\nthe datafeed from the latest result or latest record of the snapshot.\n\nFixes #63400", "committedDate": "2020-11-30T19:30:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzIzODg2Nw==", "url": "https://github.com/elastic/elasticsearch/pull/65630#discussion_r533238867", "bodyText": "This might be more reusable if the argument was the node name rather than a DiscoveryNode - there might be places where test code knows a node name but doesn't have a complete DiscoveryNode object.", "author": "droberts195", "createdAt": "2020-12-01T09:44:51Z", "path": "test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java", "diffHunk": "@@ -1524,6 +1526,20 @@ public synchronized boolean stopRandomDataNode() throws IOException {\n         return false;\n     }\n \n+    /**\n+     * Stops a specific node in the cluster. Returns true if the node was found to stop, false otherwise.\n+     */\n+    public synchronized boolean stopNode(DiscoveryNode node) throws IOException {", "originalCommit": "1f413bfa2c4710e069f683b3b618f2353430ee18", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd6539b29e4e96a5805735417ea55919ca4645fb", "url": "https://github.com/elastic/elasticsearch/commit/fd6539b29e4e96a5805735417ea55919ca4645fb", "message": "Pass node name as string to stopNode() method", "committedDate": "2020-12-01T10:41:40Z", "type": "commit"}, {"oid": "db2aa30ef5921835ab91ab599e858c2d4ff434d5", "url": "https://github.com/elastic/elasticsearch/commit/db2aa30ef5921835ab91ab599e858c2d4ff434d5", "message": "Index model snapshot after lookback is done", "committedDate": "2020-12-01T11:09:18Z", "type": "commit"}]}