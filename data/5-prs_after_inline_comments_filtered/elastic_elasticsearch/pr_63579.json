{"pr_number": 63579, "pr_title": "Fix Background Merge Breaking Snapshot Restore Test", "pr_createdAt": "2020-10-12T21:26:40Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63579", "timeline": [{"oid": "d093567d687d5754544a3ef2c88e685106c7328e", "url": "https://github.com/elastic/elasticsearch/commit/d093567d687d5754544a3ef2c88e685106c7328e", "message": "Fix Background Merge Breaking Snapshot Restore Test\n\nIf we run into a background merge between creating the snapshot and closing the index\nthen with compound files we could be in a situation where we get zero file reuse\non restore.\nForce merging before the snapshot gives us a single segment that won't change down the line\nso the restore always sees file reuse from the close index.\n\nCloses #63476", "committedDate": "2020-10-12T21:23:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU0MDQxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/63579#discussion_r503540419", "bodyText": "These are unnecessary, we already set this rebalance to none in the parent (AbstractSnapshotIntegTestCase)", "author": "original-brownbear", "createdAt": "2020-10-12T21:27:31Z", "path": "server/src/internalClusterTest/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java", "diffHunk": "@@ -562,11 +561,8 @@ public void testRestoreIndexWithMissingShards() throws Exception {\n \n     public void testRestoreIndexWithShardsMissingInLocalGateway() throws Exception {\n         logger.info(\"--> start 2 nodes\");\n-        Settings nodeSettings = Settings.builder()", "originalCommit": "d093567d687d5754544a3ef2c88e685106c7328e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}