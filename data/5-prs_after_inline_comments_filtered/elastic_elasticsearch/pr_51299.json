{"pr_number": 51299, "pr_title": "Fix tests requiring timezone alignment", "pr_createdAt": "2020-01-22T09:52:27Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51299", "timeline": [{"oid": "855d2e073b9e69fe3af1953893ab1aa78b517ecf", "url": "https://github.com/elastic/elasticsearch/commit/855d2e073b9e69fe3af1953893ab1aa78b517ecf", "message": "Fix tests requiring timezone alignment\n\nThis commit will have the test comparing H2 against ES results have the\nH2 timezone sent to ES. This ensures that some timezone sensitive tests\nwhose results otherwise differ, will always work, no matter the\nrandomized timezone chosen for the test.", "committedDate": "2020-01-22T09:46:22Z", "type": "commit"}, {"oid": "5b5b577be41e9d342e8a4002f5742597578c1386", "url": "https://github.com/elastic/elasticsearch/commit/5b5b577be41e9d342e8a4002f5742597578c1386", "message": "remove disallowed API\n\n- removing use of String.toUpperCase().", "committedDate": "2020-01-22T10:02:03Z", "type": "commit"}, {"oid": "8c236b9de2166ecd1fc1e751ac1cb75107f060db", "url": "https://github.com/elastic/elasticsearch/commit/8c236b9de2166ecd1fc1e751ac1cb75107f060db", "message": "Prevent TZ-tests from running before hour change\n\nPrevent tests requring TZ sync'ing from running before the hour changes\n(which could trigger a day/month/year change).\n\nAlso comment better why TZ-sync'ing is required.", "committedDate": "2020-01-22T21:44:00Z", "type": "commit"}, {"oid": "12784ee92f3a223e620e050bfc381fd9e85d0ce3", "url": "https://github.com/elastic/elasticsearch/commit/12784ee92f3a223e620e050bfc381fd9e85d0ce3", "message": "Add more CURRENT_DATE/_TIME tests\n\nAlso change the MINUTE() tests to work with static values; the dynamic\n\"current\" ones can change between runs against H2 and ES.", "committedDate": "2020-01-22T21:46:42Z", "type": "commit"}, {"oid": "45a2b9bc1adb7fe5e9b7b1ab70653d3212531a7b", "url": "https://github.com/elastic/elasticsearch/commit/45a2b9bc1adb7fe5e9b7b1ab70653d3212531a7b", "message": "fix code style not cought by prechecks\n\ns/final private/private final/", "committedDate": "2020-01-22T21:59:45Z", "type": "commit"}, {"oid": "e0c485d1ef3d5b0aece683a5a52ba65f316a3a1d", "url": "https://github.com/elastic/elasticsearch/commit/e0c485d1ef3d5b0aece683a5a52ba65f316a3a1d", "message": "fix API usage with defaults\n\nLocalDateTime.now() needs to be given a ZoneId", "committedDate": "2020-01-22T22:15:45Z", "type": "commit"}, {"oid": "6db05ec9b5c11d5a1c72ff9d57571432fa1629b1", "url": "https://github.com/elastic/elasticsearch/commit/6db05ec9b5c11d5a1c72ff9d57571432fa1629b1", "message": "Further fixes for tests\n\n- MINUTE requires TZ sync when extracting from a timestamp, but needs\nmuting when comes from a time (H2 not having timezones attached to\nthose)", "committedDate": "2020-01-23T08:45:07Z", "type": "commit"}, {"oid": "929ecc0f9cef09fe8f8159ce63091bbb0f3f1198", "url": "https://github.com/elastic/elasticsearch/commit/929ecc0f9cef09fe8f8159ce63091bbb0f3f1198", "message": "Merge branch 'master' into fix/timezone_sensitive_tests", "committedDate": "2020-01-23T11:21:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2MTA5Nw==", "url": "https://github.com/elastic/elasticsearch/pull/51299#discussion_r371261097", "bodyText": "The name of the constant, I believe, has a typo in it: THREASHOLD vs THRESHOLD.", "author": "astefan", "createdAt": "2020-01-27T14:12:55Z", "path": "x-pack/plugin/sql/qa/src/main/java/org/elasticsearch/xpack/sql/qa/jdbc/SqlSpecTestCase.java", "diffHunk": "@@ -13,15 +13,19 @@\n import java.net.URL;\n import java.sql.Connection;\n import java.sql.ResultSet;\n+import java.time.LocalDateTime;\n+import java.time.ZoneId;\n import java.util.Arrays;\n import java.util.List;\n import java.util.Locale;\n+import java.util.TimeZone;\n \n /**\n  * Tests comparing sql queries executed against our jdbc client\n  * with those executed against H2's jdbc client.\n  */\n public abstract class SqlSpecTestCase extends SpecBaseIntegrationTestCase {\n+    private final int TZSYNC_MINUTE_THREASHOLD = 55;", "originalCommit": "929ecc0f9cef09fe8f8159ce63091bbb0f3f1198", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMyMjkyMA==", "url": "https://github.com/elastic/elasticsearch/pull/51299#discussion_r371322920", "bodyText": "thanks, fixed it.", "author": "bpintea", "createdAt": "2020-01-27T15:54:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2MTA5Nw=="}], "type": "inlineReview"}, {"oid": "1295d6e967d09d6934d6dedb683e06f1aaaeec15", "url": "https://github.com/elastic/elasticsearch/commit/1295d6e967d09d6934d6dedb683e06f1aaaeec15", "message": "Address review comments\n\ns/THREASHOLD/THRESHOLD/", "committedDate": "2020-01-27T15:52:45Z", "type": "commit"}]}