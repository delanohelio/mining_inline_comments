{"pr_number": 50869, "pr_title": "Fix format problem in composite of unmapped", "pr_createdAt": "2020-01-10T18:30:52Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/50869", "timeline": [{"oid": "be7d304546de64e908034fa69eece12b785949ce", "url": "https://github.com/elastic/elasticsearch/commit/be7d304546de64e908034fa69eece12b785949ce", "message": "Fix format problem in composite of unmapped\n\nWhen a composite aggregation is reduced using the results from an\nindex that has one of the fields unmapped we were throwing away the\nformatter. This is mildly annoying, except in the case of IP addresses\nwhich were coming out as non-utf-8-characters. And tripping assertions.\n\nThis carefully preserves the formatter from the working bucket.\n\nCloses #50600", "committedDate": "2020-01-10T18:29:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM3MDY0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/50869#discussion_r365370647", "bodyText": "I added these to help with debugging and figure they are probably fine to keep.", "author": "nik9000", "createdAt": "2020-01-10T18:31:19Z", "path": "server/src/main/java/org/elasticsearch/search/DocValueFormat.java", "diffHunk": "@@ -335,6 +340,11 @@ public String format(BytesRef value) {\n         public BytesRef parseBytesRef(String value) {\n             return new BytesRef(InetAddressPoint.encode(InetAddresses.forString(value)));\n         }\n+\n+        @Override\n+        public String toString() {\n+            return \"ip\";\n+        }", "originalCommit": "6e3bc8cf8e11bd9c677ff2617714c41103539abc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be7d304546de64e908034fa69eece12b785949ce", "url": "https://github.com/elastic/elasticsearch/commit/be7d304546de64e908034fa69eece12b785949ce", "message": "Fix format problem in composite of unmapped\n\nWhen a composite aggregation is reduced using the results from an\nindex that has one of the fields unmapped we were throwing away the\nformatter. This is mildly annoying, except in the case of IP addresses\nwhich were coming out as non-utf-8-characters. And tripping assertions.\n\nThis carefully preserves the formatter from the working bucket.\n\nCloses #50600", "committedDate": "2020-01-10T18:29:32Z", "type": "forcePushed"}, {"oid": "3065aafd6b54e558e0f07878bf32a3a8076d9b8e", "url": "https://github.com/elastic/elasticsearch/commit/3065aafd6b54e558e0f07878bf32a3a8076d9b8e", "message": "Skip old versions because it isn't fixed there", "committedDate": "2020-01-10T19:01:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTM5NjQ0Ng==", "url": "https://github.com/elastic/elasticsearch/pull/50869#discussion_r365396446", "bodyText": "Thank you for including a note of what we're testing, helps so much when debugging test failures!", "author": "not-napoleon", "createdAt": "2020-01-10T19:32:42Z", "path": "server/src/test/java/org/elasticsearch/search/aggregations/bucket/composite/InternalCompositeTests.java", "diffHunk": "@@ -249,6 +251,30 @@ public void testReduceSame() throws IOException {\n         }\n     }\n \n+    /**\n+     * Check that reducing with an unmapped index produces useful formats.", "originalCommit": "3065aafd6b54e558e0f07878bf32a3a8076d9b8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}