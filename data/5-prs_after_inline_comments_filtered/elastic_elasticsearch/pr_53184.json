{"pr_number": 53184, "pr_title": "Ensure only plugin REST tests are run for plugins", "pr_createdAt": "2020-03-05T19:39:43Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/53184", "timeline": [{"oid": "66d5f324642eede0bdb3c26236f685eaff8b1a5d", "url": "https://github.com/elastic/elasticsearch/commit/66d5f324642eede0bdb3c26236f685eaff8b1a5d", "message": "Ensure only plugin REST tests are run for plugins\n\nThis commit fixes ensures that for external builds\n(e.g. plugin development) that the REST tests that are\ncopied are properly filtered to only include the API\nby default.\n\nThe code prior to this change resulted in including both\nthe API and tests since the copy.include resulted as an\nempty list by default since the stream is empty unless\nexplictly configured.\n\nrelated #52114", "committedDate": "2020-03-05T19:31:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUyNDA5NQ==", "url": "https://github.com/elastic/elasticsearch/pull/53184#discussion_r388524095", "bodyText": "The fact we are calling the path prefix for api specs COPY_TO I think makes this hard to follow. I'm thinking \"why are we referencing the copy destination when filtering sources?\". If we are going to use this constant for both purposes, we should rename it appropriately, something like API_SPEC_PREFIX.", "author": "mark-vieira", "createdAt": "2020-03-05T19:47:54Z", "path": "buildSrc/src/main/java/org/elasticsearch/gradle/test/rest/CopyRestApiTask.java", "diffHunk": "@@ -132,7 +132,11 @@ void copy() {\n             project.copy(c -> {\n                 c.from(project.zipTree(coreConfig.getSingleFile()));\n                 c.into(getTestSourceSet().getOutput().getResourcesDir()); // this ends up as the same dir as outputDir\n-                c.include(includeCore.get().stream().map(prefix -> COPY_TO + \"/\" + prefix + \"*/**\").collect(Collectors.toList()));\n+                if (includeCore.get().isEmpty()) {\n+                    c.include(COPY_TO + \"/**\");", "originalCommit": "66d5f324642eede0bdb3c26236f685eaff8b1a5d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUzNzczNg==", "url": "https://github.com/elastic/elasticsearch/pull/53184#discussion_r388537736", "bodyText": "Renamed COPY_TO to REST_API_PREFIX and REST_TEST_PREFIX on  f8459c9", "author": "jakelandis", "createdAt": "2020-03-05T20:13:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODUyNDA5NQ=="}], "type": "inlineReview"}, {"oid": "f8459c9420d05ec90b70bbc75401ea5e1d84254e", "url": "https://github.com/elastic/elasticsearch/commit/f8459c9420d05ec90b70bbc75401ea5e1d84254e", "message": "rename some variables", "committedDate": "2020-03-05T20:12:30Z", "type": "commit"}, {"oid": "97eaa635bda6dbd4b21f6a53b08010104725d2f2", "url": "https://github.com/elastic/elasticsearch/commit/97eaa635bda6dbd4b21f6a53b08010104725d2f2", "message": "over the line Smokey", "committedDate": "2020-03-05T20:27:20Z", "type": "commit"}]}