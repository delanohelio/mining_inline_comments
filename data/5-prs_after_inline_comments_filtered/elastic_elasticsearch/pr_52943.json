{"pr_number": 52943, "pr_title": "Improve closing mock webserver when failed to start", "pr_createdAt": "2020-02-28T10:55:29Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/52943", "timeline": [{"oid": "fab80faf5d906cf63020d5061deb2bd36f8c875a", "url": "https://github.com/elastic/elasticsearch/commit/fab80faf5d906cf63020d5061deb2bd36f8c875a", "message": "Improve closing mock webserver when failed to start\n\nFix NPE when closing a webserver that hasn't started correctly.\n\nThis can happen when ssl context isn't initialized. The server instance is then never set,\nwhich causes an NPE that masks the actual failure.\n\nExample stacktrace that would mask an actual failure:\n\n```\njava.lang.NullPointerException\n\tat org.elasticsearch.test.http.MockWebServer.close(MockWebServer.java:271)\n\tat org.elasticsearch.xpack.watcher.test.integration.HttpSecretsIntegrationTests.cleanup(HttpSecretsIntegrationTests.java:70)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)\n```", "committedDate": "2020-02-28T10:53:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTYzMTk2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/52943#discussion_r385631961", "bodyText": "Fix for slightly different NPE:\njava.lang.NullPointerException\n\tat org.elasticsearch.xpack.watcher.actions.webhook.WebhookHttpsIntegrationTests.stopWebservice(WebhookHttpsIntegrationTests.java:75)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(Method.java:498)", "author": "martijnvg", "createdAt": "2020-02-28T10:56:24Z", "path": "x-pack/plugin/watcher/src/test/java/org/elasticsearch/xpack/watcher/actions/webhook/WebhookHttpsIntegrationTests.java", "diffHunk": "@@ -72,7 +72,9 @@ public void startWebservice() throws Exception {\n \n     @After\n     public void stopWebservice() throws Exception {\n-        webServer.close();\n+        if (webServer != null) {", "originalCommit": "fab80faf5d906cf63020d5061deb2bd36f8c875a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7fcf0a12db34e1edf15dd3e3730a7d31f4d27500", "url": "https://github.com/elastic/elasticsearch/commit/7fcf0a12db34e1edf15dd3e3730a7d31f4d27500", "message": "Merge remote-tracking branch 'es/master' into fix_npe_closing_mock_webserver", "committedDate": "2020-02-28T12:21:42Z", "type": "commit"}]}