{"pr_number": 58231, "pr_title": "Add data stream support to put mapping and update index settings APIs.", "pr_createdAt": "2020-06-17T09:19:06Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/58231", "timeline": [{"oid": "4d4481923dd1144ce1bf3e6686d2be889705b596", "url": "https://github.com/elastic/elasticsearch/commit/4d4481923dd1144ce1bf3e6686d2be889705b596", "message": "Add data stream support to put mapping and update index settings APIs.\n\nIf a data stream is used in the list of index expressions then each\ndata stream is resolved to the latest backing index (write index) of data stream.\n\nRelates #53100", "committedDate": "2020-06-17T09:18:13Z", "type": "commit"}, {"oid": "20400d75ab2e3b4dcce7919445073bcd3f871181", "url": "https://github.com/elastic/elasticsearch/commit/20400d75ab2e3b4dcce7919445073bcd3f871181", "message": "removed outdated yaml tests", "committedDate": "2020-06-17T11:41:03Z", "type": "commit"}, {"oid": "aa64e482dab9f2c798c28304811cfc1cbedd461d", "url": "https://github.com/elastic/elasticsearch/commit/aa64e482dab9f2c798c28304811cfc1cbedd461d", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings", "committedDate": "2020-06-28T18:13:25Z", "type": "commit"}, {"oid": "e283fa42482b44e689781f7d94c8558b0c560ae9", "url": "https://github.com/elastic/elasticsearch/commit/e283fa42482b44e689781f7d94c8558b0c560ae9", "message": "fixed compile errors after mere", "committedDate": "2020-06-28T18:24:44Z", "type": "commit"}, {"oid": "9def6e3768c3002eb483a6f12634cc244967fd87", "url": "https://github.com/elastic/elasticsearch/commit/9def6e3768c3002eb483a6f12634cc244967fd87", "message": "Change update index setting and put mapping api\nto execute on all backing indices if data stream is targeted.", "committedDate": "2020-06-28T19:32:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAwOTMxMw==", "url": "https://github.com/elastic/elasticsearch/pull/58231#discussion_r447009313", "bodyText": "Is this comment correct? It looks like it applies the mapping to all backing indices.", "author": "danhermann", "createdAt": "2020-06-29T14:21:39Z", "path": "server/src/internalClusterTest/java/org/elasticsearch/indices/DataStreamIT.java", "diffHunk": "@@ -592,6 +605,58 @@ public void testTimestampFieldCustomAttributes() throws Exception {\n         client().admin().indices().deleteDataStream(deleteDataStreamRequest).actionGet();\n     }\n \n+    public void testUpdateMappingViaDataStream() throws Exception {\n+        putComposableIndexTemplate(\"id1\", \"@timestamp\", List.of(\"logs-*\"));\n+        CreateDataStreamAction.Request createDataStreamRequest = new CreateDataStreamAction.Request(\"logs-foobar\");\n+        client().admin().indices().createDataStream(createDataStreamRequest).actionGet();\n+\n+        String backingIndex1 = DataStream.getDefaultBackingIndexName(\"logs-foobar\", 1);\n+        String backingIndex2 = DataStream.getDefaultBackingIndexName(\"logs-foobar\", 2);\n+\n+        RolloverResponse rolloverResponse = client().admin().indices().rolloverIndex(new RolloverRequest(\"logs-foobar\", null)).get();\n+        assertThat(rolloverResponse.getNewIndex(), equalTo(backingIndex2));\n+        assertTrue(rolloverResponse.isRolledOver());\n+\n+        Map<?, ?> expectedMapping = Map.of(\"properties\", Map.of(\"@timestamp\", Map.of(\"type\", \"date\")));\n+        GetMappingsResponse getMappingsResponse = getMapping(\"logs-foobar\").get();\n+        assertThat(getMappingsResponse.getMappings().size(), equalTo(2));\n+        assertThat(getMappingsResponse.getMappings().get(backingIndex1).getSourceAsMap(), equalTo(expectedMapping));\n+        assertThat(getMappingsResponse.getMappings().get(backingIndex2).getSourceAsMap(), equalTo(expectedMapping));\n+\n+        expectedMapping = Map.of(\"properties\", Map.of(\"@timestamp\", Map.of(\"type\", \"date\"), \"my_field\", Map.of(\"type\", \"keyword\")));\n+        putMapping(\"{\\\"properties\\\":{\\\"my_field\\\":{\\\"type\\\":\\\"keyword\\\"}}}\", \"logs-foobar\").get();\n+        // Only the mapping of th latest backing index should be updated:", "originalCommit": "9def6e3768c3002eb483a6f12634cc244967fd87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQ1MTYwMQ==", "url": "https://github.com/elastic/elasticsearch/pull/58231#discussion_r447451601", "bodyText": "\ud83d\udc4d let me fix that", "author": "martijnvg", "createdAt": "2020-06-30T06:55:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAwOTMxMw=="}], "type": "inlineReview"}, {"oid": "4a1ed45a9d36b51fa93c695b18526e021f9c1766", "url": "https://github.com/elastic/elasticsearch/commit/4a1ed45a9d36b51fa93c695b18526e021f9c1766", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings", "committedDate": "2020-06-30T06:55:35Z", "type": "commit"}, {"oid": "791289b976a82d6943a4db95b44213ef563949bb", "url": "https://github.com/elastic/elasticsearch/commit/791289b976a82d6943a4db95b44213ef563949bb", "message": "fix comment", "committedDate": "2020-06-30T06:56:56Z", "type": "commit"}, {"oid": "7f3823606fdb7a503e10989f22e20716a819d236", "url": "https://github.com/elastic/elasticsearch/commit/7f3823606fdb7a503e10989f22e20716a819d236", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings", "committedDate": "2020-06-30T08:43:10Z", "type": "commit"}, {"oid": "6c58a4f7f5821fbda507e01bea56e4dbf6a18c24", "url": "https://github.com/elastic/elasticsearch/commit/6c58a4f7f5821fbda507e01bea56e4dbf6a18c24", "message": "Merge remote-tracking branch 'es/master' into add_ds_support_put_mapping_update_settings", "committedDate": "2020-06-30T13:21:43Z", "type": "commit"}]}