{"pr_number": 51503, "pr_title": "Put values source types on fields", "pr_createdAt": "2020-01-27T22:10:47Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/51503", "timeline": [{"oid": "8c73edb6701a5352a63d88a59bdf765d4279fc9f", "url": "https://github.com/elastic/elasticsearch/commit/8c73edb6701a5352a63d88a59bdf765d4279fc9f", "message": "Initial tinkering around", "committedDate": "2020-01-24T15:00:56Z", "type": "commit"}, {"oid": "f425932552301ed71e33933d2f01dc771179ef1c", "url": "https://github.com/elastic/elasticsearch/commit/f425932552301ed71e33933d2f01dc771179ef1c", "message": "added the rest of the field -> vst mappings", "committedDate": "2020-01-27T19:21:23Z", "type": "commit"}, {"oid": "72ea0b8f28704dd1a354daf5ddb9f0d1e1cc531b", "url": "https://github.com/elastic/elasticsearch/commit/72ea0b8f28704dd1a354daf5ddb9f0d1e1cc531b", "message": "Clean up registration", "committedDate": "2020-01-27T22:06:31Z", "type": "commit"}, {"oid": "c7cc9babccd4dc59323b5e0c8bdd897046c18f3e", "url": "https://github.com/elastic/elasticsearch/commit/c7cc9babccd4dc59323b5e0c8bdd897046c18f3e", "message": "fix checkstyle", "committedDate": "2020-01-28T14:35:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2MDA2Ng==", "url": "https://github.com/elastic/elasticsearch/pull/51503#discussion_r371860066", "bodyText": "Oops, I forgot to include Booleans.  I'll push an update shortly.", "author": "not-napoleon", "createdAt": "2020-01-28T15:08:28Z", "path": "server/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java", "diffHunk": "@@ -72,11 +70,11 @@ public Aggregator build(String name, AggregatorFactories factories, double inter\n                     return new RangeHistogramAggregator(name, factories, interval, offset, order, keyed, minDocCount, minBound,\n                         maxBound, rangeValueSource, formatter, context, parent, pipelineAggregators, metaData);\n                 }\n-            },\n-            (fieldType, indexFieldData) -> fieldType instanceof RangeFieldMapper.RangeFieldType\n+            }\n         );\n \n-        valuesSourceRegistry.register(HistogramAggregationBuilder.NAME, CoreValuesSourceType.NUMERIC,\n+        valuesSourceRegistry.register(HistogramAggregationBuilder.NAME,\n+            List.of(CoreValuesSourceType.NUMERIC, CoreValuesSourceType.DATE),", "originalCommit": "c7cc9babccd4dc59323b5e0c8bdd897046c18f3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4e976b6ba0f074f888121326500dd6c17d4acbe8", "url": "https://github.com/elastic/elasticsearch/commit/4e976b6ba0f074f888121326500dd6c17d4acbe8", "message": "allow histograms of boolean fields", "committedDate": "2020-01-28T15:20:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2ODg3NA==", "url": "https://github.com/elastic/elasticsearch/pull/51503#discussion_r371868874", "bodyText": "Possible yes, encouraged not necessarily.  See warning on: https://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-id-field.html\n\nThe value of the _id field is also accessible in aggregations or for sorting, but doing so is discouraged as it requires to load a lot of data in memory. In case sorting or aggregating on the _id field is required, it is advised to duplicate the content of the _id field in another field that has doc_values enabled.", "author": "polyfractal", "createdAt": "2020-01-28T15:22:28Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java", "diffHunk": "@@ -153,6 +155,12 @@ public Query termsQuery(List<?> values, QueryShardContext context) {\n             return new TermInSetQuery(name(), bytesRefs);\n         }\n \n+        @Override\n+        public ValuesSourceType getValuesSourceType() {\n+            // TODO: should this even exist? Is aggregating on the ID field valid?", "originalCommit": "4e976b6ba0f074f888121326500dd6c17d4acbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg4OTk2Mw==", "url": "https://github.com/elastic/elasticsearch/pull/51503#discussion_r371889963", "bodyText": "It's an _index sorta-metadata field that we add to the doc, mainly for use with querying to differentiate between different indices.  But I've seen it used in aggs before, like Terms, to partition based on index\nhttps://www.elastic.co/guide/en/elasticsearch/reference/current/mapping-index-field.html", "author": "polyfractal", "createdAt": "2020-01-28T15:53:40Z", "path": "server/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java", "diffHunk": "@@ -189,6 +191,12 @@ public Query wildcardQuery(String value,\n         public IndexFieldData.Builder fielddataBuilder(String fullyQualifiedIndexName) {\n             return new ConstantIndexFieldData.Builder(mapperService -> fullyQualifiedIndexName);\n         }\n+\n+        @Override\n+        public ValuesSourceType getValuesSourceType() {\n+            // TODO: Should Index fields be aggregatable?  What even is an IndexField?", "originalCommit": "4e976b6ba0f074f888121326500dd6c17d4acbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}