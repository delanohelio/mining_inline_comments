{"pr_number": 61354, "pr_title": "[API keys] Add full_name and email to API key doc and use them to populate authing User", "pr_createdAt": "2020-08-20T05:42:16Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/61354", "timeline": [{"oid": "18fa022b200ecdde9e405134ecf78a7659c024fb", "url": "https://github.com/elastic/elasticsearch/commit/18fa022b200ecdde9e405134ecf78a7659c024fb", "message": "[API keys] Add full_name and email to API key doc and use them to populate user\n\nThe API key document currently doesn't include the user's full_name or\nemail attributes.\n\nThis changeset adds those fields to the document and extracts them to fill\nin the User when authenticating. They're effectively going to be a snapshot\nof the User from when the key was created, but this is in line with roles\nand metadata as well.\n\nSigned-off-by: lloydmeta <lloydmeta@gmail.com>", "committedDate": "2020-08-20T05:57:38Z", "type": "commit"}, {"oid": "18fa022b200ecdde9e405134ecf78a7659c024fb", "url": "https://github.com/elastic/elasticsearch/commit/18fa022b200ecdde9e405134ecf78a7659c024fb", "message": "[API keys] Add full_name and email to API key doc and use them to populate user\n\nThe API key document currently doesn't include the user's full_name or\nemail attributes.\n\nThis changeset adds those fields to the document and extracts them to fill\nin the User when authenticating. They're effectively going to be a snapshot\nof the User from when the key was created, but this is in line with roles\nand metadata as well.\n\nSigned-off-by: lloydmeta <lloydmeta@gmail.com>", "committedDate": "2020-08-20T05:57:38Z", "type": "forcePushed"}, {"oid": "7b960e4e4b26cbb9dcd9eb4226e3f55cbf2b44b8", "url": "https://github.com/elastic/elasticsearch/commit/7b960e4e4b26cbb9dcd9eb4226e3f55cbf2b44b8", "message": "* Checkstyle formatting fix.\n\nSigned-off-by: lloydmeta <lloydmeta@gmail.com>", "committedDate": "2020-08-20T06:58:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc5MDg0OQ==", "url": "https://github.com/elastic/elasticsearch/pull/61354#discussion_r473790849", "bodyText": "nit: use Bruce Baner, or anything else for that matter so that it's easier to spot it's different from the principal, in the eventual case of troubleshooting a test failure", "author": "jkakavas", "createdAt": "2020-08-20T09:03:53Z", "path": "x-pack/plugin/security/src/test/java/org/elasticsearch/xpack/security/authc/ApiKeyServiceTests.java", "diffHunk": "@@ -196,16 +196,18 @@ public void testAuthenticateWithApiKey() throws Exception {\n \n         final User user;\n         if (randomBoolean()) {\n-            user = new User(\"hulk\", new String[] { \"superuser\" }, new User(\"authenticated_user\", new String[] { \"other\" }));\n+            user = new User(new User(\"hulk\", new String[]{\"superuser\"}, \"hulk\", \"hulk@test.com\", Map.of(), true), new User(\"authenticated_user\", new String[]{\"other\"}));\n         } else {\n-            user = new User(\"hulk\", new String[] { \"superuser\" });\n+            user = new User(\"hulk\", new String[]{\"superuser\"}, \"hulk\", \"hulk@test.com\", Map.of(), true);\n         }\n         mockKeyDocument(service, id, key, user);\n \n         final AuthenticationResult auth = tryAuthenticate(service, id, key);\n         assertThat(auth.getStatus(), is(AuthenticationResult.Status.SUCCESS));\n         assertThat(auth.getUser(), notNullValue());\n         assertThat(auth.getUser().principal(), is(\"hulk\"));\n+        assertThat(auth.getUser().fullName(), is(\"hulk\"));", "originalCommit": "18fa022b200ecdde9e405134ecf78a7659c024fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgyOTEyMw==", "url": "https://github.com/elastic/elasticsearch/pull/61354#discussion_r473829123", "bodyText": "++ nice one, fixed.", "author": "lloydmeta", "createdAt": "2020-08-20T09:49:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mzc5MDg0OQ=="}], "type": "inlineReview"}, {"oid": "a13a122ac6d41d4ce702e51ab7f1cf6e5a0eff8e", "url": "https://github.com/elastic/elasticsearch/commit/a13a122ac6d41d4ce702e51ab7f1cf6e5a0eff8e", "message": "Fix name in test\n\nSigned-off-by: lloydmeta <lloydmeta@gmail.com>", "committedDate": "2020-08-20T09:49:53Z", "type": "commit"}, {"oid": "a13a122ac6d41d4ce702e51ab7f1cf6e5a0eff8e", "url": "https://github.com/elastic/elasticsearch/commit/a13a122ac6d41d4ce702e51ab7f1cf6e5a0eff8e", "message": "Fix name in test\n\nSigned-off-by: lloydmeta <lloydmeta@gmail.com>", "committedDate": "2020-08-20T09:49:53Z", "type": "forcePushed"}]}