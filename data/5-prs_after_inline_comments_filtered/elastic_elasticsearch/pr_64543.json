{"pr_number": 64543, "pr_title": "Convert some object mapper testcases to use MapperServiceTestCase", "pr_createdAt": "2020-11-03T17:39:52Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/64543", "timeline": [{"oid": "52283ab0712567023d2ee579680d3994526c3bf0", "url": "https://github.com/elastic/elasticsearch/commit/52283ab0712567023d2ee579680d3994526c3bf0", "message": "Convert some object mapper testcases to use MapperServiceTestCase", "committedDate": "2020-11-03T17:38:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNzQ2ODk1OA==", "url": "https://github.com/elastic/elasticsearch/pull/64543#discussion_r517468958", "bodyText": "Could you add the indenting back for this one?", "author": "nik9000", "createdAt": "2020-11-04T16:25:09Z", "path": "server/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java", "diffHunk": "@@ -436,61 +448,62 @@ public void testMultipleLevelsIncludeRoot2() throws Exception {\n \n         ParsedDocument doc = docMapper.parse(new SourceToParse(\"test\", \"1\",\n             BytesReference.bytes(XContentFactory.jsonBuilder()\n-                        .startObject().startArray(\"nested1\")\n-                        .startObject().startArray(\"nested2\")\n-                        .startObject().startArray(\"nested3\").startObject().field(\"foo\", \"bar\")\n-                        .endObject().endArray().endObject().endArray().endObject().endArray()\n-                        .endObject()),\n+                .startObject().startArray(\"nested1\")\n+                .startObject().startArray(\"nested2\")\n+                .startObject().startArray(\"nested3\").startObject().field(\"foo\", \"bar\")\n+                .endObject().endArray().endObject().endArray().endObject().endArray()\n+                .endObject()),\n             XContentType.JSON));\n \n         final Collection<IndexableField> fields = doc.rootDoc().getFields();\n         assertThat(fields.size(), equalTo(new HashSet<>(fields).size()));\n     }\n \n-   /**\n+    /**\n      * Same as {@link NestedObjectMapperTests#testMultipleLevelsIncludeRoot1()} but tests that\n      * the redundant includes are removed even if each individual mapping doesn't contain the\n      * redundancy, only the merged mapping does.\n      */\n     public void testMultipleLevelsIncludeRootWithMerge() throws Exception {\n-        MapperService mapperService = createIndex(\"test\").mapperService();\n+        MapperService mapperService = createMapperService(mapping(b -> {\n+        }));\n \n         String firstMapping = Strings.toString(XContentFactory.jsonBuilder().startObject()\n             .startObject(MapperService.SINGLE_MAPPING_NAME)\n-                .startObject(\"properties\")", "originalCommit": "52283ab0712567023d2ee579680d3994526c3bf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e3479ba0885a58132efe2c18998875e30c8dbe04", "url": "https://github.com/elastic/elasticsearch/commit/e3479ba0885a58132efe2c18998875e30c8dbe04", "message": "Merge remote-tracking branch 'origin/master' into mapper/object-tests", "committedDate": "2020-11-04T16:54:58Z", "type": "commit"}, {"oid": "112a5fc3701d6fdddb23ddca84524dace4959483", "url": "https://github.com/elastic/elasticsearch/commit/112a5fc3701d6fdddb23ddca84524dace4959483", "message": "indentation", "committedDate": "2020-11-04T16:56:34Z", "type": "commit"}]}