{"pr_number": 62578, "pr_title": "Dry up Snapshot IT Infrastructure", "pr_createdAt": "2020-09-17T17:45:26Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/62578", "timeline": [{"oid": "25b0b6d728eeb381c6dcaf208bad03b8c7e09c94", "url": "https://github.com/elastic/elasticsearch/commit/25b0b6d728eeb381c6dcaf208bad03b8c7e09c94", "message": "Dry up Snapshot IT Infrastructure\n\nMainly just shortening the diff of #61839 here by moving test utilities\nto the abstract test case.\nAlso, making use of the now available functionality to simplify existing tests\nand improve logging in them.", "committedDate": "2020-09-17T17:41:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkwNTAxNw==", "url": "https://github.com/elastic/elasticsearch/pull/62578#discussion_r490905017", "bodyText": "Maybe awaitNumberOfSnapshotsInProgress() ?", "author": "tlrx", "createdAt": "2020-09-18T12:09:05Z", "path": "server/src/internalClusterTest/java/org/elasticsearch/snapshots/SnapshotStatusApisIT.java", "diffHunk": "@@ -101,16 +101,9 @@ public void testStatusAPICallInProgressSnapshot() throws Exception {\n \n         logger.info(\"--> wait for data nodes to get blocked\");\n         waitForBlockOnAnyDataNode(\"test-repo\", TimeValue.timeValueMinutes(1));\n-\n-        assertBusy(() -> {\n-            try {\n-                assertEquals(SnapshotsInProgress.State.STARTED, client.admin().cluster().snapshotsStatus(\n-                        new SnapshotsStatusRequest(\"test-repo\", new String[]{\"test-snap\"})).actionGet().getSnapshots().get(0)\n-                        .getState());\n-            } catch (SnapshotMissingException sme) {\n-                throw new AssertionError(sme);\n-            }\n-        }, 1L, TimeUnit.MINUTES);\n+        awaitNSnapshotsInProgress(1);", "originalCommit": "25b0b6d728eeb381c6dcaf208bad03b8c7e09c94", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "705c0a180f58659036e91a81ccbf2654b8c0661e", "url": "https://github.com/elastic/elasticsearch/commit/705c0a180f58659036e91a81ccbf2654b8c0661e", "message": "Merge remote-tracking branch 'elastic/master' into drier-snapshot-tests", "committedDate": "2020-09-18T12:59:16Z", "type": "commit"}, {"oid": "ce91d3b8dc00d0232aa841b60af72f749764aef0", "url": "https://github.com/elastic/elasticsearch/commit/ce91d3b8dc00d0232aa841b60af72f749764aef0", "message": "rename", "committedDate": "2020-09-18T13:02:13Z", "type": "commit"}]}