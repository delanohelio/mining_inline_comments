{"pr_number": 65314, "pr_title": "Configurable MIME type for mustache template encoding on set processor", "pr_createdAt": "2020-11-20T14:03:53Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/65314", "timeline": [{"oid": "ea64cc8c297839d3c5d12c3be5365e7fbb4a251a", "url": "https://github.com/elastic/elasticsearch/commit/ea64cc8c297839d3c5d12c3be5365e7fbb4a251a", "message": "configurable MIME type for mustache template encoding", "committedDate": "2020-11-19T23:55:33Z", "type": "commit"}, {"oid": "133bef8d70dc16b0df85b88760087637fb4ce2e6", "url": "https://github.com/elastic/elasticsearch/commit/133bef8d70dc16b0df85b88760087637fb4ce2e6", "message": "add unit test and DRY up constants", "committedDate": "2020-11-24T15:46:32Z", "type": "commit"}, {"oid": "fa616b65a4b951079fb7aafccdda8fbcbc2091fa", "url": "https://github.com/elastic/elasticsearch/commit/fa616b65a4b951079fb7aafccdda8fbcbc2091fa", "message": "Merge branch 'master' into 65115_set_processor_escape_chars", "committedDate": "2020-11-24T18:41:59Z", "type": "commit"}, {"oid": "aefd9dce21e124c88016bc6bd884495df0803d2c", "url": "https://github.com/elastic/elasticsearch/commit/aefd9dce21e124c88016bc6bd884495df0803d2c", "message": "checkstyle", "committedDate": "2020-11-24T19:28:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4NzUxMw==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553387513", "bodyText": "are we sure we want mime_type as a name here? I thought mime was replace with media_type\nbut wouldn't content_type  be more consistent with what we have in mustache templating engine?", "author": "pgomulka", "createdAt": "2021-01-07T15:10:39Z", "path": "modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/SetProcessor.java", "diffHunk": "@@ -110,10 +111,11 @@ public SetProcessor create(Map<String, Processor.Factory> registry, String proce\n                                    String description, Map<String, Object> config) throws Exception {\n             String field = ConfigurationUtils.readStringProperty(TYPE, processorTag, config, \"field\");\n             String copyFrom = ConfigurationUtils.readOptionalStringProperty(TYPE, processorTag, config, \"copy_from\");\n+            String mimeType = ConfigurationUtils.readMimeTypeProperty(TYPE, processorTag, config, \"mime_type\", \"application/json\");", "originalCommit": "aefd9dce21e124c88016bc6bd884495df0803d2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM5MDYxOQ==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553390619", "bodyText": "or we could consider to rename the content_type to media_type (in mustache template engine)?", "author": "pgomulka", "createdAt": "2021-01-07T15:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4NzUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM5NDg3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553394873", "bodyText": "I'm happy to rename to whatever is most appropriate. I went with mime_type because that is what was used in CustomMustacheFactory but I would agree that media_type or possibly content_type would be better.", "author": "danhermann", "createdAt": "2021-01-07T15:22:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4NzUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzUwNzgyMg==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553507822", "bodyText": "+1 to follow up with a change to media_type to be more correct.", "author": "jakelandis", "createdAt": "2021-01-07T18:31:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4NzUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4ODkxNA==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553388914", "bodyText": "do we want the se hardcoded? What if someone specifies application/json; charset=utf-8 ?\nWould it be of any help if this bit was unified with what CustomMustacheFactory defines? I made an attempt here https://github.com/elastic/elasticsearch/pull/66857/files#diff-207cacc1e4a5b24109a693c0b63dd762156452bb5984b5ce04499b28e6c191e8R28", "author": "pgomulka", "createdAt": "2021-01-07T15:13:06Z", "path": "server/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java", "diffHunk": "@@ -49,6 +49,7 @@\n \n     public static final String TAG_KEY = \"tag\";\n     public static final String DESCRIPTION_KEY = \"description\";\n+    public static final String[] VALID_MIME_TYPES = {\"application/json\", \"text/plain\", \"application/x-www-form-urlencoded\"};", "originalCommit": "aefd9dce21e124c88016bc6bd884495df0803d2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM5OTAyMA==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r553399020", "bodyText": "I agree that unifying this set of options would be good. I can do that after you merge that PR. I don't believe that we want to allow the specification of a particular character set for the use case of the ingest processor, though.", "author": "danhermann", "createdAt": "2021-01-07T15:28:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4ODkxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2MTEzNzAxNw==", "url": "https://github.com/elastic/elasticsearch/pull/65314#discussion_r561137017", "bodyText": "Now that #66857 has been closed in favor of #67677, I believe the only improvement that can be made here is changing content_type to media_type. I'll go ahead and open a PR for that.", "author": "danhermann", "createdAt": "2021-01-20T17:16:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzM4ODkxNA=="}], "type": "inlineReview"}]}