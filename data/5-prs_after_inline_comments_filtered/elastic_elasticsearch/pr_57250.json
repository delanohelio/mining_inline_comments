{"pr_number": 57250, "pr_title": "Run sort optimization when from+size>0", "pr_createdAt": "2020-05-27T19:23:07Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/57250", "timeline": [{"oid": "6f58568482650c579fff5b88fd01699a0d6a47a7", "url": "https://github.com/elastic/elasticsearch/commit/6f58568482650c579fff5b88fd01699a0d6a47a7", "message": "Run sort optimization when from+size>0\n\nRelated to #57044", "committedDate": "2020-05-27T19:21:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxODE0Nw==", "url": "https://github.com/elastic/elasticsearch/pull/57250#discussion_r431418147", "bodyText": "A suggestion (feel free to ignore) -- since this is getting a bit long we could pull it out into a method like boolean runSortOptimization(...) for clarity.", "author": "jtibshirani", "createdAt": "2020-05-27T20:19:37Z", "path": "server/src/main/java/org/elasticsearch/search/query/QueryPhase.java", "diffHunk": "@@ -244,7 +244,7 @@ static boolean executeInternal(SearchContext searchContext) throws QueryPhaseExe\n \n             CheckedConsumer<List<LeafReaderContext>, IOException> leafSorter = l -> {};\n             // try to rewrite numeric or date sort to the optimized distanceFeatureQuery\n-            if ((searchContext.sort() != null) && (searchContext.size() > 0) && SYS_PROP_REWRITE_SORT) {\n+            if ((searchContext.sort() != null) && ((searchContext.from() + searchContext.size()) > 0) && SYS_PROP_REWRITE_SORT) {", "originalCommit": "6f58568482650c579fff5b88fd01699a0d6a47a7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQ2MTc4MA==", "url": "https://github.com/elastic/elasticsearch/pull/57250#discussion_r431461780", "bodyText": "@jtibshirani Thanks for the feedback. I have moved this check to tryRewriteLongSort function.", "author": "mayya-sharipova", "createdAt": "2020-05-27T21:47:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxODE0Nw=="}], "type": "inlineReview"}, {"oid": "8bf1381d9132bc1381f59f29fd976bd5c64c1c09", "url": "https://github.com/elastic/elasticsearch/commit/8bf1381d9132bc1381f59f29fd976bd5c64c1c09", "message": "Move size and from heck to the function", "committedDate": "2020-05-27T22:08:54Z", "type": "commit"}, {"oid": "8bf1381d9132bc1381f59f29fd976bd5c64c1c09", "url": "https://github.com/elastic/elasticsearch/commit/8bf1381d9132bc1381f59f29fd976bd5c64c1c09", "message": "Move size and from heck to the function", "committedDate": "2020-05-27T22:08:54Z", "type": "forcePushed"}]}