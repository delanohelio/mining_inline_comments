{"pr_number": 56404, "pr_title": "QL: case sensitive support in EQL", "pr_createdAt": "2020-05-08T07:46:21Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/56404", "timeline": [{"oid": "e6b0d194079c48ee1600807cdacf7ea802c2df87", "url": "https://github.com/elastic/elasticsearch/commit/e6b0d194079c48ee1600807cdacf7ea802c2df87", "message": "* StartsWith is case sensitive aware\n* Added case sensitivity to EQL configuration\n* case_sensitive parameter can be specified when running queries (default\nis case insensitive)\n* Added STARTS_WITH function to SQL as well", "committedDate": "2020-05-07T20:34:35Z", "type": "commit"}, {"oid": "be3be7a41373049fb3dc413e99b6a1ef60e01c9a", "url": "https://github.com/elastic/elasticsearch/commit/be3be7a41373049fb3dc413e99b6a1ef60e01c9a", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 55340_enhancement3", "committedDate": "2020-05-07T20:35:51Z", "type": "commit"}, {"oid": "4fbbec0e05f1794d2e937b4f212f1efb9bd0a5f8", "url": "https://github.com/elastic/elasticsearch/commit/4fbbec0e05f1794d2e937b4f212f1efb9bd0a5f8", "message": "Add case sensitive aware queryfolder tests", "committedDate": "2020-05-08T07:15:47Z", "type": "commit"}, {"oid": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "url": "https://github.com/elastic/elasticsearch/commit/166c232dba6e9eb18aefebb8de38ec238f87e96d", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 55340_enhancement3", "committedDate": "2020-05-08T07:31:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYyODYwNg==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r422628606", "bodyText": "Maybe add isCaseSensitive to the ql configuration with default value and avoid the cast?", "author": "matriv", "createdAt": "2020-05-10T11:06:39Z", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/expression/function/scalar/string/StartsWith.java", "diffHunk": "@@ -6,115 +6,20 @@\n \n package org.elasticsearch.xpack.eql.expression.function.scalar.string;\n \n+import org.elasticsearch.xpack.eql.session.EqlConfiguration;\n import org.elasticsearch.xpack.ql.expression.Expression;\n-import org.elasticsearch.xpack.ql.expression.Expressions;\n-import org.elasticsearch.xpack.ql.expression.Expressions.ParamOrdinal;\n-import org.elasticsearch.xpack.ql.expression.FieldAttribute;\n-import org.elasticsearch.xpack.ql.expression.function.scalar.ScalarFunction;\n-import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n-import org.elasticsearch.xpack.ql.expression.gen.script.ScriptTemplate;\n-import org.elasticsearch.xpack.ql.expression.gen.script.Scripts;\n-import org.elasticsearch.xpack.ql.tree.NodeInfo;\n+import org.elasticsearch.xpack.ql.session.Configuration;\n import org.elasticsearch.xpack.ql.tree.Source;\n-import org.elasticsearch.xpack.ql.type.DataType;\n-import org.elasticsearch.xpack.ql.type.DataTypes;\n \n-import java.util.Arrays;\n-import java.util.List;\n-import java.util.Locale;\n+public class StartsWith extends org.elasticsearch.xpack.ql.expression.function.scalar.string.StartsWith {\n \n-import static java.lang.String.format;\n-import static org.elasticsearch.xpack.eql.expression.function.scalar.string.StartsWithFunctionProcessor.doProcess;\n-import static org.elasticsearch.xpack.ql.expression.TypeResolutions.isStringAndExact;\n-import static org.elasticsearch.xpack.ql.expression.gen.script.ParamsBuilder.paramsBuilder;\n-\n-/**\n- * Function that checks if first parameter starts with the second parameter. Both parameters should be strings\n- * and the function returns a boolean value. The function is case insensitive.\n- */\n-public class StartsWith extends ScalarFunction {\n-\n-    private final Expression source;\n-    private final Expression pattern;\n-\n-    public StartsWith(Source source, Expression src, Expression pattern) {\n-        super(source, Arrays.asList(src, pattern));\n-        this.source = src;\n-        this.pattern = pattern;\n-    }\n-\n-    @Override\n-    protected TypeResolution resolveType() {\n-        if (!childrenResolved()) {\n-            return new TypeResolution(\"Unresolved children\");\n-        }\n-\n-        TypeResolution sourceResolution = isStringAndExact(source, sourceText(), ParamOrdinal.FIRST);\n-        if (sourceResolution.unresolved()) {\n-            return sourceResolution;\n-        }\n-\n-        return isStringAndExact(pattern, sourceText(), ParamOrdinal.SECOND);\n+    public StartsWith(Source source, Expression field, Expression pattern, Configuration configuration) {\n+        super(source, field, pattern, configuration);\n     }\n \n     @Override\n-    protected Pipe makePipe() {\n-        return new StartsWithFunctionPipe(source(), this, Expressions.pipe(source), Expressions.pipe(pattern));\n-    }\n-\n-    @Override\n-    public boolean foldable() {\n-        return source.foldable() && pattern.foldable();\n-    }\n-\n-    @Override\n-    public Object fold() {\n-        return doProcess(source.fold(), pattern.fold());\n-    }\n-\n-    @Override\n-    protected NodeInfo<? extends Expression> info() {\n-        return NodeInfo.create(this, StartsWith::new, source, pattern);\n-    }\n-\n-    @Override\n-    public ScriptTemplate asScript() {\n-        ScriptTemplate sourceScript = asScript(source);\n-        ScriptTemplate patternScript = asScript(pattern);\n-\n-        return asScriptFrom(sourceScript, patternScript);\n-    }\n-    \n-    protected ScriptTemplate asScriptFrom(ScriptTemplate sourceScript, ScriptTemplate patternScript) {\n-        return new ScriptTemplate(format(Locale.ROOT, formatTemplate(\"{eql}.%s(%s,%s)\"),\n-                \"startsWith\",\n-                sourceScript.template(),\n-                patternScript.template()),\n-                paramsBuilder()\n-                    .script(sourceScript.params())\n-                    .script(patternScript.params())\n-                    .build(), dataType());\n-    }\n-\n-    @Override\n-    public ScriptTemplate scriptWithField(FieldAttribute field) {\n-        return new ScriptTemplate(processScript(Scripts.DOC_VALUE),\n-                paramsBuilder().variable(field.exactAttribute().name()).build(),\n-                dataType());\n-    }\n-\n-    @Override\n-    public DataType dataType() {\n-        return DataTypes.BOOLEAN;\n-    }\n-\n-    @Override\n-    public Expression replaceChildren(List<Expression> newChildren) {\n-        if (newChildren.size() != 2) {\n-            throw new IllegalArgumentException(\"expected [2] children but received [\" + newChildren.size() + \"]\");\n-        }\n-\n-        return new StartsWith(source(), newChildren.get(0), newChildren.get(1));\n+    public boolean isCaseSensitive() {\n+        return ((EqlConfiguration) configuration()).isCaseSensitive();", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2OTAzMQ==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423169031", "bodyText": "I disagree - that would cause SqlConfiguration to have a case sensitivity option that is meaningless.", "author": "costin", "createdAt": "2020-05-11T16:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYyODYwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYyODc2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r422628761", "bodyText": "minor: whitespace", "author": "matriv", "createdAt": "2020-05-10T11:08:02Z", "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/analysis/VerifierTests.java", "diffHunk": "@@ -1,11 +1,12 @@\n /*\n- * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+  * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYyOTQyNQ==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r422629425", "bodyText": "Could you please add test with just changing the case sensitive flag?\nand maybe one more where all of field/pattern/caseSensitive/flag are changed.", "author": "matriv", "createdAt": "2020-05-10T11:13:46Z", "path": "x-pack/plugin/ql/src/test/java/org/elasticsearch/xpack/ql/expression/function/scalar/string/StartsWithFunctionPipeTests.java", "diffHunk": "@@ -0,0 +1,127 @@\n+/*\n+ * Copyright Elasticsearch B.V. and/or licensed to Elasticsearch B.V. under one\n+ * or more contributor license agreements. Licensed under the Elastic License;\n+ * you may not use this file except in compliance with the Elastic License.\n+ */\n+\n+package org.elasticsearch.xpack.ql.expression.function.scalar.string;\n+\n+import org.elasticsearch.xpack.ql.TestUtils;\n+import org.elasticsearch.xpack.ql.expression.Expression;\n+import org.elasticsearch.xpack.ql.expression.gen.pipeline.Pipe;\n+import org.elasticsearch.xpack.ql.tree.AbstractNodeTestCase;\n+import org.elasticsearch.xpack.ql.tree.Source;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Objects;\n+import java.util.function.Function;\n+\n+import static org.elasticsearch.xpack.ql.expression.Expressions.pipe;\n+import static org.elasticsearch.xpack.ql.expression.function.scalar.FunctionTestUtils.randomStringLiteral;\n+import static org.elasticsearch.xpack.ql.tree.SourceTests.randomSource;\n+\n+public class StartsWithFunctionPipeTests extends AbstractNodeTestCase<StartsWithFunctionPipe, Pipe> {\n+\n+    @Override\n+    protected StartsWithFunctionPipe randomInstance() {\n+        return randomStartsWithFunctionPipe();\n+    }\n+    \n+    private Expression randomStartsWithFunctionExpression() {\n+        return randomStartsWithFunctionPipe().expression();\n+    }\n+    \n+    public static StartsWithFunctionPipe randomStartsWithFunctionPipe() {\n+        return (StartsWithFunctionPipe) (new StartsWith(randomSource(),\n+                            randomStringLiteral(),\n+                            randomStringLiteral(),\n+                            TestUtils.randomConfiguration())\n+                .makePipe());\n+    }\n+\n+    @Override\n+    public void testTransform() {\n+        // test transforming only the properties (source, expression),\n+        // skipping the children (the two parameters of the binary function) which are tested separately\n+        StartsWithFunctionPipe b1 = randomInstance();\n+        Expression newExpression = randomValueOtherThan(b1.expression(), () -> randomStartsWithFunctionExpression());\n+        StartsWithFunctionPipe newB = new StartsWithFunctionPipe(\n+            b1.source(),\n+            newExpression,\n+            b1.field(),\n+            b1.pattern(),\n+            b1.isCaseSensitive());\n+\n+        assertEquals(newB, b1.transformPropertiesOnly(v -> Objects.equals(v, b1.expression()) ? newExpression : v, Expression.class));\n+        \n+        StartsWithFunctionPipe b2 = randomInstance();\n+        Source newLoc = randomValueOtherThan(b2.source(), () -> randomSource());\n+        newB = new StartsWithFunctionPipe(\n+                newLoc,\n+                b2.expression(),\n+                b2.field(),\n+                b2.pattern(),\n+                b2.isCaseSensitive());\n+\n+        assertEquals(newB,\n+                b2.transformPropertiesOnly(v -> Objects.equals(v, b2.source()) ? newLoc : v, Source.class));\n+    }\n+\n+    @Override\n+    public void testReplaceChildren() {\n+        StartsWithFunctionPipe b = randomInstance();\n+        Pipe newField = pipe(((Expression) randomValueOtherThan(b.field(), () -> randomStringLiteral())));\n+        Pipe newPattern = pipe(((Expression) randomValueOtherThan(b.pattern(), () -> randomStringLiteral())));\n+        \n+        StartsWithFunctionPipe newB = new StartsWithFunctionPipe(b.source(), b.expression(), b.field(), b.pattern(), b.isCaseSensitive());\n+        StartsWithFunctionPipe transformed = (StartsWithFunctionPipe) newB.replaceChildren(newField, b.pattern());\n+        assertEquals(transformed.field(), newField);\n+        assertEquals(transformed.source(), b.source());\n+        assertEquals(transformed.expression(), b.expression());\n+        assertEquals(transformed.pattern(), b.pattern());\n+        \n+        transformed = (StartsWithFunctionPipe) newB.replaceChildren(b.field(), newPattern);\n+        assertEquals(transformed.field(), b.field());\n+        assertEquals(transformed.source(), b.source());\n+        assertEquals(transformed.expression(), b.expression());\n+        assertEquals(transformed.pattern(), newPattern);\n+        \n+        transformed = (StartsWithFunctionPipe) newB.replaceChildren(newField, newPattern);\n+        assertEquals(transformed.field(), newField);\n+        assertEquals(transformed.source(), b.source());\n+        assertEquals(transformed.expression(), b.expression());\n+        assertEquals(transformed.pattern(), newPattern);\n+    }\n+\n+    @Override\n+    protected StartsWithFunctionPipe mutate(StartsWithFunctionPipe instance) {\n+        List<Function<StartsWithFunctionPipe, StartsWithFunctionPipe>> randoms = new ArrayList<>();\n+        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n+                f.expression(),\n+                pipe(((Expression) randomValueOtherThan(f.field(), () -> randomStringLiteral()))),\n+                f.pattern(),\n+                f.isCaseSensitive()));\n+        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n+                f.expression(),\n+                f.field(),\n+                pipe(((Expression) randomValueOtherThan(f.pattern(), () -> randomStringLiteral()))),\n+                f.isCaseSensitive()));\n+        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n+                f.expression(),\n+                pipe(((Expression) randomValueOtherThan(f.field(), () -> randomStringLiteral()))),\n+                pipe(((Expression) randomValueOtherThan(f.pattern(), () -> randomStringLiteral()))),\n+                f.isCaseSensitive()));\n+        ", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYzMDMxNg==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r422630316", "bodyText": "Maybe remove the Function as we don't normally use it in processor names.", "author": "matriv", "createdAt": "2020-05-10T11:20:52Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/string/StartsWithFunctionProcessor.java", "diffHunk": "@@ -20,43 +20,51 @@\n \n     private final Processor source;\n     private final Processor pattern;\n+    private final boolean isCaseSensitive;\n \n-    public StartsWithFunctionProcessor(Processor source, Processor pattern) {\n+    public StartsWithFunctionProcessor(Processor source, Processor pattern, boolean isCaseSensitive) {", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU0MDA1Mw==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423540053", "bodyText": "There are functions where this pattern is used - String functions.", "author": "astefan", "createdAt": "2020-05-12T08:04:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYzMDMxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjYzMDM2MQ==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r422630361", "bodyText": "Maybe remove Function from the name.", "author": "matriv", "createdAt": "2020-05-10T11:21:11Z", "path": "x-pack/plugin/ql/src/main/java/org/elasticsearch/xpack/ql/expression/function/scalar/string/StartsWithFunctionPipe.java", "diffHunk": "@@ -17,13 +17,15 @@\n \n public class StartsWithFunctionPipe extends Pipe {", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE1ODkxMg==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423158912", "bodyText": "It's idiomatic to use assume which will indicate to the framework that the test has not actually ran.", "author": "costin", "createdAt": "2020-05-11T16:19:38Z", "path": "x-pack/plugin/eql/src/test/java/org/elasticsearch/xpack/eql/planner/QueryFolderOkTests.java", "diffHunk": "@@ -114,6 +110,11 @@ private static void addSpec(ArrayList<Object[]> arr, String name, String query,\n     }\n \n     public void test() {\n+        // skip tests that do not make sense from case sensitivity point of view", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2MjAxNA==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423162014", "bodyText": "What's the advantage of using Configuration instead of SqlConfiguration?", "author": "costin", "createdAt": "2020-05-11T16:24:28Z", "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/execution/PlanExecutor.java", "diffHunk": "@@ -22,7 +22,7 @@\n import org.elasticsearch.xpack.sql.planner.Planner;\n import org.elasticsearch.xpack.sql.planner.PlanningException;\n import org.elasticsearch.xpack.sql.proto.SqlTypedParamValue;\n-import org.elasticsearch.xpack.sql.session.Configuration;", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU1MTQ5MA==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423551490", "bodyText": "This is just a rename. The SQL's Configuration => SqlConfiguration.\nThe same for Eql. EQL's Configuration was renamed to EqlConfiguration.\nI found it a bit confusing to have Configuration in three separate projects.", "author": "astefan", "createdAt": "2020-05-12T08:23:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2MjAxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2Njc3Ng==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423166776", "bodyText": "The name is unfortunate - how about SqlConfigurationFunction, BasicConfigurationFunction or DefaultConfigurationFunction, etc...", "author": "costin", "createdAt": "2020-05-11T16:32:05Z", "path": "x-pack/plugin/sql/src/main/java/org/elasticsearch/xpack/sql/expression/function/scalar/NoArgumentsConfigurationFunction.java", "diffHunk": "@@ -17,14 +17,14 @@\n import java.util.List;\n import java.util.Objects;\n \n-public abstract class ConfigurationFunction extends ScalarFunction {\n+import static java.util.Collections.emptyList;\n+\n+public abstract class NoArgumentsConfigurationFunction extends ConfigurationFunction {", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU1MjE4Nw==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423552187", "bodyText": "Agree. Will change.", "author": "astefan", "createdAt": "2020-05-12T08:24:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2Njc3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2ODAxNA==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423168014", "bodyText": "That's unfortunate - do we need a Verifier instance each time?", "author": "costin", "createdAt": "2020-05-11T16:34:08Z", "path": "x-pack/plugin/eql/src/main/java/org/elasticsearch/xpack/eql/session/EqlSession.java", "diffHunk": "@@ -27,22 +29,22 @@\n public class EqlSession {\n \n     private final Client client;\n-    private final Configuration configuration;\n+    private final EqlConfiguration configuration;\n     private final IndexResolver indexResolver;\n \n     private final PreAnalyzer preAnalyzer;\n     private final Analyzer analyzer;\n     private final Optimizer optimizer;\n     private final Planner planner;\n \n-    public EqlSession(Client client, Configuration cfg, IndexResolver indexResolver, PreAnalyzer preAnalyzer, Analyzer analyzer,\n-            Optimizer optimizer, Planner planner, PlanExecutor planExecutor) {\n+    public EqlSession(Client client, EqlConfiguration cfg, IndexResolver indexResolver, PreAnalyzer preAnalyzer,\n+            FunctionRegistry functionRegistry, Optimizer optimizer, Planner planner, PlanExecutor planExecutor) {\n \n         this.client = new ParentTaskAssigningClient(client, cfg.getTaskId());\n         this.configuration = cfg;\n         this.indexResolver = indexResolver;\n         this.preAnalyzer = preAnalyzer;\n-        this.analyzer = analyzer;\n+        this.analyzer = new Analyzer(cfg, functionRegistry, new Verifier());", "originalCommit": "166c232dba6e9eb18aefebb8de38ec238f87e96d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzU1NTk4Mw==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423555983", "bodyText": "You are correct. We can create the Verifier once in the plan executor and pass that along. Will change.", "author": "astefan", "createdAt": "2020-05-12T08:29:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE2ODAxNA=="}], "type": "inlineReview"}, {"oid": "b39a6e4596580cc7a9e38261a121a0d9500bdbf0", "url": "https://github.com/elastic/elasticsearch/commit/b39a6e4596580cc7a9e38261a121a0d9500bdbf0", "message": "Address reviews", "committedDate": "2020-05-12T08:38:44Z", "type": "commit"}, {"oid": "fc59f14ccd2fcd188ebea2c320235c438b2a9136", "url": "https://github.com/elastic/elasticsearch/commit/fc59f14ccd2fcd188ebea2c320235c438b2a9136", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 55340_enhancement3", "committedDate": "2020-05-12T08:38:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0ODQxNQ==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423648415", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    for(int i = 1; i < 4; i++) {\n          \n          \n            \n                    for (int i = 1; i < 4; i++) {", "author": "matriv", "createdAt": "2020-05-12T11:05:13Z", "path": "x-pack/plugin/ql/src/test/java/org/elasticsearch/xpack/ql/expression/function/scalar/string/StartsWithFunctionPipeTests.java", "diffHunk": "@@ -97,21 +99,18 @@ public void testReplaceChildren() {\n     @Override\n     protected StartsWithFunctionPipe mutate(StartsWithFunctionPipe instance) {\n         List<Function<StartsWithFunctionPipe, StartsWithFunctionPipe>> randoms = new ArrayList<>();\n-        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n-                f.expression(),\n-                pipe(((Expression) randomValueOtherThan(f.field(), () -> randomStringLiteral()))),\n-                f.pattern(),\n-                f.isCaseSensitive()));\n-        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n-                f.expression(),\n-                f.field(),\n-                pipe(((Expression) randomValueOtherThan(f.pattern(), () -> randomStringLiteral()))),\n-                f.isCaseSensitive()));\n-        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n-                f.expression(),\n-                pipe(((Expression) randomValueOtherThan(f.field(), () -> randomStringLiteral()))),\n-                pipe(((Expression) randomValueOtherThan(f.pattern(), () -> randomStringLiteral()))),\n-                f.isCaseSensitive()));\n+        for(int i = 1; i < 4; i++) {", "originalCommit": "b39a6e4596580cc7a9e38261a121a0d9500bdbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzY0ODgzOA==", "url": "https://github.com/elastic/elasticsearch/pull/56404#discussion_r423648838", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        for(BitSet comb : new Combinations(3, i)) {\n          \n          \n            \n                        for (BitSet comb : new Combinations(3, i)) {", "author": "matriv", "createdAt": "2020-05-12T11:06:01Z", "path": "x-pack/plugin/ql/src/test/java/org/elasticsearch/xpack/ql/expression/function/scalar/string/StartsWithFunctionPipeTests.java", "diffHunk": "@@ -97,21 +99,18 @@ public void testReplaceChildren() {\n     @Override\n     protected StartsWithFunctionPipe mutate(StartsWithFunctionPipe instance) {\n         List<Function<StartsWithFunctionPipe, StartsWithFunctionPipe>> randoms = new ArrayList<>();\n-        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n-                f.expression(),\n-                pipe(((Expression) randomValueOtherThan(f.field(), () -> randomStringLiteral()))),\n-                f.pattern(),\n-                f.isCaseSensitive()));\n-        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n-                f.expression(),\n-                f.field(),\n-                pipe(((Expression) randomValueOtherThan(f.pattern(), () -> randomStringLiteral()))),\n-                f.isCaseSensitive()));\n-        randoms.add(f -> new StartsWithFunctionPipe(f.source(),\n-                f.expression(),\n-                pipe(((Expression) randomValueOtherThan(f.field(), () -> randomStringLiteral()))),\n-                pipe(((Expression) randomValueOtherThan(f.pattern(), () -> randomStringLiteral()))),\n-                f.isCaseSensitive()));\n+        for(int i = 1; i < 4; i++) {\n+            for(BitSet comb : new Combinations(3, i)) {", "originalCommit": "b39a6e4596580cc7a9e38261a121a0d9500bdbf0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5c816212b6aaac9ef9f0a7806d39e0865c5a74e7", "url": "https://github.com/elastic/elasticsearch/commit/5c816212b6aaac9ef9f0a7806d39e0865c5a74e7", "message": "Address review #2", "committedDate": "2020-05-12T11:18:06Z", "type": "commit"}, {"oid": "df628dcdbf74bc1e7c3fb6f9dca7b41e086219a7", "url": "https://github.com/elastic/elasticsearch/commit/df628dcdbf74bc1e7c3fb6f9dca7b41e086219a7", "message": "Merge branch 'master' of https://github.com/elastic/elasticsearch into 55340_enhancement3", "committedDate": "2020-05-12T11:18:19Z", "type": "commit"}]}