{"pr_number": 63398, "pr_title": "Add searchAnalyzer method to QueryShardContext", "pr_createdAt": "2020-10-07T11:55:34Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63398", "timeline": [{"oid": "bc2704bc712c379a960a9430a8193e8840d968ff", "url": "https://github.com/elastic/elasticsearch/commit/bc2704bc712c379a960a9430a8193e8840d968ff", "message": "Add searchAnalyzer method to QueryShardContext\n\nSome callers of `QueryShardContext#getMapperService` only need to retrieve the search analyzer from the `MapperService`. With this commit we add a searchAnalyzer method to QueryShardContext` which can be called directly without having direct access to `MapperService`", "committedDate": "2020-10-07T11:52:48Z", "type": "commit"}, {"oid": "ac3fee32c1df76fc5674e3ba2557f807216d9580", "url": "https://github.com/elastic/elasticsearch/commit/ac3fee32c1df76fc5674e3ba2557f807216d9580", "message": "javadocs", "committedDate": "2020-10-07T11:54:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2MTAyMw==", "url": "https://github.com/elastic/elasticsearch/pull/63398#discussion_r500961023", "bodyText": "possibly, searchQuoteAnalyzer and searchAnalyzer could be removed from MapperService as they are only used through QueryShardContext. Only they are now a subclass of MapperAnalyzerWrapper which is package protected within MapperService and used also for indexAnalyzer which must stay where it is.", "author": "javanna", "createdAt": "2020-10-07T12:12:22Z", "path": "server/src/main/java/org/elasticsearch/index/query/QueryShardContext.java", "diffHunk": "@@ -258,6 +258,13 @@ public Analyzer getSearchAnalyzer(MappedFieldType fieldType) {\n         return mapperService.searchAnalyzer();\n     }\n \n+    /**\n+     * Returns the default search analyzer\n+     */\n+    public Analyzer getSearchAnalyzer() {\n+        return this.mapperService.searchAnalyzer();\n+    }", "originalCommit": "ac3fee32c1df76fc5674e3ba2557f807216d9580", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk3MzI0NA==", "url": "https://github.com/elastic/elasticsearch/pull/63398#discussion_r500973244", "bodyText": "Yes, MapperService builds the per-field analyzer here so we need to keep it, I think.  Although we may be able to remove the per-field delegation for search/searchQuote because generally speaking queries get their analyzers directly from the field types.  We can look at it later.", "author": "romseygeek", "createdAt": "2020-10-07T12:32:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDk2MTAyMw=="}], "type": "inlineReview"}]}