{"pr_number": 66347, "pr_title": "[ML] Deprecate anomaly detection post data endpoint", "pr_createdAt": "2020-12-15T14:20:33Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/66347", "timeline": [{"oid": "170f85058435c16376e7f9b6f36dcaff6462bf3d", "url": "https://github.com/elastic/elasticsearch/commit/170f85058435c16376e7f9b6f36dcaff6462bf3d", "message": "[ML] Deprecate anomaly detection post data endpoint\n\nThere is little evidence of this endpoint being used\nand there is quite a lot of code complexity associated\nwith the various formats that can be used to upload\ndata and the different errors that can occur when direct\ndata upload is open to end users.\n\nIn a future release we can make this endpoint internal\nso that only datafeeds can use it, and remove all the\noptions and formats that are not used by datafeeds.\n\nEnd users will have to store their input data for\nanomaly detection in Elasticsearch indices (which we\nbelieve all do today) and use a datafeed to feed it\nto anomaly detection jobs.", "committedDate": "2020-12-15T14:15:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MTE3Mw==", "url": "https://github.com/elastic/elasticsearch/pull/66347#discussion_r543391173", "bodyText": "Just double-checking: Is it ok that this snippet will be printed in the public docs?", "author": "przemekwitek", "createdAt": "2020-12-15T14:25:51Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/MlClientDocumentationIT.java", "diffHunk": "@@ -1789,7 +1798,10 @@ public void testPostData() throws Exception {\n             postDataRequest.setResetStart(null);\n \n             // tag::post-data-execute\n-            PostDataResponse postDataResponse = client.machineLearning().postData(postDataRequest, RequestOptions.DEFAULT);\n+            RequestOptions ignoreDeprecationsWarningsOptions = RequestOptions.DEFAULT.toBuilder()", "originalCommit": "170f85058435c16376e7f9b6f36dcaff6462bf3d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzQyMzc5OA==", "url": "https://github.com/elastic/elasticsearch/pull/66347#discussion_r543423798", "bodyText": "This is the worst thing about this PR.  The end user won't need to ignore the deprecation warnings, because they won't be fatal for the end user, only our test framework.  But I tried a few ways to avoid this while still keeping the code executable and they didn't work - putting it in an if (false) with the else doing the version that works in the test framework and putting the appropriate end user code in a try/catch (AssertionError e).\nI just thought of a couple of other ways to do it that might work - putting the tagged code in a /*/*/ block comment or in a dummy method that's not called.  I'll see if those work.", "author": "droberts195", "createdAt": "2020-12-15T15:04:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MTE3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzUyNTMwMg==", "url": "https://github.com/elastic/elasticsearch/pull/66347#discussion_r543525302", "bodyText": "putting the tagged code in a /*/*/ block comment\n\nThis approach passed the PR CI.  I don't know what it will look like in the final HTML docs though.  I will check after this is merged and if it doesn't work then try a different approach in a followup.", "author": "droberts195", "createdAt": "2020-12-15T17:06:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MTE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM5MjI4MQ==", "url": "https://github.com/elastic/elasticsearch/pull/66347#discussion_r543392281", "bodyText": "Would it make sense to introduce POST_DATA_OPTIONS static member just like you did in the other test?", "author": "przemekwitek", "createdAt": "2020-12-15T14:27:03Z", "path": "client/rest-high-level/src/test/java/org/elasticsearch/client/MachineLearningIT.java", "diffHunk": "@@ -435,7 +435,11 @@ public void testForecastJob() throws Exception {\n             builder.addDoc(hashMap);\n         }\n         PostDataRequest postDataRequest = new PostDataRequest(jobId, builder);\n-        machineLearningClient.postData(postDataRequest, RequestOptions.DEFAULT);\n+        // Post data is deprecated, so expect a deprecation warning\n+        RequestOptions requestOptions = RequestOptions.DEFAULT.toBuilder()", "originalCommit": "170f85058435c16376e7f9b6f36dcaff6462bf3d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7c8549f1e78ad33f4a75f153fd275e9f15bd4168", "url": "https://github.com/elastic/elasticsearch/commit/7c8549f1e78ad33f4a75f153fd275e9f15bd4168", "message": "Allow warnings in BWC tests", "committedDate": "2020-12-15T14:43:39Z", "type": "commit"}, {"oid": "c31a00af8f20365cffd1a01210d141ffb603ada6", "url": "https://github.com/elastic/elasticsearch/commit/c31a00af8f20365cffd1a01210d141ffb603ada6", "message": "More changes", "committedDate": "2020-12-15T16:15:04Z", "type": "commit"}, {"oid": "44cb67c139840690cfeb82b663d4e00790f17bd8", "url": "https://github.com/elastic/elasticsearch/commit/44cb67c139840690cfeb82b663d4e00790f17bd8", "message": "[DOCS] Adds breaking change", "committedDate": "2020-12-15T17:01:37Z", "type": "commit"}]}