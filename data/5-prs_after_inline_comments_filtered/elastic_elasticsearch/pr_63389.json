{"pr_number": 63389, "pr_title": "Remove some more QueryShardContext#getMapperService usages", "pr_createdAt": "2020-10-07T08:50:19Z", "pr_url": "https://github.com/elastic/elasticsearch/pull/63389", "timeline": [{"oid": "cac267d53c5162fbf05ea0c2de36172b02766b88", "url": "https://github.com/elastic/elasticsearch/commit/cac267d53c5162fbf05ea0c2de36172b02766b88", "message": "Remove some more QueryShardContext#getMapperService usages\n\nSome callers of `getMapperService` only call `getIndexAnalyzers` on it, which is already available on `QueryShardContext`. This commit moves these callers to call `QueryShardContext#getIndexAnalyzers` directly.\n\nAlso, the remaining getMapperService usages in tests can now be removed or replaced.", "committedDate": "2020-10-07T08:40:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg1MDcwNw==", "url": "https://github.com/elastic/elasticsearch/pull/63389#discussion_r500850707", "bodyText": "nit: indentation", "author": "romseygeek", "createdAt": "2020-10-07T08:59:43Z", "path": "server/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java", "diffHunk": "@@ -298,22 +297,18 @@ public XContentBuilder toXContent(XContentBuilder builder, Params params) throws\n      * Transfers the text, prefix, regex, analyzer, field, size and shard size settings from the\n      * original {@link SuggestionBuilder} to the target {@link SuggestionContext}\n      */\n-    protected void populateCommonFields(MapperService mapperService, SuggestionSearchContext.SuggestionContext suggestionContext) {\n+    protected void populateCommonFields(QueryShardContext context, SuggestionSearchContext.SuggestionContext suggestionContext) {\n \n         Objects.requireNonNull(field, \"field must not be null\");\n-\n-        MappedFieldType fieldType = mapperService.fieldType(field);\n-        if (fieldType == null) {\n+        if (context.isFieldMapped(field) == false) {\n             throw new IllegalArgumentException(\"no mapping found for field [\" + field + \"]\");\n-        } else if (analyzer == null) {\n-            // no analyzer name passed in, so try the field's analyzer, or the default analyzer\n-            if (fieldType.getTextSearchInfo().getSearchAnalyzer() == null) {\n-                suggestionContext.setAnalyzer(mapperService.searchAnalyzer());\n-            } else {\n-                suggestionContext.setAnalyzer(fieldType.getTextSearchInfo().getSearchAnalyzer());\n-            }\n+        }\n+\n+        MappedFieldType fieldType = context.fieldMapper(field);\n+         if (analyzer == null) {", "originalCommit": "cac267d53c5162fbf05ea0c2de36172b02766b88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg3NzEzNw==", "url": "https://github.com/elastic/elasticsearch/pull/63389#discussion_r500877137", "bodyText": "thanks!", "author": "javanna", "createdAt": "2020-10-07T09:41:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDg1MDcwNw=="}], "type": "inlineReview"}, {"oid": "6d4d7ae7ccf37d5d462735de4c692ed34022fd35", "url": "https://github.com/elastic/elasticsearch/commit/6d4d7ae7ccf37d5d462735de4c692ed34022fd35", "message": "iter", "committedDate": "2020-10-07T10:16:28Z", "type": "commit"}]}