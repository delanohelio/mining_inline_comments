{"pr_number": 4120, "pr_title": " [Improvement][API] ignore noNodeException when get worker groups", "pr_createdAt": "2020-11-28T09:11:22Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/4120", "timeline": [{"oid": "e4f552918542689c09017acf853a54ff58d318b1", "url": "https://github.com/apache/dolphinscheduler/commit/e4f552918542689c09017acf853a54ff58d318b1", "message": "ignore noNodeException when get worker groups", "committedDate": "2020-11-28T09:09:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAxMTI3Ng==", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532011276", "bodyText": "It's best to pull it out here, and the code will be more readable.\n\u62bd\u79bb\u8fd9\u91cc\u7684\u5224\u65ad", "author": "CalvinKirs", "createdAt": "2020-11-28T09:39:01Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/WorkerGroupService.java", "diffHunk": "@@ -120,30 +121,46 @@\n         return result;\n     }\n \n-\n     /**\n-     *  get worker groups\n+     * get worker groups\n      *\n      * @param isPaging whether paging\n      * @return WorkerGroup list\n      */\n     private List<WorkerGroup> getWorkerGroups(boolean isPaging) {\n-        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot()+\"/nodes\" +\"/worker\";\n-        List<String> workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+\n+        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot() + \"/nodes\" + \"/worker\";\n+        List<WorkerGroup> workerGroups = new ArrayList<>();\n+        List<String> workerGroupList;\n+        try {\n+            workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+        } catch (Exception e) {\n+            if (e.getMessage().contains(noNodeExceptionRegex)) {", "originalCommit": "e4f552918542689c09017acf853a54ff58d318b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAxNjMzNA==", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532016334", "bodyText": "I need to deal with two results, which is not easy to deal with\u3002\n\u8fd9\u5757\u8981\u5904\u7406\u4e24\u4e2a\u7ed3\u679c\uff0c\u62bd\u53d6\u65b9\u6cd5\uff0c\u4e0d\u592a\u597d\u5904\u7406\u3002", "author": "felix-thinkingdata", "createdAt": "2020-11-28T10:08:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAxMTI3Ng=="}], "type": "inlineReview"}, {"oid": "8fd2605be7bab907fd2b48a59c1506ecb4277131", "url": "https://github.com/apache/dolphinscheduler/commit/8fd2605be7bab907fd2b48a59c1506ecb4277131", "message": "add ut", "committedDate": "2020-11-28T09:51:03Z", "type": "commit"}, {"oid": "f781f241fb0a39fc43dc45b3591c01f12ac776a7", "url": "https://github.com/apache/dolphinscheduler/commit/f781f241fb0a39fc43dc45b3591c01f12ac776a7", "message": "fix code smell", "committedDate": "2020-11-28T10:17:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNzAxMQ==", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532027011", "bodyText": "i think it should be a constant variable  for worker path.", "author": "lenboo", "createdAt": "2020-11-28T11:04:08Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/WorkerGroupService.java", "diffHunk": "@@ -120,30 +121,46 @@\n         return result;\n     }\n \n-\n     /**\n-     *  get worker groups\n+     * get worker groups\n      *\n      * @param isPaging whether paging\n      * @return WorkerGroup list\n      */\n     private List<WorkerGroup> getWorkerGroups(boolean isPaging) {\n-        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot()+\"/nodes\" +\"/worker\";\n-        List<String> workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+\n+        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot() + \"/nodes\" + \"/worker\";", "originalCommit": "e4f552918542689c09017acf853a54ff58d318b1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAzMjExMw==", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532032113", "bodyText": "complete", "author": "felix-thinkingdata", "createdAt": "2020-11-28T12:00:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjAyNzAxMQ=="}], "type": "inlineReview"}, {"oid": "2323c45afa8483579b3d7683780b89124b84e30a", "url": "https://github.com/apache/dolphinscheduler/commit/2323c45afa8483579b3d7683780b89124b84e30a", "message": "fix code smell", "committedDate": "2020-11-28T11:59:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1MTc1Ng==", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532051756", "bodyText": "so do the \"default\" = DEFAULT_WORKER_GROUP", "author": "lenboo", "createdAt": "2020-11-28T15:28:34Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/WorkerGroupService.java", "diffHunk": "@@ -120,30 +122,46 @@\n         return result;\n     }\n \n-\n     /**\n-     *  get worker groups\n+     * get worker groups\n      *\n      * @param isPaging whether paging\n      * @return WorkerGroup list\n      */\n     private List<WorkerGroup> getWorkerGroups(boolean isPaging) {\n-        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot()+\"/nodes\" +\"/worker\";\n-        List<String> workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+\n+        String workerPath = zookeeperCachedOperator.getZookeeperConfig().getDsRoot() + Constants.ZOOKEEPER_DOLPHINSCHEDULER_WORKERS;\n+        List<WorkerGroup> workerGroups = new ArrayList<>();\n+        List<String> workerGroupList;\n+        try {\n+            workerGroupList = zookeeperCachedOperator.getChildrenKeys(workerPath);\n+        } catch (Exception e) {\n+            if (e.getMessage().contains(NO_NODE_EXCEPTION_REGEX)) {\n+                if (isPaging) {\n+                    return workerGroups;\n+                } else {\n+                    //ignore noNodeException return Default\n+                    WorkerGroup wg = new WorkerGroup();\n+                    wg.setName(\"default\");", "originalCommit": "2323c45afa8483579b3d7683780b89124b84e30a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjIxMDIzMA==", "url": "https://github.com/apache/dolphinscheduler/pull/4120#discussion_r532210230", "bodyText": "ok", "author": "felix-thinkingdata", "createdAt": "2020-11-29T13:30:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjA1MTc1Ng=="}], "type": "inlineReview"}, {"oid": "7c269307c66c14b221fd795df93149802639b7bf", "url": "https://github.com/apache/dolphinscheduler/commit/7c269307c66c14b221fd795df93149802639b7bf", "message": "fix code smell", "committedDate": "2020-11-29T13:30:13Z", "type": "commit"}]}