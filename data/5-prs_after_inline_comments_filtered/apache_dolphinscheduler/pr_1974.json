{"pr_number": 1974, "pr_title": "#203 add sqoop task", "pr_createdAt": "2020-02-18T13:13:20Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/1974", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDY5NjQwNA==", "url": "https://github.com/apache/dolphinscheduler/pull/1974#discussion_r380696404", "bodyText": "sqoop tasks will be converted to mapreduce tasks, managed by yarn\uff0c SqoopTask class need extends AbstractYarnTask not ShellTask", "author": "Eights-Li", "createdAt": "2020-02-18T14:14:20Z", "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/sqoop/SqoopTask.java", "diffHunk": "@@ -0,0 +1,48 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.dolphinscheduler.server.worker.task.sqoop;\n+\n+import com.alibaba.fastjson.JSON;\n+import org.apache.dolphinscheduler.common.task.shell.ShellParameters;\n+import org.apache.dolphinscheduler.common.task.sqoop.SqoopParameters;\n+import org.apache.dolphinscheduler.server.worker.task.TaskProps;\n+import org.apache.dolphinscheduler.server.worker.task.shell.ShellTask;\n+import org.apache.dolphinscheduler.server.worker.task.sqoop.generator.SqoopJobGenerator;\n+import org.slf4j.Logger;\n+\n+/**\n+ * sqoop task extends the shell task\n+ */\n+public class SqoopTask extends ShellTask {", "originalCommit": "dd486569038ef86bda3798a72197e9c9ac62437c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3f1a9b69489004a7961cfcbc7e262d58b19d785a", "url": "https://github.com/apache/dolphinscheduler/commit/3f1a9b69489004a7961cfcbc7e262d58b19d785a", "message": "add sqoop task", "committedDate": "2020-02-20T13:56:09Z", "type": "commit"}, {"oid": "19dd39778f6b4eec8310e7770ed4a64a0556f983", "url": "https://github.com/apache/dolphinscheduler/commit/19dd39778f6b4eec8310e7770ed4a64a0556f983", "message": "add sqoop task", "committedDate": "2020-02-20T13:56:09Z", "type": "commit"}, {"oid": "a5e4a6db6d37c4b0da998502e5d0fcb5316fb48f", "url": "https://github.com/apache/dolphinscheduler/commit/a5e4a6db6d37c4b0da998502e5d0fcb5316fb48f", "message": "add sqoop task test", "committedDate": "2020-02-20T13:56:09Z", "type": "commit"}, {"oid": "8b64af608dc7f9820b9f8786a19181e50f426e90", "url": "https://github.com/apache/dolphinscheduler/commit/8b64af608dc7f9820b9f8786a19181e50f426e90", "message": "add sqoop task test", "committedDate": "2020-02-20T13:56:10Z", "type": "commit"}, {"oid": "0de8a4e18a8850d2849e9bf1de889bb381929bba", "url": "https://github.com/apache/dolphinscheduler/commit/0de8a4e18a8850d2849e9bf1de889bb381929bba", "message": "add sqoop task test", "committedDate": "2020-02-20T13:56:10Z", "type": "commit"}, {"oid": "cff9fec2a59c0b4141ca531706412cfdc02a6349", "url": "https://github.com/apache/dolphinscheduler/commit/cff9fec2a59c0b4141ca531706412cfdc02a6349", "message": "modify add sqoop task test", "committedDate": "2020-02-20T13:56:10Z", "type": "commit"}, {"oid": "63302beafb6eebc88f2fc015914ef08513c264d5", "url": "https://github.com/apache/dolphinscheduler/commit/63302beafb6eebc88f2fc015914ef08513c264d5", "message": "modify sqoop task test", "committedDate": "2020-02-20T13:56:10Z", "type": "commit"}, {"oid": "2d910308fe934f296d9c6785a399e1d387d7bb97", "url": "https://github.com/apache/dolphinscheduler/commit/2d910308fe934f296d9c6785a399e1d387d7bb97", "message": "modify sqoop task test", "committedDate": "2020-02-20T13:56:10Z", "type": "commit"}, {"oid": "ca36e7dd045c9bb878795ca6339f8d24f2e735c9", "url": "https://github.com/apache/dolphinscheduler/commit/ca36e7dd045c9bb878795ca6339f8d24f2e735c9", "message": "modify sqoop task test", "committedDate": "2020-02-20T13:56:10Z", "type": "commit"}, {"oid": "2b2e45363723c2815b65dfc238c52195a8f63456", "url": "https://github.com/apache/dolphinscheduler/commit/2b2e45363723c2815b65dfc238c52195a8f63456", "message": "modify sqoop task test 2", "committedDate": "2020-02-20T15:33:14Z", "type": "commit"}, {"oid": "38ce68ac526bee8e4f7c80ddab8683998e4b9310", "url": "https://github.com/apache/dolphinscheduler/commit/38ce68ac526bee8e4f7c80ddab8683998e4b9310", "message": "modify sqoop task test 3", "committedDate": "2020-02-20T15:58:55Z", "type": "commit"}, {"oid": "227c6cb975a25c444d9b6945d53921288c20a7b4", "url": "https://github.com/apache/dolphinscheduler/commit/227c6cb975a25c444d9b6945d53921288c20a7b4", "message": "modify sqoop task test 3", "committedDate": "2020-02-21T05:47:39Z", "type": "commit"}, {"oid": "5ca0d6016956f18019689d4fac73f98e53e55c87", "url": "https://github.com/apache/dolphinscheduler/commit/5ca0d6016956f18019689d4fac73f98e53e55c87", "message": "modify sqoop task test 3", "committedDate": "2020-02-21T05:57:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQxNDU1MQ==", "url": "https://github.com/apache/dolphinscheduler/pull/1974#discussion_r382414551", "bodyText": "remove the author and time", "author": "Eights-Li", "createdAt": "2020-02-21T06:20:30Z", "path": "dolphinscheduler-common/src/test/java/org/apache/dolphinscheduler/common/task/SqoopParameterEntityTest.java", "diffHunk": "@@ -0,0 +1,54 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.dolphinscheduler.common.task;\n+\n+import org.apache.dolphinscheduler.common.task.sqoop.SqoopParameters;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceHdfsParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceHiveParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceMysqlParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.targets.TargetHdfsParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.targets.TargetHiveParameter;\n+import org.apache.dolphinscheduler.common.task.sqoop.targets.TargetMysqlParameter;\n+import org.junit.Assert;\n+import org.junit.Test;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+/**\n+ * @author simfo", "originalCommit": "5ca0d6016956f18019689d4fac73f98e53e55c87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjQxNTQzOQ==", "url": "https://github.com/apache/dolphinscheduler/pull/1974#discussion_r382415439", "bodyText": "remove this comment out code", "author": "Eights-Li", "createdAt": "2020-02-21T06:24:33Z", "path": "dolphinscheduler-server/src/main/java/org/apache/dolphinscheduler/server/worker/task/sqoop/generator/sources/MysqlSourceGenerator.java", "diffHunk": "@@ -0,0 +1,135 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.apache.dolphinscheduler.server.worker.task.sqoop.generator.sources;\n+\n+import org.apache.commons.lang.StringUtils;\n+import org.apache.dolphinscheduler.common.enums.QueryType;\n+import org.apache.dolphinscheduler.common.process.Property;\n+import org.apache.dolphinscheduler.common.task.sqoop.SqoopParameters;\n+import org.apache.dolphinscheduler.common.task.sqoop.sources.SourceMysqlParameter;\n+import org.apache.dolphinscheduler.common.utils.JSONUtils;\n+import org.apache.dolphinscheduler.dao.datasource.BaseDataSource;\n+import org.apache.dolphinscheduler.dao.datasource.DataSourceFactory;\n+import org.apache.dolphinscheduler.service.bean.SpringApplicationContext;\n+import org.apache.dolphinscheduler.dao.entity.DataSource;\n+import org.apache.dolphinscheduler.server.worker.task.sqoop.generator.ISourceGenerator;\n+import org.apache.dolphinscheduler.service.process.ProcessService;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import java.util.List;\n+\n+/**\n+ * mysql source generator\n+ */\n+public class MysqlSourceGenerator implements ISourceGenerator {\n+\n+    private Logger logger = LoggerFactory.getLogger(getClass());\n+\n+    @Override\n+    public String generate(SqoopParameters sqoopParameters) {\n+        StringBuilder result = new StringBuilder();\n+        try {\n+            SourceMysqlParameter sourceMysqlParameter\n+                    = JSONUtils.parseObject(sqoopParameters.getSourceParams(),SourceMysqlParameter.class);\n+\n+            if(sourceMysqlParameter != null){\n+                ProcessService processService = SpringApplicationContext.getBean(ProcessService.class);\n+                DataSource dataSource= processService.findDataSourceById(sourceMysqlParameter.getSrcDatasource());\n+                BaseDataSource baseDataSource = DataSourceFactory.getDatasource(dataSource.getType(),\n+                        dataSource.getConnectionParams());\n+                if(baseDataSource != null){\n+                    result.append(\" --connect \")\n+                            .append(baseDataSource.getJdbcUrl())\n+                            .append(\" --username \")\n+                            .append(baseDataSource.getUser())\n+                            .append(\" --password \")\n+                            .append(baseDataSource.getPassword());\n+\n+                    if(sourceMysqlParameter.getSrcQueryType() == QueryType.FORM.ordinal()){\n+                        if(StringUtils.isNotEmpty(sourceMysqlParameter.getSrcTable())){\n+                            result.append(\" --table \").append(sourceMysqlParameter.getSrcTable());\n+                        }\n+\n+                        if(StringUtils.isNotEmpty(sourceMysqlParameter.getSrcColumns())){\n+                            result.append(\" --columns \").append(sourceMysqlParameter.getSrcColumns());\n+                        }\n+\n+//                        StringBuilder srcWhere = new StringBuilder();\n+//                        if(sourceMysqlParameter.getSrcConditionList().size()>0){\n+//                            List<Property> items = sourceMysqlParameter.getSrcConditionList();", "originalCommit": "5ca0d6016956f18019689d4fac73f98e53e55c87", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "08985e0a64d94c543abe398dae0073aa58d9e880", "url": "https://github.com/apache/dolphinscheduler/commit/08985e0a64d94c543abe398dae0073aa58d9e880", "message": "modify sqoop task test 4", "committedDate": "2020-02-21T08:26:15Z", "type": "commit"}]}