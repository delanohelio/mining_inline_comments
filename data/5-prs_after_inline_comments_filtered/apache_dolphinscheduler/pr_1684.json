{"pr_number": 1684, "pr_title": "fix get tenantCode my NPE", "pr_createdAt": "2020-01-02T08:58:26Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/1684", "timeline": [{"oid": "257a3ee3e37720c028a92c3abdeb828e60dbbcc8", "url": "https://github.com/apache/dolphinscheduler/commit/257a3ee3e37720c028a92c3abdeb828e60dbbcc8", "message": "Merge pull request #18 from apache/dev\n\nupdate", "committedDate": "2019-12-30T10:38:34Z", "type": "commit"}, {"oid": "d5fe55ad56bd902523a0868a7d4f5d2bed3e8caa", "url": "https://github.com/apache/dolphinscheduler/commit/d5fe55ad56bd902523a0868a7d4f5d2bed3e8caa", "message": "modify UdfFuncServiceTest UT", "committedDate": "2019-12-30T10:44:03Z", "type": "commit"}, {"oid": "38e3af0dee6ec28cb99e1ce6b4fdcf66ec7ef367", "url": "https://github.com/apache/dolphinscheduler/commit/38e3af0dee6ec28cb99e1ce6b4fdcf66ec7ef367", "message": "Merge pull request #19 from apache/dev\n\nupdate", "committedDate": "2020-01-02T08:38:31Z", "type": "commit"}, {"oid": "67acd09f9401ea675d0231a610c23a8b58459767", "url": "https://github.com/apache/dolphinscheduler/commit/67acd09f9401ea675d0231a610c23a8b58459767", "message": "fix get tenantCode my NPE", "committedDate": "2020-01-02T08:53:07Z", "type": "commit"}, {"oid": "32604123eb94edb0148b0f38e6947e07894f0ae8", "url": "https://github.com/apache/dolphinscheduler/commit/32604123eb94edb0148b0f38e6947e07894f0ae8", "message": "add  ResourcesServiceTest", "committedDate": "2020-01-02T08:53:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNTk2MA==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362805960", "bodyText": "Is necessary to putMsg and log error?", "author": "khadgarmage", "createdAt": "2020-01-03T13:22:08Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -234,6 +234,12 @@ public Result updateResource(User loginUser,\n             }\n         }\n \n+        // query tenant by user id\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "originalCommit": "32604123eb94edb0148b0f38e6947e07894f0ae8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAxMzkwMQ==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r363013901", "bodyText": "add error log in getTenantCode method", "author": "samz406", "createdAt": "2020-01-04T03:44:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNTk2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjI2NQ==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362806265", "bodyText": "Is necessary to putMsg and log error?", "author": "khadgarmage", "createdAt": "2020-01-03T13:23:07Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -522,8 +529,11 @@ public Result readResource(int resourceId, int skipLineNum, int limit) {\n             }\n         }\n \n-        User user = userMapper.queryDetailsById(resource.getUserId());\n-        String tenantCode = tenantMapper.queryById(user.getTenantId()).getTenantCode();\n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){\n+            return  result;", "originalCommit": "32604123eb94edb0148b0f38e6947e07894f0ae8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAxMzkwNw==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r363013907", "bodyText": "add error log in getTenantCode method", "author": "samz406", "createdAt": "2020-01-04T03:44:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjI2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362806342", "bodyText": "Is necessary to putMsg and log error?", "author": "khadgarmage", "createdAt": "2020-01-03T13:23:22Z", "path": "dolphinscheduler-api/src/main/java/org/apache/dolphinscheduler/api/service/ResourcesService.java", "diffHunk": "@@ -644,18 +654,20 @@ public Result updateResourceContent(int resourceId, String content) {\n         if (StringUtils.isNotEmpty(resourceViewSuffixs)) {\n             List<String> strList = Arrays.asList(resourceViewSuffixs.split(\",\"));\n             if (!strList.contains(nameSuffix)) {\n-                logger.error(\"resouce suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n+                logger.error(\"resource suffix {} not support updateProcessInstance,  resource id {}\", nameSuffix, resourceId);\n                 putMsg(result, Status.RESOURCE_SUFFIX_NOT_SUPPORT_VIEW);\n                 return result;\n             }\n         }\n \n+        String tenantCode = getTenantCode(resource.getUserId(),result);\n+        if (StringUtils.isEmpty(tenantCode)){", "originalCommit": "32604123eb94edb0148b0f38e6947e07894f0ae8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgxMjIyNA==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r362812224", "bodyText": "Since a tenant is required to upload a resource, the resource and tenant are associated through the user. If the user on resouce is illegal. Then the tenant cannot be obtained, and the null pointer exception will be thrown when the tenantCode is obtained.\n\u7531\u4e8e\u4e0a\u4f20resource\u9700\u8981tenant\uff0cresource\u548ctenant\u662f\u901a\u8fc7\u7528\u6237\u5173\u8054\uff0c\u5982\u679cresource\u4e0a\u7684\u7528\u6237\u662f\u975e\u6cd5\u7684\u3002\u90a3\u4e48\u5c31\u83b7\u53d6\u4e0d\u5230tenant\u4e86\uff0c \u83b7\u53d6tenantCode\u4e5f\u5c31\u4f1a\u629b\u7a7a\u6307\u9488\u5f02\u5e38", "author": "samz406", "createdAt": "2020-01-03T13:42:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MzAxMzg3MA==", "url": "https://github.com/apache/dolphinscheduler/pull/1684#discussion_r363013870", "bodyText": "add error log  in getTenantCode method", "author": "samz406", "createdAt": "2020-01-04T03:43:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjgwNjM0Mg=="}], "type": "inlineReview"}, {"oid": "b0d73fb7897d94e318d63748d87b271f6adf984b", "url": "https://github.com/apache/dolphinscheduler/commit/b0d73fb7897d94e318d63748d87b271f6adf984b", "message": "add error log", "committedDate": "2020-01-04T03:40:53Z", "type": "commit"}]}