{"pr_number": 2965, "pr_title": "[Feature-2925][server] Init TaskLogger in TaskExecuteProcessor (#2925)", "pr_createdAt": "2020-06-13T11:50:34Z", "pr_url": "https://github.com/apache/dolphinscheduler/pull/2965", "timeline": [{"oid": "291b98ae729547c61dc684cfe93bbfde2192f13b", "url": "https://github.com/apache/dolphinscheduler/commit/291b98ae729547c61dc684cfe93bbfde2192f13b", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)", "committedDate": "2020-06-14T06:55:26Z", "type": "forcePushed"}, {"oid": "5482a5e080adfe62accd1f020c0de7c788d5fa28", "url": "https://github.com/apache/dolphinscheduler/commit/5482a5e080adfe62accd1f020c0de7c788d5fa28", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)", "committedDate": "2020-06-14T07:31:44Z", "type": "forcePushed"}, {"oid": "f36af5331ea3721f9c7d2a281ff4bcfaad679547", "url": "https://github.com/apache/dolphinscheduler/commit/f36af5331ea3721f9c7d2a281ff4bcfaad679547", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)", "committedDate": "2020-06-14T08:00:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNTM2OA==", "url": "https://github.com/apache/dolphinscheduler/pull/2965#discussion_r443135368", "bodyText": "why swallow exception\uff1f", "author": "dailidong", "createdAt": "2020-06-20T14:33:03Z", "path": "dolphinscheduler-common/src/main/java/org/apache/dolphinscheduler/common/utils/FileUtils.java", "diffHunk": "@@ -138,24 +153,39 @@ public static String getResourceViewSuffixs() {\n      * @param userName user name\n      * @throws IOException errors\n      */\n-    public static void createWorkDirAndUserIfAbsent(String execLocalPath, String userName) throws IOException{\n+    public static void createWorkDirAndUserIfAbsent(String execLocalPath, String userName) throws IOException {\n         //if work dir exists, first delete\n         File execLocalPathFile = new File(execLocalPath);\n \n-        if (execLocalPathFile.exists()){\n+        if (execLocalPathFile.exists()) {\n             org.apache.commons.io.FileUtils.forceDelete(execLocalPathFile);\n         }\n \n         //create work dir\n         org.apache.commons.io.FileUtils.forceMkdir(execLocalPathFile);\n-        logger.info(\"create dir success {}\" , execLocalPath);\n-\n+        String mkdirLog = \"create dir success \" + execLocalPath;\n+        LoggerUtils.logInfo(logger, taskLoggerThreadLocal::get, mkdirLog);\n \n         //if not exists this user,then create\n-        if (!OSUtils.getUserList().contains(userName)){\n-            OSUtils.createUser(userName);\n+        Logger taskLogger = taskLoggerThreadLocal.get();\n+        OSUtils.taskLoggerThreadLocal.set(taskLogger);\n+        try {\n+            if (!OSUtils.getUserList().contains(userName)) {\n+                boolean isSuccessCreateUser = OSUtils.createUser(userName);\n+\n+                if (isSuccessCreateUser) {\n+                    String infoLog = String.format(\"create user name success %s\", userName);\n+                    taskLogger.info(infoLog);\n+                    logger.info(infoLog);\n+                } else {\n+                    String infoLog = String.format(\"create user name fail %s\", userName);\n+                    taskLogger.error(infoLog);\n+                    logger.error(infoLog);\n+                }\n+            }\n+        } catch (Throwable ignored) {\n         }", "originalCommit": "f36af5331ea3721f9c7d2a281ff4bcfaad679547", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNjA0Ng==", "url": "https://github.com/apache/dolphinscheduler/pull/2965#discussion_r443136046", "bodyText": "why swallow exception\uff1f\n\nThx a lot for your review @dailidong . I've removed the unused exception try catch clause.", "author": "yangyichao-mango", "createdAt": "2020-06-20T14:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzEzNTM2OA=="}], "type": "inlineReview"}, {"oid": "8725fdc450b06e479a73ba55278e57cc8fdc9f17", "url": "https://github.com/apache/dolphinscheduler/commit/8725fdc450b06e479a73ba55278e57cc8fdc9f17", "message": "optimize the logger utils", "committedDate": "2020-06-21T14:20:55Z", "type": "forcePushed"}, {"oid": "1ff45c288571e53d412182194484a840f87bf03b", "url": "https://github.com/apache/dolphinscheduler/commit/1ff45c288571e53d412182194484a840f87bf03b", "message": "optimize the logger utils", "committedDate": "2020-06-26T17:02:20Z", "type": "forcePushed"}, {"oid": "7232960d7ca2391079112d102c9e4a3cb8d5b335", "url": "https://github.com/apache/dolphinscheduler/commit/7232960d7ca2391079112d102c9e4a3cb8d5b335", "message": "[Feature-2925][common] Add exitVal judge in OSUtils.exeCmd (#2925)", "committedDate": "2020-06-28T08:09:56Z", "type": "commit"}, {"oid": "28d8be230073d00025d452d1f099770942878f11", "url": "https://github.com/apache/dolphinscheduler/commit/28d8be230073d00025d452d1f099770942878f11", "message": "optimize the logger utils", "committedDate": "2020-06-28T08:09:56Z", "type": "commit"}, {"oid": "28d8be230073d00025d452d1f099770942878f11", "url": "https://github.com/apache/dolphinscheduler/commit/28d8be230073d00025d452d1f099770942878f11", "message": "optimize the logger utils", "committedDate": "2020-06-28T08:09:56Z", "type": "forcePushed"}]}