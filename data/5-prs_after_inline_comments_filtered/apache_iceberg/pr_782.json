{"pr_number": 782, "pr_title": "Incremental scan followups", "pr_createdAt": "2020-02-05T23:55:59Z", "pr_url": "https://github.com/apache/iceberg/pull/782", "timeline": [{"oid": "4e5805b685d4e900e3ebd91a3220532b312a0f67", "url": "https://github.com/apache/iceberg/commit/4e5805b685d4e900e3ebd91a3220532b312a0f67", "message": "Incremental scan followups\n\nFixes: #765: This addresses the following follow-ups from #315\n\n1. Have validations on snapshot id range\n2. Improve tests for the same", "committedDate": "2020-02-05T23:51:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQwNDI3MA==", "url": "https://github.com/apache/iceberg/pull/782#discussion_r377404270", "bodyText": "I'd like to avoid using argument names in error messages. Argument names aren't very readable for end users because they are dense and this practice requires changing strings and test cases if arguments get renamed later.\nHow about \"From and to snapshot IDs cannot be the same: (%s, %s]\", \"From snapshot does not exist: %s\", etc.", "author": "rdblue", "createdAt": "2020-02-11T00:59:02Z", "path": "core/src/main/java/org/apache/iceberg/IncrementalDataTableScan.java", "diffHunk": "@@ -137,4 +136,29 @@ protected TableScan newRefinedScan(\n     }\n     return snapshots;\n   }\n+\n+  private void validateSnapshotIdsRefinement(long newFromSnapshotId, long newToSnapshotId) {\n+    Set<Long> snapshotIdsRange = Sets.newHashSet(\n+        SnapshotUtil.snapshotIdsBetween(table(), fromSnapshotId, toSnapshotId));\n+    // since snapshotIdsBetween return ids in range (fromSnapshotId, toSnapshotId]\n+    snapshotIdsRange.add(fromSnapshotId);\n+    Preconditions.checkArgument(\n+        snapshotIdsRange.contains(newFromSnapshotId),\n+        \"newFromSnapshotId %s not in existing snapshot ids range (%s, %s]\",\n+        newFromSnapshotId, fromSnapshotId, newToSnapshotId);\n+    Preconditions.checkArgument(\n+        snapshotIdsRange.contains(newToSnapshotId),\n+        \"newToSnapshotId %s not in existing snapshot ids range (%s, %s]\",\n+        newToSnapshotId, fromSnapshotId, toSnapshotId);\n+  }\n+\n+  private static void validateSnapshotIds(Table table, long fromSnapshotId, long toSnapshotId) {\n+    Preconditions.checkArgument(fromSnapshotId != toSnapshotId, \"fromSnapshotId and toSnapshotId cannot be the same\");", "originalCommit": "4e5805b685d4e900e3ebd91a3220532b312a0f67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQwODgyOA==", "url": "https://github.com/apache/iceberg/pull/782#discussion_r377408828", "bodyText": "Makes sense. Fixed", "author": "rdsr", "createdAt": "2020-02-11T01:17:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQwNDI3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQwOTcxNA==", "url": "https://github.com/apache/iceberg/pull/782#discussion_r377409714", "bodyText": "Looks like you missed the test assertions.", "author": "rdblue", "createdAt": "2020-02-11T01:20:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQwNDI3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQxMDQ2MA==", "url": "https://github.com/apache/iceberg/pull/782#discussion_r377410460", "bodyText": "oops. I'll fix it", "author": "rdsr", "createdAt": "2020-02-11T01:24:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzQwNDI3MA=="}], "type": "inlineReview"}, {"oid": "d43d345101f7d54ca259853fbd9f5a4f0c1bdf99", "url": "https://github.com/apache/iceberg/commit/d43d345101f7d54ca259853fbd9f5a4f0c1bdf99", "message": "Address review comments", "committedDate": "2020-02-11T01:28:38Z", "type": "commit"}, {"oid": "d43d345101f7d54ca259853fbd9f5a4f0c1bdf99", "url": "https://github.com/apache/iceberg/commit/d43d345101f7d54ca259853fbd9f5a4f0c1bdf99", "message": "Address review comments", "committedDate": "2020-02-11T01:28:38Z", "type": "forcePushed"}]}