{"pr_number": 2011, "pr_title": "Add equals and hashcode to BaseSnapshot", "pr_createdAt": "2020-12-30T14:32:39Z", "pr_url": "https://github.com/apache/iceberg/pull/2011", "timeline": [{"oid": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "url": "https://github.com/apache/iceberg/commit/3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "message": "Add equals and hashcode to BaseSnapshot", "committedDate": "2020-12-30T14:31:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDYxMA==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550684610", "bodyText": "Can you use Objects.hash instead? That's a much more compact implementation that does basically the same thing.", "author": "rdblue", "createdAt": "2020-12-31T20:15:05Z", "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -211,6 +211,32 @@ private void cacheChanges() {\n     this.cachedDeletes = deletes.build();\n   }\n \n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o instanceof BaseSnapshot) {\n+      BaseSnapshot other = (BaseSnapshot) o;\n+      return this.snapshotId == other.snapshotId() &&\n+          this.parentId.equals(other.parentId()) &&\n+          this.sequenceNumber == other.sequenceNumber() &&\n+          this.timestampMillis == other.timestampMillis();\n+\n+    }\n+    return false;\n+  }\n+\n+  @Override\n+  public int hashCode() {\n+    int hash = 7;\n+    hash = 31 * hash + (int) this.snapshotId;\n+    hash = 31 * hash + (this.parentId == null ? 0 : this.parentId.hashCode());\n+    hash = 31 * hash + (int) sequenceNumber;\n+    hash = 31 * hash + (int) timestampMillis;\n+    return hash;", "originalCommit": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc2NDkwNg==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550764906", "bodyText": "Sure!", "author": "Fokko", "createdAt": "2021-01-01T12:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDYxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDgzMg==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550684832", "bodyText": "Style nits: we like to separate control flow blocks with a blank line, and avoid a blank line before the end of a block or method.", "author": "rdblue", "createdAt": "2020-12-31T20:16:32Z", "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -211,6 +211,32 @@ private void cacheChanges() {\n     this.cachedDeletes = deletes.build();\n   }\n \n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o instanceof BaseSnapshot) {\n+      BaseSnapshot other = (BaseSnapshot) o;\n+      return this.snapshotId == other.snapshotId() &&\n+          this.parentId.equals(other.parentId()) &&\n+          this.sequenceNumber == other.sequenceNumber() &&\n+          this.timestampMillis == other.timestampMillis();\n+\n+    }\n+    return false;", "originalCommit": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc2NDk4Mw==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550764983", "bodyText": "Thanks for letting me know, I've updated the style.", "author": "Fokko", "createdAt": "2021-01-01T12:41:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDgzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDk1MA==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550684950", "bodyText": "Shouldn't this also include the the table  that was loaded? Or is it enough that id and parent id are almost certainly unique?", "author": "rdblue", "createdAt": "2020-12-31T20:17:21Z", "path": "core/src/main/java/org/apache/iceberg/BaseSnapshot.java", "diffHunk": "@@ -211,6 +211,32 @@ private void cacheChanges() {\n     this.cachedDeletes = deletes.build();\n   }\n \n+  @Override\n+  public boolean equals(Object o) {\n+    if (this == o) {\n+      return true;\n+    }\n+    if (o instanceof BaseSnapshot) {\n+      BaseSnapshot other = (BaseSnapshot) o;\n+      return this.snapshotId == other.snapshotId() &&", "originalCommit": "3ef5bc07eaf7c18e0a53f17d9971f38c7c159e1c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDc3MTI5NQ==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550771295", "bodyText": "I had the same thought. For the Beam use-case, this is sufficient. If you want to split out a single stream into multiple tables, then you would do a key-by on the destination table. The comparisons will be made within the table, therefore the sequenceNumber will make this unique. I'm happy to also add the table that was loaded, but this isn't in the class right now.", "author": "Fokko", "createdAt": "2021-01-01T14:00:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDk1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDgxMDI4Nw==", "url": "https://github.com/apache/iceberg/pull/2011#discussion_r550810287", "bodyText": "I think it's okay for now, but it is an open question what makes two snapshots equal. Being careful here and including more fields as you do is pretty reasonable.", "author": "rdblue", "createdAt": "2021-01-01T21:43:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDY4NDk1MA=="}], "type": "inlineReview"}, {"oid": "4354dc8220711813acf6288324be1c8707446bf7", "url": "https://github.com/apache/iceberg/commit/4354dc8220711813acf6288324be1c8707446bf7", "message": "Merge branch 'master' of https://github.com/apache/incubator-iceberg into fd-snapshot-equals", "committedDate": "2021-01-01T12:38:25Z", "type": "commit"}, {"oid": "cfd34dc193cf8b586d2bc88b011fcb11207b4575", "url": "https://github.com/apache/iceberg/commit/cfd34dc193cf8b586d2bc88b011fcb11207b4575", "message": "Use Objects.hashCode", "committedDate": "2021-01-01T13:58:51Z", "type": "commit"}]}