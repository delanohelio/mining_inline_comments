{"pr_number": 629, "pr_title": "Add TimeoutBidder interface", "pr_createdAt": "2020-02-21T10:26:14Z", "pr_url": "https://github.com/prebid/prebid-server-java/pull/629", "timeline": [{"oid": "3359190e16088230a8b0e77bd7b9695d4ac00b86", "url": "https://github.com/prebid/prebid-server-java/commit/3359190e16088230a8b0e77bd7b9695d4ac00b86", "message": "TimeoutBidder interface added.\nFacebookBidder migrate from Bidder to TimeoutBidder", "committedDate": "2020-02-20T14:04:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTUzNA==", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383925534", "bodyText": "Please extract separate method.\nAnd extract timeoutNotification.* into values.", "author": "DGarbar", "createdAt": "2020-02-25T14:49:36Z", "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -128,6 +130,17 @@ public HttpBidderRequester(HttpClient httpClient,\n                         ? BidderError.Type.timeout\n                         : BidderError.Type.generic;\n \n+        if (errorType == BidderError.Type.timeout) {\n+            if (bidder instanceof TimeoutBidder) {\n+                final TimeoutBidder<T> timeoutBidder = (TimeoutBidder<T>) bidder;\n+                final HttpRequest<Void> timeoutNotification = timeoutBidder.makeTimeoutNotification(httpRequest);\n+                if (timeoutNotification != null) {\n+                    httpClient.request(timeoutNotification.getMethod(), timeoutNotification.getUri(),\n+                            timeoutNotification.getHeaders(), timeoutNotification.getBody(), NOTIFICATION_TIMEOUT_MS);\n+                }\n+            }\n+        }", "originalCommit": "3359190e16088230a8b0e77bd7b9695d4ac00b86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNTg2Mg==", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383925862", "bodyText": "in Go they have 200*time.Millisecond", "author": "DGarbar", "createdAt": "2020-02-25T14:50:06Z", "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -43,6 +43,7 @@\n public class HttpBidderRequester {\n \n     private static final Logger logger = LoggerFactory.getLogger(HttpBidderRequester.class);\n+    private static final int NOTIFICATION_TIMEOUT_MS = 5_000;", "originalCommit": "3359190e16088230a8b0e77bd7b9695d4ac00b86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNjM4NQ==", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383926385", "bodyText": "Add javaDoc please.", "author": "DGarbar", "createdAt": "2020-02-25T14:50:54Z", "path": "src/main/java/org/prebid/server/bidder/TimeoutBidder.java", "diffHunk": "@@ -0,0 +1,9 @@\n+package org.prebid.server.bidder;\n+\n+import org.prebid.server.bidder.model.HttpRequest;\n+\n+public interface TimeoutBidder<T> extends Bidder<T> {\n+", "originalCommit": "3359190e16088230a8b0e77bd7b9695d4ac00b86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MzkyNzY4Ng==", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r383927686", "bodyText": "Add tests for timeoutException please.", "author": "DGarbar", "createdAt": "2020-02-25T14:52:50Z", "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -103,22 +104,23 @@ public HttpBidderRequester(HttpClient httpClient,\n     /**\n      * Makes an HTTP request and returns {@link Future} that will be eventually completed with success or error result.\n      */\n-    private <T> Future<HttpCall<T>> doRequest(HttpRequest<T> httpRequest, Timeout timeout) {\n+    private <T> Future<HttpCall<T>> doRequest(HttpRequest<T> httpRequest, Timeout timeout, Bidder<T> bidder) {", "originalCommit": "3359190e16088230a8b0e77bd7b9695d4ac00b86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d9aae091134958fbd8c94705bd37d7c126e611aa", "url": "https://github.com/prebid/prebid-server-java/commit/d9aae091134958fbd8c94705bd37d7c126e611aa", "message": "TimeoutBidder interface added.\nFacebookBidder migrate from Bidder to TimeoutBidder", "committedDate": "2020-02-27T10:20:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTE3ODE5Ng==", "url": "https://github.com/prebid/prebid-server-java/pull/629#discussion_r385178196", "bodyText": "please add   if (bidder instanceof TimeoutBidder) { to this method, or perform\n  final TimeoutBidder<T> timeoutBidder = (TimeoutBidder<T>) bidder; near instanceOf and change method parameter from Bidder to TimeoutBidder.", "author": "DGarbar", "createdAt": "2020-02-27T15:17:33Z", "path": "src/main/java/org/prebid/server/bidder/HttpBidderRequester.java", "diffHunk": "@@ -132,19 +134,30 @@ public HttpBidderRequester(HttpClient httpClient,\n \n         if (errorType == BidderError.Type.timeout) {\n             if (bidder instanceof TimeoutBidder) {\n-                final TimeoutBidder<T> timeoutBidder = (TimeoutBidder<T>) bidder;\n-                final HttpRequest<Void> timeoutNotification = timeoutBidder.makeTimeoutNotification(httpRequest);\n-                if (timeoutNotification != null) {\n-                    httpClient.request(timeoutNotification.getMethod(), timeoutNotification.getUri(),\n-                            timeoutNotification.getHeaders(), timeoutNotification.getBody(), NOTIFICATION_TIMEOUT_MS);\n-                }\n+                doTimeoutNotificationRequest(httpRequest, bidder);\n             }\n         }\n \n         return Future.succeededFuture(\n                 HttpCall.failure(httpRequest, BidderError.create(exception.getMessage(), errorType)));\n     }\n \n+    /**\n+     *  doTimeoutNotificationRequest shoots on {@link TimeoutException} or {@link ConnectTimeoutException},\n+     *  if Bidder supports Timeout notifications\n+     */\n+    private <T> void doTimeoutNotificationRequest(HttpRequest<T> httpRequest, Bidder<T> bidder) {", "originalCommit": "d9aae091134958fbd8c94705bd37d7c126e611aa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "59422876de13820f70dd06d6d7651c76706a0a46", "url": "https://github.com/prebid/prebid-server-java/commit/59422876de13820f70dd06d6d7651c76706a0a46", "message": "Added extra validation", "committedDate": "2020-02-27T15:48:52Z", "type": "commit"}, {"oid": "3cb6eebf2abc66089c4ee0cd0ac699e6a1ea8fd9", "url": "https://github.com/prebid/prebid-server-java/commit/3cb6eebf2abc66089c4ee0cd0ac699e6a1ea8fd9", "message": "cs fix", "committedDate": "2020-02-27T15:53:25Z", "type": "commit"}, {"oid": "0cb2e6f5d0def11e6c910290b2b3af625b04eb18", "url": "https://github.com/prebid/prebid-server-java/commit/0cb2e6f5d0def11e6c910290b2b3af625b04eb18", "message": "Merge branch 'master' into timeout-notification", "committedDate": "2020-05-13T12:50:19Z", "type": "commit"}, {"oid": "6a9de396f7ea2c4e245eeba2ef9d8d4b4bf21dae", "url": "https://github.com/prebid/prebid-server-java/commit/6a9de396f7ea2c4e245eeba2ef9d8d4b4bf21dae", "message": "Fixes after review", "committedDate": "2020-06-04T07:35:29Z", "type": "commit"}, {"oid": "43ab5d762a8772c91fc7f38d9672c18e035d0338", "url": "https://github.com/prebid/prebid-server-java/commit/43ab5d762a8772c91fc7f38d9672c18e035d0338", "message": "Fixes after review", "committedDate": "2020-06-04T07:38:20Z", "type": "commit"}]}