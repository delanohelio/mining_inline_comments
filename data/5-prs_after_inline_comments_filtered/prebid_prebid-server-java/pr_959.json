{"pr_number": 959, "pr_title": "Default account configuration and account status support", "pr_createdAt": "2020-10-16T08:54:37Z", "pr_url": "https://github.com/prebid/prebid-server-java/pull/959", "timeline": [{"oid": "f9f94332e013c3f77d6eff6b02946136b78ff181", "url": "https://github.com/prebid/prebid-server-java/commit/f9f94332e013c3f77d6eff6b02946136b78ff181", "message": "Add support for default account configuration values in application config", "committedDate": "2020-10-15T14:01:54Z", "type": "commit"}, {"oid": "3dd6923f3b41daf1f986e4755c440001605bcaaa", "url": "https://github.com/prebid/prebid-server-java/commit/3dd6923f3b41daf1f986e4755c440001605bcaaa", "message": "Take into consideration account status", "committedDate": "2020-10-16T08:49:31Z", "type": "commit"}, {"oid": "00cff334c9d4861d407f596134538e0a02a8a44a", "url": "https://github.com/prebid/prebid-server-java/commit/00cff334c9d4861d407f596134538e0a02a8a44a", "message": "Update documentation", "committedDate": "2020-10-16T08:54:00Z", "type": "commit"}, {"oid": "00dd80988b2e56cf77987eb260b34978b3c51184", "url": "https://github.com/prebid/prebid-server-java/commit/00dd80988b2e56cf77987eb260b34978b3c51184", "message": "Merge branch 'master' into account-config-retrofit", "committedDate": "2020-12-22T09:16:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUxOTM0OA==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556519348", "bodyText": "Why this annotation required ?", "author": "DGarbar", "createdAt": "2021-01-13T13:29:46Z", "path": "src/main/java/org/prebid/server/spring/config/model/AccountConfigurationProperties.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package org.prebid.server.spring.config.model;\n+\n+import lombok.Data;\n+import lombok.NoArgsConstructor;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.settings.model.Account;\n+import org.prebid.server.settings.model.AccountAnalyticsConfig;\n+import org.prebid.server.settings.model.AccountGdprConfig;\n+import org.prebid.server.settings.model.AccountStatus;\n+import org.springframework.validation.annotation.Validated;\n+\n+@Validated", "originalCommit": "00dd80988b2e56cf77987eb260b34978b3c51184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU4MDE2MQ==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556580161", "bodyText": "Good question. It's been copied along with other annotations that we put on Spring configuration properties POJOs but apparently there are no constraints imposed on any fields in this class so it's redundant. We may put sensible constraints in future and easily overlook adding @Validated annotation though so I'm hesitant about this one.", "author": "schernysh", "createdAt": "2021-01-13T14:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUxOTM0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUyMTEzNQ==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556521135", "bodyText": "Why cant we use AccountGdprConfig class", "author": "DGarbar", "createdAt": "2021-01-13T13:32:39Z", "path": "src/main/java/org/prebid/server/spring/config/model/AccountConfigurationProperties.java", "diffHunk": "@@ -0,0 +1,58 @@\n+package org.prebid.server.spring.config.model;\n+\n+import lombok.Data;\n+import lombok.NoArgsConstructor;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.settings.model.Account;\n+import org.prebid.server.settings.model.AccountAnalyticsConfig;\n+import org.prebid.server.settings.model.AccountGdprConfig;\n+import org.prebid.server.settings.model.AccountStatus;\n+import org.springframework.validation.annotation.Validated;\n+\n+@Validated\n+@Data\n+@NoArgsConstructor\n+public class AccountConfigurationProperties {\n+\n+    private String priceGranularity;\n+\n+    private Integer bannerCacheTtl;\n+\n+    private Integer videoCacheTtl;\n+\n+    private Boolean eventsEnabled;\n+\n+    private Boolean enforceCcpa;\n+\n+    private String gdpr;", "originalCommit": "00dd80988b2e56cf77987eb260b34978b3c51184", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU4MTY0MA==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556581640", "bodyText": "Because we don't want to add @Data @NoArgsConstructor annotations to AccountGdprConfig, i.e. make it a Spring configuration properties POJO.", "author": "schernysh", "createdAt": "2021-01-13T14:57:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUyMTEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU4NjQyMw==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556586423", "bodyText": "Probably you mean AccountAnalyticsConfig because AccountGdprConfig is already have this annotation.", "author": "DGarbar", "createdAt": "2021-01-13T15:03:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUyMTEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjU5ODIyOA==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556598228", "bodyText": "Good point. AccountGdprConfig shouldn't have had these annotations in the first place.", "author": "schernysh", "createdAt": "2021-01-13T15:18:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUyMTEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjYwNjU5NA==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556606594", "bodyText": "Probably my mistake. I copy from GdprConfig which we get from yaml.\nBut why we don't want to make this @DaTa ? Because of mutability ?", "author": "DGarbar", "createdAt": "2021-01-13T15:29:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUyMTEzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjYzMzMzMQ==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r556633331", "bodyText": "Yes, it's a convention for value objects throughout PBS codebase to aspire for immutability unless it is impractical.\nAnother reason to take into consideration - using AccountGdprConfig to represent data in two different places (PBS configuration and account configuration in DB/file/etc) strongly couples these sources and forces changes in one place (account config for example) to affect another place (PBS config) and vice versa. Actually This is what Single Responsibility Principle is called to protect from.", "author": "schernysh", "createdAt": "2021-01-13T15:55:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NjUyMTEzNQ=="}], "type": "inlineReview"}, {"oid": "32e842cb15b7c462988f34de33b2406d325acd95", "url": "https://github.com/prebid/prebid-server-java/commit/32e842cb15b7c462988f34de33b2406d325acd95", "message": "Address review comments", "committedDate": "2021-01-14T08:36:00Z", "type": "commit"}, {"oid": "afa15bf08f0b939ca6a2471cd92e835b7759b1cf", "url": "https://github.com/prebid/prebid-server-java/commit/afa15bf08f0b939ca6a2471cd92e835b7759b1cf", "message": "Merge branch 'master' into account-config-retrofit", "committedDate": "2021-01-14T08:41:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NzQ3NDU2MQ==", "url": "https://github.com/prebid/prebid-server-java/pull/959#discussion_r557474561", "bodyText": "Minor. i'd rather suggest to use ObjectUtils.defaultIfNull(..) instead since we have only 2 possible values.", "author": "rpanchyk", "createdAt": "2021-01-14T15:21:27Z", "path": "src/main/java/org/prebid/server/settings/model/Account.java", "diffHunk": "@@ -31,6 +32,27 @@\n \n     AccountBidValidationConfig bidValidations;\n \n+    AccountStatus status;\n+\n+    public Account merge(Account another) {\n+        return Account.builder()\n+                .id(ObjectUtils.firstNonNull(id, another.id))", "originalCommit": "afa15bf08f0b939ca6a2471cd92e835b7759b1cf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}