{"pr_number": 664, "pr_title": "Add Admixer Bidder", "pr_createdAt": "2020-04-09T21:09:29Z", "pr_url": "https://github.com/prebid/prebid-server-java/pull/664", "timeline": [{"oid": "590a5b68346f3f9d817194d19f2fce278b7a4d2d", "url": "https://github.com/prebid/prebid-server-java/commit/590a5b68346f3f9d817194d19f2fce278b7a4d2d", "message": "Add AdmixeerBidder and tests", "committedDate": "2020-04-09T21:04:51Z", "type": "commit"}, {"oid": "3c20cde4d1059367bc4ce9c09df8ceb4da9fbadc", "url": "https://github.com/prebid/prebid-server-java/commit/3c20cde4d1059367bc4ce9c09df8ceb4da9fbadc", "message": "Merge branch 'master' into add-admixer-bidder", "committedDate": "2020-04-09T21:12:14Z", "type": "commit"}, {"oid": "ecf9dc8b7a5ad0134dda80772a1964e17fac3898", "url": "https://github.com/prebid/prebid-server-java/commit/ecf9dc8b7a5ad0134dda80772a1964e17fac3898", "message": "Merge to master branch", "committedDate": "2020-04-09T21:35:25Z", "type": "commit"}, {"oid": "a5e929ddfa3e2942965b80dc6d0bb644aa243938", "url": "https://github.com/prebid/prebid-server-java/commit/a5e929ddfa3e2942965b80dc6d0bb644aa243938", "message": "Merge branch 'master' into add-admixer-bidder", "committedDate": "2020-04-09T21:44:08Z", "type": "commit"}, {"oid": "aefc9cef679afe53c6659c2f4300bf67d575d07e", "url": "https://github.com/prebid/prebid-server-java/commit/aefc9cef679afe53c6659c2f4300bf67d575d07e", "message": "Fixing it tests", "committedDate": "2020-04-09T21:48:12Z", "type": "commit"}, {"oid": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "url": "https://github.com/prebid/prebid-server-java/commit/8eb4a963128d6eaf20749aebf35b876f2988cbe8", "message": "Move currency rates from targeting", "committedDate": "2020-04-09T21:58:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4MjI4MQ==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407482281", "bodyText": "method not according call chain", "author": "DGarbar", "createdAt": "2020-04-13T13:38:46Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -0,0 +1,168 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.vertx.core.http.HttpMethod;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class AdmixerBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpAdmixer>> ADMIXER_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpAdmixer>>() {\n+            };\n+\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public AdmixerBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    private static BidType getBidType(String impId, List<Imp> imps) {\n+        for (Imp imp : imps) {\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                } else if (imp.getVideo() != null) {\n+                    return BidType.video;\n+                } else if (imp.getXNative() != null) {\n+                    return BidType.xNative;\n+                } else if (imp.getAudio() != null) {\n+                    return BidType.audio;\n+                }\n+            }\n+        }\n+        return BidType.banner;\n+    }", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ4NTk5Nw==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407485997", "bodyText": "Didn't update according to Go.\nYou just rewrite with the same value.\nIn GO they creating ext only with CustomParam.", "author": "DGarbar", "createdAt": "2020-04-13T13:46:46Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -0,0 +1,168 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.vertx.core.http.HttpMethod;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class AdmixerBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpAdmixer>> ADMIXER_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpAdmixer>>() {\n+            };\n+\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public AdmixerBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    private static BidType getBidType(String impId, List<Imp> imps) {\n+        for (Imp imp : imps) {\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                } else if (imp.getVideo() != null) {\n+                    return BidType.video;\n+                } else if (imp.getXNative() != null) {\n+                    return BidType.xNative;\n+                } else if (imp.getAudio() != null) {\n+                    return BidType.audio;\n+                }\n+            }\n+        }\n+        return BidType.banner;\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+\n+        if (request.getImp().size() == 0) {\n+            errors.add(BidderError.badInput(\"No valid impressions in the bid request\"));\n+            return Result.of(Collections.emptyList(), errors);\n+        }\n+\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final ExtImpAdmixer extImp = parseImpExt(imp);\n+                final Imp updatedImp = processImp(imp, extImp);\n+                validImps.add(updatedImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+        final BidRequest outgoingRequest = request.toBuilder().imp(validImps).build();\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(HttpUtil.headers())\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private ExtImpAdmixer parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), ADMIXER_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private Imp processImp(Imp imp, ExtImpAdmixer extImpAdmixer) {\n+        if (extImpAdmixer.getZone().length() != 36) {\n+            throw new PreBidException(\"ZoneId must be UUID/GUID\");\n+        }\n+\n+        final Imp impUpdate = imp.toBuilder()\n+                .tagid(extImpAdmixer.getZone())\n+                .bidfloor(BigDecimal.valueOf(extImpAdmixer.getCustomFloor()))\n+                .ext(null)\n+                .build();\n+\n+        if (extImpAdmixer.getCustomParams() != null) {\n+            impUpdate.toBuilder().ext(mapper.mapper().valueToTree(extImpAdmixer)).build();", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5MDE5OQ==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407490199", "bodyText": "Try to avoid recreating of any object.\n(You can create ext above and using it in the builder )", "author": "DGarbar", "createdAt": "2020-04-13T13:55:37Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -0,0 +1,168 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.vertx.core.http.HttpMethod;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class AdmixerBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpAdmixer>> ADMIXER_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpAdmixer>>() {\n+            };\n+\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public AdmixerBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    private static BidType getBidType(String impId, List<Imp> imps) {\n+        for (Imp imp : imps) {\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                } else if (imp.getVideo() != null) {\n+                    return BidType.video;\n+                } else if (imp.getXNative() != null) {\n+                    return BidType.xNative;\n+                } else if (imp.getAudio() != null) {\n+                    return BidType.audio;\n+                }\n+            }\n+        }\n+        return BidType.banner;\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+\n+        if (request.getImp().size() == 0) {\n+            errors.add(BidderError.badInput(\"No valid impressions in the bid request\"));\n+            return Result.of(Collections.emptyList(), errors);\n+        }\n+\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final ExtImpAdmixer extImp = parseImpExt(imp);\n+                final Imp updatedImp = processImp(imp, extImp);\n+                validImps.add(updatedImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+        final BidRequest outgoingRequest = request.toBuilder().imp(validImps).build();\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(HttpUtil.headers())\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private ExtImpAdmixer parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), ADMIXER_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private Imp processImp(Imp imp, ExtImpAdmixer extImpAdmixer) {\n+        if (extImpAdmixer.getZone().length() != 36) {\n+            throw new PreBidException(\"ZoneId must be UUID/GUID\");\n+        }\n+\n+        final Imp impUpdate = imp.toBuilder()\n+                .tagid(extImpAdmixer.getZone())\n+                .bidfloor(BigDecimal.valueOf(extImpAdmixer.getCustomFloor()))\n+                .ext(null)\n+                .build();\n+\n+        if (extImpAdmixer.getCustomParams() != null) {\n+            impUpdate.toBuilder().ext(mapper.mapper().valueToTree(extImpAdmixer)).build();", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5MjQzMw==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407492433", "bodyText": "Use CollectionUtils", "author": "DGarbar", "createdAt": "2020-04-13T14:00:05Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -0,0 +1,168 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.vertx.core.http.HttpMethod;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class AdmixerBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpAdmixer>> ADMIXER_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpAdmixer>>() {\n+            };\n+\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public AdmixerBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    private static BidType getBidType(String impId, List<Imp> imps) {\n+        for (Imp imp : imps) {\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                } else if (imp.getVideo() != null) {\n+                    return BidType.video;\n+                } else if (imp.getXNative() != null) {\n+                    return BidType.xNative;\n+                } else if (imp.getAudio() != null) {\n+                    return BidType.audio;\n+                }\n+            }\n+        }\n+        return BidType.banner;\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+\n+        if (request.getImp().size() == 0) {\n+            errors.add(BidderError.badInput(\"No valid impressions in the bid request\"));\n+            return Result.of(Collections.emptyList(), errors);\n+        }\n+\n+        for (Imp imp : request.getImp()) {\n+            try {\n+                final ExtImpAdmixer extImp = parseImpExt(imp);\n+                final Imp updatedImp = processImp(imp, extImp);\n+                validImps.add(updatedImp);\n+            } catch (PreBidException e) {\n+                errors.add(BidderError.badInput(e.getMessage()));\n+            }\n+        }\n+        final BidRequest outgoingRequest = request.toBuilder().imp(validImps).build();\n+        final String body = mapper.encode(outgoingRequest);\n+\n+        return Result.of(Collections.singletonList(\n+                HttpRequest.<BidRequest>builder()\n+                        .method(HttpMethod.POST)\n+                        .uri(endpointUrl)\n+                        .headers(HttpUtil.headers())\n+                        .payload(outgoingRequest)\n+                        .body(body)\n+                        .build()),\n+                errors);\n+    }\n+\n+    private ExtImpAdmixer parseImpExt(Imp imp) {\n+        try {\n+            return mapper.mapper().convertValue(imp.getExt(), ADMIXER_EXT_TYPE_REFERENCE).getBidder();\n+        } catch (IllegalArgumentException e) {\n+            throw new PreBidException(e.getMessage(), e);\n+        }\n+    }\n+\n+    private Imp processImp(Imp imp, ExtImpAdmixer extImpAdmixer) {\n+        if (extImpAdmixer.getZone().length() != 36) {\n+            throw new PreBidException(\"ZoneId must be UUID/GUID\");\n+        }\n+\n+        final Imp impUpdate = imp.toBuilder()\n+                .tagid(extImpAdmixer.getZone())\n+                .bidfloor(BigDecimal.valueOf(extImpAdmixer.getCustomFloor()))\n+                .ext(null)\n+                .build();\n+\n+        if (extImpAdmixer.getCustomParams() != null) {\n+            impUpdate.toBuilder().ext(mapper.mapper().valueToTree(extImpAdmixer)).build();\n+        }\n+        return impUpdate;\n+    }\n+\n+    @Override\n+    public Result<List<BidderBid>> makeBids(HttpCall<BidRequest> httpCall, BidRequest bidRequest) {\n+        final int statusCode = httpCall.getResponse().getStatusCode();\n+        if (statusCode == HttpResponseStatus.NO_CONTENT.code()) {\n+            return Result.of(Collections.emptyList(), Collections.emptyList());\n+        } else if (statusCode == HttpResponseStatus.BAD_REQUEST.code()) {\n+            return Result.emptyWithError(BidderError.badInput(\"Invalid request.\"));\n+        } else if (statusCode != HttpResponseStatus.OK.code()) {\n+            return Result.emptyWithError(BidderError.badServerResponse(String.format(\"Unexpected HTTP status %s.\",\n+                    statusCode)));\n+        }\n+\n+        final BidResponse bidResponse;\n+        try {\n+            bidResponse = decodeBodyToBidResponse(httpCall);\n+        } catch (PreBidException e) {\n+            return Result.emptyWithError(BidderError.badServerResponse(e.getMessage()));\n+        }\n+\n+        if ((bidResponse.getSeatbid().size() == 0) || (bidResponse.getSeatbid().get(0).getBid().size() == 0)) {", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5MzYwMg==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407493602", "bodyText": "Use CollectionUtils", "author": "DGarbar", "createdAt": "2020-04-13T14:02:24Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -0,0 +1,168 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.type.TypeReference;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import io.netty.handler.codec.http.HttpResponseStatus;\n+import io.vertx.core.http.HttpMethod;\n+import org.prebid.server.bidder.Bidder;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.exception.PreBidException;\n+import org.prebid.server.json.DecodeException;\n+import org.prebid.server.json.JacksonMapper;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+import org.prebid.server.proto.openrtb.ext.response.BidType;\n+import org.prebid.server.util.HttpUtil;\n+\n+import java.math.BigDecimal;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+import java.util.stream.Collectors;\n+\n+public class AdmixerBidder implements Bidder<BidRequest> {\n+\n+    private static final TypeReference<ExtPrebid<?, ExtImpAdmixer>> ADMIXER_EXT_TYPE_REFERENCE =\n+            new TypeReference<ExtPrebid<?, ExtImpAdmixer>>() {\n+            };\n+\n+    private static final String DEFAULT_BID_CURRENCY = \"USD\";\n+\n+    private final String endpointUrl;\n+    private final JacksonMapper mapper;\n+\n+    public AdmixerBidder(String endpointUrl, JacksonMapper mapper) {\n+        this.endpointUrl = HttpUtil.validateUrl(Objects.requireNonNull(endpointUrl));\n+        this.mapper = Objects.requireNonNull(mapper);\n+    }\n+\n+    private static BidType getBidType(String impId, List<Imp> imps) {\n+        for (Imp imp : imps) {\n+            if (imp.getId().equals(impId)) {\n+                if (imp.getBanner() != null) {\n+                    return BidType.banner;\n+                } else if (imp.getVideo() != null) {\n+                    return BidType.video;\n+                } else if (imp.getXNative() != null) {\n+                    return BidType.xNative;\n+                } else if (imp.getAudio() != null) {\n+                    return BidType.audio;\n+                }\n+            }\n+        }\n+        return BidType.banner;\n+    }\n+\n+    @Override\n+    public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n+        final List<BidderError> errors = new ArrayList<>();\n+        final List<Imp> validImps = new ArrayList<>();\n+\n+        if (request.getImp().size() == 0) {", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NDE1Mw==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407494153", "bodyText": "NotHaveLength", "author": "DGarbar", "createdAt": "2020-04-13T14:03:35Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NDU3MA==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407494570", "bodyText": "redundant", "author": "DGarbar", "createdAt": "2020-04-13T14:04:20Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(singletonList(Imp.builder()\n+                        .id(\"123\")\n+                        .ext(mapper.valueToTree(ExtPrebid.of(null, ExtImpAdmixer.of(\"zoneId\", 36D,\n+                                givenCustomParams(\"foo1\", singletonList(\"bar1\")))))).build()))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"ZoneId must be UUID/GUID\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldCreateCorrectURL() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(asList(\n+                        givenImp(identity()),\n+                        givenImp(impBuilder -> impBuilder.banner(null).xNative(Native.builder().build()))))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue()).hasSize(1);\n+        assertThat(result.getValue().get(0).getUri()).isEqualTo(ENDPOINT_URL);\n+    }", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NTAwMg==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407495002", "bodyText": "inline throws", "author": "DGarbar", "createdAt": "2020-04-13T14:05:12Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(singletonList(Imp.builder()\n+                        .id(\"123\")\n+                        .ext(mapper.valueToTree(ExtPrebid.of(null, ExtImpAdmixer.of(\"zoneId\", 36D,\n+                                givenCustomParams(\"foo1\", singletonList(\"bar1\")))))).build()))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"ZoneId must be UUID/GUID\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldCreateCorrectURL() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(asList(\n+                        givenImp(identity()),\n+                        givenImp(impBuilder -> impBuilder.banner(null).xNative(Native.builder().build()))))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue()).hasSize(1);\n+        assertThat(result.getValue().get(0).getUri()).isEqualTo(ENDPOINT_URL);\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorIfResponseBodyCouldNotBeParsed() {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\"false\");\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, null);\n+\n+        // then\n+        assertThat(result.getErrors().get(0).getType()).isEqualTo(BidderError.Type.bad_server_response);\n+        assertThat(result.getValue()).isEmpty();\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenSeatBidIsEmpty()\n+            throws JsonProcessingException {\n+        // given", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NTMzNw==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407495337", "bodyText": "EmtyLists", "author": "DGarbar", "createdAt": "2020-04-13T14:05:54Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(singletonList(Imp.builder()\n+                        .id(\"123\")\n+                        .ext(mapper.valueToTree(ExtPrebid.of(null, ExtImpAdmixer.of(\"zoneId\", 36D,\n+                                givenCustomParams(\"foo1\", singletonList(\"bar1\")))))).build()))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"ZoneId must be UUID/GUID\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldCreateCorrectURL() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(asList(\n+                        givenImp(identity()),\n+                        givenImp(impBuilder -> impBuilder.banner(null).xNative(Native.builder().build()))))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue()).hasSize(1);\n+        assertThat(result.getValue().get(0).getUri()).isEqualTo(ENDPOINT_URL);\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorIfResponseBodyCouldNotBeParsed() {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\"false\");\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, null);\n+\n+        // then\n+        assertThat(result.getErrors().get(0).getType()).isEqualTo(BidderError.Type.bad_server_response);\n+        assertThat(result.getValue()).isEmpty();\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenSeatBidIsEmpty()", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NTM2NQ==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407495365", "bodyText": "EmtyLists", "author": "DGarbar", "createdAt": "2020-04-13T14:05:58Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(singletonList(Imp.builder()\n+                        .id(\"123\")\n+                        .ext(mapper.valueToTree(ExtPrebid.of(null, ExtImpAdmixer.of(\"zoneId\", 36D,\n+                                givenCustomParams(\"foo1\", singletonList(\"bar1\")))))).build()))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"ZoneId must be UUID/GUID\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldCreateCorrectURL() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(asList(\n+                        givenImp(identity()),\n+                        givenImp(impBuilder -> impBuilder.banner(null).xNative(Native.builder().build()))))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue()).hasSize(1);\n+        assertThat(result.getValue().get(0).getUri()).isEqualTo(ENDPOINT_URL);\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorIfResponseBodyCouldNotBeParsed() {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\"false\");\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, null);\n+\n+        // then\n+        assertThat(result.getErrors().get(0).getType()).isEqualTo(BidderError.Type.bad_server_response);\n+        assertThat(result.getValue()).isEmpty();\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenSeatBidIsEmpty()\n+            throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall =\n+                givenHttpCall(mapper.writeValueAsString(BidResponse.builder().seatbid(emptyList()).build()));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, BidRequest.builder().build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result).isNotNull()\n+                .extracting(Result::getValue, Result::getErrors)\n+                .containsOnly(Collections.emptyList(), Collections.emptyList());\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenBidsEmpty()", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NTkyOA==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407495928", "bodyText": "Duplicate this test with all possible types also", "author": "DGarbar", "createdAt": "2020-04-13T14:07:14Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(singletonList(Imp.builder()\n+                        .id(\"123\")\n+                        .ext(mapper.valueToTree(ExtPrebid.of(null, ExtImpAdmixer.of(\"zoneId\", 36D,\n+                                givenCustomParams(\"foo1\", singletonList(\"bar1\")))))).build()))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"ZoneId must be UUID/GUID\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldCreateCorrectURL() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(asList(\n+                        givenImp(identity()),\n+                        givenImp(impBuilder -> impBuilder.banner(null).xNative(Native.builder().build()))))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue()).hasSize(1);\n+        assertThat(result.getValue().get(0).getUri()).isEqualTo(ENDPOINT_URL);\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorIfResponseBodyCouldNotBeParsed() {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\"false\");\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, null);\n+\n+        // then\n+        assertThat(result.getErrors().get(0).getType()).isEqualTo(BidderError.Type.bad_server_response);\n+        assertThat(result.getValue()).isEmpty();\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenSeatBidIsEmpty()\n+            throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall =\n+                givenHttpCall(mapper.writeValueAsString(BidResponse.builder().seatbid(emptyList()).build()));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, BidRequest.builder().build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result).isNotNull()\n+                .extracting(Result::getValue, Result::getErrors)\n+                .containsOnly(Collections.emptyList(), Collections.emptyList());\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenBidsEmpty()\n+            throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall =\n+                givenHttpCall(mapper.writeValueAsString(\n+                        BidResponse.builder()\n+                        .seatbid(singletonList(SeatBid.builder().bid(emptyList()).build()))\n+                        .build()));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, BidRequest.builder().build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result).isNotNull()\n+                .extracting(Result::getValue, Result::getErrors)\n+                .containsOnly(Collections.emptyList(), Collections.emptyList());\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnBannerBidIfBannerIsPresentInRequestImp() throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\n+                mapper.writeValueAsString(\n+                        givenBidResponse(bidBuilder -> bidBuilder.impid(\"123\"))));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall,\n+                BidRequest.builder()\n+                        .imp(singletonList(Imp.builder().id(\"123\").banner(Banner.builder().build()).build()))\n+                .build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue())\n+                .containsOnly(BidderBid.of(Bid.builder().impid(\"123\").build(), banner, \"USD\"));\n+    }", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNzQ5NjEzNA==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r407496134", "bodyText": "Not used Remove, or try to use instated of BidRequest.builder", "author": "DGarbar", "createdAt": "2020-04-13T14:07:40Z", "path": "src/test/java/org/prebid/server/bidder/admixer/AdmixerBidderTest.java", "diffHunk": "@@ -0,0 +1,219 @@\n+package org.prebid.server.bidder.admixer;\n+\n+import com.fasterxml.jackson.core.JsonProcessingException;\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.iab.openrtb.request.Banner;\n+import com.iab.openrtb.request.BidRequest;\n+import com.iab.openrtb.request.Imp;\n+import com.iab.openrtb.request.Native;\n+import com.iab.openrtb.response.Bid;\n+import com.iab.openrtb.response.BidResponse;\n+import com.iab.openrtb.response.SeatBid;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.prebid.server.VertxTest;\n+import org.prebid.server.bidder.model.BidderBid;\n+import org.prebid.server.bidder.model.BidderError;\n+import org.prebid.server.bidder.model.HttpCall;\n+import org.prebid.server.bidder.model.HttpRequest;\n+import org.prebid.server.bidder.model.HttpResponse;\n+import org.prebid.server.bidder.model.Result;\n+import org.prebid.server.proto.openrtb.ext.ExtPrebid;\n+import org.prebid.server.proto.openrtb.ext.request.admixer.ExtImpAdmixer;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Function;\n+\n+import static java.util.Arrays.asList;\n+import static java.util.Collections.emptyList;\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonList;\n+import static java.util.Collections.singletonMap;\n+import static java.util.function.Function.identity;\n+import static org.assertj.core.api.Assertions.assertThat;\n+import static org.assertj.core.api.Assertions.assertThatIllegalArgumentException;\n+import static org.prebid.server.proto.openrtb.ext.response.BidType.banner;\n+\n+public class AdmixerBidderTest extends VertxTest {\n+\n+    private static final String ENDPOINT_URL = \"https://test.endpoint.com/\";\n+\n+    private AdmixerBidder admixerBidder;\n+\n+    @Before\n+    public void setUp() {\n+        admixerBidder = new AdmixerBidder(ENDPOINT_URL, jacksonMapper);\n+    }\n+\n+    @Test\n+    public void creationShouldFailOnInvalidEndpointUrl() {\n+        assertThatIllegalArgumentException().isThrownBy(() -> new AdmixerBidder(\"invalid_url\", jacksonMapper));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfImpressionListSizeIsZero() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(emptyList())\n+                        .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"No valid impressions in the bid request\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldReturnErrorIfZoneIdLengthIsNotEqual36() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(singletonList(Imp.builder()\n+                        .id(\"123\")\n+                        .ext(mapper.valueToTree(ExtPrebid.of(null, ExtImpAdmixer.of(\"zoneId\", 36D,\n+                                givenCustomParams(\"foo1\", singletonList(\"bar1\")))))).build()))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).hasSize(1)\n+                .containsOnly(BidderError.badInput(\"ZoneId must be UUID/GUID\"));\n+    }\n+\n+    @Test\n+    public void makeHttpRequestsShouldCreateCorrectURL() {\n+        // given\n+        final BidRequest bidRequest = BidRequest.builder()\n+                .imp(asList(\n+                        givenImp(identity()),\n+                        givenImp(impBuilder -> impBuilder.banner(null).xNative(Native.builder().build()))))\n+                .build();\n+\n+        // when\n+        final Result<List<HttpRequest<BidRequest>>> result = admixerBidder.makeHttpRequests(bidRequest);\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue()).hasSize(1);\n+        assertThat(result.getValue().get(0).getUri()).isEqualTo(ENDPOINT_URL);\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorIfResponseBodyCouldNotBeParsed() {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\"false\");\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, null);\n+\n+        // then\n+        assertThat(result.getErrors().get(0).getType()).isEqualTo(BidderError.Type.bad_server_response);\n+        assertThat(result.getValue()).isEmpty();\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenSeatBidIsEmpty()\n+            throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall =\n+                givenHttpCall(mapper.writeValueAsString(BidResponse.builder().seatbid(emptyList()).build()));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, BidRequest.builder().build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result).isNotNull()\n+                .extracting(Result::getValue, Result::getErrors)\n+                .containsOnly(Collections.emptyList(), Collections.emptyList());\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnErrorsWhenBidsEmpty()\n+            throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall =\n+                givenHttpCall(mapper.writeValueAsString(\n+                        BidResponse.builder()\n+                        .seatbid(singletonList(SeatBid.builder().bid(emptyList()).build()))\n+                        .build()));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall, BidRequest.builder().build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result).isNotNull()\n+                .extracting(Result::getValue, Result::getErrors)\n+                .containsOnly(Collections.emptyList(), Collections.emptyList());\n+    }\n+\n+    @Test\n+    public void makeBidsShouldReturnBannerBidIfBannerIsPresentInRequestImp() throws JsonProcessingException {\n+        // given\n+        final HttpCall<BidRequest> httpCall = givenHttpCall(\n+                mapper.writeValueAsString(\n+                        givenBidResponse(bidBuilder -> bidBuilder.impid(\"123\"))));\n+\n+        // when\n+        final Result<List<BidderBid>> result = admixerBidder.makeBids(httpCall,\n+                BidRequest.builder()\n+                        .imp(singletonList(Imp.builder().id(\"123\").banner(Banner.builder().build()).build()))\n+                .build());\n+\n+        // then\n+        assertThat(result.getErrors()).isEmpty();\n+        assertThat(result.getValue())\n+                .containsOnly(BidderBid.of(Bid.builder().impid(\"123\").build(), banner, \"USD\"));\n+    }\n+\n+    @Test\n+    public void extractTargetingShouldReturnEmptyMap() {\n+        assertThat(admixerBidder.extractTargeting(mapper.createObjectNode())).isEqualTo(emptyMap());\n+    }\n+\n+    private static BidRequest givenBidRequest(\n+            Function<BidRequest.BidRequestBuilder, BidRequest.BidRequestBuilder> bidRequestCustomizer,\n+            Function<Imp.ImpBuilder, Imp.ImpBuilder> impCustomizer) {\n+\n+        return bidRequestCustomizer.apply(BidRequest.builder()\n+                .imp(singletonList(givenImp(impCustomizer))))\n+                .build();\n+    }\n+\n+    private static BidRequest givenBidRequest(Function<Imp.ImpBuilder, Imp.ImpBuilder> impCustomizer) {\n+        return givenBidRequest(identity(), impCustomizer);\n+    }", "originalCommit": "8eb4a963128d6eaf20749aebf35b876f2988cbe8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d7dc3a984cd0d317e950273f19e349dc64933bdf", "url": "https://github.com/prebid/prebid-server-java/commit/d7dc3a984cd0d317e950273f19e349dc64933bdf", "message": "Refactoring code and tests", "committedDate": "2020-04-13T16:32:30Z", "type": "commit"}, {"oid": "2b52b60aa816f30daeed1bf553d362c38945c06b", "url": "https://github.com/prebid/prebid-server-java/commit/2b52b60aa816f30daeed1bf553d362c38945c06b", "message": "Merge branch 'master' into add-admixer-bidder", "committedDate": "2020-04-13T16:37:53Z", "type": "commit"}, {"oid": "ff705dc42f94b6ab363b3eb7f1462b9de7e23da8", "url": "https://github.com/prebid/prebid-server-java/commit/ff705dc42f94b6ab363b3eb7f1462b9de7e23da8", "message": "Merge master", "committedDate": "2020-04-13T16:42:39Z", "type": "commit"}, {"oid": "449729c653597bde0ac243c529a1c1d79dea517c", "url": "https://github.com/prebid/prebid-server-java/commit/449729c653597bde0ac243c529a1c1d79dea517c", "message": "Add link", "committedDate": "2020-04-13T19:20:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NTE4Nw==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r409485187", "bodyText": "use isEmpty()", "author": "DGarbar", "createdAt": "2020-04-16T11:32:09Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -47,29 +49,12 @@ public AdmixerBidder(String endpointUrl, JacksonMapper mapper) {\n         this.mapper = Objects.requireNonNull(mapper);\n     }\n \n-    private static BidType getBidType(String impId, List<Imp> imps) {\n-        for (Imp imp : imps) {\n-            if (imp.getId().equals(impId)) {\n-                if (imp.getBanner() != null) {\n-                    return BidType.banner;\n-                } else if (imp.getVideo() != null) {\n-                    return BidType.video;\n-                } else if (imp.getXNative() != null) {\n-                    return BidType.xNative;\n-                } else if (imp.getAudio() != null) {\n-                    return BidType.audio;\n-                }\n-            }\n-        }\n-        return BidType.banner;\n-    }\n-\n     @Override\n     public Result<List<HttpRequest<BidRequest>>> makeHttpRequests(BidRequest request) {\n         final List<BidderError> errors = new ArrayList<>();\n         final List<Imp> validImps = new ArrayList<>();\n \n-        if (request.getImp().size() == 0) {\n+        if (CollectionUtils.sizeIsEmpty(request.getImp())) {", "originalCommit": "d7dc3a984cd0d317e950273f19e349dc64933bdf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTQ4NTgzNA==", "url": "https://github.com/prebid/prebid-server-java/pull/664#discussion_r409485834", "bodyText": "use isEmpty", "author": "DGarbar", "createdAt": "2020-04-16T11:33:30Z", "path": "src/main/java/org/prebid/server/bidder/admixer/AdmixerBidder.java", "diffHunk": "@@ -141,7 +127,8 @@ private Imp processImp(Imp imp, ExtImpAdmixer extImpAdmixer) {\n             return Result.emptyWithError(BidderError.badServerResponse(e.getMessage()));\n         }\n \n-        if ((bidResponse.getSeatbid().size() == 0) || (bidResponse.getSeatbid().get(0).getBid().size() == 0)) {\n+        if (CollectionUtils.sizeIsEmpty(bidResponse.getSeatbid())", "originalCommit": "d7dc3a984cd0d317e950273f19e349dc64933bdf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "34b9dc1cfe650b0ed4f3748def99d15978d35471", "url": "https://github.com/prebid/prebid-server-java/commit/34b9dc1cfe650b0ed4f3748def99d15978d35471", "message": "Change method call", "committedDate": "2020-04-16T12:22:47Z", "type": "commit"}, {"oid": "9aba45b1a02face0bdbe717b381a3b0cfcace854", "url": "https://github.com/prebid/prebid-server-java/commit/9aba45b1a02face0bdbe717b381a3b0cfcace854", "message": "Add buyeruid to test json", "committedDate": "2020-04-21T15:24:08Z", "type": "commit"}, {"oid": "8ec4d2e5f3b72fa13692650a36fb37a16bd62fe9", "url": "https://github.com/prebid/prebid-server-java/commit/8ec4d2e5f3b72fa13692650a36fb37a16bd62fe9", "message": "Merge branch 'master' into add-admixer-bidder", "committedDate": "2020-05-14T11:55:51Z", "type": "commit"}, {"oid": "a28537f337ab31cf89b0f6e9ba4dbd1ff7b2ce06", "url": "https://github.com/prebid/prebid-server-java/commit/a28537f337ab31cf89b0f6e9ba4dbd1ff7b2ce06", "message": "Merge branch 'master' into add-admixer-bidder", "committedDate": "2020-06-24T15:07:15Z", "type": "commit"}, {"oid": "59b18946c14235286e9d757abef609a42a473630", "url": "https://github.com/prebid/prebid-server-java/commit/59b18946c14235286e9d757abef609a42a473630", "message": "Add pbs-enforces-ccpa property to admixer.yaml file", "committedDate": "2020-06-24T15:12:18Z", "type": "commit"}]}