{"pr_number": 3697, "pr_title": "Fixes #3679: Issues with new media details UI", "pr_createdAt": "2020-04-22T15:31:05Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3697", "timeline": [{"oid": "d58b38b43c5b08f151688bb709883f39c913703f", "url": "https://github.com/commons-app/apps-android-commons/commit/d58b38b43c5b08f151688bb709883f39c913703f", "message": "fix issues with media details ui", "committedDate": "2020-04-22T09:56:50Z", "type": "commit"}, {"oid": "89dc6fa5de0ce58c7f96deb405f742ba07e35fbe", "url": "https://github.com/commons-app/apps-android-commons/commit/89dc6fa5de0ce58c7f96deb405f742ba07e35fbe", "message": "code refactoring", "committedDate": "2020-04-24T04:40:55Z", "type": "commit"}, {"oid": "9ee23eeaeaa59a77f83b61730ea517249bd9c40b", "url": "https://github.com/commons-app/apps-android-commons/commit/9ee23eeaeaa59a77f83b61730ea517249bd9c40b", "message": "minor indentation fix", "committedDate": "2020-04-24T04:46:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQwNjc2OA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#discussion_r414406768", "bodyText": "Plase add a space before =", "author": "neslihanturan", "createdAt": "2020-04-24T08:49:48Z", "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -144,10 +147,14 @@ public static MediaDetailFragment forMedia(int index, boolean editable, boolean\n      * However unlike categories depictions is multi-lingual\n      * Ex: key: en value: monument\n      */\n+    private ImageInfo imageData;\n+    private int oldWidth;\n+    private int newWidth=0;\n     private Depictions depictions;\n     private boolean categoriesLoaded = false;\n     private boolean categoriesPresent = false;\n     private boolean depictionLoaded = false;\n+    private boolean heightVerifyingBoolean= true; // helps in maintaining aspect ratio", "originalCommit": "d58b38b43c5b08f151688bb709883f39c913703f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxNDcwNA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#discussion_r414414704", "bodyText": "Please use more descriptive naming explaining old width of what. And there shouldn't be a need to initialize 0 value of int, condiering it is a member variable and default value is already 0.", "author": "neslihanturan", "createdAt": "2020-04-24T09:01:42Z", "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -144,10 +147,14 @@ public static MediaDetailFragment forMedia(int index, boolean editable, boolean\n      * However unlike categories depictions is multi-lingual\n      * Ex: key: en value: monument\n      */\n+    private ImageInfo imageData;\n+    private int oldWidth;\n+    private int newWidth=0;", "originalCommit": "d58b38b43c5b08f151688bb709883f39c913703f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDQxNTk2Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3697#discussion_r414415967", "bodyText": "I would name imageData as imageInfo, considering its class type and the other usages in the code.", "author": "neslihanturan", "createdAt": "2020-04-24T09:03:53Z", "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -262,29 +306,31 @@ private void displayMediaDetails() {\n      * The imageSpacer is Basically a transparent overlay for the SimpleDraweeView\n      * which holds the image to be displayed( moreover this image is out of\n      * the scroll view )\n-     * @param imageInfo used to calculate height of the ImageSpacer\n+     * @param scrollWidth the current width of the scrollView\n      */\n-    private void updateAspectRatio(ImageInfo imageInfo) {\n-        if (imageInfo != null) {\n-            int screenWidth = scrollView.getWidth();\n-            int finalHeight = (screenWidth*imageInfo.getHeight()) / imageInfo.getWidth();\n+    private void updateAspectRatio(int scrollWidth) {\n+        if (imageData != null) {\n+            int finalHeight = (scrollWidth*imageData.getHeight()) / imageData.getWidth();\n             ViewGroup.LayoutParams params = image.getLayoutParams();\n             ViewGroup.LayoutParams spacerParams = imageSpacer.getLayoutParams();\n             params.height = finalHeight;\n             spacerParams.height = finalHeight;\n             image.setLayoutParams(params);\n             imageSpacer.setLayoutParams(spacerParams);\n+            imageLandscape.setLayoutParams(params);\n         }\n     }\n \n     private final ControllerListener aspectRatioListener = new BaseControllerListener<ImageInfo>() {\n         @Override\n         public void onIntermediateImageSet(String id, @Nullable ImageInfo imageInfo) {\n-            updateAspectRatio(imageInfo);\n+            imageData = imageInfo;", "originalCommit": "d58b38b43c5b08f151688bb709883f39c913703f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}