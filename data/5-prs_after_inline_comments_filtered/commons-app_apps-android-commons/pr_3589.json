{"pr_number": 3589, "pr_title": "Fixed issue #3195 ordering contribution list", "pr_createdAt": "2020-03-27T19:31:58Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3589", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MzQwOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r399663409", "bodyText": "I think sorting using the upload date (dateUploaded) would be more appropriate here. It's my understanding that creation date is the date of creation of the media (image) while the upload date is the date of uploading the media. Correct me if I'm wrong.", "author": "sivaraam", "createdAt": "2020-03-28T13:36:38Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionComparator.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package fr.free.nrw.commons.contributions;\n+\n+import java.util.Comparator;\n+\n+public class ContributionComparator implements Comparator<Contribution> {\n+\n+    @Override\n+    public int compare(Contribution c1, Contribution c2) {\n+        return c1.dateCreated.compareTo(c2.dateCreated);", "originalCommit": "0cee6b9c026f8ef65be48f37ca63129002f0b55f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2NjE4Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r399666187", "bodyText": "hello @sivaraam thanks for the feedback. I think you are right. I assumed the (dateCreated) was the date it was stored on the server. But in that case it doesn't differentiate from (dateUploaded). If you look at the contribution object returned, you realize  dateCreated and dateUploaded have the same value. I will change to dateUploaded for sorting just in case...", "author": "isnirp", "createdAt": "2020-03-28T14:05:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MzQwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3Mzg3Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r399673877", "bodyText": "@sivaraam I reverted the changes I made. I think it's now clean to review... thanks", "author": "isnirp", "createdAt": "2020-03-28T15:22:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MzQwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5Mjg5MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r399692890", "bodyText": "If you look at the contribution object returned, you realize dateCreated and dateUploaded have the same value.\n\nYou're right. For now both fields seem synonymous. Regardless, it's best to go with dateUploaded as I anticipate this changing with #2904.\nOthers might have better knowledge about this.", "author": "sivaraam", "createdAt": "2020-03-28T18:19:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY2MzQwOQ=="}], "type": "inlineReview"}, {"oid": "955945387b5a7e5d7fc93d8de12d7382686fce8b", "url": "https://github.com/commons-app/apps-android-commons/commit/955945387b5a7e5d7fc93d8de12d7382686fce8b", "message": "issue-#3195: order contribution list refactored", "committedDate": "2020-03-28T15:18:01Z", "type": "commit"}, {"oid": "955945387b5a7e5d7fc93d8de12d7382686fce8b", "url": "https://github.com/commons-app/apps-android-commons/commit/955945387b5a7e5d7fc93d8de12d7382686fce8b", "message": "issue-#3195: order contribution list refactored", "committedDate": "2020-03-28T15:18:01Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzYyNg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r399693626", "bodyText": "I'm not really sure if this would happen practically but I believe there might chance of c1.dateUploaded being null (just as Android Studio suggests). To add to the suspicion, the dateUploaded field itself seems to be marked as @Nullable. So, I think it might be better to handle the possible null. I'll defer the decision to the other reviewers, though.", "author": "sivaraam", "createdAt": "2020-03-28T18:26:36Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionComparator.java", "diffHunk": "@@ -0,0 +1,11 @@\n+package fr.free.nrw.commons.contributions;\n+\n+import java.util.Comparator;\n+\n+public class ContributionComparator implements Comparator<Contribution> {\n+\n+  @Override\n+  public int compare(Contribution c1, Contribution c2) {\n+    return c1.dateUploaded.compareTo(c2.dateUploaded);", "originalCommit": "955945387b5a7e5d7fc93d8de12d7382686fce8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5NDUxOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r399694519", "bodyText": "@sivaraam you are right dateUploaded is marked @nullable hence my decision to use dateCreated. but since the value provided for them is synonymous it will work for now. Let's see what other reviewers have to say like you said... thanks", "author": "isnirp", "createdAt": "2020-03-28T18:35:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY5MzYyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA0NjU2Mg==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402046562", "bodyText": "Now that we are saving HH:MM: ss as well, the getter of the dateUploaded in the Media class needs to be modified, so that it only returns yyyy-MM-dd for existing components who needed it in this format", "author": "ashishkumar468", "createdAt": "2020-04-02T04:35:30Z", "path": "app/src/main/java/fr/free/nrw/commons/upload/UploadService.java", "diffHunk": "@@ -285,7 +286,7 @@ private void uploadContribution(Contribution contribution) {\n                         contribution.setFilename(canonicalFilename);\n                         contribution.setImageUrl(uploadResult.getImageinfo().getOriginalUrl());\n                         contribution.setState(Contribution.STATE_COMPLETED);\n-                        contribution.setDateUploaded(CommonsDateUtil.getIso8601DateFormatShort()\n+                        contribution.setDateUploaded(CommonsDateUtil.getIso8601DateFormatTimestamp()", "originalCommit": "a1ce4083f0af04bc6325b49b6caffaf753cc01bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3MDE4Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402070187", "bodyText": "The return format has been changed", "author": "isnirp", "createdAt": "2020-04-02T06:04:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA0NjU2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3NTU5Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402075597", "bodyText": "Why not directly return CommonsDateUtil.getIso8601DateFormatShort().parse(dateUploaded.getTimestamp()) or null if dateUploaded is null?", "author": "ashishkumar468", "createdAt": "2020-04-02T06:20:31Z", "path": "app/src/main/java/fr/free/nrw/commons/Media.java", "diffHunk": "@@ -347,7 +347,14 @@ public void setDateCreated(Date date) {\n      */\n     public @Nullable\n     Date getDateUploaded() {\n-        return dateUploaded;\n+      String date = CommonsDateUtil.getIso8601DateFormatShort().format(dateUploaded);\n+      Date uploadDate = dateUploaded;\n+      try {\n+        uploadDate = CommonsDateUtil.getIso8601DateFormatShort().parse(date);", "originalCommit": "208e278ccc87b14e2c448ac58d7842893f6cdd3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3OTIyMw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402079223", "bodyText": "There isn't getTimestamp() for util.Date. I can do parse(dateUploaded.toString()). I would still have to catch the exception in the method.", "author": "isnirp", "createdAt": "2020-04-02T06:30:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3NTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE1ODI5OQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402158299", "bodyText": "hello @ashishkumar468 I think we can just return the dateUploaded like before. This a log of a test I did with the previous ;", "author": "isnirp", "createdAt": "2020-04-02T09:00:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3NTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3ODk0Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402178946", "bodyText": "Actually yes, the places where this is used convert them to appropriate format themselves", "author": "ashishkumar468", "createdAt": "2020-04-02T09:33:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3NTU5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3OTEzMw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402179133", "bodyText": "Can you revert the changes in this method then?", "author": "ashishkumar468", "createdAt": "2020-04-02T09:33:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjA3NTU5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3OTM1MQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402179351", "bodyText": "Can you revert this?", "author": "ashishkumar468", "createdAt": "2020-04-02T09:33:56Z", "path": "app/src/main/java/fr/free/nrw/commons/contributions/ContributionsListFragment.java", "diffHunk": "@@ -21,6 +21,7 @@\n import com.google.android.material.floatingactionbutton.FloatingActionButton;\n \n import java.util.ArrayList;\n+import java.util.Collections;", "originalCommit": "208e278ccc87b14e2c448ac58d7842893f6cdd3f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3OTQ1NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402179454", "bodyText": "Please revert this", "author": "ashishkumar468", "createdAt": "2020-04-02T09:34:06Z", "path": "app/src/main/java/fr/free/nrw/commons/upload/UploadService.java", "diffHunk": "@@ -8,6 +8,7 @@\n import android.net.Uri;\n import android.os.Bundle;\n \n+import android.util.Log;", "originalCommit": "208e278ccc87b14e2c448ac58d7842893f6cdd3f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3OTcxOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402179718", "bodyText": "Please add java docs", "author": "ashishkumar468", "createdAt": "2020-04-02T09:34:30Z", "path": "app/src/main/java/fr/free/nrw/commons/utils/CommonsDateUtil.java", "diffHunk": "@@ -20,4 +20,10 @@ public static SimpleDateFormat getIso8601DateFormatShort() {\n         simpleDateFormat.setTimeZone(TimeZone.getTimeZone(\"UTC\"));\n         return simpleDateFormat;\n     }\n+", "originalCommit": "208e278ccc87b14e2c448ac58d7842893f6cdd3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxMDMzNw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402310337", "bodyText": "Please add what does this return value means too", "author": "neslihanturan", "createdAt": "2020-04-02T13:26:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjE3OTcxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMwOTcyMQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3589#discussion_r402309721", "bodyText": "Please revert unnecessary changes, they makes it harder to review the code.", "author": "neslihanturan", "createdAt": "2020-04-02T13:25:17Z", "path": "app/src/main/java/fr/free/nrw/commons/Media.java", "diffHunk": "@@ -347,7 +347,7 @@ public void setDateCreated(Date date) {\n      */\n     public @Nullable\n     Date getDateUploaded() {\n-        return dateUploaded;\n+      return dateUploaded;\n     }", "originalCommit": "f03cd1d30eacbcbd9f7b53b422c23200c96c99ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9f941a4e1d0e883fd53beb440ed721d41982a41c", "url": "https://github.com/commons-app/apps-android-commons/commit/9f941a4e1d0e883fd53beb440ed721d41982a41c", "message": "issue-#3195: ordered contribution list", "committedDate": "2020-04-03T05:13:25Z", "type": "commit"}, {"oid": "9f941a4e1d0e883fd53beb440ed721d41982a41c", "url": "https://github.com/commons-app/apps-android-commons/commit/9f941a4e1d0e883fd53beb440ed721d41982a41c", "message": "issue-#3195: ordered contribution list", "committedDate": "2020-04-03T05:13:25Z", "type": "forcePushed"}]}