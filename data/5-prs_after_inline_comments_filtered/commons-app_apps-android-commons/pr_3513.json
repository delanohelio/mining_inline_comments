{"pr_number": 3513, "pr_title": "Fixes #3506: Image height remains zero for some time on bad network", "pr_createdAt": "2020-03-13T21:26:40Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3513", "timeline": [{"oid": "88a8a52e63b31c37057c2e013fa9144d5909d693", "url": "https://github.com/commons-app/apps-android-commons/commit/88a8a52e63b31c37057c2e013fa9144d5909d693", "message": "optimise width loading", "committedDate": "2020-03-13T21:29:15Z", "type": "commit"}, {"oid": "88a8a52e63b31c37057c2e013fa9144d5909d693", "url": "https://github.com/commons-app/apps-android-commons/commit/88a8a52e63b31c37057c2e013fa9144d5909d693", "message": "optimise width loading", "committedDate": "2020-03-13T21:29:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjkxMjA4MA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r392912080", "bodyText": "you don't need to create a variable just return dm.widthPixels", "author": "macgills", "createdAt": "2020-03-16T10:22:34Z", "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -243,13 +246,22 @@ private void displayMediaDetails() {\n \n     private void updateAspectRatio(ImageInfo imageInfo) {\n         if (imageInfo != null) {\n-            int finalHeight = (scrollView.getWidth()*imageInfo.getHeight()) / imageInfo.getWidth();\n+            int screenWidth = getScreenWidth(getContext());\n+            int finalHeight = (screenWidth*imageInfo.getHeight()) / imageInfo.getWidth();\n             ViewGroup.LayoutParams params = image.getLayoutParams();\n             params.height = finalHeight;\n             image.setLayoutParams(params);\n         }\n     }\n \n+    private int getScreenWidth(Context context) {\n+        DisplayMetrics dm = new DisplayMetrics();\n+        WindowManager windowManager = (WindowManager) context.getSystemService(WINDOW_SERVICE);\n+        windowManager.getDefaultDisplay().getMetrics(dm);\n+        int width = dm.widthPixels;", "originalCommit": "88a8a52e63b31c37057c2e013fa9144d5909d693", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1dc0deca3a5332b48fc3588d9b7ac340fa737b2b", "url": "https://github.com/commons-app/apps-android-commons/commit/1dc0deca3a5332b48fc3588d9b7ac340fa737b2b", "message": "amending as per the reviews", "committedDate": "2020-04-02T15:08:28Z", "type": "commit"}, {"oid": "47c189413c52bc085d1a38862d09ec647ee0fdfe", "url": "https://github.com/commons-app/apps-android-commons/commit/47c189413c52bc085d1a38862d09ec647ee0fdfe", "message": "aspect ratio updates after layout completion", "committedDate": "2020-04-07T07:56:11Z", "type": "commit"}, {"oid": "47c189413c52bc085d1a38862d09ec647ee0fdfe", "url": "https://github.com/commons-app/apps-android-commons/commit/47c189413c52bc085d1a38862d09ec647ee0fdfe", "message": "aspect ratio updates after layout completion", "committedDate": "2020-04-07T07:56:11Z", "type": "forcePushed"}, {"oid": "47c189413c52bc085d1a38862d09ec647ee0fdfe", "url": "https://github.com/commons-app/apps-android-commons/commit/47c189413c52bc085d1a38862d09ec647ee0fdfe", "message": "aspect ratio updates after layout completion", "committedDate": "2020-04-07T07:56:11Z", "type": "forcePushed"}, {"oid": "39dcc10519bb92ac603fa858fec4b9857687028d", "url": "https://github.com/commons-app/apps-android-commons/commit/39dcc10519bb92ac603fa858fec4b9857687028d", "message": "MediaDetailFragment: update aspect ratio using onGlobalLayoutListener", "committedDate": "2020-04-07T12:54:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4NjkyMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r404786920", "bodyText": "This should be the only new import I think", "author": "macgills", "createdAt": "2020-04-07T12:57:33Z", "path": "app/src/main/java/fr/free/nrw/commons/media/MediaDetailFragment.java", "diffHunk": "@@ -9,11 +9,14 @@\n import android.os.Bundle;\n import android.text.Editable;\n import android.text.TextWatcher;\n+import android.util.DisplayMetrics;\n import android.util.TypedValue;\n import android.view.LayoutInflater;\n import android.view.View;\n import android.view.ViewGroup;\n import android.view.ViewTreeObserver;\n+import android.view.ViewTreeObserver.OnGlobalLayoutListener;", "originalCommit": "39dcc10519bb92ac603fa858fec4b9857687028d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4ODcxOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r404788718", "bodyText": "no it shows error otherwise, both imports would be required", "author": "kbhardwaj123", "createdAt": "2020-04-07T13:00:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4NjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5ODEzOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r404798139", "bodyText": "The other imports, press ctrl+alt+o and turn these options on", "author": "macgills", "createdAt": "2020-04-07T13:14:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4NjkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc5OTk4Mw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3513#discussion_r404799983", "bodyText": "Oh I'll fix those asap", "author": "kbhardwaj123", "createdAt": "2020-04-07T13:16:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc4NjkyMA=="}], "type": "inlineReview"}, {"oid": "86b7aa55efc6afe370afc5313af8eda3e53e6735", "url": "https://github.com/commons-app/apps-android-commons/commit/86b7aa55efc6afe370afc5313af8eda3e53e6735", "message": "remove unnecessary imports", "committedDate": "2020-04-07T13:25:01Z", "type": "commit"}]}