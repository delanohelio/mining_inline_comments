{"pr_number": 3830, "pr_title": "DownSample Upload image to be shown in UploadMediaDetailFragment to handle OOM, Bitmap Too large exception", "pr_createdAt": "2020-06-22T04:22:59Z", "pr_url": "https://github.com/commons-app/apps-android-commons/pull/3830", "timeline": [{"oid": "d8023cb12950702e5bfd3b0b07a483a30eb04cb5", "url": "https://github.com/commons-app/apps-android-commons/commit/d8023cb12950702e5bfd3b0b07a483a30eb04cb5", "message": "Fixes #3829\n* DownSample Upload image to be shown in UploadMediaDetailFragment to handle OOM, Bitmap Too large exception", "committedDate": "2020-06-22T04:19:49Z", "type": "commit"}, {"oid": "b6b1b686dfa0a392321832d7aea7d3f470ed0e03", "url": "https://github.com/commons-app/apps-android-commons/commit/b6b1b686dfa0a392321832d7aea7d3f470ed0e03", "message": "removed unused imports, handled possible exceptions", "committedDate": "2020-06-22T04:29:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzM4NjgwMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r443386800", "bodyText": "Can we use a SimpleDraweeView and .setImageURI to avoid manual bounds decoding?", "author": "macgills", "createdAt": "2020-06-22T08:11:08Z", "path": "app/src/main/java/fr/free/nrw/commons/upload/mediaDetails/UploadMediaDetailFragment.java", "diffHunk": "@@ -284,7 +296,15 @@ public void onImageProcessed(UploadItem uploadItem, Place place) {\n         }\n \n         descriptions = uploadItem.getDescriptions();\n-        photoViewBackgroundImage.setImageURI(uploadItem.getMediaUri());\n+        compositeDisposable\n+            .add(downSampleImage(uploadItem.getContentUri())\n+                .subscribeOn(Schedulers.io())\n+                .observeOn(AndroidSchedulers.mainThread())\n+                .subscribe(bitmap -> {\n+                    if (null != bitmap) {\n+                        photoViewBackgroundImage.setImageBitmap(bitmap);", "originalCommit": "b6b1b686dfa0a392321832d7aea7d3f470ed0e03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be76890986bce899f5200378f898f985a5aa3260", "url": "https://github.com/commons-app/apps-android-commons/commit/be76890986bce899f5200378f898f985a5aa3260", "message": "Let Fresco handle the downsampling of image", "committedDate": "2020-06-23T16:46:52Z", "type": "commit"}, {"oid": "39394dc36957f29bc1ef1b00170843a8789511e4", "url": "https://github.com/commons-app/apps-android-commons/commit/39394dc36957f29bc1ef1b00170843a8789511e4", "message": "invalidate in onTransformEnd", "committedDate": "2020-06-23T16:56:44Z", "type": "commit"}, {"oid": "4f23331682fab46a9e22dea0293e36fa736b9116", "url": "https://github.com/commons-app/apps-android-commons/commit/4f23331682fab46a9e22dea0293e36fa736b9116", "message": "Expose an interface TransformationListener in ZoomableDraweeView to listen to transformation change end", "committedDate": "2020-06-23T17:10:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTc4NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444711784", "bodyText": "was this too long to fit on 1 line?", "author": "macgills", "createdAt": "2020-06-24T07:55:32Z", "path": "app/src/main/java/fr/free/nrw/commons/media/zoomControllers/zoomable/ZoomableDraweeView.java", "diffHunk": "@@ -73,9 +74,18 @@ public void onTransformChanged(Matrix transform) {\n                 }\n \n                 @Override\n-                public void onTransformEnd(Matrix transform) {}\n+                public void onTransformEnd(Matrix transform) {\n+                    if (null != transformationListener) {\n+                        transformationListener.onTransformationEnd();\n+                    }\n+                }\n             };\n \n+    public void setTransformationListener(", "originalCommit": "4f23331682fab46a9e22dea0293e36fa736b9116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcyMDg3Nw==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444720877", "bodyText": "Actually yes :P", "author": "ashishkumar468", "createdAt": "2020-06-24T08:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcyMzMyOQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444723329", "bodyText": "Ohh, sorry, do you mean trying the if, without the braces?", "author": "ashishkumar468", "createdAt": "2020-06-24T08:16:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTc4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcyNjU0NA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444726544", "bodyText": "no, I meant this line. you could shorten the parameter name but it is not necessary", "author": "macgills", "createdAt": "2020-06-24T08:22:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDcxMTc4NA=="}], "type": "inlineReview"}, {"oid": "535a32a55c668d4a88631196d2c1b6ba4a91c17d", "url": "https://github.com/commons-app/apps-android-commons/commit/535a32a55c668d4a88631196d2c1b6ba4a91c17d", "message": "removed photoView dependency", "committedDate": "2020-06-24T08:12:48Z", "type": "commit"}, {"oid": "6064c6d351e566e8e17df73cf71557bb6b587f3f", "url": "https://github.com/commons-app/apps-android-commons/commit/6064c6d351e566e8e17df73cf71557bb6b587f3f", "message": "removed unused imports in ZoomableActivity", "committedDate": "2020-06-24T08:13:51Z", "type": "commit"}, {"oid": "e9c01b609842fdf32ad64099d4c4c3379f8e855c", "url": "https://github.com/commons-app/apps-android-commons/commit/e9c01b609842fdf32ad64099d4c4c3379f8e855c", "message": "Bugfix, expand/collapse", "committedDate": "2020-06-24T08:27:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDczMjI0Ng==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444732246", "bodyText": "needs more space to adhere to codestyle, also can we rename this method? the Ll I am guessing stands for LinearLayout but it just looks so fugly", "author": "macgills", "createdAt": "2020-06-24T08:31:44Z", "path": "app/src/main/java/fr/free/nrw/commons/upload/mediaDetails/UploadMediaDetailFragment.java", "diffHunk": "@@ -401,6 +413,9 @@ public void onRlContainerTitleClicked() {\n      * @param shouldExpand\n      */\n     private void expandCollapseLlMediaDetail(boolean shouldExpand){\n+        if(isExpanded==shouldExpand){", "originalCommit": "e9c01b609842fdf32ad64099d4c4c3379f8e855c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDczNDEyOA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444734128", "bodyText": "Hmm, can you suggest a better name?", "author": "ashishkumar468", "createdAt": "2020-06-24T08:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDczMjI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc0MjMzNQ==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444742335", "bodyText": "just getting rid of the Ll is fine I would think", "author": "macgills", "createdAt": "2020-06-24T08:49:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDczMjI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDc0MzMwMA==", "url": "https://github.com/commons-app/apps-android-commons/pull/3830#discussion_r444743300", "bodyText": "@macgills  Done :)", "author": "ashishkumar468", "createdAt": "2020-06-24T08:50:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDczMjI0Ng=="}], "type": "inlineReview"}, {"oid": "03ef3610e73259b1020c01381bfd8ef16f9af748", "url": "https://github.com/commons-app/apps-android-commons/commit/03ef3610e73259b1020c01381bfd8ef16f9af748", "message": "changed functio name", "committedDate": "2020-06-24T08:50:09Z", "type": "commit"}]}