{"pr_number": 447, "pr_title": "Spring Boot - changes to pxf init", "pr_createdAt": "2020-09-10T21:28:37Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/447", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NjY2NzQ4NA==", "url": "https://github.com/greenplum-db/pxf/pull/447#discussion_r486667484", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    this(new File(String.format(\"%s%sservers\", pxfServerProperties.getRun(), File.separator)));\n          \n          \n            \n                    this(new File(String.format(\"%s%sservers\", pxfServerProperties.getRunDir(), File.separator)));\n          \n      \n    \n    \n  \n\nmaybe name that method better", "author": "denalex", "createdAt": "2020-09-10T22:25:34Z", "path": "server/pxf-api/src/main/java/org/greenplum/pxf/api/model/BaseConfigurationFactory.java", "diffHunk": "@@ -27,7 +27,7 @@\n \n     @Autowired\n     public BaseConfigurationFactory(PxfServerProperties pxfServerProperties) {\n-        this(new File(String.format(\"%s%sservers\", pxfServerProperties.getConf(), File.separator)));\n+        this(new File(String.format(\"%s%sservers\", pxfServerProperties.getRun(), File.separator)));", "originalCommit": "b6889873e0c5dcd716d41a9f1f39aadc2a1443b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "321dc7027921af510e366b5dbfd5c62abe07c5ce", "url": "https://github.com/greenplum-db/pxf/commit/321dc7027921af510e366b5dbfd5c62abe07c5ce", "message": "Address PR feedback\n\nAddress PR feedback", "committedDate": "2020-09-16T20:22:09Z", "type": "forcePushed"}, {"oid": "7d9386255daf320798d638e7166ba2f33a7b23c0", "url": "https://github.com/greenplum-db/pxf/commit/7d9386255daf320798d638e7166ba2f33a7b23c0", "message": "templates are now in PXF_HOME", "committedDate": "2020-09-21T18:00:17Z", "type": "forcePushed"}, {"oid": "80bf97300b1dd60abef2e51ee1383b06de7765a0", "url": "https://github.com/greenplum-db/pxf/commit/80bf97300b1dd60abef2e51ee1383b06de7765a0", "message": "Templates are now in PXF_HOME\n\nFix templates path in readme", "committedDate": "2020-09-22T10:54:46Z", "type": "forcePushed"}, {"oid": "a2463adee0bf58981f9d9aa45ce1320e557a5c88", "url": "https://github.com/greenplum-db/pxf/commit/a2463adee0bf58981f9d9aa45ce1320e557a5c88", "message": "Templates are now in PXF_HOME\n\nFix templates path in readme", "committedDate": "2020-09-22T14:00:23Z", "type": "forcePushed"}, {"oid": "81751fd2021fca4006943fe9375888dbfae0c936", "url": "https://github.com/greenplum-db/pxf/commit/81751fd2021fca4006943fe9375888dbfae0c936", "message": "GO CLI: Support pxf cluster migrate\n\nSimilar to pxf migrate, pxf cluster migrate helps migrating an old PXF\nversion to a new PXF version in a cluster.", "committedDate": "2020-09-23T20:54:34Z", "type": "forcePushed"}, {"oid": "8c3870d1466c8c60dd0b43e15be8bfaaeba3b3e3", "url": "https://github.com/greenplum-db/pxf/commit/8c3870d1466c8c60dd0b43e15be8bfaaeba3b3e3", "message": "Deprecate PXF init and reset commands\n\nStop copying pxf-profiles-default.xml to conf\n\nThe pxf-profiles-default.xml file can be loaded from resources instead\nof a file. This reduces the duplicate existence of this file. We no\nlonger provide a physical file for pxf-profiles-default.xml\n\nRename management.health.probes.enabled to management.endpoint.health.probes.enabled\n\nThe property name changed from management.health.probes.enabled to\nmanagement.endpoint.health.probes.enabled. This commit no longer uses\nthe deprecated property name\n\nRemove redundant properties from pxf-env-default.sh\n\nPXF_CONNECTION_TIMEOUT, PXF_MAX_THREADS, PXF_FRAGMENTER_CACHE are\nproperties that have already been defined in the application.properties\nfile, and are redundant. We prefer application.properties over\nenvironment variables for these properties.\n\nAlso, we no longer need to add files from the $PXF_HOME/conf classpath,\nas the files in the conf directory are going away.\n\nAllow configuring logging.file.name property\n\nSpring Boot exposes the logging.file.name. We take advantage of this\nproperty and use it for the pxf-log4j2.xml file. We still default to\n$PXF_LOGDIR/pxf-service.log for the logging.file.name\n\nAdd PXF banner\n\nInline pxf-env-default.sh inside pxf\n\nThe pxf-env-default.sh file no longer needs to be it's own script and\ncan be merged with the main pxf script. Because `pxf-env-default.sh`\nvalues don't change, we can merge these two scripts\n\nRemove nesting in templates and copy to final target\n\nRemove the unnecessary additional nesting for the templates directory.\nWe now install the templates into its final destination under $PXF_HOME\nby default.\n\nProvide a run directory by default\n\nDon't create the run directory during pxf init, but provide the run\ndirectory by default\n\nCreate the keytab directory during stage\n\nCreate the lib directory\n\nCreate the lib directory, and rename the existing `$PXF_HOME/lib`\ndirectory to `$PXF_HOME/share`.\n\nSplit configuration files into pxf-application.configuration\n\nConfiguration files are now split into pxf-application.configuration\n\nRename PXF_CONF directory to PXF_RUN\n\nThe PXF_RUN directory now defaults to PXF_HOME. pxf init is not a\nrequirement to start PXF.\n\npxf register now only copies the control file\n\nOnly copy the control file during pxf register and update the directory\nand module_pathname to point to the extension directory inside\n$PXF_HOME.\n\nSmall change in Makefile\n\nRename PXF_CONF_DIR to PXF_RUN_DIR\n\nRename PXF_CONF_DIR to PXF_RUN_DIR and default it to PXF_HOME. Also,\nremove the initialization process in PXF and replace it with the pxf\nregister command.\n\nRename PXF_CONF -> PXF_RUN in Dockerfiles\n\nRename PXF_CONF -> PXF_RUN in docker files and default the value to the\nsame value as PXF_HOME\n\nPXF_CONF -> PXF_RUN in automation code\n\nThe automation Makefile uses PXF_CONF, use PXF_RUN now and default it to\nPXF_HOME\n\nFix automation code to create additional files\n\nRPM: create logs, run directory with the correct attributes during RPM install\n\nUpdate README and some comments referring to PXF_CONF\n\nPXF_CONF -> PXF_RUN in regression\n\nPXF_CONF -> PXF_RUN in fdw\n\nPXF_CONF -> PXF_RUN in dev\n\nCopy configuration files to PXF_RUN/conf during automation\n\nFix copying of configuration files to the $PXF_RUN/conf directory\n\nFix automation tests for clouds\n\nPXF_HOME to PXF_RUN\n\nUpdate README.md\n\nPXF_CONF -> PXF_RUN in multinode servers\n\nlib is now share\n\nmkdir instead of pre-created dirs\n\nkeytabs are in\n\nMove jar from server to application\n\nkeytabs are in\n\nfixup! Move jar from server to application\n\ndo not chown ~gpadmin/pxf dir\n\nRegister the extension on multinode setup", "committedDate": "2020-09-24T17:24:42Z", "type": "commit"}, {"oid": "09c3f6ae4c97957e66986da532615ddf06c53e10", "url": "https://github.com/greenplum-db/pxf/commit/09c3f6ae4c97957e66986da532615ddf06c53e10", "message": "Rename PXF_RUN to PXF_BASE", "committedDate": "2020-09-24T17:25:29Z", "type": "commit"}, {"oid": "f93027c5ee8fae7e6e7584434668c8e8860c84b0", "url": "https://github.com/greenplum-db/pxf/commit/f93027c5ee8fae7e6e7584434668c8e8860c84b0", "message": "Implement the pxf [cluster] prepare command\n\nImplement the pxf cluster command:\n - Errors if PXF_HOME == PXF_BASE\n - Errors if PXF_BASE is not empty\n - Errors if it fails to create PXF_BASE\n - Errors if it fails to create dir structure\n - Errors if it fails to copy configuration files\n - Succeeds otherwise\n\nImplement the pxf cluster command:\n - Errors if PXF_BASE is not specified or empty\n - Errors if PXF_HOME == PXF_BASE\n - Errors if the underlying script fails\n - Succeeds otherwise", "committedDate": "2020-09-24T17:25:29Z", "type": "commit"}, {"oid": "908c88a5782388e02b0c9aa3f0ffecdd8b442d5e", "url": "https://github.com/greenplum-db/pxf/commit/908c88a5782388e02b0c9aa3f0ffecdd8b442d5e", "message": "CI: pxf prepare if PXF_BASE is different from PXF_HOME\n\nCI: multinode: pxf cluster prepare if PXF_BASE is different from PXF_HOME\nCI: multinode tests with different PXF_BASE", "committedDate": "2020-09-24T17:25:29Z", "type": "commit"}, {"oid": "759e40c73b17fa73d22aa1a2cf7b9ea3faa4f16d", "url": "https://github.com/greenplum-db/pxf/commit/759e40c73b17fa73d22aa1a2cf7b9ea3faa4f16d", "message": "Templates are now in PXF_HOME\n\nFix templates path in readme", "committedDate": "2020-09-24T17:25:29Z", "type": "commit"}, {"oid": "a61bbd3433eafb039b1aa60ea291d864bc57c751", "url": "https://github.com/greenplum-db/pxf/commit/a61bbd3433eafb039b1aa60ea291d864bc57c751", "message": "CLI: Implement pxf migrate command\n\nImplement the pxf migrate command that allows migration of older\nversions of PXF into a new installation of PXF. For example, for PXF\nversions prior to 6.0, PXF used a configuration property called PXF_CONF\nto specify a directory where PXF configurations are stored.\n\nNow, PXF configurations live under PXF_HOME, this configuration\ndirectory can be relocated to a different location. The base location\nfor configurations in PXF has been renamed to PXF_BASE.\n\nMigration of PXF_CONF to PXF_BASE is enabled by the pxf migrate command\nwhich does the following:\n- Copies the $PXF_CONF/conf/pxf-profiles.xml file to $PXF_BASE/conf/pxf-profiles.xml\n- Copies the $PXF_CONF/{servers,lib,keytabs} directories to $PXF_BASE\n- Merges values of $PXF_CONF/conf/pxf-env.sh into two different files\n  (depending on the property), the two files are\n  ${PXF_BASE}/conf/pxf-application.properties and\n  ${PXF_BASE}/conf/pxf-env.sh\n\nThe pxf migrate utility requires that PXF_CONF is different than\nPXF_BASE. The pxf migrate utility validates that the PXF_CONF and\nPXF_BASE directories are valid directories.", "committedDate": "2020-09-24T17:25:29Z", "type": "commit"}, {"oid": "2e49bea354f67d756f79277c0ace046e4deec2e2", "url": "https://github.com/greenplum-db/pxf/commit/2e49bea354f67d756f79277c0ace046e4deec2e2", "message": "GO CLI: Support pxf cluster migrate\n\nSimilar to pxf migrate, pxf cluster migrate helps migrating an old PXF\nversion to a new PXF version in a cluster.", "committedDate": "2020-09-24T17:25:29Z", "type": "commit"}, {"oid": "2e49bea354f67d756f79277c0ace046e4deec2e2", "url": "https://github.com/greenplum-db/pxf/commit/2e49bea354f67d756f79277c0ace046e4deec2e2", "message": "GO CLI: Support pxf cluster migrate\n\nSimilar to pxf migrate, pxf cluster migrate helps migrating an old PXF\nversion to a new PXF version in a cluster.", "committedDate": "2020-09-24T17:25:29Z", "type": "forcePushed"}]}