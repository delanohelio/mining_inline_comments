{"pr_number": 415, "pr_title": "Hive: Report the correct error message from HiveMetaStoreClientCompat\u2026", "pr_createdAt": "2020-07-30T15:31:20Z", "pr_url": "https://github.com/greenplum-db/pxf/pull/415", "timeline": [{"oid": "004df53f1311a52e29f61ab36ea99b82a736d68d", "url": "https://github.com/greenplum-db/pxf/commit/004df53f1311a52e29f61ab36ea99b82a736d68d", "message": "Hive: Report the correct error message from HiveMetaStoreClientCompatibility1xx\n\nPXF is not reporting the causing error message when accessing Hive\nversion 1.x. PXF is also not reporting the causing error message during\ninitialization of HiveClient. For example, when a RuntimeException is\nthrown when the HiveMetaStoreClientCompatibility1xx failed to\ninstantiate with a MetaException cause. The reported error is\njava.lang.RuntimeException: Unable to instantiate\norg.apache.hadoop.hive.metastore.HiveMetaStoreClientCompatibility1xx,\nhowever the error above does not report the original cause of the\nexception, making debugging harder for users/administrators.", "committedDate": "2020-07-30T15:30:35Z", "type": "commit"}, {"oid": "3f97b1e466745412192cd2e7c12dfd9c9a2bd51e", "url": "https://github.com/greenplum-db/pxf/commit/3f97b1e466745412192cd2e7c12dfd9c9a2bd51e", "message": "recursively modify singlecluster", "committedDate": "2020-07-30T17:29:54Z", "type": "commit"}, {"oid": "4055387ebbd7088f21dbbe27101b7e50145dc401", "url": "https://github.com/greenplum-db/pxf/commit/4055387ebbd7088f21dbbe27101b7e50145dc401", "message": "disable the HiveAdvancedTest temporarily", "committedDate": "2020-07-30T18:31:01Z", "type": "commit"}, {"oid": "59b0923313ca13e6c1ed7983c19bc20b532a7ab8", "url": "https://github.com/greenplum-db/pxf/commit/59b0923313ca13e6c1ed7983c19bc20b532a7ab8", "message": "Revert \"recursively modify singlecluster\"\n\nThis reverts commit 3f97b1e466745412192cd2e7c12dfd9c9a2bd51e.", "committedDate": "2020-07-30T18:31:17Z", "type": "commit"}, {"oid": "1a24b0c89a6b596537ce36af6ec4dff1dfebf784", "url": "https://github.com/greenplum-db/pxf/commit/1a24b0c89a6b596537ce36af6ec4dff1dfebf784", "message": "fix hdp3 table name expected error", "committedDate": "2020-07-30T19:55:45Z", "type": "commit"}, {"oid": "6c77355f897a45dcd46f1a109f67a0533004790a", "url": "https://github.com/greenplum-db/pxf/commit/6c77355f897a45dcd46f1a109f67a0533004790a", "message": "Don't run the test on the security group", "committedDate": "2020-07-30T19:56:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2NTU3MQ==", "url": "https://github.com/greenplum-db/pxf/pull/415#discussion_r463265571", "bodyText": "we do not know for sure that RuntimeException here would be caused only by the failure to instantiate HiveMetaStoreClientCompatibility1xx , it can happen for other reasons as well, I think we should adjust the error message and log it only if we're changing the actual exception that gets propagated.", "author": "denalex", "createdAt": "2020-07-30T20:54:58Z", "path": "server/pxf-hive/src/main/java/org/greenplum/pxf/plugins/hive/HiveClientWrapper.java", "diffHunk": "@@ -420,9 +420,28 @@ static HiveClientFactory getInstance() {\n         }\n \n         IMetaStoreClient initHiveClient(HiveConf hiveConf) throws MetaException {\n-            return RetryingMetaStoreClient.getProxy(hiveConf, new Class[]{HiveConf.class, HiveMetaHookLoader.class, Boolean.class},\n-                    new Object[]{hiveConf, null, true}, null, HiveMetaStoreClientCompatibility1xx.class.getName()\n-            );\n+            try {\n+                return RetryingMetaStoreClient.getProxy(hiveConf, new Class[]{HiveConf.class, HiveMetaHookLoader.class, Boolean.class},\n+                        new Object[]{hiveConf, null, true}, null, HiveMetaStoreClientCompatibility1xx.class.getName()\n+                );\n+            } catch (RuntimeException ex) {\n+                LOG.warn(\"RuntimeException occurred while instantiating the HiveMetaStoreClientCompatibility1xx class\", ex);", "originalCommit": "6c77355f897a45dcd46f1a109f67a0533004790a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzI2NjkwOQ==", "url": "https://github.com/greenplum-db/pxf/pull/415#discussion_r463266909", "bodyText": "this is probably debug-level log entry as it will happen on every call for incompatible Hive versions", "author": "denalex", "createdAt": "2020-07-30T20:57:31Z", "path": "server/pxf-hive/src/main/java/org/apache/hadoop/hive/metastore/HiveMetaStoreClientCompatibility1xx.java", "diffHunk": "@@ -56,6 +57,9 @@ public Table getTable(String dbname, String name) throws TException {\n                     Table table = client.get_table(dbname, name);\n                     return new GetTableResult(table).getTable();\n                 }\n+            } catch (MetaException | NoSuchObjectException ex) {\n+                LOG.warn(\"Original exception not re-thrown\", e);", "originalCommit": "6c77355f897a45dcd46f1a109f67a0533004790a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d072e21db3149f87c05164ff8cfbab654389ff43", "url": "https://github.com/greenplum-db/pxf/commit/d072e21db3149f87c05164ff8cfbab654389ff43", "message": "Address PR feedback", "committedDate": "2020-07-30T21:53:48Z", "type": "commit"}]}