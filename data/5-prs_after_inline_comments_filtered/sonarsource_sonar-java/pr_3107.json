{"pr_number": 3107, "pr_title": "SONARJAVA-3400 Handle DateFormat.getDateInstance()", "pr_createdAt": "2020-07-10T15:27:01Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3107", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3ODE5Mw==", "url": "https://github.com/SonarSource/sonar-java/pull/3107#discussion_r453778193", "bodyText": "The method should probably be renamed since it's no longer just about the type. Maybe just isForbidden.", "author": "sebastian-hungerecker-sonarsource", "createdAt": "2020-07-13T16:32:27Z", "path": "java-checks/src/main/java/org/sonar/java/checks/StaticMultithreadedUnsafeFieldsCheck.java", "diffHunk": "@@ -61,8 +68,20 @@ public void visitNode(Tree tree) {\n   }\n \n   private static boolean isForbiddenType(VariableTree variableTree) {", "originalCommit": "6a481f92a6a48f741df51e5cef02c7fd350ef7b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc3OTM1MQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3107#discussion_r453779351", "bodyText": "The two ifs that return false can be combined into one:\nif (initializer == null || initializer.is(Tree.Kind.NULL_LITERAL)) {\n  return false;\n}", "author": "sebastian-hungerecker-sonarsource", "createdAt": "2020-07-13T16:34:19Z", "path": "java-checks/src/main/java/org/sonar/java/checks/StaticMultithreadedUnsafeFieldsCheck.java", "diffHunk": "@@ -61,8 +68,20 @@ public void visitNode(Tree tree) {\n   }\n \n   private static boolean isForbiddenType(VariableTree variableTree) {\n+    if (isForbiddenType(variableTree.type().symbolType())) {\n+      return true;\n+    }\n     ExpressionTree initializer = variableTree.initializer();\n-    return isForbiddenType(variableTree.type().symbolType()) || (initializer != null && !initializer.is(Tree.Kind.NULL_LITERAL) && isForbiddenType(initializer.symbolType()));\n+    if (initializer == null) {\n+      return false;\n+    }\n+    if (initializer.is(Tree.Kind.NULL_LITERAL)) {\n+      return false;", "originalCommit": "6a481f92a6a48f741df51e5cef02c7fd350ef7b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzc4MTcwNw==", "url": "https://github.com/SonarSource/sonar-java/pull/3107#discussion_r453781707", "bodyText": "This will break the case where the initializer is a method call returning a forbidden type (which should be added as a test case since currently there are only test where a constructor is called rather than a method). The check for isForbiddenType(initializer.symbolType()) should come before this one. Or alternatively this one should only return if the method matcher matches, i.e.:\nif (initializer.is(Tree.Kind.METHOD_INVOCATION) && GET_DATE_INSTANCE.matches((MethodInvocationTree) initializer)) {\n  return true;\n}", "author": "sebastian-hungerecker-sonarsource", "createdAt": "2020-07-13T16:38:00Z", "path": "java-checks/src/main/java/org/sonar/java/checks/StaticMultithreadedUnsafeFieldsCheck.java", "diffHunk": "@@ -61,8 +68,20 @@ public void visitNode(Tree tree) {\n   }\n \n   private static boolean isForbiddenType(VariableTree variableTree) {\n+    if (isForbiddenType(variableTree.type().symbolType())) {\n+      return true;\n+    }\n     ExpressionTree initializer = variableTree.initializer();\n-    return isForbiddenType(variableTree.type().symbolType()) || (initializer != null && !initializer.is(Tree.Kind.NULL_LITERAL) && isForbiddenType(initializer.symbolType()));\n+    if (initializer == null) {\n+      return false;\n+    }\n+    if (initializer.is(Tree.Kind.NULL_LITERAL)) {\n+      return false;\n+    }\n+    if (initializer.is(Tree.Kind.METHOD_INVOCATION)) {\n+      return GET_DATE_INSTANCE.matches((MethodInvocationTree) initializer);", "originalCommit": "6a481f92a6a48f741df51e5cef02c7fd350ef7b4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "14ce1c3ead2943485b3e6f2d71d445309a99ef4b", "url": "https://github.com/SonarSource/sonar-java/commit/14ce1c3ead2943485b3e6f2d71d445309a99ef4b", "message": "Move test file into compiled project", "committedDate": "2020-07-14T06:56:37Z", "type": "commit"}, {"oid": "77f8afb1d08a2ce03b39f3c0186c2387cc06c597", "url": "https://github.com/SonarSource/sonar-java/commit/77f8afb1d08a2ce03b39f3c0186c2387cc06c597", "message": "SONARJAVA-3400 Handle DateFormat.getDateInstance()", "committedDate": "2020-07-14T07:05:13Z", "type": "commit"}, {"oid": "77f8afb1d08a2ce03b39f3c0186c2387cc06c597", "url": "https://github.com/SonarSource/sonar-java/commit/77f8afb1d08a2ce03b39f3c0186c2387cc06c597", "message": "SONARJAVA-3400 Handle DateFormat.getDateInstance()", "committedDate": "2020-07-14T07:05:13Z", "type": "forcePushed"}]}