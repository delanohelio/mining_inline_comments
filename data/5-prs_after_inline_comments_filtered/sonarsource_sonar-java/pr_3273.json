{"pr_number": 3273, "pr_title": "SONARJAVA-3612 FP in S1185 when class is annotated \"@Transactional\"", "pr_createdAt": "2020-11-16T13:27:00Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3273", "timeline": [{"oid": "37859c4681e7cccb7bdd41537a8edc9c04c17414", "url": "https://github.com/SonarSource/sonar-java/commit/37859c4681e7cccb7bdd41537a8edc9c04c17414", "message": "SONARJAVA-3612 FP in S1185 when class is annotated \"@Transactional\"", "committedDate": "2020-11-16T13:21:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk5NDAwNg==", "url": "https://github.com/SonarSource/sonar-java/pull/3273#discussion_r524994006", "bodyText": "Let's double check we won't get NPE here", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-11-17T09:10:53Z", "path": "java-checks/src/main/java/org/sonar/java/checks/MethodOnlyCallsSuperCheck.java", "diffHunk": "@@ -156,4 +164,9 @@ private static boolean hasAnnotationDifferentFromOverride(List<AnnotationTree> a\n     return false;\n   }\n \n+  private static boolean isClassAnnotatedWithTransactional(MethodTree methodTree) {\n+    SymbolMetadata metadata = methodTree.symbol().enclosingClass().metadata();", "originalCommit": "37859c4681e7cccb7bdd41537a8edc9c04c17414", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTE1OTcyNw==", "url": "https://github.com/SonarSource/sonar-java/pull/3273#discussion_r525159727", "bodyText": "enclosingClass() returns null for package symbol, since we are on a MethodTree, this is not possible.\nI'm still in favor of defensive programming though, even if we will miss coverage, I will add it.", "author": "quentin-jaquier-sonarsource", "createdAt": "2020-11-17T13:40:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk5NDAwNg=="}], "type": "inlineReview"}, {"oid": "c33858c14c314cd7bafde9e7292d01aba9132b39", "url": "https://github.com/SonarSource/sonar-java/commit/c33858c14c314cd7bafde9e7292d01aba9132b39", "message": "Add null check to enclosingClass", "committedDate": "2020-11-17T13:41:57Z", "type": "commit"}, {"oid": "cd25c1cf914dbd020c1794dbc764aa0b522384b4", "url": "https://github.com/SonarSource/sonar-java/commit/cd25c1cf914dbd020c1794dbc764aa0b522384b4", "message": "Move test file to new compiled module for S1185", "committedDate": "2020-11-17T14:59:17Z", "type": "commit"}, {"oid": "7354f09c385d72324260ad093205dc8b2540088c", "url": "https://github.com/SonarSource/sonar-java/commit/7354f09c385d72324260ad093205dc8b2540088c", "message": "Remove call to hasSemantic()\n\nThe rule is still able to report issue without semantic", "committedDate": "2020-11-17T14:59:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTkzMTY1Ng==", "url": "https://github.com/SonarSource/sonar-java/pull/3273#discussion_r525931656", "bodyText": "I checked a couple of variants, this check seems to be redundant. Even if we put method outside of the class, we're not able to parse the file. So I can't imagine the situation where the enclosing class will be null. So let's remove this null check. If we see any problems on peach with it we still can add the check and at least find the proper test case.", "author": "margarita-nedzelska-sonarsource", "createdAt": "2020-11-18T09:22:18Z", "path": "java-checks/src/main/java/org/sonar/java/checks/MethodOnlyCallsSuperCheck.java", "diffHunk": "@@ -156,4 +161,14 @@ private static boolean hasAnnotationDifferentFromOverride(List<AnnotationTree> a\n     return false;\n   }\n \n+  private static boolean isClassAnnotatedWithTransactional(MethodTree methodTree) {\n+    Symbol.TypeSymbol typeSymbol = methodTree.symbol().enclosingClass();\n+    if (typeSymbol != null){\n+      SymbolMetadata metadata = typeSymbol.metadata();\n+      return TRANSACTIONAL_ANNOTATIONS.stream().anyMatch(metadata::isAnnotatedWith);\n+    }\n+    // Defensive programming, should not be possible, enclosingClass returns null only for package symbol.", "originalCommit": "7354f09c385d72324260ad093205dc8b2540088c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTk5NjkxMQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3273#discussion_r525996911", "bodyText": "Okay, that makes sense. In addition, I double-checked and it seems there are other rules that do not perform the check, and nothing went wrong, so I believe it fine to not do it.", "author": "quentin-jaquier-sonarsource", "createdAt": "2020-11-18T11:00:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTkzMTY1Ng=="}], "type": "inlineReview"}, {"oid": "0e73885dd7f6920d051d10ba1d39daee41d04874", "url": "https://github.com/SonarSource/sonar-java/commit/0e73885dd7f6920d051d10ba1d39daee41d04874", "message": "Revert \"Add null check to enclosingClass\"\n\nThis reverts commit c33858c14c314cd7bafde9e7292d01aba9132b39.", "committedDate": "2020-11-18T10:56:34Z", "type": "commit"}]}