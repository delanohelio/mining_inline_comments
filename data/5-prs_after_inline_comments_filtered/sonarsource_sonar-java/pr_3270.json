{"pr_number": 3270, "pr_title": " SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent", "pr_createdAt": "2020-11-16T09:18:45Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3270", "timeline": [{"oid": "4ba820bad048b7acda15ae299d135ff1d9a24ddb", "url": "https://github.com/SonarSource/sonar-java/commit/4ba820bad048b7acda15ae299d135ff1d9a24ddb", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent.", "committedDate": "2020-11-16T09:47:28Z", "type": "forcePushed"}, {"oid": "064d38f4819563515d5befd27c03768630514e15", "url": "https://github.com/SonarSource/sonar-java/commit/064d38f4819563515d5befd27c03768630514e15", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent.", "committedDate": "2020-11-16T11:23:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAyOTcxMw==", "url": "https://github.com/SonarSource/sonar-java/pull/3270#discussion_r527029713", "bodyText": "we should take the erasure of ownerType or we gonna face inconcistencies.", "author": "m-g-sonar", "createdAt": "2020-11-19T16:36:41Z", "path": "java-checks/src/main/java/org/sonar/java/checks/SubClassStaticReferenceCheck.java", "diffHunk": "@@ -116,14 +116,24 @@ public void visitMemberSelectExpression(MemberSelectExpressionTree tree) {\n     @Override\n     public void visitIdentifier(IdentifierTree tree) {\n       Type type = tree.symbolType();\n-      if (!sameErasure(type) && type.isSubtypeOf(classType.erasure())) {\n+      if (!sameErasure(type) && type.isSubtypeOf(classTypeErasure) && !isNestedIntoParent(type)) {\n         reportIssue(tree, String.format(\"Remove this reference to \\\"%s\\\".\", type.symbol().name()));\n       }\n     }\n \n     private boolean sameErasure(Type type) {\n-      return classType.erasure().equals(type.erasure());\n+      return classTypeErasure.equals(type.erasure());\n     }\n+\n+    private boolean isNestedIntoParent(Type type) {\n+      Symbol ownerSymbol = type.symbol().owner();\n+      if (ownerSymbol != null) {\n+        Type ownerType = ownerSymbol.type();\n+        return ownerType != null && ownerType.isSubtypeOf(classTypeErasure);", "originalCommit": "064d38f4819563515d5befd27c03768630514e15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzMTQ0NQ==", "url": "https://github.com/SonarSource/sonar-java/pull/3270#discussion_r527031445", "bodyText": "isNestedSubtype()", "author": "m-g-sonar", "createdAt": "2020-11-19T16:38:59Z", "path": "java-checks/src/main/java/org/sonar/java/checks/SubClassStaticReferenceCheck.java", "diffHunk": "@@ -116,14 +116,24 @@ public void visitMemberSelectExpression(MemberSelectExpressionTree tree) {\n     @Override\n     public void visitIdentifier(IdentifierTree tree) {\n       Type type = tree.symbolType();\n-      if (!sameErasure(type) && type.isSubtypeOf(classType.erasure())) {\n+      if (!sameErasure(type) && type.isSubtypeOf(classTypeErasure) && !isNestedIntoParent(type)) {\n         reportIssue(tree, String.format(\"Remove this reference to \\\"%s\\\".\", type.symbol().name()));\n       }\n     }\n \n     private boolean sameErasure(Type type) {\n-      return classType.erasure().equals(type.erasure());\n+      return classTypeErasure.equals(type.erasure());\n     }\n+\n+    private boolean isNestedIntoParent(Type type) {", "originalCommit": "064d38f4819563515d5befd27c03768630514e15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzNDUzMg==", "url": "https://github.com/SonarSource/sonar-java/pull/3270#discussion_r527034532", "bodyText": "Type ownerType = Objects.requiresNonNull(type.symbol().owner()).type();", "author": "m-g-sonar", "createdAt": "2020-11-19T16:43:00Z", "path": "java-checks/src/main/java/org/sonar/java/checks/SubClassStaticReferenceCheck.java", "diffHunk": "@@ -116,14 +116,24 @@ public void visitMemberSelectExpression(MemberSelectExpressionTree tree) {\n     @Override\n     public void visitIdentifier(IdentifierTree tree) {\n       Type type = tree.symbolType();\n-      if (!sameErasure(type) && type.isSubtypeOf(classType.erasure())) {\n+      if (!sameErasure(type) && type.isSubtypeOf(classTypeErasure) && !isNestedIntoParent(type)) {\n         reportIssue(tree, String.format(\"Remove this reference to \\\"%s\\\".\", type.symbol().name()));\n       }\n     }\n \n     private boolean sameErasure(Type type) {\n-      return classType.erasure().equals(type.erasure());\n+      return classTypeErasure.equals(type.erasure());\n     }\n+\n+    private boolean isNestedIntoParent(Type type) {\n+      Symbol ownerSymbol = type.symbol().owner();\n+      if (ownerSymbol != null) {\n+        Type ownerType = ownerSymbol.type();", "originalCommit": "064d38f4819563515d5befd27c03768630514e15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "65f632412288830cfbe883525483a9a1ed2cb6e4", "url": "https://github.com/SonarSource/sonar-java/commit/65f632412288830cfbe883525483a9a1ed2cb6e4", "message": "Move test file to new module for S2390", "committedDate": "2020-11-19T16:50:34Z", "type": "commit"}, {"oid": "245de07928bb904afc1c5103e694514981798b5f", "url": "https://github.com/SonarSource/sonar-java/commit/245de07928bb904afc1c5103e694514981798b5f", "message": "SONARJAVA-3580 FP in S2390: do not report an issue on static class nested in the parent.", "committedDate": "2020-11-19T16:50:34Z", "type": "commit"}, {"oid": "4957b4d0afc79ff322471993c6a33a7df4222e74", "url": "https://github.com/SonarSource/sonar-java/commit/4957b4d0afc79ff322471993c6a33a7df4222e74", "message": "Fix from review", "committedDate": "2020-11-19T16:54:45Z", "type": "commit"}, {"oid": "4957b4d0afc79ff322471993c6a33a7df4222e74", "url": "https://github.com/SonarSource/sonar-java/commit/4957b4d0afc79ff322471993c6a33a7df4222e74", "message": "Fix from review", "committedDate": "2020-11-19T16:54:45Z", "type": "forcePushed"}, {"oid": "9d531ced180fcf3d892a8d09d3d8ee8076456a1c", "url": "https://github.com/SonarSource/sonar-java/commit/9d531ced180fcf3d892a8d09d3d8ee8076456a1c", "message": "Add test case when nesting class is unrelated", "committedDate": "2020-11-19T17:15:25Z", "type": "commit"}]}