{"pr_number": 3037, "pr_title": "Refactoring to avoid duplicated code for flags and error handling", "pr_createdAt": "2020-06-18T16:30:43Z", "pr_url": "https://github.com/SonarSource/sonar-java/pull/3037", "timeline": [{"oid": "b8d33d47738fb58263056823e2b9c46968748f6a", "url": "https://github.com/SonarSource/sonar-java/commit/b8d33d47738fb58263056823e2b9c46968748f6a", "message": "Refactoring to avoid duplicated code for flags and error handling\n\nMake the result of parsing a regex contain information about which\nflags the regex was created with.\n\nUse this information in the RegexBaseVisitor to set the initial\nflags, removing any need to call setFlags, which is now removed.\n\nAlso move the logic of checking whether the regex contains syntax\nerrors before visiting anything into the RegexBaseVisitor and the\nmethods before and after to it, so now rules should all be\nimplementable with only a suitable definition of a visitor class\nand then `new MyVisitor(possibleArguments).visit(regexForLiterals);`.", "committedDate": "2020-06-18T16:41:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3NDY4Nw==", "url": "https://github.com/SonarSource/sonar-java/pull/3037#discussion_r442374687", "bodyText": "I'm really not sure about this change. Why not returning always the RegexTree and use the other methods parseRegex(String regex) when we need to test the flags.\nWhen I look at all the tests which have been changed to call getResult() just after, I feel it reduced the readability of the test.", "author": "m-g-sonar", "createdAt": "2020-06-18T17:03:52Z", "path": "java-frontend/src/test/java/org/sonar/java/regex/RegexParserTestUtils.java", "diffHunk": "@@ -47,22 +49,32 @@\n \n   private RegexParserTestUtils() {}\n \n-  public static RegexTree assertSuccessfulParse(String regex) {\n+  public static RegexParseResult assertSuccessfulParse(String regex) {", "originalCommit": "b8d33d47738fb58263056823e2b9c46968748f6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjM3ODExMg==", "url": "https://github.com/SonarSource/sonar-java/pull/3037#discussion_r442378112", "bodyText": "This one is actually not used. Do you need it for a coming rule?\nIf it's not the case I would simply drop it for the time being (less is more).", "author": "m-g-sonar", "createdAt": "2020-06-18T17:10:09Z", "path": "java-frontend/src/main/java/org/sonar/java/regex/ast/RegexBaseVisitor.java", "diffHunk": "@@ -52,10 +47,38 @@ protected JavaCharacter getJavaCharacterForFlag(int flag) {\n     return activeFlags.getJavaCharacterForFlag(flag);\n   }\n \n+  private void visit(RegexTree tree) {\n+    tree.accept(this);\n+  }\n+\n   private void visit(List<RegexTree> trees) {\n     trees.forEach(this::visit);\n   }\n \n+  @Override\n+  public void visit(RegexParseResult regexParseResult) {\n+    if (!regexParseResult.hasSyntaxErrors()) {\n+      activeFlags = regexParseResult.getInitialFlags();\n+      before(regexParseResult);", "originalCommit": "b8d33d47738fb58263056823e2b9c46968748f6a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3ef15c880801abf59014c53d5a6d57acf36aeff8", "url": "https://github.com/SonarSource/sonar-java/commit/3ef15c880801abf59014c53d5a6d57acf36aeff8", "message": "Refactoring to avoid duplicated code for flags and error handling\n\nMake the result of parsing a regex contain information about which\nflags the regex was created with.\n\nUse this information in the RegexBaseVisitor to set the initial\nflags, removing any need to call setFlags, which is now removed.\n\nAlso move the logic of checking whether the regex contains syntax\nerrors before visiting anything into the RegexBaseVisitor and the\nmethods before and after to it, so now rules should all be\nimplementable with only a suitable definition of a visitor class\nand then `new MyVisitor(possibleArguments).visit(regexForLiterals);`.", "committedDate": "2020-06-18T17:34:16Z", "type": "commit"}, {"oid": "3ef15c880801abf59014c53d5a6d57acf36aeff8", "url": "https://github.com/SonarSource/sonar-java/commit/3ef15c880801abf59014c53d5a6d57acf36aeff8", "message": "Refactoring to avoid duplicated code for flags and error handling\n\nMake the result of parsing a regex contain information about which\nflags the regex was created with.\n\nUse this information in the RegexBaseVisitor to set the initial\nflags, removing any need to call setFlags, which is now removed.\n\nAlso move the logic of checking whether the regex contains syntax\nerrors before visiting anything into the RegexBaseVisitor and the\nmethods before and after to it, so now rules should all be\nimplementable with only a suitable definition of a visitor class\nand then `new MyVisitor(possibleArguments).visit(regexForLiterals);`.", "committedDate": "2020-06-18T17:34:16Z", "type": "forcePushed"}]}