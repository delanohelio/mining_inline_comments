{"pr_number": 6377, "pr_title": "Fixes #6357: File directory", "pr_createdAt": "2020-04-29T22:47:09Z", "pr_url": "https://github.com/JabRef/jabref/pull/6377", "timeline": [{"oid": "79e5106d5b4026d88df64624139b0924823a4c6c", "url": "https://github.com/JabRef/jabref/commit/79e5106d5b4026d88df64624139b0924823a4c6c", "message": "Fixes #6357: File directory\n\nBug was introduced in https://github.com/JabRef/jabref/commit/1b03f039aa4abf0812a3a8ae0ba248c08fdb39a3.", "committedDate": "2020-04-29T22:43:03Z", "type": "commit"}, {"oid": "885ddbb99e9a62b3e16fc75586871420aaf78fa3", "url": "https://github.com/JabRef/jabref/commit/885ddbb99e9a62b3e16fc75586871420aaf78fa3", "message": "Fix tests", "committedDate": "2020-04-29T22:54:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxMDMxMA==", "url": "https://github.com/JabRef/jabref/pull/6377#discussion_r417810310", "bodyText": "JavaDoc indicates, that Paths::get will be deprecated soon. Use Path::of instead.\nhttps://docs.oracle.com/en/java/javase/14/docs/api/java.base/java/nio/file/Paths.html", "author": "calixtus", "createdAt": "2020-04-30T07:30:00Z", "path": "src/main/java/org/jabref/model/metadata/FilePreferences.java", "diffHunk": "@@ -34,24 +30,14 @@ public String getUser() {\n         return user;\n     }\n \n-    public Optional<Path> getFileDirectory(Field field) {\n-        try {\n-            String value = fieldFileDirectories.get(field);\n-            // filter empty paths\n-            if ((value != null) && !value.isEmpty()) {\n-                Path path = Paths.get(value);\n-                return Optional.of(path);\n-            }\n-            return Optional.empty();\n-        } catch (InvalidPathException ex) {\n+    public Optional<Path> getFileDirectory() {\n+        if (StringUtil.isBlank(mainFileDirectory)) {\n             return Optional.empty();\n+        } else {\n+            return Optional.of(Paths.get(mainFileDirectory));", "originalCommit": "885ddbb99e9a62b3e16fc75586871420aaf78fa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzgxMjU1OQ==", "url": "https://github.com/JabRef/jabref/pull/6377#discussion_r417812559", "bodyText": "Path::of and also below", "author": "calixtus", "createdAt": "2020-04-30T07:34:16Z", "path": "src/test/java/org/jabref/model/database/BibDatabaseContextTest.java", "diffHunk": "@@ -15,61 +17,104 @@\n import static org.mockito.Mockito.mock;\n import static org.mockito.Mockito.when;\n \n-public class BibDatabaseContextTest {\n+class BibDatabaseContextTest {\n \n     private Path currentWorkingDir;\n \n-    // Store the minimal preferences for the\n-    // BibDatabaseContext.getFileDirectories(File,\n-    // FilePreferences) incocation:\n     private FilePreferences fileDirPrefs;\n \n     @BeforeEach\n-    public void setUp() {\n+    void setUp() {\n         fileDirPrefs = mock(FilePreferences.class);\n         currentWorkingDir = Paths.get(System.getProperty(\"user.dir\"));\n         when(fileDirPrefs.isBibLocationAsPrimary()).thenReturn(true);\n     }\n \n     @Test\n-    public void getFileDirectoriesWithEmptyDbParent() {\n-        BibDatabaseContext dbContext = new BibDatabaseContext();\n-        dbContext.setDatabasePath(Paths.get(\"biblio.bib\"));\n-        List<String> fileDirectories = dbContext.getFileDirectories(StandardField.FILE, fileDirPrefs);\n-        assertEquals(Collections.singletonList(currentWorkingDir.toString()),\n-                fileDirectories);\n+    void getFileDirectoriesWithEmptyDbParent() {\n+        BibDatabaseContext database = new BibDatabaseContext();\n+        database.setDatabasePath(Paths.get(\"biblio.bib\"));", "originalCommit": "885ddbb99e9a62b3e16fc75586871420aaf78fa3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d6dffac64d40260f562896c224e4b77e3fb43d5", "url": "https://github.com/JabRef/jabref/commit/4d6dffac64d40260f562896c224e4b77e3fb43d5", "message": "Replace Paths.get", "committedDate": "2020-04-30T08:56:30Z", "type": "commit"}, {"oid": "21a374f835923fe7f0e25ae0416923a52127dcb6", "url": "https://github.com/JabRef/jabref/commit/21a374f835923fe7f0e25ae0416923a52127dcb6", "message": "Fix code style", "committedDate": "2020-04-30T09:04:31Z", "type": "commit"}]}