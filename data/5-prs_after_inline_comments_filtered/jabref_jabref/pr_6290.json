{"pr_number": 6290, "pr_title": "Fix selecting custom export for copy to clipboard with uppercase file ext", "pr_createdAt": "2020-04-14T16:02:35Z", "pr_url": "https://github.com/JabRef/jabref/pull/6290", "timeline": [{"oid": "a96e056571a0884b1564b5b1390745285193c913", "url": "https://github.com/JabRef/jabref/commit/a96e056571a0884b1564b5b1390745285193c913", "message": "Fix selecting custom export for copy to clpboard with uppercase file ext\n\nFixes #6285", "committedDate": "2020-04-14T15:58:41Z", "type": "commit"}, {"oid": "7dd7266b1b63c217241b050d3a40d15f27219e03", "url": "https://github.com/JabRef/jabref/commit/7dd7266b1b63c217241b050d3a40d15f27219e03", "message": "fix annoying checkstyle", "committedDate": "2020-04-14T16:08:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxNDMyOA==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r408714328", "bodyText": "Suggestion: convert this field to Set<FileType> then you don't need to compare extensions and it's a bit more readable as well.", "author": "tobiasdiez", "createdAt": "2020-04-15T09:42:53Z", "path": "src/main/java/org/jabref/gui/exporter/ExportToClipboardAction.java", "diffHunk": "@@ -34,21 +35,24 @@\n     private static final Logger LOGGER = LoggerFactory.getLogger(ExportToClipboardAction.class);\n \n     // Only text based exporters can be used\n-    private static final List<String> SUPPORTED_FILETYPES = Arrays.asList(\"txt\", \"rtf\", \"rdf\", \"xml\", \"html\", \"htm\", \"csv\", \"ris\");\n+    private static final Set<String> SUPPORTED_FILETYPES = Set.of(\"txt\", \"rtf\", \"rdf\", \"xml\", \"html\", \"htm\", \"csv\", \"ris\");", "originalCommit": "7dd7266b1b63c217241b050d3a40d15f27219e03", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQxNDg3NA==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r410414874", "bodyText": "As I doubted it already, it's not possible to compare, because when you create a new TemplateExporter, the FileExtension is created dynamically using newFileType.\nAnd if I compare the Enums directly I would be comparing apples and oranges.\n\n  \n    \n      jabref/src/main/java/org/jabref/logic/util/StandardFileType.java\n    \n    \n        Lines 54 to 60\n      in\n      c25b639\n    \n    \n    \n    \n\n        \n          \n           public static FileType newFileType(String... extensions) { \n        \n\n        \n          \n               for (int i = 0; i < extensions.length; i++) { \n        \n\n        \n          \n                   if (extensions[i].contains(\".\")) { \n        \n\n        \n          \n                       extensions[i] = extensions[i].substring(extensions[i].indexOf('.') + 1); \n        \n\n        \n          \n                   } \n        \n\n        \n          \n               } \n        \n\n        \n          \n               return () -> Arrays.asList(extensions);", "author": "Siedlerchr", "createdAt": "2020-04-17T19:02:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxNDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQzNjQyMw==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r410436423", "bodyText": "Ok, but that's more a shortcoming of this method than a real problem.\nIt should be possible to first lookup if the StandardFileType contains a type with matching extensions (similar to the following):\n\n  \n    \n      jabref/src/main/java/org/jabref/model/entry/field/InternalField.java\n    \n    \n        Lines 38 to 42\n      in\n      b5002e0\n    \n    \n    \n    \n\n        \n          \n           public static Optional<InternalField> fromName(String name) { \n        \n\n        \n          \n               return Arrays.stream(InternalField.values()) \n        \n\n        \n          \n                            .filter(field -> field.getName().equalsIgnoreCase(name)) \n        \n\n        \n          \n                            .findAny(); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nand if not return a UnknownFileType that implements a proper equals\n\n  \n    \n      jabref/src/main/java/org/jabref/model/entry/field/UnknownField.java\n    \n    \n        Lines 30 to 45\n      in\n      b5002e0\n    \n    \n    \n    \n\n        \n          \n           @Override \n        \n\n        \n          \n           public boolean equals(Object o) { \n        \n\n        \n          \n               if (this == o) { \n        \n\n        \n          \n                   return true; \n        \n\n        \n          \n               } \n        \n\n        \n          \n               if (!(o instanceof Field)) { \n        \n\n        \n          \n                   return false; \n        \n\n        \n          \n               } \n        \n\n        \n          \n               Field other = (Field) o; \n        \n\n        \n          \n               return name.equalsIgnoreCase(other.getName()); \n        \n\n        \n          \n           } \n        \n\n        \n          \n            \n        \n\n        \n          \n           @Override \n        \n\n        \n          \n           public int hashCode() { \n        \n\n        \n          \n               return Objects.hash(name.toLowerCase(Locale.ENGLISH)); \n        \n\n        \n          \n           } \n        \n    \n  \n\n\nDefinitely a bit more complex then your solution, but should be a bit more future-proof.", "author": "tobiasdiez", "createdAt": "2020-04-17T19:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxNDMyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODIzMTA4Mg==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r418231082", "bodyText": "Thanks for the hint, applied a similar approach now for the FileTypes", "author": "Siedlerchr", "createdAt": "2020-04-30T19:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxNDMyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwODcxNTUyNw==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r408715527", "bodyText": "Instead of rethrowing the exception below, I would add logging + displaying to the user here.", "author": "tobiasdiez", "createdAt": "2020-04-15T09:44:47Z", "path": "src/main/java/org/jabref/gui/exporter/ExportToClipboardAction.java", "diffHunk": "@@ -74,12 +78,13 @@ public void execute() {\n                                           .orElse(null);\n \n         Optional<Exporter> selectedExporter = dialogService.showChoiceDialogAndWait(Localization.lang(\"Export\"), Localization.lang(\"Select export format\"),\n-                Localization.lang(\"Export\"), defaultChoice, exporters);\n+                                                                                    Localization.lang(\"Export\"), defaultChoice, exporters);\n \n         selectedExporter.ifPresent(exporter -> BackgroundTask.wrap(() -> exportToClipboard(exporter))\n-                                                                .onSuccess(this::setContentToClipboard)\n-                                                                .onFailure(ex -> { /* swallow as already logged */ })\n-                                                                .executeWith(Globals.TASK_EXECUTOR));\n+                                                             .onSuccess(this::setContentToClipboard)\n+                                                             .onFailure(ex -> {\n+                                                                 /* swallow as already logged */ })", "originalCommit": "7dd7266b1b63c217241b050d3a40d15f27219e03", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2ef5f4273fed4fdccbf3b1bd06657997d2ae2213", "url": "https://github.com/JabRef/jabref/commit/2ef5f4273fed4fdccbf3b1bd06657997d2ae2213", "message": "Merge remote-tracking branch 'upstream/master' into fixExporterSelectionCaseInsensitive\n\n* upstream/master: (25 commits)\n  ActionHelper to test for present file (#6151)\n  Reduce memory footprint (#6298)\n  Add missing abbreviated journal names (#6292)\n  fix l10n again\n  fix checkstyle\n  fix l10n\n  Try to minimize CodeCov \"wrong metrics\"\n  Showing correct icon on main table linked files column (#6264)\n  Fix labels for outdated dependency issue\n  Change one more line\n  Squashed 'src/main/resources/csl-styles/' changes from c31d9ca05a..c1793d2fe0\n  Resolve unit test from failing\n  Add one more change\n  Fix errors\n  RIS import takes the wrong date and duplicates abstract (#6272)\n  Update EntryTypeView.java\n  Change to the old school format\n  Fix XmpExporterTest (#6289)\n  Add checkstyle screenshot (and lint guidelines-...md)\n  Squashed 'src/main/resources/csl-styles/' changes from db54e5655d..c31d9ca05a\n  ...", "committedDate": "2020-04-17T18:37:17Z", "type": "commit"}, {"oid": "768eac0b4dee1357c3e283c6ff2cf2521dfa1599", "url": "https://github.com/JabRef/jabref/commit/768eac0b4dee1357c3e283c6ff2cf2521dfa1599", "message": "Pass some more globals\nshow error dialog on ex instead of rethrowing", "committedDate": "2020-04-17T19:16:36Z", "type": "commit"}, {"oid": "f57c8418a1cd96a6787a9447ae9d85ae91f08fb8", "url": "https://github.com/JabRef/jabref/commit/f57c8418a1cd96a6787a9447ae9d85ae91f08fb8", "message": "make checkstyle happy", "committedDate": "2020-04-17T19:26:41Z", "type": "commit"}, {"oid": "e3c2415d19e765d40a576dc7b11eb51e96948d2e", "url": "https://github.com/JabRef/jabref/commit/e3c2415d19e765d40a576dc7b11eb51e96948d2e", "message": "Merge remote-tracking branch 'upstream/master' into fixExporterSelectionCaseInsensitive\n\n* upstream/master: (32 commits)\n  Fix Export to clipboard Dialog icon (#6345)\n  Refactor EntryEditorPreferences (#6245)\n  Update label names\n  Squashed 'src/main/resources/csl-locales/' changes from d0ee4d13c9..79845b087b\n  Squashed 'src/main/resources/csl-styles/' changes from c1793d2fe0..143464eff6\n  Cite work by @ayaankazerouni\n  Improve performance for loading files (#6332)\n  Add ADR von JUnit vs. AssertJ (#6335)\n  'Name' textfield on focus instead of 'OK' button when user clicks on 'Add subgroup' option (#6330)\n  Bump jurt from 6.3.2 to 6.4.3 (#6325)\n  Bump unoil from 6.3.2 to 6.4.3 (#6320)\n  Bump ridl from 6.3.2 to 6.4.3 (#6326)\n  Bump classgraph from 4.8.69 to 4.8.71 (#6322)\n  Bump flexmark from 0.61.6 to 0.61.16 (#6318)\n  Bump richtextfx from 0.10.4 to 0.10.5 (#6319)\n  Bump guava from 28.2-jre to 29.0-jre (#6323)\n  Bump flexmark-ext-gfm-tasklist from 0.61.6 to 0.61.16 (#6327)\n  Bump org.beryx.jlink from 2.17.5 to 2.17.7 (#6324)\n  Improve performance massively by fixing a stupid binding mistake (#6316)\n  Fixed missing paste command (#6313)\n  ...", "committedDate": "2020-04-25T17:21:47Z", "type": "commit"}, {"oid": "6dea49e2ebec1083c61637401323f6c8b37d3fc8", "url": "https://github.com/JabRef/jabref/commit/6dea49e2ebec1083c61637401323f6c8b37d3fc8", "message": "Merge remote-tracking branch 'upstream/master' into fixExporterSelectionCaseInsensitive\n\n* upstream/master:\n  New Crowdin translations (#6375)\n  Squashed 'src/main/resources/csl-styles/' changes from 143464eff6..906cd6d43d\n  Fixes #6357: File directory (#6377)\n  Disable the generate button if the ID field is empty (#6371)\n  Fix Preferences style value too long (#6372)\n  Fix various Dark theme issues (#6368)\n  Correct label name in dependabot\n  Bump java-diff-utils from 4.5 to 4.7 (#6365)\n  Try with info.plist.template also (#6366)\n  Fix wrong button order (Apply and Cancel) in ManageProtectedTermsDialog. (#6358)\n  Bump flexmark-ext-gfm-strikethrough from 0.61.6 to 0.61.20 (#6361)\n  Bump checkstyle from 8.31 to 8.32 (#6360)\n  Bump flexmark-ext-gfm-tasklist from 0.61.16 to 0.61.20 (#6364)\n  Bump flexmark from 0.61.16 to 0.61.20 (#6359)\n  Bump org.beryx.jlink from 2.17.7 to 2.17.8 (#6362)\n  Bump classgraph from 4.8.71 to 4.8.77 (#6363)\n  Change blue and red colors in Merge entries dialog in Dark theme (#6356)\n  Add Info plist to mac resources (#5986)\n  Backward compatibility for 4.3.1 (#6296)", "committedDate": "2020-04-30T17:37:58Z", "type": "commit"}, {"oid": "8b8139e929382f4ab726c02302d2aa715fe03c97", "url": "https://github.com/JabRef/jabref/commit/8b8139e929382f4ab726c02302d2aa715fe03c97", "message": "implement enum analogous to InternalField logic", "committedDate": "2020-04-30T19:12:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2MTkxMA==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r418461910", "bodyText": "I think OptionalUtil.orElse is no longer needed, as Java has now its own orElse method.", "author": "tobiasdiez", "createdAt": "2020-05-01T08:33:26Z", "path": "src/main/java/org/jabref/logic/util/StandardFileType.java", "diffHunk": "@@ -51,12 +54,13 @@\n         return extensions;\n     }\n \n-    public static FileType newFileType(String... extensions) {\n-        for (int i = 0; i < extensions.length; i++) {\n-            if (extensions[i].contains(\".\")) {\n-                extensions[i] = extensions[i].substring(extensions[i].indexOf('.') + 1);\n-            }\n-        }\n-        return () -> Arrays.asList(extensions);\n+    public static FileType fromExtensions(String... extensions) {\n+        var exts = Arrays.asList(extensions);\n+\n+        return OptionalUtil.orElse(Arrays.stream(StandardFileType.values())", "originalCommit": "8b8139e929382f4ab726c02302d2aa715fe03c97", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ3NzAzNg==", "url": "https://github.com/JabRef/jabref/pull/6290#discussion_r418477036", "bodyText": "@tobiasdiez  Yes, but it did not work with the type inference, it expected a type of StandardFileType in the orElse part and created a compile error when\nTherefore I had to use our util method:\nhttps://stackoverflow.com/a/54238663\nPlease wait with merging I think I still need to convert the extensions to lower case before", "author": "Siedlerchr", "createdAt": "2020-05-01T09:29:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ2MTkxMA=="}], "type": "inlineReview"}, {"oid": "1dccf5d5335c2c013ba19d59f79ad9d0b385682d", "url": "https://github.com/JabRef/jabref/commit/1dccf5d5335c2c013ba19d59f79ad9d0b385682d", "message": "make new extensions lowercase", "committedDate": "2020-05-01T09:39:50Z", "type": "commit"}]}