{"pr_number": 6489, "pr_title": "Refactor BibtexKeyPatternPreferences", "pr_createdAt": "2020-05-17T22:28:29Z", "pr_url": "https://github.com/JabRef/jabref/pull/6489", "timeline": [{"oid": "c082078c5ec4c39a8c8ffc1a020f80ba1cfa41a1", "url": "https://github.com/JabRef/jabref/commit/c082078c5ec4c39a8c8ffc1a020f80ba1cfa41a1", "message": "Removed unused preferences", "committedDate": "2020-05-17T18:57:17Z", "type": "commit"}, {"oid": "9f882fbf19dfcd8fec81d128eca8180a94958f17", "url": "https://github.com/JabRef/jabref/commit/9f882fbf19dfcd8fec81d128eca8180a94958f17", "message": "Reworded advanced prefs to network prefs", "committedDate": "2020-05-17T19:16:46Z", "type": "commit"}, {"oid": "d0dfe3448a4f7e37fd806299cb570a98001723a0", "url": "https://github.com/JabRef/jabref/commit/d0dfe3448a4f7e37fd806299cb570a98001723a0", "message": "Refactored BibtexKeyPatternPreferences and some minor housekeeping", "committedDate": "2020-05-17T22:04:49Z", "type": "commit"}, {"oid": "bb29c41362a714b116f2d31f844367aecba30262", "url": "https://github.com/JabRef/jabref/commit/bb29c41362a714b116f2d31f844367aecba30262", "message": "Reworded name of advanced tab in preferences in network", "committedDate": "2020-05-17T22:08:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4OTA2Mg==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r426389062", "bodyText": "Probably wrong name?", "author": "Siedlerchr", "createdAt": "2020-05-18T06:12:51Z", "path": "src/main/java/org/jabref/logic/net/ProxyRegisterer.java", "diffHunk": "@@ -7,14 +7,14 @@ private ProxyRegisterer() {\n \n     public static void register(ProxyPreferences proxyPrefs) {\n         if (proxyPrefs.isUseProxy()) {\n-            // NetworkTabView.java ensures that proxyHostname and proxyPort are not null", "originalCommit": "bb29c41362a714b116f2d31f844367aecba30262", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQxMzg4Mw==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r426413883", "bodyText": "Yes. Very strange, apparently the tab was called NetworkTab once, so changing the name back and forth in the process of decisionmaking revealed this comment...", "author": "calixtus", "createdAt": "2020-05-18T07:17:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjM4OTA2Mg=="}], "type": "inlineReview"}, {"oid": "4b0a7767a8d97ed107dbc7ca5f665453e4d25dc6", "url": "https://github.com/JabRef/jabref/commit/4b0a7767a8d97ed107dbc7ca5f665453e4d25dc6", "message": "Fixed comments", "committedDate": "2020-05-18T07:13:58Z", "type": "commit"}, {"oid": "e0f825d750d476a5d5d8f402dfa46d7fb6c957f7", "url": "https://github.com/JabRef/jabref/commit/e0f825d750d476a5d5d8f402dfa46d7fb6c957f7", "message": "Reworded putKeyWord and reordered BibtexKeyPatternPreferences for inner coherency, split up lines for better readability", "committedDate": "2020-05-18T07:44:23Z", "type": "commit"}, {"oid": "7a5531598f8d069a011110582cb98bbd52269928", "url": "https://github.com/JabRef/jabref/commit/7a5531598f8d069a011110582cb98bbd52269928", "message": "Fixed test", "committedDate": "2020-05-18T07:59:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQzODIzNw==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r427438237", "bodyText": "Probably it makes sense to add a migration to it", "author": "Siedlerchr", "createdAt": "2020-05-19T16:31:06Z", "path": "src/main/java/org/jabref/preferences/JabRefPreferences.java", "diffHunk": "@@ -245,8 +245,6 @@\n     public static final String ALLOW_FILE_AUTO_OPEN_BROWSE = \"allowFileAutoOpenBrowse\";\n     public static final String CUSTOM_TAB_NAME = \"customTabName_\";\n     public static final String CUSTOM_TAB_FIELDS = \"customTabFields_\";\n-    public static final String USE_UNIT_FORMATTER_ON_SEARCH = \"useUnitFormatterOnSearch\";", "originalCommit": "7a5531598f8d069a011110582cb98bbd52269928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzUwMDM5Mw==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r427500393", "bodyText": "I believe there is nothing to migrate to. This preference is not used anymore. It was abandoned long ago and I don't know when. It is no more, has ceased to be and met it's maker. This is an ex preference.", "author": "calixtus", "createdAt": "2020-05-19T18:08:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzQzODIzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MTczNg==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428571736", "bodyText": "What do you think about renaming BibtexKeyPattern to CiteKeyPattern to be consistent with the naming in the metadata class?", "author": "tobiasdiez", "createdAt": "2020-05-21T10:28:22Z", "path": "src/main/java/org/jabref/gui/bibtexkeypattern/BibtexKeyPatternDialog.java", "diffHunk": "@@ -19,7 +19,7 @@ public BibtexKeyPatternDialog(BasePanel panel) {\n         this.bibtexKeyPatternPanel = new BibtexKeyPatternPanel(panel);\n         this.panel = panel;\n         this.metaData = panel.getBibDatabaseContext().getMetaData();\n-        AbstractBibtexKeyPattern keyPattern = metaData.getCiteKeyPattern(Globals.prefs.getKeyPattern());\n+        AbstractBibtexKeyPattern keyPattern = metaData.getCiteKeyPattern(Globals.prefs.getGlobalBibtexKeyPattern());", "originalCommit": "7a5531598f8d069a011110582cb98bbd52269928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc1NzM5OA==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428757398", "bodyText": "I'm really not sure about this. On one hand it would make sense, because it would abstract this preference beyond bibtex and biblatex.  On the other hand, it is closely tangled to the term bibtexKey, which has already become a fixed technical term in JabRef.\nI measured the amount of files affected by a refactor of this. About 43 files would change.", "author": "calixtus", "createdAt": "2020-05-21T16:10:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MTczNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3Mzk1Mw==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428573953", "bodyText": "I think the should prefix is better here: shouldAvoidOverwriting, shouldWarnBeforeOverwrite and shouldGenerateKeysBeforeSaving.\nhttps://stackoverflow.com/a/5326487/873661", "author": "tobiasdiez", "createdAt": "2020-05-21T10:33:34Z", "path": "src/main/java/org/jabref/gui/preferences/BibtexKeyPatternTabViewModel.java", "diffHunk": "@@ -16,46 +16,51 @@\n import org.jabref.gui.DialogService;\n import org.jabref.gui.commonfxcontrols.BibtexKeyPatternPanelItemModel;\n import org.jabref.gui.commonfxcontrols.BibtexKeyPatternPanelViewModel;\n+import org.jabref.logic.bibtexkeypattern.BibtexKeyPatternPreferences;\n import org.jabref.model.bibtexkeypattern.GlobalBibtexKeyPattern;\n import org.jabref.preferences.JabRefPreferences;\n \n public class BibtexKeyPatternTabViewModel implements PreferenceTabViewModel {\n \n-    private BooleanProperty overwriteAllowProperty = new SimpleBooleanProperty();\n-    private BooleanProperty overwriteWarningProperty = new SimpleBooleanProperty();\n-    private BooleanProperty generateOnSaveProperty = new SimpleBooleanProperty();\n-    private BooleanProperty letterStartAProperty = new SimpleBooleanProperty();\n-    private BooleanProperty letterStartBProperty = new SimpleBooleanProperty();\n-    private BooleanProperty letterAlwaysAddProperty = new SimpleBooleanProperty();\n-    private StringProperty keyPatternRegexProperty = new SimpleStringProperty();\n-    private StringProperty keyPatternReplacementProperty = new SimpleStringProperty();\n-    private StringProperty unwantedCharactersProperty = new SimpleStringProperty();\n+    private final BooleanProperty overwriteAllowProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty overwriteWarningProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty generateOnSaveProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty letterStartAProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty letterStartBProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty letterAlwaysAddProperty = new SimpleBooleanProperty();\n+    private final StringProperty keyPatternRegexProperty = new SimpleStringProperty();\n+    private final StringProperty keyPatternReplacementProperty = new SimpleStringProperty();\n+    private final StringProperty unwantedCharactersProperty = new SimpleStringProperty();\n \n     // The list and the default properties are being overwritten by the bound properties of the tableView, but to\n     // prevent an NPE on storing the preferences before lazy-loading of the setValues, they need to be initialized.\n-    private ListProperty<BibtexKeyPatternPanelItemModel> patternListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n-    private ObjectProperty<BibtexKeyPatternPanelItemModel> defaultKeyPatternProperty = new SimpleObjectProperty<>(\n+    private final ListProperty<BibtexKeyPatternPanelItemModel> patternListProperty = new SimpleListProperty<>(FXCollections.observableArrayList());\n+    private final ObjectProperty<BibtexKeyPatternPanelItemModel> defaultKeyPatternProperty = new SimpleObjectProperty<>(\n             new BibtexKeyPatternPanelItemModel(new BibtexKeyPatternPanelViewModel.DefaultEntryType(), \"\"));\n \n     private final DialogService dialogService;\n     private final JabRefPreferences preferences;\n+    private final BibtexKeyPatternPreferences initialBibtexKeyPatternPreferences;\n \n     public BibtexKeyPatternTabViewModel(DialogService dialogService, JabRefPreferences preferences) {\n         this.dialogService = dialogService;\n         this.preferences = preferences;\n+        this.initialBibtexKeyPatternPreferences = preferences.getBibtexKeyPatternPreferences();\n     }\n \n     @Override\n     public void setValues() {\n-        overwriteAllowProperty.setValue(!preferences.getBoolean(JabRefPreferences.AVOID_OVERWRITING_KEY));\n-        overwriteWarningProperty.setValue(preferences.getBoolean(JabRefPreferences.WARN_BEFORE_OVERWRITING_KEY));\n-        generateOnSaveProperty.setValue(preferences.getBoolean(JabRefPreferences.GENERATE_KEYS_BEFORE_SAVING));\n+        overwriteAllowProperty.setValue(!initialBibtexKeyPatternPreferences.avoidOverwritingCiteKey());\n+        overwriteWarningProperty.setValue(initialBibtexKeyPatternPreferences.isWarningBeforeOverwrite());", "originalCommit": "7a5531598f8d069a011110582cb98bbd52269928", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjIwNA==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428576204", "bodyText": "Maybe rename to KeySuffix?", "author": "tobiasdiez", "createdAt": "2020-05-21T10:39:22Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyPatternPreferences.java", "diffHunk": "@@ -4,48 +4,65 @@\n \n public class BibtexKeyPatternPreferences {\n \n+    public enum KeyLetters {", "originalCommit": "7a5531598f8d069a011110582cb98bbd52269928", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjcwNQ==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428576705", "bodyText": "The globalCiteKeyPattern is now also included in the bibtexKeyPatternPreferences right?", "author": "tobiasdiez", "createdAt": "2020-05-21T10:40:37Z", "path": "src/main/java/org/jabref/logic/exporter/SavePreferences.java", "diffHunk": "@@ -37,15 +36,14 @@ private SavePreferences(Boolean saveInOriginalOrder, SaveOrderConfig saveOrder,\n         this.reformatFile = reformatFile;\n         this.fieldWriterPreferences = fieldWriterPreferences;\n         this.globalCiteKeyPattern = globalCiteKeyPattern;\n-        this.generateBibtexKeysBeforeSaving = generateBibtexKeysBeforeSaving;\n         this.bibtexKeyPatternPreferences = bibtexKeyPatternPreferences;\n     }\n \n     public SavePreferences(Boolean saveInOriginalOrder, SaveOrderConfig saveOrder, Charset encoding,\n                            DatabaseSaveType saveType, Boolean takeMetadataSaveOrderInAccount, Boolean reformatFile,\n                            FieldWriterPreferences fieldWriterPreferences, GlobalBibtexKeyPattern globalCiteKeyPattern,\n-                           Boolean generateBibtexKeysBeforeSaving, BibtexKeyPatternPreferences bibtexKeyPatternPreferences) {\n-        this(saveInOriginalOrder, saveOrder, encoding, true, saveType, takeMetadataSaveOrderInAccount, reformatFile, fieldWriterPreferences, globalCiteKeyPattern, generateBibtexKeysBeforeSaving, bibtexKeyPatternPreferences);\n+                           BibtexKeyPatternPreferences bibtexKeyPatternPreferences) {", "originalCommit": "7a5531598f8d069a011110582cb98bbd52269928", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY5Njk5Ng==", "url": "https://github.com/JabRef/jabref/pull/6489#discussion_r428696996", "bodyText": "Thanks, I totally overlooked this one.\nGlobalCiteKeyPattern was in fact part of BibtexKeyPatternPreferences already before. I removed it now.", "author": "calixtus", "createdAt": "2020-05-21T14:45:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjcwNQ=="}], "type": "inlineReview"}, {"oid": "ef7154a62dfd9a5e9fc853244609b981270887f4", "url": "https://github.com/JabRef/jabref/commit/ef7154a62dfd9a5e9fc853244609b981270887f4", "message": "Added CHANGELOG.md entry and some minor rewording", "committedDate": "2020-05-21T13:51:31Z", "type": "commit"}, {"oid": "f72ca07dcd427cdd809633177ca98f93c7f32e6e", "url": "https://github.com/JabRef/jabref/commit/f72ca07dcd427cdd809633177ca98f93c7f32e6e", "message": "Removed duplicate globalCiteKeyPattern out of SavePreferences, cached getGlobalBibtexKeyPattern()", "committedDate": "2020-05-21T14:51:24Z", "type": "commit"}, {"oid": "d2f5101a858ffb3c7af6f87987d995f078e80166", "url": "https://github.com/JabRef/jabref/commit/d2f5101a858ffb3c7af6f87987d995f078e80166", "message": "Reworded forgotten variables", "committedDate": "2020-05-21T15:00:13Z", "type": "commit"}, {"oid": "bfb7f50eb5d91abe512b45c4c27e73cc6a2d76ea", "url": "https://github.com/JabRef/jabref/commit/bfb7f50eb5d91abe512b45c4c27e73cc6a2d76ea", "message": "Merge remote-tracking branch 'upstream/master' into refactor_bibtexkeyprefs", "committedDate": "2020-05-21T16:12:55Z", "type": "commit"}, {"oid": "a2ecab5a7f2e9c961a1ddc485093eb0b742d414c", "url": "https://github.com/JabRef/jabref/commit/a2ecab5a7f2e9c961a1ddc485093eb0b742d414c", "message": "Merge branch 'master' into refactor_bibtexkeyprefs", "committedDate": "2020-05-21T19:53:34Z", "type": "commit"}, {"oid": "566fbf04492f451ae927f5bb5aba252d50f809a9", "url": "https://github.com/JabRef/jabref/commit/566fbf04492f451ae927f5bb5aba252d50f809a9", "message": "Removed superfluous expressions and some rewording in l10n", "committedDate": "2020-05-22T01:40:24Z", "type": "commit"}]}