{"pr_number": 6682, "pr_title": "Rework search bar", "pr_createdAt": "2020-07-12T13:11:00Z", "pr_url": "https://github.com/JabRef/jabref/pull/6682", "timeline": [{"oid": "bb3cfb9a65ff22a7fd771d511a4a5cb2eb4a1ae3", "url": "https://github.com/JabRef/jabref/commit/bb3cfb9a65ff22a7fd771d511a4a5cb2eb4a1ae3", "message": "Reworked SearchPreferences", "committedDate": "2020-06-25T11:20:33Z", "type": "commit"}, {"oid": "650c33ebd7f394f429e2a9be5c31cad867265c56", "url": "https://github.com/JabRef/jabref/commit/650c33ebd7f394f429e2a9be5c31cad867265c56", "message": "Merge remote-tracking branch 'upstream/master' into rework_search_bar\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/preferences/PreferencesService.java", "committedDate": "2020-07-09T11:05:27Z", "type": "commit"}, {"oid": "6d86800f4c5c7cbfaae5060448489016fdc5b9c8", "url": "https://github.com/JabRef/jabref/commit/6d86800f4c5c7cbfaae5060448489016fdc5b9c8", "message": "Fixed CSS for togglebuttons", "committedDate": "2020-07-11T10:01:40Z", "type": "commit"}, {"oid": "ed443fed2ae8381bc7f7e1358b385fd097258d1b", "url": "https://github.com/JabRef/jabref/commit/ed443fed2ae8381bc7f7e1358b385fd097258d1b", "message": "Removed old disabled code fragment", "committedDate": "2020-07-11T10:12:33Z", "type": "commit"}, {"oid": "28633bd4127f541757021ae1b9e94a891608a722", "url": "https://github.com/JabRef/jabref/commit/28633bd4127f541757021ae1b9e94a891608a722", "message": "Split toolbar into small parts for better small screen ui", "committedDate": "2020-07-12T13:00:23Z", "type": "commit"}, {"oid": "bfaa3833988348ac0ff45ace9421134ba4c4df82", "url": "https://github.com/JabRef/jabref/commit/bfaa3833988348ac0ff45ace9421134ba4c4df82", "message": "Moved search modifier buttons into search bar and removed searchModeButton", "committedDate": "2020-07-12T13:04:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMyNzYzNA==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r453327634", "bodyText": "I think it would make sense to add it to the search preferences as well", "author": "Siedlerchr", "createdAt": "2020-07-12T15:04:09Z", "path": "src/main/java/org/jabref/gui/search/GlobalSearchBar.java", "diffHunk": "@@ -325,7 +322,7 @@ private void updateResults(int matched, TextFlow description, boolean grammarBas\n     }\n \n     private void setHintTooltip(TextFlow description) {\n-        if (Globals.prefs.getBoolean(JabRefPreferences.SHOW_ADVANCED_HINTS)) {\n+        if (preferencesService.getGeneralPreferences().shouldShowAdvancedHints()) {", "originalCommit": "bfaa3833988348ac0ff45ace9421134ba4c4df82", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg3MTI5MQ==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r453871291", "bodyText": "Originally the idea about the advanced hints options was to make it reusable for other hints as well. But in fact, it has only been used also for another (somewhat silly) hint in the network tab in the preferences dialog. So im not sure about this... Maybe in the future, we could evolve that feature to some annoying tip of the day feature? \ud83d\ude09", "author": "calixtus", "createdAt": "2020-07-13T19:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMyNzYzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzg5MjU1Mg==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r453892552", "bodyText": "I have no strong opinion on this. So then just leave it as is", "author": "Siedlerchr", "createdAt": "2020-07-13T19:50:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzMyNzYzNA=="}], "type": "inlineReview"}, {"oid": "a48cd0df2ba4c429aec320ded61ba4323b9506c4", "url": "https://github.com/JabRef/jabref/commit/a48cd0df2ba4c429aec320ded61ba4323b9506c4", "message": "Hides modifier buttons if search bar is not focused", "committedDate": "2020-07-13T19:06:41Z", "type": "commit"}, {"oid": "8734944bd6ffd7f5f2abbbe6f7d7c0eca670ad28", "url": "https://github.com/JabRef/jabref/commit/8734944bd6ffd7f5f2abbbe6f7d7c0eca670ad28", "message": "Added CHANGELOG", "committedDate": "2020-07-13T19:43:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyNDY2Nw==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r454324667", "bodyText": "Is the builder really necessary? I think the with* methods can be added directly to the main class without any problems.", "author": "tobiasdiez", "createdAt": "2020-07-14T12:37:43Z", "path": "src/main/java/org/jabref/preferences/SearchPreferences.java", "diffHunk": "@@ -1,103 +1,63 @@\n package org.jabref.preferences;\n \n-import java.util.Map;\n-import java.util.Objects;\n-\n import org.jabref.gui.search.SearchDisplayMode;\n \n public class SearchPreferences {\n \n-    private static final String SEARCH_DISPLAY_MODE = \"searchDisplayMode\";\n-    private static final String SEARCH_CASE_SENSITIVE = \"caseSensitiveSearch\";\n-    private static final String SEARCH_REG_EXP = \"regExpSearch\";\n-\n-    private static final String SEARCH_DIALOG_HEIGHT = \"searchDialogHeight\";\n-    private static final String SEARCH_DIALOG_WIDTH = \"searchDialogWidth\";\n-    private static final String SEARCH_DIALOG_POS_X = \"searchDialogPosX\";\n-    private static final String SEARCH_DIALOG_POS_Y = \"searchDialogPosY\";\n+    private final SearchDisplayMode searchDisplayMode;\n+    private final boolean isCaseSensitive;\n+    private final boolean isRegularExpression;\n \n-    private final JabRefPreferences preferences;\n-\n-    public SearchPreferences(JabRefPreferences preferences) {\n-        this.preferences = Objects.requireNonNull(preferences);\n+    public SearchPreferences(SearchDisplayMode searchDisplayMode, boolean isCaseSensitive, boolean isRegularExpression) {\n+        this.searchDisplayMode = searchDisplayMode;\n+        this.isCaseSensitive = isCaseSensitive;\n+        this.isRegularExpression = isRegularExpression;\n     }\n \n-    public static void putDefaults(Map<String, Object> defaults) {\n-        defaults.put(SEARCH_DISPLAY_MODE, SearchDisplayMode.FILTER.toString());\n-        defaults.put(SEARCH_CASE_SENSITIVE, Boolean.FALSE);\n-        defaults.put(SEARCH_REG_EXP, Boolean.FALSE);\n-\n-        defaults.put(SEARCH_DIALOG_WIDTH, 650);\n-        defaults.put(SEARCH_DIALOG_HEIGHT, 500);\n-        defaults.put(SEARCH_DIALOG_POS_X, 0);\n-        defaults.put(SEARCH_DIALOG_POS_Y, 0);\n-    }\n-\n-    public SearchDisplayMode getSearchMode() {\n-        try {\n-            return SearchDisplayMode.valueOf(preferences.get(SEARCH_DISPLAY_MODE));\n-        } catch (IllegalArgumentException ex) {\n-            // Should only occur when the searchmode is set directly via preferences.put and the enum was not used\n-            return SearchDisplayMode.valueOf((String) preferences.defaults.get(SEARCH_DISPLAY_MODE));\n-        }\n-    }\n-\n-    public SearchPreferences setSearchMode(SearchDisplayMode searchDisplayMode) {\n-        preferences.put(SEARCH_DISPLAY_MODE, Objects.requireNonNull(searchDisplayMode).toString());\n-        return this;\n+    public SearchDisplayMode getSearchDisplayMode() {\n+        return searchDisplayMode;\n     }\n \n     public boolean isCaseSensitive() {\n-        return preferences.getBoolean(SEARCH_CASE_SENSITIVE);\n-    }\n-\n-    public SearchPreferences setCaseSensitive(boolean isCaseSensitive) {\n-        preferences.putBoolean(SEARCH_CASE_SENSITIVE, isCaseSensitive);\n-        return this;\n+        return isCaseSensitive;\n     }\n \n     public boolean isRegularExpression() {\n-        return preferences.getBoolean(SEARCH_REG_EXP);\n+        return isRegularExpression;\n     }\n \n-    public SearchPreferences setRegularExpression(boolean isRegularExpression) {\n-        preferences.putBoolean(SEARCH_REG_EXP, isRegularExpression);\n-        return this;\n+    public Builder getBuilder() {\n+        return new Builder(this);\n     }\n \n-    public int getSeachDialogWidth() {\n-        return preferences.getInt(SEARCH_DIALOG_WIDTH);\n-    }\n+    public static class Builder {", "originalCommit": "8734944bd6ffd7f5f2abbbe6f7d7c0eca670ad28", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDUxMjU3Nw==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r454512577", "bodyText": "I'll change it, I originally just wanted to stick close to the builder pattern, as I don't have much experience on it, so this was somewhat a study project for me \ud83d\ude09", "author": "calixtus", "createdAt": "2020-07-14T17:12:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDMyNDY2Nw=="}], "type": "inlineReview"}, {"oid": "bbba792d6ddf1de519631641df4fa09273553852", "url": "https://github.com/JabRef/jabref/commit/bbba792d6ddf1de519631641df4fa09273553852", "message": "Relaxed builder pattern in SearchPreferences", "committedDate": "2020-07-14T19:07:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2Nzc3MQ==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r454967771", "bodyText": "The get() Method already returns the default if no value:\n public String get(String key) {\n        return prefs.get(key, (String) defaults.get(key));\n    }", "author": "Siedlerchr", "createdAt": "2020-07-15T10:59:45Z", "path": "src/main/java/org/jabref/preferences/JabRefPreferences.java", "diffHunk": "@@ -2356,4 +2363,27 @@ public void storeSpecialFieldsPreferences(SpecialFieldsPreferences specialFields\n         putBoolean(AUTOSYNCSPECIALFIELDSTOKEYWORDS, specialFieldsPreferences.getAutoSyncSpecialFieldsToKeyWords());\n         putBoolean(SERIALIZESPECIALFIELDS, specialFieldsPreferences.getSerializeSpecialFields());\n     }\n+\n+    @Override\n+    public SearchPreferences getSearchPreferences() {\n+        SearchDisplayMode searchDisplayMode;\n+        try {\n+            searchDisplayMode = SearchDisplayMode.valueOf(get(SEARCH_DISPLAY_MODE));\n+        } catch (IllegalArgumentException ex) {\n+            // Should only occur when the searchmode is set directly via preferences.put and the enum was not used\n+            searchDisplayMode = SearchDisplayMode.valueOf((String) defaults.get(SEARCH_DISPLAY_MODE));", "originalCommit": "bbba792d6ddf1de519631641df4fa09273553852", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNDE1OQ==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r455034159", "bodyText": "Good catch. I just copied the logic from the former searchpreferences.class. Fixing the missing consistency is one of the big projects in the future...", "author": "calixtus", "createdAt": "2020-07-15T13:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2Nzc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTAzNzQwNQ==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r455037405", "bodyText": "This was the only issue I found so far,the rest looks good!", "author": "Siedlerchr", "createdAt": "2020-07-15T13:09:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2Nzc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA1OTY3MA==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r455059670", "bodyText": "Hmm... I thought about this: what if the returned stored value is defect, but not the default value?", "author": "calixtus", "createdAt": "2020-07-15T13:40:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2Nzc3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTA2ODA5NA==", "url": "https://github.com/JabRef/jabref/pull/6682#discussion_r455068094", "bodyText": "Why should that happen?  the Prefernces.get says:\n\nthe value associated with key, or def if no value is associated with key, or the backingstore is inaccessible.", "author": "Siedlerchr", "createdAt": "2020-07-15T13:51:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDk2Nzc3MQ=="}], "type": "inlineReview"}]}