{"pr_number": 6233, "pr_title": "Add disable/enable calculation of items in group", "pr_createdAt": "2020-04-01T20:50:43Z", "pr_url": "https://github.com/JabRef/jabref/pull/6233", "timeline": [{"oid": "834c65f971b709059b67cf24cab876292c1b8ead", "url": "https://github.com/JabRef/jabref/commit/834c65f971b709059b67cf24cab876292c1b8ead", "message": "Init changes", "committedDate": "2020-03-30T19:20:35Z", "type": "commit"}, {"oid": "bc03c034ff2df3d50535c79c56dfe631b52970fb", "url": "https://github.com/JabRef/jabref/commit/bc03c034ff2df3d50535c79c56dfe631b52970fb", "message": "Merge branch 'master' of https://github.com/JabRef/jabref", "committedDate": "2020-03-30T19:21:11Z", "type": "commit"}, {"oid": "6f5b71829450e299f9a04f465481b881bf3c4694", "url": "https://github.com/JabRef/jabref/commit/6f5b71829450e299f9a04f465481b881bf3c4694", "message": "Init changes", "committedDate": "2020-03-30T19:56:48Z", "type": "commit"}, {"oid": "f25ec45d37df3177c3587b096cc99abfbd7144c2", "url": "https://github.com/JabRef/jabref/commit/f25ec45d37df3177c3587b096cc99abfbd7144c2", "message": "\u0412\u043e\u0441\u0441\u0442\u0430\u043d\u043e\u0432\u043b\u0435\u043d\u043e \u0438\u0441\u0445\u043e\u0434\u043d\u043e\u0435 \u0441\u043e\u0441\u0442\u043e\u044f\u043d\u0438\u0435 \u043c\u0430\u0441\u0442\u0435\u0440\u0430", "committedDate": "2020-03-30T20:03:34Z", "type": "commit"}, {"oid": "6b7ce6d31823f35c116d6751a4e28d23b961f258", "url": "https://github.com/JabRef/jabref/commit/6b7ce6d31823f35c116d6751a4e28d23b961f258", "message": "\u041f\u0440\u043e\u0441\u0442\u043e \u043a\u043e\u043c\u043c\u0438\u0442", "committedDate": "2020-03-30T20:23:25Z", "type": "commit"}, {"oid": "7d87baa3b7df2ca8bf0e644b4d1e0a9f061c8997", "url": "https://github.com/JabRef/jabref/commit/7d87baa3b7df2ca8bf0e644b4d1e0a9f061c8997", "message": "Merge branch 'master' of https://github.com/JabRef/jabref", "committedDate": "2020-03-31T18:30:32Z", "type": "commit"}, {"oid": "7df02e425dd6675644dc25f42d1aa36b553a73a4", "url": "https://github.com/JabRef/jabref/commit/7df02e425dd6675644dc25f42d1aa36b553a73a4", "message": "Merge branch 'master' of https://github.com/JabRef/jabref", "committedDate": "2020-04-01T18:21:36Z", "type": "commit"}, {"oid": "2862f2afaebf367327887396564d6a5d664f3e6c", "url": "https://github.com/JabRef/jabref/commit/2862f2afaebf367327887396564d6a5d664f3e6c", "message": "Issue #6042 fixed", "committedDate": "2020-04-01T19:45:59Z", "type": "commit"}, {"oid": "181f1e9b022e551409fb8360d7f6b32246be532c", "url": "https://github.com/JabRef/jabref/commit/181f1e9b022e551409fb8360d7f6b32246be532c", "message": "Issue #6042 fixed\nCorrected resources file after not passing the test", "committedDate": "2020-04-01T20:13:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NDI5Nw==", "url": "https://github.com/JabRef/jabref/pull/6233#discussion_r402454297", "bodyText": "Please use the existing PreferencesService class, it is already a wrapper/it extends the JabRefPreferences class.\nJust add a method there for getting the preferences key", "author": "Siedlerchr", "createdAt": "2020-04-02T16:39:51Z", "path": "src/main/java/org/jabref/gui/groups/GroupTreeView.java", "diffHunk": "@@ -71,13 +72,15 @@\n \n     private GroupTreeViewModel viewModel;\n     private CustomLocalDragboard localDragboard;\n+    private JabRefPreferences preferences;\n \n     private DragExpansionHandler dragExpansionHandler;\n \n     @FXML\n     public void initialize() {\n         this.localDragboard = stateManager.getLocalDragboard();\n         viewModel = new GroupTreeViewModel(stateManager, dialogService, preferencesService, taskExecutor, localDragboard);\n+        preferences = JabRefPreferences.getInstance();", "originalCommit": "181f1e9b022e551409fb8360d7f6b32246be532c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc2NzgwMA==", "url": "https://github.com/JabRef/jabref/pull/6233#discussion_r402767800", "bodyText": "Thank you for comment. Just want to make sure, that I understand you correctly:\n\ncreate a class for group preferences (like \"GeneralPreferences\", but for groups);\nadd a methods to PreferencesService interface: getGroupPreferences, storeGroupPreferences;\nimplement those methods in JabRefPreferences class;\nuse those methods in GroupTreeeView class to access preferences key;\n\nCorrect?", "author": "Gena928", "createdAt": "2020-04-03T06:45:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NDI5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3MTgxMQ==", "url": "https://github.com/JabRef/jabref/pull/6233#discussion_r402771811", "bodyText": "Hi,\neven easier, no need for a GroupPreferences\n\nAdd a method like getDisplayGroupCount() to the PreferencesService Interface\nAdd the same method to JabRefPreferences (override annoation) and  simply return\nreturn getBoolean(JabRefPreferences.DISPLAY_GROUP_COUNT)\nIn GroupTreeView you call preferencesService.getDisplayGroupCount()\n\nI think renaming quantity to Count fit's better", "author": "Siedlerchr", "createdAt": "2020-04-03T06:56:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ1NDI5Nw=="}], "type": "inlineReview"}, {"oid": "cc4d4495eec7c3f930672aa815cf872a6572fdfb", "url": "https://github.com/JabRef/jabref/commit/cc4d4495eec7c3f930672aa815cf872a6572fdfb", "message": "- Added new property to PreferencesService and JabRefPreferences\n- Used this property in GroupsTabView\n- DisplayGroupQuantity renamed into DisplayGroupCount in GroupsTabView & GroupsTabViewModel", "committedDate": "2020-04-03T08:23:41Z", "type": "commit"}, {"oid": "09cded7cddf91136d5ad36e6cae28380f6efe1ba", "url": "https://github.com/JabRef/jabref/commit/09cded7cddf91136d5ad36e6cae28380f6efe1ba", "message": "- removed line from JabRef_en.properties", "committedDate": "2020-04-03T08:27:49Z", "type": "commit"}, {"oid": "cdc18a9c2923cf441e2a4e440063187e538adc48", "url": "https://github.com/JabRef/jabref/commit/cdc18a9c2923cf441e2a4e440063187e538adc48", "message": "Updated Properties file\n- removed line from ...da.properties;\n- added line to ...en.properties;", "committedDate": "2020-04-03T09:15:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwNzEzNg==", "url": "https://github.com/JabRef/jabref/pull/6233#discussion_r403507136", "bodyText": "As noted in the issue, the circle node should always be displayed because it is also used for the any/all selected status. Can you thus please add the if check only around the text here.", "author": "tobiasdiez", "createdAt": "2020-04-04T19:26:55Z", "path": "src/main/java/org/jabref/gui/groups/GroupTreeView.java", "diffHunk": "@@ -120,27 +120,29 @@ public void initialize() {\n                 .withTooltip(GroupNodeViewModel::getDescription)\n                 .install(mainColumn);\n \n-        // Number of hits\n-        PseudoClass anySelected = PseudoClass.getPseudoClass(\"any-selected\");\n-        PseudoClass allSelected = PseudoClass.getPseudoClass(\"all-selected\");\n-        new ViewModelTreeTableCellFactory<GroupNodeViewModel>()\n-                .withGraphic(group -> {\n-                    final StackPane node = new StackPane();\n-                    node.getStyleClass().setAll(\"hits\");\n-                    if (!group.isRoot()) {\n-                        BindingsHelper.includePseudoClassWhen(node, anySelected,\n-                                group.anySelectedEntriesMatchedProperty());\n-                        BindingsHelper.includePseudoClassWhen(node, allSelected,\n-                                group.allSelectedEntriesMatchedProperty());\n-                    }\n-                    Text text = new Text();\n-                    text.textProperty().bind(group.getHits().asString());\n-                    text.getStyleClass().setAll(\"text\");\n-                    node.getChildren().add(text);\n-                    node.setMaxWidth(Control.USE_PREF_SIZE);\n-                    return node;\n-                })\n-                .install(numberColumn);\n+        // Number of hits (only if user wants to see them)\n+        if (preferencesService.getDisplayGroupCount()) {\n+            PseudoClass anySelected = PseudoClass.getPseudoClass(\"any-selected\");\n+            PseudoClass allSelected = PseudoClass.getPseudoClass(\"all-selected\");\n+            new ViewModelTreeTableCellFactory<GroupNodeViewModel>()\n+                    .withGraphic(group -> {\n+                        final StackPane node = new StackPane();\n+                        node.getStyleClass().setAll(\"hits\");\n+                        if (!group.isRoot()) {\n+                            BindingsHelper.includePseudoClassWhen(node, anySelected,\n+                                    group.anySelectedEntriesMatchedProperty());\n+                            BindingsHelper.includePseudoClassWhen(node, allSelected,\n+                                    group.allSelectedEntriesMatchedProperty());\n+                        }\n+                        Text text = new Text();", "originalCommit": "cdc18a9c2923cf441e2a4e440063187e538adc48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY4NDE1Ng==", "url": "https://github.com/JabRef/jabref/pull/6233#discussion_r403684156", "bodyText": "Done,\nplease see new GroupTreeeView.java. OK now?", "author": "Gena928", "createdAt": "2020-04-05T10:52:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwNzEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzcwMDUzMg==", "url": "https://github.com/JabRef/jabref/pull/6233#discussion_r403700532", "bodyText": "Thanks for quick follow-up! Looks good indeed.", "author": "tobiasdiez", "createdAt": "2020-04-05T13:15:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzUwNzEzNg=="}], "type": "inlineReview"}, {"oid": "ea19b70c6a26f3a34567f882efee7319d154d843", "url": "https://github.com/JabRef/jabref/commit/ea19b70c6a26f3a34567f882efee7319d154d843", "message": "Changed GroupTreeView according to comments from Tobiasdiez\nMain task - disable calling \"group.getHits()\" method to avoid calculation of items in group.", "committedDate": "2020-04-05T10:46:46Z", "type": "commit"}, {"oid": "bfbffe03a4af0dca9d2cee800d21637463c5d862", "url": "https://github.com/JabRef/jabref/commit/bfbffe03a4af0dca9d2cee800d21637463c5d862", "message": "Remove empty line", "committedDate": "2020-04-05T13:16:48Z", "type": "commit"}]}