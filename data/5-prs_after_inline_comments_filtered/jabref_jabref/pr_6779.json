{"pr_number": 6779, "pr_title": "Refactor file preferences", "pr_createdAt": "2020-08-23T18:44:45Z", "pr_url": "https://github.com/JabRef/jabref/pull/6779", "timeline": [{"oid": "e5ea3598868a25837ab4856246fa239c0a63c8a3", "url": "https://github.com/JabRef/jabref/commit/e5ea3598868a25837ab4856246fa239c0a63c8a3", "message": "Refactored for same basic clean-up and naming consistency", "committedDate": "2020-08-23T21:58:09Z", "type": "commit"}, {"oid": "fac9f9907cb6d1e0443cc211001e840e50e2c562", "url": "https://github.com/JabRef/jabref/commit/fac9f9907cb6d1e0443cc211001e840e50e2c562", "message": "Refactored for more clean-ups and naming consistency", "committedDate": "2020-08-23T21:58:09Z", "type": "commit"}, {"oid": "1fb6e7a3ae9d3cac58f8488ac6bdaaa72e3263a3", "url": "https://github.com/JabRef/jabref/commit/1fb6e7a3ae9d3cac58f8488ac6bdaaa72e3263a3", "message": "Refactored and extended AutoLinkPreferences", "committedDate": "2020-08-23T21:58:09Z", "type": "commit"}, {"oid": "4147133a8049a66141f2194623def131a70e03a0", "url": "https://github.com/JabRef/jabref/commit/4147133a8049a66141f2194623def131a70e03a0", "message": "Refactored FilePreferences to immutable class", "committedDate": "2020-08-23T21:58:09Z", "type": "commit"}, {"oid": "4147133a8049a66141f2194623def131a70e03a0", "url": "https://github.com/JabRef/jabref/commit/4147133a8049a66141f2194623def131a70e03a0", "message": "Refactored FilePreferences to immutable class", "committedDate": "2020-08-23T21:58:09Z", "type": "forcePushed"}, {"oid": "fd159fdbba7720351bcf8519a5ca6c55dd52414c", "url": "https://github.com/JabRef/jabref/commit/fd159fdbba7720351bcf8519a5ca6c55dd52414c", "message": "Refactored two preferences from AutoLinkPreferences to FilePreferences", "committedDate": "2020-08-24T11:09:22Z", "type": "commit"}, {"oid": "c90d6216f2e064f71d3ffa9a8c48f679624396db", "url": "https://github.com/JabRef/jabref/commit/c90d6216f2e064f71d3ffa9a8c48f679624396db", "message": "Moved import linked file patterns preferences to FilePreferencesTab", "committedDate": "2020-08-24T11:42:46Z", "type": "commit"}, {"oid": "1dd6ffc46a76635dce67e1265a5862389b739bce", "url": "https://github.com/JabRef/jabref/commit/1dd6ffc46a76635dce67e1265a5862389b739bce", "message": "Extended FilePreferences and refactored FileTab to use it", "committedDate": "2020-08-24T17:10:43Z", "type": "commit"}, {"oid": "416d8b7c016c99e2894b089cc43426a46b5dd861", "url": "https://github.com/JabRef/jabref/commit/416d8b7c016c99e2894b089cc43426a46b5dd861", "message": "Checkstyle", "committedDate": "2020-08-24T18:11:50Z", "type": "commit"}, {"oid": "acd5eb95107fee1002633711c36de8b729a1d453", "url": "https://github.com/JabRef/jabref/commit/acd5eb95107fee1002633711c36de8b729a1d453", "message": "Merge remote-tracking branch 'upstream/master' into RefactorFilePreferences\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/preferences/JabRefPreferences.java\n#\tsrc/main/java/org/jabref/preferences/PreferencesService.java", "committedDate": "2020-08-31T15:05:20Z", "type": "commit"}, {"oid": "edaed5ef008ab11aa029c3f76e26496f926d5512", "url": "https://github.com/JabRef/jabref/commit/edaed5ef008ab11aa029c3f76e26496f926d5512", "message": "Fixed merge error", "committedDate": "2020-08-31T15:09:16Z", "type": "commit"}, {"oid": "08bf7606d454a6803ec0b5fcd1f2c8f0b005ecf6", "url": "https://github.com/JabRef/jabref/commit/08bf7606d454a6803ec0b5fcd1f2c8f0b005ecf6", "message": "Moved import-export preferences to exportSortingTab and renamed the tab", "committedDate": "2020-08-31T18:39:10Z", "type": "commit"}, {"oid": "7e5ab695d3ba452393ea311f4196cade787cc64f", "url": "https://github.com/JabRef/jabref/commit/7e5ab695d3ba452393ea311f4196cade787cc64f", "message": "Renamed FileTab to LinkedFilesTab", "committedDate": "2020-08-31T19:04:09Z", "type": "commit"}, {"oid": "352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d", "url": "https://github.com/JabRef/jabref/commit/352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d", "message": "Refactored ImportExportTab to PreferencesService", "committedDate": "2020-08-31T20:36:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDM4OTk3MQ==", "url": "https://github.com/JabRef/jabref/pull/6779#discussion_r480389971", "bodyText": "default missing?", "author": "Siedlerchr", "createdAt": "2020-08-31T20:47:19Z", "path": "src/main/java/org/jabref/gui/preferences/LinkedFilesTabViewModel.java", "diffHunk": "@@ -0,0 +1,192 @@\n+package org.jabref.gui.preferences;\n+\n+import java.nio.file.Files;\n+import java.nio.file.Path;\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import javafx.beans.property.BooleanProperty;\n+import javafx.beans.property.ListProperty;\n+import javafx.beans.property.SimpleBooleanProperty;\n+import javafx.beans.property.SimpleListProperty;\n+import javafx.beans.property.SimpleStringProperty;\n+import javafx.beans.property.StringProperty;\n+import javafx.collections.FXCollections;\n+\n+import org.jabref.gui.DialogService;\n+import org.jabref.gui.util.DirectoryDialogConfiguration;\n+import org.jabref.logic.l10n.Localization;\n+import org.jabref.logic.util.io.AutoLinkPreferences;\n+import org.jabref.model.metadata.FilePreferences;\n+import org.jabref.preferences.PreferencesService;\n+\n+import de.saxsys.mvvmfx.utils.validation.FunctionBasedValidator;\n+import de.saxsys.mvvmfx.utils.validation.ValidationMessage;\n+import de.saxsys.mvvmfx.utils.validation.ValidationStatus;\n+import de.saxsys.mvvmfx.utils.validation.Validator;\n+\n+public class LinkedFilesTabViewModel implements PreferenceTabViewModel {\n+\n+    private final StringProperty mainFileDirectoryProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty useBibLocationAsPrimaryProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty autolinkFileStartsBibtexProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty autolinkFileExactBibtexProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty autolinkUseRegexProperty = new SimpleBooleanProperty();\n+    private final StringProperty autolinkRegexKeyProperty = new SimpleStringProperty(\"\");\n+    private final BooleanProperty searchFilesOnOpenProperty = new SimpleBooleanProperty();\n+    private final BooleanProperty openBrowseOnCreateProperty = new SimpleBooleanProperty();\n+    private final ListProperty<String> defaultFileNamePatternsProperty =\n+            new SimpleListProperty<>(FXCollections.observableArrayList(FilePreferences.DEFAULT_FILENAME_PATTERNS));\n+    private final StringProperty fileNamePatternProperty = new SimpleStringProperty();\n+    private final StringProperty fileDirectoryPatternProperty = new SimpleStringProperty();\n+\n+    private final Validator mainFileDirValidator;\n+\n+    private final DialogService dialogService;\n+    private final PreferencesService preferences;\n+    private final FilePreferences initialFilePreferences;\n+    private final AutoLinkPreferences initialAutoLinkPreferences;\n+\n+    public LinkedFilesTabViewModel(DialogService dialogService, PreferencesService preferences) {\n+        this.dialogService = dialogService;\n+        this.preferences = preferences;\n+        this.initialFilePreferences = preferences.getFilePreferences();\n+        this.initialAutoLinkPreferences = preferences.getAutoLinkPreferences();\n+\n+        mainFileDirValidator = new FunctionBasedValidator<>(\n+                mainFileDirectoryProperty,\n+                input -> {\n+                    Path path = Path.of(mainFileDirectoryProperty.getValue());\n+                    return (Files.exists(path) && Files.isDirectory(path));\n+                },\n+                ValidationMessage.error(String.format(\"%s > %s > %s %n %n %s\",\n+                        Localization.lang(\"File\"),\n+                        Localization.lang(\"External file links\"),\n+                        Localization.lang(\"Main file directory\"),\n+                        Localization.lang(\"Directory not found\")\n+                        )\n+                )\n+        );\n+    }\n+\n+    @Override\n+    public void setValues() {\n+        // External files preferences / Attached files preferences / File preferences\n+        mainFileDirectoryProperty.setValue(initialFilePreferences.getFileDirectory().orElse(Path.of(\"\")).toString());\n+        useBibLocationAsPrimaryProperty.setValue(initialFilePreferences.isBibLocationAsPrimary());\n+        searchFilesOnOpenProperty.setValue(initialFilePreferences.shouldSearchFilesOnOpen());\n+        openBrowseOnCreateProperty.setValue(initialFilePreferences.shouldOpenBrowseOnCreate());\n+        fileNamePatternProperty.setValue(initialFilePreferences.getFileNamePattern());\n+        fileDirectoryPatternProperty.setValue(initialFilePreferences.getFileDirectoryPattern());\n+\n+        // Autolink preferences\n+        switch (initialAutoLinkPreferences.getCitationKeyDependency()) {\n+            case START -> autolinkFileStartsBibtexProperty.setValue(true);\n+            case EXACT -> autolinkFileExactBibtexProperty.setValue(true);\n+            case REGEX -> autolinkUseRegexProperty.setValue(true);", "originalCommit": "352417d8fa73b0ff9d1c4ebdee87c7ed563e1e1d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "83a05c124bf23d37d0e7d945593b1f0fdf224d43", "url": "https://github.com/JabRef/jabref/commit/83a05c124bf23d37d0e7d945593b1f0fdf224d43", "message": "CHANGELOG.md", "committedDate": "2020-08-31T20:50:57Z", "type": "commit"}, {"oid": "1c00e7b43e55aebc56522dee82ad3dc27940fd6d", "url": "https://github.com/JabRef/jabref/commit/1c00e7b43e55aebc56522dee82ad3dc27940fd6d", "message": "Rewording ImportExport to File", "committedDate": "2020-08-31T22:23:52Z", "type": "commit"}, {"oid": "acc5646c6cdff8313106771720aceaa2c16275db", "url": "https://github.com/JabRef/jabref/commit/acc5646c6cdff8313106771720aceaa2c16275db", "message": "Make FilePreferences and SavePreferences mutable, added ADR", "committedDate": "2020-09-01T10:19:54Z", "type": "commit"}, {"oid": "ce20c0674b6f5922af4f3e06d4a7f52781cf8065", "url": "https://github.com/JabRef/jabref/commit/ce20c0674b6f5922af4f3e06d4a7f52781cf8065", "message": "Merge branch 'master' into RefactorFilePreferences", "committedDate": "2020-09-01T12:14:56Z", "type": "commit"}]}