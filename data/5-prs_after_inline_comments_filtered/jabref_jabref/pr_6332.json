{"pr_number": 6332, "pr_title": "Improve performance for loading files", "pr_createdAt": "2020-04-21T16:30:27Z", "pr_url": "https://github.com/JabRef/jabref/pull/6332", "timeline": [{"oid": "37cf70da1e4898dcca4cc752eaec20f00b27c16b", "url": "https://github.com/JabRef/jabref/commit/37cf70da1e4898dcca4cc752eaec20f00b27c16b", "message": "Improve performance for loading files\n\n- Performance improvements around groups\n- Remove detection of duplicate ID when inserting entries (it's not really possible to create two entries with the same except if you use `setId` manually)\n- Remove detection of duplicate bibtex keys when opening a file (the result was not used and we have a integrity check for it)\n- Use EnumMap instead of HashMap to cache fields as keywords (which is only used for Keyword and Groups fields anyway)\n- Fix bug where latex code was displayed in the maintable\n- Lazy init of source tab", "committedDate": "2020-04-21T16:16:02Z", "type": "commit"}, {"oid": "5e4f6e7d5af326085e504819310187c69309d315", "url": "https://github.com/JabRef/jabref/commit/5e4f6e7d5af326085e504819310187c69309d315", "message": "Fix tests compilation", "committedDate": "2020-04-21T16:35:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxOTk5OQ==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412319999", "bodyText": "Why is this class necessary? I don't see any advantage of the internal java ones", "author": "Siedlerchr", "createdAt": "2020-04-21T16:48:07Z", "path": "src/main/java/org/jabref/model/util/ListUtil.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.jabref.model.util;\n+\n+import java.util.function.Predicate;\n+\n+public class ListUtil {\n+    public static <T> boolean anyMatch(Iterable<T> list, Predicate<T> predicate) {", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMyNjYwMg==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412326602", "bodyText": "It's about a factor two faster than the streams solution.", "author": "tobiasdiez", "createdAt": "2020-04-21T16:55:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxOTk5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDkyNQ==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412674925", "bodyText": "Can you just add a JavaDoc, please?\nWould it be possible to add a performance test? So that if we replace this by something with promising performance (e.g., Goldman Sach's Collections), we can easily check which one is faster.", "author": "koppor", "createdAt": "2020-04-22T05:12:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjMxOTk5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3MTczNA==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412671734", "bodyText": "\ud83d\udc4d", "author": "koppor", "createdAt": "2020-04-22T05:03:17Z", "path": "src/main/java/org/jabref/gui/maintable/BibEntryTableViewModel.java", "diffHunk": "@@ -41,10 +39,10 @@\n     private final ObjectBinding<Map<Field, String>> linkedIdentifiers;\n     private final ObservableValue<List<AbstractGroup>> matchedGroups;\n \n-    public BibEntryTableViewModel(BibEntry entry, BibDatabaseContext database) {\n+    public BibEntryTableViewModel(BibEntry entry, BibDatabaseContext database, MainTableNameFormatter nameFormatter) {", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3MjE5OA==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412672198", "bodyText": "This is a kind of taste, isn't it? - Would assume that the Builder pattern would be preferred.", "author": "koppor", "createdAt": "2020-04-22T05:04:52Z", "path": "src/main/java/org/jabref/logic/importer/ParserResult.java", "diffHunk": "@@ -35,7 +34,7 @@ public ParserResult() {\n     }\n \n     public ParserResult(Collection<BibEntry> entries) {\n-        this(BibDatabases.createDatabase(BibDatabases.purgeEmptyEntries(entries)));\n+        this(new BibDatabase(BibDatabases.purgeEmptyEntries(entries)));", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkxNTE4NA==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412915184", "bodyText": "Builder pattern for a constructor with one argument seems a bit overkill, don't you think?", "author": "tobiasdiez", "createdAt": "2020-04-22T11:54:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3MjE5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3MjYxOA==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412672618", "bodyText": "Finally \ud83c\udf89", "author": "koppor", "createdAt": "2020-04-22T05:06:06Z", "path": "src/main/java/org/jabref/model/database/BibDatabase.java", "diffHunk": "@@ -169,46 +169,35 @@ public boolean containsEntryWithId(String id) {\n     }\n \n     /**\n-     * Inserts the entry, given that its ID is not already in use.\n-     * use Util.createId(...) to make up a unique ID for an entry.\n+     * Inserts the entry.\n      *\n-     * @param entry BibEntry to insert into the database\n-     * @return false if the insert was done without a duplicate warning\n-     * @throws KeyCollisionException thrown if the entry id ({@link BibEntry#getId()}) is already  present in the database\n+     * @param entry entry to insert\n      */\n-    public synchronized boolean insertEntry(BibEntry entry) throws KeyCollisionException {\n-        return insertEntry(entry, EntriesEventSource.LOCAL);\n+    public synchronized void insertEntry(BibEntry entry) {", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDEzMQ==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412674131", "bodyText": "Wasn't the samentics of \"InternalField\" that is a field introduced by JabRef? (The class should be ranamed to JabRefSuperPowerFields (when going extreme).\nOWNER and TIMESTAMP are \"normal\" BibTeX fields - just introdced by JabRef.\nIf we move GROUPS to StandardField, we should move the other two, too.\n@stefan-kolb What's your take on this?", "author": "koppor", "createdAt": "2020-04-22T05:10:43Z", "path": "src/main/java/org/jabref/model/entry/field/InternalField.java", "diffHunk": "@@ -12,7 +12,6 @@\n public enum InternalField implements Field {\n     OWNER(\"owner\"),\n     TIMESTAMP(\"timestamp\", FieldProperty.DATE),\n-    GROUPS(\"groups\"),", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjcxNzAwNg==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412717006", "bodyText": "Probably JabrefCustomFields, CustomFields?", "author": "stefan-kolb", "createdAt": "2020-04-22T06:52:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDEzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkxOTk3OQ==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412919979", "bodyText": "I now moved all three (group, owner, timestamp) to standard fields. They need to be grouped with the other fields in one enum to use the power of the enummap. Now the \"StandardField\" refers to a field that is a normal field for JabRef.", "author": "tobiasdiez", "createdAt": "2020-04-22T12:01:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDIwNQ==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412674205", "bodyText": "The comment also states, it should left in InternalFields.", "author": "koppor", "createdAt": "2020-04-22T05:10:53Z", "path": "src/main/java/org/jabref/model/entry/field/StandardField.java", "diffHunk": "@@ -124,7 +124,10 @@\n     YEARFILED(\"yearfiled\"),\n     MR_NUMBER(\"mrnumber\"),\n     XDATA(\"xdata\", FieldProperty.MULTIPLE_ENTRY_LINK),\n-    XREF(\"xref\", FieldProperty.SINGLE_ENTRY_LINK);\n+    XREF(\"xref\", FieldProperty.SINGLE_ENTRY_LINK),\n+\n+    // JabRef-specific fields", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDc1Mg==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412674752", "bodyText": "I would put the class in a seperate .java class. This would also enable testing with ...Test.java files.", "author": "koppor", "createdAt": "2020-04-22T05:12:25Z", "path": "src/main/java/org/jabref/model/groups/WordKeywordGroup.java", "diffHunk": "@@ -148,4 +136,59 @@ public int hashCode() {\n                 keywordSeparator,\n                 onlySplitWordsAtSeparator);\n     }\n+\n+    interface SearchStrategy {\n+        boolean contains(BibEntry entry);\n+    }\n+\n+    class StringSearchStrategy implements SearchStrategy {", "originalCommit": "5e4f6e7d5af326085e504819310187c69309d315", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjkyMDc0NA==", "url": "https://github.com/JabRef/jabref/pull/6332#discussion_r412920744", "bodyText": "This is more an implementation detail which shouldn't exposed to the outside world in my opinion. Moreover, private variables are used which makes extraction awkward.", "author": "tobiasdiez", "createdAt": "2020-04-22T12:02:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjY3NDc1Mg=="}], "type": "inlineReview"}, {"oid": "a438195e16e31409c0941b15fe842830a8518342", "url": "https://github.com/JabRef/jabref/commit/a438195e16e31409c0941b15fe842830a8518342", "message": "Include feedback", "committedDate": "2020-04-22T12:04:06Z", "type": "commit"}]}