{"pr_number": 6300, "pr_title": "Remove dash from illegal characters.", "pr_createdAt": "2020-04-16T20:10:09Z", "pr_url": "https://github.com/JabRef/jabref/pull/6300", "timeline": [{"oid": "2b7fad5386054ce91f0b9faa8e1f0bedefe8e8d5", "url": "https://github.com/JabRef/jabref/commit/2b7fad5386054ce91f0b9faa8e1f0bedefe8e8d5", "message": "Remove dash from illegal characters. Fix #6295 #6257 #6252", "committedDate": "2020-04-16T20:06:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyODkxMQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r409828911", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"#~^:'`\u02b9\";\n          \n          \n            \n                private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),=\\\\\\\"#%~'`\u02b9\";\n          \n      \n    \n    \n  \n\nI read the linked issues and especially https://tex.stackexchange.com/a/408548/9075. I adaopted the list accordingly (added % and =; removed ^). Additionally, I left the quotes at the end.", "author": "koppor", "createdAt": "2020-04-16T20:28:50Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -27,7 +27,7 @@\n      */\n     public static final String APPENDIX_CHARACTERS = \"abcdefghijklmnopqrstuvwxyz\";\n     private static final Logger LOGGER = LoggerFactory.getLogger(BibtexKeyGenerator.class);\n-    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"-#~^:'`\u02b9\";\n+    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"#~^:'`\u02b9\";", "originalCommit": "2b7fad5386054ce91f0b9faa8e1f0bedefe8e8d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTg3MjY4NA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r409872684", "bodyText": "This update fixes #6257.", "author": "koppor", "createdAt": "2020-04-16T21:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyODkxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyOTA4Mw==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r409829083", "bodyText": "Why didn't you remove the - it here?", "author": "koppor", "createdAt": "2020-04-16T20:29:07Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -27,7 +27,7 @@\n      */\n     public static final String APPENDIX_CHARACTERS = \"abcdefghijklmnopqrstuvwxyz\";\n     private static final Logger LOGGER = LoggerFactory.getLogger(BibtexKeyGenerator.class);\n-    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"-#~^:'`\u02b9\";\n+    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"#~^:'`\u02b9\";\n     private static final String KEY_UNWANTED_CHARACTERS = \"{}(),\\\\\\\"-\";", "originalCommit": "2b7fad5386054ce91f0b9faa8e1f0bedefe8e8d5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTkwNTg5Mg==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r409905892", "bodyText": "According to the recommendation in the README, I thought it was a mistake to include a dash in illegal signs, not those not recommended.\n\nSome characters should not be used in bibtexkey as they are not compatible or not recommended: { } ( ) , \\ \" - # ~ ^ : '", "author": "dextep", "createdAt": "2020-04-16T23:27:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyOTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDIzMzM5OA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r410233398", "bodyText": "@koppor so should i remove dash from unwanted characters and make update on READEME file?", "author": "dextep", "createdAt": "2020-04-17T13:46:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyOTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDI0ODM1NQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r410248355", "bodyText": "Remove it from illegal, but keep it in unwanted.", "author": "Siedlerchr", "createdAt": "2020-04-17T14:09:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyOTA4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDQ0NTk3Nw==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r410445977", "bodyText": "I checked the usage of KEY_UNWANTED_CHARACTERS.\nThe code comment reads as follows:\n// User doesn't want us to enforce legal characters. We must still look\n// for whitespace and some characters such as commas, since these would\n// interfere with parsing:\nThus, the KEY_UNWANTED_CHARACTERS clearly is a subset of KEY_ILLEGAL_CHARACTERS. Not sure, whether KEY_ILLEGAL_CHARACTERS makes sense at all. Maybe because of tool interopability.\nI see three options:\nA) Remove KEY_UNWANTED_CHARACTERS completely - and also the preference for it.\nB) Set KEY_UNWANTED_CHARACTERS to a minimum - as indicated in the comment. I would propose {}\" since these are the characters causing issues at parsing. I would not add space since this did not cause any issues until now (at list that I am aware of)\nC) Just remove - from KEY_UNWANTED_CHARACTERS\nPlease do option B). Please rename KEY_UNWANTED_CHARACTERS to KEY_CHARACTERS_CAUSING_PARSING_ERRORS. Please add a comment above that this is a subset of KEY_ILLEGAL_CHARACTERS.", "author": "koppor", "createdAt": "2020-04-17T20:10:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwOTgyOTA4Mw=="}], "type": "inlineReview"}, {"oid": "f332e4245fa195c48d8ad7fb87ce9bcdd6e9de0a", "url": "https://github.com/JabRef/jabref/commit/f332e4245fa195c48d8ad7fb87ce9bcdd6e9de0a", "message": "Update bibtexkey incompatible characters.\n\nCo-Authored-By: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-04-17T13:10:24Z", "type": "commit"}, {"oid": "38687aa432d81f5ba933169da0891d28a0653dd6", "url": "https://github.com/JabRef/jabref/commit/38687aa432d81f5ba933169da0891d28a0653dd6", "message": "Add missing abbreviated journal names (#6292)", "committedDate": "2020-04-17T13:19:23Z", "type": "commit"}, {"oid": "feb6709427f81f72bd3ebdd95f53f04e6c8281b1", "url": "https://github.com/JabRef/jabref/commit/feb6709427f81f72bd3ebdd95f53f04e6c8281b1", "message": " Change in CHANGELOG.md described.", "committedDate": "2020-04-17T13:38:26Z", "type": "commit"}, {"oid": "23d9720dc7673a7a541b284a400a97318c35190d", "url": "https://github.com/JabRef/jabref/commit/23d9720dc7673a7a541b284a400a97318c35190d", "message": "Revert \"Add missing abbreviated journal names (#6292)\"\n\nThis reverts commit 38687aa4", "committedDate": "2020-04-17T13:49:19Z", "type": "commit"}, {"oid": "a90ac6049f904afe53e401b633a467b4f0b97f6f", "url": "https://github.com/JabRef/jabref/commit/a90ac6049f904afe53e401b633a467b4f0b97f6f", "message": "Update CHANGELOG.md\n\nCo-Authored-By: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-04-17T22:21:24Z", "type": "commit"}, {"oid": "ed42ac17a0080734378b61bc82c8feec766143ed", "url": "https://github.com/JabRef/jabref/commit/ed42ac17a0080734378b61bc82c8feec766143ed", "message": "Update CHANGELOG.md\n\nCo-Authored-By: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-04-17T22:21:32Z", "type": "commit"}, {"oid": "6fc964554b037782dd23338097c236c37ef71416", "url": "https://github.com/JabRef/jabref/commit/6fc964554b037782dd23338097c236c37ef71416", "message": "Renamed 'KEY_UNWANTED_CHARACTERS' to 'KEY_CHARACTERS_CAUSING_PARSING_ERRORS'.", "committedDate": "2020-04-17T22:40:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUyNTQzOQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r410525439", "bodyText": "Could you please add a comment here referencing https://tex.stackexchange.com/a/408548/9075?\nProposal:\n// Source of illegal characters: https://tex.stackexchange.com/a/408548/9075", "author": "koppor", "createdAt": "2020-04-18T00:36:25Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -24,11 +24,12 @@\n public class BibtexKeyGenerator extends BracketedPattern {\n     /*\n      * All single characters that we can use for extending a key to make it unique.\n+     * KEY_CHARACTERS_CAUSING_PARSING_ERRORS is a subset of KEY_ILLEGAL_CHARACTERS\n      */\n     public static final String APPENDIX_CHARACTERS = \"abcdefghijklmnopqrstuvwxyz\";\n     private static final Logger LOGGER = LoggerFactory.getLogger(BibtexKeyGenerator.class);\n-    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"-#~^:'`\u02b9\";\n-    private static final String KEY_UNWANTED_CHARACTERS = \"{}(),\\\\\\\"-\";\n+    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),=\\\\\\\"#%~'`\u02b9\";", "originalCommit": "6fc964554b037782dd23338097c236c37ef71416", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDUyNTQ4OQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r410525489", "bodyText": "Please remove - here, too. Otherwise, the subset property does not hold.", "author": "koppor", "createdAt": "2020-04-18T00:36:43Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -24,11 +24,12 @@\n public class BibtexKeyGenerator extends BracketedPattern {\n     /*\n      * All single characters that we can use for extending a key to make it unique.\n+     * KEY_CHARACTERS_CAUSING_PARSING_ERRORS is a subset of KEY_ILLEGAL_CHARACTERS\n      */\n     public static final String APPENDIX_CHARACTERS = \"abcdefghijklmnopqrstuvwxyz\";\n     private static final Logger LOGGER = LoggerFactory.getLogger(BibtexKeyGenerator.class);\n-    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"-#~^:'`\u02b9\";\n-    private static final String KEY_UNWANTED_CHARACTERS = \"{}(),\\\\\\\"-\";\n+    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),=\\\\\\\"#%~'`\u02b9\";\n+    private static final String KEY_CHARACTERS_CAUSING_PARSING_ERRORS = \"{}(),\\\\\\\"-\";", "originalCommit": "6fc964554b037782dd23338097c236c37ef71416", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "00f8c927c195c599e10f8df70a0edef605411418", "url": "https://github.com/JabRef/jabref/commit/00f8c927c195c599e10f8df70a0edef605411418", "message": "Merged illegal `KEY_ILLEGAL_CHARACTERS` and disallowed `KEY_CHARACTERS_CAUSING_PARSING_ERRORS` into `KEY_DISALLOWED_CHARACTERS` and removed: ` \u02b9.\nAdded new KEY_UNWANTED_CHARACTERS.", "committedDate": "2020-04-22T19:55:14Z", "type": "commit"}, {"oid": "e39cca3362f88101a488c638aaf5c90217ae90a5", "url": "https://github.com/JabRef/jabref/commit/e39cca3362f88101a488c638aaf5c90217ae90a5", "message": "Adapted the tests according to code updates.", "committedDate": "2020-04-23T00:36:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUwNjUxNQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r413506515", "bodyText": "Oh, wow, did not expect that. See my review comment on allowing characters breaking the parsing of a .bib file.", "author": "koppor", "createdAt": "2020-04-23T04:50:07Z", "path": "src/test/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGeneratorTest.java", "diffHunk": "@@ -943,14 +943,14 @@ void crossrefkeywordsNKeywordsSeparatedBySpace() {\n     @Test\n     void testCheckLegalKeyEnforceLegal() {\n         assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", true));\n-        assertEquals(\"SPECIALCHARS\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,^\", true));\n+        assertEquals(\"SPECIALCHARS\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,\", true));\n         assertEquals(\"\", BibtexKeyGenerator.cleanKey(\"\\n\\t\\r\", true));\n     }\n \n     @Test\n     void testCheckLegalKeyDoNotEnforceLegal() {\n         assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", false));\n-        assertEquals(\"SPECIALCHARS#~^\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,^\", false));", "originalCommit": "e39cca3362f88101a488c638aaf5c90217ae90a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNTA3NA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r415135074", "bodyText": "Following your comment should i add { and } and \" to KEY ILLEGAL CHARACTERS then test result after cleaning key will be less about characters which can be cause parsing errors?", "author": "dextep", "createdAt": "2020-04-25T20:12:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUwNjUxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUwNzM4OQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r413507389", "bodyText": "This change is strange. Arn read better than A\u00b4r. Unsure, what the other reviewers think here. -- On the one hand, this is an example that keeping as much characters as possible might not be good. On the other hand, we have the cleanup funtionality for BibTeX keys, which can be used by users.", "author": "koppor", "createdAt": "2020-04-23T04:52:46Z", "path": "src/test/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGeneratorTest.java", "diffHunk": "@@ -239,7 +239,7 @@ void testMakeLabelAndCheckLegalKeysAccentGrave() throws ParseException {\n \n         entry0 = BibtexParser.singleFromString(\"@ARTICLE{kohn, author={Andr\u00e9s A\u02b9rnold}, year={2000}}\",\n                 importFormatPreferences, fileMonitor);\n-        assertEquals(\"Arn\",", "originalCommit": "e39cca3362f88101a488c638aaf5c90217ae90a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTEzNDIzNA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r415134234", "bodyText": "I think in this case should we stay with Arn, but when we removed \u02b9 from KEY_ILLEGAL_CHARACTERS this test was going fail. I wasn't sure what to do with that so that's why i change to A\u00b4r.", "author": "dextep", "createdAt": "2020-04-25T20:07:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzUwNzM4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTMzODM3MA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r415338370", "bodyText": "Can you please convert this into a List<Character>. Should be slightly more readable as the characters are then clearly distinguishable from each other.\nAlso the KEY prefix seems unnecessary as we are in the KeyGenerator class anyway.", "author": "tobiasdiez", "createdAt": "2020-04-26T15:43:49Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -27,8 +27,9 @@\n      */\n     public static final String APPENDIX_CHARACTERS = \"abcdefghijklmnopqrstuvwxyz\";\n     private static final Logger LOGGER = LoggerFactory.getLogger(BibtexKeyGenerator.class);\n-    private static final String KEY_ILLEGAL_CHARACTERS = \"{}(),\\\\\\\"-#~^:'`\u02b9\";\n-    private static final String KEY_UNWANTED_CHARACTERS = \"{}(),\\\\\\\"-\";\n+    // Source of DISALLOWED characters: https://tex.stackexchange.com/a/408548/9075\n+    private static final String KEY_DISALLOWED_CHARACTERS = \"{}(),=\\\\\\\"#%~'\";", "originalCommit": "e39cca3362f88101a488c638aaf5c90217ae90a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "471ec0e11c71d74e0bfaaa4a9250f27b82a5d32c", "url": "https://github.com/JabRef/jabref/commit/471ec0e11c71d74e0bfaaa4a9250f27b82a5d32c", "message": "Removed 'enforceLegalKey'.\nChanged 'KEY_ILLEGAL_CHARACTERS' and 'KEY_UNWANTED_CHARACTERS'.\nUpdated tests.\nChanged error warning about disallowed characters.", "committedDate": "2020-04-28T22:39:27Z", "type": "commit"}, {"oid": "19e0879bd99349e48b3fb0e9c761b753e615795d", "url": "https://github.com/JabRef/jabref/commit/19e0879bd99349e48b3fb0e9c761b753e615795d", "message": "Removed \"Enforce legal characters in BibTeX keys\" option in the preferences (General tab).\nRemoved 'ENFORCE_LEGAL_BIBTEX_KEY' from JabRefPreferences.java.\nAdded \"Remove the following characters:\" field in \"BibTeX key generator\" tab in the preferences for the unwanted characters.\nAdded 'DEFAULT_UNWANTED_BIBTEX_KEY_CHARACTERS' to JabRefPreferences.java as defaults.\nRevert 'avoidOverwritingCiteKey' - mistakenly removed in previous commit from BibtexKeyPatternPreferences.java.", "committedDate": "2020-05-01T18:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MjgxMw==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418662813", "bodyText": "How should i pass UnwantedCharacters here?", "author": "dextep", "createdAt": "2020-05-01T18:03:38Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -54,7 +54,8 @@ static String generateKey(BibEntry entry, String pattern) {\n     static String generateKey(BibEntry entry, String pattern, BibDatabase database) {\n         GlobalBibtexKeyPattern keyPattern = new GlobalBibtexKeyPattern(Collections.emptyList());\n         keyPattern.setDefaultValue(\"[\" + pattern + \"]\");\n-        return new BibtexKeyGenerator(keyPattern, database, new BibtexKeyPatternPreferences(\"\", \"\", false, true, true, keyPattern, ','))\n+        String unwantedCharacters = \"-`\u02b9:!;?^+\";", "originalCommit": "19e0879bd99349e48b3fb0e9c761b753e615795d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1Mzg4MQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418753881", "bodyText": "It's a bit ugly, but I guess it's ok to leave it like that because the two static methods shouldn't be used anyway. If you could be so nice, please add a @Deprecated annotation to them.", "author": "tobiasdiez", "createdAt": "2020-05-01T21:53:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2MjgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2NTgxMg==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418665812", "bodyText": "Here ValidBibtexKeyChecker cannot depend on org.jabref.Globals, but if i pass it using be BibtexKeyPatternPreferences.java, FieldCheckers class have to take BibtexKeyPatternPreferences instance also. would this solution be correct?", "author": "dextep", "createdAt": "2020-05-01T18:10:22Z", "path": "src/main/java/org/jabref/logic/integrity/ValidBibtexKeyChecker.java", "diffHunk": "@@ -17,7 +18,7 @@\n             return Optional.of(Localization.lang(\"empty BibTeX key\"));\n         }\n \n-        String cleaned = BibtexKeyGenerator.cleanKey(value);\n+        String cleaned = BibtexKeyGenerator.cleanKey(value, Globals.prefs.getUnwantedCharacters());", "originalCommit": "19e0879bd99349e48b3fb0e9c761b753e615795d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTY1NQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418755655", "bodyText": "Luckily, you can simply pass an empty string here since the integrity check shouldn't warn about unwanted characters. (This is what I meant with my somewhat cryptic text the other day).", "author": "tobiasdiez", "createdAt": "2020-05-01T21:58:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODY2NTgxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTA4Mw==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418755083", "bodyText": "I think you should use preferences.getBibtexKeyPatternPreferences().getUnwantedCharacters() here as the second argument, right?", "author": "tobiasdiez", "createdAt": "2020-05-01T21:56:48Z", "path": "src/main/java/org/jabref/logic/importer/fileformat/EndnoteImporter.java", "diffHunk": "@@ -232,8 +232,7 @@ public ParserResult importDatabase(BufferedReader reader) throws IOException {\n                         type = StandardEntryType.MastersThesis;\n                     }\n                 } else if (\"F\".equals(prefix)) {\n-                    hm.put(InternalField.KEY_FIELD, BibtexKeyGenerator.cleanKey(val,\n-                            preferences.getBibtexKeyPatternPreferences().isEnforceLegalKey()));\n+                    hm.put(InternalField.KEY_FIELD, BibtexKeyGenerator.cleanKey(val, \"-`\u02b9:!;?^+\"));", "originalCommit": "19e0879bd99349e48b3fb0e9c761b753e615795d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NTk5MQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418755991", "bodyText": "Can you please remove the DEFAULT prefix (as it is not a default value for something, but the real thing).", "author": "tobiasdiez", "createdAt": "2020-05-01T21:59:37Z", "path": "src/main/java/org/jabref/preferences/JabRefPreferences.java", "diffHunk": "@@ -214,6 +214,7 @@\n     // Currently, it is not possible to specify defaults for specific entry types\n     // When this should be made possible, the code to inspect is org.jabref.gui.preferences.BibtexKeyPatternPrefTab.storeSettings() -> LabelPattern keypatterns = getCiteKeyPattern(); etc\n     public static final String DEFAULT_BIBTEX_KEY_PATTERN = \"defaultBibtexKeyPattern\";\n+    public static final String DEFAULT_UNWANTED_BIBTEX_KEY_CHARACTERS = \"defaultUnwantedBibtexKeyCharacters\";", "originalCommit": "19e0879bd99349e48b3fb0e9c761b753e615795d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODc1NjMyNA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r418756324", "bodyText": "I think the second argument can be replaced by preferences.getUnwantedCharacters().", "author": "tobiasdiez", "createdAt": "2020-05-01T22:00:45Z", "path": "src/main/java/org/jabref/gui/customizefields/CustomizeGeneralFieldsDialogViewModel.java", "diffHunk": "@@ -57,12 +58,13 @@ public void saveFields() {\n                 return;\n             }\n \n-            String testString = BibtexKeyGenerator.cleanKey(parts[1], preferences.getEnforceLegalKeys());\n+            String testString = BibtexKeyGenerator.cleanKey(parts[1], Globals.prefs.get(JabRefPreferences.DEFAULT_UNWANTED_BIBTEX_KEY_CHARACTERS));", "originalCommit": "19e0879bd99349e48b3fb0e9c761b753e615795d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2161cd14de9ba04034f26f80d86ab4230f63b7dc", "url": "https://github.com/JabRef/jabref/commit/2161cd14de9ba04034f26f80d86ab4230f63b7dc", "message": "Changes related to the review.", "committedDate": "2020-05-02T21:49:14Z", "type": "commit"}, {"oid": "ae8b18394df222ced31150d5c32f4d8ab5220524", "url": "https://github.com/JabRef/jabref/commit/ae8b18394df222ced31150d5c32f4d8ab5220524", "message": "Remove dash from illegal characters. Fix #6295 #6257 #6252", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "08257ffdde4ab0c76823672fa42e59914cf20853", "url": "https://github.com/JabRef/jabref/commit/08257ffdde4ab0c76823672fa42e59914cf20853", "message": "Update bibtexkey incompatible characters.\n\nCo-Authored-By: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "d0e52417387d1d31aaf2cb66cf0ef24cfa57acc3", "url": "https://github.com/JabRef/jabref/commit/d0e52417387d1d31aaf2cb66cf0ef24cfa57acc3", "message": " Change in CHANGELOG.md described.", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "8a510e3dd9cca6020965f3ce64eb9d7cd5fc7d99", "url": "https://github.com/JabRef/jabref/commit/8a510e3dd9cca6020965f3ce64eb9d7cd5fc7d99", "message": "Revert \"Add missing abbreviated journal names (#6292)\"\n\nThis reverts commit 38687aa4", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "d7d5ac7bf79648fc1207c05d7491cd2485587f8b", "url": "https://github.com/JabRef/jabref/commit/d7d5ac7bf79648fc1207c05d7491cd2485587f8b", "message": "Update CHANGELOG.md\n\nCo-Authored-By: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "dda32599b8b12155f24bef1ddbb11cff3fcf5d05", "url": "https://github.com/JabRef/jabref/commit/dda32599b8b12155f24bef1ddbb11cff3fcf5d05", "message": "Update CHANGELOG.md\n\nCo-Authored-By: Oliver Kopp <kopp.dev@gmail.com>", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "7362457ddc6a5818aff8d67906e436d80516087c", "url": "https://github.com/JabRef/jabref/commit/7362457ddc6a5818aff8d67906e436d80516087c", "message": "Renamed 'KEY_UNWANTED_CHARACTERS' to 'KEY_CHARACTERS_CAUSING_PARSING_ERRORS'.", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "fe430206717ed4266e85b807e157608bf68820ac", "url": "https://github.com/JabRef/jabref/commit/fe430206717ed4266e85b807e157608bf68820ac", "message": "Merged illegal `KEY_ILLEGAL_CHARACTERS` and disallowed `KEY_CHARACTERS_CAUSING_PARSING_ERRORS` into `KEY_DISALLOWED_CHARACTERS` and removed: ` \u02b9.\nAdded new KEY_UNWANTED_CHARACTERS.", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "aae2b0ed4d5d9252aa00f6e2879f7d66e2d6f7e0", "url": "https://github.com/JabRef/jabref/commit/aae2b0ed4d5d9252aa00f6e2879f7d66e2d6f7e0", "message": "Adapted the tests according to code updates.", "committedDate": "2020-05-03T16:06:31Z", "type": "commit"}, {"oid": "4807493816ace90992943762d3201b243d1b87ed", "url": "https://github.com/JabRef/jabref/commit/4807493816ace90992943762d3201b243d1b87ed", "message": "Removed 'enforceLegalKey'.\nChanged 'KEY_ILLEGAL_CHARACTERS' and 'KEY_UNWANTED_CHARACTERS'.\nUpdated tests.\nChanged error warning about disallowed characters.", "committedDate": "2020-05-03T16:10:43Z", "type": "commit"}, {"oid": "0b1ca1a8379aaf81dde804f8c749dd0ede81af67", "url": "https://github.com/JabRef/jabref/commit/0b1ca1a8379aaf81dde804f8c749dd0ede81af67", "message": "Removed \"Enforce legal characters in BibTeX keys\" option in the preferences (General tab).\nRemoved 'ENFORCE_LEGAL_BIBTEX_KEY' from JabRefPreferences.java.\nAdded \"Remove the following characters:\" field in \"BibTeX key generator\" tab in the preferences for the unwanted characters.\nAdded 'DEFAULT_UNWANTED_BIBTEX_KEY_CHARACTERS' to JabRefPreferences.java as defaults.\nRevert 'avoidOverwritingCiteKey' - mistakenly removed in previous commit from BibtexKeyPatternPreferences.java.", "committedDate": "2020-05-03T16:21:15Z", "type": "commit"}, {"oid": "d64b9118b11b8e9f74cf1a4072cc7b86b987d1af", "url": "https://github.com/JabRef/jabref/commit/d64b9118b11b8e9f74cf1a4072cc7b86b987d1af", "message": "Changes related to the review.", "committedDate": "2020-05-03T16:21:15Z", "type": "commit"}, {"oid": "6032766d40eb6cd8423235052d95cd7b7c67499d", "url": "https://github.com/JabRef/jabref/commit/6032766d40eb6cd8423235052d95cd7b7c67499d", "message": "Changes related to the review.", "committedDate": "2020-05-03T16:50:41Z", "type": "commit"}, {"oid": "995ff608aa8b5e1d251fa62691878f134a300c36", "url": "https://github.com/JabRef/jabref/commit/995ff608aa8b5e1d251fa62691878f134a300c36", "message": "Merge branch 'remove-dash-from-illegal-chars' of https://github.com/dextep/jabref into remove-dash-from-illegal-chars\n\n# Conflicts:\n#\tsrc/main/java/org/jabref/gui/customizefields/CustomizeGeneralFieldsDialogViewModel.java\n#\tsrc/main/java/org/jabref/gui/integrity/IntegrityCheckAction.java\n#\tsrc/test/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGeneratorTest.java", "committedDate": "2020-05-03T17:02:54Z", "type": "commit"}, {"oid": "4d3719579ff9a1a88f25825134b9dab8a3482efc", "url": "https://github.com/JabRef/jabref/commit/4d3719579ff9a1a88f25825134b9dab8a3482efc", "message": "Merge remote-tracking branch 'upstream/master' into remove-dash-from-illegal-chars", "committedDate": "2020-05-04T19:17:07Z", "type": "commit"}, {"oid": "3f5b2e58ba99ee3acd7d068d9dff14ddbd3fdc00", "url": "https://github.com/JabRef/jabref/commit/3f5b2e58ba99ee3acd7d068d9dff14ddbd3fdc00", "message": "Fix checkstyle.\nFix unit tests.", "committedDate": "2020-05-05T01:48:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkxODE0OQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r419918149", "bodyText": "Please extract \"-\u02b9:!;?^+\"to a public constantDEFAULT_UNWANTED_CHARACTERSinBibtexKeyGenerator` and use it everywhere.", "author": "tobiasdiez", "createdAt": "2020-05-05T07:38:44Z", "path": "src/test/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGeneratorTest.java", "diffHunk": "@@ -73,7 +73,7 @@ void testCrossrefAndInAuthorNames() throws Exception {\n \n         assertEquals(\"Holland\",\n                 BibtexKeyGenerator.cleanKey(BibtexKeyGenerator.generateKey(entry1, \"auth\",\n-                        database), true));\n+                        database), \"-`\u02b9:!;?^+\"));", "originalCommit": "3f5b2e58ba99ee3acd7d068d9dff14ddbd3fdc00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEzMzM5MA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420133390", "bodyText": "I wasn't sure it was correct, thanks!", "author": "dextep", "createdAt": "2020-05-05T14:02:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkxODE0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQxNDU3OA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420414578", "bodyText": "It's usually a good idea to don't have duplication of code or magic strings. Makes it harder to maintain in the future.", "author": "tobiasdiez", "createdAt": "2020-05-05T21:22:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkxODE0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkxODg5MA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r419918890", "bodyText": "These tests need to be adapted, at least there names.", "author": "tobiasdiez", "createdAt": "2020-05-05T07:40:14Z", "path": "src/test/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGeneratorTest.java", "diffHunk": "@@ -942,22 +942,22 @@ void crossrefkeywordsNKeywordsSeparatedBySpace() {\n \n     @Test\n     void testCheckLegalKeyEnforceLegal() {\n-        assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", true));\n-        assertEquals(\"SPECIALCHARS\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,^\", true));\n-        assertEquals(\"\", BibtexKeyGenerator.cleanKey(\"\\n\\t\\r\", true));\n+        assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", \"-`\u02b9:!;?^+\"));", "originalCommit": "3f5b2e58ba99ee3acd7d068d9dff14ddbd3fdc00", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkxOTQ3OQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r419919479", "bodyText": "I think it's better to use an empty string as the unwanted characters here, instead of changing the expected value. Otherwise this test is exactly the same as the previous.", "author": "tobiasdiez", "createdAt": "2020-05-05T07:41:27Z", "path": "src/test/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGeneratorTest.java", "diffHunk": "@@ -942,22 +942,22 @@ void crossrefkeywordsNKeywordsSeparatedBySpace() {\n \n     @Test\n     void testCheckLegalKeyEnforceLegal() {\n-        assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", true));\n-        assertEquals(\"SPECIALCHARS\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,^\", true));\n-        assertEquals(\"\", BibtexKeyGenerator.cleanKey(\"\\n\\t\\r\", true));\n+        assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", \"-`\u02b9:!;?^+\"));\n+        assertEquals(\"SPECIALCHARS\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,\", \"-`\u02b9:!;?^+\"));\n+        assertEquals(\"\", BibtexKeyGenerator.cleanKey(\"\\n\\t\\r\", \"-`\u02b9:!;?^+\"));\n     }\n \n     @Test\n     void testCheckLegalKeyDoNotEnforceLegal() {\n-        assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", false));\n-        assertEquals(\"SPECIALCHARS#~^\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,^\", false));\n-        assertEquals(\"\", BibtexKeyGenerator.cleanKey(\"\\n\\t\\r\", false));\n+        assertEquals(\"AAAA\", BibtexKeyGenerator.cleanKey(\"AA AA\", \"-`\u02b9:!;?^+\"));\n+        assertEquals(\"SPECIALCHARS\", BibtexKeyGenerator.cleanKey(\"SPECIAL CHARS#{\\\\\\\"}~,^\", \"-`\u02b9:!;?^+\"));", "originalCommit": "3f5b2e58ba99ee3acd7d068d9dff14ddbd3fdc00", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDEyODg0Nw==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420128847", "bodyText": "Of course, I don't know why I didn't pay attention for this. Thank you very much for your helpful review!", "author": "dextep", "createdAt": "2020-05-05T13:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTkxOTQ3OQ=="}], "type": "inlineReview"}, {"oid": "6db1344b410eb133c436951df8211353fa66c633", "url": "https://github.com/JabRef/jabref/commit/6db1344b410eb133c436951df8211353fa66c633", "message": "Changes related to the review.", "committedDate": "2020-05-05T19:27:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU4MTU1Ng==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420581556", "bodyText": "Please replace the code:\n        String newKey = key.chars()\n                .filter(c -> unwantedCharacters.indexOf(c) == -1)\n                .filter(c -> !DISALLOWED_CHARACTERS.contains((char) c))\n                .collect(StringBuilder::new,\n                        StringBuilder::appendCodePoint, StringBuilder::append)\n                .toString();\n\nI came up while thinking as follows (and stack-overflow-ing for String filter characters, ...). Used answer: https://stackoverflow.com/a/20268845/873282\nWhy not a simple indexOf thing?\n\"abcdef\".indexOf('c') != -1;\nSee https://stackoverflow.com/a/506107/873282.\nSecond reason: Conversion into the list is IMHO more CPU consuming than the indexOf call. I know, that it is not critical, but I think, the conversion (plus the readble !unwantedChars.contains(c)) is less readable then a simple (unwantedChars.indexOf(c) >= 0)", "author": "koppor", "createdAt": "2020-05-06T07:00:36Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -73,36 +77,26 @@ private static String getAppendix(int number) {\n         }\n     }\n \n-    public static String removeUnwantedCharacters(String key, boolean enforceLegalKey) {\n-        if (!enforceLegalKey) {\n-            // User doesn't want us to enforce legal characters. We must still look\n-            // for whitespace and some characters such as commas, since these would\n-            // interfere with parsing:\n-            StringBuilder newKey = new StringBuilder();\n-            for (int i = 0; i < key.length(); i++) {\n-                char c = key.charAt(i);\n-                if (KEY_UNWANTED_CHARACTERS.indexOf(c) == -1) {\n-                    newKey.append(c);\n-                }\n-            }\n-            return newKey.toString();\n+    public static String removeUnwantedCharacters(String key, String unwantedCharacters) {\n+        List<Character> unwantedChars = new ArrayList<>();\n+        for (char ch : unwantedCharacters.toCharArray()) {\n+            unwantedChars.add(ch);\n         }\n \n         StringBuilder newKey = new StringBuilder();\n         for (int i = 0; i < key.length(); i++) {\n             char c = key.charAt(i);\n-            if (KEY_ILLEGAL_CHARACTERS.indexOf(c) == -1) {\n+            if (!DISALLOWED_CHARACTERS.contains(c) && !unwantedChars.contains(c)) {\n                 newKey.append(c);\n             }\n         }", "originalCommit": "6db1344b410eb133c436951df8211353fa66c633", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3MzM1Ng==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420773356", "bodyText": "I didn't think of it that way, thank you for your review @koppor \ud83d\udc4d!", "author": "dextep", "createdAt": "2020-05-06T13:04:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU4MTU1Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4MTA5Nw==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420781097", "bodyText": "You're welcome. Plese note that I used multiline comments:\n\nThus, more code can be deleted. See also my new review comment.\nSorry for being picky here. I hope with these tough comments here we won't need to touch this code the next months again \ud83c\udf88", "author": "koppor", "createdAt": "2020-05-06T13:16:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDU4MTU1Ng=="}], "type": "inlineReview"}, {"oid": "c1ec4add7fa8992d79185f0230329ee904bb6227", "url": "https://github.com/JabRef/jabref/commit/c1ec4add7fa8992d79185f0230329ee904bb6227", "message": "Changes related to the review.", "committedDate": "2020-05-06T12:59:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3OTY3OA==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420779678", "bodyText": "We don't need the unwantedChars variable, do we? Can you please delete that for loop and the variable? --> the code on line 86 directly accesses the method parameter unwantedChararacters!\nSide note: This is an example why similar variable names can be mixed up.", "author": "koppor", "createdAt": "2020-05-06T13:14:25Z", "path": "src/main/java/org/jabref/logic/bibtexkeypattern/BibtexKeyGenerator.java", "diffHunk": "@@ -82,17 +82,15 @@ public static String removeUnwantedCharacters(String key, String unwantedCharact\n         for (char ch : unwantedCharacters.toCharArray()) {", "originalCommit": "c1ec4add7fa8992d79185f0230329ee904bb6227", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc4NTUzMQ==", "url": "https://github.com/JabRef/jabref/pull/6300#discussion_r420785531", "bodyText": "Of course, we don't need it, I'm sorry. Every time I get the impression that I didn't notice something. \ud83d\udc1e", "author": "dextep", "createdAt": "2020-05-06T13:22:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDc3OTY3OA=="}], "type": "inlineReview"}, {"oid": "cfeea59722afa6ad4e8eda64fe4e63dd78dfc1b8", "url": "https://github.com/JabRef/jabref/commit/cfeea59722afa6ad4e8eda64fe4e63dd78dfc1b8", "message": "Changes related to the review.", "committedDate": "2020-05-06T13:17:33Z", "type": "commit"}]}