{"pr_number": 2083, "pr_title": "[CALCITE-4139] Prevent NPE in ListTransientTable", "pr_createdAt": "2020-07-26T17:02:56Z", "pr_url": "https://github.com/apache/calcite/pull/2083", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDYxMDIzMQ==", "url": "https://github.com/apache/calcite/pull/2083#discussion_r460610231", "bodyText": "When the current can be null ?", "author": "danny0405", "createdAt": "2020-07-27T02:02:13Z", "path": "core/src/main/java/org/apache/calcite/schema/impl/ListTransientTable.java", "diffHunk": "@@ -99,6 +99,9 @@ public ListTransientTable(String name, RelDataType rowType) {\n           // TODO cleaner way to handle non-array objects?\n           @Override public Object[] current() {\n             Object current = list.get(i);\n+            if (current == null) {\n+              return null;\n+            }", "originalCommit": "ccb2e20ab5883bd10ea58d0ff6a4ab9a802eb432", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY3NzY3OA==", "url": "https://github.com/apache/calcite/pull/2083#discussion_r460677678", "bodyText": "ListTransientTable is currently used in combination with repeatUnion to support recursive queries. So we could get to this scenario if we have a null involved in the repeatUnion.", "author": "rubenada", "createdAt": "2020-07-27T06:43:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDYxMDIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDY4NTQyMg==", "url": "https://github.com/apache/calcite/pull/2083#discussion_r460685422", "bodyText": "Hmm, is it possible to write a test case there, for your case null involved repeatUnion", "author": "danny0405", "createdAt": "2020-07-27T07:04:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDYxMDIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkwNjUzNQ==", "url": "https://github.com/apache/calcite/pull/2083#discussion_r460906535", "bodyText": "Thanks for the feedback @danny0405 . I have provided a unit test that reproduces the NPE.", "author": "rubenada", "createdAt": "2020-07-27T13:54:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDYxMDIzMQ=="}], "type": "inlineReview"}, {"oid": "70cf29e43ab7413e3e067b6f0fe1444d99b82f54", "url": "https://github.com/apache/calcite/commit/70cf29e43ab7413e3e067b6f0fe1444d99b82f54", "message": "[CALCITE-4139] Prevent NPE in ListTransientTable", "committedDate": "2020-07-27T13:52:05Z", "type": "commit"}, {"oid": "70cf29e43ab7413e3e067b6f0fe1444d99b82f54", "url": "https://github.com/apache/calcite/commit/70cf29e43ab7413e3e067b6f0fe1444d99b82f54", "message": "[CALCITE-4139] Prevent NPE in ListTransientTable", "committedDate": "2020-07-27T13:52:05Z", "type": "forcePushed"}]}