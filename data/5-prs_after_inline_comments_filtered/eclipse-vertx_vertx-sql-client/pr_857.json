{"pr_number": 857, "pr_title": "Fix the incorrect hostname of proxy server in connection auto retry testsuite", "pr_createdAt": "2020-12-15T23:30:33Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/857", "timeline": [{"oid": "c225f2548e93c497bcda8b0a76434464eb9f4640", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/c225f2548e93c497bcda8b0a76434464eb9f4640", "message": "Fix hostname when connecting to proxy and postgres\n\nPgConnectionAutoRetryTest connects to the proxy using the\nhostname returned by ContainerPgRule.\nThis differs from `localhost` in some CI environments, see #854 and\nhttps://www.testcontainers.org/features/networking/#getting-the-container-host\nThis needs to be changed to `localhost`, the proxy hostname,\nto make the tests succeed.\n\nConnectionAutoRetryTestBase connects to the database using\n`localhost` as hostname. The hostname of the database differs\nfrom `localhost` in some CI environments.\nUse the hostname returned by ContainerPgRule to make the tests succeed.\n\nFixes #854\n\nSigned-off-by: Julian Ladisch <julianladisch@users.noreply.github.com>", "committedDate": "2020-12-15T22:57:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgxNjUzNQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/857#discussion_r543816535", "bodyText": "can you update other auto retry tests(they all extends ConnectionAutoRetryTestBase) in this project as well?", "author": "BillyYccc", "createdAt": "2020-12-16T01:47:16Z", "path": "vertx-pg-client/src/test/java/io/vertx/pgclient/tck/PgConnectionAutoRetryTest.java", "diffHunk": "@@ -42,6 +42,7 @@ public void tearDown(TestContext ctx) {\n   protected void initialConnector(int proxyPort) {\n     SqlConnectOptions proxyOptions = new PgConnectOptions(options);\n     proxyOptions.setPort(proxyPort);\n+    proxyOptions.setHost(\"localhost\");", "originalCommit": "c225f2548e93c497bcda8b0a76434464eb9f4640", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgxODI4Nw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/857#discussion_r543818287", "bodyText": "The proxy server listening on a default host also seems not reliable for the testing, can we try to get rid of it and use the database host instead?", "author": "BillyYccc", "createdAt": "2020-12-16T01:52:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgxNjUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE3NzcwNA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/857#discussion_r545177704", "bodyText": "Each *ConnectionAutoRetryTest uses proxyOptions.setHost(\"localhost\") now.", "author": "julianladisch", "createdAt": "2020-12-17T15:27:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgxNjUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE4Njg2Nw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/857#discussion_r545186867", "bodyText": "The proxy server uses this.netServer.listen(), this is listening on default host = \"0.0.0.0\" = all interfaces.\nI don't see how this could be unreliable.\nVert.x always starts a NetServer on localhost. For starting a server running at some other address we need Docker to create that server on a docker network. This is a different feature and should be tested in a different test, not in the connection auto retry test.", "author": "julianladisch", "createdAt": "2020-12-17T15:39:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzgxNjUzNQ=="}], "type": "inlineReview"}, {"oid": "02ac50f78e42c0f3ce6a1e894da6720e341b88ea", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/02ac50f78e42c0f3ce6a1e894da6720e341b88ea", "message": "Fix proxy hostname for DB2, MSSQL, MySQL\n\nSigned-off-by: Julian Ladisch <julianladisch@users.noreply.github.com>", "committedDate": "2020-12-17T15:10:07Z", "type": "commit"}]}