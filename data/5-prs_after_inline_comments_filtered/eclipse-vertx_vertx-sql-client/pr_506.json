{"pr_number": 506, "pr_title": "Get the SSL handshake failure being reported to messageHandler correctly", "pr_createdAt": "2020-01-14T22:43:33Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/506", "timeline": [{"oid": "5073a70c5ebda74b0ca4bcb57f63af469cd8d33b", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/5073a70c5ebda74b0ca4bcb57f63af469cd8d33b", "message": "get the SSL handshake failure being reported to messageHandler correctly\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-01-14T22:42:17Z", "type": "commit"}, {"oid": "02a68f63d3ea5d590f5091385b045d1da3593e51", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/02a68f63d3ea5d590f5091385b045d1da3593e51", "message": "fix NPE\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-01-14T23:03:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMDk0MQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/506#discussion_r366910941", "bodyText": "this change will have a merge conflict with your other PR #505, I assume you can just undo this change?", "author": "aguibert", "createdAt": "2020-01-15T14:39:50Z", "path": "vertx-mysql-client/src/main/java/io/vertx/mysqlclient/impl/InitiateSslHandler.java", "diffHunk": "@@ -41,7 +41,6 @@ public void channelRead(ChannelHandlerContext ctx, Object msg) throws Exception\n \n   @Override\n   public void exceptionCaught(ChannelHandlerContext ctx, Throwable cause) throws Exception {\n-    cause.printStackTrace();", "originalCommit": "02a68f63d3ea5d590f5091385b045d1da3593e51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxNjc1NA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/506#discussion_r366916754", "bodyText": "no because this PR is for 3.8 branch.", "author": "BillyYccc", "createdAt": "2020-01-15T14:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMDk0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMTg0Mg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/506#discussion_r366911842", "bodyText": "this does seem a bit hacky, where does the error message come from? Is there any chance it could change or be a localized (non-english) message?", "author": "aguibert", "createdAt": "2020-01-15T14:41:33Z", "path": "vertx-mysql-client/src/main/java/io/vertx/mysqlclient/impl/codec/MySQLEncoder.java", "diffHunk": "@@ -49,6 +49,14 @@ void write(CommandBase<?> cmd) {\n     codec.completionHandler = resp -> {\n       CommandCodec c = inflight.poll();\n       resp.cmd = (CommandBase) c.cmd;\n+      /*\n+       * a bit hacky but we need this message delivered to the socket messageHandler\n+       */\n+      if (resp.cause() != null && resp.cause().getMessage().equals(\"SSL handshake failed\")) {", "originalCommit": "02a68f63d3ea5d590f5091385b045d1da3593e51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkyMDQ5NQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/506#discussion_r366920495", "bodyText": "The error is from \n  \n    \n      vertx-sql-client/vertx-mysql-client/src/main/java/io/vertx/mysqlclient/impl/InitiateSslHandler.java\n    \n    \n         Line 56\n      in\n      6d38d4b\n    \n    \n    \n    \n\n        \n          \n           upgradePromise.tryFail(new VertxException(\"SSL handshake failed\", true)); \n        \n    \n  \n\n\nBecause in Vert.x 3.8 the NetSocket#upgradeToSsl method does not have an async result to represent if it fails, so we let the failure propagated in the channel pipeline and gets the connection closed, then we can check the activity of channel to know if the SSL handshake is successful or not. We only need this trick in 3.8 branch which is different what I do in my another PR for master branch(i.e. 4.0 version).", "author": "BillyYccc", "createdAt": "2020-01-15T14:56:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjkxMTg0Mg=="}], "type": "inlineReview"}, {"oid": "6405b638e777cd756619e69bc5475b0c4742bd67", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/6405b638e777cd756619e69bc5475b0c4742bd67", "message": "add a test for MySQLTLSTest with a wrong certificate\n\nSigned-off-by: Billy Yuan <billy112487983@gmail.com>", "committedDate": "2020-01-16T14:28:21Z", "type": "commit"}]}