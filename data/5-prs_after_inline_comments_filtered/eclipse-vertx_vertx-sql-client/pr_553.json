{"pr_number": 553, "pr_title": "Add tests for table joins and subqueries", "pr_createdAt": "2020-03-20T21:20:17Z", "pr_url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553", "timeline": [{"oid": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "url": "https://github.com/eclipse-vertx/vertx-sql-client/commit/67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "message": "Add tests for table joins and subqueries", "committedDate": "2020-03-20T21:16:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NTIyNg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395895226", "bodyText": "this change was requested from the previous PR", "author": "aguibert", "createdAt": "2020-03-20T21:20:52Z", "path": "vertx-db2-client/src/main/java/io/vertx/db2client/impl/drda/ColumnMetaData.java", "diffHunk": "@@ -115,6 +115,8 @@ public void setColumnCount(final int numColumns) {\n     }\n     \n     public String getColumnName(int i) {\n+    \tif (i < 0)", "originalCommit": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg5NTI4Mg==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395895282", "bodyText": "this change was requested from the previous PR", "author": "aguibert", "createdAt": "2020-03-20T21:21:00Z", "path": "vertx-sql-client/src/main/java/io/vertx/sqlclient/impl/ListTuple.java", "diffHunk": "@@ -19,7 +19,6 @@\n \n import io.vertx.sqlclient.Tuple;\n \n-import java.util.Iterator;", "originalCommit": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNTcxMQ==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395905711", "bodyText": "tablesToClean() always returns an empty list each time, so won't that mean cleanTestTable() will never be run?", "author": "gjwatts", "createdAt": "2020-03-20T21:51:35Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/DB2TestBase.java", "diffHunk": "@@ -21,12 +26,17 @@\n \tprotected Vertx vertx;\n \tprotected Connector<SqlConnection> connector;\n \tprotected DB2ConnectOptions options;\n+\t\n+\t@Rule\n+\tpublic TestName testName = new TestName();\n \n \t@Before\n \tpublic void setUp(TestContext ctx) throws Exception {\n+\t\tSystem.out.println(\">>> BEGIN \" + testName.getMethodName());\n \t\tvertx = Vertx.vertx();\n \t\tinitConnector();\n-\t\tcleanTestTable(ctx);\n+\t\tfor (String table : tablesToClean())\n+\t\t\tcleanTestTable(ctx, table);\n \t}", "originalCommit": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjQ5MjY2OA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r396492668", "bodyText": "by default yes, but if a test class wants to have tables cleaned they can override the tablesToClean() method like this:\n\tprotected List<String> tablesToClean() {\n\t\treturn Collections.singletonList(\"someTable\");\n\t}", "author": "aguibert", "createdAt": "2020-03-23T14:29:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNTcxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjYzNzQzMA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r396637430", "bodyText": "Ok, that makes sense.  Thanks for the explanation.", "author": "gjwatts", "createdAt": "2020-03-23T17:43:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkwNTcxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkyMjM5Nw==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r395922397", "bodyText": "This is a nit and completely irrelevant to the test itself, but on line 25, I would suggest changing \"FORT ID\" to \"FORT MSG\" to remove confusion with the line above.", "author": "gjwatts", "createdAt": "2020-03-20T22:50:03Z", "path": "vertx-db2-client/src/test/java/io/vertx/db2client/TableJoinTest.java", "diffHunk": "@@ -0,0 +1,100 @@\n+package io.vertx.db2client;\n+\n+import java.util.Arrays;\n+\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import io.vertx.ext.unit.TestContext;\n+import io.vertx.ext.unit.junit.VertxUnitRunner;\n+import io.vertx.sqlclient.Row;\n+\n+/**\n+ * Tests for table joins which are documented here:\n+ * https://www.ibm.com/support/knowledgecenter/SSEPEK_10.0.0/intro/src/tpc/db2z_joindatafromtables.html\n+ */\n+@RunWith(VertxUnitRunner.class)\n+public class TableJoinTest extends DB2TestBase {\n+\t\n+\t@Test\n+\tpublic void testColumnRename(TestContext ctx) {\n+\t\tconnect(ctx.asyncAssertSuccess(conn -> {\n+\t\t\tconn.query(\"SELECT immutable.id AS \\\"IMM ID\\\",\" +\n+\t\t                      \"immutable.message AS IMM_MSG,\" +\n+\t\t\t\t\t          \"Fortune.id AS FORT_ID,\" +\n+\t\t                      \"Fortune.message AS \\\"FORT ID\\\" FROM immutable \" + ", "originalCommit": "67fcd3f5c66bbf5ffdeb9fa161fe8306c3eb2eca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjU5MDk3NA==", "url": "https://github.com/eclipse-vertx/vertx-sql-client/pull/553#discussion_r396590974", "bodyText": "good catch, I will correct that in a follow-on PR", "author": "aguibert", "createdAt": "2020-03-23T16:37:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTkyMjM5Nw=="}], "type": "inlineReview"}]}