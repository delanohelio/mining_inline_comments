{"pr_number": 710, "pr_title": "Added navbar button for base admin panel", "pr_createdAt": "2020-05-26T20:36:52Z", "pr_url": "https://github.com/phac-nml/irida/pull/710", "timeline": [{"oid": "3974e3e9281541c31fc0f6165032ab58b516ddae", "url": "https://github.com/phac-nml/irida/commit/3974e3e9281541c31fc0f6165032ab58b516ddae", "message": "Added navbar button for base admin panel", "committedDate": "2020-05-26T20:19:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwOTAwMw==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430709003", "bodyText": "This looks great but you can move\nassertTrue(\"Admin Button should be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0); into the accessPageAsAdmin method after the LoginPage line and remove this test.\nSame applies to the test below where you can move the assertFalse(\"Admin Button should not be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0); into the accessPageFailure method after the LoginPage line and remove the test below as well", "author": "deepsidhu85", "createdAt": "2020-05-26T21:08:52Z", "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/admin/AdminPageIT.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.admin;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.springframework.test.context.ActiveProfiles;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.AbstractIridaUIITChromeDriver;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.LoginPage;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.admin.AdminPage;\n+\n+import com.github.springtestdbunit.annotation.DatabaseSetup;\n+\n+import static junit.framework.TestCase.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@ActiveProfiles(\"it\")\n+@DatabaseSetup(\"/ca/corefacility/bioinformatics/irida/ria/web/admin/AdminPageView.xml\")\n+public class AdminPageIT extends AbstractIridaUIITChromeDriver {\n+\n+\t@Test\n+\tpublic void accessPageAsAdmin() {\n+\t\tLoginPage.loginAsAdmin(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertTrue(\"Page title should be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void accessPageFailure() {\n+\t\tLoginPage.loginAsUser(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertFalse(\"Page title should not be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void adminButtonVisible() {\n+\t\tLoginPage.loginAsAdmin(driver());", "originalCommit": "3974e3e9281541c31fc0f6165032ab58b516ddae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2NzI4MA==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430767280", "bodyText": "\"FUBAR - YOU MADE IT\" is not going to be the final title so maybe test something that will actually be there. I realize that is the only thing on the page, you could ask the driver for the url:\n\nassertTrue(\"Logged in as admin, the user can get to the administration panel\", driver().getCurrentUrl()\n\t\t\t\t.contains(\"/admin\"));\n2. Instead of finding by id, use a class specific for testing. We try to prefix classes that are used with for testing with t- so in this case you could add the class t-admin-panel-btn or something like that.", "author": "joshsadam", "createdAt": "2020-05-26T23:46:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDcwOTAwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2Nzk1NA==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430767954", "bodyText": "XPath really sucks to work with. Again here I would add a specific class for testing beginning with t-. \u00a0It is also better to just ask for the title found on the page and then actually do the comparison in the integration test.", "author": "joshsadam", "createdAt": "2020-05-26T23:48:46Z", "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/admin/AdminPage.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.pages.admin;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+import org.openqa.selenium.support.PageFactory;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.AbstractPage;\n+\n+public class AdminPage extends AbstractPage {\n+\tpublic static final String RELATIVE_URL = \"admin/\";\n+\n+\t@FindBy(tagName=\"body\")\n+\tprivate WebElement body;\n+\n+\tpublic AdminPage(WebDriver driver) { super(driver); }\n+\n+\t/**\n+\t * Initialize the page so that the default {@Link WebElement} has been found.\n+\t *\n+\t * @param driver\t{@Link WebDriver}\n+\t * @return The initialized {@Link AdminPage}\n+\t */\n+\tpublic static AdminPage initPage(WebDriver driver) {\n+\t\tget(driver, RELATIVE_URL);\n+\t\treturn PageFactory.initElements(driver, AdminPage.class);\n+\t}\n+\n+\t/**\n+\t * Compares the expected page title to the actual page title.\n+\t *\n+\t * @return {@link Boolean}\n+\t */\n+\tpublic boolean comparePageTitle(String pageTitle) {\n+\t\tint titleFound = body.findElements(By.xpath(\"//h1[contains(text(),'\" + pageTitle + \"')]\"))", "originalCommit": "3974e3e9281541c31fc0f6165032ab58b516ddae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDc2ODA2NQ==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r430768065", "bodyText": "Better just to find exactly what you are looking for here.  In this case you could find the title here.", "author": "joshsadam", "createdAt": "2020-05-26T23:49:13Z", "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/admin/AdminPage.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.pages.admin;\n+\n+import org.openqa.selenium.By;\n+import org.openqa.selenium.WebDriver;\n+import org.openqa.selenium.WebElement;\n+import org.openqa.selenium.support.FindBy;\n+import org.openqa.selenium.support.PageFactory;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.AbstractPage;\n+\n+public class AdminPage extends AbstractPage {\n+\tpublic static final String RELATIVE_URL = \"admin/\";\n+\n+\t@FindBy(tagName=\"body\")\n+\tprivate WebElement body;", "originalCommit": "3974e3e9281541c31fc0f6165032ab58b516ddae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTA2MzA1MQ==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r431063051", "bodyText": "In your integration test page only do comparisons, it should know nothing about the structure of the page - do that on your page object. \u00a0For example here you would maybe ask the page object if the admin panel button is present.", "author": "joshsadam", "createdAt": "2020-05-27T12:00:58Z", "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/admin/AdminPageIT.java", "diffHunk": "@@ -0,0 +1,45 @@\n+package ca.corefacility.bioinformatics.irida.ria.integration.admin;\n+\n+import org.junit.Test;\n+import org.openqa.selenium.By;\n+import org.springframework.test.context.ActiveProfiles;\n+\n+import ca.corefacility.bioinformatics.irida.ria.integration.AbstractIridaUIITChromeDriver;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.LoginPage;\n+import ca.corefacility.bioinformatics.irida.ria.integration.pages.admin.AdminPage;\n+\n+import com.github.springtestdbunit.annotation.DatabaseSetup;\n+\n+import static junit.framework.TestCase.assertFalse;\n+import static org.junit.Assert.assertTrue;\n+\n+@ActiveProfiles(\"it\")\n+@DatabaseSetup(\"/ca/corefacility/bioinformatics/irida/ria/web/admin/AdminPageView.xml\")\n+public class AdminPageIT extends AbstractIridaUIITChromeDriver {\n+\n+\t@Test\n+\tpublic void accessPageAsAdmin() {\n+\t\tLoginPage.loginAsAdmin(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertTrue(\"Page title should be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void accessPageFailure() {\n+\t\tLoginPage.loginAsUser(driver());\n+\t\tAdminPage page = AdminPage.initPage(driver());\n+\t\tassertFalse(\"Page title should not be present\", page.comparePageTitle(\"FUBAR - YOU MADE IT\"));\n+\t}\n+\n+\t@Test\n+\tpublic void adminButtonVisible() {\n+\t\tLoginPage.loginAsAdmin(driver());\n+\t\tassertTrue(\"Admin Button should be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0);\n+\t}\n+\n+\t@Test\n+\tpublic void adminButtonNotVisible() {\n+\t\tLoginPage.loginAsUser(driver());\n+\t\tassertFalse(\"Admin Button should not be displayed\", driver().findElements(By.id(\"admin-panel-btn\")).size() > 0);", "originalCommit": "3974e3e9281541c31fc0f6165032ab58b516ddae", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "58203fa62efba295f5ba528ce1ffe113140589d6", "url": "https://github.com/phac-nml/irida/commit/58203fa62efba295f5ba528ce1ffe113140589d6", "message": "Changed admin panel button testing structure", "committedDate": "2020-05-27T18:07:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1NjI1Mw==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r431356253", "bodyText": "I am sure you see this waitForTime sprinkled all over, it is a terrible, horrible bad thing that I created and am trying to get rid of.  The reason it is bad, is no matter what happens it must wait for 500ms. One of these is not bad, but have them everywhere really slows down the tests.  A better way here would be:\nWebDriverWait wait = new WebDriverWait(driver, 2);\nwait.until(ExpectedConditions.urlContains(\"/admin\"));", "author": "joshsadam", "createdAt": "2020-05-27T18:29:53Z", "path": "src/test/java/ca/corefacility/bioinformatics/irida/ria/integration/pages/admin/AdminPage.java", "diffHunk": "@@ -28,14 +29,42 @@ public static AdminPage initPage(WebDriver driver) {\n \t}\n \n \t/**\n-\t * Compares the expected page title to the actual page title.\n+\t * Navigate to the admin panel page on path 'admin/'.\n+\t *\n+\t * @param driver\t{@Link WebDriver}\n+\t */\n+\tpublic void goToAdminPage(WebDriver driver) {\n+\t\tget(driver, ADMIN_RELATIVE_URL);\n+\t}\n+\n+\t/**\n+\t *  Determines if admin panel title is\n+\t *  visible on the admin panel page.\n \t *\n \t * @return {@link Boolean}\n \t */\n-\tpublic boolean comparePageTitle(String pageTitle) {\n-\t\tint titleFound = body.findElements(By.xpath(\"//h1[contains(text(),'\" + pageTitle + \"')]\"))\n-\t\t\t\t.size();\n+\tpublic boolean adminPanelTitleVisible() {\n+\t\treturn driver.findElements(By.id(\"t-admin-panel-title\"))\n+\t\t\t\t.size() == 1;\n+\t}\n \n-\t\treturn titleFound > 0;\n+\t/**\n+\t *  Determines if admin panel button is\n+\t *  visible on the navbar.\n+\t *\n+\t * @return {@link Boolean}\n+\t */\n+\tpublic boolean adminPanelButtonVisible() {\n+\t\treturn driver.findElements(By.id(\"t-admin-panel-btn\"))\n+\t\t\t\t.size() == 1;\n+\t}\n+\n+\t/**\n+\t *  Clicks on the admin panel button to navigate\n+\t *  to the admin panel page.\n+\t */\n+\tpublic void clickAdminButton() {\n+\t\tadminPanelBtn.click();\n+\t\twaitForTime(500);", "originalCommit": "58203fa62efba295f5ba528ce1ffe113140589d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1ODg0MA==", "url": "https://github.com/phac-nml/irida/pull/710#discussion_r431358840", "bodyText": "Okay sounds good, I will add that instead", "author": "paulowenbrown", "createdAt": "2020-05-27T18:34:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTM1NjI1Mw=="}], "type": "inlineReview"}, {"oid": "4a6347d228592165dcf7b3f0efce83fbc58cf217", "url": "https://github.com/phac-nml/irida/commit/4a6347d228592165dcf7b3f0efce83fbc58cf217", "message": "Changed admin panel tests to use classes and WebElement lists, also changed wait function used", "committedDate": "2020-05-27T18:45:15Z", "type": "commit"}, {"oid": "8b168df8ebd408a06b58d6a2adeb5a6348f872df", "url": "https://github.com/phac-nml/irida/commit/8b168df8ebd408a06b58d6a2adeb5a6348f872df", "message": "Added admin panel title to message.properties", "committedDate": "2020-05-27T19:15:27Z", "type": "commit"}, {"oid": "17e83f7fa1c746308e0889850f1d2207cb478a1d", "url": "https://github.com/phac-nml/irida/commit/17e83f7fa1c746308e0889850f1d2207cb478a1d", "message": "Added admin panel title to title tag", "committedDate": "2020-05-27T19:19:01Z", "type": "commit"}]}