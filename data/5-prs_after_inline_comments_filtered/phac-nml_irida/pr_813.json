{"pr_number": 813, "pr_title": "Cart server refactor", "pr_createdAt": "2020-10-01T12:25:51Z", "pr_url": "https://github.com/phac-nml/irida/pull/813", "timeline": [{"oid": "3aa87b6a27e737d3ae3885e140c79ae3647b8d54", "url": "https://github.com/phac-nml/irida/commit/3aa87b6a27e737d3ae3885e140c79ae3647b8d54", "message": ":construction: Working on new cart api", "committedDate": "2020-09-30T14:29:51Z", "type": "commit"}, {"oid": "c759769055b1263f006ac8771cbefe269be37e6e", "url": "https://github.com/phac-nml/irida/commit/c759769055b1263f006ac8771cbefe269be37e6e", "message": ":construction: Updated adding samples to cart", "committedDate": "2020-09-30T17:52:03Z", "type": "commit"}, {"oid": "5a5efa04d126c467a94dbe2019f36047e429542a", "url": "https://github.com/phac-nml/irida/commit/5a5efa04d126c467a94dbe2019f36047e429542a", "message": ":construction: Cleaning up the CartController", "committedDate": "2020-10-01T11:38:34Z", "type": "commit"}, {"oid": "ad5d3a6dd970d7a448814783345f97baabd34ea9", "url": "https://github.com/phac-nml/irida/commit/ad5d3a6dd970d7a448814783345f97baabd34ea9", "message": "\ud83d\udea7 Working on fixing changes after new cart", "committedDate": "2020-10-01T15:22:36Z", "type": "commit"}, {"oid": "32b7c81648c35568968acb8b14576d7c80f06eec", "url": "https://github.com/phac-nml/irida/commit/32b7c81648c35568968acb8b14576d7c80f06eec", "message": ":construction: Cleaned up server response\n\nPreviously we were sending the project info with every sample.  This is a lot of wasted data.  Not the response is frame in terms of project, and those contain their own samples.", "committedDate": "2020-10-02T13:12:47Z", "type": "commit"}, {"oid": "c8af55bd9ff2aeb9d5b889619a44a74087180b3f", "url": "https://github.com/phac-nml/irida/commit/c8af55bd9ff2aeb9d5b889619a44a74087180b3f", "message": "Updated JavaDoc", "committedDate": "2020-10-05T14:02:47Z", "type": "commit"}, {"oid": "0c1fd2189ec85347b5806fd6463911e8f2ea7ad9", "url": "https://github.com/phac-nml/irida/commit/0c1fd2189ec85347b5806fd6463911e8f2ea7ad9", "message": "Updated JavaDoc", "committedDate": "2020-10-05T14:09:57Z", "type": "commit"}, {"oid": "57091b32d51a02091b5bf6e9a6ffb36aae1dae03", "url": "https://github.com/phac-nml/irida/commit/57091b32d51a02091b5bf6e9a6ffb36aae1dae03", "message": "Fix galaxy code", "committedDate": "2020-10-05T16:54:27Z", "type": "commit"}, {"oid": "e8689afbcd74a10d59a9d4bb83ff3c9a216f1f91", "url": "https://github.com/phac-nml/irida/commit/e8689afbcd74a10d59a9d4bb83ff3c9a216f1f91", "message": "Updated JavaDoc", "committedDate": "2020-10-05T18:19:12Z", "type": "commit"}, {"oid": "ba0e3a9e18d90522d8e6ae429ebcd269160bae13", "url": "https://github.com/phac-nml/irida/commit/ba0e3a9e18d90522d8e6ae429ebcd269160bae13", "message": "This version of the cart is no longer used", "committedDate": "2020-10-06T09:58:20Z", "type": "commit"}, {"oid": "a3a4e92edfa90f274ba499dfd31e3f7755dbec72", "url": "https://github.com/phac-nml/irida/commit/a3a4e92edfa90f274ba499dfd31e3f7755dbec72", "message": "Updated JavaDoc", "committedDate": "2020-10-06T11:27:46Z", "type": "commit"}, {"oid": "29a5c75c779d396581719102e4d29e633db3acef", "url": "https://github.com/phac-nml/irida/commit/29a5c75c779d396581719102e4d29e633db3acef", "message": "Updated JavaDoc", "committedDate": "2020-10-06T11:55:08Z", "type": "commit"}, {"oid": "62fce0f9a7eabe343cecf0451be520a302280f53", "url": "https://github.com/phac-nml/irida/commit/62fce0f9a7eabe343cecf0451be520a302280f53", "message": "Updated JavaDoc", "committedDate": "2020-10-06T11:59:29Z", "type": "commit"}, {"oid": "57a26578621738f7bc555da2cf24938b0d83a65c", "url": "https://github.com/phac-nml/irida/commit/57a26578621738f7bc555da2cf24938b0d83a65c", "message": "Merge branch 'development' into cart-server-refactor", "committedDate": "2020-10-06T12:03:44Z", "type": "commit"}, {"oid": "5bae1fae4f5489fe5b24d321815e4e894f568ec1", "url": "https://github.com/phac-nml/irida/commit/5bae1fae4f5489fe5b24d321815e4e894f568ec1", "message": "Updated CHANGELOG", "committedDate": "2020-10-06T12:05:27Z", "type": "commit"}, {"oid": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "url": "https://github.com/phac-nml/irida/commit/f58611dcacf9ee48b8662e993144b6ecaa79ef88", "message": "CartGalaxyController does not need to be session scoped any more", "committedDate": "2020-10-06T12:56:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMDM1Mg==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500410352", "bodyText": "Should be Get the samples", "author": "deepsidhu85", "createdAt": "2020-10-06T15:52:05Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/CartAjaxController.java", "diffHunk": "@@ -0,0 +1,99 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax;\n+\n+import java.util.List;\n+import java.util.Set;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.web.bind.annotation.*;\n+\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UICartService;\n+\n+/**\n+ * AJAX controller for cart functionality\n+ */\n+@RestController\n+@RequestMapping(\"/ajax/cart\")\n+public class CartAjaxController {\n+\tprivate final UICartService service;\n+\n+\t@Autowired\n+\tpublic CartAjaxController(UICartService service) {\n+\t\tthis.service = service;\n+\t}\n+\n+\t/**\n+\t * Add a set of samples to the cart from a particular project\n+\t *\n+\t * @param request Request to add sample to the cart\n+\t * @return the number of samples currrently in the cart\n+\t */\n+\t@PostMapping(\"\")\n+\tpublic ResponseEntity<Integer> addSamplesToCart(@RequestBody AddToCartRequest request) {\n+\t\treturn ResponseEntity.ok(service.addSamplesToCart(request));\n+\t}\n+\n+\t/**\n+\t * Get the number of samples from all projects that are currently in the cart\n+\t *\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@GetMapping(\"/count\")\n+\tpublic ResponseEntity<Integer> getNumberOfSamplesInCart() {\n+\t\treturn ResponseEntity.ok(service.getNumberOfSamplesInCart());\n+\t}\n+\n+\t/**\n+\t * Remove a sample from the cart\n+\t *\n+\t * @param request Request to move a sample from the cart\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@DeleteMapping(\"/sample\")\n+\tpublic ResponseEntity<Integer> removeSample(@RequestBody RemoveSampleRequest request) {\n+\t\treturn ResponseEntity.ok(service.removeSample(request));\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart\n+\t *\n+\t * @param id for a project\n+\t * @return the number of samples currently in the cart\n+\t */\n+\t@DeleteMapping(\"/project\")\n+\tpublic ResponseEntity<Integer> removeProject(@RequestParam Long id) {\n+\t\treturn ResponseEntity.ok(service.removeProject(id));\n+\t}\n+\n+\t/**\n+\t * Completely empty the cart\n+\t */\n+\t@DeleteMapping(\"\")\n+\tpublic void emptyCart() {\n+\t\tservice.emptyCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of project identifiers for projects that have samples in the cart.\n+\t *\n+\t * @return list of project identifiers\n+\t */\n+\t@GetMapping(\"/ids\")\n+\tpublic ResponseEntity<Set<Long>> getProjectIdsInCart() {\n+\t\treturn ResponseEntity.ok(service.getProjectIdsInCart());\n+\t}\n+\n+\t/**\n+\t * Cart the samples that are in the cart for a specific project", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1NjkwMQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500456901", "bodyText": "Fixed in 7ff3cc6", "author": "joshsadam", "createdAt": "2020-10-06T17:02:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQxMDM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTAxNQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500435015", "bodyText": "As this is a model for the UI rename it to CartProjectModel", "author": "deepsidhu85", "createdAt": "2020-10-06T16:28:20Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/ajax/dto/cart/CartProject.java", "diffHunk": "@@ -0,0 +1,35 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart;\n+\n+import java.util.List;\n+\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+\n+/**\n+ * Model for UI to represent a project and its sample within the cart.\n+ */\n+public class CartProject {", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1ODg0OA==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500458848", "bodyText": "Updated in 3550032", "author": "joshsadam", "createdAt": "2020-10-06T17:05:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTg3NQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500435875", "bodyText": "Remove the final", "author": "deepsidhu85", "createdAt": "2020-10-06T16:29:41Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartController.java", "diffHunk": "@@ -1,49 +1,32 @@\n package ca.corefacility.bioinformatics.irida.ria.web.cart;\n \n-import ca.corefacility.bioinformatics.irida.model.project.Project;\n-import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.components.Cart;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.*;\n-import ca.corefacility.bioinformatics.irida.ria.web.oauth.GalaxyRedirectionEndpointController;\n-import ca.corefacility.bioinformatics.irida.service.ProjectService;\n-import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n import org.springframework.beans.factory.annotation.Autowired;\n import org.springframework.beans.factory.annotation.Qualifier;\n import org.springframework.beans.factory.annotation.Value;\n-import org.springframework.context.annotation.Scope;\n import org.springframework.http.MediaType;\n import org.springframework.stereotype.Controller;\n import org.springframework.ui.Model;\n-import org.springframework.web.bind.annotation.*;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestParam;\n \n-import java.util.*;\n+import ca.corefacility.bioinformatics.irida.ria.web.oauth.GalaxyRedirectionEndpointController;\n \n /**\n  * Controller managing interactions with the selected sequences\n  */\n @Controller\n-@Scope(\"session\")\n @RequestMapping(\"/cart\")\n public class CartController {\n-\tprivate Cart cart;\n-\n-\tprivate final SampleService sampleService;\n-\tprivate final ProjectService projectService;\n-\n \t@Value(\"${server.base.url}\")\n \tprivate String serverBaseUrl;\n \t/*\n \t * Additional variables\n \t */\n-\tprivate String iridaPipelinePluginStyle;\n+\tprivate final String iridaPipelinePluginStyle;", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTU0MA==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500459540", "bodyText": "Updated in 720b1f6", "author": "joshsadam", "createdAt": "2020-10-06T17:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNTg3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNzU5MQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500437591", "bodyText": "Remove the final from the variables", "author": "deepsidhu85", "createdAt": "2020-10-06T16:32:14Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "diffHunk": "@@ -12,27 +13,26 @@\n import org.springframework.web.bind.annotation.RequestMapping;\n import org.springframework.web.bind.annotation.RestController;\n \n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n import ca.corefacility.bioinformatics.irida.ria.config.GalaxySessionInterceptor;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.components.Cart;\n-import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.CartSample;\n import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.GalaxyExportSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.services.UICartService;\n import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n \n /**\n  * Controller to handle all ajax requests made to the cart that have to do with Galaxy.\n  */\n @RestController\n-@Scope(\"session\")\n @RequestMapping(\"/ajax/galaxy-export\")\n public class CartGalaxyController {\n-\tprivate SampleService sampleService;\n-\tprivate Cart cart;\n+\tprivate final SampleService sampleService;", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ1OTk1Ng==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500459956", "bodyText": "Updated in 0019e23", "author": "joshsadam", "createdAt": "2020-10-06T17:07:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzNzU5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQzODE1NA==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500438154", "bodyText": "Might need to apply the irida intellij styling to this method", "author": "deepsidhu85", "createdAt": "2020-10-06T16:33:03Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/cart/CartGalaxyController.java", "diffHunk": "@@ -41,14 +41,9 @@ public CartGalaxyController(SampleService sampleService, Cart cart) {\n \t */\n \t@RequestMapping(\"/samples\")\n \tpublic List<GalaxyExportSample> getGalaxyExportForm() {\n-\t\tMap<Long, Map<Long, CartSample>> contents = cart.get();\n-\t\tList<GalaxyExportSample> result = new ArrayList<>();\n-\t\tfor (Long projectId : contents.keySet()) {\n-\t\t\tIterable<Sample> samples = sampleService.readMultiple(contents.get(projectId)\n-\t\t\t\t\t.keySet());\n-\t\t\tsamples.forEach(s -> result.add(new GalaxyExportSample(s, projectId)));\n-\t\t}\n-\t\treturn result;\n+\t\tMap<Project, List<Sample>> contents = cartService.getFullCart();", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDI5Mw==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500440293", "bodyText": "Remove the final from the variables", "author": "deepsidhu85", "createdAt": "2020-10-06T16:36:20Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "diffHunk": "@@ -83,45 +83,41 @@\n \t/*\n \t * SERVICES\n \t */\n-\tprivate ReferenceFileService referenceFileService;\n-\tprivate SequencingObjectService sequencingObjectService;\n-\tprivate AnalysisSubmissionService analysisSubmissionService;\n-\tprivate ProjectService projectService;\n-\tprivate UserService userService;\n-\tprivate IridaWorkflowsService workflowsService;\n-\tprivate MessageSource messageSource;\n+\tprivate final ReferenceFileService referenceFileService;", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDYzNQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500440635", "bodyText": "Remove final", "author": "deepsidhu85", "createdAt": "2020-10-06T16:36:53Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/pipelines/PipelineController.java", "diffHunk": "@@ -83,45 +83,41 @@\n \t/*\n \t * SERVICES\n \t */\n-\tprivate ReferenceFileService referenceFileService;\n-\tprivate SequencingObjectService sequencingObjectService;\n-\tprivate AnalysisSubmissionService analysisSubmissionService;\n-\tprivate ProjectService projectService;\n-\tprivate UserService userService;\n-\tprivate IridaWorkflowsService workflowsService;\n-\tprivate MessageSource messageSource;\n+\tprivate final ReferenceFileService referenceFileService;\n+\tprivate final SequencingObjectService sequencingObjectService;\n+\tprivate final AnalysisSubmissionService analysisSubmissionService;\n+\tprivate final ProjectService projectService;\n+\tprivate final UserService userService;\n+\tprivate final IridaWorkflowsService workflowsService;\n+\tprivate final MessageSource messageSource;\n \tprivate final WorkflowNamedParametersService namedParameterService;\n-\tprivate UpdateSamplePermission updateSamplePermission;\n-\tprivate AnalysisSubmissionSampleProcessor analysisSubmissionSampleProcessor;\n-\tprivate GalaxyToolDataService galaxyToolDataService;\n-\tprivate EmailController emailController;\n-\n-\t/*\n-\t * CONTROLLERS\n-\t */\n-\tprivate CartController cartController;\n+\tprivate final UpdateSamplePermission updateSamplePermission;\n+\tprivate final AnalysisSubmissionSampleProcessor analysisSubmissionSampleProcessor;\n+\tprivate final GalaxyToolDataService galaxyToolDataService;\n+\tprivate final EmailController emailController;\n+\tprivate final UICartService cartService;\n \n \t@Autowired\n \tpublic PipelineController(SequencingObjectService sequencingObjectService,\n \t\t\tReferenceFileService referenceFileService, AnalysisSubmissionService analysisSubmissionService,\n \t\t\tIridaWorkflowsService iridaWorkflowsService, ProjectService projectService, UserService userService,\n-\t\t\tCartController cartController, MessageSource messageSource,\n+\t\t\tMessageSource messageSource,\n \t\t\tfinal WorkflowNamedParametersService namedParameterService, UpdateSamplePermission updateSamplePermission,", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MTY3NQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500461675", "bodyText": "This is an old relic, I cannot remember you used to like that. \u00a0Removed in 746b003", "author": "joshsadam", "createdAt": "2020-10-06T17:10:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MDYzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MzU3Nw==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500443577", "bodyText": "What do you think about changing wherever you have Map<Project, List<Sample>> here and any of the above files to a dto which contains those objects?", "author": "deepsidhu85", "createdAt": "2020-10-06T16:41:26Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java", "diffHunk": "@@ -0,0 +1,126 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.util.*;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.stereotype.Component;\n+\n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n+import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.CartSample;\n+import ca.corefacility.bioinformatics.irida.ria.web.ajax.dto.cart.CartProject;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.AddToCartRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.cart.dto.RemoveSampleRequest;\n+import ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs.Cart;\n+import ca.corefacility.bioinformatics.irida.service.ProjectService;\n+import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n+\n+/**\n+ * Service for handling all aspects interaction with the Cart.\n+ */\n+@Component\n+public class UICartService {\n+\tprivate final Cart cart;\n+\tprivate final ProjectService projectService;\n+\tprivate final SampleService sampleService;\n+\n+\t@Autowired\n+\tpublic UICartService(Cart cart, ProjectService projectService, SampleService sampleService) {\n+\t\tthis.cart = cart;\n+\t\tthis.projectService = projectService;\n+\t\tthis.sampleService = sampleService;\n+\t}\n+\n+\t/**\n+\t * Add samples from a project to the cart.\n+\t *\n+\t * @param request Information about the project and samples to add to the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int addSamplesToCart(AddToCartRequest request) {\n+\t\treturn cart.add(request.getProjectId(), (List<Long>) request.getSampleIds());\n+\t}\n+\n+\t/**\n+\t * Get the number of samples in the cart\n+\t *\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int getNumberOfSamplesInCart() {\n+\t\treturn cart.getNumberOfSamplesInCart();\n+\t}\n+\n+\t/**\n+\t * Remove all samples from the cart\n+\t */\n+\tpublic void emptyCart() {\n+\t\tcart.clear();\n+\t}\n+\n+\t/**\n+\t * Remove a specific sample from the cart.\n+\t *\n+\t * @param request Information about the samplet o remove from the cart\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeSample(RemoveSampleRequest request) {\n+\t\treturn cart.removeSample(request.getProjectId(), request.getSampleId());\n+\t}\n+\n+\t/**\n+\t * Remove all samples from a specific project from the cart.\n+\t *\n+\t * @param id identifier for the project to remove from the cart.\n+\t * @return number of total samples in the cart\n+\t */\n+\tpublic int removeProject(Long id) {\n+\t\treturn cart.removeProject(id);\n+\t}\n+\n+\t/**\n+\t * Get a set of  identifiers for {@link Project}s in the cart\n+\t *\n+\t * @return {@link Set} of {@link Project} identifiers\n+\t */\n+\tpublic Set<Long> getProjectIdsInCart() {\n+\t\treturn cart.getProjectIdsInCart();\n+\t}\n+\n+\t/**\n+\t * Get a list of sample in the cart belonging to a list of projects\n+\t *\n+\t * @param ids List of identifiers for project to get the samples for.\n+\t * @return {@link List} of {@link CartProject}s containing project and sample information for items in the cart.\n+\t */\n+\tpublic List<CartProject> getSamplesForProjects(List<Long> ids) {\n+\t\tList<Project> projects = (List<Project>) projectService.readMultiple(ids);\n+\t\tList<CartProject> cartProjects = new ArrayList<>();\n+\t\tfor (Project project : projects) {\n+\t\t\tCartProject cartProject = new CartProject(project.getId(), project.getLabel());\n+\t\t\tList<CartSample> samples = new ArrayList<>();\n+\t\t\tsampleService.readMultiple(cart.getCartSampleIdsForProject(project.getId()))\n+\t\t\t\t\t.forEach(sample -> {\n+\t\t\t\t\t\tsamples.add(new CartSample(sample));\n+\t\t\t\t\t});\n+\t\t\tcartProject.setSamples(samples);\n+\t\t\tcartProjects.add(cartProject);\n+\t\t}\n+\t\treturn cartProjects;\n+\t}\n+\n+\t/**\n+\t * Get the entire cart flushed out into {@link Project}s with their {@link Sample}s\n+\t *\n+\t * @return All proejcts and samples in the part\n+\t */\n+\tpublic Map<Project, List<Sample>> getFullCart() {", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MDk4NQ==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500460985", "bodyText": "I left these calls pretty much as they were previous so to not have to refactor too much of the UI calls that are older. \u00a0As those get updated we can move these to DTOs. \u00a0I think this in particular is a galaxy call.", "author": "joshsadam", "createdAt": "2020-10-06T17:09:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MzU3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDUwMTgyMw==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500501823", "bodyText": "Sounds good!", "author": "deepsidhu85", "createdAt": "2020-10-06T18:15:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0MzU3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NDg0MA==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500444840", "bodyText": "Method comment", "author": "deepsidhu85", "createdAt": "2020-10-06T16:43:24Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java", "diffHunk": "@@ -0,0 +1,73 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.sessionAttrs;\n+\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.List;\n+import java.util.Set;\n+\n+/**\n+ * Session object to hold samples that are currently in the cart.\n+ */\n+public class Cart extends HashMap<Long, HashSet<Long>> {\n+\n+\tpublic int add(Long projectId, List<Long> sampleIds) {", "originalCommit": "f58611dcacf9ee48b8662e993144b6ecaa79ef88", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ2MjcyOA==", "url": "https://github.com/phac-nml/irida/pull/813#discussion_r500462728", "bodyText": "Added in ff327b3", "author": "joshsadam", "createdAt": "2020-10-06T17:12:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDQ0NDg0MA=="}], "type": "inlineReview"}, {"oid": "7ff3cc60b7ad101a19b06bf2ea94e6e007a93528", "url": "https://github.com/phac-nml/irida/commit/7ff3cc60b7ad101a19b06bf2ea94e6e007a93528", "message": "\ud83d\udcddFixed typo", "committedDate": "2020-10-06T17:01:17Z", "type": "commit"}, {"oid": "413e19783ef142068ca7a6d5a36c8bcfd9d03ce6", "url": "https://github.com/phac-nml/irida/commit/413e19783ef142068ca7a6d5a36c8bcfd9d03ce6", "message": "\ud83d\udcdd Fixed grammar in CHANGELOG.md", "committedDate": "2020-10-06T17:03:19Z", "type": "commit"}, {"oid": "355003282dbbbbf2cc92247eb2a8b80b5b121a5f", "url": "https://github.com/phac-nml/irida/commit/355003282dbbbbf2cc92247eb2a8b80b5b121a5f", "message": "\ud83d\udea7 Updated CartProject to CartProjectModel", "committedDate": "2020-10-06T17:05:01Z", "type": "commit"}, {"oid": "37d24d4e0a1663bbf1ae171af0c98c390adef69a", "url": "https://github.com/phac-nml/irida/commit/37d24d4e0a1663bbf1ae171af0c98c390adef69a", "message": "\ud83d\udea7 Updated CartSample to CartSampleModel", "committedDate": "2020-10-06T17:05:37Z", "type": "commit"}, {"oid": "720b1f646043b2d45e37716fa49ddeb822744838", "url": "https://github.com/phac-nml/irida/commit/720b1f646043b2d45e37716fa49ddeb822744838", "message": "\ud83d\udea7 Does not need to be final", "committedDate": "2020-10-06T17:06:42Z", "type": "commit"}, {"oid": "0019e2334d708eab552b72a2f9e3acea265c71c3", "url": "https://github.com/phac-nml/irida/commit/0019e2334d708eab552b72a2f9e3acea265c71c3", "message": "\ud83d\udea7 Services do not need to be final", "committedDate": "2020-10-06T17:07:21Z", "type": "commit"}, {"oid": "746b003e81aa0d6e9e5f6b072670b1c231c0d8fc", "url": "https://github.com/phac-nml/irida/commit/746b003e81aa0d6e9e5f6b072670b1c231c0d8fc", "message": "\ud83d\udea7 Remove final from constructor call", "committedDate": "2020-10-06T17:10:12Z", "type": "commit"}, {"oid": "ff327b3dfaf6c5db4002fe5a0c32ffbf4a7512c7", "url": "https://github.com/phac-nml/irida/commit/ff327b3dfaf6c5db4002fe5a0c32ffbf4a7512c7", "message": "\ud83d\udcdd Added JSDoc for add", "committedDate": "2020-10-06T17:11:53Z", "type": "commit"}, {"oid": "edb5a72614c8656f5bef85e0f90bce70295b0a90", "url": "https://github.com/phac-nml/irida/commit/edb5a72614c8656f5bef85e0f90bce70295b0a90", "message": "\ud83d\udcdd Added missing JSDoc for cart.js", "committedDate": "2020-10-06T17:13:48Z", "type": "commit"}, {"oid": "0b5643b1b98b4b90291a3f3834053255bbd13da7", "url": "https://github.com/phac-nml/irida/commit/0b5643b1b98b4b90291a3f3834053255bbd13da7", "message": "\ud83d\udea7 Removed logging statement in CartSamples.jsx", "committedDate": "2020-10-06T17:14:54Z", "type": "commit"}, {"oid": "82e5a94bf2cf47a92e2795d0b3966b2643609fa5", "url": "https://github.com/phac-nml/irida/commit/82e5a94bf2cf47a92e2795d0b3966b2643609fa5", "message": "Removed final variable", "committedDate": "2020-10-07T02:13:59Z", "type": "commit"}, {"oid": "f40df94f064d6b214c61a4dd3795ff6330ec33e1", "url": "https://github.com/phac-nml/irida/commit/f40df94f064d6b214c61a4dd3795ff6330ec33e1", "message": "Updated formatting", "committedDate": "2020-10-07T02:14:39Z", "type": "commit"}, {"oid": "fc1976bc5eb3845274bb847a3ceb3c02098c4819", "url": "https://github.com/phac-nml/irida/commit/fc1976bc5eb3845274bb847a3ceb3c02098c4819", "message": "Fixed broken tests to to change is response structures", "committedDate": "2020-10-07T12:32:34Z", "type": "commit"}, {"oid": "5e08daff3a097bc78106483b9d424b3b28233f5d", "url": "https://github.com/phac-nml/irida/commit/5e08daff3a097bc78106483b9d424b3b28233f5d", "message": "Merge branch 'development' into cart-server-refactor", "committedDate": "2020-10-07T12:49:34Z", "type": "commit"}]}