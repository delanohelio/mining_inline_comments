{"pr_number": 884, "pr_title": "Updated displaying sample details within the cart", "pr_createdAt": "2020-12-04T18:33:24Z", "pr_url": "https://github.com/phac-nml/irida/pull/884", "timeline": [{"oid": "df6aa4cef297f34ca792cead04cc870b7d8bee33", "url": "https://github.com/phac-nml/irida/commit/df6aa4cef297f34ca792cead04cc870b7d8bee33", "message": "Initial commit.\n\nReworking samples drawer to show full detials and files.", "committedDate": "2020-11-27T22:37:45Z", "type": "commit"}, {"oid": "e79ca06a5e9e6c594d40750aab7cd7357e8a38a8", "url": "https://github.com/phac-nml/irida/commit/e79ca06a5e9e6c594d40750aab7cd7357e8a38a8", "message": "Updating server code", "committedDate": "2020-11-28T02:16:11Z", "type": "commit"}, {"oid": "d0575ba8466e366e41ac16addd65827778bbb234", "url": "https://github.com/phac-nml/irida/commit/d0575ba8466e366e41ac16addd65827778bbb234", "message": "Working on indicating if a sample is in the cart", "committedDate": "2020-11-30T11:21:45Z", "type": "commit"}, {"oid": "3a14514fa5c3f3636229d90853ce9b26e6d06a95", "url": "https://github.com/phac-nml/irida/commit/3a14514fa5c3f3636229d90853ce9b26e6d06a95", "message": "If the sample is in the part return the project id", "committedDate": "2020-11-30T18:15:58Z", "type": "commit"}, {"oid": "7bf6c7208c66ee64f70f9a0042a4d3e6e9ca154a", "url": "https://github.com/phac-nml/irida/commit/7bf6c7208c66ee64f70f9a0042a4d3e6e9ca154a", "message": "Merge branch 'fix-adding-samples-response' into cart-sample-details\n\n# Conflicts:\n#\tsrc/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UICartService.java\n#\tsrc/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java", "committedDate": "2020-12-02T13:23:50Z", "type": "commit"}, {"oid": "4ddb09ab585e5550e0c4f20a56651ce0db9071a0", "url": "https://github.com/phac-nml/irida/commit/4ddb09ab585e5550e0c4f20a56651ce0db9071a0", "message": "Remove sample from cart", "committedDate": "2020-12-02T15:14:44Z", "type": "commit"}, {"oid": "b10a07c774a6c966c384ab4c36a237807ff71f0b", "url": "https://github.com/phac-nml/irida/commit/b10a07c774a6c966c384ab4c36a237807ff71f0b", "message": "Added button to remove sample from cart", "committedDate": "2020-12-02T15:50:04Z", "type": "commit"}, {"oid": "116617cc01c93905e5b3ee4caaa051bc84270de5", "url": "https://github.com/phac-nml/irida/commit/116617cc01c93905e5b3ee4caaa051bc84270de5", "message": "Show sample created date", "committedDate": "2020-12-02T16:56:34Z", "type": "commit"}, {"oid": "a47426736312f4753154ec7eb3fb0edd5995e9db", "url": "https://github.com/phac-nml/irida/commit/a47426736312f4753154ec7eb3fb0edd5995e9db", "message": "Working on displaying files", "committedDate": "2020-12-02T18:47:54Z", "type": "commit"}, {"oid": "1024b975289576144dfc55eb125d5cbae4d273c5", "url": "https://github.com/phac-nml/irida/commit/1024b975289576144dfc55eb125d5cbae4d273c5", "message": "Merge branch 'fix-adding-samples-response' into cart-sample-details\n\n# Conflicts:\n#\tsrc/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java\n#\tsrc/main/webapp/resources/js/apis/cart/cart.js", "committedDate": "2020-12-03T18:37:36Z", "type": "commit"}, {"oid": "a04dca53c96534024584088cf9fc5222ff5a7934", "url": "https://github.com/phac-nml/irida/commit/a04dca53c96534024584088cf9fc5222ff5a7934", "message": "Manually adding each file type", "committedDate": "2020-12-03T18:59:16Z", "type": "commit"}, {"oid": "58c0dab99d7ccdd6014d0932c6f6dc30e6c6d257", "url": "https://github.com/phac-nml/irida/commit/58c0dab99d7ccdd6014d0932c6f6dc30e6c6d257", "message": "Layout", "committedDate": "2020-12-03T19:27:40Z", "type": "commit"}, {"oid": "81eff7e7c9b1e735e191cf9325695fa8e1bb6da6", "url": "https://github.com/phac-nml/irida/commit/81eff7e7c9b1e735e191cf9325695fa8e1bb6da6", "message": "Merge branch 'development' into cart-sample-details", "committedDate": "2020-12-04T16:50:12Z", "type": "commit"}, {"oid": "60040c115bd63f8ec060e5c1924fbf70920286f0", "url": "https://github.com/phac-nml/irida/commit/60040c115bd63f8ec060e5c1924fbf70920286f0", "message": "Merge branch 'fix-adding-samples-response' into cart-sample-details", "committedDate": "2020-12-04T16:50:24Z", "type": "commit"}, {"oid": "34e57e85afb933a3e37e6a05ed55cbd662c3c07b", "url": "https://github.com/phac-nml/irida/commit/34e57e85afb933a3e37e6a05ed55cbd662c3c07b", "message": "Removed old dead code", "committedDate": "2020-12-04T17:41:53Z", "type": "commit"}, {"oid": "be84f7a4fdff99ae22c4f4960227f199a0bd1aba", "url": "https://github.com/phac-nml/irida/commit/be84f7a4fdff99ae22c4f4960227f199a0bd1aba", "message": "Merge branch 'fix-adding-samples-response' into cart-sample-details", "committedDate": "2020-12-04T19:02:33Z", "type": "commit"}, {"oid": "850ee6372e25c6cc961866b4999e4b98bb21dd27", "url": "https://github.com/phac-nml/irida/commit/850ee6372e25c6cc961866b4999e4b98bb21dd27", "message": "Only show the types of files that the sample actually has.", "committedDate": "2020-12-04T19:36:18Z", "type": "commit"}, {"oid": "78ece14f9df6e17e20fb44b55867b57577350ba1", "url": "https://github.com/phac-nml/irida/commit/78ece14f9df6e17e20fb44b55867b57577350ba1", "message": "Cleaned up ajax requests", "committedDate": "2020-12-07T15:05:54Z", "type": "commit"}, {"oid": "00562c980aef586af52ab38fa80732e434c1c8f2", "url": "https://github.com/phac-nml/irida/commit/00562c980aef586af52ab38fa80732e434c1c8f2", "message": "Merge branch 'development' into cart-sample-details", "committedDate": "2020-12-07T15:06:10Z", "type": "commit"}, {"oid": "2dc665d14429f74c7cc876544b02090a6c51e8a7", "url": "https://github.com/phac-nml/irida/commit/2dc665d14429f74c7cc876544b02090a6c51e8a7", "message": "Updated CHANGELOG.md", "committedDate": "2020-12-07T15:13:45Z", "type": "commit"}, {"oid": "707a58fa468ef4df2dca50518c113513c56a895c", "url": "https://github.com/phac-nml/irida/commit/707a58fa468ef4df2dca50518c113513c56a895c", "message": "Fixed JavaDoc", "committedDate": "2020-12-07T18:16:13Z", "type": "commit"}, {"oid": "9f654ce7d7f485b96fe9f49f2a5c6f7a2e3244ad", "url": "https://github.com/phac-nml/irida/commit/9f654ce7d7f485b96fe9f49f2a5c6f7a2e3244ad", "message": "Removed dependency on redux", "committedDate": "2020-12-07T23:17:49Z", "type": "commit"}, {"oid": "66f62d2e73c1e34a36ae6c71946a070145c2b001", "url": "https://github.com/phac-nml/irida/commit/66f62d2e73c1e34a36ae6c71946a070145c2b001", "message": "Fields never get modified so can be final", "committedDate": "2020-12-08T15:33:50Z", "type": "commit"}, {"oid": "d55944470ac66cd826374f3011266d16af247d5a", "url": "https://github.com/phac-nml/irida/commit/d55944470ac66cd826374f3011266d16af247d5a", "message": "Added missing JavaDoc", "committedDate": "2020-12-08T15:35:18Z", "type": "commit"}, {"oid": "b831e3ce9f9d6148f748329d9bbab8bf3461e90b", "url": "https://github.com/phac-nml/irida/commit/b831e3ce9f9d6148f748329d9bbab8bf3461e90b", "message": "Merge branch 'development' into cart-sample-details\n\n# Conflicts:\n#\tCHANGELOG.md", "committedDate": "2020-12-10T13:20:25Z", "type": "commit"}, {"oid": "b460ee9da5dd2a349d9c7c86a86a548ef60ee5ac", "url": "https://github.com/phac-nml/irida/commit/b460ee9da5dd2a349d9c7c86a86a548ef60ee5ac", "message": "Updated JavaDoc", "committedDate": "2020-12-10T17:30:47Z", "type": "commit"}, {"oid": "3d8aa57bb814be90cdcbf707338f373ac6a7a44d", "url": "https://github.com/phac-nml/irida/commit/3d8aa57bb814be90cdcbf707338f373ac6a7a44d", "message": "Fixed missing imports", "committedDate": "2020-12-10T17:59:14Z", "type": "commit"}, {"oid": "300a258d14313dfc60402a7e5afc1a208a5e094a", "url": "https://github.com/phac-nml/irida/commit/300a258d14313dfc60402a7e5afc1a208a5e094a", "message": "Switching to a modal", "committedDate": "2020-12-10T22:16:11Z", "type": "commit"}, {"oid": "972ac84be46b54d0e84705fb5fcaca5a5c629eac", "url": "https://github.com/phac-nml/irida/commit/972ac84be46b54d0e84705fb5fcaca5a5c629eac", "message": "Updated to use a Modal instead of Drawer", "committedDate": "2020-12-11T13:31:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAyNzgyNA==", "url": "https://github.com/phac-nml/irida/pull/884#discussion_r541027824", "bodyText": "Fast5 data also has qc files associated with it. So I think there should be a section here which sets the enhanceQCEntries for it", "author": "deepsidhu85", "createdAt": "2020-12-11T15:28:14Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/services/UISampleService.java", "diffHunk": "@@ -0,0 +1,138 @@\n+package ca.corefacility.bioinformatics.irida.ria.web.services;\n+\n+import java.util.*;\n+import java.util.stream.Collectors;\n+\n+import org.springframework.beans.factory.annotation.Autowired;\n+import org.springframework.security.core.Authentication;\n+import org.springframework.security.core.context.SecurityContextHolder;\n+import org.springframework.stereotype.Component;\n+\n+import ca.corefacility.bioinformatics.irida.model.assembly.GenomeAssembly;\n+import ca.corefacility.bioinformatics.irida.model.joins.impl.SampleGenomeAssemblyJoin;\n+import ca.corefacility.bioinformatics.irida.model.project.Project;\n+import ca.corefacility.bioinformatics.irida.model.sample.QCEntry;\n+import ca.corefacility.bioinformatics.irida.model.sample.Sample;\n+import ca.corefacility.bioinformatics.irida.model.sample.SampleSequencingObjectJoin;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.Fast5Object;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequenceFilePair;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SequencingObject;\n+import ca.corefacility.bioinformatics.irida.model.sequenceFile.SingleEndSequenceFile;\n+import ca.corefacility.bioinformatics.irida.ria.web.samples.dto.SampleDetails;\n+import ca.corefacility.bioinformatics.irida.ria.web.samples.dto.SampleFiles;\n+import ca.corefacility.bioinformatics.irida.security.permissions.sample.UpdateSamplePermission;\n+import ca.corefacility.bioinformatics.irida.service.GenomeAssemblyService;\n+import ca.corefacility.bioinformatics.irida.service.ProjectService;\n+import ca.corefacility.bioinformatics.irida.service.SequencingObjectService;\n+import ca.corefacility.bioinformatics.irida.service.sample.SampleService;\n+\n+/**\n+ * UI Service for samples\n+ */\n+@Component\n+public class UISampleService {\n+\tprivate final SampleService sampleService;\n+\tprivate final ProjectService projectService;\n+\tprivate final UpdateSamplePermission updateSamplePermission;\n+\tprivate final SequencingObjectService sequencingObjectService;\n+\tprivate final GenomeAssemblyService genomeAssemblyService;\n+\tprivate final UICartService cartService;\n+\n+\t@Autowired\n+\tpublic UISampleService(SampleService sampleService, ProjectService projectService, UpdateSamplePermission updateSamplePermission,\n+\t\t\tSequencingObjectService sequencingObjectService, GenomeAssemblyService genomeAssemblyService, UICartService cartService) {\n+\t\tthis.sampleService = sampleService;\n+\t\tthis.projectService = projectService;\n+\t\tthis.updateSamplePermission = updateSamplePermission;\n+\t\tthis.sequencingObjectService = sequencingObjectService;\n+\t\tthis.genomeAssemblyService = genomeAssemblyService;\n+\t\tthis.cartService = cartService;\n+\t}\n+\n+\t/**\n+\t * Get full details, including metadata for a {@link Sample}\n+\t *\n+\t * @param id Identifier for a {@link Sample}\n+\t * @return {@link SampleDetails}\n+\t */\n+\tpublic SampleDetails getSampleDetails(Long id) {\n+\t\tSample sample = sampleService.read(id);\n+\t\tAuthentication authentication = SecurityContextHolder.getContext()\n+\t\t\t\t.getAuthentication();\n+\t\tboolean isModifiable = updateSamplePermission.isAllowed(authentication, sample);\n+\t\treturn new SampleDetails(sample, isModifiable, cartService.isSampleInCart(id));\n+\t}\n+\n+\t/**\n+\t * Get the sequence files associated with a sample\n+\t *\n+\t * @param sampleId  Identifier for a sample\n+\t * @param projectId Identifier for the project the sample belong to\n+\t * @return All the sequencing files associated with the sample\n+\t */\n+\tpublic SampleFiles getSampleFiles(Long sampleId, Long projectId) {\n+\t\tSample sample = sampleService.read(sampleId);\n+\t\t// get the project if available\n+\t\tProject project = null;\n+\t\tif (projectId != null) {\n+\t\t\tproject = projectService.read(projectId);\n+\t\t}\n+\n+\t\tCollection<SampleSequencingObjectJoin> filePairJoins = sequencingObjectService.getSequencesForSampleOfType(\n+\t\t\t\tsample, SequenceFilePair.class);\n+\t\tCollection<SampleSequencingObjectJoin> singleFileJoins = sequencingObjectService.getSequencesForSampleOfType(\n+\t\t\t\tsample, SingleEndSequenceFile.class);\n+\t\tCollection<SampleSequencingObjectJoin> fast5FileJoins = sequencingObjectService.getSequencesForSampleOfType(\n+\t\t\t\tsample, Fast5Object.class);\n+\t\tList<SequencingObject> fast5 = fast5FileJoins.stream()\n+\t\t\t\t.map(SampleSequencingObjectJoin::getObject)\n+\t\t\t\t.collect(Collectors.toList());\n+\n+\t\tCollection<SampleGenomeAssemblyJoin> genomeAssemblyJoins = genomeAssemblyService.getAssembliesForSample(sample);\n+\n+\t\tList<GenomeAssembly> genomeAssemblies = genomeAssemblyJoins.stream()\n+\t\t\t\t.map(SampleGenomeAssemblyJoin::getObject)\n+\t\t\t\t.collect(Collectors.toList());\n+\n+\t\t// add project to qc entries and filter any unavailable entries\n+\t\tList<SequencingObject> filePairs = new ArrayList<>();\n+\t\tfor (SampleSequencingObjectJoin join : filePairJoins) {\n+\t\t\tSequencingObject obj = join.getObject();\n+\t\t\tenhanceQcEntries(obj, project);\n+\t\t\tfilePairs.add(obj);\n+\t\t}\n+\n+\t\tList<SequencingObject> singles = new ArrayList<>();\n+\t\tfor (SampleSequencingObjectJoin join : singleFileJoins) {\n+\t\t\tSequencingObject obj = join.getObject();\n+\t\t\tenhanceQcEntries(obj, project);\n+\t\t\tsingles.add(obj);\n+\t\t}\n+", "originalCommit": "972ac84be46b54d0e84705fb5fcaca5a5c629eac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY2NjY3MA==", "url": "https://github.com/phac-nml/irida/pull/884#discussion_r542666670", "bodyText": "It's not in the current version of the files. \u00a0I can to this in a later branch. Not actually doing anything with the QC data yet.", "author": "joshsadam", "createdAt": "2020-12-14T19:14:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAyNzgyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjcxMDE2Mw==", "url": "https://github.com/phac-nml/irida/pull/884#discussion_r542710163", "bodyText": "Sounds good!", "author": "deepsidhu85", "createdAt": "2020-12-14T19:54:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAyNzgyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAyOTAyOA==", "url": "https://github.com/phac-nml/irida/pull/884#discussion_r541029028", "bodyText": "Extra sample in @param text", "author": "deepsidhu85", "createdAt": "2020-12-11T15:29:56Z", "path": "src/main/java/ca/corefacility/bioinformatics/irida/ria/web/sessionAttrs/Cart.java", "diffHunk": "@@ -88,4 +88,13 @@ public int removeProject(Long projectId) {\n \t\treturn Sets.newHashSet(this.values());\n \t}\n \n+\t/**\n+\t * Find if a sample is currently in the cart.  If it is get the project that it belongs to.\n+\t *\n+\t * @param sampleId identifier for a sample sample to check the cart for.", "originalCommit": "972ac84be46b54d0e84705fb5fcaca5a5c629eac", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjY2ODE1OA==", "url": "https://github.com/phac-nml/irida/pull/884#discussion_r542668158", "bodyText": "Updated in 25828a1", "author": "joshsadam", "createdAt": "2020-12-14T19:15:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MTAyOTAyOA=="}], "type": "inlineReview"}, {"oid": "734428dd3df5a132d87d42e4b199091a52b989e1", "url": "https://github.com/phac-nml/irida/commit/734428dd3df5a132d87d42e4b199091a52b989e1", "message": "Cleaned up how files are displayed", "committedDate": "2020-12-11T18:54:58Z", "type": "commit"}, {"oid": "1f06a334425e8c4a2dc70f9216e8193d45173cd2", "url": "https://github.com/phac-nml/irida/commit/1f06a334425e8c4a2dc70f9216e8193d45173cd2", "message": "Cleaned up internationalization and file names", "committedDate": "2020-12-14T14:56:22Z", "type": "commit"}, {"oid": "f46cfbc8f4a483568031136dec220c4c60298fb3", "url": "https://github.com/phac-nml/irida/commit/f46cfbc8f4a483568031136dec220c4c60298fb3", "message": "Updated CHANGELOG", "committedDate": "2020-12-14T19:13:51Z", "type": "commit"}, {"oid": "25828a13e932bd65ed5dc10eaede867a2af9e306", "url": "https://github.com/phac-nml/irida/commit/25828a13e932bd65ed5dc10eaede867a2af9e306", "message": "Fixed JavaDoc with too many samples", "committedDate": "2020-12-14T19:15:45Z", "type": "commit"}, {"oid": "874db0bac778d4cde15a8cdc94c1af7bed39019c", "url": "https://github.com/phac-nml/irida/commit/874db0bac778d4cde15a8cdc94c1af7bed39019c", "message": "Update file JSDoc", "committedDate": "2020-12-14T19:17:48Z", "type": "commit"}, {"oid": "94bab472469c60e4cd4d889d7d5bc69a1cb7b1af", "url": "https://github.com/phac-nml/irida/commit/94bab472469c60e4cd4d889d7d5bc69a1cb7b1af", "message": "Moved notification message into the file sample files component", "committedDate": "2020-12-14T19:20:23Z", "type": "commit"}, {"oid": "238a09c7f58f1b4e0f602a758c1d05890476d133", "url": "https://github.com/phac-nml/irida/commit/238a09c7f58f1b4e0f602a758c1d05890476d133", "message": "Add JSDoc to CalendarDate", "committedDate": "2020-12-14T19:22:15Z", "type": "commit"}, {"oid": "51e9c13b8125d5fd0b22d9e4128210b2cbaccc3d", "url": "https://github.com/phac-nml/irida/commit/51e9c13b8125d5fd0b22d9e4128210b2cbaccc3d", "message": "Removed empty useEffect hook", "committedDate": "2020-12-14T19:23:52Z", "type": "commit"}, {"oid": "7c76e26d3e472c5740cc86767bae7f95f2244d3d", "url": "https://github.com/phac-nml/irida/commit/7c76e26d3e472c5740cc86767bae7f95f2244d3d", "message": "Added initial test checking for sample name", "committedDate": "2020-12-15T04:19:57Z", "type": "commit"}, {"oid": "661df15bcb59366bb4b811ead8b819cac335e42b", "url": "https://github.com/phac-nml/irida/commit/661df15bcb59366bb4b811ead8b819cac335e42b", "message": "Test to make sure that the created date is set up properly", "committedDate": "2020-12-15T11:07:12Z", "type": "commit"}, {"oid": "5cef2b9b93ce2909efd1dbf4881ff281eee75415", "url": "https://github.com/phac-nml/irida/commit/5cef2b9b93ce2909efd1dbf4881ff281eee75415", "message": "Added tests for metadata fields", "committedDate": "2020-12-15T11:39:08Z", "type": "commit"}]}