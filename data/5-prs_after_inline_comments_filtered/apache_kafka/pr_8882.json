{"pr_number": 8882, "pr_title": "KAFKA-10165: Remove Percentiles from e2e metrics", "pr_createdAt": "2020-06-16T20:14:37Z", "pr_url": "https://github.com/apache/kafka/pull/8882", "timeline": [{"oid": "7c3c51ffcb65b50c344ab05733874964e1d1064c", "url": "https://github.com/apache/kafka/commit/7c3c51ffcb65b50c344ab05733874964e1d1064c", "message": "KAFKA-10165: Remove Percentiles from e2e metrics", "committedDate": "2020-06-17T03:35:02Z", "type": "commit"}, {"oid": "ae1a3908bcaad82e30ad35a0e4462d7a4b7978b5", "url": "https://github.com/apache/kafka/commit/ae1a3908bcaad82e30ad35a0e4462d7a4b7978b5", "message": "separate test case for closeAndRecycle metrics", "committedDate": "2020-06-17T03:42:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc4MTQ5OA==", "url": "https://github.com/apache/kafka/pull/8882#discussion_r441781498", "bodyText": "@vvcephei I'm not familiar enough with the metrics classification to know if this will be an issue or just an oddity, but we now have allegedly task-level metrics but with the processor-node-level tags/grouping. It's kind of a \"task metric in implementation, processor node metric in interface\" -- might be confusing for us but should be alright for users, yeah?", "author": "ableegoldman", "createdAt": "2020-06-17T19:25:25Z", "path": "streams/src/main/java/org/apache/kafka/streams/processor/internals/metrics/TaskMetrics.java", "diffHunk": "@@ -133,6 +142,25 @@ public static Sensor activeBufferedRecordsSensor(final String threadId,\n         return sensor;\n     }\n \n+    public static Sensor e2ELatencySensor(final String threadId,\n+                                          final String taskId,\n+                                          final String processorNodeId,\n+                                          final RecordingLevel recordingLevel,\n+                                          final StreamsMetricsImpl streamsMetrics) {\n+        final String sensorName = processorNodeId + \"-\" + RECORD_E2E_LATENCY;\n+        final Sensor sensor = streamsMetrics.taskLevelSensor(threadId, taskId, sensorName, recordingLevel);\n+        final Map<String, String> tagMap = streamsMetrics.nodeLevelTagMap(threadId, taskId, processorNodeId);\n+        addMinAndMaxToSensor(\n+            sensor,\n+            PROCESSOR_NODE_LEVEL_GROUP,", "originalCommit": "ae1a3908bcaad82e30ad35a0e4462d7a4b7978b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc4MjI4Ng==", "url": "https://github.com/apache/kafka/pull/8882#discussion_r441782286", "bodyText": "We give it the task sensor prefix which becomes part of the full sensor name, rather than the processor node prefix", "author": "ableegoldman", "createdAt": "2020-06-17T19:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc4MTQ5OA=="}], "type": "inlineReview"}]}