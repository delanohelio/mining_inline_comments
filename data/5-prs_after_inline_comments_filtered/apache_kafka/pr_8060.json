{"pr_number": 8060, "pr_title": "KAFKA-9274: Gracefully handle timeout exception", "pr_createdAt": "2020-02-07T18:32:39Z", "pr_url": "https://github.com/apache/kafka/pull/8060", "timeline": [{"oid": "74cfbf1a779b7dd3fb3a1ee9f4277338cd9a66d3", "url": "https://github.com/apache/kafka/commit/74cfbf1a779b7dd3fb3a1ee9f4277338cd9a66d3", "message": "timeout for committed and initTxn", "committedDate": "2020-02-14T21:30:16Z", "type": "commit"}, {"oid": "74cfbf1a779b7dd3fb3a1ee9f4277338cd9a66d3", "url": "https://github.com/apache/kafka/commit/74cfbf1a779b7dd3fb3a1ee9f4277338cd9a66d3", "message": "timeout for committed and initTxn", "committedDate": "2020-02-14T21:30:16Z", "type": "forcePushed"}, {"oid": "19332579cacd46146a8309938215845c16448a8d", "url": "https://github.com/apache/kafka/commit/19332579cacd46146a8309938215845c16448a8d", "message": "improve producer unit test", "committedDate": "2020-02-14T22:46:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY3OTE2OQ==", "url": "https://github.com/apache/kafka/pull/8060#discussion_r379679169", "bodyText": "This is just to verify that initTransactions can indeed be retried. cc @hachikuji", "author": "guozhangwang", "createdAt": "2020-02-14T22:49:14Z", "path": "clients/src/test/java/org/apache/kafka/clients/producer/KafkaProducerTest.java", "diffHunk": "@@ -761,7 +762,18 @@ public void testInitTransactionTimeout() {\n \n         try (Producer<String, String> producer = new KafkaProducer<>(configs, new StringSerializer(),\n                 new StringSerializer(), metadata, client, null, time)) {\n+            client.prepareResponse(\n+                request -> request instanceof FindCoordinatorRequest &&\n+                    ((FindCoordinatorRequest) request).data().keyType() == FindCoordinatorRequest.CoordinatorType.TRANSACTION.id(),\n+                FindCoordinatorResponse.prepareResponse(Errors.NONE, host1));\n+\n             assertThrows(TimeoutException.class, producer::initTransactions);\n+\n+            client.respond(FindCoordinatorResponse.prepareResponse(Errors.NONE, host1));\n+            client.prepareResponse(initProducerIdResponse(1L, (short) 5, Errors.NONE));\n+\n+            // retry initialization should work\n+            producer.initTransactions();", "originalCommit": "19332579cacd46146a8309938215845c16448a8d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}