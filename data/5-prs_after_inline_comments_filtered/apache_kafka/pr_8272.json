{"pr_number": 8272, "pr_title": "KAFKA-9701: Add more debug log on client to reproduce the issue", "pr_createdAt": "2020-03-11T02:56:37Z", "pr_url": "https://github.com/apache/kafka/pull/8272", "timeline": [{"oid": "37f67e148461e0f1e17954c863f3ba3338b78603", "url": "https://github.com/apache/kafka/commit/37f67e148461e0f1e17954c863f3ba3338b78603", "message": "hotfix statemanager util", "committedDate": "2020-03-07T04:06:06Z", "type": "commit"}, {"oid": "cf6f7e4a098ba5f871caa08238be5d293b1c3a9c", "url": "https://github.com/apache/kafka/commit/cf6f7e4a098ba5f871caa08238be5d293b1c3a9c", "message": "Merge remote-tracking branch 'upstream/trunk' into trunk", "committedDate": "2020-03-10T17:45:41Z", "type": "commit"}, {"oid": "ebfdc71cba3b6d35ba88b032b1664c3afa78f97f", "url": "https://github.com/apache/kafka/commit/ebfdc71cba3b6d35ba88b032b1664c3afa78f97f", "message": "add more debug log to protocol type", "committedDate": "2020-03-11T02:56:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM2NzkzMg==", "url": "https://github.com/apache/kafka/pull/8272#discussion_r391367932", "bodyText": "Why are we logging this at error level when it's a client issue?", "author": "ijuma", "createdAt": "2020-03-12T02:17:49Z", "path": "clients/src/main/java/org/apache/kafka/clients/consumer/internals/AbstractCoordinator.java", "diffHunk": "@@ -576,7 +576,7 @@ public void handle(JoinGroupResponse joinResponse, RequestFuture<ByteBuffer> fut\n             Errors error = joinResponse.error();\n             if (error == Errors.NONE) {\n                 if (isProtocolTypeInconsistent(joinResponse.data().protocolType())) {\n-                    log.debug(\"JoinGroup failed due to inconsistent Protocol Type, received {} but expected {}\",\n+                    log.error(\"JoinGroup failed due to inconsistent Protocol Type, received {} but expected {}\",", "originalCommit": "ebfdc71cba3b6d35ba88b032b1664c3afa78f97f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM4OTg3Nw==", "url": "https://github.com/apache/kafka/pull/8272#discussion_r391389877", "bodyText": "@ijuma not sure I understand your question?", "author": "guozhangwang", "createdAt": "2020-03-12T03:58:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM2NzkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTQzNTEwOQ==", "url": "https://github.com/apache/kafka/pull/8272#discussion_r391435109", "bodyText": "Logging at error level should indicate a broker error. Bad client requests are a client error though and should not generate the logs at error level. Does that make sense?", "author": "ijuma", "createdAt": "2020-03-12T07:11:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM2NzkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYxNjQ4Mw==", "url": "https://github.com/apache/kafka/pull/8272#discussion_r392616483", "bodyText": "Atm we cannot say for sure, but it's likely that what's observed on KAFKA-9701 is a broker-side issue; we can either 1) add the check on broker-side across all members to make sure the selected protocol is consistent for everyone, so if the broker already made a wrong choice itself would log an ERROR, or 2) let it check on the client side. I think for trouble-shooting purposes option 2) is fine, and if we later discovered that this bug is actually on the client side I'm happy to revert this change after fixing it.", "author": "guozhangwang", "createdAt": "2020-03-14T20:20:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM2NzkzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjYyMjM0OA==", "url": "https://github.com/apache/kafka/pull/8272#discussion_r392622348", "bodyText": "So the if (isProtocolTypeInconsistent(joinResponse.data().protocolType())) check is like an assert for a bug in the broker implementation versus validating the join group request?", "author": "ijuma", "createdAt": "2020-03-14T21:54:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTM2NzkzMg=="}], "type": "inlineReview"}]}