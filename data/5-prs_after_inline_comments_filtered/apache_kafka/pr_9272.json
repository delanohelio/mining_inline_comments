{"pr_number": 9272, "pr_title": "KAFKA-10458; Updating controller quota does not work since Token Bucket", "pr_createdAt": "2020-09-09T13:29:23Z", "pr_url": "https://github.com/apache/kafka/pull/9272", "timeline": [{"oid": "04e57800ca11552ede3063f89b0299ffe6153fe5", "url": "https://github.com/apache/kafka/commit/04e57800ca11552ede3063f89b0299ffe6153fe5", "message": "Update the correct metric in the ControllerQuotaManager when the quota is updated.", "committedDate": "2020-09-09T12:03:59Z", "type": "commit"}, {"oid": "73faac4c32bab026cf1cf574f03160dc83a27372", "url": "https://github.com/apache/kafka/commit/73faac4c32bab026cf1cf574f03160dc83a27372", "message": "Wire up the MetricConfig differently in the Sensor to ensure that updating the MetricConfig of the KafkaMetric is reflected in the Sensor.", "committedDate": "2020-09-09T13:26:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzU5MzEyOQ==", "url": "https://github.com/apache/kafka/pull/9272#discussion_r487593129", "bodyText": "nit: this is not really needed, since it's not ambiguous here as in constructor,", "author": "apovzner", "createdAt": "2020-09-13T23:43:56Z", "path": "clients/src/main/java/org/apache/kafka/common/metrics/Sensor.java", "diffHunk": "@@ -53,12 +54,20 @@\n     private final Object metricLock;\n \n     private static class StatAndConfig {\n-        public final Stat stat;\n-        public final MetricConfig config;\n+        private final Stat stat;\n+        private final Supplier<MetricConfig> configSupplier;\n \n-        StatAndConfig(Stat stat, MetricConfig config) {\n+        StatAndConfig(Stat stat, Supplier<MetricConfig> configSupplier) {\n             this.stat = stat;\n-            this.config = config;\n+            this.configSupplier = configSupplier;\n+        }\n+\n+        public Stat stat() {\n+            return this.stat;", "originalCommit": "73faac4c32bab026cf1cf574f03160dc83a27372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkwOTgwOQ==", "url": "https://github.com/apache/kafka/pull/9272#discussion_r487909809", "bodyText": "I guess if you are removing this. above, you could remove it here as well for consistency.", "author": "rajinisivaram", "createdAt": "2020-09-14T13:25:36Z", "path": "clients/src/main/java/org/apache/kafka/common/metrics/Sensor.java", "diffHunk": "@@ -53,12 +54,20 @@\n     private final Object metricLock;\n \n     private static class StatAndConfig {\n-        public final Stat stat;\n-        public final MetricConfig config;\n+        private final Stat stat;\n+        private final Supplier<MetricConfig> configSupplier;\n \n-        StatAndConfig(Stat stat, MetricConfig config) {\n+        StatAndConfig(Stat stat, Supplier<MetricConfig> configSupplier) {\n             this.stat = stat;\n-            this.config = config;\n+            this.configSupplier = configSupplier;\n+        }\n+\n+        public Stat stat() {\n+            return this.stat;\n+        }\n+\n+        public MetricConfig config() {\n+            return this.configSupplier.get();", "originalCommit": "73faac4c32bab026cf1cf574f03160dc83a27372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NzkwOTgxNQ==", "url": "https://github.com/apache/kafka/pull/9272#discussion_r487909815", "bodyText": "I guess if you are removing this. above, you could remove it here as well for consistency.", "author": "rajinisivaram", "createdAt": "2020-09-14T13:25:36Z", "path": "clients/src/main/java/org/apache/kafka/common/metrics/Sensor.java", "diffHunk": "@@ -53,12 +54,20 @@\n     private final Object metricLock;\n \n     private static class StatAndConfig {\n-        public final Stat stat;\n-        public final MetricConfig config;\n+        private final Stat stat;\n+        private final Supplier<MetricConfig> configSupplier;\n \n-        StatAndConfig(Stat stat, MetricConfig config) {\n+        StatAndConfig(Stat stat, Supplier<MetricConfig> configSupplier) {\n             this.stat = stat;\n-            this.config = config;\n+            this.configSupplier = configSupplier;\n+        }\n+\n+        public Stat stat() {\n+            return this.stat;\n+        }\n+\n+        public MetricConfig config() {\n+            return this.configSupplier.get();", "originalCommit": "73faac4c32bab026cf1cf574f03160dc83a27372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a4ecee3f46c99ae355e264ff11cb1dfd317ff685", "url": "https://github.com/apache/kafka/commit/a4ecee3f46c99ae355e264ff11cb1dfd317ff685", "message": "address feedback", "committedDate": "2020-09-14T14:45:41Z", "type": "commit"}]}