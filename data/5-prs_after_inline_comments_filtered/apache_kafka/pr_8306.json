{"pr_number": 8306, "pr_title": "MINOR: clean up required setup for StreamsPartitionAssignorTest", "pr_createdAt": "2020-03-17T01:56:36Z", "pr_url": "https://github.com/apache/kafka/pull/8306", "timeline": [{"oid": "97d81e637b9803fcefba1a6ee4ee28a90bf8d4c2", "url": "https://github.com/apache/kafka/commit/97d81e637b9803fcefba1a6ee4ee28a90bf8d4c2", "message": "just some cleanup", "committedDate": "2020-03-17T01:32:21Z", "type": "commit"}, {"oid": "a1a28304fe22605c68605c8e530f6983024c8229", "url": "https://github.com/apache/kafka/commit/a1a28304fe22605c68605c8e530f6983024c8229", "message": "just some cleanup here and there", "committedDate": "2020-03-17T01:50:16Z", "type": "commit"}, {"oid": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "url": "https://github.com/apache/kafka/commit/ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "message": "move #getInfo methods", "committedDate": "2020-03-17T01:54:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQwMzQ4Mg==", "url": "https://github.com/apache/kafka/pull/8306#discussion_r393403482", "bodyText": "Just moved these (getInfo) down to the end", "author": "ableegoldman", "createdAt": "2020-03-17T01:57:56Z", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -211,45 +219,16 @@ private void createMockTaskManager(final Set<TaskId> prevTasks,\n         builder.buildTopology();\n     }\n \n-    private Map<String, Subscription> subscriptions;\n-\n     @Before\n     public void setUp() {\n-        if (subscriptions != null) {\n-            subscriptions.clear();\n-        } else {\n-            subscriptions = new HashMap<>();\n-        }\n-    }\n-\n-    private static SubscriptionInfo getInfo(final int version,", "originalCommit": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2MjU4Mg==", "url": "https://github.com/apache/kafka/pull/8306#discussion_r393962582", "bodyText": "Nice.", "author": "guozhangwang", "createdAt": "2020-03-17T20:51:46Z", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -440,18 +418,15 @@ public void testEagerSubscription() {\n         final UUID processId = UUID.randomUUID();\n         createMockTaskManager(prevTasks, standbyTasks, processId, builder);\n         EasyMock.replay(taskManager);\n-\n-        streamsMetadataState = EasyMock.createNiceMock(StreamsMetadataState.class);\n-        configurePartitionAssignor(emptyMap());\n-        partitionAssignor.setRebalanceProtocol(RebalanceProtocol.EAGER);\n+        configurePartitionAssignorWith(Collections.singletonMap(StreamsConfig.UPGRADE_FROM_CONFIG, StreamsConfig.UPGRADE_FROM_23));", "originalCommit": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2OTI1Ng==", "url": "https://github.com/apache/kafka/pull/8306#discussion_r393969256", "bodyText": "nit: the mocked task manager would just call getTaskOffsetSums(...) so maybe we can just call taskManager.getTaskOffsetSums() here? Ditto elsewhere.", "author": "guozhangwang", "createdAt": "2020-03-17T21:03:42Z", "path": "streams/src/test/java/org/apache/kafka/streams/processor/internals/StreamsPartitionAssignorTest.java", "diffHunk": "@@ -482,10 +455,7 @@ public void testCooperativeSubscription() {\n         Collections.sort(subscription.topics());\n         assertEquals(asList(\"topic1\", \"topic2\"), subscription.topics());\n \n-        final Set<TaskId> standbyTasks = new HashSet<>(cachedTasks);\n-        standbyTasks.removeAll(prevTasks);\n-\n-        final SubscriptionInfo info = getInfo(processId, getTaskOffsetSums(prevTasks, cachedTasks), null);\n+        final SubscriptionInfo info = getInfo(processId, getTaskOffsetSums(prevTasks, standbyTasks), null);", "originalCommit": "ad5ae5590505776d515d3b7462cf7cbaa2bde9ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDAxNjIwNg==", "url": "https://github.com/apache/kafka/pull/8306#discussion_r394016206", "bodyText": "We want to stub the task offsets for cases where we just care about the task sets themselves, much of this will end up being rewritten in the next few KIP-441 PRs. But I think we can clean this up a bit more, I'll ping you for another review soon", "author": "ableegoldman", "createdAt": "2020-03-17T22:52:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk2OTI1Ng=="}], "type": "inlineReview"}, {"oid": "51d8d986d62a2b05eb4e2f95f894db78a09a969d", "url": "https://github.com/apache/kafka/commit/51d8d986d62a2b05eb4e2f95f894db78a09a969d", "message": "more cleanup, pre move replay", "committedDate": "2020-03-17T22:23:53Z", "type": "commit"}, {"oid": "2485d2f553a953dfaf48a6da39df63de328ed36b", "url": "https://github.com/apache/kafka/commit/2485d2f553a953dfaf48a6da39df63de328ed36b", "message": "further cleanup", "committedDate": "2020-03-17T23:18:06Z", "type": "commit"}]}