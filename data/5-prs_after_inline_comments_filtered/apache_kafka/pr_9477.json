{"pr_number": 9477, "pr_title": "MINOR: TopologyTestDriver should not require dummy parameters", "pr_createdAt": "2020-10-21T22:07:48Z", "pr_url": "https://github.com/apache/kafka/pull/9477", "timeline": [{"oid": "57e48003d9dd9732d65609c9da1d7e58e34acc91", "url": "https://github.com/apache/kafka/commit/57e48003d9dd9732d65609c9da1d7e58e34acc91", "message": "MINOR: TopologyTestDriver should not require dummy parameters", "committedDate": "2020-10-21T22:14:29Z", "type": "forcePushed"}, {"oid": "57e48003d9dd9732d65609c9da1d7e58e34acc91", "url": "https://github.com/apache/kafka/commit/57e48003d9dd9732d65609c9da1d7e58e34acc91", "message": "MINOR: TopologyTestDriver should not require dummy parameters", "committedDate": "2020-10-21T22:14:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc4MzMwNg==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r509783306", "bodyText": "can be removed?", "author": "mjsax", "createdAt": "2020-10-21T23:00:28Z", "path": "streams/examples/src/test/java/org/apache/kafka/streams/examples/docs/DeveloperGuideTesting.java", "diffHunk": "@@ -73,7 +73,6 @@ public void setup() {\n         // setup test driver\n         final Properties props = new Properties();\n         props.setProperty(StreamsConfig.APPLICATION_ID_CONFIG, \"maxAggregation\");", "originalCommit": "57e48003d9dd9732d65609c9da1d7e58e34acc91", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTg2OTM0Mg==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r509869342", "bodyText": "Yeah, you're looking at a state where I had partially applied the suggestion to drop the unnecessary configs. Bootstrap Server is always unnecessary with TTD, but applicationId sometimes winds up being necessary to keep tests from colliding on the state directory. Chasing these down is what got me hung up the first time around, so I think I'll just leave it as-is for now.", "author": "vvcephei", "createdAt": "2020-10-22T04:14:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc4MzMwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTc4MzM4MA==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r509783380", "bodyText": "can be removed? (seems on many other tests, too)", "author": "mjsax", "createdAt": "2020-10-21T23:00:40Z", "path": "streams/src/test/java/org/apache/kafka/streams/TopologyTest.java", "diffHunk": "@@ -340,7 +340,6 @@ public void shouldThrowOnUnassignedStateStoreAccess() {\n         final String badNodeName = \"badGuy\";\n \n         final Properties config = new Properties();\n-        config.put(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, \"host:1\");\n         config.put(StreamsConfig.APPLICATION_ID_CONFIG, \"appId\");", "originalCommit": "57e48003d9dd9732d65609c9da1d7e58e34acc91", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91f9772971700f598b7375b57d823d239e2e77fe", "url": "https://github.com/apache/kafka/commit/91f9772971700f598b7375b57d823d239e2e77fe", "message": "unused import", "committedDate": "2020-10-22T04:05:22Z", "type": "commit"}, {"oid": "058655fd846bd02e2d3b971c011d67ea1c13fe0d", "url": "https://github.com/apache/kafka/commit/058655fd846bd02e2d3b971c011d67ea1c13fe0d", "message": "keep necessary temp directory config", "committedDate": "2020-10-22T04:11:39Z", "type": "commit"}, {"oid": "2c43e1984692dbb27934471e4c5d90e93f715c67", "url": "https://github.com/apache/kafka/commit/2c43e1984692dbb27934471e4c5d90e93f715c67", "message": "forgot about the new MockProcessorContext during the rebase", "committedDate": "2020-10-22T04:50:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyNjAwNA==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r510126004", "bodyText": "this comment (https://github.com/apache/kafka/blob/trunk/streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java#L138) can be removed since it is not necessary anymore.", "author": "chia7712", "createdAt": "2020-10-22T12:38:18Z", "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -297,7 +297,15 @@ public TopologyTestDriver(final Topology topology,\n     private TopologyTestDriver(final InternalTopologyBuilder builder,\n                                final Properties config,\n                                final long initialWallClockTimeMs) {\n-        final StreamsConfig streamsConfig = new ClientUtils.QuietStreamsConfig(config);\n+        final Properties configCopy = new Properties();\n+        configCopy.putAll(config);\n+        if (!configCopy.containsKey(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG)) {", "originalCommit": "2c43e1984692dbb27934471e4c5d90e93f715c67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE1Nzg1Nw==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r510157857", "bodyText": "That's a good point. I'll put it in the follow-up ticket.", "author": "vvcephei", "createdAt": "2020-10-22T13:23:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEyNjAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEzMTc5OA==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r510131798", "bodyText": "How about replacing containsKey/setProperty by putIfAbsent", "author": "chia7712", "createdAt": "2020-10-22T12:47:34Z", "path": "streams/test-utils/src/main/java/org/apache/kafka/streams/TopologyTestDriver.java", "diffHunk": "@@ -297,7 +297,15 @@ public TopologyTestDriver(final Topology topology,\n     private TopologyTestDriver(final InternalTopologyBuilder builder,\n                                final Properties config,\n                                final long initialWallClockTimeMs) {\n-        final StreamsConfig streamsConfig = new ClientUtils.QuietStreamsConfig(config);\n+        final Properties configCopy = new Properties();\n+        configCopy.putAll(config);\n+        if (!configCopy.containsKey(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG)) {\n+            configCopy.setProperty(StreamsConfig.BOOTSTRAP_SERVERS_CONFIG, \"dummy-bootstrap-host:0\");\n+        }\n+        if (!configCopy.containsKey(StreamsConfig.APPLICATION_ID_CONFIG)) {", "originalCommit": "2c43e1984692dbb27934471e4c5d90e93f715c67", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDE1NzQ5Ng==", "url": "https://github.com/apache/kafka/pull/9477#discussion_r510157496", "bodyText": "Good idea! I didn't think of that. I'm sorry that I didn't see this until after I merged.", "author": "vvcephei", "createdAt": "2020-10-22T13:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDEzMTc5OA=="}], "type": "inlineReview"}]}