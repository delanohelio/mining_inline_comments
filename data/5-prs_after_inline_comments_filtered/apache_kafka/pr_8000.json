{"pr_number": 8000, "pr_title": "KAFKA-9417: New Integration Test for KIP-447", "pr_createdAt": "2020-01-22T21:55:14Z", "pr_url": "https://github.com/apache/kafka/pull/8000", "timeline": [{"oid": "7f6d8ab335b286eef84d11afbac80fd72e5df543", "url": "https://github.com/apache/kafka/commit/7f6d8ab335b286eef84d11afbac80fd72e5df543", "message": "new txn test", "committedDate": "2020-02-11T20:37:34Z", "type": "commit"}, {"oid": "40ed3bd5aa91ad358cccfc76e3ddc922a123c7ce", "url": "https://github.com/apache/kafka/commit/40ed3bd5aa91ad358cccfc76e3ddc922a123c7ce", "message": "tooling class support", "committedDate": "2020-02-11T20:37:34Z", "type": "commit"}, {"oid": "c88e6d0c7f7ffca4db743b533c90126557be321d", "url": "https://github.com/apache/kafka/commit/c88e6d0c7f7ffca4db743b533c90126557be321d", "message": "tune txn timeout for transactions_test", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "b2395c9d443c3103f95cfebf1a6d7daed6288237", "url": "https://github.com/apache/kafka/commit/b2395c9d443c3103f95cfebf1a6d7daed6288237", "message": "more fixes on partition output", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "466e66805c17a8e85b8cf3575534fd15a7caff32", "url": "https://github.com/apache/kafka/commit/466e66805c17a8e85b8cf3575534fd15a7caff32", "message": "debug log for transaction_test", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "2ccb59d6c4daffa13a31009158e9277b392c9699", "url": "https://github.com/apache/kafka/commit/2ccb59d6c4daffa13a31009158e9277b392c9699", "message": "group mode remaining count fix", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "18bd2dd00a442804d639549bad0be51dcce7e4e8", "url": "https://github.com/apache/kafka/commit/18bd2dd00a442804d639549bad0be51dcce7e4e8", "message": "adjust result", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "6b78e0262a76f81a8cc8bb951e9929db756ca041", "url": "https://github.com/apache/kafka/commit/6b78e0262a76f81a8cc8bb951e9929db756ca041", "message": "debug log", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "5aca9b632674c3f67d2cdbd0a8546c4fdf6e4c97", "url": "https://github.com/apache/kafka/commit/5aca9b632674c3f67d2cdbd0a8546c4fdf6e4c97", "message": "less records", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "1f824ff4d9365a74dc77eccb9cdee078da6a4167", "url": "https://github.com/apache/kafka/commit/1f824ff4d9365a74dc77eccb9cdee078da6a4167", "message": "revert to only single test", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "1e15f3037647e4eb531337a687d38d001aaebe2c", "url": "https://github.com/apache/kafka/commit/1e15f3037647e4eb531337a687d38d001aaebe2c", "message": "debug txn timeout and shorten abort scheduler interval from 1 min to 10 seconds", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "2e7d0212c76515de4d32e74746411d4f231ba72c", "url": "https://github.com/apache/kafka/commit/2e7d0212c76515de4d32e74746411d4f231ba72c", "message": "make message cap atomic", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "b386012c497beac4de83513e792b273f38854b75", "url": "https://github.com/apache/kafka/commit/b386012c497beac4de83513e792b273f38854b75", "message": "debug group mode", "committedDate": "2020-02-11T20:37:35Z", "type": "commit"}, {"oid": "f7d5783f277a2e1a5d45f18128aef7d2cf3ac438", "url": "https://github.com/apache/kafka/commit/f7d5783f277a2e1a5d45f18128aef7d2cf3ac438", "message": "good for group test", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "297c700cabee3fb7619678bc40c31329a58a1b55", "url": "https://github.com/apache/kafka/commit/297c700cabee3fb7619678bc40c31329a58a1b55", "message": "remove logging", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "d244b6c60d14ed57d6561addf582879ebd38bcc0", "url": "https://github.com/apache/kafka/commit/d244b6c60d14ed57d6561addf582879ebd38bcc0", "message": "add total message tracking", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "653bc2758da6c7df5e4b8ea83707dee9b94209db", "url": "https://github.com/apache/kafka/commit/653bc2758da6c7df5e4b8ea83707dee9b94209db", "message": "more rebalance related debug log", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "40cbb2aa2d3eddc4ed2fb5a41ea018c139018710", "url": "https://github.com/apache/kafka/commit/40cbb2aa2d3eddc4ed2fb5a41ea018c139018710", "message": "add notes for local docker build failure", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "1b78116ea9ca5bcfde65b9e48fd687936c9eb02c", "url": "https://github.com/apache/kafka/commit/1b78116ea9ca5bcfde65b9e48fd687936c9eb02c", "message": "fix remaining message count change after rebalance", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "bf30abf7fcc43ceb8a9d91f81b73cf39d3816fab", "url": "https://github.com/apache/kafka/commit/bf30abf7fcc43ceb8a9d91f81b73cf39d3816fab", "message": "debug logging", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "e0800139fadbb213cae31fa645574d1aa15d08fe", "url": "https://github.com/apache/kafka/commit/e0800139fadbb213cae31fa645574d1aa15d08fe", "message": "debug info for double counting and delayed join complete", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "54f1227c8c7db4c41ffaf4ca7f28f577ab2545e5", "url": "https://github.com/apache/kafka/commit/54f1227c8c7db4c41ffaf4ca7f28f577ab2545e5", "message": "deprecate misleading message cap", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "21b8d54ffc564412e89242879f9fe0727dffc0d6", "url": "https://github.com/apache/kafka/commit/21b8d54ffc564412e89242879f9fe0727dffc0d6", "message": "excessive long timeout for new member join timeout", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "a6a07e1e5c8a59a51466887bca678cc1f6132af7", "url": "https://github.com/apache/kafka/commit/a6a07e1e5c8a59a51466887bca678cc1f6132af7", "message": "long expire hb", "committedDate": "2020-02-11T20:37:36Z", "type": "commit"}, {"oid": "34946fc7bd06c9270859094b9c4f10405a386f9b", "url": "https://github.com/apache/kafka/commit/34946fc7bd06c9270859094b9c4f10405a386f9b", "message": "add 0 check", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "f5f862a8436474aac517e857a0de3db385a7525f", "url": "https://github.com/apache/kafka/commit/f5f862a8436474aac517e857a0de3db385a7525f", "message": "fix later", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "8e651db36378181794f6ea1471641979ad3fd09d", "url": "https://github.com/apache/kafka/commit/8e651db36378181794f6ea1471641979ad3fd09d", "message": "remove record bound", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "6902766174f8b6baf44e447f8243712b222c83da", "url": "https://github.com/apache/kafka/commit/6902766174f8b6baf44e447f8243712b222c83da", "message": "smaller max poll timeout", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "4b7ffdf9a97368adcc64281f828449efceb17f0e", "url": "https://github.com/apache/kafka/commit/4b7ffdf9a97368adcc64281f828449efceb17f0e", "message": "expose group metadata", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "abd921a275099cdbb729c593a4b2023192812248", "url": "https://github.com/apache/kafka/commit/abd921a275099cdbb729c593a4b2023192812248", "message": "add timeout to listOffset and let consumer redo the remaining count after rebalance", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "918d57d1f81e271d41f4cae0d7c5f5896fad5bc6", "url": "https://github.com/apache/kafka/commit/918d57d1f81e271d41f4cae0d7c5f5896fad5bc6", "message": "Revert \"add timeout to listOffset and let consumer redo the remaining count after rebalance\"\n\nThis reverts commit bf94b0af68066aa762a169b08b4c09d74ef0ed0a.", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "2a8ed5ad92bb64c840b98939d6ed8ea73cc32548", "url": "https://github.com/apache/kafka/commit/2a8ed5ad92bb64c840b98939d6ed8ea73cc32548", "message": "request update of metadata", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "20be486525411a877947dc3c74e82e283bb7b14d", "url": "https://github.com/apache/kafka/commit/20be486525411a877947dc3c74e82e283bb7b14d", "message": "formal fix", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "51e1809862f52de261ebf961b2b79aa8056b58d7", "url": "https://github.com/apache/kafka/commit/51e1809862f52de261ebf961b2b79aa8056b58d7", "message": "cleanup log messages", "committedDate": "2020-02-11T20:37:37Z", "type": "commit"}, {"oid": "17b1ebb275d0bef7744a0215fc2392c4c97285cc", "url": "https://github.com/apache/kafka/commit/17b1ebb275d0bef7744a0215fc2392c4c97285cc", "message": "add txn timeout to example", "committedDate": "2020-02-11T21:06:44Z", "type": "commit"}, {"oid": "17b1ebb275d0bef7744a0215fc2392c4c97285cc", "url": "https://github.com/apache/kafka/commit/17b1ebb275d0bef7744a0215fc2392c4c97285cc", "message": "add txn timeout to example", "committedDate": "2020-02-11T21:06:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3Nzg5ODk2MA==", "url": "https://github.com/apache/kafka/pull/8000#discussion_r377898960", "bodyText": "Add a reminder in EOS example to people", "author": "abbccdda", "createdAt": "2020-02-11T21:07:58Z", "path": "examples/src/main/java/kafka/examples/ExactlyOnceMessageProcessor.java", "diffHunk": "@@ -76,8 +76,11 @@ public ExactlyOnceMessageProcessor(final String mode,\n         this.numInstances = numInstances;\n         this.instanceIdx = instanceIdx;\n         this.transactionalId = \"Processor-\" + instanceIdx;\n+        // If we are using the group mode, it is recommended to have a relatively short txn timeout\n+        // in order to clear pending offsets faster.\n+        final int transactionTimeoutMs = this.mode.equals(\"groupMode\") ? 10000 : -1;", "originalCommit": "17b1ebb275d0bef7744a0215fc2392c4c97285cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzkwMDI1Mg==", "url": "https://github.com/apache/kafka/pull/8000#discussion_r377900252", "bodyText": "Need to add synchronized as we are using static date FORMAT which shall triggers spotsbug for concurrent access.", "author": "abbccdda", "createdAt": "2020-02-11T21:10:37Z", "path": "tools/src/main/java/org/apache/kafka/tools/TransactionalMessageCopier.java", "diffHunk": "@@ -226,87 +256,124 @@ private static String toJsonString(Map<String, Object> data) {\n         return json;\n     }\n \n-    private static String statusAsJson(long consumed, long remaining, String transactionalId) {\n+    private static synchronized String statusAsJson(long totalProcessed, long consumedSinceLastRebalanced, long remaining, String transactionalId, String stage) {", "originalCommit": "17b1ebb275d0bef7744a0215fc2392c4c97285cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}