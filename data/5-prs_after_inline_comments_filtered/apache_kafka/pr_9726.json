{"pr_number": 9726, "pr_title": "KAFKA-10833: Expose task configurations in Connect REST API (KIP-661)", "pr_createdAt": "2020-12-10T12:24:14Z", "pr_url": "https://github.com/apache/kafka/pull/9726", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODMyMjM5MA==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r568322390", "bodyText": "I see the symmetry with connectorInfo above. But here we return a map, in which case it might be safer and nicer to return an empty map? Wdyt?\nIn terms of response the result will be the same because if the connector is found it will always have a map of maps.", "author": "kkonstantine", "createdAt": "2021-02-02T04:55:45Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/AbstractHerder.java", "diffHunk": "@@ -265,6 +265,20 @@ public ConnectorInfo connectorInfo(String connector) {\n         );\n     }\n \n+    protected Map<ConnectorTaskId, Map<String, String>> buildTasksConfig(String connector) {\n+        final ClusterConfigState configState = configBackingStore.snapshot();\n+\n+        if (!configState.contains(connector))\n+            return null;", "originalCommit": "28a0b26b768903a925a69c288be5415212d8504a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODMyNTAzOQ==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r568325039", "bodyText": "I agree with your choice to preserve symmetry. Yet some features need to find their way to the codebase eventually. There's a PR in progress to apply some basic modernization and reduce boilerplate. Want to use a lambda and skip the need to synchronize merges with: #9867 ?", "author": "kkonstantine", "createdAt": "2021-02-02T05:05:02Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/distributed/DistributedHerder.java", "diffHunk": "@@ -744,6 +744,29 @@ public Void call() throws Exception {\n         );\n     }\n \n+    @Override\n+    public void tasksConfig(String connName, final Callback<Map<ConnectorTaskId, Map<String, String>>> callback) {\n+        log.trace(\"Submitting tasks config request {}\", connName);\n+\n+        addRequest(\n+                new Callable<Void>() {", "originalCommit": "28a0b26b768903a925a69c288be5415212d8504a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODMyNTM2Mw==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r568325363", "bodyText": "If you change above, don't forget to check with empty here.", "author": "kkonstantine", "createdAt": "2021-02-02T05:06:04Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/standalone/StandaloneHerder.java", "diffHunk": "@@ -434,4 +434,15 @@ public int hashCode() {\n             return Objects.hash(seq);\n         }\n     }\n+\n+    @Override\n+    public void tasksConfig(String connName, Callback<Map<ConnectorTaskId, Map<String, String>>> callback) {\n+        Map<ConnectorTaskId, Map<String, String>> tasksConfig = buildTasksConfig(connName);\n+        if (tasksConfig == null) {", "originalCommit": "28a0b26b768903a925a69c288be5415212d8504a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODMyNTU4NQ==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r568325585", "bodyText": "nit: extra line", "author": "kkonstantine", "createdAt": "2021-02-02T05:06:55Z", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/rest/resources/ConnectorsResourceTest.java", "diffHunk": "@@ -519,6 +519,38 @@ public void testGetConnectorConfigConnectorNotFound() throws Throwable {\n         PowerMock.verifyAll();\n     }\n \n+    @Test\n+    public void testGetTasksConfig() throws Throwable {\n+", "originalCommit": "28a0b26b768903a925a69c288be5415212d8504a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU2ODMyNjEwNg==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r568326106", "bodyText": "Should we add one more test to test multiple tasks with multiple config properties?", "author": "kkonstantine", "createdAt": "2021-02-02T05:08:46Z", "path": "connect/runtime/src/test/java/org/apache/kafka/connect/runtime/rest/resources/ConnectorsResourceTest.java", "diffHunk": "@@ -519,6 +519,38 @@ public void testGetConnectorConfigConnectorNotFound() throws Throwable {\n         PowerMock.verifyAll();\n     }\n \n+    @Test\n+    public void testGetTasksConfig() throws Throwable {", "originalCommit": "28a0b26b768903a925a69c288be5415212d8504a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "828ebf650e4c9b8c9c4da74f047179dfb82edb9c", "url": "https://github.com/apache/kafka/commit/828ebf650e4c9b8c9c4da74f047179dfb82edb9c", "message": "KAFKA-10833: Expose task configurations in Connect REST API\n\nThis PR adds a new REST endpoint to Connect: GET /{connector}/tasks-config, that returns the configuration of all tasks for the connector.\n\nCo-authored-by: Mickael Maison <mickael.maison@gmail.com>\nCo-authored-by: Oliver Dineen <dineeno@uk.ibm.com>", "committedDate": "2021-02-04T18:36:38Z", "type": "commit"}, {"oid": "696531961c6b53dd6489008fbd0dbb0da3d0ada1", "url": "https://github.com/apache/kafka/commit/696531961c6b53dd6489008fbd0dbb0da3d0ada1", "message": "Address feedback", "committedDate": "2021-02-04T19:54:48Z", "type": "commit"}, {"oid": "696531961c6b53dd6489008fbd0dbb0da3d0ada1", "url": "https://github.com/apache/kafka/commit/696531961c6b53dd6489008fbd0dbb0da3d0ada1", "message": "Address feedback", "committedDate": "2021-02-04T19:54:48Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDUwNTY1MA==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r570505650", "bodyText": "nit: this alignment might be a bit off. We can follow the pattern of 2 tabs with first and last line on their own if that looks better I guess.", "author": "kkonstantine", "createdAt": "2021-02-04T19:58:26Z", "path": "connect/runtime/src/main/java/org/apache/kafka/connect/runtime/rest/resources/ConnectorsResource.java", "diffHunk": "@@ -188,6 +188,16 @@ public ConnectorInfo getConnector(final @PathParam(\"connector\") String connector\n         return completeOrForwardRequest(cb, \"/connectors/\" + connector + \"/config\", \"GET\", headers, null, forward);\n     }\n \n+    @GET\n+    @Path(\"/{connector}/tasks-config\")\n+    public Map<ConnectorTaskId, Map<String, String>> getTasksConfig(final @PathParam(\"connector\") String connector,\n+                                                  final @Context HttpHeaders headers,", "originalCommit": "696531961c6b53dd6489008fbd0dbb0da3d0ada1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDU0NTgyOA==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r570545828", "bodyText": "You mean something like this?\n @GET\n    @Path(\"/{connector}/tasks-config\")\n    public Map<ConnectorTaskId, Map<String, String>> getTasksConfig(\n            final @PathParam(\"connector\") String connector,\n            final @Context HttpHeaders headers,\n            final @QueryParam(\"forward\") Boolean forward) throws Throwable {\n        FutureCallback<Map<ConnectorTaskId, Map<String, String>>> cb = new FutureCallback<>();\n        ...", "author": "mimaison", "createdAt": "2021-02-04T21:11:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDUwNTY1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDU3Nzg0NQ==", "url": "https://github.com/apache/kafka/pull/9726#discussion_r570577845", "bodyText": "That's right \ud83d\udc4d", "author": "kkonstantine", "createdAt": "2021-02-04T22:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU3MDUwNTY1MA=="}], "type": "inlineReview"}, {"oid": "f1deb16d48c24dc1ef5fa011a0550e45f49f8981", "url": "https://github.com/apache/kafka/commit/f1deb16d48c24dc1ef5fa011a0550e45f49f8981", "message": "Fix alignment", "committedDate": "2021-02-04T22:10:44Z", "type": "commit"}]}