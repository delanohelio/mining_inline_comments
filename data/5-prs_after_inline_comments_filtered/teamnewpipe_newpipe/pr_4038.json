{"pr_number": 4038, "pr_title": "Remember last selected media type for downloads.", "pr_createdAt": "2020-08-01T09:16:34Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/4038", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MDY3NQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463950675", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n          \n          \n            \n                    final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),", "author": "TobiGr", "createdAt": "2020-08-01T10:57:54Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,22 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),", "originalCommit": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MTEzMw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463951133", "bodyText": "(defaultMedia.equals(getString(R.string.video)) this will fail to detect the last used type when the user changed tha pplication language. Please create three keys in settings_keys.xml to avoid that.", "author": "TobiGr", "createdAt": "2020-08-01T11:03:47Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,22 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.video));\n+\n+        assert defaultMedia != null;\n+        if (isVideoStreamsAvailable && (defaultMedia.equals(getString(R.string.video)))) {", "originalCommit": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk1MjM2NA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r463952364", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    SharedPreferences.Editor editor = prefs.edit();\n          \n          \n            \n                    final SharedPreferences.Editor editor = prefs.edit();", "author": "TobiGr", "createdAt": "2020-08-01T11:19:08Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -663,6 +682,11 @@ private void prepareSelectedDownload() {\n \n         // check for existing file with the same name\n         checkSelectedDownload(mainStorage, mainStorage.findFile(filename), filename, mime);\n+\n+        // remember the last media type downloaded by the user\n+        SharedPreferences.Editor editor = prefs.edit();", "originalCommit": "f82955d5c8356b79bae20c0bb2050be4a63f6d4a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDk4MjYxOQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/4038#discussion_r470982619", "bodyText": "According to the docs, getString(resInt) cannot be null, thus defaultMedia cannot be null (as long as we don't put anything stupid into the preferences, which we clearly do not). I think, the assertion can be removed.", "author": "TobiGr", "createdAt": "2020-08-15T13:34:42Z", "path": "app/src/main/java/org/schabi/newpipe/download/DownloadDialog.java", "diffHunk": "@@ -515,7 +515,24 @@ protected void setupDownloadOptions() {\n         videoButton.setVisibility(isVideoStreamsAvailable ? View.VISIBLE : View.GONE);\n         subtitleButton.setVisibility(isSubtitleStreamsAvailable ? View.VISIBLE : View.GONE);\n \n-        if (isVideoStreamsAvailable) {\n+        prefs = PreferenceManager.getDefaultSharedPreferences(getContext());\n+        final String defaultMedia = prefs.getString(getString(R.string.last_used_download_type),\n+                    getString(R.string.last_download_type_video_key));\n+\n+        assert defaultMedia != null;", "originalCommit": "4f40bd6ae58c9d8732f8ba2f3c842a2a8b3264bf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "message": "Remember last selected media type for downloads.", "committedDate": "2020-09-03T17:47:34Z", "type": "commit"}, {"oid": "99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "url": "https://github.com/TeamNewPipe/NewPipe/commit/99442b6e0489de74cc22f6bb404dfc33ea08ec7c", "message": "Remember last selected media type for downloads.", "committedDate": "2020-09-03T17:47:34Z", "type": "forcePushed"}]}