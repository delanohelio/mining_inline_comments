{"pr_number": 3579, "pr_title": "Add Markdown export of crash logs", "pr_createdAt": "2020-05-13T07:03:09Z", "pr_url": "https://github.com/TeamNewPipe/NewPipe/pull/3579", "timeline": [{"oid": "4846094384989684c16aeecf98a46c03d3d40c81", "url": "https://github.com/TeamNewPipe/NewPipe/commit/4846094384989684c16aeecf98a46c03d3d40c81", "message": "Add Markdown export of crash logs\n\nAdd content country as additional debug information to reports", "committedDate": "2020-05-13T08:08:34Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMjc2Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r424302766", "bodyText": "I think it's a mistake\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                .value(\"content_country\", getContentLanguageString())\n          \n          \n            \n                                .value(\"content_country\", getContentCountryString())", "author": "B0pol", "createdAt": "2020-05-13T09:31:41Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -351,7 +385,8 @@ private String buildJson() {\n                     .object()\n                     .value(\"user_action\", getUserActionString(errorInfo.userAction))\n                     .value(\"request\", errorInfo.request)\n-                    .value(\"content_language\", getContentLangString())\n+                    .value(\"content_language\", getContentLanguageString())\n+                    .value(\"content_country\", getContentLanguageString())", "originalCommit": "4846094384989684c16aeecf98a46c03d3d40c81", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwNTI3Nw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r424305277", "bodyText": "Do not duplicate\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                private String getContentCountryString() {\n          \n          \n            \n                    String contentCountry = PreferenceManager.getDefaultSharedPreferences(this)\n          \n          \n            \n                            .getString(this.getString(R.string.content_country_key), \"none\");\n          \n          \n            \n                    if (contentCountry.equals(getString(R.string.default_localization_key))) {\n          \n          \n            \n                        contentCountry = Locale.getDefault().toString();\n          \n          \n            \n                    }\n          \n          \n            \n                    return contentCountry;\n          \n          \n            \n                }\n          \n          \n            \n                private String getContentCountryString() {\n          \n          \n            \n                    return Localization.getPreferredContentCountry(this).getCountryCode();\n          \n          \n            \n                }", "author": "B0pol", "createdAt": "2020-05-13T09:35:50Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -377,9 +461,18 @@ private String getUserActionString(final UserAction userAction) {\n         }\n     }\n \n-    private String getContentLangString() {\n-        String contentLanguage = PreferenceManager.getDefaultSharedPreferences(this)\n+    private String getContentCountryString() {\n+        String contentCountry = PreferenceManager.getDefaultSharedPreferences(this)\n                 .getString(this.getString(R.string.content_country_key), \"none\");\n+        if (contentCountry.equals(getString(R.string.default_localization_key))) {\n+            contentCountry = Locale.getDefault().toString();\n+        }\n+        return contentCountry;\n+    }", "originalCommit": "4846094384989684c16aeecf98a46c03d3d40c81", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMxMjQzNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r424312434", "bodyText": "Same, don't duplicate, just use Localization.getPreferredLocalization(this).getLocalizationCode();\nBut remember that it's useless now. See #3089 (comment). So maybe we should gather app language, with Localization.getAppLocale(this).getLanguage();", "author": "B0pol", "createdAt": "2020-05-13T09:47:47Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -377,9 +461,18 @@ private String getUserActionString(final UserAction userAction) {\n         }\n     }\n \n-    private String getContentLangString() {\n-        String contentLanguage = PreferenceManager.getDefaultSharedPreferences(this)\n+    private String getContentCountryString() {\n+        String contentCountry = PreferenceManager.getDefaultSharedPreferences(this)\n                 .getString(this.getString(R.string.content_country_key), \"none\");\n+        if (contentCountry.equals(getString(R.string.default_localization_key))) {\n+            contentCountry = Locale.getDefault().toString();\n+        }\n+        return contentCountry;\n+    }\n+\n+    private String getContentLanguageString() {", "originalCommit": "4846094384989684c16aeecf98a46c03d3d40c81", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUwMDgwNw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r424500807", "bodyText": "Ah yes. I wrote that code back in October along with some other changes for more debug info regarding the parsed YouTube pages and didn't think of your recent changes when rebasing.", "author": "TobiGr", "createdAt": "2020-05-13T14:51:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMxMjQzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDYzNDc4MA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r424634780", "bodyText": "I think contentCountry might be useful in the future as soon as we enabled support for it again. I corrected the code but didn't include the content country in the report and also added a field for the app language.", "author": "TobiGr", "createdAt": "2020-05-13T18:10:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMxMjQzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDY4MTk1OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r424681958", "bodyText": "Content country != Localization\nContent Country is working. And yeah, let's not remove it, I suddenly got some ideas for Localization.", "author": "B0pol", "createdAt": "2020-05-13T19:32:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMxMjQzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU2MDkwNg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446560906", "bodyText": "Done", "author": "TobiGr", "createdAt": "2020-06-27T19:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMxMjQzNA=="}], "type": "inlineReview"}, {"oid": "fc059543397cd8d201d04855991f698f5153264f", "url": "https://github.com/TeamNewPipe/NewPipe/commit/fc059543397cd8d201d04855991f698f5153264f", "message": "Add Markdown export of crash logs\n\nAdd app language as additional debug information to reports", "committedDate": "2020-05-13T18:09:28Z", "type": "forcePushed"}, {"oid": "1700a2e27180769ccc67b087b328de5b39a544bf", "url": "https://github.com/TeamNewPipe/NewPipe/commit/1700a2e27180769ccc67b087b328de5b39a544bf", "message": "Add Markdown export of crash logs\n\nAdd app language as additional debug information to reports", "committedDate": "2020-06-27T19:40:20Z", "type": "forcePushed"}, {"oid": "f437660d94447ee4a7a80477b9533515ed87af0d", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f437660d94447ee4a7a80477b9533515ed87af0d", "message": "Add Markdown export of crash logs\n\nAdd app language as additional debug information to reports", "committedDate": "2020-06-27T19:50:11Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjU3MzIyMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446573221", "bodyText": "remove this line. Typo + duplicate from the one below", "author": "B0pol", "createdAt": "2020-06-27T22:17:14Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -347,7 +380,10 @@ private String buildJson() {\n                     .object()\n                     .value(\"user_action\", getUserActionString(errorInfo.userAction))\n                     .value(\"request\", errorInfo.request)\n-                    .value(\"content_language\", getContentLangString())\n+                    .value(\"content_language\", getContentLanguageString())\n+                    .value(\"content_country\", getContentCountryString())\n+                    .value(\"app_langauge\", getAppLanguage())", "originalCommit": "f437660d94447ee4a7a80477b9533515ed87af0d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f06f9e88cc911583a980ec7150f46c6041e7958a", "url": "https://github.com/TeamNewPipe/NewPipe/commit/f06f9e88cc911583a980ec7150f46c6041e7958a", "message": "Add Markdown export of crash logs\n\nAdd app language as additional debug information to reports", "committedDate": "2020-06-27T22:43:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1Mjk4Mw==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446652983", "bodyText": "final", "author": "wb9688", "createdAt": "2020-06-28T13:44:41Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -281,6 +279,39 @@ public boolean onOptionsItemSelected(final MenuItem item) {\n         return false;\n     }\n \n+    private void openPrivacyPolicyDialog(final Context context, final String action) {\n+        new AlertDialog.Builder(context)\n+                .setIcon(android.R.drawable.ic_dialog_alert)\n+                .setTitle(R.string.privacy_policy_title)\n+                .setMessage(R.string.start_accept_privacy_policy)\n+                .setCancelable(false)\n+                .setNeutralButton(R.string.read_privacy_policy, (dialog, which) -> {\n+                    Intent webIntent = new Intent(Intent.ACTION_VIEW,", "originalCommit": "f06f9e88cc911583a980ec7150f46c6041e7958a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1NTYwMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446655601", "bodyText": "replaced with ShareUtils.openInBrowser", "author": "TobiGr", "createdAt": "2020-06-28T14:08:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1Mjk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzAzNA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446653034", "bodyText": "final", "author": "wb9688", "createdAt": "2020-06-28T13:45:00Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -365,6 +400,63 @@ private String buildJson() {\n         return \"\";\n     }\n \n+    private String buildMarkdown() {\n+        try {\n+            StringBuilder htmlErrorReport = new StringBuilder();", "originalCommit": "f06f9e88cc911583a980ec7150f46c6041e7958a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzIwMA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446653200", "bodyText": "\"an\", not \"on\"", "author": "wb9688", "createdAt": "2020-06-28T13:46:30Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -281,6 +279,39 @@ public boolean onOptionsItemSelected(final MenuItem item) {\n         return false;\n     }\n \n+    private void openPrivacyPolicyDialog(final Context context, final String action) {\n+        new AlertDialog.Builder(context)\n+                .setIcon(android.R.drawable.ic_dialog_alert)\n+                .setTitle(R.string.privacy_policy_title)\n+                .setMessage(R.string.start_accept_privacy_policy)\n+                .setCancelable(false)\n+                .setNeutralButton(R.string.read_privacy_policy, (dialog, which) -> {\n+                    Intent webIntent = new Intent(Intent.ACTION_VIEW,\n+                            Uri.parse(context.getString(R.string.privacy_policy_url))\n+                    );\n+                    context.startActivity(webIntent);\n+                })\n+                .setPositiveButton(R.string.accept, (dialog, which) -> {\n+                    if (action.equals(\"EMAIL\")) { // send on email", "originalCommit": "f06f9e88cc911583a980ec7150f46c6041e7958a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzQyOTYwMQ==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r447429601", "bodyText": "or \"via\"/\"through\"", "author": "opusforlife2", "createdAt": "2020-06-30T06:02:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzIwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzI3Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446653276", "bodyText": "final", "author": "wb9688", "createdAt": "2020-06-28T13:47:14Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -205,40 +215,28 @@ protected void onCreate(final Bundle savedInstanceState) {\n         errorList = intent.getStringArrayExtra(ERROR_LIST);\n \n         // important add guru meditation\n-        addGuruMeditaion();\n+        addGuruMeditation();\n         currentTimeStamp = getCurrentTimeStamp();\n \n-        reportButton.setOnClickListener((View v) -> {\n-            Context context = this;\n-            new AlertDialog.Builder(context)\n-                    .setIcon(android.R.drawable.ic_dialog_alert)\n-                    .setTitle(R.string.privacy_policy_title)\n-                    .setMessage(R.string.start_accept_privacy_policy)\n-                    .setCancelable(false)\n-                    .setNeutralButton(R.string.read_privacy_policy, (dialog, which) -> {\n-                        Intent webIntent = new Intent(Intent.ACTION_VIEW,\n-                                Uri.parse(context.getString(R.string.privacy_policy_url))\n-                        );\n-                        context.startActivity(webIntent);\n-                    })\n-                    .setPositiveButton(R.string.accept, (dialog, which) -> {\n-                        final Intent i = new Intent(Intent.ACTION_SENDTO)\n-                                .setData(Uri.parse(\"mailto:\")) // only email apps should handle this\n-                                .putExtra(Intent.EXTRA_EMAIL, new String[]{ERROR_EMAIL_ADDRESS})\n-                                .putExtra(Intent.EXTRA_SUBJECT, ERROR_EMAIL_SUBJECT)\n-                                .putExtra(Intent.EXTRA_TEXT, buildJson());\n-                        if (i.resolveActivity(getPackageManager()) != null) {\n-                            startActivity(i);\n-                        }\n+        reportEmailButton.setOnClickListener((View v) -> {\n+            openPrivacyPolicyDialog(this, \"EMAIL\");\n+        });\n \n-                    })\n-                    .setNegativeButton(R.string.decline, (dialog, which) -> {\n-                        // do nothing\n-                    })\n-                    .show();\n+        copyButton.setOnClickListener((View v) -> {\n+            ClipboardManager clipboard =", "originalCommit": "f06f9e88cc911583a980ec7150f46c6041e7958a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1NTY1Mg==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446655652", "bodyText": "replaced with ShareUtils.copyToClipboard()", "author": "TobiGr", "createdAt": "2020-06-28T14:08:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzI3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzI4OA==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446653288", "bodyText": "final", "author": "wb9688", "createdAt": "2020-06-28T13:47:20Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -205,40 +215,28 @@ protected void onCreate(final Bundle savedInstanceState) {\n         errorList = intent.getStringArrayExtra(ERROR_LIST);\n \n         // important add guru meditation\n-        addGuruMeditaion();\n+        addGuruMeditation();\n         currentTimeStamp = getCurrentTimeStamp();\n \n-        reportButton.setOnClickListener((View v) -> {\n-            Context context = this;\n-            new AlertDialog.Builder(context)\n-                    .setIcon(android.R.drawable.ic_dialog_alert)\n-                    .setTitle(R.string.privacy_policy_title)\n-                    .setMessage(R.string.start_accept_privacy_policy)\n-                    .setCancelable(false)\n-                    .setNeutralButton(R.string.read_privacy_policy, (dialog, which) -> {\n-                        Intent webIntent = new Intent(Intent.ACTION_VIEW,\n-                                Uri.parse(context.getString(R.string.privacy_policy_url))\n-                        );\n-                        context.startActivity(webIntent);\n-                    })\n-                    .setPositiveButton(R.string.accept, (dialog, which) -> {\n-                        final Intent i = new Intent(Intent.ACTION_SENDTO)\n-                                .setData(Uri.parse(\"mailto:\")) // only email apps should handle this\n-                                .putExtra(Intent.EXTRA_EMAIL, new String[]{ERROR_EMAIL_ADDRESS})\n-                                .putExtra(Intent.EXTRA_SUBJECT, ERROR_EMAIL_SUBJECT)\n-                                .putExtra(Intent.EXTRA_TEXT, buildJson());\n-                        if (i.resolveActivity(getPackageManager()) != null) {\n-                            startActivity(i);\n-                        }\n+        reportEmailButton.setOnClickListener((View v) -> {\n+            openPrivacyPolicyDialog(this, \"EMAIL\");\n+        });\n \n-                    })\n-                    .setNegativeButton(R.string.decline, (dialog, which) -> {\n-                        // do nothing\n-                    })\n-                    .show();\n+        copyButton.setOnClickListener((View v) -> {\n+            ClipboardManager clipboard =\n+                    (ClipboardManager) getSystemService(Context.CLIPBOARD_SERVICE);\n+            ClipData clip = ClipData.newPlainText(", "originalCommit": "f06f9e88cc911583a980ec7150f46c6041e7958a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY1MzM5Ng==", "url": "https://github.com/TeamNewPipe/NewPipe/pull/3579#discussion_r446653396", "bodyText": "final", "author": "wb9688", "createdAt": "2020-06-28T13:48:20Z", "path": "app/src/main/java/org/schabi/newpipe/report/ErrorActivity.java", "diffHunk": "@@ -193,7 +200,10 @@ protected void onCreate(final Bundle savedInstanceState) {\n             actionBar.setDisplayShowTitleEnabled(true);\n         }\n \n-        Button reportButton = findViewById(R.id.errorReportButton);\n+        Button reportEmailButton = findViewById(R.id.errorReportEmailButton);\n+        Button copyButton = findViewById(R.id.errorReportCopyButton);\n+        Button reportGithubButton = findViewById(R.id.errorReportGitHubButton);", "originalCommit": "f06f9e88cc911583a980ec7150f46c6041e7958a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3de5afc68e2ddf98c26b11c229a457d82a5ae3d0", "url": "https://github.com/TeamNewPipe/NewPipe/commit/3de5afc68e2ddf98c26b11c229a457d82a5ae3d0", "message": "Add Markdown export of crash logs\n\nAdd app language as additional debug information to reports", "committedDate": "2020-06-28T14:07:22Z", "type": "commit"}, {"oid": "3de5afc68e2ddf98c26b11c229a457d82a5ae3d0", "url": "https://github.com/TeamNewPipe/NewPipe/commit/3de5afc68e2ddf98c26b11c229a457d82a5ae3d0", "message": "Add Markdown export of crash logs\n\nAdd app language as additional debug information to reports", "committedDate": "2020-06-28T14:07:22Z", "type": "forcePushed"}]}