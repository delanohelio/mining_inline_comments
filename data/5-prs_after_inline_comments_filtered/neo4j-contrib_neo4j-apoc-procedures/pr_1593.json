{"pr_number": 1593, "pr_title": "fixes #1581: Error in query - CALL apoc.schema.nodes()", "pr_createdAt": "2020-07-14T15:52:32Z", "pr_url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1593", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjUxMzE3Mg==", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/pull/1593#discussion_r456513172", "bodyText": "@conker84 I think you said it will work across all versions if we use the procedure approach? If so, let's do that and not bother calling the API in the lines above.", "author": "mneedham", "createdAt": "2020-07-17T15:25:42Z", "path": "src/main/java/apoc/schema/Schemas.java", "diffHunk": "@@ -417,6 +435,20 @@ private IndexConstraintNodeInfo nodeInfoFromIndexDefinition(IndexReference index\n         List<String> properties = new ArrayList<>();\n         Arrays.stream(indexReference.properties()).forEach((i) -> properties.add(tokens.propertyKeyGetName(i)));\n         try {\n+            float populationProgressValue;\n+            try {\n+                final PopulationProgress populationProgress = schemaRead.indexGetPopulationProgress(indexReference);\n+                populationProgressValue = populationProgress.getCompleted() / populationProgress.getTotal() * 100;\n+            } catch (IncompatibleClassChangeError e) {\n+                // Workaround because in Neo4j 3.5.19 we have the following error\n+                // Failed to invoke procedure `apoc.schema.nodes`: Caused by: java.lang.IncompatibleClassChangeError: Found interface org.neo4j.storageengine.api.schema.PopulationProgress, but class was expected\n+                populationProgressValue = db.execute(\"CALL db.indexes() YIELD tokenNames, properties, progress \" +", "originalCommit": "287c1de3fec37270c2c4b172a1b89d1d91281daf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "91327eabf9f41ab0bf12b61def762070ab3a843f", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/91327eabf9f41ab0bf12b61def762070ab3a843f", "message": "fixes #1581: Error in query - CALL apoc.schema.nodes()", "committedDate": "2020-07-20T12:02:48Z", "type": "commit"}, {"oid": "91327eabf9f41ab0bf12b61def762070ab3a843f", "url": "https://github.com/neo4j-contrib/neo4j-apoc-procedures/commit/91327eabf9f41ab0bf12b61def762070ab3a843f", "message": "fixes #1581: Error in query - CALL apoc.schema.nodes()", "committedDate": "2020-07-20T12:02:48Z", "type": "forcePushed"}]}