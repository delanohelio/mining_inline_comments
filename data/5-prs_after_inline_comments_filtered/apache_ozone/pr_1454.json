{"pr_number": 1454, "pr_title": "HDDS-4285. Read is slow due to frequent calls to UGI.getCurrentUser() and getTokens()", "pr_createdAt": "2020-09-29T14:46:50Z", "pr_url": "https://github.com/apache/ozone/pull/1454", "timeline": [{"oid": "86dbee8807cf5f049ef11278ddd8f63cb0801819", "url": "https://github.com/apache/ozone/commit/86dbee8807cf5f049ef11278ddd8f63cb0801819", "message": "HDDS-4285. Read is slow due to the frequent usage of UGI.getCurrentUserCall()", "committedDate": "2020-09-28T15:56:19Z", "type": "commit"}, {"oid": "32387fcaf07af13a71fa4fca000868fc3eaac920", "url": "https://github.com/apache/ozone/commit/32387fcaf07af13a71fa4fca000868fc3eaac920", "message": "Fix read path", "committedDate": "2020-09-28T18:16:34Z", "type": "commit"}, {"oid": "980842eb0f1377d87decf3fe638fb4874a658830", "url": "https://github.com/apache/ozone/commit/980842eb0f1377d87decf3fe638fb4874a658830", "message": "trigger new CI check", "committedDate": "2020-09-29T08:53:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxOTY3MA==", "url": "https://github.com/apache/ozone/pull/1454#discussion_r496819670", "bodyText": "Can we update the javadoc comment of this method as we new added param tokens here?\nThe same suggestion for methods we changed below:\n\nputBlockAsync\nreadChunk\nwriteChunkAsync", "author": "linyiqun", "createdAt": "2020-09-29T15:33:17Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/hdds/scm/storage/ContainerProtocolCalls.java", "diffHunk": "@@ -84,7 +86,8 @@ private ContainerProtocolCalls() {\n    * @throws IOException if there is an I/O error while performing the call\n    */\n   public static GetBlockResponseProto getBlock(XceiverClientSpi xceiverClient,\n-      DatanodeBlockID datanodeBlockID) throws IOException {\n+      DatanodeBlockID datanodeBlockID,\n+      Collection<Token<? extends TokenIdentifier>> tokens) throws IOException {", "originalCommit": "980842eb0f1377d87decf3fe638fb4874a658830", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg4OTgxNg==", "url": "https://github.com/apache/ozone/pull/1454#discussion_r496889816", "bodyText": "Thanks @linyiqun for the suggestion.  Would\n@param tokens list of tokens the current user has, possibly including a token for this block\nbe OK, or do you have a better description for this param?", "author": "adoroszlai", "createdAt": "2020-09-29T16:47:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxOTY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzE5OTQ5NA==", "url": "https://github.com/apache/ozone/pull/1454#discussion_r497199494", "bodyText": "@adoroszlai , above description looks good to me. Thanks.", "author": "linyiqun", "createdAt": "2020-09-30T01:53:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxOTY3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzY0MTQ0Nw==", "url": "https://github.com/apache/ozone/pull/1454#discussion_r497641447", "bodyText": "We can directly encode the pass in token for the specific block id without additional token selection.", "author": "xiaoyuyao", "createdAt": "2020-09-30T16:24:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjgxOTY3MA=="}], "type": "inlineReview"}, {"oid": "3fd7d07b7d35d2060db5ea5ce1bdfe3fac8e63c1", "url": "https://github.com/apache/ozone/commit/3fd7d07b7d35d2060db5ea5ce1bdfe3fac8e63c1", "message": "Add javadoc for new param", "committedDate": "2020-09-30T09:15:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYzNjYxMw==", "url": "https://github.com/apache/ozone/pull/1454#discussion_r497636613", "bodyText": "Should we just pass down the token from the caller directly and bypass the UGI addToken/getTokens completely?", "author": "xiaoyuyao", "createdAt": "2020-09-30T16:17:01Z", "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/storage/BlockInputStream.java", "diffHunk": "@@ -193,10 +196,11 @@ public synchronized void initialize() throws IOException {\n       if (token != null) {\n         UserGroupInformation.getCurrentUser().addToken(token);", "originalCommit": "3fd7d07b7d35d2060db5ea5ce1bdfe3fac8e63c1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e05eb00f091c77920d1e6e5f0e06762bca398e3f", "url": "https://github.com/apache/ozone/commit/e05eb00f091c77920d1e6e5f0e06762bca398e3f", "message": "HDDS-4285. Directly pass block token", "committedDate": "2020-10-08T08:58:23Z", "type": "commit"}, {"oid": "5617fac3d612457c776ef0b4dac422648ed5e4fb", "url": "https://github.com/apache/ozone/commit/5617fac3d612457c776ef0b4dac422648ed5e4fb", "message": "Merge remote-tracking branch 'origin/master' into HDDS-4285", "committedDate": "2020-10-08T12:09:13Z", "type": "commit"}]}