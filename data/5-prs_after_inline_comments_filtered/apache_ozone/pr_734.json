{"pr_number": 734, "pr_title": "HDDS-3240. Improve write efficiency by creating container in parallel", "pr_createdAt": "2020-03-29T02:54:59Z", "pr_url": "https://github.com/apache/ozone/pull/734", "timeline": [{"oid": "3ca3e738274211b52ad8a0b594b8bd6b351e6c06", "url": "https://github.com/apache/ozone/commit/3ca3e738274211b52ad8a0b594b8bd6b351e6c06", "message": "HDDS-3240. Improve write efficiency by creating container in parallel", "committedDate": "2020-03-29T02:43:03Z", "type": "commit"}, {"oid": "060df37309c39874b905a14d77f9f0558f7e7b74", "url": "https://github.com/apache/ozone/commit/060df37309c39874b905a14d77f9f0558f7e7b74", "message": "add config in ozone-default.xml", "committedDate": "2020-03-29T06:06:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NjAwMg==", "url": "https://github.com/apache/ozone/pull/734#discussion_r399776002", "bodyText": "Instead of introducing another set of executors for read chunk operation, can the cache lookup be executed in the per-container executor returned by getCommandExecutor?", "author": "adoroszlai", "createdAt": "2020-03-29T10:18:16Z", "path": "hadoop-hdds/container-service/src/main/java/org/apache/hadoop/ozone/container/common/transport/server/ratis/ContainerStateMachine.java", "diffHunk": "@@ -664,12 +689,12 @@ private ByteString getCachedStateMachineData(Long logIndex, long term,\n             future.complete(\n                 getCachedStateMachineData(entry.getIndex(), entry.getTerm(),\n                     requestProto));\n-          } catch (IOException e) {\n+          } catch (Exception e) {\n             metrics.incNumReadStateMachineFails();\n             future.completeExceptionally(e);\n           }\n           return future;\n-        }, getChunkExecutor(requestProto.getWriteChunk()));\n+        }, getReadChunkExecutor(requestProto.getWriteChunk()));", "originalCommit": "060df37309c39874b905a14d77f9f0558f7e7b74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk0NjYzOA==", "url": "https://github.com/apache/ozone/pull/734#discussion_r399946638", "bodyText": "@adoroszlai  Thank you very much. I will try it.", "author": "runzhiwang", "createdAt": "2020-03-30T06:09:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NjAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDY2MTkzMw==", "url": "https://github.com/apache/ozone/pull/734#discussion_r400661933", "bodyText": "I think, lookUp from the cache can be done in the same thread where readStateMachineData is called. I don't think there is a need here to delegate the cache lookup to a different thread. Reading and writing from the disk can be done using the same set of chunk executor threads.", "author": "bshashikant", "createdAt": "2020-03-31T06:02:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NjAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDg5MDI0OA==", "url": "https://github.com/apache/ozone/pull/734#discussion_r400890248", "bodyText": "@adoroszlai  How do you think of @bshashikant 's advice ? I think it's also reasonable, because lookup from cache is so fast, there is no need to do it in another thread.", "author": "runzhiwang", "createdAt": "2020-03-31T12:55:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NjAwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTUyNzU2NA==", "url": "https://github.com/apache/ozone/pull/734#discussion_r401527564", "bodyText": "Sounds good.", "author": "adoroszlai", "createdAt": "2020-04-01T10:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTc3NjAwMg=="}], "type": "inlineReview"}, {"oid": "98916bb1961a777e412fc82697607a24d45606d2", "url": "https://github.com/apache/ozone/commit/98916bb1961a777e412fc82697607a24d45606d2", "message": "fix code review", "committedDate": "2020-04-02T00:42:37Z", "type": "commit"}, {"oid": "b006cad7f4d39c66c3e4bfb6a64c3361a44e3ea3", "url": "https://github.com/apache/ozone/commit/b006cad7f4d39c66c3e4bfb6a64c3361a44e3ea3", "message": "retrigger build with empty commit", "committedDate": "2020-04-02T02:12:01Z", "type": "commit"}, {"oid": "eaebd38b68e06235d42b107f61cef81c8a511834", "url": "https://github.com/apache/ozone/commit/eaebd38b68e06235d42b107f61cef81c8a511834", "message": "retrigger build with empty commit", "committedDate": "2020-04-02T09:37:53Z", "type": "commit"}]}