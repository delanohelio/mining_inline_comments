{"pr_number": 512, "pr_title": "HDDS-2959. Handle replay of OM Key ACL requests", "pr_createdAt": "2020-01-30T23:44:37Z", "pr_url": "https://github.com/apache/ozone/pull/512", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3NTExMQ==", "url": "https://github.com/apache/ozone/pull/512#discussion_r374275111", "bodyText": "Was this check moved somewhere else?", "author": "arp7", "createdAt": "2020-02-03T18:48:12Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/acl/OMKeyAclResponse.java", "diffHunk": "@@ -36,27 +34,30 @@\n  */\n public class OMKeyAclResponse extends OMClientResponse {\n \n-  private final OmKeyInfo omKeyInfo;\n+  private OmKeyInfo omKeyInfo;\n \n-  public OMKeyAclResponse(@Nullable OmKeyInfo omKeyInfo,\n-      @Nonnull OMResponse omResponse) {\n+  public OMKeyAclResponse(@Nonnull OMResponse omResponse,\n+      @Nonnull OmKeyInfo omKeyInfo) {\n     super(omResponse);\n     this.omKeyInfo = omKeyInfo;\n   }\n \n+  /**\n+   * For when the request is not successful or it is a replay transaction.\n+   * For a successful request, the other constructor should be used.\n+   */\n+  public OMKeyAclResponse(@Nonnull OMResponse omResponse) {\n+    super(omResponse);\n+  }\n+\n   @Override\n   public void addToDBBatch(OMMetadataManager omMetadataManager,\n       BatchOperation batchOperation) throws IOException {\n \n-    // If response status is OK and success is true, add to DB batch.\n-    if (getOMResponse().getStatus() == OzoneManagerProtocolProtos.Status.OK &&", "originalCommit": "cb2bfeb89019796d24d815d246b2d9df02da0f4e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3NjY4MQ==", "url": "https://github.com/apache/ozone/pull/512#discussion_r374276681", "bodyText": "Yes Arpit. OmClientResponse#checkAndUpdateDB() performs this check before calling addToDBBatch(). OMDoubleBuffer now calls checkAndUpdateDB() instead of addToDBBatch() directly.", "author": "hanishakoneru", "createdAt": "2020-02-03T18:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDI3NTExMQ=="}], "type": "inlineReview"}, {"oid": "4fc5e80961bb8514f3d504b75715b56e52a95ed5", "url": "https://github.com/apache/ozone/commit/4fc5e80961bb8514f3d504b75715b56e52a95ed5", "message": "UpdateDB even if applyAcl is false", "committedDate": "2020-02-04T23:36:58Z", "type": "forcePushed"}, {"oid": "096d1210cfb1bf2b683389828120925f58ceb37b", "url": "https://github.com/apache/ozone/commit/096d1210cfb1bf2b683389828120925f58ceb37b", "message": "HDDS-2959. Handle replay of OM Key ACL requests", "committedDate": "2020-02-10T21:15:01Z", "type": "commit"}, {"oid": "6a6cbc3f1176bca892bb3f0aebbcd0ea59831cdf", "url": "https://github.com/apache/ozone/commit/6a6cbc3f1176bca892bb3f0aebbcd0ea59831cdf", "message": "HDDS-2959. Unit test", "committedDate": "2020-02-10T21:15:01Z", "type": "commit"}, {"oid": "6769d73baa88adbc2169ada1ab2eb29c709f9784", "url": "https://github.com/apache/ozone/commit/6769d73baa88adbc2169ada1ab2eb29c709f9784", "message": "Add debug enabled check", "committedDate": "2020-02-10T21:15:01Z", "type": "commit"}, {"oid": "da2d30df20287c14c0f1a9ea785fb14a55da779d", "url": "https://github.com/apache/ozone/commit/da2d30df20287c14c0f1a9ea785fb14a55da779d", "message": "UpdateDB even if applyAcl is false", "committedDate": "2020-02-10T21:15:01Z", "type": "commit"}, {"oid": "2e4ff77baf25577b9658475b8423f0bddb33cad4", "url": "https://github.com/apache/ozone/commit/2e4ff77baf25577b9658475b8423f0bddb33cad4", "message": "Unit test fix", "committedDate": "2020-02-10T21:16:42Z", "type": "commit"}, {"oid": "2e4ff77baf25577b9658475b8423f0bddb33cad4", "url": "https://github.com/apache/ozone/commit/2e4ff77baf25577b9658475b8423f0bddb33cad4", "message": "Unit test fix", "committedDate": "2020-02-10T21:16:42Z", "type": "forcePushed"}, {"oid": "c2f489d7d90a931ab1911e632beb025844a54ff0", "url": "https://github.com/apache/ozone/commit/c2f489d7d90a931ab1911e632beb025844a54ff0", "message": "rebase", "committedDate": "2020-02-10T21:18:23Z", "type": "commit"}]}