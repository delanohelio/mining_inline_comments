{"pr_number": 1595, "pr_title": "HDDS-4468. Fix Goofys listBucket large than 1000 objects will stuck forever", "pr_createdAt": "2020-11-16T16:57:15Z", "pr_url": "https://github.com/apache/ozone/pull/1595", "timeline": [{"oid": "b48ed3c05cd81018643ab8832b98b0cbdeb68fb0", "url": "https://github.com/apache/ozone/commit/b48ed3c05cd81018643ab8832b98b0cbdeb68fb0", "message": "HDDS-4468. Fix Goofys listBucket large than 1000 objects will stuck forever", "committedDate": "2020-11-16T16:50:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc3NzU5NQ==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r524777595", "bodyText": "We need some comments here.", "author": "runzhiwang", "createdAt": "2020-11-16T23:57:46Z", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,9 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    if (startAfter == null) {", "originalCommit": "b48ed3c05cd81018643ab8832b98b0cbdeb68fb0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk3NTM1MQ==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r524975351", "bodyText": "Done.", "author": "maobaolong", "createdAt": "2020-11-17T08:41:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc3NzU5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYyNjY4NQ==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r525626685", "bodyText": "What do you mean \"stand for startAfter\" ? I think we can comment why we need set startAfter with marker.", "author": "runzhiwang", "createdAt": "2020-11-18T01:02:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDc3NzU5NQ=="}], "type": "inlineReview"}, {"oid": "2fa1b3a63e05949e464e6605902fe1de0d18e320", "url": "https://github.com/apache/ozone/commit/2fa1b3a63e05949e464e6605902fe1de0d18e320", "message": "HDDS-4468. Add necessary comments", "committedDate": "2020-11-17T08:41:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY3NDYyNw==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r525674627", "bodyText": "LGTM\n// Set nextMarker to be lastKey. for the compatibility  of aws api v1,", "author": "GlenGeng", "createdAt": "2020-11-18T02:40:08Z", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -187,6 +191,8 @@ public Response list(\n       response.setTruncated(true);\n       ContinueToken nextToken = new ContinueToken(lastKey, prevDir);\n       response.setNextToken(nextToken.encodeToString());\n+      // For aws api v1 compatibility purpose, set nextMarker with lastKey", "originalCommit": "2fa1b3a63e05949e464e6605902fe1de0d18e320", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTkwMTQ4NA==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r525901484", "bodyText": "Done.", "author": "maobaolong", "createdAt": "2020-11-18T08:35:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTY3NDYyNw=="}], "type": "inlineReview"}, {"oid": "5c77886134e2bd039703fb4c8bbfd62edb636e58", "url": "https://github.com/apache/ozone/commit/5c77886134e2bd039703fb4c8bbfd62edb636e58", "message": "HDDS-4468. Update comments.", "committedDate": "2020-11-18T08:35:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526657800", "bodyText": "After startAfter = marker, could startAfter be null?\nWe may remove duplicated check for startAfter after this null checker.", "author": "timmylicheng", "createdAt": "2020-11-19T07:55:33Z", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // stand for startAfter\n+    if (startAfter == null) {\n+      startAfter = marker;\n+    }", "originalCommit": "5c77886134e2bd039703fb4c8bbfd62edb636e58", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY2MzQzOQ==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526663439", "bodyText": "@timmylicheng Thanks for your review.\nthe marker can be null, so the startAfter can be null, although we assigned the marker value to startAfter.", "author": "maobaolong", "createdAt": "2020-11-19T08:07:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjcwOTQxNA==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526709414", "bodyText": "So why do we put marker to startAfter when it's null? Maybe it would be great to have comments to explain this. :)", "author": "timmylicheng", "createdAt": "2020-11-19T09:23:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc3NjM3Nw==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r526776377", "bodyText": "@timmylicheng\nOK, I add a null checker, assign marker to startAfter only when marker != null.\nPTAL.", "author": "maobaolong", "createdAt": "2020-11-19T11:06:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjY1NzgwMA=="}], "type": "inlineReview"}, {"oid": "0e57920f605206effc29e9025209e68c2bb9f344", "url": "https://github.com/apache/ozone/commit/0e57920f605206effc29e9025209e68c2bb9f344", "message": "Address comments.", "committedDate": "2020-11-19T11:01:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA0NDk0OQ==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r528044949", "bodyText": "Below we are not setting marker should we also set that also, if the marker is not null?\nL136: response.setMarker(\"\");", "author": "bharatviswa504", "createdAt": "2020-11-21T01:07:11Z", "path": "hadoop-ozone/s3gateway/src/main/java/org/apache/hadoop/ozone/s3/endpoint/BucketEndpoint.java", "diffHunk": "@@ -112,6 +112,10 @@ public Response list(\n     ContinueToken decodedToken =\n         ContinueToken.decodeFromString(continueToken);\n \n+    // Assign marker to startAfter. for the compatibility of aws api v1\n+    if (startAfter == null && marker != null) {", "originalCommit": "0e57920f605206effc29e9025209e68c2bb9f344", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODQ0MjAxMg==", "url": "https://github.com/apache/ozone/pull/1595#discussion_r528442012", "bodyText": "Done.", "author": "maobaolong", "createdAt": "2020-11-23T02:01:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODA0NDk0OQ=="}], "type": "inlineReview"}, {"oid": "008c372098aebb77eb8b14a161692416a8330e48", "url": "https://github.com/apache/ozone/commit/008c372098aebb77eb8b14a161692416a8330e48", "message": "set marker to response also when not null", "committedDate": "2020-11-23T02:00:52Z", "type": "commit"}]}