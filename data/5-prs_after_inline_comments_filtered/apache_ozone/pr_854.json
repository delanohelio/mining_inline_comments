{"pr_number": 854, "pr_title": "HDDS-3393. Recon throws NPE in clusterState endpoint", "pr_createdAt": "2020-04-21T18:00:08Z", "pr_url": "https://github.com/apache/ozone/pull/854", "timeline": [{"oid": "77ad175837f336c844241354711af70f51044763", "url": "https://github.com/apache/ozone/commit/77ad175837f336c844241354711af70f51044763", "message": "HDDS-3393. Recon throws NPE in clusterState endpoint", "committedDate": "2020-04-21T17:55:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NTQwNg==", "url": "https://github.com/apache/ozone/pull/854#discussion_r412395406", "bodyText": "Instead of not null checks, can we have a state in MetadataManager like INITIALIZED, STOPPED? This will help be future proof, and if anywhere this check is required it will be generic to use state, instead of not null check", "author": "bharatviswa504", "createdAt": "2020-04-21T18:32:12Z", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/api/ClusterStateEndpoint.java", "diffHunk": "@@ -81,20 +82,26 @@ public Response getClusterState() {\n             stats.getScmUsed().get(), stats.getRemaining().get());\n     ClusterStateResponse.Builder builder = ClusterStateResponse.newBuilder();\n     try {\n-      builder.setVolumes(\n-          omMetadataManager.getVolumeTable().getEstimatedKeyCount());\n+      Table volumeTable = omMetadataManager.getVolumeTable();", "originalCommit": "77ad175837f336c844241354711af70f51044763", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjQxMjIyNQ==", "url": "https://github.com/apache/ozone/pull/854#discussion_r412412225", "bodyText": "Thanks for the review! I added a boolean flag to keep track of the initialized state to ReconOMMetadataManager.", "author": "vivekratnavel", "createdAt": "2020-04-21T18:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjM5NTQwNg=="}], "type": "inlineReview"}, {"oid": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e", "url": "https://github.com/apache/ozone/commit/8aa1ea9a7bc90013ee3496f09690b048c2e61e8e", "message": "Fix review comments.", "committedDate": "2020-04-21T18:56:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzNzY3NQ==", "url": "https://github.com/apache/ozone/pull/854#discussion_r412537675", "bodyText": "Minor NIT: return true if OM Tables are initialized, otherwise false.", "author": "bharatviswa504", "createdAt": "2020-04-21T22:34:54Z", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/recovery/ReconOMMetadataManager.java", "diffHunk": "@@ -41,4 +41,10 @@\n    * Database.\n    */\n   long getLastSequenceNumberFromDB();\n+\n+  /**\n+   * Check if OM tables are initialized.\n+   * @return if OM Tables are initialized", "originalCommit": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUzNzkwNA==", "url": "https://github.com/apache/ozone/pull/854#discussion_r412537904", "bodyText": "Missed @override notion, and same comment as above related to Javadoc or it can be completely removed.", "author": "bharatviswa504", "createdAt": "2020-04-21T22:35:29Z", "path": "hadoop-ozone/recon/src/main/java/org/apache/hadoop/ozone/recon/recovery/ReconOmMetadataManagerImpl.java", "diffHunk": "@@ -120,4 +122,11 @@ public long getLastSequenceNumberFromDB() {\n     }\n   }\n \n+  /**\n+   * Check if OM tables are initialized.\n+   * @return if OM Tables are initialized\n+   */\n+  public boolean isOmTablesInitialized() {", "originalCommit": "8aa1ea9a7bc90013ee3496f09690b048c2e61e8e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b3a3c2cfdb17d763372ca9e62d248ba7c2902206", "url": "https://github.com/apache/ozone/commit/b3a3c2cfdb17d763372ca9e62d248ba7c2902206", "message": "Fix review comments.", "committedDate": "2020-04-21T22:46:52Z", "type": "commit"}]}