{"pr_number": 1301, "pr_title": "HDDS-3882. Update modification time when updating volume/bucket/key ACLs", "pr_createdAt": "2020-08-07T09:20:30Z", "pr_url": "https://github.com/apache/ozone/pull/1301", "timeline": [{"oid": "03bc16512a0dfe40c784c5dbd66079d48f8a96b0", "url": "https://github.com/apache/ozone/commit/03bc16512a0dfe40c784c5dbd66079d48f8a96b0", "message": "renew modification after true operation result", "committedDate": "2020-09-03T18:09:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NDM0MA==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r503654340", "bodyText": "if you don't call .build() hereon line 68, we can avoid the unnecessary  toBuilder() conversion on line 71.", "author": "xiaoyuyao", "createdAt": "2020-10-13T04:04:05Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/acl/OMBucketAddAclRequest.java", "diffHunk": "@@ -58,6 +60,19 @@\n     };\n   }\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.AddAclRequest addAclRequest =\n+        getOmRequest().getAddAclRequest().toBuilder()\n+            .setModificationTime(modificationTime).build();", "originalCommit": "06cb9f0a5c14ece512d409b282e825b1eca88f46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NDM5OA==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r503654398", "bodyText": "same as above.", "author": "xiaoyuyao", "createdAt": "2020-10-13T04:04:25Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/acl/OMBucketRemoveAclRequest.java", "diffHunk": "@@ -55,6 +57,19 @@\n     };\n   }\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.RemoveAclRequest removeAclRequest =\n+        getOmRequest().getRemoveAclRequest().toBuilder()", "originalCommit": "06cb9f0a5c14ece512d409b282e825b1eca88f46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzY1NDQ0Mg==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r503654442", "bodyText": "same as above.", "author": "xiaoyuyao", "createdAt": "2020-10-13T04:04:39Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/bucket/acl/OMBucketSetAclRequest.java", "diffHunk": "@@ -55,6 +57,19 @@\n     };\n   }\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.SetAclRequest setAclRequest =\n+        getOmRequest().getSetAclRequest().toBuilder()", "originalCommit": "06cb9f0a5c14ece512d409b282e825b1eca88f46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cc16d2672ab75afa5a375f2d6b351e74b1e31cbf", "url": "https://github.com/apache/ozone/commit/cc16d2672ab75afa5a375f2d6b351e74b1e31cbf", "message": "update modification time when updating volume ACLs", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "4e10ea82910a711caaf484c2eeb91767307703f5", "url": "https://github.com/apache/ozone/commit/4e10ea82910a711caaf484c2eeb91767307703f5", "message": "add UT corresponding to modification time updating in Volume ACLs", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "ee9c7f0b17c4f1c37d331ae00a87a74510f7e1fe", "url": "https://github.com/apache/ozone/commit/ee9c7f0b17c4f1c37d331ae00a87a74510f7e1fe", "message": "update modification time when updating bucket ACLs", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "25ae6308a98dc72420eec1cea395b63551581f2d", "url": "https://github.com/apache/ozone/commit/25ae6308a98dc72420eec1cea395b63551581f2d", "message": "add UT corresponding to modification time updating in Bucket ACLs", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "1649c5f4085c9d079a465d5daec6b128dc7e5934", "url": "https://github.com/apache/ozone/commit/1649c5f4085c9d079a465d5daec6b128dc7e5934", "message": "set the initial value", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "ca455cf030e5b61a5e15c4eeb10e060d4d6338dd", "url": "https://github.com/apache/ozone/commit/ca455cf030e5b61a5e15c4eeb10e060d4d6338dd", "message": "update modification time when updating key ACLs", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "708e18246e66926500b3480a413eb7a011d081d7", "url": "https://github.com/apache/ozone/commit/708e18246e66926500b3480a413eb7a011d081d7", "message": "add UT corresponding to modification time updating in Key ACLs", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "f50549388978fc4078483ecc2e0bca5aba3a49c7", "url": "https://github.com/apache/ozone/commit/f50549388978fc4078483ecc2e0bca5aba3a49c7", "message": "simplify the pre-setting", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "bd3e68b44ea1a8e466c6e563e6ce99342db12eb2", "url": "https://github.com/apache/ozone/commit/bd3e68b44ea1a8e466c6e563e6ce99342db12eb2", "message": "renew modification after true operation result", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "7444c8b9db53577457e6f680d3436f95cfc7fe55", "url": "https://github.com/apache/ozone/commit/7444c8b9db53577457e6f680d3436f95cfc7fe55", "message": "add the missed preExecute()", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "url": "https://github.com/apache/ozone/commit/65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "message": "avoid unnecessary call of toBuilder", "committedDate": "2020-10-19T06:56:04Z", "type": "commit"}, {"oid": "65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "url": "https://github.com/apache/ozone/commit/65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "message": "avoid unnecessary call of toBuilder", "committedDate": "2020-10-19T06:56:04Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4NjQ0Mw==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r510486443", "bodyText": "This has the same toBuilder=>build=>toBuilder issue.", "author": "xiaoyuyao", "createdAt": "2020-10-22T22:09:17Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/acl/OMKeyAddAclRequest.java", "diffHunk": "@@ -43,6 +45,19 @@\n   private static final Logger LOG =\n       LoggerFactory.getLogger(OMKeyAddAclRequest.class);\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.AddAclRequest addAclRequest =\n+        getOmRequest().getAddAclRequest().toBuilder()\n+        .setModificationTime(modificationTime).build();", "originalCommit": "65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4NjU0NA==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r510486544", "bodyText": "Same as above.", "author": "xiaoyuyao", "createdAt": "2020-10-22T22:09:33Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/acl/OMKeyRemoveAclRequest.java", "diffHunk": "@@ -43,6 +45,19 @@\n   private static final Logger LOG =\n       LoggerFactory.getLogger(OMKeyRemoveAclRequest.class);\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.RemoveAclRequest removeAclRequest =\n+        getOmRequest().getRemoveAclRequest().toBuilder()\n+            .setModificationTime(modificationTime).build();", "originalCommit": "65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4Njc4Nw==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r510486787", "bodyText": "Same as above. Sorry, I did not explicitly comment all on this.", "author": "xiaoyuyao", "createdAt": "2020-10-22T22:10:13Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/key/acl/OMKeySetAclRequest.java", "diffHunk": "@@ -44,6 +46,19 @@\n   private static final Logger LOG =\n       LoggerFactory.getLogger(OMKeySetAclRequest.class);\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.SetAclRequest setAclRequest =\n+        getOmRequest().getSetAclRequest().toBuilder()", "originalCommit": "65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ4Njk5MA==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r510486990", "bodyText": "Same as above.", "author": "xiaoyuyao", "createdAt": "2020-10-22T22:10:39Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/volume/acl/OMVolumeAddAclRequest.java", "diffHunk": "@@ -48,6 +50,19 @@\n     volumeAddAclOp = (acls, volArgs) -> volArgs.addAcl(acls.get(0));\n   }\n \n+  @Override\n+  public OMRequest preExecute(OzoneManager ozoneManager) throws IOException {\n+    long modificationTime = Time.now();\n+    OzoneManagerProtocolProtos.AddAclRequest addAclRequest =\n+        getOmRequest().getAddAclRequest().toBuilder()", "originalCommit": "65b26d48d7437a119bf60a3fbdc79d1ca18f9687", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "16070dfae4d3a822e234f82f81ebf9e2aebecebd", "url": "https://github.com/apache/ozone/commit/16070dfae4d3a822e234f82f81ebf9e2aebecebd", "message": "avoid unnecessary call of toBuilder in VolumeAclRequest", "committedDate": "2020-10-24T08:24:20Z", "type": "commit"}, {"oid": "cb0537459d6a85e30d675a362e263f42354fbf24", "url": "https://github.com/apache/ozone/commit/cb0537459d6a85e30d675a362e263f42354fbf24", "message": "avoid unnecessary call of toBuilder in KeyAclRequest", "committedDate": "2020-10-24T08:26:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTQ4NDIxNg==", "url": "https://github.com/apache/ozone/pull/1301#discussion_r511484216", "bodyText": "nit: redundant line", "author": "cxorm", "createdAt": "2020-10-24T15:32:26Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/request/volume/acl/OMVolumeAclRequest.java", "diffHunk": "@@ -84,6 +84,7 @@ public OMClientResponse validateAndUpdateCache(OzoneManager ozoneManager,\n           VOLUME_LOCK, volume);\n       omVolumeArgs = getVolumeInfo(omMetadataManager, volume);\n \n+", "originalCommit": "cb0537459d6a85e30d675a362e263f42354fbf24", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c2bb0374d75dd2d589e5a742de6bffe46df269f7", "url": "https://github.com/apache/ozone/commit/c2bb0374d75dd2d589e5a742de6bffe46df269f7", "message": "remove redundant line", "committedDate": "2020-10-24T15:39:51Z", "type": "commit"}]}