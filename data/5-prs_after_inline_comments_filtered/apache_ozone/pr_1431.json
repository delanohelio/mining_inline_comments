{"pr_number": 1431, "pr_title": "HDDS-4254. Bucket space: add usedBytes and update it when create and delete key.", "pr_createdAt": "2020-09-17T02:39:45Z", "pr_url": "https://github.com/apache/ozone/pull/1431", "timeline": [{"oid": "cc59b671677cf0cb243065f7e6ca82458472f764", "url": "https://github.com/apache/ozone/commit/cc59b671677cf0cb243065f7e6ca82458472f764", "message": "add usedBytes to Bucket.", "committedDate": "2020-09-16T14:44:59Z", "type": "commit"}, {"oid": "99304b307551dc1e5aa418c4d83f3820416bb452", "url": "https://github.com/apache/ozone/commit/99304b307551dc1e5aa418c4d83f3820416bb452", "message": "fix checkstyle", "committedDate": "2020-09-17T02:22:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxNDQxNg==", "url": "https://github.com/apache/ozone/pull/1431#discussion_r492614416", "bodyText": "the last two lines can be merged into one line.", "author": "ChenSammi", "createdAt": "2020-09-22T09:59:24Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/OMAllocateBlockResponse.java", "diffHunk": "@@ -72,5 +76,10 @@ public void addToDBBatch(OMMetadataManager omMetadataManager,\n     omMetadataManager.getVolumeTable().putWithBatch(batchOperation,\n         omMetadataManager.getVolumeKey(omVolumeArgs.getVolume()),\n         omVolumeArgs);\n+    // update bucket usedBytes.\n+    omMetadataManager.getBucketTable().putWithBatch(batchOperation,\n+        omMetadataManager.getBucketKey(omVolumeArgs.getVolume(),\n+            omBucketInfo.getBucketName()),\n+        omBucketInfo);", "originalCommit": "99304b307551dc1e5aa418c4d83f3820416bb452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxNDYzMQ==", "url": "https://github.com/apache/ozone/pull/1431#discussion_r492614631", "bodyText": "same as above.", "author": "ChenSammi", "createdAt": "2020-09-22T09:59:46Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/OMKeyCommitResponse.java", "diffHunk": "@@ -77,6 +80,11 @@ public void addToDBBatch(OMMetadataManager omMetadataManager,\n     omMetadataManager.getVolumeTable().putWithBatch(batchOperation,\n         omMetadataManager.getVolumeKey(omVolumeArgs.getVolume()),\n         omVolumeArgs);\n+    // update bucket usedBytes.\n+    omMetadataManager.getBucketTable().putWithBatch(batchOperation,\n+        omMetadataManager.getBucketKey(omVolumeArgs.getVolume(),\n+            omBucketInfo.getBucketName()),\n+        omBucketInfo);", "originalCommit": "99304b307551dc1e5aa418c4d83f3820416bb452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MjYxNDg4MQ==", "url": "https://github.com/apache/ozone/pull/1431#discussion_r492614881", "bodyText": "the same. please double check the rest files.", "author": "ChenSammi", "createdAt": "2020-09-22T10:00:10Z", "path": "hadoop-ozone/ozone-manager/src/main/java/org/apache/hadoop/ozone/om/response/key/OMKeyCreateResponse.java", "diffHunk": "@@ -99,6 +103,11 @@ protected void addToDBBatch(OMMetadataManager omMetadataManager,\n     omMetadataManager.getVolumeTable().putWithBatch(batchOperation,\n         omMetadataManager.getVolumeKey(omVolumeArgs.getVolume()),\n         omVolumeArgs);\n+    // update bucket usedBytes.\n+    omMetadataManager.getBucketTable().putWithBatch(batchOperation,\n+        omMetadataManager.getBucketKey(omVolumeArgs.getVolume(),\n+            omBucketInfo.getBucketName()),\n+        omBucketInfo);", "originalCommit": "99304b307551dc1e5aa418c4d83f3820416bb452", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e89af69541ecb7dacbefebacc36c883bb0ab7178", "url": "https://github.com/apache/ozone/commit/e89af69541ecb7dacbefebacc36c883bb0ab7178", "message": "fix code style", "committedDate": "2020-09-23T03:45:54Z", "type": "commit"}]}