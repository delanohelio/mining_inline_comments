{"pr_number": 942, "pr_title": "HDDS-2556. Handle InterruptedException in BlockOutputStream", "pr_createdAt": "2020-05-19T03:02:03Z", "pr_url": "https://github.com/apache/ozone/pull/942", "timeline": [{"oid": "4728db123281dcca0b568656d2e8fc49f0ed2c9a", "url": "https://github.com/apache/ozone/commit/4728db123281dcca0b568656d2e8fc49f0ed2c9a", "message": "HDDS-2556. Handle InterruptedException in BlockOutputStream", "committedDate": "2020-05-19T03:00:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2MTk3OQ==", "url": "https://github.com/apache/ozone/pull/942#discussion_r428361979", "bodyText": "Same code is in multiple places, can we have short utility to do all these in that. So, this will avoid code smell in sonar.", "author": "bharatviswa504", "createdAt": "2020-05-20T23:22:30Z", "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/storage/BlockOutputStream.java", "diffHunk": "@@ -317,10 +317,16 @@ private void handleFullBuffer() throws IOException {\n       if (!commitWatcher.getFutureMap().isEmpty()) {\n         waitOnFlushFutures();\n       }\n-    } catch (InterruptedException | ExecutionException e) {\n+    } catch (ExecutionException e) {\n       setIoException(e);\n       adjustBuffersOnException();\n       throw getIoException();\n+    } catch (InterruptedException ex) {\n+      LOG.error(\"Command execution was interrupted.\");\n+      Thread.currentThread().interrupt();\n+      setIoException(ex);\n+      adjustBuffersOnException();", "originalCommit": "4728db123281dcca0b568656d2e8fc49f0ed2c9a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQyNDYwMA==", "url": "https://github.com/apache/ozone/pull/942#discussion_r428424600", "bodyText": "@bharatviswa504  I have tried to move the duplicate lines to separate method and also perform other cleanups.\nAt the very least, the thread interrupt must be done in the catch block and not in a separate method being called from the catch block. So, the thread.interrupt() is the only line that cannot be avoided from being duplicated.", "author": "dineshchitlangia", "createdAt": "2020-05-21T03:24:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODM2MTk3OQ=="}], "type": "inlineReview"}, {"oid": "2cdfc37e70e19e43f35608a30b8ac040b7cf7448", "url": "https://github.com/apache/ozone/commit/2cdfc37e70e19e43f35608a30b8ac040b7cf7448", "message": "addressed review comments", "committedDate": "2020-05-21T03:22:44Z", "type": "commit"}, {"oid": "5f5f5e3a3c4cbf46ded06843178be01e9954305f", "url": "https://github.com/apache/ozone/commit/5f5f5e3a3c4cbf46ded06843178be01e9954305f", "message": "simplified parameters", "committedDate": "2020-05-21T03:38:11Z", "type": "commit"}, {"oid": "13b01eebc4cc3aa734a7bb28584070bcc03fe5e1", "url": "https://github.com/apache/ozone/commit/13b01eebc4cc3aa734a7bb28584070bcc03fe5e1", "message": "removed unused import", "committedDate": "2020-05-21T03:42:45Z", "type": "commit"}, {"oid": "cbd320ef9e7523020d76d05d73047351b4b0d278", "url": "https://github.com/apache/ozone/commit/cbd320ef9e7523020d76d05d73047351b4b0d278", "message": "Avoid autounboxing", "committedDate": "2020-05-21T04:19:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkwNTMyMQ==", "url": "https://github.com/apache/ozone/pull/942#discussion_r428905321", "bodyText": "Minor NIT: variable name is called skipExecutionException, but when true, we are handling ExecutionException. I think it should be viceversa.", "author": "bharatviswa504", "createdAt": "2020-05-21T20:47:20Z", "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/storage/BlockOutputStream.java", "diffHunk": "@@ -654,4 +662,34 @@ private void writeChunkToContainer(ChunkBuffer chunk) throws IOException {\n   public void setXceiverClient(XceiverClientSpi xceiverClient) {\n     this.xceiverClient = xceiverClient;\n   }\n+\n+  /**\n+   * Handles InterruptedExecution.\n+   *\n+   * @param ex\n+   * @param skipExecutionException is optional, if passed as TRUE, then\n+   * handle ExecutionException else skip it.\n+   * @throws IOException\n+   */\n+  private void handleInterruptedException(Exception ex,\n+      boolean skipExecutionException)\n+      throws IOException {\n+    LOG.error(\"Command execution was interrupted.\");\n+    if(skipExecutionException) {", "originalCommit": "cbd320ef9e7523020d76d05d73047351b4b0d278", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk0MjM5OA==", "url": "https://github.com/apache/ozone/pull/942#discussion_r428942398", "bodyText": "Addressed in latest commit.", "author": "dineshchitlangia", "createdAt": "2020-05-21T22:07:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkwNTMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODkwNjQ1Mw==", "url": "https://github.com/apache/ozone/pull/942#discussion_r428906453", "bodyText": "NIT: javadoc also need to be updated for this.", "author": "bharatviswa504", "createdAt": "2020-05-21T20:49:35Z", "path": "hadoop-hdds/client/src/main/java/org/apache/hadoop/hdds/scm/storage/BlockOutputStream.java", "diffHunk": "@@ -654,4 +662,34 @@ private void writeChunkToContainer(ChunkBuffer chunk) throws IOException {\n   public void setXceiverClient(XceiverClientSpi xceiverClient) {\n     this.xceiverClient = xceiverClient;\n   }\n+\n+  /**\n+   * Handles InterruptedExecution.\n+   *\n+   * @param ex\n+   * @param skipExecutionException is optional, if passed as TRUE, then", "originalCommit": "cbd320ef9e7523020d76d05d73047351b4b0d278", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6a72a200169a3cf184a642d6df990312e6fcdfd8", "url": "https://github.com/apache/ozone/commit/6a72a200169a3cf184a642d6df990312e6fcdfd8", "message": "renamed variable", "committedDate": "2020-05-21T22:05:48Z", "type": "commit"}]}