{"pr_number": 1544, "pr_title": "HDDS-4337. Implement RocksDB options cache for new datanode DB utilities.", "pr_createdAt": "2020-11-02T23:14:18Z", "pr_url": "https://github.com/apache/ozone/pull/1544", "timeline": [{"oid": "c766182691a934f4b5b9ee793ecca7ce06f022dc", "url": "https://github.com/apache/ozone/commit/c766182691a934f4b5b9ee793ecca7ce06f022dc", "message": "Outline how static column family options cna be used for datanode", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "0a7cce24feccc443debb33b11c9129d684411de1", "url": "https://github.com/apache/ozone/commit/0a7cce24feccc443debb33b11c9129d684411de1", "message": "Remove unused method and make methods not used outside private", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "338aa070ded59a2a6fd40d3ef8be09134dbacad4", "url": "https://github.com/apache/ozone/commit/338aa070ded59a2a6fd40d3ef8be09134dbacad4", "message": "Refactor DBStoreBuilder constructors\n\nRemoval of DBProfile also got mixed in here, but not finished.", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "5c481f891623b70e787227da82715050b8d42155", "url": "https://github.com/apache/ozone/commit/5c481f891623b70e787227da82715050b8d42155", "message": "Finish reorganizing methods", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "7b780ccc312b679e2e2c79c5ad9e6b3701151da9", "url": "https://github.com/apache/ozone/commit/7b780ccc312b679e2e2c79c5ad9e6b3701151da9", "message": "Code and comment clean up", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "290b5ec96b8b6b58cb50bbcbff09280e5ee580f5", "url": "https://github.com/apache/ozone/commit/290b5ec96b8b6b58cb50bbcbff09280e5ee580f5", "message": "Add documentation for profile setter", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "cba325251787f298948f68dc3fa86a146be4aa3e", "url": "https://github.com/apache/ozone/commit/cba325251787f298948f68dc3fa86a146be4aa3e", "message": "Rename column fmaily setting options", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "85b0a505fb2afb8cac9ce7d8cc88e0aa7f6edc0f", "url": "https://github.com/apache/ozone/commit/85b0a505fb2afb8cac9ce7d8cc88e0aa7f6edc0f", "message": "Add simple test for registering the same table name multiple times", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "86a25cfa2f848eda69a6b7895597b699a97a1de4", "url": "https://github.com/apache/ozone/commit/86a25cfa2f848eda69a6b7895597b699a97a1de4", "message": "Fix errors when sharing column family options and cache", "committedDate": "2020-11-02T22:43:53Z", "type": "commit"}, {"oid": "eab4a124b10dd682646b2bdc8542907e6b543a4d", "url": "https://github.com/apache/ozone/commit/eab4a124b10dd682646b2bdc8542907e6b543a4d", "message": "Rename static column family options variable", "committedDate": "2020-11-02T22:58:48Z", "type": "commit"}, {"oid": "02b81897aebbcf7fea0db69ab17bc97afebcfe15", "url": "https://github.com/apache/ozone/commit/02b81897aebbcf7fea0db69ab17bc97afebcfe15", "message": "Fix checkstyle violations", "committedDate": "2020-11-03T12:32:21Z", "type": "commit"}, {"oid": "35a6fe102a5c68afc97f93909dd66078159e262e", "url": "https://github.com/apache/ozone/commit/35a6fe102a5c68afc97f93909dd66078159e262e", "message": "Retrigger CI", "committedDate": "2020-11-03T14:09:58Z", "type": "commit"}, {"oid": "18d90f717e55b76c8695a8cdcd5a7604e7d02c3e", "url": "https://github.com/apache/ozone/commit/18d90f717e55b76c8695a8cdcd5a7604e7d02c3e", "message": "Allow cache size to be specified from xml configuration", "committedDate": "2020-11-10T19:56:47Z", "type": "commit"}, {"oid": "ff1c93a261da055f240b067c2d00bcc0e4b8d600", "url": "https://github.com/apache/ozone/commit/ff1c93a261da055f240b067c2d00bcc0e4b8d600", "message": "Add unit test for column family options sharing among containers", "committedDate": "2020-11-10T19:57:09Z", "type": "commit"}, {"oid": "1e68293a5d67e91af8f3c1bf0d33e597be27e9e4", "url": "https://github.com/apache/ozone/commit/1e68293a5d67e91af8f3c1bf0d33e597be27e9e4", "message": "Fix failing unit test by using one static configuration in unit tests", "committedDate": "2020-11-10T22:27:41Z", "type": "commit"}, {"oid": "f0e65baaf875349b943eb920bab6fbfb78a53294", "url": "https://github.com/apache/ozone/commit/f0e65baaf875349b943eb920bab6fbfb78a53294", "message": "Fix checkstyle violation", "committedDate": "2020-11-10T22:40:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NTYwNQ==", "url": "https://github.com/apache/ozone/pull/1544#discussion_r521245605", "bodyText": "I think a better name for this parameter might be:\n\"hdds.datanode.container.rocksdb.cache.size\"\nThat more clearly says \"this is the cache size for the container rocksDBs\". What do you think?", "author": "sodonnel", "createdAt": "2020-11-11T10:00:47Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConfigKeys.java", "diffHunk": "@@ -343,6 +343,11 @@\n   public static final double\n       HDDS_DATANODE_STORAGE_UTILIZATION_CRITICAL_THRESHOLD_DEFAULT = 0.95;\n \n+  public static final String\n+      HDDS_DATANODE_METADATA_CACHE_SIZE = \"hdds.datanode.metadata.cache.size\";", "originalCommit": "18d90f717e55b76c8695a8cdcd5a7604e7d02c3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA4NzEwMQ==", "url": "https://github.com/apache/ozone/pull/1544#discussion_r522087101", "bodyText": "My initial thought was that metadata tells what the cache is used for, which seemed more useful than rocksdb, which tells how the cache is implemented. But if this config is being changed, knowing that it is for a RocksDB instance might be useful. Maybe we could include both parts? For example, the existing config ozone.metastore.rocksdb.statistics contains both pieces of information.\nI think putting container in the name makes the config sound like it is for one container, whereas just having datanode makes it more apparent that this is the size of one shared cache for the whole DN.\nThese would give a new name like hdds.datanode.rocksdb.metadata.cache.size or hdds.datanode.metadata.store.rocksdb.cache.size which are informative but fairly long. Since ozone-default.xml has a description, this may not be necessary.\nI don't really have a strong opinion either way. If you think hdds.datanode.container.rocksdb.cache.size the best name I am fine with that.", "author": "errose28", "createdAt": "2020-11-12T12:59:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NTYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA5MTQ1Ng==", "url": "https://github.com/apache/ozone/pull/1544#discussion_r522091456", "bodyText": "How about hdds.datanode.metadata.rocksdb.cache.size? I just dropped store from your suggestion.", "author": "sodonnel", "createdAt": "2020-11-12T13:06:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NTYwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjEwOTU3NA==", "url": "https://github.com/apache/ozone/pull/1544#discussion_r522109574", "bodyText": "Sounds good to me, I'll update the name.", "author": "errose28", "createdAt": "2020-11-12T13:36:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI0NTYwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MDIyMA==", "url": "https://github.com/apache/ozone/pull/1544#discussion_r521250220", "bodyText": "The usual pattern here is to have a pair of variables name like:\nPARAMETER_KEY\nPARAMETER_DEFAULT\nI think it would be good to change this variable to HDDS_DATANODE_METADATA_CACHE_SIZE_DEFAULT.\nI see some other parameters in this file don't end in \"_KEY\", so I guess it is not essential to rename HDDS_DATANODE_METADATA_CACHE_SIZE to \"HDDS_DATANODE_METADATA_CACHE_SIZE_KEY\".\nIf we change the parameter name to \"hdds.datanode.container.rocksdb.cache.size\" based on the above comment, maybe we should also rename the variables to HDDS_DATANODE_CONTAINER_ROCKSDB_CACHE_SIZE ?", "author": "sodonnel", "createdAt": "2020-11-11T10:08:35Z", "path": "hadoop-hdds/common/src/main/java/org/apache/hadoop/ozone/OzoneConfigKeys.java", "diffHunk": "@@ -343,6 +343,11 @@\n   public static final double\n       HDDS_DATANODE_STORAGE_UTILIZATION_CRITICAL_THRESHOLD_DEFAULT = 0.95;\n \n+  public static final String\n+      HDDS_DATANODE_METADATA_CACHE_SIZE = \"hdds.datanode.metadata.cache.size\";\n+  public static final String\n+      HDDS_DATANODE_CACHE_SIZE_DEFAULT = \"64MB\";", "originalCommit": "18d90f717e55b76c8695a8cdcd5a7604e7d02c3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjA4ODM5NQ==", "url": "https://github.com/apache/ozone/pull/1544#discussion_r522088395", "bodyText": "Yes, this was a typo. I forgot to update the name of the default variable when I updated the name. I will fix it once we decide on a name for the config.", "author": "errose28", "createdAt": "2020-11-12T13:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTI1MDIyMA=="}], "type": "inlineReview"}, {"oid": "6d99e8c9c7639d2c3c48d7473dfd7ea9a468b0b7", "url": "https://github.com/apache/ozone/commit/6d99e8c9c7639d2c3c48d7473dfd7ea9a468b0b7", "message": "Rename cache size configuration to hdds.datanode.metadata.rocksdb.cache.size", "committedDate": "2020-11-12T20:14:43Z", "type": "commit"}]}