{"pr_number": 2170, "pr_title": "MekHQ 1892: MegaMek Standardization of Launch Game Dialogs", "pr_createdAt": "2020-08-23T22:22:00Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2170", "timeline": [{"oid": "10f4d286ec87b16160a8bcbe22b37a250606d27b", "url": "https://github.com/MegaMek/megamek/commit/10f4d286ec87b16160a8bcbe22b37a250606d27b", "message": "Minor code refactor in ConnectDialog", "committedDate": "2020-08-17T20:15:54Z", "type": "commit"}, {"oid": "886fb4b611c3802680f24cfa1c851dc99a9108e9", "url": "https://github.com/MegaMek/megamek/commit/886fb4b611c3802680f24cfa1c851dc99a9108e9", "message": "Continuing minor cleanups with the HostDialog", "committedDate": "2020-08-17T20:37:00Z", "type": "commit"}, {"oid": "ae407d4783ee191c322948ba1d6c6a824533d95d", "url": "https://github.com/MegaMek/megamek/commit/ae407d4783ee191c322948ba1d6c6a824533d95d", "message": "Further cleanup", "committedDate": "2020-08-17T20:40:42Z", "type": "commit"}, {"oid": "89bc7915c3f14af0bf2eb57788532662fcfb526f", "url": "https://github.com/MegaMek/megamek/commit/89bc7915c3f14af0bf2eb57788532662fcfb526f", "message": "Cleaning up MegaMekGUI", "committedDate": "2020-08-17T20:55:46Z", "type": "commit"}, {"oid": "e1ed0c7962e4ca6a559f6d4d1a97ee6fbe3ab6f8", "url": "https://github.com/MegaMek/megamek/commit/e1ed0c7962e4ca6a559f6d4d1a97ee6fbe3ab6f8", "message": "Starting to implement launch game changes", "committedDate": "2020-08-21T03:07:45Z", "type": "commit"}, {"oid": "b9683cf76ad6462cddb08cb21facce5e3ab34c80", "url": "https://github.com/MegaMek/megamek/commit/b9683cf76ad6462cddb08cb21facce5e3ab34c80", "message": "Continuing to work on standardizing the localizations", "committedDate": "2020-08-23T21:55:12Z", "type": "commit"}, {"oid": "5800cc9d3dd3fbeff2d6004b8a18df8cd300257f", "url": "https://github.com/MegaMek/megamek/commit/5800cc9d3dd3fbeff2d6004b8a18df8cd300257f", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_LaunchGame", "committedDate": "2020-08-23T21:57:33Z", "type": "commit"}, {"oid": "76f791b987f39d368f931d808742d0f7af1da763", "url": "https://github.com/MegaMek/megamek/commit/76f791b987f39d368f931d808742d0f7af1da763", "message": "Reverting i18n changes", "committedDate": "2020-08-23T21:58:32Z", "type": "commit"}, {"oid": "2d08fc4058f88edf142a91258ba09bb9a2d0599b", "url": "https://github.com/MegaMek/megamek/commit/2d08fc4058f88edf142a91258ba09bb9a2d0599b", "message": "Reverting messages changes in the code", "committedDate": "2020-08-23T22:06:30Z", "type": "commit"}, {"oid": "8de77e7b22fbfab80828b7ed8b136e053cd9d8ae", "url": "https://github.com/MegaMek/megamek/commit/8de77e7b22fbfab80828b7ed8b136e053cd9d8ae", "message": "Fixing bugs found during testing", "committedDate": "2020-08-23T22:16:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkzOTkzNA==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r490939934", "bodyText": "Is it intentional not to log the ex.getMessage()? Otherwise, the String error of line 596 could be re-used in 553 and 555", "author": "SJuliez", "createdAt": "2020-09-18T13:13:42Z", "path": "megamek/src/megamek/client/ui/swing/MegaMekGUI.java", "diffHunk": "@@ -559,68 +533,48 @@ public String getDescription() {\n             }\n         });\n         int returnVal = fc.showOpenDialog(frame);\n-        if ((returnVal != JFileChooser.APPROVE_OPTION)\n-                || (fc.getSelectedFile() == null)) {\n+        if ((returnVal != JFileChooser.APPROVE_OPTION) || (fc.getSelectedFile() == null)) {\n             // I want a file, y'know!\n             return;\n         }\n         HostDialog hd = new HostDialog(frame);\n         hd.setVisible(true);\n-        if ((hd.playerName == null) || (hd.serverPass == null) || (hd.port == 0)) {\n-            return;\n-        }\n \n-        // Players should have to enter a non-blank, non-whitespace name.\n-        boolean foundValid = false;\n-        char[] nameChars = hd.playerName.toCharArray();\n-        for (int loop = 0; !foundValid && (loop < nameChars.length); loop++) {\n-            if (!Character.isWhitespace(nameChars[loop])) {\n-                foundValid = true;\n-            }\n-        }\n-        if (!foundValid) {\n-            JOptionPane\n-                    .showMessageDialog(\n-                            frame,\n-                            Messages.getString(\"MegaMek.PlayerNameAlert1.message\"), Messages.getString(\"MegaMek.PlayerNameAlert1.title\"), JOptionPane.ERROR_MESSAGE); //$NON-NLS-1$ //$NON-NLS-2$\n+        if (!hd.dataValidation(\"MegaMek.PlayerNameAlert1.title\", \"MegaMek.PlayerNameAlert.message\")) {\n             return;\n         }\n \n         // kick off a RNG check\n         d6();\n         // start server\n         try {\n-            server = new Server(hd.serverPass, hd.port, hd.register, hd.register ? hd.metaserver : \"\");\n+            server = new Server(hd.getServerPass(), hd.getPort(), hd.isRegister(), hd.isRegister() ? hd.getMetaserver() : \"\");\n         } catch (IOException ex) {\n-            System.err.println(\"could not create server socket on port \" + hd.port);\n-            String error = \"Error: could not start server at localhost\" + \":\" + hd.port + \" (\" +\n-                    ex.getMessage() + \").\";\n-            JOptionPane\n-                    .showMessageDialog(\n-                            frame,\n-                            error,\n-                            Messages.getString(\"MegaMek.HostGameAlert.title\"), JOptionPane.ERROR_MESSAGE); //$NON-NLS-1$\n+            MegaMek.getLogger().error(this, \"could not create server socket on port \" + hd.getPort());\n+            JOptionPane.showMessageDialog(frame,\n+                    \"Error: could not start server at localhost\" + \":\" + hd.getPort() + \" (\" + ex.getMessage() + \").\",\n+                    Messages.getString(\"MegaMek.HostGameAlert.title\"), JOptionPane.ERROR_MESSAGE);", "originalCommit": "8de77e7b22fbfab80828b7ed8b136e053cd9d8ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk5OTU5MA==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r490999590", "bodyText": "Annoyingly we should be localizing one and not the other, but I should fix that localization.", "author": "Windchild292", "createdAt": "2020-09-18T14:45:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkzOTkzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA1OTc0NA==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r491059744", "bodyText": "Ended up finding a bunch of localization issues in this, so I've fixed that now.", "author": "Windchild292", "createdAt": "2020-09-18T16:25:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDkzOTkzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk1MjA1OQ==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r490952059", "bodyText": "My feeling would be (not because it's important right here, more as a matter principle) that InitComponents might rather be\n\"protected JPanel createMainPanel() { ... }\"\nEverything from \"add(middlePanel...\" to center() (lines 71-77) would then move to the AbstractGCD and in the subclass it would just \"return middlePanel;\" instead. In this way the subclass can create whatever it wants in that panel and just return it and it does not have to \"remember\" doing anything (e.g. to createButtons()).\nOf course, this forces createbuttons() on the subclasses but I suppose that's the buttons we need for a game conection dialog...\nI mean this purely as a suggestion.", "author": "SJuliez", "createdAt": "2020-09-18T13:33:19Z", "path": "megamek/src/megamek/client/ui/swing/gameConnectionDialogs/ConnectDialog.java", "diffHunk": "@@ -0,0 +1,108 @@\n+/*\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MegaMek.\n+ *\n+ * MegaMek is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MegaMek is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MegaMek. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package megamek.client.ui.swing.gameConnectionDialogs;\n+\n+import java.awt.BorderLayout;\n+import java.awt.GridBagConstraints;\n+import java.awt.GridBagLayout;\n+import java.awt.Insets;\n+import java.awt.event.ActionEvent;\n+\n+import javax.swing.JFrame;\n+import javax.swing.JLabel;\n+import javax.swing.JPanel;\n+import javax.swing.JTextField;\n+import javax.swing.SwingConstants;\n+\n+import megamek.client.ui.Messages;\n+\n+/** The Connect to game (as Bot or Player) dialog */\n+public class ConnectDialog extends AbstractGameConnectionDialog {\n+    private static final long serialVersionUID = 5895056240077042429L;\n+\n+    private String serverAddress;\n+    private JTextField serverAddressField;\n+\n+    public ConnectDialog(JFrame frame) {\n+        super(frame, Messages.getString(\"MegaMek.ConnectDialog.title\"), true);\n+    }\n+\n+    //region Initialization\n+    @Override\n+    protected void initComponents() {\n+        JLabel yourNameL = new JLabel(Messages.getString(\"MegaMek.yourNameL\"), SwingConstants.RIGHT);\n+        JLabel serverAddrL = new JLabel(Messages.getString(\"MegaMek.serverAddrL\"), SwingConstants.RIGHT);\n+        JLabel portL = new JLabel(Messages.getString(\"MegaMek.portL\"), SwingConstants.RIGHT);\n+        setPlayerNameField(new JTextField(getClientPreferences().getLastPlayerName(), 16));\n+        getPlayerNameField().addActionListener(this);\n+        serverAddressField = new JTextField(getClientPreferences().getLastConnectAddr(), 16);\n+        serverAddressField.addActionListener(this);\n+        setPortField(new JTextField(getClientPreferences().getLastConnectPort() + \"\", 4));\n+        getPortField().addActionListener(this);\n+        \n+        JPanel middlePanel = new JPanel(new GridBagLayout());\n+        GridBagConstraints c = new GridBagConstraints();\n+        c.fill = GridBagConstraints.NONE;\n+        c.weightx = 0.0;\n+        c.weighty = 0.0;\n+        c.insets = new Insets(5, 5, 5, 5);\n+        c.gridwidth = 1;\n+        \n+        addOptionRow(middlePanel, c, yourNameL, getPlayerNameField());\n+        addOptionRow(middlePanel, c, serverAddrL, serverAddressField);\n+        addOptionRow(middlePanel, c, portL, getPortField());\n+        \n+        add(middlePanel, BorderLayout.CENTER);\n+        \n+        createButtons();\n+        \n+        pack();\n+        setResizable(false);\n+        center();\n+    }\n+    //endregion Initialization", "originalCommit": "8de77e7b22fbfab80828b7ed8b136e053cd9d8ae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTA1OTYyMQ==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r491059621", "bodyText": "I concur, that's better code. Implement.", "author": "Windchild292", "createdAt": "2020-09-18T16:24:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk1MjA1OQ=="}], "type": "inlineReview"}, {"oid": "d13cec9ac87650c8c9f63bf5a3128b40a5512b46", "url": "https://github.com/MegaMek/megamek/commit/d13cec9ac87650c8c9f63bf5a3128b40a5512b46", "message": "Merge remote-tracking branch 'upstream/master' into dev_Windchild_LaunchGame", "committedDate": "2020-09-18T14:46:01Z", "type": "commit"}, {"oid": "bc14fa99461c6810b6f6ef49cdc607740f4b24c6", "url": "https://github.com/MegaMek/megamek/commit/bc14fa99461c6810b6f6ef49cdc607740f4b24c6", "message": "Fixing localization strings", "committedDate": "2020-09-18T15:49:41Z", "type": "commit"}, {"oid": "aa2e79fe7f5a00ff173cba7e11d9468bd6e5b4b0", "url": "https://github.com/MegaMek/megamek/commit/aa2e79fe7f5a00ff173cba7e11d9468bd6e5b4b0", "message": "Refactoring to reduce code reuse", "committedDate": "2020-09-18T15:50:00Z", "type": "commit"}, {"oid": "54c8d63aa46215469e3a0af22bc5dc4458f5b9a0", "url": "https://github.com/MegaMek/megamek/commit/54c8d63aa46215469e3a0af22bc5dc4458f5b9a0", "message": "Adding resources::getFormattedString to handle any cases where we cannot have the numbers formatted like ports", "committedDate": "2020-09-18T16:22:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwMDAxNQ==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r491200015", "bodyText": "So far this was done using \"message=SomeError {0}: {1}\". The call to Messages.getString looks the same in both cases I think. Is there an advantage to the %s version?", "author": "SJuliez", "createdAt": "2020-09-18T21:32:01Z", "path": "megamek/src/megamek/client/ui/Messages.java", "diffHunk": "@@ -53,4 +53,12 @@ public static String getString(String key) {\n     public static String getString(String key, Object... args) {\n         return MessageFormat.format(getString(key), args);\n     }\n+\n+    /**\n+     * Returns the formatted internationalized text for the given key in the resource bundle,\n+     * replacing occurrences of %s in the message with the contents of args.\n+     */\n+    public static String getFormattedString(String key, Object... args) {\n+        return String.format(getString(key), args);\n+    }", "originalCommit": "54c8d63aa46215469e3a0af22bc5dc4458f5b9a0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwMDc1Mw==", "url": "https://github.com/MegaMek/megamek/pull/2170#discussion_r491200753", "bodyText": "This does not format numbers, which is necessary for ports.... and I apparently forgot to put that in the comment.", "author": "Windchild292", "createdAt": "2020-09-18T21:34:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwMDAxNQ=="}], "type": "inlineReview"}, {"oid": "34871af55b5d206e727377a0f512897fabd81287", "url": "https://github.com/MegaMek/megamek/commit/34871af55b5d206e727377a0f512897fabd81287", "message": "Applying changes from review", "committedDate": "2020-09-19T05:36:08Z", "type": "commit"}]}