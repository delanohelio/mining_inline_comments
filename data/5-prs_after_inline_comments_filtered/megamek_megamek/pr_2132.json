{"pr_number": 2132, "pr_title": "add Java object look-ahead library to mitigate deserialization vulnerabilities", "pr_createdAt": "2020-08-11T20:13:49Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2132", "timeline": [{"oid": "034f3bd3eaae97a770f244a3d79fbb2a6eea6c83", "url": "https://github.com/MegaMek/megamek/commit/034f3bd3eaae97a770f244a3d79fbb2a6eea6c83", "message": "add serialkiller to mitigate deserialization vulnerabilities\n\nMegamek unsafely deserializes untrusted raw objects from files in\nmegamek/common/MechSummaryCache.java and over the wire in\nmegamek/common/net/marshall/NativeSerializationMarshaller.java, which\ncould allow attackers to gain remote code execution on the game host\nmachine. This commit wraps the InputStream in these instances with\nSerialKiller, a Look-Ahead Java Object Deserialization library. A whitelist\nof allowed objects is stored in resources/megamek/serialkiller.xml, which\nwill need to be updated if more objects are added that need to be deserialized.\nNote that I've whitelisted all internal classes (megamek.common.*).", "committedDate": "2020-08-11T20:03:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0Njk3MA==", "url": "https://github.com/MegaMek/megamek/pull/2132#discussion_r468846970", "bodyText": "I just noticed the game hangs when I launch using the unixDistTar package, but not when I run with gradlew. Do I need to move the shipped serialkiller.xml file to the mmconf folder instead of the resources folder to use it from a jar?", "author": "Algebro7", "createdAt": "2020-08-11T20:30:42Z", "path": "megamek/src/megamek/common/net/marshall/NativeSerializationMarshaller.java", "diffHunk": "@@ -48,7 +50,7 @@ public void marshall(Packet packet, OutputStream stream) throws Exception {\n      */\n     @Override\n     public Packet unmarshall(InputStream stream) throws Exception {\n-        ObjectInputStream in = new ObjectInputStream(stream);\n+        ObjectInputStream in = new SerialKiller(stream, Objects.requireNonNull(getClass().getClassLoader().getResource(\"./megamek/serialkiller.xml\")).toString());", "originalCommit": "034f3bd3eaae97a770f244a3d79fbb2a6eea6c83", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg1NzI2OQ==", "url": "https://github.com/MegaMek/megamek/pull/2132#discussion_r468857269", "bodyText": "This should be fixed with 3cc0cbd", "author": "Algebro7", "createdAt": "2020-08-11T20:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODg0Njk3MA=="}], "type": "inlineReview"}, {"oid": "3cc0cbd64fd0204f19442cd442c3a1e870d75b4b", "url": "https://github.com/MegaMek/megamek/commit/3cc0cbd64fd0204f19442cd442c3a1e870d75b4b", "message": "move serialkiller config to mmconf", "committedDate": "2020-08-11T20:50:41Z", "type": "commit"}, {"oid": "5a15de18d808cd3bf7c13d03f43e0a125b29abbc", "url": "https://github.com/MegaMek/megamek/commit/5a15de18d808cd3bf7c13d03f43e0a125b29abbc", "message": "remove unneeded import", "committedDate": "2020-08-11T20:57:12Z", "type": "commit"}, {"oid": "c47f9e0d7a5725553b72396792cfa2cd59cd84e3", "url": "https://github.com/MegaMek/megamek/commit/c47f9e0d7a5725553b72396792cfa2cd59cd84e3", "message": "move serialkiller config to jar resources", "committedDate": "2020-08-12T01:37:01Z", "type": "commit"}, {"oid": "6cb4012677ae333b2d93e6ace33a56c7fc2f215d", "url": "https://github.com/MegaMek/megamek/commit/6cb4012677ae333b2d93e6ace33a56c7fc2f215d", "message": "whitelist 1-dimensional megamek array", "committedDate": "2020-08-15T20:39:10Z", "type": "commit"}, {"oid": "7c0c590cc98e2353b91bb8846d5a121aea91e7a7", "url": "https://github.com/MegaMek/megamek/commit/7c0c590cc98e2353b91bb8846d5a121aea91e7a7", "message": "whitelist whole megamek namespace", "committedDate": "2020-08-16T03:14:43Z", "type": "commit"}]}