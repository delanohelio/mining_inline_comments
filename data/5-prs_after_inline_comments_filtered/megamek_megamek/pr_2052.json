{"pr_number": 2052, "pr_title": "Account for variable equipment size and armored components in TRO entries", "pr_createdAt": "2020-07-06T17:32:06Z", "pr_url": "https://github.com/MegaMek/megamek/pull/2052", "timeline": [{"oid": "4570c849eee6f5de4d32f5be82e302df8957fc1a", "url": "https://github.com/MegaMek/megamek/commit/4570c849eee6f5de4d32f5be82e302df8957fc1a", "message": "Account for variable sized-equipment in TRO summaries.", "committedDate": "2020-04-29T05:00:22Z", "type": "commit"}, {"oid": "dbba209d395668db521ae525f2cfbd0683e639ad", "url": "https://github.com/MegaMek/megamek/commit/dbba209d395668db521ae525f2cfbd0683e639ad", "message": "Don't strip variable size note from equipment name.", "committedDate": "2020-04-29T05:46:06Z", "type": "commit"}, {"oid": "b0b3078208e2b576c0768c2a64ebd2f6c48176e2", "url": "https://github.com/MegaMek/megamek/commit/b0b3078208e2b576c0768c2a64ebd2f6c48176e2", "message": "Warnings cleanup", "committedDate": "2020-04-29T05:46:41Z", "type": "commit"}, {"oid": "9d1a6e60e5691ca05b86c1b4bed7b19f98b953cd", "url": "https://github.com/MegaMek/megamek/commit/9d1a6e60e5691ca05b86c1b4bed7b19f98b953cd", "message": "Merge remote-tracking branch 'origin/master' into variable_equipment_tro\n\n# Conflicts:\n#\tmegamek/src/megamek/common/templates/SupportVeeTROView.java", "committedDate": "2020-07-06T16:32:30Z", "type": "commit"}, {"oid": "5b13737d9da6246c72c549bdca51213fd6d98f55", "url": "https://github.com/MegaMek/megamek/commit/5b13737d9da6246c72c549bdca51213fd6d98f55", "message": "Indicate armored component in TRO view.", "committedDate": "2020-07-06T17:14:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5MTAwMw==", "url": "https://github.com/MegaMek/megamek/pull/2052#discussion_r450391003", "bodyText": "Yikes.", "author": "NickAragua", "createdAt": "2020-07-06T18:01:06Z", "path": "megamek/src/megamek/common/templates/InfantryTROView.java", "diffHunk": "@@ -226,10 +226,8 @@ private void addAugmentationNotes(List<String> notes) {\n         }\n         if (!options.isEmpty()) {\n             notes.add(Messages.getString(\"TROView.InfantryNote.Augmented\"));\n-            options.forEach(o -> {\n-                notes.add(o.getDisplayableName().replaceAll(\"\\\\s+\\\\(Not Implemn?ented\\\\)\", \"\") + \": \"\n-                        + o.getDescription().replaceAll(\"See IO.*\", \"\"));\n-            });\n+            options.forEach(o -> notes.add(o.getDisplayableName().replaceAll(\"\\\\s+\\\\(Not Implemented\\\\)\", \"\") + \": \"", "originalCommit": "5b13737d9da6246c72c549bdca51213fd6d98f55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQzODY3Mg==", "url": "https://github.com/MegaMek/megamek/pull/2052#discussion_r450438672", "bodyText": "I was lazy the first time around and accounted for the spelling error rather that fixing it.", "author": "neoancient", "createdAt": "2020-07-06T19:36:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5MTAwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5Mjk5MQ==", "url": "https://github.com/MegaMek/megamek/pull/2052#discussion_r450392991", "bodyText": "The name variable appears to get overwritten if the equipment is not ammo but takes up more than one slot?", "author": "NickAragua", "createdAt": "2020-07-06T18:04:38Z", "path": "megamek/src/megamek/common/templates/TROView.java", "diffHunk": "@@ -439,26 +429,30 @@ protected int addEquipment(Entity entity, boolean includeAmmo) {\n             if (m.isOmniPodMounted() || !entity.isOmni()) {\n                 final String loc = formatLocationTableEntry(entity, m);\n                 equipment.putIfAbsent(loc, new HashMap<>());\n-                equipment.get(loc).merge(m.getType(), 1, Integer::sum);\n+                equipment.get(loc).merge(new EquipmentKey(m.getType(), m.getSize(), m.isArmored()),\n+                        1, Integer::sum);\n             }\n         }\n         final List<Map<String, Object>> eqList = new ArrayList<>();\n         for (final String loc : equipment.keySet()) {\n-            for (final Map.Entry<EquipmentType, Integer> entry : equipment.get(loc).entrySet()) {\n-                final EquipmentType eq = entry.getKey();\n-                final int count = equipment.get(loc).get(eq);\n-                String name = stripNotes(eq.getName());\n+            for (final Map.Entry<EquipmentKey, Integer> entry : equipment.get(loc).entrySet()) {\n+                final EquipmentType eq = entry.getKey().getType();\n+                final int count = equipment.get(loc).get(entry.getKey());\n+                String name = stripNotes(entry.getKey().name());\n+                if (entry.getKey().isArmored()) {\n+                    name += \" (Armored)\";\n+                }\n                 if (eq instanceof AmmoType) {\n                     name = String.format(\"%s (%d)\", name, ((AmmoType) eq).getShots() * count);", "originalCommit": "5b13737d9da6246c72c549bdca51213fd6d98f55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDQ0NDAzMg==", "url": "https://github.com/MegaMek/megamek/pull/2052#discussion_r450444032", "bodyText": "Actually it's if there's more than one of them. It adds the count and appends an 's' to the name. But the formation of a plural is not correct in cases where the equipment name itself ends in 's' and the possible addition of \"(Armored)\" throws it off in any case. So I removed the grammatical inflection as well as including the armored tag.", "author": "neoancient", "createdAt": "2020-07-06T19:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDM5Mjk5MQ=="}], "type": "inlineReview"}, {"oid": "77a4ed39fd8bbb91555827b60b261eb7ddd8018a", "url": "https://github.com/MegaMek/megamek/commit/77a4ed39fd8bbb91555827b60b261eb7ddd8018a", "message": "Include armored tag when multiple occurrences are in the same location.", "committedDate": "2020-07-06T19:45:18Z", "type": "commit"}]}