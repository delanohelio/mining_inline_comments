{"pr_number": 1737, "pr_title": "implement fuel-air ordnance for artillery", "pr_createdAt": "2020-03-04T04:23:16Z", "pr_url": "https://github.com/MegaMek/megamek/pull/1737", "timeline": [{"oid": "6cbef1b85383a1c484067a7f3c5c8f65fb9a9060", "url": "https://github.com/MegaMek/megamek/commit/6cbef1b85383a1c484067a7f3c5c8f65fb9a9060", "message": "implement fuel-air ordnance for artillery", "committedDate": "2020-03-04T04:21:42Z", "type": "commit"}, {"oid": "3b9724ad70f3d5dc14bf21f445750e7d4c68acba", "url": "https://github.com/MegaMek/megamek/commit/3b9724ad70f3d5dc14bf21f445750e7d4c68acba", "message": "Merge branch 'master' of https://github.com/MegaMek/megamek into fuel_air_munitions", "committedDate": "2020-03-04T04:25:50Z", "type": "commit"}, {"oid": "0da4d526b14ff97b47a97a8947b1ac423cd0e623", "url": "https://github.com/MegaMek/megamek/commit/0da4d526b14ff97b47a97a8947b1ac423cd0e623", "message": "Merge branch 'master' of https://github.com/MegaMek/megamek into fuel_air_munitions", "committedDate": "2020-03-05T03:21:25Z", "type": "commit"}, {"oid": "92ccca773a12f6561b6ae2bea96f3a62e6841daf", "url": "https://github.com/MegaMek/megamek/commit/92ccca773a12f6561b6ae2bea96f3a62e6841daf", "message": "fix parameter whoops", "committedDate": "2020-03-05T16:52:59Z", "type": "commit"}, {"oid": "b461604e36328f49a76e0c5202d760d5c620e3f5", "url": "https://github.com/MegaMek/megamek/commit/b461604e36328f49a76e0c5202d760d5c620e3f5", "message": "Merge branch 'master' of https://github.com/MegaMek/megamek into fuel_air_munitions", "committedDate": "2020-03-06T02:06:58Z", "type": "commit"}, {"oid": "9f06d5107a219e5d7ce2444cada1aca400bbeda3", "url": "https://github.com/MegaMek/megamek/commit/9f06d5107a219e5d7ce2444cada1aca400bbeda3", "message": "adjust incorrect bomb references", "committedDate": "2020-03-06T02:10:41Z", "type": "commit"}, {"oid": "05b627880da6314914e5e35af74630d9c6511cea", "url": "https://github.com/MegaMek/megamek/commit/05b627880da6314914e5e35af74630d9c6511cea", "message": "Merge branch 'fuel_air_munitions' of https://github.com/NickAragua/megamek into fuel_air_munitions", "committedDate": "2020-03-06T02:10:55Z", "type": "commit"}, {"oid": "090657ada3d36b88cb785603ff3c08ca6c76932e", "url": "https://github.com/MegaMek/megamek/commit/090657ada3d36b88cb785603ff3c08ca6c76932e", "message": "FAE shouldn't do 2x damage or clear minefields", "committedDate": "2020-03-06T03:28:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5Njk1Nw==", "url": "https://github.com/MegaMek/megamek/pull/1737#discussion_r388696957", "bodyText": "Consolidates mine clearing code into one place. I was going to have FAE code invoke it as well, but then realized that FAE probably can't clear minefields (the \"can I clear minefields\" code appears to imply that only standard munitions can clear mine fields)", "author": "NickAragua", "createdAt": "2020-03-06T03:30:31Z", "path": "megamek/src/megamek/common/weapons/ArtilleryWeaponIndirectFireHandler.java", "diffHunk": "@@ -456,24 +448,30 @@ else if ((null != bestSpotter) && !(this instanceof ArtilleryWeaponDirectFireHan\n \n         // artillery may unintentially clear minefields, but only if it wasn't\n         // trying to\n-        if (!mineClear && game.containsMinefield(targetPos)) {\n-            Enumeration<Minefield> minefields = game.getMinefields(targetPos)\n-                    .elements();\n-            ArrayList<Minefield> mfRemoved = new ArrayList<Minefield>();\n-            while (minefields.hasMoreElements()) {\n-                Minefield mf = minefields.nextElement();\n-                if (server.clearMinefield(mf, ae, 10, vPhaseReport)) {\n-                    mfRemoved.add(mf);\n-                }\n-            }\n-            // we have to do it this way to avoid a concurrent error problem\n-            for (Minefield mf : mfRemoved) {\n-                server.removeMinefield(mf);\n-            }\n+        if (!mineClear) {\n+            clearMineFields(targetPos, Minefield.CLEAR_NUMBER_WEAPON_ACCIDENT, vPhaseReport);\n         }\n \n         return false;\n     }\n+    \n+    /**\n+     * Worker function that clears minefields.\n+     */\n+    private void clearMineFields(Coords targetPos, int targetNum, Vector<Report> vPhaseReport) {", "originalCommit": "090657ada3d36b88cb785603ff3c08ca6c76932e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwMjIwMg==", "url": "https://github.com/MegaMek/megamek/pull/1737#discussion_r388702202", "bodyText": "I checked with the rules team and FAE can clear minefields per the rules in TO. For all the hexes the FAE covers. So they are pretty good minesweepers.", "author": "HammerGS", "createdAt": "2020-03-06T03:57:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5Njk1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcwODA4OQ==", "url": "https://github.com/MegaMek/megamek/pull/1737#discussion_r388708089", "bodyText": "Ok, I'll make the necessary changes.", "author": "NickAragua", "createdAt": "2020-03-06T04:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5Njk1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODY5NzE0Ng==", "url": "https://github.com/MegaMek/megamek/pull/1737#discussion_r388697146", "bodyText": "The \"contains minefield\" check was redundant.", "author": "NickAragua", "createdAt": "2020-03-06T03:31:28Z", "path": "megamek/src/megamek/common/weapons/ArtilleryWeaponIndirectFireHandler.java", "diffHunk": "@@ -461,24 +448,30 @@ else if ((null != bestSpotter) && !(this instanceof ArtilleryWeaponDirectFireHan\n \n         // artillery may unintentially clear minefields, but only if it wasn't\n         // trying to\n-        if (!mineClear && game.containsMinefield(targetPos)) {\n-            Enumeration<Minefield> minefields = game.getMinefields(targetPos)\n-                    .elements();\n-            ArrayList<Minefield> mfRemoved = new ArrayList<Minefield>();\n-            while (minefields.hasMoreElements()) {\n-                Minefield mf = minefields.nextElement();\n-                if (server.clearMinefield(mf, ae, 10, vPhaseReport)) {\n-                    mfRemoved.add(mf);\n-                }\n-            }\n-            // we have to do it this way to avoid a concurrent error problem\n-            for (Minefield mf : mfRemoved) {\n-                server.removeMinefield(mf);\n-            }\n+        if (!mineClear) {", "originalCommit": "090657ada3d36b88cb785603ff3c08ca6c76932e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f0864b81d43d03b580b69ac69841b88eaf74f53", "url": "https://github.com/MegaMek/megamek/commit/7f0864b81d43d03b580b69ac69841b88eaf74f53", "message": "FAE *can* clear minefields", "committedDate": "2020-03-06T05:31:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3NjEyMQ==", "url": "https://github.com/MegaMek/megamek/pull/1737#discussion_r390076121", "bodyText": "It would be helpful to add a comment here that 62 is already in use, as is done elsewhere that the numbers are out of order.", "author": "neoancient", "createdAt": "2020-03-10T03:25:39Z", "path": "megamek/src/megamek/common/AmmoType.java", "diffHunk": "@@ -333,9 +333,11 @@\n     \n     // More SRM+LRM Munitions types\n     public static final long M_MINE_CLEARANCE = 1l << 61;\n+    \n+    public static final long M_FAE = 1l << 63;\n   \n   \n-    // Numbers 62-63 are used for Nuclear munitions, above ", "originalCommit": "7f0864b81d43d03b580b69ac69841b88eaf74f53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d4e0700b44b38e6075141bb5e7262a9a159161d", "url": "https://github.com/MegaMek/megamek/commit/0d4e0700b44b38e6075141bb5e7262a9a159161d", "message": "updated comment", "committedDate": "2020-03-10T22:40:38Z", "type": "commit"}]}