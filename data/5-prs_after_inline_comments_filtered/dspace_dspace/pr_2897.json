{"pr_number": 2897, "pr_title": "#2893 Move builders from dspace-server-webapp to dspace-api.", "pr_createdAt": "2020-07-21T21:06:19Z", "pr_url": "https://github.com/DSpace/DSpace/pull/2897", "timeline": [{"oid": "dd9c0b9999f75f1f2045da8e382bd7fca39e93cd", "url": "https://github.com/DSpace/DSpace/commit/dd9c0b9999f75f1f2045da8e382bd7fca39e93cd", "message": "#2893 Move builders from dspace-server-webapp to dspace-api.", "committedDate": "2020-07-22T12:50:20Z", "type": "commit"}, {"oid": "9d6c8891ec8bff691f3576a2cbdef827e9b23baf", "url": "https://github.com/DSpace/DSpace/commit/9d6c8891ec8bff691f3576a2cbdef827e9b23baf", "message": "#2893 Rebase on current main, patch recently-added class, tidy documentation.", "committedDate": "2020-07-22T13:58:23Z", "type": "commit"}, {"oid": "9d6c8891ec8bff691f3576a2cbdef827e9b23baf", "url": "https://github.com/DSpace/DSpace/commit/9d6c8891ec8bff691f3576a2cbdef827e9b23baf", "message": "#2893 Rebase on current main, patch recently-added class, tidy documentation.", "committedDate": "2020-07-22T13:58:23Z", "type": "forcePushed"}, {"oid": "459dc2163b5906e139d61de1efa35a85f9670928", "url": "https://github.com/DSpace/DSpace/commit/459dc2163b5906e139d61de1efa35a85f9670928", "message": "Fix bad LGTM default that suppresses test JARs.", "committedDate": "2020-07-22T16:02:15Z", "type": "commit"}, {"oid": "daed71b91bd7985507c67883ac4f3e8916320e21", "url": "https://github.com/DSpace/DSpace/commit/daed71b91bd7985507c67883ac4f3e8916320e21", "message": "Add shebang to lgtm-build in attempt to make it work.", "committedDate": "2020-07-22T19:07:25Z", "type": "commit"}, {"oid": "ef353a5f44e6dc6541deb5f027b41b91d127399a", "url": "https://github.com/DSpace/DSpace/commit/ef353a5f44e6dc6541deb5f027b41b91d127399a", "message": "Try again to make LGTM run custom command", "committedDate": "2020-07-22T19:22:05Z", "type": "commit"}, {"oid": "453e1c9c914b975ca3f2f5d8607634a092fbfffc", "url": "https://github.com/DSpace/DSpace/commit/453e1c9c914b975ca3f2f5d8607634a092fbfffc", "message": "Yet another attempt to understand undocumented LGTM build command(s)", "committedDate": "2020-07-22T19:28:12Z", "type": "commit"}, {"oid": "c1139ff0a3e425f2153aca73782eb31a2df8926d", "url": "https://github.com/DSpace/DSpace/commit/c1139ff0a3e425f2153aca73782eb31a2df8926d", "message": "Trim lgtm build command some more", "committedDate": "2020-07-22T19:42:13Z", "type": "commit"}, {"oid": "b14f52313e0e992d3ca8c1d26046f9d4c7e809bb", "url": "https://github.com/DSpace/DSpace/commit/b14f52313e0e992d3ca8c1d26046f9d4c7e809bb", "message": "Set JAVA_HOME trying to make LGTM work as UNdocumented.", "committedDate": "2020-07-23T14:32:10Z", "type": "commit"}, {"oid": "0076e6b37b178059c0e788f5726bd9cf19384096", "url": "https://github.com/DSpace/DSpace/commit/0076e6b37b178059c0e788f5726bd9cf19384096", "message": "Clean up a lot of ErrorProne and Checkstyle warnings.  #2983\nSo I can see what else is wrong.", "committedDate": "2020-07-23T17:00:36Z", "type": "commit"}, {"oid": "ca31be285989295b93ba66c211230e786faf34f3", "url": "https://github.com/DSpace/DSpace/commit/ca31be285989295b93ba66c211230e786faf34f3", "message": "#2983 More Checkstyle errors", "committedDate": "2020-07-23T17:30:51Z", "type": "commit"}, {"oid": "1ec7c38675944b26b6ec2c81642f8510abefe678", "url": "https://github.com/DSpace/DSpace/commit/1ec7c38675944b26b6ec2c81642f8510abefe678", "message": "Use skipTests not maven.test.skip so tests always built; fix dependencies. #2983", "committedDate": "2020-07-24T01:15:25Z", "type": "commit"}, {"oid": "46dc547db86afb4f1bcfc6863bc9ae00a0c63e83", "url": "https://github.com/DSpace/DSpace/commit/46dc547db86afb4f1bcfc6863bc9ae00a0c63e83", "message": "#2893 Reconfigure test building on LGTM", "committedDate": "2020-07-24T14:33:26Z", "type": "commit"}, {"oid": "f2ad45d25d7b269e5a1a6a691ea0b8a91aebbc80", "url": "https://github.com/DSpace/DSpace/commit/f2ad45d25d7b269e5a1a6a691ea0b8a91aebbc80", "message": "Merge branch 'main' into #2893", "committedDate": "2020-07-24T14:38:06Z", "type": "commit"}, {"oid": "bc4663b783b8bcaa09794f4473026d2b810c0f91", "url": "https://github.com/DSpace/DSpace/commit/bc4663b783b8bcaa09794f4473026d2b810c0f91", "message": "#2893 try LGTM with default command again", "committedDate": "2020-07-24T14:39:23Z", "type": "commit"}, {"oid": "20a3d94a1b9c39b15067189079777c0b08919b12", "url": "https://github.com/DSpace/DSpace/commit/20a3d94a1b9c39b15067189079777c0b08919b12", "message": "#2893 Re-enable test running in Travis; document changes to how-to-test.", "committedDate": "2020-07-24T14:53:34Z", "type": "commit"}, {"oid": "f6a0d76094e4120d7a6e1226b216cd9df3f8a08d", "url": "https://github.com/DSpace/DSpace/commit/f6a0d76094e4120d7a6e1226b216cd9df3f8a08d", "message": "#2893 Discard un-needed custom LGTM build script.", "committedDate": "2020-07-24T15:19:02Z", "type": "commit"}, {"oid": "7f0a6771bc7b0f36a7bb530b72f74da7b7d7cedd", "url": "https://github.com/DSpace/DSpace/commit/7f0a6771bc7b0f36a7bb530b72f74da7b7d7cedd", "message": "#2893 Rework a dspace-api IT to use Builders as a demo.", "committedDate": "2020-07-24T21:13:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzNTI2Mg==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r461635262", "bodyText": "Rather than manually installing the Item, you can just use the ItemBuilder here.  For example, remove the call to the WorkspaceItemBuilder and replace all this with:\nItem item = ItemBuilder.createItem(context, collection).withAuthor(\"Donald,Smith\").build();\n\nThis would allow you to remove the itemService.delete() at the end of this method as well (along with the context turn off/on authN surrounding it).", "author": "tdonohue", "createdAt": "2020-07-28T14:40:21Z", "path": "dspace-api/src/test/java/org/dspace/app/bulkedit/MetadataExportIT.java", "diffHunk": "@@ -14,58 +14,60 @@\n import java.nio.charset.StandardCharsets;\n \n import org.apache.commons.io.IOUtils;\n-import org.dspace.AbstractIntegrationTest;\n+import org.dspace.AbstractIntegrationTestWithDatabase;\n import org.dspace.app.launcher.ScriptLauncher;\n import org.dspace.app.scripts.handler.impl.TestDSpaceRunnableHandler;\n+import org.dspace.builder.CollectionBuilder;\n+import org.dspace.builder.CommunityBuilder;\n+import org.dspace.builder.WorkspaceItemBuilder;\n import org.dspace.content.Collection;\n import org.dspace.content.Community;\n import org.dspace.content.Item;\n import org.dspace.content.WorkspaceItem;\n import org.dspace.content.factory.ContentServiceFactory;\n-import org.dspace.content.service.CollectionService;\n-import org.dspace.content.service.CommunityService;\n import org.dspace.content.service.InstallItemService;\n import org.dspace.content.service.ItemService;\n-import org.dspace.content.service.WorkspaceItemService;\n import org.dspace.services.ConfigurationService;\n import org.dspace.services.factory.DSpaceServicesFactory;\n import org.junit.Test;\n \n-public class MetadataExportTest extends AbstractIntegrationTest {\n-\n-    private ItemService itemService = ContentServiceFactory.getInstance().getItemService();\n-    private CollectionService collectionService = ContentServiceFactory.getInstance().getCollectionService();\n-    private CommunityService communityService = ContentServiceFactory.getInstance().getCommunityService();\n-    private WorkspaceItemService workspaceItemService = ContentServiceFactory.getInstance().getWorkspaceItemService();\n-    private InstallItemService installItemService = ContentServiceFactory.getInstance().getInstallItemService();\n-    private ConfigurationService configurationService = DSpaceServicesFactory.getInstance().getConfigurationService();\n+public class MetadataExportIT\n+        extends AbstractIntegrationTestWithDatabase {\n+    private final ItemService itemService\n+            = ContentServiceFactory.getInstance().getItemService();\n+    private final InstallItemService installItemService\n+            = ContentServiceFactory.getInstance().getInstallItemService();\n+    private final ConfigurationService configurationService\n+            = DSpaceServicesFactory.getInstance().getConfigurationService();\n \n     @Test\n     public void metadataExportToCsvTest() throws Exception {\n         context.turnOffAuthorisationSystem();\n-        Community community = communityService.create(null, context);\n-        Collection collection = collectionService.create(context, community);\n-        WorkspaceItem wi = workspaceItemService.create(context, collection, true);\n+        Community community = CommunityBuilder.createCommunity(context).build();\n+        Collection collection = CollectionBuilder.createCollection(context, community).build();\n+        WorkspaceItem wi = WorkspaceItemBuilder.createWorkspaceItem(context, collection).build();\n         Item item = wi.getItem();\n         itemService.addMetadata(context, item, \"dc\", \"contributor\", \"author\", null, \"Donald, Smith\");\n         item = installItemService.installItem(context, wi);", "originalCommit": "7f0a6771bc7b0f36a7bb530b72f74da7b7d7cedd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY2NTQxMw==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r461665413", "bodyText": "Thank you.  That's much neater.  I'm not at all familiar with using the Builder classes yet....", "author": "mwoodiupui", "createdAt": "2020-07-28T15:18:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzNTI2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzODgyMw==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r461638823", "bodyText": "Why is this method needed?  Is it an @Override?", "author": "tdonohue", "createdAt": "2020-07-28T14:44:40Z", "path": "dspace-api/src/test/java/org/dspace/discovery/MockSolrSearchCore.java", "diffHunk": "@@ -22,4 +22,8 @@ public void afterPropertiesSet() throws Exception {\n         solr = null;\n     }\n \n+    public void reset() {\n+        // This method intentionally left blank.", "originalCommit": "7f0a6771bc7b0f36a7bb530b72f74da7b7d7cedd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTg0Mzc5NA==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r461843794", "bodyText": "I added it because AbstractIntegrationTestWithDatabase calls it.\nThere used to be two MockSolrSearchCore classes, one in dspace-api and one in dspace-server-webapp.  I think that when I merged them, I kept the wrong one.  I'll try it the other way.", "author": "mwoodiupui", "createdAt": "2020-07-28T20:04:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzODgyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ0NTM1MQ==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r462445351", "bodyText": "Thank you for asking.  This opened an interesting can of worms.  I hadn't copied enough from dspace-server-webapp, which incorrectly allowed this to succeed.", "author": "mwoodiupui", "createdAt": "2020-07-29T16:54:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTYzODgyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY0NjM2NQ==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r461646365", "bodyText": "Where is this method called/used? Should this have an @Override?  Or maybe more clear JavaDocs on its usage/purpose", "author": "tdonohue", "createdAt": "2020-07-28T14:53:51Z", "path": "dspace-api/src/test/java/org/dspace/statistics/MockSolrLoggerServiceImpl.java", "diffHunk": "@@ -62,18 +64,28 @@ public void afterPropertiesSet() throws Exception {\n      * @return faked CityResponse\n      */\n     private CityResponse mockCityResponse() {\n-        List<String> cityNames = new ArrayList<String>(Collections.singleton(\"New York\"));\n+        List<String> cityNames = new ArrayList<>(Collections.singleton(\"New York\"));\n         City city = new City(cityNames, 1, 1, new HashMap());\n \n-        List<String> countryNames = new ArrayList<String>(Collections.singleton(\"United States\"));\n+        List<String> countryNames = new ArrayList<>(Collections.singleton(\"United States\"));\n         Country country = new Country(countryNames, 1, 1, \"US\", new HashMap());\n \n         Location location = new Location(1, 1, 40.760498D, -73.9933D, 501, 1, \"EST\");\n \n         Postal postal = new Postal(\"10036\", 1);\n \n         return new CityResponse(city, new Continent(), country, location, new MaxMind(), postal,\n-                                country, new RepresentedCountry(), new ArrayList<>(0),\n-                                new Traits());\n+                                                 country,  new RepresentedCountry(), new ArrayList<>(0),\n+                                                 new Traits());\n+    }\n+\n+    /** Remove all records. */\n+    public void reset() {\n+        mockSolrServer.reset();", "originalCommit": "7f0a6771bc7b0f36a7bb530b72f74da7b7d7cedd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQ0NTgyMA==", "url": "https://github.com/DSpace/DSpace/pull/2897#discussion_r462445820", "bodyText": "It's called from AbstractIntegrationTestWith Database.  I've tried to improve the JavaDoc.", "author": "mwoodiupui", "createdAt": "2020-07-29T16:54:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTY0NjM2NQ=="}], "type": "inlineReview"}, {"oid": "e3bc495198fe1974d4ace715bccee6ee08333f4e", "url": "https://github.com/DSpace/DSpace/commit/e3bc495198fe1974d4ace715bccee6ee08333f4e", "message": "#2893 Tabs to spaces.", "committedDate": "2020-07-29T16:41:16Z", "type": "commit"}, {"oid": "ecd8a886337e74372cb322f0ea45c807ee536d65", "url": "https://github.com/DSpace/DSpace/commit/ecd8a886337e74372cb322f0ea45c807ee536d65", "message": "#2893 More proper use of Builders in demo test suite.", "committedDate": "2020-07-29T16:44:09Z", "type": "commit"}, {"oid": "8ee4b7ab9d4ccdc522d16f6436a042f57c61b573", "url": "https://github.com/DSpace/DSpace/commit/8ee4b7ab9d4ccdc522d16f6436a042f57c61b573", "message": "Address questions about dummy methods.  This breaks tests. #2893\nMerge more from dspace-server-webapp to make tests work again.\nTidy up XML layout.  Improve alignment of declared to actual dependencies.", "committedDate": "2020-07-29T16:48:31Z", "type": "commit"}, {"oid": "a27355f79a0b304068e496bc3f2e394a3d1c6926", "url": "https://github.com/DSpace/DSpace/commit/a27355f79a0b304068e496bc3f2e394a3d1c6926", "message": "#2893 dspace/modules/additions also needs new dependencies, updates.", "committedDate": "2020-07-29T21:21:55Z", "type": "commit"}, {"oid": "442f563fccfe8af2810339fc03f24076c81acdcd", "url": "https://github.com/DSpace/DSpace/commit/442f563fccfe8af2810339fc03f24076c81acdcd", "message": "#2893 Move several explicit dependency versions up to dependencyManagement in parent.", "committedDate": "2020-07-31T20:30:02Z", "type": "commit"}, {"oid": "ea995d66aaaaeb8a70c4378da7855f9be847b918", "url": "https://github.com/DSpace/DSpace/commit/ea995d66aaaaeb8a70c4378da7855f9be847b918", "message": "Merge remote-tracking branch 'upstream/main' into #2893", "committedDate": "2020-07-31T20:50:27Z", "type": "commit"}, {"oid": "dc198bae00198ffd068d74d913aa67206f914714", "url": "https://github.com/DSpace/DSpace/commit/dc198bae00198ffd068d74d913aa67206f914714", "message": "#2893 Fix new class that used old package for Builders.", "committedDate": "2020-07-31T20:52:59Z", "type": "commit"}, {"oid": "87843a0edc82a491aa56bd016b88bfc9dfcc0f91", "url": "https://github.com/DSpace/DSpace/commit/87843a0edc82a491aa56bd016b88bfc9dfcc0f91", "message": "Merge remote-tracking branch 'upstream/main' into #2893", "committedDate": "2020-07-31T22:12:23Z", "type": "commit"}, {"oid": "e1ad520c86e0f8b56a452d22ca5aabfba6d2820a", "url": "https://github.com/DSpace/DSpace/commit/e1ad520c86e0f8b56a452d22ca5aabfba6d2820a", "message": "Merge remote-tracking branch 'upstream/main' into #2893", "committedDate": "2020-08-04T17:08:45Z", "type": "commit"}]}