{"pr_number": 1466, "pr_title": "Add Course Reset Dates banner on CourseOutlineFragment.java", "pr_createdAt": "2020-10-01T16:42:22Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1466", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODg5MTg4Nw==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498891887", "bodyText": "use / before the path, to make parity with others.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T15:26:27Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/course/CourseService.java", "diffHunk": "@@ -138,6 +140,12 @@ public CourseService get() {\n     @GET(\"api/course_home/v1/dates/{course_key}\")\n     Call<CourseDates> getCourseDates(@Path(\"course_key\") String courseId);\n \n+    @GET(\"api/course_experience/v1/course_deadlines_info/{course_key}\")\n+    Call<CourseBannerInfoModel> getCourseBannerInfo(@Path(\"course_key\") String courseId);\n+\n+    @POST(\"api/course_experience/v1/reset_course_deadlines\")\n+    Call<ResetCourseDates> resetCourseDates(@Body HashMap<String, String> courseBody);\n+", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxMjM0NQ==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498912345", "bodyText": "why need to add this isBannerVisible ? deserve doc string.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T16:03:20Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -97,6 +106,7 @@\n     private EnrolledCoursesResponse courseData;\n     private String courseComponentId;\n     private boolean isVideoMode;\n+    private boolean isBannerVisible = false;", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2NDQzNw==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r499064437", "bodyText": "Flag to check the course dates banner visibility as we are adding the banner as an item in listView which should be only visible on CourseUnitDashboard.", "author": "omerhabib26", "createdAt": "2020-10-02T21:48:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxMjM0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxMjc0NQ==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498912745", "bodyText": "Remove un-necessary comments.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T16:04:06Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile\n+            switch (courseBannerInfo.getDatesBannerInfo().getCourseBannerType()) {\n+                case UPGRADE_TO_GRADED:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_graded));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_graded_button);\n+                    break;\n+                case UPGRADE_TO_RESET:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_reset));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_reset_button);\n+                    break;\n+                case RESET_DATES:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_reset_date));\n+                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_reset_date_button);", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2Nzc5Ng==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r499067796", "bodyText": "Removed", "author": "omerhabib26", "createdAt": "2020-10-02T22:00:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODkxMjc0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDIwNw==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498940207", "bodyText": "Add todo.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T16:58:53Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2Nzc1OA==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r499067758", "bodyText": "Added", "author": "omerhabib26", "createdAt": "2020-10-02T22:00:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDUxMQ==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498940511", "bodyText": "better to add the following code:\n            listView.removeHeaderView(bannerViewBinding.getRoot());\n            isBannerVisible = false;", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T16:59:31Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile\n+            switch (courseBannerInfo.getDatesBannerInfo().getCourseBannerType()) {\n+                case UPGRADE_TO_GRADED:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_graded));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_graded_button);\n+                    break;\n+                case UPGRADE_TO_RESET:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_reset));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_reset_button);\n+                    break;\n+                case RESET_DATES:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_reset_date));\n+                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_reset_date_button);\n+                    break;\n+                case INFO_BANNER:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_info_banner));\n+                    break;\n+                case BLANK:\n+                    break;", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2NTcxNw==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r499065717", "bodyText": "(Y)", "author": "omerhabib26", "createdAt": "2020-10-02T21:53:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDUxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDc4Mw==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498940783", "bodyText": "no need to pass the boolean as always show progress.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T17:00:10Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -398,6 +478,54 @@ public void viewDownloadsStatus() {\n         }\n     }\n \n+    /**\n+     * Initialized dates info banner on CourseOutlineFragment\n+     *\n+     * @param courseBannerInfo object of course deadline info\n+     */\n+    private void initDatesBanner(CourseBannerInfoModel courseBannerInfo) {\n+        LayoutCourseDatesBannerBinding bannerViewBinding = DataBindingUtil.inflate(getLayoutInflater(), R.layout.layout_course_dates_banner, listView, false);\n+        if (courseBannerInfo != null && !isVideoMode && isOnCourseOutline && !courseBannerInfo.getHasEnded()) {\n+            String buttonText = \"\";\n+            // Currently we are only handling RESET_DATES case,\n+            // UPGRADE_TO_GRADED & UPGRADE_TO_RESET will be enable once we are allowed to do payment through mobile\n+            switch (courseBannerInfo.getDatesBannerInfo().getCourseBannerType()) {\n+                case UPGRADE_TO_GRADED:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_graded));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_graded_button);\n+                    break;\n+                case UPGRADE_TO_RESET:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_upgrade_to_reset));\n+//                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_upgrade_to_reset_button);\n+                    break;\n+                case RESET_DATES:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_banner_reset_date));\n+                    buttonText = getContextOrThrow().getString(R.string.course_dates_banner_reset_date_button);\n+                    break;\n+                case INFO_BANNER:\n+                    bannerViewBinding.bannerInfo.setText(getText(R.string.course_dates_info_banner));\n+                    break;\n+                case BLANK:\n+                    break;\n+            }\n+\n+            if (listView.getHeaderViewsCount() == 0 && !TextUtils.isEmpty(bannerViewBinding.bannerInfo.getText())) {\n+                if (!TextUtils.isEmpty(buttonText)) {\n+                    bannerViewBinding.btnShiftDates.setText(buttonText);\n+                    bannerViewBinding.btnShiftDates.setVisibility(View.VISIBLE);\n+                    bannerViewBinding.btnShiftDates.setOnClickListener(v -> {\n+                        resetCourseDatesBanner(true);", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTA2Nzg0MQ==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r499067841", "bodyText": "Removed", "author": "omerhabib26", "createdAt": "2020-10-02T22:00:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MDc4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MTU3Nw==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498941577", "bodyText": "better to rename as COURSE_KEY", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T17:01:53Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/constants/ApiConstants.java", "diffHunk": "@@ -44,6 +44,8 @@\n \n     public static final String VALIDATION_DECISIONS = \"validation_decisions\";\n \n+    public static final String KEY_COURSE_ID = \"course_key\";", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MjE2Ng==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498942166", "bodyText": "need doc-string.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T17:03:01Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -339,6 +413,9 @@ private void initListView(@NonNull View view) {\n         listView.setOnItemClickListener(new AdapterView.OnItemClickListener() {\n             @Override\n             public void onItemClick(AdapterView<?> parent, View view, int position, long id) {\n+                if (!isVideoMode && isBannerVisible && position == 0) {", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5ODk0MjI1Mg==", "url": "https://github.com/edx/edx-app-android/pull/1466#discussion_r498942252", "bodyText": "same.", "author": "farhan-arshad-dev", "createdAt": "2020-10-02T17:03:13Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/CourseOutlineFragment.java", "diffHunk": "@@ -357,6 +434,9 @@ public void onItemClick(AdapterView<?> parent, View view, int position, long id)\n         listView.setOnItemLongClickListener(new AdapterView.OnItemLongClickListener() {\n             @Override\n             public boolean onItemLongClick(AdapterView<?> parent, View view, int position, long id) {\n+                if (!isVideoMode && isBannerVisible && position == 0) {\n+                    return false;\n+                }", "originalCommit": "651d9514ba99b5352061a4274d6bf30f17ca62fd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "url": "https://github.com/edx/edx-app-android/commit/1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "message": "Add Course Reset Dates banner on CourseOutlineFragment.java\n- LEARNER-7824\n- Add Option to shift dates for verified learner\n- Show dialog box on success/unsuccess of shift dates API call", "committedDate": "2020-10-05T07:56:18Z", "type": "commit"}, {"oid": "1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "url": "https://github.com/edx/edx-app-android/commit/1ee7dcd913bc5abc49a2cb8ddb6bca5b4088d195", "message": "Add Course Reset Dates banner on CourseOutlineFragment.java\n- LEARNER-7824\n- Add Option to shift dates for verified learner\n- Show dialog box on success/unsuccess of shift dates API call", "committedDate": "2020-10-05T07:56:18Z", "type": "forcePushed"}]}