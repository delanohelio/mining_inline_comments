{"pr_number": 1442, "pr_title": "Registration Form Validation", "pr_createdAt": "2020-07-23T20:55:10Z", "pr_url": "https://github.com/edx/edx-app-android/pull/1442", "timeline": [{"oid": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "url": "https://github.com/edx/edx-app-android/commit/3600dfc92e94dee01034a6c5101ea6a2052092cd", "message": "Registration Validation API usage\n- LEARNER-7835\n- Validate the registration form and show the error inline with each field that had invalid data, otherwise call the registration API and register the learner.", "committedDate": "2020-07-23T20:45:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MDIxNw==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459960217", "bodyText": "Remove extra line", "author": "omerhabib26", "createdAt": "2020-07-24T09:56:24Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/authentication/LoginService.java", "diffHunk": "@@ -41,6 +42,17 @@ public LoginService get() {\n         }\n     }\n \n+", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5NjMxMQ==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459996311", "bodyText": "removed.", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T11:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MDIxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MTQzNw==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459961437", "bodyText": "IMO, it should be \"URL_VALIDATE_REGISTERATION_FIELDS\"", "author": "omerhabib26", "createdAt": "2020-07-24T09:59:13Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/http/constants/ApiConstants.java", "diffHunk": "@@ -32,6 +32,8 @@\n \n     public static final String URL_REGISTRATION = \"/user_api/{\" + API_VERSION + \"}/account/registration/\";\n \n+    public static final String URL_VALIDATION_REGISTRATION = \"/api/user/v1/validation/registration\";", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5ODg5OA==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459998898", "bodyText": "updated to URL_VALIDATE_REGISTRATION_FIELDS", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T11:33:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk2MTQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTAzOA==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459971038", "bodyText": "IMO, it should be \"getRegistrationParameters\"", "author": "omerhabib26", "createdAt": "2020-07-24T10:22:29Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -368,6 +391,46 @@ public void onClick(DialogInterface dialog, int which) {\n         task.execute();\n     }\n \n+    private Bundle getRegistrationParameter() {", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAwMjk1MQ==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r460002951", "bodyText": "Renamed.", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T11:43:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTAzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTMxMA==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459971310", "bodyText": "remove irrelevant comment or update it", "author": "omerhabib26", "createdAt": "2020-07-24T10:23:11Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -368,6 +391,46 @@ public void onClick(DialogInterface dialog, int which) {\n         task.execute();\n     }\n \n+    private Bundle getRegistrationParameter() {\n+        boolean hasError = false;\n+        // prepare query (POST body)", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAwMzAzNA==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r460003034", "bodyText": "removed.", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T11:43:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk3MTMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk4MjI0MQ==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459982241", "bodyText": "IMO, can we make the doc a bit simple?", "author": "omerhabib26", "createdAt": "2020-07-24T10:50:31Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/authentication/LoginService.java", "diffHunk": "@@ -41,6 +42,17 @@ public LoginService get() {\n         }\n     }\n \n+\n+    /**\n+     * Depending on the query parameters for this endpoint, a different action will be triggered", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5OTc3OA==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459999778", "bodyText": "done.", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T11:35:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk4MjI0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5MjUwNg==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459992506", "bodyText": "Can we make a common function for this as L:329 has the same code", "author": "omerhabib26", "createdAt": "2020-07-24T11:17:01Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -183,6 +189,62 @@ public void onClick(View v) {\n         tryToSetUIInteraction(true);\n     }\n \n+    private void validateRegistrationFields() {\n+        Bundle parameters = getRegistrationParameter();\n+        if (parameters == null) {\n+            return;\n+        }\n+        showProgress();\n+        final Map<String, String> parameterMap = new HashMap<>();\n+        for (String key : parameters.keySet()) {\n+            parameterMap.put(key, parameters.getString(key));\n+        }\n+        Call<JsonObject> validateRegistrationFields = loginService.validateRegistrationFields(parameterMap);\n+        validateRegistrationFields.enqueue(new ErrorHandlingCallback<JsonObject>(this) {\n+            @Override\n+            protected void onResponse(@NonNull JsonObject responseBody) {\n+                final Type stringMapType = new TypeToken<HashMap<String, String>>() {\n+                }.getType();\n+                final HashMap<String, String> messageBody = new Gson().fromJson(responseBody.get(\"validation_decisions\"), stringMapType);\n+                if (hasValidationError(messageBody)) {\n+                    hideProgress();\n+                } else {\n+                    createAccount(parameters);\n+                }\n+            }\n+\n+            @Override\n+            protected void onFailure(@NonNull Throwable error) {\n+                hideProgress();\n+                RegisterActivity.this.showAlertDialog(null, ErrorUtils.getErrorMessage(error,\n+                        RegisterActivity.this));\n+                logger.error(error);\n+            }\n+        });\n+    }\n+\n+    private boolean hasValidationError(HashMap<String, String> messageBody) {\n+        boolean errorShown = false;\n+        for (String key : messageBody.keySet()) {", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDAxMTUzMw==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r460011533", "bodyText": "I already tried but both lines of codes have the following differences.\n\nUsing Difference HashMap types.\nThe availability of error messages are different.\nScenarios Conditions.\n\nAlso, the effort is more than it's worth to create a common method.", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T12:04:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5MjUwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5NDI3Ng==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459994276", "bodyText": "Can we use a constant for \"validation_decisions\"", "author": "omerhabib26", "createdAt": "2020-07-24T11:21:30Z", "path": "OpenEdXMobile/src/main/java/org/edx/mobile/view/RegisterActivity.java", "diffHunk": "@@ -183,6 +189,62 @@ public void onClick(View v) {\n         tryToSetUIInteraction(true);\n     }\n \n+    private void validateRegistrationFields() {\n+        Bundle parameters = getRegistrationParameter();\n+        if (parameters == null) {\n+            return;\n+        }\n+        showProgress();\n+        final Map<String, String> parameterMap = new HashMap<>();\n+        for (String key : parameters.keySet()) {\n+            parameterMap.put(key, parameters.getString(key));\n+        }\n+        Call<JsonObject> validateRegistrationFields = loginService.validateRegistrationFields(parameterMap);\n+        validateRegistrationFields.enqueue(new ErrorHandlingCallback<JsonObject>(this) {\n+            @Override\n+            protected void onResponse(@NonNull JsonObject responseBody) {\n+                final Type stringMapType = new TypeToken<HashMap<String, String>>() {\n+                }.getType();\n+                final HashMap<String, String> messageBody = new Gson().fromJson(responseBody.get(\"validation_decisions\"), stringMapType);", "originalCommit": "3600dfc92e94dee01034a6c5101ea6a2052092cd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5OTk5OA==", "url": "https://github.com/edx/edx-app-android/pull/1442#discussion_r459999998", "bodyText": "Declare in ApiConstants.java named VALIDATION_DECISIONS", "author": "farhan-arshad-dev", "createdAt": "2020-07-24T11:36:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTk5NDI3Ng=="}], "type": "inlineReview"}, {"oid": "1d4a61739cd97403f388f792406d89104c5dd8c3", "url": "https://github.com/edx/edx-app-android/commit/1d4a61739cd97403f388f792406d89104c5dd8c3", "message": "Address PR comments", "committedDate": "2020-07-24T12:42:31Z", "type": "commit"}]}