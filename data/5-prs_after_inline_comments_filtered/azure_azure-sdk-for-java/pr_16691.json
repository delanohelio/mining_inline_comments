{"pr_number": 16691, "pr_title": "Improve code coverage for Azure Certificates", "pr_createdAt": "2020-10-22T17:27:27Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16691", "timeline": [{"oid": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "message": "Improve code coverage for Azure Certificates", "committedDate": "2020-10-22T17:18:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ2MDk1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r510460953", "bodyText": "We prefer to use all the explicit imports for our SDKs instead of the asterisk(*) notation.", "author": "vcolin7", "createdAt": "2020-10-22T21:13:32Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -9,19 +9,10 @@\n import com.azure.core.http.HttpClient;\n import com.azure.core.http.HttpPipeline;\n import com.azure.core.http.rest.PagedIterable;\n+import com.azure.core.util.Context;\n import com.azure.core.util.polling.PollResponse;\n import com.azure.core.util.polling.SyncPoller;\n-import com.azure.security.keyvault.certificates.models.CertificateContact;\n-import com.azure.security.keyvault.certificates.models.CertificateContentType;\n-import com.azure.security.keyvault.certificates.models.CertificateIssuer;\n-import com.azure.security.keyvault.certificates.models.CertificateOperation;\n-import com.azure.security.keyvault.certificates.models.CertificatePolicy;\n-import com.azure.security.keyvault.certificates.models.CertificateProperties;\n-import com.azure.security.keyvault.certificates.models.DeletedCertificate;\n-import com.azure.security.keyvault.certificates.models.IssuerProperties;\n-import com.azure.security.keyvault.certificates.models.KeyVaultCertificate;\n-import com.azure.security.keyvault.certificates.models.KeyVaultCertificateWithPolicy;\n-import com.azure.security.keyvault.certificates.models.MergeCertificateOptions;\n+import com.azure.security.keyvault.certificates.models.*;", "originalCommit": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQ2MTAyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r510461028", "bodyText": "Use explicit imports.", "author": "vcolin7", "createdAt": "2020-10-22T21:13:40Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -30,17 +21,9 @@\n import java.security.cert.CertificateException;\n import java.security.cert.X509Certificate;\n import java.time.Duration;\n-import java.util.Arrays;\n-import java.util.HashMap;\n-import java.util.HashSet;\n-import java.util.List;\n-import java.util.Map;\n-\n-import static org.junit.jupiter.api.Assertions.assertEquals;\n-import static org.junit.jupiter.api.Assertions.assertFalse;\n-import static org.junit.jupiter.api.Assertions.assertNotNull;\n-import static org.junit.jupiter.api.Assertions.assertTrue;\n-import static org.junit.jupiter.api.Assertions.fail;\n+import java.util.*;\n+\n+import static org.junit.jupiter.api.Assertions.*;", "originalCommit": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzEyMjU0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r513122548", "bodyText": "I would rename this to listPropertiesOfCertificates since that is the method name being called.", "author": "vcolin7", "createdAt": "2020-10-28T01:15:35Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -437,6 +429,28 @@ public void listCertificates(HttpClient httpClient, CertificateServiceVersion se\n         });\n     }\n \n+\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void listPropertyOfCertificates(HttpClient httpClient, CertificateServiceVersion serviceVersion) {", "originalCommit": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzEyMzE0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r513123148", "bodyText": "Please refer to my comments on CertificateClient on the naming this method and listPropertyOfCertificates.", "author": "vcolin7", "createdAt": "2020-10-28T01:17:49Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -241,10 +231,18 @@ void getCertificateOperationRunner(Consumer<String> testRunner) {\n     @Test\n     public abstract void cancelCertificateOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n \n+\n     void cancelCertificateOperationRunner(Consumer<String> testRunner) {\n         testRunner.accept(generateResourceId(\"testCertificate11\"));\n     }\n \n+    @Test\n+    public abstract void cancelCertificateCreationOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n+\n+    void cancelCertificateCreationOperationRunner(Consumer<String> testRunner) {\n+        testRunner.accept(generateResourceId(\"testCertificate11\"));\n+    }", "originalCommit": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzEyMzUxNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r513123517", "bodyText": "I don't know if we need different runners for overloads of the same method if they do the same thing. I guess it's ok to leave it as is but may be a good thing to consider in a future revision.", "author": "vcolin7", "createdAt": "2020-10-28T01:19:22Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -283,6 +280,19 @@ void listCertificatesRunner(Consumer<List<String>> testRunner) {\n         testRunner.accept(certificates);\n     }\n \n+    @Test\n+    public abstract void listPropertyOfCertificates(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n+\n+    void listPropertyOfCertificatesRunner(Consumer<List<String>> testRunner){", "originalCommit": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzEyNDgwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r513124806", "bodyText": "We probably should simulate an actual scenario like firing the creation of a certificate and then cancelling the operation like the above method does. Of course, in this case we would use the cancelCertificateOperation method instead of cancelling through the poller just like you did here.", "author": "vcolin7", "createdAt": "2020-10-28T01:23:56Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -364,6 +347,15 @@ public void cancelCertificateOperation(HttpClient httpClient, CertificateService\n         });\n     }\n \n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void cancelCertificateCreationOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n+        createCertificateClient(httpClient, serviceVersion);\n+        cancelCertificateCreationOperationRunner((certName) -> {\n+            client.cancelCertificateOperation(certName);\n+        });", "originalCommit": "f2d41c1c3bf64c34d379e9104e9607dc3cf8e8f2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f28800e5b2418f1d7950d7cbff06ce7e27f339e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f28800e5b2418f1d7950d7cbff06ce7e27f339e", "message": "fix: fix Azure Certificates", "committedDate": "2020-10-28T08:45:39Z", "type": "commit"}, {"oid": "c3e69b8ac75923c28d606443164825715ae3fee0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3e69b8ac75923c28d606443164825715ae3fee0", "message": "fix: fix Azure Certificates", "committedDate": "2020-10-28T10:05:14Z", "type": "commit"}, {"oid": "d3a656748d79e73bc4c4d4e01f490a118a2682b9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d3a656748d79e73bc4c4d4e01f490a118a2682b9", "message": "fix: fix checkstyle in Azure Certificate", "committedDate": "2020-10-30T10:28:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNTg4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r515415889", "bodyText": "Please refer to my comment in CertificateClient about renaming this method.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public abstract void listPropertyOfCertificatesThroughPoller(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n          \n          \n            \n                public abstract void listPropertiesOfCertificates(HttpClient httpClient, CertificateServiceVersion serviceVersion);", "author": "vcolin7", "createdAt": "2020-10-30T22:56:37Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -283,6 +299,19 @@ void listCertificatesRunner(Consumer<List<String>> testRunner) {\n         testRunner.accept(certificates);\n     }\n \n+    @Test\n+    public abstract void listPropertyOfCertificatesThroughPoller(HttpClient httpClient, CertificateServiceVersion serviceVersion);", "originalCommit": "d3a656748d79e73bc4c4d4e01f490a118a2682b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNjAyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r515416024", "bodyText": "Please refer to my comment in CertificateClient about renaming this method.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                void listPropertyOfCertificatesRunner(Consumer<List<String>> testRunner) {\n          \n          \n            \n                void listPropertiesOfCertificatesRunner(Consumer<List<String>> testRunner) {", "author": "vcolin7", "createdAt": "2020-10-30T22:57:13Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -283,6 +299,19 @@ void listCertificatesRunner(Consumer<List<String>> testRunner) {\n         testRunner.accept(certificates);\n     }\n \n+    @Test\n+    public abstract void listPropertyOfCertificatesThroughPoller(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n+\n+    void listPropertyOfCertificatesRunner(Consumer<List<String>> testRunner) {", "originalCommit": "d3a656748d79e73bc4c4d4e01f490a118a2682b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNzM2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r515417365", "bodyText": "Please refer to my comments on CertificateClient renaming this method.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                @Test\n          \n          \n            \n                public abstract void cancelCertificateCreationOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n          \n          \n            \n            \n          \n          \n            \n                void cancelCertificateCreationOperationRunner(Consumer<String> testRunner) {\n          \n          \n            \n                    testRunner.accept(generateResourceId(\"testCertificate11\"));\n          \n          \n            \n                }\n          \n          \n            \n                @Test\n          \n          \n            \n                public abstract void cancelCertificateOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n          \n          \n            \n            \n          \n          \n            \n                void cancelCertificateOperationRunner(Consumer<String> testRunner) {\n          \n          \n            \n                    testRunner.accept(generateResourceId(\"testCertificate11\"));\n          \n          \n            \n                }", "author": "vcolin7", "createdAt": "2020-10-30T23:03:16Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTestBase.java", "diffHunk": "@@ -241,10 +250,18 @@ void getCertificateOperationRunner(Consumer<String> testRunner) {\n     @Test\n     public abstract void cancelCertificateOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n \n+\n     void cancelCertificateOperationRunner(Consumer<String> testRunner) {\n         testRunner.accept(generateResourceId(\"testCertificate11\"));\n     }\n \n+    @Test\n+    public abstract void cancelCertificateCreationOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion);\n+\n+    void cancelCertificateCreationOperationRunner(Consumer<String> testRunner) {\n+        testRunner.accept(generateResourceId(\"testCertificate11\"));\n+    }", "originalCommit": "d3a656748d79e73bc4c4d4e01f490a118a2682b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNzg0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r515417845", "bodyText": "We should rename this to createCertificateOperation and have the method above it be called createCertificateOperationThroughPoller or something like that, feels more descriptive of what both methods do.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void cancelCertificateCreationOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n          \n          \n            \n                    createCertificateClient(httpClient, serviceVersion);\n          \n          \n            \n                    cancelCertificateCreationOperationRunner((certName) -> {\n          \n          \n            \n                public void cancelCertificateOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n          \n          \n            \n                    createCertificateClient(httpClient, serviceVersion);\n          \n          \n            \n                    cancelCertificateOperationRunner((certName) -> {", "author": "vcolin7", "createdAt": "2020-10-30T23:05:11Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -364,6 +363,15 @@ public void cancelCertificateOperation(HttpClient httpClient, CertificateService\n         });\n     }\n \n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void cancelCertificateCreationOperation(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n+        createCertificateClient(httpClient, serviceVersion);\n+        cancelCertificateCreationOperationRunner((certName) -> {", "originalCommit": "d3a656748d79e73bc4c4d4e01f490a118a2682b9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxODA0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r515418042", "bodyText": "Also, please refer to this comment about the implementation of this test case.", "author": "vcolin7", "createdAt": "2020-10-30T23:05:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxNzg0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTQxODIzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16691#discussion_r515418234", "bodyText": "I suggested the throughPoller suffix for the first cancelCertificateOperation(), since it actually uses the actual Poller object to cancel the operation. This suffix is not necessary here because we are simply calling listPropertiesOfCertificates(). I would still rename it to that exact name instead of having it deviate to listPropertyOfCertificates().\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void listPropertyOfCertificatesThroughPoller(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n          \n          \n            \n                    createCertificateClient(httpClient, serviceVersion);\n          \n          \n            \n                    listPropertyOfCertificatesRunner((certificates) -> {\n          \n          \n            \n                public void listPropertiesOfCertificates(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n          \n          \n            \n                    createCertificateClient(httpClient, serviceVersion);\n          \n          \n            \n                    listPropertiesOfCertificatesRunner((certificates) -> {", "author": "vcolin7", "createdAt": "2020-10-30T23:06:49Z", "path": "sdk/keyvault/azure-security-keyvault-certificates/src/test/java/com/azure/security/keyvault/certificates/CertificateClientTest.java", "diffHunk": "@@ -437,6 +445,28 @@ public void listCertificates(HttpClient httpClient, CertificateServiceVersion se\n         });\n     }\n \n+\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"getTestParameters\")\n+    public void listPropertyOfCertificatesThroughPoller(HttpClient httpClient, CertificateServiceVersion serviceVersion) {\n+        createCertificateClient(httpClient, serviceVersion);\n+        listPropertyOfCertificatesRunner((certificates) -> {", "originalCommit": "d3a656748d79e73bc4c4d4e01f490a118a2682b9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b1c16dda4c71e75d891a26703b81e061fc690d90", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b1c16dda4c71e75d891a26703b81e061fc690d90", "message": "fix Azure Certificate previous naming issue & removed cancel certificate method", "committedDate": "2020-11-02T13:25:14Z", "type": "commit"}]}