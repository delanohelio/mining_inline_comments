{"pr_number": 17739, "pr_title": "SB T2 Fixing Live test", "pr_createdAt": "2020-11-21T05:14:48Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17739", "timeline": [{"oid": "9473ceb5b5fc0972cb791b2312c16da552d0ff9f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9473ceb5b5fc0972cb791b2312c16da552d0ff9f", "message": "Fixing live test", "committedDate": "2020-11-21T05:12:02Z", "type": "commit"}, {"oid": "4d0d0cbd4a608596cd1c2e3e72be5e202c83414c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4d0d0cbd4a608596cd1c2e3e72be5e202c83414c", "message": " more test fix", "committedDate": "2020-11-21T05:50:44Z", "type": "commit"}, {"oid": "dd1d58d69b959aa7cc61edaf90f533b43d8cbf86", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dd1d58d69b959aa7cc61edaf90f533b43d8cbf86", "message": " more test fix", "committedDate": "2020-11-21T06:10:30Z", "type": "commit"}, {"oid": "38cbdf7517547ffcfaa6b23c662d7f8ed5da8c9c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/38cbdf7517547ffcfaa6b23c662d7f8ed5da8c9c", "message": " more test fix", "committedDate": "2020-11-21T06:27:32Z", "type": "commit"}, {"oid": "c6feac8c6ad5ac4a55654af90ef616d465a0c31c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c6feac8c6ad5ac4a55654af90ef616d465a0c31c", "message": " more test fix", "committedDate": "2020-11-21T07:16:25Z", "type": "commit"}, {"oid": "310e4e4fdd851195e210cd819da7e47f0bb01ca2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/310e4e4fdd851195e210cd819da7e47f0bb01ca2", "message": " more test fix: receiveAndAutoComplete", "committedDate": "2020-11-21T08:03:24Z", "type": "commit"}, {"oid": "f32ebcbc5bd4aa6e26cfec9adf9f7a391d42cb57", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f32ebcbc5bd4aa6e26cfec9adf9f7a391d42cb57", "message": " more test fix", "committedDate": "2020-11-21T08:17:45Z", "type": "commit"}, {"oid": "6f2af6708cfe31187fa4a26a8e2d41966f6aef81", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f2af6708cfe31187fa4a26a8e2d41966f6aef81", "message": " more test fix", "committedDate": "2020-11-21T19:40:42Z", "type": "commit"}, {"oid": "880a4c98141e1e7b7b2318c72c6b02863c2a95a0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/880a4c98141e1e7b7b2318c72c6b02863c2a95a0", "message": " more test fix", "committedDate": "2020-11-21T20:08:02Z", "type": "commit"}, {"oid": "52ce168a4221da8ab516445343ec0d079c93eec8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/52ce168a4221da8ab516445343ec0d079c93eec8", "message": " more test fix", "committedDate": "2020-11-21T20:32:45Z", "type": "commit"}, {"oid": "6d0aad473bacab3bcc3f1af78d10d05cc42eefaa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6d0aad473bacab3bcc3f1af78d10d05cc42eefaa", "message": "Fixing queue index", "committedDate": "2020-11-21T20:59:23Z", "type": "commit"}, {"oid": "5ddc8c4dd6c385dfe78d60e9b0c04bc61a2f6629", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ddc8c4dd6c385dfe78d60e9b0c04bc61a2f6629", "message": "Fixing queue index and increasing queues", "committedDate": "2020-11-21T22:19:59Z", "type": "commit"}, {"oid": "dded1e4a415cf5fd80698901db44eed50646fd99", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dded1e4a415cf5fd80698901db44eed50646fd99", "message": "Fixing some test, same fix as other", "committedDate": "2020-11-22T01:42:26Z", "type": "commit"}, {"oid": "73b2d79ed98be9b2a4b57e10254105e1722acddc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/73b2d79ed98be9b2a4b57e10254105e1722acddc", "message": "Fixing some test", "committedDate": "2020-11-22T08:07:01Z", "type": "commit"}, {"oid": "3dfe2559e2376a91c0e51b67cb91959ab00e3db8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3dfe2559e2376a91c0e51b67cb91959ab00e3db8", "message": "Continue test", "committedDate": "2020-11-22T16:38:31Z", "type": "commit"}, {"oid": "073d4e9f078f9b57162bf6f3975c42ee885a02f0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/073d4e9f078f9b57162bf6f3975c42ee885a02f0", "message": "Closing session REceiver connection", "committedDate": "2020-11-22T19:13:40Z", "type": "commit"}, {"oid": "5d4eff0305adba5235dbcf9dd9d42d0c3c5426cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5d4eff0305adba5235dbcf9dd9d42d0c3c5426cf", "message": "Closing session Receiver connection", "committedDate": "2020-11-22T20:13:16Z", "type": "commit"}, {"oid": "b6fbd287cfe82db5740e21dcbf0237aaecd55e23", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b6fbd287cfe82db5740e21dcbf0237aaecd55e23", "message": "Fixing sendReceiveMessageWithVariousPropertyTypes test", "committedDate": "2020-11-22T21:30:42Z", "type": "commit"}, {"oid": "85f86c15b681067df478b8ba9418e3510752215c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/85f86c15b681067df478b8ba9418e3510752215c", "message": "Fix more test and undo logging", "committedDate": "2020-11-22T23:39:30Z", "type": "commit"}, {"oid": "be8fe80402f1c4571517c3f8a02c53bda86e2dfb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/be8fe80402f1c4571517c3f8a02c53bda86e2dfb", "message": "Comment proxy test", "committedDate": "2020-11-23T01:52:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU3MTgwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r528571801", "bodyText": "Changing back to How Yijun has done for acceptNextSession. Exactly same way here.", "author": "hemanttanwar", "createdAt": "2020-11-23T09:38:25Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusSessionReceiverAsyncClient.java", "diffHunk": "@@ -110,16 +110,17 @@\n         if (CoreUtils.isNullOrEmpty(sessionId)) {\n             return monoError(logger, new IllegalArgumentException(\"'sessionId' cannot be empty\"));\n         }\n+\n         final ReceiverOptions newReceiverOptions = new ReceiverOptions(receiverOptions.getReceiveMode(),\n             receiverOptions.getPrefetchCount(), receiverOptions.getMaxLockRenewDuration(),\n             receiverOptions.isEnableAutoComplete(), sessionId, null);\n+        final ServiceBusSessionManager sessionSpecificManager = new ServiceBusSessionManager(entityPath, entityType,", "originalCommit": "be8fe80402f1c4571517c3f8a02c53bda86e2dfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "965e8535db9907e4e46e11999eff630f9581d37f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/965e8535db9907e4e46e11999eff630f9581d37f", "message": "Fixing unbounded request and other small changes", "committedDate": "2020-11-23T19:12:45Z", "type": "commit"}, {"oid": "05d0145987c3d556364eaba67c0b3631387ef6bf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/05d0145987c3d556364eaba67c0b3631387ef6bf", "message": "Merge branch 'master' into sb-t2-live-test-fixes", "committedDate": "2020-11-23T19:48:24Z", "type": "commit"}, {"oid": "e70dfb94f7033bc80532fa7d0c07caa907a67060", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e70dfb94f7033bc80532fa7d0c07caa907a67060", "message": "Merge master into branch", "committedDate": "2020-11-23T19:50:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwNDE5OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r529004199", "bodyText": "getMessage(messageId, isSessionEnabled); Already set session id , we do not need this again.", "author": "hemanttanwar", "createdAt": "2020-11-23T21:21:15Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClientIntegrationTest.java", "diffHunk": "@@ -659,90 +716,90 @@ void receiveAndRenewLock(MessagingEntityType entityType) {\n     @ParameterizedTest\n     void autoRenewLockOnReceiveMessage(MessagingEntityType entityType, boolean isSessionEnabled) {\n         // Arrange\n-        setSenderAndReceiver(entityType, 0, isSessionEnabled);\n+        final AtomicInteger lockRenewCount = new AtomicInteger();\n+\n+        setSender(entityType, TestUtils.USE_CASE_DEFAULT, isSessionEnabled);\n \n         final String messageId = UUID.randomUUID().toString();\n         final ServiceBusMessage message = getMessage(messageId, isSessionEnabled);\n \n-        if (isSessionEnabled) {\n-            message.setSessionId(sessionId);\n-        }", "originalCommit": "e70dfb94f7033bc80532fa7d0c07caa907a67060", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTAwNTgyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r529005822", "bodyText": "Just like we are checking constant values for other properties, I an using fixed value here.  This is to avoid left over messages case.", "author": "hemanttanwar", "createdAt": "2020-11-23T21:24:45Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClientIntegrationTest.java", "diffHunk": "@@ -819,34 +875,31 @@ void sendReceiveMessageWithVariousPropertyTypes(MessagingEntityType entityType)\n         sentProperties.put(\"FloatProperty\", 5.5f);\n         sentProperties.put(\"DoubleProperty\", 6.6f);\n         sentProperties.put(\"CharProperty\", 'z');\n-        sentProperties.put(\"UUIDProperty\", UUID.randomUUID());\n+        sentProperties.put(\"UUIDProperty\", UUID.fromString(\"38400000-8cf0-11bd-b23e-10b96e4ef00d\"));\n         sentProperties.put(\"StringProperty\", \"string\");", "originalCommit": "e70dfb94f7033bc80532fa7d0c07caa907a67060", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bde657c103f4d1ff0255fb9152ea5e1eca131be1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bde657c103f4d1ff0255fb9152ea5e1eca131be1", "message": "code cleanup", "committedDate": "2020-11-23T21:46:12Z", "type": "commit"}, {"oid": "70783292094639b1fc82d9f274d277310ba5a6e9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/70783292094639b1fc82d9f274d277310ba5a6e9", "message": "Fixing unit test", "committedDate": "2020-11-23T23:15:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA2ODI2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r529068268", "bodyText": "Do we really need this to be a member variable? Isn't this only tested in a few test cases.", "author": "conniey", "createdAt": "2020-11-23T23:42:58Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClientIntegrationTest.java", "diffHunk": "@@ -63,6 +62,7 @@\n \n     private ServiceBusReceiverAsyncClient receiver;\n     private ServiceBusSenderAsyncClient sender;\n+    private ServiceBusSessionReceiverAsyncClient sessionReceiver;", "originalCommit": "70783292094639b1fc82d9f274d277310ba5a6e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIwMzUxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r529203518", "bodyText": "It is used for all the session based test, we have atleaset 8-10 test using it.\nThe session test, use receiver and that receiver is created using this ServiceBusSessionReceiverAsyncClient and we have to close this intermediate builder.", "author": "hemanttanwar", "createdAt": "2020-11-24T04:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA2ODI2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA2ODU1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r529068558", "bodyText": "Why are we using concatMap rather than flatMap? I'm confused by this chain.", "author": "conniey", "createdAt": "2020-11-23T23:43:48Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClientIntegrationTest.java", "diffHunk": "@@ -124,12 +126,13 @@ void createTransactionAndRollbackMessagesTest(MessagingEntityType entityType) {\n             })\n             .verifyComplete();\n \n-        final ServiceBusReceivedMessage receivedMessage = receiver.receiveMessages().next().block(OPERATION_TIMEOUT);\n-        assertNotNull(receivedMessage);\n+        StepVerifier.create(receiver.receiveMessages()\n+            .concatMap(receivedMessage -> receiver.complete(receivedMessage).thenReturn(receivedMessage)).next())", "originalCommit": "70783292094639b1fc82d9f274d277310ba5a6e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTIwMzk0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17739#discussion_r529203944", "bodyText": "Updated with, flatMap instead.", "author": "hemanttanwar", "createdAt": "2020-11-24T05:00:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTA2ODU1OA=="}], "type": "inlineReview"}, {"oid": "bdb547854eeef98b1d536e1d9e416fd003950ce0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bdb547854eeef98b1d536e1d9e416fd003950ce0", "message": "Closing deadletter", "committedDate": "2020-11-24T01:49:39Z", "type": "commit"}, {"oid": "e1926ae44ecbe71ca18ec4a79bf29e00e2c3deb0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e1926ae44ecbe71ca18ec4a79bf29e00e2c3deb0", "message": "Fixing some more test", "committedDate": "2020-11-24T02:14:51Z", "type": "commit"}, {"oid": "ea25394371a620e946dc3fc9e15c979f447b7b0a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ea25394371a620e946dc3fc9e15c979f447b7b0a", "message": "space fix", "committedDate": "2020-11-24T05:04:17Z", "type": "commit"}, {"oid": "99ea471e1fd4b16b724620d578a7ca3f9301f6d3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/99ea471e1fd4b16b724620d578a7ca3f9301f6d3", "message": "Adjusting some integration test", "committedDate": "2020-11-24T06:55:08Z", "type": "commit"}, {"oid": "c34275eef9d9f2790b55c4d781f5ac42920c0bf3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c34275eef9d9f2790b55c4d781f5ac42920c0bf3", "message": "Review comments", "committedDate": "2020-11-24T21:11:56Z", "type": "commit"}, {"oid": "d57df539638aa1c3ec82cb4d898a25587456b954", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d57df539638aa1c3ec82cb4d898a25587456b954", "message": "Review comments", "committedDate": "2020-11-24T21:38:39Z", "type": "commit"}, {"oid": "0513caf63c18c45bb23ac8b1dedc60c3fdc2cc15", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0513caf63c18c45bb23ac8b1dedc60c3fdc2cc15", "message": "Small change to take message", "committedDate": "2020-11-24T22:21:13Z", "type": "commit"}]}