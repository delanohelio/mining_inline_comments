{"pr_number": 17096, "pr_title": "[Service Bus ] Rename ServiceBusAmqpException to ServiceBusReceiverException ", "pr_createdAt": "2020-11-03T03:59:20Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17096", "timeline": [{"oid": "e7df936056cd75aa660a1b5ae59fc14ae336a116", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e7df936056cd75aa660a1b5ae59fc14ae336a116", "message": "Rename ServiceBusReceiverException", "committedDate": "2020-11-03T03:55:10Z", "type": "commit"}, {"oid": "c7a30192bd57556599fe3c45817f36b09b57b159", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c7a30192bd57556599fe3c45817f36b09b57b159", "message": "Rename ServiceBusReceiverException", "committedDate": "2020-11-03T03:56:21Z", "type": "commit"}, {"oid": "c08bfa21a1f397efe774bd8ed226d4985d34ac89", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c08bfa21a1f397efe774bd8ed226d4985d34ac89", "message": "Merge branch 'master' into sb-ts-servicebusreceiver-exception-name-change", "committedDate": "2020-11-03T05:49:34Z", "type": "commit"}, {"oid": "0864a0c6d32f2fa6f307c224bded5a525dc1f47c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0864a0c6d32f2fa6f307c224bded5a525dc1f47c", "message": "fix unit etst", "committedDate": "2020-11-03T06:01:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ3OTM0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516479347", "bodyText": "This can be simplified\nif (throwable instanceof AmqpException) { \n   return new ServiceBusReceiverException((AmqpException) throwable, errorSource);\n}\nreturn throwable;", "author": "srnagar", "createdAt": "2020-11-03T08:01:38Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClient.java", "diffHunk": "@@ -1163,13 +1163,13 @@ private String getLinkName(String sessionId) {\n     }\n \n     /**\n-     * Map the error to {@link ServiceBusAmqpException}\n+     * Map the error to {@link ServiceBusReceiverException}\n      */\n     private Throwable mapError(Throwable throwable, ServiceBusErrorSource errorSource) {\n-        if ((throwable instanceof ServiceBusAmqpException) || !(throwable instanceof AmqpException)) {\n+        if ((throwable instanceof ServiceBusReceiverException) || !(throwable instanceof AmqpException)) {\n             return throwable;\n         } else {\n-            return new ServiceBusAmqpException((AmqpException) throwable, errorSource);\n+            return new ServiceBusReceiverException((AmqpException) throwable, errorSource);\n         }", "originalCommit": "0864a0c6d32f2fa6f307c224bded5a525dc1f47c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4MjMxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516482313", "bodyText": "This should extend from AzureException in azure-core.", "author": "srnagar", "createdAt": "2020-11-03T08:08:13Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -0,0 +1,71 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.messaging.servicebus;\n+\n+import com.azure.core.amqp.exception.AmqpErrorCondition;\n+import com.azure.core.amqp.exception.AmqpErrorContext;\n+import com.azure.core.amqp.exception.AmqpException;\n+\n+/**\n+ * Defines {@link ServiceBusReceiverException} which has additional information about the operation that caused the\n+ * error.\n+ *\n+ * @see ServiceBusErrorSource\n+ */\n+public final class ServiceBusReceiverException extends Exception {", "originalCommit": "0864a0c6d32f2fa6f307c224bded5a525dc1f47c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjQ4MjM3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516482379", "bodyText": "These 3 methods are specific to AmqpException. We should instead override the getCause() method and return the underlying exception.", "author": "srnagar", "createdAt": "2020-11-03T08:08:23Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -0,0 +1,71 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.messaging.servicebus;\n+\n+import com.azure.core.amqp.exception.AmqpErrorCondition;\n+import com.azure.core.amqp.exception.AmqpErrorContext;\n+import com.azure.core.amqp.exception.AmqpException;\n+\n+/**\n+ * Defines {@link ServiceBusReceiverException} which has additional information about the operation that caused the\n+ * error.\n+ *\n+ * @see ServiceBusErrorSource\n+ */\n+public final class ServiceBusReceiverException extends Exception {\n+    private final transient ServiceBusErrorSource errorSource;\n+    private final AmqpException amqpException;\n+\n+    /**\n+     * @param amqpException for the error happened.\n+     * @param errorSource indicating which api caused the error.\n+     */\n+    ServiceBusReceiverException(AmqpException amqpException, ServiceBusErrorSource errorSource) {\n+        super(amqpException.getMessage(), amqpException.getCause());\n+        this.errorSource = errorSource;\n+        this.amqpException = amqpException;\n+    }\n+\n+    /**\n+     *  Gets the {@link ServiceBusErrorSource} in case of any errors.\n+     *\n+     * @return the {@link ServiceBusErrorSource}\n+     */\n+    public ServiceBusErrorSource getErrorSource() {\n+        return errorSource;\n+    }\n+\n+    @Override\n+    public String getMessage() {\n+        return amqpException.getMessage();\n+    }\n+\n+    /**\n+     * A boolean indicating if the exception is a transient error or not.\n+     *\n+     * @return returns true when user can retry the operation that generated the exception without additional\n+     * intervention.\n+     */\n+    public boolean isTransient() {\n+        return amqpException.isTransient();\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpErrorCondition} for this exception.\n+     *\n+     * @return The {@link AmqpErrorCondition} for this exception, or {@code null} if nothing was set.\n+     */\n+    public AmqpErrorCondition getErrorCondition() {\n+        return amqpException.getErrorCondition();\n+    }\n+\n+    /**\n+     * Gets the context for this exception.\n+     *\n+     * @return The context for this exception.\n+     */\n+    public AmqpErrorContext getContext() {\n+        return amqpException.getContext();\n+    }", "originalCommit": "0864a0c6d32f2fa6f307c224bded5a525dc1f47c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2c0d90f72fc3446c504705c5277afe2c0ba71b29", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2c0d90f72fc3446c504705c5277afe2c0ba71b29", "message": "Review comments", "committedDate": "2020-11-03T16:26:21Z", "type": "commit"}, {"oid": "c02107474977d73e0ebe7caf4782bd61272ebcde", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c02107474977d73e0ebe7caf4782bd61272ebcde", "message": "Merge branch 'master' into sb-ts-servicebusreceiver-exception-name-change", "committedDate": "2020-11-03T16:27:25Z", "type": "commit"}, {"oid": "84d6f03a3bbf5951e93907f3c4e161ef4af8e61a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/84d6f03a3bbf5951e93907f3c4e161ef4af8e61a", "message": "Review comments'", "committedDate": "2020-11-03T17:07:12Z", "type": "commit"}, {"oid": "53a74304314b9b4665b69655f4730130a227f44e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/53a74304314b9b4665b69655f4730130a227f44e", "message": "review comments", "committedDate": "2020-11-03T17:17:45Z", "type": "commit"}, {"oid": "8807aef88bcb53970b9d47aadd32c6a8336c7a05", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8807aef88bcb53970b9d47aadd32c6a8336c7a05", "message": "fix code style", "committedDate": "2020-11-03T17:24:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgyODE3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516828173", "bodyText": "From our discussion yesterday, I thought we decided to keep this as extending from Exception in the case that there are exceptions other than AmqpException.", "author": "conniey", "createdAt": "2020-11-03T17:13:43Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -13,59 +11,33 @@\n  *\n  * @see ServiceBusErrorSource\n  */\n-public final class ServiceBusReceiverException extends Exception {\n+public final class ServiceBusReceiverException extends AmqpException {", "originalCommit": "84d6f03a3bbf5951e93907f3c4e161ef4af8e61a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg0NzcyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516847722", "bodyText": "extending it from AzureException as suggested by Srikanta", "author": "hemanttanwar", "createdAt": "2020-11-03T17:45:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgyODE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjgzODExOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516838119", "bodyText": "Should we have a constructor that just takes Exception? Then in the map all the receive errors that aren't AMQP exceptions to that.\nServiceBusReceiverAsyncClient. L1198", "author": "conniey", "createdAt": "2020-11-03T17:29:11Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -13,59 +11,33 @@\n  *\n  * @see ServiceBusErrorSource\n  */\n-public final class ServiceBusReceiverException extends Exception {\n+public final class ServiceBusReceiverException extends AmqpException {\n     private final transient ServiceBusErrorSource errorSource;\n-    private final AmqpException amqpException;\n \n     /**\n      * @param amqpException for the error happened.\n      * @param errorSource indicating which api caused the error.\n      */\n     ServiceBusReceiverException(AmqpException amqpException, ServiceBusErrorSource errorSource) {", "originalCommit": "84d6f03a3bbf5951e93907f3c4e161ef4af8e61a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b302b45677f3cb3474a98cc9b414c6580f4d41e8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b302b45677f3cb3474a98cc9b414c6580f4d41e8", "message": "Review comments", "committedDate": "2020-11-03T18:18:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3ODI4MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516878280", "bodyText": "Do you need to override this? It just calls the base class.", "author": "conniey", "createdAt": "2020-11-03T18:38:50Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -3,26 +3,34 @@\n \n package com.azure.messaging.servicebus;\n \n-import com.azure.core.amqp.exception.AmqpException;\n+import com.azure.core.exception.AzureException;\n \n /**\n- * Defines {@link ServiceBusAmqpException} which has additional information about the operation that caused the error.\n+ * Defines {@link ServiceBusReceiverException} which has additional information about the operation that caused the\n+ * error.\n  *\n  * @see ServiceBusErrorSource\n  */\n-public final class ServiceBusAmqpException extends AmqpException {\n+public final class ServiceBusReceiverException extends AzureException {\n     private final transient ServiceBusErrorSource errorSource;\n \n     /**\n-     * @param amqpException for the error hapened.\n+     * @param throwable for the error happened.\n      * @param errorSource indicating which api caused the error.\n      */\n-    ServiceBusAmqpException(AmqpException amqpException, ServiceBusErrorSource errorSource) {\n-        super(amqpException.isTransient(), amqpException.getErrorCondition(), amqpException.getMessage(),\n-            amqpException.getCause(), amqpException.getContext());\n+    ServiceBusReceiverException(Throwable throwable, ServiceBusErrorSource errorSource) {\n+        super(throwable.getMessage(), throwable.getCause());\n         this.errorSource = errorSource;\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public Throwable getCause() {", "originalCommit": "b302b45677f3cb3474a98cc9b414c6580f4d41e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3NzI0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516877248", "bodyText": "Why are we not wrapping AmqpException?", "author": "srnagar", "createdAt": "2020-11-03T18:36:55Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClient.java", "diffHunk": "@@ -1188,14 +1188,14 @@ private String getLinkName(String sessionId) {\n     }\n \n     /**\n-     * Map the error to {@link ServiceBusAmqpException}\n+     * Map the error to {@link ServiceBusReceiverException}\n      */\n     private Throwable mapError(Throwable throwable, ServiceBusErrorSource errorSource) {\n-        if ((throwable instanceof ServiceBusAmqpException) || !(throwable instanceof AmqpException)) {\n-            return throwable;\n-        } else {\n-            return new ServiceBusAmqpException((AmqpException) throwable, errorSource);\n+        // If it is already `ServiceBusReceiverException`, we can just throw it.\n+        if (!(throwable instanceof AmqpException) && !(throwable instanceof ServiceBusReceiverException)) {", "originalCommit": "b302b45677f3cb3474a98cc9b414c6580f4d41e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkzNDQ2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516934460", "bodyText": "based on our discussion converting all the exception to SBRE .", "author": "hemanttanwar", "createdAt": "2020-11-03T20:23:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3NzI0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3NzgwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516877802", "bodyText": "Since we are wrapping the exception, throwable itself will be the cause.", "author": "srnagar", "createdAt": "2020-11-03T18:37:58Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -3,26 +3,34 @@\n \n package com.azure.messaging.servicebus;\n \n-import com.azure.core.amqp.exception.AmqpException;\n+import com.azure.core.exception.AzureException;\n \n /**\n- * Defines {@link ServiceBusAmqpException} which has additional information about the operation that caused the error.\n+ * Defines {@link ServiceBusReceiverException} which has additional information about the operation that caused the\n+ * error.\n  *\n  * @see ServiceBusErrorSource\n  */\n-public final class ServiceBusAmqpException extends AmqpException {\n+public final class ServiceBusReceiverException extends AzureException {\n     private final transient ServiceBusErrorSource errorSource;\n \n     /**\n-     * @param amqpException for the error hapened.\n+     * @param throwable for the error happened.\n      * @param errorSource indicating which api caused the error.\n      */\n-    ServiceBusAmqpException(AmqpException amqpException, ServiceBusErrorSource errorSource) {\n-        super(amqpException.isTransient(), amqpException.getErrorCondition(), amqpException.getMessage(),\n-            amqpException.getCause(), amqpException.getContext());\n+    ServiceBusReceiverException(Throwable throwable, ServiceBusErrorSource errorSource) {\n+        super(throwable.getMessage(), throwable.getCause());", "originalCommit": "b302b45677f3cb3474a98cc9b414c6580f4d41e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3ODA4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516878089", "bodyText": "This is not required since the inherited method already does the same thing. It's required only if you have to customize this method.", "author": "srnagar", "createdAt": "2020-11-03T18:38:29Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverException.java", "diffHunk": "@@ -3,26 +3,34 @@\n \n package com.azure.messaging.servicebus;\n \n-import com.azure.core.amqp.exception.AmqpException;\n+import com.azure.core.exception.AzureException;\n \n /**\n- * Defines {@link ServiceBusAmqpException} which has additional information about the operation that caused the error.\n+ * Defines {@link ServiceBusReceiverException} which has additional information about the operation that caused the\n+ * error.\n  *\n  * @see ServiceBusErrorSource\n  */\n-public final class ServiceBusAmqpException extends AmqpException {\n+public final class ServiceBusReceiverException extends AzureException {\n     private final transient ServiceBusErrorSource errorSource;\n \n     /**\n-     * @param amqpException for the error hapened.\n+     * @param throwable for the error happened.\n      * @param errorSource indicating which api caused the error.\n      */\n-    ServiceBusAmqpException(AmqpException amqpException, ServiceBusErrorSource errorSource) {\n-        super(amqpException.isTransient(), amqpException.getErrorCondition(), amqpException.getMessage(),\n-            amqpException.getCause(), amqpException.getContext());\n+    ServiceBusReceiverException(Throwable throwable, ServiceBusErrorSource errorSource) {\n+        super(throwable.getMessage(), throwable.getCause());\n         this.errorSource = errorSource;\n     }\n \n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public Throwable getCause() {\n+        return super.getCause();\n+    }", "originalCommit": "b302b45677f3cb3474a98cc9b414c6580f4d41e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjg3OTM5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516879396", "bodyText": "If the exception type is AmqpException then we should wrap it even in default case with UNKNOWN source.", "author": "srnagar", "createdAt": "2020-11-03T18:41:04Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClient.java", "diffHunk": "@@ -1038,10 +1038,10 @@ private boolean isManagementToken(String lockToken) {\n                 if (receiverOptions.isEnableAutoComplete() && throwable instanceof AmqpException) {\n                     switch (dispositionStatus) {\n                         case COMPLETED:\n-                            return new ServiceBusAmqpException((AmqpException) throwable,\n+                            return new ServiceBusReceiverException((AmqpException) throwable,\n                                 ServiceBusErrorSource.COMPLETE);\n                         case ABANDONED:\n-                            return new ServiceBusAmqpException((AmqpException) throwable,\n+                            return new ServiceBusReceiverException((AmqpException) throwable,\n                                 ServiceBusErrorSource.ABANDONED);\n                         default:\n                             // Do nothing", "originalCommit": "b302b45677f3cb3474a98cc9b414c6580f4d41e8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ed3d5bb288d64f4283b4c91f9ec90d2c171c8fa9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ed3d5bb288d64f4283b4c91f9ec90d2c171c8fa9", "message": "changes based o review comments", "committedDate": "2020-11-03T20:07:04Z", "type": "commit"}, {"oid": "9c0affac1e28a6a712a29ceec3c0630c1157d521", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c0affac1e28a6a712a29ceec3c0630c1157d521", "message": " Review comments", "committedDate": "2020-11-03T20:53:34Z", "type": "commit"}, {"oid": "f0f2d22ad1f29447a61ff14078948088b78ae77d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f0f2d22ad1f29447a61ff14078948088b78ae77d", "message": " Review comments", "committedDate": "2020-11-03T20:59:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk1NTQ5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17096#discussion_r516955494", "bodyText": "I don't think this comment applies anymore.", "author": "conniey", "createdAt": "2020-11-03T21:06:40Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceiverAsyncClient.java", "diffHunk": "@@ -1034,20 +1034,15 @@ private boolean isManagementToken(String lockToken) {\n         }\n         return updateDispositionOperation\n             .onErrorMap(throwable -> {\n-                // We only populate ErrorSource only when AutoComplete is enabled.\n-                if (receiverOptions.isEnableAutoComplete() && throwable instanceof AmqpException) {\n-                    switch (dispositionStatus) {\n-                        case COMPLETED:\n-                            return new ServiceBusAmqpException((AmqpException) throwable,\n-                                ServiceBusErrorSource.COMPLETE);\n-                        case ABANDONED:\n-                            return new ServiceBusAmqpException((AmqpException) throwable,\n-                                ServiceBusErrorSource.ABANDONED);\n-                        default:\n-                            // Do nothing\n-                    }\n+                // We only populate ErrorSource for scenario covered by ServiceBusErrorSource enum.", "originalCommit": "9c0affac1e28a6a712a29ceec3c0630c1157d521", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "87dd79034cbc0499334b9cee9f02681c8e6a5e25", "url": "https://github.com/Azure/azure-sdk-for-java/commit/87dd79034cbc0499334b9cee9f02681c8e6a5e25", "message": "removed unwanted comment", "committedDate": "2020-11-03T21:16:06Z", "type": "commit"}]}