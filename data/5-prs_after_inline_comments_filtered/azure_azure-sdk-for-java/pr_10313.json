{"pr_number": 10313, "pr_title": "Add TestWatcher to Print Testing Information", "pr_createdAt": "2020-04-17T01:12:39Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10313", "timeline": [{"oid": "e7a6afcb2e8121199fde1afb58e6116bc4c6a88f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e7a6afcb2e8121199fde1afb58e6116bc4c6a88f", "message": "Prototype for test watcher concept", "committedDate": "2020-04-17T01:11:04Z", "type": "commit"}, {"oid": "9ff039760454936c51decc981d20587d85284781", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9ff039760454936c51decc981d20587d85284781", "message": "Added client parent and module-info", "committedDate": "2020-04-17T17:54:44Z", "type": "commit"}, {"oid": "4b687cdcf2973c23fe0118d40c05196d9d195cc5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4b687cdcf2973c23fe0118d40c05196d9d195cc5", "message": "Small additional change", "committedDate": "2020-04-17T18:18:02Z", "type": "commit"}, {"oid": "798b968a5c3db199bbb67da89b30d13d71e2eb38", "url": "https://github.com/Azure/azure-sdk-for-java/commit/798b968a5c3db199bbb67da89b30d13d71e2eb38", "message": "Make SPI work for test watcher", "committedDate": "2020-04-17T19:44:18Z", "type": "commit"}, {"oid": "9f77f18fac7df46f08891e0f7abc0e87c6cfc4c0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9f77f18fac7df46f08891e0f7abc0e87c6cfc4c0", "message": "Merge remote-tracking branch 'upstream/master' into AzEng_TestWatcher", "committedDate": "2020-04-17T19:44:28Z", "type": "commit"}, {"oid": "6af28f7f99b26bc22ecf378732fcdbb050702da2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6af28f7f99b26bc22ecf378732fcdbb050702da2", "message": "Merge from master", "committedDate": "2020-04-17T19:46:19Z", "type": "commit"}, {"oid": "6bd463140e22af694d56ae13ef1b78819cb8618d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6bd463140e22af694d56ae13ef1b78819cb8618d", "message": "Merge branch 'master' into AzEng_TestWatcher", "committedDate": "2020-04-17T20:41:21Z", "type": "commit"}, {"oid": "41a4eb16b3c588eb85d8ed2bfbfe959d574a2a1e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/41a4eb16b3c588eb85d8ed2bfbfe959d574a2a1e", "message": "Merge branch 'AzEng_TestWatcher' of https://github.com/alzimmermsft/azure-sdk-for-java into AzEng_TestWatcher", "committedDate": "2020-04-17T20:42:36Z", "type": "commit"}, {"oid": "94bfd5717140e489bcb8a1a9ac5a6ba04dcfd866", "url": "https://github.com/Azure/azure-sdk-for-java/commit/94bfd5717140e489bcb8a1a9ac5a6ba04dcfd866", "message": "Reduce configurationParameters", "committedDate": "2020-04-17T20:46:54Z", "type": "commit"}, {"oid": "0e41322db8da7e0ec6a2edc18ddab1be36b11fc6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0e41322db8da7e0ec6a2edc18ddab1be36b11fc6", "message": "Removed configuration from AppConfig", "committedDate": "2020-04-17T20:49:50Z", "type": "commit"}, {"oid": "5364c62829c601598cfbdee69af68076248957c9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5364c62829c601598cfbdee69af68076248957c9", "message": "Update log message, removed parent POM, cleaned up POM", "committedDate": "2020-04-17T21:09:24Z", "type": "commit"}, {"oid": "34c765dce7b10bdfeeddcf48fd0441876abc9f07", "url": "https://github.com/Azure/azure-sdk-for-java/commit/34c765dce7b10bdfeeddcf48fd0441876abc9f07", "message": "Removed effective-pom used to verification of configuration inheritence", "committedDate": "2020-04-17T21:10:36Z", "type": "commit"}, {"oid": "34c765dce7b10bdfeeddcf48fd0441876abc9f07", "url": "https://github.com/Azure/azure-sdk-for-java/commit/34c765dce7b10bdfeeddcf48fd0441876abc9f07", "message": "Removed effective-pom used to verification of configuration inheritence", "committedDate": "2020-04-17T21:10:36Z", "type": "forcePushed"}, {"oid": "28b578c86477a2fb63c5d1fc3661630a6b0eb0c6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/28b578c86477a2fb63c5d1fc3661630a6b0eb0c6", "message": "Fix missing version tag and added reporter to global configuration", "committedDate": "2020-04-17T22:10:19Z", "type": "commit"}, {"oid": "f3701ff340ee43a0e8a4b9a2b18761f63bc226ed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3701ff340ee43a0e8a4b9a2b18761f63bc226ed", "message": "Merged in master", "committedDate": "2020-04-17T22:33:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0OTgzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r410749837", "bodyText": "nit: add new line.", "author": "conniey", "createdAt": "2020-04-18T20:57:58Z", "path": "eng/azure-test-watcher/src/main/java/com/azure/testing/package-info.java", "diffHunk": "@@ -0,0 +1,7 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+/**\n+ * Package containing JUnit 5 testing extensions.\n+ */\n+package com.azure.testing;", "originalCommit": "f3701ff340ee43a0e8a4b9a2b18761f63bc226ed", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTUyMjM4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r411522385", "bodyText": "Added", "author": "alzimmermsft", "createdAt": "2020-04-20T16:33:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMDc0OTgzNw=="}], "type": "inlineReview"}, {"oid": "b0c19f328983da4d81928bb6488fdfb040e787c5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0c19f328983da4d81928bb6488fdfb040e787c5", "message": "Merge branch 'master' into AzEng_TestWatcher", "committedDate": "2020-04-20T16:28:52Z", "type": "commit"}, {"oid": "d92e970214240d5cbb22375c6aa29b46e429f7c6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d92e970214240d5cbb22375c6aa29b46e429f7c6", "message": "Moved from eng/ to common/", "committedDate": "2020-04-20T16:32:40Z", "type": "commit"}, {"oid": "debbbcae970e8d845fa977848bed040ca3a8917e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/debbbcae970e8d845fa977848bed040ca3a8917e", "message": "Fixed module path", "committedDate": "2020-04-20T16:35:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNDEwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r412234101", "bodyText": "nit: completed -> Completed", "author": "conniey", "createdAt": "2020-04-21T14:27:52Z", "path": "common/azure-test-watcher/src/main/java/com/azure/testing/AzureTestWatcher.java", "diffHunk": "@@ -0,0 +1,50 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.testing;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+\n+import java.lang.reflect.Method;\n+import java.util.Objects;\n+\n+/**\n+ * JUnit 5 extension class which reports on testing running and simple metrics about the test such as run time.\n+ */\n+public class AzureTestWatcher implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+    @Override\n+    public void beforeTestExecution(ExtensionContext extensionContext) {\n+        String displayName = extensionContext.getDisplayName();\n+        getStore(extensionContext).put(extensionContext.getRequiredTestMethod(), System.currentTimeMillis());\n+\n+        String testName = \"\";\n+        String fullyQualifiedTestName = \"\";\n+        if (extensionContext.getTestMethod().isPresent()) {\n+            Method method = extensionContext.getTestMethod().get();\n+            testName = method.getName();\n+            fullyQualifiedTestName = method.getDeclaringClass().getName() + \".\" + testName;\n+        }\n+\n+        if (!Objects.equals(displayName, testName)) {\n+            System.out.printf(\"Starting test %s (%s), \", fullyQualifiedTestName, displayName);\n+        } else {\n+            System.out.printf(\"Starting test %s, \", fullyQualifiedTestName);\n+        }\n+    }\n+\n+    @Override\n+    public void afterTestExecution(ExtensionContext context) {\n+        Method testMethod = context.getRequiredTestMethod();\n+        long start = getStore(context).remove(testMethod, long.class);\n+        long duration = System.currentTimeMillis() - start;\n+\n+        System.out.printf(\"completed in %d ms.%n\", duration);", "originalCommit": "debbbcae970e8d845fa977848bed040ca3a8917e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE5NTIzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r413195239", "bodyText": "The idea was that this and the other print statement would form a single line.\nTest begins, console view:\nStarting test {qualified name} ({display name})\nTest completes, console view:\nStarting test {qualified name} ({display name}), completed in {millis} ms.{newline}.", "author": "alzimmermsft", "createdAt": "2020-04-22T17:54:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNDEwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNTAyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r412235024", "bodyText": "Do you need a %n for these too?", "author": "conniey", "createdAt": "2020-04-21T14:28:50Z", "path": "common/azure-test-watcher/src/main/java/com/azure/testing/AzureTestWatcher.java", "diffHunk": "@@ -0,0 +1,50 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.testing;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+\n+import java.lang.reflect.Method;\n+import java.util.Objects;\n+\n+/**\n+ * JUnit 5 extension class which reports on testing running and simple metrics about the test such as run time.\n+ */\n+public class AzureTestWatcher implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+    @Override\n+    public void beforeTestExecution(ExtensionContext extensionContext) {\n+        String displayName = extensionContext.getDisplayName();\n+        getStore(extensionContext).put(extensionContext.getRequiredTestMethod(), System.currentTimeMillis());\n+\n+        String testName = \"\";\n+        String fullyQualifiedTestName = \"\";\n+        if (extensionContext.getTestMethod().isPresent()) {\n+            Method method = extensionContext.getTestMethod().get();\n+            testName = method.getName();\n+            fullyQualifiedTestName = method.getDeclaringClass().getName() + \".\" + testName;\n+        }\n+\n+        if (!Objects.equals(displayName, testName)) {\n+            System.out.printf(\"Starting test %s (%s), \", fullyQualifiedTestName, displayName);", "originalCommit": "debbbcae970e8d845fa977848bed040ca3a8917e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNzMyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r412237326", "bodyText": "this could be a static method because it doesn't rely on any state from its parent class.", "author": "conniey", "createdAt": "2020-04-21T14:31:24Z", "path": "common/azure-test-watcher/src/main/java/com/azure/testing/AzureTestWatcher.java", "diffHunk": "@@ -0,0 +1,50 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.testing;\n+\n+import org.junit.jupiter.api.extension.AfterTestExecutionCallback;\n+import org.junit.jupiter.api.extension.BeforeTestExecutionCallback;\n+import org.junit.jupiter.api.extension.ExtensionContext;\n+\n+import java.lang.reflect.Method;\n+import java.util.Objects;\n+\n+/**\n+ * JUnit 5 extension class which reports on testing running and simple metrics about the test such as run time.\n+ */\n+public class AzureTestWatcher implements BeforeTestExecutionCallback, AfterTestExecutionCallback {\n+\n+    @Override\n+    public void beforeTestExecution(ExtensionContext extensionContext) {\n+        String displayName = extensionContext.getDisplayName();\n+        getStore(extensionContext).put(extensionContext.getRequiredTestMethod(), System.currentTimeMillis());\n+\n+        String testName = \"\";\n+        String fullyQualifiedTestName = \"\";\n+        if (extensionContext.getTestMethod().isPresent()) {\n+            Method method = extensionContext.getTestMethod().get();\n+            testName = method.getName();\n+            fullyQualifiedTestName = method.getDeclaringClass().getName() + \".\" + testName;\n+        }\n+\n+        if (!Objects.equals(displayName, testName)) {\n+            System.out.printf(\"Starting test %s (%s), \", fullyQualifiedTestName, displayName);\n+        } else {\n+            System.out.printf(\"Starting test %s, \", fullyQualifiedTestName);\n+        }\n+    }\n+\n+    @Override\n+    public void afterTestExecution(ExtensionContext context) {\n+        Method testMethod = context.getRequiredTestMethod();\n+        long start = getStore(context).remove(testMethod, long.class);\n+        long duration = System.currentTimeMillis() - start;\n+\n+        System.out.printf(\"completed in %d ms.%n\", duration);\n+    }\n+\n+    private ExtensionContext.Store getStore(ExtensionContext context) {", "originalCommit": "debbbcae970e8d845fa977848bed040ca3a8917e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMzE5NjY2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10313#discussion_r413196669", "bodyText": "Good point, will replace getClass() with AzureTestWatcher.class and make this method static.", "author": "alzimmermsft", "createdAt": "2020-04-22T17:56:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjIzNzMyNg=="}], "type": "inlineReview"}, {"oid": "d2607034572a75fc7579a39e778ca528439057a1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d2607034572a75fc7579a39e778ca528439057a1", "message": "Updated to use object bag to pass testing context", "committedDate": "2020-04-22T18:12:24Z", "type": "commit"}]}