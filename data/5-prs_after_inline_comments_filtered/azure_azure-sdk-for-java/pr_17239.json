{"pr_number": 17239, "pr_title": "Share enable protocol", "pr_createdAt": "2020-11-05T23:13:24Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17239", "timeline": [{"oid": "be1293a9c23b365c36adfde0b2d3d9c1295be9ef", "url": "https://github.com/Azure/azure-sdk-for-java/commit/be1293a9c23b365c36adfde0b2d3d9c1295be9ef", "message": "Added share enabled protocols and tests", "committedDate": "2020-11-05T22:09:02Z", "type": "commit"}, {"oid": "f2f275995de08b6ac5fce879f8641552f5afb108", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f2f275995de08b6ac5fce879f8641552f5afb108", "message": "Updated generated code with internal types", "committedDate": "2020-11-05T23:11:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzMTk3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r518431975", "bodyText": "should this be named ShareEnabledProtocols ? As far as I understand one can have multiple of them enabled when this \"enum\" expands.\nI'd rather use enum and EnumSet to model this. See https://github.com/Azure/azure-sdk-for-java/blob/4da5d307be3b618c7c989e76b13cf1e96e9dbb17/sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/NtfsFileAttributes.java for example.", "author": "kasobol-msft", "createdAt": "2020-11-05T23:26:56Z", "path": "sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareEnabledProtocol.java", "diffHunk": "@@ -0,0 +1,75 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.storage.file.share.models;\n+\n+import com.azure.storage.common.implementation.Constants;\n+\n+/**\n+ * Represents protocols that can be set on a share.\n+ */\n+public class ShareEnabledProtocol {", "originalCommit": "f2f275995de08b6ac5fce879f8641552f5afb108", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0MTk3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r518441978", "bodyText": "I can change the name\nI thought about EnumSet, but it seems like this this collection of booleans is more common in the sdk for representing what is a flags enum in .net, so I went with this. Might be a question for ApiView time?", "author": "rickle-msft", "createdAt": "2020-11-05T23:56:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzMTk3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ0MjMzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r518442334", "bodyText": "Let's see what @alzimmermsft thinks.", "author": "kasobol-msft", "createdAt": "2020-11-05T23:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzMTk3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQ3MjUxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r518472510", "bodyText": "In the future are there plans to support both SMB and NFS concurrently? Would additional protocols be added?\nIf only one protocol is expected using an enum value would help guide usage to non-error cases but if support will be expanded to multiple it may result in a poor API growth.", "author": "alzimmermsft", "createdAt": "2020-11-06T01:35:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzMTk3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODUwNzYzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r518507636", "bodyText": "Possible values in the future at REST API:\n\"SMB;NFS\"\n\"SMBv2;SMBv3;NFSv4\"\n\nsee original discussion Azure/azure-sdk-for-net#16123 (comment)\nSo looks like we stick to current design.", "author": "kasobol-msft", "createdAt": "2020-11-06T03:48:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODQzMTk3NQ=="}], "type": "inlineReview"}, {"oid": "80d9064ebfdc1d82df1021e0fd3b44378af79d41", "url": "https://github.com/Azure/azure-sdk-for-java/commit/80d9064ebfdc1d82df1021e0fd3b44378af79d41", "message": "PR feedback", "committedDate": "2020-11-05T23:57:48Z", "type": "commit"}, {"oid": "fac78cc1563e61c5c88c9842e181f330255aacec", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fac78cc1563e61c5c88c9842e181f330255aacec", "message": "Forgot to commit some new files", "committedDate": "2020-11-06T00:21:47Z", "type": "commit"}, {"oid": "6070ec2021b718cbcc4b21843161816307b97bd9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6070ec2021b718cbcc4b21843161816307b97bd9", "message": "Updated test", "committedDate": "2020-11-06T00:38:16Z", "type": "commit"}, {"oid": "c136c81acf0be6d54dbffeabba1367bbf1c670ee", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c136c81acf0be6d54dbffeabba1367bbf1c670ee", "message": "Fix analyze step", "committedDate": "2020-11-06T20:43:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAwMDE5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r519000192", "bodyText": "@rickle-msft FYI this discussion here is still developing Azure/azure-sdk-for-net#16123 (comment) . We might need to loosen this validation if it turns out that new protocols can be returned with old service version in the future.", "author": "kasobol-msft", "createdAt": "2020-11-06T20:54:43Z", "path": "sdk/storage/azure-storage-file-share/src/main/java/com/azure/storage/file/share/models/ShareEnabledProtocols.java", "diffHunk": "@@ -0,0 +1,88 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.storage.file.share.models;\n+\n+import com.azure.storage.common.implementation.Constants;\n+\n+/**\n+ * Represents protocols that can be set on a share.\n+ */\n+public class ShareEnabledProtocols {\n+\n+    private boolean smb;\n+\n+    private boolean nfs;\n+\n+    /**\n+     * @return Enable SMB\n+     */\n+    public boolean isSmb() {\n+        return smb;\n+    }\n+\n+    /**\n+     * @return Enable NFS\n+     */\n+    public boolean isNfs() {\n+        return nfs;\n+    }\n+\n+    /**\n+     * @param smb Enable SMB\n+     * @return The updated object\n+     */\n+    public ShareEnabledProtocols setSmb(boolean smb) {\n+        this.smb = smb;\n+        return this;\n+    }\n+\n+    /**\n+     * @param nfs Enable NFS\n+     * @return The updated object\n+     */\n+    public ShareEnabledProtocols setNfs(boolean nfs) {\n+        this.nfs = nfs;\n+        return this;\n+    }\n+\n+    /**\n+     * Converts the given protocols to a {@code String}.\n+     *\n+     * @return A {@code String} which represents the enabled protocols.\n+     * @throws IllegalArgumentException If both SMB and NFS are set.\n+     */\n+    public String toString() {\n+        if (this.smb) {\n+            if (this.nfs) {\n+                throw new IllegalArgumentException(\"SMB and NFS cannot both be set.\");\n+            }\n+            return Constants.HeaderConstants.SMB_PROTOCOL;\n+        }\n+        if (this.nfs) {\n+            return Constants.HeaderConstants.NFS_PROTOCOL;\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Parses a {@code String} into a {@code SharEnabledProtocol}.\n+     *\n+     * @param str The string to parse.\n+     * @return A {@code ShareEnabledProtocol} represented by the string.\n+     * @throws IllegalArgumentException If the String is not a recognized protocol.\n+     */\n+    public static ShareEnabledProtocols parse(String str) {\n+        if (str == null) {\n+            return null;\n+        }\n+\n+        if (str.equals(Constants.HeaderConstants.SMB_PROTOCOL)) {\n+            return new ShareEnabledProtocols().setSmb(true);\n+        } else if (str.equals(Constants.HeaderConstants.NFS_PROTOCOL)) {\n+            return new ShareEnabledProtocols().setNfs(true);\n+        }\n+\n+        throw new IllegalArgumentException(\"String is not an understood protocol: \" + str);", "originalCommit": "c136c81acf0be6d54dbffeabba1367bbf1c670ee", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAwNjc4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r519006785", "bodyText": "Maybe this should be ExpandableStringEnum like this thing \n  \n    \n      azure-sdk-for-java/sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/AccessTier.java\n    \n    \n         Line 14\n      in\n      7e6e164\n    \n    \n    \n    \n\n        \n          \n           public final class AccessTier extends ExpandableStringEnum<AccessTier> {", "author": "kasobol-msft", "createdAt": "2020-11-06T21:10:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAwMDE5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxMTg2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r519011864", "bodyText": "I don't think ExpandableStringEnum lets you set more than one?", "author": "rickle-msft", "createdAt": "2020-11-06T21:23:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAwMDE5Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAxOTEyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17239#discussion_r519019126", "bodyText": "That would bring us back to ExpandableStringEnum<ShareProtocol> and Set<ShareProtocol> (a variation of enumset). Question is if we want to expose future expansion to older SDK users or not.\nBtw. Let's not block on this here as we are yet to hear from the service team. we can address this later.", "author": "kasobol-msft", "createdAt": "2020-11-06T21:41:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTAwMDE5Mg=="}], "type": "inlineReview"}, {"oid": "6521efa9407fb3fb7226f6e9b599739bf3910041", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6521efa9407fb3fb7226f6e9b599739bf3910041", "message": "Checkstyle", "committedDate": "2020-11-06T21:34:06Z", "type": "commit"}, {"oid": "095613845e24c03bceae4674b308184d87be2e14", "url": "https://github.com/Azure/azure-sdk-for-java/commit/095613845e24c03bceae4674b308184d87be2e14", "message": "Checkstyle", "committedDate": "2020-11-06T21:52:25Z", "type": "commit"}]}