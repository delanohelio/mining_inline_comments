{"pr_number": 10354, "pr_title": "Live tests for Form Recognizer", "pr_createdAt": "2020-04-20T05:15:43Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10354", "timeline": [{"oid": "a3da90fb9769bfbb1beec970d5c52a9095b31d48", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a3da90fb9769bfbb1beec970d5c52a9095b31d48", "message": "test resource json", "committedDate": "2020-04-20T05:44:53Z", "type": "forcePushed"}, {"oid": "60f8de3cc53878ea4a0b245a06eb91d889fc79ce", "url": "https://github.com/Azure/azure-sdk-for-java/commit/60f8de3cc53878ea4a0b245a06eb91d889fc79ce", "message": "fix directory name", "committedDate": "2020-04-20T19:57:55Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY1MzQ3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r411653477", "bodyText": "PRIMARY_STORAGE_ACCOUNT_NAME should be something like PRIMARY_STORAGE_ACCOUNT_URL or this hardcoded URL (https://%s.blob.core.windows.net) will affect testing in other clouds.", "author": "danieljurek", "createdAt": "2020-04-20T20:01:22Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormTrainingClientTestBase.java", "diffHunk": "@@ -182,65 +272,41 @@ String getEndpoint() {\n             : Configuration.getGlobalConfiguration().get(\"AZURE_FORM_RECOGNIZER_ENDPOINT\");\n     }\n \n-    static void validateCustomModel(CustomFormModel expectedModel, CustomFormModel actualCustomModel) {\n-        assertNotNull(actualCustomModel.getModelId());\n-        assertEquals(expectedModel.getModelStatus(), actualCustomModel.getModelStatus());\n-        validateErrors(expectedModel.getModelError(), actualCustomModel.getModelError());\n-        assertNotNull(actualCustomModel.getCreatedOn());\n-        assertNotNull(actualCustomModel.getLastUpdatedOn());\n-        validateSubModels(expectedModel.getSubModels(), actualCustomModel.getSubModels());\n-        validateTrainingDocuments(expectedModel.getTrainingDocuments(), actualCustomModel.getTrainingDocuments());\n-    }\n-\n-    static void validateAccountProperties(AccountProperties expectedAccountProperties, AccountProperties actualAccountProperties) {\n-        assertEquals(expectedAccountProperties.getLimit(), actualAccountProperties.getLimit());\n-        assertNotNull(actualAccountProperties.getCount());\n-    }\n-\n-    private static void validateTrainingDocuments(List<TrainingDocumentInfo> expectedTrainingDocuments, List<TrainingDocumentInfo> actualTrainingDocuments) {\n-        List<TrainingDocumentInfo> actualTrainingList = actualTrainingDocuments.stream().collect(Collectors.toList());\n-        List<TrainingDocumentInfo> expectedTrainingList = expectedTrainingDocuments.stream().collect(Collectors.toList());\n-        assertEquals(expectedTrainingList.size(), actualTrainingList.size());\n-        for (int i = 0; i < actualTrainingList.size(); i++) {\n-            TrainingDocumentInfo expectedTrainingDocument = expectedTrainingList.get(i);\n-            TrainingDocumentInfo actualTrainingDocument = actualTrainingList.get(i);\n-            assertEquals(expectedTrainingDocument.getName(), actualTrainingDocument.getName());\n-            assertEquals(expectedTrainingDocument.getPageCount(), actualTrainingDocument.getPageCount());\n-            assertEquals(expectedTrainingDocument.getTrainingStatus(), actualTrainingDocument.getTrainingStatus());\n-            validateErrors(expectedTrainingDocument.getDocumentErrors(), actualTrainingDocument.getDocumentErrors());\n-        }\n-    }\n-\n-    private static void validateErrors(List<FormRecognizerError> expectedErrors, List<FormRecognizerError> actualErrors) {\n-        if (expectedErrors != null && actualErrors != null) {\n-            List<FormRecognizerError> actualErrorList = actualErrors.stream().collect(Collectors.toList());\n-            List<FormRecognizerError> expectedErrorList = expectedErrors.stream().collect(Collectors.toList());\n-            assertEquals(expectedErrorList.size(), actualErrorList.size());\n-            for (int i = 0; i < actualErrorList.size(); i++) {\n-                FormRecognizerError expectedError = expectedErrorList.get(i);\n-                FormRecognizerError actualError = actualErrorList.get(i);\n-                assertEquals(expectedError.getCode(), actualError.getCode());\n-                assertEquals(expectedError.getMessage(), actualError.getMessage());\n+    private String createStorageAndGenerateSas(String folderPath) {\n+        if (interceptorManager.isPlaybackMode()) {\n+            return \"https://isPlaybackmode\";\n+        } else {\n+            String accountName = Configuration.getGlobalConfiguration().get(\"PRIMARY_STORAGE_ACCOUNT_NAME\");\n+            String accountKey = Configuration.getGlobalConfiguration().get(\"PRIMARY_STORAGE_ACCOUNT_KEY\");\n+            StorageSharedKeyCredential credential = new StorageSharedKeyCredential(accountName, accountKey);\n+            String endpoint = String.format(Locale.ROOT, \"https://%s.blob.core.windows.net\", accountName);", "originalCommit": "a3da90fb9769bfbb1beec970d5c52a9095b31d48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTcxMjE2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r411712166", "bodyText": "#10380", "author": "samvaity", "createdAt": "2020-04-20T21:42:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTY1MzQ3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNjkzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r412526932", "bodyText": "these two seems valid model id and status model id?", "author": "mssfang", "createdAt": "2020-04-21T22:11:27Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/TestUtils.java", "diffHunk": "@@ -51,36 +51,35 @@\n  * Contains helper methods for generating inputs for test methods\n  */\n final class TestUtils {\n-\n-    static final String VALID_MODEL_ID = \"95537f1b-aac4-4da8-8292-f1b93ac4c8f8\";\n-    static final String LABELED_MODEL_ID = \"a0a3998a-b3c0-4075-aa6b-c4c4affe66b7\";\n     static final String INVALID_MODEL_ID = \"a0a3998a-4c4affe66b7\";\n     static final String INVALID_STATUS_MODEL_ID = \"22138c4e-c4b0-4901-a0e1-6c5beb73fc1d\";", "originalCommit": "4c2a8798a49e6dcf6cea4e57b67a44659d86b934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU0NDMzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r412544337", "bodyText": "static final String INVALID_MODEL_ID = \"a0a3998a-4c4affe66b7\";\n\n\nIt is not a valid UUID format for model Id.\n\nstatic final String INVALID_STATUS_MODEL_ID = \"22138c4e-c4b0-4901-a0e1-6c5beb73fc1d\";\n\n\nAnd this one has an invalid status.", "author": "samvaity", "createdAt": "2020-04-21T22:49:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNjkzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNzI0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r412527249", "bodyText": "valid labeled model id ?", "author": "mssfang", "createdAt": "2020-04-21T22:12:05Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/TestUtils.java", "diffHunk": "@@ -51,36 +51,35 @@\n  * Contains helper methods for generating inputs for test methods\n  */\n final class TestUtils {\n-\n-    static final String VALID_MODEL_ID = \"95537f1b-aac4-4da8-8292-f1b93ac4c8f8\";\n-    static final String LABELED_MODEL_ID = \"a0a3998a-b3c0-4075-aa6b-c4c4affe66b7\";\n     static final String INVALID_MODEL_ID = \"a0a3998a-4c4affe66b7\";\n     static final String INVALID_STATUS_MODEL_ID = \"22138c4e-c4b0-4901-a0e1-6c5beb73fc1d\";\n-    static final String INVALID_STATUS_MODEL_ERROR = \"Model Id \" + INVALID_STATUS_MODEL_ID + \" returned with invalid\"\n-        + \" status.\";\n-\n-    static final String INVALID_SOURCE_URL_ERROR = \"Download failed. Please check your input URL.\";\n-    // TODO (savaity): Do not hardcode, generate SAS URL\n-    static final String VALID_LABELED_DATA_SAS_URL = \"\";\n-    static final String VALID_UNLABELED_DATA_SAS_URL = \"\";\n-    static final Object INVALID_MODEL_ID_ERROR = \"Invalid UUID string: \" + INVALID_MODEL_ID;\n-    static final Object NULL_SOURCE_URL_ERROR = \"'fileSourceUrl' cannot be null.\";\n+    static final String INVALID_RECEIPT_URL = \"https://invalid.blob.core.windows.net/fr/contoso-allinone.jpg\";\n+    static final String INVALID_SOURCE_URL_ERROR = \"Status code 400, \\\"{\\\"error\\\":{\\\"code\\\":\\\"1003\\\",\"\n+        + \"\\\"message\\\":\\\"Parameter 'Source' is not a valid Uri.\\\"}}\\\"\";\n+    static final String INVALID_MODEL_ID_ERROR = \"Invalid UUID string: \" + INVALID_MODEL_ID;\n+    static final String NULL_SOURCE_URL_ERROR = \"'fileSourceUrl' cannot be null.\";\n     static final String INVALID_URL = \"htttttttps://localhost:8080\";\n+    static final String LABELED_MODEL_ID = \"a0a3998a-b3c0-4075-aa6b-c4c4affe66b7\";", "originalCommit": "4c2a8798a49e6dcf6cea4e57b67a44659d86b934", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNzkyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r412527924", "bodyText": "create/use a static final variable for the model id.", "author": "mssfang", "createdAt": "2020-04-21T22:13:37Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/TestUtils.java", "diffHunk": "@@ -172,7 +171,7 @@ static CustomFormModel getExpectedUnlabeledModel() {\n             }\n         };\n         CustomFormSubModel customFormSubModel = new CustomFormSubModel(null, fieldMap, \"form-0\");\n-        return new CustomFormModel(VALID_MODEL_ID, CustomFormModelStatus.READY,\n+        return new CustomFormModel(\"95537f1b-aac4-4da8-8292-f1b93ac4c8f8\", CustomFormModelStatus.READY,", "originalCommit": "4c2a8798a49e6dcf6cea4e57b67a44659d86b934", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjU0NDYyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10354#discussion_r412544621", "bodyText": "It isn't reused anywhere else so didn't bother putting it in a static variable.", "author": "samvaity", "createdAt": "2020-04-21T22:50:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMjUyNzkyNA=="}], "type": "inlineReview"}, {"oid": "d6ccb50671140ee79251e82fe5c0c1a03d2ac7f9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d6ccb50671140ee79251e82fe5c0c1a03d2ac7f9", "message": "test resource json", "committedDate": "2020-04-21T23:03:38Z", "type": "commit"}, {"oid": "d44ee79e912d04ca7a31e3b7a99de234b5f7d035", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d44ee79e912d04ca7a31e3b7a99de234b5f7d035", "message": "fix directory name", "committedDate": "2020-04-21T23:04:21Z", "type": "commit"}, {"oid": "2399783a5d915dca4dd3e95d1394c6747b46e97b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2399783a5d915dca4dd3e95d1394c6747b46e97b", "message": "update resources", "committedDate": "2020-04-21T23:05:06Z", "type": "commit"}, {"oid": "e5d63ae3329c7429336464debc82a872a6d95abd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e5d63ae3329c7429336464debc82a872a6d95abd", "message": "update failing tests", "committedDate": "2020-04-21T23:05:21Z", "type": "commit"}, {"oid": "c5089cd88b4dfee1f94420de02d3cf7a97d7f41e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5089cd88b4dfee1f94420de02d3cf7a97d7f41e", "message": "add more tests, changelog, sample-files", "committedDate": "2020-04-21T23:05:36Z", "type": "commit"}, {"oid": "930bad8f58d793827d2ebcbdba0efeaa46366a24", "url": "https://github.com/Azure/azure-sdk-for-java/commit/930bad8f58d793827d2ebcbdba0efeaa46366a24", "message": "rebase changes", "committedDate": "2020-04-22T00:23:21Z", "type": "forcePushed"}, {"oid": "a2d608054aa1c3dd1ff33765a887b74b1da0aa64", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a2d608054aa1c3dd1ff33765a887b74b1da0aa64", "message": "rebase changes", "committedDate": "2020-04-22T00:27:44Z", "type": "forcePushed"}, {"oid": "1f80e012b4aa04000c2396e5e169b1330f7353ab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f80e012b4aa04000c2396e5e169b1330f7353ab", "message": "rebase changes", "committedDate": "2020-04-22T00:46:32Z", "type": "commit"}, {"oid": "1f80e012b4aa04000c2396e5e169b1330f7353ab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f80e012b4aa04000c2396e5e169b1330f7353ab", "message": "rebase changes", "committedDate": "2020-04-22T00:46:32Z", "type": "forcePushed"}, {"oid": "4024f21aa311b01242d4ae311b8f974243acff89", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4024f21aa311b01242d4ae311b8f974243acff89", "message": "replayable test", "committedDate": "2020-04-22T02:55:55Z", "type": "commit"}, {"oid": "4024f21aa311b01242d4ae311b8f974243acff89", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4024f21aa311b01242d4ae311b8f974243acff89", "message": "replayable test", "committedDate": "2020-04-22T02:55:55Z", "type": "forcePushed"}]}