{"pr_number": 15430, "pr_title": "Update JSON Patch Functionality", "pr_createdAt": "2020-09-21T19:44:52Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15430", "timeline": [{"oid": "6999c96573165a54be5ee1dbf84c01a7b97aa6b9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6999c96573165a54be5ee1dbf84c01a7b97aa6b9", "message": "Release azure-core-experimental 1.0.0-beta.5", "committedDate": "2020-09-21T19:44:00Z", "type": "commit"}, {"oid": "081e9a8daa6743bc5ef61c3a5fd5e5cfca61431c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/081e9a8daa6743bc5ef61c3a5fd5e5cfca61431c", "message": "Merge branch 'master' into AzCore_ReleaseJsonPatchInExperimental", "committedDate": "2020-09-21T21:35:12Z", "type": "commit"}, {"oid": "34a49fcb7f6e57e1c035b01d66373c78f16ac1e9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/34a49fcb7f6e57e1c035b01d66373c78f16ac1e9", "message": "Changed value to Object instead of JSON string, added getter for JSON Patch operations contained in the document", "committedDate": "2020-09-21T22:58:43Z", "type": "commit"}, {"oid": "c4ac1199e7d8918b51ba3c71714e0199ab0ac3aa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4ac1199e7d8918b51ba3c71714e0199ab0ac3aa", "message": "Fix linting issues", "committedDate": "2020-09-21T23:25:24Z", "type": "commit"}, {"oid": "e7720bceff35444d8965b5e8f99458e651985d94", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e7720bceff35444d8965b5e8f99458e651985d94", "message": "Merge branch 'master' into AzCore_ReleaseJsonPatchInExperimental", "committedDate": "2020-09-22T21:53:14Z", "type": "commit"}, {"oid": "28a0e5daf61c8073b198d9830c9ebbfbddb3fc90", "url": "https://github.com/Azure/azure-sdk-for-java/commit/28a0e5daf61c8073b198d9830c9ebbfbddb3fc90", "message": "Update JsonPatchDocument to accept JsonSerializer during construction, added support for null in add, replace, and test operations", "committedDate": "2020-09-22T23:39:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwNTE1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15430#discussion_r493105152", "bodyText": "Can this return a List<JsonPatchOperation> instead?", "author": "srnagar", "createdAt": "2020-09-23T00:24:17Z", "path": "sdk/core/azure-core-experimental/src/main/java/com/azure/core/experimental/jsonpatch/JsonPatchDocument.java", "diffHunk": "@@ -22,15 +25,44 @@\n     private static final ObjectMapper MAPPER = ((JacksonAdapter) JacksonAdapter.createDefaultSerializerAdapter())\n         .serializer();\n \n+    private static final String ADD = \"add\";\n+    private static final String REMOVE = \"remove\";\n+    private static final String REPLACE = \"replace\";\n+    private static final String MOVE = \"move\";\n+    private static final String COPY = \"copy\";\n+    private static final String TEST = \"test\";\n+\n     private final ClientLogger logger = new ClientLogger(JsonPatchDocument.class);\n \n     private final List<JsonPatchOperation> operations;\n+    private final JsonSerializer serializer;\n \n     /**\n      * Creates a new JSON Patch document.\n      */\n     public JsonPatchDocument() {\n+        this(null);\n+    }\n+\n+    /**\n+     * Creates a new JSON Patch document.\n+     * <p>\n+     * If {@code serializer} isn't specified {@link JacksonAdapter} will be used.\n+     *\n+     * @param serializer The {@link JsonSerializer} that will be used to serialize patch operation values.\n+     */\n+    public JsonPatchDocument(JsonSerializer serializer) {\n         this.operations = new ArrayList<>();\n+        this.serializer = serializer;\n+    }\n+\n+    /**\n+     * Gets the JSON Patch operations in this document.\n+     *\n+     * @return The JSON Patch operations in this document.\n+     */\n+    public List<Object> getJsonPatchOperations() {", "originalCommit": "28a0e5daf61c8073b198d9830c9ebbfbddb3fc90", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Mzc1MzEwMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15430#discussion_r493753103", "bodyText": "Done", "author": "alzimmermsft", "createdAt": "2020-09-23T17:07:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzEwNTE1Mg=="}], "type": "inlineReview"}, {"oid": "0449880fddebecaea0a5b534b0e3bda02294a3bb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0449880fddebecaea0a5b534b0e3bda02294a3bb", "message": "Additional changes for JSON Patch support", "committedDate": "2020-09-23T17:06:00Z", "type": "commit"}, {"oid": "23857832273b82611154a7d300574ba8c0f5ad5a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/23857832273b82611154a7d300574ba8c0f5ad5a", "message": "Fix possible exception in toString and suppress Checkstyles for having external dependencies in public API", "committedDate": "2020-09-23T17:57:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgwMjczMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15430#discussion_r493802732", "bodyText": "I think switching the behavior of this parameter based on ctor parameter might be a little confusing.\nImagine you were replacing some trivial properties in the beginning but now wanting to pass a serialized object into another property. Passing the serializer into ctor would change the behavior of all existing code.", "author": "pakrym", "createdAt": "2020-09-23T18:30:26Z", "path": "sdk/core/azure-core-experimental/src/main/java/com/azure/core/experimental/jsonpatch/JsonPatchDocument.java", "diffHunk": "@@ -65,19 +87,17 @@ public JsonPatchDocument appendAdd(String path, String rawJsonValue) {\n      *\n      * <p><strong>Code Samples</strong></p>\n      *\n-     * {@codesnippet com.azure.core.experimental.jsonpatch.JsonPatchDocument.appendReplace#String-String}\n+     * {@codesnippet com.azure.core.experimental.jsonpatch.JsonPatchDocument.appendReplace#String-Object}\n      *\n      * @param path The path to replace.\n-     * @param rawJsonValue The raw JSON value to use as the replacement.\n+     * @param value The value to use as the replacement.\n      * @return The updated JsonPatchDocument object.\n-     * @throws NullPointerException If {@code path} or {@code rawJsonValue} is null.\n+     * @throws NullPointerException If {@code path} is null.\n      */\n-    public JsonPatchDocument appendReplace(String path, String rawJsonValue) {\n+    public JsonPatchDocument appendReplace(String path, Object value) {", "originalCommit": "23857832273b82611154a7d300574ba8c0f5ad5a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgyNDQ2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15430#discussion_r493824467", "bodyText": "Do we foresee it being a common scenario for multiple seriliazers to be used when interacting with a single JsonPatchDocument? With the pattern being the patch document is tied to a single serializer I would think that a different document would be used.\nAnother possible solution to this problem, given JsonPatchOperation is in public API is to add an appendOperation(JsonPatchOperation operation) API where the customer would set the optionalValue manually if they wanted to use multiple serializers for a single document.", "author": "alzimmermsft", "createdAt": "2020-09-23T18:57:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgwMjczMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgzMDI3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15430#discussion_r493830274", "bodyText": "I was confused as to what default behavior is.", "author": "pakrym", "createdAt": "2020-09-23T19:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzgwMjczMg=="}], "type": "inlineReview"}]}