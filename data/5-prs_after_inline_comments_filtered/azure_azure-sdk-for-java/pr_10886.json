{"pr_number": 10886, "pr_title": "Added paramterized tests for textanalytics and formrecognizer", "pr_createdAt": "2020-05-07T04:52:37Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10886", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI0NDk0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421244940", "bodyText": "just curious why call \"display name with arguments\" since there is no argument at the method input.", "author": "mssfang", "createdAt": "2020-05-07T05:18:24Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/TextAnalyticsClientBuilderTest.java", "diffHunk": "@@ -45,7 +47,8 @@\n     /**\n      * Test client builder with valid API key\n      */\n-    @Test\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)", "originalCommit": "7905b1ac2dd2f4481fca65ccb1dc98d64ca9a7b4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTYzNzEzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421637134", "bodyText": "I am supposed to have a draft here. The PR is in progress.", "author": "sima-zhu", "createdAt": "2020-05-07T16:30:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI0NDk0MA=="}], "type": "inlineReview"}, {"oid": "3956f754b1fe39ada321fd2dadb3aa1284a1f66b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3956f754b1fe39ada321fd2dadb3aa1284a1f66b", "message": "Added parameters", "committedDate": "2020-05-07T17:07:44Z", "type": "commit"}, {"oid": "3956f754b1fe39ada321fd2dadb3aa1284a1f66b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3956f754b1fe39ada321fd2dadb3aa1284a1f66b", "message": "Added parameters", "committedDate": "2020-05-07T17:07:44Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3Njk5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421676991", "bodyText": "The indentation is off here?", "author": "samvaity", "createdAt": "2020-05-07T17:36:52Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerClientTestBase.java", "diffHunk": "@@ -261,91 +261,75 @@ private static void validateReceiptItemsData(List<FieldValue> expectedReceiptIte\n     }\n \n     @Test\n-    abstract void recognizeReceiptSourceUrl();\n+    abstract void recognizeReceiptSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeReceiptSourceUrlTextDetails();\n+    abstract void recognizeReceiptSourceUrlTextDetails(HttpClient httpClient,\n+        FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeReceiptData();\n+    abstract void recognizeReceiptData(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeReceiptDataTextDetails();\n+    abstract void recognizeReceiptDataTextDetails(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeReceiptDataTextDetailsWithNullData();\n+    abstract void recognizeReceiptDataTextDetailsWithNullData(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeReceiptDataWithContentTypeAutoDetection();\n+    abstract void recognizeReceiptDataWithContentTypeAutoDetection(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeLayoutData();\n+    abstract void recognizeLayoutData(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeLayoutDataWithNullData();\n+    abstract void recognizeLayoutDataWithNullData(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeLayoutDataWithContentTypeAutoDetection();\n+    abstract void recognizeLayoutDataWithContentTypeAutoDetection(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeLayoutSourceUrl();\n+    abstract void recognizeLayoutSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeLayoutInvalidSourceUrl();\n+    abstract void recognizeLayoutInvalidSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeCustomFormLabeledData();\n+    abstract void recognizeCustomFormLabeledData(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeCustomFormUnlabeledData();\n+    abstract void recognizeCustomFormUnlabeledData(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeCustomFormLabeledDataWithNullValues();\n+    abstract void recognizeCustomFormLabeledDataWithNullValues(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeCustomFormLabeledDataWithContentTypeAutoDetection();\n+    abstract void recognizeCustomFormLabeledDataWithContentTypeAutoDetection(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n     @Test\n-    abstract void recognizeCustomFormInvalidSourceUrl();\n+    abstract void recognizeCustomFormInvalidSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion);\n \n-    void validateUSReceiptData(USReceipt actualRecognizedReceipt,\n-        boolean includeTextDetails) {\n+    void validateUSReceiptData(USReceipt actualRecognizedReceipt, boolean includeTextDetails) {\n         final AnalyzeResult analyzeResult = getAnalyzeRawResponse().getAnalyzeResult();\n         List<ReadResult> readResults = analyzeResult.getReadResults();\n         DocumentResult documentResult = analyzeResult.getDocumentResults().get(0);\n         final Map<String, FieldValue> expectedReceiptFields = documentResult.getFields();\n-        validatePageRangeData(documentResult.getPageRange().get(0),\n-            actualRecognizedReceipt.getRecognizedForm().getPageRange());\n-        validatePageRangeData(documentResult.getPageRange().get(1),\n-            actualRecognizedReceipt.getRecognizedForm().getPageRange());\n-        assertEquals(expectedReceiptFields.get(\"ReceiptType\").getValueString(),\n-            actualRecognizedReceipt.getReceiptType().getType());\n-        assertEquals(expectedReceiptFields.get(\"ReceiptType\").getConfidence(),\n-            actualRecognizedReceipt.getReceiptType().getConfidence());\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"MerchantName\"),\n-            actualRecognizedReceipt.getMerchantName(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"MerchantPhoneNumber\"),\n-            actualRecognizedReceipt.getMerchantPhoneNumber(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"MerchantAddress\"),\n-            actualRecognizedReceipt.getMerchantAddress(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"Total\"),\n-            actualRecognizedReceipt.getTotal(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"Subtotal\"),\n-            actualRecognizedReceipt.getSubtotal(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"Tax\"),\n-            actualRecognizedReceipt.getTax(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"TransactionDate\"),\n-            actualRecognizedReceipt.getTransactionDate(),\n-            readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"TransactionTime\"),\n-            actualRecognizedReceipt.getTransactionTime(),\n-            readResults, includeTextDetails);\n-        validateReceiptItemsData(expectedReceiptFields.get(\"Items\").getValueArray(),\n-            actualRecognizedReceipt.getReceiptItems(), readResults, includeTextDetails);\n-    }\n-\n-    void validateLayoutDataResults(IterableStream<FormPage> actualFormPages,\n-        boolean includeTextDetails) {\n+        validatePageRangeData(documentResult.getPageRange().get(0), actualRecognizedReceipt.getRecognizedForm().getPageRange());", "originalCommit": "3956f754b1fe39ada321fd2dadb3aa1284a1f66b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3OTIzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421679230", "bodyText": "Will double check the indentation.", "author": "sima-zhu", "createdAt": "2020-05-07T17:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3Njk5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NzMxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421677316", "bodyText": "does this mean we will create a new client every time before a test?", "author": "samvaity", "createdAt": "2020-05-07T17:37:24Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerClientTest.java", "diffHunk": "@@ -167,17 +198,21 @@ void recognizeLayoutSourceUrl() {\n     /**\n      * Verifies that an exception is thrown for invalid source url for recognizing content information.\n      */\n-    @Test\n-    void recognizeLayoutInvalidSourceUrl() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.ai.formrecognizer.TestUtils#getTestParameters\")\n+     public void recognizeLayoutInvalidSourceUrl(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion) {\n+        client = getFormRecognizerClient(httpClient, serviceVersion);", "originalCommit": "3956f754b1fe39ada321fd2dadb3aa1284a1f66b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3OTA0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421679042", "bodyText": "Yes, it is a cheap operation and parameterized tests can only set on method level instead of @beforeAll and @before", "author": "sima-zhu", "createdAt": "2020-05-07T17:40:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NzMxNg=="}], "type": "inlineReview"}, {"oid": "b0268845d5114f81db63af7289f5c8cb47653f7e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b0268845d5114f81db63af7289f5c8cb47653f7e", "message": "Reformat code", "committedDate": "2020-05-07T18:01:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTcwNDkzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r421704931", "bodyText": "Should we be good to delete clientSetup from FomRecognizerClientTestBase now .", "author": "samvaity", "createdAt": "2020-05-07T18:23:47Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClientTest.java", "diffHunk": "@@ -46,20 +53,27 @@ static void afterAll() {\n         StepVerifier.resetDefaultTimeout();\n     }\n \n-    @Override\n-    protected void beforeTest() {\n-        client = clientSetup(httpPipeline -> new FormRecognizerClientBuilder()", "originalCommit": "b0268845d5114f81db63af7289f5c8cb47653f7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f2805c93e6f56b7e267a82abf6174ac0308e71d9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f2805c93e6f56b7e267a82abf6174ac0308e71d9", "message": "Fixed all linting issues", "committedDate": "2020-05-08T08:20:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDMxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r422684319", "bodyText": "indentation revert?", "author": "samvaity", "createdAt": "2020-05-10T18:51:51Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerClientTestBase.java", "diffHunk": "@@ -328,24 +318,21 @@ void validateUSReceiptData(USReceipt actualRecognizedReceipt,\n             actualRecognizedReceipt.getMerchantPhoneNumber(), readResults, includeTextDetails);\n         validateFieldValueTransforms(expectedReceiptFields.get(\"MerchantAddress\"),\n             actualRecognizedReceipt.getMerchantAddress(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"Total\"),\n-            actualRecognizedReceipt.getTotal(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"Subtotal\"),\n-            actualRecognizedReceipt.getSubtotal(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"Tax\"),\n-            actualRecognizedReceipt.getTax(), readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"TransactionDate\"),\n-            actualRecognizedReceipt.getTransactionDate(),\n+        validateFieldValueTransforms(expectedReceiptFields.get(\"Total\"), actualRecognizedReceipt.getTotal(),\n             readResults, includeTextDetails);\n-        validateFieldValueTransforms(expectedReceiptFields.get(\"TransactionTime\"),\n-            actualRecognizedReceipt.getTransactionTime(),\n+        validateFieldValueTransforms(expectedReceiptFields.get(\"Subtotal\"), actualRecognizedReceipt.getSubtotal(),\n             readResults, includeTextDetails);\n+        validateFieldValueTransforms(expectedReceiptFields.get(\"Tax\"), actualRecognizedReceipt.getTax(), readResults,", "originalCommit": "f2805c93e6f56b7e267a82abf6174ac0308e71d9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjY4NDUxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10886#discussion_r422684513", "bodyText": "This test seems to be failing in live mode.\nhttps://dev.azure.com/azure-sdk/internal/_build/results?buildId=386425&view=ms.vss-test-web.build-test-results-tab&runId=10847082&resultId=100047&paneView=debug", "author": "samvaity", "createdAt": "2020-05-10T18:53:29Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerClientTest.java", "diffHunk": "@@ -104,8 +127,10 @@ void recognizeReceiptDataWithContentTypeAutoDetection() {\n      * Verifies receipt data for a document using source as as input stream data and text content when\n      * includeTextDetails is true.\n      */\n-    @Test\n-    void recognizeReceiptDataTextDetails() {\n+    @ParameterizedTest(name = DISPLAY_NAME_WITH_ARGUMENTS)\n+    @MethodSource(\"com.azure.ai.formrecognizer.TestUtils#getTestParameters\")\n+     public void recognizeReceiptDataTextDetails(HttpClient httpClient, FormRecognizerServiceVersion serviceVersion) {", "originalCommit": "f2805c93e6f56b7e267a82abf6174ac0308e71d9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8ad4129a14354b64b751baa255ee607c3eb28122", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8ad4129a14354b64b751baa255ee607c3eb28122", "message": "Merge from master", "committedDate": "2020-05-10T22:07:47Z", "type": "commit"}, {"oid": "b93b2a2092cc8b5a6fac8a8c3876d21691329280", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b93b2a2092cc8b5a6fac8a8c3876d21691329280", "message": "Fixed linting issue and failed tests", "committedDate": "2020-05-11T16:44:55Z", "type": "commit"}, {"oid": "d18dd042fd416d0d83b89f4d90922f20078e9d9b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d18dd042fd416d0d83b89f4d90922f20078e9d9b", "message": "Fixed playback", "committedDate": "2020-05-11T18:02:33Z", "type": "commit"}, {"oid": "0fd6e15aca246a348c669af050e4da4526c6a531", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0fd6e15aca246a348c669af050e4da4526c6a531", "message": "Comment out the failure tests", "committedDate": "2020-05-11T18:25:24Z", "type": "commit"}]}