{"pr_number": 13333, "pr_title": "TA add \"opinion mining\" new feature ", "pr_createdAt": "2020-07-20T16:46:34Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/13333", "timeline": [{"oid": "e81347f4eb733ffbc2bbf11c9ecd73438c1caf68", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e81347f4eb733ffbc2bbf11c9ecd73438c1caf68", "message": "regenerated base code and all tests passed now", "committedDate": "2020-07-15T01:13:41Z", "type": "commit"}, {"oid": "873cd82f898ed8004e3710a1e57aa530b45c89ad", "url": "https://github.com/Azure/azure-sdk-for-java/commit/873cd82f898ed8004e3710a1e57aa530b45c89ad", "message": "update record json files", "committedDate": "2020-07-15T04:16:24Z", "type": "commit"}, {"oid": "82553a3a2aef3a0fa83d5de10db411db7119fd6d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/82553a3a2aef3a0fa83d5de10db411db7119fd6d", "message": "added service API version 3.1-preview.1 and updates tests", "committedDate": "2020-07-15T15:31:30Z", "type": "commit"}, {"oid": "d8a8233e12444025792b0d4e455e54515783c7c7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d8a8233e12444025792b0d4e455e54515783c7c7", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into TA-3.1-preview1", "committedDate": "2020-07-15T15:57:36Z", "type": "commit"}, {"oid": "0362d1e600a01bd6fcde5535eaa98d6f1d0d0d7d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0362d1e600a01bd6fcde5535eaa98d6f1d0d0d7d", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into TA-OpinionMining", "committedDate": "2020-07-15T20:29:30Z", "type": "commit"}, {"oid": "3cca467fa27aefd30c11deebaefcfb5b66520f9a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3cca467fa27aefd30c11deebaefcfb5b66520f9a", "message": "opinion mining first version", "committedDate": "2020-07-20T16:43:38Z", "type": "commit"}, {"oid": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "message": "reorder sentenceSentiment object input parameters", "committedDate": "2020-07-20T16:56:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwNTg2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461905869", "bodyText": "To match SentimentConfidenceScorePerLabel should this be renamed to AspectConfidenceScorePerLabel?", "author": "samvaity", "createdAt": "2020-07-28T21:52:53Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -4,15 +4,23 @@\n package com.azure.ai.textanalytics;\n \n import com.azure.ai.textanalytics.implementation.TextAnalyticsClientImpl;\n+import com.azure.ai.textanalytics.implementation.models.AspectConfidenceScoreLabel;", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg2NzEyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r465867124", "bodyText": "implementation file.", "author": "mssfang", "createdAt": "2020-08-05T16:52:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwNTg2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwNjQ0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461906449", "bodyText": "@param isIncludeOpinionMining The boolean indicator to include opinion mining data in the returned result.", "author": "samvaity", "createdAt": "2020-07-28T21:53:36Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -67,15 +75,16 @@\n      * which contains {@link AnalyzeSentimentResultCollection}.\n      *\n      * @param documents The list of documents to analyze sentiments for.\n+     * @param isIncludeOpinionMining The boolean indicator to show the opinion mining.", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwNzY5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461907694", "bodyText": "should the boolean be named just includeOpinionMining. I think its the getter of this property that is to be named isOpinionMiningIncluded()", "author": "samvaity", "createdAt": "2020-07-28T21:55:07Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -86,16 +95,18 @@\n      * which contains {@link AnalyzeSentimentResultCollection}.\n      *\n      * @param documents The list of documents to analyze sentiments for.\n+     * @param isIncludeOpinionMining The boolean indicator to show the opinion mining.\n      * @param options The {@link TextAnalyticsRequestOptions} request options.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     Mono<Response<AnalyzeSentimentResultCollection>> analyzeSentimentBatchWithContext(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n+        Iterable<TextDocumentInput> documents, boolean isIncludeOpinionMining, TextAnalyticsRequestOptions options,", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwOTQ0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461909444", "bodyText": "Should we do this check before the method call?", "author": "samvaity", "createdAt": "2020-07-28T21:57:11Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +201,104 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n+     * @param isIncludeOpinionMining The boolean indicator to show the opinion mining.\n      * @param options The {@link TextAnalyticsRequestOptions} request options.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, boolean isIncludeOpinionMining, TextAnalyticsRequestOptions options,\n+        Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            isIncludeOpinionMining,\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<AspectSentiment> toAspectSentimentList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment) {\n+        if (sentenceSentiment.getAspects() == null) {", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTkxMDcyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r465910728", "bodyText": "sentenceSentiment could has no aspects at all when excluding opinion mining. So the return null for the null.", "author": "mssfang", "createdAt": "2020-08-05T18:08:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwOTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEzNzU1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470137555", "bodyText": "Yes, but so can we just do this before we do the method call", "author": "samvaity", "createdAt": "2020-08-13T17:49:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwOTQ0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTAxODU2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r471018564", "bodyText": "i think it is better to check inside of method call. We are checking sentenceSentiment's aspects, which called sentenceSentiment.getAspects(), is a method of SentenceSentiment. If there are multiple call to toAspectSentimentList(). we don't need to write sentenceSentiment.getAspect() one more time.", "author": "mssfang", "createdAt": "2020-08-15T17:53:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkwOTQ0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxMDMwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461910302", "bodyText": "Instead of the 0 can we put in a variable so we know what it stands for?", "author": "samvaity", "createdAt": "2020-07-28T21:58:18Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +201,104 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n+     * @param isIncludeOpinionMining The boolean indicator to show the opinion mining.\n      * @param options The {@link TextAnalyticsRequestOptions} request options.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, boolean isIncludeOpinionMining, TextAnalyticsRequestOptions options,\n+        Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            isIncludeOpinionMining,\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<AspectSentiment> toAspectSentimentList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment) {\n+        if (sentenceSentiment.getAspects() == null) {\n+            return null;\n+        }\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        final List<AspectSentiment> aspectSentiments = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String refLink = aspectRelation.getRef();\n+                final int refIndex = Integer.parseInt(refLink.substring(refLink.lastIndexOf(\"/\") + 1));\n+                // TODO: Future work to add AspectRelationType.ASPECT feature when service has the implementation.\n+                if (AspectRelationType.OPINION.equals(aspectRelationType)) {\n+                    opinionSentiments.add(toOpinionSentiment(sentenceSentiment.getOpinions().get(refIndex)));\n+                }\n+            });\n+\n+            aspectSentiments.add(new AspectSentiment(sentenceAspect.getText(),\n+                toTextSentiment(sentenceAspect.getSentiment()), new IterableStream<>(opinionSentiments),\n+                sentenceAspect.getOffset(), sentenceAspect.getLength(),\n+                toSentimentConfidenceScores(sentenceAspect.getConfidenceScores())));\n+        });\n+\n+        return new IterableStream<>(aspectSentiments);\n+    }\n+\n+    /*\n+     * Transform type AspectConfidenceScoreLabel to SentimentConfidenceScores.\n+     */\n+    private SentimentConfidenceScores toSentimentConfidenceScores(\n+        AspectConfidenceScoreLabel aspectConfidenceScoreLabel) {\n+        return new SentimentConfidenceScores(aspectConfidenceScoreLabel.getNegative(), 0,", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxMTYxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461911613", "bodyText": "Why can't we directly use fromString here?", "author": "samvaity", "createdAt": "2020-07-28T21:59:55Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +201,104 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n+     * @param isIncludeOpinionMining The boolean indicator to show the opinion mining.\n      * @param options The {@link TextAnalyticsRequestOptions} request options.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, boolean isIncludeOpinionMining, TextAnalyticsRequestOptions options,\n+        Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            isIncludeOpinionMining,\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<AspectSentiment> toAspectSentimentList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment) {\n+        if (sentenceSentiment.getAspects() == null) {\n+            return null;\n+        }\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        final List<AspectSentiment> aspectSentiments = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String refLink = aspectRelation.getRef();\n+                final int refIndex = Integer.parseInt(refLink.substring(refLink.lastIndexOf(\"/\") + 1));\n+                // TODO: Future work to add AspectRelationType.ASPECT feature when service has the implementation.\n+                if (AspectRelationType.OPINION.equals(aspectRelationType)) {\n+                    opinionSentiments.add(toOpinionSentiment(sentenceSentiment.getOpinions().get(refIndex)));\n+                }\n+            });\n+\n+            aspectSentiments.add(new AspectSentiment(sentenceAspect.getText(),\n+                toTextSentiment(sentenceAspect.getSentiment()), new IterableStream<>(opinionSentiments),\n+                sentenceAspect.getOffset(), sentenceAspect.getLength(),\n+                toSentimentConfidenceScores(sentenceAspect.getConfidenceScores())));\n+        });\n+\n+        return new IterableStream<>(aspectSentiments);\n+    }\n+\n+    /*\n+     * Transform type AspectConfidenceScoreLabel to SentimentConfidenceScores.\n+     */\n+    private SentimentConfidenceScores toSentimentConfidenceScores(\n+        AspectConfidenceScoreLabel aspectConfidenceScoreLabel) {\n+        return new SentimentConfidenceScores(aspectConfidenceScoreLabel.getNegative(), 0,\n+            aspectConfidenceScoreLabel.getPositive());\n+    }\n+\n+    /*\n+     * Transform type SentenceOpinion to OpinionSentiment.\n+     */\n+    private OpinionSentiment toOpinionSentiment(SentenceOpinion sentenceOpinion) {\n+        return new OpinionSentiment(sentenceOpinion.getText(), toTextSentiment(sentenceOpinion.getSentiment()),\n+            sentenceOpinion.getOffset(), sentenceOpinion.getLength(), sentenceOpinion.isNegated(),\n+            toSentimentConfidenceScores(sentenceOpinion.getConfidenceScores()));\n+    }\n+\n+    /*\n+     * Transform type SentenceOpinionSentiment to TextSentiment.\n+     */\n+    private TextSentiment toTextSentiment(SentenceOpinionSentiment sentenceOpinionSentiment) {\n+        if (SentenceOpinionSentiment.POSITIVE.equals(sentenceOpinionSentiment)) {", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTg3MDUyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r465870529", "bodyText": "That works. Thx", "author": "mssfang", "createdAt": "2020-08-05T16:58:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxMTYxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxMjgzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461912836", "bodyText": "Should we clarify more what opinion mining might mean?", "author": "samvaity", "createdAt": "2020-07-28T22:01:31Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClient.java", "diffHunk": "@@ -649,14 +649,41 @@ public String getDefaultLanguage() {\n      *\n      * @return A {@link Mono} contains the {@link DocumentSentiment analyzed document sentiment} of the document.\n      *\n-     * @throws NullPointerException if {@code document} is {@code null}.\n+     * @throws NullPointerException if {@code document} is null.\n      * @throws TextAnalyticsException if the response returned with an {@link TextAnalyticsError error}.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Mono<DocumentSentiment> analyzeSentiment(String document, String language) {\n+        return analyzeSentiment(document, false, language);\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If {@code isIncludeOpinionMining} set to true, the output\n+     * will include the opinion mining result.", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkxNDE3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461914175", "bodyText": "Isn't this Javadoc applicable to the Asycn client javadocs too?", "author": "samvaity", "createdAt": "2020-07-28T22:03:12Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsClient.java", "diffHunk": "@@ -587,14 +612,42 @@ public DocumentSentiment analyzeSentiment(String document, String language) {\n      *\n      * @return A {@link AnalyzeSentimentResultCollection}.\n      *\n-     * @throws NullPointerException if {@code documents} is {@code null}.\n+     * @throws NullPointerException if {@code documents} is null.\n      * @throws IllegalArgumentException if {@code documents} is empty.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public AnalyzeSentimentResultCollection analyzeSentimentBatch(\n         Iterable<String> documents, String language, TextAnalyticsRequestOptions options) {\n-        inputDocumentsValidation(documents);\n-        return client.analyzeSentimentBatch(documents, language, options).block();\n+        return client.analyzeSentimentBatch(documents, false, language, options).block();\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label\n+     * (Positive, Negative, and Neutral) for the document and each sentence within it.\n+     * If {@code isIncludeOpinionMining} set to true, the output will include the opinion mining result.\n+     *\n+     * <p><strong>Code Sample</strong></p>\n+     * <p>Analyze the sentiments in a list of documents with a provided language representation and request options.</p>\n+     * {@codesnippet com.azure.ai.textanalytics.TextAnalyticsClient.analyzeSentimentBatch#Iterable-boolean-String-TextAnalyticsRequestOptions}\n+     *\n+     * @param documents A list of documents to be analyzed.\n+     * For text length limits, maximum batch size, and supported text encoding, see\n+     * <a href=\"https://docs.microsoft.com/azure/cognitive-services/text-analytics/overview#data-limits\">data limits</a>.\n+     * @param isIncludeOpinionMining The boolean indicator to define if the request includes opinion mining.\n+     * @param language The 2 letter ISO 639-1 representation of language for the documents. If not set, uses \"en\" for\n+     * English as default.\n+     * @param options The {@link TextAnalyticsRequestOptions options} to configure the scoring model for documents\n+     * and show statistics.\n+     *\n+     * @return A {@link AnalyzeSentimentResultCollection}.\n+     *\n+     * @throws NullPointerException if {@code documents} is null.\n+     * @throws IllegalArgumentException if {@code documents} is empty.", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkyNTM5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461925391", "bodyText": "does the param name need to be plural, it kind of suggests its returning more than one value?", "author": "samvaity", "createdAt": "2020-07-28T22:18:23Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/OpinionSentiment.java", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link OpinionSentiment} model.\n+ */\n+@Immutable\n+public final class OpinionSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final boolean isNegated;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link OpinionSentiment} model that describes opinion sentiment.\n+     *\n+     * @param text The opinion text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE.\n+     * @param offset The offset of opinion text.\n+     * @param length The length of opinion text.\n+     * @param isNegated The boolean indicator to show if the opinion text negated or not.\n+     * @param confidenceScores The {@link SentimentConfidenceScores}.", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjAzODk0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r466038943", "bodyText": "Yup. It need to be plural, It keeps consistency as previous did in SentimentConfidenceScores and also consistency cross langauges.\nprivate final SentimentConfidenceScores confidenceScores;\n\nIn .NET api design: https://apiview.dev/Assemblies/Review/b196a5e53fa2441f92e3b1accefa35e7?diffRevisionId=b3605f7e99b744ba8175087b0c933fe2#Azure.AI.TextAnalytics.OpinionSentiment", "author": "mssfang", "createdAt": "2020-08-05T22:27:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkyNTM5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM1MTIxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473351210", "bodyText": "it does return more than one value as it is scores per sentiment label", "author": "maririos", "createdAt": "2020-08-19T21:42:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkyNTM5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTkyNjU3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r461926574", "bodyText": "I think these examples need to be more concise seeing they get injected into javadocs esp, it can make the javdocs pretty verbose.", "author": "samvaity", "createdAt": "2020-07-28T22:21:25Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/TextAnalyticsClientJavaDocCodeSnippets.java", "diffHunk": "@@ -490,6 +498,73 @@ public void analyzeSentimentWithLanguage() {\n         // END: com.azure.ai.textanalytics.TextAnalyticsClient.analyzeSentiment#String-String\n     }\n \n+    /**\n+     * Code snippet for {@link TextAnalyticsClient#analyzeSentiment(String, boolean, String)}\n+     */\n+    public void analyzeSentimentWithLanguageWithOpinionMining() {\n+        // BEGIN: com.azure.ai.textanalytics.TextAnalyticsClient.analyzeSentiment#String-boolean-String\n+        final DocumentSentiment documentSentiment = textAnalyticsClient.analyzeSentiment(", "originalCommit": "9fe2c35f335049f046ed63786ab8caba5b7fe7e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fedfae2933395a2f2fa418f17dbff8a16cd1f563", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fedfae2933395a2f2fa418f17dbff8a16cd1f563", "message": "resolved conflict", "committedDate": "2020-08-03T16:39:49Z", "type": "commit"}, {"oid": "9efab3fc55e4a4e9298d64f98f1363ea5e591025", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9efab3fc55e4a4e9298d64f98f1363ea5e591025", "message": "addressed feebacks", "committedDate": "2020-08-05T23:02:54Z", "type": "commit"}, {"oid": "d42ac1712153c94852a9dad4d98d406452ee7ef5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d42ac1712153c94852a9dad4d98d406452ee7ef5", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into TA-OpinionMining", "committedDate": "2020-08-06T14:08:37Z", "type": "commit"}, {"oid": "de3970a837d6f49c16076650c4274879d6e43f03", "url": "https://github.com/Azure/azure-sdk-for-java/commit/de3970a837d6f49c16076650c4274879d6e43f03", "message": "resolve conflict", "committedDate": "2020-08-11T05:40:05Z", "type": "commit"}, {"oid": "09abd7013938bb43aa43c8eb01ffac917ab8d389", "url": "https://github.com/Azure/azure-sdk-for-java/commit/09abd7013938bb43aa43c8eb01ffac917ab8d389", "message": "reorder the API's parameter input list", "committedDate": "2020-08-11T05:51:57Z", "type": "commit"}, {"oid": "fab703d1891767de604494cf79fea5f246cbbd3a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fab703d1891767de604494cf79fea5f246cbbd3a", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into TA-OpinionMining", "committedDate": "2020-08-12T02:50:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NDQ4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r469454488", "bodyText": "Should include that if this flag is specified, you'll get a minedOpinions property on SentenceSentiment", "author": "iscai-msft", "createdAt": "2020-08-12T18:22:38Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -86,16 +97,18 @@\n      * which contains {@link AnalyzeSentimentResultCollection}.\n      *\n      * @param documents The list of documents to analyze sentiments for.\n+     * @param includeOpinionMining The boolean indicator to include opinion mining data in the returned result.", "originalCommit": "09abd7013938bb43aa43c8eb01ffac917ab8d389", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NzgzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r469457839", "bodyText": "Should also include it's only available for v3.1-preview.1", "author": "iscai-msft", "createdAt": "2020-08-12T18:28:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NDQ4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTY3NTU2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r469675568", "bodyText": "thanks.", "author": "mssfang", "createdAt": "2020-08-13T03:30:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NDQ4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NjE4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r469456186", "bodyText": "nit: I think this might be a better description", "author": "iscai-msft", "createdAt": "2020-08-12T18:25:38Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/MinedOpinion.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.util.IterableStream;\n+\n+/**\n+ * The {@link MinedOpinion} model.\n+ */\n+public final class MinedOpinion {\n+    private final AspectSentiment aspect;\n+    private final IterableStream<OpinionSentiment> opinions;\n+\n+    /**\n+     * Create an {@link MinedOpinion} model that describes mined opinion.\n+     *\n+     * @param aspect The aspect of the mined opinion.", "originalCommit": "09abd7013938bb43aa43c8eb01ffac917ab8d389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NjY1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r469456653", "bodyText": "should include this is only returned if you pass the opinion mining parameter to the analyzeSentiment cal", "author": "iscai-msft", "createdAt": "2020-08-12T18:26:33Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/SentenceSentiment.java", "diffHunk": "@@ -14,25 +15,42 @@\n     private final String text;\n     private final SentimentConfidenceScores confidenceScores;\n     private final TextSentiment sentiment;\n+    private final IterableStream<MinedOpinion> minedOpinions;\n \n     /**\n      * Creates a {@link SentenceSentiment} model that describes the sentiment analysis of sentence.\n-     *\n-     * @param text The sentence text\n+     * @param text The sentence text.\n      * @param sentiment The sentiment label of the sentence.\n      * @param confidenceScores The sentiment confidence score (Softmax score) between 0 and 1, for each sentiment label.\n      *   Higher values signify higher confidence.\n      */\n     public SentenceSentiment(String text, TextSentiment sentiment, SentimentConfidenceScores confidenceScores) {\n         this.text = text;\n         this.sentiment = sentiment;\n+        this.minedOpinions = null;\n+        this.confidenceScores = confidenceScores;\n+    }\n+\n+    /**\n+     * Creates a {@link SentenceSentiment} model that describes the sentiment analysis of sentence.\n+     * @param text The sentence text.\n+     * @param sentiment The sentiment label of the sentence.\n+     * @param minedOpinions The mined opinions of the sentence sentiment.", "originalCommit": "09abd7013938bb43aa43c8eb01ffac917ab8d389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTQ1NzA3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r469457075", "bodyText": "nit: \"Is the aspect negated\"", "author": "iscai-msft", "createdAt": "2020-08-12T18:27:17Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/AnalyzeSentimentWithAspects.java", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics;\n+\n+import com.azure.ai.textanalytics.models.DocumentSentiment;\n+import com.azure.ai.textanalytics.models.MinedOpinion;\n+import com.azure.ai.textanalytics.models.OpinionSentiment;\n+import com.azure.ai.textanalytics.models.SentimentConfidenceScores;\n+import com.azure.ai.textanalytics.models.TextSentiment;\n+import com.azure.core.credential.AzureKeyCredential;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static com.azure.ai.textanalytics.models.TextSentiment.MIXED;\n+import static com.azure.ai.textanalytics.models.TextSentiment.NEGATIVE;\n+import static com.azure.ai.textanalytics.models.TextSentiment.POSITIVE;\n+\n+/**\n+ * Sample demonstrates how to synchronously analyze the sentiment of document with opinion mining.\n+ */\n+public class AnalyzeSentimentWithAspects {\n+    /**\n+     * Main method to invoke this demo about how to analyze the sentiment of document.\n+     *\n+     * @param args Unused arguments to the program.\n+     */\n+    public static void main(String[] args) {\n+        // Instantiate a client that will be used to call the service.\n+        TextAnalyticsClient client = new TextAnalyticsClientBuilder()\n+            .credential(new AzureKeyCredential(\"{key}\"))\n+            .endpoint(\"{endpoint}\")\n+            .buildClient();\n+\n+        // The text that needs be analyzed.\n+        String document = \"Bad atmosphere. Not close to plenty of restaurants, hotels, and transit! Staff are not friendly and helpful.\";\n+\n+        System.out.printf(\"Text = %s%n\", document);\n+\n+        final DocumentSentiment documentSentiment = client.analyzeSentiment(document, \"en\", true);\n+        SentimentConfidenceScores scores = documentSentiment.getConfidenceScores();\n+        System.out.printf(\n+            \"Recognized document sentiment: %s, positive score: %f, neutral score: %f, negative score: %f.%n\",\n+            documentSentiment.getSentiment(), scores.getPositive(), scores.getNeutral(), scores.getNegative());\n+\n+        List<MinedOpinion> positiveMinedOpinions = new ArrayList<>();\n+        List<MinedOpinion> mixedMinedOpinions = new ArrayList<>();\n+        List<MinedOpinion> negativeMinedOpinions = new ArrayList<>();\n+        documentSentiment.getSentences().forEach(sentenceSentiment -> {\n+            SentimentConfidenceScores sentenceScores = sentenceSentiment.getConfidenceScores();\n+            System.out.printf(\"\\tSentence sentiment: %s, positive score: %f, neutral score: %f, negative score: %f.%n\",\n+                sentenceSentiment.getSentiment(), sentenceScores.getPositive(), sentenceScores.getNeutral(), sentenceScores.getNegative());\n+            sentenceSentiment.getMinedOpinions().forEach(minedOpinion -> {\n+                TextSentiment aspectTextSentiment = minedOpinion.getAspect().getSentiment();\n+                if (NEGATIVE.equals(aspectTextSentiment)) {\n+                    negativeMinedOpinions.add(minedOpinion);\n+                } else if (POSITIVE.equals(aspectTextSentiment)) {\n+                    positiveMinedOpinions.add(minedOpinion);\n+                } else if (MIXED.equals(aspectTextSentiment)) {\n+                    mixedMinedOpinions.add(minedOpinion);\n+                }\n+            });\n+        });\n+\n+        System.out.printf(\"Positive aspects count: %d%n\", positiveMinedOpinions.size());\n+        for (MinedOpinion positiveMinedOpinion : positiveMinedOpinions) {\n+            System.out.printf(\"\\tAspect: %s%n\", positiveMinedOpinion.getAspect().getText());\n+            for (OpinionSentiment opinionSentiment : positiveMinedOpinion.getOpinions()) {\n+                System.out.printf(\"\\t\\t'%s' sentiment because of \\\"%s\\\". Does the aspect negated: %s.%n\",", "originalCommit": "09abd7013938bb43aa43c8eb01ffac917ab8d389", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "34716072b45d5ffb5c22a59bea18363e02e16877", "url": "https://github.com/Azure/azure-sdk-for-java/commit/34716072b45d5ffb5c22a59bea18363e02e16877", "message": "with latest design implementation", "committedDate": "2020-08-13T03:53:08Z", "type": "commit"}, {"oid": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ed68e89a1c9d900f05b593eb2c055f12c95febb4", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into TA-OpinionMining", "committedDate": "2020-08-13T03:53:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExOTM1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470119354", "bodyText": "This would be a breaking change, are we ok with that?", "author": "samvaity", "createdAt": "2020-08-13T17:28:02Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -67,15 +75,21 @@\n      * which contains {@link AnalyzeSentimentResultCollection}.\n      *\n      * @param documents The list of documents to analyze sentiments for.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n-     *\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n+     *\n+     * @throws NullPointerException if {@code documents} is null.\n+     * @throws IllegalArgumentException if {@code documents} is empty.\n      */\n     public Mono<Response<AnalyzeSentimentResultCollection>> analyzeSentimentBatch(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options) {\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options) {", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDIwMDA0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470200047", "bodyText": "we are not exploring this class. It is a internal used class.", "author": "mssfang", "createdAt": "2020-08-13T19:34:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExOTM1NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyMTE0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473621142", "bodyText": "sorry, I missed its an internal class!", "author": "samvaity", "createdAt": "2020-08-20T05:52:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExOTM1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEzODI3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470138270", "bodyText": "what happens if the the character \"/\" is not found?", "author": "samvaity", "createdAt": "2020-08-13T17:50:27Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +197,80 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n+     * @param includeOpinionMining The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.\n      * @param options The {@link TextAnalyticsRequestOptions} request options.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, boolean includeOpinionMining, TextAnalyticsRequestOptions options,\n+        Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            includeOpinionMining,\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinion> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        if (sentenceSentiment.getAspects() == null) {\n+            return null;\n+        }\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        final List<MinedOpinion> minedOpinions = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String refLink = aspectRelation.getRef();\n+                final int refIndex = Integer.parseInt(refLink.substring(refLink.lastIndexOf(\"/\") + 1));", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDc2NjM1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470766355", "bodyText": "will reconsider the conditional checking. For how to parse the reflink,  will need to be revisited.", "author": "mssfang", "createdAt": "2020-08-14T17:44:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEzODI3MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NTg5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472985893", "bodyText": "added the support to parse full reference pointer. See findSentimentOpinion()", "author": "mssfang", "createdAt": "2020-08-19T12:20:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDEzODI3MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MDAyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470140028", "bodyText": "Should this example show opinion mining aspect of analyzing sentiment?", "author": "samvaity", "createdAt": "2020-08-13T17:52:54Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClient.java", "diffHunk": "@@ -649,14 +652,46 @@ public String getDefaultLanguage() {\n      *\n      * @return A {@link Mono} contains the {@link DocumentSentiment analyzed document sentiment} of the document.\n      *\n-     * @throws NullPointerException if {@code document} is {@code null}.\n+     * @throws NullPointerException if {@code document} is null.\n      * @throws TextAnalyticsException if the response returned with an {@link TextAnalyticsError error}.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Mono<DocumentSentiment> analyzeSentiment(String document, String language) {\n+        return analyzeSentiment(document, language, null);\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).\n+     *\n+     * <p><strong>Code Sample</strong></p>\n+     * <p>Analyze the sentiments in a document with a provided language representation and\n+     * {@link AnalyzeSentimentOptions} options. Subscribes to the call asynchronously and prints out the", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NjIyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472986221", "bodyText": "Yup. Refactored the samples.", "author": "mssfang", "createdAt": "2020-08-19T12:21:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MDAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NTQwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470145406", "bodyText": "Does this exception not apply to the previous API's?", "author": "samvaity", "createdAt": "2020-08-13T18:00:56Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClient.java", "diffHunk": "@@ -727,11 +796,44 @@ public String getDefaultLanguage() {\n      *\n      * @return A {@link Mono} contains a {@link Response} that contains a {@link AnalyzeSentimentResultCollection}.\n      *\n-     * @throws NullPointerException if {@code documents} is {@code null}.\n+     * @throws NullPointerException if {@code documents} is null.\n+     * @throws IllegalArgumentException if {@code documents} is empty.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTE0MTI3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r471141274", "bodyText": "inputDocumentsValidation() throws both NullPointerException and IllegalArgumentException. So we should add this exception to here. I think we missed the exception previously. But it should be the correct way to do it.", "author": "mssfang", "createdAt": "2020-08-16T18:04:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NTQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjU2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470146564", "bodyText": "Need more description explaining the property. This descriptions here is for the private property and hence won't be accessible to th users. Consider moving that here.", "author": "samvaity", "createdAt": "2020-08-13T18:02:52Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AnalyzeSentimentOptions.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Fluent;\n+\n+/**\n+ * The {@link AnalyzeSentimentOptions} model.\n+ */\n+@Fluent\n+public final class AnalyzeSentimentOptions {\n+    private TextAnalyticsRequestOptions requestOptions;\n+\n+    /*\n+     * The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.\n+     */\n+    private boolean includeOpinionMining;\n+\n+    /**\n+     * Get the value of {@code requestOptions}.\n+     *\n+     * @return the value of {@code requestOptions}.\n+     */\n+    public TextAnalyticsRequestOptions getRequestOptions() {\n+        return requestOptions;\n+    }\n+\n+    /**\n+     * Set the value of {@code includeOpinionMining}.\n+     *\n+     * @param requestOptions It used to configure the scoring model for documents and show statistics.\n+     * @return the AnalyzeSentimentOptions object itself.\n+     */\n+    public AnalyzeSentimentOptions setRequestOptions(TextAnalyticsRequestOptions requestOptions) {\n+        this.requestOptions = requestOptions;\n+        return this;\n+    }\n+\n+    /**\n+     * Get the value of {@code includeOpinionMining}.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NjU2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472986563", "bodyText": "updated", "author": "mssfang", "createdAt": "2020-08-19T12:21:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjU2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjkxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470146918", "bodyText": "label?", "author": "samvaity", "createdAt": "2020-08-13T18:03:32Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AspectSentiment.java", "diffHunk": "@@ -0,0 +1,82 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link AspectSentiment} model.\n+ */\n+@Immutable\n+public final class AspectSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link AspectSentiment} model that describes aspect.\n+     *\n+     * @param text The aspect text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE.\n+     * @param offset The offset of aspect text.\n+     * @param length The length of aspect text.\n+     * @param confidenceScores The {@link SentimentConfidenceScores}.\n+     */\n+    public AspectSentiment(String text, TextSentiment sentiment,\n+        int offset, int length, SentimentConfidenceScores confidenceScores) {\n+        this.text = text;\n+        this.sentiment = sentiment;\n+        this.confidenceScores = confidenceScores;\n+        this.length = length;\n+        this.offset = offset;\n+    }\n+\n+    /**\n+     * Get the aspect text property.\n+     *\n+     * @return The text value.\n+     */\n+    public String getText() {\n+        return text;\n+    }\n+\n+    /**\n+     * Get the aspect text sentiment label: POSITIVE, NEGATIVE.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUxMDkwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472510906", "bodyText": "will delete label from all existing javadocs", "author": "mssfang", "createdAt": "2020-08-18T21:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjkxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUzNzA2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472537068", "bodyText": "hmm. https://docs.microsoft.com/en-us/azure/cognitive-services/text-analytics/how-tos/text-analytics-how-to-sentiment-analysis?tabs=version-3\nafter review the service doc. they are also using label. So i think we should keep it.", "author": "mssfang", "createdAt": "2020-08-18T22:53:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjkxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0ODAxNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470148015", "bodyText": "Should add more docs explaining what aspect and opionion is.", "author": "samvaity", "createdAt": "2020-08-13T18:05:35Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/MinedOpinion.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.util.IterableStream;\n+\n+/**\n+ * The {@link MinedOpinion} model.\n+ */\n+public final class MinedOpinion {\n+    private final AspectSentiment aspect;\n+    private final IterableStream<OpinionSentiment> opinions;\n+\n+    /**\n+     * Create an {@link MinedOpinion} model that describes mined opinion.\n+     *\n+     * @param aspect The aspect of a product/service that this opinion is about.\n+     * @param opinions The opinions of the aspect text.\n+     */\n+    public MinedOpinion(AspectSentiment aspect, IterableStream<OpinionSentiment> opinions) {\n+        this.aspect = aspect;\n+        this.opinions = opinions;\n+    }\n+\n+    /**\n+     * Get the opinions of aspect text.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4Njc1Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472986753", "bodyText": "updated", "author": "mssfang", "createdAt": "2020-08-19T12:22:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0ODAxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MTQyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470151420", "bodyText": "Are we only creating the opinion list to print out the size ?\nSeems like not adding a lot of value.\nThis example could be simplified I think.", "author": "samvaity", "createdAt": "2020-08-13T18:11:22Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/AnalyzeSentimentWithOpinionMining.java", "diffHunk": "@@ -0,0 +1,95 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics;\n+\n+import com.azure.ai.textanalytics.models.AnalyzeSentimentOptions;\n+import com.azure.ai.textanalytics.models.DocumentSentiment;\n+import com.azure.ai.textanalytics.models.MinedOpinion;\n+import com.azure.ai.textanalytics.models.OpinionSentiment;\n+import com.azure.ai.textanalytics.models.SentimentConfidenceScores;\n+import com.azure.ai.textanalytics.models.TextSentiment;\n+import com.azure.core.credential.AzureKeyCredential;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+\n+import static com.azure.ai.textanalytics.models.TextSentiment.MIXED;\n+import static com.azure.ai.textanalytics.models.TextSentiment.NEGATIVE;\n+import static com.azure.ai.textanalytics.models.TextSentiment.POSITIVE;\n+\n+/**\n+ * Sample demonstrates how to synchronously analyze the sentiment of document with opinion mining.\n+ */\n+public class AnalyzeSentimentWithOpinionMining {\n+    /**\n+     * Main method to invoke this demo about how to analyze the sentiment of document.\n+     *\n+     * @param args Unused arguments to the program.\n+     */\n+    public static void main(String[] args) {\n+        // Instantiate a client that will be used to call the service.\n+        TextAnalyticsClient client = new TextAnalyticsClientBuilder()\n+            .credential(new AzureKeyCredential(\"{key}\"))\n+            .endpoint(\"{endpoint}\")\n+            .buildClient();\n+\n+        // The text that needs be analyzed.\n+        String document = \"Bad atmosphere. Not close to plenty of restaurants, hotels, and transit! Staff are not friendly and helpful.\";\n+\n+        System.out.printf(\"Text = %s%n\", document);\n+\n+        AnalyzeSentimentOptions options = new AnalyzeSentimentOptions().setIncludeOpinionMining(true);\n+        final DocumentSentiment documentSentiment = client.analyzeSentiment(document, \"en\", options);\n+        SentimentConfidenceScores scores = documentSentiment.getConfidenceScores();\n+        System.out.printf(\n+            \"Recognized document sentiment: %s, positive score: %f, neutral score: %f, negative score: %f.%n\",\n+            documentSentiment.getSentiment(), scores.getPositive(), scores.getNeutral(), scores.getNegative());\n+\n+        List<MinedOpinion> positiveMinedOpinions = new ArrayList<>();\n+        List<MinedOpinion> mixedMinedOpinions = new ArrayList<>();\n+        List<MinedOpinion> negativeMinedOpinions = new ArrayList<>();\n+        documentSentiment.getSentences().forEach(sentenceSentiment -> {\n+            SentimentConfidenceScores sentenceScores = sentenceSentiment.getConfidenceScores();\n+            System.out.printf(\"\\tSentence sentiment: %s, positive score: %f, neutral score: %f, negative score: %f.%n\",\n+                sentenceSentiment.getSentiment(), sentenceScores.getPositive(), sentenceScores.getNeutral(), sentenceScores.getNegative());\n+            sentenceSentiment.getMinedOpinions().forEach(minedOpinion -> {\n+                TextSentiment aspectTextSentiment = minedOpinion.getAspect().getSentiment();\n+                if (NEGATIVE.equals(aspectTextSentiment)) {\n+                    negativeMinedOpinions.add(minedOpinion);\n+                } else if (POSITIVE.equals(aspectTextSentiment)) {\n+                    positiveMinedOpinions.add(minedOpinion);\n+                } else if (MIXED.equals(aspectTextSentiment)) {\n+                    mixedMinedOpinions.add(minedOpinion);\n+                }\n+            });\n+        });\n+\n+        System.out.printf(\"Positive aspects count: %d%n\", positiveMinedOpinions.size());", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1MDIyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472550222", "bodyText": "We are starting with printing out the size. The for loop, it loops all mined opinions.", "author": "mssfang", "createdAt": "2020-08-18T23:33:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MTQyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4NzY4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472987682", "bodyText": "ignore my last comment.  Changed the sample scenarios already.", "author": "mssfang", "createdAt": "2020-08-19T12:23:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MTQyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MjIwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470152207", "bodyText": "Don't think its a good idea to be making these lists, can't we directly add the content from L508-l513 here?\nApplicable for all examples below.", "author": "samvaity", "createdAt": "2020-08-13T18:12:41Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientJavaDocCodeSnippets.java", "diffHunk": "@@ -469,7 +478,42 @@ public void analyzeSentimentWithLanguage() {\n                         sentenceSentiment.getConfidenceScores().getNegative());\n                 }\n             });\n-        // END: com.azure.ai.textanalytics.TextAnalyticsAsyncClient.analyzeSentiment#string-string\n+        // END: com.azure.ai.textanalytics.TextAnalyticsAsyncClient.analyzeSentiment#String-String\n+    }\n+\n+    /**\n+     * Code snippet for {@link TextAnalyticsAsyncClient#analyzeSentiment(String, String, AnalyzeSentimentOptions)}\n+     */\n+    public void analyzeSentimentWithLanguageWithOpinionMining() {\n+        // BEGIN: com.azure.ai.textanalytics.TextAnalyticsAsyncClient.analyzeSentiment#String-String-AnalyzeSentimentOptions\n+        textAnalyticsAsyncClient.analyzeSentiment(\"The hotel was dark and unclean.\", \"en\",\n+            new AnalyzeSentimentOptions().setIncludeOpinionMining(true))\n+            .subscribe(documentSentiment -> {\n+                List<MinedOpinion> positiveMinedOpinions = new ArrayList<>();\n+                List<MinedOpinion> mixedMinedOpinions = new ArrayList<>();\n+                List<MinedOpinion> negativeMinedOpinions = new ArrayList<>();\n+                for (SentenceSentiment sentenceSentiment : documentSentiment.getSentences()) {\n+                    sentenceSentiment.getMinedOpinions().forEach(minedOpinion -> {\n+                        TextSentiment aspectTextSentiment = minedOpinion.getAspect().getSentiment();\n+                        if (NEGATIVE.equals(aspectTextSentiment)) {\n+                            negativeMinedOpinions.add(minedOpinion);\n+                        } else if (POSITIVE.equals(aspectTextSentiment)) {\n+                            positiveMinedOpinions.add(minedOpinion);\n+                        } else if (MIXED.equals(aspectTextSentiment)) {\n+                            mixedMinedOpinions.add(minedOpinion);", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk4Nzg1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472987851", "bodyText": "updated", "author": "mssfang", "createdAt": "2020-08-19T12:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MjIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MjM1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470152352", "bodyText": "unused?", "author": "samvaity", "createdAt": "2020-08-13T18:12:57Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientJavaDocCodeSnippets.java", "diffHunk": "@@ -469,7 +478,42 @@ public void analyzeSentimentWithLanguage() {\n                         sentenceSentiment.getConfidenceScores().getNegative());\n                 }\n             });\n-        // END: com.azure.ai.textanalytics.TextAnalyticsAsyncClient.analyzeSentiment#string-string\n+        // END: com.azure.ai.textanalytics.TextAnalyticsAsyncClient.analyzeSentiment#String-String\n+    }\n+\n+    /**\n+     * Code snippet for {@link TextAnalyticsAsyncClient#analyzeSentiment(String, String, AnalyzeSentimentOptions)}\n+     */\n+    public void analyzeSentimentWithLanguageWithOpinionMining() {\n+        // BEGIN: com.azure.ai.textanalytics.TextAnalyticsAsyncClient.analyzeSentiment#String-String-AnalyzeSentimentOptions\n+        textAnalyticsAsyncClient.analyzeSentiment(\"The hotel was dark and unclean.\", \"en\",\n+            new AnalyzeSentimentOptions().setIncludeOpinionMining(true))\n+            .subscribe(documentSentiment -> {\n+                List<MinedOpinion> positiveMinedOpinions = new ArrayList<>();\n+                List<MinedOpinion> mixedMinedOpinions = new ArrayList<>();", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1MDU4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472550583", "bodyText": "it should be neutral, not mixed. I will fix it.", "author": "mssfang", "createdAt": "2020-08-18T23:34:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MjM1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY3NzE0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472677144", "bodyText": "I am wrong. AspectSentiment and OpinionSentiment could have positive, negative, and mixed. So it should keep as it is.", "author": "mssfang", "createdAt": "2020-08-19T04:28:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MjM1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MjgxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470152811", "bodyText": "Not a good example to show.\nPlease use the options more efficiently or use other overload.\nApplicable for all examples below.", "author": "samvaity", "createdAt": "2020-08-13T18:13:53Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientJavaDocCodeSnippets.java", "diffHunk": "@@ -482,7 +526,7 @@ public void analyzeSentimentStringListWithOptions() {\n             \"The restaurant had amazing gnocchi.\"\n         );\n \n-        textAnalyticsAsyncClient.analyzeSentimentBatch(documents, \"en\", null).subscribe(\n+        textAnalyticsAsyncClient.analyzeSentimentBatch(documents, \"en\", (TextAnalyticsRequestOptions) null).subscribe(", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1NDY1Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470154657", "bodyText": "Consider providing an empty object", "author": "samvaity", "createdAt": "2020-08-13T18:17:08Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/DocumentInputAsyncTest.java", "diffHunk": "@@ -617,7 +617,7 @@ public void analyzeSentimentNullInputWithLanguageHint() {\n      */\n     @Test\n     public void analyzeSentimentBatchNullInput() {\n-        StepVerifier.create(client.analyzeSentimentBatch(null, null, null))\n+        StepVerifier.create(client.analyzeSentimentBatch(null, null, (TextAnalyticsRequestOptions) null))", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4MTMxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470081313", "bodyText": "Please consider having this in another PR for separation of concern.", "author": "deyaaeldeen", "createdAt": "2020-08-13T16:37:04Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -117,17 +135,6 @@\n             analyzeSentimentResults.add(convertToAnalyzeSentimentResult(documentSentiment));\n         }\n         for (DocumentError documentError : sentimentResponse.getErrors()) {\n-            /*\n-             *  TODO: Remove this after service update to throw exception.\n-             *  Currently, service sets max limit of document size to 5, if the input documents size > 5, it will\n-             *  have an id = \"\", empty id. In the future, they will remove this and throw HttpResponseException.\n-             */\n-            if (documentError.getId().isEmpty()) {\n-                throw logger.logExceptionAsError(\n-                    new HttpResponseException(documentError.getError().getInnererror().getMessage(),\n-                    getEmptyErrorIdHttpResponse(new SimpleResponse<>(response, response.getValue())),\n-                        documentError.getError().getInnererror().getCode()));\n-            }\n             analyzeSentimentResults.add(new AnalyzeSentimentResult(documentError.getId(), null,", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjgwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470086809", "bodyText": "One suggestion:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n          \n          \n            \n                 * v3.1-preview.1 service version.\n          \n          \n            \n                 * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It is provided by service\n          \n          \n            \n                 * v3.1-preview.1 and later.", "author": "deyaaeldeen", "createdAt": "2020-08-13T16:46:16Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +197,80 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n+     * @param includeOpinionMining The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjM0NjkzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472346938", "bodyText": "includeOpinionMining  no longer as an input param here. but will revisit it in all of other places", "author": "mssfang", "createdAt": "2020-08-18T17:02:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDA4NjgwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExODQzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470118437", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            final int refIndex = Integer.parseInt(refLink.substring(refLink.lastIndexOf(\"/\") + 1));\n          \n          \n            \n                            if (AspectRelationType.OPINION.equals(aspectRelationType)) {\n          \n          \n            \n                                opinionSentiments.add(toOpinionSentiment(sentenceSentiment.getOpinions().get(refIndex)));\n          \n          \n            \n                            final int opinionIndex = Integer.parseInt(refLink.substring(refLink.lastIndexOf(\"/\") + 1));\n          \n          \n            \n                            if (AspectRelationType.OPINION.equals(aspectRelationType)) {\n          \n          \n            \n                                opinionSentiments.add(toOpinionSentiment(sentenceSentiment.getOpinions().get(opinionIndex)));", "author": "deyaaeldeen", "createdAt": "2020-08-13T17:27:01Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +197,80 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n+     * @param includeOpinionMining The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.\n      * @param options The {@link TextAnalyticsRequestOptions} request options.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, boolean includeOpinionMining, TextAnalyticsRequestOptions options,\n+        Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            includeOpinionMining,\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinion> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        if (sentenceSentiment.getAspects() == null) {\n+            return null;\n+        }\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        final List<MinedOpinion> minedOpinions = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String refLink = aspectRelation.getRef();\n+                final int refIndex = Integer.parseInt(refLink.substring(refLink.lastIndexOf(\"/\") + 1));\n+                if (AspectRelationType.OPINION.equals(aspectRelationType)) {\n+                    opinionSentiments.add(toOpinionSentiment(sentenceSentiment.getOpinions().get(refIndex)));", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MTc0MzUzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r471743537", "bodyText": "I also think you need to parse the full pointer and use it to access the opinion properly based on our discussion with Assaf in the arch board meeting.", "author": "deyaaeldeen", "createdAt": "2020-08-17T20:01:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDExODQzNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MjEwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470142102", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n          \n          \n            \n                 * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n          \n          \n            \n                 * (also known as aspect-based sentiment analysis).\n          \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining results. It mines the\n          \n          \n            \n                 * opinions of a sentence and conducts more granular analysis around aspects in the text (also known as\n          \n          \n            \n                 * aspect-based sentiment analysis).", "author": "deyaaeldeen", "createdAt": "2020-08-13T17:55:53Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClient.java", "diffHunk": "@@ -649,14 +652,46 @@ public String getDefaultLanguage() {\n      *\n      * @return A {@link Mono} contains the {@link DocumentSentiment analyzed document sentiment} of the document.\n      *\n-     * @throws NullPointerException if {@code document} is {@code null}.\n+     * @throws NullPointerException if {@code document} is null.\n      * @throws TextAnalyticsException if the response returned with an {@link TextAnalyticsError error}.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Mono<DocumentSentiment> analyzeSentiment(String document, String language) {\n+        return analyzeSentiment(document, language, null);\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0MzkxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470143913", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n          \n          \n            \n                 * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n          \n          \n            \n                 * (also known as aspect-based sentiment analysis).\n          \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining results. It mines the\n          \n          \n            \n                 * opinions of a sentence and conducts more granular analysis around aspects in the text (also known as\n          \n          \n            \n                 * aspect-based sentiment analysis).", "author": "deyaaeldeen", "createdAt": "2020-08-13T17:58:35Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClient.java", "diffHunk": "@@ -693,11 +728,45 @@ public String getDefaultLanguage() {\n      *\n      * @return A {@link Mono} contains a {@link AnalyzeSentimentResultCollection}.\n      *\n-     * @throws NullPointerException if {@code documents} is {@code null}.\n+     * @throws NullPointerException if {@code documents} is null.\n+     * @throws IllegalArgumentException if {@code documents} is empty.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Mono<AnalyzeSentimentResultCollection> analyzeSentimentBatch(\n         Iterable<String> documents, String language, TextAnalyticsRequestOptions options) {\n+        return analyzeSentimentBatch(documents, language, new AnalyzeSentimentOptions().setRequestOptions(options));\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NDEzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470144134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n          \n          \n            \n                 * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n          \n          \n            \n                 * (also known as aspect-based sentiment analysis).\n          \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining results. It mines the\n          \n          \n            \n                 * opinions of a sentence and conducts more granular analysis around aspects in the text (also known as\n          \n          \n            \n                 * aspect-based sentiment analysis).", "author": "deyaaeldeen", "createdAt": "2020-08-13T17:58:57Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClient.java", "diffHunk": "@@ -727,11 +796,44 @@ public String getDefaultLanguage() {\n      *\n      * @return A {@link Mono} contains a {@link Response} that contains a {@link AnalyzeSentimentResultCollection}.\n      *\n-     * @throws NullPointerException if {@code documents} is {@code null}.\n+     * @throws NullPointerException if {@code documents} is null.\n+     * @throws IllegalArgumentException if {@code documents} is empty.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Mono<Response<AnalyzeSentimentResultCollection>> analyzeSentimentBatchWithResponse(\n         Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options) {\n+        return analyzeSentimentAsyncClient.analyzeSentimentBatch(documents,\n+            new AnalyzeSentimentOptions().setRequestOptions(options));\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NDgyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470144825", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n          \n          \n            \n                 * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n          \n          \n            \n                 * (also known as aspect-based sentiment analysis).\n          \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining results. It mines the\n          \n          \n            \n                 * opinions of a sentence and conducts more granular analysis around aspects in the text (also known as\n          \n          \n            \n                 * aspect-based sentiment analysis).", "author": "deyaaeldeen", "createdAt": "2020-08-13T17:59:57Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsClient.java", "diffHunk": "@@ -560,15 +563,45 @@ public DocumentSentiment analyzeSentiment(String document) {\n      *\n      * @return A {@link DocumentSentiment analyzed document sentiment} of the document.\n      *\n-     * @throws NullPointerException if {@code document} is {@code null}.\n+     * @throws NullPointerException if {@code document} is null.\n      * @throws TextAnalyticsException if the response returned with an {@link TextAnalyticsError error}.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public DocumentSentiment analyzeSentiment(String document, String language) {\n-        Objects.requireNonNull(document, \"'document' cannot be null.\");\n         return client.analyzeSentiment(document, language).block();\n     }\n \n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NTAwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470145007", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n          \n          \n            \n                 * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n          \n          \n            \n                 * (also known as aspect-based sentiment analysis).\n          \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining results. It mines the\n          \n          \n            \n                 * opinions of a sentence and conducts more granular analysis around aspects in the text (also known as\n          \n          \n            \n                 * aspect-based sentiment analysis).", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:00:13Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsClient.java", "diffHunk": "@@ -587,13 +620,45 @@ public DocumentSentiment analyzeSentiment(String document, String language) {\n      *\n      * @return A {@link AnalyzeSentimentResultCollection}.\n      *\n-     * @throws NullPointerException if {@code documents} is {@code null}.\n+     * @throws NullPointerException if {@code documents} is null.\n      * @throws IllegalArgumentException if {@code documents} is empty.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public AnalyzeSentimentResultCollection analyzeSentimentBatch(\n         Iterable<String> documents, String language, TextAnalyticsRequestOptions options) {\n-        inputDocumentsValidation(documents);\n+        return client.analyzeSentimentBatch(documents, language,\n+            new AnalyzeSentimentOptions().setRequestOptions(options)).block();\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NTI4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470145283", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n          \n          \n            \n                 * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n          \n          \n            \n                 * (also known as aspect-based sentiment analysis).\n          \n          \n            \n                 * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n          \n          \n            \n                 * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n          \n          \n            \n                 * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining results. It mines the\n          \n          \n            \n                 * opinions of a sentence and conducts more granular analysis around aspects in the text (also known as\n          \n          \n            \n                 * aspect-based sentiment analysis).", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:00:42Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/TextAnalyticsClient.java", "diffHunk": "@@ -615,13 +680,44 @@ public AnalyzeSentimentResultCollection analyzeSentimentBatch(\n      *\n      * @return A {@link Response} that contains a {@link AnalyzeSentimentResultCollection}.\n      *\n-     * @throws NullPointerException if {@code documents} is {@code null}.\n+     * @throws NullPointerException if {@code documents} is null.\n      * @throws IllegalArgumentException if {@code documents} is empty.\n      */\n     @ServiceMethod(returns = ReturnType.SINGLE)\n     public Response<AnalyzeSentimentResultCollection> analyzeSentimentBatchWithResponse(\n         Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        inputDocumentsValidation(documents);\n+        return client.analyzeSentimentAsyncClient.analyzeSentimentBatchWithContext(documents,\n+            new AnalyzeSentimentOptions().setRequestOptions(options), context).block();\n+    }\n+\n+    /**\n+     * Returns a sentiment prediction, as well as confidence scores for each sentiment label (Positive, Negative, and\n+     * Neutral) for the document and each sentence within it. If the {@code includeOpinionMining} of\n+     * {@link AnalyzeSentimentOptions} set to true, the output will include the opinion mining result. It mined the\n+     * opinions of a sentence and conduct more granular analysis around the aspects of a product or service\n+     * (also known as aspect-based sentiment analysis).", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjEzNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470146134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n          \n          \n            \n                 * v3.1-preview.1 service version.\n          \n          \n            \n                 * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It is provided by service\n          \n          \n            \n                 * v3.1-preview.1 and later.", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:02:09Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AnalyzeSentimentOptions.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Fluent;\n+\n+/**\n+ * The {@link AnalyzeSentimentOptions} model.\n+ */\n+@Fluent\n+public final class AnalyzeSentimentOptions {\n+    private TextAnalyticsRequestOptions requestOptions;\n+\n+    /*\n+     * The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE0NjI4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470146281", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n          \n          \n            \n                 * v3.1-preview.1 service version.\n          \n          \n            \n                 * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It is provided by service\n          \n          \n            \n                 * v3.1-preview.1 and later.", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:02:20Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AnalyzeSentimentOptions.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Fluent;\n+\n+/**\n+ * The {@link AnalyzeSentimentOptions} model.\n+ */\n+@Fluent\n+public final class AnalyzeSentimentOptions {\n+    private TextAnalyticsRequestOptions requestOptions;\n+\n+    /*\n+     * The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.\n+     */\n+    private boolean includeOpinionMining;\n+\n+    /**\n+     * Get the value of {@code requestOptions}.\n+     *\n+     * @return the value of {@code requestOptions}.\n+     */\n+    public TextAnalyticsRequestOptions getRequestOptions() {\n+        return requestOptions;\n+    }\n+\n+    /**\n+     * Set the value of {@code includeOpinionMining}.\n+     *\n+     * @param requestOptions It used to configure the scoring model for documents and show statistics.\n+     * @return the AnalyzeSentimentOptions object itself.\n+     */\n+    public AnalyzeSentimentOptions setRequestOptions(TextAnalyticsRequestOptions requestOptions) {\n+        this.requestOptions = requestOptions;\n+        return this;\n+    }\n+\n+    /**\n+     * Get the value of {@code includeOpinionMining}.\n+     *\n+     * @return the value of {@code includeOpinionMining}.\n+     */\n+    public boolean isIncludeOpinionMining() {\n+        return includeOpinionMining;\n+    }\n+\n+    /**\n+     * Set the value of {@code includeOpinionMining}.\n+     *\n+     * @param includeOpinionMining The boolean indicator to include opinion mining data in the returned result. If this\n+     * flag is specified, you'll get a {@code minedOpinions} property on SentenceSentiment. It's available start from\n+     * v3.1-preview.1 service version.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MzU0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470153549", "bodyText": "There are more labels in the type than listed here. I know the service returns only those for now, but not sure this is addressed clearly in the documentation and could be a point of confusion for the user.", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:15:05Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AspectSentiment.java", "diffHunk": "@@ -0,0 +1,82 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link AspectSentiment} model.\n+ */\n+@Immutable\n+public final class AspectSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link AspectSentiment} model that describes aspect.\n+     *\n+     * @param text The aspect text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1Nzk5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470157994", "bodyText": "Furthermore, dot net uses a different type which also has a neutral option in it. cc @iscai-msft @maririos", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:23:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MzU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjUwOTI4MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472509280", "bodyText": "will add the javadoc to better explain the sentiment label for the aspect", "author": "mssfang", "createdAt": "2020-08-18T21:41:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MzU0OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU2NzExNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472567115", "bodyText": "@deyaaeldeen refer to https://github.com/Azure/azure-rest-api-specs/blob/master/specification/cognitiveservices/data-plane/TextAnalytics/preview/v3.1-preview.1/TextAnalytics.json#L849\nthe sentiment label could be mixed but not neutral.", "author": "mssfang", "createdAt": "2020-08-19T00:32:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1MzU0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1OTM2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470159366", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Get the confidence score of the sentiment label. All score values sum up to 1, higher the score value means\n          \n          \n            \n                 * higher confidence the sentiment label represents.\n          \n          \n            \n                 * Get the confidence score of the sentiment label. All score values sum up to 1, the higher the score,\n          \n          \n            \n                 * the higher the confidence in the sentiment.", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:26:09Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AspectSentiment.java", "diffHunk": "@@ -0,0 +1,82 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link AspectSentiment} model.\n+ */\n+@Immutable\n+public final class AspectSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link AspectSentiment} model that describes aspect.\n+     *\n+     * @param text The aspect text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE.\n+     * @param offset The offset of aspect text.\n+     * @param length The length of aspect text.\n+     * @param confidenceScores The {@link SentimentConfidenceScores}.\n+     */\n+    public AspectSentiment(String text, TextSentiment sentiment,\n+        int offset, int length, SentimentConfidenceScores confidenceScores) {\n+        this.text = text;\n+        this.sentiment = sentiment;\n+        this.confidenceScores = confidenceScores;\n+        this.length = length;\n+        this.offset = offset;\n+    }\n+\n+    /**\n+     * Get the aspect text property.\n+     *\n+     * @return The text value.\n+     */\n+    public String getText() {\n+        return text;\n+    }\n+\n+    /**\n+     * Get the aspect text sentiment label: POSITIVE, NEGATIVE.\n+     * @return The sentiment value.\n+     */\n+    public TextSentiment getSentiment() {\n+        return sentiment;\n+    }\n+\n+\n+    /**\n+     * Get the offset of aspect text.\n+     *\n+     * @return The offset of aspect text.\n+     */\n+    public int getOffset() {\n+        return offset;\n+    }\n+\n+    /**\n+     * Get the length of aspect text.\n+     *\n+     * @return The length of aspect text.\n+     */\n+    public int getLength() {\n+        return length;\n+    }\n+\n+    /**\n+     * Get the confidence score of the sentiment label. All score values sum up to 1, higher the score value means\n+     * higher confidence the sentiment label represents.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE1OTc2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470159760", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * Create an {@link MinedOpinion} model that describes mined opinion.\n          \n          \n            \n                 * Create an {@link MinedOpinion} model that describes a mined opinion.", "author": "deyaaeldeen", "createdAt": "2020-08-13T18:26:53Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/MinedOpinion.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.util.IterableStream;\n+\n+/**\n+ * The {@link MinedOpinion} model.\n+ */\n+public final class MinedOpinion {\n+    private final AspectSentiment aspect;\n+    private final IterableStream<OpinionSentiment> opinions;\n+\n+    /**\n+     * Create an {@link MinedOpinion} model that describes mined opinion.", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5MDEwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r470190101", "bodyText": "same comment about neutral.", "author": "deyaaeldeen", "createdAt": "2020-08-13T19:17:39Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/OpinionSentiment.java", "diffHunk": "@@ -0,0 +1,93 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link OpinionSentiment} model.\n+ */\n+@Immutable\n+public final class OpinionSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;", "originalCommit": "ed68e89a1c9d900f05b593eb2c055f12c95febb4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjY3NjEyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r472676125", "bodyText": "the same solution to it", "author": "mssfang", "createdAt": "2020-08-19T04:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDE5MDEwMQ=="}], "type": "inlineReview"}, {"oid": "7ea1826951e249af2cbf9cc15d3afc1433c501a5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ea1826951e249af2cbf9cc15d3afc1433c501a5", "message": "address feedback 2", "committedDate": "2020-08-19T13:01:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMDA5NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473210095", "bodyText": "this should be fixes by now, no? are u planning on updating our code to delete this condition in a future PR?", "author": "maririos", "createdAt": "2020-08-19T17:39:18Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -131,10 +128,22 @@\n         Response<SentimentResponse> response) {\n         final SentimentResponse sentimentResponse = response.getValue();\n         final List<AnalyzeSentimentResult> analyzeSentimentResults = new ArrayList<>();\n-        for (DocumentSentiment documentSentiment : sentimentResponse.getDocuments()) {\n-            analyzeSentimentResults.add(convertToAnalyzeSentimentResult(documentSentiment));\n+        final List<DocumentSentiment> documentSentiments = sentimentResponse.getDocuments();\n+        for (DocumentSentiment documentSentiment : documentSentiments) {\n+            analyzeSentimentResults.add(convertToAnalyzeSentimentResult(documentSentiment, documentSentiments));\n         }\n         for (DocumentError documentError : sentimentResponse.getErrors()) {\n+            /*\n+             *  TODO: Remove this after service update to throw exception.", "originalCommit": "7ea1826951e249af2cbf9cc15d3afc1433c501a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4MjIwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473582204", "bodyText": "this will be take care in another PR. I will remove them one time at all.", "author": "mssfang", "createdAt": "2020-08-20T04:32:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMDA5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU5MjkyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473592928", "bodyText": "#10962", "author": "mssfang", "createdAt": "2020-08-20T05:06:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMDA5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMTg0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473211847", "bodyText": "is this a common pattern in Java?\nAt least in .NET, we always return an empty list instead of null (applies to other libraries too)", "author": "maririos", "createdAt": "2020-08-19T17:42:18Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -224,32 +232,32 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n     /*\n      * Transform SentenceSentiment's opinion mining to output that user can use.\n      */\n-    private IterableStream<MinedOpinion> toMinedOpinionList(\n-        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment) {\n+    private IterableStream<MinedOpinions> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment,\n+        List<DocumentSentiment> documentSentimentList) {\n         // If include opinion mining indicator is false, the service return null for the aspect list.\n-        if (sentenceSentiment.getAspects() == null) {\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        if (sentenceAspects == null) {", "originalCommit": "7ea1826951e249af2cbf9cc15d3afc1433c501a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4NDA5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473584097", "bodyText": "It depends. I checked with @srnagar. Returns null is different than return an empty list. A list is null means the value is never set, a empty list means the value was set but it was empty.  \"returning empty list might make the user feel like we still went ahead and mined the opinions and there were just no opinions in the text\".", "author": "mssfang", "createdAt": "2020-08-20T04:39:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzIxMTg0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM1NDc5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473354793", "bodyText": "Did you have to change this because of an error in the compiler or something?", "author": "maririos", "createdAt": "2020-08-19T21:46:42Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/TextAnalyticsAsyncClientJavaDocCodeSnippets.java", "diffHunk": "@@ -482,7 +509,7 @@ public void analyzeSentimentStringListWithOptions() {\n             \"The restaurant had amazing gnocchi.\"\n         );\n \n-        textAnalyticsAsyncClient.analyzeSentimentBatch(documents, \"en\", null).subscribe(\n+        textAnalyticsAsyncClient.analyzeSentimentBatch(documents, \"en\", new TextAnalyticsRequestOptions()).subscribe(", "originalCommit": "7ea1826951e249af2cbf9cc15d3afc1433c501a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzU4NzUwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473587508", "bodyText": "After revisited the purpose of this codesnippet, found set the TextAnalyticsRequestOptions to null is wrong.\nThe purpose of this codesnippet is to show the how to use API with TextAnalyticsRequestOptions.\nSo I will update it to include statistics info.", "author": "mssfang", "createdAt": "2020-08-20T04:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM1NDc5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDEzMTYwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r474131604", "bodyText": "This happens in other places of your tests... I see how you always replace null for TextAnalyticsRequestOptions .\nif you leave it null, will the code compile?\nI am asking this because I want to make sure this is not because of the addition of AnalyzeSentimentOptions", "author": "maririos", "createdAt": "2020-08-20T16:46:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM1NDc5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzM1NTg4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473355883", "bodyText": "it is the opinion that is negated, not the aspect :)", "author": "maririos", "createdAt": "2020-08-19T21:47:59Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/samples/java/com/azure/ai/textanalytics/TextAnalyticsClientJavaDocCodeSnippets.java", "diffHunk": "@@ -582,4 +642,52 @@ public void analyzeBatchSentimentMaxOverload() {\n         });\n         // END: com.azure.ai.textanalytics.TextAnalyticsClient.analyzeSentimentBatch#Iterable-TextAnalyticsRequestOptions-Context\n     }\n+\n+    /**\n+     * Code snippet for {@link TextAnalyticsClient#analyzeSentimentBatchWithResponse(Iterable, AnalyzeSentimentOptions, Context)}\n+     */\n+    public void analyzeBatchSentimentMaxOverloadWithOpinionMining() {\n+        // BEGIN: com.azure.ai.textanalytics.TextAnalyticsClient.analyzeSentimentBatch#Iterable-AnalyzeSentimentOptions-Context\n+        List<TextDocumentInput> textDocumentInputs = Arrays.asList(\n+            new TextDocumentInput(\"1\", \"The hotel was dark and unclean. The restaurant had amazing gnocchi.\")\n+                .setLanguage(\"en\"),\n+            new TextDocumentInput(\"2\", \"The restaurant had amazing gnocchi. The hotel was dark and unclean.\")\n+                .setLanguage(\"en\")\n+        );\n+\n+        AnalyzeSentimentOptions options = new AnalyzeSentimentOptions().setIncludeOpinionMining(true)\n+            .setIncludeStatistics(true);\n+\n+        // Analyzing batch sentiments\n+        Response<AnalyzeSentimentResultCollection> response =\n+            textAnalyticsClient.analyzeSentimentBatchWithResponse(textDocumentInputs, options, Context.NONE);\n+\n+        // Response's status code\n+        System.out.printf(\"Status code of request response: %d%n\", response.getStatusCode());\n+        AnalyzeSentimentResultCollection resultCollection = response.getValue();\n+\n+        // Batch statistics\n+        TextDocumentBatchStatistics batchStatistics = resultCollection.getStatistics();\n+        System.out.printf(\"A batch of documents statistics, transaction count: %s, valid document count: %s.%n\",\n+            batchStatistics.getTransactionCount(), batchStatistics.getValidDocumentCount());\n+\n+        // Analyzed sentiment for each of documents from a batch of documents\n+        resultCollection.forEach(analyzeSentimentResult -> {\n+            System.out.printf(\"Document ID: %s%n\", analyzeSentimentResult.getId());\n+            DocumentSentiment documentSentiment = analyzeSentimentResult.getDocumentSentiment();\n+            documentSentiment.getSentences().forEach(sentenceSentiment -> {\n+                System.out.printf(\"\\tSentence sentiment: %s%n\", sentenceSentiment.getSentiment());\n+                sentenceSentiment.getMinedOpinions().forEach(minedOpinions -> {\n+                    AspectSentiment aspectSentiment = minedOpinions.getAspect();\n+                    System.out.printf(\"\\tAspect sentiment: %s, aspect text: %s%n\", aspectSentiment.getSentiment(),\n+                        aspectSentiment.getText());\n+                    for (OpinionSentiment opinionSentiment : minedOpinions.getOpinions()) {\n+                        System.out.printf(\"\\t\\t'%s' sentiment because of \\\"%s\\\". Is the aspect negated: %s.%n\",", "originalCommit": "7ea1826951e249af2cbf9cc15d3afc1433c501a5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7f0920d3ec855262d7772e5615f8880467b13a3b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7f0920d3ec855262d7772e5615f8880467b13a3b", "message": "wording and address mariana feedbacks", "committedDate": "2020-08-20T05:04:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyMzU4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473623585", "bodyText": "Since these are private functions, I am not sure if these error messages will help user understand what went wrong. Also, if they are for debuggability purposes should we consider not throwing the execption but just logging it?\nIs this the client side expectation we are setting?", "author": "samvaity", "createdAt": "2020-08-20T05:55:51Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +208,134 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options, Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            options == null ? null : options.isIncludeOpinionMining(),\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinions> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment,\n+        List<DocumentSentiment> documentSentimentList) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        if (sentenceAspects == null) {\n+            return null;\n+        }\n+        final List<MinedOpinions> minedOpinions = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String opinionPointer = aspectRelation.getRef();\n+                if (AspectRelationType.OPINION == aspectRelationType) {\n+                    opinionSentiments.add(toOpinionSentiment(\n+                        findSentimentOpinion(opinionPointer, documentSentimentList)));\n+                }\n+            });\n+\n+            minedOpinions.add(new MinedOpinions(\n+                new AspectSentiment(sentenceAspect.getText(),\n+                    TextSentiment.fromString(sentenceAspect.getSentiment().toString()),\n+                    sentenceAspect.getOffset(), sentenceAspect.getLength(),\n+                    toSentimentConfidenceScores(sentenceAspect.getConfidenceScores())),\n+                new IterableStream<>(opinionSentiments)));\n+        });\n+\n+        return new IterableStream<>(minedOpinions);\n+    }\n+\n+    /*\n+     * Transform type AspectConfidenceScoreLabel to SentimentConfidenceScores.\n+     */\n+    private SentimentConfidenceScores toSentimentConfidenceScores(\n+        AspectConfidenceScoreLabel aspectConfidenceScoreLabel) {\n+        return new SentimentConfidenceScores(aspectConfidenceScoreLabel.getNegative(), NEUTRAL_SCORE_ZERO,\n+            aspectConfidenceScoreLabel.getPositive());\n+    }\n+\n+    /*\n+     * Transform type SentenceOpinion to OpinionSentiment.\n+     */\n+    private OpinionSentiment toOpinionSentiment(SentenceOpinion sentenceOpinion) {\n+        return new OpinionSentiment(sentenceOpinion.getText(),\n+            TextSentiment.fromString(sentenceOpinion.getSentiment().toString()),\n+            sentenceOpinion.getOffset(), sentenceOpinion.getLength(), sentenceOpinion.isNegated(),\n+            toSentimentConfidenceScores(sentenceOpinion.getConfidenceScores()));\n+    }\n+\n+    /*\n+     * Parses the reference pointer to an index array that contains document, sentence, and opinion indexes.\n+     */\n+    private int[] parseRefPointerToIndexArray(String referencePointer) {\n+        // The pattern always start with character '#', the opinion index will existing in specified sentence, which\n+        // is under specified document.\n+        // example: #/documents/0/sentences/0/opinions/0\n+        final String patternRegex = \"#\\\\/documents\\\\/(\\\\d+)\\\\/sentences\\\\/(\\\\d+)\\\\/opinions\\\\/(\\\\d+)\";\n+        final Pattern pattern = Pattern.compile(patternRegex);\n+        final Matcher matcher = pattern.matcher(referencePointer);\n+        final boolean isMatched = matcher.find();\n+\n+        // The first index represents the document index, second one represents the sentence index,\n+        // third ond represents the opinion index.\n+        final int[] result = new int[3];\n+        if (isMatched) {\n+            String[] segments = referencePointer.split(\"/\");\n+            result[0] = Integer.parseInt(segments[2]);\n+            result[1] = Integer.parseInt(segments[4]);\n+            result[2] = Integer.parseInt(segments[6]);\n+        } else {\n+            throw logger.logExceptionAsError(new RuntimeException(\n+                String.format(\"'referencePointer' %s is not a valid opinion pointer\", referencePointer)));", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcwNDQ0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478704441", "bodyText": "It should throw since it is validating on the service's response. But I will change the Exception type to IllegalStateException since RuntimeException is too generic.", "author": "mssfang", "createdAt": "2020-08-27T21:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyMzU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyNTU2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473625566", "bodyText": "Not sure if this would be the best way, we could get a NumberFormatException or a IndexOutOfBoundExcption depending on if the segment is not a valid number or we didn't get 6 segments.", "author": "samvaity", "createdAt": "2020-08-20T05:58:54Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +208,134 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options, Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            options == null ? null : options.isIncludeOpinionMining(),\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinions> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment,\n+        List<DocumentSentiment> documentSentimentList) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        if (sentenceAspects == null) {\n+            return null;\n+        }\n+        final List<MinedOpinions> minedOpinions = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String opinionPointer = aspectRelation.getRef();\n+                if (AspectRelationType.OPINION == aspectRelationType) {\n+                    opinionSentiments.add(toOpinionSentiment(\n+                        findSentimentOpinion(opinionPointer, documentSentimentList)));\n+                }\n+            });\n+\n+            minedOpinions.add(new MinedOpinions(\n+                new AspectSentiment(sentenceAspect.getText(),\n+                    TextSentiment.fromString(sentenceAspect.getSentiment().toString()),\n+                    sentenceAspect.getOffset(), sentenceAspect.getLength(),\n+                    toSentimentConfidenceScores(sentenceAspect.getConfidenceScores())),\n+                new IterableStream<>(opinionSentiments)));\n+        });\n+\n+        return new IterableStream<>(minedOpinions);\n+    }\n+\n+    /*\n+     * Transform type AspectConfidenceScoreLabel to SentimentConfidenceScores.\n+     */\n+    private SentimentConfidenceScores toSentimentConfidenceScores(\n+        AspectConfidenceScoreLabel aspectConfidenceScoreLabel) {\n+        return new SentimentConfidenceScores(aspectConfidenceScoreLabel.getNegative(), NEUTRAL_SCORE_ZERO,\n+            aspectConfidenceScoreLabel.getPositive());\n+    }\n+\n+    /*\n+     * Transform type SentenceOpinion to OpinionSentiment.\n+     */\n+    private OpinionSentiment toOpinionSentiment(SentenceOpinion sentenceOpinion) {\n+        return new OpinionSentiment(sentenceOpinion.getText(),\n+            TextSentiment.fromString(sentenceOpinion.getSentiment().toString()),\n+            sentenceOpinion.getOffset(), sentenceOpinion.getLength(), sentenceOpinion.isNegated(),\n+            toSentimentConfidenceScores(sentenceOpinion.getConfidenceScores()));\n+    }\n+\n+    /*\n+     * Parses the reference pointer to an index array that contains document, sentence, and opinion indexes.\n+     */\n+    private int[] parseRefPointerToIndexArray(String referencePointer) {\n+        // The pattern always start with character '#', the opinion index will existing in specified sentence, which\n+        // is under specified document.\n+        // example: #/documents/0/sentences/0/opinions/0\n+        final String patternRegex = \"#\\\\/documents\\\\/(\\\\d+)\\\\/sentences\\\\/(\\\\d+)\\\\/opinions\\\\/(\\\\d+)\";\n+        final Pattern pattern = Pattern.compile(patternRegex);\n+        final Matcher matcher = pattern.matcher(referencePointer);\n+        final boolean isMatched = matcher.find();\n+\n+        // The first index represents the document index, second one represents the sentence index,\n+        // third ond represents the opinion index.\n+        final int[] result = new int[3];\n+        if (isMatched) {\n+            String[] segments = referencePointer.split(\"/\");\n+            result[0] = Integer.parseInt(segments[2]);\n+            result[1] = Integer.parseInt(segments[4]);\n+            result[2] = Integer.parseInt(segments[6]);", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyMDI0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478720240", "bodyText": "it won't have NumberFormatException and IndexOutOfBoundException because of the 'isMatched' will be false in that case. And then it will throw IllegalStateException.", "author": "mssfang", "createdAt": "2020-08-27T22:01:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyNTU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyNjg3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473626874", "bodyText": "{@code neutral} This wouldn't be highlighted correctly since it is an enum. Need to add a an enum highlighter,", "author": "samvaity", "createdAt": "2020-08-20T06:00:47Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AspectSentiment.java", "diffHunk": "@@ -0,0 +1,86 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link AspectSentiment} model.\n+ */\n+@Immutable\n+public final class AspectSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link AspectSentiment} model that describes aspect.\n+     *\n+     * @param text The aspect text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE, MIXED. {@link TextSentiment} has\n+     * {@code neutral} sentiment type additionally, but aspect sentiment can only be positive, negative, or mixed.", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyNzEzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473627139", "bodyText": "the docs could be better", "author": "samvaity", "createdAt": "2020-08-20T06:01:14Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/AspectSentiment.java", "diffHunk": "@@ -0,0 +1,86 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link AspectSentiment} model.\n+ */\n+@Immutable\n+public final class AspectSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link AspectSentiment} model that describes aspect.\n+     *\n+     * @param text The aspect text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE, MIXED. {@link TextSentiment} has\n+     * {@code neutral} sentiment type additionally, but aspect sentiment can only be positive, negative, or mixed.\n+     * @param offset The offset of aspect text.\n+     * @param length The length of aspect text.\n+     * @param confidenceScores The {@link SentimentConfidenceScores}.\n+     */\n+    public AspectSentiment(String text, TextSentiment sentiment,\n+        int offset, int length, SentimentConfidenceScores confidenceScores) {\n+        this.text = text;\n+        this.sentiment = sentiment;\n+        this.confidenceScores = confidenceScores;\n+        this.length = length;\n+        this.offset = offset;\n+    }\n+\n+    /**\n+     * Get the aspect text property.\n+     *\n+     * @return The text value.\n+     */\n+    public String getText() {\n+        return text;\n+    }\n+\n+    /**\n+     * Get the aspect text sentiment label: POSITIVE, NEGATIVE, MIXED. {@link TextSentiment} has\n+     * {@code neutral} sentiment type additionally, but aspect sentiment can only be positive, negative, or mixed.\n+     *\n+     * @return The sentiment value.\n+     */\n+    public TextSentiment getSentiment() {\n+        return sentiment;\n+    }\n+\n+\n+    /**\n+     * Get the offset of aspect text.", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyNzk4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473627986", "bodyText": "Update the docs here to help user understand the functionality.", "author": "samvaity", "createdAt": "2020-08-20T06:02:33Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/OpinionSentiment.java", "diffHunk": "@@ -0,0 +1,97 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The {@link OpinionSentiment} model.\n+ */\n+@Immutable\n+public final class OpinionSentiment {\n+    private final String text;\n+    private final TextSentiment sentiment;\n+    private final SentimentConfidenceScores confidenceScores;\n+    private final boolean isNegated;\n+    private final int length;\n+    private final int offset;\n+\n+    /**\n+     * Create an {@link OpinionSentiment} model that describes opinion sentiment.\n+     *\n+     * @param text The opinion text property.\n+     * @param sentiment The text sentiment label: POSITIVE, NEGATIVE, MIXED. {@link TextSentiment} has\n+     * {@code neutral} sentiment type additionally, but opinion sentiment can only be positive, negative, or mixed.\n+     * @param offset The offset of opinion text.\n+     * @param length The length of opinion text.\n+     * @param isNegated The boolean indicator to show if the opinion text negated or not.\n+     * @param confidenceScores The {@link SentimentConfidenceScores}.\n+     */\n+    public OpinionSentiment(String text, TextSentiment sentiment, int offset, int length,\n+        boolean isNegated, SentimentConfidenceScores confidenceScores) {\n+        this.text = text;\n+        this.sentiment = sentiment;\n+        this.offset = offset;\n+        this.length = length;\n+        this.isNegated = isNegated;\n+        this.confidenceScores = confidenceScores;\n+    }\n+\n+    /**\n+     * Get the opinion text property.\n+     *\n+     * @return The text value.\n+     */\n+    public String getText() {\n+        return text;\n+    }\n+\n+    /**\n+     * Get the opinion text sentiment label: POSITIVE, NEGATIVE, MIXED. {@link TextSentiment} has\n+     * {@code neutral} sentiment type additionally, but aspect sentiment can only be positive, negative, or mixed.\n+     *\n+     * @return The sentiment value.\n+     */\n+    public TextSentiment getSentiment() {\n+        return sentiment;\n+    }\n+\n+    /**\n+     * Get the offset of opinion text.", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyODczOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r473628739", "bodyText": "This is final, does it mean it is always null on this model class?", "author": "samvaity", "createdAt": "2020-08-20T06:03:42Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/SentenceSentiment.java", "diffHunk": "@@ -14,25 +15,43 @@\n     private final String text;\n     private final SentimentConfidenceScores confidenceScores;\n     private final TextSentiment sentiment;\n+    private final IterableStream<MinedOpinions> minedOpinions;\n \n     /**\n      * Creates a {@link SentenceSentiment} model that describes the sentiment analysis of sentence.\n-     *\n-     * @param text The sentence text\n+     * @param text The sentence text.\n      * @param sentiment The sentiment label of the sentence.\n      * @param confidenceScores The sentiment confidence score (Softmax score) between 0 and 1, for each sentiment label.\n      *   Higher values signify higher confidence.\n      */\n     public SentenceSentiment(String text, TextSentiment sentiment, SentimentConfidenceScores confidenceScores) {\n         this.text = text;\n         this.sentiment = sentiment;\n+        this.minedOpinions = null;", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDMyODQ0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r474328449", "bodyText": "if user uses this constructor, that means the the minedOpinion will always be null.\nnull minedOpinon means user doesn't want to include opinion mining in the request.\nempty list of minedOpinion has different meaning. It means the user wants the opinion mining but have no opinion returns, so it is an empty list of opinions.", "author": "mssfang", "createdAt": "2020-08-20T23:37:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzYyODczOQ=="}], "type": "inlineReview"}, {"oid": "151c199ad33fbda4682ca7ba1dfc003fbbb24098", "url": "https://github.com/Azure/azure-sdk-for-java/commit/151c199ad33fbda4682ca7ba1dfc003fbbb24098", "message": "resolve conflict", "committedDate": "2020-08-20T23:57:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgxMzk0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r475813943", "bodyText": "could we add tests that validate that if an opinion comes in another sentence the above code is going to work?\nThey will probably have to be mock tests", "author": "maririos", "createdAt": "2020-08-24T18:30:36Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -188,24 +208,134 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options, Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            options == null ? null : options.isIncludeOpinionMining(),\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinions> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment,\n+        List<DocumentSentiment> documentSentimentList) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        if (sentenceAspects == null) {\n+            return null;\n+        }\n+        final List<MinedOpinions> minedOpinions = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String opinionPointer = aspectRelation.getRef();\n+                if (AspectRelationType.OPINION == aspectRelationType) {\n+                    opinionSentiments.add(toOpinionSentiment(\n+                        findSentimentOpinion(opinionPointer, documentSentimentList)));\n+                }\n+            });\n+\n+            minedOpinions.add(new MinedOpinions(\n+                new AspectSentiment(sentenceAspect.getText(),\n+                    TextSentiment.fromString(sentenceAspect.getSentiment().toString()),\n+                    sentenceAspect.getOffset(), sentenceAspect.getLength(),\n+                    toSentimentConfidenceScores(sentenceAspect.getConfidenceScores())),\n+                new IterableStream<>(opinionSentiments)));\n+        });\n+\n+        return new IterableStream<>(minedOpinions);\n+    }\n+\n+    /*\n+     * Transform type AspectConfidenceScoreLabel to SentimentConfidenceScores.\n+     */\n+    private SentimentConfidenceScores toSentimentConfidenceScores(\n+        AspectConfidenceScoreLabel aspectConfidenceScoreLabel) {\n+        return new SentimentConfidenceScores(aspectConfidenceScoreLabel.getNegative(), NEUTRAL_SCORE_ZERO,\n+            aspectConfidenceScoreLabel.getPositive());\n+    }\n+\n+    /*\n+     * Transform type SentenceOpinion to OpinionSentiment.\n+     */\n+    private OpinionSentiment toOpinionSentiment(SentenceOpinion sentenceOpinion) {\n+        return new OpinionSentiment(sentenceOpinion.getText(),\n+            TextSentiment.fromString(sentenceOpinion.getSentiment().toString()),\n+            sentenceOpinion.getOffset(), sentenceOpinion.getLength(), sentenceOpinion.isNegated(),\n+            toSentimentConfidenceScores(sentenceOpinion.getConfidenceScores()));\n+    }\n+\n+    /*\n+     * Parses the reference pointer to an index array that contains document, sentence, and opinion indexes.\n+     */\n+    private int[] parseRefPointerToIndexArray(String referencePointer) {\n+        // The pattern always start with character '#', the opinion index will existing in specified sentence, which\n+        // is under specified document.\n+        // example: #/documents/0/sentences/0/opinions/0\n+        final String patternRegex = \"#\\\\/documents\\\\/(\\\\d+)\\\\/sentences\\\\/(\\\\d+)\\\\/opinions\\\\/(\\\\d+)\";\n+        final Pattern pattern = Pattern.compile(patternRegex);\n+        final Matcher matcher = pattern.matcher(referencePointer);\n+        final boolean isMatched = matcher.find();\n+\n+        // The first index represents the document index, second one represents the sentence index,\n+        // third ond represents the opinion index.\n+        final int[] result = new int[3];\n+        if (isMatched) {\n+            String[] segments = referencePointer.split(\"/\");\n+            result[0] = Integer.parseInt(segments[2]);\n+            result[1] = Integer.parseInt(segments[4]);\n+            result[2] = Integer.parseInt(segments[6]);\n+        } else {\n+            throw logger.logExceptionAsError(new RuntimeException(\n+                String.format(\"'referencePointer' %s is not a valid opinion pointer\", referencePointer)));\n+        }\n+\n+        return result;\n+    }\n+\n+    /*\n+     * Find the specific sentence opinion in the document sentiment list by given the opinion reference pointer.\n+     */\n+    private SentenceOpinion findSentimentOpinion(String opinionPointer, List<DocumentSentiment> documentSentimentList) {\n+        final int[] opinionIndexes = parseRefPointerToIndexArray(opinionPointer);", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODcyNTE4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478725184", "bodyText": "will add the unit tests", "author": "mssfang", "createdAt": "2020-08-27T22:14:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTgxMzk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NTkxMDc4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r475910789", "bodyText": "for includeStatistics, we should also add a comment about how this information is only available for batch operations so we don't confuse the user when trying it to use in the single document operations", "author": "maririos", "createdAt": "2020-08-24T21:41:58Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/TextAnalyticsRequestOptions.java", "diffHunk": "@@ -48,6 +49,7 @@ public boolean isIncludeStatistics() {\n      *", "originalCommit": "7f0920d3ec855262d7772e5615f8880467b13a3b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9969645cbdbf2042c5d8d64bbea6d868a798bc63", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9969645cbdbf2042c5d8d64bbea6d868a798bc63", "message": "resolve conflict", "committedDate": "2020-08-26T22:52:26Z", "type": "commit"}, {"oid": "d3c11bddddca17a664124961d65f47ab5dde6a48", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d3c11bddddca17a664124961d65f47ab5dde6a48", "message": "checkstyle issues", "committedDate": "2020-08-27T00:22:46Z", "type": "commit"}, {"oid": "f43c1bdd151d6187b33c20bca2c15ce9e6dcb957", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f43c1bdd151d6187b33c20bca2c15ce9e6dcb957", "message": "add mockito dependency and tests to TA", "committedDate": "2020-08-27T23:33:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMjAwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478812005", "bodyText": "Redundant escape characters, seems like this should work?\n\nfinal String patternRegex = \"#/documents/(\\d+)/sentences/(\\d+)/opinions/(\\d+)\";", "author": "samvaity", "createdAt": "2020-08-28T03:35:30Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -175,24 +195,135 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options, Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            options == null ? null : options.isIncludeOpinionMining(),\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinion> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment,\n+        List<DocumentSentiment> documentSentimentList) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();\n+        if (sentenceAspects == null) {\n+            return null;\n+        }\n+        final List<MinedOpinion> minedOpinions = new ArrayList<>();\n+        sentenceAspects.forEach(sentenceAspect -> {\n+            final List<OpinionSentiment> opinionSentiments = new ArrayList<>();\n+            sentenceAspect.getRelations().forEach(aspectRelation -> {\n+                final AspectRelationType aspectRelationType = aspectRelation.getRelationType();\n+                final String opinionPointer = aspectRelation.getRef();\n+                if (AspectRelationType.OPINION == aspectRelationType) {\n+                    opinionSentiments.add(toOpinionSentiment(\n+                        findSentimentOpinion(opinionPointer, documentSentimentList)));\n+                }\n+            });\n+\n+            minedOpinions.add(new MinedOpinion(\n+                new AspectSentiment(sentenceAspect.getText(),\n+                    TextSentiment.fromString(sentenceAspect.getSentiment().toString()),\n+                    sentenceAspect.getOffset(), sentenceAspect.getLength(),\n+                    toSentimentConfidenceScores(sentenceAspect.getConfidenceScores())),\n+                new IterableStream<>(opinionSentiments)));\n+        });\n+\n+        return new IterableStream<>(minedOpinions);\n+    }\n+\n+    /*\n+     * Transform type AspectConfidenceScoreLabel to SentimentConfidenceScores.\n+     */\n+    private SentimentConfidenceScores toSentimentConfidenceScores(\n+        AspectConfidenceScoreLabel aspectConfidenceScoreLabel) {\n+        return new SentimentConfidenceScores(aspectConfidenceScoreLabel.getNegative(), NEUTRAL_SCORE_ZERO,\n+            aspectConfidenceScoreLabel.getPositive());\n+    }\n+\n+    /*\n+     * Transform type SentenceOpinion to OpinionSentiment.\n+     */\n+    private OpinionSentiment toOpinionSentiment(SentenceOpinion sentenceOpinion) {\n+        return new OpinionSentiment(sentenceOpinion.getText(),\n+            TextSentiment.fromString(sentenceOpinion.getSentiment().toString()),\n+            sentenceOpinion.getOffset(), sentenceOpinion.getLength(), sentenceOpinion.isNegated(),\n+            toSentimentConfidenceScores(sentenceOpinion.getConfidenceScores()));\n+    }\n+\n+    /*\n+     * Parses the reference pointer to an index array that contains document, sentence, and opinion indexes.\n+     */\n+    int[] parseRefPointerToIndexArray(String opinionPointer) {\n+        // The pattern always start with character '#', the opinion index will existing in specified sentence, which\n+        // is under specified document.\n+        // example: #/documents/0/sentences/0/opinions/0\n+        final String patternRegex = \"#\\\\/documents\\\\/(\\\\d+)\\\\/sentences\\\\/(\\\\d+)\\\\/opinions\\\\/(\\\\d+)\";", "originalCommit": "f43c1bdd151d6187b33c20bca2c15ce9e6dcb957", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMjE2Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478812167", "bodyText": "nit: can replace lambda", "author": "samvaity", "createdAt": "2020-08-28T03:36:12Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -175,24 +195,135 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options, Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            options == null ? null : options.isIncludeOpinionMining(),\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));", "originalCommit": "f43c1bdd151d6187b33c20bca2c15ce9e6dcb957", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMzE0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478813144", "bodyText": "What happens if the service accidentally sends getAspects() as empty even when the boolean indicator for opinion mining is set to true. Seems like we wouldn't catch that. Should check for if the boolean is set not if this is empty. Service can send back error data.", "author": "samvaity", "createdAt": "2020-08-28T03:40:11Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/AnalyzeSentimentAsyncClient.java", "diffHunk": "@@ -175,24 +195,135 @@ private AnalyzeSentimentResult convertToAnalyzeSentimentResult(DocumentSentiment\n      * {@link AnalyzeSentimentResultCollection} from a {@link SimpleResponse} of {@link SentimentResponse}.\n      *\n      * @param documents A list of documents to be analyzed.\n-     * @param options The {@link TextAnalyticsRequestOptions} request options.\n+     * @param options The additional configurable {@link AnalyzeSentimentOptions options} that may be passed when\n+     * analyzing sentiments.\n      * @param context Additional context that is passed through the Http pipeline during the service call.\n      *\n      * @return A mono {@link Response} contains {@link AnalyzeSentimentResultCollection}.\n      */\n     private Mono<Response<AnalyzeSentimentResultCollection>> getAnalyzedSentimentResponse(\n-        Iterable<TextDocumentInput> documents, TextAnalyticsRequestOptions options, Context context) {\n-        // TODO: add opinion mining in the following PR\n+        Iterable<TextDocumentInput> documents, AnalyzeSentimentOptions options, Context context) {\n         return service.sentimentWithResponseAsync(\n             new MultiLanguageBatchInput().setDocuments(toMultiLanguageInput(documents)),\n             options == null ? null : options.getModelVersion(),\n             options == null ? null : options.isIncludeStatistics(),\n-            null,\n+            options == null ? null : options.isIncludeOpinionMining(),\n             context.addData(AZ_TRACING_NAMESPACE_KEY, COGNITIVE_TRACING_NAMESPACE_VALUE))\n             .doOnSubscribe(ignoredValue -> logger.info(\"A batch of documents - {}\", documents.toString()))\n             .doOnSuccess(response -> logger.info(\"Analyzed sentiment for a batch of documents - {}\", response))\n             .doOnError(error -> logger.warning(\"Failed to analyze sentiment - {}\", error))\n             .map(this::toAnalyzeSentimentResultCollectionResponse)\n             .onErrorMap(throwable -> mapToHttpResponseExceptionIfExist(throwable));\n     }\n+\n+    /*\n+     * Transform SentenceSentiment's opinion mining to output that user can use.\n+     */\n+    private IterableStream<MinedOpinion> toMinedOpinionList(\n+        com.azure.ai.textanalytics.implementation.models.SentenceSentiment sentenceSentiment,\n+        List<DocumentSentiment> documentSentimentList) {\n+        // If include opinion mining indicator is false, the service return null for the aspect list.\n+        final List<SentenceAspect> sentenceAspects = sentenceSentiment.getAspects();", "originalCommit": "f43c1bdd151d6187b33c20bca2c15ce9e6dcb957", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzNjk0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478836949", "bodyText": "if the getAspects() is emtpy, we return an empty list of MinedOpinon.\nfinal List<MinedOpinion> minedOpinions = new ArrayList<>();\nreturn new IterableStream<>(minedOpinions);", "author": "mssfang", "createdAt": "2020-08-28T05:24:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMzE0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgzODc3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478838777", "bodyText": "empty list could mean there is no mined opinion but it should not be an exception that need to be catch.", "author": "mssfang", "createdAt": "2020-08-28T05:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxMzE0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODgxNDI3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478814279", "bodyText": "nit: extra lines", "author": "samvaity", "createdAt": "2020-08-28T03:44:55Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/main/java/com/azure/ai/textanalytics/models/MinedOpinion.java", "diffHunk": "@@ -0,0 +1,47 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics.models;\n+\n+import com.azure.core.util.IterableStream;\n+\n+/**\n+ * The {@link MinedOpinion} model.\n+ */\n+public final class MinedOpinion {\n+    private final AspectSentiment aspect;\n+    private final IterableStream<OpinionSentiment> opinions;\n+\n+    /**\n+     * Create an {@link MinedOpinion} model that describes the mined opinions.\n+     *\n+     * @param aspect The aspect of a product/service that the opinions is about.\n+     * @param opinions The opinions of the aspect text.\n+     */\n+    public MinedOpinion(AspectSentiment aspect, IterableStream<OpinionSentiment> opinions) {\n+        this.aspect = aspect;\n+        this.opinions = opinions;\n+    }\n+\n+    /**\n+     * Get the aspect in text, such as the attributes of products or services. For example, if a customer leaves\n+     * feedback about a hotel such as \"the room was great, but the staff was unfriendly\", opinion mining will locate\n+     * aspects in the text. The \"room\" and \"staff\" are two aspects recognized.\n+     *\n+     * @return The aspect in text.\n+     */\n+    public AspectSentiment getAspect() {\n+        return this.aspect;\n+    }\n+\n+    /**\n+     * Get the opinions of aspect text.\n+     *\n+     * @return The opinions of aspect text.\n+     */\n+    public IterableStream<OpinionSentiment> getOpinions() {\n+        return opinions;\n+    }\n+", "originalCommit": "f43c1bdd151d6187b33c20bca2c15ce9e6dcb957", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e5f0ea680876a5ad0c0712eaada35b4450291e48", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e5f0ea680876a5ad0c0712eaada35b4450291e48", "message": "wording and feedbakcs", "committedDate": "2020-08-28T05:33:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg2NjQzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r478866430", "bodyText": "Just wanted to clarify that we are using mocks because the reference pointer is an internal function and can only be accessed with object mocking?", "author": "samvaity", "createdAt": "2020-08-28T06:52:06Z", "path": "sdk/textanalytics/azure-ai-textanalytics/src/test/java/com/azure/ai/textanalytics/ReferencePointerParseTest.java", "diffHunk": "@@ -0,0 +1,152 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.textanalytics;\n+\n+import com.azure.ai.textanalytics.implementation.TextAnalyticsClientImpl;\n+import com.azure.ai.textanalytics.implementation.models.DocumentSentiment;\n+import com.azure.ai.textanalytics.implementation.models.SentenceOpinion;\n+import com.azure.ai.textanalytics.implementation.models.SentenceSentiment;\n+import org.junit.jupiter.api.AfterEach;\n+import org.junit.jupiter.api.BeforeEach;\n+import org.junit.jupiter.api.Test;\n+import org.mockito.Mock;\n+import org.mockito.Mockito;\n+import org.mockito.MockitoAnnotations;\n+\n+import java.util.List;\n+\n+import static org.junit.jupiter.api.Assertions.assertEquals;\n+import static org.junit.jupiter.api.Assertions.assertThrows;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * Unit tests for Aspect relation's reference parse\n+ */\n+public class ReferencePointerParseTest {\n+\n+    @Mock", "originalCommit": "e5f0ea680876a5ad0c0712eaada35b4450291e48", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTU0NzYyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/13333#discussion_r479547621", "bodyText": "I want to remove the dependency on TextAnalyticsClientImpl\nprivate AnalyzeSentimentAsyncClient analyzeSentimentAsyncClient = new AnalyzeSentimentAsyncClient(textAnalyticsClientImpl);", "author": "mssfang", "createdAt": "2020-08-28T21:44:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODg2NjQzMA=="}], "type": "inlineReview"}, {"oid": "be9721fdca7503f7f5b8e5d8b56f6a1e0d42c499", "url": "https://github.com/Azure/azure-sdk-for-java/commit/be9721fdca7503f7f5b8e5d8b56f6a1e0d42c499", "message": "don't mock on input", "committedDate": "2020-08-28T21:19:13Z", "type": "commit"}]}