{"pr_number": 16821, "pr_title": "Communication - Added release phone number LRO", "pr_createdAt": "2020-10-26T20:30:28Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16821", "timeline": [{"oid": "7dfe573c63c662966919a7fcf8b9993862c2401a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7dfe573c63c662966919a7fcf8b9993862c2401a", "message": "Added release phone number LRO", "committedDate": "2020-10-26T20:40:43Z", "type": "forcePushed"}, {"oid": "d20ce035b42b3779e6082e7e0292dd4adccdcd9e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d20ce035b42b3779e6082e7e0292dd4adccdcd9e", "message": "Added release phone number LRO", "committedDate": "2020-10-26T20:58:20Z", "type": "forcePushed"}, {"oid": "650b2887cb9ce6493125182d51f2fc306ac8375e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/650b2887cb9ce6493125182d51f2fc306ac8375e", "message": "Refactor private methods and added readme", "committedDate": "2020-10-26T22:01:54Z", "type": "forcePushed"}, {"oid": "ee4969205c0ff2cc7c0c43db4b25b52cba0248d6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ee4969205c0ff2cc7c0c43db4b25b52cba0248d6", "message": "Refactor private methods and added readme", "committedDate": "2020-10-26T22:03:32Z", "type": "forcePushed"}, {"oid": "5ec46e1277e4ccf8dcc2a1bbcb97f3a21748d5d2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5ec46e1277e4ccf8dcc2a1bbcb97f3a21748d5d2", "message": "Refactor private methods and added readme", "committedDate": "2020-10-26T22:11:08Z", "type": "forcePushed"}, {"oid": "8415ffe0982cf4a7975357e43e0b187afe9986c4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8415ffe0982cf4a7975357e43e0b187afe9986c4", "message": "Fixed style issues", "committedDate": "2020-10-26T22:54:50Z", "type": "forcePushed"}, {"oid": "55eb6df955eb96d0ce7d4bb14f43a46d65945477", "url": "https://github.com/Azure/azure-sdk-for-java/commit/55eb6df955eb96d0ce7d4bb14f43a46d65945477", "message": "Fixed style issues", "committedDate": "2020-10-27T15:53:11Z", "type": "forcePushed"}, {"oid": "027efb73125c8115e4a1b3d9b907308c4e8ef6bd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/027efb73125c8115e4a1b3d9b907308c4e8ef6bd", "message": "Fixed style issues", "committedDate": "2020-10-27T16:41:50Z", "type": "forcePushed"}, {"oid": "950618e505111bc29d84637987dc866a8f9d0bd6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/950618e505111bc29d84637987dc866a8f9d0bd6", "message": "Added release phone number LRO", "committedDate": "2020-10-28T19:05:37Z", "type": "commit"}, {"oid": "a6b179531925f4792a712b240ca44d945f2bf027", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a6b179531925f4792a712b240ca44d945f2bf027", "message": "Made implemented functions private", "committedDate": "2020-10-28T19:05:38Z", "type": "commit"}, {"oid": "82d6580e6ea0d7cc782420b7af7dafd44d5357a9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/82d6580e6ea0d7cc782420b7af7dafd44d5357a9", "message": "Refactor private methods and added readme", "committedDate": "2020-10-28T19:05:39Z", "type": "commit"}, {"oid": "f4644d29a07e743e7a65b49ef1729edc3e2cb51d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f4644d29a07e743e7a65b49ef1729edc3e2cb51d", "message": "Fixed style issues", "committedDate": "2020-10-28T19:05:40Z", "type": "commit"}, {"oid": "f4644d29a07e743e7a65b49ef1729edc3e2cb51d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f4644d29a07e743e7a65b49ef1729edc3e2cb51d", "message": "Fixed style issues", "committedDate": "2020-10-28T19:05:40Z", "type": "forcePushed"}, {"oid": "f11ee5351b0aa65fc62a7ecd2e45ebd32a9aef0a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f11ee5351b0aa65fc62a7ecd2e45ebd32a9aef0a", "message": "Fixed readme samples", "committedDate": "2020-10-28T20:02:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3MTY3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16821#discussion_r513771672", "bodyText": "Similar to other, can you use the default interval here as well?", "author": "ankitarorabit", "createdAt": "2020-10-28T21:27:30Z", "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/PhoneNumberAsyncClient.java", "diffHunk": "@@ -896,4 +896,67 @@\n         };\n \n     }\n+\n+ /**\n+     * Releases the given phone numbers.\n+     * This function returns a Long Running Operation poller that allows you to \n+     * wait indefinitely until the operation is complete.\n+     * \n+     * @param phoneNumbers A list of {@link PhoneNumber} with the desired numbers to release\n+     * @param pollInterval The time our long running operation will keep on polling \n+     * until it gets a result from the server\n+     * @return A {@link PollerFlux} object with the release entity\n+     */\n+    @ServiceMethod(returns = ReturnType.COLLECTION)\n+    public PollerFlux<PhoneNumberRelease, PhoneNumberRelease> \n+        beginReleasePhoneNumbers(List<PhoneNumber> phoneNumbers, Duration pollInterval) {\n+        Objects.requireNonNull(phoneNumbers, \"'phoneNumbers' cannot be null.\");\n+        Objects.requireNonNull(pollInterval, \"'pollInterval' cannot be null.\");", "originalCommit": "f11ee5351b0aa65fc62a7ecd2e45ebd32a9aef0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3MjM2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16821#discussion_r513772362", "bodyText": "nit: can you move the argument in the above line?", "author": "ankitarorabit", "createdAt": "2020-10-28T21:28:54Z", "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/PhoneNumberAsyncClient.java", "diffHunk": "@@ -896,4 +896,67 @@\n         };\n \n     }\n+\n+ /**\n+     * Releases the given phone numbers.\n+     * This function returns a Long Running Operation poller that allows you to \n+     * wait indefinitely until the operation is complete.\n+     * \n+     * @param phoneNumbers A list of {@link PhoneNumber} with the desired numbers to release\n+     * @param pollInterval The time our long running operation will keep on polling \n+     * until it gets a result from the server\n+     * @return A {@link PollerFlux} object with the release entity\n+     */\n+    @ServiceMethod(returns = ReturnType.COLLECTION)\n+    public PollerFlux<PhoneNumberRelease, PhoneNumberRelease> \n+        beginReleasePhoneNumbers(List<PhoneNumber> phoneNumbers, Duration pollInterval) {\n+        Objects.requireNonNull(phoneNumbers, \"'phoneNumbers' cannot be null.\");\n+        Objects.requireNonNull(pollInterval, \"'pollInterval' cannot be null.\");\n+        return new PollerFlux<PhoneNumberRelease, PhoneNumberRelease>(pollInterval,\n+            releaseNumbersActivationOperation(phoneNumbers),\n+            releaseNumbersPollOperation(),\n+            (activationResponse, pollingContext) ->\n+            monoError(logger, new RuntimeException(\"Cancellation is not supported\")),\n+            releaseNumbersFetchResultOperation());\n+    }\n+\n+    private Function<PollingContext<PhoneNumberRelease>, Mono<PhoneNumberRelease>> \n+        releaseNumbersActivationOperation(List<PhoneNumber> phoneNumbers) {\n+        return (pollingContext) -> {\n+            Mono<PhoneNumberRelease> response = releasePhoneNumbers(phoneNumbers)\n+                .flatMap(releaseNumberResponse -> {\n+                    String releaseId = releaseNumberResponse.getReleaseId();\n+                    Mono<PhoneNumberRelease> phoneNumberRelease = getReleaseById(releaseId);\n+                    return phoneNumberRelease;\n+                });\n+            return response;\n+        };\n+    }\n+\n+    private Function<PollingContext<PhoneNumberRelease>, \n+        Mono<PollResponse<PhoneNumberRelease>>> ", "originalCommit": "f11ee5351b0aa65fc62a7ecd2e45ebd32a9aef0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3MzUyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16821#discussion_r513773522", "bodyText": "Didnt we say that we will not block and instead use stepVerifier in tests?", "author": "ankitarorabit", "createdAt": "2020-10-28T21:31:02Z", "path": "sdk/communication/azure-communication-administration/src/test/java/com/azure/communication/administration/PhoneNumberAsyncClientIntegrationTest.java", "diffHunk": "@@ -525,6 +494,22 @@ public void beginPurchaseSearch(HttpClient httpClient) {\n             .verifyComplete();\n     }\n \n+    @ParameterizedTest\n+    @MethodSource(\"com.azure.core.test.TestBase#getHttpClients\")\n+    public void beginReleasePhoneNumbers(HttpClient httpClient) {\n+        PhoneNumber phoneNumber = new PhoneNumber(PHONENUMBER_TO_RELEASE);\n+        List<PhoneNumber> phoneNumbers = new ArrayList<>();\n+        phoneNumbers.add(phoneNumber);\n+        Duration pollInterval = Duration.ofSeconds(5);\n+        PollerFlux<PhoneNumberRelease, PhoneNumberRelease> poller =\n+            this.getClient(httpClient).beginReleasePhoneNumbers(phoneNumbers, pollInterval);\n+        AsyncPollResponse<PhoneNumberRelease, PhoneNumberRelease> asyncRes = ", "originalCommit": "f11ee5351b0aa65fc62a7ecd2e45ebd32a9aef0a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3NDA2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16821#discussion_r513774068", "bodyText": "I am not sure what the developers will understand out of PhoneNumberRelease, can't we have a better naming atleast for this?", "author": "ankitarorabit", "createdAt": "2020-10-28T21:32:07Z", "path": "sdk/communication/azure-communication-administration/src/main/java/com/azure/communication/administration/PhoneNumberAsyncClient.java", "diffHunk": "@@ -896,4 +896,67 @@\n         };\n \n     }\n+\n+ /**\n+     * Releases the given phone numbers.\n+     * This function returns a Long Running Operation poller that allows you to \n+     * wait indefinitely until the operation is complete.\n+     * \n+     * @param phoneNumbers A list of {@link PhoneNumber} with the desired numbers to release\n+     * @param pollInterval The time our long running operation will keep on polling \n+     * until it gets a result from the server\n+     * @return A {@link PollerFlux} object with the release entity\n+     */\n+    @ServiceMethod(returns = ReturnType.COLLECTION)\n+    public PollerFlux<PhoneNumberRelease, PhoneNumberRelease> ", "originalCommit": "f11ee5351b0aa65fc62a7ecd2e45ebd32a9aef0a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3NTU0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16821#discussion_r513775544", "bodyText": "Ideally, I would want to see something more meaningful -- do we know how other languages are solving this?", "author": "ankitarorabit", "createdAt": "2020-10-28T21:35:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzc3NDA2OA=="}], "type": "inlineReview"}, {"oid": "6cb58925759471ee19ea50b64f7b23f5edd48ef1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6cb58925759471ee19ea50b64f7b23f5edd48ef1", "message": "Addressed comments", "committedDate": "2020-10-29T19:23:19Z", "type": "commit"}, {"oid": "6cb58925759471ee19ea50b64f7b23f5edd48ef1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6cb58925759471ee19ea50b64f7b23f5edd48ef1", "message": "Addressed comments", "committedDate": "2020-10-29T19:23:19Z", "type": "forcePushed"}]}