{"pr_number": 10649, "pr_title": "Use static storage account for Form Recognizer live tests ", "pr_createdAt": "2020-05-01T01:20:41Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/10649", "timeline": [{"oid": "2dd145bd9cb30b5c331329dacc61842be57dbd69", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2dd145bd9cb30b5c331329dacc61842be57dbd69", "message": "update confidence value", "committedDate": "2020-05-01T02:20:17Z", "type": "forcePushed"}, {"oid": "ddf28838302baea5081be66f766cd401687338e0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ddf28838302baea5081be66f766cd401687338e0", "message": "Update for tests", "committedDate": "2020-05-01T21:07:42Z", "type": "forcePushed"}, {"oid": "881492df1dc3bf53412905bd33ea8cdc2e5f1875", "url": "https://github.com/Azure/azure-sdk-for-java/commit/881492df1dc3bf53412905bd33ea8cdc2e5f1875", "message": "remove storage dependency", "committedDate": "2020-05-01T21:27:14Z", "type": "forcePushed"}, {"oid": "b8327555f41ffc1e338044cfae25d6ac7395e1aa", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b8327555f41ffc1e338044cfae25d6ac7395e1aa", "message": "remove storage dependency", "committedDate": "2020-05-01T21:46:17Z", "type": "forcePushed"}, {"oid": "7cd8bc6389f613dd47f9d7f3ab63bac346d816c9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7cd8bc6389f613dd47f9d7f3ab63bac346d816c9", "message": "remove storage dependency", "committedDate": "2020-05-01T22:02:55Z", "type": "forcePushed"}, {"oid": "2cb5547558a30050613358b3a1c8e7ccda4e6a8c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2cb5547558a30050613358b3a1c8e7ccda4e6a8c", "message": "update Form recognizer tests", "committedDate": "2020-05-02T20:31:59Z", "type": "forcePushed"}, {"oid": "c5eef3b827207e6d5c8a1ca09154e2cdda5dd17a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5eef3b827207e6d5c8a1ca09154e2cdda5dd17a", "message": "update changelog", "committedDate": "2020-05-03T21:03:04Z", "type": "forcePushed"}, {"oid": "b39e512ad1a0e606eab8263de7b52f19a0bd97c9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b39e512ad1a0e606eab8263de7b52f19a0bd97c9", "message": "update changelog", "committedDate": "2020-05-03T21:24:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNDY1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10649#discussion_r419824654", "bodyText": "These two methods can simplify to be one generic method.\nprivate String getSasUri(String sasUrl) {}", "author": "mssfang", "createdAt": "2020-05-05T01:49:42Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormTrainingClientTestBase.java", "diffHunk": "@@ -306,15 +277,18 @@ String getApiKey() {\n     String getEndpoint() {\n         return interceptorManager.isPlaybackMode()\n             ? \"https://localhost:8080\"\n-            : Configuration.getGlobalConfiguration().get(\"AZURE_FORM_RECOGNIZER_ENDPOINT\");\n+            : Configuration.getGlobalConfiguration().get(AZURE_FORM_RECOGNIZER_ENDPOINT);\n     }\n \n-    private String createStorageAndGenerateSas(String folderPath) {\n-        if (interceptorManager.isPlaybackMode()) {\n-            return \"https://isPlaybackmode\";\n-        } else {\n-            return Configuration.getGlobalConfiguration().get(FORM_RECOGNIZER_TRAINING_BLOB_CONTAINER_SAS_URL);\n+    private String getTrainingSasUri() {\n+        return interceptorManager.isPlaybackMode()\n+            ? \"https://isPlaybackmode\"\n+            : Configuration.getGlobalConfiguration().get(FORM_RECOGNIZER_TRAINING_BLOB_CONTAINER_SAS_URL);\n+    }\n \n-        }\n+    private String getTestingSasUri() {\n+        return interceptorManager.isPlaybackMode()\n+            ? \"https://isPlaybackmode\"\n+            : Configuration.getGlobalConfiguration().get(FORM_RECOGNIZER_TESTING_BLOB_CONTAINER_SAS_URL);", "originalCommit": "71684319f42e30997c02b5b9b3a611498fa3da5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNjgwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10649#discussion_r419826808", "bodyText": "they are returning different configurations", "author": "samvaity", "createdAt": "2020-05-05T02:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNDY1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNjY3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10649#discussion_r419826677", "bodyText": "do you want to user logger? or is that fine to throw it directly in test?", "author": "mssfang", "createdAt": "2020-05-05T01:59:38Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormTrainingClientTestBase.java", "diffHunk": "@@ -124,72 +95,72 @@ private static void validateErrorData(List<ErrorInformation> expectedErrors,\n         }\n     }\n \n-    static void validateCustomModel(CustomFormModel expectedModel, CustomFormModel actualCustomModel) {\n-        assertNotNull(actualCustomModel.getModelId());\n-        assertEquals(expectedModel.getModelStatus(), actualCustomModel.getModelStatus());\n-        validateErrors(expectedModel.getModelError(), actualCustomModel.getModelError());\n-        assertNotNull(actualCustomModel.getCreatedOn());\n-        assertNotNull(actualCustomModel.getLastUpdatedOn());\n-        validateSubModels(expectedModel.getSubModels(), actualCustomModel.getSubModels());\n-        validateTrainingDocuments(expectedModel.getTrainingDocuments(), actualCustomModel.getTrainingDocuments());\n-    }\n-\n     static void validateAccountProperties(AccountProperties expectedAccountProperties,\n         AccountProperties actualAccountProperties) {\n         assertEquals(expectedAccountProperties.getLimit(), actualAccountProperties.getLimit());\n         assertNotNull(actualAccountProperties.getCount());\n     }\n \n-    private static void validateTrainingDocuments(List<TrainingDocumentInfo> expectedTrainingDocuments,\n-        List<TrainingDocumentInfo> actualTrainingDocuments) {\n-        List<TrainingDocumentInfo> actualTrainingList = new ArrayList<>(actualTrainingDocuments);\n-        List<TrainingDocumentInfo> expectedTrainingList =\n-            new ArrayList<>(expectedTrainingDocuments);\n-        assertEquals(expectedTrainingList.size(), actualTrainingList.size());\n-        for (int i = 0; i < actualTrainingList.size(); i++) {\n-            TrainingDocumentInfo expectedTrainingDocument = expectedTrainingList.get(i);\n-            TrainingDocumentInfo actualTrainingDocument = actualTrainingList.get(i);\n-            assertEquals(expectedTrainingDocument.getName(), actualTrainingDocument.getName());\n-            assertEquals(expectedTrainingDocument.getPageCount(), actualTrainingDocument.getPageCount());\n-            assertEquals(expectedTrainingDocument.getTrainingStatus(), actualTrainingDocument.getTrainingStatus());\n-            validateErrors(expectedTrainingDocument.getDocumentErrors(), actualTrainingDocument.getDocumentErrors());\n+    /**\n+     * Deserialize test data from service.\n+     *\n+     * @return the deserialized raw response test data\n+     */\n+    static <T> T deserializeRawResponse(SerializerAdapter serializerAdapter, NetworkCallRecord record, Class<T> clazz) {\n+        try {\n+            return serializerAdapter.deserialize(record.getResponse().get(\"Body\"),\n+                clazz, SerializerEncoding.JSON);\n+        } catch (IOException e) {\n+            throw new RuntimeException(\"Failed to deserialize service response.\");", "originalCommit": "71684319f42e30997c02b5b9b3a611498fa3da5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNjg0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10649#discussion_r419826848", "bodyText": "I think it is fine to just throw so that the test fails.", "author": "samvaity", "createdAt": "2020-05-05T02:00:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNjY3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNzI5NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10649#discussion_r419827294", "bodyText": "I saw this method twice in this PR.  Do we want to put it in TestUtil?", "author": "mssfang", "createdAt": "2020-05-05T02:02:42Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/test/java/com/azure/ai/formrecognizer/FormRecognizerClientTestBase.java", "diffHunk": "@@ -527,14 +557,63 @@ String getApiKey() {\n     protected String getEndpoint() {", "originalCommit": "71684319f42e30997c02b5b9b3a611498fa3da5e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDI4MTc3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/10649#discussion_r420281770", "bodyText": "Cannot move them outside of the TestBase classes as they the interceptorManager class instance to find the corresponding configurations.", "author": "samvaity", "createdAt": "2020-05-05T17:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgyNzI5NA=="}], "type": "inlineReview"}, {"oid": "d3e085efc241437c70ea04613ffe1363f7c3681c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d3e085efc241437c70ea04613ffe1363f7c3681c", "message": "test deployment script output", "committedDate": "2020-05-05T17:30:19Z", "type": "commit"}, {"oid": "c54b125661152ef0a3db2477de33dd389f93d617", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c54b125661152ef0a3db2477de33dd389f93d617", "message": "update confidence value", "committedDate": "2020-05-05T17:30:24Z", "type": "commit"}, {"oid": "fbd92c9d37bbfcbdde6a368938e50994cbd808f0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbd92c9d37bbfcbdde6a368938e50994cbd808f0", "message": "Update for tests", "committedDate": "2020-05-05T17:30:30Z", "type": "commit"}, {"oid": "f3cfe718bf6eaacaf65212a05f9326e86aa4f839", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3cfe718bf6eaacaf65212a05f9326e86aa4f839", "message": "remove storage dependency", "committedDate": "2020-05-05T17:30:35Z", "type": "commit"}, {"oid": "9743bdcee5bab89f8e9db94aee13682f44c1bfdb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9743bdcee5bab89f8e9db94aee13682f44c1bfdb", "message": "update form training tests to use record files", "committedDate": "2020-05-05T17:30:40Z", "type": "commit"}, {"oid": "332afcea74af70c9c8b9099cf1c88e955390cc7c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/332afcea74af70c9c8b9099cf1c88e955390cc7c", "message": "update Form recognizer tests", "committedDate": "2020-05-05T17:30:46Z", "type": "commit"}, {"oid": "bef1220dfe03558dd5d1b1aad75368a7c510e16f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bef1220dfe03558dd5d1b1aad75368a7c510e16f", "message": "update changelog", "committedDate": "2020-05-05T17:30:50Z", "type": "commit"}, {"oid": "f776d0bcbf9e1ddf59e1e1aabe769fba19e46e7c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f776d0bcbf9e1ddf59e1e1aabe769fba19e46e7c", "message": "readme updates", "committedDate": "2020-05-05T17:30:54Z", "type": "commit"}, {"oid": "f776d0bcbf9e1ddf59e1e1aabe769fba19e46e7c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f776d0bcbf9e1ddf59e1e1aabe769fba19e46e7c", "message": "readme updates", "committedDate": "2020-05-05T17:30:54Z", "type": "forcePushed"}]}