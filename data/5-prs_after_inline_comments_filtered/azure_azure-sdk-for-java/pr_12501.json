{"pr_number": 12501, "pr_title": "add more logging info", "pr_createdAt": "2020-06-24T23:11:18Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12501", "timeline": [{"oid": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "url": "https://github.com/Azure/azure-sdk-for-java/commit/21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "message": "add more logging info", "committedDate": "2020-06-24T23:09:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTUwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445221505", "bodyText": "Why is this logger.warn() and not logger.info(), is this intentional?", "author": "kushagraThapar", "createdAt": "2020-06-24T23:14:13Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/GoneAndRetryWithRetryPolicy.java", "diffHunk": "@@ -83,11 +84,10 @@ public GoneAndRetryWithRetryPolicy(RxDocumentServiceRequest request, Integer wai\n                                 exception, this.lastRetryWithException);\n                         exceptionToThrow = this.lastRetryWithException;\n                     } else {\n-                        logger.warn(\"Received gone exception after backoff/retry. Will fail the request. {}\",\n-                                exception.toString());\n+                        logger.warn(\"Received gone exception after backoff/retry. Will fail the request. {}, short stackTrace = [{}]\",", "originalCommit": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMzQyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445223422", "bodyText": "after all the retries are exhausted we want to print a warn message indicating failure. however when there are more retry attempt are left we want to print a info message.", "author": "moderakh", "createdAt": "2020-06-24T23:20:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTUwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTg1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445221850", "bodyText": "It would be better if we can have this as a JVM parameter as well defined in Configs.java\nSo that if we want the customer to increase the depth size, we don't have to change the code, release and ask them to upgrade.\nWith JVM params, they can just update the param value and they can re-start their application.", "author": "kushagraThapar", "createdAt": "2020-06-24T23:15:21Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/directconnectivity/GoneAndRetryWithRetryPolicy.java", "diffHunk": "@@ -23,8 +24,8 @@\n import java.time.Duration;\n \n public class GoneAndRetryWithRetryPolicy extends RetryPolicyWithDiagnostics {\n-\n     private final static Logger logger = LoggerFactory.getLogger(GoneAndRetryWithRetryPolicy.class);\n+    private final static int LIMITED_STACK_TRACE_FAILURE_DEPTH = 3;", "originalCommit": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyNzQxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445227416", "bodyText": "moved to Configs.java", "author": "moderakh", "createdAt": "2020-06-24T23:33:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMTg1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMjY5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445222697", "bodyText": "We should put these in a try with finally block to close both StringWriter and PrintWriter in case there is any issue serializing the exception.\nJust as a safety check so that we don't have memory leaks.", "author": "kushagraThapar", "createdAt": "2020-06-24T23:17:58Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/Utils.java", "diffHunk": "@@ -646,4 +648,23 @@ public static String toJson(ObjectMapper mapper, ObjectNode object) {\n             throw new IllegalStateException(\"Unable to convert JSON to STRING\", e);\n         }\n     }\n+\n+    public static String limitedStackTrace(Exception e, int depth) {\n+        StackTraceElement[] stacktrace = e.getStackTrace();\n+        if (stacktrace == null) {\n+            return \"null\";\n+        } else {\n+            StringWriter strWriter = new StringWriter();\n+            PrintWriter writer = new PrintWriter(strWriter);", "originalCommit": "21dfcc44213bd06d47eddf4e0041ba4f54d38b64", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyODM0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12501#discussion_r445228346", "bodyText": "This is not a resource. Using of StringBuilder is the same of using byte[] or StringBuilder. same as byte[] instantiation that is not needed to be explicilty closed, doesn't cause memory leak.", "author": "moderakh", "createdAt": "2020-06-24T23:36:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTIyMjY5Nw=="}], "type": "inlineReview"}, {"oid": "c3863647c6431466a1965e5ccf887f3139fa7a59", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c3863647c6431466a1965e5ccf887f3139fa7a59", "message": "addressed comments", "committedDate": "2020-06-24T23:32:36Z", "type": "commit"}, {"oid": "3ee74052d86e6f9acf50bba88a6316267ea49880", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3ee74052d86e6f9acf50bba88a6316267ea49880", "message": "cleanup", "committedDate": "2020-06-24T23:36:11Z", "type": "commit"}, {"oid": "ff1230e2efae4bc85d59f94a38283f23559afadb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ff1230e2efae4bc85d59f94a38283f23559afadb", "message": "updated", "committedDate": "2020-06-24T23:44:28Z", "type": "commit"}, {"oid": "6af79f7f968ec49e3afd7b2dc8aac554ce03d2c5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6af79f7f968ec49e3afd7b2dc8aac554ce03d2c5", "message": "cleanup, removed some earlier stuff", "committedDate": "2020-06-25T17:04:47Z", "type": "commit"}, {"oid": "45a1c16e7317f12b0a04567357d4679deff38190", "url": "https://github.com/Azure/azure-sdk-for-java/commit/45a1c16e7317f12b0a04567357d4679deff38190", "message": "cleanup", "committedDate": "2020-06-25T17:05:43Z", "type": "commit"}, {"oid": "e723df394a004c6f00e7b1ed9431e914a84bf316", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e723df394a004c6f00e7b1ed9431e914a84bf316", "message": "cleanup", "committedDate": "2020-06-25T17:06:08Z", "type": "commit"}, {"oid": "f3575f85e7719197daf3ab8b23e16400a216396b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f3575f85e7719197daf3ab8b23e16400a216396b", "message": "cleanup", "committedDate": "2020-06-25T17:27:57Z", "type": "commit"}]}