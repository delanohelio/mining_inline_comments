{"pr_number": 9173, "pr_title": "Fixing SB tests and message properties. Adds create batch.", "pr_createdAt": "2020-03-17T21:47:12Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9173", "timeline": [{"oid": "7e5aa06f5a0d3152d2a50121e86ee11ec2b1fecf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7e5aa06f5a0d3152d2a50121e86ee11ec2b1fecf", "message": "Adding tests.", "committedDate": "2020-03-18T18:42:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM5OTgzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9173#discussion_r395399836", "bodyText": "Should we use the term event or  message for Service bus?\ncreatesMessageBatchWithSize", "author": "hemanttanwar", "createdAt": "2020-03-20T01:12:39Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/test/java/com/azure/messaging/servicebus/ServiceBusSenderAsyncClientTest.java", "diffHunk": "@@ -125,6 +124,108 @@ void teardown() {\n         messagesCaptor = null;\n     }\n \n+    /**\n+     * Verifies that the correct Service Bus properties are set.\n+     */\n+    @Test\n+    void verifyProperties() {\n+        Assertions.assertEquals(ENTITY_NAME, sender.getEntityName());\n+        Assertions.assertEquals(NAMESPACE, sender.getFullyQualifiedNamespace());\n+    }\n+\n+    /**\n+     * Verifies that an exception is thrown when we create a batch with null options.\n+     */\n+    @Test\n+    void createBatchNull() {\n+        Assertions.assertThrows(NullPointerException.class, () -> sender.createBatch(null));\n+    }\n+\n+    /**\n+     * Verifies that the default batch is the same size as the message link.\n+     */\n+    @Test\n+    void createBatchDefault() {\n+        // Arrange\n+        when(connection.createSendLink(eq(ENTITY_NAME), eq(ENTITY_NAME), any(AmqpRetryOptions.class)))\n+            .thenReturn(Mono.just(sendLink));\n+        when(sendLink.getLinkSize()).thenReturn(Mono.just(MAX_MESSAGE_LENGTH_BYTES));\n+\n+        // Act & Assert\n+        StepVerifier.create(sender.createBatch())\n+            .assertNext(batch -> {\n+                Assertions.assertEquals(MAX_MESSAGE_LENGTH_BYTES, batch.getMaxSizeInBytes());\n+                Assertions.assertEquals(0, batch.getCount());\n+            })\n+            .verifyComplete();\n+    }\n+\n+    /**\n+     * Verifies we cannot create a batch if the options size is larger than the link.\n+     */\n+    @Test\n+    void createBatchWhenSizeTooBig() {\n+        // Arrange\n+        int maxLinkSize = 1024;\n+        int batchSize = maxLinkSize + 10;\n+\n+        final AmqpSendLink link = mock(AmqpSendLink.class);\n+        when(link.getLinkSize()).thenReturn(Mono.just(maxLinkSize));\n+\n+        when(connection.createSendLink(eq(ENTITY_NAME), eq(ENTITY_NAME), eq(retryOptions)))\n+            .thenReturn(Mono.just(link));\n+\n+        // This event is 1024 bytes when serialized.\n+        final CreateBatchOptions options = new CreateBatchOptions().setMaximumSizeInBytes(batchSize);\n+\n+        // Act & Assert\n+        StepVerifier.create(sender.createBatch(options))\n+            .expectError(IllegalArgumentException.class)\n+            .verify();\n+    }\n+\n+    /**\n+     * Verifies that the producer can create a batch with a given {@link CreateBatchOptions#getMaximumSizeInBytes()}.\n+     */\n+    @Test\n+    void createsEventDataBatchWithSize() {", "originalCommit": "a939d2481f305ab67eb72abea04c378a7f5c111a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f537dac63a7cade0768d071dac10fdbe0f6b19eb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f537dac63a7cade0768d071dac10fdbe0f6b19eb", "message": "Splitting sinks.", "committedDate": "2020-03-20T14:00:50Z", "type": "commit"}, {"oid": "c5ab9d97e872306ea266b53495ba262b3bc0c7bc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c5ab9d97e872306ea266b53495ba262b3bc0c7bc", "message": "Fixing calculated time.", "committedDate": "2020-03-20T14:00:50Z", "type": "commit"}, {"oid": "58410b7413de14c0dcb9e37507d7c6b8b4b5cdd9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/58410b7413de14c0dcb9e37507d7c6b8b4b5cdd9", "message": "Fix tests.", "committedDate": "2020-03-20T14:00:50Z", "type": "commit"}, {"oid": "5b5f5b77e00c72e87d96d942d37558268ddd2a50", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5b5f5b77e00c72e87d96d942d37558268ddd2a50", "message": "Fix documentation on interface.", "committedDate": "2020-03-20T14:00:51Z", "type": "commit"}, {"oid": "1f869ed4fdefad485df91595dea8f54ffb9c8c0b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1f869ed4fdefad485df91595dea8f54ffb9c8c0b", "message": "Fixing spotbugs", "committedDate": "2020-03-20T14:00:51Z", "type": "commit"}, {"oid": "a97bcd11401dfe919661b598522b834c7422489d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a97bcd11401dfe919661b598522b834c7422489d", "message": "Adding test for deadletter with properties.", "committedDate": "2020-03-20T14:00:52Z", "type": "commit"}, {"oid": "155359343f8be4d537551d506c9e909a2eae89b0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/155359343f8be4d537551d506c9e909a2eae89b0", "message": "Exposing a way to create Message Batches.", "committedDate": "2020-03-20T14:00:52Z", "type": "commit"}, {"oid": "e6a5e02ff224eaf4d2723494ba03d505b7d18273", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e6a5e02ff224eaf4d2723494ba03d505b7d18273", "message": "Adding tests.", "committedDate": "2020-03-20T14:00:52Z", "type": "commit"}, {"oid": "0d4e17e14520282948968da93a109a1e45a3dab6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d4e17e14520282948968da93a109a1e45a3dab6", "message": "Enabling tests", "committedDate": "2020-03-20T14:00:52Z", "type": "commit"}, {"oid": "9bbc86e283bd54e83536e856efae8f63d3c4741a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9bbc86e283bd54e83536e856efae8f63d3c4741a", "message": "Adding await.", "committedDate": "2020-03-20T14:00:53Z", "type": "commit"}, {"oid": "b134f60f5c3faae0c6725c7461f8d5fff3fe8c52", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b134f60f5c3faae0c6725c7461f8d5fff3fe8c52", "message": "Fix checkstyles.", "committedDate": "2020-03-20T14:00:53Z", "type": "commit"}, {"oid": "0725c2a6d81eb7485a871e1e8b326482c614efd3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0725c2a6d81eb7485a871e1e8b326482c614efd3", "message": "Adding scheduler.", "committedDate": "2020-03-20T14:00:53Z", "type": "commit"}, {"oid": "c90158958d792d8c13448c059429ca40f93b4d43", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c90158958d792d8c13448c059429ca40f93b4d43", "message": "Using Flux.usingWhen()", "committedDate": "2020-03-20T16:09:41Z", "type": "forcePushed"}, {"oid": "c90158958d792d8c13448c059429ca40f93b4d43", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c90158958d792d8c13448c059429ca40f93b4d43", "message": "Using Flux.usingWhen()", "committedDate": "2020-03-20T16:09:41Z", "type": "commit"}, {"oid": "d7eee27652745cb9e19c5466a5a37b1ba9691a53", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d7eee27652745cb9e19c5466a5a37b1ba9691a53", "message": "Fix tests", "committedDate": "2020-03-20T16:11:44Z", "type": "commit"}, {"oid": "36143976fb5bbf33bae0f19ec6fb9238413392c1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/36143976fb5bbf33bae0f19ec6fb9238413392c1", "message": "Removing unused constants.", "committedDate": "2020-03-20T16:24:40Z", "type": "commit"}, {"oid": "c08ccd976a9947a5dc2072f7864f0b05bf6ca7a3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c08ccd976a9947a5dc2072f7864f0b05bf6ca7a3", "message": "Adding test.", "committedDate": "2020-03-20T16:31:47Z", "type": "commit"}, {"oid": "d0b847cc07d520357cd7a8f2f39ef45139755165", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0b847cc07d520357cd7a8f2f39ef45139755165", "message": "Fix checkstyle", "committedDate": "2020-03-20T16:41:38Z", "type": "commit"}, {"oid": "8ff469bc4394831ddf8e585ea986c9a34a54259d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8ff469bc4394831ddf8e585ea986c9a34a54259d", "message": "Reducing delay", "committedDate": "2020-03-20T16:45:31Z", "type": "commit"}]}