{"pr_number": 17910, "pr_title": "ACS Chat: Preview 3 refactor", "pr_createdAt": "2020-12-02T01:16:13Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17910", "timeline": [{"oid": "9b5b902f0e62c243f30155d90c857c6ed343ec8a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9b5b902f0e62c243f30155d90c857c6ed343ec8a", "message": "use local swagger.json", "committedDate": "2020-11-30T22:28:33Z", "type": "commit"}, {"oid": "eb3fdb52de1f2058030b99d8a2f23d62099259cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/eb3fdb52de1f2058030b99d8a2f23d62099259cf", "message": "fix AutoRest directive to match new swagger", "committedDate": "2020-12-01T00:34:47Z", "type": "commit"}, {"oid": "fa62494e916c84e9d27affb1133a2395a5ebbf61", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa62494e916c84e9d27affb1133a2395a5ebbf61", "message": "run AutoRest, update wrapper code accordingly", "committedDate": "2020-12-01T22:33:13Z", "type": "commit"}, {"oid": "9c568f4622e0af8fbd99a52635eb4c1b323719a0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9c568f4622e0af8fbd99a52635eb4c1b323719a0", "message": "more refactoring against new swagger generated code", "committedDate": "2020-12-01T23:16:12Z", "type": "commit"}, {"oid": "a1d877598110e0a40c82d40982f1e1973b6c177c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a1d877598110e0a40c82d40982f1e1973b6c177c", "message": "correct actual vs. expected in assertions", "committedDate": "2020-12-01T23:25:20Z", "type": "commit"}, {"oid": "37e69beabe7f8c475a551799a75740de0c7fd00a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/37e69beabe7f8c475a551799a75740de0c7fd00a", "message": "update test session recordings", "committedDate": "2020-12-01T23:47:27Z", "type": "commit"}, {"oid": "7ddd3b25aad8e0cabdf78103446562c743577973", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ddd3b25aad8e0cabdf78103446562c743577973", "message": "sync README.md", "committedDate": "2020-12-01T23:54:02Z", "type": "commit"}, {"oid": "c433919c78b396bf05babdd62ac05e53d6533a33", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c433919c78b396bf05babdd62ac05e53d6533a33", "message": "expose sync overloads", "committedDate": "2020-12-02T00:20:49Z", "type": "commit"}, {"oid": "9ab9ee57ed9bb2b97b71d6c32324cc420d6d457a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9ab9ee57ed9bb2b97b71d6c32324cc420d6d457a", "message": "add tests", "committedDate": "2020-12-02T01:10:31Z", "type": "commit"}, {"oid": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "message": "update README.md", "committedDate": "2020-12-02T01:24:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg0MDg1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r533840855", "bodyText": "chatClient (singular all the way) ?", "author": "juancamilor", "createdAt": "2020-12-02T01:45:51Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatAsyncClient.java", "diffHunk": "@@ -33,11 +36,13 @@\n     private final ClientLogger logger = new ClientLogger(ChatAsyncClient.class);\n \n     private final AzureCommunicationChatServiceImpl chatServiceClient;\n+    private final ChatsImpl chatsClient;", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU1OTA2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534559062", "bodyText": ".ChatImpl", "author": "juancamilor", "createdAt": "2020-12-02T23:45:21Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatAsyncClient.java", "diffHunk": "@@ -2,15 +2,18 @@\n // Licensed under the MIT License.\n package com.azure.communication.chat;\n \n+import com.azure.communication.chat.implementation.converters.CreateChatThreadResultConverter;\n import reactor.core.publisher.Mono;\n \n+import com.azure.communication.chat.models.ChatThread;\n+import com.azure.communication.chat.models.ChatThreadInfo;\n+import com.azure.communication.chat.models.CreateChatThreadOptions;\n+import com.azure.communication.chat.models.CreateChatThreadResult;\n+import com.azure.communication.chat.models.ListChatThreadsOptions;\n import com.azure.communication.chat.implementation.converters.ChatThreadConverter;\n import com.azure.communication.chat.implementation.converters.CreateChatThreadOptionsConverter;\n import com.azure.communication.chat.implementation.AzureCommunicationChatServiceImpl;\n-import com.azure.communication.chat.models.CreateChatThreadOptions;\n-import com.azure.communication.chat.models.ListChatThreadsOptions;\n-import com.azure.communication.chat.models.ChatThread;\n-import com.azure.communication.chat.models.ChatThreadInfo;\n+import com.azure.communication.chat.implementation.ChatsImpl;", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU1OTMzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534559332", "bodyText": "THREAD_RESOURCE_STATUS_TYPE  - Not needed anymore", "author": "juancamilor", "createdAt": "2020-12-02T23:46:03Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatAsyncClient.java", "diffHunk": "@@ -33,11 +36,13 @@\n     private final ClientLogger logger = new ClientLogger(ChatAsyncClient.class);\n \n     private final AzureCommunicationChatServiceImpl chatServiceClient;\n+    private final ChatsImpl chatsClient;\n \n     private static final String THREAD_RESOURCE_STATUS_TYPE = \"thread\";", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU2MDU2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534560565", "bodyText": ".ChatThreadImpl", "author": "juancamilor", "createdAt": "2020-12-02T23:49:22Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatThreadAsyncClient.java", "diffHunk": "@@ -2,6 +2,7 @@\n // Licensed under the MIT License.\n package com.azure.communication.chat;\n \n+import com.azure.communication.chat.implementation.ChatThreadsImpl;", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU2MTE2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534561168", "bodyText": "threadClient => chatThreadClient\nIn general, Thread was considered too generic on the earlier reviews so we are following that convention across all sdks : prefix names with Chat when they refer to chat threads", "author": "juancamilor", "createdAt": "2020-12-02T23:50:53Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatThreadAsyncClient.java", "diffHunk": "@@ -50,11 +53,13 @@\n     private final ClientLogger logger = new ClientLogger(ChatThreadAsyncClient.class);\n \n     private final AzureCommunicationChatServiceImpl chatServiceClient;\n+    private final ChatThreadsImpl threadClient;", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU3OTUwMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534579500", "bodyText": "Here (and everywhere we do listParticipantsOptions.get...) we should have a null check on listParticipantsOptions\nCheck out the other methods that had pagination already, they should have null checks before invoking the threadClient with options", "author": "angiurgiu", "createdAt": "2020-12-03T00:40:16Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatThreadAsyncClient.java", "diffHunk": "@@ -270,12 +275,28 @@ public String getChatThreadId() {\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PagedFlux<ChatParticipant> listParticipants() {\n+        ListParticipantsOptions listParticipantsOptions = new ListParticipantsOptions();\n+        return listParticipants(listParticipantsOptions);\n+    }\n+\n+    /**\n+     * Gets the participants of a thread.\n+     *\n+     * @param listParticipantsOptions The request options.\n+     * @return the participants of a thread.\n+     */\n+    @ServiceMethod(returns = ReturnType.COLLECTION)\n+    public PagedFlux<ChatParticipant> listParticipants(ListParticipantsOptions listParticipantsOptions) {\n         try {\n             return pagedFluxConvert(new PagedFlux<>(\n                 () -> withContext(context ->\n-                    this.chatServiceClient.listChatParticipantsSinglePageAsync(chatThreadId, context)),\n+                    this.threadClient.listChatParticipantsSinglePageAsync(\n+                        chatThreadId,\n+                        listParticipantsOptions.getMaxPageSize(),", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU3OTk3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534579971", "bodyText": "Same comment, take precautions against NullReferenceExceptions", "author": "angiurgiu", "createdAt": "2020-12-03T00:41:30Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/ChatThreadAsyncClient.java", "diffHunk": "@@ -697,11 +734,26 @@ public String getChatThreadId() {\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PagedFlux<ChatMessageReadReceipt> listReadReceipts() {\n+        ListReadReceiptOptions listReadReceiptOptions = new ListReadReceiptOptions();\n+        return listReadReceipts(listReadReceiptOptions);\n+    }\n+\n+    /**\n+     * Gets read receipts for a thread.\n+     *\n+     * @param listReadReceiptOptions The additional options for this operation.\n+     * @return read receipts for a thread.\n+     */\n+    @ServiceMethod(returns = ReturnType.COLLECTION)\n+    public PagedFlux<ChatMessageReadReceipt> listReadReceipts(ListReadReceiptOptions listReadReceiptOptions) {", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDU4MDcxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17910#discussion_r534580719", "bodyText": "Id instead of ID", "author": "angiurgiu", "createdAt": "2020-12-03T00:43:33Z", "path": "sdk/communication/azure-communication-chat/src/main/java/com/azure/communication/chat/models/CreateChatThreadOptions.java", "diffHunk": "@@ -22,6 +22,8 @@\n     @JsonProperty(value = \"participants\", required = true)\n     private List<ChatParticipant> participants;\n \n+    private String repeatabilityRequestID;", "originalCommit": "d922581c16f3d56a7a8e74ef0a469cc9fb65a8c9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "12cdfcc12153f3a54b72b48e47e0b81ea9bce37c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/12cdfcc12153f3a54b72b48e47e0b81ea9bce37c", "message": "pr feedback", "committedDate": "2020-12-03T22:59:23Z", "type": "commit"}]}