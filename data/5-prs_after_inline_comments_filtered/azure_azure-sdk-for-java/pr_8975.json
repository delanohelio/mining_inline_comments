{"pr_number": 8975, "pr_title": "Replace HttpBin Usage with WireMock", "pr_createdAt": "2020-03-11T17:06:39Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8975", "timeline": [{"oid": "304a1598abda8b5ff6552a812fde89592702c3e5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/304a1598abda8b5ff6552a812fde89592702c3e5", "message": "Cleanup RestProxyTests", "committedDate": "2020-03-06T00:44:20Z", "type": "commit"}, {"oid": "16ef0d1209452c6310efdcc1800d942d5af60b65", "url": "https://github.com/Azure/azure-sdk-for-java/commit/16ef0d1209452c6310efdcc1800d942d5af60b65", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-07T00:25:22Z", "type": "commit"}, {"oid": "278b2d98599ae1aa20b22ea94b34dd5a670f69b3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/278b2d98599ae1aa20b22ea94b34dd5a670f69b3", "message": "Prototype of WireMock server", "committedDate": "2020-03-10T17:47:03Z", "type": "commit"}, {"oid": "c1b8d75150c41709540785fa13f569be8aabc944", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c1b8d75150c41709540785fa13f569be8aabc944", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-10T20:06:24Z", "type": "commit"}, {"oid": "0d336cd6949198378eab4654bb03df67352be0e5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d336cd6949198378eab4654bb03df67352be0e5", "message": "Prototype with ResponseDefinitionTransformer", "committedDate": "2020-03-10T22:34:11Z", "type": "commit"}, {"oid": "599fda57fad60c7c29f21019f7326aad247699d1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/599fda57fad60c7c29f21019f7326aad247699d1", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-10T22:45:01Z", "type": "commit"}, {"oid": "85c9e7be1fd6643d9f43866d626a89be457b15f5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/85c9e7be1fd6643d9f43866d626a89be457b15f5", "message": "Stubbed and fixed most HttpBin tests", "committedDate": "2020-03-11T01:48:40Z", "type": "commit"}, {"oid": "003556dd76bdc356638b45fce7d7a0260189edb5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/003556dd76bdc356638b45fce7d7a0260189edb5", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-11T16:52:29Z", "type": "commit"}, {"oid": "8f0dc93bdf4e928087e4db477bcfe84f0fa00f6b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f0dc93bdf4e928087e4db477bcfe84f0fa00f6b", "message": "Removed RestProxyStressTests, MockServer, and Jetty dependencies", "committedDate": "2020-03-11T18:01:44Z", "type": "commit"}, {"oid": "2d1c2fb343eb4c27876c9f39c82f024007ba9326", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d1c2fb343eb4c27876c9f39c82f024007ba9326", "message": "Fixing additional tests", "committedDate": "2020-03-11T20:58:11Z", "type": "commit"}, {"oid": "8292a893e478ce289f2d9b54fb4bbedb63dea297", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8292a893e478ce289f2d9b54fb4bbedb63dea297", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-11T21:59:21Z", "type": "commit"}, {"oid": "2bc56ab8a7c87dd73c0d12a7de34bb08665ca8b9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2bc56ab8a7c87dd73c0d12a7de34bb08665ca8b9", "message": "Change server startup and shutdown guards", "committedDate": "2020-03-11T22:04:40Z", "type": "commit"}, {"oid": "c942cff0646a2587e099eb81f48735e9cd878210", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c942cff0646a2587e099eb81f48735e9cd878210", "message": "Disambiguate test from WireMock stub", "committedDate": "2020-03-11T23:04:10Z", "type": "commit"}, {"oid": "1762ff5bd1a522e97448b69bcc842fdf4da793cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1762ff5bd1a522e97448b69bcc842fdf4da793cf", "message": "Additional test fixes for Linux", "committedDate": "2020-03-11T23:42:05Z", "type": "commit"}, {"oid": "826424305a0f4608de1e4298f2fea14191720288", "url": "https://github.com/Azure/azure-sdk-for-java/commit/826424305a0f4608de1e4298f2fea14191720288", "message": "Additional mocking changes in attempt to resolve Linux deadlocking issue", "committedDate": "2020-03-12T00:10:01Z", "type": "commit"}, {"oid": "3d70236f7dc078ab61735ecfbc5cc079e6e061ad", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3d70236f7dc078ab61735ecfbc5cc079e6e061ad", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-12T16:28:35Z", "type": "commit"}, {"oid": "4c8709462f0d6a0409d1418c71d7f5e572812cb1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4c8709462f0d6a0409d1418c71d7f5e572812cb1", "message": "Use WireMock dynamic port, cleaned up transformer code, added API to get port to RestProxyTests", "committedDate": "2020-03-12T17:43:32Z", "type": "commit"}, {"oid": "3f28bc783078a23883682725f55d983a7009ffa9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3f28bc783078a23883682725f55d983a7009ffa9", "message": "Fixed mock RestProxyTests", "committedDate": "2020-03-12T18:53:55Z", "type": "commit"}, {"oid": "a0974c13b1a386a780872e2a7e702a3a7b920cbd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/a0974c13b1a386a780872e2a7e702a3a7b920cbd", "message": "Merge branch 'master' into AzCore_ReplaceHttpBinJsonWithWireMock", "committedDate": "2020-03-12T22:45:11Z", "type": "commit"}, {"oid": "0872aa16eeda3cab3651482ac3a972252bdaecc7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0872aa16eeda3cab3651482ac3a972252bdaecc7", "message": "Fixed issue where Linux would deadlock on a test", "committedDate": "2020-03-12T22:46:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwOTMxNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8975#discussion_r392509315", "bodyText": "This is the same code in RestProxyWithHttpProxyNettyTests. Can you check if this can be de-duplicated?", "author": "srnagar", "createdAt": "2020-03-13T22:13:20Z", "path": "sdk/core/azure-core-http-netty/src/test/java/com/azure/core/http/netty/implementation/RestProxyWithNettyTests.java", "diffHunk": "@@ -4,12 +4,36 @@\n package com.azure.core.http.netty.implementation;\n \n import com.azure.core.http.HttpClient;\n+import com.azure.core.http.netty.NettyAsyncHttpClientBuilder;\n+import com.azure.core.test.RestProxyTestsWireMockServer;\n import com.azure.core.test.implementation.RestProxyTests;\n+import com.github.tomakehurst.wiremock.WireMockServer;\n+import org.junit.jupiter.api.AfterAll;\n+import org.junit.jupiter.api.BeforeAll;\n \n public class RestProxyWithNettyTests extends RestProxyTests {\n+    private static WireMockServer server;\n+\n+    @BeforeAll\n+    public static void getWireMockServer() {\n+        server = RestProxyTestsWireMockServer.getRestProxyTestsServer();\n+        server.start();\n+    }\n+\n+    @AfterAll\n+    public static void shutdownWireMockServer() {\n+        if (server != null) {\n+            server.shutdown();\n+        }\n+    }\n+\n+    @Override\n+    protected int getWireMockPort() {\n+        return server.port();\n+    }", "originalCommit": "0872aa16eeda3cab3651482ac3a972252bdaecc7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUxNTc0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8975#discussion_r392515749", "bodyText": "For now I will be keep these separate as I believe WireMock is capable of allowing proxying which we may want to take advantage of to final begin testing proxying.", "author": "alzimmermsft", "createdAt": "2020-03-13T22:38:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjUwOTMxNQ=="}], "type": "inlineReview"}]}