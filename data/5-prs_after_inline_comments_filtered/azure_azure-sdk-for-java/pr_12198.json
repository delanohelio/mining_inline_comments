{"pr_number": 12198, "pr_title": "API Changes for ORS", "pr_createdAt": "2020-06-15T17:16:31Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12198", "timeline": [{"oid": "1c82c357757e9edc220710e2a8912df90b8b90be", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1c82c357757e9edc220710e2a8912df90b8b90be", "message": "ObjectReplication API changes", "committedDate": "2020-06-15T17:14:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzExMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440327113", "bodyText": "Should I be more explicit with source in the name?", "author": "gapra-msft", "createdAt": "2020-06-15T17:17:00Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/BlobDownloadHeaders.java", "diffHunk": "@@ -24,7 +27,7 @@\n      * Instantiates an empty {@code BlobDownloadHeaders}.\n      */\n     public BlobDownloadHeaders() {\n-        objectReplicationSourcePolicies = null;\n+        objectReplicationPolicies = null;", "originalCommit": "1c82c357757e9edc220710e2a8912df90b8b90be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMjQ3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440332473", "bodyText": "Maybe objectReplicationSourceProperties? Since there's already another variable to hold the destination policy header if we get back the OR info of a destination blob.", "author": "amnguye", "createdAt": "2020-06-15T17:26:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzExMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNjQ0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440336443", "bodyText": "changed to ORSourcePOlicies", "author": "gapra-msft", "createdAt": "2020-06-15T17:33:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzExMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMyNzgzMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440327832", "bodyText": "TODO : delete", "author": "gapra-msft", "createdAt": "2020-06-15T17:18:19Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/BlobProperties.java", "diffHunk": "@@ -50,7 +52,8 @@\n     private final Long tagCount;\n     private final String versionId;\n     private final Boolean isCurrentVersion;\n-    private final Map<String, ObjectReplicationPolicy> objectReplicationSourcePolicies;\n+    private final List<ObjectReplicationPolicy> objectReplicationPolicies;\n+//    private final Map<String, ObjectReplicationPolicy> objectReplicationSourcePolicies;", "originalCommit": "1c82c357757e9edc220710e2a8912df90b8b90be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b040d4c433d380d083b3cb556d92236e2679c234", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b040d4c433d380d083b3cb556d92236e2679c234", "message": "Added back imports", "committedDate": "2020-06-15T17:30:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMzQ0Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440333446", "bodyText": "We should accept list of rules as constructor parameter as well, so that this is fully functional after construction (avoid multi-step init).\nIf we're aiming to make this class immutable we should clone the list (https://stackoverflow.com/questions/6137224/immutable-object-with-arraylist-member-variable-why-can-this-variable-be-chang )", "author": "kasobol-msft", "createdAt": "2020-06-15T17:28:19Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/ObjectReplicationPolicy.java", "diffHunk": "@@ -3,24 +3,24 @@\n \n package com.azure.storage.blob.models;\n \n-import java.util.HashMap;\n-import java.util.Map;\n+import java.util.ArrayList;\n+import java.util.List;\n \n /**\n  * A type that contains information about an object replication policy on a source blob.\n  */\n public class ObjectReplicationPolicy {\n \n     private final String policyId;\n-    private final Map<String, String> ruleStatuses;\n+    private final List<ObjectReplicationRule> objectReplicationRules;\n \n     ObjectReplicationPolicy(String policyId) {\n         this.policyId = policyId;\n-        this.ruleStatuses = new HashMap<>();\n+        this.objectReplicationRules = new ArrayList<>();\n     }", "originalCommit": "1c82c357757e9edc220710e2a8912df90b8b90be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM0NzU4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440347581", "bodyText": "Should I make all the constructors public?", "author": "gapra-msft", "createdAt": "2020-06-15T17:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMzQ0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM0OTA1OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440349059", "bodyText": "Yes, customers should be able to create these types for test purposes. See BlobContainerAccessPolicies as an example (though that one isn't perfectly immutable...).", "author": "kasobol-msft", "createdAt": "2020-06-15T17:57:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzMzQ0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNDcwNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440334706", "bodyText": "By looking at usage I think we could simplify this and code that's using it by usage of stream api.\nhttps://stackoverflow.com/questions/23696317/find-first-element-by-predicate", "author": "kasobol-msft", "createdAt": "2020-06-15T17:30:32Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/ObjectReplicationPolicy.java", "diffHunk": "@@ -31,10 +31,20 @@ public String getPolicyId() {\n     }\n \n     /**\n-     * @return A {@code Map} of rules associated with this policy to the status of the replication associated with that\n+     * @return A {@code List} of rules associated with this policy to the status of the replication associated with that\n      * rule.\n      */\n-    public Map<String, String> getRules() {\n-        return this.ruleStatuses;\n+    public List<ObjectReplicationRule> getRules() {\n+        return this.objectReplicationRules;\n+    }\n+\n+    static int getIndexOfObjectReplicationPolicy(String policyId,\n+        List<ObjectReplicationPolicy> objectReplicationPolicies) {\n+        for (int i = 0; i < objectReplicationPolicies.size(); i++) {\n+            if (policyId.equals(objectReplicationPolicies.get(i).getPolicyId())) {\n+                return i;\n+            }\n+        }\n+        return -1;\n     }", "originalCommit": "1c82c357757e9edc220710e2a8912df90b8b90be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDMzNTI0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12198#discussion_r440335241", "bodyText": "same here.", "author": "kasobol-msft", "createdAt": "2020-06-15T17:31:36Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/models/ObjectReplicationRule.java", "diffHunk": "@@ -0,0 +1,45 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.storage.blob.models;\n+\n+import java.util.List;\n+\n+/**\n+ * A type that contains information about an object replication rule on a source blob.\n+ */\n+public class ObjectReplicationRule {\n+\n+    private final String ruleId;\n+    private final ObjectReplicationStatus status;\n+\n+\n+    ObjectReplicationRule(String ruleId, ObjectReplicationStatus status) {\n+        this.ruleId = ruleId;\n+        this.status = status;\n+    }\n+\n+    /**\n+     * @return The rule id.\n+     */\n+    public String getRuleId() {\n+        return ruleId;\n+    }\n+\n+    /**\n+     * @return The {@link ObjectReplicationStatus}\n+     */\n+    public ObjectReplicationStatus getStatus() {\n+        return status;\n+    }\n+\n+    static int getIndexOfObjectReplicationRule(String ruleId,", "originalCommit": "1c82c357757e9edc220710e2a8912df90b8b90be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5e5a0c0ac0bcdfc7d858e304bfb983faea9ce7f2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5e5a0c0ac0bcdfc7d858e304bfb983faea9ce7f2", "message": "rename to source", "committedDate": "2020-06-15T17:33:23Z", "type": "commit"}, {"oid": "4541da5b8939978feb8d8f6c7e4f03618c749fed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4541da5b8939978feb8d8f6c7e4f03618c749fed", "message": "Added more gt status", "committedDate": "2020-06-15T17:55:59Z", "type": "commit"}, {"oid": "28d31ae8c597430b6fb5de6448b4259a2457469a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/28d31ae8c597430b6fb5de6448b4259a2457469a", "message": "Added docs to constructors", "committedDate": "2020-06-15T17:56:17Z", "type": "commit"}, {"oid": "e992693067c4fb5983bda827412fa5087844bf45", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e992693067c4fb5983bda827412fa5087844bf45", "message": "Analyze", "committedDate": "2020-06-15T17:57:35Z", "type": "commit"}, {"oid": "b9139c81af417bc1224376285ce0a4a54b2e0be5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9139c81af417bc1224376285ce0a4a54b2e0be5", "message": "Added back imports", "committedDate": "2020-06-15T17:58:50Z", "type": "commit"}, {"oid": "800265a3707af650ef1bf0d051432b3e6c3e1e64", "url": "https://github.com/Azure/azure-sdk-for-java/commit/800265a3707af650ef1bf0d051432b3e6c3e1e64", "message": "Added collection", "committedDate": "2020-06-15T18:27:41Z", "type": "commit"}, {"oid": "3be1baa0afc4584ad36e033ea1b9ff07e75feb08", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3be1baa0afc4584ad36e033ea1b9ff07e75feb08", "message": "Made immutable", "committedDate": "2020-06-15T19:04:10Z", "type": "commit"}, {"oid": "6ce9d5c21eebe73a928a781f81d49f86d889a02e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ce9d5c21eebe73a928a781f81d49f86d889a02e", "message": "fixed imports", "committedDate": "2020-06-15T19:07:52Z", "type": "commit"}, {"oid": "95ae9bb28421637baf24fd7256c67e1da2874d09", "url": "https://github.com/Azure/azure-sdk-for-java/commit/95ae9bb28421637baf24fd7256c67e1da2874d09", "message": "analyze fix", "committedDate": "2020-06-15T19:37:17Z", "type": "commit"}]}