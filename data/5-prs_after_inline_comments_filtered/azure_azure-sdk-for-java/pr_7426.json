{"pr_number": 7426, "pr_title": "Added client side checks for account set props", "pr_createdAt": "2020-01-14T22:54:13Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7426", "timeline": [{"oid": "de9974f034ca083e49798140d0b777baee535ac3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/de9974f034ca083e49798140d0b777baee535ac3", "message": "Added checks for account set props", "committedDate": "2020-01-14T22:53:48Z", "type": "commit"}, {"oid": "8940b340ad0b96369f45e23aeed0743b65461e90", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8940b340ad0b96369f45e23aeed0743b65461e90", "message": "Fixed checkstyle", "committedDate": "2020-01-14T23:26:04Z", "type": "commit"}, {"oid": "d038f392ee606782c3caea6620de096716d809a7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d038f392ee606782c3caea6620de096716d809a7", "message": "Added more checks and test recording", "committedDate": "2020-01-15T17:44:41Z", "type": "commit"}, {"oid": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92", "url": "https://github.com/Azure/azure-sdk-for-java/commit/aef2bf8376b605c1b57dfd462a7dba9bc1210f92", "message": "test Recordings", "committedDate": "2020-01-15T18:00:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzAzMzAzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7426#discussion_r367033030", "bodyText": "Can you leave a comment that mentions that the service requires these fields not be null so we change null to empty string?", "author": "rickle-msft", "createdAt": "2020-01-15T18:21:42Z", "path": "sdk/storage/azure-storage-blob/src/main/java/com/azure/storage/blob/BlobServiceAsyncClient.java", "diffHunk": "@@ -391,10 +395,89 @@ public String getAccountUrl() {\n     }\n \n     Mono<Response<Void>> setPropertiesWithResponse(BlobServiceProperties properties, Context context) {\n-        return this.azureBlobStorage.services().setPropertiesWithRestResponseAsync(properties, null, null, context)\n+        BlobServiceProperties finalProperties = null;\n+        if (properties != null) {\n+            finalProperties = new BlobServiceProperties();\n+\n+            // Logging\n+            finalProperties.setLogging(properties.getLogging());\n+            if (finalProperties.getLogging() != null) {\n+                StorageImplUtils.assertNotNull(\"Logging Version\", finalProperties.getLogging().getVersion());\n+                validateRetentionPolicy(finalProperties.getLogging().getRetentionPolicy(), \"Logging Retention Policy\");\n+            }\n+\n+            // Hour Metrics\n+            finalProperties.setHourMetrics(properties.getHourMetrics());\n+            if (finalProperties.getHourMetrics() != null) {\n+                StorageImplUtils.assertNotNull(\"HourMetrics Version\", finalProperties.getHourMetrics().getVersion());\n+                validateRetentionPolicy(finalProperties.getHourMetrics().getRetentionPolicy(), \"HourMetrics Retention \"\n+                    + \"Policy\");\n+                if (finalProperties.getHourMetrics().isEnabled()) {\n+                    StorageImplUtils.assertNotNull(\"HourMetrics IncludeApis\",\n+                        finalProperties.getHourMetrics().isIncludeApis());\n+                }\n+            }\n+\n+            // Minute Metrics\n+            finalProperties.setMinuteMetrics(properties.getMinuteMetrics());\n+            if (finalProperties.getMinuteMetrics() != null) {\n+                StorageImplUtils.assertNotNull(\"MinuteMetrics Version\",\n+                    finalProperties.getMinuteMetrics().getVersion());\n+                validateRetentionPolicy(finalProperties.getMinuteMetrics().getRetentionPolicy(), \"MinuteMetrics \"\n+                    + \"Retention Policy\");\n+                if (finalProperties.getMinuteMetrics().isEnabled()) {\n+                    StorageImplUtils.assertNotNull(\"MinuteMetrics IncludeApis\",\n+                        finalProperties.getHourMetrics().isIncludeApis());\n+                }\n+            }\n+\n+            // CORS\n+            if (properties.getCors() != null) {\n+                List<BlobCorsRule> corsRules = new ArrayList<>();\n+                for (BlobCorsRule rule : properties.getCors()) {\n+                    corsRules.add(validatedCorsRule(rule));\n+                }\n+                finalProperties.setCors(corsRules);\n+            }\n+\n+            // Default Service Version\n+            finalProperties.setDefaultServiceVersion(properties.getDefaultServiceVersion());\n+\n+            // Delete Retention Policy\n+            finalProperties.setDeleteRetentionPolicy(properties.getDeleteRetentionPolicy());\n+            validateRetentionPolicy(finalProperties.getDeleteRetentionPolicy(), \"DeleteRetentionPolicy Days\");\n+\n+            // Static Website\n+            finalProperties.setStaticWebsite(properties.getStaticWebsite());\n+\n+        }\n+\n+        return this.azureBlobStorage.services().setPropertiesWithRestResponseAsync(finalProperties, null, null, context)\n             .map(response -> new SimpleResponse<>(response, null));\n     }\n \n+    private BlobCorsRule validatedCorsRule(BlobCorsRule originalRule) {", "originalCommit": "aef2bf8376b605c1b57dfd462a7dba9bc1210f92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b4838185a1dcf3fc7283df89fb265e85f24bac6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3b4838185a1dcf3fc7283df89fb265e85f24bac6", "message": "Added comments to test and private methods", "committedDate": "2020-01-15T18:27:01Z", "type": "commit"}, {"oid": "ef5e21f49d72cf485cca2e69e62c3eb434ecd88c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ef5e21f49d72cf485cca2e69e62c3eb434ecd88c", "message": "Merge branch 'master' into storage/accountSetProps", "committedDate": "2020-01-15T19:20:36Z", "type": "commit"}, {"oid": "75739f8c80924e6f5f022f7888e8f4b8b692c00e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/75739f8c80924e6f5f022f7888e8f4b8b692c00e", "message": "Added javadoc and Changelog", "committedDate": "2020-01-15T20:43:55Z", "type": "commit"}]}