{"pr_number": 17779, "pr_title": "Updating samples", "pr_createdAt": "2020-11-24T03:11:56Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17779", "timeline": [{"oid": "7ecc2489aca4d442786157930857195d51df2766", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7ecc2489aca4d442786157930857195d51df2766", "message": "Updating samples with autocomplete.", "committedDate": "2020-11-24T02:27:49Z", "type": "commit"}, {"oid": "91fb7b0f2c5b59dc712a7334af7e76a4c215eb39", "url": "https://github.com/Azure/azure-sdk-for-java/commit/91fb7b0f2c5b59dc712a7334af7e76a4c215eb39", "message": "Updating samples.", "committedDate": "2020-11-24T02:49:16Z", "type": "commit"}, {"oid": "6b098423f8156e0ec6e64e266a173a3f0e1dd639", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6b098423f8156e0ec6e64e266a173a3f0e1dd639", "message": "Updating documentation", "committedDate": "2020-11-24T02:51:41Z", "type": "commit"}, {"oid": "90c7aeb9a8ab46ab095c950bd41d3adbcabef2e7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/90c7aeb9a8ab46ab095c950bd41d3adbcabef2e7", "message": "Fixing checkstyles.", "committedDate": "2020-11-24T02:59:09Z", "type": "commit"}, {"oid": "fadef9ad1a02b3741ba3d00d4f9030f3bbdfaea7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fadef9ad1a02b3741ba3d00d4f9030f3bbdfaea7", "message": "Clean up README.md", "committedDate": "2020-11-24T03:10:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgxNTEwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17779#discussion_r529815107", "bodyText": "One of the need for acceptSession() API  was to show user that it can fail. if session does not get accepted they need to do something? Either go to next session or have some code to log message about it.", "author": "hemanttanwar", "createdAt": "2020-11-24T19:09:25Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReceiveSingleSessionAsyncSample.java", "diffHunk": "@@ -40,14 +40,22 @@ public static void main(String[] args) throws InterruptedException {\n             .subscriptionName(\"<<subscription-name>>\")\n             .buildAsyncClient();\n \n+        // Receiving messages from the first available sessions. It waits up to the AmqpRetryOptions.getTryTimeout().\n+        // If no session is available within that operation timeout, it completes with an error. Otherwise, a receiver\n+        // is returned when a lock on the session is acquired.\n         Mono<ServiceBusReceiverAsyncClient> receiverMono = sessionReceiver.acceptNextSession();\n-        Disposable subscription = receiverMono.flatMapMany(receiver -> receiver.receiveMessages()\n-            .flatMap(message -> {\n-                System.out.println(\"Processing message from session: \" + message.getSessionId());\n ", "originalCommit": "fadef9ad1a02b3741ba3d00d4f9030f3bbdfaea7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTg0NDE0OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17779#discussion_r529844148", "bodyText": "It'll propagate it downstream into the subscriber. So it'll be handled by the onError.", "author": "conniey", "createdAt": "2020-11-24T20:01:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgxNTEwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgyMDU0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17779#discussion_r529820544", "bodyText": "Does this receiver gets close() , So that builder close the connection.", "author": "hemanttanwar", "createdAt": "2020-11-24T19:19:17Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReceiveNamedSessionAsyncSample.java", "diffHunk": "@@ -40,17 +40,24 @@ public static void main(String[] args) throws InterruptedException {\n             .queueName(\"<<queue-name>>\")\n             .buildAsyncClient();\n \n-        Mono<ServiceBusReceiverAsyncClient> receiverMono = sessionReceiver.acceptSession(\"greetings\");\n-        Disposable subscription = receiverMono.flatMapMany(receiver -> receiver.receiveMessages()\n-            .flatMap(message -> {\n+        // Receiving messages that have the sessionId \"greetings-id\" set. This can be set via\n+        // ServiceBusMessage.setMessageId(String) when sending a message.\n \n-                System.out.println(\"Processing message from session: \" + message.getSessionId());\n+        // The Mono completes successfully when a lock on the session is acquired, otherwise, it completes with an\n+        // error.\n+        Mono<ServiceBusReceiverAsyncClient> receiverMono = sessionReceiver.acceptSession(\"greetings-id\");\n \n-                // Process message then complete it.\n-                //return receiver.complete(context.getMessage());\n-                return Mono.empty();\n-            }))\n-            .subscribe(aVoid -> {\n+        // If the session is successfully accepted, begin receiving messages from it.\n+        Disposable subscription = receiverMono.flatMapMany(receiver -> receiver.receiveMessages())\n+            .subscribe(message -> {", "originalCommit": "fadef9ad1a02b3741ba3d00d4f9030f3bbdfaea7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgyODk5OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17779#discussion_r529828999", "bodyText": "this should be closed as well", "author": "hemanttanwar", "createdAt": "2020-11-24T19:34:01Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ReceiveNamedSessionSample.java", "diffHunk": "@@ -44,15 +44,21 @@ public static void main(String[] args) {\n             .sessionReceiver()\n             .queueName(\"<<queue-name>>\")\n             .buildClient();\n-        ServiceBusReceiverClient receiver = sessionReceiver.acceptSession(\"greetings\");\n+\n+        // Receiving messages that have the sessionId \"greetings-id\" set. This can be set via\n+        // ServiceBusMessage.setMessageId(String) when sending a message.\n+\n+        // A receiver is returned when a lock on the session is acquired, otherwise, it throws an exception.\n+        ServiceBusReceiverClient receiver = sessionReceiver.acceptSession(\"greetings-id\");", "originalCommit": "fadef9ad1a02b3741ba3d00d4f9030f3bbdfaea7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTgzMDk3Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17779#discussion_r529830976", "bodyText": "There is sessionReceiver few lines above, this is not needed here.", "author": "hemanttanwar", "createdAt": "2020-11-24T19:37:40Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/SendSessionMessageAsyncSample.java", "diffHunk": "@@ -56,40 +55,21 @@ public static void main(String[] args) throws InterruptedException {\n             .queueName(queueName)\n             .buildAsyncClient();\n \n+        // Setting the sessionId parameter ensures all messages end up in the same session and are received in order.", "originalCommit": "fadef9ad1a02b3741ba3d00d4f9030f3bbdfaea7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "804a6a706731d35d6b1b7174b7d62fe5c31b9869", "url": "https://github.com/Azure/azure-sdk-for-java/commit/804a6a706731d35d6b1b7174b7d62fe5c31b9869", "message": "Fixing documentation and dispose of resources.", "committedDate": "2020-11-24T20:18:00Z", "type": "commit"}, {"oid": "ea6dae65d52889603f458f37171ab0003dd4e8d0", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ea6dae65d52889603f458f37171ab0003dd4e8d0", "message": "Fixing comments", "committedDate": "2020-11-24T20:21:13Z", "type": "commit"}]}