{"pr_number": 9322, "pr_title": "Form Recognizer initial repo setup", "pr_createdAt": "2020-03-20T10:15:03Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9322", "timeline": [{"oid": "e101edc0a488799d368d0538cd038840ba7e74ed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e101edc0a488799d368d0538cd038840ba7e74ed", "message": "receipt endpoints working", "committedDate": "2020-03-20T10:19:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2NzkwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r395867907", "bodyText": "Per our conversation today, we will likely split this into multiple clients going forward.  We decided it's ok to diverge for the Preview 1 release.", "author": "annelo-msft", "createdAt": "2020-03-20T20:12:30Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,56 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * <p><strong>Instantiating a synchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder this} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {", "originalCommit": "e101edc0a488799d368d0538cd038840ba7e74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTg2ODU5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r395868592", "bodyText": "Current FR version is v2.0-preview", "author": "annelo-msft", "createdAt": "2020-03-20T20:14:05Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerServiceVersion.java", "diffHunk": "@@ -0,0 +1,37 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.core.util.ServiceVersion;\n+\n+/**\n+ * The versions of Azure Form Recognizer supported by this client library.\n+ */\n+public enum FormRecognizerServiceVersion implements ServiceVersion {\n+    V3_0_preview_1(\"v3.0-preview.1\");", "originalCommit": "e101edc0a488799d368d0538cd038840ba7e74ed", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "url": "https://github.com/Azure/azure-sdk-for-java/commit/dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "message": "raw ocr and field value update", "committedDate": "2020-03-25T07:35:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDI4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398250283", "bodyText": "If pollInterval and includeTextDetails are optional, we should have an overload without these 2 args. beginExtractReceipt(String sourceUrl).", "author": "srnagar", "createdAt": "2020-03-26T00:28:18Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,215 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerAsyncClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>> beginExtractReceipt(String sourceUrl,\n+                                                                                              boolean includeTextDetails,\n+                                                                                              Duration pollInterval) {", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MTQxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398251414", "bodyText": "Is it worth creating a custom type like FormRecognizerPollerFlux<T> extends PollerFlux<OperationResult, IterableStream<T>>?\n@JonathanGiles", "author": "srnagar", "createdAt": "2020-03-26T00:32:25Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,215 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerAsyncClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>> beginExtractReceipt(String sourceUrl,\n+                                                                                              boolean includeTextDetails,\n+                                                                                              Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult());\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkxMDY4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r399910685", "bodyText": "I think the existing API is within the bounds of reasonableness.", "author": "JonathanGiles", "createdAt": "2020-03-30T03:37:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MTQxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjExMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398252113", "bodyText": "Is the length of Flux always known?", "author": "srnagar", "createdAt": "2020-03-26T00:35:00Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,215 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerAsyncClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>> beginExtractReceipt(String sourceUrl,\n+                                                                                              boolean includeTextDetails,\n+                                                                                              Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult());\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>\n+    beginExtractReceipt(Flux<ByteBuffer> data, long length, boolean includeTextDetails, FormContentType formContentType,", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxMzI0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r399413249", "bodyText": "It should be known as the service expects it here", "author": "samvaity", "createdAt": "2020-03-27T17:04:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MjExMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MzM5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398253392", "bodyText": "receiptAnalyzeActivationOperation and receiptStreamActivationOperation are identical. Consider reducing these into a single method.", "author": "srnagar", "createdAt": "2020-03-26T00:39:32Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,215 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerAsyncClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>> beginExtractReceipt(String sourceUrl,\n+                                                                                              boolean includeTextDetails,\n+                                                                                              Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult());\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>\n+    beginExtractReceipt(Flux<ByteBuffer> data, long length, boolean includeTextDetails, FormContentType formContentType,\n+                        Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>(interval,\n+            receiptStreamActivationOperation(data, length, formContentType, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult());\n+    }\n+\n+    private Function<PollingContext<OperationResult>, Mono<OperationResult>> receiptAnalyzeActivationOperation(", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyNTIxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400425214", "bodyText": "Not sure, if we should. They individually hit different endpoints and it would be better maintainable this way.", "author": "samvaity", "createdAt": "2020-03-30T19:03:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MzM5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU4OTAyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398589028", "bodyText": "Sync APIs should have Context arg", "author": "srnagar", "createdAt": "2020-03-26T13:53:07Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,86 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * <p><strong>Instantiating a synchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder this} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {\n+    private final FormRecognizerAsyncClient client;\n+\n+    /**\n+     * Create a {@code FormRecognizerClient client} that sends requests to the Form Recognizer service's endpoint.\n+     * Each service call goes through the {@link FormRecognizerClientBuilder#pipeline http pipeline}.\n+     *\n+     * @param client The {@link FormRecognizerClient} that the client routes its request through.\n+     */\n+    FormRecognizerClient(FormRecognizerAsyncClient client) {\n+        this.client = client;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ReceiptPageResult>> beginExtractReceipt(String sourceUrl,", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODkzMjEzMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398932133", "bodyText": "Could it be related to the auto rest issue we discussed here - Azure/autorest.java#560", "author": "samvaity", "createdAt": "2020-03-26T22:32:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU4OTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5MDU1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401990554", "bodyText": "Updating sync API's in #9763", "author": "samvaity", "createdAt": "2020-04-02T00:43:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU4OTAyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU5NzI3MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398597271", "bodyText": "Does FormRecognizer not support connectionString?", "author": "srnagar", "createdAt": "2020-03-26T14:03:51Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,354 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.ApiKeyCredentialPolicy;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.ai.formrecognizer.models.FormRecognizerApiKeyCredential;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.TokenCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.BearerTokenAuthenticationPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(FormRecognizerApiKeyCredential) apiKey(FormRecognizerApiKeyCredential)} or\n+ * {@link #credential(TokenCredential) credential(TokenCredential)} give the builder access credential.\n+ * </p>\n+ * TODO: add code snippets\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER = \"Content-Type\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = \"application/json\";\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String TEXT_ANALYTICS_PROPERTIES = \"azure-ai-textanalytics.properties\";\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+    private static final String DEFAULT_SCOPE = \"https://cognitiveservices.azure.com/.default\";\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private FormRecognizerApiKeyCredential credential;\n+    private TokenCredential tokenCredential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(TEXT_ANALYTICS_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(FormRecognizerApiKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(FormRecognizerApiKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");\n+\n+        HttpPipeline pipeline = httpPipeline;\n+        // Create a default Pipeline if it is not given\n+        if (pipeline == null) {\n+            // Closest to API goes first, closest to wire goes last.\n+            final List<HttpPipelinePolicy> policies = new ArrayList<>();\n+\n+            // Authentications\n+            if (tokenCredential != null) {\n+                // User token based policy\n+                policies.add(new BearerTokenAuthenticationPolicy(tokenCredential, DEFAULT_SCOPE));\n+            } else if (credential != null) {\n+                policies.add(new ApiKeyCredentialPolicy(credential));\n+            } else {\n+                // Throw exception that credential and tokenCredential cannot be null\n+                throw logger.logExceptionAsError(\n+                    new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+            }\n+\n+            policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion,\n+                buildConfiguration));\n+            policies.add(new RequestIdPolicy());\n+            policies.add(new AddHeadersPolicy(headers));\n+            policies.add(new AddDatePolicy());\n+\n+            HttpPolicyProviders.addBeforeRetryPolicies(policies);\n+            policies.add(retryPolicy == null ? DEFAULT_RETRY_POLICY : retryPolicy);\n+            policies.addAll(this.policies);\n+            HttpPolicyProviders.addAfterRetryPolicies(policies);\n+\n+            policies.add(new HttpLoggingPolicy(httpLogOptions));\n+\n+            pipeline = new HttpPipelineBuilder()\n+                .policies(policies.toArray(new HttpPipelinePolicy[0]))\n+                .httpClient(httpClient)\n+                .build();\n+        }\n+\n+        final FormRecognizerClientImpl formRecognizerAPI = new FormRecognizerClientImplBuilder()\n+            .endpoint(endpoint)\n+            .pipeline(pipeline)\n+            .build();\n+\n+        return new FormRecognizerAsyncClient(formRecognizerAPI, serviceVersion);\n+    }\n+\n+    /**\n+     * Sets the service endpoint for the Azure Form Recognizer instance.\n+     *\n+     * @param endpoint The URL of the Azure Form Recognizer instance service requests to and receive responses from.\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     * @throws NullPointerException if {@code endpoint} is null\n+     * @throws IllegalArgumentException if {@code endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClientBuilder endpoint(String endpoint) {\n+        Objects.requireNonNull(endpoint, \"'endpoint' cannot be null.\");\n+\n+        try {\n+            new URL(endpoint);\n+        } catch (MalformedURLException ex) {\n+            throw logger.logExceptionAsWarning(new IllegalArgumentException(\"'endpoint' must be a valid URL.\", ex));\n+        }\n+\n+        if (endpoint.endsWith(\"/\")) {\n+            this.endpoint = endpoint.substring(0, endpoint.length() - 1);\n+        } else {\n+            this.endpoint = endpoint;\n+        }\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the credential to use when authenticating HTTP requests for this FormRecognizerClientImplBuilder.\n+     *\n+     * @param apiKeyCredential API key credential\n+     *\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     * @throws NullPointerException If {@code apiKeyCredential} is {@code null}\n+     */\n+    public FormRecognizerClientBuilder apiKey(FormRecognizerApiKeyCredential apiKeyCredential) {\n+        this.credential = Objects.requireNonNull(apiKeyCredential, \"'apiKeyCredential' cannot be null.\");\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the {@link TokenCredential} used to authenticate HTTP requests.\n+     *\n+     * @param tokenCredential TokenCredential used to authenticate HTTP requests.\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     * @throws NullPointerException If {@code tokenCredential} is {@code null}.\n+     */\n+    public FormRecognizerClientBuilder credential(TokenCredential tokenCredential) {", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQwOTk4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r399409982", "bodyText": "Yes, similar to Text Analytics this doesn't have connection string authentication.\nAlso, currently, Form recognizer does not support AAD.", "author": "samvaity", "createdAt": "2020-03-27T16:59:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU5NzI3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODU5OTgyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398599826", "bodyText": "nit: private static final", "author": "srnagar", "createdAt": "2020-03-26T14:07:21Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,212 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageInfo;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {\n+    private final static ClientLogger LOGGER = new ClientLogger(Transforms.class);", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxMjAzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398612039", "bodyText": "Can this be moved to implementation package?", "author": "srnagar", "createdAt": "2020-03-26T14:23:19Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Utility.java", "diffHunk": "@@ -0,0 +1,51 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+\n+/**\n+ * Utility method class.\n+ */\n+public class Utility {", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxNTg1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398615852", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * Defines values for LengthUnit.\n          \n          \n            \n             * Defines values for DimensionUnit.", "author": "srnagar", "createdAt": "2020-03-26T14:28:04Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/DimensionUnit.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+// Code generated by Microsoft (R) AutoRest Code Generator.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.util.ExpandableStringEnum;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+\n+import java.util.Collection;\n+\n+/**\n+ * Defines values for LengthUnit.", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxNjU4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398616581", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @return the parsed LengthUnit object, or null if unable to parse.\n          \n          \n            \n                 * @return the parsed DimensionUnit object, or null if unable to parse.", "author": "srnagar", "createdAt": "2020-03-26T14:28:55Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/DimensionUnit.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+// Code generated by Microsoft (R) AutoRest Code Generator.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.util.ExpandableStringEnum;\n+import com.fasterxml.jackson.annotation.JsonCreator;\n+\n+import java.util.Collection;\n+\n+/**\n+ * Defines values for LengthUnit.\n+ */\n+public final class DimensionUnit extends ExpandableStringEnum<DimensionUnit> {\n+    /**\n+     * Static value en for Language.\n+     */\n+    public static final DimensionUnit PIXEL = fromString(\"pixel\");\n+\n+    /**\n+     * Static value en for Language.\n+     */\n+    public static final DimensionUnit INCH = fromString(\"inch\");\n+\n+    /**\n+     * Parses a serialized value to a {@code DimensionUnit} instance.\n+     *\n+     * @param value the serialized value to parse.\n+     * @return the parsed LengthUnit object, or null if unable to parse.", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTAxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398619010", "bodyText": "Is this the only model class in public package that's generated by autorest?", "author": "srnagar", "createdAt": "2020-03-26T14:32:00Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/ElementType.java", "diffHunk": "@@ -0,0 +1,37 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+// Code generated by Microsoft (R) AutoRest Code Generator.", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTQxMTE3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r399411177", "bodyText": "This was copied over from the implementation class, removed the comment.", "author": "samvaity", "createdAt": "2020-03-27T17:01:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYxOTAxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMzE4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398623189", "bodyText": "You can now use AzureKeyCredential in azure-core instead of defining custom key credential.", "author": "srnagar", "createdAt": "2020-03-26T14:37:28Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/FormRecognizerApiKeyCredential.java", "diffHunk": "@@ -0,0 +1,51 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Objects;\n+\n+/**\n+ * API key credential that shared across cognitive services, or restrict to single service.\n+ *\n+ * <p>Be able to rotate an existing API key</p>\n+ * {@codesnippet com.azure.ai.formrecognizer.models.FormRecognizerApiKeyCredential}\n+ *\n+ */\n+public final class FormRecognizerApiKeyCredential {", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyNTQ5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400425493", "bodyText": "Updated to use AzureKeyCredential", "author": "samvaity", "createdAt": "2020-03-30T19:04:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMzE4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyNDQ5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398624496", "bodyText": "missing javadoc.", "author": "srnagar", "createdAt": "2020-03-26T14:39:08Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/ReceiptType.java", "diffHunk": "@@ -0,0 +1,47 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ *", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyNDgwMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398624800", "bodyText": "javadoc missing for this class.", "author": "srnagar", "createdAt": "2020-03-26T14:39:32Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/ReceiptPageResult.java", "diffHunk": "@@ -0,0 +1,146 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Fluent;\n+\n+import java.util.List;\n+\n+@Fluent\n+public class ReceiptPageResult {", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyNTM1OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398625359", "bodyText": "Javadoc missing for these methods. Also, look at other model classes in public package to ensure all of them have javadocs.", "author": "srnagar", "createdAt": "2020-03-26T14:40:15Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/StringValue.java", "diffHunk": "@@ -0,0 +1,49 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import java.util.List;\n+\n+/**\n+ * Class to represent the Float value for\n+ * {@link com.azure.ai.formrecognizer.implementation.models.FieldValue#getValueString()}\n+ */\n+public class StringValue extends FieldValue<String> {\n+    /*\n+     * String value.\n+     */\n+    private String valueString;\n+\n+    /**\n+     * Constructs a StringValue.\n+     *\n+     * @param text The text content of the extracted field.\n+     * @param boundingBox Bounding box of the field value.\n+     * @param valueString String value.\n+     */\n+    public StringValue(String text, BoundingBox boundingBox, String valueString) {\n+        super(text, boundingBox);\n+        this.valueString = valueString;\n+    }\n+\n+    @Override\n+    public String getValue() {\n+        return this.valueString;\n+    }\n+\n+    @Override\n+    public void setValue(String value) {\n+        this.valueString = value;\n+    }\n+\n+    @Override\n+    public List<Element> getElements() {\n+        return super.getElements();\n+    }\n+\n+    @Override\n+    public Float getConfidence() {\n+        return super.getConfidence();", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyNzI2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398627266", "bodyText": "The directory name for all sample Java files is incorrect.\n/src/samples/java/com.azure.ai.formrecognizer/ExtractPrebuiltReceiptAsync.java", "author": "srnagar", "createdAt": "2020-03-26T14:42:44Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/samples/java/com.azure.ai.formrecognizer/ExtractPrebuiltReceiptAsync.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyOTAzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r398629036", "bodyText": "nit: fix formatting in both sync and async client classes.", "author": "srnagar", "createdAt": "2020-03-26T14:45:04Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,215 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.ai.formrecognizer.models.ReceiptPageResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerAsyncClient.instantiation}\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>> beginExtractReceipt(String sourceUrl,\n+                                                                                              boolean includeTextDetails,\n+                                                                                              Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult());\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>\n+    beginExtractReceipt(Flux<ByteBuffer> data, long length, boolean includeTextDetails, FormContentType formContentType,\n+                        Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ReceiptPageResult>>(interval,\n+            receiptStreamActivationOperation(data, length, formContentType, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult());\n+    }\n+\n+    private Function<PollingContext<OperationResult>, Mono<OperationResult>> receiptAnalyzeActivationOperation(\n+        String sourceUrl, boolean includeTextDetails) {\n+        return (pollingContext) -> {\n+            try {\n+                return service.analyzeReceiptAsyncWithResponseAsync(includeTextDetails,\n+                    new SourcePath().setSource(sourceUrl))\n+                    .map(response -> {\n+                        final AnalyzeReceiptAsyncHeaders headers = response.getDeserializedHeaders();\n+                        return new OperationResult(parseModelId(headers.getOperationLocation()));\n+                    });\n+            } catch (RuntimeException ex) {\n+                return monoError(logger, ex);\n+            }\n+        };\n+    }\n+\n+    private Function<PollingContext<OperationResult>, Mono<OperationResult>> receiptStreamActivationOperation(\n+        Flux<ByteBuffer> buffer, long length, FormContentType formContentType, boolean includeTextDetails) {\n+        return (pollingContext) -> {\n+            try {\n+                return service.analyzeReceiptAsyncWithResponseAsync(includeTextDetails,\n+                    ContentType.fromString(formContentType.toString()), buffer, length)\n+                    .map(response -> {\n+                        final AnalyzeReceiptAsyncHeaders headers = response.getDeserializedHeaders();\n+                        return new OperationResult(parseModelId(headers.getOperationLocation()));\n+                    });\n+            } catch (RuntimeException ex) {\n+                return monoError(logger, ex);\n+            }\n+        };\n+    }\n+\n+    private Function<PollingContext<OperationResult>, Mono<PollResponse<OperationResult>>>\n+    extractReceiptPollOperation() {\n+        return (pollingContext) -> {\n+            PollResponse<OperationResult> operationResultPollResponse = pollingContext.getLatestResponse();\n+            String modelId = operationResultPollResponse.getValue().getResultId();\n+            try {\n+                UUID resultUid = UUID.fromString(modelId);\n+                return service.getAnalyzeReceiptResultWithResponseAsync(resultUid)\n+                    .flatMap(modelSimpleResponse -> processAnalyzeModelResponse(modelSimpleResponse, operationResultPollResponse));\n+            } catch (HttpResponseException e) {\n+                logger.logExceptionAsError(e);\n+                return Mono.just(new PollResponse<>(LongRunningOperationStatus.FAILED, null));\n+            }\n+        };\n+    }\n+\n+    private Function<PollingContext<OperationResult>, Mono<IterableStream<ReceiptPageResult>>>\n+    fetchExtractReceiptResult() {", "originalCommit": "dc34e20f6c5b4d8fe834d364de27fafbe1c8d7ea", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "url": "https://github.com/Azure/azure-sdk-for-java/commit/eb336a0ab077827ac8a91e604bc863cddf9ee821", "message": "update to AzureKeyCredential", "committedDate": "2020-03-30T07:57:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3MDYxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400370614", "bodyText": "Mind removing the entire unfinished section from the Javadoc and adding a TODO outside of it, this will guard us against the scenario where we don't get around to this and a TODO is published in our Javadocs.", "author": "alzimmermsft", "createdAt": "2020-03-30T17:34:04Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,231 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3Mjg0Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400372842", "bodyText": "Should document that this doesn't support cancellation and will throw an error if it is cancelled.", "author": "alzimmermsft", "createdAt": "2020-03-30T17:37:39Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,231 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceipt(String sourceUrl) {\n+        return beginExtractReceipt(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * one second is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceipt(String sourceUrl,\n+                                                                                             boolean includeTextDetails,\n+                                                                                             Duration pollInterval) {\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(1);\n+        return new PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3ODA3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400378077", "bodyText": "Same comment about TODO in Javadocs", "author": "alzimmermsft", "createdAt": "2020-03-30T17:45:54Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,98 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * <p><strong>Instantiating a synchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3OTAxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400379013", "bodyText": "Same comment about TODOs in Javadocs", "author": "alzimmermsft", "createdAt": "2020-03-30T17:47:15Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,336 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential) apiKey(FormRecognizerApiKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * TODO: add code snippets", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3OTY4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400379684", "bodyText": "There is a constant for this in ContentType in Azure Core.", "author": "alzimmermsft", "createdAt": "2020-03-30T17:48:19Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,336 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential) apiKey(FormRecognizerApiKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * TODO: add code snippets\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = \"application/json\";", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4OTA4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400389088", "bodyText": "Let's move this above any other work", "author": "alzimmermsft", "createdAt": "2020-03-30T18:03:28Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,336 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential) apiKey(FormRecognizerApiKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * TODO: add code snippets\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = \"application/json\";\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String FORM_RECOGNIZER_PROPERTIES = \"azure-ai-formrecognizer.properties\";\n+    static final String OCP_APIM_SUBSCRIPTION_KEY = \"Ocp-Apim-Subscription-Key\";\n+\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private AzureKeyCredential credential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(FORM_RECOGNIZER_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4OTY1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400389655", "bodyText": "Should move this after the retry policy", "author": "alzimmermsft", "createdAt": "2020-03-30T18:04:22Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,336 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential) apiKey(FormRecognizerApiKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * TODO: add code snippets\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = \"application/json\";\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String FORM_RECOGNIZER_PROPERTIES = \"azure-ai-formrecognizer.properties\";\n+    static final String OCP_APIM_SUBSCRIPTION_KEY = \"Ocp-Apim-Subscription-Key\";\n+\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private AzureKeyCredential credential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(FORM_RECOGNIZER_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");\n+\n+        HttpPipeline pipeline = httpPipeline;\n+        // Create a default Pipeline if it is not given\n+        if (pipeline == null) {\n+            // Closest to API goes first, closest to wire goes last.\n+            final List<HttpPipelinePolicy> policies = new ArrayList<>();\n+\n+            // Authentications\n+            if (credential != null) {\n+                policies.add(new AzureKeyCredentialPolicy(OCP_APIM_SUBSCRIPTION_KEY, credential));\n+            } else {\n+                // Throw exception that credential and tokenCredential cannot be null\n+                throw logger.logExceptionAsError(\n+                    new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+            }\n+\n+            policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion,\n+                buildConfiguration));\n+            policies.add(new RequestIdPolicy());\n+            policies.add(new AddHeadersPolicy(headers));\n+            policies.add(new AddDatePolicy());", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwNTc2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400405766", "bodyText": "Should this mention FormRecognizerClientImplBuilder?", "author": "alzimmermsft", "createdAt": "2020-03-30T18:30:39Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,336 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential) apiKey(FormRecognizerApiKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * TODO: add code snippets\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = \"application/json\";\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String FORM_RECOGNIZER_PROPERTIES = \"azure-ai-formrecognizer.properties\";\n+    static final String OCP_APIM_SUBSCRIPTION_KEY = \"Ocp-Apim-Subscription-Key\";\n+\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private AzureKeyCredential credential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(FORM_RECOGNIZER_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");\n+\n+        HttpPipeline pipeline = httpPipeline;\n+        // Create a default Pipeline if it is not given\n+        if (pipeline == null) {\n+            // Closest to API goes first, closest to wire goes last.\n+            final List<HttpPipelinePolicy> policies = new ArrayList<>();\n+\n+            // Authentications\n+            if (credential != null) {\n+                policies.add(new AzureKeyCredentialPolicy(OCP_APIM_SUBSCRIPTION_KEY, credential));\n+            } else {\n+                // Throw exception that credential and tokenCredential cannot be null\n+                throw logger.logExceptionAsError(\n+                    new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+            }\n+\n+            policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion,\n+                buildConfiguration));\n+            policies.add(new RequestIdPolicy());\n+            policies.add(new AddHeadersPolicy(headers));\n+            policies.add(new AddDatePolicy());\n+\n+            HttpPolicyProviders.addBeforeRetryPolicies(policies);\n+            policies.add(retryPolicy == null ? DEFAULT_RETRY_POLICY : retryPolicy);\n+            policies.addAll(this.policies);\n+            HttpPolicyProviders.addAfterRetryPolicies(policies);\n+\n+            policies.add(new HttpLoggingPolicy(httpLogOptions));\n+\n+            pipeline = new HttpPipelineBuilder()\n+                .policies(policies.toArray(new HttpPipelinePolicy[0]))\n+                .httpClient(httpClient)\n+                .build();\n+        }\n+\n+        final FormRecognizerClientImpl formRecognizerAPI = new FormRecognizerClientImplBuilder()\n+            .endpoint(endpoint)\n+            .pipeline(pipeline)\n+            .build();\n+\n+        return new FormRecognizerAsyncClient(formRecognizerAPI, serviceVersion);\n+    }\n+\n+    /**\n+     * Sets the service endpoint for the Azure Form Recognizer instance.\n+     *\n+     * @param endpoint The URL of the Azure Form Recognizer instance service requests to and receive responses from.\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     * @throws NullPointerException if {@code endpoint} is null\n+     * @throws IllegalArgumentException if {@code endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClientBuilder endpoint(String endpoint) {\n+        Objects.requireNonNull(endpoint, \"'endpoint' cannot be null.\");\n+\n+        try {\n+            new URL(endpoint);\n+        } catch (MalformedURLException ex) {\n+            throw logger.logExceptionAsWarning(new IllegalArgumentException(\"'endpoint' must be a valid URL.\", ex));\n+        }\n+\n+        if (endpoint.endsWith(\"/\")) {\n+            this.endpoint = endpoint.substring(0, endpoint.length() - 1);\n+        } else {\n+            this.endpoint = endpoint;\n+        }\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the credential to use when authenticating HTTP requests for this FormRecognizerClientImplBuilder.", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwNzI3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400407279", "bodyText": "Mind adding a comment around this regex pattern to clarify its purpose.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:33:12Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,214 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageMetadata;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {\n+    private static final ClientLogger LOGGER = new ClientLogger(Transforms.class);\n+    private static final Pattern COMPILE = Pattern.compile(\"[^0-9]+\");", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwODE3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400408179", "bodyText": "Is it likely that there will be additional keys added in the future? If so, what is the plan to ensure this remains up to date when changes are made? Is there any possibility this could be made more generic and flexible to support additional keys?", "author": "alzimmermsft", "createdAt": "2020-03-30T18:34:47Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,214 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageMetadata;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {\n+    private static final ClientLogger LOGGER = new ClientLogger(Transforms.class);\n+    private static final Pattern COMPILE = Pattern.compile(\"[^0-9]+\");\n+\n+    private Transforms() {\n+    }\n+\n+    static IterableStream<ExtractedReceipt> toReceipt(AnalyzeResult analyzeResult, boolean includeTextDetails) {\n+        List<ReadResult> readResults = analyzeResult.getReadResults();\n+        List<DocumentResult> documentResult = analyzeResult.getDocumentResults();\n+        List<ExtractedReceipt> extractedReceiptList = new ArrayList<>();\n+\n+        for (int i = 0; i < readResults.size(); i++) {\n+            ReadResult readResultItem = readResults.get(i);\n+            PageMetadata pageMetadata = getPageInfo(readResultItem);\n+            ExtractedReceipt extractedReceiptItem = new ExtractedReceipt(pageMetadata);\n+\n+            DocumentResult documentResultItem = documentResult.get(i);\n+            documentResultItem.getFields().forEach((key, fieldValue) -> {\n+                switch (key) {", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0MTAyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400441020", "bodyText": "As this being a trained model, it would be unlikely to have additional keys or to expect this to be updated very often. Further, for any new introductions from the service side to keep this up to date this will have to go through updates accordingly.\nAlso, with such specific string matching, I am not sure how we could make it generic in nature?", "author": "samvaity", "createdAt": "2020-03-30T19:29:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwODE3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NDQzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400584438", "bodyText": "If these keys are not going to be updated frequently, can this be an ExpandableStringEnum?", "author": "srnagar", "createdAt": "2020-03-31T01:09:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwODE3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5MjQ4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401992482", "bodyText": "Update :\nThe service team intends to have additional keys added in between service updates. So to ensure this remains consistent the additional keys would be grouped into the Map<String, FieldValue> extractedFields here and with proceeding client upgrades would be converted to strongly typed fields.", "author": "samvaity", "createdAt": "2020-04-02T00:51:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwODE3OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUxOTYzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r402519636", "bodyText": "Can the keys be converted to expandable enums?", "author": "srnagar", "createdAt": "2020-04-02T18:20:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwODE3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQwOTQ4NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400409484", "bodyText": "Mind adding comments into the helper methods and in the code to explain the transforms being applied.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:37:03Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,214 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageMetadata;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxMDI2OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400410268", "bodyText": "Should this return Flux.error instead of throwing?", "author": "alzimmermsft", "createdAt": "2020-03-30T18:38:25Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/implementation/Utility.java", "diffHunk": "@@ -0,0 +1,51 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.implementation;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+\n+/**\n+ * Utility method class.\n+ */\n+public class Utility {\n+    private static final ClientLogger LOGGER = new ClientLogger(Utility.class);\n+\n+    /**\n+     * A utility method for converting the input stream to Flux of ByteBuffer.\n+     *\n+     * @param data The input data which needs to convert to ByteBuffer.\n+     *\n+     * @return {@link ByteBuffer} which contains the input data.\n+     * @throws RuntimeException When I/O error occurs.\n+     */\n+    public static Flux<ByteBuffer> convertStreamToByteBuffer(InputStream data) {\n+        try {\n+            return Flux.just(toByteArray(data));\n+        } catch (IOException e) {\n+            throw LOGGER.logExceptionAsError(new RuntimeException(e));", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxMTE4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400411181", "bodyText": "Do we want to convert the entire InputStream to a ByteBuffer in a single go or should this be chunked as downstream requests more elements? Could we have scenarios where a large file is being read that wouldn't fit into memory?", "author": "alzimmermsft", "createdAt": "2020-03-30T18:39:54Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/implementation/Utility.java", "diffHunk": "@@ -0,0 +1,51 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.implementation;\n+\n+import com.azure.core.util.logging.ClientLogger;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.ByteArrayOutputStream;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+\n+/**\n+ * Utility method class.\n+ */\n+public class Utility {\n+    private static final ClientLogger LOGGER = new ClientLogger(Utility.class);\n+\n+    /**\n+     * A utility method for converting the input stream to Flux of ByteBuffer.\n+     *\n+     * @param data The input data which needs to convert to ByteBuffer.\n+     *\n+     * @return {@link ByteBuffer} which contains the input data.\n+     * @throws RuntimeException When I/O error occurs.\n+     */\n+    public static Flux<ByteBuffer> convertStreamToByteBuffer(InputStream data) {\n+        try {\n+            return Flux.just(toByteArray(data));\n+        } catch (IOException e) {\n+            throw LOGGER.logExceptionAsError(new RuntimeException(e));\n+        }\n+    }\n+\n+    private static ByteBuffer toByteArray(InputStream in) throws IOException {\n+\n+        ByteArrayOutputStream os = new ByteArrayOutputStream();\n+\n+        byte[] buffer = new byte[1024];\n+        int len;\n+\n+        // read bytes from the input stream and store them in buffer\n+        while ((len = in.read(buffer)) != -1) {\n+            // write bytes from the buffer into output stream\n+            os.write(buffer, 0, len);\n+        }\n+\n+        return ByteBuffer.wrap(os.toByteArray());\n+    }", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0NzUxMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400447511", "bodyText": "I have added a separate issue to track this #9690\nAnd if it helps, the service docs do mention a size limit specification\n\nImage file size must be less than 20 MB.\n\nI will also add it to our javadocs.", "author": "samvaity", "createdAt": "2020-03-30T19:41:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxMTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MzIxNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401073214", "bodyText": "The service will only accept files of 20MB, so anything larger is an exception, but nothing is stopping me from sends a 2GB file by accident.", "author": "alzimmermsft", "createdAt": "2020-03-31T17:04:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxMTE4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA5NTc4Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401095786", "bodyText": "Updating this implementation in #9690", "author": "samvaity", "createdAt": "2020-03-31T17:40:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxMTE4MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDk1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400414952", "bodyText": "Should this class be final?", "author": "alzimmermsft", "createdAt": "2020-03-30T18:46:30Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/PageMetadata.java", "diffHunk": "@@ -0,0 +1,124 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The PageMetadata model.\n+ */\n+@Immutable\n+public class PageMetadata {", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNTc1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400415758", "bodyText": "Are these left generic so that the service could return an integer value here? It seems that these APIs will need a lot of type checking to be done to be used safely or to have a lot of unchecked casts.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:47:53Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/ReceiptItem.java", "diffHunk": "@@ -0,0 +1,91 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Fluent;\n+\n+/**\n+ * The ReceiptItem model.\n+ */\n+@Fluent\n+public class ReceiptItem {\n+\n+    /*\n+     * Name of the field value.\n+     */\n+    private FieldValue<?> name;", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ1MTA3MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400451070", "bodyText": "Right, so FieldValue here is an abstract class that can take in a T that could be of type Integer, String, Float, Date, Time atm.\nIt is to accommodate the valueDate, valueTime, valuePhoneNumber properties on Service model FieldValue.\nAlso, this enables the user to access the value on the field as\n\nextractedReceiptItem.getMerchantAddress().getValue()\n\nrather than first knowing the type and then,\n\nextractedReceiptItem.getMerchantAddress().getValueString()", "author": "samvaity", "createdAt": "2020-03-30T19:47:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNTc1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNjMzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400416336", "bodyText": "These use the nullable Float, it is expected for these to be returned as null?", "author": "alzimmermsft", "createdAt": "2020-03-30T18:48:51Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/Point.java", "diffHunk": "@@ -0,0 +1,52 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * The Point model.\n+ */\n+@Immutable\n+public class Point {\n+\n+    /*\n+     * The x-axis point coordinate.\n+     */\n+    private final Float xCoordinate;\n+\n+    /*\n+     * The y-axis point coordinate.\n+     */\n+    private final Float yCoordinate;\n+\n+    /**\n+     * Creates a Point object.\n+     *\n+     * @param xCoordinate The x-axis point coordinate.\n+     * @param yCoordinate The y-axis point coordinate.\n+     */\n+    public Point(final Float xCoordinate, final Float yCoordinate) {\n+        this.xCoordinate = xCoordinate;\n+        this.yCoordinate = yCoordinate;", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA5NzMxNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401097317", "bodyText": "Updated to primitive float as it cannot be null.", "author": "samvaity", "createdAt": "2020-03-31T17:42:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNjMzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNzMwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400417305", "bodyText": "Should put in a fake key, this will throw an exception.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:50:25Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/samples/java/com/azure/ai/formrecognizer/ExtractPrebuiltReceiptAsync.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.PollerFlux;\n+import reactor.core.publisher.Mono;\n+\n+import java.time.Duration;\n+\n+/**\n+ * Sample for extracting receipt information using file source URL.\n+ */\n+public class ExtractPrebuiltReceiptAsync {\n+    public static void main(final String[] args) {\n+        // Instantiate a client that will be used to call the service.\n+        final FormRecognizerAsyncClient client = new FormRecognizerClientBuilder()\n+            .apiKey(new AzureKeyCredential(\"\"))", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxODMxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400418312", "bodyText": "Why do we sleep here for 20 seconds? The captured trainingOperationResponse won't change during the sleep period.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:52:05Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/samples/java/com/azure/ai/formrecognizer/ExtractPrebuiltReceiptAsync.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.PollerFlux;\n+import reactor.core.publisher.Mono;\n+\n+import java.time.Duration;\n+\n+/**\n+ * Sample for extracting receipt information using file source URL.\n+ */\n+public class ExtractPrebuiltReceiptAsync {\n+    public static void main(final String[] args) {\n+        // Instantiate a client that will be used to call the service.\n+        final FormRecognizerAsyncClient client = new FormRecognizerClientBuilder()\n+            .apiKey(new AzureKeyCredential(\"\"))\n+            .endpoint(\"https://{endpoint}.cognitiveservices.azure.com/\")\n+            .buildAsyncClient();\n+\n+        String receiptUrl = \"https://docs.microsoft.com/en-us/azure/cognitive-services/form-recognizer/media/contoso-allinone.jpg\";\n+        PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> analyzeReceiptPoller =\n+            client.beginExtractReceipt(receiptUrl, true, Duration.ofSeconds(1));\n+\n+        IterableStream<ExtractedReceipt> receiptPageResults = analyzeReceiptPoller\n+            .last()\n+            .flatMap(trainingOperationResponse -> {\n+                try {\n+                    Thread.sleep(20000);", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxOTIzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400419238", "bodyText": "This could be injected into the flatMap lambda.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:53:35Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/samples/java/com/azure/ai/formrecognizer/ExtractPrebuiltReceiptAsync.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.PollerFlux;\n+import reactor.core.publisher.Mono;\n+\n+import java.time.Duration;\n+\n+/**\n+ * Sample for extracting receipt information using file source URL.\n+ */\n+public class ExtractPrebuiltReceiptAsync {\n+    public static void main(final String[] args) {\n+        // Instantiate a client that will be used to call the service.\n+        final FormRecognizerAsyncClient client = new FormRecognizerClientBuilder()\n+            .apiKey(new AzureKeyCredential(\"\"))\n+            .endpoint(\"https://{endpoint}.cognitiveservices.azure.com/\")\n+            .buildAsyncClient();\n+\n+        String receiptUrl = \"https://docs.microsoft.com/en-us/azure/cognitive-services/form-recognizer/media/contoso-allinone.jpg\";\n+        PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> analyzeReceiptPoller =\n+            client.beginExtractReceipt(receiptUrl, true, Duration.ofSeconds(1));\n+\n+        IterableStream<ExtractedReceipt> receiptPageResults = analyzeReceiptPoller\n+            .last()\n+            .flatMap(trainingOperationResponse -> {\n+                try {\n+                    Thread.sleep(20000);\n+                } catch (InterruptedException e) {\n+                    e.printStackTrace();\n+                }\n+                if (trainingOperationResponse.getStatus().isComplete()) {\n+                    System.out.println(\"Polling completed successfully\");\n+                    // training completed successfully, retrieving final result.\n+                    return trainingOperationResponse.getFinalResult();\n+                } else {\n+                    System.out.println(\"polling completed unsuccessfully with status:\"\n+                        + trainingOperationResponse.getStatus());\n+                    return Mono.empty();\n+                }\n+            }).block();\n+\n+        for (ExtractedReceipt extractedReceiptItem : receiptPageResults) {", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxOTM5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400419392", "bodyText": "Should put in a fake key, this will throw an exception.", "author": "alzimmermsft", "createdAt": "2020-03-30T18:53:50Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/samples/java/com/azure/ai/formrecognizer/ExtractPrebuiltReceiptSync.java", "diffHunk": "@@ -0,0 +1,68 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.nio.file.Files;\n+import java.time.Duration;\n+\n+/**\n+ * Sample for extracting receipt information using input stream.\n+ */\n+public class ExtractPrebuiltReceiptSync {\n+\n+    /**\n+     * Sample for extracting receipt information using input stream.\n+     *\n+     * @param args Unused. Arguments to the program.\n+     * @throws IOException Exception thrown when there is an error in reading all the bytes from the File.\n+     */\n+    public static void main(final String[] args) throws IOException {\n+        // Instantiate a client that will be used to call the service.\n+\n+        final FormRecognizerClient client = new FormRecognizerClientBuilder()\n+            .apiKey(new AzureKeyCredential(\"\"))", "originalCommit": "eb336a0ab077827ac8a91e604bc863cddf9ee821", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1cc2e05402105b12a92a55d737037be72d282d4a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1cc2e05402105b12a92a55d737037be72d282d4a", "message": "receipt endpoints working", "committedDate": "2020-03-30T21:25:47Z", "type": "commit"}, {"oid": "ddf8ab138d668c4c60b00b451fff66d006fc7431", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ddf8ab138d668c4c60b00b451fff66d006fc7431", "message": "raw ocr and field value update", "committedDate": "2020-03-30T21:26:01Z", "type": "commit"}, {"oid": "525ca665cc048ca815dde52b807fe16dac42cc7b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/525ca665cc048ca815dde52b807fe16dac42cc7b", "message": "update model names, tests, javadocs", "committedDate": "2020-03-30T21:26:12Z", "type": "commit"}, {"oid": "c03e3e454a5551f4087778038125234cdf680b8a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c03e3e454a5551f4087778038125234cdf680b8a", "message": "add testing", "committedDate": "2020-03-30T21:26:23Z", "type": "commit"}, {"oid": "0d794bbdac6de662cf3443f5912a0d6115ec353d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d794bbdac6de662cf3443f5912a0d6115ec353d", "message": "update to AzureKeyCredential", "committedDate": "2020-03-30T21:26:30Z", "type": "commit"}, {"oid": "9fff5c3f5d3210e43eb5426b514ffede78f6d5d8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9fff5c3f5d3210e43eb5426b514ffede78f6d5d8", "message": "addressing some review feedback", "committedDate": "2020-03-30T21:26:36Z", "type": "commit"}, {"oid": "9fff5c3f5d3210e43eb5426b514ffede78f6d5d8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9fff5c3f5d3210e43eb5426b514ffede78f6d5d8", "message": "addressing some review feedback", "committedDate": "2020-03-30T21:26:36Z", "type": "forcePushed"}, {"oid": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "message": "models update", "committedDate": "2020-03-31T00:31:51Z", "type": "commit"}, {"oid": "e550685a367496584a0b2b2c57577a4202eb7283", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e550685a367496584a0b2b2c57577a4202eb7283", "message": "Bounding box model update", "committedDate": "2020-03-31T01:15:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MTIwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400581208", "bodyText": "This API should have Context param.", "author": "srnagar", "createdAt": "2020-03-31T00:57:31Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,103 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * <p><strong>Instantiating a synchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder this} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {\n+    private final FormRecognizerAsyncClient client;\n+\n+    /**\n+     * Create a {@code FormRecognizerClient client} that sends requests to the Form Recognizer service's endpoint.\n+     * Each service call goes through the {@link FormRecognizerClientBuilder#pipeline http pipeline}.\n+     *\n+     * @param client The {@link FormRecognizerClient} that the client routes its request through.\n+     */\n+    FormRecognizerClient(FormRecognizerAsyncClient client) {\n+        this.client = client;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>>", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTEyMzQ1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401123452", "bodyText": "I don't think we support Context param/tracing for LRO operations yet.\nhttps://github.com/Azure/azure-sdk-for-java/blob/master/sdk/keyvault/azure-security-keyvault-certificates/src/main/java/com/azure/security/keyvault/certificates/CertificateClient.java#L92", "author": "samvaity", "createdAt": "2020-03-31T18:26:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MTIwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk4NjIyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401986220", "bodyText": "The context-param in LRO operations would require the Poller itself to support context passing which currently it doesn't.\nSupport context in Poller impl in azure-core to support this - #9762\nUpdate FR API's to reflect this change - #9763", "author": "samvaity", "createdAt": "2020-04-02T00:28:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MTIwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4MjIwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400582204", "bodyText": "Same here - this method should have Context param.", "author": "srnagar", "createdAt": "2020-03-31T01:01:04Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,103 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * <p><strong>Instantiating a synchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder this} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {\n+    private final FormRecognizerAsyncClient client;\n+\n+    /**\n+     * Create a {@code FormRecognizerClient client} that sends requests to the Form Recognizer service's endpoint.\n+     * Each service call goes through the {@link FormRecognizerClientBuilder#pipeline http pipeline}.\n+     *\n+     * @param client The {@link FormRecognizerClient} that the client routes its request through.\n+     */\n+    FormRecognizerClient(FormRecognizerAsyncClient client) {\n+        this.client = client;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails, Duration pollInterval) {\n+        return client.beginExtractReceiptFromUrl(sourceUrl, includeTextDetails, pollInterval).getSyncPoller();\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipt data using optical character recognition (OCR) and a prebuilt\n+     * trained receipt model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types including .pdf, .jpg, .png or .tiff type file stream.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link SyncPoller} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>>", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NDk5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400584991", "bodyText": "Instead of silently skipping over unknown keys, if the known set of keys are limited and new keys are not added frequently, this should throw an exception when the key is unknown. And when a new key is added, it should be accompanied by a service version update too right?", "author": "srnagar", "createdAt": "2020-03-31T01:10:58Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,305 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageMetadata;\n+import com.azure.ai.formrecognizer.models.PageRange;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {\n+    private static final ClientLogger LOGGER = new ClientLogger(Transforms.class);\n+    // Pattern match to find all digits in the provided string.\n+    private static final Pattern COMPILE = Pattern.compile(\"[^0-9]+\");\n+\n+    private Transforms() {\n+    }\n+\n+    /**\n+     * Helper method to convert the {@link com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult}\n+     * service level receipt model to list of {@link ExtractedReceipt}.\n+     *\n+     * @param analyzeResult The result of the analyze receipt operation returned by the service.\n+     * @param includeTextDetails When set to true, a list of references to the text elements is returned in the read result.\n+     *\n+     * @return A list of {@link ExtractedReceipt} to represent the list of extracted receipt information.\n+     */\n+    static IterableStream<ExtractedReceipt> toReceipt(AnalyzeResult analyzeResult, boolean includeTextDetails) {\n+        List<ReadResult> readResults = analyzeResult.getReadResults();\n+        List<DocumentResult> documentResult = analyzeResult.getDocumentResults();\n+        List<ExtractedReceipt> extractedReceiptList = new ArrayList<>();\n+\n+        for (int i = 0; i < readResults.size(); i++) {\n+            ReadResult readResultItem = readResults.get(i);\n+\n+            // add page Info\n+            PageMetadata pageMetadata = getPageInfo(readResultItem);\n+            PageRange pageRange = null;\n+            DocumentResult documentResultItem = documentResult.get(i);\n+            List<Integer> receiptPageRange = documentResultItem.getPageRange();\n+            if (receiptPageRange.size() == 2) {\n+                pageRange = new PageRange(receiptPageRange.get(0), receiptPageRange.get(1));\n+            }\n+            ExtractedReceipt extractedReceiptItem = new ExtractedReceipt(pageMetadata, pageRange);\n+\n+            // add receipt fields\n+            documentResultItem.getFields().forEach((key, fieldValue) -> {\n+                switch (key) {\n+                    case \"ReceiptType\":\n+                        extractedReceiptItem.setReceiptType(new ReceiptType(fieldValue.getValueString(),\n+                            fieldValue.getConfidence()));\n+                        break;\n+                    case \"MerchantName\":\n+                        extractedReceiptItem.setMerchantName(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"MerchantAddress\":\n+                        extractedReceiptItem.setMerchantAddress(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"MerchantPhoneNumber\":\n+                        extractedReceiptItem.setMerchantPhoneNumber(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Subtotal\":\n+                        extractedReceiptItem.setSubtotal(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Tax\":\n+                        extractedReceiptItem.setTax(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Tip\":\n+                        extractedReceiptItem.setTip(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Total\":\n+                        extractedReceiptItem.setTotal(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"TransactionDate\":\n+                        extractedReceiptItem.setTransactionDate(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"TransactionTime\":\n+                        extractedReceiptItem.setTransactionTime(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Items\":\n+                        extractedReceiptItem.setReceiptItems(toReceiptItems(fieldValue.getValueArray(), readResults, includeTextDetails));\n+                        break;\n+                    default:\n+                        break;", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5ODAyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401298021", "bodyText": "The leftover keys would be put in a Map<String, FieldValue> extractedFields to still be able to capture them and not ignore.\n\nif the known set of keys are limited and new keys are not added frequently.\n\nThe service currently wants to have the ability to add fields in between service updates. These would be made available to the user on the Map of FieldValue (extractedFields) and move to become new fields like merchantName, merchantAddress etc in further client releases.", "author": "samvaity", "createdAt": "2020-04-01T00:57:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NDk5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NTkyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400585929", "bodyText": "Same comments as above for these keys.", "author": "srnagar", "createdAt": "2020-03-31T01:14:11Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,305 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageMetadata;\n+import com.azure.ai.formrecognizer.models.PageRange;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {\n+    private static final ClientLogger LOGGER = new ClientLogger(Transforms.class);\n+    // Pattern match to find all digits in the provided string.\n+    private static final Pattern COMPILE = Pattern.compile(\"[^0-9]+\");\n+\n+    private Transforms() {\n+    }\n+\n+    /**\n+     * Helper method to convert the {@link com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult}\n+     * service level receipt model to list of {@link ExtractedReceipt}.\n+     *\n+     * @param analyzeResult The result of the analyze receipt operation returned by the service.\n+     * @param includeTextDetails When set to true, a list of references to the text elements is returned in the read result.\n+     *\n+     * @return A list of {@link ExtractedReceipt} to represent the list of extracted receipt information.\n+     */\n+    static IterableStream<ExtractedReceipt> toReceipt(AnalyzeResult analyzeResult, boolean includeTextDetails) {\n+        List<ReadResult> readResults = analyzeResult.getReadResults();\n+        List<DocumentResult> documentResult = analyzeResult.getDocumentResults();\n+        List<ExtractedReceipt> extractedReceiptList = new ArrayList<>();\n+\n+        for (int i = 0; i < readResults.size(); i++) {\n+            ReadResult readResultItem = readResults.get(i);\n+\n+            // add page Info\n+            PageMetadata pageMetadata = getPageInfo(readResultItem);\n+            PageRange pageRange = null;\n+            DocumentResult documentResultItem = documentResult.get(i);\n+            List<Integer> receiptPageRange = documentResultItem.getPageRange();\n+            if (receiptPageRange.size() == 2) {\n+                pageRange = new PageRange(receiptPageRange.get(0), receiptPageRange.get(1));\n+            }\n+            ExtractedReceipt extractedReceiptItem = new ExtractedReceipt(pageMetadata, pageRange);\n+\n+            // add receipt fields\n+            documentResultItem.getFields().forEach((key, fieldValue) -> {\n+                switch (key) {\n+                    case \"ReceiptType\":\n+                        extractedReceiptItem.setReceiptType(new ReceiptType(fieldValue.getValueString(),\n+                            fieldValue.getConfidence()));\n+                        break;\n+                    case \"MerchantName\":\n+                        extractedReceiptItem.setMerchantName(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"MerchantAddress\":\n+                        extractedReceiptItem.setMerchantAddress(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"MerchantPhoneNumber\":\n+                        extractedReceiptItem.setMerchantPhoneNumber(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Subtotal\":\n+                        extractedReceiptItem.setSubtotal(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Tax\":\n+                        extractedReceiptItem.setTax(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Tip\":\n+                        extractedReceiptItem.setTip(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Total\":\n+                        extractedReceiptItem.setTotal(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"TransactionDate\":\n+                        extractedReceiptItem.setTransactionDate(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"TransactionTime\":\n+                        extractedReceiptItem.setTransactionTime(setFieldValue(fieldValue, readResults, includeTextDetails));\n+                        break;\n+                    case \"Items\":\n+                        extractedReceiptItem.setReceiptItems(toReceiptItems(fieldValue.getValueArray(), readResults, includeTextDetails));\n+                        break;\n+                    default:\n+                        break;\n+                }\n+            });\n+            extractedReceiptList.add(extractedReceiptItem);\n+        }\n+        return new IterableStream<>(extractedReceiptList);\n+    }\n+\n+    /**\n+     * Helper method that converts the incoming service field value to one of the strongly typed SDK level {@link FieldValue} with\n+     * reference elements set when {@code includeTextDetails} is set to true.\n+     *\n+     * @param fieldValue The named field values returned by the service.\n+     * @param readResults The result containing the list of element references when includeTextDetails is set to true.\n+     * @param includeTextDetails When set to true, a list of references to the text elements is returned in the read result.\n+     *\n+     * @return The strongly typed {@link FieldValue} for the field input.\n+     */\n+    private static FieldValue<?> setFieldValue(com.azure.ai.formrecognizer.implementation.models.FieldValue fieldValue,\n+                                               List<ReadResult> readResults, boolean includeTextDetails) {\n+        FieldValue<?> value;\n+        switch (fieldValue.getType()) {\n+            case PHONE_NUMBER:\n+            case STRING:\n+            case TIME:\n+            case DATE:\n+                value = toFieldValueString(fieldValue);\n+                break;\n+            case INTEGER:\n+                value = toFieldValueInteger(fieldValue);\n+                break;\n+            case NUMBER:\n+                value = toFieldValueNumber(fieldValue);\n+                break;\n+            case ARRAY:\n+            case OBJECT:\n+            default:\n+                throw LOGGER.logExceptionAsError(new RuntimeException(\"FieldValue Type not supported\"));\n+        }\n+        if (includeTextDetails) {\n+            value.setElements(setReferenceElements(readResults, fieldValue.getElements()));\n+        }\n+        return value;\n+    }\n+\n+    /**\n+     * Helper method that converts the service returned page information to SDK model {@link PageMetadata}.\n+     *\n+     * @param readResultItem A read result item returned from the service containing the page information for provided\n+     * input.\n+     *\n+     * @return The {@link PageMetadata} for the receipt page.\n+     */\n+    private static PageMetadata getPageInfo(ReadResult readResultItem) {\n+        return new PageMetadata(TextLanguage.fromString(readResultItem.getLanguage().toString()),\n+            readResultItem.getHeight(), readResultItem.getPage(), readResultItem.getWidth(),\n+            readResultItem.getAngle(), DimensionUnit.fromString(readResultItem.getUnit().toString()));\n+    }\n+\n+    /**\n+     * Helper method to set the text reference elements on FieldValue/fields when {@code includeTextDetails} set to true.\n+     *\n+     * @param readResults The ReadResult containing the resolved references for text elements.\n+     * @param elements When includeTextDetails is set to true, a list of references to the text\n+     * elements constituting this field value.\n+     *\n+     * @return The updated {@link FieldValue} object with list if referenced elements.\n+     */\n+    private static List<Element> setReferenceElements(List<ReadResult> readResults, List<String> elements) {\n+        List<Element> elementList = new ArrayList<>();\n+        elements.forEach(elementString -> {\n+            String[] indices = COMPILE.matcher(elementString).replaceAll(\" \").trim().split(\" \");\n+            int readResultIndex, lineIndex;\n+            if (indices.length >= 1) {\n+                readResultIndex = Integer.parseInt(indices[0]);\n+                lineIndex = Integer.parseInt(indices[1]);\n+            } else {\n+                throw LOGGER.logExceptionAsError(new RuntimeException(\"Reference Elements not found\"));\n+            }\n+            if (indices.length == 3) {\n+                int wordIndex = Integer.parseInt(indices[2]);\n+                TextWord textWord = readResults.get(readResultIndex).getLines().get(lineIndex).getWords()\n+                    .get(wordIndex);\n+                WordElement wordElement = new WordElement(textWord.getText(), toBoundingBox(textWord.getBoundingBox()));\n+                elementList.add(wordElement);\n+            } else {\n+                TextLine textLine = readResults.get(readResultIndex).getLines().get(lineIndex);\n+                LineElement lineElement = new LineElement(textLine.getText(), toBoundingBox(textLine.getBoundingBox()));\n+                elementList.add(lineElement);\n+            }\n+        });\n+        return elementList;\n+    }\n+\n+    /**\n+     * Helper method to convert the service level modeled eight numbers representing the four points to SDK level\n+     * {@link BoundingBox}.\n+     *\n+     * @param boundingBox A list of eight numbers representing the four points of a box.\n+     *\n+     * @return A {@link BoundingBox}.\n+     */\n+    private static BoundingBox toBoundingBox(List<Float> boundingBox) {\n+        List<Point> pointList = new ArrayList<>();\n+        for (int i = 0; i < boundingBox.size(); i += 2) {\n+            Point point = new Point(boundingBox.get(i), boundingBox.get(i + 1));\n+            pointList.add(point);\n+        }\n+        return new BoundingBox(pointList);\n+    }\n+\n+    /**\n+     * Helper method to convert the service level {@link com.azure.ai.formrecognizer.implementation.models.FieldValue#getValueArray() value items}\n+     * to SDK level {@link ReceiptItem receipt items}.\n+     *\n+     * @param fieldValue The named field values returned by the service.\n+     * @param readResults The result containing the list of element references when includeTextDetails is set to true.\n+     * @param includeTextDetails When set to true, a list of references to the text elements is returned in the read result.\n+     *\n+     * @return A list of {@link ReceiptItem}.\n+     */\n+    private static List<ReceiptItem> toReceiptItems(\n+        List<com.azure.ai.formrecognizer.implementation.models.FieldValue> fieldValue, List<ReadResult> readResults, boolean includeTextDetails) {\n+        List<ReceiptItem> receiptItemList = new ArrayList<>();\n+        fieldValue.forEach(fieldValue1 -> {\n+            ReceiptItem receiptItem = new ReceiptItem();\n+            fieldValue1.getValueObject().forEach((key, fieldValue2) -> {\n+                switch (key) {\n+                    case \"Quantity\":", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI5OTIxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401299218", "bodyText": "Updated to an enum.", "author": "samvaity", "createdAt": "2020-04-01T01:01:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4NTkyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU4ODcwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400588704", "bodyText": "Add @inheritdoc javadoc tag for all these overridden methods.", "author": "srnagar", "createdAt": "2020-03-31T01:24:45Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/IntegerValue.java", "diffHunk": "@@ -0,0 +1,62 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import java.util.List;\n+\n+/**\n+ * Class to represent the Integer value for\n+ * {@link com.azure.ai.formrecognizer.implementation.models.FieldValue#getValueInteger()}\n+ */\n+public class IntegerValue extends FieldValue<Integer> {\n+\n+    /*\n+     * Integer value.\n+     */\n+    private Integer valueInteger;\n+\n+    /*\n+     * Type of the FieldValue.\n+     */\n+    private final FieldValueType fieldValueType;\n+\n+    /**\n+     * Constructs an IntegerValue.\n+     *\n+     * @param text The text content of the extracted field.\n+     * @param boundingBox Bounding box of the field value.\n+     * @param valueInteger Integer value.\n+     * @param pageNumber The 1 based page number of the document on which this field is found.\n+     */\n+    public IntegerValue(String text, BoundingBox boundingBox, Integer valueInteger, int pageNumber) {\n+        super(text, boundingBox, pageNumber);\n+        this.valueInteger = valueInteger;\n+        this.fieldValueType = FieldValueType.INTEGER;\n+    }\n+\n+    @Override", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5MDAzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400590039", "bodyText": "Should this have a public ctor? Do we expect users to create instances of this class?", "author": "srnagar", "createdAt": "2020-03-31T01:29:11Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/WordElement.java", "diffHunk": "@@ -0,0 +1,43 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Immutable;\n+\n+/**\n+ * Creates an element of type {@link ElementType#WORD}\n+ */\n+@Immutable\n+public final class WordElement extends Element {\n+    /*\n+     * Type of the element.\n+     */\n+    private final ElementType elementType;\n+\n+    /**\n+     * Creates an {@link Element element} of type Word.\n+     *\n+     * @param text Text content of the extracted field.\n+     * @param boundingBox Bounding box of the field value, if appropriate.\n+     */\n+    public WordElement(String text, BoundingBox boundingBox) {", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYxMjE4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r402612182", "bodyText": "#9619", "author": "samvaity", "createdAt": "2020-04-02T21:40:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5MDAzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5MDY2Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r400590662", "bodyText": "Why does it open models package to com.azure.core?", "author": "srnagar", "createdAt": "2020-03-31T01:31:15Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/module-info.java", "diffHunk": "@@ -0,0 +1,13 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+module com.azure.ai.formrecognizer {\n+    requires transitive com.azure.core;\n+\n+    exports com.azure.ai.formrecognizer;\n+    exports com.azure.ai.formrecognizer.models;\n+\n+    opens com.azure.ai.formrecognizer.implementation to com.fasterxml.jackson.databind;\n+    opens com.azure.ai.formrecognizer.models to com.fasterxml.jackson.databind;\n+    opens com.azure.ai.formrecognizer.implementation.models to com.fasterxml.jackson.databind, com.azure.core;", "originalCommit": "4d2d75f04aa2f5a51c7224fd0f98eea8cdda4190", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI1MzY4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401253681", "bodyText": "Get this error without it\n\nCaused by: java.lang.IllegalAccessException: class com.azure.core.http.rest.ResponseConstructorsCache (in module com.azure.core) cannot access class com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncResponse (in module com.azure.ai.formrecognizer) because module com.azure.ai.formrecognizer does not export com.azure.ai.formrecognizer.implementation.models to module com.azure.core\nat java.base/jdk.internal.reflect.Reflection.newIllegalAccessException(Reflection.java:361)", "author": "samvaity", "createdAt": "2020-03-31T22:31:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDU5MDY2Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MDM0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401060344", "bodyText": "nit: missing a .", "author": "alzimmermsft", "createdAt": "2020-03-31T16:44:31Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,241 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MjQxNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401062416", "bodyText": "Should this also state that the document should be no larger than 20MB or does this use a different API on the service side which allows for larger files?", "author": "alzimmermsft", "createdAt": "2020-03-31T16:47:43Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,241 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails,\n+                               Duration pollInterval) {\n+        Objects.requireNonNull(sourceUrl, \"'sourceUrl' is required and cannot be null.\");\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(5);\n+        return new PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult(includeTextDetails));\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param data The data of the document to be extract receipt information from.", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzkxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401063912", "bodyText": "Never mind, I see the parameter below mentions this.", "author": "alzimmermsft", "createdAt": "2020-03-31T16:49:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MjQxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzAyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401063020", "bodyText": "Should this have a reduce API? I'm only seeing a single beginExtractReceipt whereas beginExtractReceiptFromUrl has two APIs.", "author": "alzimmermsft", "createdAt": "2020-03-31T16:48:34Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,241 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails,\n+                               Duration pollInterval) {\n+        Objects.requireNonNull(sourceUrl, \"'sourceUrl' is required and cannot be null.\");\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(5);\n+        return new PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult(includeTextDetails));\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types including .pdf, .jpg, .png or .tiff type file stream.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceipt(", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTMwMDIwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401300201", "bodyText": "Yes, in beginExtractReceiptFromUrl was about adding convenience to the users. But adding overloads for beginExtractReceipt would only take away the pollInterval and includeTextDetails  and would be overly simplifying things for the user.\nNot sure, if we would want that.\n@srnagar @JonathanGiles Thoughts?", "author": "samvaity", "createdAt": "2020-04-01T01:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzAyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5MDE2Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401990166", "bodyText": "Added simplified beginExtractReceipt overloads.", "author": "samvaity", "createdAt": "2020-04-02T00:42:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2MzAyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjE5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401066191", "bodyText": "Same question as the async client, should this have a reduced parameters API", "author": "alzimmermsft", "createdAt": "2020-03-31T16:53:21Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,103 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * <p><strong>Instantiating a synchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder this} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {\n+    private final FormRecognizerAsyncClient client;\n+\n+    /**\n+     * Create a {@code FormRecognizerClient client} that sends requests to the Form Recognizer service's endpoint.\n+     * Each service call goes through the {@link FormRecognizerClientBuilder#pipeline http pipeline}.\n+     *\n+     * @param client The {@link FormRecognizerClient} that the client routes its request through.\n+     */\n+    FormRecognizerClient(FormRecognizerAsyncClient client) {\n+        this.client = client;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails, Duration pollInterval) {\n+        return client.beginExtractReceiptFromUrl(sourceUrl, includeTextDetails, pollInterval).getSyncPoller();\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipt data using optical character recognition (OCR) and a prebuilt\n+     * trained receipt model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types including .pdf, .jpg, .png or .tiff type file stream.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link SyncPoller} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>>", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5MDI4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401990288", "bodyText": "Updated.", "author": "samvaity", "createdAt": "2020-04-02T00:43:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2NjE5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2ODMwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401068308", "bodyText": "I believe this is wrong in other places too, as I've seen it, this should be updated to something similar as the following.\n* <p>If {@code logOptions} isn't provided, the default options will use {@link HttpLogDetailLevel#NONE} which will prevent logging.</p>", "author": "alzimmermsft", "createdAt": "2020-03-31T16:56:35Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,337 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.ContentType;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = ContentType.APPLICATION_JSON;\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String FORM_RECOGNIZER_PROPERTIES = \"azure-ai-formrecognizer.properties\";\n+    static final String OCP_APIM_SUBSCRIPTION_KEY = \"Ocp-Apim-Subscription-Key\";\n+\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private AzureKeyCredential credential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(FORM_RECOGNIZER_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");\n+\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+\n+        HttpPipeline pipeline = httpPipeline;\n+        // Create a default Pipeline if it is not given\n+        if (pipeline == null) {\n+            // Closest to API goes first, closest to wire goes last.\n+            final List<HttpPipelinePolicy> policies = new ArrayList<>();\n+\n+            // Authentications\n+            if (credential != null) {\n+                policies.add(new AzureKeyCredentialPolicy(OCP_APIM_SUBSCRIPTION_KEY, credential));\n+            } else {\n+                // Throw exception that credential and tokenCredential cannot be null\n+                throw logger.logExceptionAsError(\n+                    new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+            }\n+\n+            policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion,\n+                buildConfiguration));\n+            policies.add(new RequestIdPolicy());\n+            policies.add(new AddHeadersPolicy(headers));\n+\n+            HttpPolicyProviders.addBeforeRetryPolicies(policies);\n+            policies.add(retryPolicy == null ? DEFAULT_RETRY_POLICY : retryPolicy);\n+            policies.addAll(this.policies);\n+            HttpPolicyProviders.addAfterRetryPolicies(policies);\n+\n+            policies.add(new AddDatePolicy());\n+            policies.add(new HttpLoggingPolicy(httpLogOptions));\n+\n+            pipeline = new HttpPipelineBuilder()\n+                .policies(policies.toArray(new HttpPipelinePolicy[0]))\n+                .httpClient(httpClient)\n+                .build();\n+        }\n+\n+        final FormRecognizerClientImpl formRecognizerAPI = new FormRecognizerClientImplBuilder()\n+            .endpoint(endpoint)\n+            .pipeline(pipeline)\n+            .build();\n+\n+        return new FormRecognizerAsyncClient(formRecognizerAPI, serviceVersion);\n+    }\n+\n+    /**\n+     * Sets the service endpoint for the Azure Form Recognizer instance.\n+     *\n+     * @param endpoint The URL of the Azure Form Recognizer instance service requests to and receive responses from.\n+     * @return The updated FormRecognizerClientBuilder object.\n+     * @throws NullPointerException if {@code endpoint} is null\n+     * @throws IllegalArgumentException if {@code endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClientBuilder endpoint(String endpoint) {\n+        Objects.requireNonNull(endpoint, \"'endpoint' cannot be null.\");\n+\n+        try {\n+            new URL(endpoint);\n+        } catch (MalformedURLException ex) {\n+            throw logger.logExceptionAsWarning(new IllegalArgumentException(\"'endpoint' must be a valid URL.\", ex));\n+        }\n+\n+        if (endpoint.endsWith(\"/\")) {\n+            this.endpoint = endpoint.substring(0, endpoint.length() - 1);\n+        } else {\n+            this.endpoint = endpoint;\n+        }\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the credential to use when authenticating HTTP requests for this FormRecognizerClientBuilder.\n+     *\n+     * @param apiKeyCredential API key credential\n+     *\n+     * @return The updated FormRecognizerClientBuilder object.\n+     * @throws NullPointerException If {@code apiKeyCredential} is {@code null}\n+     */\n+    public FormRecognizerClientBuilder apiKey(AzureKeyCredential apiKeyCredential) {\n+        this.credential = Objects.requireNonNull(apiKeyCredential, \"'apiKeyCredential' cannot be null.\");\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the logging configuration for HTTP requests and responses.\n+     *\n+     * <p> If logLevel is not provided, default value of {@link HttpLogDetailLevel#NONE} is set. </p>", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA2OTI0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401069249", "bodyText": "Should we link to the default RetryPolicy? {@link RetryPolicy#RetryPolicy()}", "author": "alzimmermsft", "createdAt": "2020-03-31T16:57:57Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,337 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.ContentType;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = ContentType.APPLICATION_JSON;\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String FORM_RECOGNIZER_PROPERTIES = \"azure-ai-formrecognizer.properties\";\n+    static final String OCP_APIM_SUBSCRIPTION_KEY = \"Ocp-Apim-Subscription-Key\";\n+\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private AzureKeyCredential credential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(FORM_RECOGNIZER_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");\n+\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+\n+        HttpPipeline pipeline = httpPipeline;\n+        // Create a default Pipeline if it is not given\n+        if (pipeline == null) {\n+            // Closest to API goes first, closest to wire goes last.\n+            final List<HttpPipelinePolicy> policies = new ArrayList<>();\n+\n+            // Authentications\n+            if (credential != null) {\n+                policies.add(new AzureKeyCredentialPolicy(OCP_APIM_SUBSCRIPTION_KEY, credential));\n+            } else {\n+                // Throw exception that credential and tokenCredential cannot be null\n+                throw logger.logExceptionAsError(\n+                    new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+            }\n+\n+            policies.add(new UserAgentPolicy(httpLogOptions.getApplicationId(), clientName, clientVersion,\n+                buildConfiguration));\n+            policies.add(new RequestIdPolicy());\n+            policies.add(new AddHeadersPolicy(headers));\n+\n+            HttpPolicyProviders.addBeforeRetryPolicies(policies);\n+            policies.add(retryPolicy == null ? DEFAULT_RETRY_POLICY : retryPolicy);\n+            policies.addAll(this.policies);\n+            HttpPolicyProviders.addAfterRetryPolicies(policies);\n+\n+            policies.add(new AddDatePolicy());\n+            policies.add(new HttpLoggingPolicy(httpLogOptions));\n+\n+            pipeline = new HttpPipelineBuilder()\n+                .policies(policies.toArray(new HttpPipelinePolicy[0]))\n+                .httpClient(httpClient)\n+                .build();\n+        }\n+\n+        final FormRecognizerClientImpl formRecognizerAPI = new FormRecognizerClientImplBuilder()\n+            .endpoint(endpoint)\n+            .pipeline(pipeline)\n+            .build();\n+\n+        return new FormRecognizerAsyncClient(formRecognizerAPI, serviceVersion);\n+    }\n+\n+    /**\n+     * Sets the service endpoint for the Azure Form Recognizer instance.\n+     *\n+     * @param endpoint The URL of the Azure Form Recognizer instance service requests to and receive responses from.\n+     * @return The updated FormRecognizerClientBuilder object.\n+     * @throws NullPointerException if {@code endpoint} is null\n+     * @throws IllegalArgumentException if {@code endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClientBuilder endpoint(String endpoint) {\n+        Objects.requireNonNull(endpoint, \"'endpoint' cannot be null.\");\n+\n+        try {\n+            new URL(endpoint);\n+        } catch (MalformedURLException ex) {\n+            throw logger.logExceptionAsWarning(new IllegalArgumentException(\"'endpoint' must be a valid URL.\", ex));\n+        }\n+\n+        if (endpoint.endsWith(\"/\")) {\n+            this.endpoint = endpoint.substring(0, endpoint.length() - 1);\n+        } else {\n+            this.endpoint = endpoint;\n+        }\n+\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the credential to use when authenticating HTTP requests for this FormRecognizerClientBuilder.\n+     *\n+     * @param apiKeyCredential API key credential\n+     *\n+     * @return The updated FormRecognizerClientBuilder object.\n+     * @throws NullPointerException If {@code apiKeyCredential} is {@code null}\n+     */\n+    public FormRecognizerClientBuilder apiKey(AzureKeyCredential apiKeyCredential) {\n+        this.credential = Objects.requireNonNull(apiKeyCredential, \"'apiKeyCredential' cannot be null.\");\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the logging configuration for HTTP requests and responses.\n+     *\n+     * <p> If logLevel is not provided, default value of {@link HttpLogDetailLevel#NONE} is set. </p>\n+     *\n+     * @param logOptions The logging configuration to use when sending and receiving HTTP requests/responses.\n+     *\n+     * @return The updated FormRecognizerClientBuilder object.\n+     */\n+    public FormRecognizerClientBuilder httpLogOptions(HttpLogOptions logOptions) {\n+        this.httpLogOptions = logOptions;\n+        return this;\n+    }\n+\n+    /**\n+     * Adds a policy to the set of existing policies that are executed after required policies.\n+     *\n+     * @param policy The retry policy for service requests.\n+     *\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     * @throws NullPointerException If {@code policy} is {@code null}.\n+     */\n+    public FormRecognizerClientBuilder addPolicy(HttpPipelinePolicy policy) {\n+        policies.add(Objects.requireNonNull(policy, \"'policy' cannot be null.\"));\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the HTTP client to use for sending and receiving requests to and from the service.\n+     *\n+     * @param client The HTTP client to use for requests.\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     */\n+    public FormRecognizerClientBuilder httpClient(HttpClient client) {\n+        if (this.httpClient != null && client == null) {\n+            logger.info(\"HttpClient is being set to 'null' when it was previously configured.\");\n+        }\n+\n+        this.httpClient = client;\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the HTTP pipeline to use for the service client.\n+     * <p>\n+     * If {@code pipeline} is set, all other settings are ignored, aside from\n+     * {@link FormRecognizerClientBuilder#endpoint(String) endpoint} to build {@link FormRecognizerAsyncClient} or\n+     * {@link FormRecognizerClient}.\n+     *\n+     * @param httpPipeline The HTTP pipeline to use for sending service requests and receiving responses.\n+     *\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     */\n+    public FormRecognizerClientBuilder pipeline(HttpPipeline httpPipeline) {\n+        if (this.httpPipeline != null && httpPipeline == null) {\n+            logger.info(\"HttpPipeline is being set to 'null' when it was previously configured.\");\n+        }\n+\n+        this.httpPipeline = httpPipeline;\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the configuration store that is used during construction of the service client.\n+     * <p>\n+     * The default configuration store is a clone of the {@link Configuration#getGlobalConfiguration() global\n+     * configuration store}, use {@link Configuration#NONE} to bypass using configuration settings during construction.\n+     *\n+     * @param configuration The configuration store used to\n+     *\n+     * @return The updated FormRecognizerClientImplBuilder object.\n+     */\n+    public FormRecognizerClientBuilder configuration(Configuration configuration) {\n+        this.configuration = configuration;\n+        return this;\n+    }\n+\n+    /**\n+     * Sets the {@link RetryPolicy} that is used when each request is sent.\n+     * <p>\n+     * The default retry policy will be used if not provided {@link FormRecognizerClientBuilder#buildAsyncClient()}", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MTAxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401071013", "bodyText": "Isn't the pattern matching on all non-digit characters? The regex is [NOT 0-9] match one or more consecutive.", "author": "alzimmermsft", "createdAt": "2020-03-31T17:00:41Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/Transforms.java", "diffHunk": "@@ -0,0 +1,310 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeResult;\n+import com.azure.ai.formrecognizer.implementation.models.DocumentResult;\n+import com.azure.ai.formrecognizer.implementation.models.ReadResult;\n+import com.azure.ai.formrecognizer.implementation.models.TextLine;\n+import com.azure.ai.formrecognizer.implementation.models.TextWord;\n+import com.azure.ai.formrecognizer.models.BoundingBox;\n+import com.azure.ai.formrecognizer.models.DimensionUnit;\n+import com.azure.ai.formrecognizer.models.Element;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FieldValue;\n+import com.azure.ai.formrecognizer.models.FloatValue;\n+import com.azure.ai.formrecognizer.models.IntegerValue;\n+import com.azure.ai.formrecognizer.models.LineElement;\n+import com.azure.ai.formrecognizer.models.PageMetadata;\n+import com.azure.ai.formrecognizer.models.PageRange;\n+import com.azure.ai.formrecognizer.models.Point;\n+import com.azure.ai.formrecognizer.models.ReceiptItem;\n+import com.azure.ai.formrecognizer.models.ReceiptType;\n+import com.azure.ai.formrecognizer.models.StringValue;\n+import com.azure.ai.formrecognizer.models.TextLanguage;\n+import com.azure.ai.formrecognizer.models.WordElement;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.regex.Pattern;\n+\n+/**\n+ * Helper class to convert service level models to SDK exposed models.\n+ */\n+final class Transforms {\n+    private static final ClientLogger LOGGER = new ClientLogger(Transforms.class);\n+    // Pattern match to find all digits in the provided string.", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTI3NjYzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401276639", "bodyText": "yup, updated!", "author": "samvaity", "createdAt": "2020-03-31T23:41:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA3MTAxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA4Mzk3NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401083975", "bodyText": "NIT: headers used only once.", "author": "mssfang", "createdAt": "2020-03-31T17:21:23Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,241 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncHeaders;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are language detection, sentiment analysis, and recognition entities, PII entities,\n+ * and linked entities of a text input or list of test inputs.\n+ *\n+ * <p><strong>Instantiating an asynchronous Form Recognizer Client</strong></p>\n+ * TODO: codesnippet\n+ *\n+ * <p>View {@link FormRecognizerClientBuilder} for additional ways to construct the client.</p>\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)}  http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails,\n+                               Duration pollInterval) {\n+        Objects.requireNonNull(sourceUrl, \"'sourceUrl' is required and cannot be null.\");\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(5);\n+        return new PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult(includeTextDetails));\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts data using optical character recognition (OCR) and a prebuilt receipt\n+     * trained model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param data The data of the document to be extract receipt information from.\n+     * @param length The exact length of the data. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param formContentType Supported Media types including .pdf, .jpg, .png or .tiff type file stream.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceipt(\n+        Flux<ByteBuffer> data, long length, boolean includeTextDetails, FormContentType formContentType,\n+        Duration pollInterval) {\n+        Objects.requireNonNull(data, \"'data' is required and cannot be null.\");\n+\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(5);\n+        return new PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>(interval,\n+            receiptStreamActivationOperation(data, length, formContentType, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),\n+            fetchExtractReceiptResult(includeTextDetails));\n+    }\n+\n+    private Function<PollingContext<OperationResult>, Mono<OperationResult>> receiptAnalyzeActivationOperation(\n+        String sourceUrl, boolean includeTextDetails) {\n+        return (pollingContext) -> {\n+            try {\n+                return service.analyzeReceiptAsyncWithResponseAsync(includeTextDetails,\n+                    new SourcePath().setSource(sourceUrl))\n+                    .map(response -> {\n+                        final AnalyzeReceiptAsyncHeaders headers = response.getDeserializedHeaders();", "originalCommit": "e550685a367496584a0b2b2c57577a4202eb7283", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "766b5f6882f710a2b20c58b7a6899e02941ce8f6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/766b5f6882f710a2b20c58b7a6899e02941ce8f6", "message": "add extracted fields map", "committedDate": "2020-03-31T23:12:12Z", "type": "commit"}, {"oid": "9eb295c5e0b837f6bfbbe2de5685b6e33909dad5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9eb295c5e0b837f6bfbbe2de5685b6e33909dad5", "message": "swagger changes codegen update", "committedDate": "2020-04-01T00:55:28Z", "type": "commit"}, {"oid": "8b18723908b51ce6b0603c8cca46f380959a753a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b18723908b51ce6b0603c8cca46f380959a753a", "message": "Invalid source url test", "committedDate": "2020-04-01T18:26:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5MDk1OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401890959", "bodyText": "javadoc: these doc should change to FormRecognizer specifically.", "author": "mssfang", "createdAt": "2020-04-01T20:31:14Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,98 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,", "originalCommit": "8b18723908b51ce6b0603c8cca46f380959a753a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTg5OTc0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401899745", "bodyText": "using \"{@link FormRecognizerClient client}\" will be a better choice.", "author": "mssfang", "createdAt": "2020-04-01T20:48:03Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,98 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {\n+    private final FormRecognizerAsyncClient client;\n+\n+    /**\n+     * Create a {@code FormRecognizerClient client} that sends requests to the Form Recognizer service's endpoint.", "originalCommit": "8b18723908b51ce6b0603c8cca46f380959a753a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkyMjY1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401922651", "bodyText": "extra \"with an\"", "author": "mssfang", "createdAt": "2020-04-01T21:32:20Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -0,0 +1,98 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.Utility;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.polling.SyncPoller;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+\n+/**\n+ * This class provides a synchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, detect language, recognize entities, recognize PII entities,\n+ * recognize linked entities, and analyze sentiment for a text input or a list of text inputs.\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class)\n+public final class FormRecognizerClient {\n+    private final FormRecognizerAsyncClient client;\n+\n+    /**\n+     * Create a {@code FormRecognizerClient client} that sends requests to the Form Recognizer service's endpoint.\n+     * Each service call goes through the {@link FormRecognizerClientBuilder#pipeline http pipeline}.\n+     *\n+     * @param client The {@link FormRecognizerClient} that the client routes its request through.\n+     */\n+    FormRecognizerClient(FormRecognizerAsyncClient client) {\n+        this.client = client;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * with an error message indicating absence of cancellation support</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link SyncPoller} to poll the progress of the extract receipt operation until it has completed,\n+     * has failed, or has been cancelled.\n+     */\n+    public SyncPoller<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails, Duration pollInterval) {\n+        return client.beginExtractReceiptFromUrl(sourceUrl, includeTextDetails, pollInterval).getSyncPoller();\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipt data using optical character recognition (OCR) and a prebuilt\n+     * trained receipt model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an", "originalCommit": "8b18723908b51ce6b0603c8cca46f380959a753a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk5OTAwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401999008", "bodyText": "you have two \"with an\", end of this line and start of next line.", "author": "mssfang", "createdAt": "2020-04-02T01:15:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkyMjY1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkyMzg0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401923847", "bodyText": "extra line break is not needed here, can be append this line after last one.", "author": "mssfang", "createdAt": "2020-04-01T21:34:49Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,338 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.ContentType;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential)} gives\n+ * the builder access credential.", "originalCommit": "8b18723908b51ce6b0603c8cca46f380959a753a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkyNDc3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r401924772", "bodyText": "this authentication can be moved to after\nHttpPolicyProviders.addBeforeRetryPolicies(policies);\n\nwhich will fixes #9608 for Form Recognizer.\ncc: @alzimmermsft", "author": "mssfang", "createdAt": "2020-04-01T21:36:50Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClientBuilder.java", "diffHunk": "@@ -0,0 +1,338 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImplBuilder;\n+import com.azure.core.annotation.ServiceClientBuilder;\n+import com.azure.core.credential.AzureKeyCredential;\n+import com.azure.core.http.ContentType;\n+import com.azure.core.http.HttpClient;\n+import com.azure.core.http.HttpHeaders;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.AddDatePolicy;\n+import com.azure.core.http.policy.AddHeadersPolicy;\n+import com.azure.core.http.policy.AzureKeyCredentialPolicy;\n+import com.azure.core.http.policy.HttpLogDetailLevel;\n+import com.azure.core.http.policy.HttpLogOptions;\n+import com.azure.core.http.policy.HttpLoggingPolicy;\n+import com.azure.core.http.policy.HttpPipelinePolicy;\n+import com.azure.core.http.policy.HttpPolicyProviders;\n+import com.azure.core.http.policy.RequestIdPolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.util.Configuration;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.net.MalformedURLException;\n+import java.net.URL;\n+import java.time.temporal.ChronoUnit;\n+import java.util.ArrayList;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Objects;\n+\n+/**\n+ * This class provides a fluent builder API to help instantiation of {@link FormRecognizerClient FormRecognizerClients}\n+ * and {@link FormRecognizerAsyncClient FormRecognizerAsyncClients}, call {@link #buildClient()} buildClient} and\n+ * {@link #buildAsyncClient() buildAsyncClient} respectively to construct an instance of the desired client.\n+ *\n+ * <p>\n+ * The client needs the service endpoint of the Azure Form Recognizer to access the resource service.\n+ * {@link #apiKey(AzureKeyCredential)} gives\n+ * the builder access credential.\n+ * </p>\n+ * <p>\n+ * Another way to construct the client is using a {@link HttpPipeline}. The pipeline gives the client an\n+ * authenticated way to communicate with the service. Set the pipeline with {@link #pipeline(HttpPipeline) this} and\n+ * set the service endpoint with {@link #endpoint(String) this}. Using a\n+ * pipeline requires additional setup but allows for finer control on how the {@link FormRecognizerClient} and\n+ * {@link FormRecognizerAsyncClient} is built.\n+ * </p>\n+ *\n+ * @see FormRecognizerAsyncClient\n+ * @see FormRecognizerClient\n+ */\n+@ServiceClientBuilder(serviceClients = {FormRecognizerAsyncClient.class, FormRecognizerClient.class})\n+public final class FormRecognizerClientBuilder {\n+\n+    private static final String ECHO_REQUEST_ID_HEADER = \"x-ms-return-client-request-id\";\n+    private static final String CONTENT_TYPE_HEADER_VALUE = ContentType.APPLICATION_JSON;\n+    private static final String ACCEPT_HEADER = \"Accept\";\n+    private static final String FORM_RECOGNIZER_PROPERTIES = \"azure-ai-formrecognizer.properties\";\n+    static final String OCP_APIM_SUBSCRIPTION_KEY = \"Ocp-Apim-Subscription-Key\";\n+\n+    private static final String NAME = \"name\";\n+    private static final String VERSION = \"version\";\n+    private static final RetryPolicy DEFAULT_RETRY_POLICY = new RetryPolicy(\"retry-after-ms\", ChronoUnit.MILLIS);\n+\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerClientBuilder.class);\n+    private final List<HttpPipelinePolicy> policies;\n+    private final HttpHeaders headers;\n+    private final String clientName;\n+    private final String clientVersion;\n+\n+    private String endpoint;\n+    private AzureKeyCredential credential;\n+    private HttpClient httpClient;\n+    private HttpLogOptions httpLogOptions;\n+    private HttpPipeline httpPipeline;\n+    private Configuration configuration;\n+    private RetryPolicy retryPolicy;\n+    private FormRecognizerServiceVersion version;\n+\n+    /**\n+     * The constructor with defaults.\n+     */\n+    public FormRecognizerClientBuilder() {\n+        policies = new ArrayList<>();\n+        httpLogOptions = new HttpLogOptions();\n+\n+        Map<String, String> properties = CoreUtils.getProperties(FORM_RECOGNIZER_PROPERTIES);\n+        clientName = properties.getOrDefault(NAME, \"UnknownName\");\n+        clientVersion = properties.getOrDefault(VERSION, \"UnknownVersion\");\n+\n+        headers = new HttpHeaders()\n+            .put(ECHO_REQUEST_ID_HEADER, \"true\")\n+            .put(ACCEPT_HEADER, CONTENT_TYPE_HEADER_VALUE);\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerClient} based on options set in the builder. Every time\n+     * {@code buildClient()} is called a new instance of {@link FormRecognizerClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored\n+     * </p>\n+     *\n+     * @return A FormRecognizerClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerClient buildClient() {\n+        return new FormRecognizerClient(buildAsyncClient());\n+    }\n+\n+    /**\n+     * Creates a {@link FormRecognizerAsyncClient} based on options set in the builder. Every time\n+     * {@code buildAsyncClient()} is called a new instance of {@link FormRecognizerAsyncClient} is created.\n+     *\n+     * <p>\n+     * If {@link #pipeline(HttpPipeline) pipeline} is set, then the {@code pipeline} and\n+     * {@link #endpoint(String) endpoint} are used to create the {@link FormRecognizerClient client}. All other builder\n+     * settings are ignored.\n+     * </p>\n+     *\n+     * @return A FormRecognizerAsyncClient with the options set from the builder.\n+     * @throws NullPointerException if {@link #endpoint(String) endpoint} or\n+     * {@link #apiKey(AzureKeyCredential) apiKey} has not been set.\n+     * @throws IllegalArgumentException if {@link #endpoint(String) endpoint} cannot be parsed into a valid URL.\n+     */\n+    public FormRecognizerAsyncClient buildAsyncClient() {\n+        Objects.requireNonNull(endpoint, \"'Endpoint' is required and can not be null.\");\n+\n+        // Global Env configuration store\n+        final Configuration buildConfiguration = (configuration == null)\n+            ? Configuration.getGlobalConfiguration().clone() : configuration;\n+        // Service Version\n+        final FormRecognizerServiceVersion serviceVersion =\n+            version != null ? version : FormRecognizerServiceVersion.getLatest();\n+\n+        // Endpoint cannot be null, which is required in request authentication\n+\n+        HttpPipeline pipeline = httpPipeline;\n+        // Create a default Pipeline if it is not given\n+        if (pipeline == null) {\n+            // Closest to API goes first, closest to wire goes last.\n+            final List<HttpPipelinePolicy> policies = new ArrayList<>();\n+\n+            // Authentications\n+            if (credential != null) {\n+                policies.add(new AzureKeyCredentialPolicy(OCP_APIM_SUBSCRIPTION_KEY, credential));\n+            } else {\n+                // Throw exception that credential and tokenCredential cannot be null\n+                throw logger.logExceptionAsError(\n+                    new IllegalArgumentException(\"Missing credential information while building a client.\"));\n+            }", "originalCommit": "8b18723908b51ce6b0603c8cca46f380959a753a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjYxNjY1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r402616654", "bodyText": "updated.", "author": "samvaity", "createdAt": "2020-04-02T21:50:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTkyNDc3Mg=="}], "type": "inlineReview"}, {"oid": "6db10aa28c213fc3f80fcb11cd1c84f49af57a4d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6db10aa28c213fc3f80fcb11cd1c84f49af57a4d", "message": "update test resource", "committedDate": "2020-04-02T00:14:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUxNjQyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r402516420", "bodyText": "nit: use FluxUtil.monoError() as that will also log the exception.", "author": "srnagar", "createdAt": "2020-04-02T18:14:34Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -0,0 +1,249 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.ai.formrecognizer;\n+\n+import com.azure.ai.formrecognizer.implementation.FormRecognizerClientImpl;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.models.ExtractedReceipt;\n+import com.azure.ai.formrecognizer.models.FormContentType;\n+import com.azure.ai.formrecognizer.models.OperationResult;\n+import com.azure.core.annotation.ServiceClient;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.CoreUtils;\n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+import com.azure.core.util.polling.LongRunningOperationStatus;\n+import com.azure.core.util.polling.PollResponse;\n+import com.azure.core.util.polling.PollerFlux;\n+import com.azure.core.util.polling.PollingContext;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+import java.util.UUID;\n+import java.util.function.Function;\n+\n+import static com.azure.ai.formrecognizer.Transforms.toReceipt;\n+import static com.azure.core.util.FluxUtil.monoError;\n+\n+/**\n+ * This class provides an asynchronous client that contains all the operations that apply to Azure Form Recognizer.\n+ * Operations allowed by the client are, to extract receipt data fields from receipt documents.\n+ *\n+ * @see FormRecognizerClientBuilder\n+ */\n+@ServiceClient(builder = FormRecognizerClientBuilder.class, isAsync = true)\n+public final class FormRecognizerAsyncClient {\n+    private final ClientLogger logger = new ClientLogger(FormRecognizerAsyncClient.class);\n+    private final FormRecognizerClientImpl service;\n+    private final FormRecognizerServiceVersion serviceVersion;\n+\n+    /**\n+     * Create a {@code FormRecognizerAsyncClient} that sends requests to the Form Recognizer services's endpoint. Each\n+     * service call goes through the {@link FormRecognizerClientBuilder#pipeline(HttpPipeline)} http pipeline}.\n+     *\n+     * @param service The proxy service used to perform REST calls.\n+     * @param serviceVersion The versions of Azure Form Recognizer supported by this client library.\n+     */\n+    FormRecognizerAsyncClient(FormRecognizerClientImpl service, FormRecognizerServiceVersion serviceVersion) {\n+        this.service = service;\n+        this.serviceVersion = serviceVersion;\n+    }\n+\n+    /**\n+     * Gets the service version the client is using.\n+     *\n+     * @return the service version the client is using.\n+     */\n+    public FormRecognizerServiceVersion getServiceVersion() {\n+        return serviceVersion;\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * error message indicating absence of cancellation support.</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>> beginExtractReceiptFromUrl(String sourceUrl) {\n+        return beginExtractReceiptFromUrl(sourceUrl, false, null);\n+    }\n+\n+    /**\n+     * Detects and extracts data from receipts using optical character recognition (OCR) and a prebuilt receipt trained\n+     * model.\n+     * <p>The service does not support cancellation of the long running operation and returns with an\n+     * error message indicating absence of cancellation support.</p>\n+     *\n+     * @param sourceUrl The source URL to the input document. Size of the file must be less than 20 MB.\n+     * @param includeTextDetails Include text lines and element references in the result.\n+     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n+     * 5 seconds is used.\n+     *\n+     * @return A {@link PollerFlux} that polls the extract receipt operation until it has completed, has failed, or has\n+     * been cancelled.\n+     */\n+    public PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>\n+        beginExtractReceiptFromUrl(String sourceUrl, boolean includeTextDetails,\n+                               Duration pollInterval) {\n+        Objects.requireNonNull(sourceUrl, \"'sourceUrl' is required and cannot be null.\");\n+        final Duration interval = pollInterval != null ? pollInterval : Duration.ofSeconds(5);\n+        return new PollerFlux<OperationResult, IterableStream<ExtractedReceipt>>(interval,\n+            receiptAnalyzeActivationOperation(sourceUrl, includeTextDetails),\n+            extractReceiptPollOperation(),\n+            (activationResponse, context) -> Mono.error(new RuntimeException(\"Cancellation is not supported\")),", "originalCommit": "6db10aa28c213fc3f80fcb11cd1c84f49af57a4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjUyMDYwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9322#discussion_r402520609", "bodyText": "Re-generate this client with the latest v4 autorest to include the Context in client method.", "author": "srnagar", "createdAt": "2020-04-02T18:21:53Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/implementation/FormRecognizerClientImpl.java", "diffHunk": "@@ -0,0 +1,418 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+// Code generated by Microsoft (R) AutoRest Code Generator.\n+\n+package com.azure.ai.formrecognizer.implementation;\n+\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeLayoutAsyncResponse;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeOperationResult;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeReceiptAsyncResponse;\n+import com.azure.ai.formrecognizer.implementation.models.AnalyzeWithCustomModelResponse;\n+import com.azure.ai.formrecognizer.implementation.models.ContentType;\n+import com.azure.ai.formrecognizer.implementation.models.Model;\n+import com.azure.ai.formrecognizer.implementation.models.ModelInfo;\n+import com.azure.ai.formrecognizer.implementation.models.Models;\n+import com.azure.ai.formrecognizer.implementation.models.SourcePath;\n+import com.azure.ai.formrecognizer.implementation.models.TrainCustomModelAsyncResponse;\n+import com.azure.ai.formrecognizer.implementation.models.TrainRequest;\n+import com.azure.core.annotation.BodyParam;\n+import com.azure.core.annotation.Delete;\n+import com.azure.core.annotation.ExpectedResponses;\n+import com.azure.core.annotation.Get;\n+import com.azure.core.annotation.HeaderParam;\n+import com.azure.core.annotation.Host;\n+import com.azure.core.annotation.HostParam;\n+import com.azure.core.annotation.PathParam;\n+import com.azure.core.annotation.Post;\n+import com.azure.core.annotation.QueryParam;\n+import com.azure.core.annotation.ReturnType;\n+import com.azure.core.annotation.ServiceInterface;\n+import com.azure.core.annotation.ServiceMethod;\n+import com.azure.core.annotation.UnexpectedResponseExceptionType;\n+import com.azure.core.exception.HttpResponseException;\n+import com.azure.core.http.HttpPipeline;\n+import com.azure.core.http.HttpPipelineBuilder;\n+import com.azure.core.http.policy.CookiePolicy;\n+import com.azure.core.http.policy.RetryPolicy;\n+import com.azure.core.http.policy.UserAgentPolicy;\n+import com.azure.core.http.rest.PagedResponse;\n+import com.azure.core.http.rest.PagedResponseBase;\n+import com.azure.core.http.rest.Response;\n+import com.azure.core.http.rest.RestProxy;\n+import com.azure.core.http.rest.SimpleResponse;\n+import com.azure.core.util.Context;\n+import com.azure.core.util.FluxUtil;\n+import java.nio.ByteBuffer;\n+import java.util.UUID;\n+import reactor.core.publisher.Flux;\n+import reactor.core.publisher.Mono;\n+\n+/**\n+ * Initializes a new instance of the FormRecognizerClient type.\n+ */\n+public final class FormRecognizerClientImpl {\n+    /**\n+     * The proxy service used to perform REST calls.\n+     */\n+    private FormRecognizerClientService service;\n+\n+    /**\n+     * Supported Cognitive Services endpoints (protocol and hostname, for example: https://westus2.api.cognitive.microsoft.com).\n+     */\n+    private String endpoint;\n+\n+    /**\n+     * Gets Supported Cognitive Services endpoints (protocol and hostname, for example: https://westus2.api.cognitive.microsoft.com).\n+     *\n+     * @return the endpoint value.\n+     */\n+    public String getEndpoint() {\n+        return this.endpoint;\n+    }\n+\n+    /**\n+     * Sets Supported Cognitive Services endpoints (protocol and hostname, for example: https://westus2.api.cognitive.microsoft.com).\n+     *\n+     * @param endpoint the endpoint value.\n+     * @return the service client itself.\n+     */\n+    FormRecognizerClientImpl setEndpoint(String endpoint) {\n+        this.endpoint = endpoint;\n+        return this;\n+    }\n+\n+    /**\n+     * The HTTP pipeline to send requests through.\n+     */\n+    private HttpPipeline httpPipeline;\n+\n+    /**\n+     * Gets The HTTP pipeline to send requests through.\n+     *\n+     * @return the httpPipeline value.\n+     */\n+    public HttpPipeline getHttpPipeline() {\n+        return this.httpPipeline;\n+    }\n+\n+    /**\n+     * Initializes an instance of FormRecognizerClient client.\n+     */\n+    public FormRecognizerClientImpl() {\n+        new HttpPipelineBuilder().policies(new UserAgentPolicy(), new RetryPolicy(), new CookiePolicy()).build();\n+    }\n+\n+    /**\n+     * Initializes an instance of FormRecognizerClient client.\n+     *\n+     * @param httpPipeline The HTTP pipeline to send requests through.\n+     */\n+    public FormRecognizerClientImpl(HttpPipeline httpPipeline) {\n+        this.httpPipeline = httpPipeline;\n+        this.service = RestProxy.create(FormRecognizerClientService.class, this.httpPipeline);\n+    }\n+\n+    /**\n+     * The interface defining all the services for FormRecognizerClient to be\n+     * used by the proxy service to perform REST calls.\n+     */\n+    @Host(\"{endpoint}/formrecognizer/v2.0-preview\")\n+    @ServiceInterface(name = \"FormRecognizerClient\")\n+    private interface FormRecognizerClientService {\n+        @Post(\"/custom/models\")\n+        @ExpectedResponses({201})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<TrainCustomModelAsyncResponse> trainCustomModelAsync(@HostParam(\"endpoint\") String endpoint, @BodyParam(\"application/json\") TrainRequest trainRequest, Context context);\n+\n+        @Get(\"/custom/models/{modelId}\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<Model>> getCustomModel(@HostParam(\"endpoint\") String endpoint, @PathParam(\"modelId\") UUID modelId, @QueryParam(\"includeKeys\") Boolean includeKeys, Context context);\n+\n+        @Delete(\"/custom/models/{modelId}\")\n+        @ExpectedResponses({204})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<Response<Void>> deleteCustomModel(@HostParam(\"endpoint\") String endpoint, @PathParam(\"modelId\") UUID modelId, Context context);\n+\n+        @Post(\"/custom/models/{modelId}/analyze\")\n+        @ExpectedResponses({202})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<AnalyzeWithCustomModelResponse> analyzeWithCustomModel(@HostParam(\"endpoint\") String endpoint, @PathParam(\"modelId\") UUID modelId, @QueryParam(\"includeTextDetails\") Boolean includeTextDetails, @HeaderParam(\"Content-Type\") ContentType contentType, @BodyParam(\"application/octet-stream\") Flux<ByteBuffer> fileStream, @HeaderParam(\"Content-Length\") Long contentLength, Context context);\n+\n+        @Post(\"/custom/models/{modelId}/analyze\")\n+        @ExpectedResponses({202})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<AnalyzeWithCustomModelResponse> analyzeWithCustomModel(@HostParam(\"endpoint\") String endpoint, @PathParam(\"modelId\") UUID modelId, @QueryParam(\"includeTextDetails\") Boolean includeTextDetails, @BodyParam(\"application/json\") SourcePath fileStream, Context context);\n+\n+        @Get(\"/custom/models/{modelId}/analyzeResults/{resultId}\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<AnalyzeOperationResult>> getAnalyzeFormResult(@HostParam(\"endpoint\") String endpoint, @PathParam(\"modelId\") UUID modelId, @PathParam(\"resultId\") UUID resultId, Context context);\n+\n+        @Post(\"/prebuilt/receipt/analyze\")\n+        @ExpectedResponses({202})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<AnalyzeReceiptAsyncResponse> analyzeReceiptAsync(@HostParam(\"endpoint\") String endpoint, @QueryParam(\"includeTextDetails\") Boolean includeTextDetails, @BodyParam(\"application/json\") SourcePath fileStream, Context context);\n+\n+        @Post(\"/prebuilt/receipt/analyze\")\n+        @ExpectedResponses({202})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<AnalyzeReceiptAsyncResponse> analyzeReceiptAsync(@HostParam(\"endpoint\") String endpoint, @QueryParam(\"includeTextDetails\") Boolean includeTextDetails, @HeaderParam(\"Content-Type\") ContentType contentType, @BodyParam(\"application/octet-stream\") Flux<ByteBuffer> fileStream, @HeaderParam(\"Content-Length\") Long contentLength, Context context);\n+\n+        @Get(\"/prebuilt/receipt/analyzeResults/{resultId}\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<AnalyzeOperationResult>> getAnalyzeReceiptResult(@HostParam(\"endpoint\") String endpoint, @PathParam(\"resultId\") UUID resultId, Context context);\n+\n+        @Post(\"/layout/analyze\")\n+        @ExpectedResponses({202})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<AnalyzeLayoutAsyncResponse> analyzeLayoutAsync(@HostParam(\"endpoint\") String endpoint, @HeaderParam(\"Content-Type\") ContentType contentType, @BodyParam(\"application/octet-stream\") Flux<ByteBuffer> fileStream, @HeaderParam(\"Content-Length\") Long contentLength, Context context);\n+\n+        @Post(\"/layout/analyze\")\n+        @ExpectedResponses({202})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<AnalyzeLayoutAsyncResponse> analyzeLayoutAsync(@HostParam(\"endpoint\") String endpoint, @BodyParam(\"application/json\") SourcePath fileStream, Context context);\n+\n+        @Get(\"/layout/analyzeResults/{resultId}\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<AnalyzeOperationResult>> getAnalyzeLayoutResult(@HostParam(\"endpoint\") String endpoint, @PathParam(\"resultId\") UUID resultId, Context context);\n+\n+        @Get(\"/custom/models\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<Models>> listCustomModels(@HostParam(\"endpoint\") String endpoint, @QueryParam(\"op\") String op, Context context);\n+\n+        @Get(\"/custom/models\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<Models>> getCustomModels(@HostParam(\"endpoint\") String endpoint, @QueryParam(\"op\") String op, Context context);\n+\n+        @Get(\"{nextLink}\")\n+        @ExpectedResponses({200})\n+        @UnexpectedResponseExceptionType(HttpResponseException.class)\n+        Mono<SimpleResponse<Models>> listCustomModelsNext(@PathParam(value = \"nextLink\", encoded = true) String nextLink, Context context);\n+    }\n+\n+    /**\n+     * Create and train a custom model. The request must include a source parameter that is either an externally accessible Azure storage blob container Uri (preferably a Shared Access Signature Uri) or valid path to a data folder in a locally mounted drive. When local paths are specified, they must follow the Linux/Unix path format and be an absolute path rooted to the input mount configuration setting value e.g., if '{Mounts:Input}' configuration setting value is '/input' then a valid source path would be '/input/contosodataset'. All data to be trained is expected to be under the source folder or sub folders under it. Models are trained using documents that are of the following content type - 'application/pdf', 'image/jpeg', 'image/png', 'image/tiff'. Other type of content is ignored.\n+     *\n+     * @param trainRequest Request parameter to train a new custom model.\n+     * @throws IllegalArgumentException thrown if parameters fail the validation.\n+     * @throws HttpResponseException thrown if the request is rejected by server.\n+     * @throws RuntimeException all other wrapped checked exceptions if the request fails to be sent.\n+     */\n+    @ServiceMethod(returns = ReturnType.SINGLE)\n+    public Mono<TrainCustomModelAsyncResponse> trainCustomModelAsyncWithResponseAsync(TrainRequest trainRequest) {", "originalCommit": "6db10aa28c213fc3f80fcb11cd1c84f49af57a4d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "afb06564f666d8c676cccbac49294f5aae540e03", "url": "https://github.com/Azure/azure-sdk-for-java/commit/afb06564f666d8c676cccbac49294f5aae540e03", "message": "regenerated client impl", "committedDate": "2020-04-02T21:47:56Z", "type": "commit"}, {"oid": "7cd08d28bcf6d72d5fcf18f194af94b1c3435970", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7cd08d28bcf6d72d5fcf18f194af94b1c3435970", "message": "move date retry policy", "committedDate": "2020-04-02T22:33:09Z", "type": "commit"}]}