{"pr_number": 8186, "pr_title": "Added test.yml file for live test pipeline", "pr_createdAt": "2020-02-13T20:28:21Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8186", "timeline": [{"oid": "494fbf5cbc5b46a07894173dd8302c160a96ad02", "url": "https://github.com/Azure/azure-sdk-for-java/commit/494fbf5cbc5b46a07894173dd8302c160a96ad02", "message": "test if the live tests can run", "committedDate": "2020-02-14T00:58:32Z", "type": "forcePushed"}, {"oid": "5961c95ecf940ff4851085ba5e0175deaa61d01e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5961c95ecf940ff4851085ba5e0175deaa61d01e", "message": "pre run step", "committedDate": "2020-02-14T01:34:30Z", "type": "forcePushed"}, {"oid": "537743393869f78fff994eb4c1bc0a7a44e45183", "url": "https://github.com/Azure/azure-sdk-for-java/commit/537743393869f78fff994eb4c1bc0a7a44e45183", "message": "pre run step", "committedDate": "2020-02-14T01:36:11Z", "type": "forcePushed"}, {"oid": "e54fb2a73d7cb06e38a4be297db7ba9564b9eaea", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e54fb2a73d7cb06e38a4be297db7ba9564b9eaea", "message": "pre run step", "committedDate": "2020-02-14T01:37:27Z", "type": "forcePushed"}, {"oid": "e452cdc8cccf05ae7ccba146c046fdcb9f8ba672", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e452cdc8cccf05ae7ccba146c046fdcb9f8ba672", "message": "pre run step", "committedDate": "2020-02-14T01:39:42Z", "type": "forcePushed"}, {"oid": "e7b926cf1f76bf19bfc504f2d5150b41ab057146", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e7b926cf1f76bf19bfc504f2d5150b41ab057146", "message": "pre run step", "committedDate": "2020-02-14T01:40:50Z", "type": "forcePushed"}, {"oid": "869d7e31dc965fff2af4588e4f4a82618654bd33", "url": "https://github.com/Azure/azure-sdk-for-java/commit/869d7e31dc965fff2af4588e4f4a82618654bd33", "message": "pre run step", "committedDate": "2020-02-14T01:44:31Z", "type": "forcePushed"}, {"oid": "6f71980b01cc9831792eea0f1b69ea1674908ea8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6f71980b01cc9831792eea0f1b69ea1674908ea8", "message": "pre run step", "committedDate": "2020-02-14T01:47:55Z", "type": "forcePushed"}, {"oid": "90ff0f11ea676b38f2d858e9bfbe6802664a577b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/90ff0f11ea676b38f2d858e9bfbe6802664a577b", "message": "pre run step", "committedDate": "2020-02-14T01:55:44Z", "type": "forcePushed"}, {"oid": "3a6ff5e52abb9ec6d22230eeabef0cb6a056e75e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a6ff5e52abb9ec6d22230eeabef0cb6a056e75e", "message": "pre run step", "committedDate": "2020-02-14T02:03:34Z", "type": "forcePushed"}, {"oid": "40ef831ba1bca08077f6d7d9fb7ad670aa958a76", "url": "https://github.com/Azure/azure-sdk-for-java/commit/40ef831ba1bca08077f6d7d9fb7ad670aa958a76", "message": "pre run step", "committedDate": "2020-02-14T02:05:47Z", "type": "forcePushed"}, {"oid": "b9aa09453a7dd74d63830b5fbc20215c847d3f57", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9aa09453a7dd74d63830b5fbc20215c847d3f57", "message": "pre run step", "committedDate": "2020-02-14T02:07:22Z", "type": "forcePushed"}, {"oid": "278d7a3bb154880a58f8f815df9fa57b6adb8445", "url": "https://github.com/Azure/azure-sdk-for-java/commit/278d7a3bb154880a58f8f815df9fa57b6adb8445", "message": "pre run step", "committedDate": "2020-02-14T02:10:27Z", "type": "forcePushed"}, {"oid": "417f6f17d0576057efa133ec6ae27b1df54700d9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/417f6f17d0576057efa133ec6ae27b1df54700d9", "message": "pre run step", "committedDate": "2020-02-14T02:12:25Z", "type": "forcePushed"}, {"oid": "cf8cef8ad9e1e87193c7728cf4544575e804c179", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cf8cef8ad9e1e87193c7728cf4544575e804c179", "message": "pre run step", "committedDate": "2020-02-14T02:15:14Z", "type": "forcePushed"}, {"oid": "eca520cd9bb0c76d03dfd4ecef6be06c2a67506f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/eca520cd9bb0c76d03dfd4ecef6be06c2a67506f", "message": "pre run step", "committedDate": "2020-02-14T02:16:37Z", "type": "forcePushed"}, {"oid": "33defa639d6c89651a47912cc5ea5fc5c076a5cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/33defa639d6c89651a47912cc5ea5fc5c076a5cf", "message": "pre run step", "committedDate": "2020-02-14T02:18:35Z", "type": "forcePushed"}, {"oid": "8b013c19277bb33a1f05a0abdc3bb0f893b100b2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8b013c19277bb33a1f05a0abdc3bb0f893b100b2", "message": "pre run step", "committedDate": "2020-02-14T02:19:43Z", "type": "forcePushed"}, {"oid": "10696afa4a415c3915e8770c9db32a7c9a6e7bf1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/10696afa4a415c3915e8770c9db32a7c9a6e7bf1", "message": "pre run step", "committedDate": "2020-02-14T02:20:28Z", "type": "forcePushed"}, {"oid": "46255c57abc258db0f160c594e2f3eca9bee4b4b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/46255c57abc258db0f160c594e2f3eca9bee4b4b", "message": "pre run step", "committedDate": "2020-02-14T02:24:29Z", "type": "forcePushed"}, {"oid": "0ef587d30e24701f23f9431e97ad15ab03beb3cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0ef587d30e24701f23f9431e97ad15ab03beb3cf", "message": "pre run step", "committedDate": "2020-02-14T02:27:21Z", "type": "forcePushed"}, {"oid": "3106a58c8ef3ad038416ca9c7314b1e2b74d0aa1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3106a58c8ef3ad038416ca9c7314b1e2b74d0aa1", "message": "pre run step", "committedDate": "2020-02-14T02:28:40Z", "type": "forcePushed"}, {"oid": "51a08fe24cb0ba8a2f8c2c1578bae8bdb8c92c5d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/51a08fe24cb0ba8a2f8c2c1578bae8bdb8c92c5d", "message": "pre run step", "committedDate": "2020-02-14T02:29:25Z", "type": "forcePushed"}, {"oid": "c86bfa240865058f8eb8c1da2183ec2e8be706ae", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c86bfa240865058f8eb8c1da2183ec2e8be706ae", "message": "pre run step", "committedDate": "2020-02-14T02:34:22Z", "type": "forcePushed"}, {"oid": "d527b5eca2016aec2aec5e358476a65c9836af59", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d527b5eca2016aec2aec5e358476a65c9836af59", "message": "pre run step", "committedDate": "2020-02-14T02:41:05Z", "type": "forcePushed"}, {"oid": "b706425883582aadfacaee30916e869dce3a56ab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b706425883582aadfacaee30916e869dce3a56ab", "message": "pre run step", "committedDate": "2020-02-14T02:43:54Z", "type": "forcePushed"}, {"oid": "87be608b7eb0ce0774aed97a9395456e500e1fca", "url": "https://github.com/Azure/azure-sdk-for-java/commit/87be608b7eb0ce0774aed97a9395456e500e1fca", "message": "pre run step", "committedDate": "2020-02-14T02:48:25Z", "type": "forcePushed"}, {"oid": "faae671c7dd6d0950d0f24c7102565b8971daf3f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/faae671c7dd6d0950d0f24c7102565b8971daf3f", "message": "pre run step", "committedDate": "2020-02-14T02:51:54Z", "type": "forcePushed"}, {"oid": "fb30ca2423f5079d6287699192794ace52ee8090", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fb30ca2423f5079d6287699192794ace52ee8090", "message": "pre run step", "committedDate": "2020-02-14T04:04:41Z", "type": "forcePushed"}, {"oid": "7b04722b42596f5c528f45dbb98959ae467d5a5c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7b04722b42596f5c528f45dbb98959ae467d5a5c", "message": "pre run step", "committedDate": "2020-02-14T04:07:12Z", "type": "forcePushed"}, {"oid": "01a26014a242de58bcb127a19295f6c70ecea441", "url": "https://github.com/Azure/azure-sdk-for-java/commit/01a26014a242de58bcb127a19295f6c70ecea441", "message": "build two steps", "committedDate": "2020-02-14T04:46:39Z", "type": "forcePushed"}, {"oid": "1317719c39ac197b1110d826267db98e5bc6dbbd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1317719c39ac197b1110d826267db98e5bc6dbbd", "message": "build two steps", "committedDate": "2020-02-14T14:48:10Z", "type": "forcePushed"}, {"oid": "71224db5277458670eb919c8181b0be5f282336a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/71224db5277458670eb919c8181b0be5f282336a", "message": "Setup up live test mode in search", "committedDate": "2020-02-18T19:07:16Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NTAwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8186#discussion_r380955004", "bodyText": "Not this PR and for documentation purposes.\nA RetryPolicy should be implicitly added in the builder, right now this will cause the create pipeline to have two retry policies.", "author": "alzimmermsft", "createdAt": "2020-02-18T21:47:54Z", "path": "sdk/search/azure-search/src/test/java/com/azure/search/SearchIndexClientTestBase.java", "diffHunk": "@@ -92,22 +92,20 @@\n     }\n \n     SearchIndexClientBuilder getClientBuilder(String indexName) {\n-        if (!interceptorManager.isPlaybackMode()) {\n-            return new SearchIndexClientBuilder()\n-                .endpoint(endpoint)\n-                .indexName(indexName)\n-                .httpClient(new NettyAsyncHttpClientBuilder().wiretap(true).build())\n-                .credential(searchApiKeyCredential)\n-                .addPolicy(interceptorManager.getRecordPolicy())\n-                .addPolicy(new RetryPolicy())\n-                .addPolicy(new HttpLoggingPolicy(\n-                    new HttpLogOptions().setLogLevel(HttpLogDetailLevel.BODY_AND_HEADERS)));\n-        } else {\n-            return new SearchIndexClientBuilder()\n-                .endpoint(endpoint)\n-                .indexName(indexName)\n-                .httpClient(interceptorManager.getPlaybackClient());\n+        SearchIndexClientBuilder builder = new SearchIndexClientBuilder().endpoint(endpoint)\n+            .indexName(indexName);\n+        if (interceptorManager.isPlaybackMode()) {\n+            return builder.httpClient(interceptorManager.getPlaybackClient());\n+        }\n+        builder.httpClient(new NettyAsyncHttpClientBuilder().wiretap(true).build())\n+            .credential(searchApiKeyCredential)\n+            .addPolicy(new RetryPolicy())", "originalCommit": "a40e798a8231c4c6e95431cc2f304d7d7e768df5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NTUyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8186#discussion_r380955527", "bodyText": "Not this PR and for documentation purposes.\nThis change would ideally be done by setting the HttpLogOptions within the builder. Right now this will cause the generated pipeline to have two logging policies which is less than ideal when running live tests with logging on.", "author": "alzimmermsft", "createdAt": "2020-02-18T21:48:53Z", "path": "sdk/search/azure-search/src/test/java/com/azure/search/SearchIndexClientTestBase.java", "diffHunk": "@@ -92,22 +92,20 @@\n     }\n \n     SearchIndexClientBuilder getClientBuilder(String indexName) {\n-        if (!interceptorManager.isPlaybackMode()) {\n-            return new SearchIndexClientBuilder()\n-                .endpoint(endpoint)\n-                .indexName(indexName)\n-                .httpClient(new NettyAsyncHttpClientBuilder().wiretap(true).build())\n-                .credential(searchApiKeyCredential)\n-                .addPolicy(interceptorManager.getRecordPolicy())\n-                .addPolicy(new RetryPolicy())\n-                .addPolicy(new HttpLoggingPolicy(\n-                    new HttpLogOptions().setLogLevel(HttpLogDetailLevel.BODY_AND_HEADERS)));\n-        } else {\n-            return new SearchIndexClientBuilder()\n-                .endpoint(endpoint)\n-                .indexName(indexName)\n-                .httpClient(interceptorManager.getPlaybackClient());\n+        SearchIndexClientBuilder builder = new SearchIndexClientBuilder().endpoint(endpoint)\n+            .indexName(indexName);\n+        if (interceptorManager.isPlaybackMode()) {\n+            return builder.httpClient(interceptorManager.getPlaybackClient());\n+        }\n+        builder.httpClient(new NettyAsyncHttpClientBuilder().wiretap(true).build())\n+            .credential(searchApiKeyCredential)\n+            .addPolicy(new RetryPolicy())\n+            .addPolicy(new HttpLoggingPolicy(\n+                new HttpLogOptions().setLogLevel(HttpLogDetailLevel.BODY_AND_HEADERS)));", "originalCommit": "a40e798a8231c4c6e95431cc2f304d7d7e768df5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NzM0Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8186#discussion_r380957343", "bodyText": "Should this be replaced with the isLiveMode method in InterceptorManager?", "author": "alzimmermsft", "createdAt": "2020-02-18T21:52:34Z", "path": "sdk/search/azure-search/src/test/java/com/azure/search/SearchServiceTestBase.java", "diffHunk": "@@ -656,4 +660,22 @@ ServiceStatistics getExpectedServiceStatistics() {\n             .setCounters(serviceCounters)\n             .setLimits(serviceLimits);\n     }\n+\n+    static boolean liveMode() {\n+        return setupTestMode() == TestMode.LIVE;\n+    }", "originalCommit": "a40e798a8231c4c6e95431cc2f304d7d7e768df5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTAyMDYwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8186#discussion_r381020605", "bodyText": "Yes. Try to replace with the one.", "author": "sima-zhu", "createdAt": "2020-02-19T00:51:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NzM0Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjE0OTg5Ng==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8186#discussion_r382149896", "bodyText": "My concern is next release will depend on azure-core-test. So I put a helper method currently in search. Will move to interceptorManager.isLiveMode once azure-core-test is released.", "author": "sima-zhu", "createdAt": "2020-02-20T17:32:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk1NzM0Mw=="}], "type": "inlineReview"}, {"oid": "49385151a38c7b3aebba7a67ef396677117695b9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/49385151a38c7b3aebba7a67ef396677117695b9", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into live_tests", "committedDate": "2020-02-21T21:33:20Z", "type": "forcePushed"}, {"oid": "d0dc2a5ec6d75eed6a7574faaf04d9491bc9a416", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0dc2a5ec6d75eed6a7574faaf04d9491bc9a416", "message": "Make changes to live tests", "committedDate": "2020-02-21T21:36:45Z", "type": "commit"}, {"oid": "d0dc2a5ec6d75eed6a7574faaf04d9491bc9a416", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d0dc2a5ec6d75eed6a7574faaf04d9491bc9a416", "message": "Make changes to live tests", "committedDate": "2020-02-21T21:36:45Z", "type": "forcePushed"}, {"oid": "c50445fc683022c1f1e230645eb20eae58e345cf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c50445fc683022c1f1e230645eb20eae58e345cf", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into live_tests", "committedDate": "2020-02-21T22:14:54Z", "type": "commit"}, {"oid": "32628b73cca0eea0eeb159283f9e5b1159faea12", "url": "https://github.com/Azure/azure-sdk-for-java/commit/32628b73cca0eea0eeb159283f9e5b1159faea12", "message": "Initial checkin for test.yml", "committedDate": "2020-02-24T17:50:16Z", "type": "commit"}, {"oid": "b2798d6c71c37f04ad6374ec5404d6699c521635", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b2798d6c71c37f04ad6374ec5404d6699c521635", "message": "Merge branch 'master' of https://github.com/Azure/azure-sdk-for-java into live_tests", "committedDate": "2020-02-24T18:35:05Z", "type": "commit"}]}