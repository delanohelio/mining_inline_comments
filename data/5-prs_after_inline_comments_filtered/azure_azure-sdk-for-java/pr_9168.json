{"pr_number": 9168, "pr_title": "Decouple commons dependency ", "pr_createdAt": "2020-03-17T18:09:13Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9168", "timeline": [{"oid": "e78e3cf22f15e8fe929a83996c6596ca3fe2b12e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e78e3cf22f15e8fe929a83996c6596ca3fe2b12e", "message": "example, benchmark projects: taking explcit dependency on commons", "committedDate": "2020-03-17T17:51:25Z", "type": "commit"}, {"oid": "fa2f45f0be25d5d812d96f7cb032058449ff48a9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fa2f45f0be25d5d812d96f7cb032058449ff48a9", "message": "azure-cosmos: adding local package 'apachecommons'  with trimdown version of necessary commons types.", "committedDate": "2020-03-17T17:53:31Z", "type": "commit"}, {"oid": "99d82fc04c81174907db3a7f6e25cd1e02a699f7", "url": "https://github.com/Azure/azure-sdk-for-java/commit/99d82fc04c81174907db3a7f6e25cd1e02a699f7", "message": "azure-cosmos: Remove source dependency on commons types and using local 'apachecommons' types instead.", "committedDate": "2020-03-17T17:55:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4MzcwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r393983709", "bodyText": "we should track the source library version, for tracking future fixes, etc.\nWhere are we tracking the source version?", "author": "moderakh", "createdAt": "2020-03-17T21:33:41Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/apachecommons/collections/AbstractCollectionDecorator.java", "diffHunk": "@@ -0,0 +1,146 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * Portions Copyright (c) Microsoft Corporation", "originalCommit": "99d82fc04c81174907db3a7f6e25cd1e02a699f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDA5MzU1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r394093550", "bodyText": "I'll add source version in all common files, good catch!", "author": "anuchandy", "createdAt": "2020-03-18T03:54:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4MzcwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDY1MzcyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r394653729", "bodyText": "Discussed with Kushagra. Updated the cgmanifest with the version information, this file can be used as the central place to track version, instead of adding same info in all source files.", "author": "anuchandy", "createdAt": "2020-03-18T21:36:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4MzcwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4NTAyOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r393985028", "bodyText": "bug: this is a cosmos class why is this coming here?\n@kushagraThapar", "author": "moderakh", "createdAt": "2020-03-17T21:36:35Z", "path": "sdk/cosmos/azure-cosmos/src/main/java/com/azure/cosmos/implementation/apachecommons/lang/Range.java", "diffHunk": "@@ -0,0 +1,292 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/*\n+ * Portions Copyright (c) Microsoft Corporation\n+ */\n+\n+package com.azure.cosmos.implementation.apachecommons.lang;\n+\n+import java.io.Serializable;\n+import java.util.Comparator;\n+\n+public final class Range<T> implements Serializable {", "originalCommit": "99d82fc04c81174907db3a7f6e25cd1e02a699f7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk5Mzc2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r393993760", "bodyText": "Yeah, we have our own Range.java class, which doesn't use any of the external libraries other than jackson.\n@anuchandy  can you please confirm if we didn't replace this class by mistake ?\npackage com.azure.cosmos.implementation.routing;\n\nimport com.azure.cosmos.BridgeInternal;\nimport com.azure.cosmos.models.JsonSerializable;\nimport com.fasterxml.jackson.annotation.JsonIgnoreProperties;\nimport com.fasterxml.jackson.annotation.JsonProperty;\nimport com.fasterxml.jackson.databind.node.ObjectNode;\n\nimport java.io.Serializable;\nimport java.util.Comparator;\n\n@JsonIgnoreProperties({ \"empty\", \"singleValue\", \"hashMap\" })\npublic final class Range<T extends Comparable<T>> extends JsonSerializable {", "author": "kushagraThapar", "createdAt": "2020-03-17T21:56:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4NTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk5NTA2NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r393995064", "bodyText": "@moderakh  - The Range.java class that Anu has added should be coming from org.apache.commons.lang3\nWe use commons-lang3 Range.java in ParallelAsync.java and ConsistencyTests2.java\nBut what its worth, we should definitely check that we didn't replace our internal class.", "author": "kushagraThapar", "createdAt": "2020-03-17T21:59:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4NTAyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk5NjM4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9168#discussion_r393996388", "bodyText": "ok correct. looks good thanks.", "author": "moderakh", "createdAt": "2020-03-17T22:02:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzk4NTAyOA=="}], "type": "inlineReview"}, {"oid": "69e6342ce5ad07b65f3a4adb4d510182795f29ab", "url": "https://github.com/Azure/azure-sdk-for-java/commit/69e6342ce5ad07b65f3a4adb4d510182795f29ab", "message": "Since commons is now redisributed, updating cosmos cgmanifest to include commons-collection4, commons-lang3 and commons-text.", "committedDate": "2020-03-18T21:25:54Z", "type": "commit"}, {"oid": "539df8bf08ee32f695633fab001c74a5f4acee1e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/539df8bf08ee32f695633fab001c74a5f4acee1e", "message": "Merge branch 'master' of github.com:azure/azure-sdk-for-java into compose-commons-1", "committedDate": "2020-03-19T00:29:11Z", "type": "commit"}, {"oid": "729e86213d9c62bf15afdf7d070085174e8ccecb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/729e86213d9c62bf15afdf7d070085174e8ccecb", "message": "exclude vendored apache-commons types from spotbug", "committedDate": "2020-03-19T01:05:36Z", "type": "commit"}, {"oid": "729e86213d9c62bf15afdf7d070085174e8ccecb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/729e86213d9c62bf15afdf7d070085174e8ccecb", "message": "exclude vendored apache-commons types from spotbug", "committedDate": "2020-03-19T01:05:36Z", "type": "forcePushed"}, {"oid": "6695af2b0bf30d7f685eb58a322b943bf7219920", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6695af2b0bf30d7f685eb58a322b943bf7219920", "message": "Synch upstream", "committedDate": "2020-03-20T03:28:08Z", "type": "commit"}, {"oid": "8f61271b76e2e02577d2d7fa9d9b81ad74ab58e9", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8f61271b76e2e02577d2d7fa9d9b81ad74ab58e9", "message": "Sync Upstream", "committedDate": "2020-03-23T19:09:14Z", "type": "commit"}, {"oid": "eae270376cdeae0335fad9eb0e49ef452e58677a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/eae270376cdeae0335fad9eb0e49ef452e58677a", "message": "Fixed wrong UnmodifiableMap import from apache commons", "committedDate": "2020-03-23T23:51:12Z", "type": "commit"}]}