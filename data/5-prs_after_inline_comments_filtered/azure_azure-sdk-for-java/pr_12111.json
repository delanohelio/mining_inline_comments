{"pr_number": 12111, "pr_title": "Form Recognizer service method parameter guideline update ", "pr_createdAt": "2020-06-11T22:48:34Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/12111", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExMjYzNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439112637", "bodyText": "Will move this to a common function.", "author": "samvaity", "createdAt": "2020-06-11T22:49:43Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -188,15 +178,22 @@\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<RecognizedForm>>\n-        beginRecognizeCustomForms(Flux<ByteBuffer> form, String modelId, long length, FormContentType formContentType,\n-        boolean includeTextDetails, Duration pollInterval) {\n-        final Duration interval = pollInterval != null ? pollInterval : DEFAULT_DURATION;\n+        beginRecognizeCustomForms(RecognizeCustomFormsOptions recognizeCustomFormsOptions) {\n+        final String modelId = recognizeCustomFormsOptions.getModelId();\n+        Flux<ByteBuffer> buffer;\n+        if (recognizeCustomFormsOptions.getForm() != null) {\n+            buffer = Utility.toFluxByteBuffer(recognizeCustomFormsOptions.getForm());\n+        } else {\n+            buffer = recognizeCustomFormsOptions.getFormData();\n+        }", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExMzQxNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439113415", "bodyText": "Still debating if I should keep this API, as I think this parameter set would be more commonly used. And want to keep it simple for the users to pass in FormContentType without having to create options even if it isn't necessarily required.\n@srnagar  thoughts?", "author": "samvaity", "createdAt": "2020-06-11T22:52:06Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -225,7 +205,7 @@\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public SyncPoller<OperationResult, List<FormPage>>\n         beginRecognizeContent(InputStream form, long length, FormContentType formContentType) {", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4NDc3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439584779", "bodyText": "If user studies show that this is a more commonly used parameter set, then I think having this method will make it easier for the majority of the users compared to creating options.", "author": "srnagar", "createdAt": "2020-06-12T18:40:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTExMzQxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU3NzgzNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439577835", "bodyText": "Add javadoc", "author": "srnagar", "createdAt": "2020-06-12T18:24:52Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/RecognizeCustomFormsOptions.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package com.azure.ai.formrecognizer.models;\n+\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+public class RecognizeCustomFormsOptions extends RecognizeOptions {", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU3ODI2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439578260", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                static final Duration DEFAULT_DURATION = Duration.ofSeconds(5);\n          \n          \n            \n                static final Duration DEFAULT_POLL_INTERVAL = Duration.ofSeconds(5);", "author": "srnagar", "createdAt": "2020-06-12T18:25:42Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/RecognizeOptions.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Fluent;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+@Fluent\n+public class RecognizeOptions {\n+    private FormContentType formContentType;\n+    private boolean includeTextContent;\n+    private Duration pollInterval;\n+    private InputStream form;\n+    private Flux<ByteBuffer> formData;\n+    private long length;\n+    private String formUrl;\n+    static final Duration DEFAULT_DURATION = Duration.ofSeconds(5);", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU3ODk1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439578958", "bodyText": "This should be set to DEFAULT_DURATION in case the setter is not called.", "author": "srnagar", "createdAt": "2020-06-12T18:27:12Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/models/RecognizeOptions.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.azure.ai.formrecognizer.models;\n+\n+import com.azure.core.annotation.Fluent;\n+import reactor.core.publisher.Flux;\n+\n+import java.io.InputStream;\n+import java.nio.ByteBuffer;\n+import java.time.Duration;\n+import java.util.Objects;\n+\n+@Fluent\n+public class RecognizeOptions {\n+    private FormContentType formContentType;\n+    private boolean includeTextContent;\n+    private Duration pollInterval;", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4MDQxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439580413", "bodyText": "Should this be named BeginRecognizeReceiptsOptions as per guidelines?\n\nDO name the options type after the name of the service method it is used for, such that the type is named Options. For example, above the method was createBlob, and so the options type was named CreateBlobOptions", "author": "srnagar", "createdAt": "2020-06-12T18:30:29Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerClient.java", "diffHunk": "@@ -355,10 +322,7 @@\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public SyncPoller<OperationResult, List<RecognizedReceipt>>\n-        beginRecognizeReceipts(InputStream receipt, long length, FormContentType formContentType,\n-        boolean includeTextDetails, Duration pollInterval) {\n-        Flux<ByteBuffer> buffer = Utility.toFluxByteBuffer(receipt);\n-        return client.beginRecognizeReceipts(buffer, length, formContentType, includeTextDetails, pollInterval)\n-            .getSyncPoller();\n+        beginRecognizeReceipts(RecognizeOptions recognizeOptions) {", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyNTEzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439625136", "bodyText": "I think this could serve as an exception since RecognizeOPtions is not confined to just receipts API. It can be applied to the receipt and content API.\nI remember discussing this with @JonathanGiles that some options could be more generic in nature and could be applied to more than one method. So, in that case, we cannot follow the <operation-name>Options naming.", "author": "samvaity", "createdAt": "2020-06-12T20:21:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4MDQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4NjMwNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439586305", "bodyText": "Do we need this method? It's the same as beginRecognizeContent(RecognizeOptions recognizeOptions) below.", "author": "srnagar", "createdAt": "2020-06-12T18:43:54Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -242,10 +237,9 @@\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<FormPage>>\n-        beginRecognizeContentFromUrl(String formUrl, Duration pollInterval) {\n-        final Duration interval = pollInterval != null ? pollInterval : DEFAULT_DURATION;\n-        return new PollerFlux<OperationResult, List<FormPage>>(interval,\n-            contentAnalyzeActivationOperation(formUrl),\n+        beginRecognizeContentFromUrl(RecognizeOptions recognizeOptions) {", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTYyNTg4NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439625885", "bodyText": "I think we should have  beginRecognizeContentFromUrl(RecognizeOptions recognizeOptions)\ntoo, since it allows the user an option to pass the configurable options when passing in a URL input for the form/receipt.", "author": "samvaity", "createdAt": "2020-06-12T20:22:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4NjMwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3OTExNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439679117", "bodyText": "Updated to remove the suggested overload as it can be accessed via  beginRecognizeContent(RecognizeOptions recognizeOptions)", "author": "samvaity", "createdAt": "2020-06-12T23:29:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4NjMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4NzEwMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439587100", "bodyText": "This method can be removed now as there is beginRecognizeCustomForms(RecognizeCustomFormsOptions recognizeCustomFormsOptions).", "author": "srnagar", "createdAt": "2020-06-12T18:45:38Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -120,15 +117,15 @@\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<RecognizedForm>>\n-        beginRecognizeCustomFormsFromUrl(String formUrl, String modelId, boolean includeTextDetails,\n-        Duration pollInterval) {\n-        final Duration interval = pollInterval != null ? pollInterval : DEFAULT_DURATION;\n+        beginRecognizeCustomFormsFromUrl(RecognizeCustomFormsOptions recognizeCustomFormsOptions) {", "originalCommit": "e3fd68deb7f89cf1c23fe856c43cc6451f6f9ecc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTY3ODkyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r439678920", "bodyText": "Updated it to be package-private.", "author": "samvaity", "createdAt": "2020-06-12T23:28:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTU4NzEwMA=="}], "type": "inlineReview"}, {"oid": "460955a268288808c51ce044e141d744e674ac4c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/460955a268288808c51ce044e141d744e674ac4c", "message": "Update to remove extra overload, fix checkstyle:", "committedDate": "2020-06-12T23:33:56Z", "type": "forcePushed"}, {"oid": "3246f5fbf7612ace2758f949c8d100d8daaa3f13", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3246f5fbf7612ace2758f949c8d100d8daaa3f13", "message": "Update to remove extra overload, fix checkstyle:", "committedDate": "2020-06-12T23:55:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI0MzI3NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r440243274", "bodyText": "nit: It's a little confusing that RecognizeCustomFormsOptions takes arguments in the order (form, length, modelId), while this function takes it in (form, modelId, length)", "author": "iscai-msft", "createdAt": "2020-06-15T15:05:04Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -157,7 +139,8 @@\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<RecognizedForm>>\n         beginRecognizeCustomForms(Flux<ByteBuffer> form, String modelId, long length, FormContentType formContentType) {\n-        return beginRecognizeCustomForms(form, modelId, length, formContentType, false, null);\n+        return beginRecognizeCustomForms(new RecognizeCustomFormsOptions(form, length, modelId)", "originalCommit": "3246f5fbf7612ace2758f949c8d100d8daaa3f13", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDM5MTk2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r440391969", "bodyText": "I think (form, length, modelId) could be the correct ordering. I will update to follow that ordering and get consistent, thanks!", "author": "samvaity", "createdAt": "2020-06-15T19:17:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDI0MzI3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ3NzA5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r440477090", "bodyText": "Remove the annotation too as this now a package-private method.", "author": "srnagar", "createdAt": "2020-06-15T22:15:36Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -94,41 +96,20 @@\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n     public PollerFlux<OperationResult, List<RecognizedForm>>\n         beginRecognizeCustomFormsFromUrl(String formUrl, String modelId) {\n-        return beginRecognizeCustomFormsFromUrl(formUrl, modelId, false, null);\n+        return beginRecognizeCustomFormsFromUrl(new RecognizeCustomFormsOptions(formUrl, modelId));\n     }\n \n-    /**\n-     * Recognizes form data from documents using optical character recognition (OCR) and a custom trained\n-     * model.\n-     * <p>The service does not support cancellation of the long running operation and returns with an\n-     * error message indicating absence of cancellation support.</p>\n-     *\n-     * <p><strong>Code sample</strong></p>\n-     * {@codesnippet com.azure.ai.formrecognizer.FormRecognizerAsyncClient.beginRecognizeCustomFormsFromUrl#string-string-boolean-Duration}\n-     *\n-     * @param formUrl The source URL to the input form.\n-     * @param modelId The UUID string format custom trained model Id to be used.\n-     * @param includeTextDetails Include text lines and element references in the result.\n-     * @param pollInterval Duration between each poll for the operation status. If none is specified, a default of\n-     * 5 seconds is used.\n-     *\n-     * @return A {@link PollerFlux} that polls the recognize custom form operation until it has completed, has failed,\n-     * or has been cancelled. The completed operation returns a List of {@link RecognizedForm}.\n-     * @throws FormRecognizerException If recognize operation fails and the {@link AnalyzeOperationResult} returned with\n-     * an {@link OperationStatus#FAILED}.\n-     * @throws NullPointerException If {@code formUrl}, {@code modelId} is {@code null}.\n-     */\n     @ServiceMethod(returns = ReturnType.COLLECTION)", "originalCommit": "e800c9875d6ffb80f566cbe1a406d2fbcf5b4f5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDQ3ODE0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/12111#discussion_r440478147", "bodyText": "Add a null check for recognizeOptions before using it.", "author": "srnagar", "createdAt": "2020-06-15T22:18:27Z", "path": "sdk/formrecognizer/azure-ai-formrecognizer/src/main/java/com/azure/ai/formrecognizer/FormRecognizerAsyncClient.java", "diffHunk": "@@ -305,14 +267,17 @@\n      * @throws NullPointerException If {@code form} is {@code null}.\n      */\n     @ServiceMethod(returns = ReturnType.COLLECTION)\n-    public PollerFlux<OperationResult, List<FormPage>> beginRecognizeContent(\n-        Flux<ByteBuffer> form, long length, FormContentType formContentType, Duration pollInterval) {\n+    public PollerFlux<OperationResult, List<FormPage>> beginRecognizeContent(RecognizeOptions recognizeOptions) {\n+        if (recognizeOptions.getFormUrl() != null) {", "originalCommit": "e800c9875d6ffb80f566cbe1a406d2fbcf5b4f5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68bfc7ea9543f36c0c4c3de60eb2a6f1a7706268", "url": "https://github.com/Azure/azure-sdk-for-java/commit/68bfc7ea9543f36c0c4c3de60eb2a6f1a7706268", "message": "sync and async options are different", "committedDate": "2020-06-18T23:29:49Z", "type": "commit"}, {"oid": "4a6a60d7404da4ad64f14ef1968e8cdc1dcee461", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4a6a60d7404da4ad64f14ef1968e8cdc1dcee461", "message": "update to setters", "committedDate": "2020-06-18T23:29:51Z", "type": "commit"}, {"oid": "94e5f7c0a315dc5be3f4cba1b813e73a6735aec8", "url": "https://github.com/Azure/azure-sdk-for-java/commit/94e5f7c0a315dc5be3f4cba1b813e73a6735aec8", "message": "Add options to all API's", "committedDate": "2020-06-18T23:29:52Z", "type": "commit"}, {"oid": "930b95756dbe2d1ee1c96e321a68365aa5d8860f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/930b95756dbe2d1ee1c96e321a68365aa5d8860f", "message": "update tests, javdoc", "committedDate": "2020-06-18T23:29:54Z", "type": "commit"}, {"oid": "f33b05ddd7c71aec601ad991ab9af54933a90b08", "url": "https://github.com/Azure/azure-sdk-for-java/commit/f33b05ddd7c71aec601ad991ab9af54933a90b08", "message": "Update to remove extra overload, fix checkstyle:", "committedDate": "2020-06-18T23:31:40Z", "type": "commit"}, {"oid": "22def1bd5f7fe96c40072614437cb12678bc71da", "url": "https://github.com/Azure/azure-sdk-for-java/commit/22def1bd5f7fe96c40072614437cb12678bc71da", "message": "review comments", "committedDate": "2020-06-18T23:32:17Z", "type": "commit"}, {"oid": "4fc24f217c7700ecbdf2ffbf1669d0c9683cf0c2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4fc24f217c7700ecbdf2ffbf1669d0c9683cf0c2", "message": "add non-null check and return poller error", "committedDate": "2020-06-18T23:32:22Z", "type": "commit"}, {"oid": "4fc24f217c7700ecbdf2ffbf1669d0c9683cf0c2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4fc24f217c7700ecbdf2ffbf1669d0c9683cf0c2", "message": "add non-null check and return poller error", "committedDate": "2020-06-18T23:32:22Z", "type": "forcePushed"}]}