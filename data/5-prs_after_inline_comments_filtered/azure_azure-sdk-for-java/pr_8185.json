{"pr_number": 8185, "pr_title": "Maintain Before and After Retry Polices Separately in HttpPolicyProviders", "pr_createdAt": "2020-02-13T19:16:39Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/8185", "timeline": [{"oid": "abc9e8bff34f6d1033eb23b8f7e1a07e8ecdfcfe", "url": "https://github.com/Azure/azure-sdk-for-java/commit/abc9e8bff34f6d1033eb23b8f7e1a07e8ecdfcfe", "message": "Update HttpPolicyProvider to maintain separate iterables for before and after policy providers", "committedDate": "2020-02-13T19:14:27Z", "type": "commit"}, {"oid": "46174577d6c48af0a2dcc7de3a02c1ffc31b1c02", "url": "https://github.com/Azure/azure-sdk-for-java/commit/46174577d6c48af0a2dcc7de3a02c1ffc31b1c02", "message": "Add tests", "committedDate": "2020-02-13T20:44:37Z", "type": "commit"}, {"oid": "d7cbc22a3f0622c85144d245e56c250cbd229f61", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d7cbc22a3f0622c85144d245e56c250cbd229f61", "message": "Merge branch 'master' into AzCore_UpdatePolicyProviders", "committedDate": "2020-02-13T20:45:11Z", "type": "commit"}, {"oid": "282bbd4e3e549d43861279d56bc0b8c6732b3081", "url": "https://github.com/Azure/azure-sdk-for-java/commit/282bbd4e3e549d43861279d56bc0b8c6732b3081", "message": "Merge branch 'master' into AzCore_UpdatePolicyProviders", "committedDate": "2020-02-14T00:12:15Z", "type": "commit"}, {"oid": "3a24296d5278c04c581298a78b8002264e31a01f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3a24296d5278c04c581298a78b8002264e31a01f", "message": "Remove tests", "committedDate": "2020-02-14T00:31:32Z", "type": "commit"}, {"oid": "123c95c05f9780ddb593330388e7c93562bfaceb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/123c95c05f9780ddb593330388e7c93562bfaceb", "message": "Remove inadvertent change", "committedDate": "2020-02-14T00:32:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIwNDc3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8185#discussion_r379204773", "bodyText": "Log and throw the exception. Also, this should have been caught in checkstyle.", "author": "srnagar", "createdAt": "2020-02-14T01:07:42Z", "path": "sdk/core/azure-core/src/main/java/com/azure/core/http/policy/HttpPolicyProviders.java", "diffHunk": "@@ -36,32 +39,18 @@ public static void addBeforeRetryPolicies(List<HttpPipelinePolicy> policies) {\n      * @param policies Policy list to append the policies.\n      */\n     public static void addAfterRetryPolicies(List<HttpPipelinePolicy> policies) {\n-        addRetryPolicies(policies, () -> getPolicyProviders(false, AfterRetryPolicyProvider.class));\n+        addPolices(policies, AFTER_PROVIDER);\n     }\n \n-    private static void addRetryPolicies(List<HttpPipelinePolicy> policies,\n-        Supplier<Iterator<? extends HttpPolicyProvider>> policySupplier) {\n-        Iterator<? extends HttpPolicyProvider> it = policySupplier.get();\n-        while (it.hasNext()) {\n-            HttpPolicyProvider policyProvider = it.next();\n-            HttpPipelinePolicy policy = policyProvider.create();\n+    private static void addPolices(List<HttpPipelinePolicy> policies,\n+        Iterable<? extends HttpPolicyProvider> providers) {\n+        for (HttpPolicyProvider provider : providers) {\n+            HttpPipelinePolicy policy = provider.create();\n             if (policy == null) {\n-                throw new NullPointerException(\"HttpPipelinePolicy created with \" + policyProvider.getClass()\n-                    + \" resulted in a null policy\");\n+                throw new NullPointerException(String.format(INVALID_POLICY, provider.getClass()));", "originalCommit": "123c95c05f9780ddb593330388e7c93562bfaceb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTU0OTIxMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/8185#discussion_r379549212", "bodyText": "Being used from a static method which conflicts with the logging guidelines, we may want to amend those to allow them in a static only class.", "author": "alzimmermsft", "createdAt": "2020-02-14T17:17:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTIwNDc3Mw=="}], "type": "inlineReview"}]}