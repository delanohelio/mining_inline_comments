{"pr_number": 7083, "pr_title": "Add az.namespace span attribute to Eventhubs library", "pr_createdAt": "2020-01-03T00:16:11Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/7083", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMTE0NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362701145", "bodyText": "Is there a constants class in the implementation package we can put this in, instead of triplicating the constant?", "author": "conniey", "createdAt": "2020-01-03T03:58:22Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/EventHubProducerAsyncClient.java", "diffHunk": "@@ -93,6 +94,7 @@\n \n     private static final SendOptions DEFAULT_SEND_OPTIONS = new SendOptions();\n     private static final CreateBatchOptions DEFAULT_BATCH_OPTIONS = new CreateBatchOptions();\n+    private static final String AZ_NAMESPACE_VALUE = \"Microsoft.EventHub\";", "originalCommit": "5fca574e2d64ead3a9c8173c770c720d497190a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkyMDYzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362920630", "bodyText": "added it to the client constants file.", "author": "samvaity", "createdAt": "2020-01-03T18:54:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjcwMTE0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjg5MTExMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362891113", "bodyText": "Shouldn't the same constant from the interface this implements be usable instead of having it again?", "author": "alzimmermsft", "createdAt": "2020-01-03T17:23:45Z", "path": "sdk/core/azure-core-tracing-opentelemetry/src/main/java/com/azure/core/tracing/opentelemetry/OpenTelemetryTracer.java", "diffHunk": "@@ -32,10 +32,11 @@\n     private static final Tracer TRACER = OpenTelemetry.getTracerFactory().get(\"Azure-OpenTelemetry\");\n \n     // standard attributes with AMQP request\n-    static final String COMPONENT = \"component\";\n     static final String MESSAGE_BUS_DESTINATION = \"message_bus.destination\";\n     static final String PEER_ENDPOINT = \"peer.address\";\n \n+    static final String AZ_NAMESPACE_KEY = \"az.namespace\";", "originalCommit": "5fca574e2d64ead3a9c8173c770c720d497190a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb40ba59e6b52ec036930bdfe7361883ab019a7e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/cb40ba59e6b52ec036930bdfe7361883ab019a7e", "message": "add to constants file", "committedDate": "2020-01-03T18:53:15Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkzNzY4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362937681", "bodyText": "nit: Can you add a comment/link to where this value came from so when we visit this in the future, we'll know where it was from.", "author": "conniey", "createdAt": "2020-01-03T19:47:03Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/implementation/ClientConstants.java", "diffHunk": "@@ -7,6 +7,7 @@\n \n public final class ClientConstants {\n     public static final String AZURE_ACTIVE_DIRECTORY_SCOPE = \"https://eventhubs.azure.net/.default\";\n+    public static final String AZ_NAMESPACE_VALUE = \"Microsoft.EventHub\";", "originalCommit": "cb40ba59e6b52ec036930bdfe7361883ab019a7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkzODA2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362938063", "bodyText": "it would be easier to reason about if you chained .addData(NAMESPACE...) to the declaration above rather than here.", "author": "conniey", "createdAt": "2020-01-03T19:48:07Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/PartitionPumpManager.java", "diffHunk": "@@ -193,10 +195,9 @@ private Context startProcessTracingSpan(EventData eventData, String eventHubName\n             return Context.NONE;\n         }\n \n-        Context spanContext = tracerProvider.extractContext(diagnosticId.toString(), Context.NONE);\n-        Context entityContext = spanContext.addData(ENTITY_PATH_KEY, eventHubName);\n-\n-        return tracerProvider.startSpan(entityContext.addData(HOST_NAME_KEY, fullyQualifiedNamespace),\n+        Context spanContext = tracerProvider.extractContext(diagnosticId.toString(), Context.NONE)\n+            .addData(ENTITY_PATH_KEY, eventHubName).addData(HOST_NAME_KEY, fullyQualifiedNamespace);\n+        return tracerProvider.startSpan(spanContext.addData(AZ_NAMESPACE_KEY, AZ_NAMESPACE_VALUE),", "originalCommit": "cb40ba59e6b52ec036930bdfe7361883ab019a7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkzODY4Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362938683", "bodyText": "nit: It is a lot easier to understand all the method invocations by formatting it as:\nfinalSharedContext.addData(ENTITY_PATH_KEY, link.getEntityPath())\n    .addData(HOST_NAME_KEY, link.getHostname())\n    .addData(AZ_NAMESPACE_KEY, AZ_NAMESPACE_VALUE);\nSame comment as the ones below.", "author": "conniey", "createdAt": "2020-01-03T19:49:52Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/EventHubProducerAsyncClient.java", "diffHunk": "@@ -425,10 +427,11 @@ public String getEventHubName() {\n         return getSendLink(batch.getPartitionId())\n             .flatMap(link -> {\n                 if (isTracingEnabled) {\n-                    Context entityContext = finalSharedContext.addData(ENTITY_PATH_KEY, link.getEntityPath());\n+                    Context entityContext = finalSharedContext.addData(ENTITY_PATH_KEY, link.getEntityPath())", "originalCommit": "cb40ba59e6b52ec036930bdfe7361883ab019a7e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkzODk3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362938972", "bodyText": "Did you add a unit test to ensure this AZ_NAMESPACE_KEY is set when sending an event?", "author": "conniey", "createdAt": "2020-01-03T19:50:50Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/EventHubProducerAsyncClient.java", "diffHunk": "@@ -44,9 +44,11 @@\n import java.util.stream.Collector;", "originalCommit": "cb40ba59e6b52ec036930bdfe7361883ab019a7e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mjk3NTM0OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/7083#discussion_r362975349", "bodyText": "updated existing tests to assert if AZ_NAMESPACE_KEY set on sending an event.", "author": "samvaity", "createdAt": "2020-01-03T21:59:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2MjkzODk3Mg=="}], "type": "inlineReview"}, {"oid": "3382a635bbeaa04905a68b1de523caf4550a44d1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3382a635bbeaa04905a68b1de523caf4550a44d1", "message": "update tests", "committedDate": "2020-01-03T22:18:46Z", "type": "forcePushed"}, {"oid": "11eceb9f89293842bfd6bd3d88aac5b8a8d87c5e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/11eceb9f89293842bfd6bd3d88aac5b8a8d87c5e", "message": "update az.namespace attribute", "committedDate": "2020-01-08T00:26:50Z", "type": "forcePushed"}, {"oid": "6ead25a804a831ddfca5dfd0e8490825ef6247e3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6ead25a804a831ddfca5dfd0e8490825ef6247e3", "message": "update az.namespace attribute", "committedDate": "2020-01-08T00:54:55Z", "type": "forcePushed"}, {"oid": "777042ad4078766e3113dd6962609bf63e91ecae", "url": "https://github.com/Azure/azure-sdk-for-java/commit/777042ad4078766e3113dd6962609bf63e91ecae", "message": "add az.namespace span attribute", "committedDate": "2020-02-18T20:13:41Z", "type": "commit"}, {"oid": "1b3326a090b925d535bddb74821874f75b553abf", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1b3326a090b925d535bddb74821874f75b553abf", "message": "add to constants file", "committedDate": "2020-02-18T20:13:46Z", "type": "commit"}, {"oid": "0d70dadc07b00005f88d5550ae5dd54f76369732", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0d70dadc07b00005f88d5550ae5dd54f76369732", "message": "update tests", "committedDate": "2020-02-18T20:14:44Z", "type": "commit"}, {"oid": "11916a59411215746d74c329fed15f1db8b3480c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/11916a59411215746d74c329fed15f1db8b3480c", "message": "update az.namespace attribute", "committedDate": "2020-02-18T20:15:49Z", "type": "commit"}, {"oid": "deca27fae71b5b3de409ef9e30684fc16595f486", "url": "https://github.com/Azure/azure-sdk-for-java/commit/deca27fae71b5b3de409ef9e30684fc16595f486", "message": "update rebase", "committedDate": "2020-02-18T20:22:11Z", "type": "commit"}, {"oid": "deca27fae71b5b3de409ef9e30684fc16595f486", "url": "https://github.com/Azure/azure-sdk-for-java/commit/deca27fae71b5b3de409ef9e30684fc16595f486", "message": "update rebase", "committedDate": "2020-02-18T20:22:11Z", "type": "forcePushed"}, {"oid": "67ad012188e87a0c9eee1c5a3771b6631d4f028f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/67ad012188e87a0c9eee1c5a3771b6631d4f028f", "message": "update to remove dead store", "committedDate": "2020-02-18T20:37:33Z", "type": "commit"}]}