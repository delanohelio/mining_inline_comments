{"pr_number": 9845, "pr_title": "Refactor etag handling using ETagState", "pr_createdAt": "2020-04-03T06:43:19Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/9845", "timeline": [{"oid": "47c4af059d537bed4f43f670631c7fa274514179", "url": "https://github.com/Azure/azure-sdk-for-java/commit/47c4af059d537bed4f43f670631c7fa274514179", "message": "Refactor etag handling using ETagState", "committedDate": "2020-04-03T06:28:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4NTQ1OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9845#discussion_r402785458", "bodyText": "Why set both? Will it affect line 413 when you call both regardless create or update?", "author": "weidongxu-microsoft", "createdAt": "2020-04-03T07:26:15Z", "path": "sdk/dns/mgmt/src/main/java/com/azure/management/dns/implementation/DnsZoneImpl.java", "diffHunk": "@@ -394,34 +395,25 @@ public DnsZoneImpl withoutTxtRecordSet(String name, String eTag) {\n \n     @Override\n     public DnsZoneImpl withETagCheck() {\n-        if (isInCreateMode()) {\n-            this.dnsZoneETag = \"*\";\n-            return this;\n-        }\n-        return this.withETagCheck(this.inner().etag());\n+        this.eTagState.withImplicitETagCheckOnCreate();\n+        this.eTagState.withImplicitETagCheckOnUpdate();", "originalCommit": "47c4af059d537bed4f43f670631c7fa274514179", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgxNDU5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9845#discussion_r402814591", "bodyText": "withETagCheck() could be available both Create phase and Update phase. So it's required to set both here.\nIn Create phase, line#413 self.inner().etag() is NULL so it will send If-Match: null and If-None-Match:* during creation. In Update phase, it would send If-Match: etag and If-None-Match: *. This is the scenario applied by RecordSet in track 1. I tested it's working when sending If-Match: etag and If-None-Match: * for Update.", "author": "xseeseesee", "createdAt": "2020-04-03T08:10:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4NTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjgyNDA0MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9845#discussion_r402824040", "bodyText": "The problem is why does If-None-Match: * work on UPDATE? The condition specified by it is that there being not any match, isn't it? Unless you can find spec elaborating it is acceptable, don't do it.\nThe test pass might be just service behavior, which might not work on another service.", "author": "weidongxu-microsoft", "createdAt": "2020-04-03T08:21:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4NTQ1OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjg1MDMzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/9845#discussion_r402850338", "bodyText": "Agree. I just commit changes for this. Now it will only set one of them by verifying inner.id().", "author": "xseeseesee", "createdAt": "2020-04-03T08:51:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc4NTQ1OA=="}], "type": "inlineReview"}, {"oid": "d2eb038b95cdbf8efaefe07493aa789752b57e6f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d2eb038b95cdbf8efaefe07493aa789752b57e6f", "message": "fix implicit ETag handling in phase create or update", "committedDate": "2020-04-03T08:48:57Z", "type": "commit"}, {"oid": "461c1e166325810bce11f3a3f2032399e91930d5", "url": "https://github.com/Azure/azure-sdk-for-java/commit/461c1e166325810bce11f3a3f2032399e91930d5", "message": "Update javadoc for ETagState", "committedDate": "2020-04-07T05:27:15Z", "type": "commit"}, {"oid": "b9c3346206c5bfdc78515109aca11fbc1cfebc30", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b9c3346206c5bfdc78515109aca11fbc1cfebc30", "message": "Merge branch 'master' into mgmt-etag", "committedDate": "2020-04-07T05:43:21Z", "type": "commit"}]}