{"pr_number": 17678, "pr_title": "Vijay receive message ttl fix", "pr_createdAt": "2020-11-19T05:45:16Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17678", "timeline": [{"oid": "c8ee2de96ca14fb44faed29227ff722ef7f6e620", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c8ee2de96ca14fb44faed29227ff722ef7f6e620", "message": "Fixing a regresion in message converter.", "committedDate": "2020-11-19T05:28:15Z", "type": "commit"}, {"oid": "15d0292a7791125cf0502c8c08913e0ff1313c5b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/15d0292a7791125cf0502c8c08913e0ff1313c5b", "message": "Changing version number.", "committedDate": "2020-11-19T05:43:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE4OTc2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17678#discussion_r527189765", "bodyText": "I understand that this override is done for a long time ,  Why is it done in first place ? If  amqpMessage.getTtl()    is positive , this override is needed ?", "author": "hemanttanwar", "createdAt": "2020-11-19T20:50:53Z", "path": "sdk/servicebus/microsoft-azure-servicebus/src/main/java/com/microsoft/azure/servicebus/MessageConverter.java", "diffHunk": "@@ -131,14 +131,20 @@ public static Message convertAmqpMessageToBrokeredMessage(org.apache.qpid.proton\n         // Header\n         // Delivery count for service bus starts from 1, for AMQP it starts from 0.\n         brokeredMessage.setDeliveryCount(amqpMessage.getDeliveryCount() + 1);\n-        brokeredMessage.setTimeToLive(Duration.ofMillis(amqpMessage.getTtl()));\n-        \n+        long ttlMillis = amqpMessage.getTtl();\n+        if (ttlMillis > 0l) {\n+        \tbrokeredMessage.setTimeToLive(Duration.ofMillis(ttlMillis));\n+        }\n \n         // Properties\n         // Override TimeToLive from CrationTime and ExpiryTime, as they support duration of any length, which ttl doesn't\n         if (amqpMessage.getCreationTime() != 0l && amqpMessage.getExpiryTime() != 0l) {\n-        \tbrokeredMessage.setTimeToLive(Duration.ofMillis(amqpMessage.getExpiryTime() - amqpMessage.getCreationTime()));\n+        \tttlMillis = amqpMessage.getExpiryTime() - amqpMessage.getCreationTime();", "originalCommit": "15d0292a7791125cf0502c8c08913e0ff1313c5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzIwMzk3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17678#discussion_r527203973", "bodyText": "Needed because ttl is milliseconds as integer, so it can't support time to live of more than 50 days. That's why we had to change it.", "author": "yvgopal", "createdAt": "2020-11-19T21:16:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzE4OTc2NQ=="}], "type": "inlineReview"}]}