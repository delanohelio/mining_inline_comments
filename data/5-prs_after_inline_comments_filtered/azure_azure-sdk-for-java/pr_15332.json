{"pr_number": 15332, "pr_title": "Add device code print to console functionality", "pr_createdAt": "2020-09-17T18:34:40Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/15332", "timeline": [{"oid": "ede1afc5f793009fa87c059ab3ecb84542c083d3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ede1afc5f793009fa87c059ab3ecb84542c083d3", "message": "Add 2019 MSI endpoint support.", "committedDate": "2020-08-31T04:32:58Z", "type": "commit"}, {"oid": "bd2580c0d1d7854f267d093fdc9e167867721ddc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bd2580c0d1d7854f267d093fdc9e167867721ddc", "message": "refactor code.", "committedDate": "2020-09-02T04:12:42Z", "type": "commit"}, {"oid": "b539e893aa5c6ba778a297a354d64738834f39a1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b539e893aa5c6ba778a297a354d64738834f39a1", "message": "Merge remote-tracking branch 'upstream/master' into app_service_version_support", "committedDate": "2020-09-02T16:47:49Z", "type": "commit"}, {"oid": "ad9bcdb4cfa6aaff4c1e61e4ac26dcd09ec33b1c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ad9bcdb4cfa6aaff4c1e61e4ac26dcd09ec33b1c", "message": "update e2e", "committedDate": "2020-09-02T18:11:14Z", "type": "commit"}, {"oid": "1643e7d07d43e06c9748be7f6243e493b3e509d4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1643e7d07d43e06c9748be7f6243e493b3e509d4", "message": "address feedback.", "committedDate": "2020-09-03T23:19:46Z", "type": "commit"}, {"oid": "e7cb212c96ce4c1d202d8aca6af9210c2dc90e7e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e7cb212c96ce4c1d202d8aca6af9210c2dc90e7e", "message": "update code.", "committedDate": "2020-09-03T23:29:58Z", "type": "commit"}, {"oid": "81fa3315fd276292acd15700416631dc13c31a21", "url": "https://github.com/Azure/azure-sdk-for-java/commit/81fa3315fd276292acd15700416631dc13c31a21", "message": "Merge remote-tracking branch 'upstream/master' into app_service_version_support", "committedDate": "2020-09-11T17:17:49Z", "type": "commit"}, {"oid": "c4646cf82f3e0cb3cb767e9760e5327d0b2a6f37", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4646cf82f3e0cb3cb767e9760e5327d0b2a6f37", "message": "update changelog", "committedDate": "2020-09-11T17:19:24Z", "type": "commit"}, {"oid": "d57a248ae50582d1d7e092e3544b4f7e7f1216c6", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d57a248ae50582d1d7e092e3544b4f7e7f1216c6", "message": "Merge remote-tracking branch 'upstream/master' into app_service_version_support", "committedDate": "2020-09-11T21:17:02Z", "type": "commit"}, {"oid": "d612e5ca59c391c215451c4f606056756688d43a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/d612e5ca59c391c215451c4f606056756688d43a", "message": "Merge remote-tracking branch 'upstream/master' into add-device-code-use-console-feature", "committedDate": "2020-09-17T17:31:46Z", "type": "commit"}, {"oid": "04dd4838936bea3447e617c633b222c12b19494f", "url": "https://github.com/Azure/azure-sdk-for-java/commit/04dd4838936bea3447e617c633b222c12b19494f", "message": "add default console output behavior", "committedDate": "2020-09-17T17:48:32Z", "type": "commit"}, {"oid": "027a9f2a019b2457f3a503063bf8288de488889e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/027a9f2a019b2457f3a503063bf8288de488889e", "message": "update code", "committedDate": "2020-09-17T18:39:58Z", "type": "commit"}, {"oid": "560e8081a5516535ba6f9cd89b6a940ca2115496", "url": "https://github.com/Azure/azure-sdk-for-java/commit/560e8081a5516535ba6f9cd89b6a940ca2115496", "message": "update code", "committedDate": "2020-09-17T18:51:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ5NTA4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15332#discussion_r490495081", "bodyText": "Since the consumer is set on the DeviceCodeCredentialBuilder it would be good to have defaults also set in the builder.  That's the general pattern we are following for other configurable options like httpclient, retry policies etc. So, we have one place for all defaults.", "author": "srnagar", "createdAt": "2020-09-17T19:15:07Z", "path": "sdk/identity/azure-identity/src/main/java/com/azure/identity/implementation/IdentityClient.java", "diffHunk": "@@ -580,10 +580,17 @@ private HttpPipeline setupPipeline(HttpClient httpClient) {\n      */\n     public Mono<MsalToken> authenticateWithDeviceCode(TokenRequestContext request,\n                                                       Consumer<DeviceCodeInfo> deviceCodeConsumer) {\n+\n+        final Consumer<DeviceCodeInfo> deviceCodeInfoConsumer;\n+        if (deviceCodeConsumer != null) {\n+            deviceCodeInfoConsumer = deviceCodeConsumer;\n+        } else {\n+            deviceCodeInfoConsumer = deviceCodeInfo -> System.out.println(deviceCodeInfo.getMessage());\n+        }", "originalCommit": "560e8081a5516535ba6f9cd89b6a940ca2115496", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDUwNzkwOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15332#discussion_r490507908", "bodyText": "That approach comes with the drawback of the configured default living in the memory until the credential object is garbage collected.\nThis approach will ensure that the default value gets created and garbage collected after the method call finishes.\nGiven that in memory token cache will be active in our auth policies too, so invocation of this method will not be frequent as well.", "author": "g2vinay", "createdAt": "2020-09-17T19:30:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ5NTA4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE4ODk0NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15332#discussion_r491188944", "bodyText": "This consumer can be a static constant. I don't think the consumer has to be tied to the lifetime of the credential.\nprivate static final Consumer<DeviceCodeInfo> DEVICE_CODE_CONSUMER = deviceCodeInfo -> System.out.println(deviceCodeInfo.getMessage());", "author": "srnagar", "createdAt": "2020-09-18T21:01:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ5NTA4MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTIwMDQ3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/15332#discussion_r491200472", "bodyText": "Yeah, statics are common and from a functionality point of view will work fine.\nBut, making it static, will prevent it from being garbage collected until the application terminates.\nSo, from memory point of view, static is worse compared to localizing the variable. In this scenario, the more we localize, the better the situation becomes from memory consumption aspect.", "author": "g2vinay", "createdAt": "2020-09-18T21:33:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDQ5NTA4MQ=="}], "type": "inlineReview"}, {"oid": "418737914e44e748e2a8fecbace2730f247a4f4e", "url": "https://github.com/Azure/azure-sdk-for-java/commit/418737914e44e748e2a8fecbace2730f247a4f4e", "message": "address feedback", "committedDate": "2020-09-25T23:45:05Z", "type": "commit"}, {"oid": "8a5b8ff54125b2db5358bb7ef3539cffab5421ea", "url": "https://github.com/Azure/azure-sdk-for-java/commit/8a5b8ff54125b2db5358bb7ef3539cffab5421ea", "message": "add checkstyle sup", "committedDate": "2020-09-28T16:39:48Z", "type": "commit"}, {"oid": "7c1e93cd8f0c5d9e4885ab93fa13e4345ec8060a", "url": "https://github.com/Azure/azure-sdk-for-java/commit/7c1e93cd8f0c5d9e4885ab93fa13e4345ec8060a", "message": "Merge remote-tracking branch 'upstream/master' into add-device-code-use-console-feature", "committedDate": "2020-09-28T16:40:00Z", "type": "commit"}]}