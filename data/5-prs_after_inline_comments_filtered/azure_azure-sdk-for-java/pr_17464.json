{"pr_number": 17464, "pr_title": "Amqp Message Update - API Change", "pr_createdAt": "2020-11-11T05:15:38Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/17464", "timeline": [{"oid": "b23438371045c9a85e90d68dd8cfe8b93e0e8bed", "url": "https://github.com/Azure/azure-sdk-for-java/commit/b23438371045c9a85e90d68dd8cfe8b93e0e8bed", "message": "Amqp Message Update - API Change", "committedDate": "2020-11-11T05:10:37Z", "type": "commit"}, {"oid": "c4c6b2535ed28b53274d8e23ce5c14782a47d9e3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c4c6b2535ed28b53274d8e23ce5c14782a47d9e3", "message": "Adding test", "committedDate": "2020-11-11T07:54:50Z", "type": "commit"}, {"oid": "01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "url": "https://github.com/Azure/azure-sdk-for-java/commit/01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "message": "Merge master into branch", "committedDate": "2020-11-11T08:00:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYxOTE4OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r521619189", "bodyText": "final", "author": "srnagar", "createdAt": "2020-11-11T20:28:01Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAddress.java", "diffHunk": "@@ -0,0 +1,62 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents amqp address information.\n+ */\n+public class AmqpAddress {", "originalCommit": "01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYxOTkwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r521619904", "bodyText": "Can we add a little more information in the doc about what this address is? Also, link the AMQP spec to all these AMQP types because a lot of the model contents are dictated by the spec. So, we should have more descriptive docs.", "author": "srnagar", "createdAt": "2020-11-11T20:29:26Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAddress.java", "diffHunk": "@@ -0,0 +1,62 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents amqp address information.", "originalCommit": "01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMTQ4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r521621482", "bodyText": "This check is unnecessary as the AmqpAnnotatedMessage instance can only be created with a non-null body.", "author": "srnagar", "createdAt": "2020-11-11T20:32:31Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -49,7 +52,22 @@ public AmqpAnnotatedMessage(AmqpMessageBody body) {\n      */\n     public AmqpAnnotatedMessage(AmqpAnnotatedMessage message) {\n         Objects.requireNonNull(message, \"'message' cannot be null.\");\n-        amqpMessageBody = Objects.requireNonNull(message.getBody(), \"'message.body' cannot be null.\");\n+        Objects.requireNonNull(message.getBody(), \"'message.body' cannot be null.\");", "originalCommit": "01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTYyMjU2NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r521622565", "bodyText": "These should be documented in javadoc @throws section.", "author": "srnagar", "createdAt": "2020-11-11T20:34:39Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -49,7 +52,22 @@ public AmqpAnnotatedMessage(AmqpMessageBody body) {\n      */\n     public AmqpAnnotatedMessage(AmqpAnnotatedMessage message) {\n         Objects.requireNonNull(message, \"'message' cannot be null.\");\n-        amqpMessageBody = Objects.requireNonNull(message.getBody(), \"'message.body' cannot be null.\");\n+        Objects.requireNonNull(message.getBody(), \"'message.body' cannot be null.\");\n+\n+        AmqpBodyType bodyType = message.getBody().getBodyType();\n+        switch (bodyType) {\n+            case DATA:\n+                amqpMessageBody = AmqpMessageBody.fromData(message.getBody().getData());\n+                break;\n+            case SEQUENCE:\n+            case VALUE:\n+                throw logger.logExceptionAsError(new UnsupportedOperationException(\"Body type not supported yet \"\n+                    + bodyType.toString()));\n+            default:\n+                throw logger.logExceptionAsError(new IllegalStateException(\"Body type not valid \"\n+                    + bodyType.toString()));\n+        }", "originalCommit": "01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTY5NDgwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r521694807", "bodyText": "I guess we should make this javadoc crisp on why we do this. For the customer, this decision seems arbitrary and we need to document the justification for doing this. This, as we discussed earlier, has the potential for dropping data that is sent from another client that does support more than one byte[].", "author": "srnagar", "createdAt": "2020-11-11T23:17:16Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,97 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpBodyType} map to AMQP specification message body types.\n+ * Current implementation only support {@link AmqpBodyType#DATA DATA}. Other types will be supported in future releases.\n+ * Client should test for {@link AmqpBodyType} before calling corresponding get method.\n+ * Get methods not corresponding to the type of the body throw exception.\n+ *\n+ * @see AmqpBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private static final ClientLogger LOGGER = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpBodyType bodyType;\n+\n+    private byte[] data;\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given {@link Iterable} of byte array. Please note that this\n+     * version of the SDK supports only one element in given {@link Iterable}.", "originalCommit": "01aeb75f448b8d4b184ce7f1db5bb4a2796dcea3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "66b1fb18be26f239e1cacbfccd829dba9c6394d1", "url": "https://github.com/Azure/azure-sdk-for-java/commit/66b1fb18be26f239e1cacbfccd829dba9c6394d1", "message": "Removing Iterable constructor", "committedDate": "2020-11-12T01:45:06Z", "type": "commit"}, {"oid": "888217b2ee268d62b4dfcb1024f63922eb9735fb", "url": "https://github.com/Azure/azure-sdk-for-java/commit/888217b2ee268d62b4dfcb1024f63922eb9735fb", "message": "Adding java doc", "committedDate": "2020-11-12T07:56:03Z", "type": "commit"}, {"oid": "ae8f8f2d266adb8fdf59b68755ec82b4c7980172", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ae8f8f2d266adb8fdf59b68755ec82b4c7980172", "message": "Adding java doc", "committedDate": "2020-11-12T08:07:56Z", "type": "commit"}, {"oid": "2918312ae75b15aad3b3be6d78e8fe1320652b85", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2918312ae75b15aad3b3be6d78e8fe1320652b85", "message": "fix javadoc", "committedDate": "2020-11-12T16:49:08Z", "type": "commit"}, {"oid": "fbf1efeefbf286154b0dc30b6e36872885f21352", "url": "https://github.com/Azure/azure-sdk-for-java/commit/fbf1efeefbf286154b0dc30b6e36872885f21352", "message": "Adding java doc", "committedDate": "2020-11-12T16:56:29Z", "type": "commit"}, {"oid": "e4525a5bd24b660558575f6a40f1444a2f25bbc4", "url": "https://github.com/Azure/azure-sdk-for-java/commit/e4525a5bd24b660558575f6a40f1444a2f25bbc4", "message": "Renames amqp body type", "committedDate": "2020-11-12T17:22:01Z", "type": "commit"}, {"oid": "ab9a71c33bf547b7ee067ec9a15b7ab618645b49", "url": "https://github.com/Azure/azure-sdk-for-java/commit/ab9a71c33bf547b7ee067ec9a15b7ab618645b49", "message": "type rename-> service bus change", "committedDate": "2020-11-12T19:51:27Z", "type": "commit"}, {"oid": "efdc61115a958a7e2f1ad4f9b78d86ddff526e2d", "url": "https://github.com/Azure/azure-sdk-for-java/commit/efdc61115a958a7e2f1ad4f9b78d86ddff526e2d", "message": "Rev API changes for body type rename", "committedDate": "2020-11-12T20:03:10Z", "type": "commit"}, {"oid": "bb72b2129f5d11de43a0c6055bc22d6f2472a01b", "url": "https://github.com/Azure/azure-sdk-for-java/commit/bb72b2129f5d11de43a0c6055bc22d6f2472a01b", "message": "Added API based on review comments", "committedDate": "2020-11-12T22:51:52Z", "type": "commit"}, {"oid": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "url": "https://github.com/Azure/azure-sdk-for-java/commit/9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "message": "Review commnets", "committedDate": "2020-11-12T23:18:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4MDg5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522780893", "bodyText": "Why is this a static logger? I see this used only in instance methods.", "author": "srnagar", "createdAt": "2020-11-13T08:19:19Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,108 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private static final ClientLogger LOGGER = new ClientLogger(AmqpMessageBody.class);", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMzA0Mzg5Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r523043897", "bodyText": "This is left over, Earlier this was used in static methods.  Changin it.", "author": "hemanttanwar", "createdAt": "2020-11-13T16:00:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4MDg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4MTYwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522781602", "bodyText": "Update javadoc since the return type is now an IterableStream.", "author": "srnagar", "createdAt": "2020-11-13T08:19:58Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,108 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private static final ClientLogger LOGGER = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private byte[] data;\n+\n+    AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = data;\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an immutable list containing only first byte array set on this {@link AmqpMessageBody}. This library only", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4MzMxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522783310", "bodyText": "Why do we create a new singletonList each time getData() is called? We can create the singletonList just once when fromData() is called.", "author": "srnagar", "createdAt": "2020-11-13T08:21:41Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,108 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private static final ClientLogger LOGGER = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private byte[] data;\n+\n+    AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = data;\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an immutable list containing only first byte array set on this {@link AmqpMessageBody}. This library only\n+     * support one byte array, so the returned list will have only one element. Look for future releases where we will\n+     * support multiple byte array.\n+     * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+     * corresponding to the type of the body throws exception.</b>\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     */\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Can not return data for a \"\n+                + \"message which is of type %s.\", getBodyType().toString())));\n+        }\n+\n+        return new IterableStream<>(Collections.singletonList(data));", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4NDIwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522784204", "bodyText": "Why does getData() not make a copy of the array but this method does?", "author": "srnagar", "createdAt": "2020-11-13T08:22:33Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,108 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private static final ClientLogger LOGGER = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private byte[] data;\n+\n+    AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = data;\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an immutable list containing only first byte array set on this {@link AmqpMessageBody}. This library only\n+     * support one byte array, so the returned list will have only one element. Look for future releases where we will\n+     * support multiple byte array.\n+     * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+     * corresponding to the type of the body throws exception.</b>\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     */\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Can not return data for a \"\n+                + \"message which is of type %s.\", getBodyType().toString())));\n+        }\n+\n+        return new IterableStream<>(Collections.singletonList(data));\n+    }\n+\n     /**\n-     * Type representing various supported amqp body types.\n+     * Gets first byte array set on this {@link AmqpMessageBody}. This library only support one byte array on Amqp\n+     * Message. Look for future releases where we will support multiple byte array and you can use\n+     * {@link AmqpMessageBody#getData()} API.\n+     * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+     * corresponding to the type of the body throws exception.</b>\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n      *\n-     * @return The {@link AmqpBodyType}.\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#section-message-format\">\n+     *     Amqp Message Format.</a>\n      */\n-    AmqpBodyType getBodyType();\n+    public byte[] getFirstData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Can not return data for a \"\n+                + \"message which is of type %s.\", getBodyType().toString())));\n+        }\n+\n+        return Arrays.copyOf(data, data.length);", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4NDU4Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522784582", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Can not return data for a \"\n          \n          \n            \n                        throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Cannot return data for a \"", "author": "srnagar", "createdAt": "2020-11-13T08:22:58Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,108 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private static final ClientLogger LOGGER = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private byte[] data;\n+\n+    AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = data;\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an immutable list containing only first byte array set on this {@link AmqpMessageBody}. This library only\n+     * support one byte array, so the returned list will have only one element. Look for future releases where we will\n+     * support multiple byte array.\n+     * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+     * corresponding to the type of the body throws exception.</b>\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     */\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Can not return data for a \"\n+                + \"message which is of type %s.\", getBodyType().toString())));\n+        }\n+\n+        return new IterableStream<>(Collections.singletonList(data));\n+    }\n+\n     /**\n-     * Type representing various supported amqp body types.\n+     * Gets first byte array set on this {@link AmqpMessageBody}. This library only support one byte array on Amqp\n+     * Message. Look for future releases where we will support multiple byte array and you can use\n+     * {@link AmqpMessageBody#getData()} API.\n+     * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+     * corresponding to the type of the body throws exception.</b>\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n      *\n-     * @return The {@link AmqpBodyType}.\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#section-message-format\">\n+     *     Amqp Message Format.</a>\n      */\n-    AmqpBodyType getBodyType();\n+    public byte[] getFirstData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw LOGGER.logExceptionAsError(new IllegalArgumentException(String.format(\"Can not return data for a \"", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc4NzQ1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522787452", "bodyText": "Add more details about what are the various forms of message id and why and how to use this.", "author": "srnagar", "createdAt": "2020-11-13T08:25:31Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageId.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents Message id in various forms.", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc5MDA2OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522790069", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!messageId.equals(other.toString())) {\n          \n          \n            \n                        return false;\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    return true;\n          \n          \n            \n                    return Objects.equals(messageId, other.toString());", "author": "srnagar", "createdAt": "2020-11-13T08:27:46Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageId.java", "diffHunk": "@@ -0,0 +1,64 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents Message id in various forms.\n+ *\n+ * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-message-id-ulong\">\n+ *     Amqp Message Id.</a>\n+ */\n+public final class AmqpMessageId {\n+    private final String messageId;\n+\n+    /**\n+     * Creates the {@link AmqpMessageId} with given {@code messageId}.\n+     *\n+     * @param messageId representing id of the message.\n+     */\n+    public AmqpMessageId(String messageId) {\n+        this.messageId = Objects.requireNonNull(messageId, \"'messageId' cannot be null.\");\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return messageId.hashCode();\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public boolean equals(Object other) {\n+        if (other == null) {\n+            return false;\n+        }\n+\n+        if (this.getClass() != other.getClass()) {\n+            return false;\n+        }\n+\n+        if (this == other) {\n+            return true;\n+        }\n+\n+        if (!messageId.equals(other.toString())) {\n+            return false;\n+        }\n+\n+        return true;", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMjc5MTEzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r522791139", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (!address.equals(other.toString())) {\n          \n          \n            \n                        return false;\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    return true;\n          \n          \n            \n                    return Objects.equals(address, other.toString());", "author": "srnagar", "createdAt": "2020-11-13T08:28:42Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAddress.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents amqp address information. This will be used in populating information like 'To', 'ReplyTo' etc.\n+ *\n+ * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-address-string\">\n+ *     Address type Format.</a>\n+ */\n+public final class AmqpAddress {\n+\n+    private final String address;\n+\n+    /**\n+     * Creates the {@link AmqpAddress} with given {@code address}.\n+     *\n+     * @param address to use.\n+     */\n+    public AmqpAddress(String address) {\n+        this.address = Objects.requireNonNull(address, \"'address' cannot be null.\");\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return address.hashCode();\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public boolean equals(Object other) {\n+        if (other == null) {\n+            return false;\n+        }\n+\n+        if (this.getClass() != other.getClass()) {\n+            return false;\n+        }\n+\n+        if (this == other) {\n+            return true;\n+        }\n+\n+        if (!address.equals(other.toString())) {\n+            return false;\n+        }\n+\n+        return true;", "originalCommit": "9eb5273d7e3e30623d97f771e34a3e2ddbff2286", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5513888eff77aa242c898e40f8e7d4c5fe71ae38", "url": "https://github.com/Azure/azure-sdk-for-java/commit/5513888eff77aa242c898e40f8e7d4c5fe71ae38", "message": "Review Comments", "committedDate": "2020-11-13T17:05:23Z", "type": "commit"}, {"oid": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "url": "https://github.com/Azure/azure-sdk-for-java/commit/4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "message": "Review coments", "committedDate": "2020-11-14T00:38:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NTI3Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524855277", "bodyText": "Have you checked that this renders correctly in generated JavaDoc?", "author": "JonathanGiles", "createdAt": "2020-11-17T03:05:29Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAddress.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents amqp address information. This will be used in populating information like 'To', 'ReplyTo' etc.\n+ *\n+ * <p><strong>Create and retrieve address</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpAddress.createAndGet}\n+ *\n+ * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-address-string\">\n+ *     Address type Format.</a>", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDk3MDY3Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524970673", "bodyText": "Yes, I did verify them.", "author": "hemanttanwar", "createdAt": "2020-11-17T08:33:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NTI3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NTg5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524855893", "bodyText": "This documentation is really unclear. You're telling the user what will happen, but you aren't tell them why or how to avoid the issue.", "author": "JonathanGiles", "createdAt": "2020-11-17T03:07:40Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -46,10 +49,27 @@ public AmqpAnnotatedMessage(AmqpMessageBody body) {\n      * @param message used to create another instance of {@link AmqpAnnotatedMessage}.\n      *\n      * @throws NullPointerException if {@code message} or {@link AmqpAnnotatedMessage#getBody() body} is null.\n+     * @throws UnsupportedOperationException if {@link AmqpMessageBodyType} is {@link AmqpMessageBodyType#SEQUENCE} or\n+     * {@link AmqpMessageBodyType#VALUE}.\n+     * @throws IllegalStateException for invalid {@link AmqpMessageBodyType}.", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyMzA3OQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524923079", "bodyText": "Okay  added more doc and code sample to explain more.", "author": "hemanttanwar", "createdAt": "2020-11-17T07:02:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NTg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NjQ1Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524856452", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n          \n          \n            \n             * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not", "author": "JonathanGiles", "createdAt": "2020-11-17T03:09:44Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ *\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1Njg5MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524856891", "bodyText": "This error is copy / pasted in many places - please review all docs for similar typos.", "author": "JonathanGiles", "createdAt": "2020-11-17T03:11:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NjQ1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1NzMwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524857309", "bodyText": "This kind of error message only serves to confuse users. It is better to say that the type is not supported at present and that it will be available in future releases. Perhaps even going so far as to point to a pre-filed github issue so that users may find more or subscribe.", "author": "JonathanGiles", "createdAt": "2020-11-17T03:12:59Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ *\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private List<byte[]> data;\n+\n+    AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = Collections.singletonList(Arrays.copyOf(data, data.length));\n+        return body;\n+    }\n+\n     /**\n-     * Type representing various supported amqp body types.\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an {@link IterableStream} of byte array containing only first byte array set on this\n+     * {@link AmqpMessageBody}. This library only support one byte array, so the returned list will have only one\n+     * element. Look for future releases where we will support multiple byte array.\n      *\n-     * @return The {@link AmqpBodyType}.\n+     * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+     * corresponding to the type of the body throws exception.</b>\n+     *\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n      */\n-    AmqpBodyType getBodyType();\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(String.format(\"Cannot return data for a \"\n+                + \"message which is of type %s.\", getBodyType().toString())));", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1ODUzMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524858531", "bodyText": "you can call getFirstData now, can't you?", "author": "JonathanGiles", "createdAt": "2020-11-17T03:17:30Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusMessage.java", "diffHunk": "@@ -162,11 +162,10 @@ public AmqpAnnotatedMessage getAmqpAnnotatedMessage() {\n      * @return A byte array representing the data.\n      */\n     public BinaryData getBody() {\n-        final AmqpBodyType type = amqpAnnotatedMessage.getBody().getBodyType();\n+        final AmqpMessageBodyType type = amqpAnnotatedMessage.getBody().getBodyType();\n         switch (type) {\n             case DATA:\n-                Optional<byte[]> byteArrayData = ((AmqpDataBody) amqpAnnotatedMessage.getBody()).getData().stream()\n-                    .findFirst();\n+                Optional<byte[]> byteArrayData = amqpAnnotatedMessage.getBody().getData().stream().findFirst();", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NzYwMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524867601", "bodyText": "Yeah, this can either use body.getFirstData() or body.getData().iterator().next(). No need to use optional.", "author": "srnagar", "createdAt": "2020-11-17T03:51:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1ODUzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524859388", "bodyText": "Will service bus never support the other AmqpMessageId formats and will only ever support String?", "author": "JonathanGiles", "createdAt": "2020-11-17T03:20:31Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusReceivedMessage.java", "diffHunk": "@@ -554,7 +579,11 @@ void setLockedUntil(OffsetDateTime lockedUntil) {\n      * @param messageId to be set.\n      */\n     void setMessageId(String messageId) {\n-        amqpAnnotatedMessage.getProperties().setMessageId(messageId);\n+        AmqpMessageId id = null;\n+        if (messageId != null) {\n+            id = new AmqpMessageId(messageId);\n+        }\n+        amqpAnnotatedMessage.getProperties().setMessageId(id);", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkwODc1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524908751", "bodyText": "My understanding is that service bus will expose String only but advance user who want to stay in AMQP land, they can get AmqpAnnotatedMesage and set MessageId in other format whenever we provide support for it.\n@ramya-rao-a  Is this assumption correct ?", "author": "hemanttanwar", "createdAt": "2020-11-17T06:21:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDkyNjcyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524926729", "bodyText": "@JoshLove-msft has the details on this from the conversation with Clemens", "author": "ramya-rao-a", "createdAt": "2020-11-17T07:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQyMTU4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525421581", "bodyText": "If there is a future scenario where these other types are relevant, we should have a plan for how they will be enabled so that we can be sure it will be possible in a non-breaking fashion.", "author": "JonathanGiles", "createdAt": "2020-11-17T19:14:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQyNTAzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525425036", "bodyText": "The service already supports all formats. We didn't enable it yet in .NET because the AMQP lib doesn't allow for getting back the data in its underlying format - it only allows you to get it as a string.\nThe way we will support it in .NET would be to have different ctors for each of the additional formats.\nWe will also have TryGetX methods where users can attempt to get back the data for each format, and an enum Format Property that has the format, similar to how the AmqpMessageBody/BodyType works.", "author": "JoshLove-msft", "createdAt": "2020-11-17T19:20:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQyODk3Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525428972", "bodyText": "When you speak to how you will do this in .NET, are you speaking to how you would implement ServiceBusReceivedMessage? Right now we are looking at methods in Java such as setMessageId here, and it sounds like your proposed way forward would require a number of setter overloads for each type (or else, support for setting the AmqpMessageId directly)", "author": "JonathanGiles", "createdAt": "2020-11-17T19:26:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQ0NjcwMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525446702", "bodyText": "No this would be for setting it directly on the AmqpMessageProperties. We would not expose this on the ServiceBus API directly.", "author": "JoshLove-msft", "createdAt": "2020-11-17T19:44:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0NDU5MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525544590", "bodyText": "So the Service Bus APIs will continue to be String-only forever? @hemanttanwar Can you provide sample code on how this would be done (either today or in the future) for Java using the approach Josh shares above?", "author": "JonathanGiles", "createdAt": "2020-11-17T21:44:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg1OTM4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2NjYxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524866610", "bodyText": "I don't think copy is required here. Even if we did this for immutability, we'll have to do this again in getter methods which we are currently not doing. So, just copying here isn't useful.", "author": "srnagar", "createdAt": "2020-11-17T03:47:27Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ *\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private List<byte[]> data;\n+\n+    AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = Collections.singletonList(Arrays.copyOf(data, data.length));", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2ODEyNQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524868125", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 * @param address to use.\n          \n          \n            \n                 * @param The address to set for this instance.", "author": "srnagar", "createdAt": "2020-11-17T03:53:46Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAddress.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents amqp address information. This will be used in populating information like 'To', 'ReplyTo' etc.\n+ *\n+ * <p><strong>Create and retrieve address</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpAddress.createAndGet}\n+ *\n+ * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-address-string\">\n+ *     Address type Format.</a>\n+ */\n+public final class AmqpAddress {\n+\n+    private final String address;\n+\n+    /**\n+     * Creates the {@link AmqpAddress} with given {@code address}.\n+     *\n+     * @param address to use.", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2ODUzOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524868538", "bodyText": "The javadoc for overridden methods is inconsistent. hashCode has no javadoc, equals has @inheritdoc and toString has custom documentation. We should have consistent doc here.", "author": "srnagar", "createdAt": "2020-11-17T03:55:20Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAddress.java", "diffHunk": "@@ -0,0 +1,65 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents amqp address information. This will be used in populating information like 'To', 'ReplyTo' etc.\n+ *\n+ * <p><strong>Create and retrieve address</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpAddress.createAndGet}\n+ *\n+ * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-address-string\">\n+ *     Address type Format.</a>\n+ */\n+public final class AmqpAddress {\n+\n+    private final String address;\n+\n+    /**\n+     * Creates the {@link AmqpAddress} with given {@code address}.\n+     *\n+     * @param address to use.\n+     * @throws NullPointerException if {@code address} is null.\n+     */\n+    public AmqpAddress(String address) {\n+        this.address = Objects.requireNonNull(address, \"'address' cannot be null.\");\n+    }\n+\n+    @Override\n+    public int hashCode() {\n+        return address.hashCode();\n+    }\n+\n+    /**\n+     * {@inheritDoc}\n+     */\n+    @Override\n+    public boolean equals(Object other) {\n+        if (other == null) {\n+            return false;\n+        }\n+\n+        if (this.getClass() != other.getClass()) {\n+            return false;\n+        }\n+\n+        if (this == other) {\n+            return true;\n+        }\n+\n+        return Objects.equals(address, other.toString());\n+    }\n+\n+    /**\n+     * Gets string representation of the address.\n+     *\n+     * @return string representation of the address.\n+     */", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2ODk1Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524868957", "bodyText": "These links should be on AmqpMessageBodyType instead.", "author": "srnagar", "createdAt": "2020-11-17T03:56:55Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2OTI2Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524869263", "bodyText": "I don't think we should have information about future releases in this JavaDoc. It should instead be a GitHub issue tracked in our backlog.", "author": "srnagar", "createdAt": "2020-11-17T03:58:06Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg2OTgyMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524869820", "bodyText": "This can be made private as it's not required by any other class within the package.", "author": "srnagar", "createdAt": "2020-11-17T04:00:01Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Arrays;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to AMQP specification message body\n+ * types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA}. Other types will be supported in\n+ * future releases.\n+ * <b>Amqp message body types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-data\">DATA</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-amqp-sequence\">SEQUENCE</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-amqp-value\">VALUE</a></li>\n+ * </ul>\n+ *\n+ * <b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method.Get methods not\n+ * corresponding to the type of the body throws exception.</b>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private List<byte[]> data;\n+\n+    AmqpMessageBody() {", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg3MDYyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524870626", "bodyText": "If the message ids support string, long, uuid and binary types why does the constructor only have String?", "author": "srnagar", "createdAt": "2020-11-17T04:03:13Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageId.java", "diffHunk": "@@ -0,0 +1,70 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents Message id. Amqp specification support message id in various types. This class only implements\n+ * {@link String} representation at present.\n+ *\n+ * <p><strong>Create and retrieve message id </strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * <b>Amqp message id types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-id-string\">String</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-message-id-ulong\">long</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-id-uuid\">Uuid</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-id-binary\">binary</a></li>", "originalCommit": "4839f2f408edfe1c6a4e5aab43fe734cc0e29e47", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg4NDc3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r524884778", "bodyText": "We ,including dotnet, are only implementing String in this GA release.   And other types will be supported in future and by all the languages as well.", "author": "hemanttanwar", "createdAt": "2020-11-17T04:58:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNDg3MDYyNg=="}], "type": "inlineReview"}, {"oid": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "message": "Review Comments", "committedDate": "2020-11-17T08:27:54Z", "type": "commit"}, {"oid": "c64ca0188de5e7580234d8dd9122c4be3933e706", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c64ca0188de5e7580234d8dd9122c4be3933e706", "message": "Review Comments", "committedDate": "2020-11-17T08:33:27Z", "type": "commit"}, {"oid": "0292180d767ac84a00f010f705576b0abe179898", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0292180d767ac84a00f010f705576b0abe179898", "message": "Removed copy constructors", "committedDate": "2020-11-17T17:42:52Z", "type": "commit"}, {"oid": "235a6a4abcc1f9ccf0602ce20a1a8bc868b2718c", "url": "https://github.com/Azure/azure-sdk-for-java/commit/235a6a4abcc1f9ccf0602ce20a1a8bc868b2718c", "message": "unit test change", "committedDate": "2020-11-17T17:59:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNDAwOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525414009", "bodyText": "Just noting that we don't make a copy in .NET.", "author": "JoshLove-msft", "createdAt": "2020-11-17T19:05:04Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -59,12 +69,15 @@ public AmqpAnnotatedMessage(AmqpAnnotatedMessage message) {\n         AmqpMessageBodyType bodyType = message.getBody().getBodyType();\n         switch (bodyType) {\n             case DATA:\n-                amqpMessageBody = AmqpMessageBody.fromData(message.getBody().getFirstData());\n+                final byte[] data = message.getBody().getFirstData();\n+                amqpMessageBody = AmqpMessageBody.fromData(Arrays.copyOf(data, data.length));", "originalCommit": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNDQ3OA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525414478", "bodyText": "Why do we not copy here, but do in the AmqpMessage ctor?", "author": "JoshLove-msft", "createdAt": "2020-11-17T19:05:51Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -53,7 +48,7 @@ public static AmqpMessageBody fromData(byte[] data) {\n         Objects.requireNonNull(data, \"'data' cannot be null.\");\n         AmqpMessageBody body = new AmqpMessageBody();\n         body.bodyType = AmqpMessageBodyType.DATA;\n-        body.data = Collections.singletonList(Arrays.copyOf(data, data.length));\n+        body.data = Collections.singletonList(data);", "originalCommit": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMDAyMQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525410021", "bodyText": "nit: upper-case 'C'\nnit: 'supports', not 'support'", "author": "JonathanGiles", "createdAt": "2020-11-17T18:58:35Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -45,12 +48,19 @@ public AmqpAnnotatedMessage(AmqpMessageBody body) {\n \n     /**\n      * Creates instance of {@link AmqpAnnotatedMessage} with given {@link AmqpAnnotatedMessage} instance.\n+     * The Current implementation only support {@link AmqpMessageBodyType#DATA DATA} AMQP data type. Track this", "originalCommit": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMzM0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525413347", "bodyText": "Why are you copying the byte[] here?", "author": "JonathanGiles", "createdAt": "2020-11-17T19:04:05Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -59,12 +69,15 @@ public AmqpAnnotatedMessage(AmqpAnnotatedMessage message) {\n         AmqpMessageBodyType bodyType = message.getBody().getBodyType();\n         switch (bodyType) {\n             case DATA:\n-                amqpMessageBody = AmqpMessageBody.fromData(message.getBody().getFirstData());\n+                final byte[] data = message.getBody().getFirstData();\n+                amqpMessageBody = AmqpMessageBody.fromData(Arrays.copyOf(data, data.length));", "originalCommit": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUxMDg4Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525510887", "bodyText": "I actually removed copy constructor from AmqpAnnotatedMessage  , since this was created for service bus needs. dotnet also do not have copy constructor.\nAnd moved this logic into ServiceBusMessage, I still do Arrays.copyOf because when use is copying a ServiceBusReceivedMessage into ServiceBusMessage , changing one bytes should not effect bytes in other object. Thus I need to use  Arrays.copyOf", "author": "hemanttanwar", "createdAt": "2020-11-17T20:41:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMzM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUxNTQyOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525515429", "bodyText": "You should clarify the behavior with @JoshLove-msft to ensure we are not doing needless copies. Specifically, where, if anywhere, does .NET copy in their amqp or service bus library. I would guess it is less than we do.", "author": "JonathanGiles", "createdAt": "2020-11-17T20:49:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMzM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUyMDUxMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525520510", "bodyText": "We do not copy the bytes - we just create a new instance of AmqpMessageBody wrapping the same bytes - https://github.com/Azure/azure-sdk-for-net/blob/master/sdk/servicebus/Azure.Messaging.ServiceBus/src/Primitives/ServiceBusMessage.cs#L66-L72", "author": "JoshLove-msft", "createdAt": "2020-11-17T20:59:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMzM0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzNTMzMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525535333", "bodyText": "Okay I will  remove this copy from here.", "author": "hemanttanwar", "createdAt": "2020-11-17T21:26:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxMzM0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNDE4MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525414181", "bodyText": "\"support body type [%s] at present\" -> \"supports the AMQP Data body type at present\"", "author": "JonathanGiles", "createdAt": "2020-11-17T19:05:21Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpAnnotatedMessage.java", "diffHunk": "@@ -59,12 +69,15 @@ public AmqpAnnotatedMessage(AmqpAnnotatedMessage message) {\n         AmqpMessageBodyType bodyType = message.getBody().getBodyType();\n         switch (bodyType) {\n             case DATA:\n-                amqpMessageBody = AmqpMessageBody.fromData(message.getBody().getFirstData());\n+                final byte[] data = message.getBody().getFirstData();\n+                amqpMessageBody = AmqpMessageBody.fromData(Arrays.copyOf(data, data.length));\n                 break;\n             case SEQUENCE:\n             case VALUE:\n-                throw logger.logExceptionAsError(new UnsupportedOperationException(\"Body type not supported yet \"\n-                    + bodyType.toString()));\n+                throw logger.logExceptionAsError(new UnsupportedOperationException(\n+                    String.format(Locale.US, \"This constructor only support body type [%s] at present. Track \"\n+                        + \"this issue, https://github.com/Azure/azure-sdk-for-java/issues/17614 for other body type \"\n+                        + \"support in future.\", AmqpMessageBodyType.DATA.toString())));", "originalCommit": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNDg0Nw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525414847", "bodyText": "Why did you stop copying here?", "author": "JonathanGiles", "createdAt": "2020-11-17T19:06:28Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -53,7 +48,7 @@ public static AmqpMessageBody fromData(byte[] data) {\n         Objects.requireNonNull(data, \"'data' cannot be null.\");\n         AmqpMessageBody body = new AmqpMessageBody();\n         body.bodyType = AmqpMessageBodyType.DATA;\n-        body.data = Collections.singletonList(Arrays.copyOf(data, data.length));\n+        body.data = Collections.singletonList(data);", "originalCommit": "0886d24a21dc92ebb8db6f2ebd5eacfc69facbda", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUwNjQ2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525506460", "bodyText": "We are not providing immutable AmqpMessageBody . So I do not copy bytes when user create this object and also in getters. Matching how dotnet is doing.\nSrikanta also commented in his comment above.\n#17464 (comment)", "author": "hemanttanwar", "createdAt": "2020-11-17T20:35:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNDg0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzNzY1NA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525537654", "bodyText": "Based on discussion above #17464 (comment), I have  removed Arrays.copyOf from  AmqpMessageBody and ServiceBusMessage", "author": "hemanttanwar", "createdAt": "2020-11-17T21:31:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTQxNDg0Nw=="}], "type": "inlineReview"}, {"oid": "3140431d4111d34e3ecfb565244d7d6e18246ce2", "url": "https://github.com/Azure/azure-sdk-for-java/commit/3140431d4111d34e3ecfb565244d7d6e18246ce2", "message": "Incorporate review comments", "committedDate": "2020-11-17T21:02:40Z", "type": "commit"}, {"oid": "2d71f31d418865aa65ca65803b80d755236ffe14", "url": "https://github.com/Azure/azure-sdk-for-java/commit/2d71f31d418865aa65ca65803b80d755236ffe14", "message": "Incorporate review comments", "committedDate": "2020-11-17T21:21:16Z", "type": "commit"}, {"oid": "79c54385a95525092a645413af64c215995ce178", "url": "https://github.com/Azure/azure-sdk-for-java/commit/79c54385a95525092a645413af64c215995ce178", "message": "Removed copy constructors", "committedDate": "2020-11-17T21:28:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzNzM1NQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525537355", "bodyText": "nit: these new lines under the if statement in various places look out of place.", "author": "JonathanGiles", "createdAt": "2020-11-17T21:30:40Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to an AMQP specification message\n+ * body types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA} AMQP data type. Track this\n+ * <a href=\"https://github.com/Azure/azure-sdk-for-java/issues/17614\" target=\"_blank\">issue</a> to find out support for\n+ * other AMQP types.\n+ *\n+ * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+ * corresponding to the type of the body throws exception.</b></p>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private List<byte[]> data;\n+\n+    private AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = Collections.singletonList(data);\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an {@link IterableStream} of byte array containing only first byte array set on this\n+     * {@link AmqpMessageBody}. This library only support one byte array at present, so the returned list will have only\n+     *  one element.\n+     * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+     * corresponding to the type of the body throws exception.</b></p>\n+     *\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     */\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\n+                \"This method can only be called for AMQP Data body type at present. Track this issue, \"\n+                    + \"https://github.com/Azure/azure-sdk-for-java/issues/17614 for other body type support in \"\n+                    + \"future.\"));\n+        }\n+\n+        return new IterableStream<>(data);\n+    }\n+\n     /**\n-     * Type representing various supported amqp body types.\n+     * Gets first byte array set on this {@link AmqpMessageBody}. This library only support one byte array on Amqp\n+     * Message. Look for future releases where we will support multiple byte array and you can use\n+     * {@link AmqpMessageBody#getData()} API.\n+     * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+     * corresponding to the type of the body throws exception.</b></p>\n      *\n-     * @return The {@link AmqpBodyType}.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#section-message-format\" target=\"_blank\">\n+     *     Amqp Message Format.</a>\n      */\n-    AmqpBodyType getBodyType();\n+    public byte[] getFirstData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+\n+            throw logger.logExceptionAsError(new IllegalArgumentException(", "originalCommit": "79c54385a95525092a645413af64c215995ce178", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzNzkxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525537913", "bodyText": "If the common case is to have users call this getFirstData API, we shouldn't wrap into a collection and call get(0) on it, as it is just extra work. We should only wrap the first time the getData call is made, and keep it as a byte[] otherwise.", "author": "JonathanGiles", "createdAt": "2020-11-17T21:31:37Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,113 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to an AMQP specification message\n+ * body types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA} AMQP data type. Track this\n+ * <a href=\"https://github.com/Azure/azure-sdk-for-java/issues/17614\" target=\"_blank\">issue</a> to find out support for\n+ * other AMQP types.\n+ *\n+ * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+ * corresponding to the type of the body throws exception.</b></p>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    private List<byte[]> data;\n+\n+    private AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = Collections.singletonList(data);\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an {@link IterableStream} of byte array containing only first byte array set on this\n+     * {@link AmqpMessageBody}. This library only support one byte array at present, so the returned list will have only\n+     *  one element.\n+     * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+     * corresponding to the type of the body throws exception.</b></p>\n+     *\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     */\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\n+                \"This method can only be called for AMQP Data body type at present. Track this issue, \"\n+                    + \"https://github.com/Azure/azure-sdk-for-java/issues/17614 for other body type support in \"\n+                    + \"future.\"));\n+        }\n+\n+        return new IterableStream<>(data);\n+    }\n+\n     /**\n-     * Type representing various supported amqp body types.\n+     * Gets first byte array set on this {@link AmqpMessageBody}. This library only support one byte array on Amqp\n+     * Message. Look for future releases where we will support multiple byte array and you can use\n+     * {@link AmqpMessageBody#getData()} API.\n+     * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+     * corresponding to the type of the body throws exception.</b></p>\n      *\n-     * @return The {@link AmqpBodyType}.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     * @see <a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#section-message-format\" target=\"_blank\">\n+     *     Amqp Message Format.</a>\n      */\n-    AmqpBodyType getBodyType();\n+    public byte[] getFirstData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\n+                \"This method can only be called for AMQP Data body type at present. Track this issue, \"\n+                    + \"https://github.com/Azure/azure-sdk-for-java/issues/17614 for other body type support in \"\n+                    + \"future.\"));\n+        }\n+\n+        return data.get(0);", "originalCommit": "79c54385a95525092a645413af64c215995ce178", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzOTQ2MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525539460", "bodyText": "I'm curious, what are the repercussions of a user doing this:\nmessageBody = amqpAnnotatedMessage.getBody();", "author": "JonathanGiles", "createdAt": "2020-11-17T21:34:38Z", "path": "sdk/core/azure-core-amqp/src/samples/java/com/azure/core/amqp/models/AmqpAnnotatedMessageJavaDocCodeSamples.java", "diffHunk": "@@ -0,0 +1,30 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+/**\n+ * Class contains sample code snippets that will be used in javadocs.\n+ */\n+public class AmqpAnnotatedMessageJavaDocCodeSamples {\n+    /**\n+     * Get message body from {@link AmqpAnnotatedMessage}.\n+     */\n+    public void checkBodyType() {\n+        AmqpAnnotatedMessage amqpAnnotatedMessage = null;\n+        // BEGIN: com.azure.core.amqp.models.AmqpBodyType.checkBodyType\n+        AmqpMessageBodyType bodyType = amqpAnnotatedMessage.getBody().getBodyType();\n+        AmqpMessageBody messageBody = null;\n+        switch (bodyType) {\n+            case DATA:\n+                messageBody = AmqpMessageBody.fromData(amqpAnnotatedMessage.getBody().getFirstData());", "originalCommit": "79c54385a95525092a645413af64c215995ce178", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0MDEyNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525540124", "bodyText": "Put another way...this code is demonstrating how to switch off the body type, but to me it raises questions about what it is actually demonstrating, and what the real use case is.", "author": "JonathanGiles", "createdAt": "2020-11-17T21:35:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzOTQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU0MTExMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525541113", "bodyText": "It would be good to clarify to the user in this sample code and / or Java why the code I put above is wrong, because I would guess that most people would do that by default.", "author": "JonathanGiles", "createdAt": "2020-11-17T21:37:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzOTQ2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTYwNDA5Mg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r525604092", "bodyText": "updated sample to clarify this  why user should not call this directly.", "author": "hemanttanwar", "createdAt": "2020-11-17T23:57:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzOTQ2MA=="}], "type": "inlineReview"}, {"oid": "627f57f54c88445bc2b6e52a1f0622df252b8afd", "url": "https://github.com/Azure/azure-sdk-for-java/commit/627f57f54c88445bc2b6e52a1f0622df252b8afd", "message": "Review comments , code snippets java doc etc", "committedDate": "2020-11-17T23:53:40Z", "type": "commit"}, {"oid": "6c9667aa9134963ad6f27882617e18331bfd9a34", "url": "https://github.com/Azure/azure-sdk-for-java/commit/6c9667aa9134963ad6f27882617e18331bfd9a34", "message": "fix copy constructor API change", "committedDate": "2020-11-18T04:05:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5MTQxOA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526791418", "bodyText": "nit: Update comment as this is not a package-private constructor anymore or remove the comment", "author": "srnagar", "createdAt": "2020-11-19T11:24:17Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,115 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to an AMQP specification message\n+ * body types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA} AMQP data type. Track this\n+ * <a href=\"https://github.com/Azure/azure-sdk-for-java/issues/17614\" target=\"_blank\">issue</a> to find out support for\n+ * other AMQP types.\n+ *\n+ * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+ * corresponding to the type of the body throws exception.</b></p>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    // We expect user to call `getFirstData()` more because we support one byte[] as present.\n+    // This the priority here to store payload as `byte[] data` and\n+    private byte[] data;\n+    private List<byte[]> dataList;\n+\n+    private AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5MzcxOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526793719", "bodyText": "We don't need to include future release plans in javadoc.", "author": "srnagar", "createdAt": "2020-11-19T11:27:20Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBody.java", "diffHunk": "@@ -3,14 +3,115 @@\n \n package com.azure.core.amqp.models;\n \n+import com.azure.core.util.IterableStream;\n+import com.azure.core.util.logging.ClientLogger;\n+\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Objects;\n+\n /**\n- * Interface representing Amqp Message Body.\n+ * This class encapsulates the body of a message. The {@link AmqpMessageBodyType} map to an AMQP specification message\n+ * body types. Current implementation only support {@link AmqpMessageBodyType#DATA DATA} AMQP data type. Track this\n+ * <a href=\"https://github.com/Azure/azure-sdk-for-java/issues/17614\" target=\"_blank\">issue</a> to find out support for\n+ * other AMQP types.\n+ *\n+ * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+ * corresponding to the type of the body throws exception.</b></p>\n+ *\n+ * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+ *\n+ * @see AmqpMessageBodyType\n  */\n-public interface AmqpMessageBody {\n+public final class AmqpMessageBody {\n+    private final ClientLogger logger = new ClientLogger(AmqpMessageBody.class);\n+    private AmqpMessageBodyType bodyType;\n+\n+    // We expect user to call `getFirstData()` more because we support one byte[] as present.\n+    // This the priority here to store payload as `byte[] data` and\n+    private byte[] data;\n+    private List<byte[]> dataList;\n+\n+    private AmqpMessageBody() {\n+        // package constructor so no one can create instance of this except classes im this package.\n+    }\n+\n+    /**\n+     * Creates instance of {@link AmqpMessageBody} with given byte array.\n+     *\n+     * @param data used to create another instance of {@link AmqpMessageBody}.\n+     *\n+     * @return AmqpMessageBody Newly created instance.\n+     *\n+     * @throws NullPointerException if {@code data} is null.\n+     */\n+    public static AmqpMessageBody fromData(byte[] data) {\n+        Objects.requireNonNull(data, \"'data' cannot be null.\");\n+        AmqpMessageBody body = new AmqpMessageBody();\n+        body.bodyType = AmqpMessageBodyType.DATA;\n+        body.data = data;\n+        return body;\n+    }\n+\n+    /**\n+     * Gets the {@link AmqpMessageBodyType} of the message.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return AmqpBodyType type of the message.\n+     */\n+    public AmqpMessageBodyType getBodyType() {\n+        return bodyType;\n+    }\n+\n+    /**\n+     * Gets an {@link IterableStream} of byte array containing only first byte array set on this\n+     * {@link AmqpMessageBody}. This library only support one byte array at present, so the returned list will have only\n+     *  one element.\n+     * <p><b>Client should test for {@link AmqpMessageBodyType} before calling corresponding get method. Get methods not\n+     * corresponding to the type of the body throws exception.</b></p>\n+     *\n+     * <p><strong>How to check for {@link AmqpMessageBodyType}</strong></p>\n+     * {@codesnippet com.azure.core.amqp.models.AmqpBodyType.checkBodyType}\n+     * @return data set on {@link AmqpMessageBody}.\n+     *\n+     * @throws IllegalArgumentException If {@link AmqpMessageBodyType} is not {@link AmqpMessageBodyType#DATA DATA}.\n+     */\n+    public IterableStream<byte[]> getData() {\n+        if (bodyType != AmqpMessageBodyType.DATA) {\n+            throw logger.logExceptionAsError(new IllegalArgumentException(\n+                \"This method can only be called for AMQP Data body type at present. Track this issue, \"\n+                    + \"https://github.com/Azure/azure-sdk-for-java/issues/17614 for other body type support in \"\n+                    + \"future.\"));\n+        }\n+        if (dataList ==  null) {\n+            dataList = Collections.singletonList(data);\n+        }\n+        return new IterableStream<>(dataList);\n+    }\n+\n     /**\n-     * Type representing various supported amqp body types.\n+     * Gets first byte array set on this {@link AmqpMessageBody}. This library only support one byte array on Amqp\n+     * Message. Look for future releases where we will support multiple byte array and you can use\n+     * {@link AmqpMessageBody#getData()} API.", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NDkzNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526794936", "bodyText": "Same here - javadoc doesn't have to include future release issues. We can just state that currently only DATA type is supported.", "author": "srnagar", "createdAt": "2020-11-19T11:29:25Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageBodyType.java", "diffHunk": "@@ -0,0 +1,33 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+/**\n+ * Represents all valid {@link AmqpMessageBodyType} for an AMQP Message. Current SDK only support\n+ * {@link AmqpMessageBodyType#DATA DATA} AMQP data type. Track this <a href=\"https://github.com/Azure/azure-sdk-for-java/issues/17614\" target=\"_blank\">issue</a>\n+ * to find out support for other AMQP types.", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzNDAyNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r527034027", "bodyText": "Jonathan specifically asked me to create an issue and include which user can subscribe to,", "author": "hemanttanwar", "createdAt": "2020-11-19T16:42:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NDkzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NTY5Mw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526795693", "bodyText": "If this class only supports string id, do we need to have all other types in this javadoc?", "author": "srnagar", "createdAt": "2020-11-19T11:30:39Z", "path": "sdk/core/azure-core-amqp/src/main/java/com/azure/core/amqp/models/AmqpMessageId.java", "diffHunk": "@@ -0,0 +1,71 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+import java.util.Objects;\n+\n+/**\n+ * This represents Message id. Amqp specification support message id in various types. This class only implements\n+ * {@link String} representation at present.\n+ *\n+ * <p><strong>Create and retrieve message id </strong></p>\n+ * {@codesnippet com.azure.core.amqp.models.AmqpMessageId.createAndGet}\n+ *\n+ * <b>Amqp message id types:</b>\n+ * <ul>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-id-string\" target=\"_blank\">String</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/amqp-core-messaging-v1.0.html#type-message-id-ulong\" target=\"_blank\">long</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-id-uuid\" target=\"_blank\">Uuid</a></li>\n+ * <li><a href=\"http://docs.oasis-open.org/amqp/core/v1.0/os/amqp-core-messaging-v1.0-os.html#type-message-id-binary\" target=\"_blank\">binary</a></li>\n+ * </ul>", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzAzNjcyNg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r527036726", "bodyText": "ok removing", "author": "hemanttanwar", "createdAt": "2020-11-19T16:45:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NTY5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5NjkwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526796907", "bodyText": "We should have a single class for all javadocs. Users landing on our samples directory will see too many javadoc classes and can distract them from real samples.", "author": "srnagar", "createdAt": "2020-11-19T11:32:53Z", "path": "sdk/core/azure-core-amqp/src/samples/java/com/azure/core/amqp/models/AmqpAddressJavaDocCodeSamples.java", "diffHunk": "@@ -0,0 +1,21 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.core.amqp.models;\n+\n+/**\n+ * Class contains sample code snippets that will be used in javadocs.\n+ */\n+public class AmqpAddressJavaDocCodeSamples {", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjc5OTYzMA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526799630", "bodyText": "Why point users to AmqpAnnotatedMessage when we are trying to hide/minimize it's usage?", "author": "srnagar", "createdAt": "2020-11-19T11:37:13Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusMessage.java", "diffHunk": "@@ -108,23 +109,109 @@ public ServiceBusMessage(BinaryData body) {\n      * @param receivedMessage The received message to create new message from.\n      *\n      * @throws NullPointerException if {@code receivedMessage} is {@code null}.\n+     * @throws UnsupportedOperationException if {@link AmqpMessageBodyType} is {@link AmqpMessageBodyType#SEQUENCE} or\n+     * {@link AmqpMessageBodyType#VALUE}. See code sample above explaining how to check for {@link AmqpMessageBodyType}\n+     * before calling this constructor.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType} before calling this constructor</strong></p>\n+     * {@codesnippet com.azure.messaging.servicebus.ServiceBusMessage.copyServiceBusMessage}\n+     * @throws IllegalStateException for invalid {@link AmqpMessageBodyType}.\n+     * @see AmqpAnnotatedMessage", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMDM0MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526800341", "bodyText": "Why was the copy-constructor removed from AmqpAnnotatedMessage? We did have the copy constructor earlier.", "author": "srnagar", "createdAt": "2020-11-19T11:38:35Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/main/java/com/azure/messaging/servicebus/ServiceBusMessage.java", "diffHunk": "@@ -108,23 +109,109 @@ public ServiceBusMessage(BinaryData body) {\n      * @param receivedMessage The received message to create new message from.\n      *\n      * @throws NullPointerException if {@code receivedMessage} is {@code null}.\n+     * @throws UnsupportedOperationException if {@link AmqpMessageBodyType} is {@link AmqpMessageBodyType#SEQUENCE} or\n+     * {@link AmqpMessageBodyType#VALUE}. See code sample above explaining how to check for {@link AmqpMessageBodyType}\n+     * before calling this constructor.\n+     * <p><strong>How to check for {@link AmqpMessageBodyType} before calling this constructor</strong></p>\n+     * {@codesnippet com.azure.messaging.servicebus.ServiceBusMessage.copyServiceBusMessage}\n+     * @throws IllegalStateException for invalid {@link AmqpMessageBodyType}.\n+     * @see AmqpAnnotatedMessage\n      */\n     public ServiceBusMessage(ServiceBusReceivedMessage receivedMessage) {\n         Objects.requireNonNull(receivedMessage, \"'receivedMessage' cannot be null.\");\n \n-        this.amqpAnnotatedMessage = new AmqpAnnotatedMessage(receivedMessage.getAmqpAnnotatedMessage());", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA0MDE1MQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r527040151", "bodyText": "I removed it for following reasons\n\nCopy constructor is kind of Service bus needs and other library do not need it, for example Events hub.\ndotnet also do not have it,  so to in sync with dotnet.", "author": "hemanttanwar", "createdAt": "2020-11-19T16:50:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwMDM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwNDM1MA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526804350", "bodyText": "Same applies here. Add all javadoc samples in one class.", "author": "srnagar", "createdAt": "2020-11-19T11:45:30Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ServiceBusMessageJavaDocCodeSamples.java", "diffHunk": "@@ -0,0 +1,33 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.messaging.servicebus;\n+\n+import com.azure.core.amqp.models.AmqpAnnotatedMessage;\n+import com.azure.core.amqp.models.AmqpMessageBodyType;\n+\n+/**\n+ * java doc sample for  {@link ServiceBusMessage}.\n+ */\n+public class ServiceBusMessageJavaDocCodeSamples {", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwNTUwNw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r526805507", "bodyText": "To copy a received message, why does the user have to check the body type? This should be taken care of in the constructor of ServiceBusMessage.", "author": "srnagar", "createdAt": "2020-11-19T11:47:37Z", "path": "sdk/servicebus/azure-messaging-servicebus/src/samples/java/com/azure/messaging/servicebus/ServiceBusMessageJavaDocCodeSamples.java", "diffHunk": "@@ -0,0 +1,33 @@\n+// Copyright (c) Microsoft Corporation. All rights reserved.\n+// Licensed under the MIT License.\n+\n+package com.azure.messaging.servicebus;\n+\n+import com.azure.core.amqp.models.AmqpAnnotatedMessage;\n+import com.azure.core.amqp.models.AmqpMessageBodyType;\n+\n+/**\n+ * java doc sample for  {@link ServiceBusMessage}.\n+ */\n+public class ServiceBusMessageJavaDocCodeSamples {\n+    /**\n+     * Copy {@link AmqpAnnotatedMessage}.\n+     */\n+    public void copyServiceBusReceivedMessage() {\n+        ServiceBusReceivedMessage sourceServiceBusReceivedMessage = null;\n+        // BEGIN: com.azure.messaging.servicebus.ServiceBusMessage.copyServiceBusMessage\n+        AmqpMessageBodyType bodyType = sourceServiceBusReceivedMessage.getAmqpAnnotatedMessage().getBody().getBodyType();\n+        ServiceBusMessage copyMessage = null;\n+        switch (bodyType) {\n+            case DATA:\n+                copyMessage = new ServiceBusMessage(sourceServiceBusReceivedMessage);\n+                break;\n+            case SEQUENCE:\n+            case VALUE:\n+                throw new RuntimeException(\"Body type not supported yet.\");\n+            default:\n+                throw new RuntimeException(\"Body type not valid.\");\n+        }", "originalCommit": "6c9667aa9134963ad6f27882617e18331bfd9a34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA2MzQwNA==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/17464#discussion_r527063404", "bodyText": "Actually, we will not create a SBRM with any other type except DATA for now. So User should not face this problem in copy constructor where type is something else. So  user should not need to check this type.", "author": "hemanttanwar", "createdAt": "2020-11-19T17:21:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjgwNTUwNw=="}], "type": "inlineReview"}, {"oid": "c72a301e2ceda03fc8262b3d4e4de97f72e57818", "url": "https://github.com/Azure/azure-sdk-for-java/commit/c72a301e2ceda03fc8262b3d4e4de97f72e57818", "message": "Resolved more review comments", "committedDate": "2020-11-19T17:23:16Z", "type": "commit"}]}