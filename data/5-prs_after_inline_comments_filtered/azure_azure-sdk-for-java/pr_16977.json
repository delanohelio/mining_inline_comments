{"pr_number": 16977, "pr_title": "Close client and check for link id when link is stolen", "pr_createdAt": "2020-10-29T22:58:11Z", "pr_url": "https://github.com/Azure/azure-sdk-for-java/pull/16977", "timeline": [{"oid": "0e73302b73aeb639260d4df3592a31ce606bf278", "url": "https://github.com/Azure/azure-sdk-for-java/commit/0e73302b73aeb639260d4df3592a31ce606bf278", "message": "Close client and check for link id when link is stolen", "committedDate": "2020-10-29T22:52:10Z", "type": "commit"}, {"oid": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc", "url": "https://github.com/Azure/azure-sdk-for-java/commit/1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc", "message": "Fix checkstyle", "committedDate": "2020-10-29T23:29:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5ODMzOQ==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#discussion_r514898339", "bodyText": "In what case a link name is the same as a tracking id?", "author": "YijunXieMS", "createdAt": "2020-10-30T06:41:14Z", "path": "sdk/eventhubs/azure-messaging-eventhubs/src/main/java/com/azure/messaging/eventhubs/implementation/AmqpReceiveLinkProcessor.java", "diffHunk": "@@ -166,6 +169,21 @@ public void onNext(AmqpReceiveLink next) {\n                         }\n                     },\n                     error -> {\n+                        if (error instanceof AmqpException) {\n+                            AmqpException amqpException = (AmqpException) error;\n+                            if (amqpException.getErrorCondition() == AmqpErrorCondition.LINK_STOLEN\n+                                && amqpException.getContext() != null\n+                                && amqpException.getContext() instanceof LinkErrorContext) {\n+                                LinkErrorContext errorContext = (LinkErrorContext) amqpException.getContext();\n+                                if (currentLink != null\n+                                    && !currentLink.getLinkName().equals(errorContext.getTrackingId())) {", "originalCommit": "1a73212d0a7e0ae3d7b4ebb85b56ec4715ebd7bc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5OTQyMg==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#discussion_r514899422", "bodyText": "I thought the trackingId was an autogenerated value?", "author": "conniey", "createdAt": "2020-10-30T06:45:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5ODMzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDkxNzMxMw==", "url": "https://github.com/Azure/azure-sdk-for-java/pull/16977#discussion_r514917313", "bodyText": "When the link is stolen, the trackingId in LinkErrorContext is the link name.\nif (link.getRemoteProperties() != null && link.getRemoteProperties().containsKey(TRACKING_ID_PROPERTY)) {\n    referenceId = link.getRemoteProperties().get(TRACKING_ID_PROPERTY).toString();\n} else {\n    referenceId = link.getName();\n}\nreturn new LinkErrorContext(getHostname(), entityPath, referenceId, link.getCredit());", "author": "srnagar", "createdAt": "2020-10-30T07:40:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNDg5ODMzOQ=="}], "type": "inlineReview"}]}