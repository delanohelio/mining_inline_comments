{"pr_number": 418, "pr_title": "Fixing migration of concepts whith refernces to other concepts", "pr_createdAt": "2020-01-09T17:06:00Z", "pr_url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/418", "timeline": [{"oid": "a036d791c3ccb8ebcfae7b95ff8dd896115c5696", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/a036d791c3ccb8ebcfae7b95ff8dd896115c5696", "message": "Fixing resolution to linked resources - (Task #417)\n\n- Changed the Migration ResourceSet to always hand back\nnull for eobjects in referenced resources. This way the linked resources\nwill remain as proxy objects in the currently migrated concept. procies\nare not critical for migration.\n- Adjusted the ActiveConceptConfigurationElement to correctly link a\nconcept to existing ones in the repository. Adjustments also consider\nuri fragment resolution.\n- Adjusted the test cases by fixing a bug in the old test case bailing\nout to early. Also added new asserts to check if the proxy objects get\ncorrectly linked to existing concepts.\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-09T17:01:18Z", "type": "commit"}, {"oid": "057d82f47087bd494dcd9742bf78ad24db4e51b9", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/057d82f47087bd494dcd9742bf78ad24db4e51b9", "message": "Improved getCategory in helper - (Task #417)\n\n- The getCategory method now allows to search for a category in the\nconcept using its FQN. The search uses the last part of the FQN\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-10T12:38:21Z", "type": "commit"}, {"oid": "929a72a714ccaf5a690dd3e52a2846cbf163faca", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/929a72a714ccaf5a690dd3e52a2846cbf163faca", "message": "Refactored Test Class hierarchy for concepts - (Task #417)\n\n- Added a new test class for Concept Test Cases\n- Refactored code to load concpets\n- Prepared TestConcept to also load Maturity Concept\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-10T12:41:30Z", "type": "commit"}, {"oid": "56d9dea28e3c4f319e0425c9c77884fc2b30664e", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/56d9dea28e3c4f319e0425c9c77884fc2b30664e", "message": "Updated Test Concept for testing migration - (Task #417)\n\n- Added new Category to Test Concept with an equation linking to the\nmaturity concept.\n- Updated dependencies into maturity concept\n- Added a new version of the test concept to actually test the concept\nmigrator.\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-10T12:47:26Z", "type": "commit"}, {"oid": "22e35a145f6d8c7f4b9da5f06ae4c6ec26fe61ff", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/22e35a145f6d8c7f4b9da5f06ae4c6ec26fe61ff", "message": "Reintroducing timeout for unit tests - (Task #417)\n\n- Got aciidetially removed.\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-10T14:47:33Z", "type": "commit"}, {"oid": "7872e3d35eb2c8b3a89c3322a4dff7abff5f9528", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7872e3d35eb2c8b3a89c3322a4dff7abff5f9528", "message": "Fixed Activation of Concepts and Dependencies - (Task #417)\n\n- Changed process of adding depending concepts. Now based on selection\nof concepts rather than cross references to the selection. change was\nneeded due to new way of loading concepts that need migration.\n- Refactored some of the code into ActiveConceptHelper.\n- Added test cases for new methods.\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-13T09:25:54Z", "type": "commit"}, {"oid": "cf300cf2a367db5b05b1b60ce90be9e0ad07b782", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/cf300cf2a367db5b05b1b60ce90be9e0ad07b782", "message": "Merge from Development - (Task #417)\n\n- Merge from Development due to #407 finished and merged on development.\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-13T11:51:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc1MDY4NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/418#discussion_r365750684", "bodyText": "What about this commented out line?", "author": "SaMuellerDLR", "createdAt": "2020-01-13T11:14:17Z", "path": "de.dlr.sc.virsat.model.edit.test/src/de/dlr/sc/virsat/model/dvlm/concepts/registry/ActiveConceptConfigurationElementTest.java", "diffHunk": "@@ -107,14 +114,8 @@ public void testCreateAddActiveConceptCommand() {\n \t    Repository repository = DVLMFactory.eINSTANCE.createRepository();\r\n \t    resourceRepository.getContents().add(repository);\r\n \t    \r\n-\t\t// Adding Concept B before A will fail\r\n-\t\texpectedException.expect(RuntimeException.class);\r\n-\t\tCommand failCommand = ActiveConceptConfigurationElement.createCopyConceptToRepository(ourEditingDomain, conceptSourceB, repository);\r\n-\t\tfailCommand.execute();\r\n-\t\tassertTrue(\"ActiveConcepts are not present\", repository.getActiveConcepts().isEmpty());\r\n-\t\t\r\n \t\t// Concept A should be added without any trouble\r\n-\t\texpectedException = ExpectedException.none();\r\n+\t\t//expectedException = ExpectedException.none();\r", "originalCommit": "7872e3d35eb2c8b3a89c3322a4dff7abff5f9528", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTgwNTE0Ng==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/418#discussion_r365805146", "bodyText": "Has to be removed, it is now expected at the end of the test case.", "author": "PhilMFischer", "createdAt": "2020-01-13T13:33:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc1MDY4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NTc1MjgxNw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/418#discussion_r365752817", "bodyText": "Minor typo cleanedConcpetImport -> cleanedConceptImport", "author": "SaMuellerDLR", "createdAt": "2020-01-13T11:19:48Z", "path": "de.dlr.sc.virsat.model/src/de/dlr/sc/virsat/model/dvlm/concepts/util/ActiveConceptHelper.java", "diffHunk": "@@ -572,4 +590,32 @@ public static final String getDmfNsUriForConcept(Concept concept) {\n \t\tString conceptName = VirSatEcoreUtil.getNameOfFqn(concept.getName());\r\n \t\treturn MODEL_URI_PREFIX + concept.getVersion() + \"/\" + VirSatEcoreUtil.getNameOfFqn(conceptName);\r\n \t}\r\n+\r\n+\t/**\r\n+\t * The method hands back the ConceptID of an Imported NameSpace. An\r\n+\t * Imported NameSpace always consists of the ConceptID + the ElemenID.\r\n+\t * E.G. de.dlr.testConcept.testCategory\r\n+\t * @param conceptImport The Import Object for importing the NameSpace\r\n+\t * @return the cleaned ID of the concept to be imported\r\n+\t */\r\n+\tpublic static String getConceptFromImport(ConceptImport conceptImport) {\r\n+\t\tString importedNameSpace = conceptImport.getImportedNamespace();\r\n+\t\tint lastIndexOfDot =  importedNameSpace.lastIndexOf(FQID_DELIMITER);\r\n+\t\tString importedConceptId = importedNameSpace.substring(0, lastIndexOfDot);\r\n+\t\treturn importedConceptId;\r\n+\t}\r\n+\t\r\n+\t/**\r\n+\t * This method hands back the IDs of concepts which are imported\r\n+\t * @param concept the concept for which to get all imported concepts\r\n+\t * @return A set of Strings with all IDs\r\n+\t */\r\n+\tpublic static Set<String> getConceptDependencies(Concept concept) {\r\n+\t\tSet<String> importedConceptIds = new HashSet<>();\r\n+\t\tconcept.getImports().forEach(conceptImport -> {\r\n+\t\t\tString cleanedConcpetImport = getConceptFromImport(conceptImport);\r", "originalCommit": "7872e3d35eb2c8b3a89c3322a4dff7abff5f9528", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1624efe261abe294417e640d6c5e8ceb7814184b", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/1624efe261abe294417e640d6c5e8ceb7814184b", "message": "Fix due to comment - (Task #417)\n\n- removed Commented Expected Exception. It is now expected at the end of\nthe test\n- fixed indentation by replacing BS with tab.\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-13T13:32:24Z", "type": "commit"}, {"oid": "c6125b61807712198577dacdc7b855fbbebd38c4", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/c6125b61807712198577dacdc7b855fbbebd38c4", "message": "Fixed typo due to review comment - (Task #417)\n\n---\nTask #417: Exception when migrating concepts with references", "committedDate": "2020-01-13T13:35:30Z", "type": "commit"}]}