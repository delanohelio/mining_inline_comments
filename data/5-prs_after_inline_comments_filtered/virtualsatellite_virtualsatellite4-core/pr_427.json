{"pr_number": 427, "pr_title": "DND Override functionality for navigator", "pr_createdAt": "2020-01-15T12:36:58Z", "pr_url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427", "timeline": [{"oid": "ced3920688cd91f6c3805714f329cd385db9b271", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ced3920688cd91f6c3805714f329cd385db9b271", "message": "Added API for delegated drop adapters - (Task #74)\n\n- Added drop adapter to navigator which is capable of redirecting drag\nand drop operations to different drop handlers.\n- Added extension point to register new drop adapters for individual\nconcepts.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-15T08:16:27Z", "type": "commit"}, {"oid": "22593841e82aa1cf6087839249f42b22618f00c2", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/22593841e82aa1cf6087839249f42b22618f00c2", "message": "Added Empty Implementation for PS Drop Adapter - (Task #74)\n\n- Added concept specific dropa dapter to Product structure model\nextension\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-15T09:53:30Z", "type": "commit"}, {"oid": "4db03be95323457f54372e42f8f17216f8f85caa", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/4db03be95323457f54372e42f8f17216f8f85caa", "message": "Merge remote-tracking branch 'origin/development' into feature/task_74-Override_DND_functiona", "committedDate": "2020-01-15T13:56:06Z", "type": "commit"}, {"oid": "d5b8d7a218211de589f9a6c9676bb4d6ee276c69", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/d5b8d7a218211de589f9a6c9676bb4d6ee276c69", "message": "Implemented first Product Structure related dropAdapter - (Task #74)\n\n- Renamed extension point schema.\n- Fixed code to load delegation drop adapter from registration\n- Implemented first drop adapter to replace typing of a given\nstructuralelementinstance.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-15T15:02:47Z", "type": "commit"}, {"oid": "4e3350506877917a67068e45a19a028ea3982bb1", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/4e3350506877917a67068e45a19a028ea3982bb1", "message": "Refactored Command Checks - (Task #74)\n\n- Now checking if object can be inherited from, otherwise a command will\nbe set to be unexecutable.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-15T16:11:36Z", "type": "commit"}, {"oid": "edcf1bae842339363d86cff4dad431f02999efd5", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/edcf1bae842339363d86cff4dad431f02999efd5", "message": "Added test case for inheritance case - (Task #74)\n\n- Added test case to test that the applicability check is correct when\nusing the inheritance feature\n- Renamed test cases to distinguish between the cases: adding child seis\nor adding super seis.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-15T16:37:23Z", "type": "commit"}, {"oid": "6b81486970ad6eef37a7080209c1f636daec3509", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/6b81486970ad6eef37a7080209c1f636daec3509", "message": "moved implementation for typing to project - (Task #74)\n\n- Inheritance is in general an extension independant functionality,\ntherefore it has been moved to project.\n- will implement PS specific inheritance drop to also create new\nelements.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-16T13:05:28Z", "type": "commit"}, {"oid": "790d9c9d3cc5ac31d2cf1516ac96443b0852b432", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/790d9c9d3cc5ac31d2cf1516ac96443b0852b432", "message": "Merge branch 'feature/task_74-Override_DND_functiona' of https://github.com/virtualsatellite/VirtualSatellite4-Core.git into feature/task_74-Override_DND_functiona", "committedDate": "2020-01-16T13:05:45Z", "type": "commit"}, {"oid": "ea9b77880e7c08e4d2fd21924b37526a41c4d00a", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ea9b77880e7c08e4d2fd21924b37526a41c4d00a", "message": "Implemented all functionality for PS drag and drop - (Task #74)\n\n- Added functionality to create new PS element when pressing ALT with\nDND operation.\n- Also adjusting discipline and names when creating drop.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-16T15:42:19Z", "type": "commit"}, {"oid": "d63c6efbb58233dbc0be973da37f2d65dd996f9b", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/d63c6efbb58233dbc0be973da37f2d65dd996f9b", "message": "Cleaned up code - (Task #74)\n\n- Removed all warnings\n- Prepared test cases\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-16T16:31:03Z", "type": "commit"}, {"oid": "84498799ecd2f0c66eec78a0f947a806e4634bce", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/84498799ecd2f0c66eec78a0f947a806e4634bce", "message": "Write a Heading here - (Task #74)\n\n- Added further hamcrest dependency to test plugin so that the\nhamcrest.collections matchers are available.\n- Implemented test cases for VirSatInheritance Drop Adapter\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-17T08:19:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxMDY2NQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r367810665", "bodyText": "Is this really just an info and not an error?", "author": "SaMuellerDLR", "createdAt": "2020-01-17T08:08:21Z", "path": "de.dlr.sc.virsat.model.extension.ps/src/de/dlr/sc/virsat/model/extension/ps/dnd/ProductStructureDragAndDropInheritanceCommandHelper.java", "diffHunk": "@@ -0,0 +1,165 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.extension.ps.dnd;\r\n+\r\n+import java.lang.reflect.Constructor;\r\n+import java.lang.reflect.InvocationTargetException;\r\n+import java.util.Collection;\r\n+import java.util.Collections;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+\r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.common.command.CompoundCommand;\r\n+import org.eclipse.emf.common.command.UnexecutableCommand;\r\n+import de.dlr.sc.virsat.model.concept.types.factory.BeanStructuralElementInstanceFactory;\r\n+import de.dlr.sc.virsat.model.concept.types.structural.IBeanStructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.Repository;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.roles.Discipline;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.util.DVLMCopiedNameHelper;\r\n+import de.dlr.sc.virsat.model.extension.ps.Activator;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.AssemblyTree;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ConfigurationTree;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementConfiguration;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementOccurence;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementRealization;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ProductStorageDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.dnd.VirSatDragAndDropInheritanceCommandHelper;\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.dnd.VirSatDragAndDropInheritanceCommandHelper.DndOperation;\r\n+import de.dlr.sc.virsat.project.resources.VirSatResourceSet;\r\n+import de.dlr.sc.virsat.project.structure.command.CreateAddSeiWithFileStructureCommand;\r\n+\r\n+/**\r\n+ * This is a helper class to create the correct command for replacing an inheritance\r\n+ * of a SEI with another SEI.\r\n+ */\r\n+public class ProductStructureDragAndDropInheritanceCommandHelper {\r\n+\r\n+\tprotected Map<Class<? extends IBeanStructuralElementInstance>, Class<? extends IBeanStructuralElementInstance>> mapDropBeanToCreateBean;\r\n+\t\r\n+\t/**\r\n+\t * Constructor\r\n+\t */\r\n+\tpublic ProductStructureDragAndDropInheritanceCommandHelper() {\r\n+\t\t\r\n+\t\t// Populate map with information about which Bean to create for which drop target\r\n+\t\tmapDropBeanToCreateBean = new HashMap<>();\r\n+\t\t\r\n+\t\tmapDropBeanToCreateBean.put(ConfigurationTree.class, ElementConfiguration.class);\r\n+\t\tmapDropBeanToCreateBean.put(ElementConfiguration.class, ElementConfiguration.class);\r\n+\r\n+\t\tmapDropBeanToCreateBean.put(AssemblyTree.class, ElementOccurence.class);\r\n+\t\tmapDropBeanToCreateBean.put(ElementOccurence.class, ElementOccurence.class);\r\n+\r\n+\t\tmapDropBeanToCreateBean.put(ProductStorageDomain.class, ElementRealization.class);\r\n+\t\tmapDropBeanToCreateBean.put(ElementRealization.class, ElementRealization.class);\r\n+\t}\r\n+\t\r\n+\t/**\r\n+\t * Call this method to create a command to add or replace the SEI in the list of superSEIs\r\n+\t * @param ed The editing domain for which the command should be created\r\n+\t * @param dragObject the object which is dragged and shall be used for replacing\r\n+\t * @param dropOperation the kind of operation\r\n+\t * @param dropSei the SEI where the superSEIs should be changed\r\n+\t * @return The command to add or replace a superSEI\r\n+\t */\r\n+\tpublic Command createDropCommand(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, StructuralElementInstance dropSei) {\r\n+\t\tIBeanStructuralElementInstance createSeiBean = createBeanStructuralElementInstanceForDrop(ed, dragObjects, dropSei);\r\n+\t\t\r\n+\t\tif (createSeiBean != null) {\r\n+\t\t\tStructuralElementInstance createSei = createSeiBean.getStructuralElementInstance();\r\n+\t\t\tCommand addSeiCommand = CreateAddSeiWithFileStructureCommand.create(\r\n+\t\t\t\t\ted,\r\n+\t\t\t\t\tdropSei,\r\n+\t\t\t\t\tcreateSei\r\n+\t\t\t);\r\n+\t\t\tCommand setInheritanceCommand = VirSatDragAndDropInheritanceCommandHelper.createDropCommand(\r\n+\t\t\t\t\ted,\r\n+\t\t\t\t\tdragObjects,\r\n+\t\t\t\t\tDndOperation.ADD_INHERITANCE,\r\n+\t\t\t\t\tcreateSei\r\n+\t\t\t);\r\n+\t\t\t\r\n+\t\t\tCompoundCommand commandCreateSeiAndSetInheritance = new CompoundCommand();\r\n+\t\t\tcommandCreateSeiAndSetInheritance.append(addSeiCommand);\r\n+\t\t\tcommandCreateSeiAndSetInheritance.append(setInheritanceCommand);\r\n+\r\n+\t\t\treturn commandCreateSeiAndSetInheritance;\r\n+\t\t}\r\n+\t\t\r\n+\t\treturn UnexecutableCommand.INSTANCE;\r\n+\t}\t\r\n+\t\r\n+\t/**\r\n+\t * Call this method to create a BeanSei for a given drop Target SEI\r\n+\t * @param ed The editing domain in which the object will be dropped\r\n+\t * @param dragObjects The objects preferably SEIs which are dragged\r\n+\t * @param dropSei the SEI to which the objects shall get dropped\r\n+\t * @return A BeanSEI with corresponding to the drop target with correct name and discipline\r\n+\t */\r\n+\tpublic IBeanStructuralElementInstance createBeanStructuralElementInstanceForDrop(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, StructuralElementInstance dropSei) {\r\n+\t\t// When creating a new object and setting the inheritance link at the same time\r\n+\t\t// then there should be only one element in the list anyway, so get the first one.\r\n+\t\tObject dragObject = dragObjects.iterator().next();\r\n+\t\t\r\n+\t\ttry {\r\n+\t\t\tif (dragObject instanceof StructuralElementInstance) {\r\n+\t\t\t\t// Identify the concept\r\n+\t\t\t\tVirSatResourceSet virSatResourceSet = ed.getResourceSet();\r\n+\t\t\t\tRepository currentRepository = virSatResourceSet.getRepository();\r\n+\t\t\t\tConcept concept = new ActiveConceptHelper(currentRepository).getConcept(Activator.getPluginId());\r\n+\t\t\t\t\r\n+\t\t\t\t// Create a bean for the given dropSEI\r\n+\t\t\t\tBeanStructuralElementInstanceFactory bsf = new BeanStructuralElementInstanceFactory();\r\n+\t\t\t\tIBeanStructuralElementInstance dropBeanSei = bsf.getInstanceFor(dropSei);\r\n+\t\t\t\t\r\n+\t\t\t\t// Use the created bean to decide which type of bean should be created for adding to the dropSEI\r\n+\t\t\t\tClass<? extends IBeanStructuralElementInstance> dropBeanSeiClass = dropBeanSei.getClass();\r\n+\t\t\t\tClass<? extends IBeanStructuralElementInstance> createBeanSeiClass = mapDropBeanToCreateBean.get(dropBeanSeiClass);\r\n+\t\t\t\t\r\n+\t\t\t\t// If there is a suggestion to it and if it was successful to identify the concept\r\n+\t\t\t\t// Then it it is possible to create a new BeanSei and to set it up correctly\r\n+\t\t\t\tif (createBeanSeiClass != null && concept != null) {\r\n+\t\t\t\t\tConstructor<? extends IBeanStructuralElementInstance> createBeanSeiConstructor = createBeanSeiClass.getDeclaredConstructor(Concept.class);\r\n+\t\t\t\t\tIBeanStructuralElementInstance createBeanSei = (IBeanStructuralElementInstance) createBeanSeiConstructor.newInstance(concept);\r\n+\t\t\t\t\tStructuralElementInstance createSei = createBeanSei.getStructuralElementInstance();\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// Now copy the name and the disciplines accordingly\r\n+\t\t\t\t\tStructuralElementInstance dragSei = (StructuralElementInstance) dragObject;\r\n+\t\t\t\t\tDiscipline discipline = dropSei.getAssignedDiscipline(); \r\n+\t\t\t\t\tcreateSei.setAssignedDiscipline(discipline);\r\n+\t\t\t\t\tString name = dragSei.getName(); \r\n+\t\t\t\t\tcreateSei.setName(name);\r\n+\t\t\t\t\t\r\n+\t\t\t\t\t// Now fix naming clashes\r\n+\t\t\t\t\tDVLMCopiedNameHelper dcnh = new DVLMCopiedNameHelper();\r\n+\t\t\t\t\tdcnh.updateCopiedNames(dropSei.getChildren(), Collections.singleton(createSei));\r\n+\t\r\n+\t\t\t\t\treturn createBeanSei;\r\n+\t\t\t\t}\r\n+\t\t\t}\r\n+\t\t} catch (CoreException | NoSuchMethodException | SecurityException | InstantiationException | IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {\r\n+\t\t\tActivator.getDefault().getLog().log(new Status(\r\n+\t\t\t\t\tStatus.INFO,\r", "originalCommit": "d63c6efbb58233dbc0be973da37f2d65dd996f9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU0ODM2Mw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368548363", "bodyText": "Well a WARNING could be ok, ERROR I think should indicate a problem that may create havoc when further executing the application. WARNING is more like something went unexpectedly wrong but is regarded as no critical problem.", "author": "PhilMFischer", "createdAt": "2020-01-20T13:31:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxMDY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxMzA1MA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r367813050", "bodyText": "The first with can be removed", "author": "SaMuellerDLR", "createdAt": "2020-01-17T08:15:57Z", "path": "de.dlr.sc.virsat.model.extension.ps/src/de/dlr/sc/virsat/model/extension/ps/dnd/ProductStructureDragAndDropInheritanceCommandHelper.java", "diffHunk": "@@ -0,0 +1,165 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.extension.ps.dnd;\r\n+\r\n+import java.lang.reflect.Constructor;\r\n+import java.lang.reflect.InvocationTargetException;\r\n+import java.util.Collection;\r\n+import java.util.Collections;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+\r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.common.command.CompoundCommand;\r\n+import org.eclipse.emf.common.command.UnexecutableCommand;\r\n+import de.dlr.sc.virsat.model.concept.types.factory.BeanStructuralElementInstanceFactory;\r\n+import de.dlr.sc.virsat.model.concept.types.structural.IBeanStructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.Repository;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.roles.Discipline;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.util.DVLMCopiedNameHelper;\r\n+import de.dlr.sc.virsat.model.extension.ps.Activator;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.AssemblyTree;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ConfigurationTree;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementConfiguration;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementOccurence;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementRealization;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ProductStorageDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.dnd.VirSatDragAndDropInheritanceCommandHelper;\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.dnd.VirSatDragAndDropInheritanceCommandHelper.DndOperation;\r\n+import de.dlr.sc.virsat.project.resources.VirSatResourceSet;\r\n+import de.dlr.sc.virsat.project.structure.command.CreateAddSeiWithFileStructureCommand;\r\n+\r\n+/**\r\n+ * This is a helper class to create the correct command for replacing an inheritance\r\n+ * of a SEI with another SEI.\r\n+ */\r\n+public class ProductStructureDragAndDropInheritanceCommandHelper {\r\n+\r\n+\tprotected Map<Class<? extends IBeanStructuralElementInstance>, Class<? extends IBeanStructuralElementInstance>> mapDropBeanToCreateBean;\r\n+\t\r\n+\t/**\r\n+\t * Constructor\r\n+\t */\r\n+\tpublic ProductStructureDragAndDropInheritanceCommandHelper() {\r\n+\t\t\r\n+\t\t// Populate map with information about which Bean to create for which drop target\r\n+\t\tmapDropBeanToCreateBean = new HashMap<>();\r\n+\t\t\r\n+\t\tmapDropBeanToCreateBean.put(ConfigurationTree.class, ElementConfiguration.class);\r\n+\t\tmapDropBeanToCreateBean.put(ElementConfiguration.class, ElementConfiguration.class);\r\n+\r\n+\t\tmapDropBeanToCreateBean.put(AssemblyTree.class, ElementOccurence.class);\r\n+\t\tmapDropBeanToCreateBean.put(ElementOccurence.class, ElementOccurence.class);\r\n+\r\n+\t\tmapDropBeanToCreateBean.put(ProductStorageDomain.class, ElementRealization.class);\r\n+\t\tmapDropBeanToCreateBean.put(ElementRealization.class, ElementRealization.class);\r\n+\t}\r\n+\t\r\n+\t/**\r\n+\t * Call this method to create a command to add or replace the SEI in the list of superSEIs\r\n+\t * @param ed The editing domain for which the command should be created\r\n+\t * @param dragObject the object which is dragged and shall be used for replacing\r\n+\t * @param dropOperation the kind of operation\r\n+\t * @param dropSei the SEI where the superSEIs should be changed\r\n+\t * @return The command to add or replace a superSEI\r\n+\t */\r\n+\tpublic Command createDropCommand(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, StructuralElementInstance dropSei) {\r\n+\t\tIBeanStructuralElementInstance createSeiBean = createBeanStructuralElementInstanceForDrop(ed, dragObjects, dropSei);\r\n+\t\t\r\n+\t\tif (createSeiBean != null) {\r\n+\t\t\tStructuralElementInstance createSei = createSeiBean.getStructuralElementInstance();\r\n+\t\t\tCommand addSeiCommand = CreateAddSeiWithFileStructureCommand.create(\r\n+\t\t\t\t\ted,\r\n+\t\t\t\t\tdropSei,\r\n+\t\t\t\t\tcreateSei\r\n+\t\t\t);\r\n+\t\t\tCommand setInheritanceCommand = VirSatDragAndDropInheritanceCommandHelper.createDropCommand(\r\n+\t\t\t\t\ted,\r\n+\t\t\t\t\tdragObjects,\r\n+\t\t\t\t\tDndOperation.ADD_INHERITANCE,\r\n+\t\t\t\t\tcreateSei\r\n+\t\t\t);\r\n+\t\t\t\r\n+\t\t\tCompoundCommand commandCreateSeiAndSetInheritance = new CompoundCommand();\r\n+\t\t\tcommandCreateSeiAndSetInheritance.append(addSeiCommand);\r\n+\t\t\tcommandCreateSeiAndSetInheritance.append(setInheritanceCommand);\r\n+\r\n+\t\t\treturn commandCreateSeiAndSetInheritance;\r\n+\t\t}\r\n+\t\t\r\n+\t\treturn UnexecutableCommand.INSTANCE;\r\n+\t}\t\r\n+\t\r\n+\t/**\r\n+\t * Call this method to create a BeanSei for a given drop Target SEI\r\n+\t * @param ed The editing domain in which the object will be dropped\r\n+\t * @param dragObjects The objects preferably SEIs which are dragged\r\n+\t * @param dropSei the SEI to which the objects shall get dropped\r\n+\t * @return A BeanSEI with corresponding to the drop target with correct name and discipline\r", "originalCommit": "d63c6efbb58233dbc0be973da37f2d65dd996f9b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxNTIwOQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r367815209", "bodyText": "I think we should also pass the stack trace to the logger.", "author": "SaMuellerDLR", "createdAt": "2020-01-17T08:22:40Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMObjectDropAdapterAssistant.java", "diffHunk": "@@ -9,98 +9,176 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n \r\n-import java.util.Collection;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+import java.util.function.Function;\r\n \r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.IConfigurationElement;\r\n import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Platform;\r\n import org.eclipse.core.runtime.Status;\r\n-import org.eclipse.emf.common.command.Command;\r\n-import org.eclipse.emf.ecore.EObject;\r\n-import org.eclipse.jface.util.LocalSelectionTransfer;\r\n-import org.eclipse.jface.viewers.ISelection;\r\n import org.eclipse.jface.viewers.IStructuredSelection;\r\n-import org.eclipse.jface.viewers.StructuredSelection;\r\n-import org.eclipse.swt.dnd.DND;\r\n import org.eclipse.swt.dnd.DropTargetEvent;\r\n import org.eclipse.swt.dnd.TransferData;\r\n-import org.eclipse.ui.PlatformUI;\r\n import org.eclipse.ui.navigator.CommonDropAdapter;\r\n import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n-import org.eclipse.ui.navigator.CommonViewer;\r\n-\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n-import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n \r\n /**\r\n- * VirSat Drop Assitant to copy and paste SEIs and CAs in the Navigator\r\n- * @author fisc_ph\r\n- *\r\n+ * Drop Assistant for VirSat Navigator that delegates calls to concept specific drop assistants\r\n  */\r\n public class DVLMObjectDropAdapterAssistant extends CommonDropAdapterAssistant {\r\n \r\n+\tprotected Map<String, CommonDropAdapterAssistant> mapConceptIdToDelegateDropAdapter;\r\n+\t\r\n+\tprotected CommonDropAdapterAssistant defaultCopyPasteDropAdapter;\r\n+\tprotected CommonDropAdapterAssistant defaultInheritanceDropAdapter;\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_NAVIGATOR = \"de.dlr.sc.virsat.project.ui.navigator\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION = \"DVLMConceptDropAssistant\";\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID = \"conceptId\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION = \"class\";\r\n+\t\r\n+\t@Override\r\n+\tprotected void doInit() {\r\n+\t\tinitDropAssistantMap();\r\n+\t\t\r\n+\t\tdefaultCopyPasteDropAdapter = new DVLMDefaultCopyAndPasteDropAdapterAssistant();\r\n+\t\tdefaultInheritanceDropAdapter = new DVLMDefaultInheritanceDropAdapterAssistant();\r\n+\t\tdefaultCopyPasteDropAdapter.init(getContentService());\r\n+\t}\r\n+\r\n \t/**\r\n-\t * Method to create a Drop Command based on the Copy Paste functionality\r\n-\t * @param target The object to witch to drop to\r\n-\t * @param operation the type of DND operation\r\n-\t * @return the ccommand if it is creatable or null in case it could not be created\r\n+\t * Reads out the extension point to initialize the map of\r\n+\t * concept ids vs. drop adapters\r\n \t */\r\n-\tprivate Command createDropCommand(Object target, int operation) {\r\n-\t\tCommand dropCommand = null;\r\n-\t\t\r\n-\t\tif (target instanceof EObject) {\r\n-\t\t\tEObject eObject = (EObject) target;\r\n-\t\t\tVirSatTransactionalEditingDomain virSatEd = VirSatEditingDomainRegistry.INSTANCE.getEd(eObject);\r\n-\t\t\tISelection selection = LocalSelectionTransfer.getTransfer().getSelection();\r\n-\t\t\t\r\n-\t\t\tif (selection instanceof IStructuredSelection) {\r\n-\t\t\t\tIStructuredSelection structerdSelection = (IStructuredSelection) selection;\r\n-\t\t\t\t\r\n-\t\t\t\t@SuppressWarnings(\"unchecked\")\r\n-\t\t\t\tCollection<Object> dndObjects = structerdSelection.toList();\r\n-\t\t\t\t\t\r\n-\t\t\t\tif (operation == DND.DROP_COPY) {\r\n-\t\t\t\t\tdropCommand = VirSatPasteFromClipboardCommand.create(virSatEd, eObject, dndObjects, ClipboardState.COPY);\r\n-\t\t\t\t} else if (operation == DND.DROP_MOVE) {\r\n-\t\t\t\t\tdropCommand = VirSatPasteFromClipboardCommand.create(virSatEd, eObject, dndObjects, ClipboardState.CUT);\r\n+\tprotected void initDropAssistantMap() {\r\n+\t\t// Re initialize the map of drop assistants\r\n+\t\tmapConceptIdToDelegateDropAdapter = new HashMap<>();\r\n+\t\r\n+\t\t// Now start looping over all Navigator extensions to find the possible registered drop assistants\r\n+\t\tIConfigurationElement[] navigatorExtensions = Platform.getExtensionRegistry().getConfigurationElementsFor(EXTENSION_POINT_NAVIGATOR);\r\n+\t\tfor (IConfigurationElement navigatorExtension : navigatorExtensions) {\r\n+\t\t\tif (EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION.equals(navigatorExtension.getName())) {\r\n+\t\t\t\tString conceptId = navigatorExtension.getAttribute(EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID);\r\n+\t\t\t\tCommonDropAdapterAssistant dropAdapter;\r\n+\t\t\t\ttry {\r\n+\t\t\t\t\tdropAdapter = (CommonDropAdapterAssistant) navigatorExtension.createExecutableExtension(EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION);\r\n+\t\t\t\t\tdropAdapter.init(getContentService());\r\n+\t\t\t\t\tif (!mapConceptIdToDelegateDropAdapter.containsKey(conceptId)) {\r\n+\t\t\t\t\t\tmapConceptIdToDelegateDropAdapter.put(conceptId, dropAdapter);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Cannot register two drop adapter for the same concept: \" + conceptId));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} catch (CoreException e) {\r\n+\t\t\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Failed to create executable extension for drop adapter in concept: \" + navigatorExtension.getContributor() + \"->\" + conceptId + \" because: \" + e.getMessage()));\r", "originalCommit": "d63c6efbb58233dbc0be973da37f2d65dd996f9b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODU0OTcyOQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368549729", "bodyText": "Yes added it to the places where INFOs are now logged as WARNINGS", "author": "PhilMFischer", "createdAt": "2020-01-20T13:34:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzgxNTIwOQ=="}], "type": "inlineReview"}, {"oid": "e78a6b6b417a29b69017c47830e8b282fed64067", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/e78a6b6b417a29b69017c47830e8b282fed64067", "message": "Simplified concept test case setup - (Task #74)\n\n- Added method to easily execute tests as a command in the editing\ndomain.\n\n- Removed some further warnings.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-17T09:16:42Z", "type": "commit"}, {"oid": "8a2f95f0eca5cb1a0dfa7b18dca347bd3b587ccb", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/8a2f95f0eca5cb1a0dfa7b18dca347bd3b587ccb", "message": "Refactored execute function in project test case  - (Task #74)\n\n- Added a second method to execute code as recording command in the ED.\nBut this time the method does not hand back results.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-17T10:46:22Z", "type": "commit"}, {"oid": "f2b764506ced62e7c4d01d055112ba2cd21b6aff", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/f2b764506ced62e7c4d01d055112ba2cd21b6aff", "message": "Implemented Test cases for PS inheritance commands - (Task #74)\n\n- Refatcored command helper to mainly use PS bean elements where\npossible\n- Added test cases\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-17T13:00:29Z", "type": "commit"}, {"oid": "b85c004a664389cca7d095d075cd35b4c2bfef4a", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/b85c004a664389cca7d095d075cd35b4c2bfef4a", "message": "Refactored all project tests - (Task #74)\n\n- Refactored due to changes in AProjectTest case\n- Unified setup and tear down of all project unit tests.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-17T14:40:52Z", "type": "commit"}, {"oid": "f76d8dcea7b8bbde7cad675c8c10d78706d51ebf", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/f76d8dcea7b8bbde7cad675c8c10d78706d51ebf", "message": "Merge remote-tracking branch 'origin/feature/task_430-Use_https_based_addre' into feature/task_74-Override_DND_functiona", "committedDate": "2020-01-17T15:42:29Z", "type": "commit"}, {"oid": "b960b3f71adde2262d0ef6e711ff6903d523c835", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/b960b3f71adde2262d0ef6e711ff6903d523c835", "message": "Improved SWT Bot tests with drag and drop - (Task #74)\n\n- Added DND testcase for moving a SEI\n- Added DND testcase for moving a CA\n- Added DND testcase for setting inheritance\n- Added hamcrest library to dependencies for better hamcrest assert\nstatements on collections etc.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-20T13:10:29Z", "type": "commit"}, {"oid": "7a792358b95a4d63363b602381f27fd8f69000ba", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/7a792358b95a4d63363b602381f27fd8f69000ba", "message": "Minor fixes due to review - (Task #74)\n\n- changed some log statements from info to warning level.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-20T13:38:42Z", "type": "commit"}, {"oid": "c97c674e1ecd320e0951fd7102a3cc565060a4af", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/c97c674e1ecd320e0951fd7102a3cc565060a4af", "message": "Fixing test case on jenkins - (Task #74)\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-20T14:02:35Z", "type": "commit"}, {"oid": "c0f4ad03a372bd7f1c2d833d57b5e093c200c901", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/c0f4ad03a372bd7f1c2d833d57b5e093c200c901", "message": "Integrated old test case - (Task #74)\n\n- Old test case for project builder was not added to all tests.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-20T14:27:37Z", "type": "commit"}, {"oid": "ffd29fd8cfb5ccb7000a0aaba18e4d7a81bbb36b", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ffd29fd8cfb5ccb7000a0aaba18e4d7a81bbb36b", "message": "Fixing SWT Bot dependencies - (Task #74)\n\n- Added all concept plugins.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-20T14:44:10Z", "type": "commit"}, {"oid": "ad5c507102d6cf01ab226486081447cf26c62c26", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/ad5c507102d6cf01ab226486081447cf26c62c26", "message": "Merge remote-tracking branch 'origin/development' into feature/task_74-Override_DND_functiona", "committedDate": "2020-01-20T16:29:35Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0ODk3Mw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368848973", "bodyText": "I think we can make these private.", "author": "SaMuellerDLR", "createdAt": "2020-01-21T07:44:11Z", "path": "de.dlr.sc.virsat.model.extension.ps.test/src/de/dlr/sc/virsat/model/extension/ps/util/test/ProductStructureHelperTest.java", "diffHunk": "@@ -37,14 +33,12 @@\n \r\n /**\r\n  * Test Case for Generating Tree\r\n- * @author bell_er\r\n  *\r\n  */\r\n public class ProductStructureHelperTest extends AConceptProjectTestCase {\r\n-\tprivate static final String CONCEPT_ID_EGSCC = de.dlr.sc.virsat.model.extension.ps.Activator.getPluginId();\r\n-\tprivate static final String EXTENSION_ID = \"de.dlr.sc.virsat.model.Concept\";\r\n-\r\n-\tprivate static final int THREE = 3;\r\n+\tprivate static final String CONCEPT_ID_PS = Activator.getPluginId();\r\n+\t\r\n+\tprivate static final int AMOUNT_CT_SUBSYTEMS = 3;\r\n \r\n \tElementDefinition ed;\r", "originalCommit": "ad5c507102d6cf01ab226486081447cf26c62c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1NjgzNA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368856834", "bodyText": "arent they automatically private if not explicitly stated?", "author": "PhilMFischer", "createdAt": "2020-01-21T08:09:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0ODk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODkzNDAzNQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368934035", "bodyText": "The visibility level if not stated is considered \"package protected\". E.g. classes in the same package can access the variables. https://docs.oracle.com/javase/tutorial/java/javaOO/accesscontrol.html\nThis has the minor consequence that eclipse doesnt create warnings for unused variables. So if, for example due to a change in the test case, the variable ed is no longer used, then eclipse would not create a warning. And the dead variable would just lie around.", "author": "SaMuellerDLR", "createdAt": "2020-01-21T10:56:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0ODk3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2ODc3OQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370168779", "bodyText": "ok, than i add it to the change.", "author": "PhilMFischer", "createdAt": "2020-01-23T15:00:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0ODk3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTYyMQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368849621", "bodyText": "Maybe a short comment why its overwritten.", "author": "SaMuellerDLR", "createdAt": "2020-01-21T07:46:31Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/structure/VirSatProjectCommonsTest.java", "diffHunk": "@@ -65,6 +65,10 @@\n \t@Rule\r\n \tpublic final ExpectedException expectedException = ExpectedException.none();\r\n \t\r\n+\t@Override\r\n+\tprotected void addProjectFileStructure() {\r\n+\t}\r", "originalCommit": "ad5c507102d6cf01ab226486081447cf26c62c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1NjUwNw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368856507", "bodyText": "Done", "author": "PhilMFischer", "createdAt": "2020-01-21T08:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg0OTYyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1MDA0OA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368850048", "bodyText": "I dont think we need an empty constructor.", "author": "SaMuellerDLR", "createdAt": "2020-01-21T07:48:01Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/ADVLMDropAdapaterAssistant.java", "diffHunk": "@@ -0,0 +1,86 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.swt.dnd.TransferData;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+\r\n+/**\r\n+ * Generic functionality to implement a DVLMDropAdapterAssitant\r\n+ *\r\n+ */\r\n+public abstract class ADVLMDropAdapaterAssistant extends CommonDropAdapterAssistant {\r\n+\r\n+\tpublic ADVLMDropAdapaterAssistant() {\r\n+\t\tsuper();\r", "originalCommit": "ad5c507102d6cf01ab226486081447cf26c62c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1NjEyMA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368856120", "bodyText": "Done", "author": "PhilMFischer", "createdAt": "2020-01-21T08:06:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1MDA0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1MDM2NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368850364", "bodyText": "Do we need this commented out code?", "author": "SaMuellerDLR", "createdAt": "2020-01-21T07:49:10Z", "path": "de.dlr.sc.virsat.swtbot.test/src/de/dlr/sc/virsat/swtbot/test/InheritanceTest.java", "diffHunk": "@@ -139,6 +140,40 @@ public void singleLevelInheritancePropagationUITest() {\n \t\twaitForAllBuildersAndUiThread();\r\n \t\tassertEquals(\"newDocName\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_DOCUMENTNAME));\r\n \t\tassertEquals(\"overriden note\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_NOTE));\r\n+\t}\r\n+\t\r\n+\t@Test\r\n+\tpublic void inheritanceTypingDragAndDrop() {\r\n+\t\trename(elementConfiguration, \"ec_1\");\r\n+\t\tSWTBotTreeItem elementConfiguration2 = addElement(ElementConfiguration.class, conceptPs, configurationTree);\r\n+\t\trename(elementConfiguration2, \"ec_2\");\r\n+\t\t\r\n+\t\tSWTBotTreeItem documentEc1 = addElement(Document.class, conceptPs, elementConfiguration);\r\n+\t\tSWTBotTreeItem documentEc2 = addElement(Document.class, conceptPs, elementConfiguration2);\r\n+\r\n+\t\topenEditor(documentEc1);\r\n+\t\tsetText(Document.PROPERTY_DOCUMENTNAME, \"docFromEc1\");\r\n+\r\n+\t\topenEditor(documentEc2);\r\n+\t\tsetText(Document.PROPERTY_DOCUMENTNAME, \"docFromEc2\");\r\n+\t\t\r\n+\t\t// There are no documents yet with the ElementOccurrence\r\n+\t\tassertThat(\"There is only the documents folder\", elementOccurence.getItems(), arrayWithSize(1));\r\n+\t\t\r\n+\t\t// Now drag the first inheritance\r\n+\t\telementConfiguration.dragAndDrop(elementOccurence);\r\n+\t\twaitForAllBuildersAndUiThread();\r\n+\t\t\r\n+\t\topenEditor(elementOccurence);\r\n+\t\t//waitForAllBuildersAndUiThread();\r\n+\t\tassertEquals(\"Received override from EC1\", \"docFromEc1\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_DOCUMENTNAME));\r\n+\t\t\r\n+\t\t// now drag the other and verify\r\n+\t\telementConfiguration2.dragAndDrop(elementOccurence);\r\n+\t\twaitForAllBuildersAndUiThread();\r\n \t\t\r\n+\t\topenEditor(elementOccurence);\r\n+\t\t//waitForAllBuildersAndUiThread();\r", "originalCommit": "ad5c507102d6cf01ab226486081447cf26c62c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1NjE3MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368856171", "bodyText": "Removed", "author": "PhilMFischer", "createdAt": "2020-01-21T08:06:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1MDM2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1Mjg2NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368852864", "bodyText": "I guess this Store class is introduced to avoid the effectivly final requirement since you want to save the result from the doExecute call?\nYou may disagree, but I would prefer using final List<T> objects = new ArrayList<>(); and then objects.add(supplier.get()) simple since it avoids introducing some new magic class.", "author": "SaMuellerDLR", "createdAt": "2020-01-21T07:56:54Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/test/AProjectTestCase.java", "diffHunk": "@@ -160,4 +164,47 @@ protected void addEditingDomainAndRepository() {\n \tprotected String getProjectName() {\r\n \t\treturn TEST_PROJECT_NAME + \"_\" + this.getClass().getSimpleName();\r\n \t}\r\n+\t\r\n+\t\r\n+\t/**\r\n+\t * Simple method to execute code as part of a recording command\r\n+\t * @param runnable the lambda to be executed with no parameters and no return value. \r\n+\t */\r\n+\tprotected <T> void executeAsCommand(Runnable runnable) {\r\n+\t\t// Now wrap the lambda into a recording command and execute it\r\n+\t\teditingDomain.getVirSatCommandStack().execute(new RecordingCommand(editingDomain) {\r\n+\t\t\t@Override\r\n+\t\t\tprotected void doExecute() {\r\n+\t\t\t\trunnable.run();\r\n+\t\t\t}\r\n+\t\t});\r\n+\t}\r\n+\t\t\r\n+\t/**\r\n+\t * Simple method to execute code as part of a recording command\r\n+\t * @param supplier the lambda to be executed with no parameters. \r\n+\t * @return the result of the executed lambda\r\n+\t */\r\n+\tprotected <T> T executeAsCommand(Supplier<T> supplier) {\r\n+\t\t\r\n+\t\t// Simple class to store object of the given generic type T\r\n+\t\tclass Store {\r", "originalCommit": "ad5c507102d6cf01ab226486081447cf26c62c26", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg2ODM0OQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r368868349", "bodyText": "Decided to go with a vector", "author": "PhilMFischer", "createdAt": "2020-01-21T08:40:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2ODg1Mjg2NA=="}], "type": "inlineReview"}, {"oid": "0f8edcea338ca5f6f23ad3de87f4936a00a891f1", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/0f8edcea338ca5f6f23ad3de87f4936a00a891f1", "message": "Fixes due to review comments - (Task #74)\n\n- Major change, using vector to store object from the execute method\nlambda expression.\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-21T08:40:30Z", "type": "commit"}, {"oid": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/1e298c6683e3bc1933d65998b3c4c03378692eaf", "message": "Added some comments as requested by Review - (Task #74)\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-23T09:32:27Z", "type": "commit"}, {"oid": "bdf3a38d8ac8f2f597c877e1a6cae0fa63054604", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/bdf3a38d8ac8f2f597c877e1a6cae0fa63054604", "message": "Fixes due to review - (Task #74)\n\n- made variables private and removed them due to \"unused\"\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-23T15:02:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxOTAzNg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370019036", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            W */\n          \n          \n            \n             */", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T09:48:26Z", "path": "de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/editingDomain/commands/VirSatClipboardCommandHelperTest.java", "diffHunk": "@@ -31,19 +29,9 @@\n \r\n /**\r\n  * Test Cases for the ClipBoard Command Helper\r\n- * @author fisc_ph\r\n- *\r\n- */\r\n+W */\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4Nzg1Mg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370487852", "bodyText": "@andriikovalov-dlr Cool thing, how does this work with the suggestion \ud83e\udd13", "author": "PhilMFischer", "createdAt": "2020-01-24T06:21:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDAxOTAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0ODgzOA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370048838", "bodyText": "Is this comment still correct?", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T10:49:04Z", "path": "de.dlr.sc.virsat.model.edit/src/de/dlr/sc/virsat/model/dvlm/util/DVLMCommandParameterApplicableForCheck.java", "diffHunk": "@@ -9,22 +9,34 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.model.dvlm.util;\r\n \r\n+import org.eclipse.emf.ecore.EReference;\r\n import org.eclipse.emf.edit.command.CommandParameter;\r\n \r\n+import de.dlr.sc.virsat.model.dvlm.inheritance.InheritancePackage;\r\n+\r\n \r\n /**\r\n  * This class extends the ApplicableFor checks to be used with EMF CommandParameters\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4OTM3Ng==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370489376", "bodyText": "Got adjusted.", "author": "PhilMFischer", "createdAt": "2020-01-24T06:30:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDA0ODgzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyMTUxMg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370121512", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\ted = VirSatEditingDomainRegistry.INSTANCE.getEd((EObject) dropObject);\n          \n          \n            \n            \t\t\ted = VirSatEditingDomainRegistry.INSTANCE.getEd(validatedDropObject);", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T13:40:13Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/ADVLMDropAdapaterAssistant.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.swt.dnd.TransferData;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+\r\n+/**\r\n+ * Generic functionality to implement a DVLMDropAdapterAssitant\r\n+ *\r\n+ */\r\n+public abstract class ADVLMDropAdapaterAssistant extends CommonDropAdapterAssistant {\r\n+\r\n+\tprotected VirSatTransactionalEditingDomain ed;\r\n+\tprotected Command validatedDropCommand;\r\n+\tprotected EObject validatedDropObject;\r\n+\tprotected Collection<Object> validatedDragObjects;\r\n+\r\n+\t/**\r\n+\t * Method to create the command which will be used for the validate and handle drop\r\n+\t * @param ed The editing domain for which to create the command\r\n+\t * @param dragObjects the objects which are dragged\r\n+\t * @param operation the type of operation complying with DND\r\n+\t * @param dropObject the object to which the drag operation is supposed to be dropped\r\n+\t * @return the command for executing the drag and drop operation\r\n+\t */\r\n+\tprotected abstract Command createDropCommand(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, int operation, EObject dropObject);\r\n+\r\n+\t/**\r\n+\t * Method to determine which objects have been selected by the drag and drop operation\r\n+\t * @return a Collection containing the objects which are dragged\r\n+\t */\r\n+\tprotected abstract Collection<Object> getSelectedDragObjects();\r\n+\r\n+\t@Override\r\n+\tpublic IStatus validateDrop(Object dropObject, int operation, TransferData transferType) {\r\n+\t\tif (dropObject instanceof EObject) {\r\n+\t\t\tvalidatedDragObjects = getSelectedDragObjects();\r\n+\t\t\tvalidatedDropObject = (EObject) dropObject;\r\n+\t\t\ted = VirSatEditingDomainRegistry.INSTANCE.getEd((EObject) dropObject);\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyMzUwNg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370123506", "bodyText": "Shall we maybe rename \"validatedDragObjects\" into just \"dragObjects\"? Or where are they validated?", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T13:43:57Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/ADVLMDropAdapaterAssistant.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.swt.dnd.TransferData;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+\r\n+/**\r\n+ * Generic functionality to implement a DVLMDropAdapterAssitant\r\n+ *\r\n+ */\r\n+public abstract class ADVLMDropAdapaterAssistant extends CommonDropAdapterAssistant {\r\n+\r\n+\tprotected VirSatTransactionalEditingDomain ed;\r\n+\tprotected Command validatedDropCommand;\r\n+\tprotected EObject validatedDropObject;\r\n+\tprotected Collection<Object> validatedDragObjects;\r\n+\r\n+\t/**\r\n+\t * Method to create the command which will be used for the validate and handle drop\r\n+\t * @param ed The editing domain for which to create the command\r\n+\t * @param dragObjects the objects which are dragged\r\n+\t * @param operation the type of operation complying with DND\r\n+\t * @param dropObject the object to which the drag operation is supposed to be dropped\r\n+\t * @return the command for executing the drag and drop operation\r\n+\t */\r\n+\tprotected abstract Command createDropCommand(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, int operation, EObject dropObject);\r\n+\r\n+\t/**\r\n+\t * Method to determine which objects have been selected by the drag and drop operation\r\n+\t * @return a Collection containing the objects which are dragged\r\n+\t */\r\n+\tprotected abstract Collection<Object> getSelectedDragObjects();\r\n+\r\n+\t@Override\r\n+\tpublic IStatus validateDrop(Object dropObject, int operation, TransferData transferType) {\r\n+\t\tif (dropObject instanceof EObject) {\r\n+\t\t\tvalidatedDragObjects = getSelectedDragObjects();\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5MDQyNA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370490424", "bodyText": "Not a hundred percent sure if i ilke to name it differently, because for me it were the objects which were ok when the validateDrop method executed. Nevertheless, they are not necessarily valid. I changed them now to dropEObject and dragObjects", "author": "PhilMFischer", "createdAt": "2020-01-24T06:35:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyMzUwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNDEwMA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370124100", "bodyText": "Eclipse formatter wouldn't have liked it \ud83d\ude04", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T13:45:07Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/ADVLMDropAdapaterAssistant.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.swt.dnd.TransferData;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+\r\n+/**\r\n+ * Generic functionality to implement a DVLMDropAdapterAssitant\r\n+ *\r\n+ */\r\n+public abstract class ADVLMDropAdapaterAssistant extends CommonDropAdapterAssistant {\r\n+\r\n+\tprotected VirSatTransactionalEditingDomain ed;\r\n+\tprotected Command validatedDropCommand;\r\n+\tprotected EObject validatedDropObject;\r\n+\tprotected Collection<Object> validatedDragObjects;\r\n+\r\n+\t/**\r\n+\t * Method to create the command which will be used for the validate and handle drop\r\n+\t * @param ed The editing domain for which to create the command\r\n+\t * @param dragObjects the objects which are dragged\r\n+\t * @param operation the type of operation complying with DND\r\n+\t * @param dropObject the object to which the drag operation is supposed to be dropped\r\n+\t * @return the command for executing the drag and drop operation\r\n+\t */\r\n+\tprotected abstract Command createDropCommand(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, int operation, EObject dropObject);\r\n+\r\n+\t/**\r\n+\t * Method to determine which objects have been selected by the drag and drop operation\r\n+\t * @return a Collection containing the objects which are dragged\r\n+\t */\r\n+\tprotected abstract Collection<Object> getSelectedDragObjects();\r\n+\r\n+\t@Override\r\n+\tpublic IStatus validateDrop(Object dropObject, int operation, TransferData transferType) {\r\n+\t\tif (dropObject instanceof EObject) {\r\n+\t\t\tvalidatedDragObjects = getSelectedDragObjects();\r\n+\t\t\tvalidatedDropObject = (EObject) dropObject;\r\n+\t\t\ted = VirSatEditingDomainRegistry.INSTANCE.getEd((EObject) dropObject);\r\n+\t\t\tvalidatedDropCommand = createDropCommand(\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4ODc1Mw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370488753", "bodyText": "Yes, i am not happy with it either. The way it is written it is readable, autoformatting will fail big time. Is there a good way we could adjust our formatting?", "author": "PhilMFischer", "createdAt": "2020-01-24T06:26:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDEyNDEwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0NjExMg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370146112", "bodyText": "I am wondering, does eclipse guarantee to have the same class instance process validate and handle without interference of other DND operations? (in this case we can just save the command and remove this if, and other fields).\nAnyhow, is command creation so expensive that we want to cache it? Or does it have side effects? Let's maybe create the command again and simplify the whole class?", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T14:24:05Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/ADVLMDropAdapaterAssistant.java", "diffHunk": "@@ -0,0 +1,82 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.swt.dnd.TransferData;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+\r\n+/**\r\n+ * Generic functionality to implement a DVLMDropAdapterAssitant\r\n+ *\r\n+ */\r\n+public abstract class ADVLMDropAdapaterAssistant extends CommonDropAdapterAssistant {\r\n+\r\n+\tprotected VirSatTransactionalEditingDomain ed;\r\n+\tprotected Command validatedDropCommand;\r\n+\tprotected EObject validatedDropObject;\r\n+\tprotected Collection<Object> validatedDragObjects;\r\n+\r\n+\t/**\r\n+\t * Method to create the command which will be used for the validate and handle drop\r\n+\t * @param ed The editing domain for which to create the command\r\n+\t * @param dragObjects the objects which are dragged\r\n+\t * @param operation the type of operation complying with DND\r\n+\t * @param dropObject the object to which the drag operation is supposed to be dropped\r\n+\t * @return the command for executing the drag and drop operation\r\n+\t */\r\n+\tprotected abstract Command createDropCommand(VirSatTransactionalEditingDomain ed, Collection<Object> dragObjects, int operation, EObject dropObject);\r\n+\r\n+\t/**\r\n+\t * Method to determine which objects have been selected by the drag and drop operation\r\n+\t * @return a Collection containing the objects which are dragged\r\n+\t */\r\n+\tprotected abstract Collection<Object> getSelectedDragObjects();\r\n+\r\n+\t@Override\r\n+\tpublic IStatus validateDrop(Object dropObject, int operation, TransferData transferType) {\r\n+\t\tif (dropObject instanceof EObject) {\r\n+\t\t\tvalidatedDragObjects = getSelectedDragObjects();\r\n+\t\t\tvalidatedDropObject = (EObject) dropObject;\r\n+\t\t\ted = VirSatEditingDomainRegistry.INSTANCE.getEd((EObject) dropObject);\r\n+\t\t\tvalidatedDropCommand = createDropCommand(\r\n+\t\t\t\ted,\r\n+\t\t\t\tvalidatedDragObjects,\r\n+\t\t\t\toperation,\r\n+\t\t\t\tvalidatedDropObject\r\n+\t\t\t);\r\n+\t\t\t\r\n+\t\t\t\r\n+\t\t\treturn validatedDropCommand.canExecute() ? Status.OK_STATUS : Status.CANCEL_STATUS;\r\n+\t\t}\r\n+\t\treturn Status.CANCEL_STATUS;\r\n+\t}\r\n+\r\n+\t@Override\r\n+\tpublic IStatus handleDrop(CommonDropAdapter aDropAdapter, DropTargetEvent aDropTargetEvent, Object handleDropObject) {\r\n+\t\tCollection<Object> handleDragObjects = getSelectedDragObjects();\r\n+\t\tif (handleDropObject == validatedDropObject && handleDragObjects.equals(validatedDragObjects)) {\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0OTA4MA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370149080", "bodyText": "Why do we need to set the selection to drop target?", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T14:28:58Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMDefaultCopyAndPasteDropAdapterAssistant.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+import java.util.Collections;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.common.command.UnexecutableCommand;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.jface.util.LocalSelectionTransfer;\r\n+import org.eclipse.jface.viewers.ISelection;\r\n+import org.eclipse.jface.viewers.IStructuredSelection;\r\n+import org.eclipse.jface.viewers.StructuredSelection;\r\n+import org.eclipse.swt.dnd.DND;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.ui.PlatformUI;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonViewer;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n+import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+\r\n+/**\r\n+ * VirSat Drop Assistant to copy and paste SEIs and CAs in the Navigator\r\n+ *\r\n+ */\r\n+public class DVLMDefaultCopyAndPasteDropAdapterAssistant extends ADVLMDropAdapaterAssistant {\r\n+\t\r\n+\t@Override\r\n+\tpublic IStatus handleDrop(CommonDropAdapter aDropAdapter, DropTargetEvent aDropTargetEvent, Object aTarget) {\r\n+\t\tIStatus superStatus = super.handleDrop(aDropAdapter, aDropTargetEvent, aTarget);\r\n+\t\t\r\n+\t\tif (superStatus.isOK()) {\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE0OTUzMQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370149531", "bodyText": "I suggest we move the selection setting to its own method", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T14:29:43Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMDefaultCopyAndPasteDropAdapterAssistant.java", "diffHunk": "@@ -0,0 +1,81 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n+\r\n+import java.util.Collection;\r\n+import java.util.Collections;\r\n+\r\n+import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.common.command.UnexecutableCommand;\r\n+import org.eclipse.emf.ecore.EObject;\r\n+import org.eclipse.jface.util.LocalSelectionTransfer;\r\n+import org.eclipse.jface.viewers.ISelection;\r\n+import org.eclipse.jface.viewers.IStructuredSelection;\r\n+import org.eclipse.jface.viewers.StructuredSelection;\r\n+import org.eclipse.swt.dnd.DND;\r\n+import org.eclipse.swt.dnd.DropTargetEvent;\r\n+import org.eclipse.ui.PlatformUI;\r\n+import org.eclipse.ui.navigator.CommonDropAdapter;\r\n+import org.eclipse.ui.navigator.CommonViewer;\r\n+\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n+import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+\r\n+/**\r\n+ * VirSat Drop Assistant to copy and paste SEIs and CAs in the Navigator\r\n+ *\r\n+ */\r\n+public class DVLMDefaultCopyAndPasteDropAdapterAssistant extends ADVLMDropAdapaterAssistant {\r\n+\t\r\n+\t@Override\r\n+\tpublic IStatus handleDrop(CommonDropAdapter aDropAdapter, DropTargetEvent aDropTargetEvent, Object aTarget) {\r\n+\t\tIStatus superStatus = super.handleDrop(aDropAdapter, aDropTargetEvent, aTarget);\r\n+\t\t\r\n+\t\tif (superStatus.isOK()) {\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE2NDI1MA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370164250", "bodyText": "Do we need to init copy-paste adapter, but not inheritance?", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T14:53:41Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMObjectDropAdapterAssistant.java", "diffHunk": "@@ -9,98 +9,176 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n \r\n-import java.util.Collection;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+import java.util.function.Function;\r\n \r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.IConfigurationElement;\r\n import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Platform;\r\n import org.eclipse.core.runtime.Status;\r\n-import org.eclipse.emf.common.command.Command;\r\n-import org.eclipse.emf.ecore.EObject;\r\n-import org.eclipse.jface.util.LocalSelectionTransfer;\r\n-import org.eclipse.jface.viewers.ISelection;\r\n import org.eclipse.jface.viewers.IStructuredSelection;\r\n-import org.eclipse.jface.viewers.StructuredSelection;\r\n-import org.eclipse.swt.dnd.DND;\r\n import org.eclipse.swt.dnd.DropTargetEvent;\r\n import org.eclipse.swt.dnd.TransferData;\r\n-import org.eclipse.ui.PlatformUI;\r\n import org.eclipse.ui.navigator.CommonDropAdapter;\r\n import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n-import org.eclipse.ui.navigator.CommonViewer;\r\n-\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n-import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n \r\n /**\r\n- * VirSat Drop Assitant to copy and paste SEIs and CAs in the Navigator\r\n- * @author fisc_ph\r\n- *\r\n+ * Drop Assistant for VirSat Navigator that delegates calls to concept specific drop assistants\r\n  */\r\n public class DVLMObjectDropAdapterAssistant extends CommonDropAdapterAssistant {\r\n \r\n+\tprotected Map<String, CommonDropAdapterAssistant> mapConceptIdToDelegateDropAdapter;\r\n+\t\r\n+\tprotected CommonDropAdapterAssistant defaultCopyPasteDropAdapter;\r\n+\tprotected CommonDropAdapterAssistant defaultInheritanceDropAdapter;\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_NAVIGATOR = \"de.dlr.sc.virsat.project.ui.navigator\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION = \"DVLMConceptDropAssistant\";\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID = \"conceptId\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION = \"class\";\r\n+\t\r\n+\t@Override\r\n+\tprotected void doInit() {\r\n+\t\tinitDropAssistantMap();\r\n+\t\t\r\n+\t\tdefaultCopyPasteDropAdapter = new DVLMDefaultCopyAndPasteDropAdapterAssistant();\r\n+\t\tdefaultInheritanceDropAdapter = new DVLMDefaultInheritanceDropAdapterAssistant();\r\n+\t\tdefaultCopyPasteDropAdapter.init(getContentService());\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3MDIyMg==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370170222", "bodyText": "Let's move this to the top to the other fields", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T15:03:08Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMObjectDropAdapterAssistant.java", "diffHunk": "@@ -9,98 +9,176 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n \r\n-import java.util.Collection;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+import java.util.function.Function;\r\n \r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.IConfigurationElement;\r\n import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Platform;\r\n import org.eclipse.core.runtime.Status;\r\n-import org.eclipse.emf.common.command.Command;\r\n-import org.eclipse.emf.ecore.EObject;\r\n-import org.eclipse.jface.util.LocalSelectionTransfer;\r\n-import org.eclipse.jface.viewers.ISelection;\r\n import org.eclipse.jface.viewers.IStructuredSelection;\r\n-import org.eclipse.jface.viewers.StructuredSelection;\r\n-import org.eclipse.swt.dnd.DND;\r\n import org.eclipse.swt.dnd.DropTargetEvent;\r\n import org.eclipse.swt.dnd.TransferData;\r\n-import org.eclipse.ui.PlatformUI;\r\n import org.eclipse.ui.navigator.CommonDropAdapter;\r\n import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n-import org.eclipse.ui.navigator.CommonViewer;\r\n-\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n-import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n \r\n /**\r\n- * VirSat Drop Assitant to copy and paste SEIs and CAs in the Navigator\r\n- * @author fisc_ph\r\n- *\r\n+ * Drop Assistant for VirSat Navigator that delegates calls to concept specific drop assistants\r\n  */\r\n public class DVLMObjectDropAdapterAssistant extends CommonDropAdapterAssistant {\r\n \r\n+\tprotected Map<String, CommonDropAdapterAssistant> mapConceptIdToDelegateDropAdapter;\r\n+\t\r\n+\tprotected CommonDropAdapterAssistant defaultCopyPasteDropAdapter;\r\n+\tprotected CommonDropAdapterAssistant defaultInheritanceDropAdapter;\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_NAVIGATOR = \"de.dlr.sc.virsat.project.ui.navigator\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION = \"DVLMConceptDropAssistant\";\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID = \"conceptId\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION = \"class\";\r\n+\t\r\n+\t@Override\r\n+\tprotected void doInit() {\r\n+\t\tinitDropAssistantMap();\r\n+\t\t\r\n+\t\tdefaultCopyPasteDropAdapter = new DVLMDefaultCopyAndPasteDropAdapterAssistant();\r\n+\t\tdefaultInheritanceDropAdapter = new DVLMDefaultInheritanceDropAdapterAssistant();\r\n+\t\tdefaultCopyPasteDropAdapter.init(getContentService());\r\n+\t}\r\n+\r\n \t/**\r\n-\t * Method to create a Drop Command based on the Copy Paste functionality\r\n-\t * @param target The object to witch to drop to\r\n-\t * @param operation the type of DND operation\r\n-\t * @return the ccommand if it is creatable or null in case it could not be created\r\n+\t * Reads out the extension point to initialize the map of\r\n+\t * concept ids vs. drop adapters\r\n \t */\r\n-\tprivate Command createDropCommand(Object target, int operation) {\r\n-\t\tCommand dropCommand = null;\r\n-\t\t\r\n-\t\tif (target instanceof EObject) {\r\n-\t\t\tEObject eObject = (EObject) target;\r\n-\t\t\tVirSatTransactionalEditingDomain virSatEd = VirSatEditingDomainRegistry.INSTANCE.getEd(eObject);\r\n-\t\t\tISelection selection = LocalSelectionTransfer.getTransfer().getSelection();\r\n-\t\t\t\r\n-\t\t\tif (selection instanceof IStructuredSelection) {\r\n-\t\t\t\tIStructuredSelection structerdSelection = (IStructuredSelection) selection;\r\n-\t\t\t\t\r\n-\t\t\t\t@SuppressWarnings(\"unchecked\")\r\n-\t\t\t\tCollection<Object> dndObjects = structerdSelection.toList();\r\n-\t\t\t\t\t\r\n-\t\t\t\tif (operation == DND.DROP_COPY) {\r\n-\t\t\t\t\tdropCommand = VirSatPasteFromClipboardCommand.create(virSatEd, eObject, dndObjects, ClipboardState.COPY);\r\n-\t\t\t\t} else if (operation == DND.DROP_MOVE) {\r\n-\t\t\t\t\tdropCommand = VirSatPasteFromClipboardCommand.create(virSatEd, eObject, dndObjects, ClipboardState.CUT);\r\n+\tprotected void initDropAssistantMap() {\r\n+\t\t// Re initialize the map of drop assistants\r\n+\t\tmapConceptIdToDelegateDropAdapter = new HashMap<>();\r\n+\t\r\n+\t\t// Now start looping over all Navigator extensions to find the possible registered drop assistants\r\n+\t\tIConfigurationElement[] navigatorExtensions = Platform.getExtensionRegistry().getConfigurationElementsFor(EXTENSION_POINT_NAVIGATOR);\r\n+\t\tfor (IConfigurationElement navigatorExtension : navigatorExtensions) {\r\n+\t\t\tif (EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION.equals(navigatorExtension.getName())) {\r\n+\t\t\t\tString conceptId = navigatorExtension.getAttribute(EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID);\r\n+\t\t\t\tCommonDropAdapterAssistant dropAdapter;\r\n+\t\t\t\ttry {\r\n+\t\t\t\t\tdropAdapter = (CommonDropAdapterAssistant) navigatorExtension.createExecutableExtension(EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION);\r\n+\t\t\t\t\tdropAdapter.init(getContentService());\r\n+\t\t\t\t\tif (!mapConceptIdToDelegateDropAdapter.containsKey(conceptId)) {\r\n+\t\t\t\t\t\tmapConceptIdToDelegateDropAdapter.put(conceptId, dropAdapter);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Cannot register two drop adapter for the same concept: \" + conceptId));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} catch (CoreException e) {\r\n+\t\t\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Failed to create executable extension for drop adapter in concept: \" + navigatorExtension.getContributor() + \"->\" + conceptId + \" because: \" + e.getMessage()));\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n-\t\treturn dropCommand;\r\n \t}\r\n+\r\n+\t/**\r\n+\t * Call this method to get a drop adapter for a given object.\r\n+\t * The method checks if the object belongs to a concept and hands\r\n+\t * back the drop adapter which is in the map if it exists\r\n+\t * @param object the object for which to find a specialized drop adapter \r\n+\t * @return null in case there is no specific drop adapter for the given object.\r\n+\t */\r\n+\tprotected CommonDropAdapterAssistant getDelegateDropAdapter(Object object) {\r\n+\t\t// To call a concept drop assistant the object where to drop at needs\r\n+\t\t// to be a dvlm instance. Once this is clear it is possible to detect the\r\n+\t\t// type of the object and the concept corresponding to it.\r\n+\t\tConcept concept = null;\r\n+\t\tif (object instanceof StructuralElementInstance) {\r\n+\t\t\tStructuralElementInstance sei = (StructuralElementInstance) object;\r\n+\t\t\tconcept = ActiveConceptHelper.getConcept(sei.getType());\r\n+\t\t} else if (object instanceof ATypeInstance) {\r\n+\t\t\tATypeInstance ti = (ATypeInstance) object;\r\n+\t\t\tconcept = ActiveConceptHelper.getConcept(ti.getType());\r\n+\t\t}\r\n \t\r\n-\t@Override\r\n-\tpublic IStatus validateDrop(Object target, int operation, TransferData transferType) {\t\t\r\n-\t\tCommand dropCommand = createDropCommand(target, operation);\r\n-\t\tif ((dropCommand != null) && (dropCommand.canExecute())) {\r\n-\t\t\treturn Status.OK_STATUS;\r\n-\t\t} else {\r\n-\t\t\treturn Status.CANCEL_STATUS;\r\n+\t\t// In case we found a concept try to get a drop adapter for it\r\n+\t\tif (concept != null) {\r\n+\t\t\t// now ask the map for the drop assistant and hand it back\r\n+\t\t\tString conceptId = concept.getName();\r\n+\t\t\tCommonDropAdapterAssistant dropAdapterAssitant = mapConceptIdToDelegateDropAdapter.get(conceptId);\r\n+\t\t\treturn dropAdapterAssitant;\r\n+\t\t}\r\n+\t\t\r\n+\t\treturn null;\r\n+\t}\r\n+\t\r\n+\tprivate CommonDropAdapterAssistant delegateDropAdapter;\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3MTU0MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370171541", "bodyText": "Let's rename it to something like getConceptSpecificDropAdapter", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T15:05:14Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMObjectDropAdapterAssistant.java", "diffHunk": "@@ -9,98 +9,176 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n \r\n-import java.util.Collection;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+import java.util.function.Function;\r\n \r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.IConfigurationElement;\r\n import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Platform;\r\n import org.eclipse.core.runtime.Status;\r\n-import org.eclipse.emf.common.command.Command;\r\n-import org.eclipse.emf.ecore.EObject;\r\n-import org.eclipse.jface.util.LocalSelectionTransfer;\r\n-import org.eclipse.jface.viewers.ISelection;\r\n import org.eclipse.jface.viewers.IStructuredSelection;\r\n-import org.eclipse.jface.viewers.StructuredSelection;\r\n-import org.eclipse.swt.dnd.DND;\r\n import org.eclipse.swt.dnd.DropTargetEvent;\r\n import org.eclipse.swt.dnd.TransferData;\r\n-import org.eclipse.ui.PlatformUI;\r\n import org.eclipse.ui.navigator.CommonDropAdapter;\r\n import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n-import org.eclipse.ui.navigator.CommonViewer;\r\n-\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n-import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n \r\n /**\r\n- * VirSat Drop Assitant to copy and paste SEIs and CAs in the Navigator\r\n- * @author fisc_ph\r\n- *\r\n+ * Drop Assistant for VirSat Navigator that delegates calls to concept specific drop assistants\r\n  */\r\n public class DVLMObjectDropAdapterAssistant extends CommonDropAdapterAssistant {\r\n \r\n+\tprotected Map<String, CommonDropAdapterAssistant> mapConceptIdToDelegateDropAdapter;\r\n+\t\r\n+\tprotected CommonDropAdapterAssistant defaultCopyPasteDropAdapter;\r\n+\tprotected CommonDropAdapterAssistant defaultInheritanceDropAdapter;\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_NAVIGATOR = \"de.dlr.sc.virsat.project.ui.navigator\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION = \"DVLMConceptDropAssistant\";\r\n+\t\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID = \"conceptId\";\r\n+\tpublic static final String EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION = \"class\";\r\n+\t\r\n+\t@Override\r\n+\tprotected void doInit() {\r\n+\t\tinitDropAssistantMap();\r\n+\t\t\r\n+\t\tdefaultCopyPasteDropAdapter = new DVLMDefaultCopyAndPasteDropAdapterAssistant();\r\n+\t\tdefaultInheritanceDropAdapter = new DVLMDefaultInheritanceDropAdapterAssistant();\r\n+\t\tdefaultCopyPasteDropAdapter.init(getContentService());\r\n+\t}\r\n+\r\n \t/**\r\n-\t * Method to create a Drop Command based on the Copy Paste functionality\r\n-\t * @param target The object to witch to drop to\r\n-\t * @param operation the type of DND operation\r\n-\t * @return the ccommand if it is creatable or null in case it could not be created\r\n+\t * Reads out the extension point to initialize the map of\r\n+\t * concept ids vs. drop adapters\r\n \t */\r\n-\tprivate Command createDropCommand(Object target, int operation) {\r\n-\t\tCommand dropCommand = null;\r\n-\t\t\r\n-\t\tif (target instanceof EObject) {\r\n-\t\t\tEObject eObject = (EObject) target;\r\n-\t\t\tVirSatTransactionalEditingDomain virSatEd = VirSatEditingDomainRegistry.INSTANCE.getEd(eObject);\r\n-\t\t\tISelection selection = LocalSelectionTransfer.getTransfer().getSelection();\r\n-\t\t\t\r\n-\t\t\tif (selection instanceof IStructuredSelection) {\r\n-\t\t\t\tIStructuredSelection structerdSelection = (IStructuredSelection) selection;\r\n-\t\t\t\t\r\n-\t\t\t\t@SuppressWarnings(\"unchecked\")\r\n-\t\t\t\tCollection<Object> dndObjects = structerdSelection.toList();\r\n-\t\t\t\t\t\r\n-\t\t\t\tif (operation == DND.DROP_COPY) {\r\n-\t\t\t\t\tdropCommand = VirSatPasteFromClipboardCommand.create(virSatEd, eObject, dndObjects, ClipboardState.COPY);\r\n-\t\t\t\t} else if (operation == DND.DROP_MOVE) {\r\n-\t\t\t\t\tdropCommand = VirSatPasteFromClipboardCommand.create(virSatEd, eObject, dndObjects, ClipboardState.CUT);\r\n+\tprotected void initDropAssistantMap() {\r\n+\t\t// Re initialize the map of drop assistants\r\n+\t\tmapConceptIdToDelegateDropAdapter = new HashMap<>();\r\n+\t\r\n+\t\t// Now start looping over all Navigator extensions to find the possible registered drop assistants\r\n+\t\tIConfigurationElement[] navigatorExtensions = Platform.getExtensionRegistry().getConfigurationElementsFor(EXTENSION_POINT_NAVIGATOR);\r\n+\t\tfor (IConfigurationElement navigatorExtension : navigatorExtensions) {\r\n+\t\t\tif (EXTENSION_POINT_DROP_ASSISTANT_CONTRIBUTION.equals(navigatorExtension.getName())) {\r\n+\t\t\t\tString conceptId = navigatorExtension.getAttribute(EXTENSION_POINT_DROP_ASSISTANT_CONCEPT_ID);\r\n+\t\t\t\tCommonDropAdapterAssistant dropAdapter;\r\n+\t\t\t\ttry {\r\n+\t\t\t\t\tdropAdapter = (CommonDropAdapterAssistant) navigatorExtension.createExecutableExtension(EXTENSION_POINT_DROP_ASSISTANT_IMPLEMENTATION);\r\n+\t\t\t\t\tdropAdapter.init(getContentService());\r\n+\t\t\t\t\tif (!mapConceptIdToDelegateDropAdapter.containsKey(conceptId)) {\r\n+\t\t\t\t\t\tmapConceptIdToDelegateDropAdapter.put(conceptId, dropAdapter);\r\n+\t\t\t\t\t} else {\r\n+\t\t\t\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Cannot register two drop adapter for the same concept: \" + conceptId));\r\n+\t\t\t\t\t}\r\n+\t\t\t\t} catch (CoreException e) {\r\n+\t\t\t\t\tActivator.getDefault().getLog().log(new Status(Status.ERROR, Activator.getPluginId(), \"Failed to create executable extension for drop adapter in concept: \" + navigatorExtension.getContributor() + \"->\" + conceptId + \" because: \" + e.getMessage()));\r\n \t\t\t\t}\r\n \t\t\t}\r\n \t\t}\r\n-\t\treturn dropCommand;\r\n \t}\r\n+\r\n+\t/**\r\n+\t * Call this method to get a drop adapter for a given object.\r\n+\t * The method checks if the object belongs to a concept and hands\r\n+\t * back the drop adapter which is in the map if it exists\r\n+\t * @param object the object for which to find a specialized drop adapter \r\n+\t * @return null in case there is no specific drop adapter for the given object.\r\n+\t */\r\n+\tprotected CommonDropAdapterAssistant getDelegateDropAdapter(Object object) {\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3Nzk4Mw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370177983", "bodyText": "This shoud be named somehow like DelegatedDropAdapterAssistant", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T15:15:38Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMObjectDropAdapterAssistant.java", "diffHunk": "@@ -9,98 +9,176 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n \r\n-import java.util.Collection;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+import java.util.function.Function;\r\n \r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.IConfigurationElement;\r\n import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Platform;\r\n import org.eclipse.core.runtime.Status;\r\n-import org.eclipse.emf.common.command.Command;\r\n-import org.eclipse.emf.ecore.EObject;\r\n-import org.eclipse.jface.util.LocalSelectionTransfer;\r\n-import org.eclipse.jface.viewers.ISelection;\r\n import org.eclipse.jface.viewers.IStructuredSelection;\r\n-import org.eclipse.jface.viewers.StructuredSelection;\r\n-import org.eclipse.swt.dnd.DND;\r\n import org.eclipse.swt.dnd.DropTargetEvent;\r\n import org.eclipse.swt.dnd.TransferData;\r\n-import org.eclipse.ui.PlatformUI;\r\n import org.eclipse.ui.navigator.CommonDropAdapter;\r\n import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n-import org.eclipse.ui.navigator.CommonViewer;\r\n-\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n-import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n \r\n /**\r\n- * VirSat Drop Assitant to copy and paste SEIs and CAs in the Navigator\r\n- * @author fisc_ph\r\n- *\r\n+ * Drop Assistant for VirSat Navigator that delegates calls to concept specific drop assistants\r\n  */\r\n public class DVLMObjectDropAdapterAssistant extends CommonDropAdapterAssistant {\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4NDU1NA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370184554", "bodyText": "To me it looks like this class mostly repeats platform code. Can't we just use the normal navigator dropassistant extension point from concepts? We can make them higher priority to be sure they act before the default ones", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T15:25:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3Nzk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5MTA0MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370491041", "bodyText": "This shoud be named somehow like DelegatedDropAdapterAssistant\n\nDone.", "author": "PhilMFischer", "createdAt": "2020-01-24T06:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3Nzk4Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5MTUzNw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370491537", "bodyText": "To me it looks like this class mostly repeats platform code. Can't we just use the normal navigator dropassistant extension point from concepts? We can make them higher priority to be sure they act before the default ones\n\nUnfortunately no. From what i saw, we can only add dropAdapter to navigator content contributions. Therefore every concept may have to provide a complete navigator content. Not a 100% sure, but i also think that it is only possible to add one dropAdapter per navigatorContent.\nThe way it is implemented now, it is possible to define a dropAdapter which can be used in any navigator but it can also be reused in the delegateDropAdapter.\nI think this increases functionality and flexibility on what developers want to do on concept side.", "author": "PhilMFischer", "createdAt": "2020-01-24T06:41:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE3Nzk4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4ODY3MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370188671", "bodyText": "Also not clear to me why this class is also appears in the plugin.xml of calculation.ui", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T15:31:53Z", "path": "de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/DVLMObjectDropAdapterAssistant.java", "diffHunk": "@@ -9,98 +9,176 @@\n  *******************************************************************************/\r\n package de.dlr.sc.virsat.project.ui.navigator.dropAssist;\r\n \r\n-import java.util.Collection;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+import java.util.function.Function;\r\n \r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.IConfigurationElement;\r\n import org.eclipse.core.runtime.IStatus;\r\n+import org.eclipse.core.runtime.Platform;\r\n import org.eclipse.core.runtime.Status;\r\n-import org.eclipse.emf.common.command.Command;\r\n-import org.eclipse.emf.ecore.EObject;\r\n-import org.eclipse.jface.util.LocalSelectionTransfer;\r\n-import org.eclipse.jface.viewers.ISelection;\r\n import org.eclipse.jface.viewers.IStructuredSelection;\r\n-import org.eclipse.jface.viewers.StructuredSelection;\r\n-import org.eclipse.swt.dnd.DND;\r\n import org.eclipse.swt.dnd.DropTargetEvent;\r\n import org.eclipse.swt.dnd.TransferData;\r\n-import org.eclipse.ui.PlatformUI;\r\n import org.eclipse.ui.navigator.CommonDropAdapter;\r\n import org.eclipse.ui.navigator.CommonDropAdapterAssistant;\r\n-import org.eclipse.ui.navigator.CommonViewer;\r\n-\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatEditingDomainRegistry;\r\n-import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatEditingDomainClipBoard.ClipboardState;\r\n-import de.dlr.sc.virsat.project.editingDomain.commands.VirSatPasteFromClipboardCommand;\r\n-import de.dlr.sc.virsat.project.ui.navigator.VirSatNavigator;\r\n+import de.dlr.sc.virsat.model.dvlm.categories.ATypeInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.project.Activator;\r\n \r\n /**\r\n- * VirSat Drop Assitant to copy and paste SEIs and CAs in the Navigator\r\n- * @author fisc_ph\r\n- *\r\n+ * Drop Assistant for VirSat Navigator that delegates calls to concept specific drop assistants\r\n  */\r\n public class DVLMObjectDropAdapterAssistant extends CommonDropAdapterAssistant {\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5MjE1OA==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370492158", "bodyText": "Good question! @SaMuellerDLR  Do we need the drop adapter there? I think it is heritage and we should leave it there for the moment. But i guess we don't need it , since we do not have any code dealing with Copy&Paste and DnD of Equations. Do we?", "author": "PhilMFischer", "createdAt": "2020-01-24T06:44:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4ODY3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDUwMjYxOQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370502619", "bodyText": "I checked it yesterday and we dont have any drag and drop functionality for equations.\nI found the commit in our old repository, and there it looks like the entry only exists due to creating the setup with copy & paste. I think it can be safely removed.", "author": "SaMuellerDLR", "createdAt": "2020-01-24T07:33:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4ODY3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDU0MTQ3MQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370541471", "bodyText": "I removed it from calculations", "author": "andriikovalov-dlr", "createdAt": "2020-01-24T09:33:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDE4ODY3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwMjA2Ng==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370202066", "bodyText": "Unnecessary comment", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T15:53:55Z", "path": "de.dlr.sc.virsat.model.extension.ps/src/de/dlr/sc/virsat/model/extension/ps/dnd/ProductStructureDragAndDropInheritanceCommandHelper.java", "diffHunk": "@@ -0,0 +1,177 @@\n+/*******************************************************************************\r\n+ * Copyright (c) 2008-2019 German Aerospace Center (DLR), Simulation and Software Technology, Germany.\r\n+ *\r\n+ * This program and the accompanying materials are made available under the\r\n+ * terms of the Eclipse Public License 2.0 which is available at\r\n+ * http://www.eclipse.org/legal/epl-2.0.\r\n+ *\r\n+ * SPDX-License-Identifier: EPL-2.0\r\n+ *******************************************************************************/\r\n+package de.dlr.sc.virsat.model.extension.ps.dnd;\r\n+\r\n+import java.lang.reflect.Constructor;\r\n+import java.lang.reflect.InvocationTargetException;\r\n+import java.util.Collection;\r\n+import java.util.Collections;\r\n+import java.util.HashMap;\r\n+import java.util.Map;\r\n+\r\n+import org.eclipse.core.runtime.CoreException;\r\n+import org.eclipse.core.runtime.Status;\r\n+import org.eclipse.emf.common.command.Command;\r\n+import org.eclipse.emf.common.command.CompoundCommand;\r\n+import org.eclipse.emf.common.command.UnexecutableCommand;\r\n+\r\n+import de.dlr.sc.virsat.model.concept.types.factory.BeanStructuralElementInstanceFactory;\r\n+import de.dlr.sc.virsat.model.concept.types.structural.IBeanStructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.Concept;\r\n+import de.dlr.sc.virsat.model.dvlm.concepts.util.ActiveConceptHelper;\r\n+import de.dlr.sc.virsat.model.dvlm.roles.Discipline;\r\n+import de.dlr.sc.virsat.model.dvlm.structural.StructuralElementInstance;\r\n+import de.dlr.sc.virsat.model.dvlm.util.DVLMCopiedNameHelper;\r\n+import de.dlr.sc.virsat.model.extension.ps.Activator;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.AssemblyTree;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ConfigurationTree;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementConfiguration;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementOccurence;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ElementRealization;\r\n+import de.dlr.sc.virsat.model.extension.ps.model.ProductStorageDomain;\r\n+import de.dlr.sc.virsat.project.editingDomain.VirSatTransactionalEditingDomain;\r\n+import de.dlr.sc.virsat.project.structure.command.CreateAddSeiWithFileStructureCommand;\r\n+\r\n+/**\r\n+ * This is a helper class to create the correct command for replacing an inheritance\r\n+ * of a SEI with another SEI.\r\n+ */\r\n+public class ProductStructureDragAndDropInheritanceCommandHelper {\r\n+\r\n+\tprotected Map<Class<? extends IBeanStructuralElementInstance>, Class<? extends IBeanStructuralElementInstance>> mapDropBeanToCreateBean;\r\n+\tprotected BeanStructuralElementInstanceFactory bsf;\r\n+\t\r\n+\t/**\r\n+\t * Constructor\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIyNTg2OQ==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370225869", "bodyText": "Let's maybe also check the number of child items after DND?\nAlso can we emulate add and override actions?", "author": "andriikovalov-dlr", "createdAt": "2020-01-23T16:33:45Z", "path": "de.dlr.sc.virsat.swtbot.test/src/de/dlr/sc/virsat/swtbot/test/InheritanceTest.java", "diffHunk": "@@ -139,6 +140,38 @@ public void singleLevelInheritancePropagationUITest() {\n \t\twaitForAllBuildersAndUiThread();\r\n \t\tassertEquals(\"newDocName\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_DOCUMENTNAME));\r\n \t\tassertEquals(\"overriden note\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_NOTE));\r\n+\t}\r\n+\t\r\n+\t@Test\r\n+\tpublic void inheritanceTypingDragAndDrop() {\r\n+\t\trename(elementConfiguration, \"ec_1\");\r\n+\t\tSWTBotTreeItem elementConfiguration2 = addElement(ElementConfiguration.class, conceptPs, configurationTree);\r\n+\t\trename(elementConfiguration2, \"ec_2\");\r\n+\t\t\r\n+\t\tSWTBotTreeItem documentEc1 = addElement(Document.class, conceptPs, elementConfiguration);\r\n+\t\tSWTBotTreeItem documentEc2 = addElement(Document.class, conceptPs, elementConfiguration2);\r\n+\r\n+\t\topenEditor(documentEc1);\r\n+\t\tsetText(Document.PROPERTY_DOCUMENTNAME, \"docFromEc1\");\r\n+\r\n+\t\topenEditor(documentEc2);\r\n+\t\tsetText(Document.PROPERTY_DOCUMENTNAME, \"docFromEc2\");\r\n+\t\t\r\n+\t\t// There are no documents yet with the ElementOccurrence\r\n+\t\tassertThat(\"There is only the documents folder\", elementOccurence.getItems(), arrayWithSize(1));\r\n+\t\t\r\n+\t\t// Now drag the first inheritance\r\n+\t\telementConfiguration.dragAndDrop(elementOccurence);\r\n+\t\twaitForAllBuildersAndUiThread();\r\n+\t\t\r\n+\t\topenEditor(elementOccurence);\r\n+\t\tassertEquals(\"Received override from EC1\", \"docFromEc1\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_DOCUMENTNAME));\r\n+\t\t\r\n+\t\t// now drag the other and verify\r\n+\t\telementConfiguration2.dragAndDrop(elementOccurence);\r\n+\t\twaitForAllBuildersAndUiThread();\r\n \t\t\r\n+\t\topenEditor(elementOccurence);\r\n+\t\tassertEquals(\"Received override from EC2\", \"docFromEc2\", bot.tableWithId(\"tableDocument\").cell(0, Document.PROPERTY_DOCUMENTNAME));\r", "originalCommit": "1e298c6683e3bc1933d65998b3c4c03378692eaf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ5Mzc0Mw==", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/pull/427#discussion_r370493743", "bodyText": "Well, we could check for the children, but i think that is covered by the unit tests we added. This test i just implemented to have a rough overview that the registration on the extension point and execution of the dropAdapter works as expected.\nUnfortunately SWTBot only supports The DragAndDrop Move at the moment. Changing it looks to me like a modification in SWTBot code.", "author": "PhilMFischer", "createdAt": "2020-01-24T06:52:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIyNTg2OQ=="}], "type": "inlineReview"}, {"oid": "8802020c59396ce5b6f3f777fdfebc09a6d39309", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/8802020c59396ce5b6f3f777fdfebc09a6d39309", "message": "Update de.dlr.sc.virsat.project.test/src/de/dlr/sc/virsat/project/editingDomain/commands/VirSatClipboardCommandHelperTest.java\n\nCo-Authored-By: andriikovalov-dlr <48556822+andriikovalov-dlr@users.noreply.github.com>", "committedDate": "2020-01-24T06:23:57Z", "type": "commit"}, {"oid": "903439e3ec12d9bfbc7a2a06a334de1e1421b615", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/903439e3ec12d9bfbc7a2a06a334de1e1421b615", "message": "Update de.dlr.sc.virsat.project.ui/src/de/dlr/sc/virsat/project/ui/navigator/dropAssist/ADVLMDropAdapaterAssistant.java\n\nCo-Authored-By: andriikovalov-dlr <48556822+andriikovalov-dlr@users.noreply.github.com>", "committedDate": "2020-01-24T06:25:06Z", "type": "commit"}, {"oid": "f9df21cdafa90accc3ef49854443262aedaceaf0", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/f9df21cdafa90accc3ef49854443262aedaceaf0", "message": "Changes due to review of andrii - (Task #74)\n\n- fixed some comments\n- renamed class\n- renamed some member variables\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-24T06:53:54Z", "type": "commit"}, {"oid": "c3c07e5e3d9768becece2472b2a6b29024cdfc3f", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/c3c07e5e3d9768becece2472b2a6b29024cdfc3f", "message": "Merge with changes from GitHub Review - (Task #74)\n\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-24T06:56:51Z", "type": "commit"}, {"oid": "348991dd1f3d87901af666a47065c927ea0c0aef", "url": "https://github.com/virtualsatellite/VirtualSatellite4-Core/commit/348991dd1f3d87901af666a47065c927ea0c0aef", "message": "Removed unused dropAssistant from calculations - (Task #74)\n\n---\nTask #74: Override DND functionality in Navigator", "committedDate": "2020-01-24T09:32:41Z", "type": "commit"}]}