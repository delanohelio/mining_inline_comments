{"pr_number": 1289, "pr_title": "export new implemented oltp traversals", "pr_createdAt": "2020-12-07T09:22:33Z", "pr_url": "https://github.com/hugegraph/hugegraph/pull/1289", "timeline": [{"oid": "123ff1cf3053fce9bbb033e116a21c92564fe8b8", "url": "https://github.com/hugegraph/hugegraph/commit/123ff1cf3053fce9bbb033e116a21c92564fe8b8", "message": "export new implemented oltp traversals\n\nChange-Id: I0e501dcffd7c38dbd6afe76e82000935160bee36", "committedDate": "2020-12-07T09:21:31Z", "type": "commit"}, {"oid": "7837241ca702b4667e512eac38ec6feaaf0e6bb9", "url": "https://github.com/hugegraph/hugegraph/commit/7837241ca702b4667e512eac38ec6feaaf0e6bb9", "message": "improve\n\nChange-Id: I3b541099d0dbec6dc455f28324fb80229cdb45d6", "committedDate": "2020-12-09T03:54:20Z", "type": "commit"}, {"oid": "806f2db74038dfbfc266127aca0d23c1d68c1565", "url": "https://github.com/hugegraph/hugegraph/commit/806f2db74038dfbfc266127aca0d23c1d68c1565", "message": "move EdgeStep, WeightedEdgeStep and RepeatEdgeStep to steps package\n\nChange-Id: I934670631e3b7969e7be975bef0fb5104d633965", "committedDate": "2020-12-09T05:48:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzMDk1OA==", "url": "https://github.com/hugegraph/hugegraph/pull/1289#discussion_r539030958", "bodyText": "move to TemplatePathsAPI", "author": "javeme", "createdAt": "2020-12-09T05:57:31Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/api/traversers/TraverserAPI.java", "diffHunk": "@@ -38,14 +38,11 @@ protected static EdgeStep step(HugeGraph graph, Step step) {\n                             step.degree, step.skipDegree);\n     }\n \n-    protected static TemplatePathsTraverser.RepeatEdgeStep repeatEdgeStep(\n-              HugeGraph graph, TemplatePathsAPI.RepeatEdgeStep step) {\n-        return new TemplatePathsTraverser.RepeatEdgeStep(graph, step.direction,\n-                                                         step.labels,\n-                                                         step.properties,\n-                                                         step.degree,\n-                                                         step.skipDegree,\n-                                                         step.maxTimes);\n+    protected static RepeatEdgeStep repeatEdgeStep(\n+              HugeGraph graph, TemplatePathsAPI.TemplatePathStep step) {", "originalCommit": "806f2db74038dfbfc266127aca0d23c1d68c1565", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTAzMzUxMQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1289#discussion_r539033511", "bodyText": "edgesOfVertexWithCount", "author": "javeme", "createdAt": "2020-12-09T06:04:09Z", "path": "hugegraph-core/src/main/java/com/baidu/hugegraph/traversal/algorithm/CountTraverser.java", "diffHunk": "@@ -63,45 +62,45 @@ public long count(Id source, List<Step> steps,\n         }\n \n         int stepNum = steps.size();\n-        Step firstStep = steps.get(0);\n+        EdgeStep firstStep = steps.get(0);\n         if (stepNum == 1) {\n             // Just one step, query count and return\n-            long edgesCount = this.edgesCount(source, firstStep.edgeStep);\n+            long edgesCount = this.edgesCount(source, firstStep);\n             this.count.add(edgesCount);\n             return this.count.longValue();\n         }\n \n         // Multiple steps, construct first step to iterator\n-        Iterator<Edge> edges = this.edgesOfVertex(source, firstStep);\n+        Iterator<Edge> edges = this.edgesOfVertexWithDedup(source, firstStep);\n         // Wrap steps to Iterator except last step\n         for (int i = 1; i < stepNum - 1; i++) {\n-            Step currentStep = steps.get(i);\n+            EdgeStep currentStep = steps.get(i);\n             edges = new FlatMapperIterator<>(edges, (edge) -> {\n                 Id target = ((HugeEdge) edge).id().otherVertexId();\n-                return this.edgesOfVertex(target, currentStep);\n+                return this.edgesOfVertexWithDedup(target, currentStep);\n             });\n         }\n \n         // The last step, just query count\n-        Step lastStep = steps.get(stepNum - 1);\n+        EdgeStep lastStep = steps.get(stepNum - 1);\n         while (edges.hasNext()) {\n             Id target = ((HugeEdge) edges.next()).id().otherVertexId();\n             if (this.dedup(target)) {\n                 continue;\n             }\n             // Count last layer vertices(without dedup size)\n-            long edgesCount = this.edgesCount(target, lastStep.edgeStep);\n+            long edgesCount = this.edgesCount(target, lastStep);\n             this.count.add(edgesCount);\n         }\n \n         return this.count.longValue();\n     }\n \n-    private Iterator<Edge> edgesOfVertex(Id source, Step step) {\n+    private Iterator<Edge> edgesOfVertexWithDedup(Id source, EdgeStep step) {", "originalCommit": "806f2db74038dfbfc266127aca0d23c1d68c1565", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d81a5c677a988c71da0380ab69ae93ac1e67b1cb", "url": "https://github.com/hugegraph/hugegraph/commit/d81a5c677a988c71da0380ab69ae93ac1e67b1cb", "message": "improve\n\nChange-Id: I5c16abb730a176c638bf842118a61d58c52fe80e", "committedDate": "2020-12-09T07:29:07Z", "type": "commit"}]}