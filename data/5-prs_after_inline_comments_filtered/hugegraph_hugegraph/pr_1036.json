{"pr_number": 1036, "pr_title": "service support https access", "pr_createdAt": "2020-06-14T05:02:52Z", "pr_url": "https://github.com/hugegraph/hugegraph/pull/1036", "timeline": [{"oid": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "url": "https://github.com/hugegraph/hugegraph/commit/0c54274f3c6753e17d622bafac0c1ba08ba90c75", "message": "add sup https", "committedDate": "2020-06-14T05:00:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMjQzMg==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439932432", "bodyText": "prefer ssl.server_keystore_file", "author": "javeme", "createdAt": "2020-06-15T05:07:36Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMjc5Ng==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439932796", "bodyText": "define a var for 'new SSLEngineConfigurator(sslContext)'", "author": "javeme", "createdAt": "2020-06-15T05:09:27Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/server/RestServer.java", "diffHunk": "@@ -68,8 +70,22 @@ public void start() throws IOException {\n     }\n \n     private HttpServer configHttpServer(URI uri, ResourceConfig rc) {\n-        HttpServer server = GrizzlyHttpServerFactory.createHttpServer(uri, rc,\n-                                                                      false);\n+        final HttpServer server;\n+        String protocol = this.conf.get(ServerOptions.SECURITY_PROTOCOL);\n+        String keystoreServerFile = this.conf.get(ServerOptions.KEYSTORE_SERVER_FILE);\n+        String keystoreServerPassword = this.conf.get(ServerOptions.KEYSTORE_SERVER_PASSWORD);\n+        if (protocol != null && protocol.equals(\"https\")) {\n+            SSLContextConfigurator sslContext = new SSLContextConfigurator();\n+            // set up security context\n+            sslContext.setKeyStoreFile(keystoreServerFile);\n+            sslContext.setKeyStorePass(keystoreServerPassword);\n+            server = GrizzlyHttpServerFactory.createHttpServer(uri, rc, true,\n+                                                               new SSLEngineConfigurator(sslContext)", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMzAxNA==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439933014", "bodyText": "prefer server.protocol", "author": "javeme", "createdAt": "2020-06-15T05:10:35Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",\n+                    \"The server keystore file.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+            new ConfigOption<>(\n+                    \"server.keystore.password\",\n+                    \"The server keystore password.\",\n+                    disallowEmpty(),\n+                    \"abc123\"\n+            );\n+\n+    public static final ConfigOption<String> SECURITY_PROTOCOL =\n+            new ConfigOption<>(\n+                    \"security.protocol\",", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMzI4Mw==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439933283", "bodyText": "don't set by default, just keep empty", "author": "javeme", "createdAt": "2020-06-15T05:11:55Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",\n+                    \"The server keystore file.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+            new ConfigOption<>(\n+                    \"server.keystore.password\",\n+                    \"The server keystore password.\",\n+                    disallowEmpty(),\n+                    \"abc123\"", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzMzg5MA==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439933890", "bodyText": "improve description: The path of server keystore file used when https protocol is enabled", "author": "javeme", "createdAt": "2020-06-15T05:14:31Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",\n+                    \"The server keystore file.\",", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzNDA0MQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439934041", "bodyText": "improve description", "author": "javeme", "createdAt": "2020-06-15T05:15:01Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",\n+                    \"The server keystore file.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+            new ConfigOption<>(\n+                    \"server.keystore.password\",\n+                    \"The server keystore password.\",", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzNDEyNg==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439934126", "bodyText": "prefer ssl.server_keystore_password", "author": "javeme", "createdAt": "2020-06-15T05:15:19Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",\n+                    \"The server keystore file.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+            new ConfigOption<>(\n+                    \"server.keystore.password\",", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzOTkzNDIzOQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r439934239", "bodyText": "improve description", "author": "javeme", "createdAt": "2020-06-15T05:15:52Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,27 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+            new ConfigOption<>(\n+                    \"server.keystore.file\",\n+                    \"The server keystore file.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+            new ConfigOption<>(\n+                    \"server.keystore.password\",\n+                    \"The server keystore password.\",\n+                    disallowEmpty(),\n+                    \"abc123\"\n+            );\n+\n+    public static final ConfigOption<String> SECURITY_PROTOCOL =\n+            new ConfigOption<>(\n+                    \"security.protocol\",\n+                    \"security.protocol.\",", "originalCommit": "0c54274f3c6753e17d622bafac0c1ba08ba90c75", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "58ee346f0eaa7b9df360593196175238ca6f9f1e", "url": "https://github.com/hugegraph/hugegraph/commit/58ee346f0eaa7b9df360593196175238ca6f9f1e", "message": "Code specification", "committedDate": "2020-06-15T07:09:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg4NzgxNQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r440887815", "bodyText": "align with \"The path...\"", "author": "javeme", "createdAt": "2020-06-16T14:19:13Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,26 +212,29 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n-    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_FILE =\n             new ConfigOption<>(\n-                    \"server.keystore.file\",\n-                    \"The server keystore file.\",\n+                    \"ssl.server_keystore_file\",\n+                    \"The path of server keystore file used when https \" +\n+                            \"protocol is enabled.\",", "originalCommit": "58ee346f0eaa7b9df360593196175238ca6f9f1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg4Nzg4MA==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r440887880", "bodyText": "ditto", "author": "javeme", "createdAt": "2020-06-16T14:19:19Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,26 +212,29 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n-    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_FILE =\n             new ConfigOption<>(\n-                    \"server.keystore.file\",\n-                    \"The server keystore file.\",\n+                    \"ssl.server_keystore_file\",\n+                    \"The path of server keystore file used when https \" +\n+                            \"protocol is enabled.\",\n                     disallowEmpty(),\n                     \"server.keystore\"\n             );\n \n-    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+    public static final ConfigOption<String> SERVER_KEYSTORE_PASSWORD =\n             new ConfigOption<>(\n-                    \"server.keystore.password\",\n-                    \"The server keystore password.\",\n-                    disallowEmpty(),\n-                    \"abc123\"\n+                    \"ssl.server_keystore_password\",\n+                    \"The password of the path of the server keystore file \" +\n+                            \"used when the https protocol is enabled.\",", "originalCommit": "58ee346f0eaa7b9df360593196175238ca6f9f1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg4OTAwNA==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r440889004", "bodyText": "The protocol of rest-server, allowed values are: http or https.", "author": "javeme", "createdAt": "2020-06-16T14:20:45Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,26 +212,29 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n-    public static final ConfigOption<String> KEYSTORE_SERVER_FILE =\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_FILE =\n             new ConfigOption<>(\n-                    \"server.keystore.file\",\n-                    \"The server keystore file.\",\n+                    \"ssl.server_keystore_file\",\n+                    \"The path of server keystore file used when https \" +\n+                            \"protocol is enabled.\",\n                     disallowEmpty(),\n                     \"server.keystore\"\n             );\n \n-    public static final ConfigOption<String> KEYSTORE_SERVER_PASSWORD =\n+    public static final ConfigOption<String> SERVER_KEYSTORE_PASSWORD =\n             new ConfigOption<>(\n-                    \"server.keystore.password\",\n-                    \"The server keystore password.\",\n-                    disallowEmpty(),\n-                    \"abc123\"\n+                    \"ssl.server_keystore_password\",\n+                    \"The password of the path of the server keystore file \" +\n+                            \"used when the https protocol is enabled.\",\n+                    null,\n+                    \"\"\n             );\n \n-    public static final ConfigOption<String> SECURITY_PROTOCOL =\n+    public static final ConfigOption<String> SERVER_PROTOCOL =\n             new ConfigOption<>(\n-                    \"security.protocol\",\n-                    \"security.protocol.\",\n+                    \"server.protocol\",\n+                    \"Fill in when https protocol is enabled.\",", "originalCommit": "58ee346f0eaa7b9df360593196175238ca6f9f1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDg5MDM5OQ==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r440890399", "bodyText": "allowValues(\"http\", \"https\")", "author": "javeme", "createdAt": "2020-06-16T14:22:31Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +212,30 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_FILE =\n+            new ConfigOption<>(\n+                    \"ssl.server_keystore_file\",\n+                    \"The path of server keystore file used when https \" +\n+                            \"protocol is enabled.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_PASSWORD =\n+            new ConfigOption<>(\n+                    \"ssl.server_keystore_password\",\n+                    \"The password of the path of the server keystore file \" +\n+                            \"used when the https protocol is enabled.\",\n+                    null,\n+                    \"\"\n+            );\n+\n+    public static final ConfigOption<String> SERVER_PROTOCOL =\n+            new ConfigOption<>(\n+                    \"server.protocol\",\n+                    \"Fill in when https protocol is enabled.\",\n+                    disallowEmpty(),", "originalCommit": "58ee346f0eaa7b9df360593196175238ca6f9f1e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "042af6776c74c4863f102d1ceca79a4e0e8a022b", "url": "https://github.com/hugegraph/hugegraph/commit/042af6776c74c4863f102d1ceca79a4e0e8a022b", "message": "code specification", "committedDate": "2020-06-17T01:01:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTkzMDI4Mw==", "url": "https://github.com/hugegraph/hugegraph/pull/1036#discussion_r441930283", "bodyText": "add an space between \"http\" and \"https\"", "author": "Linary", "createdAt": "2020-06-18T02:17:04Z", "path": "hugegraph-api/src/main/java/com/baidu/hugegraph/config/ServerOptions.java", "diffHunk": "@@ -212,4 +213,31 @@ public static synchronized ServerOptions instance() {\n                     disallowEmpty(),\n                     \"hugegraph:9fd95c9c-711b-415b-b85f-d4df46ba5c31\"\n             );\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_FILE =\n+            new ConfigOption<>(\n+                    \"ssl.server_keystore_file\",\n+                    \"The path of server keystore file used when https \" +\n+                    \"protocol is enabled.\",\n+                    disallowEmpty(),\n+                    \"server.keystore\"\n+            );\n+\n+    public static final ConfigOption<String> SERVER_KEYSTORE_PASSWORD =\n+            new ConfigOption<>(\n+                    \"ssl.server_keystore_password\",\n+                    \"The password of the path of the server keystore file \" +\n+                    \"used when the https protocol is enabled.\",\n+                    null,\n+                    \"\"\n+            );\n+\n+    public static final ConfigOption<String> SERVER_PROTOCOL =\n+            new ConfigOption<>(\n+                    \"server.protocol\",\n+                    \"The protocol of rest-server, allowed values are: \" +\n+                    \"http or https.\",\n+                    allowValues(\"http\",\"https\"),", "originalCommit": "042af6776c74c4863f102d1ceca79a4e0e8a022b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "13074c446fefd02d685d1f75b28924fa33a467e4", "url": "https://github.com/hugegraph/hugegraph/commit/13074c446fefd02d685d1f75b28924fa33a467e4", "message": "add an space between http and https", "committedDate": "2020-06-18T02:23:17Z", "type": "commit"}]}