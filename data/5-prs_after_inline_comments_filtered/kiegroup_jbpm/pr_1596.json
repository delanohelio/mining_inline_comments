{"pr_number": 1596, "pr_title": "Fixed issue when having same dates - deleteLogsByDate method", "pr_createdAt": "2020-02-18T10:49:33Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1596", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcyNDM3NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380724375", "bodyText": "If only this test is problematic, I would add a delay just here, otherwise we will be prolonging all tests in the class.", "author": "MarianMacik", "createdAt": "2020-02-18T14:57:46Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/log/ProcessInstanceLogCleanTest.java", "diffHunk": "@@ -223,7 +224,7 @@ public void deleteLogsWithStatusActive() {\n \n     @Test\n     @BZ(\"1188702\")\n-    public void deleteLogsByDate() {\n+    public void deleteLogsByDate() throws InterruptedException {", "originalCommit": "4720665ad9bd7b548f171a77a58390ebc91b6618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDczMjk4Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380732987", "bodyText": "problem is only happening for that particular test method, however, the problem itself is the call to the method\nstartProcess(kieSession, HELLO_WORLD_PROCESS_ID, 4);\nThat's the one which is starting 4 processes at same time - for the code above.\nSo far, the issue is only happening for that test method, but it might affect future test cases calling the same \"startProcess\" method.\nAnother option, would be to create a new method overloaded called \"startProcess\", passing a delay in miliseconds for instance.\nI'd prefer this option - what do you think @MarianMacik?", "author": "afalhambra", "createdAt": "2020-02-18T15:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcyNDM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDczNzM1OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380737359", "bodyText": "yes, having a different method seems more clear.\nOne second delay is too much, perhaps 5-10 ms is enough as precision is per millisecond.", "author": "gmunozfe", "createdAt": "2020-02-18T15:17:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcyNDM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDc4NzgyMw==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380787823", "bodyText": "+1 @afalhambra", "author": "MarianMacik", "createdAt": "2020-02-18T16:30:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcyNDM3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNDYxMw==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r381134613", "bodyText": "Done. Updated.", "author": "afalhambra", "createdAt": "2020-02-19T08:17:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDcyNDM3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk2NjcyOQ==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r380966729", "bodyText": "Reduce sleep time (probably a few milliseconds is enough)", "author": "gmunozfe", "createdAt": "2020-02-18T22:12:25Z", "path": "jbpm-test-coverage/src/test/java/org/jbpm/test/functional/log/ProcessInstanceLogCleanTest.java", "diffHunk": "@@ -385,9 +380,10 @@ private void abortProcess(KieSession kieSession, long pid) {\n         }\n     }\n \n-    private List<ProcessInstance> startProcess(KieSession kieSession, String processId, int count) {\n+    private List<ProcessInstance> startProcess(KieSession kieSession, String processId, int count) throws InterruptedException {\n         List<ProcessInstance> piList = new ArrayList<ProcessInstance>();\n         for (int i = 0; i < count; i++) {\n+            TimeUnit.MILLISECONDS.sleep(1000);", "originalCommit": "4720665ad9bd7b548f171a77a58390ebc91b6618", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MTEzNDQyNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1596#discussion_r381134425", "bodyText": "agree", "author": "afalhambra", "createdAt": "2020-02-19T08:17:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDk2NjcyOQ=="}], "type": "inlineReview"}, {"oid": "c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "url": "https://github.com/kiegroup/jbpm/commit/c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "message": "# deleteLogsByDate method fixed by adding a delay of 1sec when starting up BPM processes in order to avoid issue with equal dates", "committedDate": "2020-02-19T08:16:50Z", "type": "commit"}, {"oid": "c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "url": "https://github.com/kiegroup/jbpm/commit/c8c4562c3415e088cc96a0900dfa13f6dcfcd68e", "message": "# deleteLogsByDate method fixed by adding a delay of 1sec when starting up BPM processes in order to avoid issue with equal dates", "committedDate": "2020-02-19T08:16:50Z", "type": "forcePushed"}]}