{"pr_number": 1641, "pr_title": "[JBPM-9129] Start process without triggering a start node", "pr_createdAt": "2020-05-04T08:14:59Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1641", "timeline": [{"oid": "3272dd559b5dfb0af65730baca8f773d16f8db03", "url": "https://github.com/kiegroup/jbpm/commit/3272dd559b5dfb0af65730baca8f773d16f8db03", "message": "[JBPM-9129] Start process without triggering a start node\n\nAdded functions to trigger a new process from an arbitrary node.", "committedDate": "2020-05-05T07:48:21Z", "type": "forcePushed"}, {"oid": "ed98ee8bee77d76066e557568b911b32944fef59", "url": "https://github.com/kiegroup/jbpm/commit/ed98ee8bee77d76066e557568b911b32944fef59", "message": "[JBPM-9129] Start process without triggering a start node\n\nAdded functions to trigger a new process from an arbitrary node.", "committedDate": "2020-05-05T15:35:38Z", "type": "forcePushed"}, {"oid": "b1fec1d5831a9b99c605bf25f985002c0f266155", "url": "https://github.com/kiegroup/jbpm/commit/b1fec1d5831a9b99c605bf25f985002c0f266155", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-11T14:14:22Z", "type": "forcePushed"}, {"oid": "bc90039ec4399eced753d0a9d225d899720e7b74", "url": "https://github.com/kiegroup/jbpm/commit/bc90039ec4399eced753d0a9d225d899720e7b74", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-17T12:34:26Z", "type": "forcePushed"}, {"oid": "27ae166fefe96617c4cc1442ab1b2a50ba02a754", "url": "https://github.com/kiegroup/jbpm/commit/27ae166fefe96617c4cc1442ab1b2a50ba02a754", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-18T13:24:50Z", "type": "forcePushed"}, {"oid": "8238eba46118aabd69cceda5fac773fb06b62714", "url": "https://github.com/kiegroup/jbpm/commit/8238eba46118aabd69cceda5fac773fb06b62714", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-18T15:02:40Z", "type": "forcePushed"}, {"oid": "0c2b5194541eddca9232043fe57665098b212998", "url": "https://github.com/kiegroup/jbpm/commit/0c2b5194541eddca9232043fe57665098b212998", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-19T06:22:09Z", "type": "forcePushed"}, {"oid": "8ed260236a00b5597266ba9b542fe71b46bbe81b", "url": "https://github.com/kiegroup/jbpm/commit/8ed260236a00b5597266ba9b542fe71b46bbe81b", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-19T16:46:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4NzM0NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428087345", "bodyText": "I think CancelNodeInstanceAction is used in multiple cases, boundary escalation and boundary error events, not sure I grasp the meaning of TIMED cancel type in this context?", "author": "krisv", "createdAt": "2020-05-20T15:05:07Z", "path": "jbpm-flow/src/main/java/org/jbpm/process/instance/impl/CancelNodeInstanceAction.java", "diffHunk": "@@ -38,7 +40,7 @@ public void execute(ProcessContext context) throws Exception {\n \t\tWorkflowProcessInstance pi = context.getNodeInstance().getProcessInstance();\n \t\tNodeInstance nodeInstance = findNodeByUniqueId(pi.getNodeInstances(), attachedToNodeId);\n \t\tif (nodeInstance != null) {\n-\t\t    ((org.jbpm.workflow.instance.NodeInstance)nodeInstance).cancel();\n+            ((org.jbpm.workflow.instance.NodeInstance) nodeInstance).cancel(TIMED);", "originalCommit": "8ed260236a00b5597266ba9b542fe71b46bbe81b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODUzOTI2OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428539269", "bodyText": "You are right. I can use SKIPPED vs OBSOLETE. OBSOLETE means the task has no meaning anymore as the group it belonged is already completted. SKIPPED would mean that another route has been taking.", "author": "elguardian", "createdAt": "2020-05-21T09:15:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4NzM0NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4ODUyNg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428088526", "bodyText": "What's the point of passing wfp here, isn't this always this?", "author": "krisv", "createdAt": "2020-05-20T15:06:39Z", "path": "jbpm-flow/src/main/java/org/jbpm/ruleflow/instance/RuleFlowProcessInstance.java", "diffHunk": "@@ -46,4 +48,32 @@ public void internalStart(String trigger) {\n     \t    .forEach(austoStartNode -> signalEvent(austoStartNode.getName(), null));\n     }\n \n+\n+    private void trigger(RuleFlowProcessInstance wfp, String nodeId) {", "originalCommit": "8ed260236a00b5597266ba9b542fe71b46bbe81b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU0MDAwMQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428540001", "bodyText": "sure", "author": "elguardian", "createdAt": "2020-05-21T09:16:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA4ODUyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5MDI5Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428090297", "bodyText": "Node instances are stored as part of the binary state using protobuf, wouldn't we have to keep the aborted field to keep backwards compatibility?  Would we need to generate the protobuf files?  From what I understand this field is just used to pass information around (to the listener generating the logs), so I guess it probably isn't going to be necessary to be serialized (actually aborted node instances should not be serialized), but unless this aborted field was somehow excluded in protobuf marshalling, and/or cancelType will be too?", "author": "krisv", "createdAt": "2020-05-20T15:08:57Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/NodeInstanceImpl.java", "diffHunk": "@@ -78,12 +82,12 @@\n     protected int slaCompliance = ProcessInstance.SLA_NA;\n     protected Date slaDueDate;\n     protected long slaTimerId = -1;\n-    protected boolean aborted = false;", "originalCommit": "8ed260236a00b5597266ba9b542fe71b46bbe81b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU0MDgyMg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428540822", "bodyText": "made it transient.", "author": "elguardian", "createdAt": "2020-05-21T09:18:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5MDI5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NDU3Mg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428094572", "bodyText": "It seems most of the logic around storying actual object was removed for more review, should this (and similar references in this PR to WithValueObject) still be here?", "author": "krisv", "createdAt": "2020-05-20T15:14:45Z", "path": "jbpm-services/jbpm-kie-services/src/main/java/org/jbpm/kie/services/impl/RuntimeDataServiceImpl.java", "diffHunk": "@@ -761,6 +761,13 @@ public NodeInstanceDesc getNodeInstanceForWorkItem(Long workItemId) {\n         return variablesState;\n     }\n \n+    @Override\n+    public Collection<VariableDesc> getVariablesCurrentStateWithValueObject(Long processInstanceId) {", "originalCommit": "8ed260236a00b5597266ba9b542fe71b46bbe81b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU0MzE5MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428543191", "bodyText": "removed. left behind by mistake.", "author": "elguardian", "createdAt": "2020-05-21T09:23:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODA5NDU3Mg=="}], "type": "inlineReview"}, {"oid": "d6599557a1c12a1003d4e312daa5a0da4e784448", "url": "https://github.com/kiegroup/jbpm/commit/d6599557a1c12a1003d4e312daa5a0da4e784448", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-21T09:26:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY3MTY0Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428671647", "bodyText": "Please remove auto-generated TODO comment for consistency across the class methods.", "author": "afalhambra", "createdAt": "2020-05-21T14:03:49Z", "path": "jbpm-human-task/jbpm-human-task-workitems/src/test/java/org/jbpm/services/task/test/TestStatefulKnowledgeSession.java", "diffHunk": "@@ -312,4 +312,11 @@ public void delete(FactHandle fh, FactHandle.State fhState) {\n     public void destroy() {\n         dispose();        \n     }\n+\n+    @Override\n+    public ProcessInstance startProcessFromNodeIds(String processId, Map<String, Object> params, String... nodeId) {\n+        // TODO Auto-generated method stub", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzMzQzMg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430233432", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:13:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY3MTY0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY4NjA0Mg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428686042", "bodyText": "Same as some others comments, it should be nodeIds to not lead to any confusion.", "author": "afalhambra", "createdAt": "2020-05-21T14:27:13Z", "path": "jbpm-flow/src/main/java/org/jbpm/ruleflow/instance/RuleFlowProcessInstance.java", "diffHunk": "@@ -46,4 +48,31 @@ public void internalStart(String trigger) {\n     \t    .forEach(austoStartNode -> signalEvent(austoStartNode.getName(), null));\n     }\n \n+\n+    public void startProcessFromNodeIds(String[] nodeInstancesIds) {", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzMzczNA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430233734", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:13:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY4NjA0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY5NDQ1MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428694451", "bodyText": "You could use functional style expression like:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return node.isPresent() ? node.get() : null;\n          \n          \n            \n                    return node.orElse(null);", "author": "afalhambra", "createdAt": "2020-05-21T14:41:01Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/core/impl/NodeContainerImpl.java", "diffHunk": "@@ -63,6 +64,12 @@ public Node getNode(final long id) {\n         return node; \n     }\n \n+    @Override\n+    public Node getNodeByUniqueId(String nodeId) {\n+        Optional<Node> node = this.nodes.values().stream().filter(e -> e.getNodeUniqueId().equals(nodeId)).findFirst();\n+        return node.isPresent() ? node.get() : null;", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNDk5MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430234991", "bodyText": "ok", "author": "elguardian", "createdAt": "2020-05-26T08:15:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY5NDQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODcwMzkwMw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r428703903", "bodyText": "2020", "author": "afalhambra", "createdAt": "2020-05-21T14:54:16Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA4OTI1Mg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429089252", "bodyText": "Previous version of this class setup this.aborted = true; when calling cancel() method. However this is no longer the case in the new changes. Shouldn't we set also this.aborted = true; when calling cancel() method? Otherwise aborted is never updated in the code (new method setAborted(boolean aborted) is not called in the code).\nThe reason to keep aborted field is to keep backward compatibility only? if so, why you want to mark cancelType as transient", "author": "afalhambra", "createdAt": "2020-05-22T07:34:42Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/NodeInstanceImpl.java", "diffHunk": "@@ -149,9 +155,13 @@ public Node getNode() {\n     public boolean isInversionOfControl() {\n         return false;\n     }\n+\n+    public final void cancel() {\n+        cancel(ABORTED);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIxODA5MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429218091", "bodyText": "Field aborted and cancelType aren't necessary to be persisted long-term, but more short-term for data passing.  Probably aborted could have been transient as well, but for backwards compability we probably can't change that now.  So I guess the plan is to just keep the field, nothing more.  I think we have tests that are run as part of QE suite that test portability of process instance binary state across versions, can we make sure these are run to make sure we don't break backwards compatibility with this?", "author": "krisv", "createdAt": "2020-05-22T12:31:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA4OTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTg2OTkzOA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429869938", "bodyText": "Yes, there are tests as part of a test suite in jbpm-runtime-manager module. However these are related to a migration between different bpm processes. So I'm wondering whether this will be enough or we should add a specific test case for backward compatibility. @krisv, @elguardian wdyt?\nhttps://github.com/kiegroup/jbpm/blob/master/jbpm-runtime-manager/src/test/java/org/jbpm/runtime/manager/impl/migration/MigrationManagerTest.java", "author": "afalhambra", "createdAt": "2020-05-25T10:50:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA4OTI1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTkwMjExNg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429902116", "bodyText": "This aborted field would be persisted with any node instance, so I think any of those migration tests would be able to detect migration issues caused by this.  There should be sufficient other unit tests for simply testing whether aborting a node instance works well (using cancelType).", "author": "krisv", "createdAt": "2020-05-25T12:12:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA4OTI1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyOTM4NA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429129384", "bodyText": "Writing down here some comments about these bpmn files:\n\nName attribute in the processes should be consistent and meaningful. Some of them have \"test2\" and another has \"test\".\nPackage should be consistent and meaningful across them. Some have \"com.myspace.sample\" and others have \"com.myspace.test\"", "author": "afalhambra", "createdAt": "2020-05-22T09:02:25Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzOTkwNg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430239906", "bodyText": "not relevant", "author": "elguardian", "createdAt": "2020-05-26T08:24:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEyOTM4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNDY3NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429134675", "bodyText": "nodeIds are not declared in the javadoc section", "author": "afalhambra", "createdAt": "2020-05-22T09:13:56Z", "path": "jbpm-services/jbpm-services-api/src/main/java/org/jbpm/services/api/ProcessService.java", "diffHunk": "@@ -81,12 +81,39 @@\n     Long startProcess(String deploymentId, String processId, CorrelationKey correlationKey, Map<String, Object> params);\n \n     /**\n-\t * Aborts the specified process\n-\t * \n-\t * @param processInstanceId process instance's unique identifier\n-\t * @throws DeploymentNotFoundException in case deployment unit was not found\n-\t * @throws ProcessInstanceNotFoundException in case process instance with given id was not found\n-\t */\n+     * Starts a process with the values supplied from the current nodes\n+     * \n+     * @param deploymentId deployment information for the process's kjar\n+     * @param processId The process's identifier\n+     * @param params process variables\n+     * @return process instance identifier\n+     * @throws RuntimeException in case of encountered errors\n+     * @throws DeploymentNotFoundException in case deployment with given deployment id does not exist\n+     * @throws DeploymentNotActiveException in case deployment with given deployment id is not active\n+     */\n+    Long startProcessFromNodeIds(String deploymentId, String processId, Map<String, Object> params, String... nodeIds);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NDY3MA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430254670", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:49:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNDY3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNDk1Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429134956", "bodyText": "same as above", "author": "afalhambra", "createdAt": "2020-05-22T09:14:29Z", "path": "jbpm-services/jbpm-services-api/src/main/java/org/jbpm/services/api/ProcessService.java", "diffHunk": "@@ -81,12 +81,39 @@\n     Long startProcess(String deploymentId, String processId, CorrelationKey correlationKey, Map<String, Object> params);\n \n     /**\n-\t * Aborts the specified process\n-\t * \n-\t * @param processInstanceId process instance's unique identifier\n-\t * @throws DeploymentNotFoundException in case deployment unit was not found\n-\t * @throws ProcessInstanceNotFoundException in case process instance with given id was not found\n-\t */\n+     * Starts a process with the values supplied from the current nodes\n+     * \n+     * @param deploymentId deployment information for the process's kjar\n+     * @param processId The process's identifier\n+     * @param params process variables\n+     * @return process instance identifier\n+     * @throws RuntimeException in case of encountered errors\n+     * @throws DeploymentNotFoundException in case deployment with given deployment id does not exist\n+     * @throws DeploymentNotActiveException in case deployment with given deployment id is not active\n+     */\n+    Long startProcessFromNodeIds(String deploymentId, String processId, Map<String, Object> params, String... nodeIds);\n+\n+    /**\n+     * Starts a process with the values supplied from the current nodes\n+     * \n+     * @param deploymentId deployment information for the process's kjar\n+     * @param processId The process's identifier\n+     * @param key correlation key (must be unique)\n+     * @param params process variables\n+     * @return process instance identifier\n+     * @throws RuntimeException in case of encountered errors\n+     * @throws DeploymentNotFoundException in case deployment with given deployment id does not exist\n+     * @throws DeploymentNotActiveException in case deployment with given deployment id is not active\n+     */\n+    Long startProcessFromNodeIds(String deploymentId, String processId, CorrelationKey key, Map<String, Object> params, String... nodeIds);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1NTMyNw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430255327", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:50:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzNDk1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTEzODg1NA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429138854", "bodyText": "Exception is never thrown within this method.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void testStartProcessFromNodeIdsWithTimer() throws Exception {\n          \n          \n            \n                public void testStartProcessFromNodeIdsWithTimer() {", "author": "afalhambra", "createdAt": "2020-05-22T09:22:16Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        ProcessInstance pi = processService.getProcessInstance(processInstanceId);\n+        assertNull(pi);\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIdsWithTimer() throws Exception {", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0Mjg4Mw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429142883", "bodyText": "there are only 2 kjar to be deployed here so I would rename the following:\n\nreleaseId3 to releaseId2\nkJar3 to kJar2\npom3 to pom2\ntarget/kmodule2\n\nQuestion here is: why do we need to deploy same processes but with a different version?", "author": "afalhambra", "createdAt": "2020-05-22T09:30:26Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0MDA5NA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430240094", "bodyText": "ok", "author": "elguardian", "createdAt": "2020-05-26T08:24:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0Mjg4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0ODQ2NQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429148465", "bodyText": "I would change it to the below to make it more readable\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Thread.sleep(3000);\n          \n          \n            \n                    TimeUnit.SECONDS.sleep(3);", "author": "afalhambra", "createdAt": "2020-05-22T09:42:39Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        ProcessInstance pi = processService.getProcessInstance(processInstanceId);\n+        assertNull(pi);\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIdsWithTimer() throws Exception {\n+        final String processId = \"simple.restartWithTimer\";\n+        assertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+        assertNotNull(processService);\n+\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), processId, singletonMap(\"var_a\", 3));\n+        assertNotNull(processInstanceId);\n+\n+        Thread.sleep(3000);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MzYzMg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430253632", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:47:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE0ODQ2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MDA0MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429150041", "bodyText": "I would use method reference as per below\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n          \n          \n            \n                    String[] nodeIds = logs.stream().map(NodeInstanceDesc::getNodeId).toArray(String[]::new);", "author": "afalhambra", "createdAt": "2020-05-22T09:46:00Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MDUxMA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429150510", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n          \n          \n            \n                    nodeIds = logs.stream().map(NodeInstanceDesc::getNodeId).toArray(String[]::new);", "author": "afalhambra", "createdAt": "2020-05-22T09:47:03Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MjU4Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430252586", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:45:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MDUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjgzOQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429152839", "bodyText": "EntryType.ABORTED is a new enum entry so I would add an assert to check logs.size, so we ensure correct data is fetched having this new state.", "author": "afalhambra", "createdAt": "2020-05-22T09:52:07Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI2MjMwOQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430262309", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T09:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE1MjgzOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5MDQ2Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429190466", "bodyText": "same as before", "author": "afalhambra", "createdAt": "2020-05-22T11:22:28Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0Mjc4NA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430242784", "bodyText": "the goal of the test is to see if the starts node instance work. not really checking the task works or not.", "author": "elguardian", "createdAt": "2020-05-26T08:29:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5MDQ2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5MTkyNg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429191926", "bodyText": "Would be worth to have an assert here checking this task name is number 2?", "author": "afalhambra", "createdAt": "2020-05-22T11:26:00Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1MzA5Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430253096", "bodyText": "not the goal of the test.", "author": "elguardian", "createdAt": "2020-05-26T08:46:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5MTkyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5MTk4Nw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429191987", "bodyText": "Would be worth to have an assert here checking this task name is number 1?", "author": "afalhambra", "createdAt": "2020-05-22T11:26:09Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI0MjcxMw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430242713", "bodyText": "the goal of the test is to see if the starts node instance work. not really checking the task works or not.", "author": "elguardian", "createdAt": "2020-05-26T08:29:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5MTk4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NTA4OA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429195088", "bodyText": "Why not to pass an emptyList in the params argument here?\nso by doing that we can later on check add an additional assert checkingthat the process variable var_a is actually set already to 3 (it's been restored properly from previous state)? wdyt?", "author": "afalhambra", "createdAt": "2020-05-22T11:33:58Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDI1Mjk0NA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430252944", "bodyText": "there is no previous state.", "author": "elguardian", "createdAt": "2020-05-26T08:46:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NTA4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NTY4OA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429195688", "bodyText": "rename to skipped\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    Collection<NodeInstanceDesc> timed = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.SKIPPED, new QueryContext(0, 0));\n          \n          \n            \n                    Collection<NodeInstanceDesc> skipped = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.SKIPPED, new QueryContext(0, 0));", "author": "afalhambra", "createdAt": "2020-05-22T11:35:30Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        ProcessInstance pi = processService.getProcessInstance(processInstanceId);\n+        assertNull(pi);\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIdsWithTimer() throws Exception {\n+        final String processId = \"simple.restartWithTimer\";\n+        assertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+        assertNotNull(processService);\n+\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), processId, singletonMap(\"var_a\", 3));\n+        assertNotNull(processInstanceId);\n+\n+        Thread.sleep(3000);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> timed = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.SKIPPED, new QueryContext(0, 0));", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzODczNw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430238737", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:22:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NTY4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NjA1Mg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429196052", "bodyText": "I'd use method reference here as well.", "author": "afalhambra", "createdAt": "2020-05-22T11:36:29Z", "path": "jbpm-services/jbpm-kie-services/src/test/java/org/jbpm/kie/services/test/StartProcessFromArbitraryNodesServiceImplTest.java", "diffHunk": "@@ -0,0 +1,225 @@\n+/*\n+ * Copyright 2017 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.kie.services.test;\n+\n+import java.io.File;\n+import java.io.FileOutputStream;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+import org.drools.compiler.kie.builder.impl.InternalKieModule;\n+import org.jbpm.kie.services.impl.KModuleDeploymentUnit;\n+import org.jbpm.kie.test.util.AbstractKieServicesBaseTest;\n+import org.jbpm.services.api.RuntimeDataService.EntryType;\n+import org.jbpm.services.api.model.DeploymentUnit;\n+import org.jbpm.services.api.model.NodeInstanceDesc;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.kie.api.KieServices;\n+import org.kie.api.builder.ReleaseId;\n+import org.kie.api.runtime.process.ProcessInstance;\n+import org.kie.api.runtime.query.QueryContext;\n+import org.kie.api.task.model.Task;\n+import org.kie.scanner.KieMavenRepository;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+\n+import static java.util.Collections.emptyMap;\n+import static java.util.Collections.singletonMap;\n+import static org.hamcrest.CoreMatchers.is;\n+import static org.junit.Assert.assertNotNull;\n+import static org.junit.Assert.assertNull;\n+import static org.junit.Assert.assertThat;\n+import static org.kie.scanner.KieMavenRepository.getKieMavenRepository;\n+\n+public class StartProcessFromArbitraryNodesServiceImplTest extends AbstractKieServicesBaseTest {\n+\n+    private static final Logger logger = LoggerFactory.getLogger(StartProcessFromArbitraryNodesServiceImplTest.class);\n+\n+    private List<DeploymentUnit> units = new ArrayList<DeploymentUnit>();\n+\n+    @Before\n+    public void prepare() {\n+    \tconfigureServices();\n+    \tlogger.debug(\"Preparing kjar\");\n+        KieServices ks = KieServices.Factory.get();\n+        ReleaseId releaseId = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, VERSION);\n+        List<String> processes = new ArrayList<String>();\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithTimerTest.bpmn2\");\n+        processes.add(\"repo/processes/general/BPMN2-SimpleRestartWithObsoleteTest.bpmn2\");\n+\n+        InternalKieModule kJar1 = createKieJar(ks, releaseId, processes);\n+        File pom = new File(\"target/kmodule\", \"pom.xml\");\n+        pom.getParentFile().mkdir();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom);\n+            fs.write(getPom(releaseId).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+\t\tKieMavenRepository repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId, kJar1, pom);\n+\n+        ReleaseId releaseId3 = ks.newReleaseId(GROUP_ID, ARTIFACT_ID, \"1.1.0\");\n+\n+        InternalKieModule kJar3 = createKieJar(ks, releaseId3, processes);\n+        File pom3 = new File(\"target/kmodule3\", \"pom.xml\");\n+        pom3.getParentFile().mkdirs();\n+        try {\n+            FileOutputStream fs = new FileOutputStream(pom3);\n+            fs.write(getPom(releaseId3).getBytes());\n+            fs.close();\n+        } catch (Exception e) {\n+\n+        }\n+        repository = getKieMavenRepository();\n+        repository.deployArtifact(releaseId3, kJar3, pom3);\n+    }\n+\n+    @After\n+    public void cleanup() {\n+        cleanupSingletonSessionId();\n+        if (units != null && !units.isEmpty()) {\n+            for (DeploymentUnit unit : units) {\n+            \ttry {\n+                deploymentService.undeploy(unit);\n+            \t} catch (Exception e) {\n+            \t\t// do nothing in case of some failed tests to avoid next test to fail as well\n+            \t}\n+            }\n+            units.clear();\n+        }\n+        close();\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIds() {\n+    \tassertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+    \tassertNotNull(processService);\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3));\n+    \tassertNotNull(processInstanceId);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        String[] nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        logs = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        nodeIds = logs.stream().map(e -> e.getNodeId()).toArray(String[]::new);\n+        processInstanceId = processService.startProcessFromNodeIds(deploymentUnit.getIdentifier(), \"restart.simple\", singletonMap(\"var_a\", 3), nodeIds);\n+        runtimeDataService.getTasksByProcessInstanceId(processInstanceId).forEach(e -> {\n+            this.userTaskService.start(e, \"john\");\n+            this.userTaskService.complete(e, \"john\", emptyMap());\n+        });\n+\n+        ProcessInstance pi = processService.getProcessInstance(processInstanceId);\n+        assertNull(pi);\n+    }\n+\n+    @Test\n+    public void testStartProcessFromNodeIdsWithTimer() throws Exception {\n+        final String processId = \"simple.restartWithTimer\";\n+        assertNotNull(deploymentService);\n+\n+        KModuleDeploymentUnit deploymentUnit = new KModuleDeploymentUnit(GROUP_ID, ARTIFACT_ID, VERSION);\n+\n+        deploymentService.deploy(deploymentUnit);\n+        units.add(deploymentUnit);\n+        assertNotNull(processService);\n+\n+\n+        Long processInstanceId = processService.startProcess(deploymentUnit.getIdentifier(), processId, singletonMap(\"var_a\", 3));\n+        assertNotNull(processInstanceId);\n+\n+        Thread.sleep(3000);\n+\n+        processService.abortProcessInstance(processInstanceId);\n+\n+        Collection<NodeInstanceDesc> timed = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.SKIPPED, new QueryContext(0, 0));\n+        assertThat(timed.size(), is(1));\n+        Collection<NodeInstanceDesc> aborted = runtimeDataService.getProcessInstanceFullHistoryByType(processInstanceId, EntryType.ABORTED, new QueryContext(0, 0));\n+        assertThat(aborted.size(), is(1));\n+        String[] nodeIds = aborted.stream().map(e -> e.getNodeId()).toArray(String[]::new);", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNTkzNw==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430235937", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:17:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTE5NjA1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwNDY1MQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429204651", "bodyText": "from and to can be null.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return \"Script \" + this.name + \" from version \" + from + \" to \" + to;\n          \n          \n            \n                    return \"Script \" + this.name + (from != null ? \" from version \" + from : \"\") + (to != null ? \" to \" + to : \"\");", "author": "afalhambra", "createdAt": "2020-05-22T11:58:06Z", "path": "jbpm-test-util/src/main/java/org/jbpm/test/util/DatabaseScript.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.util;\n+\n+import java.io.File;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+\n+\n+public class DatabaseScript implements Comparable<DatabaseScript> {\n+\n+    private String name;\n+    private Version from;\n+    private Version to;\n+    private File script;\n+\n+    public DatabaseScript(File script) {\n+        this(script.getName());\n+        this.script = script;\n+    }\n+\n+    public DatabaseScript(String value) {\n+        Pattern pattern = Pattern.compile(\"(.*)-(\\\\d+\\\\.\\\\d+)-to-(\\\\d+\\\\.\\\\d+).sql\");\n+        Matcher matcher = pattern.matcher(value);\n+        if (matcher.matches() && matcher.groupCount() == 3) {\n+            this.name = matcher.group(1);\n+            this.from = new Version(matcher.group(2));\n+            this.to = new Version(matcher.group(3));\n+        } else {\n+            this.name = value;\n+        }\n+    }\n+\n+    public File getScript() {\n+        return script;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public Version getTo() {\n+        return to;\n+    }\n+\n+    public Version getFrom() {\n+        return from;\n+    }\n+\n+    @Override\n+    public int compareTo(DatabaseScript o) {\n+        if (this.name.equals(o.name)) {\n+            if (from == null || o.from == null) {\n+                return this.name.compareTo(o.name);\n+            }\n+            return from.compareTo(o.from);\n+        } else {\n+            return this.name.compareTo(o.name);\n+        }\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {\n+        if (obj instanceof DatabaseScript) {\n+            return this.compareTo((DatabaseScript) obj) == 0;\n+        }\n+        return false;\n+    }\n+\n+    @Override\n+    public String toString() {\n+        return \"Script \" + this.name + \" from version \" + from + \" to \" + to;", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNjQ5Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430236496", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:18:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwNDY1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwODMzMA==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429208330", "bodyText": "hasCode method should be implemented, but up to you as this is a test class.", "author": "afalhambra", "createdAt": "2020-05-22T12:07:21Z", "path": "jbpm-test-util/src/main/java/org/jbpm/test/util/Version.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.util;\n+\n+public class Version implements Comparable<Version> {\n+\n+    Integer major;\n+    Integer minor;\n+\n+    public Version(String version) {\n+        String[] parts = version.split(\"\\\\.\");\n+        this.major = Integer.parseInt(parts[0]);\n+        this.minor = Integer.parseInt(parts[1]);\n+    }\n+\n+\n+    public int getMajor() {\n+        return major;\n+    }\n+\n+    public int getMinor() {\n+        return minor;\n+    }\n+\n+    @Override\n+    public int compareTo(Version other) {\n+        if (major.equals(other.major)) {\n+            return minor.compareTo(other.minor);\n+        }\n+        return major.compareTo(other.major);\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNzUzNQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430237535", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:20:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwODMzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwODQxMg==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r429208412", "bodyText": "hasCode method should be implemented, but up to you as this is a test class.", "author": "afalhambra", "createdAt": "2020-05-22T12:07:33Z", "path": "jbpm-test-util/src/main/java/org/jbpm/test/util/DatabaseScript.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright 2020 Red Hat, Inc. and/or its affiliates.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.jbpm.test.util;\n+\n+import java.io.File;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+\n+\n+\n+public class DatabaseScript implements Comparable<DatabaseScript> {\n+\n+    private String name;\n+    private Version from;\n+    private Version to;\n+    private File script;\n+\n+    public DatabaseScript(File script) {\n+        this(script.getName());\n+        this.script = script;\n+    }\n+\n+    public DatabaseScript(String value) {\n+        Pattern pattern = Pattern.compile(\"(.*)-(\\\\d+\\\\.\\\\d+)-to-(\\\\d+\\\\.\\\\d+).sql\");\n+        Matcher matcher = pattern.matcher(value);\n+        if (matcher.matches() && matcher.groupCount() == 3) {\n+            this.name = matcher.group(1);\n+            this.from = new Version(matcher.group(2));\n+            this.to = new Version(matcher.group(3));\n+        } else {\n+            this.name = value;\n+        }\n+    }\n+\n+    public File getScript() {\n+        return script;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public Version getTo() {\n+        return to;\n+    }\n+\n+    public Version getFrom() {\n+        return from;\n+    }\n+\n+    @Override\n+    public int compareTo(DatabaseScript o) {\n+        if (this.name.equals(o.name)) {\n+            if (from == null || o.from == null) {\n+                return this.name.compareTo(o.name);\n+            }\n+            return from.compareTo(o.from);\n+        } else {\n+            return this.name.compareTo(o.name);\n+        }\n+    }\n+\n+    @Override\n+    public boolean equals(Object obj) {", "originalCommit": "d6599557a1c12a1003d4e312daa5a0da4e784448", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDIzNzE4OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430237189", "bodyText": "done", "author": "elguardian", "createdAt": "2020-05-26T08:19:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTIwODQxMg=="}], "type": "inlineReview"}, {"oid": "a7c7cce899123e8135b86ae1a7966db8e72e52cb", "url": "https://github.com/kiegroup/jbpm/commit/a7c7cce899123e8135b86ae1a7966db8e72e52cb", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-26T08:20:44Z", "type": "forcePushed"}, {"oid": "1d45c0f871c0a06ace5a78abbe9d9b79a44810ec", "url": "https://github.com/kiegroup/jbpm/commit/1d45c0f871c0a06ace5a78abbe9d9b79a44810ec", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-26T09:01:51Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU5ODE3OQ==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430598179", "bodyText": "Reorder the modifiers to comply with the Java Language Specification", "author": "gmunozfe", "createdAt": "2020-05-26T17:52:20Z", "path": "jbpm-flow/src/main/java/org/jbpm/workflow/instance/impl/NodeInstanceImpl.java", "diffHunk": "@@ -78,12 +82,14 @@\n     protected int slaCompliance = ProcessInstance.SLA_NA;\n     protected Date slaDueDate;\n     protected long slaTimerId = -1;\n-    protected boolean aborted = false;\n+    private boolean aborted = false;\n+    transient protected CancelType cancelType;", "originalCommit": "1d45c0f871c0a06ace5a78abbe9d9b79a44810ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDkwMDA0Ng==", "url": "https://github.com/kiegroup/jbpm/pull/1641#discussion_r430900046", "bodyText": "ok", "author": "elguardian", "createdAt": "2020-05-27T07:06:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU5ODE3OQ=="}], "type": "inlineReview"}, {"oid": "6af9eeb510dff021ab9d45d252657ff0eab18493", "url": "https://github.com/kiegroup/jbpm/commit/6af9eeb510dff021ab9d45d252657ff0eab18493", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-27T07:09:36Z", "type": "commit"}, {"oid": "6af9eeb510dff021ab9d45d252657ff0eab18493", "url": "https://github.com/kiegroup/jbpm/commit/6af9eeb510dff021ab9d45d252657ff0eab18493", "message": "[JBPM-9129] Start process without triggering a start node", "committedDate": "2020-05-27T07:09:36Z", "type": "forcePushed"}]}