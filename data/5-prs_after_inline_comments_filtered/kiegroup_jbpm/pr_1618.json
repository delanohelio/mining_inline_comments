{"pr_number": 1618, "pr_title": "[JBPM-9073] Unique index error when correlationKey name is set to null", "pr_createdAt": "2020-03-26T07:22:54Z", "pr_url": "https://github.com/kiegroup/jbpm/pull/1618", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4NzUxMA==", "url": "https://github.com/kiegroup/jbpm/pull/1618#discussion_r398387510", "bodyText": "Quick question, there is no need to add any CorrelationPropertyInfo object to the correlactionKey object? Just asking as I see we were doing that before.\nOtherwise, looks great to me. I will wait for the CI to complete and then check it on the db certification matrix.\nNice one @elguardian", "author": "afalhambra", "createdAt": "2020-03-26T08:21:18Z", "path": "jbpm-persistence/jbpm-persistence-jpa/src/main/java/org/jbpm/persistence/processinstance/JPAProcessInstanceManager.java", "diffHunk": "@@ -87,8 +90,7 @@ public void addProcessInstance(ProcessInstance processInstance, CorrelationKey c\n         processInstanceInfo.updateLastReadDate();\n         // generate correlation key if not given which is same as process instance id to keep uniqueness \n         if (correlationKey == null) {\n-            correlationKey = new CorrelationKeyInfo();\n-            ((CorrelationKeyInfo)correlationKey).addProperty(new CorrelationPropertyInfo(null, processInstanceInfo.getId().toString()));\n+            correlationKey = (CorrelationKeyInfo) correlationKeyFactory.newCorrelationKey(processInstanceInfo.getId().toString());", "originalCommit": "3fe1fe951fc75a2b089ec4eaa219c4368885badb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTIwMzIyNA==", "url": "https://github.com/kiegroup/jbpm/pull/1618#discussion_r399203224", "bodyText": "it si equivalente code to https://github.com/kiegroup/jbpm/blob/master/jbpm-persistence/jbpm-persistence-jpa/src/main/java/org/jbpm/persistence/correlation/JPACorrelationKeyFactory.java#L32", "author": "elguardian", "createdAt": "2020-03-27T11:36:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODM4NzUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODYyMjY2NA==", "url": "https://github.com/kiegroup/jbpm/pull/1618#discussion_r398622664", "bodyText": "Cast to CorrelationKeyInfo is not needed", "author": "afalhambra", "createdAt": "2020-03-26T14:36:44Z", "path": "jbpm-persistence/jbpm-persistence-jpa/src/main/java/org/jbpm/persistence/processinstance/JPAProcessInstanceManager.java", "diffHunk": "@@ -87,8 +90,7 @@ public void addProcessInstance(ProcessInstance processInstance, CorrelationKey c\n         processInstanceInfo.updateLastReadDate();\n         // generate correlation key if not given which is same as process instance id to keep uniqueness \n         if (correlationKey == null) {\n-            correlationKey = new CorrelationKeyInfo();\n-            ((CorrelationKeyInfo)correlationKey).addProperty(new CorrelationPropertyInfo(null, processInstanceInfo.getId().toString()));\n+            correlationKey = (CorrelationKeyInfo) correlationKeyFactory.newCorrelationKey(processInstanceInfo.getId().toString());", "originalCommit": "3fe1fe951fc75a2b089ec4eaa219c4368885badb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a02496afc3f7e7023142cd83c38caa484f95ef2b", "url": "https://github.com/kiegroup/jbpm/commit/a02496afc3f7e7023142cd83c38caa484f95ef2b", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation", "committedDate": "2020-03-27T11:37:36Z", "type": "forcePushed"}, {"oid": "00a425db74e629528a3627347dea39e9387652c1", "url": "https://github.com/kiegroup/jbpm/commit/00a425db74e629528a3627347dea39e9387652c1", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation", "committedDate": "2020-03-30T15:31:38Z", "type": "commit"}, {"oid": "00a425db74e629528a3627347dea39e9387652c1", "url": "https://github.com/kiegroup/jbpm/commit/00a425db74e629528a3627347dea39e9387652c1", "message": "[JBPM-9073] Unique index error when correlationKey name is set to null\n\nname in correlation key does not reflect the external form. Change to switch factory\nimplementation", "committedDate": "2020-03-30T15:31:38Z", "type": "forcePushed"}]}