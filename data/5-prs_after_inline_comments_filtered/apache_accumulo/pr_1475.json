{"pr_number": 1475, "pr_title": "fixes #1474: Option to leave cloned tables offline", "pr_createdAt": "2020-01-14T20:45:42Z", "pr_url": "https://github.com/apache/accumulo/pull/1475", "timeline": [{"oid": "bf46842032e04bbb85f87811e5bae633c3e3974b", "url": "https://github.com/apache/accumulo/commit/bf46842032e04bbb85f87811e5bae633c3e3974b", "message": "fixes #1474: Option to leave cloned tables offline\n* Added an optional keepOffline option to TableOperations.clone\n* Updated the shell clone command with a -k option\n* Updated the CloneTestIT to test the keepOffline option", "committedDate": "2020-01-14T20:47:31Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODk4MA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366578980", "bodyText": "Probably better to name the option \"o\", to be consistent with other offline commands.  For example, that is what CreateTableCommand uses in 2.X", "author": "milleruntime", "createdAt": "2020-01-14T21:23:03Z", "path": "shell/src/main/java/org/apache/accumulo/shell/commands/CloneTableCommand.java", "diffHunk": "@@ -99,6 +105,8 @@ public Options getOptions() {\n     noFlushOption =\n         new Option(\"nf\", \"noFlush\", false, \"do not flush table data in memory before cloning.\");\n     o.addOption(noFlushOption);\n+    keepOfflineOption =\n+        new Option(\"k\", \"keepOffline\", false, \"do not bring the table online after cloning.\");", "originalCommit": "bf46842032e04bbb85f87811e5bae633c3e3974b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwMjM5Nw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366602397", "bodyText": "done", "author": "ivakegg", "createdAt": "2020-01-14T22:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODk4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366572641", "bodyText": "need a since 2.1 javadoc tag", "author": "keith-turner", "createdAt": "2020-01-14T21:07:50Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -433,6 +433,33 @@ void clone(String srcTableName, String newTableName, boolean flush,\n       Map<String,String> propertiesToSet, Set<String> propertiesToExclude) throws AccumuloException,\n       AccumuloSecurityException, TableNotFoundException, TableExistsException;\n \n+  /**\n+   * Clone a table from an existing table. The cloned table will have the same data as the source\n+   * table it was created from. After cloning, the two tables can mutate independently. Initially\n+   * the cloned table should not use any extra space, however as the source table and cloned table\n+   * major compact extra space will be used by the clone.\n+   *\n+   * Initially the cloned table is only readable and writable by the user who created it.\n+   *\n+   * @param srcTableName\n+   *          the table to clone\n+   * @param newTableName\n+   *          the name of the clone\n+   * @param flush\n+   *          determines if memory is flushed in the source table before cloning.\n+   * @param propertiesToSet\n+   *          the sources tables properties are copied, this allows overriding of those properties\n+   * @param propertiesToExclude\n+   *          do not copy these properties from the source table, just revert to system defaults\n+   * @param keepOffline\n+   *          do not bring the table online after cloning\n+   */", "originalCommit": "bf46842032e04bbb85f87811e5bae633c3e3974b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4Mjg5MQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366582891", "bodyText": "I think he is targeting the 1.9 branch, which will be 1.10.  So I guess it should be a since 1.10 javadoc tag, which may be the only one haha.", "author": "milleruntime", "createdAt": "2020-01-14T21:31:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU4NTc1Mw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366585753", "bodyText": "Interesting, API in 1.10, not in 2.0, and in 2.1.", "author": "keith-turner", "createdAt": "2020-01-14T21:38:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwMjU4OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366602588", "bodyText": "so what should I do in this case?", "author": "ivakegg", "createdAt": "2020-01-14T22:18:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwNjAwNg==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366606006", "bodyText": "I am not sure... maybe it could be @since 1.10 2.1.0", "author": "keith-turner", "createdAt": "2020-01-14T22:26:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzcyNzg3MQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r367727871", "bodyText": "@since 1.10.0 and 2.1.0 works. Or, since we don't generally add new APIs in bugfix/patch releases, it might suffice to put @since 1.10 and 2.1", "author": "ctubbsii", "createdAt": "2020-01-17T01:12:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY3Mzk0Mw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r370673943", "bodyText": "will do", "author": "ivakegg", "createdAt": "2020-01-24T14:53:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3MjY0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366578323", "bodyText": "Would be nice to create a simple class for clone configuration so in the future we do not need to add more overloaded methods.  Something like the following.\n/**\n * @since 2.1.0\n */\nvoid clone(String srcTableName, String newTableName, CloneConfiguration config);\nCould possibly have the following API for CloneConfiguration.\n/**\n * @since 2.1.0\n */\npublic class CloneConfiguration {\n  Map<String,String> getPropertiesToSet();\n\n  Set<String> getPropertiesToExclude();\n\n  boolean flush();\n\n  InitialTableState getInitialState();\n\n  /**\n   * @since 2.1.0\n   */\n  public static interface Builder {\n\n    /**\n     * props to set on the clone. If not set defaults to empty map.\n     */\n    Builder setProperties(Map<String,String> props);\n\n    /**\n     * Props to exclude form the source table.  If not set defaults to empty set.\n     * \n     */\n    Builder excludeProperties(Set<String> props);\n\n    /**\n     * The initial table state for the clone. If not set defaults to ONLINE.\n     */\n    Builder setInitialTableState(InitialTableState init);\n\n    /**\n     * Determines if source tables in memory data is flushed before cloning. Unflushed data will not be in clone.  If not set defaults to true.\n     */\n    Builder setFlush(boolean flush);\n\n    // builds an immutable CloneConfiguration\n    CloneConfiguration build();\n  }\n\n  public static Builder builder() {\n    // TODO return a new builder obj that is not visible in the public API.. see ScanDirectivesImpl\n    // for an example of simple way to implement\n    return null;\n  }\n}", "author": "keith-turner", "createdAt": "2020-01-14T21:21:25Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/TableOperations.java", "diffHunk": "@@ -433,6 +433,33 @@ void clone(String srcTableName, String newTableName, boolean flush,\n       Map<String,String> propertiesToSet, Set<String> propertiesToExclude) throws AccumuloException,\n       AccumuloSecurityException, TableNotFoundException, TableExistsException;\n \n+  /**\n+   * Clone a table from an existing table. The cloned table will have the same data as the source\n+   * table it was created from. After cloning, the two tables can mutate independently. Initially\n+   * the cloned table should not use any extra space, however as the source table and cloned table\n+   * major compact extra space will be used by the clone.\n+   *\n+   * Initially the cloned table is only readable and writable by the user who created it.\n+   *\n+   * @param srcTableName\n+   *          the table to clone\n+   * @param newTableName\n+   *          the name of the clone\n+   * @param flush\n+   *          determines if memory is flushed in the source table before cloning.\n+   * @param propertiesToSet\n+   *          the sources tables properties are copied, this allows overriding of those properties\n+   * @param propertiesToExclude\n+   *          do not copy these properties from the source table, just revert to system defaults\n+   * @param keepOffline\n+   *          do not bring the table online after cloning\n+   */\n+\n+  void clone(String srcTableName, String newTableName, boolean flush,", "originalCommit": "bf46842032e04bbb85f87811e5bae633c3e3974b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjYwMjczNQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r366602735", "bodyText": "I like it, but perhaps I do this only in the 2.1 line?", "author": "ivakegg", "createdAt": "2020-01-14T22:18:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzcyODg3Mw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r367728873", "bodyText": "Keeping the change minimal in 1.x is a nice goal, but adding an overloaded method now, that we won't need in 2.1 because the builder is added to 2.1 seems to only add unnecessary bloat. It would probably make sense to add the builder for both 1.10 and 2.1, or only add this entire feature to 2.1, so we never need to add the overloaded version of the method anywhere.", "author": "ctubbsii", "createdAt": "2020-01-17T01:17:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTEyMjg5OQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r369122899", "bodyText": "I agree.  There shouldn't be anything in this change that can't go into 1.10 (now that it is java 1.8).  It should then be fairly easy to merge forward and no need for #1476", "author": "milleruntime", "createdAt": "2020-01-21T16:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY3NTI2OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r370675268", "bodyText": "ok, adding into the 1.10 line.  Change will be coming soon.", "author": "ivakegg", "createdAt": "2020-01-24T14:55:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQxNzkxMA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371417910", "bodyText": "@keith-turner : I have implemented a CloneConfiguration and CloneConfigurationImpl.  However I left the impl public to enable creating a new instance in the CloneConfiguration.builder() implementation.  Looking at your ScanDirectives.builder(), it appears to always return the same instance of a builder and hence the configuration object.  Hence that is really not usable across threads.  Was that intentional?", "author": "ivakegg", "createdAt": "2020-01-27T18:50:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ0MDMzMw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371440333", "bodyText": "FYI ScanDirectives were added in #1440", "author": "milleruntime", "createdAt": "2020-01-27T19:35:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQ5OTUyOA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371499528", "bodyText": "@ivakegg I think I figured out what is going on with the ScanDirectives.builder()... the setters in DefaultScanDirectives will return a new object of the parent class.\nreturn new ScanDirectivesImpl().setExecutorName(name);\nSo the builder will always return DefaultScanDirectives first with the builder() method and then only if something needs to be set return a new ScanDirectivesImpl object.", "author": "milleruntime", "createdAt": "2020-01-27T21:44:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgxOTY1OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371819658", "bodyText": "Ah, I see it now.  So should I change to the same pattern for the builder()?  I guess I would at least be able to make the CloneConfigurationImpl package private if I did but I am not sure it is worth the extra class.", "author": "ivakegg", "createdAt": "2020-01-28T14:04:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTgzOTg5NA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371839894", "bodyText": "The pattern I chose for ScanDirectives builder is complex because I thought it would be called very frequently and wanted it to be efficient.  For CloneConfiguration builder, I don't think efficiency would be a concern so personally I would go with the simplest implementation.", "author": "keith-turner", "createdAt": "2020-01-28T14:37:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg0OTUwMw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371849503", "bodyText": "OK, then I will leave it as is.  Thanks @keith-turner.", "author": "ivakegg", "createdAt": "2020-01-28T14:52:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NjU3ODMyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA0Mjg0Mg==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r367042842", "bodyText": "keepOfflineOption wasn't added to 'o' so it won't show up on the shell command line as an option.", "author": "Manno15", "createdAt": "2020-01-15T18:42:37Z", "path": "shell/src/main/java/org/apache/accumulo/shell/commands/CloneTableCommand.java", "diffHunk": "@@ -99,6 +105,8 @@ public Options getOptions() {\n     noFlushOption =\n         new Option(\"nf\", \"noFlush\", false, \"do not flush table data in memory before cloning.\");\n     o.addOption(noFlushOption);\n+    keepOfflineOption =\n+        new Option(\"o\", \"offline\", false, \"do not bring the table online after cloning.\");", "originalCommit": "c426c3993f67da13fb723db1978be2b5d6428e30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczMTA1OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r367731058", "bodyText": "This could be tested with ShellServerIT", "author": "ctubbsii", "createdAt": "2020-01-17T01:27:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA0Mjg0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY3NjMwNg==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r370676306", "bodyText": "doh", "author": "ivakegg", "createdAt": "2020-01-24T14:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzA0Mjg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczMDc2Nw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r367730767", "bodyText": "INFO-only: The standard built-in Java exception here is UnsupportedOperationException, not the commons-lang subclass. This is fine for consistency with the rest of the class, but it's a bad idea to use the commons-lang version in general (especially since it has been added and removed there, so it depends on what version of the library you're using). We replaced all these occurrences that in the 2.x branch when we switched to commons-lang3.", "author": "ctubbsii", "createdAt": "2020-01-17T01:25:45Z", "path": "core/src/main/java/org/apache/accumulo/core/client/mock/MockTableOperations.java", "diffHunk": "@@ -474,6 +474,14 @@ public void clone(String srcTableName, String newTableName, boolean flush,\n     throw new NotImplementedException();\n   }\n \n+  @Override\n+  public void clone(String srcTableName, String newTableName, boolean flush,\n+      Map<String,String> propertiesToSet, Set<String> propertiesToExclude, boolean keepOffline)\n+      throws AccumuloException, AccumuloSecurityException, TableNotFoundException,\n+      TableExistsException {\n+    throw new NotImplementedException();", "originalCommit": "c426c3993f67da13fb723db1978be2b5d6428e30", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDY3NTc0OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r370675748", "bodyText": "ok, I will have to remember this when I merge into 2.1.", "author": "ivakegg", "createdAt": "2020-01-24T14:56:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczMDc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDc4OTI0OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r370789248", "bodyText": "Actually there is no MockTableOperations in 2.1, so this is a moot point.", "author": "ivakegg", "createdAt": "2020-01-24T18:54:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NzczMDc2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NTg1MQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371265851", "bodyText": "The Impl class should be in the client.impl package.", "author": "milleruntime", "createdAt": "2020-01-27T14:21:12Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/CloneConfigurationImpl.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.client.admin;", "originalCommit": "fe4314d1c4531ef54185ef47770fece5ec97ddae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM4ODk1OA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371388958", "bodyText": "ah, ok", "author": "ivakegg", "createdAt": "2020-01-27T17:50:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2NTg1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2OTQ2NQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371269465", "bodyText": "This method should be in the CloneConfiguration interface so users don't need to touch the Impl class.  With Java 1.8 you can make this a default method too.", "author": "milleruntime", "createdAt": "2020-01-27T14:27:25Z", "path": "core/src/main/java/org/apache/accumulo/core/client/admin/CloneConfigurationImpl.java", "diffHunk": "@@ -0,0 +1,123 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one\n+ * or more contributor license agreements.  See the NOTICE file\n+ * distributed with this work for additional information\n+ * regarding copyright ownership.  The ASF licenses this file\n+ * to you under the Apache License, Version 2.0 (the\n+ * \"License\"); you may not use this file except in compliance\n+ * with the License.  You may obtain a copy of the License at\n+ *\n+ *   http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing,\n+ * software distributed under the License is distributed on an\n+ * \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\n+ * KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations\n+ * under the License.\n+ */\n+package org.apache.accumulo.core.client.admin;\n+\n+import java.util.Collections;\n+import java.util.Map;\n+import java.util.Set;\n+\n+import com.google.common.base.Preconditions;\n+\n+/**\n+ * A {@link CloneConfiguration} implementation which also implements the builder thereof\n+ *\n+ * @since 1.10 and 2.1\n+ */\n+public class CloneConfigurationImpl implements CloneConfiguration, CloneConfiguration.Builder {\n+\n+  // The purpose of this is to allow building an immutable CloneConfiguration object without\n+  // creating\n+  // separate Builder and CloneConfiguration objects. This is done to reduce object creation and\n+  // copying. This could easily be changed to two objects without changing the interfaces.\n+  private boolean built = false;\n+\n+  // determines if memory is flushed in the source table before cloning.\n+  private boolean flush = true;\n+\n+  // the sources table properties are copied, this allows overriding of those properties\n+  private Map<String,String> propertiesToSet = null;\n+\n+  // do not copy these properties from the source table, just revert to system defaults\n+  private Set<String> propertiesToExclude = null;\n+\n+  // do not bring the table online after cloning\n+  private boolean keepOffline = false;\n+\n+  private CloneConfigurationImpl() {}\n+\n+  public boolean isFlush() {\n+    Preconditions.checkState(built);\n+    return flush;\n+  }\n+\n+  public Map<String,String> getPropertiesToSet() {\n+    Preconditions.checkState(built);\n+    return (propertiesToSet == null ? Collections.<String,String>emptyMap()\n+        : Collections.unmodifiableMap(propertiesToSet));\n+  }\n+\n+  public Set<String> getPropertiesToExclude() {\n+    Preconditions.checkState(built);\n+    return (propertiesToExclude == null ? Collections.<String>emptySet()\n+        : Collections.unmodifiableSet(propertiesToExclude));\n+  }\n+\n+  public boolean isKeepOffline() {\n+    Preconditions.checkState(built);\n+    return keepOffline;\n+  }\n+\n+  @Override\n+  public Builder setFlush(boolean flush) {\n+    Preconditions.checkState(!built);\n+    this.flush = flush;\n+    return this;\n+  }\n+\n+  @Override\n+  public Builder setPropertiesToSet(Map<String,String> propertiesToSet) {\n+    Preconditions.checkState(!built);\n+    this.propertiesToSet = propertiesToSet;\n+    return this;\n+  }\n+\n+  @Override\n+  public Builder setPropertiesToExclude(Set<String> propertiesToExclude) {\n+    Preconditions.checkState(!built);\n+    this.propertiesToExclude = propertiesToExclude;\n+    return this;\n+  }\n+\n+  @Override\n+  public Builder setKeepOffline(boolean keepOffline) {\n+    Preconditions.checkState(!built);\n+    this.keepOffline = keepOffline;\n+    return this;\n+  }\n+\n+  @Override\n+  public CloneConfiguration build() {\n+    Preconditions.checkState(!built);\n+    built = true;\n+    return this;\n+  }\n+\n+  @Override\n+  public String toString() {\n+    return \"{flush=\" + flush + \", propertiesToSet=\" + propertiesToSet + \", propertiesToExclude=\"\n+        + propertiesToExclude + \", keepOffline=\" + keepOffline + \", built=\" + built + \"}\";\n+  }\n+\n+  /**\n+   * @return a {@link CloneConfiguration} builder\n+   */\n+  public static CloneConfiguration.Builder builder() {", "originalCommit": "fe4314d1c4531ef54185ef47770fece5ec97ddae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM4OTgxNg==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371389816", "bodyText": "If the pom was not forcing 1.7 source compatibility, then I would.  In the top level pom of the 1.9 branch I see:\n<maven.compiler.release>7</maven.compiler.release>\n<maven.compiler.source>1.7</maven.compiler.source>\n<maven.compiler.target>1.7</maven.compiler.target>", "author": "ivakegg", "createdAt": "2020-01-27T17:51:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2OTQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM5MzQ3Mw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371393473", "bodyText": "Probably need to update your branch... I added Java 1.8 in 9c957ab for the 1.10 release.", "author": "milleruntime", "createdAt": "2020-01-27T17:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2OTQ2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTQwNDczOQ==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371404739", "bodyText": "I see it now.... ok moving static method into interface", "author": "ivakegg", "createdAt": "2020-01-27T18:23:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI2OTQ2NQ=="}], "type": "inlineReview"}, {"oid": "2d2945ef9d7a81efc8aade452e1cea4ade28b0d6", "url": "https://github.com/apache/accumulo/commit/2d2945ef9d7a81efc8aade452e1cea4ade28b0d6", "message": "re #1474: Moved builder method into the interface.", "committedDate": "2020-01-27T18:52:05Z", "type": "forcePushed"}, {"oid": "dc40d079edad6098a7c04ff0147a1bd9b4cdbf17", "url": "https://github.com/apache/accumulo/commit/dc40d079edad6098a7c04ff0147a1bd9b4cdbf17", "message": "fixes #1474: Option to leave cloned tables offline\n* Added an optional keepOffline option to TableOperations.clone via a CloneConfiguration\n* Updated the shell clone command with a -o option\n* Updated the CloneTestIT to test the keepOffline option\n* Updated the ShellServerIT to test the -o option", "committedDate": "2020-01-28T14:57:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2MjAxMw==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371862013", "bodyText": "Purely pedantic, so I'm sure this is ignorable - consider naming this assertTableState because it actually performs the assertion and will fail if the assertion fails.", "author": "drewfarris", "createdAt": "2020-01-28T15:11:38Z", "path": "test/src/main/java/org/apache/accumulo/test/functional/CloneTestIT.java", "diffHunk": "@@ -121,6 +125,12 @@ public void testProps() throws Exception {\n \n   }\n \n+  private void checkTableState(String table, Connector c, TableState expected) throws TException {", "originalCommit": "dc40d079edad6098a7c04ff0147a1bd9b4cdbf17", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2NTM5MA==", "url": "https://github.com/apache/accumulo/pull/1475#discussion_r371865390", "bodyText": "done", "author": "ivakegg", "createdAt": "2020-01-28T15:16:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTg2MjAxMw=="}], "type": "inlineReview"}, {"oid": "7f274131a994ee7941c1bac3e5806bec4275e347", "url": "https://github.com/apache/accumulo/commit/7f274131a994ee7941c1bac3e5806bec4275e347", "message": "fixes #1474: Option to leave cloned tables offline\n* Added an optional keepOffline option to TableOperations.clone via a CloneConfiguration\n* Updated the shell clone command with a -o option\n* Updated the CloneTestIT to test the keepOffline option\n* Updated the ShellServerIT to test the -o option", "committedDate": "2020-01-28T15:15:06Z", "type": "commit"}, {"oid": "7f274131a994ee7941c1bac3e5806bec4275e347", "url": "https://github.com/apache/accumulo/commit/7f274131a994ee7941c1bac3e5806bec4275e347", "message": "fixes #1474: Option to leave cloned tables offline\n* Added an optional keepOffline option to TableOperations.clone via a CloneConfiguration\n* Updated the shell clone command with a -o option\n* Updated the CloneTestIT to test the keepOffline option\n* Updated the ShellServerIT to test the -o option", "committedDate": "2020-01-28T15:15:06Z", "type": "forcePushed"}]}