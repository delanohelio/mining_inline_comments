{"pr_number": 1531, "pr_title": "Bump ZooKeeper dependency to 3.5.7", "pr_createdAt": "2020-02-25T01:24:52Z", "pr_url": "https://github.com/apache/accumulo/pull/1531", "timeline": [{"oid": "65b4757992b3823207a6c1ad85d64644fef34c00", "url": "https://github.com/apache/accumulo/commit/65b4757992b3823207a6c1ad85d64644fef34c00", "message": "WIP - bump to ZK 3.5.7\n\nThis work is stalled due to https://issues.apache.org/jira/browse/ZOOKEEPER-3737\nIt is possible to do this, but one of the benefits of this was to try to\neliminate the transitive dependency on log4j 1.2. ZOOKEEPER-3737 seems\nto prohibit that, at least for now.", "committedDate": "2020-02-25T01:22:15Z", "type": "commit"}, {"oid": "b7ff218e2b234d2904a3b0c822ef24e80cbfda52", "url": "https://github.com/apache/accumulo/commit/b7ff218e2b234d2904a3b0c822ef24e80cbfda52", "message": "Make minicluster/zookeeper work without log4j 1.2\n\n* Disable log4j 1.2 jmx support in ZooKeeper when minicluster runs it\n* Whitelist 'ruok' 4lw in minicluster zoo.cfg\n* Add missing case statements for new ZK event types in\n  DistributedWorkQueue\n* Close unclosed ZooKeeper instances in test code", "committedDate": "2020-02-26T03:40:40Z", "type": "commit"}, {"oid": "48e239b63895ce24c99d5d6609401a55e95af71c", "url": "https://github.com/apache/accumulo/commit/48e239b63895ce24c99d5d6609401a55e95af71c", "message": "Disable ZK admin server in minicluster", "committedDate": "2020-02-26T04:45:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ5NjU3OQ==", "url": "https://github.com/apache/accumulo/pull/1531#discussion_r384496579", "bodyText": "Does disabling this avoid executing the code that calls log4j v1?", "author": "keith-turner", "createdAt": "2020-02-26T13:39:24Z", "path": "minicluster/src/main/java/org/apache/accumulo/miniclusterImpl/MiniAccumuloClusterImpl.java", "diffHunk": "@@ -404,6 +404,7 @@ public MiniAccumuloClusterImpl(MiniAccumuloConfigImpl config) throws IOException\n       zooCfg.setProperty(\"maxClientCnxns\", \"1000\");\n       zooCfg.setProperty(\"dataDir\", config.getZooKeeperDir().getAbsolutePath());\n       zooCfg.setProperty(\"4lw.commands.whitelist\", \"ruok\");\n+      zooCfg.setProperty(\"admin.enableServer\", \"false\");", "originalCommit": "48e239b63895ce24c99d5d6609401a55e95af71c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ5ODEwMw==", "url": "https://github.com/apache/accumulo/pull/1531#discussion_r384498103", "bodyText": "Nevermind I see the discussion on the zookeeper issue.", "author": "keith-turner", "createdAt": "2020-02-26T13:42:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ5NjU3OQ=="}], "type": "inlineReview"}, {"oid": "ed459cd77cba482b2c970afc231ec532dc5f7633", "url": "https://github.com/apache/accumulo/commit/ed459cd77cba482b2c970afc231ec532dc5f7633", "message": "Enable another 4lw for WatchTheWatchCountIT", "committedDate": "2020-02-26T15:17:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzM5OA==", "url": "https://github.com/apache/accumulo/pull/1531#discussion_r384757398", "bodyText": "Would be good to make more use of this being autoclosable but that could be a follow on ticket.", "author": "milleruntime", "createdAt": "2020-02-26T20:50:55Z", "path": "test/src/test/java/org/apache/accumulo/test/fate/zookeeper/ZooLockTest.java", "diffHunk": "@@ -274,42 +274,43 @@ public void testUnexpectedEvent() throws Exception {\n     String parent = \"/zltest-\" + this.hashCode() + \"-l\" + pdCount.incrementAndGet();\n \n     ConnectedWatcher watcher = new ConnectedWatcher();\n-    ZooKeeper zk = new ZooKeeper(accumulo.getZooKeepers(), 30000, watcher);\n-    zk.addAuthInfo(\"digest\", \"accumulo:secret\".getBytes(UTF_8));\n+    try (ZooKeeper zk = new ZooKeeper(accumulo.getZooKeepers(), 30000, watcher)) {", "originalCommit": "ed459cd77cba482b2c970afc231ec532dc5f7633", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc3ODIwMA==", "url": "https://github.com/apache/accumulo/pull/1531#discussion_r384778200", "bodyText": "I think these might be the only places we could use try-with-resources (I only fixed these because they generated warnings). But yes, separate issue, if there's anything else to be done with this.", "author": "ctubbsii", "createdAt": "2020-02-26T21:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzM5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc4MDk3Mg==", "url": "https://github.com/apache/accumulo/pull/1531#discussion_r384780972", "bodyText": "I looked again and it looks like this is the only use of this object other than ZooSession (where we are manually closing) so disregard.", "author": "milleruntime", "createdAt": "2020-02-26T21:36:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDc1NzM5OA=="}], "type": "inlineReview"}]}