{"pr_number": 1528, "pr_title": "Switch to Log4j2", "pr_createdAt": "2020-02-21T09:06:26Z", "pr_url": "https://github.com/apache/accumulo/pull/1528", "timeline": [{"oid": "030daa1d477b74e732a7aadc6c056041241d96c1", "url": "https://github.com/apache/accumulo/commit/030daa1d477b74e732a7aadc6c056041241d96c1", "message": "Update to log4j2\n\nFix #1514 Update pom.xml with log4j2 dependencies\n\n* Use slf4j bindings for log4j2\n* Keep log4j 1.2 jars for minicluster and test, because ZK needs it at runtime\n* Use log4j-1.2-api jar for log4j 1.2 dependencies for deprecated public\n  APIs that can't yet be removed (particularly in core/mapred stuffs)\n* Add disruptor jar to class path to support high-performance asynchronous loggers\n* Exclude transitive dependencies for log4j 1.2, for better control over\n  build class path, and to avoid multiple runtime slf4j bindings\n* Update assembly to include log4j2 jars, and to exclude log4j 1.2 jars\n\nFix #1515 Create new AccumuloMonitorAppender to send to REST endpoint\n\n* Remove unnecessary extra port configuration property for log4j\n  SocketServer endpoint in monitor\n* Update Monitor to store HTTP(s) URL for the service in ZK instead of\n  just host and port; remove redundant log4j service advertisement using\n  old log4j SocketServer port\n* Create new AccumuloMonitorAppender to read HTTP(s) URL from ZooCache,\n  on demand, and send logs as JSON to the REST endpoint at that URL\n* Fix extra slash in MonitorUtilTest\n* Replace previous LogService in monitor with simpler RecentLogs\n  implementation to cache received logs from REST endpoint\n* Simplify LogResource REST endpoints to use the RecentLogs APIs, with\n  new endpoint to receive POSTed logs as JSON, and clean up the\n  deduplication/counting/sanitizing code\n* Simplify StatusResource to get its info from the RecentLogs object\n* Update the web views to include logger names on the monitor page, and\n  to simplify passing of the optional stacktrace details\n\nFix #1516 Remove log4j1 config files and add log4j2 config files\n\n* Create basic log4j2 config files for Accumulo services and a default\n  config file for clients such as the shell\n* Update accumulo-env.sh to configure logging using high-performance\n  asynchronous loggers\n* Create service config file with console, rolling file, and monitor\n  appenders, as well as an example separate rolling file appender for\n  audit logs that can be easily toggled on\n* Create config file for console suitable for clients, especially the\n  shell, complete with color highlighting\n* Add config for periodic auto-reconfiguring of log4j without restarting\n  services (especially helpful as a substitute for the now defunct shell\n  option for 'debug on')", "committedDate": "2020-02-21T12:37:32Z", "type": "commit"}, {"oid": "030daa1d477b74e732a7aadc6c056041241d96c1", "url": "https://github.com/apache/accumulo/commit/030daa1d477b74e732a7aadc6c056041241d96c1", "message": "Update to log4j2\n\nFix #1514 Update pom.xml with log4j2 dependencies\n\n* Use slf4j bindings for log4j2\n* Keep log4j 1.2 jars for minicluster and test, because ZK needs it at runtime\n* Use log4j-1.2-api jar for log4j 1.2 dependencies for deprecated public\n  APIs that can't yet be removed (particularly in core/mapred stuffs)\n* Add disruptor jar to class path to support high-performance asynchronous loggers\n* Exclude transitive dependencies for log4j 1.2, for better control over\n  build class path, and to avoid multiple runtime slf4j bindings\n* Update assembly to include log4j2 jars, and to exclude log4j 1.2 jars\n\nFix #1515 Create new AccumuloMonitorAppender to send to REST endpoint\n\n* Remove unnecessary extra port configuration property for log4j\n  SocketServer endpoint in monitor\n* Update Monitor to store HTTP(s) URL for the service in ZK instead of\n  just host and port; remove redundant log4j service advertisement using\n  old log4j SocketServer port\n* Create new AccumuloMonitorAppender to read HTTP(s) URL from ZooCache,\n  on demand, and send logs as JSON to the REST endpoint at that URL\n* Fix extra slash in MonitorUtilTest\n* Replace previous LogService in monitor with simpler RecentLogs\n  implementation to cache received logs from REST endpoint\n* Simplify LogResource REST endpoints to use the RecentLogs APIs, with\n  new endpoint to receive POSTed logs as JSON, and clean up the\n  deduplication/counting/sanitizing code\n* Simplify StatusResource to get its info from the RecentLogs object\n* Update the web views to include logger names on the monitor page, and\n  to simplify passing of the optional stacktrace details\n\nFix #1516 Remove log4j1 config files and add log4j2 config files\n\n* Create basic log4j2 config files for Accumulo services and a default\n  config file for clients such as the shell\n* Update accumulo-env.sh to configure logging using high-performance\n  asynchronous loggers\n* Create service config file with console, rolling file, and monitor\n  appenders, as well as an example separate rolling file appender for\n  audit logs that can be easily toggled on\n* Create config file for console suitable for clients, especially the\n  shell, complete with color highlighting\n* Add config for periodic auto-reconfiguring of log4j without restarting\n  services (especially helpful as a substitute for the now defunct shell\n  option for 'debug on')", "committedDate": "2020-02-21T12:37:32Z", "type": "forcePushed"}, {"oid": "a06c8ebfa849d39b13e70bc1fec9879a20d667fd", "url": "https://github.com/apache/accumulo/commit/a06c8ebfa849d39b13e70bc1fec9879a20d667fd", "message": "Fix dependency analysis looking for log4j jar", "committedDate": "2020-02-21T14:01:04Z", "type": "commit"}, {"oid": "de9fe403dbf70c2a68ca29dd3a12f5053681433e", "url": "https://github.com/apache/accumulo/commit/de9fe403dbf70c2a68ca29dd3a12f5053681433e", "message": "Fix ITs and make log clearing use a dedicated endpoint", "committedDate": "2020-02-21T16:19:55Z", "type": "commit"}, {"oid": "2eab3fcc5c1da5f875433c21060be55068c8fe74", "url": "https://github.com/apache/accumulo/commit/2eab3fcc5c1da5f875433c21060be55068c8fe74", "message": "Fix #1529 Migrate log4j 1.2 test files to log4j2\n\nFix AuditMessageIT and directly convert existing log4j 1.2 configuration\nfiles to log4j2 format. No evaluation was done to update the files, only\ndirect conversion from previous behavior.", "committedDate": "2020-02-22T04:56:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0MjQxMg==", "url": "https://github.com/apache/accumulo/pull/1528#discussion_r383942412", "bodyText": "It looks like this property was only used in MiniAccumulo?", "author": "milleruntime", "createdAt": "2020-02-25T15:14:44Z", "path": "core/src/main/java/org/apache/accumulo/core/conf/Property.java", "diffHunk": "@@ -544,8 +544,6 @@\n       \"Properties in this category affect the behavior of the monitor web server.\"),\n   MONITOR_PORT(\"monitor.port.client\", \"9995\", PropertyType.PORT,\n       \"The listening port for the monitor's http service\"),\n-  MONITOR_LOG4J_PORT(\"monitor.port.log4j\", \"4560\", PropertyType.PORT,\n-      \"The listening port for the monitor's log4j logging collection.\"),", "originalCommit": "2eab3fcc5c1da5f875433c21060be55068c8fe74", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk2MDc3Mg==", "url": "https://github.com/apache/accumulo/pull/1528#discussion_r383960772", "bodyText": "Yes, though users could have used it, too. It's a NOOP now. The config property does nothing.", "author": "ctubbsii", "createdAt": "2020-02-25T15:42:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk0MjQxMg=="}], "type": "inlineReview"}]}