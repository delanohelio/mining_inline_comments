{"pr_number": 418, "pr_title": "NMA -390 Blockchain Identity Persistance", "pr_createdAt": "2020-05-27T20:09:14Z", "pr_url": "https://github.com/dashevo/dash-wallet/pull/418", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTQxMzYzNg==", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r431413636", "bodyText": "For some reason the listener added here was being called three times.  This resulted in three services being created.", "author": "HashEngineering", "createdAt": "2020-05-27T20:10:33Z", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -773,12 +789,31 @@ public void onCreate() {\n \n         peerDiscoveryList.add(dnsDiscovery);\n         updateAppWidget();\n+\n+        initViewModel();\n+    }\n+\n+    void initViewModel() {\n+\n         AppDatabase.getAppDatabase().blockchainStateDao().load().observe(this, new Observer<BlockchainState>() {\n             @Override\n             public void onChanged(BlockchainState blockchainState) {\n                 handleBlockchainStateNotification(blockchainState);\n             }\n         });\n+\n+        Wallet wallet = ((WalletApplication) getApplication()).getWallet();\n+        //wallet.addCreditFundingEventListener(Threading.SAME_THREAD, creditFundingTransactionEventListener);", "originalCommit": "f04482d751efc5b739e13f7681462754466b0d31", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "26167fc65a0245598ea4168286bf42e6836560d3", "url": "https://github.com/dashevo/dash-wallet/commit/26167fc65a0245598ea4168286bf42e6836560d3", "message": "Add ability to recover a username when rescanning blockchain", "committedDate": "2020-05-29T16:30:03Z", "type": "commit"}, {"oid": "b0397787fdd8277843ae90beabba7cdff0d1168a", "url": "https://github.com/dashevo/dash-wallet/commit/b0397787fdd8277843ae90beabba7cdff0d1168a", "message": "Add support for restoring the username from a recovery phrase", "committedDate": "2020-05-29T16:31:29Z", "type": "commit"}, {"oid": "b0397787fdd8277843ae90beabba7cdff0d1168a", "url": "https://github.com/dashevo/dash-wallet/commit/b0397787fdd8277843ae90beabba7cdff0d1168a", "message": "Add support for restoring the username from a recovery phrase", "committedDate": "2020-05-29T16:31:29Z", "type": "forcePushed"}, {"oid": "9dd5fb2c50a20bbdf17c57ea641ea665b52526df", "url": "https://github.com/dashevo/dash-wallet/commit/9dd5fb2c50a20bbdf17c57ea641ea665b52526df", "message": "Add \"restoring\" to save the type of operation (create / restore)", "committedDate": "2020-05-30T04:21:46Z", "type": "commit"}, {"oid": "e7cd98d508026627a80254d48a17743d8a896250", "url": "https://github.com/dashevo/dash-wallet/commit/e7cd98d508026627a80254d48a17743d8a896250", "message": "Add ability to restart a recover operation", "committedDate": "2020-05-30T04:23:58Z", "type": "commit"}, {"oid": "ad446974006366475428afbf12f13864809be7cb", "url": "https://github.com/dashevo/dash-wallet/commit/ad446974006366475428afbf12f13864809be7cb", "message": "Add simple DashPayProfile management to the database", "committedDate": "2020-05-30T04:24:45Z", "type": "commit"}, {"oid": "552cf7255cdf21746c496ea7e0274c6c5ce7f92e", "url": "https://github.com/dashevo/dash-wallet/commit/552cf7255cdf21746c496ea7e0274c6c5ce7f92e", "message": "Remove unnecessary code and imports", "committedDate": "2020-05-30T04:31:19Z", "type": "commit"}, {"oid": "ea9e9bef126fb1475c7b0e4c696871b23a79e3bf", "url": "https://github.com/dashevo/dash-wallet/commit/ea9e9bef126fb1475c7b0e4c696871b23a79e3bf", "message": "Merge branch 'evonet-develop' into blockchain-identity-persistance", "committedDate": "2020-05-30T08:59:31Z", "type": "commit"}, {"oid": "9421ac65587e8343a23ceef9b6073e0589c1502a", "url": "https://github.com/dashevo/dash-wallet/commit/9421ac65587e8343a23ceef9b6073e0589c1502a", "message": "Preventing kotlin NPE crash in CreateIdentityService.\nDisabled the ability to use existing username (it was ebanled for testing).\nAdded wake lock acquiring in CreateIdentityService to prevent from interrupting process by the system suspend.\nHide `Join DashPay` button during creation process.\nMerged `evonet-develop` into `blockchain-identity-persistance`.", "committedDate": "2020-05-30T09:27:30Z", "type": "commit"}, {"oid": "8d203b46937b27d370c378638a06da5179166b02", "url": "https://github.com/dashevo/dash-wallet/commit/8d203b46937b27d370c378638a06da5179166b02", "message": "Merge branch 'blockchain-identity-persistance' of http://github.com/dashevo/dash-wallet into blockchain-identity-persistance", "committedDate": "2020-05-30T10:41:59Z", "type": "commit"}, {"oid": "51289c74b24a487d454beb83178a0d24f0c72d9d", "url": "https://github.com/dashevo/dash-wallet/commit/51289c74b24a487d454beb83178a0d24f0c72d9d", "message": "Show 1 letter on avatar.  Hide avatar when there is no username", "committedDate": "2020-05-30T18:57:58Z", "type": "commit"}, {"oid": "9d0f0f4420d0623092cd92a2a41e7a2bf5417e03", "url": "https://github.com/dashevo/dash-wallet/commit/9d0f0f4420d0623092cd92a2a41e7a2bf5417e03", "message": "Remove dashpayprofile on reset", "committedDate": "2020-05-31T03:02:38Z", "type": "commit"}, {"oid": "628e9f2700050204dc34dadc7144dedbf38b77c6", "url": "https://github.com/dashevo/dash-wallet/commit/628e9f2700050204dc34dadc7144dedbf38b77c6", "message": "Fix logging of errors", "committedDate": "2020-05-31T03:17:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA==", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r432951780", "bodyText": "When resetting a wallet, this code does not appear to be executed.  Is it because we are using an executor? @tomasz-ludek\nPerhaps the app is restarted before this is executed.  When doing a rescan blockchain, this code is executed.", "author": "HashEngineering", "createdAt": "2020-05-31T14:17:51Z", "path": "wallet/src/de/schildbach/wallet/service/BlockchainServiceImpl.java", "diffHunk": "@@ -916,6 +930,15 @@ public void onDestroy() {\n                 log.info(\"removing wallet file and app data\");\n                 application.finalizeWipe();\n             }\n+            //Clear the blockchain identity\n+            executor.execute(new Runnable() {\n+                @Override\n+                public void run() {\n+                    //not sure when this will execute\n+                    AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n+                    AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n+                }\n+            });", "originalCommit": "628e9f2700050204dc34dadc7144dedbf38b77c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk3MjExMA==", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r432972110", "bodyText": "As discussed on Slack. It could be moved to the end of WalletApplication.finalizeWipe methode, like this:\nfinal Handler mainThreadHandler = new Handler();\nExecutors.newSingleThreadExecutor().execute(new Runnable() {\n    @Override\n    public void run() {\n        AppDatabase.getAppDatabase().blockchainIdentityDataDao().clear();\n        AppDatabase.getAppDatabase().dashPayProfileDao().clear();\n        mainThreadHandler.post(new Runnable() {\n            @Override\n            public void run() {\n                ProcessPhoenix.triggerRebirth(WalletApplication.this);\n            }\n        });\n    }\n});", "author": "tomasz-ludek", "createdAt": "2020-05-31T18:31:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzIwOTYzNw==", "url": "https://github.com/dashevo/dash-wallet/pull/418#discussion_r433209637", "bodyText": "abf080a\nthis code was working for me", "author": "HashEngineering", "createdAt": "2020-06-01T12:39:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjk1MTc4MA=="}], "type": "inlineReview"}, {"oid": "26496fafcba50fd03cfab2a9ea4280341ac255d2", "url": "https://github.com/dashevo/dash-wallet/commit/26496fafcba50fd03cfab2a9ea4280341ac255d2", "message": "Don't show avatar if there is no username", "committedDate": "2020-05-31T14:49:45Z", "type": "commit"}, {"oid": "0ff2704207c11681f11ae99df076deceb5462d57", "url": "https://github.com/dashevo/dash-wallet/commit/0ff2704207c11681f11ae99df076deceb5462d57", "message": "Remove databases when restoring from seed, file or creating new wallet", "committedDate": "2020-05-31T14:56:15Z", "type": "commit"}, {"oid": "9900b4f7663decf9910fbbf1bb8fbc3a674117f6", "url": "https://github.com/dashevo/dash-wallet/commit/9900b4f7663decf9910fbbf1bb8fbc3a674117f6", "message": "Hide the hello card (top item in history) after clicking on it", "committedDate": "2020-05-31T15:36:11Z", "type": "commit"}, {"oid": "6ee1ada6796182f119d40a03326d69d1ca0d2aed", "url": "https://github.com/dashevo/dash-wallet/commit/6ee1ada6796182f119d40a03326d69d1ca0d2aed", "message": "Changed color of the check marks during username validation to green.\nMinor refactoring.", "committedDate": "2020-06-01T11:02:36Z", "type": "commit"}, {"oid": "40c04f989e81f88a56ac572dab126c2e7d8b1f91", "url": "https://github.com/dashevo/dash-wallet/commit/40c04f989e81f88a56ac572dab126c2e7d8b1f91", "message": "Changed shades for green of the check marks during username validation.", "committedDate": "2020-06-01T11:09:23Z", "type": "commit"}, {"oid": "14167bb8e4c280fdcf49e892ea209a3e6b4256b2", "url": "https://github.com/dashevo/dash-wallet/commit/14167bb8e4c280fdcf49e892ea209a3e6b4256b2", "message": "Changed some messages when recovering the identity", "committedDate": "2020-06-01T11:37:49Z", "type": "commit"}, {"oid": "abf080a0abd2f695b9c389510137fcd3bdf669e6", "url": "https://github.com/dashevo/dash-wallet/commit/abf080a0abd2f695b9c389510137fcd3bdf669e6", "message": "Simplify the database removal step in finalize wipe", "committedDate": "2020-06-01T12:30:13Z", "type": "commit"}, {"oid": "4be4ac4c56abb55b4abb4df4a1604fd1dcff2651", "url": "https://github.com/dashevo/dash-wallet/commit/4be4ac4c56abb55b4abb4df4a1604fd1dcff2651", "message": "Remove comment about when a thread executes", "committedDate": "2020-06-01T12:51:09Z", "type": "commit"}, {"oid": "20f22a0bd5d312439f493087506b27e19eca457d", "url": "https://github.com/dashevo/dash-wallet/commit/20f22a0bd5d312439f493087506b27e19eca457d", "message": "Change comment about thread execution", "committedDate": "2020-06-01T12:57:08Z", "type": "commit"}]}