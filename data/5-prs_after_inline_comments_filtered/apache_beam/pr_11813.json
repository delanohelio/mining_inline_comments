{"pr_number": 11813, "pr_title": "[BEAM-10077] using filename + hash instead of UUID for staging name", "pr_createdAt": "2020-05-26T00:22:18Z", "pr_url": "https://github.com/apache/beam/pull/11813", "timeline": [{"oid": "1d84d00bcf20c8f7cbf43c33a8ce293f8167a9be", "url": "https://github.com/apache/beam/commit/1d84d00bcf20c8f7cbf43c33a8ce293f8167a9be", "message": "[BEAM-10077] using filename + hash instead of UUID for staging name", "committedDate": "2020-05-26T01:36:14Z", "type": "commit"}, {"oid": "1d84d00bcf20c8f7cbf43c33a8ce293f8167a9be", "url": "https://github.com/apache/beam/commit/1d84d00bcf20c8f7cbf43c33a8ce293f8167a9be", "message": "[BEAM-10077] using filename + hash instead of UUID for staging name", "committedDate": "2020-05-26T01:36:14Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUwNDI0MA==", "url": "https://github.com/apache/beam/pull/11813#discussion_r430504240", "bodyText": "Where are we setting the hashCoder for this path ? Also are we missing a unit test for this ?", "author": "chamikaramj", "createdAt": "2020-05-26T15:31:37Z", "path": "runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/Environments.java", "diffHunk": "@@ -264,6 +259,14 @@ public static Environment createProcessEnvironment(\n                   .build()\n                   .toByteString());\n         }\n+        if (stagedName == null) {\n+          stagedName = createStagingFileName(file, hashCode);", "originalCommit": "1d84d00bcf20c8f7cbf43c33a8ce293f8167a9be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU3NjU5OA==", "url": "https://github.com/apache/beam/pull/11813#discussion_r430576598", "bodyText": "I believe existing unit test covers this path. This is the path when a given path doesn't have special '=' character. In that case, we generate the staged name.", "author": "ihji", "createdAt": "2020-05-26T17:15:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUwNDI0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUwNTYzNg==", "url": "https://github.com/apache/beam/pull/11813#discussion_r430505636", "bodyText": "Seems like this is just reverting to old behavior. Why would these names being unique an issue ? Did the change break Dataflow somehow ?", "author": "chamikaramj", "createdAt": "2020-05-26T15:33:40Z", "path": "runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/DataflowRunner.java", "diffHunk": "@@ -211,8 +210,8 @@\n \n   @VisibleForTesting static final int GCS_UPLOAD_BUFFER_SIZE_BYTES_DEFAULT = 1024 * 1024;\n \n-  @VisibleForTesting static final String PIPELINE_FILE_FORMAT = \"pipeline-%s.pb\";\n-  @VisibleForTesting static final String DATAFLOW_GRAPH_FILE_FORMAT = \"dataflow_graph-%s.json\";\n+  @VisibleForTesting static final String PIPELINE_FILE_NAME = \"pipeline.pb\";", "originalCommit": "1d84d00bcf20c8f7cbf43c33a8ce293f8167a9be", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDU3OTUyMA==", "url": "https://github.com/apache/beam/pull/11813#discussion_r430579520", "bodyText": "In the previous PR, forBytesToStage only respected the target name as is so we needed to make the target name unique. Now forBytesToStage generates unique names by itself so we don't need to put UUID suffix manually.", "author": "ihji", "createdAt": "2020-05-26T17:20:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDUwNTYzNg=="}], "type": "inlineReview"}]}