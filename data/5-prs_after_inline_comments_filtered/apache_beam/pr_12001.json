{"pr_number": 12001, "pr_title": "[BEAM-10082] Remove dependency on java.xml.ws and remove deprecated MetricName methods", "pr_createdAt": "2020-06-12T16:00:13Z", "pr_url": "https://github.com/apache/beam/pull/12001", "timeline": [{"oid": "abfe85e4597e0ae9a75ea88a1715517c0a84c2ae", "url": "https://github.com/apache/beam/commit/abfe85e4597e0ae9a75ea88a1715517c0a84c2ae", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors.", "committedDate": "2020-06-12T16:33:52Z", "type": "forcePushed"}, {"oid": "9e045b1f4c21fa72278982909ea3c30777b17597", "url": "https://github.com/apache/beam/commit/9e045b1f4c21fa72278982909ea3c30777b17597", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors.", "committedDate": "2020-06-12T16:35:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzNjAwNA==", "url": "https://github.com/apache/beam/pull/12001#discussion_r440836004", "bodyText": "thanks for adding this missing javadoc", "author": "echauchot", "createdAt": "2020-06-16T13:09:44Z", "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -50,6 +49,12 @@ public MetricsHttpSink(MetricsOptions pipelineOptions) {\n     this.urlString = pipelineOptions.getMetricsHttpSinkUrl();\n   }\n \n+  /**\n+   * Writes the metricQueryResults via HTTP POST to metrics sink endpoint.\n+   *\n+   * @param metricQueryResults query results to write.\n+   * @throws Exception throws IOException for non-200 response from endpoint.\n+   */", "originalCommit": "9e045b1f4c21fa72278982909ea3c30777b17597", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxODcwNw==", "url": "https://github.com/apache/beam/pull/12001#discussion_r440918707", "bodyText": "You're welcome.", "author": "tysonjh", "createdAt": "2020-06-16T14:58:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzNjAwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDgzODU0Nw==", "url": "https://github.com/apache/beam/pull/12001#discussion_r440838547", "bodyText": "Agreed as there is no suitable http exception in java.net regular package. But please change the message to add more context \"Exception while writing metrics to MetricsHttpSink : expected HTTP 200 OK response but received \"", "author": "echauchot", "createdAt": "2020-06-16T13:13:31Z", "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -69,7 +74,7 @@ public void writeMetrics(MetricQueryResults metricQueryResults) throws Exception\n     }\n     int responseCode = connection.getResponseCode();\n     if (responseCode != 200) {\n-      throw new HTTPException(responseCode);\n+      throw new IOException(\"Expected OK 200 response but received: \" + responseCode);", "originalCommit": "9e045b1f4c21fa72278982909ea3c30777b17597", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxOTA2OQ==", "url": "https://github.com/apache/beam/pull/12001#discussion_r440919069", "bodyText": "These were deprecated.", "author": "tysonjh", "createdAt": "2020-06-16T14:59:09Z", "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -86,8 +93,8 @@ public MetricNameSerializer(Class<MetricName> t) {\n     public void serialize(MetricName value, JsonGenerator gen, SerializerProvider provider)\n         throws IOException {\n       gen.writeStartObject();\n-      gen.writeObjectField(\"name\", value.name());\n-      gen.writeObjectField(\"namespace\", value.namespace());", "originalCommit": "9e713d92e4b8454af1cd82028660b045a7c6f852", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY4MTkyOQ==", "url": "https://github.com/apache/beam/pull/12001#discussion_r441681929", "bodyText": "yes I replaced them with get* versions to simplify serialization code but they were re-introduced to be compatible with dataflow hosted engine which uses .name and .namespace which I could not know of because it is not opensource. Anyway good catch !  Dataflow is supposed to have migrated to .get* versions now, can you check ? If so we can remove the deprecated versions from the api.", "author": "echauchot", "createdAt": "2020-06-17T16:42:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxOTA2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3NTgxMA==", "url": "https://github.com/apache/beam/pull/12001#discussion_r441875810", "bodyText": "Got it, I was just doing some code cleaning as I went along. I've verified that removing the deprecated methods doesn't break anything and added that to this PR. I'll update the commit message as well.", "author": "tysonjh", "createdAt": "2020-06-17T22:51:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDkxOTA2OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4MjUwMw==", "url": "https://github.com/apache/beam/pull/12001#discussion_r440982503", "bodyText": "sed s/MetricsSinkHttp/MetricsHttpSink/", "author": "echauchot", "createdAt": "2020-06-16T16:26:05Z", "path": "runners/extensions-java/metrics/src/main/java/org/apache/beam/runners/extensions/metrics/MetricsHttpSink.java", "diffHunk": "@@ -74,7 +74,9 @@ public void writeMetrics(MetricQueryResults metricQueryResults) throws Exception\n     }\n     int responseCode = connection.getResponseCode();\n     if (responseCode != 200) {\n-      throw new IOException(\"Expected OK 200 response but received: \" + responseCode);\n+      throw new IOException(\n+          \"Expected HTTP 200 OK response while writing metrics to MetricsSinkHttp but received \"", "originalCommit": "9e713d92e4b8454af1cd82028660b045a7c6f852", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTg3NDY5OA==", "url": "https://github.com/apache/beam/pull/12001#discussion_r441874698", "bodyText": "Oops! Done.", "author": "tysonjh", "createdAt": "2020-06-17T22:47:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MDk4MjUwMw=="}], "type": "inlineReview"}, {"oid": "6499899072e294486de57d5fcc8392375ef1bac4", "url": "https://github.com/apache/beam/commit/6499899072e294486de57d5fcc8392375ef1bac4", "message": "[BEAM-10082] Remove dependency on java.xml.ws.\n\nJava 11 removed some Java EE modules. The dependency in MetricsHttpSink\nis for HttpException. Replace this instead with an IOException.\n\nfixup! Spotless errors.", "committedDate": "2020-06-19T17:15:06Z", "type": "commit"}, {"oid": "02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "url": "https://github.com/apache/beam/commit/02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "message": "Remove deprecated MetricName methods.\n\nMetricName.name() and MetricName.namespace() are no longer used by\nDataflow and can be safely removed. A typo is also fixed in\na MetricsHttpSink exception message.", "committedDate": "2020-06-19T17:15:06Z", "type": "commit"}, {"oid": "02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "url": "https://github.com/apache/beam/commit/02f0d9a0a6a0e483d49848d006e0c79b7e6af209", "message": "Remove deprecated MetricName methods.\n\nMetricName.name() and MetricName.namespace() are no longer used by\nDataflow and can be safely removed. A typo is also fixed in\na MetricsHttpSink exception message.", "committedDate": "2020-06-19T17:15:06Z", "type": "forcePushed"}]}