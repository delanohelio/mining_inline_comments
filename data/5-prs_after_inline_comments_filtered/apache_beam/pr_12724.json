{"pr_number": 12724, "pr_title": "Only encoding element residual when it's not null.", "pr_createdAt": "2020-08-28T23:36:00Z", "pr_url": "https://github.com/apache/beam/pull/12724", "timeline": [{"oid": "d8318789374299c716e5c96078058f7c6fca4624", "url": "https://github.com/apache/beam/commit/d8318789374299c716e5c96078058f7c6fca4624", "message": "Only encoding element residual when it's not null.", "committedDate": "2020-08-28T23:30:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5MTYwOQ==", "url": "https://github.com/apache/beam/pull/12724#discussion_r480291609", "bodyText": "Can't windowedSplitResult itself be null here?", "author": "ibzib", "createdAt": "2020-08-31T17:54:03Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -1642,43 +1642,45 @@ public Object restriction() {\n               .build());\n     }\n \n-    ByteString.Output primaryBytes = ByteString.newOutput();\n-    ByteString.Output residualBytes = ByteString.newOutput();\n-    try {\n-      fullInputCoder.encode(windowedSplitResult.getPrimarySplitRoot(), primaryBytes);\n-      fullInputCoder.encode(windowedSplitResult.getResidualSplitRoot(), residualBytes);\n-    } catch (IOException e) {\n-      throw new RuntimeException(e);\n+    if (windowedSplitResult.getResidualSplitRoot() != null) {", "originalCommit": "d8318789374299c716e5c96078058f7c6fca4624", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5NjI2MA==", "url": "https://github.com/apache/beam/pull/12724#discussion_r480296260", "bodyText": "windowedSplitResult can be null and it has been checked above https://github.com/apache/beam/blob/master/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java#L1579-L1588.\nI'm working on a refactor #12710, which will provide much more test coverage. Sorry for the inconvenience.", "author": "boyuanzz", "createdAt": "2020-08-31T18:02:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5MTYwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5ODM2OQ==", "url": "https://github.com/apache/beam/pull/12724#discussion_r480298369", "bodyText": "No worries. Please close this PR though if you don't think it's the best solution.", "author": "ibzib", "createdAt": "2020-08-31T18:06:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI5MTYwOQ=="}], "type": "inlineReview"}]}