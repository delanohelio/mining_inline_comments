{"pr_number": 12426, "pr_title": "[BEAM-7996] Add support for MapType and Nulls in container types for Python RowCoder", "pr_createdAt": "2020-07-30T18:34:46Z", "pr_url": "https://github.com/apache/beam/pull/12426", "timeline": [{"oid": "e850957ae3b7e6990cea32f76ce3645f5834a55e", "url": "https://github.com/apache/beam/commit/e850957ae3b7e6990cea32f76ce3645f5834a55e", "message": "Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-07-30T18:31:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzE5NDUyNw==", "url": "https://github.com/apache/beam/pull/12426#discussion_r463194527", "bodyText": "This change is necessary because ImmutableMap (as well as Collectors.toMap) does not allow null values, so it errors on the new test cases.", "author": "TheNeuralBit", "createdAt": "2020-07-30T18:36:05Z", "path": "runners/core-construction-java/src/test/java/org/apache/beam/runners/core/construction/CommonCoderTest.java", "diffHunk": "@@ -366,12 +368,15 @@ private static Object parseField(Object value, Schema.FieldType fieldType) {\n                 .map((element) -> parseField(element, fieldType.getCollectionElementType()))\n                 .collect(toImmutableList());\n       case MAP:\n-        Map<Object, Object> kvMap = (Map<Object, Object>) value;\n-        return kvMap.entrySet().stream()\n-            .collect(\n-                toImmutableMap(\n-                    (pair) -> parseField(pair.getKey(), fieldType.getMapKeyType()),\n-                    (pair) -> parseField(pair.getValue(), fieldType.getMapValueType())));\n+        Map<Object, Object> kvMap = new HashMap<>();\n+        ((Map<Object, Object>) value)\n+            .entrySet().stream()\n+                .forEach(\n+                    (entry) ->\n+                        kvMap.put(\n+                            parseField(entry.getKey(), fieldType.getMapKeyType()),\n+                            parseField(entry.getValue(), fieldType.getMapValueType())));\n+        return kvMap;", "originalCommit": "e850957ae3b7e6990cea32f76ce3645f5834a55e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "587dde57cbb2b0095a1fa04b59798d1b62c66f18", "url": "https://github.com/apache/beam/commit/587dde57cbb2b0095a1fa04b59798d1b62c66f18", "message": "fixup! Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-07-30T21:05:47Z", "type": "commit"}, {"oid": "0dfff978855e2e12087cd37f854eeffb6b2f2d91", "url": "https://github.com/apache/beam/commit/0dfff978855e2e12087cd37f854eeffb6b2f2d91", "message": "fixup! Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-08-04T16:56:00Z", "type": "commit"}, {"oid": "16c06ea87222f3a35bb38dda66d71361722270d8", "url": "https://github.com/apache/beam/commit/16c06ea87222f3a35bb38dda66d71361722270d8", "message": "Don't specify nested in row coder tests", "committedDate": "2020-08-04T18:07:30Z", "type": "commit"}, {"oid": "33354403a0e22dd20646175e34f12b379a5ef75e", "url": "https://github.com/apache/beam/commit/33354403a0e22dd20646175e34f12b379a5ef75e", "message": "fixup! Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-08-04T18:07:52Z", "type": "commit"}, {"oid": "0416e2ed65e5e859c4db1466254758a30d2200b7", "url": "https://github.com/apache/beam/commit/0416e2ed65e5e859c4db1466254758a30d2200b7", "message": "Don't mutate value when reading rows", "committedDate": "2020-08-04T18:08:24Z", "type": "commit"}, {"oid": "9bb591d9a8238a87bd8e44a82f3be7a84ca4b4e7", "url": "https://github.com/apache/beam/commit/9bb591d9a8238a87bd8e44a82f3be7a84ca4b4e7", "message": "fixup! Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-08-04T18:11:07Z", "type": "commit"}, {"oid": "d4f55982291aa23dd4ea2284ee74194dc65ec9cc", "url": "https://github.com/apache/beam/commit/d4f55982291aa23dd4ea2284ee74194dc65ec9cc", "message": "fixup! Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-08-04T22:21:25Z", "type": "commit"}, {"oid": "73f5602c9eb2fc4a7971fdea12faa0badf0c26b0", "url": "https://github.com/apache/beam/commit/73f5602c9eb2fc4a7971fdea12faa0badf0c26b0", "message": "Python: Don't mutate value", "committedDate": "2020-08-04T22:22:10Z", "type": "commit"}, {"oid": "31f246e62056ecf9c1acb0a816b2feef555020c2", "url": "https://github.com/apache/beam/commit/31f246e62056ecf9c1acb0a816b2feef555020c2", "message": "fixup! Add support for encoding Maps and Nulls (in container types) in Python RowCoder", "committedDate": "2020-08-05T21:45:20Z", "type": "commit"}]}