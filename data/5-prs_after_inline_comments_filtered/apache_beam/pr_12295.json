{"pr_number": 12295, "pr_title": "[BEAM-10520] Propagate BigQueryIO streaming insert quota errors to Da\u2026", "pr_createdAt": "2020-07-17T10:00:25Z", "pr_url": "https://github.com/apache/beam/pull/12295", "timeline": [{"oid": "d36eaf7faac63eb87afa45978a5e9aacd09e3025", "url": "https://github.com/apache/beam/commit/d36eaf7faac63eb87afa45978a5e9aacd09e3025", "message": "[BEAM-10520] Propagate BigQueryIO streaming insert quota errors to Dataflow UI under the STACK TRACES tab", "committedDate": "2020-07-17T09:58:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjcwMjY2Nw==", "url": "https://github.com/apache/beam/pull/12295#discussion_r456702667", "bodyText": "Probably add a comment as to why we are limiting this.", "author": "chamikaramj", "createdAt": "2020-07-17T22:39:31Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryServicesImpl.java", "diffHunk": "@@ -401,11 +401,9 @@ public Job getJob(JobReference jobRef, Sleeper sleeper, BackOff backoff)\n     private static final FluentBackoff INSERT_BACKOFF_FACTORY =\n         FluentBackoff.DEFAULT.withInitialBackoff(Duration.millis(200)).withMaxRetries(5);\n \n-    // A backoff for rate limit exceeded errors. Retries forever.\n+    // A backoff for rate limit exceeded errors. Only retry upto approximately 2 minutes.", "originalCommit": "d36eaf7faac63eb87afa45978a5e9aacd09e3025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4NjY0NA==", "url": "https://github.com/apache/beam/pull/12295#discussion_r457686644", "bodyText": "Done.", "author": "ihji", "createdAt": "2020-07-20T20:56:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjcwMjY2Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjcwMjkzMg==", "url": "https://github.com/apache/beam/pull/12295#discussion_r456702932", "bodyText": "Can we add a unit test for this behavior ?", "author": "chamikaramj", "createdAt": "2020-07-17T22:40:29Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/bigquery/BigQueryServicesImpl.java", "diffHunk": "@@ -811,7 +809,11 @@ public void deleteDataset(String projectId, String datasetId)\n                                   \"BigQuery insertAll error, retrying: %s\",\n                                   ApiErrorExtractor.INSTANCE.getErrorMessage(e)));\n                           try {\n-                            sleeper.sleep(backoff1.nextBackOffMillis());\n+                            long nextBackOffMillis = backoff1.nextBackOffMillis();\n+                            if (nextBackOffMillis == BackOff.STOP) {\n+                              throw e;", "originalCommit": "d36eaf7faac63eb87afa45978a5e9aacd09e3025", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzY4NjcxMQ==", "url": "https://github.com/apache/beam/pull/12295#discussion_r457686711", "bodyText": "Done.", "author": "ihji", "createdAt": "2020-07-20T20:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjcwMjkzMg=="}], "type": "inlineReview"}, {"oid": "192aa1e550147932778d8e116f0f649889bf70ad", "url": "https://github.com/apache/beam/commit/192aa1e550147932778d8e116f0f649889bf70ad", "message": "add testcase", "committedDate": "2020-07-20T20:45:30Z", "type": "commit"}]}