{"pr_number": 12225, "pr_title": "[BEAM-10080] Fix LocalFileSystemsTest to work with Java 11", "pr_createdAt": "2020-07-10T21:31:58Z", "pr_url": "https://github.com/apache/beam/pull/12225", "timeline": [{"oid": "bc22394883439694b4f15163c91dce503ab84351", "url": "https://github.com/apache/beam/commit/bc22394883439694b4f15163c91dce503ab84351", "message": "[BEAM-10080] Fix LocalFileSystemsTest to work with Java 11", "committedDate": "2020-07-10T21:41:36Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwOTE3NQ==", "url": "https://github.com/apache/beam/pull/12225#discussion_r453709175", "bodyText": "pwd is a bit unclear as a parameter name.", "author": "tysonjh", "createdAt": "2020-07-13T14:53:43Z", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/io/LocalFileSystem.java", "diffHunk": "@@ -90,9 +91,14 @@\n \n   @Override\n   protected List<MatchResult> match(List<String> specs) throws IOException {\n+    return match(new File(\".\").getAbsolutePath(), specs);\n+  }\n+\n+  @VisibleForTesting\n+  List<MatchResult> match(String pwd, List<String> specs) throws IOException {", "originalCommit": "bc22394883439694b4f15163c91dce503ab84351", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgxODAyMA==", "url": "https://github.com/apache/beam/pull/12225#discussion_r453818020", "bodyText": "Changed to baseDir", "author": "kennknowles", "createdAt": "2020-07-13T17:38:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcwOTE3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyMjk5MA==", "url": "https://github.com/apache/beam/pull/12225#discussion_r453722990", "bodyText": "Can you change the relativeFile name to something else? It may actually be an absolute file and that would be confusing.", "author": "tysonjh", "createdAt": "2020-07-13T15:12:44Z", "path": "sdks/java/core/src/main/java/org/apache/beam/sdk/io/LocalFileSystem.java", "diffHunk": "@@ -223,12 +229,22 @@ private MatchResult matchOne(String spec) throws IOException {\n     // it considers it an invalid file system pattern. We should use\n     // new File(spec) to avoid such validation.\n     // See https://bugs.openjdk.java.net/browse/JDK-8197918\n-    final File file = new File(spec);\n+    // However, new File(parent, child) resolves absolute `child` in a system-dependent\n+    // way that is generally incorrect, for example new File($PWD, \"/tmp/foo\") resolves\n+    // to $PWD/tmp/foo on many systems, unlike Paths.get($PWD).resolve(\"/tmp/foo\") which\n+    // correctly resolves to \"/tmp/foo\". We add just this one piece of logic here, without\n+    // switching to Paths which could require a rewrite of this module to support\n+    // both Windows and correct file resolution.\n+    // The root cause is that globs are not files but we are using file manipulation libraries\n+    // to work with them.\n+    final File relativeFile = new File(spec);", "originalCommit": "bc22394883439694b4f15163c91dce503ab84351", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzgyMjkzMw==", "url": "https://github.com/apache/beam/pull/12225#discussion_r453822933", "bodyText": "Renamed to specAsFile since basically it is just cramming the string into a File object, and renamed file into absoluteFile since it is now rooted in a base directory unless it was already absolute.", "author": "kennknowles", "createdAt": "2020-07-13T17:47:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzcyMjk5MA=="}], "type": "inlineReview"}, {"oid": "40c46befaf6e22ce783ce973c34edaa0d613abfc", "url": "https://github.com/apache/beam/commit/40c46befaf6e22ce783ce973c34edaa0d613abfc", "message": "[BEAM-10080] Fix LocalFileSystemsTest to work with Java 11", "committedDate": "2020-07-13T17:47:23Z", "type": "commit"}, {"oid": "40c46befaf6e22ce783ce973c34edaa0d613abfc", "url": "https://github.com/apache/beam/commit/40c46befaf6e22ce783ce973c34edaa0d613abfc", "message": "[BEAM-10080] Fix LocalFileSystemsTest to work with Java 11", "committedDate": "2020-07-13T17:47:23Z", "type": "forcePushed"}]}