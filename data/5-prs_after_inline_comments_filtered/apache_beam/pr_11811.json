{"pr_number": 11811, "pr_title": "[BEAM-10075] Add a flag to tune the size of the grouping tables used by the dataflow workers", "pr_createdAt": "2020-05-25T17:57:59Z", "pr_url": "https://github.com/apache/beam/pull/11811", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgzMTAzNQ==", "url": "https://github.com/apache/beam/pull/11811#discussion_r430831035", "bodyText": "Please add this option to \n  \n    \n      beam/sdks/java/core/src/main/java/org/apache/beam/sdk/options/SdkHarnessOptions.java\n    \n    \n         Line 32\n      in\n      32c6579\n    \n    \n    \n    \n\n        \n          \n           public interface SdkHarnessOptions extends PipelineOptions { \n        \n    \n  \n\n instead of here.\nPlease also plumb the value to \n  \n    \n      beam/sdks/java/harness/src/main/java/org/apache/beam/fn/harness/PrecombineGroupingTable.java\n    \n    \n         Line 44\n      in\n      32c6579\n    \n    \n    \n    \n\n        \n          \n           public static <K, InputT, AccumT> GroupingTable<WindowedValue<K>, InputT, AccumT> combining( \n        \n    \n  \n\n\nWe should be able to use a primitive type (also long seems really large for specifying amount of MBs):\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              Long getGroupingTableMaxSizeMb();\n          \n          \n            \n            \n          \n          \n            \n              void setGroupingTableMaxSizeMb(Long value);\n          \n          \n            \n              int getGroupingTableMaxSizeMb();\n          \n          \n            \n            \n          \n          \n            \n              void setGroupingTableMaxSizeMb(int value);", "author": "lukecwik", "createdAt": "2020-05-27T03:01:24Z", "path": "runners/google-cloud-dataflow-java/src/main/java/org/apache/beam/runners/dataflow/options/DataflowPipelineDebugOptions.java", "diffHunk": "@@ -177,6 +177,20 @@ public Dataflow create(PipelineOptions options) {\n \n   void setNumberOfWorkerHarnessThreads(int value);\n \n+  /**\n+   * Size (in MB) of each grouping table used to pre-combine elements. If unset, defaults to 100 MB.\n+   *\n+   * <p>CAUTION: If set too large, workers may run into OOM conditions more easily, each worker may\n+   * have many grouping tables in-memory concurrently.\n+   */\n+  @Description(\n+      \"The size (in MB) of the grouping tables used to pre-combine elements before \"\n+          + \"shuffling.  Larger values may reduce the amount of data shuffled.\")\n+  @Default.Long(100)\n+  Long getGroupingTableMaxSizeMb();\n+\n+  void setGroupingTableMaxSizeMb(Long value);", "originalCommit": "6021085dc859485b80574d35fddcef6f02aa5481", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgzNDMzNw==", "url": "https://github.com/apache/beam/pull/11811#discussion_r430834337", "bodyText": "\ud83d\udc4d done!", "author": "steveniemitz", "createdAt": "2020-05-27T03:15:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDgzMTAzNQ=="}], "type": "inlineReview"}, {"oid": "d9c9617c600d92605e40027670467928ca63368c", "url": "https://github.com/apache/beam/commit/d9c9617c600d92605e40027670467928ca63368c", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers", "committedDate": "2020-05-27T03:14:47Z", "type": "forcePushed"}, {"oid": "634344d575e379e910baaed0ce07f4e850655dd7", "url": "https://github.com/apache/beam/commit/634344d575e379e910baaed0ce07f4e850655dd7", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers", "committedDate": "2020-05-27T04:15:14Z", "type": "commit"}, {"oid": "634344d575e379e910baaed0ce07f4e850655dd7", "url": "https://github.com/apache/beam/commit/634344d575e379e910baaed0ce07f4e850655dd7", "message": "Add a flag to tune the size of the grouping tables used by the dataflow workers", "committedDate": "2020-05-27T04:15:14Z", "type": "forcePushed"}]}