{"pr_number": 12266, "pr_title": "[BEAM-10494] PubsubSchemaCapableIOProvider config inner class rather than row", "pr_createdAt": "2020-07-15T16:22:03Z", "pr_url": "https://github.com/apache/beam/pull/12266", "timeline": [{"oid": "660a60d14cf4b7418d6fea14848e7fc6aae0ab1b", "url": "https://github.com/apache/beam/commit/660a60d14cf4b7418d6fea14848e7fc6aae0ab1b", "message": "PubsubSchemaCapableIOProvider config inner class rather than row", "committedDate": "2020-07-15T15:46:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5MjQyNg==", "url": "https://github.com/apache/beam/pull/12266#discussion_r455492426", "bodyText": "Can we make this class private or package-private?", "author": "robinyqiu", "createdAt": "2020-07-16T03:46:18Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubSchemaCapableIOProvider.java", "diffHunk": "@@ -264,4 +265,22 @@ private static boolean fieldPresent(\n               schema.getField(field).getType(), Schema.EquivalenceNullablePolicy.IGNORE);\n     }\n   }\n+\n+  @Internal\n+  @AutoValue\n+  public abstract static class Config implements Serializable {", "originalCommit": "660a60d14cf4b7418d6fea14848e7fc6aae0ab1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2NDk3OA==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456064978", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-16T20:40:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5MjQyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5Mjc1Mg==", "url": "https://github.com/apache/beam/pull/12266#discussion_r455492752", "bodyText": "Rename to useDeadLetterQueue for consistency?", "author": "robinyqiu", "createdAt": "2020-07-16T03:47:28Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubSchemaCapableIOProvider.java", "diffHunk": "@@ -264,4 +265,22 @@ private static boolean fieldPresent(\n               schema.getField(field).getType(), Schema.EquivalenceNullablePolicy.IGNORE);\n     }\n   }\n+\n+  @Internal\n+  @AutoValue\n+  public abstract static class Config implements Serializable {\n+    @Nullable\n+    public abstract String getTimestampAttributeKey();\n+\n+    @Nullable\n+    public abstract String getDeadLetterQueue();\n+\n+    private boolean useDlqCheck() {", "originalCommit": "660a60d14cf4b7418d6fea14848e7fc6aae0ab1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2NTIyOQ==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456065229", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-16T20:41:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5Mjc1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5NDI5Ng==", "url": "https://github.com/apache/beam/pull/12266#discussion_r455494296", "bodyText": "The @Internal flag is a warning to users to not depend on the labeled class. This class is not even visible to user because it is private, so the flag is not needed here. Same below.", "author": "robinyqiu", "createdAt": "2020-07-16T03:53:50Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubSchemaCapableIOProvider.java", "diffHunk": "@@ -155,16 +159,17 @@ private void validateConfigurationSchema(Row configuration) {\n   /** An abstraction to create schema aware IOs. */\n   @Internal\n   private static class PubsubSchemaIO implements SchemaIO, Serializable {", "originalCommit": "660a60d14cf4b7418d6fea14848e7fc6aae0ab1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2NTYyNA==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456065624", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-16T20:42:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5NDI5Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5NTAyNA==", "url": "https://github.com/apache/beam/pull/12266#discussion_r455495024", "bodyText": "Actually, I looked at the RowToPubsubMessage class and found 2 of the 3 parameters here (config and useFlatSchema) are not used at all. What was the reason to keep them there? Can we remove them?", "author": "robinyqiu", "createdAt": "2020-07-16T03:56:40Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/PubsubSchemaCapableIOProvider.java", "diffHunk": "@@ -211,7 +216,11 @@ public POutput expand(PCollection<Row> input) {\n           return input\n               .apply(\n                   RowToPubsubMessage.fromConfig(\n-                      config, useFlatSchema, useTimestampAttribute(config)))\n+                      new AutoValueSchema()", "originalCommit": "660a60d14cf4b7418d6fea14848e7fc6aae0ab1b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA2NjAyMA==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456066020", "bodyText": "There was no reason to keep it from the old logic. Unnecessary variables removed.", "author": "sclukas77", "createdAt": "2020-07-16T20:43:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NTQ5NTAyNA=="}], "type": "inlineReview"}, {"oid": "73066a8813e2543b2f8bfa74d82cf4b0ee6ac68b", "url": "https://github.com/apache/beam/commit/73066a8813e2543b2f8bfa74d82cf4b0ee6ac68b", "message": "Cleaned PubsubSchemaCapableIOProvider", "committedDate": "2020-07-16T20:39:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA4OTE4Nw==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456089187", "bodyText": "Nit: Now that config parameter is gone, this class could be better named as something more meaningful like withTimestampAttribute().", "author": "robinyqiu", "createdAt": "2020-07-16T21:30:27Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/RowToPubsubMessage.java", "diffHunk": "@@ -40,19 +39,14 @@\n  * whether config.getValue(\"timestampAttributeKey\") is set.\n  */\n class RowToPubsubMessage extends PTransform<PCollection<Row>, PCollection<PubsubMessage>> {\n-  private final Row config;\n   private final Boolean useTimestampAttribute;\n \n-  private RowToPubsubMessage(Row config, Boolean useFlatSchema, Boolean useTimestampAttribute) {\n-    checkArgument(useFlatSchema, \"RowToPubsubMessage is only supported for flattened schemas.\");\n-\n-    this.config = config;\n+  private RowToPubsubMessage(Boolean useTimestampAttribute) {\n     this.useTimestampAttribute = useTimestampAttribute;\n   }\n \n-  public static RowToPubsubMessage fromConfig(\n-      Row config, Boolean useFlatSchema, Boolean useTimestampAttribute) {\n-    return new RowToPubsubMessage(config, useFlatSchema, useTimestampAttribute);\n+  public static RowToPubsubMessage fromConfig(Boolean useTimestampAttribute) {", "originalCommit": "73066a8813e2543b2f8bfa74d82cf4b0ee6ac68b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA5OTg1Mg==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456099852", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-16T21:53:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA4OTE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA4OTc5OQ==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456089799", "bodyText": "Java coding style discourage using boxed primitive types, unless there are reasons. I think here it's better to just use boolean. Same below.", "author": "robinyqiu", "createdAt": "2020-07-16T21:31:47Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/RowToPubsubMessage.java", "diffHunk": "@@ -40,19 +39,14 @@\n  * whether config.getValue(\"timestampAttributeKey\") is set.\n  */\n class RowToPubsubMessage extends PTransform<PCollection<Row>, PCollection<PubsubMessage>> {\n-  private final Row config;\n   private final Boolean useTimestampAttribute;\n \n-  private RowToPubsubMessage(Row config, Boolean useFlatSchema, Boolean useTimestampAttribute) {\n-    checkArgument(useFlatSchema, \"RowToPubsubMessage is only supported for flattened schemas.\");\n-\n-    this.config = config;\n+  private RowToPubsubMessage(Boolean useTimestampAttribute) {", "originalCommit": "73066a8813e2543b2f8bfa74d82cf4b0ee6ac68b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA5OTk2OQ==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456099969", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-16T21:53:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjA4OTc5OQ=="}], "type": "inlineReview"}, {"oid": "33a623814ec3dcaabdb9852d3460f29f3496fb40", "url": "https://github.com/apache/beam/commit/33a623814ec3dcaabdb9852d3460f29f3496fb40", "message": "Cleaned PubsubSchemaCapableIOProvider", "committedDate": "2020-07-16T21:51:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEwMDk2NQ==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456100965", "bodyText": "Here as well.", "author": "robinyqiu", "createdAt": "2020-07-16T21:55:56Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/RowToPubsubMessage.java", "diffHunk": "@@ -40,19 +39,14 @@\n  * whether config.getValue(\"timestampAttributeKey\") is set.\n  */\n class RowToPubsubMessage extends PTransform<PCollection<Row>, PCollection<PubsubMessage>> {\n-  private final Row config;\n   private final Boolean useTimestampAttribute;", "originalCommit": "33a623814ec3dcaabdb9852d3460f29f3496fb40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU0OTA4Ng==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456549086", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-17T16:32:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEwMDk2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEwMTkyNQ==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456101925", "bodyText": "And this.", "author": "robinyqiu", "createdAt": "2020-07-16T21:58:08Z", "path": "sdks/java/io/google-cloud-platform/src/main/java/org/apache/beam/sdk/io/gcp/pubsub/RowToPubsubMessage.java", "diffHunk": "@@ -40,19 +39,14 @@\n  * whether config.getValue(\"timestampAttributeKey\") is set.\n  */\n class RowToPubsubMessage extends PTransform<PCollection<Row>, PCollection<PubsubMessage>> {\n-  private final Row config;\n   private final Boolean useTimestampAttribute;\n \n-  private RowToPubsubMessage(Row config, Boolean useFlatSchema, Boolean useTimestampAttribute) {\n-    checkArgument(useFlatSchema, \"RowToPubsubMessage is only supported for flattened schemas.\");\n-\n-    this.config = config;\n+  private RowToPubsubMessage(Boolean useTimestampAttribute) {", "originalCommit": "33a623814ec3dcaabdb9852d3460f29f3496fb40", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjU0OTE3Nw==", "url": "https://github.com/apache/beam/pull/12266#discussion_r456549177", "bodyText": "Done", "author": "sclukas77", "createdAt": "2020-07-17T16:32:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjEwMTkyNQ=="}], "type": "inlineReview"}, {"oid": "a8d029fcc1f7213fb28dd64712ad2eed74505d56", "url": "https://github.com/apache/beam/commit/a8d029fcc1f7213fb28dd64712ad2eed74505d56", "message": "Removed Boolean references in PubsubSchemaCapableIOProvider", "committedDate": "2020-07-17T13:36:29Z", "type": "commit"}]}