{"pr_number": 13309, "pr_title": "[BEAM-10925] Create ZetaSQL-specific subclass of ScalarFunctionImpl t\u2026", "pr_createdAt": "2020-11-11T22:35:22Z", "pr_url": "https://github.com/apache/beam/pull/13309", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTcyODQ1OQ==", "url": "https://github.com/apache/beam/pull/13309#discussion_r521728459", "bodyText": "for these ZETASQL_FUNCTION_GROUP_NAME, eventually I think we will migrate it off from createUdfOperator.", "author": "amaliujia", "createdAt": "2020-11-12T00:23:22Z", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/translation/SqlOperators.java", "diffHunk": "@@ -82,58 +83,85 @@\n           new UdafImpl<>(new StringAgg.StringAggString()));\n \n   public static final SqlOperator START_WITHS =\n-      createUdfOperator(\"STARTS_WITH\", BeamBuiltinMethods.STARTS_WITH_METHOD);\n+      createUdfOperator(", "originalCommit": "22228c112ca3ce23906a74bd2b87191ff24ba993", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzMjYxOA==", "url": "https://github.com/apache/beam/pull/13309#discussion_r525532618", "bodyText": "nit: It seems like SqlAnalyzer.ZETASQL_FUNCTION_GROUP_NAME is the only thing ever passed to funGroup here and below. Should it really be an argument?", "author": "apilloud", "createdAt": "2020-11-17T21:22:04Z", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/translation/SqlOperators.java", "diffHunk": "@@ -177,26 +205,25 @@ private static SqlUserDefinedFunction createUdfOperator(\n       Class<?> methodClass,\n       String methodName,\n       SqlReturnTypeInference returnTypeInference,\n-      List<RelDataType> paramTypes) {\n+      List<RelDataType> paramTypes,\n+      String funGroup) {", "originalCommit": "22228c112ca3ce23906a74bd2b87191ff24ba993", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM2MDA0OA==", "url": "https://github.com/apache/beam/pull/13309#discussion_r527360048", "bodyText": "The full implementation uses the group name to distinguish built-in functions from user-defined functions. (Whether that's a good idea or not is up for debate.)", "author": "ibzib", "createdAt": "2020-11-20T02:49:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzMjYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzMzY2Mw==", "url": "https://github.com/apache/beam/pull/13309#discussion_r525533663", "bodyText": "This (and createUdfOperator) is intended to be a (slightly hacky) helper function for implementing ZetaSQL operators via the UDF interface. Why do you need to make them public?", "author": "apilloud", "createdAt": "2020-11-17T21:24:00Z", "path": "sdks/java/extensions/sql/zetasql/src/main/java/org/apache/beam/sdk/extensions/sql/zetasql/translation/SqlOperators.java", "diffHunk": "@@ -158,7 +186,7 @@ public static SqlFunction createZetaSqlFunction(String name, SqlTypeName returnT\n         SqlFunctionCategory.USER_DEFINED_FUNCTION);\n   }\n \n-  private static SqlUserDefinedAggFunction createUdafOperator(\n+  public static SqlUserDefinedAggFunction createUdafOperator(", "originalCommit": "22228c112ca3ce23906a74bd2b87191ff24ba993", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzM1OTY2Mw==", "url": "https://github.com/apache/beam/pull/13309#discussion_r527359663", "bodyText": "In the original PR, I used createUdfOperator in ExpressionConverter, and createUdafOperator in AggregateScanConverter. So they can be package-private instead of public.", "author": "ibzib", "createdAt": "2020-11-20T02:48:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTUzMzY2Mw=="}], "type": "inlineReview"}, {"oid": "c4b1359c275e2f753021c0bdf3ccd45db2ac7df6", "url": "https://github.com/apache/beam/commit/c4b1359c275e2f753021c0bdf3ccd45db2ac7df6", "message": "[BEAM-10925] Create ZetaSQL-specific subclass of ScalarFunctionImpl that knows which function group it belongs to.\n\nThis will be important for differentiating ZetaSQL built-in functions from UDFs.\n\nAlso resolves the nullability error in findMethod.", "committedDate": "2020-11-20T02:55:39Z", "type": "commit"}, {"oid": "6c4eea4d9a2c711c661503f015361c8b18e29588", "url": "https://github.com/apache/beam/commit/6c4eea4d9a2c711c661503f015361c8b18e29588", "message": "Make createUd(a)fOperator methods package-private.", "committedDate": "2020-11-20T02:55:43Z", "type": "forcePushed"}, {"oid": "542e8ceb40a690ffc5a297c465f559840c9e965f", "url": "https://github.com/apache/beam/commit/542e8ceb40a690ffc5a297c465f559840c9e965f", "message": "Make createUd(a)fOperator methods package-private.", "committedDate": "2020-12-03T02:58:15Z", "type": "commit"}, {"oid": "542e8ceb40a690ffc5a297c465f559840c9e965f", "url": "https://github.com/apache/beam/commit/542e8ceb40a690ffc5a297c465f559840c9e965f", "message": "Make createUd(a)fOperator methods package-private.", "committedDate": "2020-12-03T02:58:15Z", "type": "forcePushed"}]}