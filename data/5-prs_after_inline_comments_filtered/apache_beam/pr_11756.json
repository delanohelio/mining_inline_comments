{"pr_number": 11756, "pr_title": "[BEAM-9603] Add timer family support to FnApiDoFnRunner", "pr_createdAt": "2020-05-20T00:54:47Z", "pr_url": "https://github.com/apache/beam/pull/11756", "timeline": [{"oid": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "url": "https://github.com/apache/beam/commit/c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "message": "[BEAM-9603] Add timer family support to FnApiDoFnRunner", "committedDate": "2020-05-20T01:05:42Z", "type": "commit"}, {"oid": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "url": "https://github.com/apache/beam/commit/c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "message": "[BEAM-9603] Add timer family support to FnApiDoFnRunner", "committedDate": "2020-05-20T01:05:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxODYxNg==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427718616", "bodyText": "The TTimerFamilySpec should have time_domain  field. Maybe we could  do something similar to \n  \n    \n      beam/runners/core-construction-java/src/main/java/org/apache/beam/runners/core/construction/ParDoTranslation.java\n    \n    \n        Lines 657 to 668\n      in\n      1de50c3\n    \n    \n    \n    \n\n        \n          \n           private static RunnerApi.TimeDomain.Enum translateTimeDomain(TimeDomain timeDomain) { \n        \n\n        \n          \n             switch (timeDomain) { \n        \n\n        \n          \n               case EVENT_TIME: \n        \n\n        \n          \n                 return RunnerApi.TimeDomain.Enum.EVENT_TIME; \n        \n\n        \n          \n               case PROCESSING_TIME: \n        \n\n        \n          \n                 return RunnerApi.TimeDomain.Enum.PROCESSING_TIME; \n        \n\n        \n          \n               case SYNCHRONIZED_PROCESSING_TIME: \n        \n\n        \n          \n                 return RunnerApi.TimeDomain.Enum.SYNCHRONIZED_PROCESSING_TIME; \n        \n\n        \n          \n               default: \n        \n\n        \n          \n                 throw new IllegalArgumentException(\"Unknown time domain\"); \n        \n\n        \n          \n             } \n        \n\n        \n          \n           }", "author": "boyuanzz", "createdAt": "2020-05-20T03:17:44Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -460,14 +461,22 @@ public void accept(WindowedValue input) throws Exception {\n       // Extract out relevant TimerFamilySpec information in preparation for execution.\n       for (Map.Entry<String, TimerFamilySpec> entry :\n           parDoPayload.getTimerFamilySpecsMap().entrySet()) {\n-        String timerFamilyId = entry.getKey();\n-        TimeDomain timeDomain =\n-            DoFnSignatures.getTimerSpecOrThrow(\n-                    doFnSignature.timerDeclarations().get(timerFamilyId), doFn)\n-                .getTimeDomain();\n+        String timerIdOrTimerFamilyId = entry.getKey();\n+        TimeDomain timeDomain;\n+        if (timerIdOrTimerFamilyId.startsWith(TimerFamilyDeclaration.PREFIX)) {\n+          timeDomain =", "originalCommit": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0MjY1NQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428242655", "bodyText": "done.", "author": "y1chi", "createdAt": "2020-05-20T19:01:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxODYxNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxOTAwMA==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427719000", "bodyText": "Could you please add more javadoc/comments about why it's timerId or timerFamilyId?", "author": "boyuanzz", "createdAt": "2020-05-20T03:19:33Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -460,14 +461,22 @@ public void accept(WindowedValue input) throws Exception {\n       // Extract out relevant TimerFamilySpec information in preparation for execution.\n       for (Map.Entry<String, TimerFamilySpec> entry :\n           parDoPayload.getTimerFamilySpecsMap().entrySet()) {\n-        String timerFamilyId = entry.getKey();\n-        TimeDomain timeDomain =\n-            DoFnSignatures.getTimerSpecOrThrow(\n-                    doFnSignature.timerDeclarations().get(timerFamilyId), doFn)\n-                .getTimeDomain();\n+        String timerIdOrTimerFamilyId = entry.getKey();\n+        TimeDomain timeDomain;\n+        if (timerIdOrTimerFamilyId.startsWith(TimerFamilyDeclaration.PREFIX)) {\n+          timeDomain =\n+              DoFnSignatures.getTimerFamilySpecOrThrow(\n+                      doFnSignature.timerFamilyDeclarations().get(timerIdOrTimerFamilyId), doFn)\n+                  .getTimeDomain();\n+        } else {\n+          timeDomain =\n+              DoFnSignatures.getTimerSpecOrThrow(\n+                      doFnSignature.timerDeclarations().get(timerIdOrTimerFamilyId), doFn)\n+                  .getTimeDomain();\n+        }\n         Coder<Timer<Object>> timerCoder =\n             (Coder) rehydratedComponents.getCoder(entry.getValue().getTimerFamilyCoderId());\n-        timerFamilyInfosBuilder.put(timerFamilyId, KV.of(timeDomain, timerCoder));\n+        timerFamilyInfosBuilder.put(timerIdOrTimerFamilyId, KV.of(timeDomain, timerCoder));", "originalCommit": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0MTA4Mw==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428241083", "bodyText": "done.", "author": "y1chi", "createdAt": "2020-05-20T18:59:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxOTAwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMDQ1MQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427720451", "bodyText": "If the timerIdOrTimerFamilyId  is for a timer family, should the timerId be the timer.dynamicTimerTag?", "author": "boyuanzz", "createdAt": "2020-05-20T03:25:46Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -962,16 +971,25 @@ private Progress getProgress() {\n             .build());\n   }\n \n-  private <K> void processTimer(String timerId, TimeDomain timeDomain, Timer<K> timer) {\n+  private <K> void processTimer(\n+      String timerIdOrTimerFamilyId, TimeDomain timeDomain, Timer<K> timer) {\n     currentTimer = timer;\n     currentTimeDomain = timeDomain;\n     onTimerContext = new OnTimerContext<>(timer.getUserKey());\n+    String timerId =\n+        timerIdOrTimerFamilyId.startsWith(TimerFamilyDeclaration.PREFIX)", "originalCommit": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzczNzI4OQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427737289", "bodyText": "it will be ignored anyway, apparently only one of timerId or the timerFamilyId takes effect.\n\n  \n    \n      beam/sdks/java/core/src/main/java/org/apache/beam/sdk/transforms/reflect/ByteBuddyDoFnInvokerFactory.java\n    \n    \n         Line 223\n      in\n      591de34\n    \n    \n    \n    \n\n        \n          \n           (timerFamilyId.isEmpty())", "author": "y1chi", "createdAt": "2020-05-20T04:41:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMDQ1MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQzODk3MQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428438971", "bodyText": "Ack. Thanks!", "author": "boyuanzz", "createdAt": "2020-05-21T04:31:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMDQ1MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMTEwMQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427721101", "bodyText": "Similar to FnApiTimer above, we should have timeDomain from proto, right?", "author": "boyuanzz", "createdAt": "2020-05-20T03:28:37Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -1207,15 +1224,51 @@ private void output(Instant scheduledTime) {\n     }\n   }\n \n-  private static class FnApiTimerMap implements TimerMap {\n-    FnApiTimerMap() {}\n+  private class FnApiTimerMap<K> implements TimerMap {\n+    private final String timerFamilyId;\n+    private final K userKey;\n+    private final TimeDomain timeDomain;\n+    private final Instant elementTimestampOrTimerHoldTimestamp;\n+    private final Instant elementTimestampOrTimerFireTimestamp;\n+    private final BoundedWindow boundedWindow;\n+    private final PaneInfo paneInfo;\n+\n+    FnApiTimerMap(\n+        String timerFamilyId,\n+        K userKey,\n+        BoundedWindow boundedWindow,\n+        Instant elementTimestampOrTimerHoldTimestamp,\n+        Instant elementTimestampOrTimerFireTimestamp,\n+        PaneInfo paneInfo) {\n+      this.timerFamilyId = timerFamilyId;\n+      this.userKey = userKey;\n+      this.elementTimestampOrTimerHoldTimestamp = elementTimestampOrTimerHoldTimestamp;\n+      this.elementTimestampOrTimerFireTimestamp = elementTimestampOrTimerFireTimestamp;\n+      this.boundedWindow = boundedWindow;\n+      this.paneInfo = paneInfo;\n+\n+      TimerFamilyDeclaration timerFamilyDeclaration =\n+          doFnSignature.timerFamilyDeclarations().get(timerFamilyId);\n+      this.timeDomain =", "originalCommit": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODI0MTI2Mw==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428241263", "bodyText": "done.", "author": "y1chi", "createdAt": "2020-05-20T18:59:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMTEwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMzI2OQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427723269", "bodyText": "We should consider exposing more APIs here like FnApiTimer. Maybe a TODO here?", "author": "boyuanzz", "createdAt": "2020-05-20T03:38:23Z", "path": "sdks/java/harness/src/main/java/org/apache/beam/fn/harness/FnApiDoFnRunner.java", "diffHunk": "@@ -1207,15 +1224,51 @@ private void output(Instant scheduledTime) {\n     }\n   }\n \n-  private static class FnApiTimerMap implements TimerMap {\n-    FnApiTimerMap() {}\n+  private class FnApiTimerMap<K> implements TimerMap {\n+    private final String timerFamilyId;\n+    private final K userKey;\n+    private final TimeDomain timeDomain;\n+    private final Instant elementTimestampOrTimerHoldTimestamp;\n+    private final Instant elementTimestampOrTimerFireTimestamp;\n+    private final BoundedWindow boundedWindow;\n+    private final PaneInfo paneInfo;\n+\n+    FnApiTimerMap(\n+        String timerFamilyId,\n+        K userKey,\n+        BoundedWindow boundedWindow,\n+        Instant elementTimestampOrTimerHoldTimestamp,\n+        Instant elementTimestampOrTimerFireTimestamp,\n+        PaneInfo paneInfo) {\n+      this.timerFamilyId = timerFamilyId;\n+      this.userKey = userKey;\n+      this.elementTimestampOrTimerHoldTimestamp = elementTimestampOrTimerHoldTimestamp;\n+      this.elementTimestampOrTimerFireTimestamp = elementTimestampOrTimerFireTimestamp;\n+      this.boundedWindow = boundedWindow;\n+      this.paneInfo = paneInfo;\n+\n+      TimerFamilyDeclaration timerFamilyDeclaration =\n+          doFnSignature.timerFamilyDeclarations().get(timerFamilyId);\n+      this.timeDomain =\n+          DoFnSignatures.getTimerFamilySpecOrThrow(timerFamilyDeclaration, doFn).getTimeDomain();\n+    }\n \n     @Override\n-    public void set(String timerId, Instant absoluteTime) {}\n+    public void set(String dynamicTimerTag, Instant absoluteTime) {", "originalCommit": "c2d6c36e03dffcbfd2387ac19862a4d9cb401494", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzczODA0MQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427738041", "bodyText": "I believe we can always call the get() first to access FnApiTimer and call it's APIs. Probably that's sufficient enough? I feel adding more shortcuts only makes the API slightly more user-friendly.", "author": "y1chi", "createdAt": "2020-05-20T04:44:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMzI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc1MDcwOQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427750709", "bodyText": "Thanks for the clarification! I still think we should have a better API(and doc) here, like getTimer(timerId)? And I would prefer not exposing set() since getTimer() is a more recommended way. What do you think? You can also start a discussion thread in dev list since it's a user faced API.", "author": "boyuanzz", "createdAt": "2020-05-20T05:31:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMzI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc1ODYwNw==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427758607", "bodyText": "This is the interface required by TimerMap though: \n  \n    \n      beam/sdks/java/core/src/main/java/org/apache/beam/sdk/state/TimerMap.java\n    \n    \n         Line 25\n      in\n      9108832\n    \n    \n    \n    \n\n        \n          \n           public interface TimerMap {", "author": "y1chi", "createdAt": "2020-05-20T05:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMzI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzc1OTAxOQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r427759019", "bodyText": "probably makes sense to keep the set shortcut since it is the most frequently used one.", "author": "y1chi", "createdAt": "2020-05-20T05:59:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMzI2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ0MDM2MQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428440361", "bodyText": "I thought it would be good time to revisit the dynamic timer API design but it's not in the scope of this PR. Let's leave it as now. Thanks!", "author": "boyuanzz", "createdAt": "2020-05-21T04:37:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcyMzI2OQ=="}], "type": "inlineReview"}, {"oid": "583991565db7b684957c9a97a0ed6bb09593c01f", "url": "https://github.com/apache/beam/commit/583991565db7b684957c9a97a0ed6bb09593c01f", "message": "Address comments and add tests", "committedDate": "2020-05-20T18:58:19Z", "type": "commit"}, {"oid": "583991565db7b684957c9a97a0ed6bb09593c01f", "url": "https://github.com/apache/beam/commit/583991565db7b684957c9a97a0ed6bb09593c01f", "message": "Address comments and add tests", "committedDate": "2020-05-20T18:58:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ0NTk0NQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428445945", "bodyText": "dynamicTimerInGlobalWindow?", "author": "boyuanzz", "createdAt": "2020-05-21T05:03:07Z", "path": "sdks/java/harness/src/test/java/org/apache/beam/fn/harness/FnApiDoFnRunnerTest.java", "diffHunk": "@@ -947,49 +910,213 @@ public void testTimers() throws Exception {\n             timerInGlobalWindow(\"A\", new Instant(1600L), new Instant(10012L)),\n             timerInGlobalWindow(\"X\", new Instant(1700L), new Instant(10022L)),\n             timerInGlobalWindow(\"C\", new Instant(1800L), new Instant(10022L)),\n-            timerInGlobalWindow(\"B\", new Instant(1900L), new Instant(10022L))));\n+            timerInGlobalWindow(\"B\", new Instant(1900L), new Instant(10022L)),\n+            timerInGlobalWindow(\"B\", new Instant(2000L), new Instant(10032L)),\n+            timerInGlobalWindow(\"Y\", new Instant(2100L), new Instant(10042L))));\n+    assertThat(\n+        fakeTimerClient.getTimers(eventFamilyTimer),\n+        contains(\n+            timerInGlobalWindow(\"X\", \"event-timer1\", new Instant(1000L), new Instant(1003L)),\n+            timerInGlobalWindow(\"Y\", \"event-timer1\", new Instant(1100L), new Instant(1103L)),\n+            timerInGlobalWindow(\"X\", \"event-timer1\", new Instant(1200L), new Instant(1203L)),\n+            timerInGlobalWindow(\"Y\", \"event-timer1\", new Instant(1300L), new Instant(1303L)),\n+            timerInGlobalWindow(\"A\", \"event-timer1\", new Instant(1400L), new Instant(2413L)),\n+            timerInGlobalWindow(\"B\", \"event-timer1\", new Instant(1500L), new Instant(2513L)),\n+            timerInGlobalWindow(\"A\", \"event-timer1\", new Instant(1600L), new Instant(2613L)),\n+            timerInGlobalWindow(\"X\", \"event-timer1\", new Instant(1700L), new Instant(1723L)),\n+            timerInGlobalWindow(\"C\", \"event-timer1\", new Instant(1800L), new Instant(1823L)),\n+            timerInGlobalWindow(\"B\", \"event-timer1\", new Instant(1900L), new Instant(1923L)),\n+            timerInGlobalWindow(\"B\", \"event-timer1\", new Instant(2000L), new Instant(2033L)),\n+            timerInGlobalWindow(\"Y\", \"event-timer1\", new Instant(2100L), new Instant(2143L))));\n+    assertThat(\n+        fakeTimerClient.getTimers(processingFamilyTimer),\n+        contains(\n+            timerInGlobalWindow(\"X\", \"processing-timer1\", new Instant(1000L), new Instant(10004L)),\n+            timerInGlobalWindow(\"Y\", \"processing-timer1\", new Instant(1100L), new Instant(10004L)),\n+            timerInGlobalWindow(\"X\", \"processing-timer1\", new Instant(1200L), new Instant(10004L)),\n+            timerInGlobalWindow(\"Y\", \"processing-timer1\", new Instant(1300L), new Instant(10004L)),\n+            timerInGlobalWindow(\"A\", \"processing-timer1\", new Instant(1400L), new Instant(10014L)),\n+            timerInGlobalWindow(\"B\", \"processing-timer1\", new Instant(1500L), new Instant(10014L)),\n+            timerInGlobalWindow(\"A\", \"processing-timer1\", new Instant(1600L), new Instant(10014L)),\n+            timerInGlobalWindow(\"X\", \"processing-timer1\", new Instant(1700L), new Instant(10024L)),\n+            timerInGlobalWindow(\"C\", \"processing-timer1\", new Instant(1800L), new Instant(10024L)),\n+            timerInGlobalWindow(\"B\", \"processing-timer1\", new Instant(1900L), new Instant(10024L)),\n+            timerInGlobalWindow(\"B\", \"processing-timer1\", new Instant(2000L), new Instant(10034L)),\n+            timerInGlobalWindow(\n+                \"Y\", \"processing-timer1\", new Instant(2100L), new Instant(10044L))));\n     mainOutputValues.clear();\n \n     assertFalse(fakeTimerClient.isOutboundClosed(eventTimer));\n     assertFalse(fakeTimerClient.isOutboundClosed(processingTimer));\n+    assertFalse(fakeTimerClient.isOutboundClosed(eventFamilyTimer));\n+    assertFalse(fakeTimerClient.isOutboundClosed(processingFamilyTimer));\n     fakeTimerClient.closeInbound(eventTimer);\n     fakeTimerClient.closeInbound(processingTimer);\n+    fakeTimerClient.closeInbound(eventFamilyTimer);\n+    fakeTimerClient.closeInbound(processingFamilyTimer);\n \n     Iterables.getOnlyElement(finishFunctionRegistry.getFunctions()).run();\n     assertThat(mainOutputValues, empty());\n \n     assertTrue(fakeTimerClient.isOutboundClosed(eventTimer));\n     assertTrue(fakeTimerClient.isOutboundClosed(processingTimer));\n+    assertTrue(fakeTimerClient.isOutboundClosed(eventFamilyTimer));\n+    assertTrue(fakeTimerClient.isOutboundClosed(processingFamilyTimer));\n \n     Iterables.getOnlyElement(teardownFunctions).run();\n     assertThat(mainOutputValues, empty());\n \n     assertEquals(\n         ImmutableMap.<StateKey, ByteString>builder()\n             .put(bagUserStateKey(\"bag\", \"X\"), encode(\"X0\", \"X1\", \"X2\", \"processing\"))\n-            .put(bagUserStateKey(\"bag\", \"Y\"), encode(\"Y1\", \"Y2\"))\n+            .put(bagUserStateKey(\"bag\", \"Y\"), encode(\"Y1\", \"Y2\", \"processing-family\"))\n             .put(bagUserStateKey(\"bag\", \"A\"), encode(\"A0\", \"event\", \"event\"))\n-            .put(bagUserStateKey(\"bag\", \"B\"), encode(\"event\", \"processing\"))\n+            .put(bagUserStateKey(\"bag\", \"B\"), encode(\"event\", \"processing\", \"event-family\"))\n             .put(bagUserStateKey(\"bag\", \"C\"), encode(\"C0\", \"processing\"))\n             .build(),\n         fakeStateClient.getData());\n   }\n \n+  private <K> org.apache.beam.runners.core.construction.Timer<K> timerInGlobalWindow(\n+      K userKey, Instant holdTimestamp, Instant fireTimestamp) {\n+    return timerInGlobalWindow(userKey, \"\", holdTimestamp, fireTimestamp);\n+  }\n+\n   private <T> WindowedValue<T> valueInWindow(T value, BoundedWindow window) {\n     return WindowedValue.of(value, window.maxTimestamp(), window, PaneInfo.NO_FIRING);\n   }\n \n   private <K> org.apache.beam.runners.core.construction.Timer<K> timerInGlobalWindow(", "originalCommit": "583991565db7b684957c9a97a0ed6bb09593c01f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODc1NDM5NQ==", "url": "https://github.com/apache/beam/pull/11756#discussion_r428754395", "bodyText": "done", "author": "y1chi", "createdAt": "2020-05-21T16:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODQ0NTk0NQ=="}], "type": "inlineReview"}, {"oid": "d3dfa30f7b6d1ac1ad693e98b29d09cc0586d6de", "url": "https://github.com/apache/beam/commit/d3dfa30f7b6d1ac1ad693e98b29d09cc0586d6de", "message": "comments", "committedDate": "2020-05-21T16:05:24Z", "type": "commit"}]}