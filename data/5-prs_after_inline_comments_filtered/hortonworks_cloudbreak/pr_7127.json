{"pr_number": 7127, "pr_title": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "pr_createdAt": "2020-01-22T19:10:49Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/7127", "timeline": [{"oid": "e050096b8ab61e339da17dac1f286071af8d9591", "url": "https://github.com/hortonworks/cloudbreak/commit/e050096b8ab61e339da17dac1f286071af8d9591", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-23T06:58:10Z", "type": "forcePushed"}, {"oid": "755141e117e935c42b9eccdcbde3e7ce76e5c726", "url": "https://github.com/hortonworks/cloudbreak/commit/755141e117e935c42b9eccdcbde3e7ce76e5c726", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-23T08:56:05Z", "type": "forcePushed"}, {"oid": "a7e3010371934739db257feb16d3b03a7a4db243", "url": "https://github.com/hortonworks/cloudbreak/commit/a7e3010371934739db257feb16d3b03a7a4db243", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-27T14:29:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxMTMxOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#discussion_r371311319", "bodyText": "Let's make it 7.1.0", "author": "keyki", "createdAt": "2020-01-27T15:35:44Z", "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/nifi/NifiConfigProvider.java", "diffHunk": "@@ -1,19 +1,40 @@\n package com.sequenceiq.cloudbreak.cmtemplate.configproviders.nifi;\n \n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.CLOUDERAMANAGER_VERSION_7_0_1;\n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.isVersionNewerOrEqualThanLimited;\n+import static com.sequenceiq.cloudbreak.cmtemplate.configproviders.ConfigUtils.config;\n+\n+import java.util.ArrayList;\n import java.util.List;\n \n+import javax.inject.Inject;\n+\n import org.springframework.stereotype.Component;\n \n import com.cloudera.api.swagger.model.ApiClusterTemplateConfig;\n-import com.sequenceiq.cloudbreak.cmtemplate.configproviders.AbstractRoleConfigProvider;\n+import com.sequenceiq.cloudbreak.auth.altus.UmsRight;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupRequest;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupService;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateComponentConfigProvider;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateProcessor;\n import com.sequenceiq.cloudbreak.template.TemplatePreparationObject;\n \n @Component\n-public class NifiConfigProvider extends AbstractRoleConfigProvider {\n+public class NifiConfigProvider implements CmTemplateComponentConfigProvider {\n+    @Inject\n+    private VirtualGroupService virtualGroupService;\n \n     @Override\n-    public List<ApiClusterTemplateConfig> getRoleConfigs(String roleType, TemplatePreparationObject source) {\n-        return List.of();\n+    public List<ApiClusterTemplateConfig> getServiceConfigs(CmTemplateProcessor templateProcessor, TemplatePreparationObject source) {\n+        List<ApiClusterTemplateConfig> configList = new ArrayList<>();\n+        String cdhVersion = source.getBlueprintView().getProcessor().getStackVersion() == null ?\n+                \"\" : source.getBlueprintView().getProcessor().getStackVersion();\n+        if (isVersionNewerOrEqualThanLimited(cdhVersion, CLOUDERAMANAGER_VERSION_7_0_1)) {", "originalCommit": "a7e3010371934739db257feb16d3b03a7a4db243", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxMTU1OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/7127#discussion_r371311559", "bodyText": "Same here.", "author": "keyki", "createdAt": "2020-01-27T15:36:06Z", "path": "template-manager-cmtemplate/src/main/java/com/sequenceiq/cloudbreak/cmtemplate/configproviders/nifi/NifiRegistryConfigProvider.java", "diffHunk": "@@ -1,19 +1,40 @@\n package com.sequenceiq.cloudbreak.cmtemplate.configproviders.nifi;\n \n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.CLOUDERAMANAGER_VERSION_7_0_1;\n+import static com.sequenceiq.cloudbreak.cmtemplate.CMRepositoryVersionUtil.isVersionNewerOrEqualThanLimited;\n+import static com.sequenceiq.cloudbreak.cmtemplate.configproviders.ConfigUtils.config;\n+\n+import java.util.ArrayList;\n import java.util.List;\n \n+import javax.inject.Inject;\n+\n import org.springframework.stereotype.Component;\n \n import com.cloudera.api.swagger.model.ApiClusterTemplateConfig;\n-import com.sequenceiq.cloudbreak.cmtemplate.configproviders.AbstractRoleConfigProvider;\n+import com.sequenceiq.cloudbreak.auth.altus.UmsRight;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupRequest;\n+import com.sequenceiq.cloudbreak.auth.altus.VirtualGroupService;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateComponentConfigProvider;\n+import com.sequenceiq.cloudbreak.cmtemplate.CmTemplateProcessor;\n import com.sequenceiq.cloudbreak.template.TemplatePreparationObject;\n \n @Component\n-public class NifiRegistryConfigProvider extends AbstractRoleConfigProvider {\n+public class NifiRegistryConfigProvider implements CmTemplateComponentConfigProvider {\n+    @Inject\n+    private VirtualGroupService virtualGroupService;\n \n     @Override\n-    public List<ApiClusterTemplateConfig> getRoleConfigs(String roleType, TemplatePreparationObject source) {\n-        return List.of();\n+    public List<ApiClusterTemplateConfig> getServiceConfigs(CmTemplateProcessor templateProcessor, TemplatePreparationObject source) {\n+        List<ApiClusterTemplateConfig> configList = new ArrayList<>();\n+        String cdhVersion = source.getBlueprintView().getProcessor().getStackVersion() == null ?\n+                \"\" : source.getBlueprintView().getProcessor().getStackVersion();\n+        if (isVersionNewerOrEqualThanLimited(cdhVersion, CLOUDERAMANAGER_VERSION_7_0_1)) {", "originalCommit": "a7e3010371934739db257feb16d3b03a7a4db243", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3de4c47221b1de5b4abbcb0d8babd2eeabf710df", "url": "https://github.com/hortonworks/cloudbreak/commit/3de4c47221b1de5b4abbcb0d8babd2eeabf710df", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-27T17:25:14Z", "type": "forcePushed"}, {"oid": "b97d3d44d7b21155dbc5b008afd56e8ec8d36fac", "url": "https://github.com/hortonworks/cloudbreak/commit/b97d3d44d7b21155dbc5b008afd56e8ec8d36fac", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-29T13:39:33Z", "type": "forcePushed"}, {"oid": "c4770b29ce3eaeef65952f21313aec1cb48a7d86", "url": "https://github.com/hortonworks/cloudbreak/commit/c4770b29ce3eaeef65952f21313aec1cb48a7d86", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-29T13:56:41Z", "type": "forcePushed"}, {"oid": "6b207a323b86d3b8f289a92c240417e293494329", "url": "https://github.com/hortonworks/cloudbreak/commit/6b207a323b86d3b8f289a92c240417e293494329", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-29T16:00:43Z", "type": "forcePushed"}, {"oid": "cf11e59402b1995b3417bbac403035b7b13cb282", "url": "https://github.com/hortonworks/cloudbreak/commit/cf11e59402b1995b3417bbac403035b7b13cb282", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-29T16:06:13Z", "type": "forcePushed"}, {"oid": "8a9c70e017191f44af035d92ea82ff6ccadd3d49", "url": "https://github.com/hortonworks/cloudbreak/commit/8a9c70e017191f44af035d92ea82ff6ccadd3d49", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-30T09:32:34Z", "type": "commit"}, {"oid": "8a9c70e017191f44af035d92ea82ff6ccadd3d49", "url": "https://github.com/hortonworks/cloudbreak/commit/8a9c70e017191f44af035d92ea82ff6ccadd3d49", "message": "CB-5019, CB-5020: Extend Nifi configproviders with certain config properties", "committedDate": "2020-01-30T09:32:34Z", "type": "forcePushed"}]}