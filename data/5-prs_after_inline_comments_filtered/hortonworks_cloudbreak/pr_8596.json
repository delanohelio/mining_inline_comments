{"pr_number": 8596, "pr_title": "CB-8021 Replace DnsV1Endpoint#deleteDnsRecordsByFqdn call with cleanu\u2026", "pr_createdAt": "2020-07-20T13:44:21Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8596", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQxNDk1Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8596#discussion_r457414952", "bodyText": "I am wondering if it might be possible for getDiscoveryFQDN to return null some error cases. I think this might be called for cleanup of a cluster that might have a node that didn't successfully complete the registration. A filter(Objects:nonNull) might be helpful here.\nI know later in the case there is Objects.requireNonNull(hostNames, \"Hostnames must be set\"); so it will throw an exception. But I wonder if this validation is called for the cluster deletion if it will prevent a cleanup from completing without the \"force\".", "author": "jamisonbennett", "createdAt": "2020-07-20T14:03:45Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/core/flow2/stack/downscale/StackDownscaleService.java", "diffHunk": "@@ -92,15 +86,14 @@ public void finishStackDownscale(StackScalingFlowContext context, String instanc\n         flowMessageService.fireEventAndLog(stack.getId(), AVAILABLE.name(), STACK_DOWNSCALE_SUCCESS, String.join(\",\", deletedInstanceIds));\n     }\n \n-    private void cleanupDnsRecords(Stack stack, List<String> fqdns) {\n+    private void cleanupDnsRecords(Stack stack, Collection<InstanceMetaData> instanceMetaDatas) {\n+        Set<String> fqdns = instanceMetaDatas.stream().map(InstanceMetaData::getDiscoveryFQDN).collect(Collectors.toSet());", "originalCommit": "8acfa311da1552e7f16582dca3a46de9e35d4e18", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQyOTI0NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8596#discussion_r457429245", "bodyText": "we are ignoring cleanup error, but sure, I can add the filter", "author": "lacikaaa", "createdAt": "2020-07-20T14:19:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQxNDk1Mg=="}], "type": "inlineReview"}, {"oid": "a6a45754e139a6d174cc3a915a53415daa1fded9", "url": "https://github.com/hortonworks/cloudbreak/commit/a6a45754e139a6d174cc3a915a53415daa1fded9", "message": "CB-8021 Replace DnsV1Endpoint#deleteDnsRecordsByFqdn call with cleanup in CB\n\nIn case of downscale the above mentioned endpoint was invoked.\nThis is not an async call, which could result in timout.\nThis commit moves this call to cleanup, which has polling already.\nAlso some simple refactor is introduced to cleanup code.", "committedDate": "2020-07-20T15:07:06Z", "type": "commit"}, {"oid": "a6a45754e139a6d174cc3a915a53415daa1fded9", "url": "https://github.com/hortonworks/cloudbreak/commit/a6a45754e139a6d174cc3a915a53415daa1fded9", "message": "CB-8021 Replace DnsV1Endpoint#deleteDnsRecordsByFqdn call with cleanup in CB\n\nIn case of downscale the above mentioned endpoint was invoked.\nThis is not an async call, which could result in timout.\nThis commit moves this call to cleanup, which has polling already.\nAlso some simple refactor is introduced to cleanup code.", "committedDate": "2020-07-20T15:07:06Z", "type": "forcePushed"}]}