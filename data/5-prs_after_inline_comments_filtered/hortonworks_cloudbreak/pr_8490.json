{"pr_number": 8490, "pr_title": "AWS ENA check in E2E", "pr_createdAt": "2020-07-06T16:19:13Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8490", "timeline": [{"oid": "691b14bb49de2eb935390caa2783747bfd057803", "url": "https://github.com/hortonworks/cloudbreak/commit/691b14bb49de2eb935390caa2783747bfd057803", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E. Two commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-06T16:19:43Z", "type": "forcePushed"}, {"oid": "f1366a9129b28411ac738cc59dc8e23c046615cb", "url": "https://github.com/hortonworks/cloudbreak/commit/f1366a9129b28411ac738cc59dc8e23c046615cb", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E. Two commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T05:43:38Z", "type": "forcePushed"}, {"oid": "451e19fd35a000b5e1b382e7f16774bc632384bb", "url": "https://github.com/hortonworks/cloudbreak/commit/451e19fd35a000b5e1b382e7f16774bc632384bb", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E. Two commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T05:51:37Z", "type": "forcePushed"}, {"oid": "9e43d4e6b5e005aa1ccd640bc0e14360980f8c02", "url": "https://github.com/hortonworks/cloudbreak/commit/9e43d4e6b5e005aa1ccd640bc0e14360980f8c02", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E. Two commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T06:08:11Z", "type": "forcePushed"}, {"oid": "c6e8a09ddd28dd1263d9a5616ba6de2902f4071a", "url": "https://github.com/hortonworks/cloudbreak/commit/c6e8a09ddd28dd1263d9a5616ba6de2902f4071a", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only.\nTwo commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T06:31:29Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0MTg4Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/8490#discussion_r450641883", "bodyText": "I thought this will be implemented with an API call.", "author": "akanto", "createdAt": "2020-07-07T06:39:55Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/util/ssh/action/SshEnaDriverCheckActions.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package com.sequenceiq.it.cloudbreak.util.ssh.action;\n+\n+import java.util.Collections;\n+import java.util.stream.Stream;\n+\n+import org.apache.commons.lang3.tuple.Pair;\n+import org.slf4j.Logger;\n+import org.slf4j.LoggerFactory;\n+import org.springframework.stereotype.Component;\n+\n+import com.sequenceiq.cloudbreak.api.endpoint.v4.stacks.response.instancegroup.instancemetadata.InstanceMetaDataV4Response;\n+import com.sequenceiq.cloudbreak.common.json.Json;\n+import com.sequenceiq.cloudbreak.common.mappable.CloudPlatform;\n+import com.sequenceiq.it.cloudbreak.CloudbreakClient;\n+import com.sequenceiq.it.cloudbreak.dto.distrox.DistroXTestDto;\n+import com.sequenceiq.it.cloudbreak.exception.TestFailException;\n+import com.sequenceiq.it.cloudbreak.util.ssh.client.SshJClient;\n+\n+@Component\n+public class SshEnaDriverCheckActions extends SshJClient {\n+\n+    private static final Logger LOGGER = LoggerFactory.getLogger(SshEnaDriverCheckActions.class);\n+\n+    private void checkEnaDriver(String instanceIP) {\n+        String modinfoEnaCmd = \"/usr/sbin/modinfo ena\";\n+        String wrongResult = \"modinfo: ERROR: Module ena not found.\";\n+        Pair<Integer, String> result = executeCommand(instanceIP, modinfoEnaCmd);\n+        if (result.getValue().startsWith(wrongResult)) {\n+            throw new TestFailException(\"Cannot find ena driver on the instance\");\n+        }\n+    }\n+\n+    private void checkEnaSupport(String instanceIP, String instanceId, String region) {\n+        String modinfoEnaCmd = String.format(\"aws ec2 describe-instances --instance-ids %s --query \\\"Reservations[].Instances[].EnaSupport\\\" --region %s\",", "originalCommit": "c6e8a09ddd28dd1263d9a5616ba6de2902f4071a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0NTkxMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8490#discussion_r450645912", "bodyText": "I'm going to rewrite to an API call", "author": "topolyai5", "createdAt": "2020-07-07T06:50:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDY0MTg4Mw=="}], "type": "inlineReview"}, {"oid": "42a313c23028ba3a5669c06066222ddda520e80f", "url": "https://github.com/hortonworks/cloudbreak/commit/42a313c23028ba3a5669c06066222ddda520e80f", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only.\nTwo commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T07:43:17Z", "type": "forcePushed"}, {"oid": "3e6aa74295554ff090aa5399379cfe6ba1357a0f", "url": "https://github.com/hortonworks/cloudbreak/commit/3e6aa74295554ff090aa5399379cfe6ba1357a0f", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only.\nTwo commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T07:46:17Z", "type": "forcePushed"}, {"oid": "bc8f0801a268ac571d5679b10bb1896ae7a13e26", "url": "https://github.com/hortonworks/cloudbreak/commit/bc8f0801a268ac571d5679b10bb1896ae7a13e26", "message": "CB-7778 AWS ENA check in E2E\nNow the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only.\nTwo commands will be checked:\n* /usr/sbin/modinfo ena\n* aws ec2 describe-instances --instance-ids iid--query \"Reservations[].Instances[].EnaSupport\" --region region", "committedDate": "2020-07-07T08:42:19Z", "type": "forcePushed"}, {"oid": "16b0880355873e6e1e728754e46494e05d0eda50", "url": "https://github.com/hortonworks/cloudbreak/commit/16b0880355873e6e1e728754e46494e05d0eda50", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-04T07:10:49Z", "type": "forcePushed"}, {"oid": "b0110013a62d593ca96ca2bc424e605d40f925b1", "url": "https://github.com/hortonworks/cloudbreak/commit/b0110013a62d593ca96ca2bc424e605d40f925b1", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-04T10:07:40Z", "type": "forcePushed"}, {"oid": "fdfb575aa627f3b2e9a00faa1782abe9c4dc2184", "url": "https://github.com/hortonworks/cloudbreak/commit/fdfb575aa627f3b2e9a00faa1782abe9c4dc2184", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-04T12:22:29Z", "type": "forcePushed"}, {"oid": "dc416ac5b70e6153c884072e87fd5648778ffcbb", "url": "https://github.com/hortonworks/cloudbreak/commit/dc416ac5b70e6153c884072e87fd5648778ffcbb", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-04T13:54:27Z", "type": "forcePushed"}, {"oid": "c8088a5bab4c278e57d9fc820909793b7ad7dd80", "url": "https://github.com/hortonworks/cloudbreak/commit/c8088a5bab4c278e57d9fc820909793b7ad7dd80", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-06T14:23:14Z", "type": "forcePushed"}, {"oid": "9696d820414dc85ed133ea9477dd3f1df07a7662", "url": "https://github.com/hortonworks/cloudbreak/commit/9696d820414dc85ed133ea9477dd3f1df07a7662", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-06T16:26:04Z", "type": "commit"}, {"oid": "9696d820414dc85ed133ea9477dd3f1df07a7662", "url": "https://github.com/hortonworks/cloudbreak/commit/9696d820414dc85ed133ea9477dd3f1df07a7662", "message": "CB-7778 AWS ENA check in E2E Now the ena driver is enabled on AWS instances by default. We should check this value via E2E and on AWS only. Two commands will be checked: * /usr/sbin/modinfo ena * aws ec2 describe-instances --instance-ids iid--query Reservations[].Instances[].EnaSupport --region region", "committedDate": "2020-08-06T16:26:04Z", "type": "forcePushed"}]}