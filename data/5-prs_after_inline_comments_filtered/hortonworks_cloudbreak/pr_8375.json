{"pr_number": 8375, "pr_title": "CB-7615 Add resource based authz for recipes", "pr_createdAt": "2020-06-23T09:38:20Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8375", "timeline": [{"oid": "3e643e2dcb02befe61c0a5d9210d48bb7cd2ae0f", "url": "https://github.com/hortonworks/cloudbreak/commit/3e643e2dcb02befe61c0a5d9210d48bb7cd2ae0f", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T09:50:58Z", "type": "forcePushed"}, {"oid": "deb1a8bc8b63122039b23b96582150b801f9322d", "url": "https://github.com/hortonworks/cloudbreak/commit/deb1a8bc8b63122039b23b96582150b801f9322d", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T13:38:18Z", "type": "forcePushed"}, {"oid": "a06d3ec2a039e9439a6e09e0b9a947243e47668e", "url": "https://github.com/hortonworks/cloudbreak/commit/a06d3ec2a039e9439a6e09e0b9a947243e47668e", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T14:02:58Z", "type": "forcePushed"}, {"oid": "16d4d897da1a3364ca988759810ad4e9357c244b", "url": "https://github.com/hortonworks/cloudbreak/commit/16d4d897da1a3364ca988759810ad4e9357c244b", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T14:11:20Z", "type": "forcePushed"}, {"oid": "73308c3c56a2b2c76844e12cd923a739c2ae4f88", "url": "https://github.com/hortonworks/cloudbreak/commit/73308c3c56a2b2c76844e12cd923a739c2ae4f88", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T14:20:58Z", "type": "forcePushed"}, {"oid": "2a2216d8994896eb02122b23ba20d231013c9658", "url": "https://github.com/hortonworks/cloudbreak/commit/2a2216d8994896eb02122b23ba20d231013c9658", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T14:33:01Z", "type": "forcePushed"}, {"oid": "9824e8ea7f1001b3e45eb7fd425983696908a49e", "url": "https://github.com/hortonworks/cloudbreak/commit/9824e8ea7f1001b3e45eb7fd425983696908a49e", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T15:34:13Z", "type": "forcePushed"}, {"oid": "d1350d05ec64f926e98e3dde11b1e01e6eeb079e", "url": "https://github.com/hortonworks/cloudbreak/commit/d1350d05ec64f926e98e3dde11b1e01e6eeb079e", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-23T16:35:09Z", "type": "forcePushed"}, {"oid": "bec2fe409a6c5e74480656c419a17bcce99ee7d6", "url": "https://github.com/hortonworks/cloudbreak/commit/bec2fe409a6c5e74480656c419a17bcce99ee7d6", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T07:06:12Z", "type": "forcePushed"}, {"oid": "bec2fe409a6c5e74480656c419a17bcce99ee7d6", "url": "https://github.com/hortonworks/cloudbreak/commit/bec2fe409a6c5e74480656c419a17bcce99ee7d6", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T07:06:12Z", "type": "forcePushed"}, {"oid": "2fec7b9f9c3d807de862aeb1673bafe920629087", "url": "https://github.com/hortonworks/cloudbreak/commit/2fec7b9f9c3d807de862aeb1673bafe920629087", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T10:15:08Z", "type": "forcePushed"}, {"oid": "e730b3980f6ad3f158ccad4e0a79a77edaceba22", "url": "https://github.com/hortonworks/cloudbreak/commit/e730b3980f6ad3f158ccad4e0a79a77edaceba22", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T10:57:42Z", "type": "forcePushed"}, {"oid": "9963383d63dcbc3e20777ea4d8c2de27f1c5fbd6", "url": "https://github.com/hortonworks/cloudbreak/commit/9963383d63dcbc3e20777ea4d8c2de27f1c5fbd6", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T11:45:13Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkzMzg3NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8375#discussion_r444933875", "bodyText": "We should remove this endpoint?\nCan we do a lookup in kibana if it's still used or not? There should be a controller interceptor for it.", "author": "lnardai", "createdAt": "2020-06-24T14:26:20Z", "path": "core/src/main/java/com/sequenceiq/cloudbreak/controller/v4/RecipesV4Controller.java", "diffHunk": "@@ -67,33 +81,38 @@ public RecipeV4Response post(Long workspaceId, RecipeV4Request request) {\n     }\n \n     @Override\n-    public RecipeV4Response deleteByName(Long workspaceId, String name) {\n+    @CheckPermissionByResourceName(action = AuthorizationResourceAction.DELETE_RECIPE)\n+    public RecipeV4Response deleteByName(Long workspaceId, @ResourceName String name) {\n         Recipe deleted = recipeService.delete(NameOrCrn.ofName(name), workspaceId);\n         notify(ResourceEvent.RECIPE_DELETED);\n         return converterUtil.convert(deleted, RecipeV4Response.class);\n     }\n \n     @Override\n-    public RecipeV4Response deleteByCrn(Long workspaceId, @NotNull String crn) {\n+    @CheckPermissionByResourceCrn(action = AuthorizationResourceAction.DELETE_RECIPE)\n+    public RecipeV4Response deleteByCrn(Long workspaceId, @NotNull @ResourceCrn String crn) {\n         Recipe deleted = recipeService.delete(NameOrCrn.ofCrn(crn), workspaceId);\n         notify(ResourceEvent.RECIPE_DELETED);\n         return converterUtil.convert(deleted, RecipeV4Response.class);\n     }\n \n     @Override\n-    public RecipeV4Responses deleteMultiple(Long workspaceId, Set<String> names) {\n+    @CheckPermissionByResourceNameList(action = AuthorizationResourceAction.DELETE_RECIPE)\n+    public RecipeV4Responses deleteMultiple(Long workspaceId, @ResourceNameList Set<String> names) {\n         Set<Recipe> deleted = recipeService.deleteMultipleByNameFromWorkspace(names, workspaceId);\n         notify(ResourceEvent.RECIPE_DELETED);\n         return new RecipeV4Responses(converterUtil.convertAllAsSet(deleted, RecipeV4Response.class));\n     }\n \n     @Override\n+    @DisableCheckPermissions", "originalCommit": "9963383d63dcbc3e20777ea4d8c2de27f1c5fbd6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkzNjM5MQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8375#discussion_r444936391", "bodyText": "I am not sure, I haven't checked, I just think that this endpoint is not a security risk anyway", "author": "horadla23", "createdAt": "2020-06-24T14:29:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkzMzg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk0MDEwOQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8375#discussion_r444940109", "bodyText": "Well, you can read anybody's recipe and it can contain sensitive information.", "author": "lnardai", "createdAt": "2020-06-24T14:34:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkzMzg3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDk0NjAxOA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8375#discussion_r444946018", "bodyText": "yes, you're right, fixed", "author": "horadla23", "createdAt": "2020-06-24T14:41:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDkzMzg3NQ=="}], "type": "inlineReview"}, {"oid": "ccd3f0b26475106995aa6ee18b0426c3e38b880d", "url": "https://github.com/hortonworks/cloudbreak/commit/ccd3f0b26475106995aa6ee18b0426c3e38b880d", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T14:41:28Z", "type": "forcePushed"}, {"oid": "77caeea84a154545bd14bf844f8f10a6ef3f261a", "url": "https://github.com/hortonworks/cloudbreak/commit/77caeea84a154545bd14bf844f8f10a6ef3f261a", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T14:42:39Z", "type": "commit"}, {"oid": "77caeea84a154545bd14bf844f8f10a6ef3f261a", "url": "https://github.com/hortonworks/cloudbreak/commit/77caeea84a154545bd14bf844f8f10a6ef3f261a", "message": "CB-7615 Add resource based authz for recipes", "committedDate": "2020-06-24T14:42:39Z", "type": "forcePushed"}]}