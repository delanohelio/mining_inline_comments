{"pr_number": 8935, "pr_title": "CB-7938: Enable delete protection for RDS to avoid accidental deletions.", "pr_createdAt": "2020-09-05T01:15:06Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8935", "timeline": [{"oid": "18383da33481999e2be15d8d43d45f687dd83252", "url": "https://github.com/hortonworks/cloudbreak/commit/18383da33481999e2be15d8d43d45f687dd83252", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions.", "committedDate": "2020-09-05T01:10:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTQwNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r484205406", "bodyText": "isDeleteProtectionEnabled", "author": "doktoric", "createdAt": "2020-09-07T06:22:20Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsRdsStatusLookupService.java", "diffHunk": "@@ -44,6 +49,28 @@ public ExternalDatabaseStatus getStatus(AuthenticatedContext ac, DatabaseStack d\n                 .get();\n     }\n \n+    public boolean isDeleteProtectonEnabled(AuthenticatedContext ac, DatabaseStack dbStack) {", "originalCommit": "18383da33481999e2be15d8d43d45f687dd83252", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NTU4NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r485065585", "bodyText": "fixed.", "author": "kkalvagadda1", "createdAt": "2020-09-08T16:56:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTUxMA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r484205510", "bodyText": "isDeleteProtectionEnabled", "author": "doktoric", "createdAt": "2020-09-07T06:22:40Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/connector/resource/AwsResourceConnector.java", "diffHunk": "@@ -118,6 +121,10 @@ private boolean deployingToSameVPC(AwsNetworkView awsNetworkView, boolean existi\n     @Override\n     public List<CloudResourceStatus> terminateDatabaseServer(AuthenticatedContext ac, DatabaseStack stack,\n             List<CloudResource> resources, PersistenceNotifier persistenceNotifier, boolean force) throws Exception {\n+        if(awsRdsStatusLookupService.isDeleteProtectonEnabled(ac, stack)) {", "originalCommit": "18383da33481999e2be15d8d43d45f687dd83252", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NTUwMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r485065501", "bodyText": "fixed.", "author": "kkalvagadda1", "createdAt": "2020-09-08T16:56:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTUxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTcxNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r484205716", "bodyText": "available ?", "author": "doktoric", "createdAt": "2020-09-07T06:23:11Z", "path": "cloud-aws/src/main/java/com/sequenceiq/cloudbreak/cloud/aws/scheduler/CustomAmazonWaiterProvider.java", "diffHunk": "@@ -81,4 +81,37 @@ public WaiterState getState() {\n                         new FixedDelayStrategy(DEFAULT_DELAY_IN_SECONDS)))\n                 .withExecutorService(WaiterExecutorServiceFactory.buildExecutorServiceForWaiter(\"AmazonRDSWaiters\")).build();\n     }\n+\n+    public Waiter<DescribeDBInstancesRequest> getDbInstanceModifyWaiter(AmazonRDS rdsClient) {\n+        return new WaiterBuilder<DescribeDBInstancesRequest, DescribeDBInstancesResult>()\n+                .withSdkFunction(new DescribeDBInstancesFunction(rdsClient))\n+                .withAcceptors(new WaiterAcceptor<DescribeDBInstancesResult>() {\n+                    @Override\n+                    public boolean matches(DescribeDBInstancesResult describeDBInstancesResult) {\n+                        return describeDBInstancesResult.getDBInstances().stream().allMatch(instance -> \"avaialble\".equals(instance.getDBInstanceStatus()));", "originalCommit": "18383da33481999e2be15d8d43d45f687dd83252", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NTA2NTk5OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8935#discussion_r485065998", "bodyText": "yes. Updated.", "author": "kkalvagadda1", "createdAt": "2020-09-08T16:57:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDIwNTcxNg=="}], "type": "inlineReview"}, {"oid": "19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "url": "https://github.com/hortonworks/cloudbreak/commit/19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions. Addressed review comments and also fixed the style check errors.", "committedDate": "2020-09-08T16:57:38Z", "type": "commit"}, {"oid": "19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "url": "https://github.com/hortonworks/cloudbreak/commit/19e60d9d007025ea48d5b4efbbaa843fa2be30e9", "message": "CB-7938: Enable delete protection for RDS to avoid accidental deletions. Addressed review comments and also fixed the style check errors.", "committedDate": "2020-09-08T16:57:38Z", "type": "forcePushed"}]}