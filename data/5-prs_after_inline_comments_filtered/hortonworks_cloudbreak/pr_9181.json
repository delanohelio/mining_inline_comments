{"pr_number": 9181, "pr_title": "CB-9103 send renewCertificate as internal actor to cloudbreak from da\u2026", "pr_createdAt": "2020-10-08T14:24:50Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9181", "timeline": [{"oid": "fe803524cb5cc1b08aa4de0eb2987d27eac9ce27", "url": "https://github.com/hortonworks/cloudbreak/commit/fe803524cb5cc1b08aa4de0eb2987d27eac9ce27", "message": "CB-9103 send renewCertificate as internal actor to cloudbreak from datalake", "committedDate": "2020-10-08T14:26:18Z", "type": "commit"}, {"oid": "fe803524cb5cc1b08aa4de0eb2987d27eac9ce27", "url": "https://github.com/hortonworks/cloudbreak/commit/fe803524cb5cc1b08aa4de0eb2987d27eac9ce27", "message": "CB-9103 send renewCertificate as internal actor to cloudbreak from datalake", "committedDate": "2020-10-08T14:26:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc3OTg2NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9181#discussion_r501779865", "bodyText": "should we cover this with a unit test ? I guess this is a bugfix so would be great to see some unit change for this.", "author": "doktoric", "createdAt": "2020-10-08T14:45:39Z", "path": "datalake/src/main/java/com/sequenceiq/datalake/service/sdx/SdxService.java", "diffHunk": "@@ -727,6 +727,8 @@ public SdxCluster save(SdxCluster sdxCluster) {\n     }\n \n     public void renewCertificate(SdxCluster sdxCluster, String userCrn) {\n-        stackV4Endpoint.renewCertificate(0L, sdxCluster.getClusterName(), userCrn);\n+        ThreadBasedUserCrnProvider.doAsInternalActor(() -> {", "originalCommit": "fe803524cb5cc1b08aa4de0eb2987d27eac9ce27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc4NzQxMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9181#discussion_r501787413", "bodyText": "unfortunately, it seems to be hard to test this. The doAsInternalActor modifies a thread-local variable and later the ApiClientRequestFilter reads this in filterchain, so in unit test there is no chance to test this, maybe with some spring integration test.", "author": "sodre90", "createdAt": "2020-10-08T14:54:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMTc3OTg2NQ=="}], "type": "inlineReview"}]}