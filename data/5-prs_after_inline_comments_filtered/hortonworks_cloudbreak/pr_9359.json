{"pr_number": 9359, "pr_title": "CB-9270 [GCP] Do not set hostnames for non-freeipa hosts while creati\u2026", "pr_createdAt": "2020-11-03T02:21:25Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9359", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY2MTk3Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/9359#discussion_r516661976", "bodyText": "getHostName(Group group, int privateId) ?", "author": "doktoric", "createdAt": "2020-11-03T13:23:38Z", "path": "cloud-gcp/src/main/java/com/sequenceiq/cloudbreak/cloud/gcp/compute/GcpInstanceResourceBuilder.java", "diffHunk": "@@ -213,10 +217,15 @@ String getPublicKey(String groupPublicKey, String groupLoginUserName) {\n         return publicKey;\n     }\n \n-    private String getHostname(CloudStack cloudStack, List<CloudResource> buildableResource) {\n+    private String getHostname(CloudStack cloudStack, int privateId) {", "originalCommit": "54ba088f8430f0a7970a76fdda70471227e37b0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkzMTE0Mw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9359#discussion_r516931143", "bodyText": "Nice suggestion! It simplified the code a lot. Thank you!", "author": "cegganesh84", "createdAt": "2020-11-03T20:16:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY2MTk3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY2MzIyMQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9359#discussion_r516663221", "bodyText": "I think we should implement a cloudStack.type parameter which can get FREEIPA, STACK  values", "author": "doktoric", "createdAt": "2020-11-03T13:25:36Z", "path": "cloud-gcp/src/main/java/com/sequenceiq/cloudbreak/cloud/gcp/compute/GcpInstanceResourceBuilder.java", "diffHunk": "@@ -213,10 +217,15 @@ String getPublicKey(String groupPublicKey, String groupLoginUserName) {\n         return publicKey;\n     }\n \n-    private String getHostname(CloudStack cloudStack, List<CloudResource> buildableResource) {\n+    private String getHostname(CloudStack cloudStack, int privateId) {\n         String hostname = null;\n-        if (!cloudStack.getGroups().isEmpty() && !cloudStack.getGroups().get(0).getInstances().isEmpty()) {\n-            hostname = cloudStack.getGroups().get(0).getInstances().get(0).getStringParameter(CloudInstance.DISCOVERY_NAME);\n+        if (!cloudStack.getGroups().isEmpty() && !cloudStack.getGroups().get(0).getInstances().isEmpty()\n+                && cloudStack.getGroups().get(0).getInstances().get(privateId) != null) {\n+            hostname = cloudStack.getGroups().get(0).getInstances().get(privateId).getStringParameter(CloudInstance.DISCOVERY_NAME);\n+            // Setting hostnames for only FreeIPA hosts\n+            if (hostname == null || !hostname.startsWith(\"ipaserver\")) {", "originalCommit": "54ba088f8430f0a7970a76fdda70471227e37b0e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjkzMTk0NQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9359#discussion_r516931945", "bodyText": "This is a great suggestion. Could you please help me with how the stack name for freeipa got FreeIPA in it? Looks like that is the last place the information is dealt with as an Enum, beyond that they are blended as a string in names. I tried to track that yesterday, but got lost and implemented this simple solution.", "author": "cegganesh84", "createdAt": "2020-11-03T20:18:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY2MzIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjk5MTA5OA==", "url": "https://github.com/hortonworks/cloudbreak/pull/9359#discussion_r516991098", "bodyText": "Hi @doktoric, I tried what seems simple and gets the job done with respect to stack type parameter suggestion. Please review.", "author": "cegganesh84", "createdAt": "2020-11-03T22:24:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNjY2MzIyMQ=="}], "type": "inlineReview"}, {"oid": "a768972433e4df52a228a0b47db39fdeeb16fac3", "url": "https://github.com/hortonworks/cloudbreak/commit/a768972433e4df52a228a0b47db39fdeeb16fac3", "message": "CB-9270 [GCP] Do not set hostnames for non-freeipa hosts while creating the instances\n\n1. If the hostname is not set at creation during FreeIPA bootstrapping they were reset by Google Cloud causing salt script failures that depends on `hostname -f`\n2. But this need not be set for other host groups.\n3. Also for FreeIPA do not hard code single instance, because that assumption breaks down in repair and HA scenarios.\n\n./gradlew build", "committedDate": "2020-11-03T20:14:15Z", "type": "forcePushed"}, {"oid": "3585f0ed9399c6d9cee7816ae684103b4c3c52bd", "url": "https://github.com/hortonworks/cloudbreak/commit/3585f0ed9399c6d9cee7816ae684103b4c3c52bd", "message": "CB-9270 [GCP] Do not set hostnames for non-freeipa hosts while creating the instances\n\n1. If the hostname is not set at creation during FreeIPA bootstrapping they were reset by Google Cloud causing salt script failures that depends on `hostname -f`\n2. But this need not be set for other host groups.\n3. Also for FreeIPA do not hard code single instance, because that assumption breaks down in repair and HA scenarios.\n\n./gradlew build", "committedDate": "2020-11-03T22:22:21Z", "type": "commit"}, {"oid": "3585f0ed9399c6d9cee7816ae684103b4c3c52bd", "url": "https://github.com/hortonworks/cloudbreak/commit/3585f0ed9399c6d9cee7816ae684103b4c3c52bd", "message": "CB-9270 [GCP] Do not set hostnames for non-freeipa hosts while creating the instances\n\n1. If the hostname is not set at creation during FreeIPA bootstrapping they were reset by Google Cloud causing salt script failures that depends on `hostname -f`\n2. But this need not be set for other host groups.\n3. Also for FreeIPA do not hard code single instance, because that assumption breaks down in repair and HA scenarios.\n\n./gradlew build", "committedDate": "2020-11-03T22:22:21Z", "type": "forcePushed"}]}