{"pr_number": 9302, "pr_title": "CB-9472 make authz mock tests runnable from one testsuite", "pr_createdAt": "2020-10-27T12:37:23Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/9302", "timeline": [{"oid": "d379aacb199e593158982b964a870b3b536140a6", "url": "https://github.com/hortonworks/cloudbreak/commit/d379aacb199e593158982b964a870b3b536140a6", "message": "CB-9472 make authz mock tests runnable from one testsuite", "committedDate": "2020-10-27T14:00:33Z", "type": "forcePushed"}, {"oid": "04a134365a99db90169a80fd5fe75552f4c69d77", "url": "https://github.com/hortonworks/cloudbreak/commit/04a134365a99db90169a80fd5fe75552f4c69d77", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- currently we need different suites and jenkins jobs for every authz mock tests based on account and it would be better to use one suite for every authz test with one jenkins job and this commit make is possible to use existing suite to introduce more authz tests even if it is executed for different account and it makes also possible to handle account admins of test users based on account id", "committedDate": "2020-10-27T14:15:44Z", "type": "forcePushed"}, {"oid": "5974bf4ee81c5f68b9cce421caddcfebfedb4519", "url": "https://github.com/hortonworks/cloudbreak/commit/5974bf4ee81c5f68b9cce421caddcfebfedb4519", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit make possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-27T14:30:33Z", "type": "forcePushed"}, {"oid": "d6d0079e15c8cb6c70ab97383518a5dfe5e58962", "url": "https://github.com/hortonworks/cloudbreak/commit/d6d0079e15c8cb6c70ab97383518a5dfe5e58962", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit make possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-27T14:46:52Z", "type": "forcePushed"}, {"oid": "be4a637c032bdd58d54f690f738f006abd35935a", "url": "https://github.com/hortonworks/cloudbreak/commit/be4a637c032bdd58d54f690f738f006abd35935a", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit makes possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-27T14:47:19Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxNzIzNg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9302#discussion_r513317236", "bodyText": "can't we just use the primitive? Constructors could be simpler also.", "author": "lnardai", "createdAt": "2020-10-28T10:01:41Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/actor/CloudbreakUser.java", "diffHunk": "@@ -12,19 +12,30 @@\n \n     private String displayName;\n \n+    private Boolean admin;", "originalCommit": "be4a637c032bdd58d54f690f738f006abd35935a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM1MDAwMw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9302#discussion_r513350003", "bodyText": "sure", "author": "horadla23", "createdAt": "2020-10-28T10:54:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxNzIzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxODc4Mg==", "url": "https://github.com/hortonworks/cloudbreak/pull/9302#discussion_r513318782", "bodyText": "Will this work with the old local setup for dp cli command? Since in that run there is no concept of userCrn.", "author": "lnardai", "createdAt": "2020-10-28T10:04:14Z", "path": "integration-test/src/main/java/com/sequenceiq/it/cloudbreak/context/TestContext.java", "diffHunk": "@@ -336,7 +335,7 @@ T doAction(T entity, Class<? extends MicroserviceClient> clientClass, Action<T,\n \n     protected <T extends CloudbreakTestDto, U extends MicroserviceClient>\n     T doActionAsAdmin(T entity, Class<? extends MicroserviceClient> clientClass, Action<T, U> action, String who) throws Exception {\n-        return action.action(getTestContext(), entity, getAdminMicroserviceClient(clientClass));\n+        return action.action(getTestContext(), entity, getAdminMicroserviceClient(clientClass, Crn.fromString(entity.getCrn()).getAccountId()));", "originalCommit": "be4a637c032bdd58d54f690f738f006abd35935a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzM0Nzk5Nw==", "url": "https://github.com/hortonworks/cloudbreak/pull/9302#discussion_r513347997", "bodyText": "what do you mean by old local setup? i guess tests should run against same version of cbd, or is there some tests which uses older cbd than the version of integration-test.jar? here i am using the crn of the entity, not usercrn, so it should work. (side note: this method is not used, so probably i will delete it when i update this pr with secret versioning change)", "author": "horadla23", "createdAt": "2020-10-28T10:50:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxODc4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzUzNTg1OQ==", "url": "https://github.com/hortonworks/cloudbreak/pull/9302#discussion_r513535859", "bodyText": "removed", "author": "horadla23", "createdAt": "2020-10-28T15:25:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzMxODc4Mg=="}], "type": "inlineReview"}, {"oid": "19e532a6dc5860f8f0344ddb21405cb0c522407d", "url": "https://github.com/hortonworks/cloudbreak/commit/19e532a6dc5860f8f0344ddb21405cb0c522407d", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit makes possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-28T13:48:25Z", "type": "forcePushed"}, {"oid": "a5e4857cdd70565c2cbc56b895668c948b09176f", "url": "https://github.com/hortonworks/cloudbreak/commit/a5e4857cdd70565c2cbc56b895668c948b09176f", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit makes possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-28T14:40:51Z", "type": "forcePushed"}, {"oid": "c0e11a3ef0f3e548246b57914d065c5140e7eb63", "url": "https://github.com/hortonworks/cloudbreak/commit/c0e11a3ef0f3e548246b57914d065c5140e7eb63", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit makes possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-28T15:16:22Z", "type": "forcePushed"}, {"oid": "e6dbeb41a9c0dde99619d34767a8958a5fb79548", "url": "https://github.com/hortonworks/cloudbreak/commit/e6dbeb41a9c0dde99619d34767a8958a5fb79548", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit makes possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-28T15:59:09Z", "type": "commit"}, {"oid": "e6dbeb41a9c0dde99619d34767a8958a5fb79548", "url": "https://github.com/hortonworks/cloudbreak/commit/e6dbeb41a9c0dde99619d34767a8958a5fb79548", "message": "CB-9472 make authz mock tests runnable from one testsuite\n- before this we needed different suites and jenkins jobs for every authz mock tests/account\n- this commit makes possible to:\n  - use one suite for every authz test with one jenkins job even if they are executed against more accounts\n  - handle account admins of test users based on account id", "committedDate": "2020-10-28T15:59:09Z", "type": "forcePushed"}]}