{"pr_number": 8032, "pr_title": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup", "pr_createdAt": "2020-05-13T09:25:04Z", "pr_url": "https://github.com/hortonworks/cloudbreak/pull/8032", "timeline": [{"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a", "url": "https://github.com/hortonworks/cloudbreak/commit/ff94901cfe82a2d52768406dd213a614ff234a6a", "message": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup", "committedDate": "2020-05-13T09:38:57Z", "type": "commit"}, {"oid": "ff94901cfe82a2d52768406dd213a614ff234a6a", "url": "https://github.com/hortonworks/cloudbreak/commit/ff94901cfe82a2d52768406dd213a614ff234a6a", "message": "CB-6967 Use DatabaseStack as resource connector parameter instead of DBInstanceIdentifier and implement Azure status lookup", "committedDate": "2020-05-13T09:38:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyOTU0Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424529546", "bodyText": "Why do we return only these two statuses?", "author": "gergopapi2", "createdAt": "2020-05-13T15:29:01Z", "path": "cloud-azure/src/main/java/com/sequenceiq/cloudbreak/cloud/azure/connector/resource/AzureDatabaseResourceService.java", "diffHunk": "@@ -141,5 +143,22 @@\n                 .name(resourceGroupName)\n                 .build(), ResourceStatus.DELETED));\n     }\n+\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext ac, DatabaseStack stack) {\n+        CloudContext cloudContext = ac.getCloudContext();\n+        AzureClient client = ac.getParameter(AzureClient.class);\n+        String resourceGroupName = azureUtils.getResourceGroupName(cloudContext, stack);\n+\n+        try {\n+            ResourceGroup resourceGroup = client.getResourceGroup(resourceGroupName);\n+            if (resourceGroup == null) {\n+                return ExternalDatabaseStatus.DELETED;\n+            }\n+            return ExternalDatabaseStatus.STARTED;", "originalCommit": "ff94901cfe82a2d52768406dd213a614ff234a6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDk5NzIxMg==", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424997212", "bodyText": "Because other ExternalDatabaseStatuses are irrelevant on Azure at this point. Azure does not support simple start/stop functionality like AWS.", "author": "pkedvessy", "createdAt": "2020-05-14T09:26:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyOTU0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNzQ2Ng==", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r424927466", "bodyText": "Question: during a mock test is the status sync running? If yes, it might then break the test.", "author": "gergopapi2", "createdAt": "2020-05-14T07:32:31Z", "path": "cloud-mock/src/main/java/com/sequenceiq/cloudbreak/cloud/mock/MockResourceConnector.java", "diffHunk": "@@ -193,17 +193,17 @@ public String getDBStackTemplate() throws TemplatingDoesNotSupportedException {\n     }\n \n     @Override\n-    public void startDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void startDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server start operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) {\n+    public void stopDatabaseServer(AuthenticatedContext authenticatedContext, DatabaseStack stack) {\n         throw new UnsupportedOperationException(\"Database server stop operation is not supported for \" + getClass().getName());\n     }\n \n     @Override\n-    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, String dbInstanceIdentifier) throws Exception {\n+    public ExternalDatabaseStatus getDatabaseServerStatus(AuthenticatedContext authenticatedContext, DatabaseStack stack) throws Exception {\n         throw new UnsupportedOperationException(\"Database server status lookup is not supported for \" + getClass().getName());", "originalCommit": "ff94901cfe82a2d52768406dd213a614ff234a6a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTAwMDI5MA==", "url": "https://github.com/hortonworks/cloudbreak/pull/8032#discussion_r425000290", "bodyText": "Do you mean the exception might break the test? I don't think it is the case as I'm not aware of any breaking test in connection with this exception. It got introduced more than a month ago.", "author": "pkedvessy", "createdAt": "2020-05-14T09:31:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkyNzQ2Ng=="}], "type": "inlineReview"}]}