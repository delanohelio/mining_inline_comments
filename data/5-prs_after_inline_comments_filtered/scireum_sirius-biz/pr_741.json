{"pr_number": 741, "pr_title": "Improves alias handling and permits to suppress tenant checks.", "pr_createdAt": "2020-05-07T12:28:46Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/741", "timeline": [{"oid": "a629fb616e606aa130a4a36a09acc42059676b80", "url": "https://github.com/scireum/sirius-biz/commit/a629fb616e606aa130a4a36a09acc42059676b80", "message": "Centralizes alias handling.\n\nWe now always add the name and label of a field as an alias\ninto the import handler. This was previously performed in the\nBaseImportHandler when also loading the aliases from the\nconfig.\n\nHowever, this doesn't work for manually created aliases,\ntherefore this was moved into the dictionary itself.\n\nWe also keep the aliases in an non-normalized state for reporting\nthem to the user in a proper way.\n\nFinally, we only report a fatal alias error, if the alias points to another\nfield. Everything else is only reported if a config error is present in the\nsystem configuration.", "committedDate": "2020-05-07T12:03:56Z", "type": "commit"}, {"oid": "06806f9f26087414217988c8f0c2f3c6ce875b46", "url": "https://github.com/scireum/sirius-biz/commit/06806f9f26087414217988c8f0c2f3c6ce875b46", "message": "Removes an unnecessary parameter and moves a method to its proper location.", "committedDate": "2020-05-07T12:04:24Z", "type": "commit"}, {"oid": "52855e2f941d1dead7352c0d18a9bb0e5fc34e0d", "url": "https://github.com/scireum/sirius-biz/commit/52855e2f941d1dead7352c0d18a9bb0e5fc34e0d", "message": "Moves a method into the real implementation classes.", "committedDate": "2020-05-07T12:25:45Z", "type": "commit"}, {"oid": "97098d7763c9a01a76f13f720eb356bb317dc2f0", "url": "https://github.com/scireum/sirius-biz/commit/97098d7763c9a01a76f13f720eb356bb317dc2f0", "message": "Permits to skip the tenant checks when importing TenantAware entities.\n\nSometimes special jobs / tasks require to modify data of a child or parent tenant,\nor in the case of the system tenant, of any other tenant. Therefore the framework\ncan be requested to skip then tenant check.", "committedDate": "2020-05-07T12:27:00Z", "type": "commit"}, {"oid": "acc16219be3643447fed0b07bf3961721ab58116", "url": "https://github.com/scireum/sirius-biz/commit/acc16219be3643447fed0b07bf3961721ab58116", "message": "Removes a tricky check suppression.\n\nNow each job requiring this behavior can call .skipTenantChecks\non the modified entities.", "committedDate": "2020-05-07T12:28:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwNTAzOA==", "url": "https://github.com/scireum/sirius-biz/pull/741#discussion_r425705038", "bodyText": "Die Fehlermeldung passt nicht! Das alte alias wird ja ersetzt...", "author": "qw3ry", "createdAt": "2020-05-15T10:16:21Z", "path": "src/main/java/sirius/biz/importer/format/ImportDictionary.java", "diffHunk": "@@ -83,17 +83,24 @@ public ImportDictionary addField(FieldDefinition field) {\n \n         this.fields.put(field.getName(), field);\n \n-        for (String alias : field.getAliases()) {\n-            if (aliases.containsKey(alias)) {\n-                throw new IllegalArgumentException(Strings.apply(\"An alias named '%s' is already present!\", alias));\n-            }\n-\n-            aliases.put(alias, field.getName());\n-        }\n+        addCheckedAlias(field, field.getName());\n+        addCheckedAlias(field, field.getLabel());\n+        field.getAliases().forEach(alias -> addCheckedAlias(field, alias));\n \n         return this;\n     }\n \n+    private void addCheckedAlias(FieldDefinition field, String alias) {\n+        String previousField = aliases.put(normalize(alias), field.getName());\n+        if (Strings.isFilled(previousField) && !Strings.areEqual(field.getName(), previousField)) {\n+            throw new IllegalArgumentException(Strings.apply(\n+                    \"Cannot add alias '%s' for field '%s', as this alias already points to '%s'!\",\n+                    alias,\n+                    field.getName(),\n+                    previousField));\n+        }", "originalCommit": "acc16219be3643447fed0b07bf3961721ab58116", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwNTMxMw==", "url": "https://github.com/scireum/sirius-biz/pull/741#discussion_r425705313", "bodyText": "also entweder putIfAbsent oder Fehlermeldung anpassen", "author": "qw3ry", "createdAt": "2020-05-15T10:16:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwNTAzOA=="}], "type": "inlineReview"}, {"oid": "f7ecf66e265191c965a3960952dc5c932def5875", "url": "https://github.com/scireum/sirius-biz/commit/f7ecf66e265191c965a3960952dc5c932def5875", "message": "Only adds an alias if none is present.", "committedDate": "2020-05-19T11:33:12Z", "type": "commit"}, {"oid": "b93e6511f16a611c620e8497e7b2737f3e12d573", "url": "https://github.com/scireum/sirius-biz/commit/b93e6511f16a611c620e8497e7b2737f3e12d573", "message": "Merge remote-tracking branch 'origin/master' into aha/field-aliases-fix", "committedDate": "2020-05-19T11:33:36Z", "type": "commit"}, {"oid": "b93e6511f16a611c620e8497e7b2737f3e12d573", "url": "https://github.com/scireum/sirius-biz/commit/b93e6511f16a611c620e8497e7b2737f3e12d573", "message": "Merge remote-tracking branch 'origin/master' into aha/field-aliases-fix", "committedDate": "2020-05-19T11:33:36Z", "type": "forcePushed"}]}