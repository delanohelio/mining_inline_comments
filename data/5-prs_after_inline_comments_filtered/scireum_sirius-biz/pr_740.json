{"pr_number": 740, "pr_title": "Update and misc fixes.", "pr_createdAt": "2020-05-06T21:24:53Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/740", "timeline": [{"oid": "9bf139f5d7739aa4c083d8e1a90a690836ff8c83", "url": "https://github.com/scireum/sirius-biz/commit/9bf139f5d7739aa4c083d8e1a90a690836ff8c83", "message": "Updates to the latest sirius versions.", "committedDate": "2020-05-06T12:59:49Z", "type": "commit"}, {"oid": "ee81aefae569c4e3eb04ce8486f3c238bf41d95e", "url": "https://github.com/scireum/sirius-biz/commit/ee81aefae569c4e3eb04ce8486f3c238bf41d95e", "message": "Removes an unused redundant field.", "committedDate": "2020-05-06T13:01:38Z", "type": "commit"}, {"oid": "0c6b0c2b1b4afa68d139541a6ad9c194d179d606", "url": "https://github.com/scireum/sirius-biz/commit/0c6b0c2b1b4afa68d139541a6ad9c194d179d606", "message": "Makes the BasePageHelper aware of the debugging mode.\n\nIf a query is prefixed with \"??\" we will output the effective\nquery as user message.", "committedDate": "2020-05-06T13:04:10Z", "type": "commit"}, {"oid": "d7a23655779800ed792b71af0229755c49631140", "url": "https://github.com/scireum/sirius-biz/commit/d7a23655779800ed792b71af0229755c49631140", "message": "Completes a refactoring in sirius-db.\n\nWe made DateRange a fully immutable class and\nnow have to manually carry the \"useLocalDate\" along.", "committedDate": "2020-05-06T13:05:24Z", "type": "commit"}, {"oid": "699fcfc5f75d701097d5e1f8b5892f5be49fb0b1", "url": "https://github.com/scireum/sirius-biz/commit/699fcfc5f75d701097d5e1f8b5892f5be49fb0b1", "message": "Fixes the comparison within a template.\n\nOtherwise job presets don't work as\nthe previously selected parameter is always lost.", "committedDate": "2020-05-06T13:06:26Z", "type": "commit"}, {"oid": "090e1c6c28ae79c8f5d3836a94598060d9b080ae", "url": "https://github.com/scireum/sirius-biz/commit/090e1c6c28ae79c8f5d3836a94598060d9b080ae", "message": "Completes a refactoring of sirius-web.\n\nInstead of returning a boolean value, we now\nuse an explicit enum constant.", "committedDate": "2020-05-06T13:07:04Z", "type": "commit"}, {"oid": "1d55fb23f78961124b4539bbc99775bce6292316", "url": "https://github.com/scireum/sirius-biz/commit/1d55fb23f78961124b4539bbc99775bce6292316", "message": "Always execute the beforeSaveHandlers bevor performing the isChanged check.\n\nWe might fill a computed field which marks the entity as changed\n(even in the \"created\" case). This is highly unlikely, but consistent.", "committedDate": "2020-05-06T13:10:46Z", "type": "commit"}, {"oid": "d2d836ca3b3b48969d627ba996634e66dbabf5fa", "url": "https://github.com/scireum/sirius-biz/commit/d2d836ca3b3b48969d627ba996634e66dbabf5fa", "message": "Only updates or creates a MongoEntity if it was changed.\n\nThe same code was already present in the SQLEntityImportHandler.", "committedDate": "2020-05-06T13:12:12Z", "type": "commit"}, {"oid": "867150f6bd08c893f081e560d2b5104d6fa2023f", "url": "https://github.com/scireum/sirius-biz/commit/867150f6bd08c893f081e560d2b5104d6fa2023f", "message": "Disabled batch updates/inserts by default.\n\nWe ran into several problems with MariaDB when performing concurrent\nbatch updates. This happens, as during a batch run, sections of the primary\nkey get locked which might lead to a deadlock within MariaDB if concurrent\nbatches update the same table (which isn't that unlikely).\n\nAs this would/will abort one batch update/transaction and therefore would\nlead to dataloss / an abort of an import, we rather play safe (by default),\nand always succeed.", "committedDate": "2020-05-06T13:14:38Z", "type": "commit"}, {"oid": "0eb48b0d3fe7ea8013d87e2e91fd4ebe1ab777dd", "url": "https://github.com/scireum/sirius-biz/commit/0eb48b0d3fe7ea8013d87e2e91fd4ebe1ab777dd", "message": "Permits to supply a default value for a DataRangeParameter.\n\nWe apply this parameter if the given value is null,\nwhich signals that the initial context is setup.\n\nIf the value is \"\", we no longer apply the default, as this is\na post value and we still need to support optional parameters.", "committedDate": "2020-05-06T21:03:02Z", "type": "commit"}, {"oid": "5d1524dda53085fa9e691b1451d427565288b43d", "url": "https://github.com/scireum/sirius-biz/commit/5d1524dda53085fa9e691b1451d427565288b43d", "message": "Adds some helper constructors and a default label for the date range parameter.", "committedDate": "2020-05-06T21:03:30Z", "type": "commit"}, {"oid": "d4d738e1a49eabadb1b3f15a4b51d782312877ba", "url": "https://github.com/scireum/sirius-biz/commit/d4d738e1a49eabadb1b3f15a4b51d782312877ba", "message": "Fixes the default value handling when also supporting optional parameters.\n\nWe apply this parameter if the given value is null,\nwhich signals that the initial context is setup.\n\nIf the value is \"\", we no longer apply the default, as this is\na post value and we still need to support optional parameters.", "committedDate": "2020-05-06T21:03:57Z", "type": "commit"}, {"oid": "675ed05aeccd655514fcfa92b83dae4cfcf95d86", "url": "https://github.com/scireum/sirius-biz/commit/675ed05aeccd655514fcfa92b83dae4cfcf95d86", "message": "Extracts commonly used parameters.", "committedDate": "2020-05-06T21:14:48Z", "type": "commit"}, {"oid": "6636fd4055b348f8471b924804766ee0aab9de5c", "url": "https://github.com/scireum/sirius-biz/commit/6636fd4055b348f8471b924804766ee0aab9de5c", "message": "Provides a base job which can transform a line based file into another.", "committedDate": "2020-05-06T21:15:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzI4Mw==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257283", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n          \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as these", "author": "sabieber", "createdAt": "2020-05-07T05:59:35Z", "path": "src/main/java/sirius/biz/web/BasePageHelper.java", "diffHunk": "@@ -159,24 +160,27 @@ public B addFacet(Facet facet, BiConsumer<Facet, Q> filter, BiConsumer<Facet, Q>\n     /**\n      * Adds a time series based filter which permits to filter on certain time ranges.\n      *\n-     * @param name   the name of the field to filter on\n-     * @param title  the title of the filter shown to the user\n-     * @param ranges the ranges which are supported as filter values\n+     * @param name         the name of the field to filter on\n+     * @param title        the title of the filter shown to the user\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these", "originalCommit": "d7a23655779800ed792b71af0229755c49631140", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzQwNw==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257407", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n          \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as these", "author": "sabieber", "createdAt": "2020-05-07T05:59:58Z", "path": "src/main/java/sirius/biz/web/ElasticPageHelper.java", "diffHunk": "@@ -120,24 +120,36 @@ protected ElasticPageHelper(ElasticQuery<E> query) {\n     /**\n      * Adds a time series based aggregation.\n      *\n-     * @param field  the field to filter on\n-     * @param ranges the ranges which are supported as filter values\n+     * @param field        the field to filter on\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these", "originalCommit": "d7a23655779800ed792b71af0229755c49631140", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzQ1NA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257454", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n          \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as these", "author": "sabieber", "createdAt": "2020-05-07T06:00:09Z", "path": "src/main/java/sirius/biz/web/ElasticPageHelper.java", "diffHunk": "@@ -120,24 +120,36 @@ protected ElasticPageHelper(ElasticQuery<E> query) {\n     /**\n      * Adds a time series based aggregation.\n      *\n-     * @param field  the field to filter on\n-     * @param ranges the ranges which are supported as filter values\n+     * @param field        the field to filter on\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n+     *                     are entirely differently encoded in the database.\n+     * @param ranges       the ranges which are supported as filter values\n      * @return the helper itself for fluent method calls\n      */\n-    public ElasticPageHelper<E> addTimeAggregation(Mapping field, DateRange... ranges) {\n-        return addTimeAggregation(field, baseQuery.getDescriptor().findProperty(field.toString()).getLabel(), ranges);\n+    public ElasticPageHelper<E> addTimeAggregation(Mapping field, boolean useLocalDate, DateRange... ranges) {\n+        return addTimeAggregation(field,\n+                                  useLocalDate,\n+                                  baseQuery.getDescriptor().findProperty(field.toString()).getLabel(),\n+                                  ranges);\n     }\n \n     /**\n      * Adds a time series based aggregation.\n      *\n-     * @param field  the field to filter on\n-     * @param title  the title of the filter shown to the user\n-     * @param ranges the ranges which are supported as filter values\n+     * @param field        the field to filter on\n+     * @param title        the title of the filter shown to the user\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these", "originalCommit": "d7a23655779800ed792b71af0229755c49631140", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzUyOQ==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257529", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n          \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as these", "author": "sabieber", "createdAt": "2020-05-07T06:00:26Z", "path": "src/main/java/sirius/biz/web/MongoPageHelper.java", "diffHunk": "@@ -89,24 +89,36 @@ protected MongoPageHelper(MongoQuery<E> query) {\n     /**\n      * Adds a time series based aggregation.\n      *\n-     * @param field  the field to filter on\n-     * @param ranges the ranges which are supported as filter values\n+     * @param field        the field to filter on\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these", "originalCommit": "d7a23655779800ed792b71af0229755c49631140", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzU3NQ==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257575", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n          \n          \n            \n                 *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as these", "author": "sabieber", "createdAt": "2020-05-07T06:00:34Z", "path": "src/main/java/sirius/biz/web/MongoPageHelper.java", "diffHunk": "@@ -89,24 +89,36 @@ protected MongoPageHelper(MongoQuery<E> query) {\n     /**\n      * Adds a time series based aggregation.\n      *\n-     * @param field  the field to filter on\n-     * @param ranges the ranges which are supported as filter values\n+     * @param field        the field to filter on\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these\n+     *                     are entirely differently encoded in the database.\n+     * @param ranges       the ranges which are supported as filter values\n      * @return the helper itself for fluent method calls\n      */\n-    public MongoPageHelper<E> addTimeAggregation(Mapping field, DateRange... ranges) {\n-        return addTimeAggregation(field, baseQuery.getDescriptor().findProperty(field.toString()).getLabel(), ranges);\n+    public MongoPageHelper<E> addTimeAggregation(Mapping field, boolean useLocalDate, DateRange... ranges) {\n+        return addTimeAggregation(field,\n+                                  baseQuery.getDescriptor().findProperty(field.toString()).getLabel(),\n+                                  useLocalDate,\n+                                  ranges);\n     }\n \n     /**\n      * Adds a time series based aggregation.\n      *\n-     * @param field  the field to filter on\n-     * @param title  the title of the filter shown to the user\n-     * @param ranges the ranges which are supported as filter values\n+     * @param field        the field to filter on\n+     * @param title        the title of the filter shown to the user\n+     * @param useLocalDate determines if the filter should be applied as {@link java.time.LocalDate} (<tt>true</tt>)\n+     *                     or as {@link java.time.LocalDateTime} (<tt>false</tt>). This is crucial, as a these", "originalCommit": "d7a23655779800ed792b71af0229755c49631140", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1ODQ3OQ==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421258479", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                 *     By default we instantly create or update the entity. Note that if this is set\n          \n          \n            \n                 * By default we instantly create or update the entity. Note that if this is set", "author": "sabieber", "createdAt": "2020-05-07T06:03:21Z", "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportJob.java", "diffHunk": "@@ -175,17 +175,18 @@ protected E fillAndVerify(E entity, Context context) {\n      * Creates or updates the given entity.\n      * <p>\n      * This can be overwritten to use a custom way of persisting data. Also this can be used to perfrom\n-     * post-save activities. Note however, in the default implementation a batch update is used.\n+     * post-save activities.\n      * <p>\n+     *     By default we instantly create or update the entity. Note that if this is set", "originalCommit": "867150f6bd08c893f081e560d2b5104d6fa2023f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1OTQyNA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421259424", "bodyText": "Wieso ist die Methode ned chainbar?", "author": "sabieber", "createdAt": "2020-05-07T06:06:09Z", "path": "src/main/java/sirius/biz/jobs/batch/file/DictionaryBasedImportJobFactory.java", "diffHunk": "@@ -23,11 +23,26 @@\n     /**\n      * Contains the parameter which is used to determine if empty values should be ignored).\n      */\n-    protected final BooleanParameter ignoreEmptyParameter;\n+    protected final BooleanParameter ignoreEmptyParameter = createIgnoreEmptyParameter();\n \n-    protected DictionaryBasedImportJobFactory() {\n+    /**\n+     * Creates the parameter which determines if empty rows should be ignored.\n+     * <p>\n+     * This is provided as a helper method so that other / similar jobs can re-use it.\n+     * We do not re-use the same parameter, as a parameter isn't immutable, so a global constant could\n+     * be easily set into an inconsistent state.\n+     *\n+     * @return the completely initialized parameter.\n+     */\n+    public static BooleanParameter createIgnoreEmptyParameter() {\n+        BooleanParameter ignoreEmptyParameter;\n         ignoreEmptyParameter = new BooleanParameter(\"ignoreEmpty\", \"$DictionaryBasedImportJobFactory.ignoreEmpty\");\n         ignoreEmptyParameter.withDescription(\"$DictionaryBasedImportJobFactory.ignoreEmpty.help\");", "originalCommit": "675ed05aeccd655514fcfa92b83dae4cfcf95d86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1OTUxOQ==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421259519", "bodyText": "sind die alle nicht chainbar?", "author": "sabieber", "createdAt": "2020-05-07T06:06:27Z", "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportJobFactory.java", "diffHunk": "@@ -31,13 +31,28 @@\n     /**\n      * Determines the {@link ImportMode}.\n      */\n-    protected final EnumParameter<ImportMode> importModeParameter;\n+    protected final EnumParameter<ImportMode> importModeParameter = createImportModeParameter();\n \n-    protected EntityImportJobFactory() {\n-        importModeParameter = new EnumParameter<>(\"importMode\", \"$EntityImportJobFactory.importMode\", ImportMode.class);\n+    /**\n+     * Creates the parameter which determines the import mode to use.\n+     * <p>\n+     * This is provided as a helper method so that other / similar jobs can re-use it.\n+     * We do not re-use the same parameter, as a parameter isn't immutable, so a global constant could\n+     * be easily set into an inconsistent state.\n+     *\n+     * @return the completely initialized parameter.\n+     */\n+    public static EnumParameter<ImportMode> createImportModeParameter() {\n+        EnumParameter<ImportMode> importModeParameter =\n+                new EnumParameter<>(\"importMode\", \"$EntityImportJobFactory.importMode\", ImportMode.class);\n         importModeParameter.withDefault(ImportMode.NEW_AND_UPDATES);", "originalCommit": "675ed05aeccd655514fcfa92b83dae4cfcf95d86", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1OTkyNQ==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421259925", "bodyText": "k\u00f6nnen wir die nicht wie bei den anderen jobs schachteln?", "author": "sabieber", "createdAt": "2020-05-07T06:07:42Z", "path": "src/main/java/sirius/biz/jobs/batch/file/LineBasedImportExportJobFactory.java", "diffHunk": "@@ -0,0 +1,45 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.jobs.params.Parameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileOrDirectoryParameter;\n+\n+import java.util.function.Consumer;\n+\n+/**\n+ * Provides a base implementation for batch jobs which transform line based files.\n+ * <p>\n+ * Using a {@link LineBasedImportExportJob} a line based file is read line by line and can write lines\n+ * into the provided (line based) output file.\n+ */\n+public abstract class LineBasedImportExportJobFactory extends LineBasedImportJobFactory {", "originalCommit": "6636fd4055b348f8471b924804766ee0aab9de5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQ4Nzg5NA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421487894", "bodyText": "ich w\u00fcsste wie :-/ - ideas welcome...", "author": "andyHa", "createdAt": "2020-05-07T13:06:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1OTkyNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NTk1Mg==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421255952", "bodyText": "Warum in 2 Zeilen?", "author": "qw3ry", "createdAt": "2020-05-07T05:55:46Z", "path": "src/main/java/sirius/biz/jobs/batch/file/DictionaryBasedImportJobFactory.java", "diffHunk": "@@ -23,11 +23,26 @@\n     /**\n      * Contains the parameter which is used to determine if empty values should be ignored).\n      */\n-    protected final BooleanParameter ignoreEmptyParameter;\n+    protected final BooleanParameter ignoreEmptyParameter = createIgnoreEmptyParameter();\n \n-    protected DictionaryBasedImportJobFactory() {\n+    /**\n+     * Creates the parameter which determines if empty rows should be ignored.\n+     * <p>\n+     * This is provided as a helper method so that other / similar jobs can re-use it.\n+     * We do not re-use the same parameter, as a parameter isn't immutable, so a global constant could\n+     * be easily set into an inconsistent state.\n+     *\n+     * @return the completely initialized parameter.\n+     */\n+    public static BooleanParameter createIgnoreEmptyParameter() {\n+        BooleanParameter ignoreEmptyParameter;\n         ignoreEmptyParameter = new BooleanParameter(\"ignoreEmpty\", \"$DictionaryBasedImportJobFactory.ignoreEmpty\");", "originalCommit": "6636fd4055b348f8471b924804766ee0aab9de5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NjM1MA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421256350", "bodyText": "Hilft uns das in irgendeiner Form weiter? Dann kann man den Konstruktor doch sowieso nur aus den Kindklassen aufrufen?", "author": "qw3ry", "createdAt": "2020-05-07T05:56:56Z", "path": "src/main/java/sirius/biz/jobs/batch/file/EntityImportJobFactory.java", "diffHunk": "@@ -31,13 +31,28 @@\n     /**\n      * Determines the {@link ImportMode}.\n      */\n-    protected final EnumParameter<ImportMode> importModeParameter;\n+    protected final EnumParameter<ImportMode> importModeParameter = createImportModeParameter();\n \n-    protected EntityImportJobFactory() {\n-        importModeParameter = new EnumParameter<>(\"importMode\", \"$EntityImportJobFactory.importMode\", ImportMode.class);\n+    /**\n+     * Creates the parameter which determines the import mode to use.\n+     * <p>\n+     * This is provided as a helper method so that other / similar jobs can re-use it.\n+     * We do not re-use the same parameter, as a parameter isn't immutable, so a global constant could\n+     * be easily set into an inconsistent state.\n+     *\n+     * @return the completely initialized parameter.\n+     */\n+    public static EnumParameter<ImportMode> createImportModeParameter() {\n+        EnumParameter<ImportMode> importModeParameter =\n+                new EnumParameter<>(\"importMode\", \"$EntityImportJobFactory.importMode\", ImportMode.class);\n         importModeParameter.withDefault(ImportMode.NEW_AND_UPDATES);\n         importModeParameter.markRequired();\n         importModeParameter.withDescription(\"$EntityImportJobFactory.importMode.help\");\n+        return importModeParameter;\n+    }\n+\n+    protected EntityImportJobFactory() {\n+        // Makes the constructor protected as this is an abstract class", "originalCommit": "6636fd4055b348f8471b924804766ee0aab9de5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzIyMg==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257222", "bodyText": "Ist in meinen Augen erstmal nur zus\u00e4tzlicher Code, der nix bringt...", "author": "qw3ry", "createdAt": "2020-05-07T05:59:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NjM1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1NzQxOA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421257418", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n             * This is implemented by a {@link LineBasedImportExportJobFactory} and will reaa line based file, process a row\n          \n          \n            \n             * This is implemented by a {@link LineBasedImportExportJobFactory} and will read a line based file, process a row", "author": "qw3ry", "createdAt": "2020-05-07T06:00:02Z", "path": "src/main/java/sirius/biz/jobs/batch/file/LineBasedImportExportJob.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileOrDirectoryParameter;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.kernel.commons.Values;\n+\n+import java.io.IOException;\n+\n+/**\n+ * Provides a job for transforming a line based file into another.\n+ * <p>\n+ * This is implemented by a {@link LineBasedImportExportJobFactory} and will reaa line based file, process a row", "originalCommit": "6636fd4055b348f8471b924804766ee0aab9de5c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MDE5MA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421260190", "bodyText": "Wenn super.close ne Exception wirft, wird der Export-Job nicht geschlossen :(\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    super.close();\n          \n          \n            \n                    exportJob.close();\n          \n          \n            \n                    try (Closeable c = super) {\n          \n          \n            \n                        exportJob.close();\n          \n          \n            \n                    }\n          \n      \n    \n    \n  \n\nDas try with resources macht intern ziemlich viele coole Sachen: https://www.oracle.com/technical-resources/articles/java/trywithresources.html", "author": "qw3ry", "createdAt": "2020-05-07T06:08:31Z", "path": "src/main/java/sirius/biz/jobs/batch/file/LineBasedImportExportJob.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.jobs.batch.file;\n+\n+import sirius.biz.jobs.params.EnumParameter;\n+import sirius.biz.process.ProcessContext;\n+import sirius.biz.storage.layer3.FileOrDirectoryParameter;\n+import sirius.biz.storage.layer3.FileParameter;\n+import sirius.kernel.commons.Values;\n+\n+import java.io.IOException;\n+\n+/**\n+ * Provides a job for transforming a line based file into another.\n+ * <p>\n+ * This is implemented by a {@link LineBasedImportExportJobFactory} and will reaa line based file, process a row\n+ * and output one or more rows into an output file.\n+ */\n+public abstract class LineBasedImportExportJob extends LineBasedImportJob {\n+\n+    protected final LineBasedExportJob exportJob;\n+\n+    /**\n+     * Creates a new job for the given factory, name and process.\n+     *\n+     * @param inputFileParameter   the parameter which is used to derive the import file from\n+     * @param destinationParameter the parameter used to select the destination for the file being written\n+     * @param fileTypeParameter    the file type to use when writing the line based data\n+     * @param process              the process context itself\n+     */\n+    protected LineBasedImportExportJob(FileParameter inputFileParameter,\n+                                       FileOrDirectoryParameter destinationParameter,\n+                                       EnumParameter<ExportFileType> fileTypeParameter,\n+                                       ProcessContext process) {\n+        super(inputFileParameter, process);\n+        this.exportJob = new LineBasedExportJob(destinationParameter, fileTypeParameter, process) {\n+            @Override\n+            protected void executeIntoExport() throws Exception {\n+                // ignored\n+            }\n+\n+            @Override\n+            protected String determineFilenameWithoutExtension() {\n+                return LineBasedImportExportJob.this.determineFilenameWithoutExtension();\n+            }\n+        };\n+    }\n+\n+    /**\n+     * Determines the base name to use for the file.\n+     * <p>\n+     * This will be expanded by the date and also by additional suffixes to generate a unique name. Also the file\n+     * extension as supplied by {@link FileExportJob#determineFileExtension()} will be appended.\n+     *\n+     * @return the base file name to use\n+     */\n+    protected abstract String determineFilenameWithoutExtension();\n+\n+    @Override\n+    public void execute() throws Exception {\n+        exportJob.execute();\n+        super.execute();\n+    }\n+\n+    @Override\n+    public void handleRow(int lineNumber, Values row) {\n+        handleRow(lineNumber, row, exportJob.export);\n+    }\n+\n+    /**\n+     * Invoked for each line in the given input file.\n+     * <p>\n+     * The provided export writes into the selected output file.\n+     * </p>\n+     *\n+     * @param lineNumber the line of the import being processed\n+     * @param row        the data in this line\n+     * @param export     the export to write to\n+     */\n+    protected abstract void handleRow(int lineNumber, Values row, LineBasedExport export);\n+\n+    @Override\n+    public void close() throws IOException {\n+        super.close();\n+        exportJob.close();", "originalCommit": "6636fd4055b348f8471b924804766ee0aab9de5c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTM4NDUzMA==", "url": "https://github.com/scireum/sirius-biz/pull/740#discussion_r421384530", "bodyText": "This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters. Learn more about bidirectional Unicode characters\n\n\n  \n\n\n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    super.close();\n          \n          \n            \n                    exportJob.close();\n          \n          \n            \n                    try(Closeable c1 = super, Closeable c2 = exportJob) {}\n          \n      \n    \n    \n  \n\ngeht nat\u00fcrlich auch, falls es compiliert", "author": "qw3ry", "createdAt": "2020-05-07T09:56:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI2MDE5MA=="}], "type": "inlineReview"}, {"oid": "152348227af68372f86cad3a21d9b899bce7cf40", "url": "https://github.com/scireum/sirius-biz/commit/152348227af68372f86cad3a21d9b899bce7cf40", "message": "Apply suggestions from code review\n\nCo-authored-by: Sascha Bieberstein <sabieber@users.noreply.github.com>\nCo-authored-by: qw3ry <tbe@scireum.de>", "committedDate": "2020-05-07T12:57:53Z", "type": "commit"}, {"oid": "ca23ded3289e8c835de5066ed172222f7492bddb", "url": "https://github.com/scireum/sirius-biz/commit/ca23ded3289e8c835de5066ed172222f7492bddb", "message": "Fixes based on PR review.", "committedDate": "2020-05-07T13:04:53Z", "type": "commit"}, {"oid": "ad2318cbc70d2babb957dc848f6ae1f3e496f879", "url": "https://github.com/scireum/sirius-biz/commit/ad2318cbc70d2babb957dc848f6ae1f3e496f879", "message": "Merge branch 'aha/basic-jobs' of https://github.com/scireum/sirius-biz into aha/basic-jobs", "committedDate": "2020-05-07T13:04:58Z", "type": "commit"}, {"oid": "e2e74bf6cb9a03b8293a861c4440ceb0262eaf96", "url": "https://github.com/scireum/sirius-biz/commit/e2e74bf6cb9a03b8293a861c4440ceb0262eaf96", "message": "Apply suggestions from code review\n\nCo-authored-by: Sascha Bieberstein <sabieber@users.noreply.github.com>", "committedDate": "2020-05-07T13:06:29Z", "type": "commit"}, {"oid": "59934c666a1f797d096d5612c3300bbbcfe3da3b", "url": "https://github.com/scireum/sirius-biz/commit/59934c666a1f797d096d5612c3300bbbcfe3da3b", "message": "Hardens error handling when closing a combined import/export job.", "committedDate": "2020-05-07T13:12:10Z", "type": "commit"}]}