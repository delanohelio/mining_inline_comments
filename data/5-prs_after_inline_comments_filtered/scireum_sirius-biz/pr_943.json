{"pr_number": 943, "pr_title": "Misc Fixes: Replication, Conversion Engine, Processes", "pr_createdAt": "2020-12-17T08:09:29Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/943", "timeline": [{"oid": "e893edb6969c0ac21b1d4038ee3290eb009bccab", "url": "https://github.com/scireum/sirius-biz/commit/e893edb6969c0ac21b1d4038ee3290eb009bccab", "message": "Uses the proper compare method to determine which tasks are executable.", "committedDate": "2020-12-17T08:03:32Z", "type": "commit"}, {"oid": "79028a8a308b817e3bbd7a803759c4b957f53a8b", "url": "https://github.com/scireum/sirius-biz/commit/79028a8a308b817e3bbd7a803759c4b957f53a8b", "message": "Fixes the name of config limits.", "committedDate": "2020-12-17T08:03:57Z", "type": "commit"}, {"oid": "2361dcca67fa692973cb36926e8c6c444204927f", "url": "https://github.com/scireum/sirius-biz/commit/2361dcca67fa692973cb36926e8c6c444204927f", "message": "Increases the conversion performance.\n\nAs the conversion engine not only does the actual conversion\nbut also juggles files from and to the storage engine. We an run\nquite a few conversions in parallel.", "committedDate": "2020-12-17T08:04:49Z", "type": "commit"}, {"oid": "4f67da9919acdb64a1f2a889935c46eb91c87006", "url": "https://github.com/scireum/sirius-biz/commit/4f67da9919acdb64a1f2a889935c46eb91c87006", "message": "Uses a proper way to measure the conversion duration.\n\nWith the previous way, we also included the \"wait time\" when\nthen task is queued.", "committedDate": "2020-12-17T08:05:46Z", "type": "commit"}, {"oid": "478b2ab017c680eef859402271eb7ff169ff996e", "url": "https://github.com/scireum/sirius-biz/commit/478b2ab017c680eef859402271eb7ff169ff996e", "message": "Marks a process as canceled if it is stopped externally.\n\nThis might happen if we shut down the node and the\nprocess gets terminated this way. In this case we must\nmark the process as erroneous as it didn't complete\nits task.", "committedDate": "2020-12-17T08:06:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg5MTYwMA==", "url": "https://github.com/scireum/sirius-biz/pull/943#discussion_r544891600", "bodyText": "Is this enough added precision for now or do we want to track download, conversion and upload duration separately right away?", "author": "sabieber", "createdAt": "2020-12-17T08:15:41Z", "path": "src/main/java/sirius/biz/storage/layer2/BasicBlobStorageSpace.java", "diffHunk": "@@ -1408,12 +1407,14 @@ private V awaitConversionResultAndRetryToFindVariant(B blob, String variantName,\n      * @param variant the variant to generate\n      */\n     private void invokeConversionPipelineAsync(B blob, V variant) {\n-        Watch watch = Watch.start();\n-        conversionEngine.performConversion(blob, variant.getVariantName()).onSuccess(handle -> {\n-            try (FileHandle automaticHandle = handle) {\n+        conversionEngine.performConversion(blob, variant.getVariantName()).onSuccess(handleAndWatch -> {\n+            try (FileHandle automaticHandle = handleAndWatch.getFirst()) {\n                 String physicalKey = keyGenerator.generateId();\n                 getPhysicalSpace().upload(physicalKey, automaticHandle.getFile());\n-                markConversionSuccess(variant, physicalKey, automaticHandle.getFile().length(), watch.elapsedMillis());\n+                markConversionSuccess(variant,\n+                                      physicalKey,\n+                                      automaticHandle.getFile().length(),\n+                                      handleAndWatch.getSecond().elapsedMillis());", "originalCommit": "4f67da9919acdb64a1f2a889935c46eb91c87006", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg5NDU3Nw==", "url": "https://github.com/scireum/sirius-biz/pull/943#discussion_r544894577", "bodyText": "Well we could add a 2nd measurement for the \"overall time\" - this would als include the queuing time...", "author": "andyHa", "createdAt": "2020-12-17T08:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDg5MTYwMA=="}], "type": "inlineReview"}]}