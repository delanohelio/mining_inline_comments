{"pr_number": 886, "pr_title": "Tycho: Updates Framework", "pr_createdAt": "2020-10-22T13:43:49Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/886", "timeline": [{"oid": "86756d99f63fed8259ae22e9c186d7fa2662a975", "url": "https://github.com/scireum/sirius-biz/commit/86756d99f63fed8259ae22e9c186d7fa2662a975", "message": "Provides an initial implementation of the updates framework.", "committedDate": "2020-10-22T13:27:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MjU5MQ==", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511852591", "bodyText": "Codeformat", "author": "sabieber", "createdAt": "2020-10-26T10:19:20Z", "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.web.BizController;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.tagliatelle.Tagliatelle;\n+import sirius.tagliatelle.compiler.CompileException;\n+import sirius.web.controller.Controller;\n+import sirius.web.controller.Routed;\n+import sirius.web.http.WebContext;\n+import sirius.web.services.JSONStructuredOutput;\n+\n+@Register(classes = Controller.class)\n+public class UpdatesController extends BizController {\n+\n+    @Part\n+    private UpdateManager updateManager;\n+\n+@Part", "originalCommit": "86756d99f63fed8259ae22e9c186d7fa2662a975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MzA3Ng==", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511853076", "bodyText": "Hardcoded?", "author": "sabieber", "createdAt": "2020-10-26T10:20:13Z", "path": "src/main/java/sirius/biz/tycho/updates/UpdateManager.java", "diffHunk": "@@ -0,0 +1,92 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.analytics.flags.ExecutionFlags;\n+import sirius.kernel.commons.Limit;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.kernel.xml.StructuredNode;\n+import sirius.kernel.xml.XMLCall;\n+\n+import javax.xml.xpath.XPathExpressionException;\n+import java.io.IOException;\n+import java.net.URL;\n+import java.time.LocalDateTime;\n+import java.time.Period;\n+import java.time.format.DateTimeFormatter;\n+import java.util.ArrayList;\n+import java.util.Collections;\n+import java.util.List;\n+import java.util.Optional;\n+\n+@Register(classes = UpdateManager.class)\n+public class UpdateManager {\n+\n+    @Part\n+    private ExecutionFlags executionFlags;\n+\n+    private List<UpdateInfo> updates = Collections.emptyList();\n+    private LocalDateTime lastFetch;\n+\n+    public boolean hasUpdates(String reference) {\n+        if (getUpdates().isEmpty()) {\n+            return false;\n+        }\n+\n+        Optional<LocalDateTime> lastView = executionFlags.readExecutionFlag(reference, \"updates-last-view\");\n+        if (!lastView.isPresent()) {\n+            return true;\n+        }\n+\n+        LocalDateTime limit = LocalDateTime.now().minusMonths(3);\n+\n+        return getUpdates().stream()\n+                           .filter(update -> update.getTimestamp().isAfter(limit))\n+                           .findFirst()\n+                           .filter(update -> update.getTimestamp().isAfter(lastView.get()))\n+                           .isPresent();\n+    }\n+\n+    public List<UpdateInfo> getUpdates() {\n+        LocalDateTime limit = LocalDateTime.now().minusDays(1);\n+        if (lastFetch == null || lastFetch.isBefore(limit)) {\n+            fetchUpdates();\n+        }\n+\n+        return Collections.unmodifiableList(updates);\n+    }\n+\n+    private void fetchUpdates() {\n+        try {\n+            Limit limit = new Limit(0, 5);\n+            List<UpdateInfo> nextUpdates = new ArrayList<>();\n+            XMLCall call = XMLCall.to(new URL(\"https://blog.scireum.de/feed\"));", "originalCommit": "86756d99f63fed8259ae22e9c186d7fa2662a975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMTg1MzIzNg==", "url": "https://github.com/scireum/sirius-biz/pull/886#discussion_r511853236", "bodyText": "Whats this?", "author": "sabieber", "createdAt": "2020-10-26T10:20:30Z", "path": "src/main/java/sirius/biz/tycho/updates/UpdatesController.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Made with all the love in the world\n+ * by scireum in Remshalden, Germany\n+ *\n+ * Copyright by scireum GmbH\n+ * http://www.scireum.de - info@scireum.de\n+ */\n+\n+package sirius.biz.tycho.updates;\n+\n+import sirius.biz.web.BizController;\n+import sirius.kernel.di.std.Part;\n+import sirius.kernel.di.std.Register;\n+import sirius.tagliatelle.Tagliatelle;\n+import sirius.tagliatelle.compiler.CompileException;\n+import sirius.web.controller.Controller;\n+import sirius.web.controller.Routed;\n+import sirius.web.http.WebContext;\n+import sirius.web.services.JSONStructuredOutput;\n+\n+@Register(classes = Controller.class)\n+public class UpdatesController extends BizController {\n+\n+    @Part\n+    private UpdateManager updateManager;\n+\n+@Part\n+private Tagliatelle tagliatelle;\n+\n+    @Routed(value = \"/tycho/updates\", jsonCall = true)\n+    public void checkForUpdates(WebContext webContext, JSONStructuredOutput output) throws CompileException {\n+        tagliatelle.resolve(\"/kb/IKGVF.html.pasta\").get().getPragma(\"tag\");", "originalCommit": "86756d99f63fed8259ae22e9c186d7fa2662a975", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "7c0f8e9cd303f7248b536e06b9b7518020b27a0a", "url": "https://github.com/scireum/sirius-biz/commit/7c0f8e9cd303f7248b536e06b9b7518020b27a0a", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates", "committedDate": "2021-06-30T06:51:25Z", "type": "commit"}, {"oid": "21cd5cd6b66d84c2ce1d02aeba74eb13c75c210c", "url": "https://github.com/scireum/sirius-biz/commit/21cd5cd6b66d84c2ce1d02aeba74eb13c75c210c", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates", "committedDate": "2021-07-02T08:52:19Z", "type": "commit"}, {"oid": "c8939e038247841c79e9a72fb32da3dcf221921f", "url": "https://github.com/scireum/sirius-biz/commit/c8939e038247841c79e9a72fb32da3dcf221921f", "message": "Provides a generic dashboard as main entry-point of Tycho apps.", "committedDate": "2021-07-02T20:15:53Z", "type": "commit"}, {"oid": "29c894285ef510b3cd75540eac87ed5bfca6c322", "url": "https://github.com/scireum/sirius-biz/commit/29c894285ef510b3cd75540eac87ed5bfca6c322", "message": "Provides extensions for common help topics.", "committedDate": "2021-07-02T20:16:50Z", "type": "commit"}, {"oid": "e643a2342466d1890cf1bb42b4bdc279910a4b5a", "url": "https://github.com/scireum/sirius-biz/commit/e643a2342466d1890cf1bb42b4bdc279910a4b5a", "message": "Improves the security for accessTokens used by the academy.\n\nBy only using a hash of the user-id, tokens might be generated elsewhere\nand used here. Therefor we add a custom suffix to make them unique.", "committedDate": "2021-07-02T20:17:49Z", "type": "commit"}, {"oid": "0b4973e11171f028e6d4869ca6838ffde639f2d5", "url": "https://github.com/scireum/sirius-biz/commit/0b4973e11171f028e6d4869ca6838ffde639f2d5", "message": "Adds a random academy video to the dashboard sidebar.", "committedDate": "2021-07-02T20:18:08Z", "type": "commit"}, {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "url": "https://github.com/scireum/sirius-biz/commit/358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "message": "Finalizes the updates framework.\n\nThis loads news from an ATOM feed and shows them to the users of the\nTycho UI.", "committedDate": "2021-07-02T20:21:13Z", "type": "commit"}, {"oid": "358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "url": "https://github.com/scireum/sirius-biz/commit/358c85babc6ace2ae0d594af3dad1f2d9c6beeff", "message": "Finalizes the updates framework.\n\nThis loads news from an ATOM feed and shows them to the users of the\nTycho UI.", "committedDate": "2021-07-02T20:21:13Z", "type": "forcePushed"}, {"oid": "01f8fa685e1ccc0049d9866b8a771851ce1d0c8c", "url": "https://github.com/scireum/sirius-biz/commit/01f8fa685e1ccc0049d9866b8a771851ce1d0c8c", "message": "Typo", "committedDate": "2021-07-05T06:53:44Z", "type": "commit"}, {"oid": "56670dbac80c9ff0ce0a00f75ac68baea24f52cd", "url": "https://github.com/scireum/sirius-biz/commit/56670dbac80c9ff0ce0a00f75ac68baea24f52cd", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates", "committedDate": "2021-07-06T14:27:13Z", "type": "commit"}, {"oid": "a410cbb8761c630f6519ad618606df99e0629fe9", "url": "https://github.com/scireum/sirius-biz/commit/a410cbb8761c630f6519ad618606df99e0629fe9", "message": "Prevents a template error in case a framework is disabled.", "committedDate": "2021-07-08T15:09:51Z", "type": "commit"}, {"oid": "ec93a87cfa786ced9a80a39ef9d4bdc87078b400", "url": "https://github.com/scireum/sirius-biz/commit/ec93a87cfa786ced9a80a39ef9d4bdc87078b400", "message": "Fixes startup warnings.", "committedDate": "2021-07-08T15:19:21Z", "type": "commit"}, {"oid": "f9705148a65d09a95f9fd2387824048410238fe0", "url": "https://github.com/scireum/sirius-biz/commit/f9705148a65d09a95f9fd2387824048410238fe0", "message": "Removes a leftover bracket.", "committedDate": "2021-07-08T15:24:56Z", "type": "commit"}, {"oid": "9b0f4793c9b2e18835f282483b487cee292434e4", "url": "https://github.com/scireum/sirius-biz/commit/9b0f4793c9b2e18835f282483b487cee292434e4", "message": "Updates to the latest sirius dependencies.", "committedDate": "2021-07-19T07:34:48Z", "type": "commit"}, {"oid": "0a398f5354b21a4f44ebe131cdb50f0e53a6d8a0", "url": "https://github.com/scireum/sirius-biz/commit/0a398f5354b21a4f44ebe131cdb50f0e53a6d8a0", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates\n\n# Conflicts:\n#\tpom.xml\n#\tsrc/main/resources/biz_de.properties", "committedDate": "2021-07-19T07:36:28Z", "type": "commit"}, {"oid": "f7e08b731bb620ad8041c1b3326a62818a8c7473", "url": "https://github.com/scireum/sirius-biz/commit/f7e08b731bb620ad8041c1b3326a62818a8c7473", "message": "Updates to the correct sirius version.", "committedDate": "2021-07-19T08:02:54Z", "type": "commit"}, {"oid": "e7f272c9a9ad9ead32912699e10becfa3c4a7396", "url": "https://github.com/scireum/sirius-biz/commit/e7f272c9a9ad9ead32912699e10becfa3c4a7396", "message": "Merge remote-tracking branch 'origin/develop' into aha/tycho-updates\n\n# Conflicts:\n#\tpom.xml", "committedDate": "2021-07-19T08:09:25Z", "type": "commit"}]}