{"pr_number": 817, "pr_title": "Fix an issue creating files in the storage", "pr_createdAt": "2020-07-07T15:48:46Z", "pr_url": "https://github.com/scireum/sirius-biz/pull/817", "timeline": [{"oid": "4add31057d239f78b3aab4c91d0c97ccd7ba9847", "url": "https://github.com/scireum/sirius-biz/commit/4add31057d239f78b3aab4c91d0c97ccd7ba9847", "message": "Fix an issue creating files in the storage\n\nThe find or create method was skipping the file creation if a previous find was issue which did not find any file (leaving the cache with null for the desired key).\n\nThis caused subsequent calls to the cache to deliver null instead of forcedly call the valuecomputer in order to create a new file.\n\nFixes: OX-5973", "committedDate": "2020-07-07T15:45:20Z", "type": "commit"}, {"oid": "f0c3a9e3992336aa1479b6f18b934f44a0232b61", "url": "https://github.com/scireum/sirius-biz/commit/f0c3a9e3992336aa1479b6f18b934f44a0232b61", "message": "Fix a variable usage\n\nFixes: OX-5973", "committedDate": "2020-07-07T15:48:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2ODI0Ng==", "url": "https://github.com/scireum/sirius-biz/pull/817#discussion_r450968246", "bodyText": "why not\n Blob blob = fetchOrCreateByPath(tenantId, path);\nblobByPathCache.put(key, blob);", "author": "andyHa", "createdAt": "2020-07-07T15:51:11Z", "path": "src/main/java/sirius/biz/storage/layer2/BasicBlobStorageSpace.java", "diffHunk": "@@ -373,8 +373,13 @@ public Blob findOrCreateByPath(String tenantId, String path) {\n             throw new IllegalArgumentException(\"An empty path was provided!\");\n         }\n \n-        return blobByPathCache.get(determinePathCacheKey(tenantId, path),\n-                                   ignored -> fetchOrCreateByPath(tenantId, path));\n+        String key = determinePathCacheKey(tenantId, path);\n+        Blob blob = blobByPathCache.get(key);\n+        if (blob == null) {\n+            blobByPathCache.remove(key);", "originalCommit": "f0c3a9e3992336aa1479b6f18b934f44a0232b61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2ODI4Ng==", "url": "https://github.com/scireum/sirius-biz/pull/817#discussion_r450968286", "bodyText": "+-", "author": "andyHa", "createdAt": "2020-07-07T15:51:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2ODI0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk3NTQwNw==", "url": "https://github.com/scireum/sirius-biz/pull/817#discussion_r450975407", "bodyText": "Unfortunately put won't sync a coherent cache", "author": "idlira", "createdAt": "2020-07-07T16:01:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2ODI0Ng=="}], "type": "inlineReview"}]}