{"pr_number": 4937, "pr_title": "Feature #19999 Use relative path instead of absolute path in", "pr_createdAt": "2020-02-14T09:46:54Z", "pr_url": "https://github.com/axelor/axelor-open-suite/pull/4937", "timeline": [{"oid": "da30989a198af5c16219e35596e266a6a89bf660", "url": "https://github.com/axelor/axelor-open-suite/commit/da30989a198af5c16219e35596e266a6a89bf660", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-02-17T11:43:23Z", "type": "forcePushed"}, {"oid": "a71b150125a90eb93733e80178b6acab51933fc0", "url": "https://github.com/axelor/axelor-open-suite/commit/a71b150125a90eb93733e80178b6acab51933fc0", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-02-17T13:13:02Z", "type": "forcePushed"}, {"oid": "6f7884ca34e5b118f666ab37f2ee78ee1a98f748", "url": "https://github.com/axelor/axelor-open-suite/commit/6f7884ca34e5b118f666ab37f2ee78ee1a98f748", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-02-18T10:54:08Z", "type": "forcePushed"}, {"oid": "ea963a7bd9f4b731ce62d822b872813dbd4a514f", "url": "https://github.com/axelor/axelor-open-suite/commit/ea963a7bd9f4b731ce62d822b872813dbd4a514f", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-02-19T06:59:37Z", "type": "forcePushed"}, {"oid": "fee88674322801011494fb0811f6afe39e877bfb", "url": "https://github.com/axelor/axelor-open-suite/commit/fee88674322801011494fb0811f6afe39e877bfb", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-02-21T08:55:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTUzMzQ1MQ==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r385533451", "bodyText": "Make this changes after: if (Strings.isNullOrEmpty(folderPath)) condition", "author": "psh-axelor", "createdAt": "2020-02-28T06:53:28Z", "path": "axelor-bank-payment/src/main/java/com/axelor/apps/bankpayment/service/bankorder/file/BankOrderFileService.java", "diffHunk": "@@ -105,7 +107,11 @@ protected String getSenderAddress() throws AxelorException {\n \n   protected String getFolderPath() throws AxelorException {\n \n-    String folderPath = paymentMode.getBankOrderExportFolderPath();\n+    String dataExportDir = AppSettings.get().get(\"data.export.dir\");", "originalCommit": "fee88674322801011494fb0811f6afe39e877bfb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e857f0ef396e4c3d8b309cdc26a88b965971c947", "url": "https://github.com/axelor/axelor-open-suite/commit/e857f0ef396e4c3d8b309cdc26a88b965971c947", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-02-28T07:35:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NTU1ODI5Mg==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r385558292", "bodyText": "Create variable for accountingBatch.getPaymentMode() and use everywhere in method\nUpdate Preconditions.checkArgument to check paymentMode.getBankOrderExportFolderPath() is not null\nAlso update path displayed on error message", "author": "psh-axelor", "createdAt": "2020-02-28T08:13:31Z", "path": "axelor-bank-payment/src/main/java/com/axelor/apps/bankpayment/service/batch/BatchDirectDebitPaymentSchedule.java", "diffHunk": "@@ -95,7 +101,11 @@ protected void processPaymentScheduleLines(int paymentScheduleType) {\n           companyBankDetails.getCurrency(),\n           I18n.get(\"Currency in company bank details is missing.\"));\n       Preconditions.checkArgument(", "originalCommit": "e857f0ef396e4c3d8b309cdc26a88b965971c947", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "637f6fc8bfed6c6a6ed3a2f31548a9dbe71dc393", "url": "https://github.com/axelor/axelor-open-suite/commit/637f6fc8bfed6c6a6ed3a2f31548a9dbe71dc393", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-04-02T07:17:08Z", "type": "forcePushed"}, {"oid": "1c399a860e4ba8ba20a623cfdce7076705969a62", "url": "https://github.com/axelor/axelor-open-suite/commit/1c399a860e4ba8ba20a623cfdce7076705969a62", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-04-02T11:11:50Z", "type": "forcePushed"}, {"oid": "19b7e5768676ae1b54e0860db538b760f1cda96c", "url": "https://github.com/axelor/axelor-open-suite/commit/19b7e5768676ae1b54e0860db538b760f1cda96c", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-04-13T13:34:12Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNTYzMjYzOA==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r415632638", "bodyText": "Remove unused variables", "author": "psh-axelor", "createdAt": "2020-04-27T08:54:13Z", "path": "axelor-admin/src/main/java/com/axelor/apps/base/service/app/AppService.java", "diffHunk": "@@ -24,6 +24,10 @@\n \n public interface AppService {\n \n+  public static final String DEFAULT_DATA_EXPORT_DIR = \"{java.io.tmpdir}/axelor/data-export\";\n+\n+  public static final String DEFAULT_FILE_UPLOAD_DIR = \"{java.io.tmpdir}/axelor/attachments\";", "originalCommit": "19b7e5768676ae1b54e0860db538b760f1cda96c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "376ca07473498d93593b9889c8c0c273eacaa2d3", "url": "https://github.com/axelor/axelor-open-suite/commit/376ca07473498d93593b9889c8c0c273eacaa2d3", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-04-27T11:45:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NTk2MQ==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r418495961", "bodyText": "Move this line of code to starting of the method", "author": "psh-axelor", "createdAt": "2020-05-01T10:42:23Z", "path": "axelor-account/src/main/java/com/axelor/apps/account/service/MoveLineExportServiceImpl.java", "diffHunk": "@@ -1487,11 +1486,10 @@ private MetaFile writeMoveLineToCsvFile(\n       }\n     }\n \n-    if (filePath == null) {\n-      filePath = Files.createTempDir().getAbsolutePath();\n-    } else {\n-      new File(filePath).mkdirs();\n-    }\n+    String dataExportDir = appAccountService.getDataExportDir();", "originalCommit": "376ca07473498d93593b9889c8c0c273eacaa2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5NzIyMw==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r418497223", "bodyText": "Move this line of code to starting of the method\nand check with append File.separator in same line of code", "author": "psh-axelor", "createdAt": "2020-05-01T10:47:34Z", "path": "axelor-account/src/main/java/com/axelor/apps/account/service/ReimbursementImportService.java", "diffHunk": "@@ -79,11 +84,13 @@ public void runReimbursementImport(Company company) throws AxelorException, IOEx\n     this.testCompanyField(company);\n \n     AccountConfig accountConfig = company.getAccountConfig();\n+    String dataUploadDir = appService.getFileUploadDir();", "originalCommit": "376ca07473498d93593b9889c8c0c273eacaa2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODQ5ODU4Mw==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r418498583", "bodyText": "Move this line of code to starting of the method", "author": "psh-axelor", "createdAt": "2020-05-01T10:53:26Z", "path": "axelor-account/src/main/java/com/axelor/apps/account/service/SubrogationReleaseServiceImpl.java", "diffHunk": "@@ -201,11 +201,10 @@ public String exportToCSV(SubrogationRelease subrogationRelease)\n     AccountConfigService accountConfigService = Beans.get(AccountConfigService.class);\n     String filePath =\n         accountConfigService.getAccountConfig(subrogationRelease.getCompany()).getExportPath();\n-    if (filePath == null) {\n-      filePath = com.google.common.io.Files.createTempDir().getAbsolutePath();\n-    } else {\n-      new File(filePath).mkdirs();\n-    }\n+    String dataExportDir = appBaseService.getDataExportDir();", "originalCommit": "376ca07473498d93593b9889c8c0c273eacaa2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUxMTg5NA==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r418511894", "bodyText": "Better to keep this Preconditions.checkArgument after catch block and check one more condition in it:\nbankOrderExportPath != null && new File(dataExpotDir + File.separator...", "author": "psh-axelor", "createdAt": "2020-05-01T11:49:41Z", "path": "axelor-bank-payment/src/main/java/com/axelor/apps/bankpayment/service/batch/BatchDirectDebitPaymentSchedule.java", "diffHunk": "@@ -94,15 +94,20 @@ protected void processPaymentScheduleLines(int paymentScheduleType) {\n       Preconditions.checkNotNull(\n           companyBankDetails.getCurrency(),\n           I18n.get(\"Currency in company bank details is missing.\"));\n-      Preconditions.checkArgument(\n-          new File(accountingBatch.getPaymentMode().getBankOrderExportFolderPath()).exists(),\n-          String.format(\n-              I18n.get(\"Bank order export folder does not exist: %s\"),\n-              accountingBatch.getPaymentMode().getBankOrderExportFolderPath()));\n \n-      BankPaymentConfigService bankPaymentConfigService = Beans.get(BankPaymentConfigService.class);\n+      String bankOrderExportPath = accountingBatch.getPaymentMode().getBankOrderExportFolderPath();\n \n       try {\n+        String dataExpotDir = appBaseService.getDataExportDir();\n+        Preconditions.checkArgument(\n+            new File(dataExpotDir + File.separator + bankOrderExportPath).exists(),\n+            String.format(\n+                I18n.get(\"Bank order export folder does not exist: %s\"),\n+                dataExpotDir + File.separator + bankOrderExportPath));", "originalCommit": "376ca07473498d93593b9889c8c0c273eacaa2d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTI0NTI5NQ==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r419245295", "bodyText": "we can't move this condition to after catch block because it uses dataExpotDir variable and it must have to stay inside the try block as dataExpotDir is not accessible outside of try block.", "author": "shve-axelor", "createdAt": "2020-05-04T07:07:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUxMTg5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyNzUwNw==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r418527507", "bodyText": "Move this line of code to starting of the method", "author": "psh-axelor", "createdAt": "2020-05-01T12:49:43Z", "path": "axelor-base/src/main/java/com/axelor/apps/base/service/administration/IndicatorGeneratorGroupingService.java", "diffHunk": "@@ -101,8 +105,9 @@ public void export(IndicatorGeneratorGrouping indicatorGeneratorGrouping) throws\n     }\n \n     try {\n+      String dataExportDir = appService.getDataExportDir();", "originalCommit": "376ca07473498d93593b9889c8c0c273eacaa2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxODUyODMwMA==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r418528300", "bodyText": "Case when dataExportDir != null && indicatorGeneratorGrouping.getPath() == null:\nIn CsvTool.csvWriter() method's parameter you should pass filePath = null so it will throw IOException and we already have catch block for it", "author": "psh-axelor", "createdAt": "2020-05-01T12:52:09Z", "path": "axelor-base/src/main/java/com/axelor/apps/base/service/administration/IndicatorGeneratorGroupingService.java", "diffHunk": "@@ -101,8 +105,9 @@ public void export(IndicatorGeneratorGrouping indicatorGeneratorGrouping) throws\n     }\n \n     try {\n+      String dataExportDir = appService.getDataExportDir();\n       CsvTool.csvWriter(", "originalCommit": "376ca07473498d93593b9889c8c0c273eacaa2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3f8c00f6bfdd46b6b4627a6837a6689ed8b0e8a2", "url": "https://github.com/axelor/axelor-open-suite/commit/3f8c00f6bfdd46b6b4627a6837a6689ed8b0e8a2", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-05-04T11:38:58Z", "type": "forcePushed"}, {"oid": "19d81dc62664874b92a5ca77fb21b9ef49117f6f", "url": "https://github.com/axelor/axelor-open-suite/commit/19d81dc62664874b92a5ca77fb21b9ef49117f6f", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-05-11T06:28:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzNDY5Mg==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r426434692", "bodyText": "Pass null value in parameter if accountConfig.getReimbursementImportFolderPathCFONB() is null", "author": "psh-axelor", "createdAt": "2020-05-18T07:56:54Z", "path": "axelor-account/src/main/java/com/axelor/apps/account/service/batch/BatchReimbursementImport.java", "diffHunk": "@@ -97,12 +97,18 @@ protected void process() {\n       Map<List<String[]>, String> data = null;\n \n       try {\n-        rejectImportService.createFilePath(accountConfig.getReimbursementImportFolderPathCFONB());\n+\n+        String dataImportDir = appBaseService.getFileUploadDir();\n+\n+        String reimbursementImportFolderPathCFONB =\n+            dataImportDir + accountConfig.getReimbursementImportFolderPathCFONB();\n+\n+        rejectImportService.createFilePath(reimbursementImportFolderPathCFONB);", "originalCommit": "19d81dc62664874b92a5ca77fb21b9ef49117f6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQzNzg4Mg==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r426437882", "bodyText": "Pass null value in parameter if accountConfig.getTempReimbImportFolderPathCFONB() is null", "author": "psh-axelor", "createdAt": "2020-05-18T08:02:30Z", "path": "axelor-account/src/main/java/com/axelor/apps/account/service/batch/BatchReimbursementImport.java", "diffHunk": "@@ -97,12 +97,18 @@ protected void process() {\n       Map<List<String[]>, String> data = null;\n \n       try {\n-        rejectImportService.createFilePath(accountConfig.getReimbursementImportFolderPathCFONB());\n+\n+        String dataImportDir = appBaseService.getFileUploadDir();\n+\n+        String reimbursementImportFolderPathCFONB =\n+            dataImportDir + accountConfig.getReimbursementImportFolderPathCFONB();\n+\n+        rejectImportService.createFilePath(reimbursementImportFolderPathCFONB);\n \n         data =\n             rejectImportService.getCFONBFileByLot(\n-                accountConfig.getReimbursementImportFolderPathCFONB(),\n-                accountConfig.getTempReimbImportFolderPathCFONB(),\n+                reimbursementImportFolderPathCFONB,\n+                dataImportDir + accountConfig.getTempReimbImportFolderPathCFONB(),", "originalCommit": "19d81dc62664874b92a5ca77fb21b9ef49117f6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ0MzA1NQ==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r426443055", "bodyText": "There is no need to do any change here as you can check the returned value is not used anywhere, this method is just used to throw exception if accountConfig.getReimbursementExportFolderPath() is null", "author": "psh-axelor", "createdAt": "2020-05-18T08:11:20Z", "path": "axelor-account/src/main/java/com/axelor/apps/account/service/config/AccountConfigService.java", "diffHunk": "@@ -482,7 +463,8 @@ public String getReimbursementExportFolderPath(AccountConfig accountConfig)\n           I18n.get(com.axelor.apps.base.exceptions.IExceptionMessage.EXCEPTION),\n           accountConfig.getCompany().getName());\n     }\n-    return accountConfig.getReimbursementExportFolderPath();\n+    String dataExportDir = appService.getDataExportDir();\n+    return dataExportDir + File.separator + accountConfig.getReimbursementExportFolderPath();", "originalCommit": "19d81dc62664874b92a5ca77fb21b9ef49117f6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ1MDk4OQ==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r426450989", "bodyText": "Optimize these lines of code, you can do the same by just one line of code\nSame in getFileUploadDir() method", "author": "psh-axelor", "createdAt": "2020-05-18T08:24:33Z", "path": "axelor-admin/src/main/java/com/axelor/apps/base/service/app/AppServiceImpl.java", "diffHunk": "@@ -564,4 +564,34 @@ public void importRoles() throws AxelorException {\n       importRoles(app);\n     }\n   }\n+\n+  @Override\n+  public String getDataExportDir() throws AxelorException {\n+    String appSettingsPath = AppSettings.get().get(\"data.export.dir\");\n+    if (appSettingsPath == null) {\n+      throw new AxelorException(\n+          TraceBackRepository.CATEGORY_CONFIGURATION_ERROR,\n+          I18n.get(IExceptionMessages.DATA_EXPORT_DIR_ERROR));\n+    } else {\n+      if (!appSettingsPath.endsWith(File.separator)) {\n+        appSettingsPath = appSettingsPath + File.separator;\n+      }\n+      return appSettingsPath;", "originalCommit": "19d81dc62664874b92a5ca77fb21b9ef49117f6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjQ1NzU0NA==", "url": "https://github.com/axelor/axelor-open-suite/pull/4937#discussion_r426457544", "bodyText": "No need to create a variable for dataExportDir\nSimply, return appService.getDataExportDir() + folderPath;", "author": "psh-axelor", "createdAt": "2020-05-18T08:35:02Z", "path": "axelor-bank-payment/src/main/java/com/axelor/apps/bankpayment/service/bankorder/file/BankOrderFileService.java", "diffHunk": "@@ -114,6 +118,9 @@ protected String getFolderPath() throws AxelorException {\n           paymentMode.getName());\n     }\n \n+    String dataExportDir = appService.getDataExportDir();\n+    folderPath = dataExportDir + paymentMode.getBankOrderExportFolderPath();", "originalCommit": "19d81dc62664874b92a5ca77fb21b9ef49117f6f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "95f3c2eb440e594e8cba79eba18e97e732e93c31", "url": "https://github.com/axelor/axelor-open-suite/commit/95f3c2eb440e594e8cba79eba18e97e732e93c31", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-05-20T12:26:19Z", "type": "forcePushed"}, {"oid": "a3061c196ce78938d23be00e94f35fd3ffe8a906", "url": "https://github.com/axelor/axelor-open-suite/commit/a3061c196ce78938d23be00e94f35fd3ffe8a906", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-06-03T07:01:06Z", "type": "commit"}, {"oid": "a3061c196ce78938d23be00e94f35fd3ffe8a906", "url": "https://github.com/axelor/axelor-open-suite/commit/a3061c196ce78938d23be00e94f35fd3ffe8a906", "message": "Feature #19999 Use relative path instead of absolute path in", "committedDate": "2020-06-03T07:01:06Z", "type": "forcePushed"}]}