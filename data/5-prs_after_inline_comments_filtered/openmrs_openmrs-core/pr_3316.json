{"pr_number": 3316, "pr_title": "TRUNK-5816: Migrate unit tests to Junit5", "pr_createdAt": "2020-07-08T18:45:27Z", "pr_url": "https://github.com/openmrs/openmrs-core/pull/3316", "timeline": [{"oid": "3db98dfec629cc38442a189472b269027fb8094b", "url": "https://github.com/openmrs/openmrs-core/commit/3db98dfec629cc38442a189472b269027fb8094b", "message": "TRUNK-5816: Migrate unit tests to Junit5", "committedDate": "2020-07-09T06:44:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452009542", "bodyText": "@achilep will you also add a Test? I believe thats a class testing whether an OpenMRS test is properly setup.", "author": "teleivo", "createdAt": "2020-07-09T07:11:34Z", "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -9,7 +9,8 @@\n  */\n package org.openmrs;\n \n-import static org.junit.Assert.assertTrue;\n+import static org.junit.jupiter.api.Assertions.assertFalse;", "originalCommit": "3db98dfec629cc38442a189472b269027fb8094b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAyNTM1OQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452025359", "bodyText": "@teleivo I don't understand well .\n\nwill you also add a Test?", "author": "achilep", "createdAt": "2020-07-09T07:42:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA1NTkwNA==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452055904", "bodyText": "@teleivo surely I plan to increase the coverage of the tests. I plan to do it at the end of the migration.", "author": "achilep", "createdAt": "2020-07-09T08:36:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjA2MjEyNw==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452062127", "bodyText": "This file is like a metatest, going through all test classes and checking they have a test, ...\nCan you please add another test class like ModuleFileParserUnitTest to this commit for example that is a unit test", "author": "teleivo", "createdAt": "2020-07-09T08:47:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjE0MDEzMw==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452140133", "bodyText": "Sorry, I have to correct myself. ModuleFileParserUnitTest extends BaseContextMockTest so we should not include this one in the commit. So any other Test class that does not extend any of these BaseContext classes. You did already migrate a few previously.", "author": "teleivo", "createdAt": "2020-07-09T11:08:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjMzMDg5MA==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452330890", "bodyText": "thanks @teleivo . done", "author": "achilep", "createdAt": "2020-07-09T16:09:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjAwOTU0Mg=="}], "type": "inlineReview"}, {"oid": "0568ac43dfcd0f628a3d0a8596382120c1c4699a", "url": "https://github.com/openmrs/openmrs-core/commit/0568ac43dfcd0f628a3d0a8596382120c1c4699a", "message": "TRUNK-5816: Migrate unit tests to Junit5", "committedDate": "2020-07-09T16:07:52Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM3OTUyMA==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452379520", "bodyText": "Shouldnt this also be an ||?\nSince before it was setting foundATestMethod to true if there is a method with the org.junit.Test annotation. I think now it should also count the ones with the org.junit.jupiter.api.Test annotation as a test method. Both annotations will never be present so an && cannot identify a test method then.\ntherefore\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\t\tif (method.getAnnotation(org.junit.Test.class) != null && method.getAnnotation(Test.class) != null) {\n          \n          \n            \n            \t\t\t\t\tif (method.getAnnotation(org.junit.Test.class) != null || method.getAnnotation(Test.class) != null) {", "author": "teleivo", "createdAt": "2020-07-09T17:31:41Z", "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -111,18 +109,16 @@ public void shouldHaveClassNameEndWithTestIfContainsMethodTestAnnotations() {\n \t\tfor (Class<?> currentClass : getClasses(\"^.*(?<!Test|IT|PT)\\\\.class$\")) {\n \t\t\t\n \t\t\t// skip over classes that are @Ignore'd\n-\t\t\tif (currentClass.getAnnotation(Ignore.class) == null) {\n+\t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {\n \t\t\t\tboolean foundATestMethod = false;\n \t\t\t\t\n \t\t\t\tfor (Method method : currentClass.getMethods()) {\n-\t\t\t\t\tif (method.getAnnotation(Test.class) != null) {\n+\t\t\t\t\tif (method.getAnnotation(org.junit.Test.class) != null && method.getAnnotation(Test.class) != null) {", "originalCommit": "0568ac43dfcd0f628a3d0a8596382120c1c4699a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwODIxMQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452408211", "bodyText": "@teleivo  here is the error I got", "author": "achilep", "createdAt": "2020-07-09T18:24:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjM3OTUyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxOTYzNg==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452419636", "bodyText": "oh, now I get it. So here it says // skip over classes that are @Ignore'd. So what we have to do is skip over classes that do not have the annotation Ignore and also do not have the annotation Disabled\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {\n          \n          \n            \n            \t\t\tif (currentClass.getAnnotation(Ignore.class) == null && currentClass.getAnnotation(Disabled.class) == null) {\n          \n      \n    \n    \n  \n\nOtherwise you are going to check CreateInitialDataSet.", "author": "teleivo", "createdAt": "2020-07-09T18:46:07Z", "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -111,18 +109,16 @@ public void shouldHaveClassNameEndWithTestIfContainsMethodTestAnnotations() {\n \t\tfor (Class<?> currentClass : getClasses(\"^.*(?<!Test|IT|PT)\\\\.class$\")) {\n \t\t\t\n \t\t\t// skip over classes that are @Ignore'd\n-\t\t\tif (currentClass.getAnnotation(Ignore.class) == null) {\n+\t\t\tif (currentClass.getAnnotation(Ignore.class) == null || currentClass.getAnnotation(Disabled.class) == null) {", "originalCommit": "0568ac43dfcd0f628a3d0a8596382120c1c4699a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQyMDM4OQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452420389", "bodyText": "So you get the error after my suggested change only because you are in fact checking a class that should not be checked since it is annotated with @Ignore. So you need to take both my suggestions and it should work if I am not mistaken.", "author": "teleivo", "createdAt": "2020-07-09T18:47:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQxOTYzNg=="}], "type": "inlineReview"}, {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85", "url": "https://github.com/openmrs/openmrs-core/commit/c749cac1f5e71e7fb43f8a5728919c0614264c85", "message": "TRUNK-5816: Migrate unit tests to Junit5", "committedDate": "2020-07-09T18:53:20Z", "type": "commit"}, {"oid": "c749cac1f5e71e7fb43f8a5728919c0614264c85", "url": "https://github.com/openmrs/openmrs-core/commit/c749cac1f5e71e7fb43f8a5728919c0614264c85", "message": "TRUNK-5816: Migrate unit tests to Junit5", "committedDate": "2020-07-09T18:53:20Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwNDEwNw==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452604107", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\t\t\tif (method.getAnnotation(Test.class) != null && method.getAnnotation(org.junit.Test.class) != null) {\n          \n          \n            \n            \t\t\t\tif (method.getAnnotation(Test.class) != null || method.getAnnotation(org.junit.Test.class) != null) {", "author": "teleivo", "createdAt": "2020-07-10T03:33:30Z", "path": "api/src/test/java/org/openmrs/OpenmrsTestsTest.java", "diffHunk": "@@ -61,12 +62,11 @@ public void shouldStartWithShould() {\n \t\t\t\t\n \t\t\t\t// make sure every \"test\" method (determined by having \n \t\t\t\t// the @Test annotation) starts with \"testShould\"\n-\t\t\t\tif (method.getAnnotation(Test.class) != null) {\n+\t\t\t\tif (method.getAnnotation(Test.class) != null && method.getAnnotation(org.junit.Test.class) != null) {", "originalCommit": "c749cac1f5e71e7fb43f8a5728919c0614264c85", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwNjA1NQ==", "url": "https://github.com/openmrs/openmrs-core/pull/3316#discussion_r452606055", "bodyText": "Tests will never have Junit 4 and Junit 5 annotations. Its always a good idea to make a test fail once you assume its good. shouldStartWithShould is supposed to fail if any method annotated with a Test annotation does not start with should or have _should in its name. So you can just open any test and delete a should and _should and see if that test here fails. Since you made. a change you should test that in a Junit 4 and 5 test method. That would have told you that with the && its not checking any test method.", "author": "teleivo", "createdAt": "2020-07-10T03:42:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjYwNDEwNw=="}], "type": "inlineReview"}, {"oid": "91af3e242c2d78c7786629df536f281f62c1d7cd", "url": "https://github.com/openmrs/openmrs-core/commit/91af3e242c2d78c7786629df536f281f62c1d7cd", "message": "TRUNK-5816 Detect Junit 4 & 5 tests not starting with should", "committedDate": "2020-07-10T03:51:33Z", "type": "commit"}]}