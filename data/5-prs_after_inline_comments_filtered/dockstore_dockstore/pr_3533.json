{"pr_number": 3533, "pr_title": "fix hosted tool delete error", "pr_createdAt": "2020-06-05T19:14:54Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3533", "timeline": [{"oid": "3304f4b021ddb5ed6ddc53ef014477088670fb77", "url": "https://github.com/dockstore/dockstore/commit/3304f4b021ddb5ed6ddc53ef014477088670fb77", "message": "fix hosted tool delete error", "committedDate": "2020-06-05T19:11:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNDU5MA==", "url": "https://github.com/dockstore/dockstore/pull/3533#discussion_r436124590", "bodyText": "devil's advocate?\nWhat's the difference? Why not just always use dbcreatedate?", "author": "denis-yuen", "createdAt": "2020-06-05T19:36:00Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/AbstractHostedEntryResource.java", "diffHunk": "@@ -390,7 +390,7 @@ public T deleteHostedVersion(@ApiParam(hidden = true) @Auth User user,\n         // If the version that's about to be deleted is the default version, unset it\n         if (entry.getActualDefaultVersion().getName().equals(version)) {\n             Optional<U> max = entry.getWorkflowVersions().stream().filter(v -> !Objects.equals(v.getName(), version))\n-                    .max(Comparator.comparingLong(ver -> ver.getDate().getTime()));\n+                    .max(Comparator.comparingLong(ver -> ver.getDate() != null ? ver.getDate().getTime() : ver.getDbCreateDate().getTime()));", "originalCommit": "3304f4b021ddb5ed6ddc53ef014477088670fb77", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNjQ4OQ==", "url": "https://github.com/dockstore/dockstore/pull/3533#discussion_r436126489", "bodyText": "last built comes from Quay.io, and is when the container was last built.", "author": "agduncan94", "createdAt": "2020-06-05T19:40:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNDU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEzMzcyNg==", "url": "https://github.com/dockstore/dockstore/pull/3533#discussion_r436133726", "bodyText": "That might open more questions.\ni.e. a workflow author might intentionally author new versions of the workflow that point to older Docker images to avoid a regression bug.  There might also be multiple versions that point to the same image (same built) but have \"properly\" sorted db create dates. Is there any case in which sorting by the Docker image is superior?", "author": "denis-yuen", "createdAt": "2020-06-05T19:53:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNDU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE0MDQ0Ng==", "url": "https://github.com/dockstore/dockstore/pull/3533#discussion_r436140446", "bodyText": "Darn just realized this is abstract hosted, so for workflows too.", "author": "agduncan94", "createdAt": "2020-06-05T20:07:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNDU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE0MTEwNA==", "url": "https://github.com/dockstore/dockstore/pull/3533#discussion_r436141104", "bodyText": "Both actually set lastModified, would that be a better fallback? @denis-yuen\nEdit: Nevermind, this is a entry level value.", "author": "agduncan94", "createdAt": "2020-06-05T20:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNDU5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjE0MzIxMQ==", "url": "https://github.com/dockstore/dockstore/pull/3533#discussion_r436143211", "bodyText": "This code is just saying, if they delete a default version for a hosted entry, set the new default date to be the most recently created. So I actually think we can just always use dbCreateDate. Does that make sense?", "author": "agduncan94", "createdAt": "2020-06-05T20:14:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjEyNDU5MA=="}], "type": "inlineReview"}, {"oid": "e019fa7a64876ea19f80174c9588bd969fe449d1", "url": "https://github.com/dockstore/dockstore/commit/e019fa7a64876ea19f80174c9588bd969fe449d1", "message": "Merge branch 'develop' into feature/fix-hosted-tool-tag-delete", "committedDate": "2020-06-05T19:43:02Z", "type": "commit"}, {"oid": "53d2225d9b397c4e41570163338e0a54a5c371f1", "url": "https://github.com/dockstore/dockstore/commit/53d2225d9b397c4e41570163338e0a54a5c371f1", "message": "use dbcreatetime for finding most recent version", "committedDate": "2020-06-05T20:15:14Z", "type": "commit"}, {"oid": "d9ef65eea69f1f4644fc1e1eb9025e9086686610", "url": "https://github.com/dockstore/dockstore/commit/d9ef65eea69f1f4644fc1e1eb9025e9086686610", "message": "Merge branch 'feature/fix-hosted-tool-tag-delete' of github.com:ga4gh/dockstore into feature/fix-hosted-tool-tag-delete", "committedDate": "2020-06-05T20:34:46Z", "type": "commit"}]}