{"pr_number": 3740, "pr_title": "feature/3712/lazyLoadSourcefiles", "pr_createdAt": "2020-08-12T23:28:53Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3740", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgyMDQwMw==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r470820403", "bodyText": "Have a question. if I understand correctly, the deleted code was relying on eager loading but prevents deleting content when stripping it out before serialization.\nremoveSourceFilesFromEntry seems to save the current state and then do the eviction. But why is a eviction no longer needed here specifically? Is it because lazy loading causes the source files to not be serialized anyway?", "author": "denis-yuen", "createdAt": "2020-08-14T19:14:26Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/EntryVersionHelper.java", "diffHunk": "@@ -134,15 +136,20 @@ static void stripContent(List<? extends Entry> entries, AbstractDockstoreDAO dao\n             dao.evict(entry);\n             // clear users which are also lazy loaded\n             entry.setUsers(null);\n-            // need to have this evicted so that hibernate does not actually delete the tags and users", "originalCommit": "1e14c2dd4fe31598fc6f3aa0b4d84bdeaf02e704", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgyNzI3MA==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r470827270", "bodyText": "With my changes, the sourcefiles are not always lazily loaded. When you refresh an entry or edit a hosted one, the sourcefiles end up getting loaded, so that's why I created the new function to remove the sourcefiles. But the sourcefiles aren't loaded whenever stripContent() was called.", "author": "NatalieEO", "createdAt": "2020-08-14T19:30:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDgyMDQwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNzAxMQ==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r476027011", "bodyText": "Can you add a comment to the method explaining what is going on here? If I knew Hibernate better, I might understand. But I don't. I sort of see what's happening, but I don't think I grok all the details.", "author": "coverbeck", "createdAt": "2020-08-25T01:10:26Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/helpers/EntryVersionHelper.java", "diffHunk": "@@ -134,15 +136,20 @@ static void stripContent(List<? extends Entry> entries, AbstractDockstoreDAO dao\n             dao.evict(entry);\n             // clear users which are also lazy loaded\n             entry.setUsers(null);\n-            // need to have this evicted so that hibernate does not actually delete the tags and users\n-            Set<Version> versions = entry.getWorkflowVersions();\n-            versions.forEach(version ->\n-                version.getSourceFiles().forEach(sourceFile ->\n-                        ((SourceFile)sourceFile).setContent(null))\n-            );\n         }\n     }\n \n+    static void removeSourceFilesFromEntry(Entry entry, SessionFactory sessionFactory) {", "originalCommit": "6bead7c5892eeabce10be1f4b880bd91ade0050f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY3MTI3Mg==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r476671272", "bodyText": "Added just the comment for now. Tried doing just the first suggestion, but ran into some issues when implementing\nthe new getFileDAO function in this file https://github.com/dockstore/dockstore/blob/feature/3712/lazyLoadSourcefiles/dockstore-webservice/src/main/java/io/openapi/api/impl/ToolsApiServiceImpl.java\nDoesn't seem simple to fix after talking to Charles.\n@denis-yuen do you have comment on whether these suggestions should be done?", "author": "NatalieEO", "createdAt": "2020-08-25T19:00:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNzAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4MTQ2NQ==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r477381465", "bodyText": "I don't have a preference as to whether the query should be in EntryDAO, but not really a hibernate expert.\n(I think there can be whole careers in this space)\nI agree that it would be nice to avoid passing FileDAO everywhere but I don't feel strongly about it if it seems very problematic.", "author": "denis-yuen", "createdAt": "2020-08-26T15:16:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNzAxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzM4MjA3Ng==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r477382076", "bodyText": "Sorry, probably less enlightening than hoped", "author": "denis-yuen", "createdAt": "2020-08-26T15:17:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjAyNzAxMQ=="}], "type": "inlineReview"}, {"oid": "db8550f5c6cd04d9ce581f2bc714e828bf42b230", "url": "https://github.com/dockstore/dockstore/commit/db8550f5c6cd04d9ce581f2bc714e828bf42b230", "message": "just add comment for now", "committedDate": "2020-08-25T18:55:30Z", "type": "forcePushed"}, {"oid": "65bced32371ad9ac26395db30658266d92a5295d", "url": "https://github.com/dockstore/dockstore/commit/65bced32371ad9ac26395db30658266d92a5295d", "message": "fix tests?", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "3ec85848c58f55a3b2b94ece0cc233c23c9583a2", "url": "https://github.com/dockstore/dockstore/commit/3ec85848c58f55a3b2b94ece0cc233c23c9583a2", "message": "checkstyle", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "586e6f108625645d1e2271b6e73a64eb248cf15f", "url": "https://github.com/dockstore/dockstore/commit/586e6f108625645d1e2271b6e73a64eb248cf15f", "message": "forgot this file", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "a23c32805e9bffab4a1ad38a6b5db230483577d2", "url": "https://github.com/dockstore/dockstore/commit/a23c32805e9bffab4a1ad38a6b5db230483577d2", "message": "see what else fails", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "54cc28ef97f3786a17bad0f04d89242038f109c5", "url": "https://github.com/dockstore/dockstore/commit/54cc28ef97f3786a17bad0f04d89242038f109c5", "message": "more fixes", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "f53ed8f749a0373202d685e18b970c5ae7952e89", "url": "https://github.com/dockstore/dockstore/commit/f53ed8f749a0373202d685e18b970c5ae7952e89", "message": "checkstyle", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "35c4d657bfe3b55c9148ff525a3c1c3b87a0768a", "url": "https://github.com/dockstore/dockstore/commit/35c4d657bfe3b55c9148ff525a3c1c3b87a0768a", "message": "fix tests and strip sourcefile from hosted entries", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "a2cc598902d7cb3943a7354f61ce588b67f97ed8", "url": "https://github.com/dockstore/dockstore/commit/a2cc598902d7cb3943a7354f61ce588b67f97ed8", "message": "just add comment for now", "committedDate": "2020-08-26T19:51:30Z", "type": "commit"}, {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e", "url": "https://github.com/dockstore/dockstore/commit/f90fa9367600def0530256e920bd82b4f8c69c5e", "message": "rebase, checkstyle", "committedDate": "2020-08-26T20:08:43Z", "type": "commit"}, {"oid": "f90fa9367600def0530256e920bd82b4f8c69c5e", "url": "https://github.com/dockstore/dockstore/commit/f90fa9367600def0530256e920bd82b4f8c69c5e", "message": "rebase, checkstyle", "committedDate": "2020-08-26T20:08:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3ODYxNDM5Nw==", "url": "https://github.com/dockstore/dockstore/pull/3740#discussion_r478614397", "bodyText": "remove TODO", "author": "garyluu", "createdAt": "2020-08-27T18:28:22Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -126,7 +126,7 @@\n     // watch out for https://hibernate.atlassian.net/browse/HHH-3799 if this is set to EAGER\n     // TODO: @JsonIgnore this field to catch more places in UI that use it.\n     // TODO: Change to FetchType.LAZY", "originalCommit": "f90fa9367600def0530256e920bd82b4f8c69c5e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "753c798ef68730f5081b66544460eaf4c98b53e0", "url": "https://github.com/dockstore/dockstore/commit/753c798ef68730f5081b66544460eaf4c98b53e0", "message": "remove todo", "committedDate": "2020-08-27T20:41:19Z", "type": "commit"}, {"oid": "f323455d52975e050dec59526187c97057ec2b7e", "url": "https://github.com/dockstore/dockstore/commit/f323455d52975e050dec59526187c97057ec2b7e", "message": "Merge branch 'develop' into feature/3712/lazyLoadSourcefiles", "committedDate": "2020-08-27T20:41:33Z", "type": "commit"}]}