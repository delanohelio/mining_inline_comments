{"pr_number": 3699, "pr_title": "Feature/3644/changes needed to ignore sourcefiles", "pr_createdAt": "2020-07-29T00:30:58Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3699", "timeline": [{"oid": "3ad642fb9ce6cc2e5549cd46fc21611e0a8f81c9", "url": "https://github.com/dockstore/dockstore/commit/3ad642fb9ce6cc2e5549cd46fc21611e0a8f81c9", "message": "changes needed for removing sourcefile refs in UI", "committedDate": "2020-07-29T00:01:13Z", "type": "commit"}, {"oid": "bfe16b1b23f709b9abdc9562bfc442d4c93dfea9", "url": "https://github.com/dockstore/dockstore/commit/bfe16b1b23f709b9abdc9562bfc442d4c93dfea9", "message": "migration", "committedDate": "2020-07-29T00:26:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk3OTU2OQ==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r461979569", "bodyText": "There's no reason to create a TreeSet here, because you overwrite it on line 186. I would just get rid of this line and define it on line 186.\nOr, more subjectively, not not declare it at all and just return line 186 directly.", "author": "coverbeck", "createdAt": "2020-07-29T01:08:55Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -145,11 +150,43 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n     public List<VersionVerifiedPlatform> getVerifiedPlatforms(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n             @Parameter(name = \"entryId\", description = \"id of the entry\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId) {\n         Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n-        checkOptionalAuthRead(user, entry);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);\n+        }\n+\n         List<VersionVerifiedPlatform> verifiedVersions = versionDAO.findEntryVersionsWithVerifiedPlatforms(entryId);\n         return verifiedVersions;\n     }\n \n+    @GET\n+    @Timed\n+    @UnitOfWork(readOnly = true)\n+    @Path(\"/{entryId}/versions/{versionId}/fileTypes\")\n+    @ApiOperation(value = \"Retrieve the file types of a version's sourcefiles\",  hidden = true)\n+    @Operation(operationId = \"getVersionsFileTypes\", description = \"Retrieve the file types of a version's sourcefile\", security = @SecurityRequirement(name = OPENAPI_JWT_SECURITY_DEFINITION_NAME))\n+    public SortedSet<DescriptorLanguage.FileType> getVersionsFileTypes(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n+            @Parameter(name = \"entryId\", description = \"Entry to retrieve the version from\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId,\n+            @Parameter(name = \"versionId\", description = \"Version to retrieve the sourcefile types from\", required = true, in = ParameterIn.PATH) @PathParam(\"versionId\") Long versionId) {\n+        Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);\n+        }\n+\n+        Version version = versionDAO.findVersionInEntry(entryId, versionId);\n+        if (version == null) {\n+            throw new CustomWebApplicationException(\"Version \" + versionId + \" does not exist for this entry\", HttpStatus.SC_BAD_REQUEST);\n+        }\n+\n+        SortedSet<DescriptorLanguage.FileType> fileTypes = new TreeSet<>();", "originalCommit": "bfe16b1b23f709b9abdc9562bfc442d4c93dfea9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MjgxMQ==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r461982811", "bodyText": "This is unfortunate, but may be fast enough for a single version, so probably not worth optimizing yet.\nWhy do you use a TreeSet instead of Collectors.toSet? TreeSet sorts, but for an enum it's just going to sort on the order of declaration, I think, and I don't think that order is significant. I could be wrong though.", "author": "coverbeck", "createdAt": "2020-07-29T01:21:25Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -145,11 +150,43 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n     public List<VersionVerifiedPlatform> getVerifiedPlatforms(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n             @Parameter(name = \"entryId\", description = \"id of the entry\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId) {\n         Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n-        checkOptionalAuthRead(user, entry);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);\n+        }\n+\n         List<VersionVerifiedPlatform> verifiedVersions = versionDAO.findEntryVersionsWithVerifiedPlatforms(entryId);\n         return verifiedVersions;\n     }\n \n+    @GET\n+    @Timed\n+    @UnitOfWork(readOnly = true)\n+    @Path(\"/{entryId}/versions/{versionId}/fileTypes\")\n+    @ApiOperation(value = \"Retrieve the file types of a version's sourcefiles\",  hidden = true)\n+    @Operation(operationId = \"getVersionsFileTypes\", description = \"Retrieve the file types of a version's sourcefile\", security = @SecurityRequirement(name = OPENAPI_JWT_SECURITY_DEFINITION_NAME))\n+    public SortedSet<DescriptorLanguage.FileType> getVersionsFileTypes(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n+            @Parameter(name = \"entryId\", description = \"Entry to retrieve the version from\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId,\n+            @Parameter(name = \"versionId\", description = \"Version to retrieve the sourcefile types from\", required = true, in = ParameterIn.PATH) @PathParam(\"versionId\") Long versionId) {\n+        Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);\n+        }\n+\n+        Version version = versionDAO.findVersionInEntry(entryId, versionId);\n+        if (version == null) {\n+            throw new CustomWebApplicationException(\"Version \" + versionId + \" does not exist for this entry\", HttpStatus.SC_BAD_REQUEST);\n+        }\n+\n+        SortedSet<DescriptorLanguage.FileType> fileTypes = new TreeSet<>();\n+        SortedSet<SourceFile> sourceFiles = version.getSourceFiles();\n+        fileTypes = sourceFiles.stream().map(sourceFile -> sourceFile.getType()).collect(Collectors.toCollection(TreeSet::new));", "originalCommit": "bfe16b1b23f709b9abdc9562bfc442d4c93dfea9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM2MDkwMg==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462360902", "bodyText": "On further reflection, it probably is better to use TreeSet. Although the particular  ordering doesn\u2019t really matter much, the fact that it will return the same order every time is a good thing.", "author": "coverbeck", "createdAt": "2020-07-29T14:51:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTk4MjgxMQ=="}], "type": "inlineReview"}, {"oid": "eaef089f805ccdf2aed6a691bff7512bcdb0be69", "url": "https://github.com/dockstore/dockstore/commit/eaef089f805ccdf2aed6a691bff7512bcdb0be69", "message": "Use another annotation that doesn't create a migration", "committedDate": "2020-07-29T16:54:15Z", "type": "commit"}, {"oid": "76aecf76603d8f25a5f1b4d68799de090066069d", "url": "https://github.com/dockstore/dockstore/commit/76aecf76603d8f25a5f1b4d68799de090066069d", "message": "Merge branch 'develop' into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-07-29T18:12:47Z", "type": "commit"}, {"oid": "48ecde53ae0867fe73e143b1537807d46576eec5", "url": "https://github.com/dockstore/dockstore/commit/48ecde53ae0867fe73e143b1537807d46576eec5", "message": "Fix permission issues and add tests", "committedDate": "2020-07-29T21:29:50Z", "type": "commit"}, {"oid": "a93859c341e509d5307ba5e1fd920bce030de829", "url": "https://github.com/dockstore/dockstore/commit/a93859c341e509d5307ba5e1fd920bce030de829", "message": "Merge branch 'feature/3644/changesNeededToIgnoreSourcefiles' of github.com:dockstore/dockstore into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-07-29T21:32:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYzODM2MQ==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462638361", "bodyText": "last comma has space in front of it instead of after it. :)", "author": "coverbeck", "createdAt": "2020-07-29T23:01:24Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -75,7 +75,7 @@\n @NamedQueries({\n         @NamedQuery(name = \"io.dockstore.webservice.core.Version.findVersionInEntry\", query = \"SELECT v FROM Version v WHERE :entryId = v.parent.id AND :versionId = v.id\"),\n         @NamedQuery(name = \"io.dockstore.webservice.core.database.VersionVerifiedPlatform.findEntryVersionsWithVerifiedPlatforms\",\n-                query = \"SELECT new io.dockstore.webservice.core.database.VersionVerifiedPlatform(version.id, KEY(verifiedbysource), verifiedbysource.metadata) FROM Version version \"\n+                query = \"SELECT new io.dockstore.webservice.core.database.VersionVerifiedPlatform(version.id, KEY(verifiedbysource), verifiedbysource.metadata, verifiedbysource.platformVersion, sourcefiles.path ,verifiedbysource.verified) FROM Version version \"", "originalCommit": "a93859c341e509d5307ba5e1fd920bce030de829", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY0MDMxNw==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462640317", "bodyText": "checkUser will fail with an NPE if user is null, which user.get() can return.", "author": "coverbeck", "createdAt": "2020-07-29T23:07:25Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -145,11 +150,41 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n     public List<VersionVerifiedPlatform> getVerifiedPlatforms(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n             @Parameter(name = \"entryId\", description = \"id of the entry\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId) {\n         Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n-        checkOptionalAuthRead(user, entry);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);\n+        }\n+\n         List<VersionVerifiedPlatform> verifiedVersions = versionDAO.findEntryVersionsWithVerifiedPlatforms(entryId);\n         return verifiedVersions;\n     }\n \n+    @GET\n+    @Timed\n+    @UnitOfWork(readOnly = true)\n+    @Path(\"/{entryId}/versions/{versionId}/fileTypes\")\n+    @ApiOperation(value = \"Retrieve the file types of a version's sourcefiles\",  hidden = true)\n+    @Operation(operationId = \"getVersionsFileTypes\", description = \"Retrieve the file types of a version's sourcefile\", security = @SecurityRequirement(name = OPENAPI_JWT_SECURITY_DEFINITION_NAME))\n+    public SortedSet<DescriptorLanguage.FileType> getVersionsFileTypes(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n+            @Parameter(name = \"entryId\", description = \"Entry to retrieve the version from\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId,\n+            @Parameter(name = \"versionId\", description = \"Version to retrieve the sourcefile types from\", required = true, in = ParameterIn.PATH) @PathParam(\"versionId\") Long versionId) {\n+        Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);", "originalCommit": "a93859c341e509d5307ba5e1fd920bce030de829", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY0MDY0OQ==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462640649", "bodyText": "Suggest \"Retrieve the unique file types of a version's sourcefiles\"", "author": "coverbeck", "createdAt": "2020-07-29T23:08:46Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -145,11 +150,41 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n     public List<VersionVerifiedPlatform> getVerifiedPlatforms(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n             @Parameter(name = \"entryId\", description = \"id of the entry\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId) {\n         Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n-        checkOptionalAuthRead(user, entry);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);\n+        }\n+\n         List<VersionVerifiedPlatform> verifiedVersions = versionDAO.findEntryVersionsWithVerifiedPlatforms(entryId);\n         return verifiedVersions;\n     }\n \n+    @GET\n+    @Timed\n+    @UnitOfWork(readOnly = true)\n+    @Path(\"/{entryId}/versions/{versionId}/fileTypes\")\n+    @ApiOperation(value = \"Retrieve the file types of a version's sourcefiles\",  hidden = true)", "originalCommit": "a93859c341e509d5307ba5e1fd920bce030de829", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY0MTAxMg==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462641012", "bodyText": "user.get() can return null", "author": "coverbeck", "createdAt": "2020-07-29T23:09:55Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -145,11 +150,41 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n     public List<VersionVerifiedPlatform> getVerifiedPlatforms(@Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n             @Parameter(name = \"entryId\", description = \"id of the entry\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") Long entryId) {\n         Entry<? extends Entry, ? extends Version> entry = toolDAO.getGenericEntryById(entryId);\n-        checkOptionalAuthRead(user, entry);\n+        checkEntry(entry);\n+\n+        if (!entry.getIsPublished()) {\n+            checkUser(user.get(), entry);", "originalCommit": "a93859c341e509d5307ba5e1fd920bce030de829", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "340e1f72ff6ba515ff78af439ab4976e8a6f7e93", "url": "https://github.com/dockstore/dockstore/commit/340e1f72ff6ba515ff78af439ab4976e8a6f7e93", "message": "PR feedback", "committedDate": "2020-07-30T00:11:35Z", "type": "commit"}, {"oid": "60e2a2bea04cacabf9224c464de66e82d0123e01", "url": "https://github.com/dockstore/dockstore/commit/60e2a2bea04cacabf9224c464de66e82d0123e01", "message": "method parameter", "committedDate": "2020-07-30T00:13:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjY2ODc0Mw==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462668743", "bodyText": "I believe you should return a 404 in this case. If you go to a private GitHub repo that you don't have permissions to, you get a 404, not an unauthorized error.\nThe logic behind this is that you don't even want to indicate that it exists to an evil-doer. If they know it exists, that's the first step. Then they could then start trying to break into it.\nI'll let others opine on this.", "author": "coverbeck", "createdAt": "2020-07-30T00:43:38Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -185,6 +181,15 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n         return sourceFiles.stream().map(sourceFile -> sourceFile.getType()).collect(Collectors.toCollection(TreeSet::new));\n     }\n \n+    public void checkEntryPermissions(final Optional<User> user, final Entry<? extends Entry, ? extends Version> entry) {\n+        if (!entry.getIsPublished()) {\n+            if (user.isEmpty()) {\n+                throw new CustomWebApplicationException(\"This entry is not published.\", HttpStatus.SC_UNAUTHORIZED);", "originalCommit": "60e2a2bea04cacabf9224c464de66e82d0123e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjM0MjYyNA==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462342624", "bodyText": "DescriptorLanguage.CWL.toString()", "author": "garyluu", "createdAt": "2020-07-29T14:28:03Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralIT.java", "diffHunk": "@@ -452,6 +456,64 @@ public void testGettingVerifiedVersions() {\n \n     }\n \n+    @Test\n+    public void testGettingVersionsFileTypes() {\n+        io.dockstore.openapi.client.ApiClient client = getOpenAPIWebClient(USER_2_USERNAME, testingPostgres);\n+        final ApiClient webClient = getWebClient(USER_2_USERNAME, testingPostgres);\n+        final HostedApi hostedApi = new HostedApi(webClient);\n+        io.dockstore.openapi.client.api.EntriesApi entriesApi = new io.dockstore.openapi.client.api.EntriesApi(client);\n+\n+        Workflow workflow = hostedApi.createHostedWorkflow(\"wdlHosted\", null, \"wdl\", null, null);\n+        SourceFile sourceFile = new SourceFile();\n+        sourceFile.setType(SourceFile.TypeEnum.DOCKSTORE_WDL);\n+        sourceFile.setContent(\"workflow potato {\\n}\");\n+        sourceFile.setPath(\"/Dockstore.wdl\");\n+        sourceFile.setAbsolutePath(\"/Dockstore.wdl\");\n+\n+        workflow = hostedApi.editHostedWorkflow(workflow.getId(), Lists.newArrayList(sourceFile));\n+        WorkflowVersion workflowVersion = workflow.getWorkflowVersions().stream().filter(wv -> wv.getName().equals(\"1\")).findFirst().get();\n+        List<String> fileTypes = entriesApi.getVersionsFileTypes(workflow.getId(), workflowVersion.getId());\n+        assertEquals(1, fileTypes.size());\n+        assertEquals(SourceFile.TypeEnum.DOCKSTORE_WDL.toString(), fileTypes.get(0));\n+\n+        SourceFile testFile = new SourceFile();\n+        testFile.setType(SourceFile.TypeEnum.WDL_TEST_JSON);\n+        testFile.setContent(\"{}\");\n+        testFile.setPath(\"/test.wdl.json\");\n+        testFile.setAbsolutePath(\"/test.wdl.json\");\n+\n+        workflow = hostedApi.editHostedWorkflow(workflow.getId(), Lists.newArrayList(sourceFile, testFile));\n+        workflowVersion = workflow.getWorkflowVersions().stream().filter(wv -> wv.getName().equals(\"2\")).findFirst().get();\n+        fileTypes = entriesApi.getVersionsFileTypes(workflow.getId(), workflowVersion.getId());\n+        assertEquals(2, fileTypes.size());\n+        assertFalse(fileTypes.get(0) == fileTypes.get(1));\n+\n+        DockstoreTool tool = hostedApi.createHostedTool(\"hostedTool\", Registry.QUAY_IO.getDockerPath().toLowerCase(), \"CWL\", \"namespace\", null);", "originalCommit": "bfe16b1b23f709b9abdc9562bfc442d4c93dfea9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYxNTAxNg==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r462615016", "bodyText": "DescriptorLanguage.WDL.toString()", "author": "garyluu", "createdAt": "2020-07-29T22:00:42Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralIT.java", "diffHunk": "@@ -430,26 +434,119 @@ public void testGettingVerifiedVersions() {\n \n         workflow = workflowApi.refresh(workflow.getId());\n         SourceFile sourceFile = workflow.getWorkflowVersions().get(0).getSourceFiles().get(0);\n-        PublishRequest publishRequest = SwaggerUtility.createPublishRequest(true);\n-        workflowApi.publish(workflow.getId(), publishRequest);\n         List<VersionVerifiedPlatform> versionsVerified = entriesApi.getVerifiedPlatforms(workflow.getId());\n         Assert.assertEquals(0, versionsVerified.size());\n \n-        testingPostgres.runUpdateStatement(\"INSERT INTO sourcefile_verified(id, verified, source, metadata) VALUES (\" + sourceFile.getId() + \", true, 'Potato CLI', 'Idaho')\");\n+        testingPostgres.runUpdateStatement(\"INSERT INTO sourcefile_verified(id, verified, source, metadata, platformversion) VALUES (\" + sourceFile.getId() + \", true, 'Potato CLI', 'Idaho', '1.0')\");\n         versionsVerified = entriesApi.getVerifiedPlatforms(workflow.getId());\n         Assert.assertEquals(1, versionsVerified.size());\n \n         ContainersApi toolApi = new ContainersApi(webClient);\n         DockstoreTool tool = toolApi.getContainerByToolPath(\"quay.io/dockstoretestuser2/quayandgithub\", null);\n         sourceFile = tool.getWorkflowVersions().get(0).getSourceFiles().get(0);\n-        toolApi.publish(tool.getId(), publishRequest);\n         versionsVerified = entriesApi.getVerifiedPlatforms(tool.getId());\n         Assert.assertEquals(0, versionsVerified.size());\n \n         testingPostgres.runUpdateStatement(\"INSERT INTO sourcefile_verified(id, verified, source, metadata) VALUES (\" + sourceFile.getId() + \", true, 'Potato CLI', 'Idaho')\");\n         versionsVerified = entriesApi.getVerifiedPlatforms(tool.getId());\n         Assert.assertEquals(1, versionsVerified.size());\n \n+        // check that verified platforms can't be viewed by another user if entry isn't published\n+        boolean throwsError = false;\n+        io.dockstore.openapi.client.ApiClient user1Client = getOpenAPIWebClient(USER_1_USERNAME, testingPostgres);\n+        io.dockstore.openapi.client.api.EntriesApi user1EntriesApi = new io.dockstore.openapi.client.api.EntriesApi(user1Client);\n+        try {\n+            versionsVerified = user1EntriesApi.getVerifiedPlatforms(workflow.getId());\n+        } catch (io.dockstore.openapi.client.ApiException ex) {\n+            throwsError = true;\n+        }\n+        if (!throwsError) {\n+            fail(\"Should not be able to verified platforms if not published and doesn't belong to user.\");\n+        }\n+\n+        // verified platforms can be viewed by others once published\n+        PublishRequest publishRequest = SwaggerUtility.createPublishRequest(true);\n+        workflowApi.publish(workflow.getId(), publishRequest);\n+        versionsVerified = user1EntriesApi.getVerifiedPlatforms(workflow.getId());\n+        Assert.assertEquals(1, versionsVerified.size());\n+    }\n+\n+    @Test\n+    public void testGettingVersionsFileTypes() {\n+        io.dockstore.openapi.client.ApiClient client = getOpenAPIWebClient(USER_2_USERNAME, testingPostgres);\n+        final ApiClient webClient = getWebClient(USER_2_USERNAME, testingPostgres);\n+        final HostedApi hostedApi = new HostedApi(webClient);\n+        WorkflowsApi workflowApi = new WorkflowsApi(webClient);\n+        io.dockstore.openapi.client.api.EntriesApi entriesApi = new io.dockstore.openapi.client.api.EntriesApi(client);\n+\n+        Workflow workflow = hostedApi.createHostedWorkflow(\"wdlHosted\", null, \"wdl\", null, null);", "originalCommit": "a93859c341e509d5307ba5e1fd920bce030de829", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0MjA5OA==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r463042098", "bodyText": "I think the other pattern (where we put the assertFail() right after this line) is cleaner since there's less code and no extra boolean.", "author": "garyluu", "createdAt": "2020-07-30T14:34:25Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java", "diffHunk": "@@ -1492,6 +1491,25 @@ public void testGettingSourceFilesForTag() {\n         if (!throwsError) {\n             Assert.fail(\"Should not be able to grab sourcefile for a version not belonging to a tool\");\n         }\n+\n+        // check that sourcefiles can't be viewed by another user if they aren't published\n+        throwsError = false;\n+        final io.dockstore.openapi.client.ApiClient user2OpenAPIWebClient = getOpenAPIWebClient(USER_2_USERNAME, testingPostgres);\n+        io.dockstore.openapi.client.api.ContainertagsApi user2toolTagsApi = new io.dockstore.openapi.client.api.ContainertagsApi(user2OpenAPIWebClient);\n+        try {\n+            sourceFiles = user2toolTagsApi.getTagsSourcefiles(tool.getId(), tag.getId(), null);", "originalCommit": "60e2a2bea04cacabf9224c464de66e82d0123e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzA0MzU2Ng==", "url": "https://github.com/dockstore/dockstore/pull/3699#discussion_r463043566", "bodyText": "Assertion to check that the exception error message is what's expected", "author": "garyluu", "createdAt": "2020-07-30T14:36:14Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/BasicIT.java", "diffHunk": "@@ -1492,6 +1491,25 @@ public void testGettingSourceFilesForTag() {\n         if (!throwsError) {\n             Assert.fail(\"Should not be able to grab sourcefile for a version not belonging to a tool\");\n         }\n+\n+        // check that sourcefiles can't be viewed by another user if they aren't published\n+        throwsError = false;\n+        final io.dockstore.openapi.client.ApiClient user2OpenAPIWebClient = getOpenAPIWebClient(USER_2_USERNAME, testingPostgres);\n+        io.dockstore.openapi.client.api.ContainertagsApi user2toolTagsApi = new io.dockstore.openapi.client.api.ContainertagsApi(user2OpenAPIWebClient);\n+        try {\n+            sourceFiles = user2toolTagsApi.getTagsSourcefiles(tool.getId(), tag.getId(), null);\n+        } catch (io.dockstore.openapi.client.ApiException e) {\n+            throwsError = true;", "originalCommit": "60e2a2bea04cacabf9224c464de66e82d0123e01", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "35238507590b1cbe4e4559d652439c13ebc04710", "url": "https://github.com/dockstore/dockstore/commit/35238507590b1cbe4e4559d652439c13ebc04710", "message": "Test error messages, don't use boolean", "committedDate": "2020-07-30T16:35:32Z", "type": "commit"}, {"oid": "177de47b870da0a86913c853f5b5d3f4054f2bfe", "url": "https://github.com/dockstore/dockstore/commit/177de47b870da0a86913c853f5b5d3f4054f2bfe", "message": "Merge branch 'develop' into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-07-30T16:38:06Z", "type": "commit"}, {"oid": "048f7a73f0d848a1a34cbcef290c70530aa5498b", "url": "https://github.com/dockstore/dockstore/commit/048f7a73f0d848a1a34cbcef290c70530aa5498b", "message": "Merge branch 'develop' into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-07-30T20:21:21Z", "type": "commit"}, {"oid": "08c10e85b0191c6d74f3c3d1d2d894142bbc71b8", "url": "https://github.com/dockstore/dockstore/commit/08c10e85b0191c6d74f3c3d1d2d894142bbc71b8", "message": "Merge branch 'develop' into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-08-03T23:05:15Z", "type": "commit"}, {"oid": "0b84e6b7b12815ca00d14dd518a2dc072b13070c", "url": "https://github.com/dockstore/dockstore/commit/0b84e6b7b12815ca00d14dd518a2dc072b13070c", "message": "Merge branch 'develop' into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-08-07T15:43:16Z", "type": "commit"}, {"oid": "0c0af355962a3515d7544b087aedf2ef926d67ad", "url": "https://github.com/dockstore/dockstore/commit/0c0af355962a3515d7544b087aedf2ef926d67ad", "message": "Merge branch 'develop' into feature/3644/changesNeededToIgnoreSourcefiles", "committedDate": "2020-08-10T22:27:16Z", "type": "commit"}]}