{"pr_number": 3548, "pr_title": "added timeout to executeCommand utilities", "pr_createdAt": "2020-06-10T17:57:26Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3548", "timeline": [{"oid": "de3640c9d911d0e8544aa7e1d0d555c1314ca548", "url": "https://github.com/dockstore/dockstore/commit/de3640c9d911d0e8544aa7e1d0d555c1314ca548", "message": "added timeout to executeCommand utilities", "committedDate": "2020-06-08T22:33:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDQ3NQ==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438320475", "bodyText": "You should keep this method signature and create an additional one with the next line. This module is used outside of the webservice, by the CLI, and having a signature go away will break the CLI. We could update the CLI when it starts using the latest version, but it would be easier not to.", "author": "coverbeck", "createdAt": "2020-06-10T18:16:35Z", "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -85,7 +86,7 @@ public static INIConfiguration parseConfig(String configFile) {\n         return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), null);\n     }\n \n-    public static ImmutablePair<String, String> executeCommand(String command, File workingDir) {", "originalCommit": "de3640c9d911d0e8544aa7e1d0d555c1314ca548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTc2ODgyMw==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r441768823", "bodyText": "Elaborating on the comment above, this will change it so that anything that calls executeCommand(String command, File workingDir) or executeCommand(String command) will have a timeout now. They may not have expected it in the past.\nFor example, https://github.com/dockstore/dockstore-cli/blob/develop/dockstore-client/src/main/java/io/dockstore/client/cli/nested/BaseLauncher.java#L112-L114 might mean that running workflows would also be under a time limit now which doesn't make sense.\nI think we basically need a \"opt-in\" timeout rather than a default.\nSorry for not elaborating before", "author": "denis-yuen", "createdAt": "2020-06-17T19:01:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDQ3NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDcxOA==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438320718", "bodyText": "What's the longest time you ever saw in the logs?\nSuggest adding the unit to the variable name, e.g. TIMEOUT_MS or TIMEOUT_IN_MILLISECONDS or TIMEOUT_MILLISECONDS.", "author": "coverbeck", "createdAt": "2020-06-10T18:17:02Z", "path": "dockstore-common/src/main/java/io/dockstore/common/NextflowUtilities.java", "diffHunk": "@@ -42,6 +42,7 @@\n public final class NextflowUtilities {\n     private static final Logger LOG = LoggerFactory.getLogger(NextflowUtilities.class);\n     private static final String DEFAULT_NEXTFLOW_VERSION = \"19.01.0\";\n+    private static final long TIMEOUT = 15000;  // based on webservice logs, usually <6 seconds is needed", "originalCommit": "de3640c9d911d0e8544aa7e1d0d555c1314ca548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM4NDAxMQ==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438384011", "bodyText": "Updated the variable name. The longest time in the logs was 6 seconds", "author": "emlys", "createdAt": "2020-06-10T20:18:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMDcxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMTMwNw==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438321307", "bodyText": "I'm worried this is too low, but I don't know all the cases where we call it. How about a minute?", "author": "coverbeck", "createdAt": "2020-06-10T18:18:05Z", "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -54,6 +54,7 @@\n     private static final Map<String, ConfigurationBuilder<INIConfiguration>> MAP = new HashMap<>();\n \n     private static final Logger LOG = LoggerFactory.getLogger(Utilities.class);\n+    private static final long DEFAULT_TIMEOUT = 20000;", "originalCommit": "de3640c9d911d0e8544aa7e1d0d555c1314ca548", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM4Mzc4MA==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438383780", "bodyText": "Raised to a minute, I think it was too low for the tests", "author": "emlys", "createdAt": "2020-06-10T20:17:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODMyMTMwNw=="}], "type": "inlineReview"}, {"oid": "a19053941ff34611208a69b95feb9bfa0700a7e5", "url": "https://github.com/dockstore/dockstore/commit/a19053941ff34611208a69b95feb9bfa0700a7e5", "message": "raise time limits", "committedDate": "2020-06-10T19:12:22Z", "type": "commit"}, {"oid": "e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7", "url": "https://github.com/dockstore/dockstore/commit/e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7", "message": "renamed timeout variables, added new executeCommand signature", "committedDate": "2020-06-10T20:20:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODM5MjI0MQ==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438392241", "bodyText": "This should call the next method with the DEFAULT_TIMEOUT_MILLISECONDS as the extra param\nLine 85/86 should call this method with the null as the extra parameter.\n\nI know the second one as like that, but we should only have command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()) once in the file, and we now have it 3 times.", "author": "coverbeck", "createdAt": "2020-06-10T20:34:06Z", "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -89,6 +90,10 @@ public static INIConfiguration parseConfig(String configFile) {\n         return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), workingDir);", "originalCommit": "e1118f1f9d73e9da7d513b1b2db60bcc1db9a1a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "31ae107682bfc2ba898ae7aaa3ac681b17545c37", "url": "https://github.com/dockstore/dockstore/commit/31ae107682bfc2ba898ae7aaa3ac681b17545c37", "message": "removed duplicated funciton calls", "committedDate": "2020-06-10T20:58:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzODgyMzk4Ng==", "url": "https://github.com/dockstore/dockstore/pull/3548#discussion_r438823986", "bodyText": "Hmmm, not sure.\nBut I think this means the default for all commands is now 15 seconds rather than just nextflow parsing in the webservice. For example workflow launches via cromwell or cwltool\nPlease confirm (you would need to build the CLI using this branch version of dockstore-common)", "author": "denis-yuen", "createdAt": "2020-06-11T14:22:22Z", "path": "dockstore-common/src/main/java/io/dockstore/common/Utilities.java", "diffHunk": "@@ -82,13 +83,16 @@ public static INIConfiguration parseConfig(String configFile) {\n     }\n \n     public static ImmutablePair<String, String> executeCommand(String command) {\n-        return executeCommand(command, true, Optional.of(ByteStreams.nullOutputStream()), Optional.of(ByteStreams.nullOutputStream()), null);\n+        return executeCommand(command, null);", "originalCommit": "31ae107682bfc2ba898ae7aaa3ac681b17545c37", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "36cf61b41aaa232cc6a4c363d0920b2bee94cb6f", "url": "https://github.com/dockstore/dockstore/commit/36cf61b41aaa232cc6a4c363d0920b2bee94cb6f", "message": "made timeout optional with default 0", "committedDate": "2020-06-17T20:54:23Z", "type": "commit"}]}