{"pr_number": 3809, "pr_title": "Feature/3559/notification char limit", "pr_createdAt": "2020-09-14T23:30:59Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3809", "timeline": [{"oid": "bf483f8af0b8698073549133052f9414b88caef8", "url": "https://github.com/dockstore/dockstore/commit/bf483f8af0b8698073549133052f9414b88caef8", "message": "Notification char limit increase, migrations", "committedDate": "2020-09-11T23:12:27Z", "type": "commit"}, {"oid": "b33a973e7fbd57965aadd43b29cfb86ced98f89d", "url": "https://github.com/dockstore/dockstore/commit/b33a973e7fbd57965aadd43b29cfb86ced98f89d", "message": "Make an integration test for notifications that are too long using a file with over 1024 characters", "committedDate": "2020-09-14T21:29:04Z", "type": "commit"}, {"oid": "e57b07ca87fc49c28c96bae2e458208a585cc7f3", "url": "https://github.com/dockstore/dockstore/commit/e57b07ca87fc49c28c96bae2e458208a585cc7f3", "message": "Modify IT imports to satisfy checkstyle", "committedDate": "2020-09-14T21:45:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMwMjEzNw==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488302137", "bodyText": "You need a fail after this line; otherwise if the test doesn't throw an error it will pass.", "author": "coverbeck", "createdAt": "2020-09-14T23:58:30Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -131,4 +145,33 @@ public void testUpdateNotification() {\n         assertEquals(currentMsg, message);  // confirm that the database entry was updated\n \n     }\n+    @Test\n+    public void testLongNotification() throws IOException {\n+\n+        // set up a notification that is too long\n+        Notification notification = longNotification();\n+\n+        // try to create notification with too long of a message\n+        try {\n+            curationApiAdmin.createNotification(notification);", "originalCommit": "e57b07ca87fc49c28c96bae2e458208a585cc7f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODMwMjIyOA==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488302228", "bodyText": "Also need fail after this line.", "author": "coverbeck", "createdAt": "2020-09-14T23:58:48Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -131,4 +145,33 @@ public void testUpdateNotification() {\n         assertEquals(currentMsg, message);  // confirm that the database entry was updated\n \n     }\n+    @Test\n+    public void testLongNotification() throws IOException {\n+\n+        // set up a notification that is too long\n+        Notification notification = longNotification();\n+\n+        // try to create notification with too long of a message\n+        try {\n+            curationApiAdmin.createNotification(notification);\n+        } catch (ApiException e) {\n+            assertEquals(Response.Status.BAD_REQUEST.getStatusCode(), e.getCode()); // this should return a 400 code right now\n+        }\n+\n+        // make another notification that will be updated\n+        Notification updateNotification = curationApiAdmin.createNotification(testNotification());\n+        long id = updateNotification.getId();\n+        notification.setId(id);\n+\n+        // try to update notification with long notification\n+        try {\n+            curationApiAdmin.updateNotification(id, notification);", "originalCommit": "e57b07ca87fc49c28c96bae2e458208a585cc7f3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNTA2OA==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488725068", "bodyText": "Seems like an arbitrary number before and now. Can you make some sort of general comment about the number chosen?", "author": "garyluu", "createdAt": "2020-09-15T14:43:34Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Notification.java", "diffHunk": "@@ -44,7 +44,7 @@\n     private long id;\n \n     @Column\n-    @Size(max = 280)\n+    @Size(max = 1024)", "originalCommit": "e57b07ca87fc49c28c96bae2e458208a585cc7f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyODI2Ng==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488828266", "bodyText": "It is mostly an arbitrary number I believe, I think the original was 280 similar to a tweet length but ran into problems with markdown characters/hyper links taking up a significant amount of those 280 characters. I originally doubled to 560 but Louise suggest going to 2^10 just to be safe.", "author": "nolwarre", "createdAt": "2020-09-15T17:12:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNTA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2NzUyMw==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488867523", "bodyText": "Make a comment in the code", "author": "garyluu", "createdAt": "2020-09-15T18:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODcyNTA2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODczMjI4Ng==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488732286", "bodyText": "You can use Java 11's Files.readString(Paths.get(ResourceHelpers.resourceFilePath(\"longNotification\"))); instead of Apache commons", "author": "garyluu", "createdAt": "2020-09-15T14:52:37Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -45,6 +50,15 @@ private Notification anotherTestNotification() {\n         return notification;\n     }\n \n+    private Notification longNotification() throws IOException {\n+        Notification notification = new Notification();\n+        String message = FileUtils.readFileToString(new File(ResourceHelpers.resourceFilePath(\"longNotification.txt\")), StandardCharsets.UTF_8);", "originalCommit": "e57b07ca87fc49c28c96bae2e458208a585cc7f3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODgyNjI2MQ==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488826261", "bodyText": "I changed it to the suggestion, what are the advantages of this approach as opposed to the Apache commons?", "author": "nolwarre", "createdAt": "2020-09-15T17:08:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODczMjI4Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODg2NzQ1MQ==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r488867451", "bodyText": "Don't need to use a 3rd party library when it can be done natively. One day we might be able to remove the 3rd party library entirely", "author": "garyluu", "createdAt": "2020-09-15T18:11:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4ODczMjI4Ng=="}], "type": "inlineReview"}, {"oid": "db6c467a596fbce198740b5c6c82c26baafb8243", "url": "https://github.com/dockstore/dockstore/commit/db6c467a596fbce198740b5c6c82c26baafb8243", "message": "Added failure points for test\n\nChanged to Java 11 file read", "committedDate": "2020-09-15T17:37:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4OTAyNDU0Mw==", "url": "https://github.com/dockstore/dockstore/pull/3809#discussion_r489024543", "bodyText": "I know you just changed this, and I overlooked it in my first review, but I think it would be better to generate the string right here. Java 11 has a feature has a feature Sting.repeat. If you do it this way:\n\nYou know exactly how long the string is. How long is longNotification.txt? I have to open it an editor or run some tool that counts chars. At a glance, I don't know if you're really over testing the limit or not.\nYou could easily test different inputs, up to the limit, just over the limit, etc.\n\nSomething like this:\nString message = \"a\".repeat(1024);\n\nYou could make 1024 a parameter on line 53, so then you test it with exactly 1024, then test again with 1025.\nYou could even make the length a parameter on line 53.", "author": "coverbeck", "createdAt": "2020-09-15T22:20:55Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/NotificationIT.java", "diffHunk": "@@ -45,6 +50,15 @@ private Notification anotherTestNotification() {\n         return notification;\n     }\n \n+    private Notification longNotification() throws IOException {\n+        Notification notification = new Notification();\n+        String message = Files.readString(Paths.get(ResourceHelpers.resourceFilePath(\"longNotification.txt\")));", "originalCommit": "db6c467a596fbce198740b5c6c82c26baafb8243", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a4b1a1bed8822d6c319d88389f6c6fcfb1d38580", "url": "https://github.com/dockstore/dockstore/commit/a4b1a1bed8822d6c319d88389f6c6fcfb1d38580", "message": "Update test to create a string of desired length instead of text file", "committedDate": "2020-09-15T22:55:05Z", "type": "commit"}, {"oid": "222cd8242f7f0b869f0a1aa4aba29dbaefcb1cdc", "url": "https://github.com/dockstore/dockstore/commit/222cd8242f7f0b869f0a1aa4aba29dbaefcb1cdc", "message": "Merge branch 'develop' into feature/3559/notificationCharLimit", "committedDate": "2020-09-16T20:06:40Z", "type": "commit"}]}