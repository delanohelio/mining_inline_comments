{"pr_number": 3631, "pr_title": "Feature/3455/progress towards lazy sourcefiles", "pr_createdAt": "2020-06-30T18:34:48Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3631", "timeline": [{"oid": "5f91f74dada5b8f2ccbdf5889800827ed3ebccfa", "url": "https://github.com/dockstore/dockstore/commit/5f91f74dada5b8f2ccbdf5889800827ed3ebccfa", "message": "progress towards lazy sourcefiles", "committedDate": "2020-06-30T18:20:51Z", "type": "commit"}, {"oid": "91f297c709e54b24e5cc1d12da4d3556607440f1", "url": "https://github.com/dockstore/dockstore/commit/91f297c709e54b24e5cc1d12da4d3556607440f1", "message": "comment", "committedDate": "2020-06-30T18:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNzI5OA==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r447927298", "bodyText": "Should add TODO and super nitpick, why isn't this inside the javadoc section?", "author": "denis-yuen", "createdAt": "2020-06-30T19:27:11Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Tool.java", "diffHunk": "@@ -265,6 +265,7 @@ public String getPath() {\n         return registry + '/' + namespace + '/' + name;\n     }\n \n+    // Make into actual column, run some migration/script to fill all the rows, and update on refresh.", "originalCommit": "91f297c709e54b24e5cc1d12da4d3556607440f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyNzY2NQ==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r447927665", "bodyText": "comment seems out of date on arrival?", "author": "denis-yuen", "createdAt": "2020-06-30T19:27:45Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Version.java", "diffHunk": "@@ -117,7 +122,9 @@\n     private ReferenceType referenceType = ReferenceType.UNSET;\n \n     // watch out for https://hibernate.atlassian.net/browse/HHH-3799 if this is set to EAGER\n-    @OneToMany(fetch = FetchType.EAGER, orphanRemoval = true, cascade = CascadeType.ALL)\n+    // Maybe can change to lazy once db column for descriptorType has been made", "originalCommit": "91f297c709e54b24e5cc1d12da4d3556607440f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkyOTAwNg==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r447929006", "bodyText": "Should document this at least on a class level", "author": "denis-yuen", "createdAt": "2020-06-30T19:30:13Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/database/VersionVerifiedPlatform.java", "diffHunk": "@@ -0,0 +1,38 @@\n+package io.dockstore.webservice.core.database;\n+\n+public class VersionVerifiedPlatform {", "originalCommit": "91f297c709e54b24e5cc1d12da4d3556607440f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzkzMDUyOA==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r447930528", "bodyText": "TODO as well", "author": "denis-yuen", "createdAt": "2020-06-30T19:33:16Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -133,6 +137,19 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n         return this.toolDAO.findCollectionsByEntryId(entry.getId());\n     }\n \n+    // Write tests for this.", "originalCommit": "91f297c709e54b24e5cc1d12da4d3556607440f1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2513126bf720dbde1fc7ac073368f9a00e5cf4d0", "url": "https://github.com/dockstore/dockstore/commit/2513126bf720dbde1fc7ac073368f9a00e5cf4d0", "message": "document, todos, yq", "committedDate": "2020-06-30T20:13:32Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1NDU2MA==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r447954560", "bodyText": "I don't think you need setters. These objects are created via the named query and are not modified after.\nIf I'm right, I would get rid of the setters and make the fields final. Also, the parameters in the constructor should probably be final too -- doesn't Codacy flag that one?\nIn general, immutability is good.", "author": "coverbeck", "createdAt": "2020-06-30T20:19:25Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/database/VersionVerifiedPlatform.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package io.dockstore.webservice.core.database;\n+\n+/**\n+ * This class is a subset of fields from sourcefile and verificationinformation. States what platform (source) a version has been verified on\n+ * and who performed the verification (metadata).\n+ * @author natalieperez\n+ * @since 1.10.0\n+ */\n+public class VersionVerifiedPlatform {\n+\n+    private long versionId;\n+    private String metadata;\n+    private String source;\n+\n+    public VersionVerifiedPlatform(long versionId, String source, String metadata) {\n+        this.versionId = versionId;\n+        this.source = source;\n+        this.metadata = metadata;\n+    }\n+\n+    public long getVersionId() {\n+        return versionId;\n+    }\n+\n+    public void setVersionId(final long versionId) {", "originalCommit": "2513126bf720dbde1fc7ac073368f9a00e5cf4d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Nzk1ODg1OQ==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r447958859", "bodyText": "entryId should be a Long.\n\nAt a quick glance, it seems to be a Long in the other resource file I looked it.\nThere used to be a thing in older JDKs, that may not apply any more, but I still do it, where you shouldn't let Java do autoboxing (automatically convert primitive to object and vice-versa), and should instead do it explicitly -- your long gets \"autoboxed\" into a Long on the next line. So just make it a Long to start with.", "author": "coverbeck", "createdAt": "2020-06-30T20:27:37Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/resources/EntryResource.java", "diffHunk": "@@ -133,6 +137,19 @@ public Entry addAliases(@ApiParam(hidden = true) @Parameter(hidden = true, name\n         return this.toolDAO.findCollectionsByEntryId(entry.getId());\n     }\n \n+    // TODO: Write tests for this endpoint.\n+    @GET\n+    @Path(\"/{entryId}/verifiedPlatforms\")\n+    @UnitOfWork\n+    @Operation(operationId = \"getVerifiedPlatforms\", description = \"Get the verified platforms for each version\", security = @SecurityRequirement(name = OPENAPI_JWT_SECURITY_DEFINITION_NAME))\n+    public List<VersionVerifiedPlatform> getVerifiedPlatforms(@ApiParam(hidden = true) @Parameter(hidden = true, name = \"user\")@Auth Optional<User> user,\n+            @Parameter(name = \"entryId\", description = \"id of the entry\", required = true, in = ParameterIn.PATH) @PathParam(\"entryId\") long entryId) {", "originalCommit": "2513126bf720dbde1fc7ac073368f9a00e5cf4d0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "5b034e2e2d09737ab891c8a6bd16ff4fdbd2bd8f", "url": "https://github.com/dockstore/dockstore/commit/5b034e2e2d09737ab891c8a6bd16ff4fdbd2bd8f", "message": "final, delete setters, typos", "committedDate": "2020-06-30T20:59:57Z", "type": "commit"}, {"oid": "2204d96982d5015bb917d5827d872daba28838b8", "url": "https://github.com/dockstore/dockstore/commit/2204d96982d5015bb917d5827d872daba28838b8", "message": "checkstyle", "committedDate": "2020-06-30T21:14:13Z", "type": "commit"}, {"oid": "deba06de92b7cbcf0fb96672f54bc711dcf2b597", "url": "https://github.com/dockstore/dockstore/commit/deba06de92b7cbcf0fb96672f54bc711dcf2b597", "message": "add tests", "committedDate": "2020-07-01T00:04:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTAxNjc5NQ==", "url": "https://github.com/dockstore/dockstore/pull/3631#discussion_r449016795", "bodyText": "wdl => DescriptorLanguage.WDL.shortname()", "author": "garyluu", "createdAt": "2020-07-02T13:50:58Z", "path": "dockstore-integration-testing/src/test/java/io/dockstore/client/cli/GeneralIT.java", "diffHunk": "@@ -413,6 +416,41 @@ public void verifySourcefileChecksumsSaved(final List<Tag> tags) {\n         });\n     }\n \n+    @Test\n+    public void testGettingVerifiedVersions() {\n+        io.dockstore.openapi.client.ApiClient client = getOpenAPIWebClient(USER_2_USERNAME, testingPostgres);\n+        io.dockstore.openapi.client.api.WorkflowsApi workflowsOpenApi = new io.dockstore.openapi.client.api.WorkflowsApi(client);\n+        final ApiClient webClient = getWebClient(USER_2_USERNAME, testingPostgres);\n+        WorkflowsApi workflowApi = new WorkflowsApi(webClient);\n+        io.dockstore.openapi.client.api.EntriesApi entriesApi = new io.dockstore.openapi.client.api.EntriesApi(client);\n+\n+        Workflow workflow = workflowApi\n+                .manualRegister(\"github\", \"DockstoreTestUser2/hello-dockstore-workflow\", \"/Dockstore.wdl\", \"altname\", \"wdl\", \"/test.json\");", "originalCommit": "deba06de92b7cbcf0fb96672f54bc711dcf2b597", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "68623189e6420181ce5e736c15455d6da806ffce", "url": "https://github.com/dockstore/dockstore/commit/68623189e6420181ce5e736c15455d6da806ffce", "message": "hide swagger, getshortname", "committedDate": "2020-07-02T16:01:01Z", "type": "commit"}, {"oid": "bc5615eb68d9c986915c8df870405a3580390362", "url": "https://github.com/dockstore/dockstore/commit/bc5615eb68d9c986915c8df870405a3580390362", "message": "Merge branch 'develop' into feature/3455/progressTowardsLazySourcefiles", "committedDate": "2020-07-02T16:01:54Z", "type": "commit"}]}