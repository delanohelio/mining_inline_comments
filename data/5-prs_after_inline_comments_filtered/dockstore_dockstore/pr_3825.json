{"pr_number": 3825, "pr_title": "Feature/partial starred", "pr_createdAt": "2020-09-23T21:22:37Z", "pr_url": "https://github.com/dockstore/dockstore/pull/3825", "timeline": [{"oid": "de440c88340ac80ff6fb14467ab230cceeb027e4", "url": "https://github.com/dockstore/dockstore/commit/de440c88340ac80ff6fb14467ab230cceeb027e4", "message": "Fix issue with no starred org or no starred entries", "committedDate": "2020-09-23T20:55:05Z", "type": "commit"}, {"oid": "77aaa87cdcb47452874cd8289cfec300eb02accb", "url": "https://github.com/dockstore/dockstore/commit/77aaa87cdcb47452874cd8289cfec300eb02accb", "message": "Tests and cleanup", "committedDate": "2020-09-23T21:20:51Z", "type": "commit"}, {"oid": "98afa831ed2d49c341c8145d4f39750eb6800128", "url": "https://github.com/dockstore/dockstore/commit/98afa831ed2d49c341c8145d4f39750eb6800128", "message": "Merge branch 'develop' into feature/partial_starred", "committedDate": "2020-09-24T15:44:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY0Mjk0OQ==", "url": "https://github.com/dockstore/dockstore/pull/3825#discussion_r494642949", "bodyText": "could probably delete this then?", "author": "garyluu", "createdAt": "2020-09-24T22:21:56Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/core/Event.java", "diffHunk": "@@ -41,7 +41,7 @@\n         @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByEntryId\", query = \"SELECT e FROM Event e where e.workflow.id = :entryId OR e.tool.id = :entryId\"),\n         @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllForOrganization\", query = \"SELECT eve FROM Event eve WHERE eve.organization.id = :organizationId ORDER BY id DESC\"),\n         @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByOrganizationIds\", query = \"SELECT e FROM Event e WHERE e.organization.id in :organizationIDs ORDER BY id DESC\"),\n-        @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByOrganizationIdsOrEntryIds\", query = \"SELECT e FROM Event e WHERE (e.organization.id in :organizationIDs) OR (e.tool.id in :entryIDs) OR (e.workflow.id in :entryIDs) ORDER BY id DESC\"),\n+        @NamedQuery(name = \"io.dockstore.webservice.core.Event.findAllByOrganizationIdsOrEntryIds\", query = \"SELECT e FROM Event e WHERE e.organization.id in (:organizationIDs) OR e.tool.id in (:entryIDs) OR e.workflow.id in (:entryIDs) ORDER BY id DESC\"),", "originalCommit": "98afa831ed2d49c341c8145d4f39750eb6800128", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY3NTMzMw==", "url": "https://github.com/dockstore/dockstore/pull/3825#discussion_r494675333", "bodyText": "Does this work correctly? Doesn't event.get(\"organization\") return an Organization object? And it's trying to see if it's in a list of Long?\nI know this gets converted into SQL, so maybe it ends up automagically working, that it knows to get the id of the organization, and you have passing tests, but still, just want to be sure.", "author": "coverbeck", "createdAt": "2020-09-25T00:05:42Z", "path": "dockstore-webservice/src/main/java/io/dockstore/webservice/jdbi/EventDAO.java", "diffHunk": "@@ -68,13 +76,29 @@ public long countAllEventsForOrganization(long organizationId) {\n \n     public List<Event> findAllByOrganizationIdsOrEntryIds(Set<Long> organizationIds, Set<Long> entryIds, Integer offset, int limit) {\n         int newLimit = Math.min(MAX_LIMIT, limit);\n-        if (organizationIds.isEmpty()) {\n+\n+        CriteriaBuilder cb = currentSession().getCriteriaBuilder();\n+        CriteriaQuery<Event> query = criteriaQuery();\n+        Root<Event> event = query.from(Event.class);\n+\n+        if (organizationIds.isEmpty() && entryIds.isEmpty()) {\n             return Collections.emptyList();\n         }\n-        Query<Event> query = this.currentSession().getNamedQuery(\"io.dockstore.webservice.core.Event.findAllByOrganizationIdsOrEntryIds\");\n-        query.setParameterList(\"organizationIDs\", organizationIds).setParameter(\"entryIDs\", entryIds)\n-                .setFirstResult(offset).setMaxResults(newLimit);\n-        return list(query);\n+        List<Predicate> list = new ArrayList<>();\n+        if (!organizationIds.isEmpty()) {\n+            list.add(event.get(\"organization\").in(organizationIds));", "originalCommit": "98afa831ed2d49c341c8145d4f39750eb6800128", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTAzMjYxOA==", "url": "https://github.com/dockstore/dockstore/pull/3825#discussion_r495032618", "bodyText": "Yeah, I can get events from both nf-core and seven bridges interweaved on the homepage.\nThere must be some automagic", "author": "denis-yuen", "createdAt": "2020-09-25T14:36:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDY3NTMzMw=="}], "type": "inlineReview"}, {"oid": "2914f0bc8a5f9adfb4250ce163c6870579fc7769", "url": "https://github.com/dockstore/dockstore/commit/2914f0bc8a5f9adfb4250ce163c6870579fc7769", "message": "Laggard delete", "committedDate": "2020-09-25T14:37:14Z", "type": "commit"}, {"oid": "31d80da29792c8cdc3b92e66e7cf74af96e8ac49", "url": "https://github.com/dockstore/dockstore/commit/31d80da29792c8cdc3b92e66e7cf74af96e8ac49", "message": "Merge branch 'develop' into feature/partial_starred", "committedDate": "2020-09-25T20:30:54Z", "type": "commit"}]}