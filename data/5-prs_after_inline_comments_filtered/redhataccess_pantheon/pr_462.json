{"pr_number": 462, "pr_title": "CCS-3862-title_fix", "pr_createdAt": "2020-10-30T15:03:05Z", "pr_url": "https://github.com/redhataccess/pantheon/pull/462", "timeline": [{"oid": "aab5b656226bc7c4d56ef06b3128d45c35d15200", "url": "https://github.com/redhataccess/pantheon/commit/aab5b656226bc7c4d56ef06b3128d45c35d15200", "message": "fix title issue in assembly api", "committedDate": "2020-10-30T15:02:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE3NTE3Mw==", "url": "https://github.com/redhataccess/pantheon/pull/462#discussion_r515175173", "bodyText": "I won't block this, but I'll note that the name of the method is not good: it says fromUuid when in fact it doesn't accept a uuid, but a ModuleVariant.", "author": "carlosmunoz", "createdAt": "2020-10-30T15:19:40Z", "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/assembly/AssemblyVariantJsonServlet.java", "diffHunk": "@@ -201,7 +202,10 @@ protected boolean isValidResource(@Nonnull SlingHttpServletRequest request, @Non\n                         .variants().get()\n                         .canonicalVariant().get();\n                 moduleMap.put(\"canonical_uuid\", canonical.uuid().get());\n-                moduleMap.put(\"title\", page.title().get());\n+                // Get the current title from module instead of using the stored value in the content node\n+                // When module title is modified, the value stored in content node becomes stale.\n+                // Sometime, the title stored in content node shows filename instead of title.\n+                moduleMap.put(\"title\", ServletHelper.getModuleTitleFromUuid(canonical));", "originalCommit": "aab5b656226bc7c4d56ef06b3128d45c35d15200", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxNTE5MzA5Ng==", "url": "https://github.com/redhataccess/pantheon/pull/462#discussion_r515193096", "bodyText": "I see what you're doing here - it seems like your thought is \"page.title() doesn't always give me the information I need, so let me get it from somewhere else.\"\nHere's the thing though... page.title() is exactly what we should be using, so if that's broken, then we need to fix it.\npage.title() is populated in AssemblyVersion.consumeTableOfContents(). It looks like it's coded to use the draft title metadata field, and if the draft doesn't exist, it falls back to filename.\nServletHelper.getModuleTitleFromUuid() has logic that is similar - it pulls the draft metadata title, then tries released, then falls back to blank.\nSince that second case is where you want to go, I would suggest fixing consumeTableOfContents to call latest() instead of draft() in its current logic. I think that would strike a good balance. What do you think?", "author": "benradey", "createdAt": "2020-10-30T15:41:38Z", "path": "pantheon-bundle/src/main/java/com/redhat/pantheon/servlet/assembly/AssemblyVariantJsonServlet.java", "diffHunk": "@@ -201,7 +202,10 @@ protected boolean isValidResource(@Nonnull SlingHttpServletRequest request, @Non\n                         .variants().get()\n                         .canonicalVariant().get();\n                 moduleMap.put(\"canonical_uuid\", canonical.uuid().get());\n-                moduleMap.put(\"title\", page.title().get());\n+                // Get the current title from module instead of using the stored value in the content node\n+                // When module title is modified, the value stored in content node becomes stale.\n+                // Sometime, the title stored in content node shows filename instead of title.\n+                moduleMap.put(\"title\", ServletHelper.getModuleTitleFromUuid(canonical));", "originalCommit": "aab5b656226bc7c4d56ef06b3128d45c35d15200", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}