{"pr_number": 3016, "pr_title": "[GEOT-6129] WFS GetPropertyValue requests fail with App-Schema define\u2026", "pr_createdAt": "2020-06-24T16:06:40Z", "pr_url": "https://github.com/geotools/geotools/pull/3016", "timeline": [{"oid": "8374b563de8227d48bf4a055897802a7c7e0551c", "url": "https://github.com/geotools/geotools/commit/8374b563de8227d48bf4a055897802a7c7e0551c", "message": "[GEOT-6129] WFS GetPropertyValue requests fail with App-Schema defined feature types", "committedDate": "2020-06-24T16:05:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyMTczNA==", "url": "https://github.com/geotools/geotools/pull/3016#discussion_r445021734", "bodyText": "Humm, something looks strange here. Attribute is the parent class of ComplexAttribute, hence it's more generic.\nWhat we are expressing here is ignore this specific case, but for all the others including this one, perform a  ((Attribute) value).getValue(). I think we should test the value class rather than the feature class.", "author": "nmco", "createdAt": "2020-06-24T16:30:06Z", "path": "modules/extension/xsd/xsd-wfs/src/main/java/org/geotools/wfs/PropertyValueCollection.java", "diffHunk": "@@ -180,7 +177,8 @@ public Object next() {\n                             descriptor.isNillable(),\n                             descriptor.getDefaultValue());\n \n-            if (next instanceof SimpleFeature) {\n+            if (next instanceof SimpleFeature || !(value instanceof ComplexAttribute)) {", "originalCommit": "8374b563de8227d48bf4a055897802a7c7e0551c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTAyNDIyNA==", "url": "https://github.com/geotools/geotools/pull/3016#discussion_r445024224", "bodyText": "Caution, value instanceof Attribute will yield true for almost all attributes, since it's one of the root classes of the hierarchy. If I understood correctly, for simple feature the value should already be a concrete value (string, date, number, ...) but you step up in an use case where the value is an attribute so you want to extract the actual value?", "author": "nmco", "createdAt": "2020-06-24T16:34:13Z", "path": "modules/extension/xsd/xsd-wfs/src/main/java/org/geotools/wfs/PropertyValueCollection.java", "diffHunk": "@@ -180,7 +177,8 @@ public Object next() {\n                             descriptor.isNillable(),\n                             descriptor.getDefaultValue());\n \n-            if (next instanceof SimpleFeature) {\n+            if (next instanceof SimpleFeature || !(value instanceof ComplexAttribute)) {\n+                if (value instanceof Attribute) value = ((Attribute) value).getValue();", "originalCommit": "8374b563de8227d48bf4a055897802a7c7e0551c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8e3377af178a94c56e50cce7ced8cd1a67926d32", "url": "https://github.com/geotools/geotools/commit/8e3377af178a94c56e50cce7ced8cd1a67926d32", "message": "better visibility for Attribute creation", "committedDate": "2020-06-26T06:25:27Z", "type": "commit"}, {"oid": "8e3377af178a94c56e50cce7ced8cd1a67926d32", "url": "https://github.com/geotools/geotools/commit/8e3377af178a94c56e50cce7ced8cd1a67926d32", "message": "better visibility for Attribute creation", "committedDate": "2020-06-26T06:25:27Z", "type": "forcePushed"}]}