{"pr_number": 2842, "pr_title": "Fix geot 5621", "pr_createdAt": "2020-03-19T17:22:44Z", "pr_url": "https://github.com/geotools/geotools/pull/2842", "timeline": [{"oid": "978aa5c9ec26729ecdc2a2c2ef3016d687bee61a", "url": "https://github.com/geotools/geotools/commit/978aa5c9ec26729ecdc2a2c2ef3016d687bee61a", "message": "[GEOT-5621] imagemosaic-jdbc - rethrow decoder threads exceptions", "committedDate": "2020-03-19T16:55:07Z", "type": "commit"}, {"oid": "17a17803cab33f40cb0c2340d4bfc5cd8d0616c7", "url": "https://github.com/geotools/geotools/commit/17a17803cab33f40cb0c2340d4bfc5cd8d0616c7", "message": "[GEOT-5621] imagemosaic-jdbc - add test as proof of concept", "committedDate": "2020-03-19T16:55:25Z", "type": "commit"}, {"oid": "45165faaf78590dd853d1f774d4b93cedc6cb1f4", "url": "https://github.com/geotools/geotools/commit/45165faaf78590dd853d1f774d4b93cedc6cb1f4", "message": "[GEOT-5621] imagejdbc-plugin - fix width/height computation", "committedDate": "2020-03-19T17:09:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTM4ODY1Mw==", "url": "https://github.com/geotools/geotools/pull/2842#discussion_r395388653", "bodyText": "Thanks for changing the variable names, intent is easier to follow now.", "author": "jodygarnett", "createdAt": "2020-03-20T00:20:42Z", "path": "modules/plugin/imagemosaic-jdbc/src/main/java/org/geotools/gce/imagemosaic/jdbc/ImageDecoderThread.java", "diffHunk": "@@ -109,34 +109,37 @@ public void run() {\n \n                 double scaleX = savedTileEnvelope.getSpan(0) / bufferedImage.getWidth();\n                 double scaleY = savedTileEnvelope.getSpan(1) / bufferedImage.getHeight();\n-                int x =\n+                int xmin =\n                         (int)\n                                 (Math.round(\n                                         (tileEnvelope.getMinimum(0)\n                                                         - savedTileEnvelope.getMinimum(0))\n                                                 / scaleX));\n-                int y =\n+                int ymin =\n                         (int)\n                                 (Math.round(\n                                         (savedTileEnvelope.getMaximum(1)\n                                                         - tileEnvelope.getMaximum(1))\n                                                 / scaleY));\n-                int width =\n+                int xmax =\n                         (int)\n                                 (Math.round(\n-                                        bufferedImage.getWidth()\n-                                                / savedTileEnvelope.getSpan(0)\n-                                                * tileEnvelope.getSpan(0)));\n-                int height =\n+                                        (tileEnvelope.getMaximum(0)\n+                                                        - savedTileEnvelope.getMinimum(0))\n+                                                / scaleX));\n+                int ymax =\n                         (int)\n                                 (Math.round(\n-                                        bufferedImage.getHeight()\n-                                                / savedTileEnvelope.getSpan(1)\n-                                                * tileEnvelope.getSpan(1)));\n+                                        (savedTileEnvelope.getMaximum(1)\n+                                                        - tileEnvelope.getMinimum(1))\n+                                                / scaleY));\n+                int width = xmax - xmin;\n+                int height = ymax - ymin;\n \n                 if ((width > 0) && (height > 0)) {\n \n-                    BufferedImage clippedImage = bufferedImage.getSubimage(x, y, width, height);\n+                    BufferedImage clippedImage =\n+                            bufferedImage.getSubimage(xmin, ymin, width, height);", "originalCommit": "45165faaf78590dd853d1f774d4b93cedc6cb1f4", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}