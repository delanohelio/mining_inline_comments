{"pr_number": 2105, "pr_title": "Added managed server shutdown/startup in msi mode in Domain on PV model", "pr_createdAt": "2020-12-16T17:41:45Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105", "timeline": [{"oid": "39e11d4b4f698aa7acf960379f74b67e6c2c89de", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/39e11d4b4f698aa7acf960379f74b67e6c2c89de", "message": "Added managed server shutdown/startup in msi mode in Domain on PV model", "committedDate": "2020-12-16T17:23:36Z", "type": "commit"}, {"oid": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into msi-tests", "committedDate": "2020-12-16T22:35:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwOTk5NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545309994", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     \"Can't patch adminServer's serverStartPolicy to NEVER\");\n          \n          \n            \n                     \"Failed to patch adminServer's serverStartPolicy to NEVER\");", "author": "sankarpn", "createdAt": "2020-12-17T18:29:47Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItIstioDomainInPV.java", "diffHunk": "@@ -324,6 +332,49 @@ public void testIstioDomainHomeInPv() {\n     boolean checkApp = checkAppUsingHostHeader(url, domainNamespace + \".org\");\n     assertTrue(checkApp, \"Failed to access WebLogic application\");\n \n+    // Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86407\n+    // Stop and Start the managed server in absense of administration server\n+    assertTrue(patchServerStartPolicy(domainUid, domainNamespace,\n+         \"/spec/adminServer/serverStartPolicy\", \"NEVER\"),\n+         \"Can't patch adminServer's serverStartPolicy to NEVER\");", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4MjkxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545382919", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-12-17T20:27:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwOTk5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMTk2Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545311966", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     \"Can't patch adminServer's serverStartPolicy to NEVER\");\n          \n          \n            \n                     \"Failed to patch adminServer's serverStartPolicy to NEVER\");", "author": "sankarpn", "createdAt": "2020-12-17T18:32:52Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -245,7 +242,9 @@ public void testAdminServerRestart() {\n     DateTime dynTs = getPodCreationTime(domainNamespace, dynamicServerPodName);\n     DateTime cfgTs = getPodCreationTime(domainNamespace, configServerPodName);\n \n-    patchServerStartPolicy(\"/spec/adminServer/serverStartPolicy\", \"NEVER\");\n+    assertTrue(patchServerStartPolicy(domainUid, domainNamespace,\n+         \"/spec/adminServer/serverStartPolicy\", \"NEVER\"),\n+         \"Can't patch adminServer's serverStartPolicy to NEVER\");", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4Mjk3Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545382973", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-12-17T20:28:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMTk2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMjEyOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545312129", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     \"Can't patch adminServer's serverStartPolicy to IF_NEEDED\");\n          \n          \n            \n                     \"Failed to patch adminServer's serverStartPolicy to IF_NEEDED\");", "author": "sankarpn", "createdAt": "2020-12-17T18:33:06Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -271,7 +270,9 @@ public void testAdminServerRestart() {\n     assertTrue(result.contains(\"script doesn't support starting or stopping administration server\"),\n         \"The script shouldn't start the admin server\");\n \n-    patchServerStartPolicy(\"/spec/adminServer/serverStartPolicy\", \"IF_NEEDED\");\n+    assertTrue(patchServerStartPolicy(domainUid, domainNamespace,\n+         \"/spec/adminServer/serverStartPolicy\", \"IF_NEEDED\"),\n+         \"Can't patch adminServer's serverStartPolicy to IF_NEEDED\");", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4MzAyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545383021", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-12-17T20:28:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMjEyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMjQ3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545312479", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                     \"Can't patch domain's serverStartPolicy to ADMIN_ONLY\");\n          \n          \n            \n                     \"Failed to patch domain's serverStartPolicy to ADMIN_ONLY\");", "author": "sankarpn", "createdAt": "2020-12-17T18:33:44Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -427,9 +429,20 @@ public void testDomainRestart() {\n     result = executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null);\n     assertTrue(result.contains(\"No changes needed\"), \"stopDomain.sh shouldn't make changes\");\n \n+    // verify managed server instances can not be started while \n+    // spec.serverStartPolicy is NEVER \n+    result =  assertDoesNotThrow(() ->\n+       executeLifecycleScript(START_SERVER_SCRIPT, SERVER_LIFECYCLE, \"managed-server1\", \"\", false),\n+       String.format(\"Failed to run %s\", START_SERVER_SCRIPT));\n+    assertTrue(result.contains(\"Cannot start server\"),\n+        \"The script shouldn't start the managed server\");\n+    logger.info(\"Managed server instances can not be started while spec.serverStartPolicy is NEVER\");\n+    \n     // Patch the Domain with serverStartPolicy set to ADMIN_ONLY\n-    // Here only Admin server pod should come up\n-    patchServerStartPolicy(\"/spec/serverStartPolicy\", \"ADMIN_ONLY\");\n+    // Here only Administration server pod should come up\n+    assertTrue(patchServerStartPolicy(domainUid, domainNamespace,\n+         \"/spec/serverStartPolicy\", \"ADMIN_ONLY\"),\n+         \"Can't patch domain's serverStartPolicy to ADMIN_ONLY\");", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4MzA3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545383077", "bodyText": "done", "author": "anpanigr", "createdAt": "2020-12-17T20:28:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMjQ3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMzczMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545313730", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * server from scrtach if it has never been started eralier with\n          \n          \n            \n               * server from scratch if it has never been started earlier with", "author": "sankarpn", "createdAt": "2020-12-17T18:35:50Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -935,20 +978,20 @@ public void testDynamicServerLifeCycleWithoutAdmin() {\n \n   /**\n    * Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86251\n-   * Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86407\n    * Once the admin server is stopped, operator can not start a new managed \n-   * server from scrtach if it has never been started eralier with Admin Server\n-   * Once the admin server is stopped, the managed server can only be started \n-   * in MSI (managed server independence) mode. To start a manged server in \n-   * MSI mode, the pre-requisite is the that the manged server MUST be started \n-   * once before admin server is shutdown, so that the embedded LDAP server is \n-   * replicated from admin server to the managed server. \n-   * In this case of MII and DomainInImage model, the server state/configuration\n-   * is not saved once the server is shutdown unless we use domain-on-pv model\n-   * So in MII case, startServer.sh script update the replica count but the \n-   * server startup is defered till we re-start the adminserver. Here the \n-   * operator tries to start the managed server but it will keep on failing \n-   * until AdminServer is available.   \n+   * server from scrtach if it has never been started eralier with", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4NTQ5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545385496", "bodyText": "resolved the typo", "author": "anpanigr", "createdAt": "2020-12-17T20:32:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxMzczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNDgwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545314807", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * replica count but the server startup is defered till we re-start the \n          \n          \n            \n               * replica count but the server startup is deferred till we re-start the", "author": "sankarpn", "createdAt": "2020-12-17T18:37:31Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -935,20 +978,20 @@ public void testDynamicServerLifeCycleWithoutAdmin() {\n \n   /**\n    * Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86251\n-   * Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86407\n    * Once the admin server is stopped, operator can not start a new managed \n-   * server from scrtach if it has never been started eralier with Admin Server\n-   * Once the admin server is stopped, the managed server can only be started \n-   * in MSI (managed server independence) mode. To start a manged server in \n-   * MSI mode, the pre-requisite is the that the manged server MUST be started \n-   * once before admin server is shutdown, so that the embedded LDAP server is \n-   * replicated from admin server to the managed server. \n-   * In this case of MII and DomainInImage model, the server state/configuration\n-   * is not saved once the server is shutdown unless we use domain-on-pv model\n-   * So in MII case, startServer.sh script update the replica count but the \n-   * server startup is defered till we re-start the adminserver. Here the \n-   * operator tries to start the managed server but it will keep on failing \n-   * until AdminServer is available.   \n+   * server from scrtach if it has never been started eralier with\n+   * administration Server. Once the administration server is stopped, the \n+   * managed server can only be started in MSI (managed server independence) \n+   * mode. To start a managed server in MSI mode, the pre-requisite is that the\n+   * managed server MUST be started once before administration server is \n+   * shutdown, so that the security configuration is replicated to the managed \n+   * server. In this case of MII and DomainInImage model, the server \n+   * state/configuration is lost once the server is shutdown unless we use \n+   * domain-on-pv model. So in MII case, startServer.sh script update the \n+   * replica count but the server startup is defered till we re-start the ", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM4NTU3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545385572", "bodyText": "resolved the typo", "author": "anpanigr", "createdAt": "2020-12-17T20:32:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMxNDgwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwMTkzNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545301936", "bodyText": "Comment can be removed.", "author": "ankedia", "createdAt": "2020-12-17T18:17:19Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItIstioDomainInPV.java", "diffHunk": "@@ -135,7 +139,7 @@ public static void initAll(@Namespaces(2) List<String> namespaces) {\n     labelMap.put(\"istio-injection\", \"enabled\");\n \n     assertDoesNotThrow(() -> addLabelsToNamespace(domainNamespace,labelMap));\n-    assertDoesNotThrow(() -> addLabelsToNamespace(opNamespace,labelMap));\n+    // assertDoesNotThrow(() -> addLabelsToNamespace(opNamespace,labelMap));", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5NTAwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545395005", "bodyText": "I should uncomment the statement. Istio should be enabled in Operator Namespace.", "author": "anpanigr", "createdAt": "2020-12-17T20:50:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMwMTkzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMDU2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545320568", "bodyText": "I assume domain's spec.serverStartPolicy  is NEVER. Probably comment can say that \"managed server instances can't be started while domain is stopped\".", "author": "ankedia", "createdAt": "2020-12-17T18:46:32Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -427,9 +429,20 @@ public void testDomainRestart() {\n     result = executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null);\n     assertTrue(result.contains(\"No changes needed\"), \"stopDomain.sh shouldn't make changes\");\n \n+    // verify managed server instances can not be started while \n+    // spec.serverStartPolicy is NEVER ", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5NTI3NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545395275", "bodyText": "Modified the comments.", "author": "anpanigr", "createdAt": "2020-12-17T20:51:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMDU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwODI0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545408243", "bodyText": "update the use case description for the changes", "author": "vanajamukkara", "createdAt": "2020-12-17T21:15:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyMDU2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDU2NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545324565", "bodyText": "Use constant STOP_DOMAIN_SCRIPT for \"stopDomain.sh\"", "author": "ankedia", "createdAt": "2020-12-17T18:51:23Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -427,9 +429,20 @@ public void testDomainRestart() {\n     result = executeLifecycleScript(STOP_DOMAIN_SCRIPT, DOMAIN, null);\n     assertTrue(result.contains(\"No changes needed\"), \"stopDomain.sh shouldn't make changes\");", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTM5MDQ3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545390479", "bodyText": "This is a string to be when the test  fails.", "author": "anpanigr", "createdAt": "2020-12-17T20:41:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNDU2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNzE3Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545327176", "bodyText": "Replace with constant.", "author": "ankedia", "createdAt": "2020-12-17T18:55:21Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItIstioDomainInPV.java", "diffHunk": "@@ -255,6 +259,10 @@ public void testIstioDomainHomeInPv() {\n                 .clusterName(clusterName)\n                 .replicas(replicaCount)\n                 .serverStartState(\"RUNNING\"))\n+            .addManagedServersItem(new ManagedServer()\n+                .serverName(\"managed-server2\")", "originalCommit": "8fb20fa47ea7246d377a45ef32a191b6586d7fd3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwOTc1MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545409750", "bodyText": "Managed Server need not be added, as I am doing scale down/up in the absence of Admin Server.", "author": "anpanigr", "createdAt": "2020-12-17T21:18:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTMyNzE3Ng=="}], "type": "inlineReview"}, {"oid": "4a434d255a76cedf6cadebfef5dca8f568f8cc98", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4a434d255a76cedf6cadebfef5dca8f568f8cc98", "message": "Addressed review comments", "committedDate": "2020-12-17T20:26:47Z", "type": "commit"}, {"oid": "92d8372378041c2d97e0dfe1b1250658d2e27f8b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/92d8372378041c2d97e0dfe1b1250658d2e27f8b", "message": "More review comments", "committedDate": "2020-12-17T20:31:37Z", "type": "commit"}, {"oid": "04032a6f49c4df5f971077fb447dde6335c4bff9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/04032a6f49c4df5f971077fb447dde6335c4bff9", "message": "Remove additional managed server configutration and enable Operator namespace for istio", "committedDate": "2020-12-17T21:20:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwMjQ5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545402490", "bodyText": "update the use case description for this change", "author": "vanajamukkara", "createdAt": "2020-12-17T21:04:14Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItIstioDomainInPV.java", "diffHunk": "@@ -324,6 +332,49 @@ public void testIstioDomainHomeInPv() {\n     boolean checkApp = checkAppUsingHostHeader(url, domainNamespace + \".org\");\n     assertTrue(checkApp, \"Failed to access WebLogic application\");\n \n+    // Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86407", "originalCommit": "92d8372378041c2d97e0dfe1b1250658d2e27f8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0Mjg5Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545442892", "bodyText": "Added the following line to the test description\nAdditionally, the test verifies that WebLogic cluster can be scaled down and scaled up in the absence of Administration server.", "author": "anpanigr", "createdAt": "2020-12-17T22:24:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwMjQ5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwMzU3MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545403571", "bodyText": "Check CommonTestUtils for this method and call that.", "author": "vanajamukkara", "createdAt": "2020-12-17T21:06:12Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItIstioDomainInPV.java", "diffHunk": "@@ -324,6 +332,49 @@ public void testIstioDomainHomeInPv() {\n     boolean checkApp = checkAppUsingHostHeader(url, domainNamespace + \".org\");\n     assertTrue(checkApp, \"Failed to access WebLogic application\");\n \n+    // Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86407\n+    // Stop and Start the managed server in absense of administration server\n+    assertTrue(patchServerStartPolicy(domainUid, domainNamespace,\n+         \"/spec/adminServer/serverStartPolicy\", \"NEVER\"),\n+         \"Failed to patch administrationi server serverStartPolicy to NEVER\");\n+    logger.info(\"Domain is patched to shutdown administration server\");\n+    checkPodDeleted(adminServerPodName, domainUid, domainNamespace);\n+    logger.info(\"Administration server shutdown success\");\n+\n+    boolean scalingSuccess = assertDoesNotThrow(() ->\n+        scaleCluster(domainUid, domainNamespace, \"cluster-1\", 1),\n+        String.format(\"Scaling down cluster cluster-1 of domain %s in namespace %s failed\",\n+        domainUid, domainNamespace));\n+    assertTrue(scalingSuccess,\n+        String.format(\"Cluster scaling failed for domain %s in namespace %s\", domainUid, domainNamespace));\n+    logger.info(\"Cluster is scaled down in absense of administration server\");\n+    checkPodDeleted(managedServerPodNamePrefix + \"2\", domainUid, domainNamespace);\n+    logger.info(\"Managed Server stopped in absense of administration server\");\n+\n+    scalingSuccess = assertDoesNotThrow(() ->\n+        scaleCluster(domainUid, domainNamespace, \"cluster-1\", 2),\n+        String.format(\"Scaling up cluster cluster-1 of domain %s in namespace %s failed\",\n+        domainUid, domainNamespace));\n+    assertTrue(scalingSuccess,\n+        String.format(\"Cluster scaling failed for domain %s in namespace %s\", domainUid, domainNamespace));\n+    logger.info(\"Cluster is scaled up in absense of administration server\");\n+    checkServiceExists(managedServerPodNamePrefix + \"2\", domainNamespace);\n+    checkPodReady(managedServerPodNamePrefix + \"2\", domainUid, domainNamespace);\n+    logger.info(\"Managed Server started in absense of administration server\");\n+  }\n+\n+  private void checkPodDeleted(String podName, String domainUid, String domNamespace) {", "originalCommit": "92d8372378041c2d97e0dfe1b1250658d2e27f8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ5MTQ5Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545491492", "bodyText": "updated tests to use CommonTestUtils .checkPodDeleted()", "author": "anpanigr", "createdAt": "2020-12-18T00:20:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQwMzU3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjMwOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545412308", "bodyText": "you have the same code both inside try and in finally blocks, keep it at one place(finally).", "author": "vanajamukkara", "createdAt": "2020-12-17T21:23:27Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -916,17 +956,20 @@ public void testDynamicServerLifeCycleWithoutAdmin() {\n       logger.info(\"Server[\" + serverName + \"] pod is initialized\");\n \n       // (re)Start Start the admin\n-      patchServerStartPolicy(\n-             \"/spec/adminServer/serverStartPolicy\", \"IF_NEEDED\");\n+      assertTrue(patchServerStartPolicy(domainUid, domainNamespace,\n+            \"/spec/adminServer/serverStartPolicy\", \"IF_NEEDED\"),\n+             \"Failed to patch adminServer's serverStartPolicy to IF_NEEDED\");\n       checkPodReadyAndServiceExists(\n              adminServerPodName, domainUid, domainNamespace);\n-      logger.info(\"AdminServer restart success\");\n+      logger.info(\"administration server restart success\");\n \n       checkPodReadyAndServiceExists(serverPodName, domainUid, domainNamespace);\n       logger.info(\"(re)Started [\" + serverName + \"] on admin server restart\");\n     } finally {\n       // restart admin server\n-      patchServerStartPolicy(\"/spec/adminServer/serverStartPolicy\", \"IF_NEEDED\");\n+      assertTrue(patchServerStartPolicy(domainUid, domainNamespace,", "originalCommit": "92d8372378041c2d97e0dfe1b1250658d2e27f8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0NzcwNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545447704", "bodyText": "The code inside the try/catch block is part of test, which verifies that the managed server get started once the admin server is (re) started. The finally block is for if the test fails for any other reason before reaching the above scenario.", "author": "anpanigr", "createdAt": "2020-12-17T22:34:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1ODI2Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545458262", "bodyText": "finally block gets executed in all cases, you can just keep the code in finally. No need to keep the code in both try and finally.", "author": "vanajamukkara", "createdAt": "2020-12-17T22:57:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ2NTU2MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545465561", "bodyText": "I know. I want to start the stop/start the admin server in my test. The admin server start in finally block is void if the test pass.", "author": "anpanigr", "createdAt": "2020-12-17T23:11:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjMwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjQ0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545412440", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n               * server from scratch if it has never been started eralier with\n          \n          \n            \n               * server from scratch if it has never been started earlier with", "author": "vanajamukkara", "createdAt": "2020-12-17T21:23:44Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java", "diffHunk": "@@ -935,20 +978,20 @@ public void testDynamicServerLifeCycleWithoutAdmin() {\n \n   /**\n    * Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86251\n-   * Refer JIRA https://jira.oraclecorp.com/jira/browse/OWLS-86407\n    * Once the admin server is stopped, operator can not start a new managed \n-   * server from scrtach if it has never been started eralier with Admin Server\n-   * Once the admin server is stopped, the managed server can only be started \n-   * in MSI (managed server independence) mode. To start a manged server in \n-   * MSI mode, the pre-requisite is the that the manged server MUST be started \n-   * once before admin server is shutdown, so that the embedded LDAP server is \n-   * replicated from admin server to the managed server. \n-   * In this case of MII and DomainInImage model, the server state/configuration\n-   * is not saved once the server is shutdown unless we use domain-on-pv model\n-   * So in MII case, startServer.sh script update the replica count but the \n-   * server startup is defered till we re-start the adminserver. Here the \n-   * operator tries to start the managed server but it will keep on failing \n-   * until AdminServer is available.   \n+   * server from scratch if it has never been started eralier with", "originalCommit": "92d8372378041c2d97e0dfe1b1250658d2e27f8b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxNDgyMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545414820", "bodyText": "what is the difference between testDynamicServerLifeCycleWithoutAdmin and testConfiguredServerLifeCycleWithoutAdmin? is it just the cluster type?", "author": "vanajamukkara", "createdAt": "2020-12-17T21:28:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjQ0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ0NDY3MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545444670", "bodyText": "yes. You are right", "author": "anpanigr", "createdAt": "2020-12-17T22:27:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjQ0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ1OTQ0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545459448", "bodyText": "Is there any reason for testing the same use case for both dynamic cluster and configured cluster? I don't think there is any difference in behavior based on cluster type.", "author": "vanajamukkara", "createdAt": "2020-12-17T22:59:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjQ0MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ2NjQ1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2105#discussion_r545466457", "bodyText": "Yes, we need coverage on both configured and dynamic cluster as far as server lifecycle is concerned.", "author": "anpanigr", "createdAt": "2020-12-17T23:13:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQxMjQ0MA=="}], "type": "inlineReview"}, {"oid": "9bac727376e21b3adaa35c118a0eed1f81b205de", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9bac727376e21b3adaa35c118a0eed1f81b205de", "message": "Update integration-tests/src/test/java/oracle/weblogic/kubernetes/ItServerStartPolicy.java\n\nCo-authored-by: Vanajakshi Mukkara <35709372+vanajamukkara@users.noreply.github.com>", "committedDate": "2020-12-17T22:30:34Z", "type": "commit"}, {"oid": "6d3769647ebb136a3d4aea3264c98be74ac76591", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6d3769647ebb136a3d4aea3264c98be74ac76591", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into msi-tests", "committedDate": "2020-12-18T00:29:18Z", "type": "commit"}, {"oid": "2afad8ef987f3975ad17cbbaf31ea06b46a8fbba", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2afad8ef987f3975ad17cbbaf31ea06b46a8fbba", "message": "Updated test to use common utility", "committedDate": "2020-12-18T00:40:38Z", "type": "commit"}]}