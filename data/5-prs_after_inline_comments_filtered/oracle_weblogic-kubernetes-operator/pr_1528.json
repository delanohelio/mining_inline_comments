{"pr_number": 1528, "pr_title": "Added two more tests to cover config update by creating an image w a new tag ", "pr_createdAt": "2020-04-02T23:32:53Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528", "timeline": [{"oid": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "message": "Added two more tests to cover config update by creating an image with a new tag jenkins-ignore", "committedDate": "2020-04-02T23:27:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNjk3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403006979", "bodyText": "tests should not throw exceptions", "author": "markxnelson", "createdAt": "2020-04-03T13:31:43Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImageConfigUpdate.java", "diffHunk": "@@ -109,7 +109,7 @@ public static void staticUnPrepare() throws Exception {\n    * @throws Exception if domain creation, config update or test veriofication fails\n    */\n   @Test\n-  public void testMiiConfigUpdateNonExistJdbc() throws Exception {\n+  public void testMiiConfigUpdateNonJdbcCm() throws Exception {", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4OTAzMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403389031", "bodyText": "fixed", "author": "hzhao-github", "createdAt": "2020-04-03T23:57:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNjk3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNzI0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403007244", "bodyText": "tests should not throw exceptions\nif you think there may be an exception - write an assert to catch it", "author": "markxnelson", "createdAt": "2020-04-03T13:32:07Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImageConfigUpdate.java", "diffHunk": "@@ -153,6 +153,62 @@ public void testMiiConfigUpdateNonExistJdbc() throws Exception {\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethodName);\n   }\n \n+  /**\n+   * Create a domain without a JDBC DS using model in image and having configmap\n+   * in the domain.yaml before deploying the domain. After deploying the domain crd,\n+   * create a new image with diff tag name and model files that define a JDBC DataSource\n+   * and update the domain crd to change image name to reload the model,\n+   * generate new config and initiate a rolling restart.\n+   *\n+   * @throws Exception if domain creation, config update or test veriofication fails\n+   */\n+  @Test\n+  public void testMiiConfigUpdateNonJdbcImage() throws Exception {", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4ODA1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403388051", "bodyText": "removed \"throws Exception\" from all tests", "author": "hzhao-github", "createdAt": "2020-04-03T23:53:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNzI0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNzkyMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403007920", "bodyText": "is it just me, or is there not a single assertion in this whole test?", "author": "markxnelson", "createdAt": "2020-04-03T13:33:18Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImageConfigUpdate.java", "diffHunk": "@@ -153,6 +153,62 @@ public void testMiiConfigUpdateNonExistJdbc() throws Exception {\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethodName);\n   }\n \n+  /**\n+   * Create a domain without a JDBC DS using model in image and having configmap\n+   * in the domain.yaml before deploying the domain. After deploying the domain crd,\n+   * create a new image with diff tag name and model files that define a JDBC DataSource\n+   * and update the domain crd to change image name to reload the model,\n+   * generate new config and initiate a rolling restart.\n+   *\n+   * @throws Exception if domain creation, config update or test veriofication fails\n+   */\n+  @Test\n+  public void testMiiConfigUpdateNonJdbcImage() throws Exception {\n+    Assumptions.assumeTrue(QUICKTEST);\n+    String testMethodName = new Object() {\n+    }.getClass().getEnclosingMethod().getName();\n+    logTestBegin(testMethodName);\n+    LoggerHelper.getLocal().log(Level.INFO,\n+        \"Creating Domain & waiting for the script to complete execution\");\n+    boolean testCompletedSuccessfully = false;\n+    try {\n+      // create Domain w/o JDBC DS using the image created by MII\n+      boolean createDS = false;\n+      createDomainUsingMii(createDS);\n+\n+      // create image with a new tag to update config\n+      Map<String, Object> domainMap = domain.getDomainMap();\n+      final String imageName = (String) domainMap.get(\"image\") + \"_nonjdbc\";\n+      final String wdtModelFile = \"model.jdbc.yaml\";\n+      final String wdtModelPropFile = \"model.jdbc.properties\";\n+      createDomainImage(domainMap, imageName, wdtModelFile, wdtModelPropFile);\n+\n+      // update domain yaml with new image tag and\n+      // apply the domain yaml, verify domain rolling-restarted\n+      modifyDomainYamlWithImageName(domain, domainNS, imageName);\n+\n+      // verify the test result by checking updated config file on server pod\n+      verifyJdbcUpdate();\n+\n+      // verify that JDBC DS is created by checking JDBC DS name and read timeout\n+      LoggerHelper.getLocal().log(Level.INFO, \"Verify that JDBC DS is created\");\n+      Set<String> jdbcResourcesToVerify = new HashSet<String>();\n+      jdbcResourcesToVerify.add(\"datasource.name.1=\" + dsName);\n+      jdbcResourcesToVerify.add(\"datasource.readTimeout.1=\" + readTimeout_2);\n+\n+      final String destDir = getResultDir() + \"/samples/model-in-image-update\";\n+      verifyJdbcResources(jdbcResourcesToVerify, destDir);\n+\n+      testCompletedSuccessfully = true;", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2NDEyMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403364120", "bodyText": "assertion is inside of verifyJdbcResources(jdbcResourcesToVerify, destDir);\nprivate void verifyJdbcResources(Set jdbcResourcesSet, String destDir)  {\n// verify JDBC DS props via WLST on server pod\nString jdbcResources = getJdbcResources(destDir);\nIterator<String> iterator = jdbcResourcesSet.iterator();\nwhile (iterator.hasNext()) {\n  String prop = iterator.next();\n  Assertions.assertTrue(jdbcResources.contains(prop), prop + \" is not found\");\n  LoggerHelper.getLocal().log(Level.INFO, prop + \" exists\");\n}\n\n}", "author": "hzhao-github", "createdAt": "2020-04-03T22:21:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNzkyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MTMyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403371321", "bodyText": "it feels like there should be more than that, i think we should be checking each operation as we go, to make sure it is behaving as we expect.  your javadoc reads like there are several steps - we should check as we go to make sure they all work, please", "author": "markxnelson", "createdAt": "2020-04-03T22:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzAwNzkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NTU2Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403065566", "bodyText": "spelling", "author": "markxnelson", "createdAt": "2020-04-03T14:57:02Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImageConfigUpdate.java", "diffHunk": "@@ -153,6 +153,62 @@ public void testMiiConfigUpdateNonExistJdbc() throws Exception {\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethodName);\n   }\n \n+  /**\n+   * Create a domain without a JDBC DS using model in image and having configmap\n+   * in the domain.yaml before deploying the domain. After deploying the domain crd,\n+   * create a new image with diff tag name and model files that define a JDBC DataSource\n+   * and update the domain crd to change image name to reload the model,\n+   * generate new config and initiate a rolling restart.\n+   *\n+   * @throws Exception if domain creation, config update or test veriofication fails", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzE5ODkxMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403198913", "bodyText": "fixed changed to verification", "author": "hzhao-github", "createdAt": "2020-04-03T17:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA2NTU2Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjA2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403372068", "bodyText": "i have the same concern here, it seems like there are several steps and there should be assertions after each step to make sure it is working as desired. thanks", "author": "markxnelson", "createdAt": "2020-04-03T22:47:56Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImageConfigUpdate.java", "diffHunk": "@@ -218,6 +274,62 @@ public void testMiiConfigUpdateExistJdbc() throws Exception {\n     LoggerHelper.getLocal().log(Level.INFO, \"SUCCESS - \" + testMethodName);\n   }\n \n+  /**\n+   * Create a domain with a JDBC DS using model in image and having configmap\n+   * in the domain.yaml before deploying the domain. After deploying the domain crd,\n+   * create a new image with diff tag name and model files that define a JDBC DataSource\n+   * and update the domain crd to change image name to reload the model,\n+   * generate new config and initiate a rolling restart.\n+   *\n+   * @throws Exception if domain creation, config update or test veriofication fails\n+   */\n+  @Test\n+  public void testMiiConfigUpdateJdbcImage() throws Exception {", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4OTQzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403389439", "bodyText": "ok. Let me move the assertions to right after the operation is done to make it look clearer", "author": "hzhao-github", "createdAt": "2020-04-03T23:59:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjA2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzU1ODUzNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403558536", "bodyText": "Mark, I made changes regarding this. I added Assertions after each step, some of them are added in the helper methods, others added in the test methods themselves. Could you please take one more look see if you are ok with the changes.", "author": "hzhao-github", "createdAt": "2020-04-04T22:57:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjA2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjM3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403372374", "bodyText": "this is good - we are checking the outcome, and printing out a nice descriptive message, but i think an assertion that it does not throw an exception would be better style.", "author": "markxnelson", "createdAt": "2020-04-03T22:48:58Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/MiiBaseTest.java", "diffHunk": "@@ -76,15 +77,109 @@ public Domain createMiiDomainWithConfigMap(String domainUidPrefix,\n     return domain;\n   }\n \n+  /**\n+   * Modify the domain yaml to change domain-level restart version.\n+   * @param domainNS the domain namespace\n+   * @param domainUid the domain UID\n+   * @param versionNo version number of domain\n+   *\n+   * @throws Exception if patching domain fails\n+   */\n+  protected void createDomainImage(Map<String, Object> domainMap, String imageName,\n+                                   String modelFile, String modelPropFile) throws Exception {\n+    String domainBaseImageName = (String) domainMap.get(\"domainHomeImageBase\");\n+    String domainUid = (String) domainMap.get(\"domainUID\");\n+    String domainName = (String) domainMap.get(\"domainName\");\n+    LoggerHelper.getLocal().log(Level.INFO, \"imageName: \" + imageName);\n+    LoggerHelper.getLocal().log(Level.INFO, \"domainBaseImageName: \" + domainBaseImageName);\n+    LoggerHelper.getLocal().log(Level.INFO, \"domainUid: \" + domainUid);\n+    LoggerHelper.getLocal().log(Level.INFO, \"domainName: \" + domainName);\n+\n+    // Get the map of any additional environment vars, or null\n+    Map<String, String> additionalEnvMap = (Map<String, String>) domainMap.get(\"additionalEnvMap\");\n+    String resultsDir = (String) domainMap.get(\"resultDir\");\n+    StringBuffer createDomainImageScriptCmd = new StringBuffer(\"export WDT_VERSION=\");\n+\n+    createDomainImageScriptCmd.append(BaseTest.WDT_VERSION).append(\" && \")\n+      .append(getUserProjectsDir())\n+      .append(\"/weblogic-domains/\")\n+      .append(domainName)\n+      .append(\"/miiWorkDir/\")\n+      .append(\"imagetool/bin/imagetool.sh update\")\n+      .append(\" --tag \")\n+      .append(imageName)\n+      .append(\" --fromImage \")\n+      .append(domainBaseImageName)\n+      .append(\" --wdtModel \")\n+      .append(resultsDir)\n+      .append(\"/samples/model-in-image/\")\n+      .append(modelFile)\n+      .append(\" --wdtVariables \")\n+      .append(resultsDir)\n+      .append(\"/samples/model-in-image/\")\n+      .append(modelPropFile)\n+      .append(\" --wdtArchive \")\n+      .append(getUserProjectsDir())\n+      .append(\"/weblogic-domains/\")\n+      .append(domainName)\n+      .append(\"/miiWorkDir/models/archive.zip\")\n+      .append(\" --wdtModelOnly \")\n+      .append(\" --wdtDomainType \")\n+      .append(WdtDomainType.WLS.geWdtDomainType());\n+\n+    // patching the domain\n+    LoggerHelper.getLocal().log(Level.INFO, \"Command to create domain image: \" + createDomainImageScriptCmd);\n+    ExecResult result = ExecCommand.exec(createDomainImageScriptCmd.toString(), true, additionalEnvMap);\n+    if (result.exitValue() != 0) {\n+      throw new RuntimeException(", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4ODY3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403388679", "bodyText": "yea. I have changed it to:\ncatch (Exception ex) {\nStringBuffer errorMsg = new StringBuffer(\"FAILURE: command: \");\nerrorMsg\n.append(createDomainImageScriptCmd)\n.append(\" failed, returned \")\n.append(result.stdout())\n.append(\"\\n\")\n.append(result.stderr());\n  Assertions.fail(errorMsg + \"\\n \" + ex.getMessage());\n}", "author": "hzhao-github", "createdAt": "2020-04-03T23:56:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjM3NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjY2NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403372665", "bodyText": "logging is great, thanks!\ni also would love to see an assertion in here, and a descriptive error please", "author": "markxnelson", "createdAt": "2020-04-03T22:49:50Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/MiiBaseTest.java", "diffHunk": "@@ -76,15 +77,109 @@ public Domain createMiiDomainWithConfigMap(String domainUidPrefix,\n     return domain;\n   }\n \n+  /**\n+   * Modify the domain yaml to change domain-level restart version.\n+   * @param domainNS the domain namespace\n+   * @param domainUid the domain UID\n+   * @param versionNo version number of domain\n+   *\n+   * @throws Exception if patching domain fails\n+   */\n+  protected void createDomainImage(Map<String, Object> domainMap, String imageName,\n+                                   String modelFile, String modelPropFile) throws Exception {\n+    String domainBaseImageName = (String) domainMap.get(\"domainHomeImageBase\");\n+    String domainUid = (String) domainMap.get(\"domainUID\");\n+    String domainName = (String) domainMap.get(\"domainName\");\n+    LoggerHelper.getLocal().log(Level.INFO, \"imageName: \" + imageName);\n+    LoggerHelper.getLocal().log(Level.INFO, \"domainBaseImageName: \" + domainBaseImageName);\n+    LoggerHelper.getLocal().log(Level.INFO, \"domainUid: \" + domainUid);\n+    LoggerHelper.getLocal().log(Level.INFO, \"domainName: \" + domainName);\n+\n+    // Get the map of any additional environment vars, or null\n+    Map<String, String> additionalEnvMap = (Map<String, String>) domainMap.get(\"additionalEnvMap\");\n+    String resultsDir = (String) domainMap.get(\"resultDir\");\n+    StringBuffer createDomainImageScriptCmd = new StringBuffer(\"export WDT_VERSION=\");\n+\n+    createDomainImageScriptCmd.append(BaseTest.WDT_VERSION).append(\" && \")\n+      .append(getUserProjectsDir())\n+      .append(\"/weblogic-domains/\")\n+      .append(domainName)\n+      .append(\"/miiWorkDir/\")\n+      .append(\"imagetool/bin/imagetool.sh update\")\n+      .append(\" --tag \")\n+      .append(imageName)\n+      .append(\" --fromImage \")\n+      .append(domainBaseImageName)\n+      .append(\" --wdtModel \")\n+      .append(resultsDir)\n+      .append(\"/samples/model-in-image/\")\n+      .append(modelFile)\n+      .append(\" --wdtVariables \")\n+      .append(resultsDir)\n+      .append(\"/samples/model-in-image/\")\n+      .append(modelPropFile)\n+      .append(\" --wdtArchive \")\n+      .append(getUserProjectsDir())\n+      .append(\"/weblogic-domains/\")\n+      .append(domainName)\n+      .append(\"/miiWorkDir/models/archive.zip\")\n+      .append(\" --wdtModelOnly \")\n+      .append(\" --wdtDomainType \")\n+      .append(WdtDomainType.WLS.geWdtDomainType());\n+\n+    // patching the domain\n+    LoggerHelper.getLocal().log(Level.INFO, \"Command to create domain image: \" + createDomainImageScriptCmd);\n+    ExecResult result = ExecCommand.exec(createDomainImageScriptCmd.toString(), true, additionalEnvMap);\n+    if (result.exitValue() != 0) {\n+      throw new RuntimeException(\n+        \"FAILURE: command \"\n+          + createDomainImageScriptCmd\n+          + \" failed, returned \"\n+          + result.stdout()\n+          + \"\\n\"\n+          + result.stderr());\n+    }\n+  }\n+\n+  /**\n+   * Modify the domain yaml to change image name.\n+   * @param domainNS the domain namespace\n+   * @param domainUid the domain UID\n+   * @param imageName image name\n+   *\n+   * @throws Exception if patching domain fails\n+   */\n+  protected void modifyDomainYamlWithImageName(\n+      Domain domain, String domainNS, String imageName) throws Exception {\n+    String versionNo = getRestartVersion(domainNS, domain.getDomainUid());\n+    StringBuffer patchDomainCmd = new StringBuffer(\"kubectl -n \");\n+    patchDomainCmd\n+        .append(domainNS)\n+        .append(\" patch domain \")\n+        .append(domain.getDomainUid())\n+        .append(\" --type='json' \")\n+        .append(\" -p='[{\\\"op\\\": \\\"replace\\\", \\\"path\\\": \\\"/spec/image\\\", \\\"value\\\": \\\"'\")\n+        .append(imageName)\n+        .append(\"'\\\" }]'\");\n+\n+    // patching the domain\n+    LoggerHelper.getLocal().log(Level.INFO, \"Command to patch domain: \" + patchDomainCmd);\n+    ExecResult result = TestUtils.exec(patchDomainCmd.toString());\n+    LoggerHelper.getLocal().log(Level.INFO, \"Domain patch result: \" + result.stdout());\n+\n+    // verify the domain restarted", "originalCommit": "4b48a4c7b0ed5bf44c6626d7f5bc01d185e4f16a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4ODk1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403388951", "bodyText": "yea. I have changed it to:\n  StringBuffer errorMsg = new StringBuffer(\"FAILURE: command: \");\n  errorMsg\n      .append(patchDomainCmd)\n      .append(\" failed, returned \")\n      .append(result.stdout())\n      .append(\"\\n\")\n      .append(result.stderr());\n\n  Assertions.fail(errorMsg + \"\\n \" + ex.getMessage());", "author": "hzhao-github", "createdAt": "2020-04-03T23:57:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MjY2NQ=="}], "type": "inlineReview"}, {"oid": "b9870d2a042fa99e7eec2380ebee874762cb445e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b9870d2a042fa99e7eec2380ebee874762cb445e", "message": "Changes for the comments jenkins-ignore", "committedDate": "2020-04-04T22:53:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzU3OTgyMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403579820", "bodyText": "do you mean it wasn't updated?", "author": "markxnelson", "createdAt": "2020-04-04T23:48:25Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItModelInImageConfigUpdate.java", "diffHunk": "@@ -105,48 +103,137 @@ public static void staticUnPrepare() throws Exception {\n    * re-create the configmap with model files that define a JDBC DataSource\n    * and update the domain crd to change domain restartVersion to reload the model,\n    * generate new config and initiate a rolling restart.\n-   *\n-   * @throws Exception if domain creation, config update or test veriofication fails\n    */\n   @Test\n-  public void testMiiConfigUpdateNonExistJdbc() throws Exception {\n+  public void testMiiConfigUpdateNonJdbcCm() {\n     Assumptions.assumeTrue(QUICKTEST);\n     String testMethodName = new Object() {\n     }.getClass().getEnclosingMethod().getName();\n-    logTestBegin(testMethodName);\n-    LoggerHelper.getLocal().log(Level.INFO,\n-        \"Creating Domain & waiting for the script to complete execution\");\n     boolean testCompletedSuccessfully = false;\n+    Domain domain = null;\n+\n     try {\n-      // create Domain w/o JDBC DS using the image created by MII\n+      logTestBegin(testMethodName);\n+      LoggerHelper.getLocal().log(Level.INFO,\n+          \"Creating Domain & waiting for the script to complete execution\");\n+\n+      // create domain w/o JDBC DS using the image created by MII\n       boolean createDS = false;\n-      createDomainUsingMii(createDS);\n+      domain = createDomainUsingMii(createDS);\n+      Assertions.assertNotNull(domain, \"Failed to create a domain\");\n \n       // copy model files that contains JDBC DS to a dir to re-create cm\n-      String destDir = copyTestModelFiles();\n+      final String destDir = getResultDir() + \"/samples/model-in-image-update\";\n+      copyTestModelFiles(destDir);\n \n-      // re-create cm to update config\n-      wdtConfigUpdate(destDir);\n+      // re-create cm to update config and verify cm is created successfylly\n+      wdtConfigUpdate(destDir, domain);\n \n-      // update domain yaml with restartVersion and\n-      // apply the domain yaml, verify domain restarted\n+      // update domain yaml with restartVersion,\n+      // apply the domain yaml and verify domain restarted successfully\n       modifyDomainYamlWithRestartVersion(domain, domainNS);\n \n-      // verify the test result by checking updated config file on server pod\n-      verifyJdbcUpdate();\n+      // verify that JNDI name exists by checking updated config file on server pod\n+      String jdbcDsStr = getJndiName(domain);\n+      Assertions.assertTrue(jdbcDsStr.contains(\"<jndi-name>\" + jndiName + \"</jndi-name>\"),\n+          \"JDBC DS doesn't update\");", "originalCommit": "b9870d2a042fa99e7eec2380ebee874762cb445e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzgyMDQwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1528#discussion_r403820405", "bodyText": "fixed.", "author": "hzhao-github", "createdAt": "2020-04-06T04:12:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzU3OTgyMA=="}], "type": "inlineReview"}, {"oid": "85c02db49e5017da7d0bf9321285ebd259386c0b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/85c02db49e5017da7d0bf9321285ebd259386c0b", "message": "Changed logs jenkins-ignore", "committedDate": "2020-04-06T04:11:15Z", "type": "commit"}]}