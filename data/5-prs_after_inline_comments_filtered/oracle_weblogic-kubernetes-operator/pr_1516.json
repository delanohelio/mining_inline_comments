{"pr_number": 1516, "pr_title": "Adding test assertions to new integration tests", "pr_createdAt": "2020-03-30T18:43:18Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516", "timeline": [{"oid": "b2e79bc50651472aae966d2534811d427d7912c8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b2e79bc50651472aae966d2534811d427d7912c8", "message": "Adding test assertions to new integration tests", "committedDate": "2020-03-30T18:40:44Z", "type": "commit"}, {"oid": "e2d38f54af81707806b5e62223ba5c75ae4081c1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e2d38f54af81707806b5e62223ba5c75ae4081c1", "message": "fix copyright header", "committedDate": "2020-03-30T18:44:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDI1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400414254", "bodyText": "Sentences start with a capital letter and end with a period.", "author": "markxnelson", "createdAt": "2020-03-30T18:45:13Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/TestAssertions.java", "diffHunk": "@@ -7,17 +7,109 @@\n import oracle.weblogic.kubernetes.assertions.impl.Operator;\n \n import java.util.concurrent.Callable;\n+import oracle.weblogic.kubernetes.assertions.impl.Kubernetes;\n \n // as in the actions, it is intended tests only use these assertaions and do\n // not go direct to the impl classes\n public class TestAssertions {\n \n-    public static Callable<Boolean> operatorIsRunning() {\n-        return Operator.isRunning();\n-    }\n+  /**\n+   * Check if Operator is running\n+   * @param namespace in which is operator is running\n+   * @return true if running false otherwise\n+   */\n+  public static Callable<Boolean> operatorIsRunning(String namespace) {\n+    return Operator.isRunning(namespace);\n+  }\n \n-    public static Callable<Boolean> domainExists(String domainUID, String namespace) {\n-        return Domain.exists(domainUID, namespace);\n-    }\n+  /**\n+   * check if operator Rest service is running\n+   * @param namespace the operator rest service exists\n+   * @return true if rest service is running otherwise false\n+   */\n+  public static boolean operatorRestServiceRunning(String namespace) {\n+    return Operator.isRestServiceCreated(namespace);\n+  }\n+\n+  /**\n+   * check if a weblogic custom resource domain exists in specified namespace and all its pods are running\n+   * @param domainUID ID of the domain\n+   * @param namespace in which the domain custom resource exists\n+   * @return true if domain exists and pods running otherwise false\n+   */\n+  public static Callable<Boolean> domainExists(String domainUID, String namespace) {\n+    return Domain.exists(domainUID, namespace);\n+  }\n+\n+  /**\n+   * check if a kubernetes pod is in running/ready state\n+   * @param podName name of the pod to check for\n+   * @param domainUID weblogic domain uid in which the pod belongs\n+   * @param namespace in which the pod is running\n+   * @return true if the pod is running otherwise false\n+   */\n+  public static Callable<Boolean> podReady(String podName, String domainUID, String namespace) {\n+    return Kubernetes.podRunning(podName, domainUID, namespace);\n+  }\n+\n+  /**\n+   * check if a pod given by the podName is in Terminating state\n+   * @param podName name of the pod to check for Terminating status\n+   * @param domainUID weblogic domain uid in which the pod belongs\n+   * @param namespace in which the pod is running\n+   * @return true if the pod is terminating otherwise false\n+   */\n+  public static Callable<Boolean> podTerminating(String podName, String domainUID, String namespace) {\n+    return Kubernetes.podTerminating(podName, domainUID, namespace);\n+  }\n+\n+  /**\n+   * check is a service exists in given namespace\n+   * @param serviceName  the name of the service to check for\n+   * @param namespace in which the service is running\n+   * @return true if the service exists otherwise false\n+   */\n+  public static boolean serviceReady(String serviceName, String namespace) {\n+    return Kubernetes.serviceCreated(serviceName, namespace);\n+  }\n+\n+  /**\n+   * check if a loadbalancer pod is ready", "originalCommit": "b2e79bc50651472aae966d2534811d427d7912c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyNzQzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400427439", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-03-30T19:07:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDI1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDcyMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400414723", "bodyText": "is this a copy/paste error?", "author": "markxnelson", "createdAt": "2020-03-30T18:46:02Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/impl/Domain.java", "diffHunk": "@@ -1,26 +1,35 @@\n-// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Copyright 2020, Oracle Corporation and/or its affiliates.\n // Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n \n package oracle.weblogic.kubernetes.assertions.impl;\n \n-import java.util.Random;\n import java.util.concurrent.Callable;\n \n-import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n-\n public class Domain {\n \n-    public static Callable<Boolean> exists(String domainUID, String namespace) {\n-        return () -> {\n-            int outcome = new Random(System.currentTimeMillis()).nextInt(3);\n-            if (outcome == 1) {\n-                logger.info(String.format(\"Domain %s exists in namespace %s\", domainUID, namespace));\n-                return true;\n-            } else {\n-                logger.info(String.format(\"Domain %s does not exist in namespace %s\", domainUID, namespace));\n-                return false;\n-            }\n-        };\n-    }\n+  public static Callable<Boolean> exists(String domainUID, String namespace) {\n+    return () -> {\n+      String pods[] = {};\n+      for (String pod : pods) {\n+        if (!Kubernetes.podExists(pod, domainUID, namespace).call().booleanValue()) {\n+          return false;\n+        }\n+      }\n+      for (String pod : pods) {", "originalCommit": "b2e79bc50651472aae966d2534811d427d7912c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyODc5OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400428798", "bodyText": "what error ?", "author": "sankarpn", "createdAt": "2020-03-30T19:09:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyOTkwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400429903", "bodyText": "method is called exists()\nyou first loop through and see if they exist, then you loop through again and check if they are running.\nwas wondering why that second loop is there? seemed like maybe it was copy/pasted from another method?", "author": "markxnelson", "createdAt": "2020-03-30T19:11:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQzODIxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400438219", "bodyText": "The existing tests check if the pod is getting created but not ready yet and then checks if it is running. If the assertion is only to check if the domain and pods exist (in ready state) then we may not need the podExists check. Removed it.", "author": "sankarpn", "createdAt": "2020-03-30T19:24:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDcyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQ0MDcwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400440701", "bodyText": "ok great, was just checking, since it did not seem to match up", "author": "markxnelson", "createdAt": "2020-03-30T19:28:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDcyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDc4MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400414780", "bodyText": "fix", "author": "markxnelson", "createdAt": "2020-03-30T18:46:10Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/impl/Kubernetes.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.", "originalCommit": "b2e79bc50651472aae966d2534811d427d7912c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyNjM2Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400426367", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-03-30T19:05:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDc4MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDg0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400414848", "bodyText": "fix", "author": "markxnelson", "createdAt": "2020-03-30T18:46:16Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/assertions/impl/Kubernetes.java", "diffHunk": "@@ -0,0 +1,46 @@\n+/*\n+ * To change this license header, choose License Headers in Project Properties.\n+ * To change this template file, choose Tools | Templates\n+ * and open the template in the editor.\n+ */\n+\n+package oracle.weblogic.kubernetes.assertions.impl;\n+\n+import java.util.concurrent.Callable;\n+\n+/**\n+ *", "originalCommit": "b2e79bc50651472aae966d2534811d427d7912c8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQyNzc1MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1516#discussion_r400427751", "bodyText": "fixed", "author": "sankarpn", "createdAt": "2020-03-30T19:08:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDQxNDg0OA=="}], "type": "inlineReview"}, {"oid": "ce25e95f26b6c8a97e4d8e5999f540fdb30f0259", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ce25e95f26b6c8a97e4d8e5999f540fdb30f0259", "message": "fix namespace", "committedDate": "2020-03-30T18:55:59Z", "type": "commit"}, {"oid": "df97ffee8ca4718708ef88b84c8694856075b504", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/df97ffee8ca4718708ef88b84c8694856075b504", "message": "fix javadoc", "committedDate": "2020-03-30T18:59:52Z", "type": "commit"}, {"oid": "25dc752aa371a4860ea79057a48a217a151154a4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/25dc752aa371a4860ea79057a48a217a151154a4", "message": "remove podExists check", "committedDate": "2020-03-30T19:18:46Z", "type": "commit"}, {"oid": "d3644145b231ce1c1885e4e8ee76f1d98afe1ea5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d3644145b231ce1c1885e4e8ee76f1d98afe1ea5", "message": "change weblogic to WebLogic and kubernetes to Kubernetes", "committedDate": "2020-03-30T20:06:11Z", "type": "commit"}, {"oid": "a2ab963098b26a5b0d47d1943056ddc11e5d04cb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a2ab963098b26a5b0d47d1943056ddc11e5d04cb", "message": "Merge branch 'mii-new-integration-tests' into mii-junit-sankar", "committedDate": "2020-03-31T15:34:24Z", "type": "commit"}, {"oid": "b20377bf8a0a28b7a263b60a91b53acd058be24d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b20377bf8a0a28b7a263b60a91b53acd058be24d", "message": "fix formatting", "committedDate": "2020-03-31T15:56:18Z", "type": "commit"}, {"oid": "636c5f17837309804773ec5609321d31447ae51a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/636c5f17837309804773ec5609321d31447ae51a", "message": "order import", "committedDate": "2020-03-31T16:16:53Z", "type": "commit"}, {"oid": "5e3921815dde558dc1ff130eb75d18afc7d9c09b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5e3921815dde558dc1ff130eb75d18afc7d9c09b", "message": "fix formatting", "committedDate": "2020-03-31T16:18:51Z", "type": "commit"}]}