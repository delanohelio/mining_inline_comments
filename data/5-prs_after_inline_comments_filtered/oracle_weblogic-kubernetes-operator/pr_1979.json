{"pr_number": 1979, "pr_title": "OWLS-84881 better handle long domainUID", "pr_createdAt": "2020-10-12T22:05:28Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979", "timeline": [{"oid": "a7f808bc84622b3c27f56f7e91a0debece6005aa", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a7f808bc84622b3c27f56f7e91a0debece6005aa", "message": "add limits to generated resource names", "committedDate": "2020-10-05T14:09:53Z", "type": "commit"}, {"oid": "efc37f95f1374874a37f5a7b1ac1945595ecb6f7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/efc37f95f1374874a37f5a7b1ac1945595ecb6f7", "message": "work in progress", "committedDate": "2020-10-06T18:09:22Z", "type": "commit"}, {"oid": "ba0b808ada4d5559e18925c785266ce6cd840922", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ba0b808ada4d5559e18925c785266ce6cd840922", "message": "get server and cluster info from introspector's results", "committedDate": "2020-10-07T21:33:07Z", "type": "commit"}, {"oid": "a8f993facdd059ddd3ee725d2e5595dbaae53ffb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a8f993facdd059ddd3ee725d2e5595dbaae53ffb", "message": "new configuration, validation, and unit tests", "committedDate": "2020-10-08T17:49:35Z", "type": "commit"}, {"oid": "f70ee23ae86de6988854bc1fa8ee29c9c3a41764", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f70ee23ae86de6988854bc1fa8ee29c9c3a41764", "message": "minor change", "committedDate": "2020-10-08T18:02:20Z", "type": "commit"}, {"oid": "8eac0f086f6a708f27d0028566863f4bf81830bb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8eac0f086f6a708f27d0028566863f4bf81830bb", "message": "Merge remote-tracking branch 'origin/develop' into OWLS-84661-long-domainUID\n\nConflicts:\n\toperator/src/main/java/oracle/kubernetes/operator/DomainProcessorImpl.java", "committedDate": "2020-10-08T18:17:58Z", "type": "commit"}, {"oid": "92ba856e392b6e452d655cac3d79a494dd64d5ac", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/92ba856e392b6e452d655cac3d79a494dd64d5ac", "message": "fix operator chart validation", "committedDate": "2020-10-09T02:22:34Z", "type": "commit"}, {"oid": "6cfb6ad699b26b9a101ba6afd3f15752016915c1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6cfb6ad699b26b9a101ba6afd3f15752016915c1", "message": "fix chart validation", "committedDate": "2020-10-09T15:02:47Z", "type": "commit"}, {"oid": "c33dc78979371c90a0d46de3f2b9a6e99bc735d5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c33dc78979371c90a0d46de3f2b9a6e99bc735d5", "message": "fix hard-coded external service name suffix in integration tests", "committedDate": "2020-10-12T15:07:29Z", "type": "commit"}, {"oid": "356a9ea5012e356424275d1afaeceb267da0a0a9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/356a9ea5012e356424275d1afaeceb267da0a0a9", "message": "fix more integration test failures", "committedDate": "2020-10-12T19:48:20Z", "type": "commit"}, {"oid": "7a7dd1fba5ad29fc6dc0254e51e7709c97bed7ff", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7a7dd1fba5ad29fc6dc0254e51e7709c97bed7ff", "message": "clean up", "committedDate": "2020-10-12T21:32:55Z", "type": "commit"}, {"oid": "56b5656e82acd01c5602fc0293312b749258a7c4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/56b5656e82acd01c5602fc0293312b749258a7c4", "message": "minor doc fixwq", "committedDate": "2020-10-12T21:52:07Z", "type": "commit"}, {"oid": "8cc643f68223f1cbb62d7b31f8a44471f8635cf4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8cc643f68223f1cbb62d7b31f8a44471f8635cf4", "message": "Revert \"minor doc fixwq\"\n\nThis reverts commit 56b5656e82acd01c5602fc0293312b749258a7c4.", "committedDate": "2020-10-12T21:53:29Z", "type": "commit"}, {"oid": "2b8ef85b6f45d3a2096bb8cf5538a7159a55f83a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2b8ef85b6f45d3a2096bb8cf5538a7159a55f83a", "message": "minor doc fix", "committedDate": "2020-10-12T21:56:01Z", "type": "commit"}, {"oid": "489b83ff066702f26cc79dfa9b384e52d77aed81", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/489b83ff066702f26cc79dfa9b384e52d77aed81", "message": "minor fix to test", "committedDate": "2020-10-13T00:02:35Z", "type": "commit"}, {"oid": "3ffb51f64f589e25491f47ea81179f661e5ddf01", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3ffb51f64f589e25491f47ea81179f661e5ddf01", "message": "clean up test constants", "committedDate": "2020-10-13T00:06:31Z", "type": "commit"}, {"oid": "fe5c03f4b03543c6358e194a97276af4ade1c898", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fe5c03f4b03543c6358e194a97276af4ade1c898", "message": "minor doc edits based on review comments", "committedDate": "2020-10-13T13:20:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA0MTY4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504041687", "bodyText": "Minor nit: Would getIntrospectJobName would be more accurate? The runtime pod name is generated by k8s using a decoration of the JobName...", "author": "tbarnes-us", "createdAt": "2020-10-13T15:22:21Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItConfigDistributionStrategy.java", "diffHunk": "@@ -767,7 +768,7 @@ private void verifyPodsStateNotChanged() {\n   private void verifyIntrospectorRuns() {\n     //verify the introspector pod is created and runs\n     logger.info(\"Verifying introspector pod is created, runs and deleted\");\n-    String introspectPodName = domainUid + \"-\" + \"introspect-domain-job\";\n+    String introspectPodName = getIntrospectPodName(domainUid);", "originalCommit": "fe5c03f4b03543c6358e194a97276af4ade1c898", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDIxNTM5NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504215395", "bodyText": "LGTM now", "author": "tbarnes-us", "createdAt": "2020-10-13T19:50:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA0MTY4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504077800", "bodyText": "I think there's a significant risk that service names in a cluster may unexpectedly become too long when a WL cluster configuration is changed to allow more servers.  For example, from <9 to >9 servers, or from <99 to >100 servers...", "author": "tbarnes-us", "createdAt": "2020-10-13T16:08:47Z", "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java", "diffHunk": "@@ -628,10 +653,65 @@ public boolean equals(Object other) {\n       verifyNoAlternateSecretNamespaceSpecified();\n       addMissingModelConfigMap(kubernetesResources);\n       verifyIstioExposingDefaultChannel();\n+      verifyIntrospectorJobName();\n \n       return failures;\n     }\n \n+    private void verifyIntrospectorJobName() {\n+      // K8S adds a 5 character suffix to an introspector job name\n+      if (LegalNames.toJobIntrospectorName(getDomainUid()).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH - 5) {\n+        failures.add(DomainValidationMessages.exceedMaxIntrospectorJobName(getDomainUid()));\n+      }\n+    }\n+\n+    private void verifyGeneratedResourceNames(WlsDomainConfig wlsDomainConfig) {\n+      checkGeneratedServerServiceName(wlsDomainConfig.getAdminServerName());\n+      if (isExternalServiceConfigured(getSpec())) {\n+        checkGeneratedExternalServiceName(wlsDomainConfig.getAdminServerName());\n+      }\n+\n+      // domain level serverConfigs do not contain servers in dynamic clusters\n+      wlsDomainConfig.getServerConfigs()\n+          .values()\n+          .stream()\n+          .map(WlsServerConfig::getName)\n+          .forEach(this::checkGeneratedServerServiceName);\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig\n+              // serverConfigs contains configured and dynamic servers in the cluster\n+              -> wlsClusterConfig.getServerConfigs().forEach(wlsServerConfig\n+                  -> this.checkGeneratedServerServiceName(wlsServerConfig.getName())));\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig -> this.checkGeneratedClusterServiceName(wlsClusterConfig.getName()));\n+    }\n+\n+    private void checkGeneratedExternalServiceName(String adminServerName) {\n+      if (LegalNames.toExternalServiceName(getDomainUid(), adminServerName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxExternalServiceName(getDomainUid(), adminServerName));\n+      }\n+    }\n+\n+    private void checkGeneratedServerServiceName(String serverName) {\n+      if (LegalNames.toServerServiceName(getDomainUid(), serverName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxServerServiceName(getDomainUid(), serverName));\n+      }\n+    }\n+\n+    private void checkGeneratedClusterServiceName(String clusterName) {\n+      if (LegalNames.toClusterServiceName(getDomainUid(), clusterName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxClusterServiceName(getDomainUid(), clusterName));", "originalCommit": "fe5c03f4b03543c6358e194a97276af4ade1c898", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA5NTIzNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504095235", "bodyText": "This comment isn't quite in the right place - it belongs on the service name check for server service names within a cluster.", "author": "tbarnes-us", "createdAt": "2020-10-13T16:31:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1MzczNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504153735", "bodyText": "I assume when that happens, the introspector will be rerun, and the validation of server service name happens after the introspector is completed, so we should be able to catch this and fail the domain update then with a clear validation error message in the domain resource.", "author": "doxiao", "createdAt": "2020-10-13T18:03:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE1OTAxNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504159014", "bodyText": "In my opinion, there's a risk that this could happen:\n\nAll testing passes at size 5.\nCluster goes into production and works fine.\nCluster size is increased from 5 to 15 and fails (perhaps in testing).\nIntrusive post-production changes needed to accomodate the change - including the potential to lose data due to server name changes (for example, cluster-targeted file stores files and database store tables are named automatically after server names).", "author": "tbarnes-us", "createdAt": "2020-10-13T18:11:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE3MzYzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504173639", "bodyText": "This is a valid and good concern. We could reserve 2 more characters in server service name check to handle this. Alternatively, can customer shortens the domainUID to avoid the issues that you are concerned? DomainUID is only a K8S side artifact that does not have anything to do with the webLogic server side.", "author": "doxiao", "createdAt": "2020-10-13T18:33:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDE3NTc0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504175742", "bodyText": "Yes, shortening the domainUID would work-around it - but it's not certain that will always be practical.", "author": "tbarnes-us", "createdAt": "2020-10-13T18:37:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3Mjc0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504272742", "bodyText": "I'm fine with reducing the maximum domainUID size by approximately 2 characters to account for dynamic clusters that grow to over 100 members. My hope is that there won't be any more need for set-asides like this as we want the maximum to stay subjectively \"reasonable.\"", "author": "rjeberhard", "createdAt": "2020-10-13T21:36:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDI3OTAxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504279019", "bodyText": "Cool. The key is to change the max size dynamically so that an increased cluster size won't cause trouble.  So decrease the current max by 2 for cluster sizes 1-9, and decrease by 1 for sizes 10-99...", "author": "tbarnes-us", "createdAt": "2020-10-13T21:50:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDY4NzA0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504687040", "bodyText": "I agree with where this is going.\nWith the changes in this PR, we enforce the limits at two different levels: 1) we specifies the maximum domainUID size in the domain spec, when this limit is exceeded, helm install will fail. We have similar restrictions to the new suffix values at the helm level; 2) the operator checks the resultant names that take into account of not only the domainUID, but also WebLogic server/cluster names as well as the suffixes.\nI think the reasonable thing to do is to keep the maximum domainUID size (in the spec schema) as high as possible, and leave the flexibility to the choices of suffix values and WebLogic configurations. In order to achieve this, I started to think that we need to allow a custom infix for cluster service names. Once we do that, custom would have almost a full control over the length of the resource names. We could keep the maximum domainUID size to 58 (63 minus the 5 characters that the K8S adds to the job name), instead of 45 (to account for the default suffix plus 5) right now,  as a general limit. Customers have the option to have short or even empty suffixes if needed to leave rooms for other configuration names. The checks in domain validation eventually makes sure that the resultant names are valid although the domainUID size limit in the spec would relatively higher than we current have in this PR.", "author": "doxiao", "createdAt": "2020-10-14T13:42:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc2MDg0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504760844", "bodyText": "I'm fine with adding support for configuring the cluster infix - it's not critical IMO, but OTOH, now's a good time since 'the patient is open'.\nAs for increasing the spec schema max, I don't have a strong opinion but prefer leaving it at 45. That matches the old effective maximum, is relatively 'roomy', and itself only leaves a relatively minimal 23 characters for cluster or server names plus infix decorations.\nAs for implementing a dynamic max size for clustered server names based on cluster size, an additional consideration is backward compatibility for small clusters that are already at their max. Perhaps it's OK to introduce small backward compatibility issues like this, but, if not, then we could offer configurables to switch back to old behavior: for example 'maxServerServiceNameSizeSmallClusters' and 'maxServerServiceNameSizeMediumClusters'.\nIf there's time available, it'd be nice if postfix and infix values could be configured on a per domain basis as overrides for the current per operator settings. This would allow a problem domain to be handled without affecting other domains that might already be deployed - and could be especially helpful in production.", "author": "tbarnes-us", "createdAt": "2020-10-14T15:14:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDc3NjUwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504776500", "bodyText": "I also think it is a good time to add customizable cluster infix after all the discussions.\nThe old effective maximum is 36 (not 45), because we have a longer introspector job name suffix.\nI am inclining to not introducing more knobs for backwards compatibility for this. But if we really want to, I marginally prefer adding a boolean to enable/disable the additional calculation for extending cluster size.\nPer domain suffix configuration is nice and more flexible for sure, it time permits.", "author": "doxiao", "createdAt": "2020-10-14T15:34:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDgyNjI4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r504826287", "bodyText": "I'm fine with a boolean assuming we choose to worry about backward compat in this area in the first place. I think the two of us have reached a basic agreement on all points.", "author": "tbarnes-us", "createdAt": "2020-10-14T16:48:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTUzNTgyMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r505535823", "bodyText": "Added code to adjust the upper limit based on the current cluster size with a new flag clusterSizePaddingValidationEnabled to enable additional padding validation.", "author": "doxiao", "createdAt": "2020-10-15T13:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDA3NzgwMA=="}], "type": "inlineReview"}, {"oid": "d305fc4c9258fa777b72bbf4cefc6c1ec9516761", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d305fc4c9258fa777b72bbf4cefc6c1ec9516761", "message": "improve error msg and remove hard-coded suffixes from doc and samples", "committedDate": "2020-10-13T19:39:13Z", "type": "commit"}, {"oid": "13f69bc770e69317b04de1090adc44d099e69b35", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/13f69bc770e69317b04de1090adc44d099e69b35", "message": "cleanup", "committedDate": "2020-10-13T19:44:18Z", "type": "commit"}, {"oid": "acdaef1ac256019bb4d99e0c2caa8e8227b6db1a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/acdaef1ac256019bb4d99e0c2caa8e8227b6db1a", "message": "change the legal checks based on Ryan's suggestion", "committedDate": "2020-10-14T21:05:45Z", "type": "commit"}, {"oid": "2a61b85dbe0d1bd4a84096e4bf2d629f82f97d41", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2a61b85dbe0d1bd4a84096e4bf2d629f82f97d41", "message": "add cluster size padding validation", "committedDate": "2020-10-15T13:12:38Z", "type": "commit"}, {"oid": "19132586efc8d3d8b386bb12e7356058dd8ea56c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/19132586efc8d3d8b386bb12e7356058dd8ea56c", "message": "minor changes to helm validation", "committedDate": "2020-10-15T15:28:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY1MTEyNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r505651124", "bodyText": "The limit should not be adjusted downward for clusters greater than size 99.", "author": "tbarnes-us", "createdAt": "2020-10-15T15:48:27Z", "path": "operator/src/main/java/oracle/kubernetes/weblogic/domain/model/Domain.java", "diffHunk": "@@ -628,10 +654,84 @@ public boolean equals(Object other) {\n       verifyNoAlternateSecretNamespaceSpecified();\n       addMissingModelConfigMap(kubernetesResources);\n       verifyIstioExposingDefaultChannel();\n+      verifyIntrospectorJobName();\n \n       return failures;\n     }\n \n+    private void verifyIntrospectorJobName() {\n+      // K8S adds a 5 character suffix to an introspector job name\n+      if (LegalNames.toJobIntrospectorName(getDomainUid()).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH - 5) {\n+        failures.add(DomainValidationMessages.exceedMaxIntrospectorJobName(\n+            getDomainUid(),\n+            LegalNames.toJobIntrospectorName(getDomainUid()),\n+            LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH - 5));\n+      }\n+    }\n+\n+    private void verifyGeneratedResourceNames(WlsDomainConfig wlsDomainConfig) {\n+      checkGeneratedServerServiceName(wlsDomainConfig.getAdminServerName(), -1);\n+      if (isExternalServiceConfigured(getSpec())) {\n+        checkGeneratedExternalServiceName(wlsDomainConfig.getAdminServerName());\n+      }\n+\n+      // domain level serverConfigs do not contain servers in dynamic clusters\n+      wlsDomainConfig.getServerConfigs()\n+          .values()\n+          .stream()\n+          .map(WlsServerConfig::getName)\n+          .forEach(serverName -> checkGeneratedServerServiceName(serverName, -1));\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig\n+              // serverConfigs contains configured and dynamic servers in the cluster\n+              -> wlsClusterConfig.getServerConfigs().forEach(wlsServerConfig\n+                  -> this.checkGeneratedServerServiceName(\n+                      wlsServerConfig.getName(), wlsClusterConfig.getServerConfigs().size())));\n+      wlsDomainConfig.getClusterConfigs()\n+          .values()\n+          .iterator()\n+          .forEachRemaining(wlsClusterConfig -> this.checkGeneratedClusterServiceName(wlsClusterConfig.getName()));\n+    }\n+\n+    private void checkGeneratedExternalServiceName(String adminServerName) {\n+      if (LegalNames.toExternalServiceName(getDomainUid(), adminServerName).length()\n+          > LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH) {\n+        failures.add(DomainValidationMessages.exceedMaxExternalServiceName(\n+            getDomainUid(),\n+            adminServerName,\n+            LegalNames.toExternalServiceName(getDomainUid(), adminServerName),\n+            LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH));\n+      }\n+    }\n+\n+    private void checkGeneratedServerServiceName(String serverName, int clusterSize) {\n+      int limit = LegalNames.LEGAL_DNS_LABEL_NAME_MAX_LENGTH;\n+      if (Main.Namespaces.isClusterSizePaddingValidation() && clusterSize > 0) {\n+        limit = clusterSize >= 10 ? limit - 1 : limit - 2;", "originalCommit": "19132586efc8d3d8b386bb12e7356058dd8ea56c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY5NjgxMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1979#discussion_r505696813", "bodyText": "Make sense. thanks.", "author": "doxiao", "createdAt": "2020-10-15T16:56:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTY1MTEyNA=="}], "type": "inlineReview"}, {"oid": "a6c0a9764f945fff552a6a52f07cc7f7963f760b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a6c0a9764f945fff552a6a52f07cc7f7963f760b", "message": "only reserve spaces for cluster size wqsmaller than 100", "committedDate": "2020-10-15T16:09:22Z", "type": "commit"}, {"oid": "ae8afad7713ee62fb0a2db81415112b6043aa806", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ae8afad7713ee62fb0a2db81415112b6043aa806", "message": "one more unit test case", "committedDate": "2020-10-15T16:37:50Z", "type": "commit"}, {"oid": "65b2bd1ea835265ad139d493cd2582b1ba1fd19e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/65b2bd1ea835265ad139d493cd2582b1ba1fd19e", "message": "minor changes", "committedDate": "2020-10-15T16:56:21Z", "type": "commit"}, {"oid": "8e0686304f1b766bd77d4043e5686de5e068f1c2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8e0686304f1b766bd77d4043e5686de5e068f1c2", "message": "Merge remote-tracking branch 'origin/develop' into OWLS-84661-long-domainUID", "committedDate": "2020-10-15T17:33:02Z", "type": "commit"}, {"oid": "20b6964f60240701b154c7c98d452ce3446610d1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/20b6964f60240701b154c7c98d452ce3446610d1", "message": "minor doc change", "committedDate": "2020-10-15T17:45:15Z", "type": "commit"}, {"oid": "cb14ac4206fe8c1b262cf45112146291f2ecc85b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cb14ac4206fe8c1b262cf45112146291f2ecc85b", "message": "change a method name", "committedDate": "2020-10-15T18:09:47Z", "type": "commit"}]}