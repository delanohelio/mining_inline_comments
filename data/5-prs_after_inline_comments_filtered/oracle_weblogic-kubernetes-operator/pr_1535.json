{"pr_number": 1535, "pr_title": "adding helm implementation", "pr_createdAt": "2020-04-03T20:29:40Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535", "timeline": [{"oid": "8678e0ee8629d84ec1712d11d8420cf661d59605", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8678e0ee8629d84ec1712d11d8420cf661d59605", "message": "moving common props to helmprops and common methods to helm class", "committedDate": "2020-04-03T05:57:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1ODc3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403358772", "bodyText": "-> \"Created a new namespace called ...\"\nDoesn't the logger facade in the operator support String formats like \"blah blah {0}\"?  Shouldn't we use the logging facade in operator rather than java.util.logging directly?", "author": "ddsharpe", "createdAt": "2020-04-03T22:05:32Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -65,69 +64,89 @@ public void testInstallingOperator() {\n     // the kubernetes deployment.  this will complete quickly, and will either be\n     // successful or not.\n \n-    // get a new unique namespace\n-    final String namespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+    // get a new unique opNamespace\n+    final String opNamespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", opNamespace));\n+\n+    final String domainNamespace1 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace1));\n+\n+    final String domainNamespace2 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n         \"Failed to create unique namespace due to ApiException\");\n-    logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace2));", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MzI4Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403373286", "bodyText": "this is the logger injected by LoggedTest isn't it?", "author": "markxnelson", "createdAt": "2020-04-03T22:52:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1ODc3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NjEyOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403396129", "bodyText": "oh it's both - it is injected, but it as a JUL", "author": "markxnelson", "createdAt": "2020-04-04T00:33:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1ODc3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NjI4MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403396280", "bodyText": "@ddsharpe we should fix that in LoggedTest", "author": "markxnelson", "createdAt": "2020-04-04T00:33:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1ODc3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzYzOTYxMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403639611", "bodyText": "@ddsharpe will change the message. For logger, it should be fixed in LoggedTest as Mark said.", "author": "vanajamukkara", "createdAt": "2020-04-05T02:32:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1ODc3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5NDE1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404194158", "bodyText": "changed the message", "author": "vanajamukkara", "createdAt": "2020-04-06T15:44:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1ODc3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1OTIwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403359207", "bodyText": "Every assertion should have a short message that would help someone debug the issue should it occur.", "author": "ddsharpe", "createdAt": "2020-04-03T22:06:57Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -65,69 +64,89 @@ public void testInstallingOperator() {\n     // the kubernetes deployment.  this will complete quickly, and will either be\n     // successful or not.\n \n-    // get a new unique namespace\n-    final String namespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+    // get a new unique opNamespace\n+    final String opNamespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", opNamespace));\n+\n+    final String domainNamespace1 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace1));\n+\n+    final String domainNamespace2 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n         \"Failed to create unique namespace due to ApiException\");\n-    logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace2));\n \n-    // Create a service account for the unique namespace\n-    final String serviceAccountName = namespace + \"-sa\";\n-    assertDoesNotThrow(\n-        () -> TestActions.createServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n+    // Create a service account for the unique opNamespace\n+    final String serviceAccountName = opNamespace + \"-sa\";\n+    assertDoesNotThrow(() -> TestActions.createServiceAccount(new V1ServiceAccount()\n+        .metadata(new V1ObjectMeta().namespace(opNamespace).name(serviceAccountName))));", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwMDc2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403400768", "bodyText": "here are some better options:\nimport static oracle.weblogic.kubernetes.actions.TestActions.createSecret;\nimport static org.assertj.core.api.Assertions.assertThat;\nimport static org.assertj.core.api.Assertions.assertThatCode;\nimport static org.assertj.core.api.Assertions.catchThrowable;\n\n  ...\n\n  @Test\n  @DisplayName(\"Test something else\")\n  public void testThereWasNoException() {\n    // this test will fail because it does throw an exception!\n\n    assertThatCode(() ->\n        createSecret(\"bob\", // name\n            \"weblogic\", // username\n            \"welcome1\", // password\n            \"default\")) //namespace\n        .as(\"Test that createSecret does not throw an exception\")\n        .withFailMessage(\"OMG! createSecret() threw an unexpected exception\")\n        .doesNotThrowAnyException();\n  }\n\n  @Test\n  @DisplayName(\"Test catching an exception\")\n  public void testCatchingAnException() {\n    // this test will pass because it does throw an exception of\n    // the expected type, and with the expected message\n\n    // when i call createSecret()\n    Throwable thrown = catchThrowable(() ->\n        createSecret(\"bob\", // name\n            \"weblogic\", // username\n            \"welcome1\", // password\n            \"default\"));\n\n    // then\n    assertThat(thrown)\n        .as(\"Test that createSecret does not throw an APIException\")\n        .withFailMessage(\"OMG! createSecret() threw an APIException\")\n        // you can check what kind of exception it is\n        .isInstanceOf(ApiException.class)\n        // and you can also check the message contains some string...\n        .hasMessageContaining(\"Failed to connect\");\n  }\n\n\nalso import static ...TestActions so you don't need to say TestActions.whatever()", "author": "markxnelson", "createdAt": "2020-04-04T00:59:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1OTIwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzYzOTczNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403639734", "bodyText": "will fix the assertions to have a message. Thanks @markxnelson for the assertions test in the other PR.", "author": "vanajamukkara", "createdAt": "2020-04-05T02:34:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1OTIwNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5NDI3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404194279", "bodyText": "done", "author": "vanajamukkara", "createdAt": "2020-04-06T15:44:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM1OTIwNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTA5MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403361090", "bodyText": "These combinations are easier to read and debug if they are separate. Like:\nassertNotNull(params.getRepoUrl(), \"repo URL was not provided\")\nor\nassertThat(params.getRepoUrl())\n.as(\"repo URL was not provided\")\n. isNotNull()\n.isNotEmpty();", "author": "ddsharpe", "createdAt": "2020-04-03T22:12:33Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MDU3Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403640576", "bodyText": "@ddsharpe here I need to check chartName is also provided only when repoUrl is provided. Otherwise chartName is not required.\nWhen repoUrl is provided, here its adding a chart repository, for that both repoUrl  and chartName are required. hence the combination.", "author": "vanajamukkara", "createdAt": "2020-04-05T02:46:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MjU0NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403642545", "bodyText": "checking for more readable ways to do this", "author": "vanajamukkara", "createdAt": "2020-04-05T03:16:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTA5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIxMTg2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404211864", "bodyText": "@markxnelson @rjeberhard any suggestions please ^^ ?", "author": "vanajamukkara", "createdAt": "2020-04-06T16:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTA5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTE5OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403361199", "bodyText": "same as previous (combo check)", "author": "ddsharpe", "createdAt": "2020-04-03T22:12:51Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MDg1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403640856", "bodyText": "helm install command uses repo url or chart dir, at least one of these must be provided. Both are not required, hence the combination.", "author": "vanajamukkara", "createdAt": "2020-04-05T02:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTE5OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MTIzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403361232", "bodyText": "combo check", "author": "ddsharpe", "createdAt": "2020-04-03T22:12:59Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MzEwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403363100", "bodyText": "Its not a big deal, but this seems harder to read than necessary.  Why not use String.format?\nString upgradeCmd = \"helm upgrade {0} {1} --namespace {3}\";\nappendValues( params.getValues(),\nString.format(upgradeCmd, params.getReleaseName(), chartDir, params.getNamespace());", "author": "ddsharpe", "createdAt": "2020-04-03T22:18:37Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDc1Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404753", "bodyText": "yeah i think String.format() would be a lot cleaner to read", "author": "markxnelson", "createdAt": "2020-04-04T01:25:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MzEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MTY2NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403641665", "bodyText": "will modify to use String.format()", "author": "vanajamukkara", "createdAt": "2020-04-05T03:03:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MzEwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwNTk4NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404205984", "bodyText": "done", "author": "vanajamukkara", "createdAt": "2020-04-06T16:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM2MzEwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MzcyNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403373726", "bodyText": "@rjeberhard @ddsharpe interested in your opinion on this --- seems like assertions in the finally is somehow wrong -- if these are important, should they not be part of the test itself?   not sure about assertions in a finally block.....", "author": "markxnelson", "createdAt": "2020-04-03T22:53:40Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -65,69 +64,89 @@ public void testInstallingOperator() {\n     // the kubernetes deployment.  this will complete quickly, and will either be\n     // successful or not.\n \n-    // get a new unique namespace\n-    final String namespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+    // get a new unique opNamespace\n+    final String opNamespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", opNamespace));\n+\n+    final String domainNamespace1 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace1));\n+\n+    final String domainNamespace2 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n         \"Failed to create unique namespace due to ApiException\");\n-    logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace2));\n \n-    // Create a service account for the unique namespace\n-    final String serviceAccountName = namespace + \"-sa\";\n-    assertDoesNotThrow(\n-        () -> TestActions.createServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n+    // Create a service account for the unique opNamespace\n+    final String serviceAccountName = opNamespace + \"-sa\";\n+    assertDoesNotThrow(() -> TestActions.createServiceAccount(new V1ServiceAccount()\n+        .metadata(new V1ObjectMeta().namespace(opNamespace).name(serviceAccountName))));\n     logger.info(\"Created service account: \" + serviceAccountName);\n \n     OperatorParams opParams =\n         new OperatorParams().releaseName(\"weblogic-operator\")\n-            .namespace(namespace)\n-            .image(\"weblogic-kubernetes-operator:test_itsimpleoperator\")\n-            .domainNamespaces(Arrays.asList(\"domainns1\", \"domainns2\"))\n-            .serviceAccount(\"opns1-sa\");\n+            .namespace(opNamespace)\n+            .chartDir(\"../kubernetes/charts/weblogic-operator\")\n+            .image(\"phx.ocir.io/weblogick8s/weblogic-kubernetes-operator:develop\")\n+            .domainNamespaces(Arrays.asList(domainNamespace1, domainNamespace2))\n+            .serviceAccount(serviceAccountName);\n \n-    //ToDO: use Junit 5 assertions\n     try {\n-      installOperator(opParams);\n-    } catch (ApiException e) {\n-      e.printStackTrace();\n-      fail(\"Failed to install Operator due to exception\" + e.getMessage());\n-    }\n+      assertThat(installOperator(opParams)).as(\"Operator installation failed\").isTrue();\n+      logger.info(String.format(\"Operator installed in namespace %s\", opNamespace));\n+\n+      // we can use a standard JUnit assertion to check on the result\n+      // assertEquals(true, success, \"Operator successfully installed in opNamespace \" + opNamespace);\n+\n+      // this is an example of waiting for an async operation to complete.\n+      // after the previous step was completed, kubernetes will try to pull the image,\n+      // start the pod, check the readiness/health probes, etc.  this will take some\n+      // period of time and either the operator will come to a running state, or it\n+      // will not.\n+      // in this example, we first wait 30 seconds, since it is unlikely this operation\n+      // will complete in less than 30 seconds, then we check if the operator is running.\n+      with().pollDelay(30, SECONDS)\n+          // we check again every 10 seconds.\n+          .and().with().pollInterval(10, SECONDS)\n+          // this listener lets us report some status with each poll\n+          .conditionEvaluationListener(\n+              condition -> logger.info(()\n+                  -> String.format(\"Waiting for operator to be running (elapsed time %dms, remaining time %dms)\",\n+                  condition.getElapsedTimeInMS(),\n+                  condition.getRemainingTimeInMS())))\n+          // and here we can set the maximum time we are prepared to wait\n+          .await().atMost(5, MINUTES)\n+          // operatorIsRunning() is one of our custom, reusable assertions\n+          .until(operatorIsRunning(opNamespace));\n+    } finally {\n+\n+      // uninstall operator release\n+      assertThat(TestActions.uninstallOperator(opParams))", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEzOTQ4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404139482", "bodyText": "Hmmm... I agree that that does seem incorrect.  If the point is to test uninstallation then this should be a test; otherwise, I'd have clean-up in an extension or \"after\" lifecycle method.", "author": "rjeberhard", "createdAt": "2020-04-06T14:33:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MzcyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwNjM4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404206383", "bodyText": "moved to after lifecycle method.", "author": "vanajamukkara", "createdAt": "2020-04-06T16:00:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3MzcyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NDIyOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403374229", "bodyText": "i need to take a much closer look at this, my gut reaction is that inheritance here is not the best solution", "author": "markxnelson", "createdAt": "2020-04-03T22:55:15Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/Operator.java", "diffHunk": "@@ -3,69 +3,10 @@\n \n package oracle.weblogic.kubernetes.actions.impl;\n \n-import io.kubernetes.client.openapi.ApiException;\n import oracle.weblogic.kubernetes.actions.impl.primitive.Helm;\n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-import static org.assertj.core.api.Assertions.assertThat;\n-\n-public class Operator implements LoggedTest {\n-\n-  /**\n-   * The URL of the Operator's Helm Repository.\n-   */\n-  //Question - is this URL correct?\n-  private static String OPERATOR_HELM_REPO_URL = \"https://oracle.github.io/weblogic-kubernetes-operator/charts\";\n-\n-  /**\n-   * The name of the Operator's Helm Chart (in the repository).\n-   */\n-  private static String OPERATOR_CHART_NAME = \"weblogic-operator/weblogic-operator\";\n-\n-  /**\n-   * Install WebLogic Kubernetes Operator.\n-   *\n-   * @param params operator parameters for helm values\n-   * @return true if the operator is successfully installed, false otherwise.\n-   * @throws ApiException - if Kubernetes client API call fails\n-   */\n-  public static boolean install(OperatorParams params) throws ApiException {\n-\n-    String namespace = params.getNamespace();\n-    String serviceAccount = params.getServiceAccount();\n-\n-    // assertions for required parameters\n-    assertThat(namespace)\n-        .as(\"make sure namespace is not empty or null\")\n-        .isNotNull()\n-        .isNotEmpty();\n-\n-    assertThat(params.getReleaseName())\n-        .as(\"make sure releaseName is not empty or null\")\n-        .isNotNull()\n-        .isNotEmpty();\n-\n-    boolean success = false;\n-    if (new Helm().chartName(OPERATOR_CHART_NAME).repoUrl(OPERATOR_HELM_REPO_URL).addRepo()) {\n-      logger.info(String.format(\"Installing Operator in namespace %s\", namespace));\n-      success = new Helm().chartName(OPERATOR_CHART_NAME)\n-                        .releaseName(params.getReleaseName())\n-                        .namespace(namespace)\n-                        .values(params.getValues())\n-                        .install();\n-    }\n-    return success;\n-  }\n-\n-  public static boolean upgrade(OperatorParams params) {\n-    return true;\n-  }\n \n+public class Operator extends Helm {", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDA1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404057", "bodyText": "seems like an operator is much more than just a set of helm params\nmaybe we could implement HelmRelease\nor have a variable that is a HelmParams\ni think an action impl should never extend a primitive\nthey should use primitives, not \"be\" them... imo", "author": "markxnelson", "createdAt": "2020-04-04T01:20:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NDIyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE0NDUzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404144532", "bodyText": "Agree.  HelmParams or the other choice seems more appropriate.", "author": "rjeberhard", "createdAt": "2020-04-06T14:39:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NDIyOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwNzYzNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404207635", "bodyText": "Agree. Removed inheritance and modified impl classes to call Helm instead.", "author": "vanajamukkara", "createdAt": "2020-04-06T16:02:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NDIyOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NDI3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403374279", "bodyText": "same here", "author": "markxnelson", "createdAt": "2020-04-03T22:55:26Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/OperatorParams.java", "diffHunk": "@@ -7,9 +7,11 @@\n import java.util.List;\n import java.util.Objects;\n \n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+\n // All parameters needed to install Operator from test\n \n-public class OperatorParams {\n+public class OperatorParams extends HelmParams {", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwODAxNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404208015", "bodyText": "Removed inheritance", "author": "vanajamukkara", "createdAt": "2020-04-06T16:02:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM3NDI3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5Mjk4Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403392982", "bodyText": "the as() describes what the test is, it is not the failure message", "author": "markxnelson", "createdAt": "2020-04-04T00:16:09Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -65,69 +64,89 @@ public void testInstallingOperator() {\n     // the kubernetes deployment.  this will complete quickly, and will either be\n     // successful or not.\n \n-    // get a new unique namespace\n-    final String namespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+    // get a new unique opNamespace\n+    final String opNamespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", opNamespace));\n+\n+    final String domainNamespace1 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace1));\n+\n+    final String domainNamespace2 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n         \"Failed to create unique namespace due to ApiException\");\n-    logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace2));\n \n-    // Create a service account for the unique namespace\n-    final String serviceAccountName = namespace + \"-sa\";\n-    assertDoesNotThrow(\n-        () -> TestActions.createServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n+    // Create a service account for the unique opNamespace\n+    final String serviceAccountName = opNamespace + \"-sa\";\n+    assertDoesNotThrow(() -> TestActions.createServiceAccount(new V1ServiceAccount()\n+        .metadata(new V1ObjectMeta().namespace(opNamespace).name(serviceAccountName))));\n     logger.info(\"Created service account: \" + serviceAccountName);\n \n     OperatorParams opParams =\n         new OperatorParams().releaseName(\"weblogic-operator\")\n-            .namespace(namespace)\n-            .image(\"weblogic-kubernetes-operator:test_itsimpleoperator\")\n-            .domainNamespaces(Arrays.asList(\"domainns1\", \"domainns2\"))\n-            .serviceAccount(\"opns1-sa\");\n+            .namespace(opNamespace)\n+            .chartDir(\"../kubernetes/charts/weblogic-operator\")\n+            .image(\"phx.ocir.io/weblogick8s/weblogic-kubernetes-operator:develop\")\n+            .domainNamespaces(Arrays.asList(domainNamespace1, domainNamespace2))\n+            .serviceAccount(serviceAccountName);\n \n-    //ToDO: use Junit 5 assertions\n     try {\n-      installOperator(opParams);\n-    } catch (ApiException e) {\n-      e.printStackTrace();\n-      fail(\"Failed to install Operator due to exception\" + e.getMessage());\n-    }\n+      assertThat(installOperator(opParams)).as(\"Operator installation failed\").isTrue();", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NTczMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403395730", "bodyText": "for example:\n @Test\n  @DisplayName(\"Test something\")\n  @Slow\n  public void testTrueIsTrue() {\n    int x = 1 + 5;\n    assertThat(true)\n        .as(\"Test that true is true\")\n        .withFailMessage(\"OMG! True was not true\")\n        .isEqualTo(false);\n  }\n\nwhich yields:\n[INFO] -------------------------------------------------------\n[INFO]  T E S T S\n[INFO] -------------------------------------------------------\n[INFO] Running oracle.weblogic.kubernetes.Mark\n<04-03-2020 20:29:08> <INFO> <oracle.weblogic.kubernetes.extensions.LoggedTest beforeEachTest> <About to execute [Test something] in oracle.weblogic.kubernetes.Mark.testTrueIsTrue()>\n<04-03-2020 20:29:08> <INFO> <oracle.weblogic.kubernetes.extensions.Timing afterTestExecution> <Method [testTrueIsTrue] took 52 ms.>\n<04-03-2020 20:29:08> <INFO> <oracle.weblogic.kubernetes.extensions.LoggedTest afterEachTest> <Finished executing [Test something] in oracle.weblogic.kubernetes.Mark.testTrueIsTrue()>\n[ERROR] Tests run: 1, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 0.136 s <<< FAILURE! - in oracle.weblogic.kubernetes.Mark\n[ERROR] oracle.weblogic.kubernetes.Mark.testTrueIsTrue  Time elapsed: 0.115 s  <<< FAILURE!\njava.lang.AssertionError: [Test that true is true] OMG! True was not true\n        at oracle.weblogic.kubernetes.Mark.testTrueIsTrue(Mark.java:25)\n        at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n   (etc)", "author": "markxnelson", "createdAt": "2020-04-04T00:30:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5Mjk4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MTc4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403641787", "bodyText": "will fix the assertions", "author": "vanajamukkara", "createdAt": "2020-04-05T03:04:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5Mjk4Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwODEwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404208107", "bodyText": "fixed", "author": "vanajamukkara", "createdAt": "2020-04-06T16:03:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5Mjk4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NTkyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403395928", "bodyText": "nitpick - start each new fluent method on a new line please, like this\nnew V1ObejctMeta()\n  .namespace(opNamespace)\n  .name(serviceAccountName)", "author": "markxnelson", "createdAt": "2020-04-04T00:31:53Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -65,69 +64,89 @@ public void testInstallingOperator() {\n     // the kubernetes deployment.  this will complete quickly, and will either be\n     // successful or not.\n \n-    // get a new unique namespace\n-    final String namespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+    // get a new unique opNamespace\n+    final String opNamespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", opNamespace));\n+\n+    final String domainNamespace1 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace1));\n+\n+    final String domainNamespace2 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n         \"Failed to create unique namespace due to ApiException\");\n-    logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace2));\n \n-    // Create a service account for the unique namespace\n-    final String serviceAccountName = namespace + \"-sa\";\n-    assertDoesNotThrow(\n-        () -> TestActions.createServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n+    // Create a service account for the unique opNamespace\n+    final String serviceAccountName = opNamespace + \"-sa\";\n+    assertDoesNotThrow(() -> TestActions.createServiceAccount(new V1ServiceAccount()\n+        .metadata(new V1ObjectMeta().namespace(opNamespace).name(serviceAccountName))));\n     logger.info(\"Created service account: \" + serviceAccountName);\n \n     OperatorParams opParams =\n         new OperatorParams().releaseName(\"weblogic-operator\")\n-            .namespace(namespace)\n-            .image(\"weblogic-kubernetes-operator:test_itsimpleoperator\")\n-            .domainNamespaces(Arrays.asList(\"domainns1\", \"domainns2\"))\n-            .serviceAccount(\"opns1-sa\");\n+            .namespace(opNamespace)\n+            .chartDir(\"../kubernetes/charts/weblogic-operator\")\n+            .image(\"phx.ocir.io/weblogick8s/weblogic-kubernetes-operator:develop\")\n+            .domainNamespaces(Arrays.asList(domainNamespace1, domainNamespace2))\n+            .serviceAccount(serviceAccountName);\n \n-    //ToDO: use Junit 5 assertions\n     try {\n-      installOperator(opParams);\n-    } catch (ApiException e) {\n-      e.printStackTrace();\n-      fail(\"Failed to install Operator due to exception\" + e.getMessage());\n-    }\n+      assertThat(installOperator(opParams)).as(\"Operator installation failed\").isTrue();\n+      logger.info(String.format(\"Operator installed in namespace %s\", opNamespace));\n+\n+      // we can use a standard JUnit assertion to check on the result\n+      // assertEquals(true, success, \"Operator successfully installed in opNamespace \" + opNamespace);\n+\n+      // this is an example of waiting for an async operation to complete.\n+      // after the previous step was completed, kubernetes will try to pull the image,\n+      // start the pod, check the readiness/health probes, etc.  this will take some\n+      // period of time and either the operator will come to a running state, or it\n+      // will not.\n+      // in this example, we first wait 30 seconds, since it is unlikely this operation\n+      // will complete in less than 30 seconds, then we check if the operator is running.\n+      with().pollDelay(30, SECONDS)\n+          // we check again every 10 seconds.\n+          .and().with().pollInterval(10, SECONDS)\n+          // this listener lets us report some status with each poll\n+          .conditionEvaluationListener(\n+              condition -> logger.info(()\n+                  -> String.format(\"Waiting for operator to be running (elapsed time %dms, remaining time %dms)\",\n+                  condition.getElapsedTimeInMS(),\n+                  condition.getRemainingTimeInMS())))\n+          // and here we can set the maximum time we are prepared to wait\n+          .await().atMost(5, MINUTES)\n+          // operatorIsRunning() is one of our custom, reusable assertions\n+          .until(operatorIsRunning(opNamespace));\n+    } finally {\n+\n+      // uninstall operator release\n+      assertThat(TestActions.uninstallOperator(opParams))\n+          .as(\"Operator uninstall failed\")\n+          .isTrue();\n+\n+      // Delete service account from unique opNamespace\n+      assertDoesNotThrow(\n+          () -> TestActions.deleteServiceAccount(new V1ServiceAccount()", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MTc4OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403641789", "bodyText": "will do", "author": "vanajamukkara", "createdAt": "2020-04-05T03:05:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NTkyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIwODE2OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404208169", "bodyText": "done", "author": "vanajamukkara", "createdAt": "2020-04-06T16:03:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM5NTkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDA5Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404097", "bodyText": "same comment about inheritance", "author": "markxnelson", "createdAt": "2020-04-04T01:20:26Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/TraefikParams.java", "diffHunk": "@@ -5,13 +5,13 @@\n \n import java.util.HashMap;\n \n+import oracle.weblogic.kubernetes.actions.impl.primitive.HelmParams;\n+\n // All parameters needed to install Traefik Operator\n \n-public class TraefikParams {\n+public class TraefikParams extends HelmParams {", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDQxNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404415", "bodyText": "i think this is not ideal - if it fails, how will we know which of the two commands failed?\ni think it would be better to run each one separately and then inspect the results\ni know is it \"more work\" - but i think it is much clearer and will produce more reliable code to do if we do it that way", "author": "markxnelson", "createdAt": "2020-04-04T01:23:02Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzY0MTgxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403641816", "bodyText": "will do", "author": "vanajamukkara", "createdAt": "2020-04-05T03:05:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDQxNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDQ4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404481", "bodyText": "captials and periods please", "author": "markxnelson", "createdAt": "2020-04-04T01:23:29Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDU1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404558", "bodyText": "nitpick: if you say it returns true on success, no need to say false otherwise, that is pretty clear :)", "author": "markxnelson", "createdAt": "2020-04-04T01:23:59Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDYxMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404611", "bodyText": "these are really nice", "author": "markxnelson", "createdAt": "2020-04-04T01:24:25Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDgwMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404802", "bodyText": "same comment as before", "author": "markxnelson", "createdAt": "2020-04-04T01:26:36Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")\n+        .append(params.getReleaseName()).append(\" \").append(chartDir)\n+        .append(\" --namespace \").append(params.getNamespace());\n+\n+    // add all the parameters\n+    appendValues(params.getValues(), upgradeCmd);\n+\n+    upgradeCmd.append(\" && helm list\");", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIxNTg5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404215896", "bodyText": "modified", "author": "vanajamukkara", "createdAt": "2020-04-06T16:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDgwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDgzOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404838", "bodyText": "capitals, period.\nHelm has a capital H", "author": "markxnelson", "createdAt": "2020-04-04T01:26:59Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")\n+        .append(params.getReleaseName()).append(\" \").append(chartDir)\n+        .append(\" --namespace \").append(params.getNamespace());\n+\n+    // add all the parameters\n+    appendValues(params.getValues(), upgradeCmd);\n+\n+    upgradeCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(upgradeCmd.toString());\n   }\n \n-  public String getRepoUrl() {\n-    return repoUrl;\n+  /**\n+   * uninstall a helm release", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDg3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404872", "bodyText": "cap, period", "author": "markxnelson", "createdAt": "2020-04-04T01:27:19Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")\n+        .append(params.getReleaseName()).append(\" \").append(chartDir)\n+        .append(\" --namespace \").append(params.getNamespace());\n+\n+    // add all the parameters\n+    appendValues(params.getValues(), upgradeCmd);\n+\n+    upgradeCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(upgradeCmd.toString());\n   }\n \n-  public String getRepoUrl() {\n-    return repoUrl;\n+  /**\n+   * uninstall a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean uninstall(HelmParams params) {\n+    // assertions for required parameters\n+    assertThat(params.getNamespace())\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    return exec(\"helm uninstall \" + params.getReleaseName()\n+        + \" -n \" + params.getNamespace());\n   }\n \n-  public HashMap<String, Object> getValues() {\n-    return values;\n+  /**\n+   * Add a chart repository\n+   * @param chartName the name of the chart\n+   * @param repoUrl reposiroty url\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean addRepo(String chartName, String repoUrl) {\n+    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n+    return exec(addRepoCmd);\n   }\n \n-  public boolean install() {\n-    StringBuffer installCmd = new StringBuffer(\"helm install \")\n-                              .append(releaseName).append(\" \").append(chartName);\n+  /**\n+   * append the values to the given string buffer", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDkwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404901", "bodyText": "period", "author": "markxnelson", "createdAt": "2020-04-04T01:27:29Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")\n+        .append(params.getReleaseName()).append(\" \").append(chartDir)\n+        .append(\" --namespace \").append(params.getNamespace());\n+\n+    // add all the parameters\n+    appendValues(params.getValues(), upgradeCmd);\n+\n+    upgradeCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(upgradeCmd.toString());\n   }\n \n-  public String getRepoUrl() {\n-    return repoUrl;\n+  /**\n+   * uninstall a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean uninstall(HelmParams params) {\n+    // assertions for required parameters\n+    assertThat(params.getNamespace())\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    return exec(\"helm uninstall \" + params.getReleaseName()\n+        + \" -n \" + params.getNamespace());\n   }\n \n-  public HashMap<String, Object> getValues() {\n-    return values;\n+  /**\n+   * Add a chart repository\n+   * @param chartName the name of the chart\n+   * @param repoUrl reposiroty url\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean addRepo(String chartName, String repoUrl) {\n+    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n+    return exec(addRepoCmd);\n   }\n \n-  public boolean install() {\n-    StringBuffer installCmd = new StringBuffer(\"helm install \")\n-                              .append(releaseName).append(\" \").append(chartName);\n+  /**\n+   * append the values to the given string buffer\n+   * @param values hash map with key, value pairs\n+   * @param command the command to append to\n+   */\n+  private static void appendValues(HashMap<String, Object> values, StringBuffer command) {\n     values.forEach((key, value) ->\n-                    installCmd.append(\" --set \")\n-                              .append(key)\n-                              .append(\"=\")\n-                              .append(value.toString().replaceAll(\"\\\\[\",\"{\").replaceAll(\"\\\\]\",\"}\")));\n-    logger.info(\"Running helm install command \" + installCmd);\n-    return true;\n-  }\n-\n-  public boolean upgrade() {\n-    return true;\n-  }\n-\n-  public boolean delete() {\n-    return true;\n+        command.append(\" --set \\\"\")\n+            .append(key)\n+            .append(\"=\")\n+            .append(value.toString().replaceAll(\"\\\\[\", \"{\").replaceAll(\"\\\\]\", \"}\").replace(\" \",\"\"))\n+            .append(\"\\\"\"));\n   }\n \n-  public boolean addRepo() {\n-    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n-    // execute addRepoCmd\n+  /**\n+   * Executes the given command", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNDk3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403404978", "bodyText": "nitpick: if this method \"executes\" a command, then it is probably nicer to say \"the command to execute\"", "author": "markxnelson", "createdAt": "2020-04-04T01:28:12Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")\n+        .append(params.getReleaseName()).append(\" \").append(chartDir)\n+        .append(\" --namespace \").append(params.getNamespace());\n+\n+    // add all the parameters\n+    appendValues(params.getValues(), upgradeCmd);\n+\n+    upgradeCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(upgradeCmd.toString());\n   }\n \n-  public String getRepoUrl() {\n-    return repoUrl;\n+  /**\n+   * uninstall a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean uninstall(HelmParams params) {\n+    // assertions for required parameters\n+    assertThat(params.getNamespace())\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    return exec(\"helm uninstall \" + params.getReleaseName()\n+        + \" -n \" + params.getNamespace());\n   }\n \n-  public HashMap<String, Object> getValues() {\n-    return values;\n+  /**\n+   * Add a chart repository\n+   * @param chartName the name of the chart\n+   * @param repoUrl reposiroty url\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean addRepo(String chartName, String repoUrl) {\n+    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n+    return exec(addRepoCmd);\n   }\n \n-  public boolean install() {\n-    StringBuffer installCmd = new StringBuffer(\"helm install \")\n-                              .append(releaseName).append(\" \").append(chartName);\n+  /**\n+   * append the values to the given string buffer\n+   * @param values hash map with key, value pairs\n+   * @param command the command to append to\n+   */\n+  private static void appendValues(HashMap<String, Object> values, StringBuffer command) {\n     values.forEach((key, value) ->\n-                    installCmd.append(\" --set \")\n-                              .append(key)\n-                              .append(\"=\")\n-                              .append(value.toString().replaceAll(\"\\\\[\",\"{\").replaceAll(\"\\\\]\",\"}\")));\n-    logger.info(\"Running helm install command \" + installCmd);\n-    return true;\n-  }\n-\n-  public boolean upgrade() {\n-    return true;\n-  }\n-\n-  public boolean delete() {\n-    return true;\n+        command.append(\" --set \\\"\")\n+            .append(key)\n+            .append(\"=\")\n+            .append(value.toString().replaceAll(\"\\\\[\", \"{\").replaceAll(\"\\\\]\", \"}\").replace(\" \",\"\"))\n+            .append(\"\\\"\"));\n   }\n \n-  public boolean addRepo() {\n-    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n-    // execute addRepoCmd\n+  /**\n+   * Executes the given command\n+   * @param command the command to run", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNTEyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403405128", "bodyText": "These feel like the should maybe be debug level messages, not info\n@rjeberhard @ddsharpe what do you think?", "author": "markxnelson", "createdAt": "2020-04-04T01:29:06Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/Helm.java", "diffHunk": "@@ -5,86 +5,175 @@\n \n import java.util.HashMap;\n \n-import oracle.weblogic.kubernetes.extensions.LoggedTest;\n-\n-public class Helm implements LoggedTest {\n-\n-  private String chartName;\n-  private String releaseName;\n-  private String namespace;\n-  private String repoUrl;\n-  private HashMap<String, Object> values;\n-\n-  public Helm chartName(String chartName) {\n-    this.chartName = chartName;\n-    return this;\n-  }\n-\n-  public Helm releaseName(String releaseName) {\n-    this.releaseName = releaseName;\n-    return this;\n-  }\n-\n-  public Helm namespace(String namespace) {\n-    this.namespace = namespace;\n-    return this;\n-  }\n-\n-  public Helm repoUrl(String repoUrl) {\n-    this.repoUrl = repoUrl;\n-    return this;\n-  }\n+import oracle.weblogic.kubernetes.utils.ExecCommand;\n+import oracle.weblogic.kubernetes.utils.ExecResult;\n+\n+import static oracle.weblogic.kubernetes.extensions.LoggedTest.logger;\n+import static org.assertj.core.api.Assertions.assertThat;\n+\n+public class Helm {\n+\n+  /**\n+   * install helm chart\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean install(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getRepoUrl() != null && params.getChartName() == null)\n+        .as(\"make sure chart name is not empty or null when repo url is provided\")\n+        .isFalse();\n+\n+    assertThat(params.getRepoUrl() == null && params.getChartDir() == null)\n+        .as(\"make sure repo url, chart name and chart dir are not empty or null. \"\n+            + \"repo url, chart name or chart dir must be provided\")\n+        .isFalse();\n+\n+    //chart reference to be used in helm install\n+    String chartRef = params.getChartDir();\n+\n+    // use repo url as chart reference if provided\n+    if (params.getChartName() != null && params.getRepoUrl() != null) {\n+      Helm.addRepo(params.getChartName(), params.getRepoUrl());\n+      chartRef = params.getRepoUrl();\n+    }\n+\n+    logger.info(String.format(\"Installing application in namespace %s using chart %s\",\n+        namespace, chartRef));\n+\n+    // build helm install command\n+    StringBuffer installCmd = new StringBuffer(\"helm install \")\n+        .append(params.getReleaseName()).append(\" \").append(chartRef)\n+        .append(\" --namespace \").append(params.getNamespace());\n \n-  public Helm values(HashMap<String, Object> values) {\n-    this.values = values;\n-    return this;\n-  }\n+    // add all the parameters\n+    appendValues(params.getValues(), installCmd);\n \n-  public String getChartName() {\n-    return chartName;\n-  }\n+    installCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(installCmd.toString());\n \n-  public String getReleaseName() {\n-    return releaseName;\n   }\n \n-  public String getNamespace() {\n-    return namespace;\n+  /**\n+   * upgrade a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean upgrade(HelmParams params) {\n+    String namespace = params.getNamespace();\n+\n+    // assertions for required parameters\n+    assertThat(namespace)\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getChartDir())\n+        .as(\"make sure chart dir is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    //chart reference to be used in helm upgrade\n+    String chartDir = params.getChartDir();\n+\n+    logger.info(String.format(\"Upgrade application in namespace %s using chart %s\",\n+        namespace, chartDir));\n+\n+    // build helm upgrade command\n+    StringBuffer upgradeCmd = new StringBuffer(\"helm upgrade \")\n+        .append(params.getReleaseName()).append(\" \").append(chartDir)\n+        .append(\" --namespace \").append(params.getNamespace());\n+\n+    // add all the parameters\n+    appendValues(params.getValues(), upgradeCmd);\n+\n+    upgradeCmd.append(\" && helm list\");\n+    // run the command\n+    return exec(upgradeCmd.toString());\n   }\n \n-  public String getRepoUrl() {\n-    return repoUrl;\n+  /**\n+   * uninstall a helm release\n+   * @param params the parameters to helm as values\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean uninstall(HelmParams params) {\n+    // assertions for required parameters\n+    assertThat(params.getNamespace())\n+        .as(\"make sure namespace is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    assertThat(params.getReleaseName())\n+        .as(\"make sure releaseName is not empty or null\")\n+        .isNotNull()\n+        .isNotEmpty();\n+\n+    return exec(\"helm uninstall \" + params.getReleaseName()\n+        + \" -n \" + params.getNamespace());\n   }\n \n-  public HashMap<String, Object> getValues() {\n-    return values;\n+  /**\n+   * Add a chart repository\n+   * @param chartName the name of the chart\n+   * @param repoUrl reposiroty url\n+   * @return true on success, false otherwise\n+   */\n+  public static boolean addRepo(String chartName, String repoUrl) {\n+    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n+    return exec(addRepoCmd);\n   }\n \n-  public boolean install() {\n-    StringBuffer installCmd = new StringBuffer(\"helm install \")\n-                              .append(releaseName).append(\" \").append(chartName);\n+  /**\n+   * append the values to the given string buffer\n+   * @param values hash map with key, value pairs\n+   * @param command the command to append to\n+   */\n+  private static void appendValues(HashMap<String, Object> values, StringBuffer command) {\n     values.forEach((key, value) ->\n-                    installCmd.append(\" --set \")\n-                              .append(key)\n-                              .append(\"=\")\n-                              .append(value.toString().replaceAll(\"\\\\[\",\"{\").replaceAll(\"\\\\]\",\"}\")));\n-    logger.info(\"Running helm install command \" + installCmd);\n-    return true;\n-  }\n-\n-  public boolean upgrade() {\n-    return true;\n-  }\n-\n-  public boolean delete() {\n-    return true;\n+        command.append(\" --set \\\"\")\n+            .append(key)\n+            .append(\"=\")\n+            .append(value.toString().replaceAll(\"\\\\[\", \"{\").replaceAll(\"\\\\]\", \"}\").replace(\" \",\"\"))\n+            .append(\"\\\"\"));\n   }\n \n-  public boolean addRepo() {\n-    String addRepoCmd = \"helm add repo \" + chartName + \" \" + repoUrl;\n-    // execute addRepoCmd\n+  /**\n+   * Executes the given command\n+   * @param command the command to run\n+   * @return true on success, false otherwise\n+   */\n+  private static boolean exec(String command) {\n+    logger.info(\"Running command - \\n\" + command);", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NTE0MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404355140", "bodyText": "Let's get some tests running and then prune these back.", "author": "rjeberhard", "createdAt": "2020-04-06T20:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNTEyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNTEzNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403405136", "bodyText": "capital H", "author": "markxnelson", "createdAt": "2020-04-04T01:29:17Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/HelmParams.java", "diffHunk": "@@ -0,0 +1,40 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes.actions.impl.primitive;\n+\n+import java.util.HashMap;\n+\n+// All common parameters needed to install a helm application", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNTE4NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r403405185", "bodyText": "why an abstract class?", "author": "markxnelson", "createdAt": "2020-04-04T01:29:44Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/impl/primitive/HelmParams.java", "diffHunk": "@@ -0,0 +1,40 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.weblogic.kubernetes.actions.impl.primitive;\n+\n+import java.util.HashMap;\n+\n+// All common parameters needed to install a helm application\n+\n+public abstract class HelmParams {", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIxNjUxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404216516", "bodyText": "Now as I removed inheritance, don't need the abstract method in this class anymore and this class is not abstract now.", "author": "vanajamukkara", "createdAt": "2020-04-06T16:14:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQwNTE4NQ=="}], "type": "inlineReview"}, {"oid": "f3143a03aeb920245305b5b0e75f8c2f7c5298dc", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f3143a03aeb920245305b5b0e75f8c2f7c5298dc", "message": "adding helm install, upgrade, delete implementation", "committedDate": "2020-04-04T04:09:21Z", "type": "commit"}, {"oid": "a4ab98ab6061ddf1450f630c8a469ccb872db622", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a4ab98ab6061ddf1450f630c8a469ccb872db622", "message": "Merge branch 'mii-new-integration-tests' of https://github.com/oracle/weblogic-kubernetes-operator into mii-tests-helmimpl", "committedDate": "2020-04-04T04:31:02Z", "type": "commit"}, {"oid": "b607f8dc87b21a2d6fa0041c0f6bd213dc5116a7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b607f8dc87b21a2d6fa0041c0f6bd213dc5116a7", "message": "fix namespace and helm delete command", "committedDate": "2020-04-04T05:27:24Z", "type": "commit"}, {"oid": "52aa141bc706ff67d3007a6e49f1d7eec85b9de4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/52aa141bc706ff67d3007a6e49f1d7eec85b9de4", "message": "Merge branch 'mii-new-integration-tests' of https://github.com/oracle/weblogic-kubernetes-operator into mii-tests-helmimpl", "committedDate": "2020-04-04T05:28:03Z", "type": "commit"}, {"oid": "058add457c39d2dea572e95fe4ce5fad091016b0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/058add457c39d2dea572e95fe4ce5fad091016b0", "message": "change delete to uninstall", "committedDate": "2020-04-04T05:40:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDEzODIxNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404138217", "bodyText": "This is the part I was discussing in the channel... Depending on the sort of cluster, the image may need to be pushed or not.  But, I guess this can wait and need not be part of this pull request.", "author": "rjeberhard", "createdAt": "2020-04-06T14:31:50Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -65,69 +64,89 @@ public void testInstallingOperator() {\n     // the kubernetes deployment.  this will complete quickly, and will either be\n     // successful or not.\n \n-    // get a new unique namespace\n-    final String namespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+    // get a new unique opNamespace\n+    final String opNamespace = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", opNamespace));\n+\n+    final String domainNamespace1 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n+        \"Failed to create unique namespace due to ApiException\");\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace1));\n+\n+    final String domainNamespace2 = assertDoesNotThrow(TestActions::createUniqueNamespace,\n         \"Failed to create unique namespace due to ApiException\");\n-    logger.info(String.format(\"Got a new namespace called %s\", namespace));\n+    logger.info(String.format(\"Got a new namespace called %s\", domainNamespace2));\n \n-    // Create a service account for the unique namespace\n-    final String serviceAccountName = namespace + \"-sa\";\n-    assertDoesNotThrow(\n-        () -> TestActions.createServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n+    // Create a service account for the unique opNamespace\n+    final String serviceAccountName = opNamespace + \"-sa\";\n+    assertDoesNotThrow(() -> TestActions.createServiceAccount(new V1ServiceAccount()\n+        .metadata(new V1ObjectMeta().namespace(opNamespace).name(serviceAccountName))));\n     logger.info(\"Created service account: \" + serviceAccountName);\n \n     OperatorParams opParams =\n         new OperatorParams().releaseName(\"weblogic-operator\")\n-            .namespace(namespace)\n-            .image(\"weblogic-kubernetes-operator:test_itsimpleoperator\")\n-            .domainNamespaces(Arrays.asList(\"domainns1\", \"domainns2\"))\n-            .serviceAccount(\"opns1-sa\");\n+            .namespace(opNamespace)\n+            .chartDir(\"../kubernetes/charts/weblogic-operator\")\n+            .image(\"phx.ocir.io/weblogick8s/weblogic-kubernetes-operator:develop\")", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE0MTczMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404141731", "bodyText": "You don't need the formatting here (the hyphen)... that will generated Javadoc that starts with this symbol.", "author": "rjeberhard", "createdAt": "2020-04-06T14:36:15Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/TestActions.java", "diffHunk": "@@ -64,24 +64,24 @@ public static boolean scaleDomain(String domainUID, String clusterName, int numO\n   }\n \n   /**\n-   * Delete the Operator release.\n+   * Uninstall the Operator release.\n    *\n    * @param name      operator release name\n    * @param namespace the name of the namespace\n    * @return true on success, false otherwise\n    */\n \n-  public static boolean deleteOperator(String name, String namespace) {\n-    return Operator.delete(name, namespace);\n+  public static boolean uninstallOperator(OperatorParams params) {\n+    return Operator.uninstall(params);\n   }\n \n   // ----------------------   domain  -----------------------------------\n \n   /**\n    * Create domain custom resource from the given domain yaml file.\n    *\n-   * @param domainUID - unique domain identifier\n-   * @param namespace - name of namespace\n+   * @param domainUID  - unique domain identifier", "originalCommit": "058add457c39d2dea572e95fe4ce5fad091016b0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDIxNzQyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404217428", "bodyText": "removed the formatting", "author": "vanajamukkara", "createdAt": "2020-04-06T16:16:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE0MTczMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NDQ0Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404354443", "bodyText": "Why the strange name?  It's because you don't want the same name as TestActions.createUninqueNamespace(), correct :(?  The \"InTryBlock\" portion of the name looks strange.  Can this just be createNamespace()?", "author": "rjeberhard", "createdAt": "2020-04-06T20:04:08Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -116,18 +148,70 @@ public void testInstallingOperator() {\n         // and here we can set the maximum time we are prepared to wait\n         .await().atMost(5, MINUTES)\n         // operatorIsRunning() is one of our custom, reusable assertions\n-        .until(operatorIsRunning(namespace));\n-\n-    // Delete service account from unique namespace\n-    assertDoesNotThrow(\n-        () -> TestActions.deleteServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n-    logger.info(\"Deleted service account \" + serviceAccountName);\n-\n-    // Delete namespace\n-    assertDoesNotThrow(\n-        () -> TestActions.deleteNamespace(namespace));\n-    logger.info(\"Deleted namespace: \" + namespace);\n+        .until(operatorIsRunning(opNamespace));\n+\n+  }\n+\n+  @AfterEach\n+  public void tearDown() {\n+    // uninstall operator release\n+    if (opHelmParams != null) {\n+      assertThat(uninstallOperator(opHelmParams))\n+          .as(\"Test uninstallOperator returns true\")\n+          .withFailMessage(\"uninstallOperator() did not return true\")\n+          .isTrue();\n+    }\n+\n+    // Delete service account from unique opNamespace\n+    if (serviceAccount != null) {\n+      assertThatCode(\n+          () -> deleteServiceAccount(serviceAccount))\n+          .as(\"Test that deleteServiceAccount doesn not throw an exception\")\n+          .withFailMessage(\"deleteServiceAccount() threw an exception\")\n+          .doesNotThrowAnyException();\n+    }\n+    // Delete domain namespaces\n+    if (domainNamespace1 != null) {\n+      assertThatCode(\n+          () -> deleteNamespace(domainNamespace1))\n+          .as(\"Test that deleteNamespace doesn not throw an exception\")\n+          .withFailMessage(\"deleteNamespace() threw an exception\")\n+          .doesNotThrowAnyException();\n+      logger.info(\"Deleted namespace: \" + domainNamespace1);\n+    }\n+\n+    if (domainNamespace2 != null) {\n+      assertThatCode(\n+          () -> deleteNamespace(domainNamespace2))\n+          .as(\"Test that deleteNamespace doesn not throw an exception\")\n+          .withFailMessage(\"deleteNamespace() threw an exception\")\n+          .doesNotThrowAnyException();\n+      logger.info(\"Deleted namespace: \" + domainNamespace2);\n+    }\n+\n+    // Delete opNamespace\n+    if (opNamespace != null) {\n+      assertThatCode(\n+          () -> deleteNamespace(opNamespace))\n+          .as(\"Test that deleteNamespace doesn not throw an exception\")\n+          .withFailMessage(\"deleteNamespace() threw an exception\")\n+          .doesNotThrowAnyException();\n+      logger.info(\"Deleted namespace: \" + opNamespace);\n+    }\n+\n+  }\n+\n+  private String createUniqueNamespaceInTryBlock() {", "originalCommit": "21ccf1c2315351f5912ff421efaf94c724dfe23c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NjY3Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404356673", "bodyText": "yes, will change it", "author": "vanajamukkara", "createdAt": "2020-04-06T20:08:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1NDQ0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1MzgzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404353839", "bodyText": "what class should it be?", "author": "markxnelson", "createdAt": "2020-04-06T20:03:01Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItSimpleOperatorValidation.java", "diffHunk": "@@ -116,18 +148,70 @@ public void testInstallingOperator() {\n         // and here we can set the maximum time we are prepared to wait\n         .await().atMost(5, MINUTES)\n         // operatorIsRunning() is one of our custom, reusable assertions\n-        .until(operatorIsRunning(namespace));\n-\n-    // Delete service account from unique namespace\n-    assertDoesNotThrow(\n-        () -> TestActions.deleteServiceAccount(new V1ServiceAccount()\n-            .metadata(new V1ObjectMeta().namespace(namespace).name(serviceAccountName))));\n-    logger.info(\"Deleted service account \" + serviceAccountName);\n-\n-    // Delete namespace\n-    assertDoesNotThrow(\n-        () -> TestActions.deleteNamespace(namespace));\n-    logger.info(\"Deleted namespace: \" + namespace);\n+        .until(operatorIsRunning(opNamespace));\n+\n+  }\n+\n+  @AfterEach\n+  public void tearDown() {\n+    // uninstall operator release\n+    if (opHelmParams != null) {\n+      assertThat(uninstallOperator(opHelmParams))\n+          .as(\"Test uninstallOperator returns true\")\n+          .withFailMessage(\"uninstallOperator() did not return true\")\n+          .isTrue();\n+    }\n+\n+    // Delete service account from unique opNamespace\n+    if (serviceAccount != null) {\n+      assertThatCode(\n+          () -> deleteServiceAccount(serviceAccount))\n+          .as(\"Test that deleteServiceAccount doesn not throw an exception\")\n+          .withFailMessage(\"deleteServiceAccount() threw an exception\")\n+          .doesNotThrowAnyException();\n+    }\n+    // Delete domain namespaces\n+    if (domainNamespace1 != null) {\n+      assertThatCode(\n+          () -> deleteNamespace(domainNamespace1))\n+          .as(\"Test that deleteNamespace doesn not throw an exception\")\n+          .withFailMessage(\"deleteNamespace() threw an exception\")\n+          .doesNotThrowAnyException();\n+      logger.info(\"Deleted namespace: \" + domainNamespace1);\n+    }\n+\n+    if (domainNamespace2 != null) {\n+      assertThatCode(\n+          () -> deleteNamespace(domainNamespace2))\n+          .as(\"Test that deleteNamespace doesn not throw an exception\")\n+          .withFailMessage(\"deleteNamespace() threw an exception\")\n+          .doesNotThrowAnyException();\n+      logger.info(\"Deleted namespace: \" + domainNamespace2);\n+    }\n+\n+    // Delete opNamespace\n+    if (opNamespace != null) {\n+      assertThatCode(\n+          () -> deleteNamespace(opNamespace))\n+          .as(\"Test that deleteNamespace doesn not throw an exception\")\n+          .withFailMessage(\"deleteNamespace() threw an exception\")\n+          .doesNotThrowAnyException();\n+      logger.info(\"Deleted namespace: \" + opNamespace);\n+    }\n+\n+  }\n+\n+  private String createUniqueNamespaceInTryBlock() {\n+    String namespace = null;\n+    try {\n+      namespace = createUniqueNamespace();\n+    } catch (Exception e) {\n+      assertThat(e)\n+          .as(\"Test that createUniqueNamespace does not throw an exception\")\n+          .withFailMessage(\"createUniqueNamespace() threw an unexpected exception\")\n+          .isNotInstanceOf(Exception.class);", "originalCommit": "21ccf1c2315351f5912ff421efaf94c724dfe23c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1OTExNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404359116", "bodyText": "Oh, I just realized what this is... You're forcing an assert to fail because e will of course be an exception.  Shouldn't this just wrap the createUniqueNamespece() with the assertDoesNotThrow?", "author": "rjeberhard", "createdAt": "2020-04-06T20:13:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1MzgzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM2NjI0Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404366242", "bodyText": "createUniqueNamespace() throws ApiException. I am bit confused, why check for instanceOf? It should fail irrespective of any type of exception right?", "author": "vanajamukkara", "createdAt": "2020-04-06T20:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1MzgzOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM4MTk4OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1535#discussion_r404381989", "bodyText": "Just saw Ryan's comment. We can use PR#1537 as this PR is closed, we have the same code.", "author": "vanajamukkara", "createdAt": "2020-04-06T20:55:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDM1MzgzOQ=="}], "type": "inlineReview"}, {"oid": "a622031d5ec792baf9b53da7d8200f062bd0cd63", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a622031d5ec792baf9b53da7d8200f062bd0cd63", "message": "addressing review comments", "committedDate": "2020-04-06T23:42:41Z", "type": "commit"}, {"oid": "21ccf1c2315351f5912ff421efaf94c724dfe23c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/21ccf1c2315351f5912ff421efaf94c724dfe23c", "message": "addressing review comments", "committedDate": "2020-04-06T23:59:20Z", "type": "commit"}, {"oid": "656054a0005c6a6ab0e0d73220e438664c76fb62", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/656054a0005c6a6ab0e0d73220e438664c76fb62", "message": "change method name", "committedDate": "2020-04-07T04:28:46Z", "type": "commit"}, {"oid": "2b12715934ff73380c0a0f98f6384189b653fb10", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2b12715934ff73380c0a0f98f6384189b653fb10", "message": "fix exception class", "committedDate": "2020-04-07T04:44:48Z", "type": "commit"}]}