{"pr_number": 2012, "pr_title": "OWLS85461 add introspect version to server pod label", "pr_createdAt": "2020-10-27T12:33:01Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012", "timeline": [{"oid": "d8dc1a7b7b0a77aa0da9bfa95092d076c82b2a74", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d8dc1a7b7b0a77aa0da9bfa95092d076c82b2a74", "message": "initial changes to add introspect version to pod labels", "committedDate": "2020-10-23T13:43:08Z", "type": "commit"}, {"oid": "46bb990ba30944301cf553b43e090faa21a3b07d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/46bb990ba30944301cf553b43e090faa21a3b07d", "message": "work in progress", "committedDate": "2020-10-23T17:53:53Z", "type": "commit"}, {"oid": "a900afafcbe52ec912887214141859a6dfe6e593", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a900afafcbe52ec912887214141859a6dfe6e593", "message": "work in progress", "committedDate": "2020-10-26T02:24:37Z", "type": "commit"}, {"oid": "ad4be5622e4f6f0d4602fb10cc30403b3e353c49", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ad4be5622e4f6f0d4602fb10cc30403b3e353c49", "message": "cleanup", "committedDate": "2020-10-26T14:08:26Z", "type": "commit"}, {"oid": "4d7ce38c0c4ac946af45553d7c504c7e59821c51", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4d7ce38c0c4ac946af45553d7c504c7e59821c51", "message": "fix unit test failure in PodWatcherTest not related to this PR", "committedDate": "2020-10-26T14:12:22Z", "type": "commit"}, {"oid": "6d9bb16c1fdbbef3ba6751ad38b6556516fc10ef", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6d9bb16c1fdbbef3ba6751ad38b6556516fc10ef", "message": "minor changes", "committedDate": "2020-10-26T20:38:23Z", "type": "commit"}, {"oid": "5501a1b7f54ca640e3810d979b93d09be2aecb66", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5501a1b7f54ca640e3810d979b93d09be2aecb66", "message": "doc changes", "committedDate": "2020-10-26T20:53:17Z", "type": "commit"}, {"oid": "cc78fc7d9cfd325080f458b28698ed58f347d57c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cc78fc7d9cfd325080f458b28698ed58f347d57c", "message": "add an example in the doc", "committedDate": "2020-10-26T21:28:26Z", "type": "commit"}, {"oid": "9d3c1d0a917f86aa0407a3cddb8be5038125f924", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9d3c1d0a917f86aa0407a3cddb8be5038125f924", "message": "Merge remote-tracking branch 'origin/develop' into add-introspect-version-label", "committedDate": "2020-10-27T12:30:37Z", "type": "commit"}, {"oid": "eef06c56df8c07216148bcde5b2e3053fb33c874", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/eef06c56df8c07216148bcde5b2e3053fb33c874", "message": "doc edits to address review comments", "committedDate": "2020-10-27T14:28:17Z", "type": "commit"}, {"oid": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f65501687cd567c1bf099e3cb6dd043aa0a541de", "message": "Merge remote-tracking branch 'origin/develop' into add-introspect-version-label", "committedDate": "2020-10-27T14:47:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3MjY2NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512772664", "bodyText": "Minor minor nit: combine repeated patch string concatenation code into a single local variable...", "author": "tbarnes-us", "createdAt": "2020-10-27T15:06:41Z", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/PodStepContext.java", "diffHunk": "@@ -364,6 +366,24 @@ protected Step patchPod(V1Pod currentPod, Step next) {\n             new V1Patch(patchBuilder.build().toString()), patchResponse(next));\n   }\n \n+  private Step updateCurrentPod(V1Pod currentPod, Step next) {\n+    return createProgressingStep(updatePod(currentPod, next));\n+  }\n+\n+  protected Step updatePod(V1Pod currentPod, Step next) {\n+    JsonPatchBuilder patchBuilder = Json.createPatchBuilder();\n+    String baseName = \"/metadata/labels/\";\n+    if (!getPodLabels().containsKey(INTROSPECTION_STATE_LABEL)) {\n+      patchBuilder.add(baseName + INTROSPECTION_STATE_LABEL, getDomain().getSpec().getIntrospectVersion());\n+    } else {\n+      patchBuilder.replace(baseName + INTROSPECTION_STATE_LABEL, getDomain().getSpec().getIntrospectVersion());", "originalCommit": "f65501687cd567c1bf099e3cb6dd043aa0a541de", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjg3OTA4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512879083", "bodyText": "Or better, into a method call. But I agree that this code is needless duplication.", "author": "russgold", "createdAt": "2020-10-27T17:18:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjc3MjY2NA=="}], "type": "inlineReview"}, {"oid": "965b0935b45e994651f1da566b7bb82c12502a75", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/965b0935b45e994651f1da566b7bb82c12502a75", "message": "address review comments", "committedDate": "2020-10-27T16:08:07Z", "type": "commit"}, {"oid": "0dc1af7050c5e8b0a7311faf0f18940d455b3bcb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0dc1af7050c5e8b0a7311faf0f18940d455b3bcb", "message": "cleanup", "committedDate": "2020-10-27T16:16:16Z", "type": "commit"}, {"oid": "af1ad2e17636538236d43e842eb2e66b3691b420", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/af1ad2e17636538236d43e842eb2e66b3691b420", "message": "add domainRestartVersion to the example", "committedDate": "2020-10-27T18:10:06Z", "type": "commit"}, {"oid": "a6f05b94cc67ed4af38ce7b4df245dce7231c9bf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a6f05b94cc67ed4af38ce7b4df245dce7231c9bf", "message": "move the patch part into the existing patch step and remove log messages", "committedDate": "2020-10-27T18:17:27Z", "type": "commit"}, {"oid": "d5516e66c657461d7035a231453c31fb4bb8fb06", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d5516e66c657461d7035a231453c31fb4bb8fb06", "message": "minor doc edit", "committedDate": "2020-10-27T18:23:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODc2MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512958760", "bodyText": "This is still much more complex than is needed. Look at PodStepContext.createMetadata(). This is where we define the labels and annotations for server pods. To add a new label, all you need to do is define it there. The rest of the code will automatically handle detection of differences between what is supposed to be and what we find.", "author": "russgold", "createdAt": "2020-10-27T19:12:26Z", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/PodStepContext.java", "diffHunk": "@@ -359,6 +361,15 @@ protected Step patchPod(V1Pod currentPod, Step next) {\n     KubernetesUtils.addPatches(\n         patchBuilder, \"/metadata/annotations/\", getAnnotations(currentPod), getPodAnnotations());\n \n+    if (introspectVersionChanged(currentPod)) {", "originalCommit": "d5516e66c657461d7035a231453c31fb4bb8fb06", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk2NzY1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2012#discussion_r512967654", "bodyText": "The label was added in the createPodModel method but in the non hashed part. If you look into getPodLabels() you'll see that the labels that are to be patched there are the customer defined labels in the server specs. I don't think you want to add this label in there.", "author": "doxiao", "createdAt": "2020-10-27T19:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMjk1ODc2MA=="}], "type": "inlineReview"}, {"oid": "f1d316c38a23d755aa6fc0d09ae629d4b3f6aa34", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f1d316c38a23d755aa6fc0d09ae629d4b3f6aa34", "message": "refactored a little", "committedDate": "2020-10-27T20:41:15Z", "type": "commit"}, {"oid": "ca7d8c0b3f9423e08945469b4e675d8af11be05b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ca7d8c0b3f9423e08945469b4e675d8af11be05b", "message": "Correct overrideDistributionStrategy other places", "committedDate": "2020-10-27T21:25:38Z", "type": "commit"}, {"oid": "e2bd8fa7ae7945988679e445d6b283089bd2fd46", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e2bd8fa7ae7945988679e445d6b283089bd2fd46", "message": "Add correct the other misspelled field name", "committedDate": "2020-10-27T21:40:17Z", "type": "commit"}]}