{"pr_number": 1512, "pr_title": "Install wit actions interface", "pr_createdAt": "2020-03-27T23:02:53Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512", "timeline": [{"oid": "65ab3c880c62a2fad8cdf315906e0dc1f2501177", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/65ab3c880c62a2fad8cdf315906e0dc1f2501177", "message": "Add actions for download and WIT\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-03-27T22:50:21Z", "type": "commit"}, {"oid": "366b647339557c3a9bbe35448ac6899e85964f8a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/366b647339557c3a9bbe35448ac6899e85964f8a", "message": "Minor fix\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-03-27T22:56:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NDkzOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399584938", "bodyText": "this is just a nit pick, i prefer to put start a new line before every dot/period", "author": "markxnelson", "createdAt": "2020-03-27T23:43:37Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/TestActions.java", "diffHunk": "@@ -38,6 +44,37 @@ public static String createUniqueNamespace() {\n         return Namespace.createUniqueNamespace();\n     }\n \n-    // etc...\n+    // ------------------------ Docker image  -------------------------\n+\n+    public static boolean createMIIImage(\n+        String baseImageName, \n+        String imageTag,\n+        List<String> modelFiles,\n+        List<String> modelVariableFiles,\n+        List<String> modelArchiveFiles,\n+        String wdtVersion,\n+        String domainType) {\n+  \n+    \treturn \n+            new WebLogicImageTool()\n+                .with(new WITParams()\n+                     .baseName(baseImageName).tag(imageTag).modelFiles(modelFiles)", "originalCommit": "366b647339557c3a9bbe35448ac6899e85964f8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYwOTgzNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399609837", "bodyText": "I assume baseImageName/Tag will itself eventually come from an 'ImageParams' type.", "author": "tbarnes-us", "createdAt": "2020-03-28T02:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NDkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwMzkwNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399903906", "bodyText": "@markxnelson it does make the logic clearer to start a new line before every dot.", "author": "doxiao", "createdAt": "2020-03-30T03:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NDkzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNDI3OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399904279", "bodyText": "@tbarnes-us We could add an \"ImageParams\" if/when the need comes.", "author": "doxiao", "createdAt": "2020-03-30T03:05:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NDkzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399585172", "bodyText": "this is ok for now, but i might ask to make it statics rather than passing around objects when i see you use this in  a test", "author": "markxnelson", "createdAt": "2020-03-27T23:44:41Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/TestActions.java", "diffHunk": "@@ -38,6 +44,37 @@ public static String createUniqueNamespace() {\n         return Namespace.createUniqueNamespace();\n     }\n \n-    // etc...\n+    // ------------------------ Docker image  -------------------------\n+\n+    public static boolean createMIIImage(\n+        String baseImageName, \n+        String imageTag,\n+        List<String> modelFiles,\n+        List<String> modelVariableFiles,\n+        List<String> modelArchiveFiles,\n+        String wdtVersion,\n+        String domainType) {\n+  \n+    \treturn \n+            new WebLogicImageTool()", "originalCommit": "366b647339557c3a9bbe35448ac6899e85964f8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDU4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399610581", "bodyText": "I guess I was thinking of something different.  I would have thought createMIIImage would take a WITParams() as a parameter.   It wouldn't have a signature with all of the params listed out - instead WITParams would be built in some central location, or generated from some central set of settings for the suite, and passed in.", "author": "tbarnes-us", "createdAt": "2020-03-28T02:56:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTY3MTEzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399671132", "bodyText": "yes, some reusable object with a fluent api would make a nice param to this method", "author": "markxnelson", "createdAt": "2020-03-28T14:56:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwNTc1Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399905752", "bodyText": "I think the problem may be the additional layer at the WebLogicImageTool level. One solution is to remove the WITParams, and use the WebLogicImageTool as the reusable object with the fluent api that is in WITParams now, as well as the updateImage method that WebLogicImageTool currently has.", "author": "doxiao", "createdAt": "2020-03-30T03:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkxMTU1NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399911554", "bodyText": "Then the TestActions will have a with() method that takes a WebLogicImageTool object. A test code of creating a MII image would look like the following.\nWebLogicImageTool wit = new WebLogicImageTool()\n.imageName(\"xxx)\n.tag(\"yyy\")\nand etc;\nnew TestActions().with(wit).createMIIImage().", "author": "doxiao", "createdAt": "2020-03-30T03:41:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkxMjA2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399912068", "bodyText": "I can give it a try and see if it looks better.", "author": "doxiao", "createdAt": "2020-03-30T03:44:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTk3OTE4Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399979183", "bodyText": "I think it is easier to just stick with the current approach and change the parameters into a WITParams.", "author": "doxiao", "createdAt": "2020-03-30T07:28:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NTAxNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400145015", "bodyText": "no - we would not instantiate TestActions - all of the methods are statics, so you would import static TestActions and then say:\nwith(wit).createMIIImage()", "author": "markxnelson", "createdAt": "2020-03-30T12:17:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE3Njk0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400176949", "bodyText": "I think what I eventually did is similar to what you suggested - TestActions does the following.\nnew WebLogicImageTool().with(wit).updateImage().", "author": "doxiao", "createdAt": "2020-03-30T13:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIwODExMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400208113", "bodyText": "if I understand correctly, you two are close.  But, I think Mark is suggesting an overloaded \"with()\" method where the argument decides the operation.  In this case \"with(WebLogicImageTool)\" finds the ImageTool with statement, and since the TestActions is a static import and all \"with()\" methods are static, it looks more like with(wit).createMIIImage().  I think you are mostly on the same page here, so approving.", "author": "ddsharpe", "createdAt": "2020-03-30T13:51:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTU4NTE3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399610180", "bodyText": "IMO, ideally version/location would itself come from a global type - the net idea is that at the beginning of a suite, all such settings are defined once (and only once) and then passed around.  Like the 'packet' object in the operator code.", "author": "tbarnes-us", "createdAt": "2020-03-28T02:52:26Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/actions/TestActions.java", "diffHunk": "@@ -38,6 +44,37 @@ public static String createUniqueNamespace() {\n         return Namespace.createUniqueNamespace();\n     }\n \n-    // etc...\n+    // ------------------------ Docker image  -------------------------\n+\n+    public static boolean createMIIImage(\n+        String baseImageName, \n+        String imageTag,\n+        List<String> modelFiles,\n+        List<String> modelVariableFiles,\n+        List<String> modelArchiveFiles,\n+        String wdtVersion,\n+        String domainType) {\n+  \n+    \treturn \n+            new WebLogicImageTool()\n+                .with(new WITParams()\n+                     .baseName(baseImageName).tag(imageTag).modelFiles(modelFiles)\n+                     .modelVariableFiles(modelVariableFiles).modelArchiveFiles(modelArchiveFiles)\n+                     .wdtVersion(wdtVersion).domainType(domainType)).updateImage();\n+    }\n+ \n+ \n+    // ------------------------ Installer  -------------------------\n+\n+    public static boolean verifyAndInstallWIT(String version, String location) {", "originalCommit": "366b647339557c3a9bbe35448ac6899e85964f8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTkwODEyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r399908121", "bodyText": "I hope we only need to do download/install of WIT and WDT binary once for the entire integration test suite. We could make them static constants, but parameterizing them makes it a little easier for the test suite to test a newer version (when the time comes).", "author": "doxiao", "createdAt": "2020-03-30T03:24:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDE0NTYyNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400145624", "bodyText": "i think it makes sense to download all of the prereqs up front (in the jenkins job) before we start running the tests - e.g. WIT, WDT, whatever installer/patches we need, helm, kubectl, etc.", "author": "markxnelson", "createdAt": "2020-03-30T12:18:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIwOTcxMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400209710", "bodyText": "Let's put the prerequisite downloads in the Jenkins file.  I think it will be much easier to maintain.  And, if we switch to another environment like running in Docker containers with the software pre-positioned, the change is very minor.", "author": "ddsharpe", "createdAt": "2020-03-30T13:54:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDIyNTAxOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400225019", "bodyText": "Agreed. We'll need to have a way for the test code to get the location of WIT and WDT binary; the MII use case needs to run WIT to generate a nee image that contains the WDT binary.", "author": "doxiao", "createdAt": "2020-03-30T14:14:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI4NDk3MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400284970", "bodyText": "Its easy for the Jenkinsfile to download the bits, extract them, and then put the folder/path in an environment variable.  Will that work?", "author": "ddsharpe", "createdAt": "2020-03-30T15:29:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMyNTM4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400325387", "bodyText": "@ddsharpe I think we shjould avoid depending on Jenkins for any critical part of the flow.  It should be possible to get a test up and running, with a single mvn call, in any basic WKO env. We shouldn't need to install Jenkins to get it working IMO - unless installing Jenkins and setting it up is itself one step?", "author": "tbarnes-us", "createdAt": "2020-03-30T16:25:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDMyNTc1OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400325759", "bodyText": "So would relying on a Jenkinsfile also rely on Jenkins being installed?", "author": "tbarnes-us", "createdAt": "2020-03-30T16:25:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3MjM3Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400372376", "bodyText": "Derek and I have agreed to disagree off-line - and are looking for other opinions.\nEven if we end up supporting setting up WDT/WIT via a jenkinsfile.   I'd minimally also like to see (1) single or at most two places that 'own' setting up WDT/WIT, (2) target/scope install location of WDT/WIT to the the test suite (cleaned up when test suite is deleted - saved if along with test results if test suite results are saved), (3) it must be very easy to get a test running stand-alone (if missing the test infra should get it - or at least a single command for setting up prior to test suite).", "author": "tbarnes-us", "createdAt": "2020-03-30T17:36:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM3OTk5MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1512#discussion_r400379991", "bodyText": "If we offload the WIT/WDT download  responsibly to Jenkin Script, then to run the test locally we need to add  a similar script to the operator github project. There may be out-of-sync  issue between  Jenkin and a local copy", "author": "anpanigr", "createdAt": "2020-03-30T17:48:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTYxMDE4MA=="}], "type": "inlineReview"}, {"oid": "90813e4ad1ea2396a45bfa3f864d15217223225f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90813e4ad1ea2396a45bfa3f864d15217223225f", "message": "Minor fix of the formating\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-03-30T03:26:03Z", "type": "commit"}, {"oid": "8693494ab40a0d757e4fd6392f8c1dfe2962b545", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8693494ab40a0d757e4fd6392f8c1dfe2962b545", "message": "Address review comment\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-03-30T07:51:28Z", "type": "commit"}, {"oid": "af18481d8d19d6aba0107f56cd749ff5cf539a5b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/af18481d8d19d6aba0107f56cd749ff5cf539a5b", "message": "Merge branch 'mii-new-integration-tests' into install-wit-actions-interface", "committedDate": "2020-03-30T17:54:43Z", "type": "commit"}]}