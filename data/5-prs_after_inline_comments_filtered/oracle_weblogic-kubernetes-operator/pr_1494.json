{"pr_number": 1494, "pr_title": "Debug it", "pr_createdAt": "2020-03-24T22:39:50Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494", "timeline": [{"oid": "148bffe69f6f3deb150254c1485bcee1eb9f3d46", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/148bffe69f6f3deb150254c1485bcee1eb9f3d46", "message": "adding more debug msgs to check server/ingress state", "committedDate": "2020-03-06T00:24:53Z", "type": "commit"}, {"oid": "d15d73d3c90290adb120a5b153a72b9d9530496f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d15d73d3c90290adb120a5b153a72b9d9530496f", "message": "use execommand", "committedDate": "2020-03-06T06:09:36Z", "type": "commit"}, {"oid": "07f6e234d88fa281e6bb804bd129f612e0df6d90", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/07f6e234d88fa281e6bb804bd129f612e0df6d90", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into debug-it", "committedDate": "2020-03-06T06:11:05Z", "type": "commit"}, {"oid": "0db31222c174bb8eda579b1a47c846c939f634b0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0db31222c174bb8eda579b1a47c846c939f634b0", "message": "adding more debug", "committedDate": "2020-03-07T01:12:31Z", "type": "commit"}, {"oid": "84612598b7e01d14b8b4e29a8f8cd8d4540054c7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/84612598b7e01d14b8b4e29a8f8cd8d4540054c7", "message": "add get ingress", "committedDate": "2020-03-07T05:57:58Z", "type": "commit"}, {"oid": "a0efaa971fb932579eae9d361b83998ce65a9d91", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a0efaa971fb932579eae9d361b83998ce65a9d91", "message": "adding more debug", "committedDate": "2020-03-10T00:23:49Z", "type": "commit"}, {"oid": "2c9c3bb4795b69425c133c1d8fc66e9f7a3c84a6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2c9c3bb4795b69425c133c1d8fc66e9f7a3c84a6", "message": "generate server pod logs", "committedDate": "2020-03-11T01:48:22Z", "type": "commit"}, {"oid": "61779fc229d78da9f1aa8e0b53844f7fa242af93", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/61779fc229d78da9f1aa8e0b53844f7fa242af93", "message": "generate server pod logs", "committedDate": "2020-03-11T03:18:11Z", "type": "commit"}, {"oid": "a307e50ac3e86a16b6f796a8127b556d8a880f09", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a307e50ac3e86a16b6f796a8127b556d8a880f09", "message": "fix kubectl logs command", "committedDate": "2020-03-11T22:48:40Z", "type": "commit"}, {"oid": "7ac97c3df1691c9e15f6f5cc26cd7cbfe04a86d7", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7ac97c3df1691c9e15f6f5cc26cd7cbfe04a86d7", "message": "adding sleep time before deploying app", "committedDate": "2020-03-12T05:25:58Z", "type": "commit"}, {"oid": "9087bae36f14e15349da55bebd3d36462292eb3a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9087bae36f14e15349da55bebd3d36462292eb3a", "message": "adding debug statements", "committedDate": "2020-03-12T16:32:04Z", "type": "commit"}, {"oid": "4bbd7cfcb5d3612543c5fb7e6e1ff61bf47f8a81", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4bbd7cfcb5d3612543c5fb7e6e1ff61bf47f8a81", "message": "wait till the pods in the second cluster is running", "committedDate": "2020-03-12T18:03:54Z", "type": "commit"}, {"oid": "eee280aed7cbe01afa06d72d1203f4fbdc8aab0e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/eee280aed7cbe01afa06d72d1203f4fbdc8aab0e", "message": "fixing error", "committedDate": "2020-03-12T21:43:40Z", "type": "commit"}, {"oid": "411c6dba9e6922ea00b0009d4ff5865ba17fd5bf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/411c6dba9e6922ea00b0009d4ff5865ba17fd5bf", "message": "check if pod is ready", "committedDate": "2020-03-13T16:22:37Z", "type": "commit"}, {"oid": "6b368087c56be444c250101a2c1151423edf2b41", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6b368087c56be444c250101a2c1151423edf2b41", "message": "restart the data cluster before deploying app", "committedDate": "2020-03-15T02:25:46Z", "type": "commit"}, {"oid": "870ddb6252e5b2acd059ef85a019e7a7f887d363", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/870ddb6252e5b2acd059ef85a019e7a7f887d363", "message": "fix cluster name", "committedDate": "2020-03-15T13:48:53Z", "type": "commit"}, {"oid": "bd49ee386c5465f1765ef5334d571cac7d18409f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/bd49ee386c5465f1765ef5334d571cac7d18409f", "message": "more debug statements", "committedDate": "2020-03-15T22:42:59Z", "type": "commit"}, {"oid": "3d03607bcec1ebb455d76b5ed61d668ed963a5d1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3d03607bcec1ebb455d76b5ed61d668ed963a5d1", "message": "modify deploying via rest API to synchronous mode", "committedDate": "2020-03-18T00:47:15Z", "type": "commit"}, {"oid": "f7d5a180131214cc4762757d12f50ec6ade95316", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f7d5a180131214cc4762757d12f50ec6ade95316", "message": "commenting out restarting the cluster", "committedDate": "2020-03-18T01:11:18Z", "type": "commit"}, {"oid": "38f35f61a9c5e4b1ef2e3535e06e7a3949b583aa", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/38f35f61a9c5e4b1ef2e3535e06e7a3949b583aa", "message": "remove some code added to debug failure in jenkins", "committedDate": "2020-03-18T23:53:08Z", "type": "commit"}, {"oid": "300cab0da112f033a1c2ba60c74eaf9497985043", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/300cab0da112f033a1c2ba60c74eaf9497985043", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into debug-it", "committedDate": "2020-03-18T23:58:11Z", "type": "commit"}, {"oid": "8dfc5ac6996d1c6cb3e140333b76e51e3aea56e5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8dfc5ac6996d1c6cb3e140333b76e51e3aea56e5", "message": "undo an inadvertent change to build.xml", "committedDate": "2020-03-19T13:33:08Z", "type": "commit"}, {"oid": "32a65cc4f899bd04f2628f08594fc827d3ae1f9b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/32a65cc4f899bd04f2628f08594fc827d3ae1f9b", "message": "enabling deployment debug flags", "committedDate": "2020-03-23T15:19:23Z", "type": "commit"}, {"oid": "85218205dbe569ab66947fcce3596ac00514a0ff", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/85218205dbe569ab66947fcce3596ac00514a0ff", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into debug-it", "committedDate": "2020-03-23T16:57:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDI1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397564258", "bodyText": "typo", "author": "markxnelson", "createdAt": "2020-03-25T01:49:31Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -228,6 +243,12 @@ private void createDomainAndDeployApp(Map<String, Object> domainMap, String doma\n     domain = null;\n     domain = TestUtils.createDomain(domainMap);\n     domain.verifyDomainCreated();\n+ \n+    // The above command only tests that the pod from the 1st cluster is Running (1/1)\n+    // So, checking the MS pod of the other cluster inidvidually here.", "originalCommit": "85218205dbe569ab66947fcce3596ac00514a0ff", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDM1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397564357", "bodyText": "does this need to be in a try/catch @rjeberhard ?", "author": "markxnelson", "createdAt": "2020-03-25T01:49:55Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -238,6 +259,13 @@ private void createDomainAndDeployApp(Map<String, Object> domainMap, String doma\n       domainUid + \"-new-managed-server2\",\n     };\n     verifyServersStatus(domain, pods, domainUid);\n+    Thread.sleep(60 * 1000);", "originalCommit": "85218205dbe569ab66947fcce3596ac00514a0ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4MzY3OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397883678", "bodyText": "There must be a try/catch at a higher level... yes, the method signature throws Exception.  This is okay if on InterruptedException it's correct that the test should fail.", "author": "rjeberhard", "createdAt": "2020-03-25T14:10:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4ODc0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397888744", "bodyText": "Is the sleep really needed here? If not remove or reduce? we usually don't put hard sleep's like this in test, instead wait for a condition in a loop with small sleep time.", "author": "vanajamukkara", "createdAt": "2020-03-25T14:17:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDM1Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExODk2Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398118963", "bodyText": "Will remove the sleep. Will not add try/catch. reason - what Ryan said.", "author": "bhavaniravichandran", "createdAt": "2020-03-25T19:36:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NDM1Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397565021", "bodyText": "feels like we should be checking the returned values in this block of code, not just printing them out", "author": "markxnelson", "createdAt": "2020-03-25T01:52:18Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -373,4 +405,62 @@ private ExecResult clearCache() throws Exception {\n     return result;\n   }\n \n+  private void restartCluster(String domainUid) throws Exception {\n+    String podName = domainUid + \"-new-managed-server1\";\n+\n+    String restartTmpDir = getResultDir() + \"/restarttemp\";\n+    Files.createDirectories(Paths.get(restartTmpDir));\n+    \n+    LoggerHelper.getLocal().log(Level.INFO, \"created restart temp dir\");\n+\n+    String originalYaml =\n+            getUserProjectsDir()\n+                + \"/weblogic-domains/\"\n+                + domain.getDomainUid()\n+                + \"/domain.yaml\";\n+    \n+    // Modify the original domain yaml to include restartVersion in admin server node\n+    DomainCrd crd = new DomainCrd(originalYaml);\n+    Map<String, Object> cluster = new HashMap();\n+    cluster.put(\"restartVersion\", \"v1.1\");\n+    crd.addObjectNodeToCluster(\"dataCluster\", cluster);\n+    String modYaml = crd.getYamlTree();\n+    LoggerHelper.getLocal().log(Level.INFO, modYaml);\n+\n+    // Write the modified yaml to a new file\n+    Path path = Paths.get(restartTmpDir, \"restart.cluster.yaml\");\n+    LoggerHelper.getLocal().log(Level.INFO, \"Path of the modified domain.yaml :{0}\", path.toString());\n+    Charset charset = StandardCharsets.UTF_8;\n+    Files.write(path, modYaml.getBytes(charset));\n+\n+    // Apply the new yaml to update the domain crd\n+    LoggerHelper.getLocal().log(Level.INFO, \"kubectl apply -f {0}\", path.toString());\n+    ExecResult exec = TestUtils.exec(\"kubectl apply -f \" + path.toString());\n+    LoggerHelper.getLocal().log(Level.INFO, exec.stdout());\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying if the cluster is restarted\");\n+\n+    TestUtils.checkPodReady(domainUid + \"-new-managed-server1\", domainNS1);\n+    TestUtils.checkPodReady(domainUid + \"-new-managed-server2\", domainNS1);\n+\n+  }\n+\n+  private void verifyServersIngressRunning() throws Exception {\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying server status\");\n+    domain.verifyServersReady();\n+    LoggerHelper.getLocal().log(Level.INFO, \"Verifying traefik and ingress created for the domain\");\n+    LoggerHelper.getLocal().log(Level.INFO,\n+        TestUtils.exec(\"helm status traefik-operator\").stdout(), true);\n+    LoggerHelper.getLocal().log(Level.INFO,", "originalCommit": "85218205dbe569ab66947fcce3596ac00514a0ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4NDg1Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397884852", "bodyText": "Does TestUtils.exec check the return value?  I agree that it's not obvious how the test code handles a failed helm command.", "author": "rjeberhard", "createdAt": "2020-03-25T14:12:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5NjMxNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397896316", "bodyText": "This method was added while I was debugging the test failure initially, later Bhavani took over the branch. It was not meant to get it merged as is.", "author": "vanajamukkara", "createdAt": "2020-03-25T14:26:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAzNjYyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398036621", "bodyText": "I left it there thinking that more debug is good. Was going to delete this when I edit this file to remove the debug flags after we finally resolve the issue. I will remove it now.", "author": "bhavaniravichandran", "createdAt": "2020-03-25T17:26:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExOTU5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398119593", "bodyText": "Already checking the status of all the servers before trying to deploy the app.", "author": "bhavaniravichandran", "createdAt": "2020-03-25T19:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU2NTAyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4NTUyNg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397885526", "bodyText": "You could just make the list a set.", "author": "rjeberhard", "createdAt": "2020-03-25T14:13:18Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/utils/LoadBalancer.java", "diffHunk": "@@ -190,7 +190,12 @@ private String getKubernetesNamespaceToUpdate(String domainNamespace) throws Exc\n         String trimmed = debracketed.replaceAll(\"\\\\s+\", \"\");\n         // now have an ArrayList containing \"foo\", \"bar\" and \"baz\"\n         ArrayList<String> list = new ArrayList<String>(Arrays.asList(trimmed.split(\",\")));\n-        list.add(domainNamespace);\n+        if (!list.contains(domainNamespace)) {", "originalCommit": "85218205dbe569ab66947fcce3596ac00514a0ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODExNzg3NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398117874", "bodyText": "This file was not part of my PR. I don't want to make changes to this file without running all the tests as it is a common file used by all the tests - worried about breaking tests. I can maybe take it up as separate work to fix this after discussing with Vanaja.", "author": "bhavaniravichandran", "createdAt": "2020-03-25T19:34:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg4NTUyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5MDg5NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r397890894", "bodyText": "can you make this method generic, so that if we have to use from other test classes it can be used? does the other multi cluster test you are debugging needs to restart the cluster as well?", "author": "vanajamukkara", "createdAt": "2020-03-25T14:20:20Z", "path": "integration-tests/src/test/java/oracle/kubernetes/operator/ItManagedCoherence.java", "diffHunk": "@@ -373,4 +405,62 @@ private ExecResult clearCache() throws Exception {\n     return result;\n   }\n \n+  private void restartCluster(String domainUid) throws Exception {", "originalCommit": "85218205dbe569ab66947fcce3596ac00514a0ff", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODAzOTQwMA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398039400", "bodyText": "restarting the cluster resolves the issue, but not sure it is the right solution. Not calling this method now, but did not want to delete it in case we decide that is what needs to be done.", "author": "bhavaniravichandran", "createdAt": "2020-03-25T17:30:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5MDg5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODE4NTM3Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1494#discussion_r398185372", "bodyText": "Deleted the method. Will add it later if need to.", "author": "bhavaniravichandran", "createdAt": "2020-03-25T21:36:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Nzg5MDg5NA=="}], "type": "inlineReview"}, {"oid": "b5f2f1063b4ee91ee90b5fd79e4dc26912543173", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b5f2f1063b4ee91ee90b5fd79e4dc26912543173", "message": "update based on review comments", "committedDate": "2020-03-25T21:32:57Z", "type": "commit"}, {"oid": "e9d1d32c444cd1eb710b7117e3ab640c9e8bd745", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e9d1d32c444cd1eb710b7117e3ab640c9e8bd745", "message": "fix curl command", "committedDate": "2020-03-26T01:30:06Z", "type": "commit"}]}