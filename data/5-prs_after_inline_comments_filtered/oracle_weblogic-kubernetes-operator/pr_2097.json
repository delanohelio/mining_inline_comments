{"pr_number": 2097, "pr_title": "OWLS-72816 Generate event and status when operator can't scale cluster past maximum", "pr_createdAt": "2020-12-14T16:59:33Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097", "timeline": [{"oid": "be30b7269806047cb867af4b96849f6b1b19d03b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/be30b7269806047cb867af4b96849f6b1b19d03b", "message": "create event and update domain status condition when replicas value is not valid for the weblogic cluster", "committedDate": "2020-12-10T22:47:33Z", "type": "commit"}, {"oid": "e594ab64aa5c668981cde07f2b51193a126752d2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e594ab64aa5c668981cde07f2b51193a126752d2", "message": "update domain events doc with InvalidReplicasValue event", "committedDate": "2020-12-10T22:52:40Z", "type": "commit"}, {"oid": "64ca6f80fb64690280264b68b9bf38a7f0bc4738", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/64ca6f80fb64690280264b68b9bf38a7f0bc4738", "message": "containsServer in WlsDomainConfig should return true for clustered servers", "committedDate": "2020-12-11T17:29:59Z", "type": "commit"}, {"oid": "c15bff678e82d38071fe645c88e9411fc825cd27", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c15bff678e82d38071fe645c88e9411fc825cd27", "message": "misc code/test cleanup", "committedDate": "2020-12-11T18:14:29Z", "type": "commit"}, {"oid": "e1584a9dcae3fa5f07740a9540b66596f4bc9204", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e1584a9dcae3fa5f07740a9540b66596f4bc9204", "message": "Merge branch 'develop' into owls72816", "committedDate": "2020-12-11T18:43:37Z", "type": "commit"}, {"oid": "7b84da5b8c9f1bad1e29342d0330a2c2c11362b6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7b84da5b8c9f1bad1e29342d0330a2c2c11362b6", "message": "fix failing test after merge from develop", "committedDate": "2020-12-11T19:00:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r542556561", "bodyText": "Maybe this is a naive comment but it looks like this change is special case handling a particular validation warning. Would it be possible and sensible to treat all validation warnings using the same event instead of having a special event for this particular validation?  E.g. have a generic 'validation' event and generic validation warning handling that handles all validation failures...", "author": "tbarnes-us", "createdAt": "2020-12-14T17:12:26Z", "path": "operator/src/main/java/oracle/kubernetes/operator/steps/ManagedServersUpStep.java", "diffHunk": "@@ -286,13 +300,26 @@ private void logIfReplicasLessThanClusterServersMin(WlsClusterConfig clusterConf\n                 domain.getReplicaCount(clusterName),\n                 clusterConfig.getMinDynamicClusterSize(),\n                 clusterName);\n+        String message = LOGGER.formatMessage(MessageKeys.REPLICAS_LESS_THAN_TOTAL_CLUSTER_SERVER_COUNT,\n+            domain.getReplicaCount(clusterName),\n+            clusterConfig.getMinDynamicClusterSize(),\n+            clusterName);\n+        addInvalidReplicasValueEventAndWarning(message);", "originalCommit": "7b84da5b8c9f1bad1e29342d0330a2c2c11362b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU2NDMxNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r542564314", "bodyText": "Good suggestion. Can we get more feedback from other reviewers?", "author": "alai8", "createdAt": "2020-12-14T17:22:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU3MDExOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r542570119", "bodyText": "@rjeberhard @doxiao ^^^", "author": "tbarnes-us", "createdAt": "2020-12-14T17:30:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQ0MTQ0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r544441444", "bodyText": "To follow the existing pattern, I think it is better to have a generic event reason, say DomainValidationError, for all the events related to validation issues, and put the details in the event message (as this PR has already done).", "author": "doxiao", "createdAt": "2020-12-16T16:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDUyMDYxNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r544520617", "bodyText": "Thanks for the feedback. I have replaced InvalidReplicasValueError with DomainValidationError. and events would look like:\n5s          Warning   DomainValidationError       domain/domain1   Validation error in domain resource domain1: Replica request of 2,020 exceeds the maximum dynamic server count of 2 configured for cluster cluster-1\n\n9s          Warning   DomainValidationError       domain/domain1   Validation error in domain resource domain1: Replica request of 0 less than the minimum dynamic server count of 1 configured for cluster cluster-1", "author": "alai8", "createdAt": "2020-12-16T18:19:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDUzNTI1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r544535257", "bodyText": "Does this pull cover all validation errors now? Have you tested this out?", "author": "tbarnes-us", "createdAt": "2020-12-16T18:41:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTQ5MDA4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r545490081", "bodyText": "I updated ValidateDomainTopologyStep and create event for validation warnings from that class in the latest change, such as:\n 9s          Warning   DomainValidationError       domain/domain1   Validation error in domain resource domain1: Managed Server 'managed-server1234' specified in the domain resource does not exist in the WebLogic domain home configuration.", "author": "alai8", "createdAt": "2020-12-18T00:16:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTkwNzY5OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2097#discussion_r545907699", "bodyText": "Great!", "author": "tbarnes-us", "createdAt": "2020-12-18T15:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MjU1NjU2MQ=="}], "type": "inlineReview"}, {"oid": "3ee212dd24186ade3870263bb74a9c4b57083baa", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3ee212dd24186ade3870263bb74a9c4b57083baa", "message": "Merge branch 'develop' into owls72816", "committedDate": "2020-12-15T00:19:50Z", "type": "commit"}, {"oid": "7f62cb71326a1280020dade1f99311c5efc0df97", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7f62cb71326a1280020dade1f99311c5efc0df97", "message": "Merge branch 'develop' into owls72816", "committedDate": "2020-12-16T16:32:57Z", "type": "commit"}, {"oid": "690c36f7d0e1f29301bde29dce7ffa578db9d13d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/690c36f7d0e1f29301bde29dce7ffa578db9d13d", "message": "rename InvalidReplicasValue event to DomainValidationError event", "committedDate": "2020-12-16T18:12:23Z", "type": "commit"}, {"oid": "1c8ad48f7ea2cfc5526c3505960a417e9fd5a5a0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1c8ad48f7ea2cfc5526c3505960a417e9fd5a5a0", "message": "create event for validation warnings in ValidateDomainTopologyStep.", "committedDate": "2020-12-18T00:05:23Z", "type": "commit"}, {"oid": "b6db8a4a765da6f40644a41d1cff1c7242fd3f41", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b6db8a4a765da6f40644a41d1cff1c7242fd3f41", "message": "update with example of new DomainValidationError event", "committedDate": "2020-12-18T00:06:09Z", "type": "commit"}, {"oid": "372b0fcb45c2822f3a52425fbdf908a9fbf7fdd2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/372b0fcb45c2822f3a52425fbdf908a9fbf7fdd2", "message": "Merge branch 'develop' into owls72816", "committedDate": "2020-12-18T00:07:00Z", "type": "commit"}]}