{"pr_number": 2053, "pr_title": "Added support for domainOnPV using NFS in Oke cluster", "pr_createdAt": "2020-11-17T01:35:05Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053", "timeline": [{"oid": "38f2327bc1aa26e38e1ba0b814dea8647e559cd6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/38f2327bc1aa26e38e1ba0b814dea8647e559cd6", "message": "added nfs", "committedDate": "2020-10-30T23:01:15Z", "type": "commit"}, {"oid": "ff2ebe7b04edbc409b6a7de51538b31802a5970a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ff2ebe7b04edbc409b6a7de51538b31802a5970a", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-02T22:07:06Z", "type": "commit"}, {"oid": "b7f013ffefc76ee243d1ec481bda75f1ff78b3d0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b7f013ffefc76ee243d1ec481bda75f1ff78b3d0", "message": "added antiaffity", "committedDate": "2020-11-03T00:09:05Z", "type": "commit"}, {"oid": "733c9c985274f8d12ff6a2f3c16c0d67e9dbed4f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/733c9c985274f8d12ff6a2f3c16c0d67e9dbed4f", "message": "added syncronized", "committedDate": "2020-11-03T00:33:43Z", "type": "commit"}, {"oid": "423edbcf71fe7cf940990e9b5406b3d0f2b51e2c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/423edbcf71fe7cf940990e9b5406b3d0f2b51e2c", "message": "fixed typo", "committedDate": "2020-11-03T01:50:26Z", "type": "commit"}, {"oid": "443247aa28ef3de1fd14370e37b496435d2cc2d2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/443247aa28ef3de1fd14370e37b496435d2cc2d2", "message": "fixed typo1", "committedDate": "2020-11-03T02:08:32Z", "type": "commit"}, {"oid": "413db648f5de0358da36ac05a391b0b9293af104", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/413db648f5de0358da36ac05a391b0b9293af104", "message": "fixed domain crd for itpodtemplate", "committedDate": "2020-11-03T23:56:06Z", "type": "commit"}, {"oid": "0282e7d3468dafd55ce41331b95a5976a083d3c6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0282e7d3468dafd55ce41331b95a5976a083d3c6", "message": "style", "committedDate": "2020-11-04T01:48:43Z", "type": "commit"}, {"oid": "d822469592757b7ee6ced7a4b0c72c40441f54e2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d822469592757b7ee6ced7a4b0c72c40441f54e2", "message": "added storageclass to pv", "committedDate": "2020-11-04T01:55:22Z", "type": "commit"}, {"oid": "2872b8fe6042c2757e8f557e2a5a9a800e772a0a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2872b8fe6042c2757e8f557e2a5a9a800e772a0a", "message": "added storageclass to pvc", "committedDate": "2020-11-04T02:12:19Z", "type": "commit"}, {"oid": "88b9289980bfecaecf2142966ba1dcc279ae62e0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/88b9289980bfecaecf2142966ba1dcc279ae62e0", "message": "added storageclass to pvc1", "committedDate": "2020-11-04T02:15:26Z", "type": "commit"}, {"oid": "dfdd43f8492558b523f9260243ceda468c14a3b6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dfdd43f8492558b523f9260243ceda468c14a3b6", "message": "style", "committedDate": "2020-11-04T16:49:56Z", "type": "commit"}, {"oid": "22e82cee2304d7b248b9a2ba281302df135b6d25", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/22e82cee2304d7b248b9a2ba281302df135b6d25", "message": "fixed hostpath", "committedDate": "2020-11-04T19:28:15Z", "type": "commit"}, {"oid": "163f32519d22eed49a4f57cbf767d61c6409f98f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/163f32519d22eed49a4f57cbf767d61c6409f98f", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-04T20:55:40Z", "type": "commit"}, {"oid": "173736a79e87c1546c88c29f0b08ca8bdf060772", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/173736a79e87c1546c88c29f0b08ca8bdf060772", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-05T20:14:11Z", "type": "commit"}, {"oid": "5a9072f8cfd0c6c6f8716bc75cdf798004daec58", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5a9072f8cfd0c6c6f8716bc75cdf798004daec58", "message": "added support for domain job fix-pvc for oke", "committedDate": "2020-11-05T20:42:30Z", "type": "commit"}, {"oid": "14f9c81630e4e9239650913259cae59872a205b8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/14f9c81630e4e9239650913259cae59872a205b8", "message": "merge develop and remove antiaffinity", "committedDate": "2020-11-09T18:28:18Z", "type": "commit"}, {"oid": "b3c83129c0f1d1c893542dca94ad8c48f1f5f297", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b3c83129c0f1d1c893542dca94ad8c48f1f5f297", "message": "added nfs to pv", "committedDate": "2020-11-09T20:24:31Z", "type": "commit"}, {"oid": "a86bc6acdc0782bf88123fb2c4f057b814eb487c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a86bc6acdc0782bf88123fb2c4f057b814eb487c", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-10T01:15:10Z", "type": "commit"}, {"oid": "b4577ad0c41ef248799aaac484a58cb50f22b4bb", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/b4577ad0c41ef248799aaac484a58cb50f22b4bb", "message": "added fix for antiaffinity", "committedDate": "2020-11-10T01:20:02Z", "type": "commit"}, {"oid": "e1c2e8188cc0ef7178fdb109e273bb4dccf39cdf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e1c2e8188cc0ef7178fdb109e273bb4dccf39cdf", "message": "fixed pv creation", "committedDate": "2020-11-10T01:31:43Z", "type": "commit"}, {"oid": "8d32fee960962bcd2523653ff6367fd5713a80f0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8d32fee960962bcd2523653ff6367fd5713a80f0", "message": "fixed merge conflict", "committedDate": "2020-11-10T18:51:12Z", "type": "commit"}, {"oid": "e15ea64f56919f6ef2e5d3df122e1b86e9098460", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e15ea64f56919f6ef2e5d3df122e1b86e9098460", "message": "added terraform config", "committedDate": "2020-11-12T22:15:05Z", "type": "commit"}, {"oid": "0b3a14a01712af44ca3bb0500e81e9be6fc598a5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0b3a14a01712af44ca3bb0500e81e9be6fc598a5", "message": "merge", "committedDate": "2020-11-12T22:24:33Z", "type": "commit"}, {"oid": "92f97f62cd7b255ee211e89575172d8a6a5a0b6c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/92f97f62cd7b255ee211e89575172d8a6a5a0b6c", "message": "mt", "committedDate": "2020-11-13T01:09:06Z", "type": "commit"}, {"oid": "8371a1c96ff6b8218e946bd568516a535fbcd9af", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8371a1c96ff6b8218e946bd568516a535fbcd9af", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-13T19:36:29Z", "type": "commit"}, {"oid": "9c907dd79b01d3bbae122c1c3971444704849af2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9c907dd79b01d3bbae122c1c3971444704849af2", "message": "fixed mt", "committedDate": "2020-11-16T16:56:57Z", "type": "commit"}, {"oid": "5009849bc7bee73b9a6036c6d28dae2ddd6bbe1a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5009849bc7bee73b9a6036c6d28dae2ddd6bbe1a", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-16T16:57:03Z", "type": "commit"}, {"oid": "8860e91a5305830c5753e2477e9410785192a9f1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8860e91a5305830c5753e2477e9410785192a9f1", "message": "added copyrights", "committedDate": "2020-11-17T01:32:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4MDk5MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r525580991", "bodyText": "This code block is repeated several times. Can it be consolidated to a function somewhere?", "author": "rjeberhard", "createdAt": "2020-11-17T22:57:18Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMiiDomainModelInPV.java", "diffHunk": "@@ -340,14 +341,21 @@ private static V1Pod setupWebLogicPod(String namespace) {\n     createSecretForBaseImages(namespace);\n \n     final String podName = \"weblogic-pv-pod-\" + namespace;\n+    String argCommand = \"chown -R 1000:0 \" + modelMountPath;", "originalCommit": "8860e91a5305830c5753e2477e9410785192a9f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA4Mjk1NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r527082955", "bodyText": "consolidated as util method", "author": "marinakog", "createdAt": "2020-11-19T17:50:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4MDk5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4MTM3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r525581377", "bodyText": "Similarly, this code block is also repeated. Perhaps we need a class with utility methods to fix-up the PV and PVC for different environments.", "author": "rjeberhard", "createdAt": "2020-11-17T22:58:13Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/ItTwoDomainsLoadBalancers.java", "diffHunk": "@@ -941,25 +945,35 @@ private void createTwoDomainsOnPVUsingWlstAndVerify() {\n \n       // create persistent volume and persistent volume claims\n       Path pvHostPath = get(PV_ROOT, this.getClass().getSimpleName(), domainUid + \"-persistentVolume\");\n-\n-      logger.info(\"Creating PV directory {0}\", pvHostPath);\n-      assertDoesNotThrow(() -> deleteDirectory(pvHostPath.toFile()), \"deleteDirectory failed with IOException\");\n-      assertDoesNotThrow(() -> createDirectories(pvHostPath), \"createDirectories failed with IOException\");\n-\n+      if (!OKE_CLUSTER) {\n+        logger.info(\"Creating PV directory {0}\", pvHostPath);\n+        assertDoesNotThrow(() -> deleteDirectory(pvHostPath.toFile()), \"deleteDirectory failed with IOException\");\n+        assertDoesNotThrow(() -> createDirectories(pvHostPath), \"createDirectories failed with IOException\");\n+      }\n       V1PersistentVolume v1pv = new V1PersistentVolume()\n           .spec(new V1PersistentVolumeSpec()\n               .addAccessModesItem(\"ReadWriteMany\")\n-              .storageClassName(domainUid + \"-weblogic-domain-storage-class\")\n               .volumeMode(\"Filesystem\")\n               .putCapacityItem(\"storage\", Quantity.fromString(\"2Gi\"))\n-              .persistentVolumeReclaimPolicy(\"Retain\")\n-              .hostPath(new V1HostPathVolumeSource()\n-                  .path(pvHostPath.toString())))\n+              .persistentVolumeReclaimPolicy(\"Retain\"))\n           .metadata(new V1ObjectMetaBuilder()\n               .withName(pvName)\n               .build()\n               .putLabelsItem(\"weblogic.domainUid\", domainUid));\n \n+      if (OKE_CLUSTER) {", "originalCommit": "8860e91a5305830c5753e2477e9410785192a9f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA4MzA1Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r527083057", "bodyText": "consolidated as util method", "author": "marinakog", "createdAt": "2020-11-19T17:50:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTU4MTM3Nw=="}], "type": "inlineReview"}, {"oid": "26825e08a184457ec5fcc5725e87f66bb3e65d1e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/26825e08a184457ec5fcc5725e87f66bb3e65d1e", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-17T23:25:33Z", "type": "commit"}, {"oid": "e1effab17be06cb588e5be082936a575d375e704", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e1effab17be06cb588e5be082936a575d375e704", "message": "added fixpvc common util", "committedDate": "2020-11-18T01:40:21Z", "type": "commit"}, {"oid": "697d549f1cad0993d5728e2231b1f2ec12e7b21e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/697d549f1cad0993d5728e2231b1f2ec12e7b21e", "message": "style", "committedDate": "2020-11-18T01:51:50Z", "type": "commit"}, {"oid": "db2c56271c21b7a620db6837fcc849feb73c4cfa", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/db2c56271c21b7a620db6837fcc849feb73c4cfa", "message": "style1", "committedDate": "2020-11-18T04:26:16Z", "type": "commit"}, {"oid": "dcfe6309a8e40654392ae2028051d1fff9e97df2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dcfe6309a8e40654392ae2028051d1fff9e97df2", "message": "fixed chown command", "committedDate": "2020-11-18T17:24:21Z", "type": "commit"}, {"oid": "f0c0fdabec19e1eed6919d098c2f0a852b425616", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f0c0fdabec19e1eed6919d098c2f0a852b425616", "message": "fixed chown command1", "committedDate": "2020-11-18T17:41:56Z", "type": "commit"}, {"oid": "e30ef4e6fec68b0bb702365112a235bf0b8060a8", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e30ef4e6fec68b0bb702365112a235bf0b8060a8", "message": "consolidated pv and pvc creation for nfs and hostpath", "committedDate": "2020-11-18T20:22:07Z", "type": "commit"}, {"oid": "07957f8ebc5bdab2baae78ca487ab0e1d826425e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/07957f8ebc5bdab2baae78ca487ab0e1d826425e", "message": "style", "committedDate": "2020-11-18T23:45:07Z", "type": "commit"}, {"oid": "836cbae4ac408d398302292cc0cc4b8353cd3414", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/836cbae4ac408d398302292cc0cc4b8353cd3414", "message": "fixed owner change", "committedDate": "2020-11-19T06:36:03Z", "type": "commit"}, {"oid": "6c39941f921b56ce76e86e419f109807ddecdbce", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6c39941f921b56ce76e86e419f109807ddecdbce", "message": "fixed typos", "committedDate": "2020-11-19T17:33:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0MDE1Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r527240156", "bodyText": "Can't we have a suitable default for NFS_SERVER and FSS_DIR ?  We need this when OKE_CLUSTER is set to true.", "author": "anpanigr", "createdAt": "2020-11-19T22:16:11Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/TestConstants.java", "diffHunk": "@@ -265,6 +265,13 @@\n   //MySQL database constants\n   public static final String MYSQL_VERSION = \"5.6\";\n \n+  //OKE constants\n+  public static final boolean OKE_CLUSTER = Boolean.parseBoolean(Optional.ofNullable(System.getenv(\"OKE_CLUSTER\"))\n+      .orElse(\"false\"));\n+  public static final String NFS_SERVER = Optional.ofNullable(System.getenv(\"NFS_SERVER\"))\n+      .orElse(\"\");", "originalCommit": "6c39941f921b56ce76e86e419f109807ddecdbce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NzUzOQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r527247539", "bodyText": "no we can can't , it is created during runtime, since I create MountTarget at the same time as OKE cluster", "author": "marinakog", "createdAt": "2020-11-19T22:30:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0MDE1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NDQwMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r527244401", "bodyText": "We have similar method ( createPvAndPvc) with same name in ItMonitoringExporter.java.  Can we merge these two.", "author": "anpanigr", "createdAt": "2020-11-19T22:24:02Z", "path": "integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -2659,6 +2666,50 @@ public static void createPVPVCAndVerify(V1PersistentVolume v1pv,\n                 pvcName, namespace)));\n   }\n \n+  /**", "originalCommit": "6c39941f921b56ce76e86e419f109807ddecdbce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0OTA1OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/2053#discussion_r527249058", "bodyText": "I need to fix MonExporter separately, it requires more changes for prometheus and grafana pvs I will do it in different jira", "author": "marinakog", "createdAt": "2020-11-19T22:33:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI0NDQwMQ=="}], "type": "inlineReview"}, {"oid": "c8b51d44c2b8266652e1f274d17750ded064844e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c8b51d44c2b8266652e1f274d17750ded064844e", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into okefss", "committedDate": "2020-11-23T17:07:44Z", "type": "commit"}]}