{"pr_number": 1824, "pr_title": "Added restPort, https tests, extra cleanup for prom and grafana", "pr_createdAt": "2020-07-18T22:47:32Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824", "timeline": [{"oid": "599dc7f4d8f9ecea3b3aebd72c349acf10880632", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/599dc7f4d8f9ecea3b3aebd72c349acf10880632", "message": "added testcases for https and restport", "committedDate": "2020-07-15T18:35:16Z", "type": "commit"}, {"oid": "27d06c56fec194a5d9c488946d50f563f89f9b10", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/27d06c56fec194a5d9c488946d50f563f89f9b10", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-15T18:36:48Z", "type": "commit"}, {"oid": "51da7da1e76fcc33c7d30ae1741db10d1bcad719", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/51da7da1e76fcc33c7d30ae1741db10d1bcad719", "message": "changed norestport file", "committedDate": "2020-07-15T19:04:09Z", "type": "commit"}, {"oid": "8b9a04e8302db0d08e71c17e1891ecb5f3237458", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8b9a04e8302db0d08e71c17e1891ecb5f3237458", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-15T21:29:23Z", "type": "commit"}, {"oid": "76d0683b520b8545b62f1d40e404e3bb466a0f52", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/76d0683b520b8545b62f1d40e404e3bb466a0f52", "message": "fixed dependencies", "committedDate": "2020-07-16T14:42:27Z", "type": "commit"}, {"oid": "8791b8fdc0603ffc2e9f8c7e34dd084df48ff6f1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8791b8fdc0603ffc2e9f8c7e34dd084df48ff6f1", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-16T14:42:33Z", "type": "commit"}, {"oid": "3d86f4173c52c1324ef7efb7fb2446b738b8283a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3d86f4173c52c1324ef7efb7fb2446b738b8283a", "message": "fixed style", "committedDate": "2020-07-16T15:00:54Z", "type": "commit"}, {"oid": "25d78fbc557cb2c0106112942d7e246032bc396b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/25d78fbc557cb2c0106112942d7e246032bc396b", "message": "switched to master", "committedDate": "2020-07-17T18:38:56Z", "type": "commit"}, {"oid": "37e6d64d4455f2f370e2e3a4535158d51d3b4cc9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/37e6d64d4455f2f370e2e3a4535158d51d3b4cc9", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-17T18:39:02Z", "type": "commit"}, {"oid": "8c96fd3fa0b8ac71d5b1e9ba14d84392e4dc6c4d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8c96fd3fa0b8ac71d5b1e9ba14d84392e4dc6c4d", "message": "disable unittest build", "committedDate": "2020-07-17T19:46:22Z", "type": "commit"}, {"oid": "56517388955a24e8a3f98c6e88e91b5d83ba821e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/56517388955a24e8a3f98c6e88e91b5d83ba821e", "message": "fixed typo", "committedDate": "2020-07-17T21:54:01Z", "type": "commit"}, {"oid": "d77ed37c092e56df8f8b09002be7128bcc98d2c5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d77ed37c092e56df8f8b09002be7128bcc98d2c5", "message": "fixed typo", "committedDate": "2020-07-17T22:06:06Z", "type": "commit"}, {"oid": "dc4fafbbad95cc46ea35b8bda785941f425b08d3", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/dc4fafbbad95cc46ea35b8bda785941f425b08d3", "message": "added extra cleaning", "committedDate": "2020-07-17T22:42:10Z", "type": "commit"}, {"oid": "30f62c8221c36f2b0eff3166bebf407c1189b070", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/30f62c8221c36f2b0eff3166bebf407c1189b070", "message": "added cleanup", "committedDate": "2020-07-18T16:38:36Z", "type": "commit"}, {"oid": "743dec63ac3784bc0e67cc835f01834d19662a21", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/743dec63ac3784bc0e67cc835f01834d19662a21", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-18T16:38:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ1NjgyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r457456828", "bodyText": "Do we need to hard-code the string 1.1.2  ?", "author": "anpanigr", "createdAt": "2020-07-20T14:48:32Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMonitoringExporter.java", "diffHunk": "@@ -1107,35 +1198,81 @@ private static void installMonitoringExporter() {\n     monitoringExporterEndToEndDir = monitoringTemp + \"/samples/kubernetes/end2end/\";\n     String monitoringExporterVersion = Optional.ofNullable(System.getenv(\"MONITORING_EXPORTER_VERSION\"))\n         .orElse(MONITORING_EXPORTER_VERSION);\n+\n+    //adding ability to build monitoring exporter if branch is not master or version number does not match latest 1.1.2\n+    boolean toBuildMonitoringExporter = (!monitoringExporterBranch.equalsIgnoreCase(\"1.1.2\")", "originalCommit": "743dec63ac3784bc0e67cc835f01834d19662a21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMTUwNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r459021507", "bodyText": "currently the test just use env var MONITORING_EXPORTER_VERSION to download version of exporter and run tests against it, https fix is not in released version yet, so I have added this condition to build it instead of downloading webapp based on value of release ( the latest now is 1.1.2) or value for branch, if not master it should build it.", "author": "marinakog", "createdAt": "2020-07-22T19:09:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ1NjgyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ1OTAzNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r457459034", "bodyText": "Remove the commented code.  Do we need to set the SSL debug ?  javax.net.debug=all generate a tons of message in server logs", "author": "anpanigr", "createdAt": "2020-07-20T14:50:51Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMonitoringExporter.java", "diffHunk": "@@ -1337,7 +1468,14 @@ private static void createDomainCrAndVerify(String adminSecretName,\n             .serverPod(new ServerPod()\n                 .addEnvItem(new V1EnvVar()\n                     .name(\"JAVA_OPTIONS\")\n-                    .value(\"-Dweblogic.StdoutDebugEnabled=false\"))\n+                    .value(\"-Dweblogic.StdoutDebugEnabled=false \"\n+                        + \"-Dweblogic.security.SSL.ignoreHostnameVerification=true -Dssl.debug=true \"\n+                        + \"-Djavax.net.debug=ssl:handshake \"\n+                        //+ \"-DUseSunHttpHandler=true -Dssl.debug=true \"", "originalCommit": "743dec63ac3784bc0e67cc835f01834d19662a21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMTc5Ng==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r459021796", "bodyText": "will remove, it was done for debugging purposes, now can remove", "author": "marinakog", "createdAt": "2020-07-22T19:10:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ1OTAzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ2MTQyMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r457461421", "bodyText": "Any other way to eliminate hard-coded 15s sleep", "author": "anpanigr", "createdAt": "2020-07-20T14:53:18Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMonitoringExporter.java", "diffHunk": "@@ -1546,10 +1739,20 @@ private HtmlPage submitConfigureForm(\n     fileField.setContentType(\"multipart/form-data\");\n \n     // Now submit the form by clicking the button and get back the second page.\n-    HtmlPage page2 = button.click();\n-    assertNotNull(page2, \"can't reach page after submit\");\n-    assertFalse((page2.asText()).contains(\"Error 500--Internal Server Error\"),\n-            \"page returns Error 500--Internal Server Error\");\n+    HtmlPage page2 = null;\n+    try {\n+      page2 = button.click();\n+      assertNotNull(page2, \"can't reach page after submit\");\n+      assertFalse((page2.asText()).contains(\"Error 500--Internal Server Error\"),\n+          \"page returns Error 500--Internal Server Error\");\n+    } catch (ClassCastException ex) {\n+      logger.info(\" Can't generate html page, collecting the error \");\n+      TextPage page3 = button.click();\n+      assertNotNull(page3, \"can't reach page after submit\");\n+      assertTrue(page3.getContent().contains(\"Unable to contact the REST API\"),\n+          \"submit does not return html page, here is received page \"\n+          + page3.getContent());\n+    }\n     // wait time to update configuration\n     Thread.sleep(15 * 1000);", "originalCommit": "743dec63ac3784bc0e67cc835f01834d19662a21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTAyMjQxOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r459022418", "bodyText": "no, prometheus is configured to push metrics every 10 secs, so we need to wait 15 until new metric will be pushed", "author": "marinakog", "createdAt": "2020-07-22T19:11:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ2MTQyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NzQ2MjA3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r457462077", "bodyText": "eliminate  hard-coded sleep for 20s", "author": "anpanigr", "createdAt": "2020-07-20T14:54:03Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMonitoringExporter.java", "diffHunk": "@@ -1748,6 +1953,24 @@ private void replaceMetricsNameSnakeCaseFalseConfiguration() throws Exception {\n     checkMetricsViaPrometheus(searchKey, \"sessmigr\");\n   }\n \n+  /**\n+   * Try to replace monitoring exporter configuration with configuration file with\n+   * no restPort value.\n+   *\n+   * @throws Exception if failed to apply configuration or check the expected values.\n+   */\n+  private void replaceMetricsNoRestPortConfiguration() throws Exception {\n+    HtmlPage page =\n+        submitConfigureForm(exporterUrl, \"replace\", RESOURCE_DIR + \"/exporter/norestport.yaml\");\n+    assertNotNull(page);\n+    assertFalse(page.asText().contains(\"restPort\"));\n+    Thread.sleep(20 * 1000);", "originalCommit": "743dec63ac3784bc0e67cc835f01834d19662a21", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a86301b0912d53c8246664c903d32a80a84ad5ef", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/a86301b0912d53c8246664c903d32a80a84ad5ef", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-21T01:24:11Z", "type": "commit"}, {"oid": "2d119a12c81c349f5bb6c7d9cabafc1027e08051", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/2d119a12c81c349f5bb6c7d9cabafc1027e08051", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-22T23:50:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU4NjU5Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r459586592", "bodyText": "You can use oracle.weblogic.kubernetes.utils.WLSTUtils.executeWLSTScript( .. ) for this.", "author": "sankarpn", "createdAt": "2020-07-23T16:45:33Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMonitoringExporter.java", "diffHunk": "@@ -1839,4 +2062,57 @@ private void changeConfigEmptyPass() throws Exception {\n             ADMIN_USERNAME_DEFAULT,\n             \"\");\n   }\n+\n+  private boolean changeListenPort(String domainUid, String domainNS, String setListenPortEnabled) throws Exception {", "originalCommit": "743dec63ac3784bc0e67cc835f01834d19662a21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDI3MTg0OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r460271848", "bodyText": "I used model in image domain with no t3 config, so it requires extra imp also when will add support for OKE it would be no issue to convert considering that oke does not provide public ip", "author": "marinakog", "createdAt": "2020-07-24T20:26:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTU4NjU5Mg=="}], "type": "inlineReview"}, {"oid": "c7a899806c668de81bc17d1bb03907e6c4a28d8d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c7a899806c668de81bc17d1bb03907e6c4a28d8d", "message": "addressed all review comments", "committedDate": "2020-07-24T19:58:21Z", "type": "commit"}, {"oid": "c0d62042678b35e4525ef6aa44bb0133c09e1615", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/c0d62042678b35e4525ef6aa44bb0133c09e1615", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-24T19:58:26Z", "type": "commit"}, {"oid": "210ff170660ba95bee31751b30b293a6cb617e5b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/210ff170660ba95bee31751b30b293a6cb617e5b", "message": "checkstyle", "committedDate": "2020-07-24T20:05:21Z", "type": "commit"}, {"oid": "589c7672f89db3fb4c2e43fe33eb835799f2a527", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/589c7672f89db3fb4c2e43fe33eb835799f2a527", "message": "switched to master branch", "committedDate": "2020-07-24T22:23:29Z", "type": "commit"}, {"oid": "4e113f7196ffa6e7813035a347296253f9b21c0f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4e113f7196ffa6e7813035a347296253f9b21c0f", "message": "Merge branch 'develop' of https://github.com/oracle/weblogic-kubernetes-operator into httpsmon", "committedDate": "2020-07-28T17:08:22Z", "type": "commit"}, {"oid": "6ebc30b4d7021715ec87bcc5faca3d5ba1172d03", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/6ebc30b4d7021715ec87bcc5faca3d5ba1172d03", "message": "switched to new monexp release", "committedDate": "2020-07-28T17:24:19Z", "type": "commit"}, {"oid": "89626e678a4962fa1f03a7562e06bd08b0e96380", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/89626e678a4962fa1f03a7562e06bd08b0e96380", "message": "added extra clean", "committedDate": "2020-07-28T18:14:07Z", "type": "commit"}, {"oid": "124599d2ce473bc76bcbeb6da27fe98d2b1d6da6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/124599d2ce473bc76bcbeb6da27fe98d2b1d6da6", "message": "added check if clusterrole or clusterrolebinding exists before delete", "committedDate": "2020-07-28T19:16:36Z", "type": "commit"}, {"oid": "3f417a52e9a3693b6c9c4064bbc9122358892bca", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/3f417a52e9a3693b6c9c4064bbc9122358892bca", "message": "fixed typo", "committedDate": "2020-07-28T19:31:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjMxMzc5Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r462313793", "bodyText": "cun-n-paste error \" logger.info(\"Get a unique namespace for domain3\"); '  is repeated twice", "author": "anpanigr", "createdAt": "2020-07-29T13:50:37Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/ItMonitoringExporter.java", "diffHunk": "@@ -247,37 +260,35 @@ public static void initAll(@Namespaces(6) List<String> namespaces) {\n     assertNotNull(namespaces.get(5), \"Namespace list is null\");\n     final String nginxNamespace = namespaces.get(5);\n \n+    logger.info(\"Get a unique namespace for domain3\");\n+    assertNotNull(namespaces.get(6), \"Namespace list is null\");\n+    domain3Namespace = namespaces.get(6);\n+\n+    logger.info(\"Get a unique namespace for domain3\");", "originalCommit": "3f417a52e9a3693b6c9c4064bbc9122358892bca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjYxNjgwMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r462616803", "bodyText": "corrected", "author": "marinakog", "createdAt": "2020-07-29T22:04:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjMxMzc5Mw=="}], "type": "inlineReview"}, {"oid": "9d08f33dfe6a5b2baa0efa0584eae1212b5d029d", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/9d08f33dfe6a5b2baa0efa0584eae1212b5d029d", "message": "fixed typos", "committedDate": "2020-07-29T15:54:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyODE0NA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r462428144", "bodyText": "import io.kubernetes.client.openapi.models.V1SecretList", "author": "sankarpn", "createdAt": "2020-07-29T16:25:44Z", "path": "new-integration-tests/src/test/java/oracle/weblogic/kubernetes/utils/CommonTestUtils.java", "diffHunk": "@@ -1502,8 +1503,20 @@ public static HelmParams installAndVerifyGrafana(String grafanaReleaseName,\n     GrafanaParams grafanaParams = new GrafanaParams()\n         .helmParams(grafanaHelmParams)\n         .nodePort(grafanaNodePort);\n-    //create grafana secret\n-    createSecretWithUsernamePassword(\"grafana-secret\", grafanaNamespace, \"admin\", \"12345678\");\n+    boolean secretExists = false;\n+    io.kubernetes.client.openapi.models.V1SecretList listSecrets = listSecrets(grafanaNamespace);", "originalCommit": "9d08f33dfe6a5b2baa0efa0584eae1212b5d029d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjUzODA5Mg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1824#discussion_r462538092", "bodyText": "corrected", "author": "marinakog", "createdAt": "2020-07-29T19:32:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjQyODE0NA=="}], "type": "inlineReview"}, {"oid": "ca78c648c46a67efe0ce5810043357c40043f45f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ca78c648c46a67efe0ce5810043357c40043f45f", "message": "change change portnumbers to fix parallel run", "committedDate": "2020-07-29T18:52:40Z", "type": "commit"}, {"oid": "43d5f1927243bde5212c9fa0f9c3e5bbde385546", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/43d5f1927243bde5212c9fa0f9c3e5bbde385546", "message": "styling", "committedDate": "2020-07-29T19:15:02Z", "type": "commit"}, {"oid": "364877890a74f9133549bc2d1496f79ea9793d4b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/364877890a74f9133549bc2d1496f79ea9793d4b", "message": "styling1", "committedDate": "2020-07-29T19:28:14Z", "type": "commit"}, {"oid": "82694d8daa7ca945679730e8e864ac58452b29a4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/82694d8daa7ca945679730e8e864ac58452b29a4", "message": "added fix for paralell run", "committedDate": "2020-07-29T19:40:08Z", "type": "commit"}]}