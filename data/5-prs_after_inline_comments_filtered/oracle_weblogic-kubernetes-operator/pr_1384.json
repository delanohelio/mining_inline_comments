{"pr_number": 1384, "pr_title": "owls-77750 dedicated ns", "pr_createdAt": "2020-01-10T16:03:29Z", "pr_url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384", "timeline": [{"oid": "4300c628dda3297c65008ac4c1d656e011175eb2", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4300c628dda3297c65008ac4c1d656e011175eb2", "message": "Work in progress", "committedDate": "2019-11-01T18:23:20Z", "type": "commit"}, {"oid": "1e9f5198bbb710a47f598ba40eaa63a2c64a05b5", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1e9f5198bbb710a47f598ba40eaa63a2c64a05b5", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-single-ns\n\nConflicts:\n\tdocs/charts/index.yaml\n\tdocs/charts/weblogic-operator-2.3.1.tgz", "committedDate": "2020-01-02T14:54:26Z", "type": "commit"}, {"oid": "5fe594b9c7fa84b231ef9d4d10424ff1a02b77fd", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5fe594b9c7fa84b231ef9d4d10424ff1a02b77fd", "message": "More changes and merge with develop\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-02T14:56:08Z", "type": "commit"}, {"oid": "27ade04b55da6eae9b0273d94bbd6d79196ba6f9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/27ade04b55da6eae9b0273d94bbd6d79196ba6f9", "message": "More changes\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-08T21:08:42Z", "type": "commit"}, {"oid": "7282cac4939ad3309c471a0fdd26967ddb7f48d6", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/7282cac4939ad3309c471a0fdd26967ddb7f48d6", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-single-ns\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/HealthCheckHelper.java", "committedDate": "2020-01-08T21:16:30Z", "type": "commit"}, {"oid": "5d9e21a9c81225bc15e566a0f3eb0ce1af3eada1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/5d9e21a9c81225bc15e566a0f3eb0ce1af3eada1", "message": "Work around issues with CRD validation and fix an installation test failure\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-09T18:35:25Z", "type": "commit"}, {"oid": "221a813cc184c25a85add2a3404307be018f8030", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/221a813cc184c25a85add2a3404307be018f8030", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns", "committedDate": "2020-01-09T19:59:11Z", "type": "commit"}, {"oid": "039480c322880d5000868e1f1c478f8878b9764c", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/039480c322880d5000868e1f1c478f8878b9764c", "message": "Fix installation test failure\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-09T20:17:11Z", "type": "commit"}, {"oid": "85676776f1b116875bdc7574eb6f9b66744c9e1b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/85676776f1b116875bdc7574eb6f9b66744c9e1b", "message": "Fixing installation test failure in Jenkins\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-09T20:33:48Z", "type": "commit"}, {"oid": "640f954826a27b304e8e353a99f6f318ba5fb3ee", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/640f954826a27b304e8e353a99f6f318ba5fb3ee", "message": "More change for dedicated in installation test\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-09T20:51:45Z", "type": "commit"}, {"oid": "4523ff0df2307ff45db21a491c809cd55931113a", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/4523ff0df2307ff45db21a491c809cd55931113a", "message": "One more change\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-09T21:29:00Z", "type": "commit"}, {"oid": "f6e00261d6539f068abd4ee245d75a78c6c75902", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f6e00261d6539f068abd4ee245d75a78c6c75902", "message": "Minor fix of nonresource security\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-09T21:52:48Z", "type": "commit"}, {"oid": "635e84b7aa019fb6293166177c2eff3d0f09f68f", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/635e84b7aa019fb6293166177c2eff3d0f09f68f", "message": "update operator charts docs\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-10T02:48:28Z", "type": "commit"}, {"oid": "fceac0d46ff1ce6468da23d8337267e19bc71583", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/fceac0d46ff1ce6468da23d8337267e19bc71583", "message": "Workaround generated CRD yaml issue\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-10T15:41:01Z", "type": "commit"}, {"oid": "0b166cd9f8e0188fd68a7a82aa99b2f8022bb6ae", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/0b166cd9f8e0188fd68a7a82aa99b2f8022bb6ae", "message": "Move the generated crd to a different location\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-10T17:13:12Z", "type": "commit"}, {"oid": "1f5a0d086c74b14da8113ab4cc39abc7bf8af370", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/1f5a0d086c74b14da8113ab4cc39abc7bf8af370", "message": "Move generated crd\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-10T22:39:34Z", "type": "commit"}, {"oid": "974c4bc8962cff66df9d64ea3c7091c3bbbba22e", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/974c4bc8962cff66df9d64ea3c7091c3bbbba22e", "message": "Fix podresets permission error\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-15T16:47:44Z", "type": "commit"}, {"oid": "61b629efe8241627fa67d8613c5c2a2387601e4b", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/61b629efe8241627fa67d8613c5c2a2387601e4b", "message": "Check and skip access to cluster level resources and update copyright\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-15T21:33:48Z", "type": "commit"}, {"oid": "e59dec595fd3a6d54743df4542df0eae673dd456", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/e59dec595fd3a6d54743df4542df0eae673dd456", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>\n\nConflicts:\n\toperator/src/main/java/oracle/kubernetes/operator/helpers/CrdHelper.java\n\toperator/src/main/java/oracle/kubernetes/operator/steps/DeleteDomainStep.java", "committedDate": "2020-01-15T21:39:27Z", "type": "commit"}, {"oid": "80b5fbd07e976971a366914ac74976b42ce1f595", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/80b5fbd07e976971a366914ac74976b42ce1f595", "message": "Improve security check code\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-16T04:10:48Z", "type": "commit"}, {"oid": "39fd7244d9929a52ea8bf9dddf28c7b34c0cc101", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/39fd7244d9929a52ea8bf9dddf28c7b34c0cc101", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns", "committedDate": "2020-01-16T20:32:28Z", "type": "commit"}, {"oid": "67305a2ca50288a29da8eac0ca16c13b06e8f961", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/67305a2ca50288a29da8eac0ca16c13b06e8f961", "message": "Cleanup cluster security checks and add log messages\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-17T23:57:25Z", "type": "commit"}, {"oid": "8fb23cf703067efbb3af7d376cfd96bdbbffe708", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/8fb23cf703067efbb3af7d376cfd96bdbbffe708", "message": "Update generated domain crd yaml and clean up logging\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-21T23:34:53Z", "type": "commit"}, {"oid": "d2119f7b97511fb3e9dabd7ec01b67050e6a8083", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/d2119f7b97511fb3e9dabd7ec01b67050e6a8083", "message": "Add more logging\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-23T02:06:15Z", "type": "commit"}, {"oid": "81766dc091521dd9327a346349c178ef631678de", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/81766dc091521dd9327a346349c178ef631678de", "message": "Add basic unit test cases for \"dedicated\"\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-23T14:32:08Z", "type": "commit"}, {"oid": "f3c29306b9c29dcc1ea240d94df5df73bf55e6cf", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/f3c29306b9c29dcc1ea240d94df5df73bf55e6cf", "message": "Add doc contents plus cleanup\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-23T19:20:36Z", "type": "commit"}, {"oid": "126bc35fc777a6b25677597f01fb86799b183fb9", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/126bc35fc777a6b25677597f01fb86799b183fb9", "message": "Fix validation\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-23T23:27:31Z", "type": "commit"}, {"oid": "cf049fce49bbe3c82cdccaf9bb8a50e3eb4519c1", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/cf049fce49bbe3c82cdccaf9bb8a50e3eb4519c1", "message": "Turn off verify boolen for dedicated value\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-24T02:14:07Z", "type": "commit"}, {"oid": "90388ebf08402b4d866984970e6f0d0d9d3a98fe", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/90388ebf08402b4d866984970e6f0d0d9d3a98fe", "message": "Merge remote-tracking branch 'origin/develop' into owls-77750-dedicated-ns", "committedDate": "2020-01-24T14:11:30Z", "type": "commit"}, {"oid": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/265e0a4d708501dbd34fde4aafab6cb9c60c0008", "message": "add unit tests", "committedDate": "2020-01-24T19:50:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDcyMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894722", "bodyText": "why all the empty lines?", "author": "markxnelson", "createdAt": "2020-01-25T00:20:05Z", "path": "kubernetes/src/test/java/oracle/kubernetes/operator/helm/HelmOperatorValuesTest.java", "diffHunk": "@@ -487,6 +487,50 @@ public void whenCreatedFromMapWithExternalDebugHttpPort_hasSpecifiedValue() {\n     assertThat(values.getExternalDebugHttpPort(), equalTo(stringValue));\n   }\n \n+  // --------------- dedicated\n+\n+  @Test\n+  public void whenDedicatedTrue_createdMapContainsValue() {\n+    operatorValues.dedicated(\"true\");\n+", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDk0OQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370894949", "bodyText": "this line seems overly complicated and prone to future update errors", "author": "markxnelson", "createdAt": "2020-01-25T00:21:34Z", "path": "operator/src/main/java/oracle/kubernetes/operator/Main.java", "diffHunk": "@@ -578,6 +595,17 @@ public NextAction apply(Packet packet) {\n     }\n   }\n \n+  /**\n+   * Adds the specified namespace to the list of started namespaces, returning true if it was not\n+   * already present.\n+   * @param ns the namespace name\n+   * @return false if the namespace had already been started\n+   */\n+  static boolean addStartedNamespace(String ns) {\n+    AtomicBoolean a = isNamespaceStarted.computeIfAbsent(ns, (key) -> new AtomicBoolean(false));\n+    return !a.getAndSet(true);", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxMDIxMw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371310213", "bodyText": "This is just a refactoring of the old code in line #567.  The pattern is used in other places.", "author": "doxiao", "createdAt": "2020-01-27T15:33:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NDk0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTAxMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895012", "bodyText": "Do not include \"All rights reserved\" in any new files -- new rules....", "author": "markxnelson", "createdAt": "2020-01-25T00:21:51Z", "path": "operator/src/main/java/oracle/kubernetes/operator/StartupControl.java", "diffHunk": "@@ -0,0 +1,74 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTA1MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895050", "bodyText": "javadoc???", "author": "markxnelson", "createdAt": "2020-01-25T00:22:08Z", "path": "operator/src/main/java/oracle/kubernetes/operator/StartupControl.java", "diffHunk": "@@ -0,0 +1,74 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.Optional;\n+import java.util.function.Function;\n+\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Operation;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Resource;\n+import oracle.kubernetes.operator.helpers.CrdHelper;\n+import oracle.kubernetes.operator.helpers.HealthCheckHelper;\n+import oracle.kubernetes.operator.helpers.KubernetesVersion;\n+import oracle.kubernetes.operator.logging.LoggingFacade;\n+import oracle.kubernetes.operator.logging.LoggingFactory;\n+import oracle.kubernetes.operator.logging.MessageKeys;\n+import oracle.kubernetes.operator.work.Step;\n+\n+public class StartupControl {", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2MTEwNA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371361104", "bodyText": "added", "author": "doxiao", "createdAt": "2020-01-27T16:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTA1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTEzMQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895131", "bodyText": "2020", "author": "markxnelson", "createdAt": "2020-01-25T00:22:46Z", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/CrdHelper.java", "diffHunk": "@@ -43,6 +52,31 @@\n   private CrdHelper() {\n   }\n \n+  /**\n+   * Used by build to generate crd-validation.yaml\n+   * @param args Arguments that must be one value giving file name to create\n+   */\n+  public static void main(String[] args) {\n+    if (args == null || args.length != 1) {\n+      throw new IllegalArgumentException();\n+    }\n+\n+    String outputFileName = args[0];\n+\n+    Path outputFilePath = Paths.get(outputFileName);\n+    CrdContext context = new CrdContext(null, null);\n+\n+    try (Writer writer = Files.newBufferedWriter(outputFilePath)) {\n+      writer.write(\n+          \"# Copyright (c) 2019, Oracle Corporation and/or its affiliates.  All rights reserved.\\n\"", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMxMDc4MQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371310781", "bodyText": "good catch", "author": "doxiao", "createdAt": "2020-01-27T15:34:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTEzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTIyNw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895227", "bodyText": "we don't support ABAC...", "author": "markxnelson", "createdAt": "2020-01-25T00:23:27Z", "path": "operator/src/main/java/oracle/kubernetes/operator/helpers/HealthCheckHelper.java", "diffHunk": "@@ -21,151 +26,190 @@\n \n   private static final LoggingFacade LOGGER = LoggingFactory.getLogger(\"Operator\", \"Operator\");\n \n-  private static final Map<AuthorizationProxy.Resource, AuthorizationProxy.Operation[]>\n+  private static final Map<Resource, Operation[]>\n       namespaceAccessChecks = new HashMap<>();\n-  private static final Map<AuthorizationProxy.Resource, AuthorizationProxy.Operation[]>\n+  private static final Map<Resource, Operation[]>\n       clusterAccessChecks = new HashMap<>();\n \n   // Note: this list should match the RBAC or ABAC policies contained in the YAML script", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTU2OA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895568", "bodyText": "remove \"All rights reserved\"", "author": "markxnelson", "createdAt": "2020-01-25T00:25:53Z", "path": "operator/src/test/java/oracle/kubernetes/operator/StartupControlTest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3NTA2MA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371175060", "bodyText": "They all say that. Is this a change?", "author": "russgold", "createdAt": "2020-01-27T10:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTMzMDgzMg==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371330832", "bodyText": "@markxnelson The operator runtime build failed if I remove \"All rights reserved\" part with the following warning.\n[WARNING] src/main/java/oracle/kubernetes/operator/StartupControl.java:[1] (header) RegexpHeader: Line does not match expected header line of '^// Copyright (c) (\\d\\d\\d\\d, )+Oracle Corporation and/or its affiliates.  All rights reserved.$'.", "author": "doxiao", "createdAt": "2020-01-27T16:06:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTU2OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM2MDIwNQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371360205", "bodyText": "left unchanged.", "author": "doxiao", "createdAt": "2020-01-27T16:55:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTU2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTYxOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895618", "bodyText": "1,8? seems old, should we update?", "author": "markxnelson", "createdAt": "2020-01-25T00:26:18Z", "path": "operator/src/test/java/oracle/kubernetes/operator/StartupControlTest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.logging.LogRecord;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import io.kubernetes.client.openapi.models.V1ResourceRule;\n+import io.kubernetes.client.openapi.models.V1SelfSubjectRulesReview;\n+import io.kubernetes.client.openapi.models.V1SubjectRulesReviewStatus;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Operation;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Resource;\n+import oracle.kubernetes.operator.helpers.CrdHelper;\n+import oracle.kubernetes.operator.helpers.KubernetesTestSupport;\n+import oracle.kubernetes.operator.helpers.KubernetesVersion;\n+import oracle.kubernetes.operator.helpers.TuningParametersStub;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.operator.work.TerminalStep;\n+import oracle.kubernetes.utils.TestUtils;\n+import org.hamcrest.Description;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static oracle.kubernetes.operator.StartupControlTest.StepPresenceMatcher.containsStep;\n+import static oracle.kubernetes.operator.logging.MessageKeys.CRD_NO_READ_ACCESS;\n+import static oracle.kubernetes.operator.logging.MessageKeys.NS_NO_READ_ACCESS;\n+import static oracle.kubernetes.utils.LogMatcher.containsWarning;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.not;\n+import static org.hamcrest.Matchers.sameInstance;\n+import static org.hamcrest.junit.MatcherAssert.assertThat;\n+\n+public class StartupControlTest {\n+  private static final KubernetesVersion VERSION = new KubernetesVersion(1, 8);", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3NTg2Mw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371175863", "bodyText": "We absolutely should. There is still logic that determines whether Rules Review is supported, even though we no longer support versions before 1.8. I don't think it should be done as part of this PR, though.", "author": "russgold", "createdAt": "2020-01-27T10:59:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTIyNzY3NQ==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371227675", "bodyText": "I have a PR coming later in the week that addresses this.  There is another set of JIRA's about removing unnecessary privileges and also working in a \"low privilege\" environment and I used those as an opportunity to clean-up this code.", "author": "rjeberhard", "createdAt": "2020-01-27T13:04:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTYxOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTI1NzQ5Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371257497", "bodyText": "You'll need to adjust the code in this PR if you do.", "author": "russgold", "createdAt": "2020-01-27T14:06:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTYxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTY3Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r370895677", "bodyText": "why all the blank lines?", "author": "markxnelson", "createdAt": "2020-01-25T00:26:37Z", "path": "operator/src/test/java/oracle/kubernetes/operator/StartupControlTest.java", "diffHunk": "@@ -0,0 +1,256 @@\n+// Copyright (c) 2020, Oracle Corporation and/or its affiliates.  All rights reserved.\n+// Licensed under the Universal Permissive License v 1.0 as shown at https://oss.oracle.com/licenses/upl.\n+\n+package oracle.kubernetes.operator;\n+\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.logging.LogRecord;\n+\n+import com.meterware.simplestub.Memento;\n+import com.meterware.simplestub.StaticStubSupport;\n+import io.kubernetes.client.openapi.models.V1ResourceRule;\n+import io.kubernetes.client.openapi.models.V1SelfSubjectRulesReview;\n+import io.kubernetes.client.openapi.models.V1SubjectRulesReviewStatus;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Operation;\n+import oracle.kubernetes.operator.helpers.AuthorizationProxy.Resource;\n+import oracle.kubernetes.operator.helpers.CrdHelper;\n+import oracle.kubernetes.operator.helpers.KubernetesTestSupport;\n+import oracle.kubernetes.operator.helpers.KubernetesVersion;\n+import oracle.kubernetes.operator.helpers.TuningParametersStub;\n+import oracle.kubernetes.operator.work.Step;\n+import oracle.kubernetes.operator.work.TerminalStep;\n+import oracle.kubernetes.utils.TestUtils;\n+import org.hamcrest.Description;\n+import org.junit.After;\n+import org.junit.Before;\n+import org.junit.Test;\n+\n+import static oracle.kubernetes.operator.StartupControlTest.StepPresenceMatcher.containsStep;\n+import static oracle.kubernetes.operator.logging.MessageKeys.CRD_NO_READ_ACCESS;\n+import static oracle.kubernetes.operator.logging.MessageKeys.NS_NO_READ_ACCESS;\n+import static oracle.kubernetes.utils.LogMatcher.containsWarning;\n+import static org.hamcrest.Matchers.equalTo;\n+import static org.hamcrest.Matchers.instanceOf;\n+import static org.hamcrest.Matchers.is;\n+import static org.hamcrest.Matchers.not;\n+import static org.hamcrest.Matchers.sameInstance;\n+import static org.hamcrest.junit.MatcherAssert.assertThat;\n+\n+public class StartupControlTest {\n+  private static final KubernetesVersion VERSION = new KubernetesVersion(1, 8);\n+\n+  private KubernetesTestSupport testSupport = new KubernetesTestSupport();\n+  private Map<String,String> environmentVariables = new HashMap<>();\n+  private Function<String, String> getEnv = (name -> environmentVariables.get(name));\n+  private List<Memento> mementos = new ArrayList<>();\n+  private List<V1ResourceRule> rules = new ArrayList<>();\n+  private Step startStep = new TerminalStep();\n+  private Step namespaceStep = new TerminalStep();\n+  private StartupControl startupControl = new StartupControl(VERSION);\n+  private Collection<LogRecord> logRecords = new ArrayList<>();\n+  private TestUtils.ConsoleHandlerMemento loggerMemento;\n+\n+  @Before\n+  public void setUp() throws Exception {\n+    mementos.add(StaticStubSupport.install(StartupControl.class, \"getHelmVariable\", getEnv));\n+    mementos.add(TuningParametersStub.install());\n+    mementos.add(testSupport.install());\n+    mementos.add(loggerMemento = TestUtils.silenceOperatorLogger());\n+\n+    loggerMemento.collectLogMessages(logRecords, CRD_NO_READ_ACCESS, NS_NO_READ_ACCESS);\n+    testSupport.doOnCreate(KubernetesTestSupport.SELF_SUBJECT_RULES_REVIEW,\n+          (Consumer<V1SelfSubjectRulesReview>) this::populateSubjectRulesReview);\n+  }\n+\n+  @After\n+  public void tearDown() {\n+    mementos.forEach(Memento::revert);\n+  }\n+\n+  @Test\n+  public void whenOperatorDedicatedUndefined_isDedicatedReturnsFalse() {\n+    assertThat(startupControl.isDedicated(), is(false));\n+  }\n+\n+  @Test\n+  public void whenOperatorDedicatedEmptyString_isDedicatedReturnsFalse() {\n+    environmentVariables.put(StartupControl.OPERATOR_DEDICATED_ENV, \"\");\n+    \n+    assertThat(startupControl.isDedicated(), is(false));\n+  }\n+\n+  @Test\n+  public void whenOperatorDedicatedNotTrue_isDedicatedReturnsFalse() {\n+    environmentVariables.put(StartupControl.OPERATOR_DEDICATED_ENV, \"zork\");\n+", "originalCommit": "265e0a4d708501dbd34fde4aafab6cb9c60c0008", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTE3NjU4Nw==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371176587", "bodyText": "Do you mean inside the test methods? That's a common convention to separate individual test setup, the invocation being tested, and the assertion of the expected result.", "author": "russgold", "createdAt": "2020-01-27T11:01:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTM3MzMyOA==", "url": "https://github.com/oracle/weblogic-kubernetes-operator/pull/1384#discussion_r371373328", "bodyText": "ok", "author": "markxnelson", "createdAt": "2020-01-27T17:19:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDg5NTY3Nw=="}], "type": "inlineReview"}, {"oid": "10828f7c5d852f28df64c785d4d46e3ee3006487", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/10828f7c5d852f28df64c785d4d46e3ee3006487", "message": "Address review comments from Mark\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-27T16:49:42Z", "type": "commit"}, {"oid": "962d6ac4b538a070759fda26f952f6bd0a2e6ec0", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/962d6ac4b538a070759fda26f952f6bd0a2e6ec0", "message": "Address doc comments from Rosemary\n\nSigned-off-by: doxiao <dongbo.xiao@oracle.com>", "committedDate": "2020-01-27T19:55:16Z", "type": "commit"}, {"oid": "ec56457bd14bdb983e99d68d8c611d095d8210f4", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/ec56457bd14bdb983e99d68d8c611d095d8210f4", "message": "Rebuilt files", "committedDate": "2020-01-28T04:18:13Z", "type": "commit"}, {"oid": "432cd6ad265779fb113ea888809592238fb48d55", "url": "https://github.com/oracle/weblogic-kubernetes-operator/commit/432cd6ad265779fb113ea888809592238fb48d55", "message": "Updated files, part deux", "committedDate": "2020-01-28T04:21:59Z", "type": "commit"}]}