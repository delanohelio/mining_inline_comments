{"pr_number": 6307, "pr_title": "Make available current card's and deck's details in WebView", "pr_createdAt": "2020-05-30T11:20:42Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6307", "timeline": [{"oid": "3a4a301da3dca4f6a44edef2193988bed15316ad", "url": "https://github.com/ankidroid/Anki-Android/commit/3a4a301da3dca4f6a44edef2193988bed15316ad", "message": "Add files via upload", "committedDate": "2020-03-14T09:50:07Z", "type": "commit"}, {"oid": "3e57c4ceca25bb1fec92ca743eaa98700966108f", "url": "https://github.com/ankidroid/Anki-Android/commit/3e57c4ceca25bb1fec92ca743eaa98700966108f", "message": "Update card.js", "committedDate": "2020-03-15T09:39:50Z", "type": "commit"}, {"oid": "e7e91bc09a085ffc129535442af8456f97f6dc80", "url": "https://github.com/ankidroid/Anki-Android/commit/e7e91bc09a085ffc129535442af8456f97f6dc80", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T09:41:29Z", "type": "commit"}, {"oid": "366610142dc2b93fd4a54958878b9205a9d59f52", "url": "https://github.com/ankidroid/Anki-Android/commit/366610142dc2b93fd4a54958878b9205a9d59f52", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T15:52:38Z", "type": "commit"}, {"oid": "7c5ec74a43504d5357e66dfec9b329a64c88c04f", "url": "https://github.com/ankidroid/Anki-Android/commit/7c5ec74a43504d5357e66dfec9b329a64c88c04f", "message": "Update card.js", "committedDate": "2020-03-15T15:55:06Z", "type": "commit"}, {"oid": "f8041a93bb3249736811d14659250d93a9c76ca4", "url": "https://github.com/ankidroid/Anki-Android/commit/f8041a93bb3249736811d14659250d93a9c76ca4", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T18:25:09Z", "type": "commit"}, {"oid": "f0f9331b5e8d518d7cbad7ac48cb0443c9384559", "url": "https://github.com/ankidroid/Anki-Android/commit/f0f9331b5e8d518d7cbad7ac48cb0443c9384559", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T18:36:30Z", "type": "commit"}, {"oid": "2f4df32f4fe9551691ebe4117059d301c55fd9b4", "url": "https://github.com/ankidroid/Anki-Android/commit/2f4df32f4fe9551691ebe4117059d301c55fd9b4", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-03-15T18:36:57Z", "type": "commit"}, {"oid": "7bd146c9a8a58c5b01b73bae5400734b4e940f5b", "url": "https://github.com/ankidroid/Anki-Android/commit/7bd146c9a8a58c5b01b73bae5400734b4e940f5b", "message": "Merge pull request #1 from ankidroid/master\n\nUpdate Ankidroid forked repo - DONE", "committedDate": "2020-03-17T12:05:33Z", "type": "commit"}, {"oid": "38ccf485e82e8413146a979176eed3819481439d", "url": "https://github.com/ankidroid/Anki-Android/commit/38ccf485e82e8413146a979176eed3819481439d", "message": "Added localhost domain-config", "committedDate": "2020-04-01T06:36:27Z", "type": "commit"}, {"oid": "2b6bcf3dc2e58fa384cc9a55c701c7f942e115ca", "url": "https://github.com/ankidroid/Anki-Android/commit/2b6bcf3dc2e58fa384cc9a55c701c7f942e115ca", "message": "Merge pull request #2 from ankidroid/master\n\nUpdating Fork", "committedDate": "2020-05-07T11:39:18Z", "type": "commit"}, {"oid": "465b0a20c6a12b8cae48c4825dcad000aba38688", "url": "https://github.com/ankidroid/Anki-Android/commit/465b0a20c6a12b8cae48c4825dcad000aba38688", "message": "Anki", "committedDate": "2020-05-07T18:41:31Z", "type": "commit"}, {"oid": "30863ff6ccd14c27375a786629d48a0175b991b6", "url": "https://github.com/ankidroid/Anki-Android/commit/30863ff6ccd14c27375a786629d48a0175b991b6", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-05-07T18:41:47Z", "type": "commit"}, {"oid": "7df6d450273f46b457b846f3a7daf7a19f61b52c", "url": "https://github.com/ankidroid/Anki-Android/commit/7df6d450273f46b457b846f3a7daf7a19f61b52c", "message": "Merge pull request #3 from ankidroid/master\n\nRevert \"don't put \"undo\" to color enabled\"", "committedDate": "2020-05-07T18:45:03Z", "type": "commit"}, {"oid": "e3045d9c618e2f3dc0cfe4f322b9b64d6de3498c", "url": "https://github.com/ankidroid/Anki-Android/commit/e3045d9c618e2f3dc0cfe4f322b9b64d6de3498c", "message": "Update", "committedDate": "2020-05-07T18:57:46Z", "type": "commit"}, {"oid": "955285abd863193bf0c70ab1436ba7d9ec70c770", "url": "https://github.com/ankidroid/Anki-Android/commit/955285abd863193bf0c70ab1436ba7d9ec70c770", "message": "Update Preferences.java", "committedDate": "2020-05-07T19:00:37Z", "type": "commit"}, {"oid": "a9ef4310bd195d21efbc9be8dd419cc4122a682a", "url": "https://github.com/ankidroid/Anki-Android/commit/a9ef4310bd195d21efbc9be8dd419cc4122a682a", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-05-07T19:01:55Z", "type": "commit"}, {"oid": "91574092619fc3adc061e147930a4d565638d8ec", "url": "https://github.com/ankidroid/Anki-Android/commit/91574092619fc3adc061e147930a4d565638d8ec", "message": "Update preferences_appearance.xml", "committedDate": "2020-05-07T19:03:35Z", "type": "commit"}, {"oid": "46d7fc5616561e625e72ee3164edfd27a7c19669", "url": "https://github.com/ankidroid/Anki-Android/commit/46d7fc5616561e625e72ee3164edfd27a7c19669", "message": "update", "committedDate": "2020-05-07T19:36:11Z", "type": "commit"}, {"oid": "ae832792d6acce358da70329161103ba215cc98f", "url": "https://github.com/ankidroid/Anki-Android/commit/ae832792d6acce358da70329161103ba215cc98f", "message": "update", "committedDate": "2020-05-08T05:52:44Z", "type": "commit"}, {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "url": "https://github.com/ankidroid/Anki-Android/commit/25aac571d064bb849f01cfd59e895c2d8b13ce2c", "message": "Update DeckPicker.java", "committedDate": "2020-05-08T06:02:46Z", "type": "commit"}, {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e", "url": "https://github.com/ankidroid/Anki-Android/commit/333008cf0e4b7eaa73c02d013f12e24e096e835e", "message": "Background Image", "committedDate": "2020-05-08T12:35:00Z", "type": "commit"}, {"oid": "5871b34b2f930a78e7146bdd4915eb5d2231e037", "url": "https://github.com/ankidroid/Anki-Android/commit/5871b34b2f930a78e7146bdd4915eb5d2231e037", "message": "Update DeckPicker.java", "committedDate": "2020-05-08T12:38:11Z", "type": "commit"}, {"oid": "47a1c6f60e968142e6365f8438da3b7855d0234c", "url": "https://github.com/ankidroid/Anki-Android/commit/47a1c6f60e968142e6365f8438da3b7855d0234c", "message": "Update Preferences.java", "committedDate": "2020-05-08T12:44:09Z", "type": "commit"}, {"oid": "829d14f4ae422a1a45a04980735caf75147a153a", "url": "https://github.com/ankidroid/Anki-Android/commit/829d14f4ae422a1a45a04980735caf75147a153a", "message": "Update DeckPicker.java", "committedDate": "2020-05-08T12:48:30Z", "type": "commit"}, {"oid": "5e7d40de9633ad992bdc271f68857515ec934d2b", "url": "https://github.com/ankidroid/Anki-Android/commit/5e7d40de9633ad992bdc271f68857515ec934d2b", "message": "Update 03-dialogs.xml\n\nPrefrences.java\n03-dialogs.xml\nUpdated", "committedDate": "2020-05-08T13:00:59Z", "type": "commit"}, {"oid": "f5a04d4e6144e98ebbae8fa816752aa0f0231ac4", "url": "https://github.com/ankidroid/Anki-Android/commit/f5a04d4e6144e98ebbae8fa816752aa0f0231ac4", "message": "Update Preferences.java", "committedDate": "2020-05-08T13:07:57Z", "type": "commit"}, {"oid": "60a4ff0790aff50a34b21fb2ea498854e55574c3", "url": "https://github.com/ankidroid/Anki-Android/commit/60a4ff0790aff50a34b21fb2ea498854e55574c3", "message": "Update Preferences.java", "committedDate": "2020-05-08T13:58:32Z", "type": "commit"}, {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b", "url": "https://github.com/ankidroid/Anki-Android/commit/f1d46028367f813c99febe0d3c13b4e87dad030b", "message": "Update DeckPicker.java", "committedDate": "2020-05-09T14:54:08Z", "type": "commit"}, {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "url": "https://github.com/ankidroid/Anki-Android/commit/e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "message": "deckpicker background image", "committedDate": "2020-05-09T22:05:49Z", "type": "commit"}, {"oid": "3dc19a5c833b782c107e408aa239b13ab71d995a", "url": "https://github.com/ankidroid/Anki-Android/commit/3dc19a5c833b782c107e408aa239b13ab71d995a", "message": "update Deckpicker.java", "committedDate": "2020-05-09T22:52:51Z", "type": "commit"}, {"oid": "e2ceb64bcc0ab6a6dbc4c2002976e7320845a2ae", "url": "https://github.com/ankidroid/Anki-Android/commit/e2ceb64bcc0ab6a6dbc4c2002976e7320845a2ae", "message": "update 03-dialogs.xml", "committedDate": "2020-05-09T23:11:58Z", "type": "commit"}, {"oid": "cabb8a314b16f550369db9e7cd203911655334ef", "url": "https://github.com/ankidroid/Anki-Android/commit/cabb8a314b16f550369db9e7cd203911655334ef", "message": "Update Preferences.java", "committedDate": "2020-05-15T20:06:58Z", "type": "commit"}, {"oid": "32c28a1a8112c2706eee554efdfcefbe2e0aa283", "url": "https://github.com/ankidroid/Anki-Android/commit/32c28a1a8112c2706eee554efdfcefbe2e0aa283", "message": "Update Fork", "committedDate": "2020-05-15T20:31:05Z", "type": "commit"}, {"oid": "b0841b85d6ea0e3b5506c9e3f50f7c23d480a347", "url": "https://github.com/ankidroid/Anki-Android/commit/b0841b85d6ea0e3b5506c9e3f50f7c23d480a347", "message": "Merge pull request #6 from ankidroid/master\n\nFork Update", "committedDate": "2020-05-15T20:35:12Z", "type": "commit"}, {"oid": "1d93e935edcad218651be9576fad70b30f11652e", "url": "https://github.com/ankidroid/Anki-Android/commit/1d93e935edcad218651be9576fad70b30f11652e", "message": "Update Preferences.java", "committedDate": "2020-05-15T20:37:41Z", "type": "commit"}, {"oid": "81bc40bf310ca4da971f25b2b017f0d7b8564bf8", "url": "https://github.com/ankidroid/Anki-Android/commit/81bc40bf310ca4da971f25b2b017f0d7b8564bf8", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-05-15T20:38:08Z", "type": "commit"}, {"oid": "05bec673418481cd410d69c862de0b18222e8525", "url": "https://github.com/ankidroid/Anki-Android/commit/05bec673418481cd410d69c862de0b18222e8525", "message": "Update Preferences.java", "committedDate": "2020-05-15T23:13:32Z", "type": "commit"}, {"oid": "a92f1b79babe2513417d1e02372d883ca2e1c2f2", "url": "https://github.com/ankidroid/Anki-Android/commit/a92f1b79babe2513417d1e02372d883ca2e1c2f2", "message": "Update 03-dialogs.xml", "committedDate": "2020-05-16T04:08:11Z", "type": "commit"}, {"oid": "9ec5c80b5b361260a3516de3cf82b61b3bea166f", "url": "https://github.com/ankidroid/Anki-Android/commit/9ec5c80b5b361260a3516de3cf82b61b3bea166f", "message": "Update 03-dialogs.xml", "committedDate": "2020-05-16T04:13:37Z", "type": "commit"}, {"oid": "e9d0b1d608e184048ac7baae6423accf2cbec87f", "url": "https://github.com/ankidroid/Anki-Android/commit/e9d0b1d608e184048ac7baae6423accf2cbec87f", "message": "update preferences.java, 03-dialog.xml", "committedDate": "2020-05-17T03:05:56Z", "type": "commit"}, {"oid": "61e60bd1c64c1c334975e52ba41264a6accb1b8d", "url": "https://github.com/ankidroid/Anki-Android/commit/61e60bd1c64c1c334975e52ba41264a6accb1b8d", "message": "Merge pull request #8 from ankidroid/master\n\nFork Update", "committedDate": "2020-05-29T06:31:05Z", "type": "commit"}, {"oid": "c738f567df10e6ea5593e28071f45ebfe284415f", "url": "https://github.com/ankidroid/Anki-Android/commit/c738f567df10e6ea5593e28071f45ebfe284415f", "message": "Added functions to card.js", "committedDate": "2020-05-30T10:10:27Z", "type": "commit"}, {"oid": "08ccbae7611b430389f469086ed23a8cd3d22109", "url": "https://github.com/ankidroid/Anki-Android/commit/08ccbae7611b430389f469086ed23a8cd3d22109", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-05-30T11:31:38Z", "type": "commit"}, {"oid": "1c8b2480426eb12b640a65e30722191f8636d908", "url": "https://github.com/ankidroid/Anki-Android/commit/1c8b2480426eb12b640a65e30722191f8636d908", "message": "Update card.js & AbstractFlashcardViewer.java\n\nAdded functions to card.js to get cards details in WebView using JS functions", "committedDate": "2020-05-30T18:56:33Z", "type": "commit"}, {"oid": "49e6567434e211ba45c1b0db1be5116be995684b", "url": "https://github.com/ankidroid/Anki-Android/commit/49e6567434e211ba45c1b0db1be5116be995684b", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-05-30T18:56:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4NzU5Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887593", "bodyText": "Can these be changed to JavascriptInterface methods: https://developer.android.com/reference/android/webkit/JavascriptInterface\nWe're currently open to accidental XSS which will break cards JS", "author": "david-allison-1", "createdAt": "2020-05-30T21:09:01Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3135,6 +3181,13 @@ public void onPageFinished(WebView view, String url) {\n             drawFlag();\n             drawMark();\n             view.loadUrl(\"javascript:onPageFinished();\");\n+\n+            // cards count, deckname, estimated time, mark, flag to be accessible in AnkiDroid WebView\n+            view.loadUrl(\"javascript:ankiGetCardCount(\" + newCount.toString() +  \",\" + lrnCount.toString() + \",\" + revCount.toString()  + \")\" );", "originalCommit": "49e6567434e211ba45c1b0db1be5116be995684b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4NzYzOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887639", "bodyText": "This needed to happen for a long time.", "author": "david-allison-1", "createdAt": "2020-05-30T21:09:31Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -176,6 +176,22 @@\n \n     protected static final int MENU_DISABLED = 3;\n \n+    // Deckname\n+    private String title;", "originalCommit": "49e6567434e211ba45c1b0db1be5116be995684b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4NzY3Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432887672", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \n          \n          \n            \n                // TODO: Consider extracting to ViewModel", "author": "david-allison-1", "createdAt": "2020-05-30T21:10:00Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -176,6 +176,22 @@\n \n     protected static final int MENU_DISABLED = 3;\n ", "originalCommit": "49e6567434e211ba45c1b0db1be5116be995684b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjg4ODI1Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432888252", "bodyText": "use executeCommand here, as this provides protection for when the card is null/controls are disabled", "author": "david-allison-1", "createdAt": "2020-05-30T21:19:12Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3022,6 +3040,34 @@ private boolean filterUrl(String url) {\n                 redrawCard();\n                 return true;\n             }\n+            // mark card using javascript\n+            if (url.startsWith(\"signal:mark_current_card\")) {\n+                onMark(mCurrentCard);", "originalCommit": "49e6567434e211ba45c1b0db1be5116be995684b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "eeb4702b226fe615f3647e95412fb9282eae4b06", "url": "https://github.com/ankidroid/Anki-Android/commit/eeb4702b226fe615f3647e95412fb9282eae4b06", "message": "Update card.js & AbstractFlashcardViewer.java", "committedDate": "2020-05-31T05:46:57Z", "type": "commit"}, {"oid": "ad189eebcc38a6250b64cf3604397918c41b2083", "url": "https://github.com/ankidroid/Anki-Android/commit/ad189eebcc38a6250b64cf3604397918c41b2083", "message": "Update card.js", "committedDate": "2020-05-31T10:23:56Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMjkzMjUzMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6307#discussion_r432932532", "bodyText": "Could you log: Timber.d that this was ignored", "author": "david-allison-1", "createdAt": "2020-05-31T10:32:17Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -3022,6 +3034,30 @@ private boolean filterUrl(String url) {\n                 redrawCard();\n                 return true;\n             }\n+            // mark card using javascript\n+            if (url.startsWith(\"signal:mark_current_card\")) {\n+                executeCommand(COMMAND_MARK);\n+                return true;\n+            }\n+            // flag card (blue, green, orange, red) using javascript from AnkiDroid webview\n+            if (url.startsWith(\"signal:\")) {\n+                String mFlag = url.replaceFirst(\"signal:\",\"\");\n+                switch (mFlag) {\n+                    case \"none\": executeCommand(COMMAND_UNSET_FLAG);\n+                        return true;\n+                    case \"red\": executeCommand(COMMAND_TOGGLE_FLAG_RED);\n+                        return true;\n+                    case \"orange\": executeCommand(COMMAND_TOGGLE_FLAG_ORANGE);\n+                        return true;\n+                    case \"green\": executeCommand(COMMAND_TOGGLE_FLAG_GREEN);\n+                        return true;\n+                    case \"blue\": executeCommand(COMMAND_TOGGLE_FLAG_BLUE);\n+                        return true;\n+                    default:\n+                        return true;", "originalCommit": "ad189eebcc38a6250b64cf3604397918c41b2083", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "b8d79d20475434a14c97bd200666a51ed977713c", "url": "https://github.com/ankidroid/Anki-Android/commit/b8d79d20475434a14c97bd200666a51ed977713c", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-05-31T10:39:11Z", "type": "commit"}, {"oid": "089a20e91679fe3e7e08ec4dff634bd58079018f", "url": "https://github.com/ankidroid/Anki-Android/commit/089a20e91679fe3e7e08ec4dff634bd58079018f", "message": "Update card.js", "committedDate": "2020-05-31T11:33:15Z", "type": "commit"}, {"oid": "d3f035e5a1b3fc679c030adc2317451aa42faa95", "url": "https://github.com/ankidroid/Anki-Android/commit/d3f035e5a1b3fc679c030adc2317451aa42faa95", "message": "Update card.js", "committedDate": "2020-05-31T12:24:57Z", "type": "commit"}, {"oid": "2edeb68fc1ada10dc97dd411fe1c8c1219a6f36e", "url": "https://github.com/ankidroid/Anki-Android/commit/2edeb68fc1ada10dc97dd411fe1c8c1219a6f36e", "message": "Update card.js", "committedDate": "2020-06-01T09:30:35Z", "type": "commit"}, {"oid": "dddbccbdfa6dcbdda928f57b123448939fa4d870", "url": "https://github.com/ankidroid/Anki-Android/commit/dddbccbdfa6dcbdda928f57b123448939fa4d870", "message": "Update AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java\n\nCo-authored-by: david-allison-1 <62114487+david-allison-1@users.noreply.github.com>", "committedDate": "2020-06-01T19:28:06Z", "type": "commit"}]}