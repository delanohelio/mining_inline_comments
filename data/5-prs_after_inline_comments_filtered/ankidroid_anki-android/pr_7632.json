{"pr_number": 7632, "pr_title": "NF: addAll", "pr_createdAt": "2020-11-09T09:01:57Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7632", "timeline": [{"oid": "0091e93b10949cdb6c248b75f84e52d0334fcb21", "url": "https://github.com/ankidroid/Anki-Android/commit/0091e93b10949cdb6c248b75f84e52d0334fcb21", "message": "NF: addAll without functor", "committedDate": "2020-11-09T09:07:55Z", "type": "forcePushed"}, {"oid": "f1a84c3fe5bed5d959dfd54701d72dfb5bfce7b5", "url": "https://github.com/ankidroid/Anki-Android/commit/f1a84c3fe5bed5d959dfd54701d72dfb5bfce7b5", "message": "NF: addAll without functor", "committedDate": "2020-11-09T09:09:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk0OTkxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r519949917", "bodyText": "Doesn't ArrayList.addAll already exist?\nCould be simplified even further (and with an efficiency gain):\ncms = note.model().getJSONArray(\"tmpls\").toJsonObjectList()", "author": "david-allison-1", "createdAt": "2020-11-09T16:36:28Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -909,10 +910,7 @@ public void _remNotes(java.util.Collection<Long> ids) {\n \t            break;\n             default: // MODELS\n     \t        cms = new ArrayList<>();\n-                JSONArray tmpls = note.model().getJSONArray(\"tmpls\");\n-                for (JSONObject tmpl: tmpls.jsonObjectIterable()) {\n-                    cms.add(tmpl);\n-                }\n+    \t        addAll(cms, note.model().getJSONArray(\"tmpls\").jsonObjectIterable());", "originalCommit": "f1a84c3fe5bed5d959dfd54701d72dfb5bfce7b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk3Nzg0Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r519977843", "bodyText": "To be clear, the same way that I created jsonObjectIterable you want to add a method\nList<JSONObject> toJSONObjectList()\nand similarly for other type, right ?\nIt would totally work, not totally ideal when we want to add elements to an existing list, since it requires to create list to delete it immediately after, but as long as we create new elmeents, it's great.", "author": "Arthur-Milchior", "createdAt": "2020-11-09T17:10:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk0OTkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk3OTU0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r519979542", "bodyText": "To be clear, the same way that I created jsonObjectIterable you want to add a method\nList<JSONObject> toJSONObjectList()\nand similarly for other type, right ?\nIt would totally work, not totally ideal when we want to add elements to an existing list, since it requires to create list to delete it immediately after, but as long as we create new elmeents, it's great.\n\nThat's right! For this use case (and a few more) it's perfect as it allows the optimisation of setting the list size before initialisation.\n\nnot totally ideal when we want to add elements to an existing list\n\nTrue, but we have CllectionUtils.addAll for that.", "author": "david-allison-1", "createdAt": "2020-11-09T17:12:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk0OTkxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk5NzkxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r519997917", "bodyText": "As I tried to explain above, addAll can not take an iterable, it takes a collection. So I could not give anything directly from Array", "author": "Arthur-Milchior", "createdAt": "2020-11-09T17:40:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk0OTkxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1MDIwMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r519950203", "bodyText": "ditto", "author": "david-allison-1", "createdAt": "2020-11-09T16:36:53Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Utils.java", "diffHunk": "@@ -514,9 +515,7 @@ private static String _incGuid(String guid) {\n \n     public static List<Long> jsonArrayToLongList(JSONArray jsonArray) throws JSONException {\n         List<Long> ar = new ArrayList<>(jsonArray.length());\n-        for (Long l: jsonArray.longIterable()) {\n-            ar.add(l);\n-        }\n+        addAll(ar, jsonArray.longIterable());", "originalCommit": "f1a84c3fe5bed5d959dfd54701d72dfb5bfce7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxOTk1MDMxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r519950317", "bodyText": "ditto", "author": "david-allison-1", "createdAt": "2020-11-09T16:37:01Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/sync/Syncer.java", "diffHunk": "@@ -793,9 +795,7 @@ private JSONArray getTags() {\n \n     private void mergeTags(JSONArray tags) {\n         ArrayList<String> list = new ArrayList<>();\n-        for (String tag: tags.stringIterable()) {\n-            list.add(tag);\n-        }\n+        addAll(list, tags.stringIterable());", "originalCommit": "f1a84c3fe5bed5d959dfd54701d72dfb5bfce7b5", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c708f2bbedfb8c3fce225a6590a502ed55879503", "url": "https://github.com/ankidroid/Anki-Android/commit/c708f2bbedfb8c3fce225a6590a502ed55879503", "message": "NF: addAll without functor", "committedDate": "2020-11-09T17:41:17Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNjk5Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r520006996", "bodyText": "ditto from the other PR - I don't see how this is the same", "author": "david-allison-1", "createdAt": "2020-11-09T17:55:11Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1866,14 +1864,10 @@ public CheckDatabaseResult fixIntegrity(CollectionTask.ProgressCallback progress\n         ArrayList<String> problems = new ArrayList<>();\n         notifyProgress.run();\n         if (m.getInt(\"type\") == Consts.MODEL_STD) {\n-            ArrayList<Integer> ords = new ArrayList<>();\n             JSONArray tmpls = m.getJSONArray(\"tmpls\");\n-            for (JSONObject tmpl: tmpls.jsonObjectIterable()) {\n-                ords.add(tmpl.getInt(\"ord\"));\n-            }\n             // cards with invalid ordinal\n             ArrayList<Long> ids = mDb.queryLongList(\n-                    \"SELECT id FROM cards WHERE ord NOT IN \" + Utils.ids2str(ords) + \" AND nid IN ( \" +", "originalCommit": "c708f2bbedfb8c3fce225a6590a502ed55879503", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAxMDg4OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7632#discussion_r520010889", "bodyText": "You're entirely right.", "author": "Arthur-Milchior", "createdAt": "2020-11-09T18:01:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMDAwNjk5Ng=="}], "type": "inlineReview"}, {"oid": "3a1570b7ad17368f705f342a5c5b7db9553d148e", "url": "https://github.com/ankidroid/Anki-Android/commit/3a1570b7ad17368f705f342a5c5b7db9553d148e", "message": "NF: addAll without functor", "committedDate": "2020-11-09T18:01:12Z", "type": "forcePushed"}, {"oid": "3a1570b7ad17368f705f342a5c5b7db9553d148e", "url": "https://github.com/ankidroid/Anki-Android/commit/3a1570b7ad17368f705f342a5c5b7db9553d148e", "message": "NF: addAll without functor", "committedDate": "2020-11-09T18:01:12Z", "type": "forcePushed"}, {"oid": "0c29bbafaf72103e4909bb87dd25c6bdace04d82", "url": "https://github.com/ankidroid/Anki-Android/commit/0c29bbafaf72103e4909bb87dd25c6bdace04d82", "message": "NF: addTags for multiple tags", "committedDate": "2020-11-10T07:27:34Z", "type": "commit"}, {"oid": "467d92208725c275c380da62ba5889d623e6e0fc", "url": "https://github.com/ankidroid/Anki-Android/commit/467d92208725c275c380da62ba5889d623e6e0fc", "message": "NF: addAll without functor", "committedDate": "2020-11-10T07:27:34Z", "type": "commit"}, {"oid": "467d92208725c275c380da62ba5889d623e6e0fc", "url": "https://github.com/ankidroid/Anki-Android/commit/467d92208725c275c380da62ba5889d623e6e0fc", "message": "NF: addAll without functor", "committedDate": "2020-11-10T07:27:34Z", "type": "forcePushed"}]}