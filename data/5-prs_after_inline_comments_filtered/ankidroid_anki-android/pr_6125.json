{"pr_number": 6125, "pr_title": "Background Image to Deck Picker Activity from Gallery", "pr_createdAt": "2020-05-07T19:15:59Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6125", "timeline": [{"oid": "3a4a301da3dca4f6a44edef2193988bed15316ad", "url": "https://github.com/ankidroid/Anki-Android/commit/3a4a301da3dca4f6a44edef2193988bed15316ad", "message": "Add files via upload", "committedDate": "2020-03-14T09:50:07Z", "type": "commit"}, {"oid": "3e57c4ceca25bb1fec92ca743eaa98700966108f", "url": "https://github.com/ankidroid/Anki-Android/commit/3e57c4ceca25bb1fec92ca743eaa98700966108f", "message": "Update card.js", "committedDate": "2020-03-15T09:39:50Z", "type": "commit"}, {"oid": "e7e91bc09a085ffc129535442af8456f97f6dc80", "url": "https://github.com/ankidroid/Anki-Android/commit/e7e91bc09a085ffc129535442af8456f97f6dc80", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T09:41:29Z", "type": "commit"}, {"oid": "366610142dc2b93fd4a54958878b9205a9d59f52", "url": "https://github.com/ankidroid/Anki-Android/commit/366610142dc2b93fd4a54958878b9205a9d59f52", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T15:52:38Z", "type": "commit"}, {"oid": "7c5ec74a43504d5357e66dfec9b329a64c88c04f", "url": "https://github.com/ankidroid/Anki-Android/commit/7c5ec74a43504d5357e66dfec9b329a64c88c04f", "message": "Update card.js", "committedDate": "2020-03-15T15:55:06Z", "type": "commit"}, {"oid": "f8041a93bb3249736811d14659250d93a9c76ca4", "url": "https://github.com/ankidroid/Anki-Android/commit/f8041a93bb3249736811d14659250d93a9c76ca4", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T18:25:09Z", "type": "commit"}, {"oid": "f0f9331b5e8d518d7cbad7ac48cb0443c9384559", "url": "https://github.com/ankidroid/Anki-Android/commit/f0f9331b5e8d518d7cbad7ac48cb0443c9384559", "message": "Update AbstractFlashcardViewer.java", "committedDate": "2020-03-15T18:36:30Z", "type": "commit"}, {"oid": "2f4df32f4fe9551691ebe4117059d301c55fd9b4", "url": "https://github.com/ankidroid/Anki-Android/commit/2f4df32f4fe9551691ebe4117059d301c55fd9b4", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-03-15T18:36:57Z", "type": "commit"}, {"oid": "7bd146c9a8a58c5b01b73bae5400734b4e940f5b", "url": "https://github.com/ankidroid/Anki-Android/commit/7bd146c9a8a58c5b01b73bae5400734b4e940f5b", "message": "Merge pull request #1 from ankidroid/master\n\nUpdate Ankidroid forked repo - DONE", "committedDate": "2020-03-17T12:05:33Z", "type": "commit"}, {"oid": "38ccf485e82e8413146a979176eed3819481439d", "url": "https://github.com/ankidroid/Anki-Android/commit/38ccf485e82e8413146a979176eed3819481439d", "message": "Added localhost domain-config", "committedDate": "2020-04-01T06:36:27Z", "type": "commit"}, {"oid": "2b6bcf3dc2e58fa384cc9a55c701c7f942e115ca", "url": "https://github.com/ankidroid/Anki-Android/commit/2b6bcf3dc2e58fa384cc9a55c701c7f942e115ca", "message": "Merge pull request #2 from ankidroid/master\n\nUpdating Fork", "committedDate": "2020-05-07T11:39:18Z", "type": "commit"}, {"oid": "465b0a20c6a12b8cae48c4825dcad000aba38688", "url": "https://github.com/ankidroid/Anki-Android/commit/465b0a20c6a12b8cae48c4825dcad000aba38688", "message": "Anki", "committedDate": "2020-05-07T18:41:31Z", "type": "commit"}, {"oid": "30863ff6ccd14c27375a786629d48a0175b991b6", "url": "https://github.com/ankidroid/Anki-Android/commit/30863ff6ccd14c27375a786629d48a0175b991b6", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-05-07T18:41:47Z", "type": "commit"}, {"oid": "7df6d450273f46b457b846f3a7daf7a19f61b52c", "url": "https://github.com/ankidroid/Anki-Android/commit/7df6d450273f46b457b846f3a7daf7a19f61b52c", "message": "Merge pull request #3 from ankidroid/master\n\nRevert \"don't put \"undo\" to color enabled\"", "committedDate": "2020-05-07T18:45:03Z", "type": "commit"}, {"oid": "e3045d9c618e2f3dc0cfe4f322b9b64d6de3498c", "url": "https://github.com/ankidroid/Anki-Android/commit/e3045d9c618e2f3dc0cfe4f322b9b64d6de3498c", "message": "Update", "committedDate": "2020-05-07T18:57:46Z", "type": "commit"}, {"oid": "955285abd863193bf0c70ab1436ba7d9ec70c770", "url": "https://github.com/ankidroid/Anki-Android/commit/955285abd863193bf0c70ab1436ba7d9ec70c770", "message": "Update Preferences.java", "committedDate": "2020-05-07T19:00:37Z", "type": "commit"}, {"oid": "a9ef4310bd195d21efbc9be8dd419cc4122a682a", "url": "https://github.com/ankidroid/Anki-Android/commit/a9ef4310bd195d21efbc9be8dd419cc4122a682a", "message": "Merge branch 'master' of https://github.com/infinyte7/Anki-Android", "committedDate": "2020-05-07T19:01:55Z", "type": "commit"}, {"oid": "91574092619fc3adc061e147930a4d565638d8ec", "url": "https://github.com/ankidroid/Anki-Android/commit/91574092619fc3adc061e147930a4d565638d8ec", "message": "Update preferences_appearance.xml", "committedDate": "2020-05-07T19:03:35Z", "type": "commit"}, {"oid": "46d7fc5616561e625e72ee3164edfd27a7c19669", "url": "https://github.com/ankidroid/Anki-Android/commit/46d7fc5616561e625e72ee3164edfd27a7c19669", "message": "update", "committedDate": "2020-05-07T19:36:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTgyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739829", "bodyText": "extract resource", "author": "david-allison-1", "createdAt": "2020-05-07T19:25:16Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTg5Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421739893", "bodyText": "ditto - extract resource", "author": "david-allison-1", "createdAt": "2020-05-07T19:25:25Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NjUwNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421756506", "bodyText": "I have extracted file path.\nI will make it extract resources then put it Ankidroid directory.", "author": "infinyte7", "createdAt": "2020-05-07T19:55:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTczOTg5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDI1OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740258", "bodyText": "At the very least, needs Timber.e logging", "author": "david-allison-1", "createdAt": "2020-05-07T19:26:06Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDU1Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740557", "bodyText": "Would be ideal to include the localised exception in the toast string", "author": "david-allison-1", "createdAt": "2020-05-07T19:26:31Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Toast.makeText(this, \"Something went wrong\", Toast.LENGTH_LONG).show();", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MDkyNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421740924", "bodyText": "Would be best to remove commented code", "author": "david-allison-1", "createdAt": "2020-05-07T19:27:11Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTQ2Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421741462", "bodyText": "PERF: Use string formatting in Timber rather than concatenation", "author": "david-allison-1", "createdAt": "2020-05-07T19:28:12Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {\n+                        preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                        backgroundImage.setChecked(false);\n+                    } else {\n+                        Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                        startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                        backgroundImage.setChecked(true);\n+                        Timber.i(\"Image added!\" + imgPathString);", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MTkzOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421741939", "bodyText": "Need to handle the case where this throws as the activity isn't found", "author": "david-allison-1", "createdAt": "2020-05-07T19:29:00Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {\n+                        preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                        backgroundImage.setChecked(false);\n+                    } else {\n+                        Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                        startActivityForResult(galleryIntent, RESULT_LOAD_IMG);", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MjA4NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421742084", "bodyText": "Nit: bracket placement", "author": "david-allison-1", "createdAt": "2020-05-07T19:29:15Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +246,21 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if ( backgroundImage.isChecked()) {", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NDc1OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421754758", "bodyText": "Okay", "author": "infinyte7", "createdAt": "2020-05-07T19:52:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MjA4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mjc2OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421742768", "bodyText": "What's the purpose of this? Mostly the static declaration and the default value? Feels like it'd be better as an instance variable", "author": "david-allison-1", "createdAt": "2020-05-07T19:30:37Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +112,8 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private static String imgPathString = \"default\";", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NTY5MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421755690", "bodyText": "To be updated.", "author": "infinyte7", "createdAt": "2020-05-07T19:53:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mjc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0MzU1Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743557", "bodyText": "Nit (arguable): Would be useful to extract this to a method", "author": "david-allison-1", "createdAt": "2020-05-07T19:32:07Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743844", "bodyText": "Is there a constant which can be used here?", "author": "david-allison-1", "createdAt": "2020-05-07T19:32:39Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NDEyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421754129", "bodyText": "If user remove image then file path string assigned \"default\".\nSo i used 0 or null to remove background.\n(Stackoverflow approach).", "author": "infinyte7", "createdAt": "2020-05-07T19:51:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1ODQ2NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421758464", "bodyText": "Agreed, https://developer.android.com/reference/android/content/res/Resources#ID_NULL was introduced in API 29... we have a long wait before we can use it.", "author": "david-allison-1", "createdAt": "2020-05-07T19:58:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzg0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzk4Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421743982", "bodyText": "This needs to gracefully handle exceptions. Ideally wrap in an exception handler", "author": "david-allison-1", "createdAt": "2020-05-07T19:32:53Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1NDQ3MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421754470", "bodyText": "I will update it.", "author": "infinyte7", "createdAt": "2020-05-07T19:51:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0Mzk4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDU2MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421744561", "bodyText": "I /think/ we already target version 15, so this is unnecessary. Happy to be proven wrong.", "author": "david-allison-1", "createdAt": "2020-05-07T19:33:57Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc1MDY3MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421750671", "bodyText": "Yes, minSdkVersion is 15 right now - for Android apps this is set in the build.gradle you can see it there for reference", "author": "mikehardy", "createdAt": "2020-05-07T19:45:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDU2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NDk3MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421744970", "bodyText": "or null", "author": "david-allison-1", "createdAt": "2020-05-07T19:34:38Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -390,6 +394,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         setContentView(R.layout.homescreen);\n         View mainView = findViewById(android.R.id.content);\n \n+        //Add background to Deckpicker activity\n+        String pathName = preferences.getString(\"deck_background_path\",\"\");\n+        View view = findViewById(R.id.root_layout);\n+        //Toast.makeText(this, pathName, Toast.LENGTH_LONG).show();\n+        if (pathName == \"default\" || pathName == \"\") {", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTc0NTQxOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r421745419", "bodyText": "\"You haven't picked an image\"", "author": "david-allison-1", "createdAt": "2020-05-07T19:35:28Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +392,31 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                //Toast.makeText(this, imgPathString, Toast.LENGTH_LONG).show();\n+                Timber.i(imgPathString);\n+                preferences.edit().putString(\"deck_background_path\", imgPathString);\n+                preferences.edit().apply();\n+                Timber.i(imgPathString);\n+                cursor.close();\n+            } else {\n+                Toast.makeText(this, \"You haven't picked Image\", Toast.LENGTH_LONG).show();", "originalCommit": "91574092619fc3adc061e147930a4d565638d8ec", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ae832792d6acce358da70329161103ba215cc98f", "url": "https://github.com/ankidroid/Anki-Android/commit/ae832792d6acce358da70329161103ba215cc98f", "message": "update", "committedDate": "2020-05-08T05:52:44Z", "type": "commit"}, {"oid": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "url": "https://github.com/ankidroid/Anki-Android/commit/25aac571d064bb849f01cfd59e895c2d8b13ce2c", "message": "Update DeckPicker.java", "committedDate": "2020-05-08T06:02:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNjk1OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422006959", "bodyText": "Wrap this in a try...catch", "author": "david-allison-1", "createdAt": "2020-05-08T08:06:46Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzAxMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007010", "bodyText": "Fairly sure this is dead code", "author": "david-allison-1", "createdAt": "2020-05-08T08:06:55Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +472,22 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(SharedPreferences preferences) {\n+        String pathName = preferences.getString(\"deck_background_path\",\"default\");\n+        View view = findViewById(R.id.root_layout);\n+        if (\"default\".equals(pathName)) {\n+            view.setBackgroundResource(0);\n+        } else {\n+            Resources res = getResources();\n+            Bitmap bitmap = BitmapFactory.decodeFile(pathName);\n+            BitmapDrawable bd = new BitmapDrawable(res, bitmap);\n+            view = findViewById(R.id.root_layout);\n+            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzNDM0Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422134342", "bodyText": "I have updated it. with\nDrawable drawable = Drawable.createFromPath(imgFile.getAbsolutePath());\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {\n     view.setBackground(drawable);\n}\nif not using if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) \nandroid studio showing error.", "author": "infinyte7", "createdAt": "2020-05-08T13:12:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzAxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzEyNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007124", "bodyText": "private static final", "author": "david-allison-1", "createdAt": "2020-05-08T08:07:12Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwNzQ5Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422007497", "bodyText": "Use a method for path concat (I think Java uses new File(a, b))", "author": "david-allison-1", "createdAt": "2020-05-08T08:08:14Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwODk2NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422008964", "bodyText": "(for discussion): We risk polluting the Anki Directory with dead images.\nIdeally pick a static filename and place it there to overwrite.\nThis could also mean that we get rid of the preference if the path is known", "author": "david-allison-1", "createdAt": "2020-05-08T08:11:36Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzMzQ1MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422133450", "bodyText": "yes, Now file name is fixed. DeckPickerBackground.png. If it exist in directory then the image will set as background.", "author": "infinyte7", "createdAt": "2020-05-08T13:10:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwODk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAwOTI2Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422009263", "bodyText": "Best to let it throw if the directory isn't found", "author": "david-allison-1", "createdAt": "2020-05-08T08:12:14Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDU4OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422010589", "bodyText": "Just confirming there's no compiler warnings around here from Android API levels, this looks suspect.", "author": "david-allison-1", "createdAt": "2020-05-08T08:15:08Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzOTg1OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422139858", "bodyText": "Not showing any compiler error.", "author": "infinyte7", "createdAt": "2020-05-08T13:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDU4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMDc3MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422010771", "bodyText": "You'll need to catch OutOfMemoryError here, I believe.\nErrors in java don't inherit from Exception", "author": "david-allison-1", "createdAt": "2020-05-08T08:15:32Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTE3Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011173", "bodyText": "UIUtils.showThemedToast is a little more standard", "author": "david-allison-1", "createdAt": "2020-05-08T08:16:24Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTQ5Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011496", "bodyText": "Ideally show this to the user, e.getLocalisedMessage()", "author": "david-allison-1", "createdAt": "2020-05-08T08:17:03Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n+            } else {\n+                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();\n+            }\n+        } catch (Exception e) {\n+            Timber.e(\"Error copying file %s\",e.toString());", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMTc3Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422011776", "bodyText": "You should be able to extract this to a resource via \"Alt+Enter\" in Android Studio, move it to \"03-dialogs.xml\"", "author": "david-allison-1", "createdAt": "2020-05-08T08:17:45Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n+            } else {\n+                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n+                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMjg2Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422012863", "bodyText": "\u26a0\ufe0f Security: You need to confirm that the path is rooted on currentAnkiDroidDirectory, otherwise this will let a user who has access to an image picker escalate to having write access on the user's external storage.\nFor example: ../../filename.apk would be malicious input\nThis would be best fixed by writing to a static well-known location, as suggested above.", "author": "david-allison-1", "createdAt": "2020-05-08T08:20:13Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzMxMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013310", "bodyText": "Again, best to extract to a resource so this can be translated, see below for instructions", "author": "david-allison-1", "createdAt": "2020-05-08T08:21:15Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n+                   destChannel  = new FileOutputStream(destFile).getChannel();\n+                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                } finally {\n+                    if (sourceChannel != null) {\n+                        sourceChannel.close();\n+                    }\n+                    if (destChannel != null) {\n+                        destChannel.close();\n+                    }\n+                }\n+                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzgwMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013803", "bodyText": "Probably best for Timber.v with a little context here", "author": "david-allison-1", "createdAt": "2020-05-08T08:22:22Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxMzk4NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422013984", "bodyText": "You can use try with resources here", "author": "david-allison-1", "createdAt": "2020-05-08T08:22:46Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNDYyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422014629", "bodyText": "(nit): You can just use ex here, Timber will perform .toString() internally, which can reduce execution time.", "author": "david-allison-1", "createdAt": "2020-05-08T08:24:09Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNDgxNQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422014815", "bodyText": "Best to display failure to the user, ideally with the exception message.", "author": "david-allison-1", "createdAt": "2020-05-08T08:24:35Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTA3Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015073", "bodyText": "Can be converted to a local variable", "author": "david-allison-1", "createdAt": "2020-05-08T08:25:10Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private String imgPathString = \"default\";", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTU0NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015545", "bodyText": "Can also be converted to 2 local variables", "author": "david-allison-1", "createdAt": "2020-05-08T08:26:15Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -108,7 +114,9 @@\n     private static final String [] sCollectionPreferences = {\"showEstimates\", \"showProgress\",\n             \"learnCutoff\", \"timeLimit\", \"useCurrent\", \"newSpread\", \"dayOffset\", \"schedVer\"};\n \n-\n+    private static int RESULT_LOAD_IMG = 111;\n+    private String imgPathString = \"default\";\n+    private String copyImagePathString = \"default\";", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxNTYxMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422015612", "bodyText": "copyImagePathString can be inline here.", "author": "david-allison-1", "createdAt": "2020-05-08T08:26:25Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());\n+                        }\n+                    } else {\n+                        copyImagePathString = \"default\";\n+                        preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxODM1NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422018354", "bodyText": "This won't handle external images (from Google Drive). You'll want to use openInputStream. Feel free to copy: https://github.com/ankidroid/Anki-Android/pull/5982/files#diff-f57ce86b452ff02ca83e914fd192964dR19", "author": "david-allison-1", "createdAt": "2020-05-08T08:32:36Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMDk3MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422120971", "bodyText": "I didn't understand this.", "author": "infinyte7", "createdAt": "2020-05-08T12:42:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxODM1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAxOTE3NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422019174", "bodyText": "needs to be translatable via a resource", "author": "david-allison-1", "createdAt": "2020-05-08T08:34:23Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +249,25 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.toString());\n+                        }\n+                    } else {\n+                        copyImagePathString = \"default\";\n+                        preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n+                        backgroundImage.setChecked(false);\n+                        Toast.makeText(this, \"Background image removed\", Toast.LENGTH_LONG).show();", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjAzMzc4Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422033783", "bodyText": "Can be condensed to:\ntry (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel(); \n     FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n    destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n}", "author": "david-allison-1", "createdAt": "2020-05-08T09:06:43Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +399,57 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Uri selectedImage = data.getData();\n+                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                cursor.moveToFirst();\n+                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                imgPathString = cursor.getString(columnIndex);\n+                cursor.close();\n+                Timber.e(imgPathString);\n+                File sourceFile = new File(imgPathString);\n+\n+                String imgName = sourceFile.getName();\n+                String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+\n+                File destFile = new File(copyImagePathString);\n+                if (!destFile.getParentFile().exists())\n+                    destFile.getParentFile().mkdirs();\n+                if (!destFile.exists()) {\n+                    destFile.createNewFile();\n+                }\n+\n+                FileChannel sourceChannel = null;\n+                FileChannel destChannel = null;\n+                try {\n+                   sourceChannel  = new FileInputStream(sourceFile).getChannel();", "originalCommit": "25aac571d064bb849f01cfd59e895c2d8b13ce2c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "333008cf0e4b7eaa73c02d013f12e24e096e835e", "url": "https://github.com/ankidroid/Anki-Android/commit/333008cf0e4b7eaa73c02d013f12e24e096e835e", "message": "Background Image", "committedDate": "2020-05-08T12:35:00Z", "type": "commit"}, {"oid": "5871b34b2f930a78e7146bdd4915eb5d2231e037", "url": "https://github.com/ankidroid/Anki-Android/commit/5871b34b2f930a78e7146bdd4915eb5d2231e037", "message": "Update DeckPicker.java", "committedDate": "2020-05-08T12:38:11Z", "type": "commit"}, {"oid": "47a1c6f60e968142e6365f8438da3b7855d0234c", "url": "https://github.com/ankidroid/Anki-Android/commit/47a1c6f60e968142e6365f8438da3b7855d0234c", "message": "Update Preferences.java", "committedDate": "2020-05-08T12:44:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTA4OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121088", "bodyText": "(nit): Move to finally block to ensure disposal:\nif (cursor != null) { \n    cursor.close(); \n}", "author": "david-allison-1", "createdAt": "2020-05-08T12:43:06Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();", "originalCommit": "333008cf0e4b7eaa73c02d013f12e24e096e835e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121393", "bodyText": "You probably want a return; + Toast here", "author": "david-allison-1", "createdAt": "2020-05-08T12:43:49Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "originalCommit": "333008cf0e4b7eaa73c02d013f12e24e096e835e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzMDUyNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422130527", "bodyText": "No, I put ; mistakenly.", "author": "infinyte7", "createdAt": "2020-05-08T13:04:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzOTYwNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422139604", "bodyText": "I'm under the impression that new File(imgPathString) would fail if this throws an exception, is there a reason to continue?", "author": "david-allison-1", "createdAt": "2020-05-08T13:22:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE0MzIwMA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422143200", "bodyText": "Oh, I understood it.", "author": "infinyte7", "createdAt": "2020-05-08T13:29:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjE2NTUzNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422165537", "bodyText": "I tried this.\nUri selectedImage = data.getData();\nString imgPath = selectedImage.getPath();\nBut not getting correct path.\nSo I am using this\nString imgPathString = cursor.getString(columnIndex);\nFile sourceFile = new File(imgPathString);\nand copying it Ankidroid Directory.", "author": "infinyte7", "createdAt": "2020-05-08T14:11:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTM5Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEyMTYxOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422121619", "bodyText": "| Exception, gotta catch 'em all ;)", "author": "david-allison-1", "createdAt": "2020-05-08T12:44:27Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -402,52 +409,36 @@ private void initSubscreen(String action, PreferenceContext listener) {\n     @Override\n     protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n         super.onActivityResult(requestCode, resultCode, data);\n-        SharedPreferences preferences = AnkiDroidApp.getSharedPrefs(getBaseContext());\n+        String imgPathString = \"\";\n         try {\n             if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n-                Uri selectedImage = data.getData();\n-                String[] filePathColumn = { MediaStore.Images.Media.DATA };\n-                Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n-                cursor.moveToFirst();\n-                int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n-                imgPathString = cursor.getString(columnIndex);\n-                cursor.close();\n-                Timber.e(imgPathString);\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    Cursor cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    imgPathString = cursor.getString(columnIndex);\n+                    cursor.close();\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());\n+                };\n+                Timber.v(imgPathString);\n                 File sourceFile = new File(imgPathString);\n-\n-                String imgName = sourceFile.getName();\n                 String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n-                copyImagePathString = currentAnkiDroidDirectory + \"/\" + imgName;\n+                String imageName = \"DeckPickerBackground.png\";\n+                File destFile = new File(currentAnkiDroidDirectory, imageName);\n \n-                File destFile = new File(copyImagePathString);\n-                if (!destFile.getParentFile().exists())\n-                    destFile.getParentFile().mkdirs();\n-                if (!destFile.exists()) {\n-                    destFile.createNewFile();\n-                }\n-\n-                FileChannel sourceChannel = null;\n-                FileChannel destChannel = null;\n-                try {\n-                   sourceChannel  = new FileInputStream(sourceFile).getChannel();\n-                   destChannel  = new FileOutputStream(destFile).getChannel();\n-                   destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n-                } finally {\n-                    if (sourceChannel != null) {\n-                        sourceChannel.close();\n-                    }\n-                    if (destChannel != null) {\n-                        destChannel.close();\n-                    }\n+                try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                     FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                    destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                    UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n                 }\n-                preferences.edit().putString(\"deck_background_path\", copyImagePathString).apply();\n-                Toast.makeText(this, \"Background image applied\", Toast.LENGTH_LONG).show();\n             } else {\n-                preferences.edit().putString(\"deck_background_path\", \"default\").apply();\n-                Toast.makeText(this, \"You haven't picked any image\", Toast.LENGTH_LONG).show();\n+                UIUtils.showThemedToast(this, getString(R.string.no_image_selected), false);\n             }\n-        } catch (Exception e) {\n-            Timber.e(\"Error copying file %s\",e.toString());\n+        } catch (OutOfMemoryError | IOException e) {", "originalCommit": "333008cf0e4b7eaa73c02d013f12e24e096e835e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "829d14f4ae422a1a45a04980735caf75147a153a", "url": "https://github.com/ankidroid/Anki-Android/commit/829d14f4ae422a1a45a04980735caf75147a153a", "message": "Update DeckPicker.java", "committedDate": "2020-05-08T12:48:30Z", "type": "commit"}, {"oid": "5e7d40de9633ad992bdc271f68857515ec934d2b", "url": "https://github.com/ankidroid/Anki-Android/commit/5e7d40de9633ad992bdc271f68857515ec934d2b", "message": "Update 03-dialogs.xml\n\nPrefrences.java\n03-dialogs.xml\nUpdated", "committedDate": "2020-05-08T13:00:59Z", "type": "commit"}, {"oid": "f5a04d4e6144e98ebbae8fa816752aa0f0231ac4", "url": "https://github.com/ankidroid/Anki-Android/commit/f5a04d4e6144e98ebbae8fa816752aa0f0231ac4", "message": "Update Preferences.java", "committedDate": "2020-05-08T13:07:57Z", "type": "commit"}, {"oid": "60a4ff0790aff50a34b21fb2ea498854e55574c3", "url": "https://github.com/ankidroid/Anki-Android/commit/60a4ff0790aff50a34b21fb2ea498854e55574c3", "message": "Update Preferences.java", "committedDate": "2020-05-08T13:58:32Z", "type": "commit"}, {"oid": "f1d46028367f813c99febe0d3c13b4e87dad030b", "url": "https://github.com/ankidroid/Anki-Android/commit/f1d46028367f813c99febe0d3c13b4e87dad030b", "message": "Update DeckPicker.java", "committedDate": "2020-05-09T14:54:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTkxMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525913", "bodyText": "Could you wrap the content of applyDeckPickerBackground in a try...catch so we don't kill the app if it fails", "author": "david-allison-1", "createdAt": "2020-05-09T17:54:47Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -466,6 +475,19 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n         }\n     }\n \n+    private void applyDeckPickerBackground(View view) {\n+        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);", "originalCommit": "f1d46028367f813c99febe0d3c13b4e87dad030b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNTk1NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422525954", "bodyText": "nit: spacing of the ifs", "author": "david-allison-1", "createdAt": "2020-05-09T17:55:06Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -241,6 +248,32 @@ private void initSubscreen(String action, PreferenceContext listener) {\n             case \"com.ichi2.anki.prefs.appearance\":\n                 listener.addPreferencesFromResource(R.xml.preferences_appearance);\n                 screen = listener.getPreferenceScreen();\n+                CheckBoxPreference backgroundImage = (CheckBoxPreference) screen.findPreference(\"deckPickerBackground\");\n+                backgroundImage.setOnPreferenceClickListener(preference -> {\n+                    if (backgroundImage.isChecked()) {\n+                        try {\n+                            Intent galleryIntent = new Intent(Intent.ACTION_PICK,android.provider.MediaStore.Images.Media.EXTERNAL_CONTENT_URI);\n+                            startActivityForResult(galleryIntent, RESULT_LOAD_IMG);\n+                            backgroundImage.setChecked(true);\n+                        } catch (Exception ex) {\n+                            Timber.e(\"%s\",ex.getLocalizedMessage());\n+                        }\n+                    } else {\n+                        backgroundImage.setChecked(false);\n+                        String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                        File imgFile = new File(currentAnkiDroidDirectory, \"DeckPickerBackground.png\" );\n+                        if(imgFile.exists()) {\n+                            if(imgFile.delete()) {", "originalCommit": "f1d46028367f813c99febe0d3c13b4e87dad030b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjE5Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526193", "bodyText": "Nit: moving these two lines up (so cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null); is the first line after the brace will allow Android Studio to convert this to try with resources and reduce code size", "author": "david-allison-1", "createdAt": "2020-05-09T17:57:32Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };", "originalCommit": "f1d46028367f813c99febe0d3c13b4e87dad030b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjU2Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526563", "bodyText": "This exception will be better handled in the outer exception handler, best to remove this catch block", "author": "david-allison-1", "createdAt": "2020-05-09T18:00:36Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    String imgPathString = cursor.getString(columnIndex);\n+                    File sourceFile = new File(imgPathString);\n+\n+                    String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                    String imageName = \"DeckPickerBackground.png\";\n+                    File destFile = new File(currentAnkiDroidDirectory, imageName);\n+\n+                    try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                         FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                        destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                        UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n+                    }\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());", "originalCommit": "f1d46028367f813c99febe0d3c13b4e87dad030b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjY2NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526665", "bodyText": "Exception strings can be formatted:\nUIUtils.showThemedToast(this, getString(R.string.error_selecting_image, e.getLocalizedMessage()), false);\nThen add a %s into the resource", "author": "david-allison-1", "createdAt": "2020-05-09T18:01:30Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);\n+                    cursor.moveToFirst();\n+                    int columnIndex = cursor.getColumnIndex(filePathColumn[0]);\n+                    String imgPathString = cursor.getString(columnIndex);\n+                    File sourceFile = new File(imgPathString);\n+\n+                    String currentAnkiDroidDirectory = CollectionHelper.getCurrentAnkiDroidDirectory(this);\n+                    String imageName = \"DeckPickerBackground.png\";\n+                    File destFile = new File(currentAnkiDroidDirectory, imageName);\n+\n+                    try (FileChannel sourceChannel = new FileInputStream(sourceFile).getChannel();\n+                         FileChannel destChannel = new FileOutputStream(destFile).getChannel()) {\n+                        destChannel.transferFrom(sourceChannel, 0, sourceChannel.size());\n+                        UIUtils.showThemedToast(this, getString(R.string.background_image_applied), false);\n+                    }\n+                } catch (Exception ex1) {\n+                    Timber.e(\"%s\",ex1.getLocalizedMessage());\n+                } finally {\n+                    if (cursor != null) {\n+                        cursor.close();\n+                    }\n+                }\n+            } else {\n+                UIUtils.showThemedToast(this, getString(R.string.no_image_selected), false);\n+            }\n+        } catch (OutOfMemoryError | Exception e) {\n+            UIUtils.showThemedToast(this, getString(R.string.error_selecting_image), false);", "originalCommit": "f1d46028367f813c99febe0d3c13b4e87dad030b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjUyNjg2MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422526860", "bodyText": "Could you leave a comment here:\nDEFECT #5973: Does not handle Google Drive downloads", "author": "david-allison-1", "createdAt": "2020-05-09T18:03:18Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -372,6 +405,44 @@ private void initSubscreen(String action, PreferenceContext listener) {\n         }\n     }\n \n+    @Override\n+    protected void onActivityResult(int requestCode, int resultCode, Intent data) {\n+        super.onActivityResult(requestCode, resultCode, data);\n+        try {\n+            if (requestCode == RESULT_LOAD_IMG && resultCode == RESULT_OK && null != data) {\n+                Cursor cursor = null;\n+                try {\n+                    Uri selectedImage = data.getData();\n+                    String[] filePathColumn = { MediaStore.Images.Media.DATA };\n+                    cursor = getContentResolver().query(selectedImage, filePathColumn, null, null, null);", "originalCommit": "f1d46028367f813c99febe0d3c13b4e87dad030b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "url": "https://github.com/ankidroid/Anki-Android/commit/e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "message": "deckpicker background image", "committedDate": "2020-05-09T22:05:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjU1NTAyOA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6125#discussion_r422555028", "bodyText": "nit: Might want a Toast here", "author": "david-allison-1", "createdAt": "2020-05-09T22:39:13Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -438,6 +438,14 @@ protected void onCreate(Bundle savedInstanceState) throws SQLException {\n \n         mReviewSummaryTextView = (TextView) findViewById(R.id.today_stats_text_view);\n \n+        //Add background to Deckpicker activity\n+        View view = mFragmented ? findViewById(R.id.deckpicker_view) : findViewById(R.id.root_layout);\n+        try {\n+            applyDeckPickerBackground(view);\n+        } catch (Exception e) {\n+            Timber.e(e,\"Background image apply failed\" );", "originalCommit": "e60944353d6b9fc10ea86360db4ca4c9dbc6b7f7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3dc19a5c833b782c107e408aa239b13ab71d995a", "url": "https://github.com/ankidroid/Anki-Android/commit/3dc19a5c833b782c107e408aa239b13ab71d995a", "message": "update Deckpicker.java", "committedDate": "2020-05-09T22:52:51Z", "type": "commit"}, {"oid": "e2ceb64bcc0ab6a6dbc4c2002976e7320845a2ae", "url": "https://github.com/ankidroid/Anki-Android/commit/e2ceb64bcc0ab6a6dbc4c2002976e7320845a2ae", "message": "update 03-dialogs.xml", "committedDate": "2020-05-09T23:11:58Z", "type": "commit"}]}