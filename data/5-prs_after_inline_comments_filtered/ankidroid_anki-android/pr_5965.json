{"pr_number": 5965, "pr_title": "Remove sublist from Decks.parents", "pr_createdAt": "2020-04-10T12:14:40Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5965", "timeline": [{"oid": "3f2321cf08d89966f407951d5093a47b10873de5", "url": "https://github.com/ankidroid/Anki-Android/commit/3f2321cf08d89966f407951d5093a47b10873de5", "message": "Remove sublist from Decks.parents\n\nI really don't understand why, but the profiler states that one and a\nhalf seconds are spent in the sublist iterator. So I remove it and do\na direct access. I believe that the little increase in code complexity\nis not worth so much time", "committedDate": "2020-04-10T08:55:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTA1MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5965#discussion_r406875050", "bodyText": "I don't think the two operations are doing the same thing, and I read the ankitects/upstream code\nThe value of 'part' will be different as the iteration happens for size >= 2. In the original implementation it will be like A::B if i == 2, but in your proposal part will be B.\nSo something different will be added to parents - it will be full of non-fully-pathed deck names instead of fully pathed ones. I don't think that's correct", "author": "mikehardy", "createdAt": "2020-04-10T18:04:59Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -932,7 +932,8 @@ private void gather(HashMap<Long, HashMap> node, List<Long> arr) {\n         // get parent and grandparent names\n         List<String> parents = new ArrayList<>();\n         List<String> parts = Arrays.asList(get(did).getString(\"name\").split(\"::\", -1));\n-        for (String part : parts.subList(0, parts.size() - 1)) {\n+        for (int i = 0; i < parts.size() - 1; i++) {", "originalCommit": "3f2321cf08d89966f407951d5093a47b10873de5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkwMTUzMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/5965#discussion_r406901533", "bodyText": "I am extremely sorry @mikehardy but I don't understand your message at all.\n\nI don't think the two operations are doing the same thing\n\nWhich are the two operations you are referring to ?\u00a0\nfor (String part : parts.subList(0, parts.size() - 1)) {\nand\nfor (int i = 0; i < parts.size() - 1; i++) {\nString part = parts.get(i);\nIn which case, I don't see why you are making a refernece to upstream code, since it's not any of the two code.\nparts.subList(0, parts.size() - 1) is essentially a list equals to parts without its last elements. So iterating over all elements of parts except the last one is the same thing as iterating over the sublist.", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:11:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkwNTYyMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5965#discussion_r406905622", "bodyText": "On \"A::B\", parts is the array {\"A\", \"B\"}. so parts.size() is 2 and parts.size()-1 is 1, so parts.sublist(0, parts.size()-1)) equals parts.sublist(0,1) which is the sublist \"{A}\"\nSo the previous loop was only applied once, with part equal to A.\nWith my loop, i's value is only 0 (since 1 is not less than parts.size()-1). So String take a single value, which is also \"A\"", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:22:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkwNTc0MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5965#discussion_r406905740", "bodyText": "In particular, \"i\" is never equal to \"2\" in your example", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:23:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkwNjA0NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5965#discussion_r406906045", "bodyText": "Mmm I think you're right, I think I misread it first attempt. This does exist upstream though\nhttps://github.com/ankitects/anki/blob/8b3f0100e4fc17e4810e3a2134ef728544ca552c/pylib/anki/decks.py#L597-L602\nlet me re-read", "author": "mikehardy", "createdAt": "2020-04-10T19:24:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTA1MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjkwNzQ1Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/5965#discussion_r406907456", "bodyText": "Let me be clear. I am NOT saying that we do the same thing as upstream. I am only saying that I am pretty sure that my pull request does not change what ankidroid does. If we didn't follow upstream, then I'm not correcting this. If we did follow upstream, I'm quite convinced that we are still following it.\nI'm trying to change execution time, not behaviour", "author": "Arthur-Milchior", "createdAt": "2020-04-10T19:28:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjg3NTA1MA=="}], "type": "inlineReview"}]}