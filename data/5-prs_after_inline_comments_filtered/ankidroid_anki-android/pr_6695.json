{"pr_number": 6695, "pr_title": "NF: remCards follow upstream and simplified", "pr_createdAt": "2020-07-19T02:19:37Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6695", "timeline": [{"oid": "08d9d51b6d3ee9b9d3c046936d97ed40d51cc225", "url": "https://github.com/ankidroid/Anki-Android/commit/08d9d51b6d3ee9b9d3c046936d97ed40d51cc225", "message": "NF: follow upstream name: remove_cards_and_orphaned_notes", "committedDate": "2020-07-21T04:21:26Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwMDQ5NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r456900494", "bodyText": "Would prefer collection2Array for brevity until we need another method which would conflict.", "author": "david-allison-1", "createdAt": "2020-07-19T12:05:04Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Utils.java", "diffHunk": "@@ -460,7 +461,7 @@ public static String ids2str(JSONArray ids) {\n \n \n     /** LIBANKI: not in libanki */\n-    public static long[] arrayList2array(List<Long> list) {\n+    public static long[] collectionOfLong2array(java.util.Collection<Long> list) {", "originalCommit": "9f819cd74a19a5d0f156bbb622927c828bfda4f1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODUzMzI2Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458533262", "bodyText": "Done. I'm surprised, it seems your name is confusing. But here it is", "author": "Arthur-Milchior", "createdAt": "2020-07-22T04:53:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwMDQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NDA1Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458894056", "bodyText": "I'm open to other suggestions, but this is better in my eyes, thanks!", "author": "david-allison-1", "createdAt": "2020-07-22T15:47:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NjkwMDQ5NA=="}], "type": "inlineReview"}, {"oid": "dcd073f81fc06c33cd7fefaa8f389b534100972a", "url": "https://github.com/ankidroid/Anki-Android/commit/dcd073f81fc06c33cd7fefaa8f389b534100972a", "message": "NF: follow upstream name: remove_cards_and_orphaned_notes", "committedDate": "2020-07-22T04:52:48Z", "type": "forcePushed"}, {"oid": "a9d6022519940340465a46209af80c18e310b24c", "url": "https://github.com/ankidroid/Anki-Android/commit/a9d6022519940340465a46209af80c18e310b24c", "message": "NF: follow upstream name: remove_cards_and_orphaned_notes", "committedDate": "2020-07-22T05:01:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjIzMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458896231", "bodyText": "I'd be tempted to move this into a unit test as it's only used for testing\nApparently not... could we use a Java style for the name, and state in a comment what the Python name is to allow people to grep between the two", "author": "david-allison-1", "createdAt": "2020-07-22T15:51:00Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -919,26 +914,25 @@ public int cardCount(Long[] ls) {\n     /**\n      * Bulk delete cards by ID.\n      */\n-    public void remCards(long[] ids) {\n-    \tremCards(ids, true);\n+    public void remove_cards_and_orphaned_notes(List<Long> ids) {", "originalCommit": "a9d6022519940340465a46209af80c18e310b24c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk0NjkxOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458946919", "bodyText": "We can. I thought there was an exception for name when there is a name upstream", "author": "Arthur-Milchior", "createdAt": "2020-07-22T17:04:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3MDY2OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459070668", "bodyText": "I won't do it actually. It may be worth doing comments for all name. But I don't want to spend time doing it name by name.\nThe remaining of the PR remains relevant I believe, so I just remove the renaming and keep the remaining", "author": "Arthur-Milchior", "createdAt": "2020-07-22T20:42:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjIzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA5OTgyNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459099826", "bodyText": "Actually.. if it's upstream, let's leave it as it is.", "author": "david-allison-1", "createdAt": "2020-07-22T21:40:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjIzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjUxMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458896512", "bodyText": "Note that we'll need to rebase this as this line will change", "author": "david-allison-1", "createdAt": "2020-07-22T15:51:24Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -919,26 +914,25 @@ public int cardCount(Long[] ls) {\n     /**\n      * Bulk delete cards by ID.\n      */\n-    public void remCards(long[] ids) {\n-    \tremCards(ids, true);\n+    public void remove_cards_and_orphaned_notes(List<Long> ids) {\n+        remCards(ids, true);\n     }\n-    public void remCards(long[] ids, boolean notes) {\n-        if (ids.length == 0) {\n+\n+    public void remCards(java.util.Collection<Long> ids, boolean notes) {\n+        if (ids.size() == 0) {\n             return;\n         }\n         String sids = Utils.ids2str(ids);\n-        long[] nids = Utils\n-                .arrayList2array(mDb.queryColumn(Long.class, \"SELECT nid FROM cards WHERE id IN \" + sids, 0));\n+        List<Long> nids = mDb.queryColumn(Long.class, \"SELECT nid FROM cards WHERE id IN \" + sids, 0);", "originalCommit": "a9d6022519940340465a46209af80c18e310b24c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk0NjUzNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458946534", "bodyText": "To \"rewrite\" I assume ?\u00a0Because I always need to rebase everything.", "author": "Arthur-Milchior", "createdAt": "2020-07-22T17:03:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjUxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk1OTcxOA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458959718", "bodyText": "Rebase - just a note that it didn't be merged even when approved", "author": "david-allison-1", "createdAt": "2020-07-22T17:25:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5NjUxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5ODgzNA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458898834", "bodyText": "Arrays.asList is dangerous, couldn't you use new ArrayList<> here? (also in a few other places in the review).", "author": "david-allison-1", "createdAt": "2020-07-22T15:54:38Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Decks.java", "diffHunk": "@@ -355,7 +355,7 @@ public void rem(long did, boolean cardsToo, boolean childrenToo) {\n             return;\n         }\n         // log the removal regardless of whether we have the deck or not\n-        mCol._logRem(new long[] { did }, Consts.REM_DECK);\n+        mCol._logRem(Arrays.asList(new Long[] { did }), Consts.REM_DECK);", "originalCommit": "a9d6022519940340465a46209af80c18e310b24c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk0NzE3OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r458947178", "bodyText": "I could. I never new it was dangerous. I thought it was the canonical way to do it", "author": "Arthur-Milchior", "createdAt": "2020-07-22T17:04:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5ODgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA5OTQyNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459099426", "bodyText": "If you use Arrays.asList, then perform .add(), then .add() will throw.\nI think the following (horrible) is standard Java:\nnew ArrayList<>(Arrays.asList(arr))\nWe should add a util method if at all possible", "author": "david-allison-1", "createdAt": "2020-07-22T21:39:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5ODgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExNDQ5NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459114494", "bodyText": "Still appearing as unchanged:", "author": "david-allison-1", "createdAt": "2020-07-22T22:16:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5ODgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExNTg5OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459115899", "bodyText": "Actually, if I'm sure that the list won't be changed, I don't really see a reason to avoid as List. And in both cases here, there won't be any change, the list will disappear soon anyway", "author": "Arthur-Milchior", "createdAt": "2020-07-22T22:19:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5ODgzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTExNzA3Mg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459117072", "bodyText": "I removed the one from the code, by allowing the method to accept an array. I kept the one in the tests to allow the tests to be more readable", "author": "Arthur-Milchior", "createdAt": "2020-07-22T22:22:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg5ODgzNA=="}], "type": "inlineReview"}, {"oid": "609823eac59267b89fdb11a8acf557a4278657d8", "url": "https://github.com/ankidroid/Anki-Android/commit/609823eac59267b89fdb11a8acf557a4278657d8", "message": "NF: _logRem and _remNote takes Collection instead of array\n\nThis allows to remove casting", "committedDate": "2020-07-22T20:40:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODAxNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459128017", "bodyText": "doesn't need to be fully qualified?\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public static long[] collection2Array(java.util.Collection<Long> list) {\n          \n          \n            \n                public static long[] collection2Array(Collection<Long> list) {", "author": "mikehardy", "createdAt": "2020-07-22T22:52:13Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Utils.java", "diffHunk": "@@ -460,7 +460,8 @@ public static String ids2str(JSONArray ids) {\n \n \n     /** LIBANKI: not in libanki */\n-    public static long[] arrayList2array(List<Long> list) {\n+    /** Transform a collection of Long into an array of Long */\n+    public static long[] collection2Array(java.util.Collection<Long> list) {", "originalCommit": "13f208c3eb2acedaf285a10e519c82beaad9422c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODc0MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459128741", "bodyText": "We need it, because we already have Anki Collecrion\nCom.ichi2.libanki.Collection", "author": "Arthur-Milchior", "createdAt": "2020-07-22T22:54:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODAxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODg1MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459128850", "bodyText": "Collection is typically the libAnki class, it's a common issue", "author": "david-allison-1", "createdAt": "2020-07-22T22:54:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODAxNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyODc2NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459128764", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void remCards(java.util.Collection<Long> ids, boolean notes) {\n          \n          \n            \n                public void remCards(Collection<Long> ids, boolean notes) {\n          \n      \n    \n    \n  \n\nanother fully-qualified that doesn't need to be - if we truly have a clash over the symbol 'Collection' I'd expect something other than java.util.Collection to get the fully-qualified-name treatment :-)", "author": "mikehardy", "createdAt": "2020-07-22T22:54:26Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -913,18 +913,19 @@ public int cardCount(Long[] ls) {\n     /**\n      * Bulk delete cards by ID.\n      */\n-    public void remCards(long[] ids) {\n-    \tremCards(ids, true);\n+    public void remCards(List<Long> ids) {\n+        remCards(ids, true);\n     }\n-    public void remCards(long[] ids, boolean notes) {\n-        if (ids.length == 0) {\n+\n+    public void remCards(java.util.Collection<Long> ids, boolean notes) {", "originalCommit": "1329352ca5cf3fad25a2fb4a71eb04947dee898f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyOTEyNw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459129127", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void _remNotes(java.util.Collection<Long> ids) {\n          \n          \n            \n                public void _remNotes(Collection<Long> ids) {", "author": "mikehardy", "createdAt": "2020-07-22T22:55:18Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -594,8 +594,8 @@ public void remNotes(long[] ids) {\n     /**\n      * Bulk delete notes by ID. Don't call this directly.\n      */\n-    public void _remNotes(long[] ids) {\n-        if (ids.length == 0) {\n+    public void _remNotes(java.util.Collection<Long> ids) {", "originalCommit": "609823eac59267b89fdb11a8acf557a4278657d8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyOTU2OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459129568", "bodyText": "@david-allison-1 just pointed out we have 'Collection' in libanki of course, sorry. Ignore all those.", "author": "mikehardy", "createdAt": "2020-07-22T22:56:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyOTEyNw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTEyOTE4NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6695#discussion_r459129185", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                public void _logRem(java.util.Collection<Long> ids, int type) {\n          \n          \n            \n                public void _logRem(Collection<Long> ids, int type) {", "author": "mikehardy", "createdAt": "2020-07-22T22:55:28Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -515,7 +515,7 @@ public void reset() {\n      * Deletion logging ********************************************************* **************************************\n      */\n \n-    public void _logRem(long[] ids, int type) {\n+    public void _logRem(java.util.Collection<Long> ids, int type) {", "originalCommit": "609823eac59267b89fdb11a8acf557a4278657d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "33029f3ebbf93748ed73a9ae415bc5d63425ace8", "url": "https://github.com/ankidroid/Anki-Android/commit/33029f3ebbf93748ed73a9ae415bc5d63425ace8", "message": "NF: _logRem accepts array\n\nThis way, I can remove an array->list", "committedDate": "2020-07-23T14:38:27Z", "type": "forcePushed"}, {"oid": "96ad3259fdcd50c86ef4c3a820d578a6cdc4e145", "url": "https://github.com/ankidroid/Anki-Android/commit/96ad3259fdcd50c86ef4c3a820d578a6cdc4e145", "message": "NF: Simplify remNote", "committedDate": "2020-07-23T17:03:29Z", "type": "commit"}, {"oid": "a54a6d6c2ffa6a422cb4c324e8f81a404dd1ad1b", "url": "https://github.com/ankidroid/Anki-Android/commit/a54a6d6c2ffa6a422cb4c324e8f81a404dd1ad1b", "message": "NF: arrayList2array more becomes more general", "committedDate": "2020-07-23T17:04:10Z", "type": "commit"}, {"oid": "072cd4993dd85730cc8951ebefa24bbbb57efd4f", "url": "https://github.com/ankidroid/Anki-Android/commit/072cd4993dd85730cc8951ebefa24bbbb57efd4f", "message": "NF: ids2str accepts any iterable\n\nThis does not change current code and allow to uses non list in future commits", "committedDate": "2020-07-23T17:04:10Z", "type": "commit"}, {"oid": "66b7f3e2cba1fa0bb2d4fafa90527fe4a6b69e15", "url": "https://github.com/ankidroid/Anki-Android/commit/66b7f3e2cba1fa0bb2d4fafa90527fe4a6b69e15", "message": "NF: getCardIdsForModel returns list instead of array\n\nThis avoid some useless transformation", "committedDate": "2020-07-23T17:04:10Z", "type": "commit"}, {"oid": "c0d8681cb79677ba056336de626790dc3c7509eb", "url": "https://github.com/ankidroid/Anki-Android/commit/c0d8681cb79677ba056336de626790dc3c7509eb", "message": "NF: remCards get list", "committedDate": "2020-07-23T17:13:24Z", "type": "commit"}, {"oid": "4053c124424c35bab1989e1cdb2007c8695a6f67", "url": "https://github.com/ankidroid/Anki-Android/commit/4053c124424c35bab1989e1cdb2007c8695a6f67", "message": "NF: _logRem and _remNote takes Collection instead of array\n\nThis allows to remove casting", "committedDate": "2020-07-23T17:13:24Z", "type": "commit"}, {"oid": "813f0d070ff5d8b4b7cf0e8758dfee4fd6a91792", "url": "https://github.com/ankidroid/Anki-Android/commit/813f0d070ff5d8b4b7cf0e8758dfee4fd6a91792", "message": "NF: _logRem accepts array\n\nThis way, I can remove an array->list", "committedDate": "2020-07-23T17:13:24Z", "type": "commit"}, {"oid": "813f0d070ff5d8b4b7cf0e8758dfee4fd6a91792", "url": "https://github.com/ankidroid/Anki-Android/commit/813f0d070ff5d8b4b7cf0e8758dfee4fd6a91792", "message": "NF: _logRem accepts array\n\nThis way, I can remove an array->list", "committedDate": "2020-07-23T17:13:24Z", "type": "forcePushed"}]}