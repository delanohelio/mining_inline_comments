{"pr_number": 7065, "pr_title": "Fix scrollbar's position not remembered in CardBrowser #6857", "pr_createdAt": "2020-09-12T09:30:34Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7065", "timeline": [{"oid": "39558f616d5164696b0caf45db3d25e36d9e6d62", "url": "https://github.com/ankidroid/Anki-Android/commit/39558f616d5164696b0caf45db3d25e36d9e6d62", "message": "Fix scrollbar's position not remembered in CardBrowser\n\nThe scrollbar's position is reset because, when user edits and saves a note in NoteEditor, NoteEditor sends a \"noteChanged\" event back to CardBrowser. In method onActivityResult() of CardBrowser, this event causes a reload, which resets the scrollbar position.\n\nIn this PR, I remove the \"noteChanged\" event from the list of events that cause a reload (in onActivityResult() of CardBrowser).", "committedDate": "2020-09-11T14:53:37Z", "type": "commit"}, {"oid": "08d829db883a5e769dc3fa1207a565a608094e32", "url": "https://github.com/ankidroid/Anki-Android/commit/08d829db883a5e769dc3fa1207a565a608094e32", "message": "Scroll to previously selected card", "committedDate": "2020-09-15T11:28:25Z", "type": "commit"}, {"oid": "6412267ebda550b1b7218aa8e0e48e405fa5eaf9", "url": "https://github.com/ankidroid/Anki-Android/commit/6412267ebda550b1b7218aa8e0e48e405fa5eaf9", "message": "Handle progress bar", "committedDate": "2020-09-15T11:42:15Z", "type": "commit"}, {"oid": "9c49e92370dcb0e527e93a8615681ae2c9e93dff", "url": "https://github.com/ankidroid/Anki-Android/commit/9c49e92370dcb0e527e93a8615681ae2c9e93dff", "message": "Merge branch 'master' into fix_cardbrowser_scrollbar_position_problem", "committedDate": "2020-09-30T16:02:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYyMzA4NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/7065#discussion_r497623084", "bodyText": "@tda1009 I apologize for the delay in looking at these - I want to be clear I like the purpose of this change and I'm sorry I've let it sit\nOne thing I'll note is that now if you add member variables, it's important to handle them across Activity restarts in the Android lifecycle. Specifically openNoteEditorForCard will open another Activity, and you haven't calculated the member variable values yet, nor are they put into the Bundle in onSaveInstanceState (or brought back from the bundle in onCreate)\nIf we add member state it should be calculated before launching another Activity and that onSaveInstanceState/onCreate change is required, or things will break if the user rotates their screen for instance", "author": "mikehardy", "createdAt": "2020-09-30T15:57:30Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -633,6 +637,8 @@ public void onItemClick(AdapterView<?> parent, View view, int position, long id)\n                     // load up the card selected on the list\n                     long clickedCardId = getCards().get(position).getId();\n                     openNoteEditorForCard(clickedCardId);\n+                    mOldCardId = clickedCardId;\n+                    mOldCardTopOffset = calculateTopOffset(position);", "originalCommit": "08d829db883a5e769dc3fa1207a565a608094e32", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NzYyNDkyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7065#discussion_r497624929", "bodyText": "same comment here for required handling in onSaveInstanceState/onCreate of instance variables", "author": "mikehardy", "createdAt": "2020-09-30T15:59:48Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/CardBrowser.java", "diffHunk": "@@ -224,6 +224,7 @@\n     private long mOldCardId = 0;\n     private int mOldCardTopOffset = 0;\n     private boolean mShouldRestoreScroll = false;\n+    private boolean mPostAutoScroll = false;", "originalCommit": "6412267ebda550b1b7218aa8e0e48e405fa5eaf9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c36fdc89ada2f7e24019dd81263d00dbd1aaed19", "url": "https://github.com/ankidroid/Anki-Android/commit/c36fdc89ada2f7e24019dd81263d00dbd1aaed19", "message": "Improve handling of scrolling state variables", "committedDate": "2020-10-03T10:57:54Z", "type": "commit"}]}