{"pr_number": 5798, "pr_title": "Give users more connection error information, handle cleartext failure", "pr_createdAt": "2020-03-08T16:39:10Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/5798", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMjQwNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5798#discussion_r389402406", "bodyText": "You seriously want to use a hyphen here? \ud83e\udd14\ud83d\ude05 A colon and new line character may be the way to go...?", "author": "timrae", "createdAt": "2020-03-08T20:28:35Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/DeckPicker.java", "diffHunk": "@@ -1542,6 +1542,9 @@ public void onPostExecute(Payload data) {\n                         showSyncErrorMessage(joinSyncMessages(dialogMessage, syncMessage));\n                     } else if (\"connectionError\".equals(resultType)) {\n                         dialogMessage = res.getString(R.string.sync_connection_error);\n+                        if (result.length >= 1 && result[1] instanceof Exception) {\n+                            dialogMessage += \" - \" + ((Exception)result[1]).getLocalizedMessage();", "originalCommit": "efbf5a87a52fba82ab8218319ee94f7929f84990", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0NTkyOA==", "url": "https://github.com/ankidroid/Anki-Android/pull/5798#discussion_r389445928", "bodyText": "I had a colon first but it looked silly next to the period, a newline is just the trick though. Altered it, looks much better", "author": "mikehardy", "createdAt": "2020-03-09T03:08:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMjQwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMjUyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/5798#discussion_r389402529", "bodyText": "I'm not sure how meaningful this is, as it's pretty much guaranteed to truncate in the snack bar. Maybe you want to show a dialog when there's an error and only show the snack bar when there's not.", "author": "timrae", "createdAt": "2020-03-08T20:30:15Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/MyAccount.java", "diffHunk": "@@ -200,11 +200,16 @@ public void onPostExecute(Payload data) {\n                     switchToState(STATE_LOGGED_IN);\n                 }\n             } else {\n-                Timber.e(\"Login failed, error code %d\",data.returnType);\n+                Timber.e(\"Login failed, error code %d\", data.returnType);\n                 if (data.returnType == 403) {\n                     UIUtils.showSimpleSnackbar(MyAccount.this, R.string.invalid_username_password, true);\n                 } else {\n-                    UIUtils.showSimpleSnackbar(MyAccount.this, R.string.connection_error_message, true);\n+                    String message = getResources().getString(R.string.connection_error_message);\n+                    Object[] result = (Object [])data.result;\n+                    if (result.length > 1 && result[1] instanceof Exception) {\n+                        message += \": \" + ((Exception)result[1]).getLocalizedMessage();\n+                    }\n+                    UIUtils.showSimpleSnackbar(MyAccount.this, message, false);", "originalCommit": "efbf5a87a52fba82ab8218319ee94f7929f84990", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ0NjExNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/5798#discussion_r389446116", "bodyText": "The truncation was still leaving a meaningful message and I was thinking it was better to just leave it as a snackbar but if a dialog is okay by you, that certainly gives more room - in the case where I have more information (there is an Exception in the result) now I do a dialog as suggested", "author": "mikehardy", "createdAt": "2020-03-09T03:09:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQwMjUyOQ=="}], "type": "inlineReview"}, {"oid": "35b680620b784daf27ffeee59a5c0631474a5f55", "url": "https://github.com/ankidroid/Anki-Android/commit/35b680620b784daf27ffeee59a5c0631474a5f55", "message": "Give users more connection error information, handle cleartext failure", "committedDate": "2020-03-09T03:07:32Z", "type": "commit"}, {"oid": "35b680620b784daf27ffeee59a5c0631474a5f55", "url": "https://github.com/ankidroid/Anki-Android/commit/35b680620b784daf27ffeee59a5c0631474a5f55", "message": "Give users more connection error information, handle cleartext failure", "committedDate": "2020-03-09T03:07:32Z", "type": "forcePushed"}]}