{"pr_number": 6854, "pr_title": "Time box", "pr_createdAt": "2020-08-08T18:19:39Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6854", "timeline": [{"oid": "73edba3dc55472cd0e62936e02cf65100c85d541", "url": "https://github.com/ankidroid/Anki-Android/commit/73edba3dc55472cd0e62936e02cf65100c85d541", "message": "NF: timeBoxReached return a pair", "committedDate": "2020-08-08T15:58:43Z", "type": "commit"}, {"oid": "20a5df67da752cbf4ad4bdde291bc0dca15ae9c5", "url": "https://github.com/ankidroid/Anki-Android/commit/20a5df67da752cbf4ad4bdde291bc0dca15ae9c5", "message": "NF: split dealWithTimeBox", "committedDate": "2020-08-08T17:34:45Z", "type": "commit"}, {"oid": "7c2745e7fdffa458632962670df23e08bb140e3d", "url": "https://github.com/ankidroid/Anki-Android/commit/7c2745e7fdffa458632962670df23e08bb140e3d", "message": "NF: onPreExecute call super\n\nNF mostly because super.onPreExecute do nothing", "committedDate": "2020-08-08T18:14:01Z", "type": "commit"}, {"oid": "11f98d962f2a9ad563c44608bc3b6f0e9514ae17", "url": "https://github.com/ankidroid/Anki-Android/commit/11f98d962f2a9ad563c44608bc3b6f0e9514ae17", "message": "Time box opened at correct time\n\nTime box works (upstream and here) by looking at the number of reps at the start and end of the timebox and looking at\nthe difference.\n\nIn order for this number to make sens, the timebox should be always considered BEFORE or always considered AFTER getting\na new card, and not sometime before, sometime after. I moved it so that it's always considered before. This makes sens\nanyway because you can display the toast \"you had reviewed n cards in m minutes\" while loading the next card.\n\nThis means we don't need to count the \"not found card\" as a special case. There was never any reason to count both the\ncards you get and the cards you don't get. The correction in https://github.com/ankidroid/Anki-Android/pull/834\npartially corrected it; in the sens of it corrected off-by-one error for the first time box but created a off-by-one\nerror in the other direction on next time box.\n\nThis also remove a scheduler action from the listener, which may help with avoiding leaking context", "committedDate": "2020-08-08T18:14:17Z", "type": "commit"}, {"oid": "23438e43688a2df168a30807750f8518767f459f", "url": "https://github.com/ankidroid/Anki-Android/commit/23438e43688a2df168a30807750f8518767f459f", "message": "NF: Reps modifier are protected", "committedDate": "2020-08-08T18:16:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkxODA2Nw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6854#discussion_r468918067", "bodyText": "Was this removed due to another PR?", "author": "david-allison-1", "createdAt": "2020-08-11T23:21:58Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/AbstractFlashcardViewer.java", "diffHunk": "@@ -621,19 +624,14 @@ protected void displayNext(Card nextCard) {\n                 AbstractFlashcardViewer.this.unblockControls();\n                 AbstractFlashcardViewer.this.displayCardQuestion();\n             }\n+        }\n \n-            // Since reps are incremented on fetch of next card, we will miss counting the\n-            // last rep since there isn't a next card. We manually account for it here.\n-            if (mNoMoreCards) {", "originalCommit": "23438e43688a2df168a30807750f8518767f459f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTM5MDAyOQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6854#discussion_r469390029", "bodyText": "No, in this case, it was removed because that should never had been part of the code. It solved a bug while introducing a new one.", "author": "Arthur-Milchior", "createdAt": "2020-08-12T16:32:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODkxODA2Nw=="}], "type": "inlineReview"}]}