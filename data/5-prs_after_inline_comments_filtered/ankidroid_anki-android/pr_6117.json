{"pr_number": 6117, "pr_title": "Only restricted devices require system browser", "pr_createdAt": "2020-05-06T16:36:11Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6117", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMjMwNQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420932305", "bodyText": "@david-allison-1 with apologies for the noisiness of the diff, this is the actual logic change - does it look right to you now? (only applying the \"is it a system web browser?\" check if we are restricted\nIt did pass local testing but I'm going to pick this to 2.10-release immediately after merge so a second set of eyes is \ud83e\udd47", "author": "mikehardy", "createdAt": "2020-05-06T16:37:46Z", "path": "AnkiDroid/src/main/java/com/ichi2/utils/AdaptionUtil.java", "diffHunk": "@@ -23,23 +41,16 @@ public static boolean hasWebBrowser(Context context) {\n         Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(\"http://www.google.com\"));\n         PackageManager pm = context.getPackageManager();\n         List<ResolveInfo> list = pm.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);\n-        if (list.size() == 0) {\n-            sHasWebBrowser = false;\n-        } else {\n-            sHasWebBrowser = false;\n-            for (ResolveInfo ri:list) {\n-                String pacagename = ri.activityInfo.packageName;\n-                if (isSystemApp(pacagename, pm)) {\n-                    sHasWebBrowser = true;\n-                    break;\n-                }\n-            }\n+        sHasWebBrowser = false;\n+        for (ResolveInfo ri : list) {\n+            sHasWebBrowser = !isRestrictedLearningDevice() || isSystemApp(ri.activityInfo.packageName, pm);\n+            break;\n         }", "originalCommit": "e8f02fbb62257a0fdb6b187517792fd1e284cba0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMjc1MQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420932751", "bodyText": "Note the system API to queryIntentActivities is guaranteed to return empty list / nonnull if there are no handlers, that's important :)", "author": "mikehardy", "createdAt": "2020-05-06T16:38:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMjMwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzOTI1OA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420939258", "bodyText": "Codacy left me a comment that was actually right and pointed out a flaw. I just re-pushed", "author": "mikehardy", "createdAt": "2020-05-06T16:48:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDkzMjMwNQ=="}], "type": "inlineReview"}, {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "url": "https://github.com/ankidroid/Anki-Android/commit/a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "message": "Only restricted devices require system browser", "committedDate": "2020-05-06T16:47:21Z", "type": "commit"}, {"oid": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "url": "https://github.com/ankidroid/Anki-Android/commit/a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "message": "Only restricted devices require system browser", "committedDate": "2020-05-06T16:47:21Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTE4NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420969185", "bodyText": "(optional): Could be extracted out of the loop for clarity.", "author": "david-allison-1", "createdAt": "2020-05-06T17:34:47Z", "path": "AnkiDroid/src/main/java/com/ichi2/utils/AdaptionUtil.java", "diffHunk": "@@ -23,23 +41,24 @@ public static boolean hasWebBrowser(Context context) {\n         Intent intent = new Intent(Intent.ACTION_VIEW, Uri.parse(\"http://www.google.com\"));\n         PackageManager pm = context.getPackageManager();\n         List<ResolveInfo> list = pm.queryIntentActivities(intent, PackageManager.MATCH_DEFAULT_ONLY);\n-        if (list.size() == 0) {\n-            sHasWebBrowser = false;\n-        } else {\n-            sHasWebBrowser = false;\n-            for (ResolveInfo ri:list) {\n-                String pacagename = ri.activityInfo.packageName;\n-                if (isSystemApp(pacagename, pm)) {\n-                    sHasWebBrowser = true;\n-                    break;\n-                }\n+        sHasWebBrowser = false;\n+        for (ResolveInfo ri : list) {\n+            // If we aren't a restricted device, any browser will do\n+            if (!isRestrictedLearningDevice()) {", "originalCommit": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5MzU2OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420993569", "bodyText": "cannot actually, we must know we have at least one entry in the list before true is ever returned, so it has to be in the loop signifying we have size() >= 1", "author": "mikehardy", "createdAt": "2020-05-06T18:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTE4NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5NzE2MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420997160", "bodyText": "Would be useful in a clarifying comment then (for next time) \ud83d\ude09", "author": "david-allison-1", "createdAt": "2020-05-06T18:18:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTE4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTUxNg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420969516", "bodyText": "spacing on the {", "author": "david-allison-1", "createdAt": "2020-05-06T17:35:20Z", "path": "AnkiDroid/src/main/java/com/ichi2/anki/Preferences.java", "diffHunk": "@@ -133,7 +133,7 @@ public void onBuildHeaders(List<Header> target) {\n         Iterator iterator = target.iterator();\n         while (iterator.hasNext()) {\n             Header header = (Header)iterator.next();\n-            if ((header.titleRes == R.string.pref_cat_advanced) && AdaptionUtil.hasReducedPreferences()){\n+            if ((header.titleRes == R.string.pref_cat_advanced) && AdaptionUtil.isRestrictedLearningDevice()){", "originalCommit": "a5a845510e333c9c3a79490ab5b4f22e9ef9d52d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk5Mzk0Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/6117#discussion_r420993946", "bodyText": "Aw dang. Fixed a couple of those but this will have to sit. Next time...\nThank you for double-checking though, I do appreciate it even though I short-circuited a bit. Could've always done a beta4 np if there was something goofy in here", "author": "mikehardy", "createdAt": "2020-05-06T18:13:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDk2OTUxNg=="}], "type": "inlineReview"}]}