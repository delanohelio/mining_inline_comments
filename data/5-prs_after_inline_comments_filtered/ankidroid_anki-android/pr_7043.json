{"pr_number": 7043, "pr_title": "Access correct cursor window size when configuring collection chunk size", "pr_createdAt": "2020-09-07T16:22:10Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/7043", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMzIyMQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#discussion_r484513221", "bodyText": "Can you also verify that this is non-negative, it's guaranteed not to be currently, but future refactorings introduce this risk as it can occur with the Android System class", "author": "david-allison-1", "createdAt": "2020-09-07T16:23:34Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -310,9 +310,10 @@ private int getChunk() {\n         String db_name = ((DatabaseChangeDecorator) db).getWrapped().getClass().getName();\n         if (\"io.requery.android.database.sqlite.SQLiteDatabase\".equals(db_name)) {\n             try {\n-                Field cursorWindowSize = io.requery.android.database.CursorWindow.class.getDeclaredField(\"sCursorWindowSize\");\n+                Field cursorWindowSize = io.requery.android.database.CursorWindow.class.getDeclaredField(\"sDefaultCursorWindowSize\");\n                 cursorWindowSize.setAccessible(true);", "originalCommit": "21717492f630fa24454c78c4b3fd6a13a3e00624", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMzYzMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#discussion_r484513632", "bodyText": "yeah - good point", "author": "mikehardy", "createdAt": "2020-09-07T16:24:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMzIyMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxNTY5Ng==", "url": "https://github.com/ankidroid/Anki-Android/pull/7043#discussion_r484515696", "bodyText": "Just in case, I went one integer farther: if the window size is not greater than 0 it is effectively useless (not just != -1). So I check for a value > 0, and if not I make a warning and use the default now. Better?", "author": "mikehardy", "createdAt": "2020-09-07T16:31:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDUxMzIyMQ=="}], "type": "inlineReview"}, {"oid": "e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "url": "https://github.com/ankidroid/Anki-Android/commit/e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "message": "Access correct cursor window size when configuring collection chunk size\n\nMoreover, guard against non-sensical values", "committedDate": "2020-09-07T16:29:38Z", "type": "commit"}, {"oid": "e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "url": "https://github.com/ankidroid/Anki-Android/commit/e018f0fd1b509917c3d73f00fbf50c7d4cfea053", "message": "Access correct cursor window size when configuring collection chunk size\n\nMoreover, guard against non-sensical values", "committedDate": "2020-09-07T16:29:38Z", "type": "forcePushed"}]}