{"pr_number": 6609, "pr_title": "NF: card search: cancelling checked more often", "pr_createdAt": "2020-07-04T15:11:00Z", "pr_url": "https://github.com/ankidroid/Anki-Android/pull/6609", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NDk5NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449794995", "bodyText": "The binding between all the classes is unnecessary, you can always do CollectionTask.getInstance() to get the currently executing task, and we only do one at a time so this should work?", "author": "mikehardy", "createdAt": "2020-07-04T18:27:51Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Finder.java", "diffHunk": "@@ -77,11 +77,22 @@ public Finder(Collection col) {\n \n     @CheckResult\n     public List<Long> findCards(String query, boolean _order) {\n-        return _findCards(query, _order);\n+        return findCards(query, _order, null);\n     }\n \n+    @CheckResult\n+    public List<Long> findCards(String query, boolean _order, CollectionTask task) {\n+        return _findCards(query, _order, task);\n+    }\n \n+\n+    @CheckResult\n     private List<Long> _findCards(String query, Object _order) {\n+        return _findCards(query, _order, null);\n+    }\n+\n+    @CheckResult\n+    private List<Long> _findCards(String query, Object _order, CollectionTask task) {", "originalCommit": "d5064b35eadac86a3c05c1025c1a0249502571c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDU5MA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449800590", "bodyText": "Honestly, I would hope that one day we are able to do multiple task at the same time, so I believe getInstance should be avoided.", "author": "Arthur-Milchior", "createdAt": "2020-07-04T19:49:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NDk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMDc4NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449800784", "bodyText": "If and when that happens it will be a cross-cutting infrastructure plan and the migration (maybe an API change like this? Maybe something else) would be all at once. That said I just searched for other users of getInstance and there are actually zero other callers! So, you have a point. I'll accept this API change then if you add one more commit to kill the CollectionTask.getInstance method so we are committed to the direction. If I am understanding things correctly this is a trivial request - if I am mistaken and there other users I don't intend for this to spiral out into a big change so I'd just use it", "author": "mikehardy", "createdAt": "2020-07-04T19:52:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NDk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMTQ2NQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449801465", "bodyText": "Done", "author": "Arthur-Milchior", "createdAt": "2020-07-04T20:02:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NDk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMjM4NA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449802384", "bodyText": "I think the commit went on a different PR somehow?", "author": "mikehardy", "createdAt": "2020-07-04T20:15:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NDk5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMzczOA==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449803738", "bodyText": "#6616\nmake more sens in a separate PR.\nI may have added it elsewhere by accident I guess", "author": "Arthur-Milchior", "createdAt": "2020-07-04T20:36:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NDk5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NTAzMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449795032", "bodyText": "CollectionTask.getInstance() is available, so no need to change the APIs here", "author": "mikehardy", "createdAt": "2020-07-04T18:28:21Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1131,7 +1131,7 @@ public String _flagNameFromCardFlags(int flags){\n         return new Finder(this).findCards(search, order);\n     }\n \n-    public List<Long> findCards(String search, boolean order) {\n+    public List<Long> findCards(String search, boolean order, CollectionTask task) {", "originalCommit": "d5064b35eadac86a3c05c1025c1a0249502571c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTgwMTIxMg==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449801212", "bodyText": "Closing, given the above conversation, it's not useful anymore", "author": "Arthur-Milchior", "createdAt": "2020-07-04T19:59:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTc5NTAzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MDkyMw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449880923", "bodyText": "This parameter seems unnecessary or is unused.", "author": "david-allison-1", "createdAt": "2020-07-05T14:02:37Z", "path": "AnkiDroid/src/main/java/com/ichi2/libanki/Collection.java", "diffHunk": "@@ -1131,7 +1131,7 @@ public String _flagNameFromCardFlags(int flags){\n         return new Finder(this).findCards(search, order);\n     }\n \n-    public List<Long> findCards(String search, boolean order) {\n+    public List<Long> findCards(String search, boolean order, CollectionTask task) {", "originalCommit": "d5064b35eadac86a3c05c1025c1a0249502571c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MjY1Mw==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449882653", "bodyText": "oops, indeed, I forgot to send it to findCards. Didn't realize there was this indirection.", "author": "Arthur-Milchior", "createdAt": "2020-07-05T14:19:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MDkyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MjY5OQ==", "url": "https://github.com/ankidroid/Anki-Android/pull/6609#discussion_r449882699", "bodyText": "Corrected", "author": "Arthur-Milchior", "createdAt": "2020-07-05T14:20:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0OTg4MDkyMw=="}], "type": "inlineReview"}, {"oid": "dc5a205cc7e1f59b45c6367fff791aaadf9348b7", "url": "https://github.com/ankidroid/Anki-Android/commit/dc5a205cc7e1f59b45c6367fff791aaadf9348b7", "message": "NF: card search: cancelling checked more often", "committedDate": "2020-07-05T14:19:56Z", "type": "forcePushed"}, {"oid": "c799fd5f3aaf16164a84fda8f82914d087f70987", "url": "https://github.com/ankidroid/Anki-Android/commit/c799fd5f3aaf16164a84fda8f82914d087f70987", "message": "NF: card search: cancelling checked more often", "committedDate": "2020-07-05T23:45:06Z", "type": "commit"}, {"oid": "ed7071f5e4da7a4dc053b4d8a88868bad7812d04", "url": "https://github.com/ankidroid/Anki-Android/commit/ed7071f5e4da7a4dc053b4d8a88868bad7812d04", "message": "NF: avoid going from id to count model to id", "committedDate": "2020-07-05T23:45:06Z", "type": "commit"}, {"oid": "42679b32473977e3b672e77177a975c1b58d889e", "url": "https://github.com/ankidroid/Anki-Android/commit/42679b32473977e3b672e77177a975c1b58d889e", "message": "NF: uses sql's count instead of list size", "committedDate": "2020-07-05T23:45:06Z", "type": "commit"}, {"oid": "0822a402aeb277feb0e8822008ede9adb5ac773b", "url": "https://github.com/ankidroid/Anki-Android/commit/0822a402aeb277feb0e8822008ede9adb5ac773b", "message": "NF: doInBackgroundLoadModels cancellable", "committedDate": "2020-07-05T23:45:06Z", "type": "commit"}, {"oid": "29b841643f2d1721fd1d843071773ed061206ead", "url": "https://github.com/ankidroid/Anki-Android/commit/29b841643f2d1721fd1d843071773ed061206ead", "message": "NF: kill Task_Type_Count_Models when ModelBrowser close", "committedDate": "2020-07-05T23:45:06Z", "type": "commit"}, {"oid": "29b841643f2d1721fd1d843071773ed061206ead", "url": "https://github.com/ankidroid/Anki-Android/commit/29b841643f2d1721fd1d843071773ed061206ead", "message": "NF: kill Task_Type_Count_Models when ModelBrowser close", "committedDate": "2020-07-05T23:45:06Z", "type": "forcePushed"}]}