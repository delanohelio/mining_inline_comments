{"pr_number": 2463, "pr_title": "Avoid flagging missing SRI attribute when HTML asset is inline", "pr_createdAt": "2020-06-25T01:41:05Z", "pr_url": "https://github.com/zaproxy/zap-extensions/pull/2463", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI2NTI5Mg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445265292", "bodyText": "The build is failing because of a missing semi-colon here.\n> Task :addOns:pscanrulesAlpha:compileJava FAILED\n/home/travis/build/zaproxy/zap-extensions/addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java:139: error: ';' expected\n        }\n         ^\n1 error", "author": "kingthorin", "createdAt": "2020-06-25T01:55:45Z", "path": "addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java", "diffHunk": "@@ -124,6 +125,20 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n         };\n     }\n \n+    private static Predicate<Element> htmlNotInline() {\n+        // 'else' branch won't ever execute since everything evaluated is a SCRIPT/LINK.\n+        // Leaving it in place for clarity.\n+        return element -> {\n+            if (element.getName() == HTMLElementName.SCRIPT) {\n+                return !element.getAttributeValue(\"src\").startsWith(\"data:\");\n+            } else if (element.getName() == HTMLElementName.LINK) {\n+                return !element.getAttributeValue(\"href\").startsWith(\"data:\");\n+            } else {\n+                return true;\n+            }\n+        }", "originalCommit": "52a31d2f39c9aadeb91a3e12f8e5d1a7d8c7eed9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI4Mzg4Mg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445283882", "bodyText": "On it, thanks.", "author": "kishorbhat", "createdAt": "2020-06-25T03:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI2NTI5Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5MzUzNQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445293535", "bodyText": "The test fails on this line with a NullPointerException. Not sure why, since the test HTML message includes a \"src\" attribute inside the script. What am I missing?", "author": "kishorbhat", "createdAt": "2020-06-25T03:59:56Z", "path": "addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java", "diffHunk": "@@ -124,6 +125,20 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n         };\n     }\n \n+    private static Predicate<Element> htmlNotInline() {\n+        // 'else' branch won't ever execute since everything evaluated is a SCRIPT/LINK.\n+        // Leaving it in place for clarity.\n+        return element -> {\n+            if (element.getName() == HTMLElementName.SCRIPT) {\n+                return !element.getAttributeValue(\"src\").startsWith(\"data:\");", "originalCommit": "4cc919f1e9fc42ed003321ba8fe043250007dacd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NTI4NQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445295285", "bodyText": "Oh, the failing test wasn't the one I wrote but shouldNotRaiseAlertGivenElementIsInline.", "author": "kishorbhat", "createdAt": "2020-06-25T04:07:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5MzUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5NTQ0Mw==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445295443", "bodyText": "I'll add null checks in both places.", "author": "kishorbhat", "createdAt": "2020-06-25T04:08:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5MzUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQxNjcyNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445416724", "bodyText": "This (method) is duplicating what SupportedElements does/provides, the scheme check should be added to #getHost(...).", "author": "thc202", "createdAt": "2020-06-25T09:08:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5MzUzNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzNDM0OA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445634348", "bodyText": "On it, thanks.", "author": "kishorbhat", "createdAt": "2020-06-25T15:12:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTI5MzUzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3MzQ5NA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445473494", "bodyText": "The Base64 value can be trimmed/removed, not meaningful for the test.", "author": "thc202", "createdAt": "2020-06-25T10:53:46Z", "path": "addOns/pscanrulesAlpha/src/test/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScannerTest.java", "diffHunk": "@@ -208,6 +208,23 @@ public void shouldIgnoreInvalidFormattedHostname() throws HttpMalformedHeaderExc\n         assertThat(alertsRaised.size(), equalTo(1));\n     }\n \n+    @Test\n+    public void shouldNotRaiseAlertGivenHtmlAssetIsInline() throws HttpMalformedHeaderException {\n+        // Given\n+        HttpMessage msg =\n+                buildMessage(\n+                        \"<html><head>\"\n+                                + \"<script src=\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlPM0jRW/QAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=\\\"></script>\"\n+                                + \"<link href=\\\"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABAQMAAAAl21bKAAAAA1BMVEX/TQBcNTh/AAAAAXRSTlPM0jRW/QAAAApJREFUeJxjYgAAAAYAAzY3fKgAAAAASUVORK5CYII=\\\">\"", "originalCommit": "437e24f1496ee33349a329f959448824f08fb9b3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzNTA2Nw==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445635067", "bodyText": "I'll switch to data:text/html payloads so that they're shorter.", "author": "kishorbhat", "createdAt": "2020-06-25T15:13:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3MzQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTYzNzcxMw==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445637713", "bodyText": "It's not necessary to change the type, the contents don't affect the outcome of the test so better not have them at all.", "author": "thc202", "createdAt": "2020-06-25T15:17:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3MzQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MTQ2NA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445641464", "bodyText": "Since the type doesn't either (affect the outcome, that is) I can strip that out too. I think data:, would be the minimally correct string.", "author": "kishorbhat", "createdAt": "2020-06-25T15:22:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3MzQ5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MjgxNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445642814", "bodyText": "Sounds good.", "author": "thc202", "createdAt": "2020-06-25T15:24:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTQ3MzQ5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTY0MDE1NQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2463#discussion_r445640155", "bodyText": "Can be merged to the above if.\ndata: would be more accurate.", "author": "thc202", "createdAt": "2020-06-25T15:20:55Z", "path": "addOns/pscanrulesAlpha/src/main/java/org/zaproxy/zap/extension/pscanrulesAlpha/SubResourceIntegrityAttributeScanner.java", "diffHunk": "@@ -71,6 +71,8 @@ public static boolean contains(String tag) {\n                                     .attribute);\n             if (url == null) {\n                 return Optional.of(origin);\n+            } else if (url.startsWith(\"data\")) {", "originalCommit": "0e5574e5f558e75f746270c4742434e55c0eff46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1bacd81164eaa238dddc70dba5306a853cc4ac3f", "url": "https://github.com/zaproxy/zap-extensions/commit/1bacd81164eaa238dddc70dba5306a853cc4ac3f", "message": "Avoid flagging missing SRI attribute when HTML asset is inline\n\nSigned-off-by: Kishor Bhat <kishorbhat@gmail.com>", "committedDate": "2020-06-29T14:44:10Z", "type": "commit"}]}