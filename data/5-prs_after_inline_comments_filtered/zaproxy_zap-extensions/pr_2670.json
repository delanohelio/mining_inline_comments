{"pr_number": 2670, "pr_title": "chore: added evidence to suspicious comment scan rule", "pr_createdAt": "2020-12-27T07:22:31Z", "pr_url": "https://github.com/zaproxy/zap-extensions/pull/2670", "timeline": [{"oid": "25d5202df2a312c059eac16d2f83dbc4eb2f165d", "url": "https://github.com/zaproxy/zap-extensions/commit/25d5202df2a312c059eac16d2f83dbc4eb2f165d", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-27T07:23:31Z", "type": "forcePushed"}, {"oid": "af31f657a22a99f09e9258fa962b95557a113076", "url": "https://github.com/zaproxy/zap-extensions/commit/af31f657a22a99f09e9258fa962b95557a113076", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-27T07:39:44Z", "type": "forcePushed"}, {"oid": "853f69d842fd857c71408df4b008bc3867a311d3", "url": "https://github.com/zaproxy/zap-extensions/commit/853f69d842fd857c71408df4b008bc3867a311d3", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-27T08:00:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549652924", "bodyText": "This is now raising an alert per comment, was that on purpose? The other info field will contain the information of all comments not just the one that matches the evidence.", "author": "thc202", "createdAt": "2020-12-29T10:29:06Z", "path": "addOns/pscanrules/src/main/java/org/zaproxy/zap/extension/pscanrules/InformationDisclosureSuspiciousCommentsScanRule.java", "diffHunk": "@@ -107,19 +110,21 @@ public void scanHttpResponseReceive(HttpMessage msg, int id, Source source) {\n                                             MESSAGE_PREFIX + \"otherinfo\", pattern, elStr));\n                             todoComments.append(\"\\n\");\n                             confidence = Alert.CONFIDENCE_LOW;\n+                            evidence.add(elStr);\n                             break; // Only need to record this script once\n                         }\n                     }\n                     offset = el.getEnd();\n                 }\n             }\n-            if (todoComments.length() > 0) {\n-                this.raiseAlert(msg, id, todoComments.toString(), confidence);\n+            for (String e : evidence) {", "originalCommit": "853f69d842fd857c71408df4b008bc3867a311d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1NDQ5OQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549654499", "bodyText": "Yep, I thought that makes more sense to have one alert per comment, do you agree?\nThe other contains the matching pattern, which is not that helpful...", "author": "omerlh", "createdAt": "2020-12-29T10:34:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY2MDg1MA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549660850", "bodyText": "IMO it's easier to manage with a single alert per message.", "author": "thc202", "createdAt": "2020-12-29T10:55:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY2NDQ3NA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r549664474", "bodyText": "I was just thinking about false positives - you might want one alert per comment so you can ignore only the alerts that are false positive", "author": "omerlh", "createdAt": "2020-12-29T11:07:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY4NzcwMA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552687700", "bodyText": "Worth mentioning this in the change log as its a change in the way the rule works.", "author": "psiinon", "createdAt": "2021-01-06T14:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjY5NjkwNA==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552696904", "bodyText": "Yep, I updated the change log", "author": "omerlh", "createdAt": "2021-01-06T15:07:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MjczMzU5OQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r552733599", "bodyText": "Did you push the changes? I'm still not seeing it :/", "author": "psiinon", "createdAt": "2021-01-06T15:49:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0OTY1MjkyNA=="}], "type": "inlineReview"}, {"oid": "a72c7555d7025390ba8e516deef472b7faff5234", "url": "https://github.com/zaproxy/zap-extensions/commit/a72c7555d7025390ba8e516deef472b7faff5234", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-29T11:58:32Z", "type": "forcePushed"}, {"oid": "6499df0ee2323bb827ffdd6c5015816bdc696ef6", "url": "https://github.com/zaproxy/zap-extensions/commit/6499df0ee2323bb827ffdd6c5015816bdc696ef6", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2020-12-29T12:16:05Z", "type": "forcePushed"}, {"oid": "91cd20377679f11c5671d3d93121c63505d2b9b7", "url": "https://github.com/zaproxy/zap-extensions/commit/91cd20377679f11c5671d3d93121c63505d2b9b7", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-03T11:07:26Z", "type": "forcePushed"}, {"oid": "e39470194d159a5f7357c1cae024c66045e88706", "url": "https://github.com/zaproxy/zap-extensions/commit/e39470194d159a5f7357c1cae024c66045e88706", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-03T11:20:55Z", "type": "forcePushed"}, {"oid": "d92d864a156e19307cff02e87d624675524ff86d", "url": "https://github.com/zaproxy/zap-extensions/commit/d92d864a156e19307cff02e87d624675524ff86d", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-06T11:53:00Z", "type": "forcePushed"}, {"oid": "4eb7b7ea2df0102f6276f665b0c38fd982620915", "url": "https://github.com/zaproxy/zap-extensions/commit/4eb7b7ea2df0102f6276f665b0c38fd982620915", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-06T16:04:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMzMDMyMg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r553330322", "bodyText": "Worth checking both alerts have the expected evidence too.", "author": "thc202", "createdAt": "2021-01-07T13:36:22Z", "path": "addOns/pscanrules/src/test/java/org/zaproxy/zap/extension/pscanrules/InformationDisclosureSuspiciousCommentsScanRuleUnitTest.java", "diffHunk": "@@ -120,6 +123,26 @@ public void shouldNotAlertOnSuspiciousCommentIsPartOfWordInJavaScriptResponse()\n         assertEquals(0, alertsRaised.size());\n     }\n \n+    @Test\n+    public void shouldCreateOneAlertPerSuspiciousComment()\n+            throws HttpMalformedHeaderException, URIException {\n+\n+        // Given\n+        String body =\n+                \"Some text <script>Some Script Element FIXME: DO something \\n FIXME: DO something else </script>\\nLine 2\\n\";\n+        HttpMessage msg = createHttpMessageWithRespBody(body, \"text/javascript;charset=ISO-8859-1\");\n+\n+        assertTrue(msg.getResponseHeader().isText());\n+        assertTrue(msg.getResponseHeader().isJavaScript());\n+\n+        // When\n+        scanHttpResponseReceive(msg);\n+\n+        // Then\n+        assertEquals(2, alertsRaised.size());\n+        assertEquals(Alert.CONFIDENCE_LOW, alertsRaised.get(0).getConfidence());", "originalCommit": "4eb7b7ea2df0102f6276f665b0c38fd982620915", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1NDUyNTM3Mg==", "url": "https://github.com/zaproxy/zap-extensions/pull/2670#discussion_r554525372", "bodyText": "Fixed this and the rest of the comments.", "author": "omerlh", "createdAt": "2021-01-10T07:31:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzMzMDMyMg=="}], "type": "inlineReview"}, {"oid": "d4c9d700fecb3fc50e5a11082e19a3e96cc707a9", "url": "https://github.com/zaproxy/zap-extensions/commit/d4c9d700fecb3fc50e5a11082e19a3e96cc707a9", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-10T07:32:35Z", "type": "forcePushed"}, {"oid": "dedb298f8126f5573706b8572ea96404543b8cb7", "url": "https://github.com/zaproxy/zap-extensions/commit/dedb298f8126f5573706b8572ea96404543b8cb7", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-10T07:46:42Z", "type": "forcePushed"}, {"oid": "0676b50cd096e4f9ece89207cc011896b400e625", "url": "https://github.com/zaproxy/zap-extensions/commit/0676b50cd096e4f9ece89207cc011896b400e625", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T08:04:27Z", "type": "forcePushed"}, {"oid": "b3e9bd30adcea15499d54fbf5c7392c9e4f0f87e", "url": "https://github.com/zaproxy/zap-extensions/commit/b3e9bd30adcea15499d54fbf5c7392c9e4f0f87e", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T08:05:11Z", "type": "forcePushed"}, {"oid": "161ba43886b263a7e875cd2929411050fd01a19a", "url": "https://github.com/zaproxy/zap-extensions/commit/161ba43886b263a7e875cd2929411050fd01a19a", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T14:01:41Z", "type": "commit"}, {"oid": "161ba43886b263a7e875cd2929411050fd01a19a", "url": "https://github.com/zaproxy/zap-extensions/commit/161ba43886b263a7e875cd2929411050fd01a19a", "message": "chore: added evidence to suspicious comment scan rule\n\nSigned-off-by: omerlh <omer.levihevroni@snyk.io>", "committedDate": "2021-01-20T14:01:41Z", "type": "forcePushed"}]}