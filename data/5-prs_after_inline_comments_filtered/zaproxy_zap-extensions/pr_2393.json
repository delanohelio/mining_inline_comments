{"pr_number": 2393, "pr_title": "Add Retire.js Addon", "pr_createdAt": "2020-05-15T02:32:58Z", "pr_url": "https://github.com/zaproxy/zap-extensions/pull/2393", "timeline": [{"oid": "cac4ce9c28058840e1fd9be20dd44856701fc90d", "url": "https://github.com/zaproxy/zap-extensions/commit/cac4ce9c28058840e1fd9be20dd44856701fc90d", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-15T11:02:15Z", "type": "forcePushed"}, {"oid": "41a5454aa2155f6a8f7e60423ba0757b9a093576", "url": "https://github.com/zaproxy/zap-extensions/commit/41a5454aa2155f6a8f7e60423ba0757b9a093576", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-15T11:04:00Z", "type": "forcePushed"}, {"oid": "f8f76032ac2e20b6a8fa3824fae2d7332df7b967", "url": "https://github.com/zaproxy/zap-extensions/commit/f8f76032ac2e20b6a8fa3824fae2d7332df7b967", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-15T12:42:05Z", "type": "forcePushed"}, {"oid": "8037e4721b93b7a8cae67e1b5bc5f0f9c43c8e0b", "url": "https://github.com/zaproxy/zap-extensions/commit/8037e4721b93b7a8cae67e1b5bc5f0f9c43c8e0b", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-15T17:01:07Z", "type": "forcePushed"}, {"oid": "458ae14d1cad278623cfa90a5dfe3a5c4c1234c6", "url": "https://github.com/zaproxy/zap-extensions/commit/458ae14d1cad278623cfa90a5dfe3a5c4c1234c6", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-15T17:16:55Z", "type": "forcePushed"}, {"oid": "6962550c0c5d0f31ed7254f19b37009bc11e218d", "url": "https://github.com/zaproxy/zap-extensions/commit/6962550c0c5d0f31ed7254f19b37009bc11e218d", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-15T17:20:09Z", "type": "forcePushed"}, {"oid": "4147405cdba45db859adcd341330d2b96e1edb3e", "url": "https://github.com/zaproxy/zap-extensions/commit/4147405cdba45db859adcd341330d2b96e1edb3e", "message": "Use gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-17T03:18:30Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNjIxMjYyNQ==", "url": "https://github.com/zaproxy/zap-extensions/pull/2393#discussion_r426212625", "bodyText": "I tried adding a UnitTest for this leveraging this.nano.addHandler and reading a file like we do with ascanrules but kept running into an NPE. I then tried adding it as an inline string but it's >65KB and wouldn't let me.", "author": "kingthorin", "createdAt": "2020-05-17T03:21:39Z", "path": "addOns/retire/src/main/java/org/zaproxy/addon/retire/RetireExtension.java", "diffHunk": "@@ -0,0 +1,276 @@\n+/*\n+ * Zed Attack Proxy (ZAP) and its related class files.\n+ *\n+ * ZAP is an HTTP/HTTPS proxy for assessing web application security.\n+ *\n+ * Copyright 2020 The ZAP Development Team\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *     http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+package org.zaproxy.addon.retire;\n+\n+import com.google.gson.Gson;\n+import com.google.gson.reflect.TypeToken;\n+import java.io.IOException;\n+import java.lang.reflect.Type;\n+import java.util.Collections;\n+import java.util.HashMap;\n+import java.util.HashSet;\n+import java.util.Iterator;\n+import java.util.List;\n+import java.util.ListIterator;\n+import java.util.Map;\n+import java.util.Map.Entry;\n+import java.util.regex.Matcher;\n+import java.util.regex.Pattern;\n+import org.apache.log4j.Logger;\n+import org.parosproxy.paros.Constant;\n+import org.parosproxy.paros.extension.ExtensionAdaptor;\n+import org.parosproxy.paros.network.HttpMessage;\n+import org.zaproxy.addon.retire.model.Extractors;\n+import org.zaproxy.addon.retire.model.RepoEntry;\n+import org.zaproxy.addon.retire.model.Vulnerability;\n+\n+public class RetireExtension extends ExtensionAdaptor {\n+    private static final String RESOURCE = \"/org/zaproxy/addon/retire/resources\";\n+    private static final String COLLECTION_PATH = RESOURCE + \"/jsrepository.json\";\n+    private static final String DONT_CHECK_NAME = \"dont check\";\n+    private static final Logger LOGGER = Logger.getLogger(RetireExtension.class);\n+\n+    private static Map<String, RepoEntry> repos = initialize();\n+\n+    /*\n+     * This function initializes and reads the vulnerability database*\n+     */\n+    public static Map<String, RepoEntry> initialize() {\n+        try {\n+            String jsrepo = RetireUtil.getStringResource(COLLECTION_PATH);\n+            Gson gson = new Gson();\n+            // Convert JSON File to Java Object\n+            Type repoMapType = new TypeToken<Map<String, RepoEntry>>() {}.getType();\n+            return gson.fromJson(jsrepo, repoMapType);\n+        } catch (IOException e) {\n+            LOGGER.warn(\"Failed to load Retire.js collection\", e);\n+        }\n+        return Collections.emptyMap();\n+    }\n+\n+    public static Map<String, RepoEntry> getRepos() {\n+        return repos;\n+    }\n+\n+    /*\n+     * This is the top level function called from the scanner. It first checks if:\n+     * 1)Matching vulnerability is found in database for JS file URL, if YES return return HashSet of related info.\n+     * 2)Matching vulnerability is found in database for JS file name, if YES return return HashSet of related info.\n+     * 3)Matching vulnerability is found in database for JS file content, if YES return return HashSet of related info.\n+     * 4)Matching vulnerability is found in database for JS file hash, if YES return HashSet of related info .\n+     * 5)Return empty HashSet.\n+     */\n+    public static Result scanJS(HttpMessage msg) {\n+\n+        String uri = msg.getRequestHeader().getURI().toString();\n+        String fileName = RetireUtil.getFileName(msg.getRequestHeader().getURI());\n+        String content = msg.getResponseBody().toString();\n+        Result result;\n+\n+        // Check if included in don't check section\n+        HashMap<String, String> msginfo = new HashMap<String, String>();\n+        msginfo.put(Extractors.TYPE_URI, uri);\n+        if (fileName != null) {\n+            msginfo.put(Extractors.TYPE_FILENAME, fileName.toString());\n+        }\n+        msginfo.put(Extractors.TYPE_FILECONTENT, content);\n+\n+        if (dontcheck(msginfo)) {\n+            return null;\n+        }\n+\n+        result = scan(Extractors.TYPE_URI, uri);\n+        if (result != null) {\n+            return result;\n+        }\n+\n+        if (fileName != null) {\n+            result = scan(Extractors.TYPE_FILENAME, fileName);\n+        }\n+        if (result != null) {\n+            return result;\n+        }\n+\n+        result = scan(Extractors.TYPE_FILECONTENT, content);\n+        if (result != null) {\n+            return result;\n+        }\n+\n+        String hash = RetireUtil.getHash(msg.getResponseBody().getBytes());\n+        return scanHash(hash);\n+    }\n+\n+    /*\n+     * This function computes the SHA 1 hash of the HTTP response body,\n+     * IF the hash matches that of an existing entry in the vulnerability database\n+     * corresponding info is returned.\n+     * ELSE an empty HashSet is returned.\n+     */\n+    private static Result scanHash(String hash) {\n+        // Testable URL: https://ajax.googleapis.com/ajax/libs/dojo/1.1.1/dojo/dojo.js", "originalCommit": "4147405cdba45db859adcd341330d2b96e1edb3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "56d6edd7f35ed2e2444e2586b85eff3eba7726bd", "url": "https://github.com/zaproxy/zap-extensions/commit/56d6edd7f35ed2e2444e2586b85eff3eba7726bd", "message": "Use gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-17T03:23:47Z", "type": "forcePushed"}, {"oid": "3785353e3bfa37e5f3aed675527c03d03b50f0b7", "url": "https://github.com/zaproxy/zap-extensions/commit/3785353e3bfa37e5f3aed675527c03d03b50f0b7", "message": "Use gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-17T03:45:27Z", "type": "forcePushed"}, {"oid": "fd5fb44efe48289806cc72e0593cc16ec7831c02", "url": "https://github.com/zaproxy/zap-extensions/commit/fd5fb44efe48289806cc72e0593cc16ec7831c02", "message": "Use gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-17T03:50:08Z", "type": "forcePushed"}, {"oid": "9c5d24a245fb7963f1d03fb8e379d62e47ec2e9e", "url": "https://github.com/zaproxy/zap-extensions/commit/9c5d24a245fb7963f1d03fb8e379d62e47ec2e9e", "message": "Use gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-17T04:53:53Z", "type": "forcePushed"}, {"oid": "0cb652b798701c185898daa59d0fb2c8a3eea4ab", "url": "https://github.com/zaproxy/zap-extensions/commit/0cb652b798701c185898daa59d0fb2c8a3eea4ab", "message": "Use gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-17T04:55:54Z", "type": "forcePushed"}, {"oid": "f0797af5b633b11f67ffc659f9e163a4cf47a876", "url": "https://github.com/zaproxy/zap-extensions/commit/f0797af5b633b11f67ffc659f9e163a4cf47a876", "message": "Tweaks", "committedDate": "2020-05-18T13:49:06Z", "type": "forcePushed"}, {"oid": "85b0c4942c999a9768a415c0a207a232d18bd248", "url": "https://github.com/zaproxy/zap-extensions/commit/85b0c4942c999a9768a415c0a207a232d18bd248", "message": "Tweaks", "committedDate": "2020-05-18T14:24:01Z", "type": "forcePushed"}, {"oid": "c6340be6be4a416c4334d5f6bcacfcaa1789150a", "url": "https://github.com/zaproxy/zap-extensions/commit/c6340be6be4a416c4334d5f6bcacfcaa1789150a", "message": "Tweaks", "committedDate": "2020-05-18T14:25:18Z", "type": "forcePushed"}, {"oid": "54e5a5e4883f2471e0c62b10aecf361723b63329", "url": "https://github.com/zaproxy/zap-extensions/commit/54e5a5e4883f2471e0c62b10aecf361723b63329", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T14:35:52Z", "type": "forcePushed"}, {"oid": "52bf4ee45231c4215b2d417697f7f46e058ef0e2", "url": "https://github.com/zaproxy/zap-extensions/commit/52bf4ee45231c4215b2d417697f7f46e058ef0e2", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T16:24:37Z", "type": "forcePushed"}, {"oid": "42942587f8bbd0b1acdda7da385e5807ec296818", "url": "https://github.com/zaproxy/zap-extensions/commit/42942587f8bbd0b1acdda7da385e5807ec296818", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T21:43:25Z", "type": "forcePushed"}, {"oid": "204e50f45a4e6191f57aea7588f66991c0917943", "url": "https://github.com/zaproxy/zap-extensions/commit/204e50f45a4e6191f57aea7588f66991c0917943", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T22:06:30Z", "type": "forcePushed"}, {"oid": "a2af7d83ace789ce2042d68ca78e3b964ffb1d0b", "url": "https://github.com/zaproxy/zap-extensions/commit/a2af7d83ace789ce2042d68ca78e3b964ffb1d0b", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T22:12:10Z", "type": "forcePushed"}, {"oid": "eed56cee209a509f0f15dc36dbdaf4a5e0a175ec", "url": "https://github.com/zaproxy/zap-extensions/commit/eed56cee209a509f0f15dc36dbdaf4a5e0a175ec", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T22:45:39Z", "type": "commit"}, {"oid": "eed56cee209a509f0f15dc36dbdaf4a5e0a175ec", "url": "https://github.com/zaproxy/zap-extensions/commit/eed56cee209a509f0f15dc36dbdaf4a5e0a175ec", "message": "Add Retire.js Addon\n\n- New add-on with passive scanner based on RetireJS/retire.js.\n- Basic UnitTest.\n- Basic help entry.\n- Icon taken from https://github.com/RetireJS profile image (globe with\nshield). Included at \"normal\" 128x128 and resized 16x16.\n- GitHub Action to create update PRs once a month. (Pattern updates only\nseem to occur once or twice a month in recent history\nhttps://github.com/RetireJS/retire.js/commits/master/repository . A\nmanual update can always be done if necessary.)\n\nUse gson to parse the Retire.js JSON input collection\n\nRework code to use gson so there's no need to worry about unchecked\nconversions.\n\nModel partially generated leveraging http://www.jsonschema2pojo.org/\n\nSigned-off-by: kingthorin <kingthorin@users.noreply.github.com>", "committedDate": "2020-05-18T22:45:39Z", "type": "forcePushed"}]}