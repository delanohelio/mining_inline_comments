{"pr_number": 19134, "pr_title": "#19096 adding the crud for templates", "pr_createdAt": "2020-08-20T05:56:43Z", "pr_url": "https://github.com/dotCMS/core/pull/19134", "timeline": [{"oid": "dfcc58ac621c99eef8053b1c3b59c55eb93ea01d", "url": "https://github.com/dotCMS/core/commit/dfcc58ac621c99eef8053b1c3b59c55eb93ea01d", "message": "#19096 adding the crud for templates", "committedDate": "2020-08-20T05:55:12Z", "type": "commit"}, {"oid": "cdf2387baf5f78ea5ea53cf929ce73515b41beb3", "url": "https://github.com/dotCMS/core/commit/cdf2387baf5f78ea5ea53cf929ce73515b41beb3", "message": "#19096 minor refactor", "committedDate": "2020-08-20T05:59:38Z", "type": "commit"}, {"oid": "51612beb65ae53946537d7ea825539dd3c08420c", "url": "https://github.com/dotCMS/core/commit/51612beb65ae53946537d7ea825539dd3c08420c", "message": "#19096 adding a template view to reduce the verbosity in the response", "committedDate": "2020-08-20T18:05:08Z", "type": "commit"}, {"oid": "c89fa9ac82b73f324b06375316dc27f42a2bdb47", "url": "https://github.com/dotCMS/core/commit/c89fa9ac82b73f324b06375316dc27f42a2bdb47", "message": "#19096 adding fixes and unit test", "committedDate": "2020-08-20T19:29:20Z", "type": "commit"}, {"oid": "e3cf002452144f5ea0c5c2269d9daa6a964dec76", "url": "https://github.com/dotCMS/core/commit/e3cf002452144f5ea0c5c2269d9daa6a964dec76", "message": "#19096 adding more attributes to the template view in order to figure out the diff actions enabled on each template such as publish, edit, etc", "committedDate": "2020-08-21T05:09:02Z", "type": "commit"}, {"oid": "0dda69ca39781fc76a84386daccef8efd60f8b81", "url": "https://github.com/dotCMS/core/commit/0dda69ca39781fc76a84386daccef8efd60f8b81", "message": "#19096 added save new, edit and publish template", "committedDate": "2020-08-21T07:45:17Z", "type": "commit"}, {"oid": "cb42ccb781abc9a989122ff6b32dc57c85feb8b1", "url": "https://github.com/dotCMS/core/commit/cb42ccb781abc9a989122ff6b32dc57c85feb8b1", "message": "#19096 adding the template resource to add/edit/publish/unpublish/copy/unlock/archive/unarchive/delete", "committedDate": "2020-08-21T21:25:28Z", "type": "commit"}, {"oid": "d7710f589eae01dfd8e7da7d6f893625b2ea9bec", "url": "https://github.com/dotCMS/core/commit/d7710f589eae01dfd8e7da7d6f893625b2ea9bec", "message": "#19096 some refactorings", "committedDate": "2020-08-24T07:10:50Z", "type": "commit"}, {"oid": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "url": "https://github.com/dotCMS/core/commit/fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "message": "#Adding a refactor and fixes", "committedDate": "2020-08-24T22:40:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwNDAzOQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476604039", "bodyText": "rename to _publish as we are doing for operations (not resources)", "author": "dsilvam", "createdAt": "2020-08-25T17:08:13Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/publish\")", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwNDMyNA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476604324", "bodyText": "Rename to _unpublish", "author": "dsilvam", "createdAt": "2020-08-25T17:08:41Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                \"publishedInodes\", publishedInodes,\n+                \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Unpublish a list of template inodes\n+     * Return the list of a success unpublished and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToUnpublish {@link List} list of template inodes to unpublish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unpublish\")", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwNDcxMQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476604711", "bodyText": "Change to /{templateInode}/_copy", "author": "dsilvam", "createdAt": "2020-08-25T17:09:21Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                \"publishedInodes\", publishedInodes,\n+                \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Unpublish a list of template inodes\n+     * Return the list of a success unpublished and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToUnpublish {@link List} list of template inodes to unpublish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unpublish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unpublish(@Context final HttpServletRequest  request,\n+                                  @Context final HttpServletResponse response,\n+                                  final List<String> templatesToUnpublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToUnpublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToUnpublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.unpublishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"UnPublish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" unpublishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception wax) {\n+\n+                    Logger.error(this, wax.getMessage(), wax);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                        \"unpublishedInodes\", publishedInodes,\n+                        \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Copy a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to copy\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/copy/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response copy(@Context final HttpServletRequest  request,", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwNDg5Ng==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476604896", "bodyText": "Change to /{templateInode}/_unlock", "author": "dsilvam", "createdAt": "2020-08-25T17:09:41Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                \"publishedInodes\", publishedInodes,\n+                \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Unpublish a list of template inodes\n+     * Return the list of a success unpublished and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToUnpublish {@link List} list of template inodes to unpublish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unpublish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unpublish(@Context final HttpServletRequest  request,\n+                                  @Context final HttpServletResponse response,\n+                                  final List<String> templatesToUnpublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToUnpublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToUnpublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.unpublishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"UnPublish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" unpublishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception wax) {\n+\n+                    Logger.error(this, wax.getMessage(), wax);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                        \"unpublishedInodes\", publishedInodes,\n+                        \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Copy a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to copy\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/copy/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response copy(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Copying the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        final Response responseRest = Response.ok(new ResponseEntityView(\n+                this.templateHelper.toTemplateView(this.templateAPI.copy(template, user), user))).build();\n+\n+        ActivityLogger.logInfo(this.getClass(), \"Copied Template\", \"User \" +\n+                user.getPrimaryKey() + \" copied template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+\n+        return responseRest;\n+    }\n+\n+    /**\n+     * Unlock a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unlock/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unlock(@Context final HttpServletRequest  request,", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwNTA3OQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476605079", "bodyText": "Change to /{templateInode}/_archive", "author": "dsilvam", "createdAt": "2020-08-25T17:09:57Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                \"publishedInodes\", publishedInodes,\n+                \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Unpublish a list of template inodes\n+     * Return the list of a success unpublished and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToUnpublish {@link List} list of template inodes to unpublish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unpublish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unpublish(@Context final HttpServletRequest  request,\n+                                  @Context final HttpServletResponse response,\n+                                  final List<String> templatesToUnpublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToUnpublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToUnpublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.unpublishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"UnPublish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" unpublishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception wax) {\n+\n+                    Logger.error(this, wax.getMessage(), wax);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                        \"unpublishedInodes\", publishedInodes,\n+                        \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Copy a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to copy\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/copy/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response copy(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Copying the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        final Response responseRest = Response.ok(new ResponseEntityView(\n+                this.templateHelper.toTemplateView(this.templateAPI.copy(template, user), user))).build();\n+\n+        ActivityLogger.logInfo(this.getClass(), \"Copied Template\", \"User \" +\n+                user.getPrimaryKey() + \" copied template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+\n+        return responseRest;\n+    }\n+\n+    /**\n+     * Unlock a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unlock/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unlock(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Unlocking the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_READ);\n+        this.templateAPI.unlock(template, user);\n+\n+        Logger.debug(this, \"Unlocked template: \" + templateInode);\n+        return Response.ok(new ResponseEntityView(true)).build();\n+    }\n+\n+    /**\n+     * Archive a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/archive/{templateInode}\")", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwNTQ5Mg==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476605492", "bodyText": "Change to /{templateInode}/_unarchive", "author": "dsilvam", "createdAt": "2020-08-25T17:10:31Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                \"publishedInodes\", publishedInodes,\n+                \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Unpublish a list of template inodes\n+     * Return the list of a success unpublished and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToUnpublish {@link List} list of template inodes to unpublish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unpublish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unpublish(@Context final HttpServletRequest  request,\n+                                  @Context final HttpServletResponse response,\n+                                  final List<String> templatesToUnpublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToUnpublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToUnpublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.unpublishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"UnPublish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" unpublishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception wax) {\n+\n+                    Logger.error(this, wax.getMessage(), wax);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                        \"unpublishedInodes\", publishedInodes,\n+                        \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Copy a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to copy\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/copy/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response copy(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Copying the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        final Response responseRest = Response.ok(new ResponseEntityView(\n+                this.templateHelper.toTemplateView(this.templateAPI.copy(template, user), user))).build();\n+\n+        ActivityLogger.logInfo(this.getClass(), \"Copied Template\", \"User \" +\n+                user.getPrimaryKey() + \" copied template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+\n+        return responseRest;\n+    }\n+\n+    /**\n+     * Unlock a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unlock/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unlock(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Unlocking the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_READ);\n+        this.templateAPI.unlock(template, user);\n+\n+        Logger.debug(this, \"Unlocked template: \" + templateInode);\n+        return Response.ok(new ResponseEntityView(true)).build();\n+    }\n+\n+    /**\n+     * Archive a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/archive/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response archive(@Context final HttpServletRequest  request,\n+                                 @Context final HttpServletResponse response,\n+                                 @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Doing archive of the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        final boolean result = this.templateAPI.archive(template, user, pageMode.respectAnonPerms);\n+\n+        Logger.debug(this, \"Archive done template: \" + templateInode);\n+        return Response.ok(new ResponseEntityView(result)).build();\n+    }\n+\n+    /**\n+     * Unarchive a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/unarchive/{templateInode}\")", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwODkwMQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476608901", "bodyText": "Doc", "author": "nollymar", "createdAt": "2020-08-25T17:15:47Z", "path": "dotCMS/src/test/java/com/dotcms/util/pagination/TemplatePaginatorTest.java", "diffHunk": "@@ -0,0 +1,121 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UUIDUtil;\n+import com.liferay.portal.model.User;\n+import org.junit.Test;\n+\n+import java.util.Date;\n+import java.util.Map;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * test {@link TemplatePaginator}\n+ */\n+public class TemplatePaginatorTest {\n+\n+    @Test\n+    public void testGetEmptyTemplateList() throws DotDataException, DotSecurityException {", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwOTAwMQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476609001", "bodyText": "Doc", "author": "nollymar", "createdAt": "2020-08-25T17:15:55Z", "path": "dotCMS/src/test/java/com/dotcms/util/pagination/TemplatePaginatorTest.java", "diffHunk": "@@ -0,0 +1,121 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UUIDUtil;\n+import com.liferay.portal.model.User;\n+import org.junit.Test;\n+\n+import java.util.Date;\n+import java.util.Map;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * test {@link TemplatePaginator}\n+ */\n+public class TemplatePaginatorTest {\n+\n+    @Test\n+    public void testGetEmptyTemplateList() throws DotDataException, DotSecurityException {\n+\n+        final int totalRecords = 10;\n+        final User user = mock(User.class);\n+        final String filter = \"filter\";\n+        final Map<String, Object> params = map(\"title\", filter);\n+        final String hostId = \"1\";\n+        final int offset = 5;\n+        final int limit = 10;\n+        final String orderby = \"title\";\n+\n+        final Host host = mock(Host.class);\n+        when(host.getIdentifier()).thenReturn(hostId);\n+\n+        final PaginatedArrayList<Template> templatesExpected = new PaginatedArrayList<>();\n+        templatesExpected.setTotalResults(totalRecords);\n+\n+        final TemplateAPI templateAPI = mock(TemplateAPI.class);\n+\n+        when(templateAPI.findTemplates(user, false, params, hostId,\n+                null, null, null, offset, limit, \"title asc\")).thenReturn(templatesExpected);\n+\n+        final TemplatePaginator templatePaginator = new TemplatePaginator(templateAPI);\n+\n+        final PaginatedArrayList<TemplateView> templateViews = templatePaginator.getItems(user, filter, limit, offset, orderby,\n+                OrderDirection.ASC, map(ContainerPaginator.HOST_PARAMETER_ID, hostId));\n+\n+        assertEquals(templateViews.getTotalResults(), totalRecords);\n+    }\n+\n+    @Test\n+    public void testGetTemplateList() throws DotDataException, DotSecurityException {", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjYwOTQzNQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476609435", "bodyText": "Add tests to the new methods", "author": "nollymar", "createdAt": "2020-08-25T17:16:37Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPIImpl.java", "diffHunk": "@@ -39,11 +48,13 @@\n \n public class TemplateAPIImpl extends BaseWebAssetAPI implements TemplateAPI {", "originalCommit": "fb3fe3aaebcd4a527fd20d64912b9827e7116ada", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb23b485edddcc411f4fb5b2e6e083849d99d241", "url": "https://github.com/dotCMS/core/commit/cb23b485edddcc411f4fb5b2e6e083849d99d241", "message": "#19096 fixing a test", "committedDate": "2020-08-25T17:58:43Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxODk4Mg==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r476718982", "bodyText": "Why not extend it from Template and add the missing properties.", "author": "erickgonzalez", "createdAt": "2020-08-25T20:31:00Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {", "originalCommit": "cb23b485edddcc411f4fb5b2e6e083849d99d241", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ5MTg1NA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r477491854", "bodyText": "Because the template is a webasset and retrieve so much", "author": "jdotcms", "createdAt": "2020-08-26T18:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjcxODk4Mg=="}], "type": "inlineReview"}, {"oid": "e503f5a859f6ddc13211f39042ce8668796b52f2", "url": "https://github.com/dotCMS/core/commit/e503f5a859f6ddc13211f39042ce8668796b52f2", "message": "#19096 unit test done", "committedDate": "2020-08-25T21:26:19Z", "type": "commit"}, {"oid": "dbb06953a18daa946c8ce2debb1cfd9d06e9a3af", "url": "https://github.com/dotCMS/core/commit/dbb06953a18daa946c8ce2debb1cfd9d06e9a3af", "message": "#19096 adding review feedback", "committedDate": "2020-08-26T18:33:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU5NzE0Mg==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r477597142", "bodyText": "Why this method?? doesUserHavePermission should be enough to check permissions, isn't??", "author": "erickgonzalez", "createdAt": "2020-08-26T21:22:22Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateHelper.java", "diffHunk": "@@ -0,0 +1,96 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.dotcms.util.pagination.TemplateView;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.Role;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.model.User;\n+import io.vavr.control.Try;\n+\n+/**\n+ * Helper for templates\n+ * @author jsanca\n+ */\n+public class TemplateHelper {\n+\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI roleAPI;\n+\n+    public TemplateHelper() {\n+        this(APILocator.getPermissionAPI(),\n+                APILocator.getRoleAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateHelper(final PermissionAPI  permissionAPI,\n+                          final RoleAPI        roleAPI) {\n+\n+        this.permissionAPI  = permissionAPI;\n+        this.roleAPI        = roleAPI;\n+    }\n+\n+    public TemplateView toTemplateView(final Template template, final User user) {\n+\n+        return new TemplateView.Builder()\n+                .name(template.getName())\n+                .friendlyName(template.getFriendlyName())\n+                .title(template.getTitle())\n+                .identifier(template.getIdentifier())\n+                .image(template.getImage())\n+                .selectedimage(template.getSelectedimage())\n+                .inode(template.getInode())\n+\n+                .theme(template.getTheme())\n+                .themeName(template.getThemeName())\n+                .headCode(template.getHeadCode())\n+                .header(template.getHeader())\n+                .body(template.getBody())\n+                .drawed(template.isDrawed())\n+                .drawedBody(template.getDrawedBody())\n+                .footer(template.getFooter())\n+\n+                .isNew(template.isNew())\n+                .hasLiveVersion(Try.of(()->template.hasLiveVersion()).getOrElse(false))\n+                .deleted(Try.of(()->template.isDeleted()).getOrElse(false))\n+                .live(Try.of(()->template.isLive()).getOrElse(false))\n+                .locked(Try.of(()->template.isLocked()).getOrElse(false))\n+                .working(Try.of(()->template.isWorking()).getOrElse(false))\n+\n+                .canRead(Try.of(()-> APILocator.getPermissionAPI().doesUserHavePermission(template, PermissionAPI.PERMISSION_READ, user)).getOrElse(false))\n+                .canWrite(Try.of(()->APILocator.getPermissionAPI().doesUserHavePermission(template, PermissionAPI.PERMISSION_EDIT, user)).getOrElse(false))\n+                .canPublish(Try.of(()->APILocator.getPermissionAPI().doesUserHavePermission(template, PermissionAPI.PERMISSION_PUBLISH, user)).getOrElse(false))\n+\n+                .categoryId(template.getCategoryId())\n+                .countAddContainer(template.getCountAddContainer())\n+                .countContainers(template.getCountContainers())\n+                .modDate(template.getModDate())\n+                .modUser(template.getModUser())\n+                .owner(template.getOwner())\n+                .showOnMenu(template.isShowOnMenu())\n+                .sortOrder(template.getSortOrder())\n+                .build();\n+    }\n+\n+    public void checkPermission(final User user, final Template currentTemplate, final int permissionType) throws DotDataException, DotSecurityException {", "originalCommit": "dbb06953a18daa946c8ce2debb1cfd9d06e9a3af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MjgwMw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480262803", "bodyText": "This method has a bit more logic", "author": "jdotcms", "createdAt": "2020-08-31T16:59:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzU5NzE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0MzY2OA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r479443668", "bodyText": "Use better the TemplateDataGen", "author": "erickgonzalez", "createdAt": "2020-08-28T17:32:50Z", "path": "dotCMS/src/test/java/com/dotcms/util/pagination/TemplatePaginatorTest.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UUIDUtil;\n+import com.liferay.portal.model.User;\n+import org.junit.Test;\n+\n+import java.util.Date;\n+import java.util.Map;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * test {@link TemplatePaginator}\n+ */\n+public class TemplatePaginatorTest {\n+\n+    /**\n+     * Method to test: getItems\n+     * Given Scenario: Just recovery an empty list of elements\n+     * ExpectedResult: Perform ok, just with zero results\n+     *\n+     */\n+    @Test\n+    public void testGetEmptyTemplateList() throws DotDataException, DotSecurityException {\n+\n+        final int totalRecords = 10;\n+        final User user = mock(User.class);\n+        final String filter = \"filter\";\n+        final Map<String, Object> params = map(\"title\", filter);\n+        final String hostId = \"1\";\n+        final int offset = 5;\n+        final int limit = 10;\n+        final String orderby = \"title\";\n+\n+        final Host host = mock(Host.class);\n+        when(host.getIdentifier()).thenReturn(hostId);\n+\n+        final PaginatedArrayList<Template> templatesExpected = new PaginatedArrayList<>();\n+        templatesExpected.setTotalResults(totalRecords);\n+\n+        final TemplateAPI templateAPI     = mock(TemplateAPI.class);\n+        final PermissionAPI permissionAPI = mock(PermissionAPI.class);\n+        final RoleAPI       roleAPI       = mock(RoleAPI.class);\n+\n+        when(templateAPI.findTemplates(user, false, params, hostId,\n+                null, null, null, offset, limit, \"title asc\")).thenReturn(templatesExpected);\n+\n+        final TemplatePaginator templatePaginator = new TemplatePaginator(templateAPI, new TemplateHelper(permissionAPI, roleAPI));\n+\n+        final PaginatedArrayList<TemplateView> templateViews = templatePaginator.getItems(user, filter, limit, offset, orderby,\n+                OrderDirection.ASC, map(ContainerPaginator.HOST_PARAMETER_ID, hostId));\n+\n+        assertEquals(templateViews.getTotalResults(), totalRecords);\n+    }\n+\n+    /**\n+     * Method to test: getItems\n+     * Given Scenario: Just recovery an empty list of elements\n+     * ExpectedResult: Perform ok, just with zero results\n+     *\n+     */\n+    @Test\n+    public void testGetTemplateList() throws DotDataException, DotSecurityException {\n+\n+        final int totalRecords = 10;\n+        final User user = mock(User.class);\n+        final String filter = \"filter\";\n+        final Map<String, Object> params = map(\"title\", filter);\n+        final String hostId = \"1\";\n+        final int offset = 5;\n+        final int limit = 10;\n+        final String orderby = \"title\";\n+\n+        final Host host = mock(Host.class);\n+        when(host.getIdentifier()).thenReturn(hostId);\n+\n+        final PaginatedArrayList<Template> templatesExpected = new PaginatedArrayList<>();\n+        templatesExpected.add(newTemplate(1));\n+        templatesExpected.add(newTemplate(2));\n+        templatesExpected.add(newTemplate(3));\n+        templatesExpected.setTotalResults(totalRecords);\n+\n+        final TemplateAPI templateAPI     = mock(TemplateAPI.class);\n+        final PermissionAPI permissionAPI = mock(PermissionAPI.class);\n+        final RoleAPI       roleAPI       = mock(RoleAPI.class);\n+\n+        when(templateAPI.findTemplates(user, false, params, hostId,\n+                null, null, null, offset, limit, \"title asc\")).thenReturn(templatesExpected);\n+\n+        final TemplatePaginator templatePaginator = new TemplatePaginator(templateAPI, new TemplateHelper(permissionAPI, roleAPI));\n+\n+        final PaginatedArrayList<TemplateView> templateViews = templatePaginator.getItems(user, filter, limit, offset, orderby,\n+                OrderDirection.ASC, map(ContainerPaginator.HOST_PARAMETER_ID, hostId));\n+\n+        assertEquals(templateViews.getTotalResults(), totalRecords);\n+        int i = 0;\n+        for (final TemplateView templateView : templateViews) {\n+\n+            final Template template = templatesExpected.get(i++);\n+            assertEquals(templateView.getIdentifier(), template.getIdentifier());\n+            assertEquals(templateView.getInode(),      template.getInode());\n+            assertEquals(templateView.getBody(),       template.getBody());\n+            assertEquals(templateView.getTitle(),      template.getTitle());\n+        }\n+    }\n+\n+    private Template newTemplate (final int sortOrder) {", "originalCommit": "dbb06953a18daa946c8ce2debb1cfd9d06e9a3af", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NjM1Mw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r479446353", "bodyText": "Remember to add the new tests to the MainSuite, if not added it will not run.", "author": "erickgonzalez", "createdAt": "2020-08-28T17:38:46Z", "path": "dotCMS/src/test/java/com/dotcms/util/pagination/TemplatePaginatorTest.java", "diffHunk": "@@ -0,0 +1,140 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UUIDUtil;\n+import com.liferay.portal.model.User;\n+import org.junit.Test;\n+\n+import java.util.Date;\n+import java.util.Map;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static org.junit.Assert.assertEquals;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+/**\n+ * test {@link TemplatePaginator}\n+ */\n+public class TemplatePaginatorTest {", "originalCommit": "dbb06953a18daa946c8ce2debb1cfd9d06e9a3af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDI2MzAwNw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480263007", "bodyText": "This is not an integration, just unit test", "author": "jdotcms", "createdAt": "2020-08-31T16:59:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3OTQ0NjM1Mw=="}], "type": "inlineReview"}, {"oid": "702f6c33cd62532bca2edc3816d81eb05c6e0a7e", "url": "https://github.com/dotCMS/core/commit/702f6c33cd62532bca2edc3816d81eb05c6e0a7e", "message": "#19096 switching to local env on curl test instead of using localhost directly", "committedDate": "2020-08-31T18:21:43Z", "type": "commit"}, {"oid": "3ab0d7953c8925174569c5bff5d59291efe506f8", "url": "https://github.com/dotCMS/core/commit/3ab0d7953c8925174569c5bff5d59291efe506f8", "message": "#19096 fixing an unit test", "committedDate": "2020-08-31T19:00:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTE3Ng==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331176", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "author": "dev-dotcms", "createdAt": "2020-08-31T19:07:54Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/_publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTE5MQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331191", "bodyText": "Codacy found an issue: Field drawed has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:07:56Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateForm.java", "diffHunk": "@@ -0,0 +1,303 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+\n+/**\n+ * Template Input Form\n+ * @author jsanca\n+ */\n+@JsonDeserialize(builder = TemplateForm.Builder.class)\n+public class TemplateForm {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean headerCheck;\n+    private final boolean footerCheck;\n+\n+    private TemplateForm(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.headerCheck = builder.headerCheck;\n+        this.footerCheck = builder.footerCheck;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isHeaderCheck() {\n+        return headerCheck;\n+    }\n+\n+    public boolean isFooterCheck() {\n+        return footerCheck;\n+    }\n+\n+    public static final class Builder {\n+\n+        @JsonProperty\n+        private  String identifier;\n+        @JsonProperty\n+        private  String inode;\n+        @JsonProperty\n+        private  String body;\n+        @JsonProperty\n+        private  String selectedimage;\n+        @JsonProperty\n+        private  String image;\n+        @JsonProperty\n+        private  boolean drawed;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTIwNw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331207", "bodyText": "Codacy found an issue: Avoid unused private fields such as 'htmlPageAssetAPI'.", "author": "dev-dotcms", "createdAt": "2020-08-31T19:07:57Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTIxNQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331215", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.business.web.WebAPILocator'", "author": "dev-dotcms", "createdAt": "2020-08-31T19:07:58Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplatePaginator.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Permission;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTIyNA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331224", "bodyText": "Codacy found an issue: Field title has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:00Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;\n+        private  boolean showOnMenu;\n+        private  String drawedBody;\n+        private  int countAddContainer;\n+        private  int countContainers;\n+        private  String headCode;\n+        private  String theme;\n+        private  String themeName;\n+        private  String footer;\n+        private  String friendlyName;\n+        private  String header;\n+        private  Date modDate;\n+        private  String modUser;\n+        private  String owner;\n+        private  String name;\n+        private  String title;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTIzMA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331230", "bodyText": "Codacy found an issue: Field identifier has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:01Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTIzNw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331237", "bodyText": "Codacy found an issue: Field owner has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:02Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;\n+        private  boolean showOnMenu;\n+        private  String drawedBody;\n+        private  int countAddContainer;\n+        private  int countContainers;\n+        private  String headCode;\n+        private  String theme;\n+        private  String themeName;\n+        private  String footer;\n+        private  String friendlyName;\n+        private  String header;\n+        private  Date modDate;\n+        private  String modUser;\n+        private  String owner;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTI0NA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331244", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.beans.Permission'", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:03Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplatePaginator.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Permission;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTI1Mw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331253", "bodyText": "Codacy found an issue: Avoid catching generic exceptions such as NullPointerException, RuntimeException, Exception in try-catch block", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:04Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplatePaginator.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Permission;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UtilMethods;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.StringPool;\n+import io.vavr.control.Try;\n+\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+\n+/**\n+ * Handle {@link com.dotmarketing.portlets.templates.model.Template} pagination\n+ * @author jsanca\n+ */\n+public class TemplatePaginator implements PaginatorOrdered<TemplateView> {\n+\n+    public static final String HOST_PARAMETER_ID = \"host\";\n+\n+    private final TemplateAPI templateAPI;\n+    private final TemplateHelper templateHelper;\n+\n+    public TemplatePaginator() {\n+        this(APILocator.getTemplateAPI(),\n+                new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()));\n+    }\n+\n+    @VisibleForTesting\n+    public TemplatePaginator(final TemplateAPI templateAPI, final TemplateHelper templateHelper) {\n+\n+        this.templateAPI    = templateAPI;\n+        this.templateHelper = templateHelper;\n+    }\n+\n+    @Override\n+    public PaginatedArrayList<TemplateView> getItems(final User user, final String filter, final int limit, final int offset,\n+                                                  final String orderby, final OrderDirection direction,\n+                                                  final Map<String, Object> extraParams) {\n+        String hostId = null;\n+\n+        if (extraParams != null) {\n+            hostId = (String) extraParams.get(HOST_PARAMETER_ID);\n+        }\n+\n+        final Map<String, Object> params = map(\"title\", filter);\n+\n+        String orderByDirection = orderby;\n+        if (UtilMethods.isSet(direction) && UtilMethods.isSet(orderby)) {\n+            orderByDirection = new StringBuffer(orderByDirection)\n+                    .append(\" \")\n+                    .append(direction.toString().toLowerCase()).toString();\n+        }\n+\n+        try {\n+            final PaginatedArrayList<Template> allTemplates =\n+                    (PaginatedArrayList<Template>) templateAPI.findTemplates(user, false, params, hostId,\n+                    null, null, null, offset, limit, orderByDirection);\n+\n+            if (UtilMethods.isSet(hostId)) {\n+\n+                allTemplates.stream().sorted(\n+                        direction == OrderDirection.ASC?Comparator.comparing(this::hostname):\n+                                Comparator.comparing(this::hostname).reversed());\n+            }\n+\n+            final PaginatedArrayList<TemplateView> templates =\n+                    new PaginatedArrayList<>();\n+            templates.addAll(allTemplates.stream().map(template -> this.templateHelper.toTemplateView(template, user)).collect(Collectors.toList()));\n+            templates.setQuery(allTemplates.getQuery());\n+            templates.setTotalResults(allTemplates.getTotalResults());\n+\n+            return templates;\n+        } catch (DotSecurityException | DotDataException e) {\n+\n+            Logger.error(this, e.getMessage(), e);\n+            throw new PaginationException(e);\n+        }\n+    }\n+\n+    private String hostname (final Template template) {\n+\n+        try {\n+            return Host.class.cast(template.getParentPermissionable()).getHostname();\n+        } catch (Exception e) {", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTI2Mw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331263", "bodyText": "Codacy found an issue: Avoid appending characters as strings in StringBuffer.append.", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:05Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplatePaginator.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Permission;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UtilMethods;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.StringPool;\n+import io.vavr.control.Try;\n+\n+import java.util.Collections;\n+import java.util.Comparator;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.stream.Collectors;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+\n+/**\n+ * Handle {@link com.dotmarketing.portlets.templates.model.Template} pagination\n+ * @author jsanca\n+ */\n+public class TemplatePaginator implements PaginatorOrdered<TemplateView> {\n+\n+    public static final String HOST_PARAMETER_ID = \"host\";\n+\n+    private final TemplateAPI templateAPI;\n+    private final TemplateHelper templateHelper;\n+\n+    public TemplatePaginator() {\n+        this(APILocator.getTemplateAPI(),\n+                new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()));\n+    }\n+\n+    @VisibleForTesting\n+    public TemplatePaginator(final TemplateAPI templateAPI, final TemplateHelper templateHelper) {\n+\n+        this.templateAPI    = templateAPI;\n+        this.templateHelper = templateHelper;\n+    }\n+\n+    @Override\n+    public PaginatedArrayList<TemplateView> getItems(final User user, final String filter, final int limit, final int offset,\n+                                                  final String orderby, final OrderDirection direction,\n+                                                  final Map<String, Object> extraParams) {\n+        String hostId = null;\n+\n+        if (extraParams != null) {\n+            hostId = (String) extraParams.get(HOST_PARAMETER_ID);\n+        }\n+\n+        final Map<String, Object> params = map(\"title\", filter);\n+\n+        String orderByDirection = orderby;\n+        if (UtilMethods.isSet(direction) && UtilMethods.isSet(orderby)) {\n+            orderByDirection = new StringBuffer(orderByDirection)\n+                    .append(\" \")", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTI3NA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331274", "bodyText": "Codacy found an issue: Unnecessary use of fully qualified name 'CollectionsUtils.map' due to existing static import 'com.dotcms.util.CollectionsUtils.map'", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:06Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/_publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTI4NA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331284", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:07Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/_publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTI5MA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331290", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.business.web.HostWebAPI'", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:08Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplatePaginator.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Permission;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.web.HostWebAPI;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTMwMA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331300", "bodyText": "Codacy found an issue: Field name has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:09Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateForm.java", "diffHunk": "@@ -0,0 +1,303 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import com.fasterxml.jackson.databind.annotation.JsonDeserialize;\n+\n+/**\n+ * Template Input Form\n+ * @author jsanca\n+ */\n+@JsonDeserialize(builder = TemplateForm.Builder.class)\n+public class TemplateForm {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean headerCheck;\n+    private final boolean footerCheck;\n+\n+    private TemplateForm(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.headerCheck = builder.headerCheck;\n+        this.footerCheck = builder.footerCheck;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isHeaderCheck() {\n+        return headerCheck;\n+    }\n+\n+    public boolean isFooterCheck() {\n+        return footerCheck;\n+    }\n+\n+    public static final class Builder {\n+\n+        @JsonProperty\n+        private  String identifier;\n+        @JsonProperty\n+        private  String inode;\n+        @JsonProperty\n+        private  String body;\n+        @JsonProperty\n+        private  String selectedimage;\n+        @JsonProperty\n+        private  String image;\n+        @JsonProperty\n+        private  boolean drawed;\n+        @JsonProperty\n+        private  boolean showOnMenu;\n+        @JsonProperty\n+        private  String drawedBody;\n+        @JsonProperty\n+        private  int countAddContainer;\n+        @JsonProperty\n+        private  int countContainers;\n+        @JsonProperty\n+        private  String headCode;\n+        @JsonProperty\n+        private  String theme;\n+        @JsonProperty\n+        private  String themeName;\n+        @JsonProperty\n+        private  String footer;\n+        @JsonProperty\n+        private  String friendlyName;\n+        @JsonProperty\n+        private  String header;\n+        @JsonProperty\n+        private  String name;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTMxMQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331311", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.beans.Inode'", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:10Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/business/TemplateAPI.java", "diffHunk": "@@ -1,11 +1,13 @@\n package com.dotmarketing.portlets.templates.business;\n \n import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Inode;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTMyOA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331328", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:11Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final Template currentTemplate = this.templateAPI.find(templateForm.getInode(), user, pageMode.respectAnonPerms);\n+\n+        if (null == currentTemplate || UtilMethods.isNotSet(currentTemplate.getIdentifier())\n+                || !InodeUtils.isSet(currentTemplate.getInode())) {\n+\n+            throw new DoesNotExistException(\"The working template inode: \" + templateForm.getInode() + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, currentTemplate, PERMISSION_WRITE);\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, currentTemplate), user))).build();\n+    }\n+\n+    /**\n+     * Publish a list of template inodes\n+     * Return the list of a success published and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToPublish {@link List} list of template inodes to publish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/_publish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response publish(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               final List<String> templatesToPublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToPublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToPublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.publishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"Publish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" publishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception e) {\n+\n+                    Logger.error(this, e.getMessage(), e);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                \"publishedInodes\", publishedInodes,\n+                \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Unpublish a list of template inodes\n+     * Return the list of a success unpublished and failed\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templatesToUnpublish {@link List} list of template inodes to unpublish\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/_unpublish\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unpublish(@Context final HttpServletRequest  request,\n+                                  @Context final HttpServletResponse response,\n+                                  final List<String> templatesToUnpublish) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+        final List<String> publishedInodes = new ArrayList<>();\n+        final List<String> failedInodes    = new ArrayList<>();\n+\n+        if (!UtilMethods.isSet(templatesToUnpublish)) {\n+\n+            throw new IllegalArgumentException(\"The body must send a collection of template inodes such as: \" +\n+                    \"[\\\"dd60695c-9e0f-4a2e-9fd8-ce2a4ac5c27d\\\",\\\"cc59390c-9a0f-4e7a-9fd8-ca7e4ec0c77d\\\"]\");\n+        }\n+\n+        for (final String templateInode : templatesToUnpublish) {\n+\n+            final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+            if (null != template && InodeUtils.isSet(template.getInode())) {\n+\n+                try {\n+\n+                    if (this.templateAPI.unpublishTemplate(template, user, pageMode.respectAnonPerms)) {\n+\n+                        ActivityLogger.logInfo(this.getClass(), \"UnPublish Template action\", \"User \" +\n+                                user.getPrimaryKey() + \" unpublishing template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+                        publishedInodes.add(templateInode);\n+                    } else {\n+                        failedInodes.add(templateInode);\n+                    }\n+                } catch(Exception wax) {\n+\n+                    Logger.error(this, wax.getMessage(), wax);\n+                    failedInodes.add(templateInode);\n+                }\n+            } else {\n+\n+                failedInodes.add(templateInode);\n+            }\n+        }\n+\n+        return Response.ok(new ResponseEntityView(\n+                CollectionsUtils.map(\n+                        \"unpublishedInodes\", publishedInodes,\n+                        \"failedInodes\",   failedInodes\n+                ))).build();\n+    }\n+\n+    /**\n+     * Copy a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to copy\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/{templateInode}/_copy\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response copy(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Copying the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        final Response responseRest = Response.ok(new ResponseEntityView(\n+                this.templateHelper.toTemplateView(this.templateAPI.copy(template, user), user))).build();\n+\n+        ActivityLogger.logInfo(this.getClass(), \"Copied Template\", \"User \" +\n+                user.getPrimaryKey() + \" copied template\" + template.getTitle(), host.getTitle() != null ? host.getTitle() : \"default\");\n+\n+        return responseRest;\n+    }\n+\n+    /**\n+     * Unlock a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/{templateInode}/_unlock\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unlock(@Context final HttpServletRequest  request,\n+                               @Context final HttpServletResponse response,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Unlocking the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_READ);\n+        this.templateAPI.unlock(template, user);\n+\n+        Logger.debug(this, \"Unlocked template: \" + templateInode);\n+        return Response.ok(new ResponseEntityView(true)).build();\n+    }\n+\n+    /**\n+     * Archive a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/{templateInode}/_archive\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response archive(@Context final HttpServletRequest  request,\n+                                 @Context final HttpServletResponse response,\n+                                 @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Doing archive of the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        final boolean result = this.templateAPI.archive(template, user, pageMode.respectAnonPerms);\n+\n+        Logger.debug(this, \"Archive done template: \" + templateInode);\n+        return Response.ok(new ResponseEntityView(result)).build();\n+    }\n+\n+    /**\n+     * Unarchive a template\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to unlock\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @Path(\"/{templateInode}/_unarchive\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response unarchive(@Context final HttpServletRequest  request,\n+                                  @Context final HttpServletResponse response,\n+                                  @PathParam(\"templateInode\") final String templateInode) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        Logger.debug(this, ()->\"Doing unarchive of the Template: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, pageMode.respectAnonPerms);\n+\n+        if (null == template || !InodeUtils.isSet(template.getInode())) {\n+\n+            throw new DoesNotExistException(\"The  template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        this.templateHelper.checkPermission(user, template, PERMISSION_WRITE);\n+        this.templateAPI.unarchive(template);\n+\n+        Logger.debug(this, \"Unarchive done template: \" + templateInode);\n+        return Response.ok(new ResponseEntityView(true)).build();\n+    }\n+\n+    /**\n+     * Deletes a template\n+     * Pre: template must not has dependencies\n+     * @param request            {@link HttpServletRequest}\n+     * @param response           {@link HttpServletResponse}\n+     * @param templateInode      {@link String} template inode to look for the template and then, delete it\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @DELETE\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response delete(@Context final HttpServletRequest  request,\n+                                    @Context final HttpServletResponse response,\n+                                    @PathParam(\"templateInode\") final String templateInode) throws Exception {", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM0MQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331341", "bodyText": "Codacy found an issue: Field theme has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:12Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;\n+        private  boolean showOnMenu;\n+        private  String drawedBody;\n+        private  int countAddContainer;\n+        private  int countContainers;\n+        private  String headCode;\n+        private  String theme;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM0OA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331348", "bodyText": "Codacy found an issue: Field themeName has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:13Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;\n+        private  boolean showOnMenu;\n+        private  String drawedBody;\n+        private  int countAddContainer;\n+        private  int countContainers;\n+        private  String headCode;\n+        private  String theme;\n+        private  String themeName;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM1Nw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331357", "bodyText": "Codacy found an issue: Field hasLiveVersion has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:14Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM2NQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331365", "bodyText": "Codacy found an issue: Field isNew has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:15Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM3Mw==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331373", "bodyText": "Codacy found an issue: Avoid declaring a variable if it is unreferenced before a possible exit point.", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:16Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response list(@Context final HttpServletRequest httpRequest,\n+                                        @Context final HttpServletResponse httpResponse,\n+                                        @QueryParam(PaginationUtil.FILTER)   final String filter,\n+                                        @QueryParam(PaginationUtil.PAGE)     final int page,\n+                                        @QueryParam(PaginationUtil.PER_PAGE) final int perPage,\n+                                        @DefaultValue(\"title\") @QueryParam(PaginationUtil.ORDER_BY) final String orderBy,\n+                                        @DefaultValue(\"ASC\") @QueryParam(PaginationUtil.DIRECTION)  final String direction,\n+                                        @QueryParam(ContainerPaginator.HOST_PARAMETER_ID)           final String hostId) {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user = initData.getUser();\n+        final Optional<String> checkedHostId = Optional.ofNullable(Try.of(()-> APILocator.getHostAPI()\n+                .find(hostId, user, false).getIdentifier()).getOrNull());\n+\n+        Logger.debug(this, ()-> \"Getting the List of templates\");\n+\n+        final Map<String, Object> extraParams = Maps.newHashMap();\n+        checkedHostId.ifPresent(checkedHostIdentifier -> extraParams.put(ContainerPaginator.HOST_PARAMETER_ID, checkedHostIdentifier));\n+        return this.paginationUtil.getPage(httpRequest, user, filter, page, perPage, orderBy, OrderDirection.valueOf(direction),\n+                extraParams);\n+    }\n+\n+    /**\n+     * Return a {@link com.dotmarketing.portlets.templates.model.Template} based on the inode\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateInode}\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getByInode(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateInode\") final String templateInode) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the template by inode: \" + templateInode);\n+\n+        final Template template = this.templateAPI.find(templateInode, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The template inode: \" + templateInode + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a live version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/live\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getLiveById(@Context final HttpServletRequest  httpRequest,\n+                               @Context final HttpServletResponse httpResponse,\n+                               @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the live template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findLiveTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The live template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    /**\n+     * Return a working version {@link com.dotmarketing.portlets.templates.model.Template} based on the id\n+     *\n+     * @return Response\n+     */\n+    @GET\n+    @Path(\"/{templateId}/working\")\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response getWorkingById(@Context final HttpServletRequest  httpRequest,\n+                                         @Context final HttpServletResponse httpResponse,\n+                                         @PathParam(\"templateId\") final String templateId) throws DotSecurityException, DotDataException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(httpRequest, httpResponse).rejectWhenNoUser(true).init();\n+        final User user     = initData.getUser();\n+        final PageMode mode = PageMode.get(httpRequest);\n+        Logger.debug(this, ()-> \"Getting the working template by id: \" + templateId);\n+\n+        final Template template = this.templateAPI.findWorkingTemplate(templateId, user, mode.respectAnonPerms);\n+\n+        if (null == template || UtilMethods.isNotSet(template.getIdentifier())) {\n+\n+            throw new DoesNotExistException(\"The working template id: \" + templateId + \" does not exists\");\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(template, user))).build();\n+    }\n+\n+    @POST\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response saveNew(@Context final HttpServletRequest  request,\n+                                @Context final HttpServletResponse response,\n+                                final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);\n+        final PageMode pageMode = PageMode.get(request);\n+\n+        if(!permissionAPI.doesUserHavePermission(host, PermissionAPI.PERMISSION_CAN_ADD_CHILDREN, user, pageMode.respectAnonPerms)) {\n+\n+            Logger.error(this, \"The user: \" + user.getUserId() + \" does not have permission to add a template\");\n+            throw new DotSecurityException(WebKeys.USER_PERMISSIONS_EXCEPTION);\n+        }\n+\n+        return Response.ok(new ResponseEntityView(this.templateHelper.toTemplateView(\n+                this.fillAndSaveTemplate(templateForm, user, host, pageMode, new Template()), user))).build();\n+    }\n+\n+    /**\n+     * Save a single template\n+     * @param request       {@link HttpServletRequest}\n+     * @param response      {@link HttpServletResponse}\n+     * @param templateForm  {@link TemplateForm}\n+     * @return Response\n+     * @throws DotDataException\n+     * @throws DotSecurityException\n+     */\n+    @PUT\n+    @JSONP\n+    @NoCache\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})\n+    public final Response save(@Context final HttpServletRequest  request,\n+                            @Context final HttpServletResponse response,\n+                            final TemplateForm templateForm) throws DotDataException, DotSecurityException {\n+\n+        final InitDataObject initData = new WebResource.InitBuilder(webResource)\n+                .requestAndResponse(request, response).rejectWhenNoUser(true).init();\n+        final User user         = initData.getUser();\n+        final Host host         = this.hostWebAPI.getCurrentHostNoThrow(request);", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM3OQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331379", "bodyText": "Codacy found an issue: Field countAddContainer has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:17Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;\n+        private  boolean showOnMenu;\n+        private  String drawedBody;\n+        private  int countAddContainer;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTM4OQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331389", "bodyText": "Codacy found an issue: Field header has the same name as a method", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:18Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplateView.java", "diffHunk": "@@ -0,0 +1,410 @@\n+package com.dotcms.util.pagination;\n+\n+import java.util.Date;\n+\n+public class TemplateView {\n+\n+    private final String  identifier;\n+    private final String  inode;\n+    private final String  categoryId;\n+    private final String  body;\n+    private final String  selectedimage;\n+    private final String  image;\n+    private final boolean drawed;\n+    private final boolean deleted;\n+    private final boolean live;\n+    private final boolean locked;\n+    private final boolean working;\n+    private final boolean isNew;\n+    private final boolean hasLiveVersion;\n+    private final boolean showOnMenu;\n+    private final String  drawedBody;\n+    private final int     countAddContainer;\n+    private final int     countContainers;\n+    private final String  headCode;\n+    private final String  theme;\n+    private final String  themeName;\n+    private final String  footer;\n+    private final String  friendlyName;\n+    private final String  header;\n+    private final Date    modDate;\n+    private final String  modUser;\n+    private final String  owner;\n+    private final String  name;\n+    private final String  title;\n+    private final int     sortOrder;\n+    private final boolean canRead;\n+    private final boolean canWrite;\n+    private final boolean canPublish;\n+\n+    private TemplateView(final Builder builder) {\n+\n+        this.identifier = builder.identifier;\n+        this.inode = builder.inode;\n+        this.categoryId = builder.categoryId;\n+        this.body = builder.body;\n+        this.selectedimage = builder.selectedimage;\n+        this.image = builder.image;\n+        this.drawed = builder.drawed;\n+        this.deleted = builder.deleted;\n+        this.live = builder.live;\n+        this.locked = builder.locked;\n+        this.working = builder.working;\n+        this.isNew = builder.isNew;\n+        this.hasLiveVersion = builder.hasLiveVersion;\n+        this.showOnMenu = builder.showOnMenu;\n+        this.drawedBody = builder.drawedBody;\n+        this.countAddContainer = builder.countAddContainer;\n+        this.countContainers = builder.countContainers;\n+        this.headCode = builder.headCode;\n+        this.theme = builder.theme;\n+        this.themeName = builder.themeName;\n+        this.footer = builder.footer;\n+        this.friendlyName = builder.friendlyName;\n+        this.header = builder.header;\n+        this.modDate = builder.modDate;\n+        this.modUser = builder.modUser;\n+        this.owner = builder.owner;\n+        this.name = builder.name;\n+        this.title = builder.title;\n+        this.sortOrder = builder.sortOrder;\n+        this.canRead = builder.canRead;\n+        this.canWrite = builder.canWrite;\n+        this.canPublish = builder.canPublish;\n+    }\n+\n+    public String getIdentifier() {\n+        return identifier;\n+    }\n+\n+    public String getInode() {\n+        return inode;\n+    }\n+\n+    public String getCategoryId() {\n+        return categoryId;\n+    }\n+\n+    public String getBody() {\n+        return body;\n+    }\n+\n+    public String getSelectedimage() {\n+        return selectedimage;\n+    }\n+\n+    public String getImage() {\n+        return image;\n+    }\n+\n+    public boolean isDrawed() {\n+        return drawed;\n+    }\n+\n+    public boolean isDeleted() {\n+        return deleted;\n+    }\n+\n+    public boolean isLive() {\n+        return live;\n+    }\n+\n+    public boolean isLocked() {\n+        return locked;\n+    }\n+\n+    public boolean isWorking() {\n+        return working;\n+    }\n+\n+    public boolean isNew() {\n+        return isNew;\n+    }\n+\n+    public boolean isHasLiveVersion() {\n+        return hasLiveVersion;\n+    }\n+\n+    public boolean isShowOnMenu() {\n+        return showOnMenu;\n+    }\n+\n+    public String getDrawedBody() {\n+        return drawedBody;\n+    }\n+\n+    public int getCountAddContainer() {\n+        return countAddContainer;\n+    }\n+\n+    public int getCountContainers() {\n+        return countContainers;\n+    }\n+\n+    public String getHeadCode() {\n+        return headCode;\n+    }\n+\n+    public String getTheme() {\n+        return theme;\n+    }\n+\n+    public String getThemeName() {\n+        return themeName;\n+    }\n+\n+    public String getFooter() {\n+        return footer;\n+    }\n+\n+    public String getFriendlyName() {\n+        return friendlyName;\n+    }\n+\n+    public String getHeader() {\n+        return header;\n+    }\n+\n+    public Date getModDate() {\n+        return modDate;\n+    }\n+\n+    public String getModUser() {\n+        return modUser;\n+    }\n+\n+    public String getOwner() {\n+        return owner;\n+    }\n+\n+    public String getName() {\n+        return name;\n+    }\n+\n+    public String getTitle() {\n+        return title;\n+    }\n+\n+    public int getSortOrder() {\n+        return sortOrder;\n+    }\n+\n+    public boolean isCanRead() {\n+        return canRead;\n+    }\n+\n+    public boolean isCanWrite() {\n+        return canWrite;\n+    }\n+\n+    public boolean isCanPublish() {\n+        return canPublish;\n+    }\n+\n+    public static final class Builder {\n+\n+        private  String identifier;\n+        private  String inode;\n+        private  String categoryId;\n+        private  String body;\n+        private  String selectedimage;\n+        private  String image;\n+        private  boolean drawed;\n+        private  boolean deleted;\n+        private  boolean live;\n+        private  boolean locked;\n+        private  boolean working;\n+        private  boolean isNew;\n+        private  boolean hasLiveVersion;\n+        private  boolean showOnMenu;\n+        private  String drawedBody;\n+        private  int countAddContainer;\n+        private  int countContainers;\n+        private  String headCode;\n+        private  String theme;\n+        private  String themeName;\n+        private  String footer;\n+        private  String friendlyName;\n+        private  String header;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTQwNA==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331404", "bodyText": "Codacy found an issue: The String literal \"application/javascript\" appears 4 times in this file; the first occurrence is on line 122", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:18Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/template/TemplateResource.java", "diffHunk": "@@ -0,0 +1,752 @@\n+package com.dotcms.rest.api.v1.template;\n+\n+import com.beust.jcommander.internal.Maps;\n+import com.dotcms.business.WrapInTransaction;\n+import com.dotcms.contenttype.model.type.BaseContentType;\n+import com.dotcms.rest.InitDataObject;\n+import com.dotcms.rest.ResponseEntityView;\n+import com.dotcms.rest.WebResource;\n+import com.dotcms.rest.annotation.NoCache;\n+import com.dotcms.util.CollectionsUtils;\n+import com.dotcms.util.PaginationUtil;\n+import com.dotcms.util.pagination.ContainerPaginator;\n+import com.dotcms.util.pagination.OrderDirection;\n+import com.dotcms.util.pagination.TemplatePaginator;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.RoleAPI;\n+import com.dotmarketing.business.VersionableAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DoesNotExistException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.factories.WebAssetFactory;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.folders.business.FolderAPI;\n+import com.dotmarketing.portlets.htmlpageasset.business.HTMLPageAssetAPI;\n+import com.dotmarketing.portlets.htmlpageasset.model.HTMLPageAsset;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.business.TemplateConstants;\n+import com.dotmarketing.portlets.templates.design.util.DesignTemplateUtil;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.ActivityLogger;\n+import com.dotmarketing.util.InodeUtils;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PageMode;\n+import com.dotmarketing.util.UtilMethods;\n+import com.dotmarketing.util.WebKeys;\n+import com.google.common.annotations.VisibleForTesting;\n+import com.liferay.portal.language.LanguageException;\n+import com.liferay.portal.language.LanguageUtil;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.servlet.SessionDialogMessage;\n+import io.vavr.control.Try;\n+import org.glassfish.jersey.server.JSONP;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import javax.ws.rs.Consumes;\n+import javax.ws.rs.DELETE;\n+import javax.ws.rs.DefaultValue;\n+import javax.ws.rs.GET;\n+import javax.ws.rs.POST;\n+import javax.ws.rs.PUT;\n+import javax.ws.rs.Path;\n+import javax.ws.rs.PathParam;\n+import javax.ws.rs.Produces;\n+import javax.ws.rs.QueryParam;\n+import javax.ws.rs.core.Context;\n+import javax.ws.rs.core.MediaType;\n+import javax.ws.rs.core.Response;\n+import java.util.ArrayList;\n+import java.util.Date;\n+import java.util.List;\n+import java.util.Map;\n+import java.util.Optional;\n+\n+import static com.dotcms.util.CollectionsUtils.map;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_READ;\n+import static com.dotmarketing.business.PermissionAPI.PERMISSION_WRITE;\n+\n+/**\n+ * CRUD of Templates\n+ * @author jsanca\n+ */\n+@Path(\"/v1/templates\")\n+public class TemplateResource {\n+\n+    private final PaginationUtil paginationUtil;\n+    private final WebResource    webResource;\n+    private final TemplateAPI    templateAPI;\n+    private final VersionableAPI versionableAPI;\n+    private final FolderAPI      folderAPI;\n+    private final HostWebAPI     hostWebAPI;\n+    private final PermissionAPI  permissionAPI;\n+    private final RoleAPI        roleAPI;\n+    private final HTMLPageAssetAPI htmlPageAssetAPI;\n+    private final TemplateHelper templateHelper;\n+\n+\n+    public TemplateResource() {\n+\n+        this(new WebResource(),\n+                new PaginationUtil(new TemplatePaginator(APILocator.getTemplateAPI(),\n+                        new TemplateHelper(APILocator.getPermissionAPI(), APILocator.getRoleAPI()))),\n+                APILocator.getTemplateAPI(),\n+                APILocator.getVersionableAPI(),\n+                APILocator.getFolderAPI(),\n+                APILocator.getPermissionAPI(),\n+                WebAPILocator.getHostWebAPI(),\n+                APILocator.getRoleAPI(),\n+                APILocator.getHTMLPageAssetAPI());\n+    }\n+\n+    @VisibleForTesting\n+    public TemplateResource(final WebResource     webResource,\n+                             final PaginationUtil templatePaginator,\n+                             final TemplateAPI    templateAPI,\n+                             final VersionableAPI versionableAPI,\n+                             final FolderAPI      folderAPI,\n+                             final PermissionAPI  permissionAPI,\n+                             final HostWebAPI     hostWebAPI,\n+                             final RoleAPI        roleAPI,\n+                             final HTMLPageAssetAPI htmlPageAssetAPI) {\n+\n+        this.webResource    = webResource;\n+        this.templateAPI    = templateAPI;\n+        this.versionableAPI = versionableAPI;\n+        this.folderAPI      = folderAPI;\n+        this.permissionAPI  = permissionAPI;\n+        this.hostWebAPI     = hostWebAPI;\n+        this.roleAPI        = roleAPI;\n+        this.htmlPageAssetAPI = htmlPageAssetAPI;\n+        this.templateHelper = new TemplateHelper(permissionAPI, roleAPI);\n+        this.paginationUtil = templatePaginator;\n+    }\n+\n+    /**\n+     * Return a list of {@link com.dotmarketing.portlets.templates.model.Template}, entity\n+     * response syntax:.\n+     *\n+     *\n+     * Url sintax:\n+     * api/v1/templates?filter=filter-string&page=page-number&per_page=per-page&ordeby=order-field-name&direction=order-direction&host=host-id\n+     *\n+     * where:\n+     *\n+     * <ul>\n+     * <li>filter-string: just return Template who content this pattern into its title</li>\n+     * <li>page: page to return</li>\n+     * <li>per_page: limit of items to return</li>\n+     * <li>ordeby: field to order by</li>\n+     * <li>direction: asc for upward order and desc for downward order</li>\n+     * <li>host: filter by host's id</li>\n+     * </ul>\n+     *\n+     * Url example: v1/templates?filter=test&page=2&orderby=title\n+     *\n+     * @param httpRequest\n+     * @return\n+     */\n+    @GET\n+    @JSONP\n+    @NoCache\n+    @Consumes(MediaType.APPLICATION_JSON)\n+    @Produces({MediaType.APPLICATION_JSON, \"application/javascript\"})", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MDMzMTQwOQ==", "url": "https://github.com/dotCMS/core/pull/19134#discussion_r480331409", "bodyText": "Codacy found an issue: Avoid unused imports such as 'java.util.Collections'", "author": "dev-dotcms", "createdAt": "2020-08-31T19:08:19Z", "path": "dotCMS/src/main/java/com/dotcms/util/pagination/TemplatePaginator.java", "diffHunk": "@@ -0,0 +1,107 @@\n+package com.dotcms.util.pagination;\n+\n+import com.dotcms.repackage.com.google.common.annotations.VisibleForTesting;\n+import com.dotcms.rest.api.v1.template.TemplateHelper;\n+import com.dotmarketing.beans.Host;\n+import com.dotmarketing.beans.Permission;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.PermissionAPI;\n+import com.dotmarketing.business.web.HostWebAPI;\n+import com.dotmarketing.business.web.WebAPILocator;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.exception.DotSecurityException;\n+import com.dotmarketing.portlets.templates.business.TemplateAPI;\n+import com.dotmarketing.portlets.templates.model.Template;\n+import com.dotmarketing.util.Logger;\n+import com.dotmarketing.util.PaginatedArrayList;\n+import com.dotmarketing.util.UtilMethods;\n+import com.liferay.portal.model.User;\n+import com.liferay.util.StringPool;\n+import io.vavr.control.Try;\n+\n+import java.util.Collections;", "originalCommit": "3ab0d7953c8925174569c5bff5d59291efe506f8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}