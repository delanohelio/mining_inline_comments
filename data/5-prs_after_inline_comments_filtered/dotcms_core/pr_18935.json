{"pr_number": 18935, "pr_title": "#18571 Testing", "pr_createdAt": "2020-07-21T17:09:49Z", "pr_url": "https://github.com/dotCMS/core/pull/18935", "timeline": [{"oid": "964d34f68760bef3db75078689d23d3df4c2002c", "url": "https://github.com/dotCMS/core/commit/964d34f68760bef3db75078689d23d3df4c2002c", "message": "#18571 Testing", "committedDate": "2020-07-21T17:02:57Z", "type": "commit"}, {"oid": "b6685a09c43d2e5ae9d971838fd995a6096b2a66", "url": "https://github.com/dotCMS/core/commit/b6685a09c43d2e5ae9d971838fd995a6096b2a66", "message": "Update Reltionship_cache_in_push_publish.postman_collection.json", "committedDate": "2020-07-21T19:59:29Z", "type": "commit"}, {"oid": "9e5cc7d33ff6b7e9777d02040680fab7018d2704", "url": "https://github.com/dotCMS/core/commit/9e5cc7d33ff6b7e9777d02040680fab7018d2704", "message": "Update Reltionship_cache_in_push_publish.postman_collection.json", "committedDate": "2020-07-21T21:36:09Z", "type": "commit"}, {"oid": "8a6ae1a658137b1a98663ae97a2cfd35be2f3122", "url": "https://github.com/dotCMS/core/commit/8a6ae1a658137b1a98663ae97a2cfd35be2f3122", "message": "Update Reltionship_cache_in_push_publish.postman_collection.json", "committedDate": "2020-07-21T22:09:37Z", "type": "commit"}, {"oid": "8550987eb89b5de759274755f6168503be8ad967", "url": "https://github.com/dotCMS/core/commit/8550987eb89b5de759274755f6168503be8ad967", "message": "Update Reltionship_cache_in_push_publish.postman_collection.json", "committedDate": "2020-07-21T22:43:16Z", "type": "commit"}, {"oid": "0c6a88b425b199bd3747fefa19d20d4ccdf976a4", "url": "https://github.com/dotCMS/core/commit/0c6a88b425b199bd3747fefa19d20d4ccdf976a4", "message": "#18780 Testing", "committedDate": "2020-07-24T17:39:52Z", "type": "commit"}, {"oid": "d5fcd2327bae99065061f0a760492a1e900bfcb3", "url": "https://github.com/dotCMS/core/commit/d5fcd2327bae99065061f0a760492a1e900bfcb3", "message": "Merge branch 'issue-18571-Relationships-cache-on-receiver-out-of-sync-after-deleting-a-relation-and-pushing-content' of https://github.com/dotCMS/core into issue-18571-Relationships-cache-on-receiver-out-of-sync-after-deleting-a-relation-and-pushing-content", "committedDate": "2020-07-24T18:23:16Z", "type": "commit"}, {"oid": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "url": "https://github.com/dotCMS/core/commit/ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "message": "#18571 bundle files", "committedDate": "2020-07-27T14:16:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDQ1MA==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930450", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.portlets.structure.model.ContentletRelationships'", "author": "dev-dotcms", "createdAt": "2020-07-27T14:26:59Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDQ2OQ==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930469", "bodyText": "Codacy found an issue: Avoid unused imports such as 'org.junit.Assert'", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:00Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;\n+import static org.junit.Assert.*;", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDQ5OA==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930498", "bodyText": "Codacy found an issue: Avoid instantiating FileInputStream, FileOutputStream, FileReader, or FileWriter", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:02Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+public class BundleResourceTest {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * Method to Test: {@link BundleResource#uploadBundleSync(HttpServletRequest, HttpServletResponse, FormDataMultiPart)}\n+     *                  and {@link com.dotcms.enterprise.publishing.remote.handler.ContentHandler#handle(File, Boolean)}\n+     * When: Send a PushPublish request with two content related, and later sned another Push Publish request removing the\n+     *       relationships between this two content\n+     * Should: Clean the relationship cache\n+     */\n+    @Test\n+    public void shouldCleanRelationshipCache() throws FileNotFoundException, DotPublisherException, DotDataException, DotCacheException {\n+\n+        final File createRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/create_relationship_content.tar.gz\")\n+                .getFile());\n+\n+        final File removeRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/remove_relationship_in_content.tar.gz\")\n+                .getFile());\n+\n+        final FileInputStream createCOntentFileInputStream = new FileInputStream(createRelationshipContentBundle);", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDUxOQ==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930519", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.portlets.rules.model.Condition'", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:03Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDUzMQ==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930531", "bodyText": "Codacy found an issue: A method/constructor should not explicitly throw java.lang.Exception", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:04Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+public class BundleResourceTest {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDU0Ng==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930546", "bodyText": "Codacy found an issue: Ensure that resources like this FileInputStream object are closed after use", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:05Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+public class BundleResourceTest {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * Method to Test: {@link BundleResource#uploadBundleSync(HttpServletRequest, HttpServletResponse, FormDataMultiPart)}\n+     *                  and {@link com.dotcms.enterprise.publishing.remote.handler.ContentHandler#handle(File, Boolean)}\n+     * When: Send a PushPublish request with two content related, and later sned another Push Publish request removing the\n+     *       relationships between this two content\n+     * Should: Clean the relationship cache\n+     */\n+    @Test\n+    public void shouldCleanRelationshipCache() throws FileNotFoundException, DotPublisherException, DotDataException, DotCacheException {\n+\n+        final File createRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/create_relationship_content.tar.gz\")\n+                .getFile());\n+\n+        final File removeRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/remove_relationship_in_content.tar.gz\")\n+                .getFile());\n+\n+        final FileInputStream createCOntentFileInputStream = new FileInputStream(createRelationshipContentBundle);\n+        final FileInputStream removeRelationshipFileInputStream = new FileInputStream(removeRelationshipContentBundle);", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDU1Nw==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930557", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.liferay.portal.model.User'", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:06Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDU3Nw==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930577", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotcms.util.CollectionsUtils.toImmutableList'", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:07Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDU5OA==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930598", "bodyText": "Codacy found an issue: Ensure that resources like this FileInputStream object are closed after use", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:09Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+public class BundleResourceTest {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * Method to Test: {@link BundleResource#uploadBundleSync(HttpServletRequest, HttpServletResponse, FormDataMultiPart)}\n+     *                  and {@link com.dotcms.enterprise.publishing.remote.handler.ContentHandler#handle(File, Boolean)}\n+     * When: Send a PushPublish request with two content related, and later sned another Push Publish request removing the\n+     *       relationships between this two content\n+     * Should: Clean the relationship cache\n+     */\n+    @Test\n+    public void shouldCleanRelationshipCache() throws FileNotFoundException, DotPublisherException, DotDataException, DotCacheException {\n+\n+        final File createRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/create_relationship_content.tar.gz\")\n+                .getFile());\n+\n+        final File removeRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/remove_relationship_in_content.tar.gz\")\n+                .getFile());\n+\n+        final FileInputStream createCOntentFileInputStream = new FileInputStream(createRelationshipContentBundle);", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDYyMQ==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930621", "bodyText": "Codacy found an issue: Avoid instantiating FileInputStream, FileOutputStream, FileReader, or FileWriter", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:10Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;\n+import com.dotmarketing.portlets.structure.model.ContentletRelationships;\n+import com.liferay.portal.model.User;\n+import com.liferay.portal.util.WebKeys;\n+import org.glassfish.jersey.media.multipart.BodyPart;\n+import org.glassfish.jersey.media.multipart.ContentDisposition;\n+import org.glassfish.jersey.media.multipart.FormDataMultiPart;\n+import org.junit.BeforeClass;\n+import org.junit.Test;\n+\n+import javax.servlet.http.HttpServletRequest;\n+import javax.servlet.http.HttpServletResponse;\n+import java.io.File;\n+import java.io.FileInputStream;\n+import java.io.FileNotFoundException;\n+\n+import static com.dotcms.util.CollectionsUtils.list;\n+import static com.dotcms.util.CollectionsUtils.toImmutableList;\n+import static org.junit.Assert.*;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+\n+public class BundleResourceTest {\n+\n+    @BeforeClass\n+    public static void prepare() throws Exception {\n+        //Setting web app environment\n+        IntegrationTestInitService.getInstance().init();\n+    }\n+\n+    /**\n+     * Method to Test: {@link BundleResource#uploadBundleSync(HttpServletRequest, HttpServletResponse, FormDataMultiPart)}\n+     *                  and {@link com.dotcms.enterprise.publishing.remote.handler.ContentHandler#handle(File, Boolean)}\n+     * When: Send a PushPublish request with two content related, and later sned another Push Publish request removing the\n+     *       relationships between this two content\n+     * Should: Clean the relationship cache\n+     */\n+    @Test\n+    public void shouldCleanRelationshipCache() throws FileNotFoundException, DotPublisherException, DotDataException, DotCacheException {\n+\n+        final File createRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/create_relationship_content.tar.gz\")\n+                .getFile());\n+\n+        final File removeRelationshipContentBundle = new File(getClass().getResource(\n+                \"/bundle/relationship_push_publish/remove_relationship_in_content.tar.gz\")\n+                .getFile());\n+\n+        final FileInputStream createCOntentFileInputStream = new FileInputStream(createRelationshipContentBundle);\n+        final FileInputStream removeRelationshipFileInputStream = new FileInputStream(removeRelationshipContentBundle);", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDkzMDYzMw==", "url": "https://github.com/dotCMS/core/pull/18935#discussion_r460930633", "bodyText": "Codacy found an issue: Avoid unused imports such as 'com.dotmarketing.portlets.rules.model.ConditionGroup'", "author": "dev-dotcms", "createdAt": "2020-07-27T14:27:12Z", "path": "dotCMS/src/integration-test/java/com/dotcms/rest/BundleResourceTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+package com.dotcms.rest;\n+\n+import com.dotcms.publisher.business.DotPublisherException;\n+import com.dotcms.util.IntegrationTestInitService;\n+import com.dotmarketing.business.APILocator;\n+import com.dotmarketing.business.CacheLocator;\n+import com.dotmarketing.business.DotCacheException;\n+import com.dotmarketing.exception.DotDataException;\n+import com.dotmarketing.portlets.contentlet.model.Contentlet;\n+import com.dotmarketing.portlets.rules.model.Condition;\n+import com.dotmarketing.portlets.rules.model.ConditionGroup;", "originalCommit": "ce91b935ebc983efd0b85ca7e2fdb6670c36e290", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}