{"pr_number": 18478, "pr_title": "Apps feature branch", "pr_createdAt": "2020-05-12T17:34:00Z", "pr_url": "https://github.com/dotCMS/core/pull/18478", "timeline": [{"oid": "79fe5b97372e1998771d75a8b9960fd4056cc8a4", "url": "https://github.com/dotCMS/core/commit/79fe5b97372e1998771d75a8b9960fd4056cc8a4", "message": "issue-18249-Refactor-Dot-Field-Variables core#18249 (#18290)\n\n* core#18249\r\n\r\n* Added missing languages\r\n\r\n* add hidden title label\r\n\r\n* custom label added", "committedDate": "2020-04-23T16:17:58Z", "type": "commit"}, {"oid": "98e9bdb8269c3f230ec0cb75f24991b096d5057b", "url": "https://github.com/dotCMS/core/commit/98e9bdb8269c3f230ec0cb75f24991b096d5057b", "message": "Merge branch 'master' of https://github.com/dotCMS/core into apps-feature-branch", "committedDate": "2020-04-27T15:15:35Z", "type": "commit"}, {"oid": "44fda47a71168a2a60fdf3ead1a2fa6557a63344", "url": "https://github.com/dotCMS/core/commit/44fda47a71168a2a60fdf3ead1a2fa6557a63344", "message": "Issue 18218 warnings (#18360)\n\n* #18218 apps secret  warning checks\r\n\r\n* #18218 lang keys\r\n\r\n* #18218  warnings fix broken test", "committedDate": "2020-04-27T18:24:21Z", "type": "commit"}, {"oid": "1e511817f36777295385ded5df9eb3134fa47257", "url": "https://github.com/dotCMS/core/commit/1e511817f36777295385ded5df9eb3134fa47257", "message": "  #18373 apps resilience when a site is deleted (#18365)\n\n* apps resilience when a site is deleted\r\n\r\n* # apps delete secrets for site\r\n\r\n* apps site delete resilience\r\n\r\n* # apps site delete resilience", "committedDate": "2020-04-27T22:44:49Z", "type": "commit"}, {"oid": "97acae1b22c048f3575b9fe21119244bb1f67996", "url": "https://github.com/dotCMS/core/commit/97acae1b22c048f3575b9fe21119244bb1f67996", "message": "Merge branch 'master' of https://github.com/dotCMS/core into apps-feature-branch", "committedDate": "2020-04-28T15:51:11Z", "type": "commit"}, {"oid": "cd31431c73ef647b622fe149d7784041d1b2ddd6", "url": "https://github.com/dotCMS/core/commit/cd31431c73ef647b622fe149d7784041d1b2ddd6", "message": "Merge branch 'apps-feature-branch' of https://github.com/dotCMS/core into apps-feature-branch", "committedDate": "2020-04-28T15:51:39Z", "type": "commit"}, {"oid": "2f812d12b4c56f6490539582f8f8e30f5fe83fbd", "url": "https://github.com/dotCMS/core/commit/2f812d12b4c56f6490539582f8f8e30f5fe83fbd", "message": "#18218 fixes for apps  warnings (#18386)", "committedDate": "2020-04-28T23:32:40Z", "type": "commit"}, {"oid": "643b70f3e106d6984376d262f9154d76b6f80eb1", "url": "https://github.com/dotCMS/core/commit/643b70f3e106d6984376d262f9154d76b6f80eb1", "message": "Merge branch 'master' of https://github.com/dotCMS/core into apps-feature-branch", "committedDate": "2020-04-30T18:40:10Z", "type": "commit"}, {"oid": "25b00ebb8a15c9d59019cb729093acd0ac0c41e0", "url": "https://github.com/dotCMS/core/commit/25b00ebb8a15c9d59019cb729093acd0ac0c41e0", "message": " fixes for  #18416 #18414 #18413 (#18418)", "committedDate": "2020-05-01T16:06:44Z", "type": "commit"}, {"oid": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "url": "https://github.com/dotCMS/core/commit/2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "message": "fix core#18415 (#18432)", "committedDate": "2020-05-05T15:51:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTY4Mw==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915683", "bodyText": "Issue found: Assigning an Object to null is a code smell.  Consider refactoring.", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:41Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/apps/view/AppView.java", "diffHunk": "@@ -48,14 +52,15 @@ public AppView(final AppDescriptor appDescriptor, final long configurationsCount\n      * @param configurationsCount\n      * @param sites\n      */\n-    public AppView(final AppDescriptor appDescriptor, final long configurationsCount, final List<SiteView> sites) {\n+    public AppView(final AppDescriptor appDescriptor, final int configurationsCount, final List<SiteView> sites) {\n         this.key = appDescriptor.getKey();\n         this.name = appDescriptor.getName();\n         this.description = appDescriptor.getDescription();\n         this.iconUrl = appDescriptor.getIconUrl();\n         this.allowExtraParams = appDescriptor.isAllowExtraParameters();\n         this.configurationsCount = configurationsCount;\n         this.sites = sites;\n+        this.sitesWithWarnings = null;", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTY5Mw==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915693", "bodyText": "Issue found: The String literal \"any-name\" appears 18 times in this file; the first occurrence is on line 461", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:43Z", "path": "dotCMS/src/integration-test/java/com/dotcms/security/apps/AppsAPIImplTest.java", "diffHunk": "@@ -434,6 +439,104 @@ public void Test_Secret_Destroy_Method() {\n         }\n     }\n \n+    /**\n+     * Test computeSecretWarnings.\n+     * Given scenario: You create a secret with no value the secret is expected to be required according to the descriptor.\n+     * Expected Result: Such situation should generate a warning\n+     */\n+    @Test\n+    public void Test_Secret_Integrity_Check_Expect_Warning()\n+            throws DotDataException, DotSecurityException {\n+        final AppsAPI api = APILocator.getAppsAPI();\n+\n+        final String appKey = \"any-key\";\n+\n+        final AppDescriptor descriptor = mock(AppDescriptor.class);\n+        when(descriptor.isAllowExtraParameters()).thenReturn(false);\n+        final Map<String, ParamDescriptor> params = of(\n+        \"requiredNoDefault\",newParam(null, false, Type.STRING, \"any\", \"hint\", true), // This is the rule we intend to break\n+        \"requiredDefault\", newParam(\"default\", false, Type.STRING, \"any\", \"hint\", true),\n+        \"nonRequiredNoDefault\", newParam(null, false, Type.STRING, \"any\", \"hint\", false)\n+         );\n+        when(descriptor.getParams()).thenReturn(params);\n+        when(descriptor.getName()).thenReturn(\"any-name\");", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTY5OQ==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915699", "bodyText": "Issue found: Avoid variables with short names like id", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:44Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/apps/view/SiteView.java", "diffHunk": "@@ -23,11 +26,12 @@\n      * @param name\n      * @param configured\n      */\n-    public SiteView(final String id, final String name, final boolean configured) {\n+    public SiteView(final String id, final String name, final boolean configured, final int secretsWithWarning) {", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTcwOA==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915708", "bodyText": "Issue found: Useless parentheses.", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:45Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/apps/view/SiteView.java", "diffHunk": "@@ -23,11 +26,12 @@\n      * @param name\n      * @param configured\n      */\n-    public SiteView(final String id, final String name, final boolean configured) {\n+    public SiteView(final String id, final String name, final boolean configured, final int secretsWithWarning) {\n         this.id = id;\n         this.name = name;\n         this.configured = configured;\n         this.secrets = null;\n+        this.secretsWithWarnings = (secretsWithWarning == 0 ? null : secretsWithWarning);", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTcyMA==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915720", "bodyText": "Issue found: The String literal \"requiredDefault\" appears 4 times in this file; the first occurrence is on line 457", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:45Z", "path": "dotCMS/src/integration-test/java/com/dotcms/security/apps/AppsAPIImplTest.java", "diffHunk": "@@ -434,6 +439,104 @@ public void Test_Secret_Destroy_Method() {\n         }\n     }\n \n+    /**\n+     * Test computeSecretWarnings.\n+     * Given scenario: You create a secret with no value the secret is expected to be required according to the descriptor.\n+     * Expected Result: Such situation should generate a warning\n+     */\n+    @Test\n+    public void Test_Secret_Integrity_Check_Expect_Warning()\n+            throws DotDataException, DotSecurityException {\n+        final AppsAPI api = APILocator.getAppsAPI();\n+\n+        final String appKey = \"any-key\";\n+\n+        final AppDescriptor descriptor = mock(AppDescriptor.class);\n+        when(descriptor.isAllowExtraParameters()).thenReturn(false);\n+        final Map<String, ParamDescriptor> params = of(\n+        \"requiredNoDefault\",newParam(null, false, Type.STRING, \"any\", \"hint\", true), // This is the rule we intend to break\n+        \"requiredDefault\", newParam(\"default\", false, Type.STRING, \"any\", \"hint\", true),", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTczNw==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915737", "bodyText": "Issue found: The String literal \"requiredNoDefault\" appears 4 times in this file; the first occurrence is on line 456", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:47Z", "path": "dotCMS/src/integration-test/java/com/dotcms/security/apps/AppsAPIImplTest.java", "diffHunk": "@@ -434,6 +439,104 @@ public void Test_Secret_Destroy_Method() {\n         }\n     }\n \n+    /**\n+     * Test computeSecretWarnings.\n+     * Given scenario: You create a secret with no value the secret is expected to be required according to the descriptor.\n+     * Expected Result: Such situation should generate a warning\n+     */\n+    @Test\n+    public void Test_Secret_Integrity_Check_Expect_Warning()\n+            throws DotDataException, DotSecurityException {\n+        final AppsAPI api = APILocator.getAppsAPI();\n+\n+        final String appKey = \"any-key\";\n+\n+        final AppDescriptor descriptor = mock(AppDescriptor.class);\n+        when(descriptor.isAllowExtraParameters()).thenReturn(false);\n+        final Map<String, ParamDescriptor> params = of(\n+        \"requiredNoDefault\",newParam(null, false, Type.STRING, \"any\", \"hint\", true), // This is the rule we intend to break", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTc0Ng==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915746", "bodyText": "Issue found: Assigning an Object to null is a code smell.  Consider refactoring.", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:48Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/apps/view/SiteView.java", "diffHunk": "@@ -42,6 +46,7 @@ public SiteView(final String id,final String name,\n         this.name = name;\n         this.configured = secrets.stream().anyMatch(secretView -> null != secretView.getSecret());\n         this.secrets = secrets;\n+        this.secretsWithWarnings = null;", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzkxNTc1OA==", "url": "https://github.com/dotCMS/core/pull/18478#discussion_r423915758", "bodyText": "Issue found: The String literal \"any-key\" appears 15 times in this file; the first occurrence is on line 451", "author": "dev-dotcms", "createdAt": "2020-05-12T17:39:49Z", "path": "dotCMS/src/integration-test/java/com/dotcms/security/apps/AppsAPIImplTest.java", "diffHunk": "@@ -434,6 +439,104 @@ public void Test_Secret_Destroy_Method() {\n         }\n     }\n \n+    /**\n+     * Test computeSecretWarnings.\n+     * Given scenario: You create a secret with no value the secret is expected to be required according to the descriptor.\n+     * Expected Result: Such situation should generate a warning\n+     */\n+    @Test\n+    public void Test_Secret_Integrity_Check_Expect_Warning()\n+            throws DotDataException, DotSecurityException {\n+        final AppsAPI api = APILocator.getAppsAPI();\n+\n+        final String appKey = \"any-key\";", "originalCommit": "2322a4c4b2c099d3c5eeb3a6c34e670edd6f242e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}