{"pr_number": 19122, "pr_title": "Issue 18780 container error using templates from different sites", "pr_createdAt": "2020-08-18T18:38:30Z", "pr_url": "https://github.com/dotCMS/core/pull/19122", "timeline": [{"oid": "ebb79ae709da51c6672c816b203d08c05659ad6b", "url": "https://github.com/dotCMS/core/commit/ebb79ae709da51c6672c816b203d08c05659ad6b", "message": "#18780 Using absolute path to file container allways", "committedDate": "2020-08-10T14:05:38Z", "type": "commit"}, {"oid": "d6af1505810adcc7dc9552b29c1b07d452595eb7", "url": "https://github.com/dotCMS/core/commit/d6af1505810adcc7dc9552b29c1b07d452595eb7", "message": "Merge remote-tracking branch 'origin/master' into issue_18780_Container_error_using_templates_from_different_sites", "committedDate": "2020-08-10T14:37:20Z", "type": "commit"}, {"oid": "754b5ee095ddb38a0ee61855446b0f1f62085ed3", "url": "https://github.com/dotCMS/core/commit/754b5ee095ddb38a0ee61855446b0f1f62085ed3", "message": "#18780 refactoring", "committedDate": "2020-08-12T17:05:15Z", "type": "commit"}, {"oid": "a7c2569b07d9eb696dedfa3cb67275a929b49182", "url": "https://github.com/dotCMS/core/commit/a7c2569b07d9eb696dedfa3cb67275a929b49182", "message": "resolving relative path", "committedDate": "2020-08-18T18:35:55Z", "type": "commit"}, {"oid": "5179ccf302016d69716c05c1bf114b60227337ba", "url": "https://github.com/dotCMS/core/commit/5179ccf302016d69716c05c1bf114b60227337ba", "message": "merge", "committedDate": "2020-08-18T18:41:01Z", "type": "commit"}, {"oid": "aea6e4413ca63922edc9854e396ea39fa453b87e", "url": "https://github.com/dotCMS/core/commit/aea6e4413ca63922edc9854e396ea39fa453b87e", "message": "#18780 Refactoring and fixes", "committedDate": "2020-08-24T19:32:39Z", "type": "commit"}, {"oid": "2668c671ae267e820314e53ae2bc436d142ee87e", "url": "https://github.com/dotCMS/core/commit/2668c671ae267e820314e53ae2bc436d142ee87e", "message": "#18780 testing/refactoring", "committedDate": "2020-08-25T15:12:57Z", "type": "commit"}, {"oid": "e02441e9d9d5ac0695449c7b4fa5bcfccd2c6781", "url": "https://github.com/dotCMS/core/commit/e02441e9d9d5ac0695449c7b4fa5bcfccd2c6781", "message": "#18780 refactoring", "committedDate": "2020-08-25T17:11:36Z", "type": "commit"}, {"oid": "403fcb4a98fb6e95603868e5f1e135e13b540c3d", "url": "https://github.com/dotCMS/core/commit/403fcb4a98fb6e95603868e5f1e135e13b540c3d", "message": "#18780 FIxing Test", "committedDate": "2020-08-25T18:24:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY1ODU4Nw==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476658587", "bodyText": "remove", "author": "dsilvam", "createdAt": "2020-08-25T18:38:24Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/ajax/ContainerAjaxDrawedTemplate.java", "diffHunk": "@@ -89,7 +90,10 @@\n                 contMap.put(\"source\", container.getSource().toString());\n                 if (container instanceof FileAssetContainer) {\n \n-                    contMap.put(\"path\", FileAssetContainer.class.cast(container).getPath());\n+                    contMap.put(\"path\",\n+                            FileAssetContainerUtil.getInstance()\n+                                    .getFullPath(FileAssetContainer.class.cast(container))\n+                    );\n                 }\n \n //                StringBuffer containerCode = new StringBuffer( cont.getCode() );", "originalCommit": "2668c671ae267e820314e53ae2bc436d142ee87e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NDU1Mg==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476694552", "bodyText": "done dotCMS/src/main/java/com/dotmarketing/util/TaskLocatorUtil.java", "author": "freddyucv", "createdAt": "2020-08-25T19:43:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY1ODU4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY1OTUwNA==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476659504", "bodyText": "javadoc", "author": "dsilvam", "createdAt": "2020-08-25T18:40:01Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/containers/business/ContainerFactory.java", "diffHunk": "@@ -67,6 +67,9 @@\n \t */\r\n \tList<Container> findContainers(User user, boolean includeArchived, Map<String,Object> params, String hostId, String inode, String identifier, String parent, int offset, int limit, String orderBy) throws DotSecurityException, DotDataException;\r\n \r\n+\tContainer getContainerByFolderPath(String path, Host host, User user, boolean live,\r", "originalCommit": "2668c671ae267e820314e53ae2bc436d142ee87e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NDY2OQ==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476694669", "bodyText": "done fbaded8#diff-bb0b37e225ac8347fc10ee3c512dea1bR70", "author": "freddyucv", "createdAt": "2020-08-25T19:44:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY1OTUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MDYzNg==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476660636", "bodyText": "remove", "author": "dsilvam", "createdAt": "2020-08-25T18:42:00Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/design/bean/TemplateLayout.java", "diffHunk": "@@ -182,11 +186,70 @@ public String toString() {\n         }\n     }\n \n-    public boolean existsContainer(final String identifier, final String uuid){\n-        return this.getContainers().stream()\n-                .anyMatch(containerUUID ->\n-                        containerUUID.getIdentifier().equals(identifier) && isTheSameUUID(containerUUID.getUUID(), uuid)\n-                );\n+    public boolean existsContainer(final Container container, final String uuid){\n+        final FileAssetContainerUtil instance = FileAssetContainerUtil.getInstance();\n+        if (instance.isFileAssetContainer(container)) {\n+            final FileAssetContainer fileAssetContainer = (FileAssetContainer) container;\n+            final String containerPath = fileAssetContainer.getPath();\n+\n+            return this.getContainers().stream()\n+                    .anyMatch((ContainerUUID containerUUID) -> {\n+                        final String relativePath = instance.isFullPath(containerUUID.getIdentifier()) ?\n+                                instance.getRelativePath(containerUUID.getIdentifier()) :\n+                                containerUUID.getIdentifier();\n+\n+                        return relativePath.equals(containerPath)\n+                                    && isTheSameUUID(containerUUID.getUUID(), uuid);\n+                    }\n+                    );\n+        } else {\n+            return this.getContainers().stream()\n+                    .anyMatch(containerUUID ->\n+                            containerUUID.getIdentifier().equals(container.getIdentifier())\n+                                    && isTheSameUUID(containerUUID.getUUID(), uuid)\n+                    );\n+        }\n+\n+\n+    }\n+\n+    @JsonIgnore\n+    @NotNull", "originalCommit": "2668c671ae267e820314e53ae2bc436d142ee87e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NTQ2Ng==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476695466", "bodyText": "done e02441e#diff-bf2367c305d13964ae1bcb10f2c61543L217", "author": "freddyucv", "createdAt": "2020-08-25T19:45:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MDYzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MDg2MA==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476660860", "bodyText": "javadoc", "author": "dsilvam", "createdAt": "2020-08-25T18:42:23Z", "path": "dotCMS/src/main/java/com/dotmarketing/portlets/templates/design/bean/TemplateLayout.java", "diffHunk": "@@ -182,11 +186,70 @@ public String toString() {\n         }\n     }\n \n-    public boolean existsContainer(final String identifier, final String uuid){\n-        return this.getContainers().stream()\n-                .anyMatch(containerUUID ->\n-                        containerUUID.getIdentifier().equals(identifier) && isTheSameUUID(containerUUID.getUUID(), uuid)\n-                );\n+    public boolean existsContainer(final Container container, final String uuid){", "originalCommit": "2668c671ae267e820314e53ae2bc436d142ee87e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NDgzNA==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476694834", "bodyText": "done fbaded8#diff-bf2367c305d13964ae1bcb10f2c61543R188", "author": "freddyucv", "createdAt": "2020-08-25T19:44:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MDg2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MTg3OA==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476661878", "bodyText": "put at the end and naming according to the last task", "author": "dsilvam", "createdAt": "2020-08-25T18:44:09Z", "path": "dotCMS/src/main/java/com/dotmarketing/util/TaskLocatorUtil.java", "diffHunk": "@@ -282,6 +282,7 @@ public static void removeFixTask(Class<?> clazz){\n         .add(Task05300UpdateIndexNameLength.class)\n         .add(Task05305AddPushPublishFilterColumn.class)\n \t\t.add(Task05350AddDotSaltClusterColumn.class)\n+\t\t.add(Task05370ChangeContainerPathToAbsolute.class)", "originalCommit": "2668c671ae267e820314e53ae2bc436d142ee87e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY5NDk0Mg==", "url": "https://github.com/dotCMS/core/pull/19122#discussion_r476694942", "bodyText": "done fbaded8#diff-a5f6335b9d67b8de8cbdc378cbe131a4R286", "author": "freddyucv", "createdAt": "2020-08-25T19:44:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NjY2MTg3OA=="}], "type": "inlineReview"}, {"oid": "fbaded83a3eb9b46bb0c29d64e15db5ac60a772c", "url": "https://github.com/dotCMS/core/commit/fbaded83a3eb9b46bb0c29d64e15db5ac60a772c", "message": "#18780 Refactoring", "committedDate": "2020-08-25T19:40:58Z", "type": "commit"}, {"oid": "6e9a0e7c827706205192d4960436840b5af586fd", "url": "https://github.com/dotCMS/core/commit/6e9a0e7c827706205192d4960436840b5af586fd", "message": "#18780 rename task upgrade", "committedDate": "2020-08-26T14:17:25Z", "type": "commit"}, {"oid": "8f16c9f56af578ae620c26a701dea5a0f0fbfdcc", "url": "https://github.com/dotCMS/core/commit/8f16c9f56af578ae620c26a701dea5a0f0fbfdcc", "message": "#18780 rename task upgrade", "committedDate": "2020-08-26T14:20:06Z", "type": "commit"}, {"oid": "2b865714ab51031294f678b74007052c2418dfaf", "url": "https://github.com/dotCMS/core/commit/2b865714ab51031294f678b74007052c2418dfaf", "message": "#18780 renaming task upgrade", "committedDate": "2020-08-26T14:43:09Z", "type": "commit"}, {"oid": "faf203571d2ed10768b4bc5a6d0488a66e9993bf", "url": "https://github.com/dotCMS/core/commit/faf203571d2ed10768b4bc5a6d0488a66e9993bf", "message": "#18780 Fixing test", "committedDate": "2020-08-26T14:48:33Z", "type": "commit"}, {"oid": "94fff499b5b227e66ca3a2e33fd78dcaf0019e2a", "url": "https://github.com/dotCMS/core/commit/94fff499b5b227e66ca3a2e33fd78dcaf0019e2a", "message": "#18780 renaming Task Upgrade again", "committedDate": "2020-08-26T14:55:20Z", "type": "commit"}, {"oid": "52d9f843ecff46cef00d4c52c33c583d32e0b14b", "url": "https://github.com/dotCMS/core/commit/52d9f843ecff46cef00d4c52c33c583d32e0b14b", "message": "#18780 Adding test in MainSuite", "committedDate": "2020-08-26T15:19:27Z", "type": "commit"}, {"oid": "b364b0775cf99da8be174cfc2849799aa5f5b6f1", "url": "https://github.com/dotCMS/core/commit/b364b0775cf99da8be174cfc2849799aa5f5b6f1", "message": "merge", "committedDate": "2020-08-26T16:05:13Z", "type": "commit"}, {"oid": "e571b6cd44fb64c1be400a82e1ac43884639011b", "url": "https://github.com/dotCMS/core/commit/e571b6cd44fb64c1be400a82e1ac43884639011b", "message": "renaming task upgrade", "committedDate": "2020-08-26T16:48:23Z", "type": "commit"}, {"oid": "ea68647f672bbc8014ff97dba6399d363aaebb50", "url": "https://github.com/dotCMS/core/commit/ea68647f672bbc8014ff97dba6399d363aaebb50", "message": "renaming task upgrade", "committedDate": "2020-08-26T17:26:19Z", "type": "commit"}, {"oid": "7f114ef96b84147d16d1a83baf842fb71b9c45bb", "url": "https://github.com/dotCMS/core/commit/7f114ef96b84147d16d1a83baf842fb71b9c45bb", "message": "Updating MainSuite", "committedDate": "2020-08-26T21:10:46Z", "type": "commit"}, {"oid": "c9770169ad105c36c244d7c78713be2caadcdb5a", "url": "https://github.com/dotCMS/core/commit/c9770169ad105c36c244d7c78713be2caadcdb5a", "message": "Merge branch 'master' into issue_18780_Container_error_using_templates_from_different_sites", "committedDate": "2020-08-31T22:14:09Z", "type": "commit"}, {"oid": "bc7be833a9c6ccbd54fd3ba2c3f93140688790f7", "url": "https://github.com/dotCMS/core/commit/bc7be833a9c6ccbd54fd3ba2c3f93140688790f7", "message": "#18780 merge", "committedDate": "2020-09-01T07:21:22Z", "type": "commit"}, {"oid": "43981b122d0279dd084ec676f345c371b92429ca", "url": "https://github.com/dotCMS/core/commit/43981b122d0279dd084ec676f345c371b92429ca", "message": "testing", "committedDate": "2020-09-01T11:12:55Z", "type": "commit"}, {"oid": "f7fb101f56ade892575faa55b734c8615db76a43", "url": "https://github.com/dotCMS/core/commit/f7fb101f56ade892575faa55b734c8615db76a43", "message": "testing", "committedDate": "2020-09-01T11:14:02Z", "type": "commit"}, {"oid": "4b02adcf2251218aad1236419dd33ec1de2e3c9a", "url": "https://github.com/dotCMS/core/commit/4b02adcf2251218aad1236419dd33ec1de2e3c9a", "message": "#18780 merge", "committedDate": "2020-09-01T11:16:58Z", "type": "commit"}]}