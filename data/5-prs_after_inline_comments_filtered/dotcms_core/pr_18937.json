{"pr_number": 18937, "pr_title": "Issue 18553", "pr_createdAt": "2020-07-21T18:08:32Z", "pr_url": "https://github.com/dotCMS/core/pull/18937", "timeline": [{"oid": "032e34cf57a5259567e2eb3289da5f660be4c628", "url": "https://github.com/dotCMS/core/commit/032e34cf57a5259567e2eb3289da5f660be4c628", "message": "#18553 comments", "committedDate": "2020-07-14T18:00:42Z", "type": "commit"}, {"oid": "6bc62ea156cf4d023650b07c9d24cc9f661acc28", "url": "https://github.com/dotCMS/core/commit/6bc62ea156cf4d023650b07c9d24cc9f661acc28", "message": "#18553 add new severity SUCCESS", "committedDate": "2020-07-14T18:01:18Z", "type": "commit"}, {"oid": "aa9604c343e0c1a0422db93635effd8b37a94989", "url": "https://github.com/dotCMS/core/commit/aa9604c343e0c1a0422db93635effd8b37a94989", "message": "#18553 growl notifications to PP", "committedDate": "2020-07-14T18:02:06Z", "type": "commit"}, {"oid": "c99ef45346e9c307cac6a165cdd8a20331c4e051", "url": "https://github.com/dotCMS/core/commit/c99ef45346e9c307cac6a165cdd8a20331c4e051", "message": "#18553 change life success to 5 sec", "committedDate": "2020-07-15T21:08:25Z", "type": "commit"}, {"oid": "f53766a23a40335518b29f8dfe61bb368160543b", "url": "https://github.com/dotCMS/core/commit/f53766a23a40335518b29f8dfe61bb368160543b", "message": "#18553 link when failure", "committedDate": "2020-07-15T21:09:17Z", "type": "commit"}, {"oid": "6ddfd4f5189cc563368e3e174b9ec7610a2f2bbe", "url": "https://github.com/dotCMS/core/commit/6ddfd4f5189cc563368e3e174b9ec7610a2f2bbe", "message": "#18553 remove log", "committedDate": "2020-07-17T16:11:22Z", "type": "commit"}, {"oid": "166df6f57a44bba210126c30304c33d4b9e7a134", "url": "https://github.com/dotCMS/core/commit/166df6f57a44bba210126c30304c33d4b9e7a134", "message": "Merge branch 'master' of github.com:dotCMS/core into issue-18553", "committedDate": "2020-07-21T17:01:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NTI4Mg==", "url": "https://github.com/dotCMS/core/pull/18937#discussion_r458295282", "bodyText": "I would extract to a private method sendNotification", "author": "dsilvam", "createdAt": "2020-07-21T18:14:02Z", "path": "dotCMS/src/main/java/com/dotcms/publisher/business/PublisherQueueJob.java", "diffHunk": "@@ -355,6 +381,46 @@ private void updateBundleStatus(final PublishAuditStatus bundleAudit,\n \t\t\t}\n \t\t}\n \t\tLogger.info(this, \"===========================================================\");\n+\n+\t\t//Growl Notifications\n+\t\tif(UtilMethods.isSet(notificationMessage)){", "originalCommit": "166df6f57a44bba210126c30304c33d4b9e7a134", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzAwOQ==", "url": "https://github.com/dotCMS/core/pull/18937#discussion_r458297009", "bodyText": "All these arguments could become an object called NotificationParams and use a builder pattern.\nE.g.\nnew NotificationParamsBuilder().withMessage(\"\").withMessageArgument(\"\").withNotificationLife(\"\").withSeverity(SUCCESS)\nand then call the .build() when passing it to the private method sendNotification(builder.build())", "author": "dsilvam", "createdAt": "2020-07-21T18:17:04Z", "path": "dotCMS/src/main/java/com/dotcms/publisher/business/PublisherQueueJob.java", "diffHunk": "@@ -292,10 +303,19 @@ private void updateAuditStatus(final List<Map<String, Object>> bundlesInQueue) t\n \t@NotNull\n \tprivate void updateBundleStatus(final PublishAuditStatus bundleAudit,\n \t\t\t\t\t\t\t\t\tfinal Map<String, Map<String, EndpointDetail>> endpointTrackingMap,\n-\t\t\t\t\t\t\t\t\tfinal GroupPushStats groupPushStats, final List<Map<String, Object>> bundlesInQueue) throws DotDataException, DotPublisherException {\n+\t\t\t\t\t\t\t\t\tfinal GroupPushStats groupPushStats, final List<Map<String, Object>> bundlesInQueue)\n+\t\t\tthrows DotDataException, DotPublisherException, DotSecurityException, LanguageException {\n \t\tStatus bundleStatus;\n \t\tfinal PublishAuditHistory localHistory = bundleAudit.getStatusPojo();\n \t\tfinal String auditedBundleId = bundleAudit.getBundleId();\n+\t\t//Info need to generate Growl Notification\n+\t\tfinal Bundle bundle = APILocator.getBundleAPI().getBundleById(auditedBundleId);\n+\t\tfinal boolean isBundleNameGenerated = bundle.getName().startsWith(\"bundle-\");\n+\t\tString notificationMessage = \"\";\n+\t\tString notificationMessageArgument = \"\";\n+\t\tlong notificationLife = 5000;\n+\t\tMessageSeverity notificationSeverity = MessageSeverity.SUCCESS;\n+", "originalCommit": "166df6f57a44bba210126c30304c33d4b9e7a134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk4MzE4Mw==", "url": "https://github.com/dotCMS/core/pull/18937#discussion_r458983183", "bodyText": "using builder", "author": "erickgonzalez", "createdAt": "2020-07-22T18:03:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5NzAwOQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5ODE5NQ==", "url": "https://github.com/dotCMS/core/pull/18937#discussion_r458298195", "bodyText": "not sure if this should be configurable in order to get more detail if wanted", "author": "jdotcms", "createdAt": "2020-07-21T18:18:51Z", "path": "dotCMS/src/main/java/com/dotcms/publisher/business/PublisherQueueJob.java", "diffHunk": "@@ -355,6 +381,46 @@ private void updateBundleStatus(final PublishAuditStatus bundleAudit,\n \t\t\t}\n \t\t}\n \t\tLogger.info(this, \"===========================================================\");\n+\n+\t\t//Growl Notifications\n+\t\tif(UtilMethods.isSet(notificationMessage)){\n+\t\t\tfinal SystemMessageBuilder message = new SystemMessageBuilder()\n+\t\t\t\t\t.setMessage(LanguageUtil.format(\n+\t\t\t\t\t\t\tAPILocator.getUserAPI().loadUserById(bundle.getOwner()).getLocale(),\n+\t\t\t\t\t\t\tnotificationMessage,\n+\t\t\t\t\t\t\tnotificationMessageArgument))\n+\t\t\t\t\t.setSeverity(notificationSeverity)\n+\t\t\t\t\t.setType(MessageType.SIMPLE_MESSAGE)\n+\t\t\t\t\t.setLife(notificationLife);\n+\n+\t\t\tSystemMessageEventUtil.getInstance().pushMessage(message.create(), ImmutableList.of(bundle.getOwner()));\n+\t\t}\n+\t}\n+\n+\t/**\n+\t * Utility method to generate the bundle title for the notification, checks the amount of assets and\n+\t * only shows the assetType and assetTitle of the first three items, if there are more the amount of\n+\t * remain assets is shown.\n+\t *\n+\t * @param bundleAssets assets that were added manually to the bundle\n+\t * @return a string that will be the argument for the notification\n+\t */\n+\tprivate String generateBundleTitle(final Map<String,String> bundleAssets)\n+\t\t\tthrows LanguageException {\n+\t\tint count = 0;\n+\t\tString bundleTitle = \"\";\n+\t\tfor(final String id : bundleAssets.keySet()){\n+\t\t\tif(count < 3) {", "originalCommit": "166df6f57a44bba210126c30304c33d4b9e7a134", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODk4MzU5Nw==", "url": "https://github.com/dotCMS/core/pull/18937#discussion_r458983597", "bodyText": "This is to keep consistency with the Status/History Tab", "author": "erickgonzalez", "createdAt": "2020-07-22T18:04:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODI5ODE5NQ=="}], "type": "inlineReview"}, {"oid": "199c541e6a9a2ddbbfaaa046e1d36e1ef9ae1ab7", "url": "https://github.com/dotCMS/core/commit/199c541e6a9a2ddbbfaaa046e1d36e1ef9ae1ab7", "message": "#18553 refactor PP Notifications", "committedDate": "2020-07-22T18:03:03Z", "type": "commit"}]}