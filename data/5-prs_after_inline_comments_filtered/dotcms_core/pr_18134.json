{"pr_number": 18134, "pr_title": "#17848 Fixing error handling when an index is not found", "pr_createdAt": "2020-03-12T22:35:34Z", "pr_url": "https://github.com/dotCMS/core/pull/18134", "timeline": [{"oid": "b28da220cacb831e557587017548be93302a7a8a", "url": "https://github.com/dotCMS/core/commit/b28da220cacb831e557587017548be93302a7a8a", "message": "#17848 Fixing error handling when an index is not found", "committedDate": "2020-03-12T22:33:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk0MzQxOA==", "url": "https://github.com/dotCMS/core/pull/18134#discussion_r391943418", "bodyText": "I think we should remove this catch also and let the Mappers catch these Exceptions", "author": "freddyucv", "createdAt": "2020-03-12T22:41:06Z", "path": "dotCMS/src/main/java/com/dotcms/rest/api/v1/index/ESIndexResource.java", "diffHunk": "@@ -484,15 +484,18 @@ public Response getActive(@Context HttpServletRequest httpServletRequest, @Conte\n     @Path(\"/docscount/{params:.*}\")\n     @Produces(\"text/plain\")\n     public Response getDocumentCount(@Context HttpServletRequest httpServletRequest, @Context final HttpServletResponse httpServletResponse, @PathParam(\"params\") String params) {\n+\n+        InitDataObject init= null;\n         try {\n-            InitDataObject init=auth(params,httpServletRequest, httpServletResponse);\n+            init = auth(params,httpServletRequest, httpServletResponse);\n \n             //Creating an utility response object\n             ResourceResponse responseResource = new ResourceResponse( init.getParamsMap() );\n \n             String indexName = this.indexHelper.getIndexNameOrAlias(init.getParamsMap(),\"index\",\"alias\",this.indexAPI);\n             return responseResource.response( Long.toString( indexDocumentCount( indexName ) ) );\n-        } catch (Exception e) {\n+\n+        } catch (DotSecurityException | DotDataException e) {", "originalCommit": "b28da220cacb831e557587017548be93302a7a8a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjI3NDM4OQ==", "url": "https://github.com/dotCMS/core/pull/18134#discussion_r392274389", "bodyText": "The problem with doing this is that it would change the method signature. That's why I left those 2 exceptions", "author": "nollymar", "createdAt": "2020-03-13T14:48:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTk0MzQxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjM2ODc1Mg==", "url": "https://github.com/dotCMS/core/pull/18134#discussion_r392368752", "bodyText": "I think the fall back should be INTERNAL_SERVER_ERROR", "author": "dsilvam", "createdAt": "2020-03-13T17:25:07Z", "path": "dotCMS/src/main/java/com/dotcms/rest/exception/mapper/ElasticsearchStatusExceptionMapper.java", "diffHunk": "@@ -0,0 +1,29 @@\n+package com.dotcms.rest.exception.mapper;\n+\n+import com.dotmarketing.util.Logger;\n+import javax.ws.rs.core.Response;\n+import javax.ws.rs.core.Response.Status;\n+import org.elasticsearch.ElasticsearchStatusException;\n+import javax.ws.rs.ext.ExceptionMapper;\n+\n+public class ElasticsearchStatusExceptionMapper implements ExceptionMapper<ElasticsearchStatusException> {\n+\n+\n+    @Override\n+    public Response toResponse(ElasticsearchStatusException exception) {\n+\n+        //Log into our logs first.\n+        Logger.warn(this.getClass(), exception.getMessage(), exception);\n+\n+        //Create the message.\n+        String message = exception.getMessage();\n+\n+        //Creating the message in JSON format.\n+        String entity = ExceptionMapperUtil.getJsonErrorAsString(message);\n+\n+        //Return 4xx message to the client.\n+        return ExceptionMapperUtil.createResponse(entity, message,\n+                message.contains(\"index_not_found_exception\") ? Status.NOT_FOUND\n+                        : Status.BAD_REQUEST);", "originalCommit": "b28da220cacb831e557587017548be93302a7a8a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c7bf43d88b1555deec08af60c08b34114cbbefcc", "url": "https://github.com/dotCMS/core/commit/c7bf43d88b1555deec08af60c08b34114cbbefcc", "message": "Merge branch 'master' of https://github.com/dotCMS/core into issue-17848-additional-fix", "committedDate": "2020-03-13T21:50:10Z", "type": "commit"}, {"oid": "67abff06687fd337ae0d0c0d418d03a7c4c477c6", "url": "https://github.com/dotCMS/core/commit/67abff06687fd337ae0d0c0d418d03a7c4c477c6", "message": "#17848 Code review suggestion: remove DotSecurityException from catch to delegate exception handling to DotSecurityExceptionMapper", "committedDate": "2020-03-13T21:53:02Z", "type": "commit"}, {"oid": "cfc34680a4a35397f5873ad797e79732d2f3c8d7", "url": "https://github.com/dotCMS/core/commit/cfc34680a4a35397f5873ad797e79732d2f3c8d7", "message": "#17848 Applying code review suggestions", "committedDate": "2020-03-16T16:33:51Z", "type": "commit"}]}