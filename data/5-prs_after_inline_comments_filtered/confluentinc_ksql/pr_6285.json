{"pr_number": 6285, "pr_title": "test: correct bug in QTT that meant some tests were ignored", "pr_createdAt": "2020-09-23T11:47:56Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6285", "timeline": [{"oid": "d088ecaea56f8e16c91fc4fde824e6d18f04786f", "url": "https://github.com/confluentinc/ksql/commit/d088ecaea56f8e16c91fc4fde824e6d18f04786f", "message": "test: correct bug in QTT that meant some tests were ignored\n\nSome QTT test cases used `input` rather than `inputs` and `output` rather than `outputs`. Previously, QTT would have detected this mistake, but the check has been removed.\n\nThis change adds back in the check to ensure a test case provides at least one of:\n\n- an expected exception\n- input messages\n- output messages\n\nThe change also corrects the bad tests and their historic plans", "committedDate": "2020-09-23T11:47:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU0Mzc2MQ==", "url": "https://github.com/confluentinc/ksql/pull/6285#discussion_r493543761", "bodyText": "How come we only require one of inputs or outputs to be present? Under what scenario would it make sense to provide one and not the other?", "author": "vcrfxia", "createdAt": "2020-09-23T12:43:06Z", "path": "ksqldb-functional-tests/src/main/java/io/confluent/ksql/test/model/TestCaseNode.java", "diffHunk": "@@ -133,12 +134,22 @@ public VersionBoundsNode versionBounds() {\n   }\n \n   private void validate() {\n-    if (this.name.isEmpty()) {\n+    if (name.isEmpty()) {\n       throw new MissingFieldException(\"name\");\n     }\n \n-    if (this.statements.isEmpty()) {\n-      throw new InvalidFieldException(\"statements\", \"was empty\");\n+    try {\n+      if (statements.isEmpty()) {\n+        throw new InvalidFieldException(\"statements\", \"was empty\");\n+      }\n+\n+      if (!expectedException.isPresent() && inputs.isEmpty() && outputs.isEmpty()) {", "originalCommit": "d088ecaea56f8e16c91fc4fde824e6d18f04786f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU1NjA3Mw==", "url": "https://github.com/confluentinc/ksql/pull/6285#discussion_r493556073", "bodyText": "I now understand why the input file may be null: we might have tests that start with no inputs and instead use INSERT VALUES to insert data, but I still don't understand why it'd be useful to have a test where the output file is null. FWIW it looks like the testing tool requires the output file to be present: \n  \n    \n      ksql/ksqldb-functional-tests/src/main/java/io/confluent/ksql/test/tools/KsqlTestingTool.java\n    \n    \n         Line 55\n      in\n      c5d6b56\n    \n    \n    \n    \n\n        \n          \n           && testOptions.getOutputFile() != null) {", "author": "vcrfxia", "createdAt": "2020-09-23T12:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU0Mzc2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU3MzQzNw==", "url": "https://github.com/confluentinc/ksql/pull/6285#discussion_r493573437", "bodyText": "A test where a filter filters everything out.  Weird... yes... do we have such tests... yes.", "author": "big-andy-coates", "createdAt": "2020-09-23T13:13:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU0Mzc2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU5MTc4OA==", "url": "https://github.com/confluentinc/ksql/pull/6285#discussion_r493591788", "bodyText": "But shouldn't a test like that require an empty outputs node rather than a missing outputs node? Having a missing outputs node is counterintuitive since missing nodes in other parts of the test specification indicate that nothing should be checked, whereas in a test like that we would still want to verify that no outputs were produced.", "author": "vcrfxia", "createdAt": "2020-09-23T13:32:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU0Mzc2MQ=="}], "type": "inlineReview"}]}