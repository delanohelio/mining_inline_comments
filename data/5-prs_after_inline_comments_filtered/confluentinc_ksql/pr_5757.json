{"pr_number": 5757, "pr_title": "chore: update KSQL metrics context labels", "pr_createdAt": "2020-07-01T21:58:34Z", "pr_url": "https://github.com/confluentinc/ksql/pull/5757", "timeline": [{"oid": "7c7ecd15d4e90d4c6f22fd6c6a8de026de5733c6", "url": "https://github.com/confluentinc/ksql/commit/7c7ecd15d4e90d4c6f22fd6c6a8de026de5733c6", "message": "chore: update KSQL metrics context labels", "committedDate": "2020-07-01T22:41:06Z", "type": "commit"}, {"oid": "7c7ecd15d4e90d4c6f22fd6c6a8de026de5733c6", "url": "https://github.com/confluentinc/ksql/commit/7c7ecd15d4e90d4c6f22fd6c6a8de026de5733c6", "message": "chore: update KSQL metrics context labels", "committedDate": "2020-07-01T22:41:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzNDc2Nw==", "url": "https://github.com/confluentinc/ksql/pull/5757#discussion_r453134767", "bodyText": "if ksql.cluster.id and ksql.service.id are the same, why do we need both?", "author": "xiaodongdu", "createdAt": "2020-07-11T00:57:01Z", "path": "ksqldb-common/src/main/java/io/confluent/ksql/metrics/MetricCollectors.java", "diffHunk": "@@ -143,22 +142,16 @@ public static void addConfigurableReporter(\n   }\n \n   public static Map<String, Object> addConfluentMetricsContextConfigs(\n-      final String ksqlServiceId\n+      final String ksqlServiceId,\n+      final String kafkaClusterId\n   ) {\n     final Map<String, Object> updatedProps = new HashMap<>();\n     updatedProps.put(RESOURCE_LABEL_TYPE, KSQL_RESOURCE_TYPE);\n     updatedProps.put(RESOURCE_LABEL_CLUSTER_ID, ksqlServiceId);\n-    return updatedProps;\n-  }\n-\n-  public static Map<String, Object> addConfluentMetricsContextConfigsForKsql(\n-      final String ksqlServiceId\n-  ) {\n-    final Map<String, Object> updatedProps = new HashMap<>();\n     updatedProps.put(RESOURCE_LABEL_KSQL_SERVICE_ID, ksqlServiceId);\n+    updatedProps.put(RESOURCE_LABEL_KAFKA_CLUSTER_ID, kafkaClusterId);", "originalCommit": "7c7ecd15d4e90d4c6f22fd6c6a8de026de5733c6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzkwMDMwNQ==", "url": "https://github.com/confluentinc/ksql/pull/5757#discussion_r453900305", "bodyText": "we can remove RESOURCE_LABEL_KSQL_SERVICE_ID and just keep the cluster id label. The service id of a KSQL server is the only id for it so it essentially is the cluster id", "author": "stevenpyzhang", "createdAt": "2020-07-13T20:05:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzNDc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1Mzk4MjU0Ng==", "url": "https://github.com/confluentinc/ksql/pull/5757#discussion_r453982546", "bodyText": "RESOURCE_LABEL_CLUSTER_ID and RESOURCE_LABEL_KAFKA_CLUSTER_ID are the same. I would recommend to keep RESOURCE_LABEL_KSQL_SERVICE_ID which is more meaningful for KSQL.", "author": "xiaodongdu", "createdAt": "2020-07-13T22:31:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzNDc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDAyODU5NQ==", "url": "https://github.com/confluentinc/ksql/pull/5757#discussion_r454028595", "bodyText": "Oh I see, I was under the impression that the cluster id meant the ksql cluster id, not the kafka one. If that's the case, then I'll keep RESOURCE_LABEL_KSQL_SERVICE_ID", "author": "stevenpyzhang", "createdAt": "2020-07-14T00:39:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzNDc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDA1NTIwMw==", "url": "https://github.com/confluentinc/ksql/pull/5757#discussion_r454055203", "bodyText": "@stevenpyzhang @xiaodongdu I think it makes more sense to keep ksql.cluster.id as the KSQL service ID, and ksql.kafka.cluster.id as the backing cluster id to align with the terminology we already use in RBAC https://docs.confluent.io/current/security/rbac/rbac-get-cluster-ids.html#ksqldb-example\nWe should fix the other components if they don't align.", "author": "xvrl", "createdAt": "2020-07-14T02:10:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzNDc2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1NDYyMTcyMw==", "url": "https://github.com/confluentinc/ksql/pull/5757#discussion_r454621723", "bodyText": "@xvrl I've updated the PR to match with this ^", "author": "stevenpyzhang", "createdAt": "2020-07-14T20:23:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MzEzNDc2Nw=="}], "type": "inlineReview"}, {"oid": "6977a0c8051ea7bf1352715262dc7564c02a7d54", "url": "https://github.com/confluentinc/ksql/commit/6977a0c8051ea7bf1352715262dc7564c02a7d54", "message": "remove cluster.id label", "committedDate": "2020-07-14T00:38:06Z", "type": "commit"}, {"oid": "6977a0c8051ea7bf1352715262dc7564c02a7d54", "url": "https://github.com/confluentinc/ksql/commit/6977a0c8051ea7bf1352715262dc7564c02a7d54", "message": "remove cluster.id label", "committedDate": "2020-07-14T00:38:06Z", "type": "forcePushed"}, {"oid": "4a815fdb8b76636fca47c4048d483a40244311ca", "url": "https://github.com/confluentinc/ksql/commit/4a815fdb8b76636fca47c4048d483a40244311ca", "message": "Revert \"remove cluster.id label\"\n\nThis reverts commit 6977a0c8051ea7bf1352715262dc7564c02a7d54.", "committedDate": "2020-07-14T20:19:39Z", "type": "commit"}, {"oid": "f45cd3e6c66e028778f5ccf177830ef5cdca8cf8", "url": "https://github.com/confluentinc/ksql/commit/f45cd3e6c66e028778f5ccf177830ef5cdca8cf8", "message": "use cluster.id instead of service.id for label", "committedDate": "2020-07-14T22:04:21Z", "type": "commit"}, {"oid": "f45cd3e6c66e028778f5ccf177830ef5cdca8cf8", "url": "https://github.com/confluentinc/ksql/commit/f45cd3e6c66e028778f5ccf177830ef5cdca8cf8", "message": "use cluster.id instead of service.id for label", "committedDate": "2020-07-14T22:04:21Z", "type": "forcePushed"}]}