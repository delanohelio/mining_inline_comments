{"pr_number": 4580, "pr_title": "refactor: Use JKS TLS config", "pr_createdAt": "2020-02-17T18:22:23Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4580", "timeline": [{"oid": "1f061697e1868cd8f4e0aa05ffbecd46eec69105", "url": "https://github.com/confluentinc/ksql/commit/1f061697e1868cd8f4e0aa05ffbecd46eec69105", "message": "use JKS TLS config", "committedDate": "2020-02-17T18:40:56Z", "type": "commit"}, {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "url": "https://github.com/confluentinc/ksql/commit/6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "message": "tweaks", "committedDate": "2020-02-17T18:40:56Z", "type": "commit"}, {"oid": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "url": "https://github.com/confluentinc/ksql/commit/6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "message": "tweaks", "committedDate": "2020-02-17T18:40:56Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NzQwMQ==", "url": "https://github.com/confluentinc/ksql/pull/4580#discussion_r380857401", "bodyText": "Isn't client auth normally off, requested or required rather than simply on-off?", "author": "big-andy-coates", "createdAt": "2020-02-18T18:33:11Z", "path": "ksql-api/src/main/java/io/confluent/ksql/api/server/ApiServerConfig.java", "diffHunk": "@@ -38,22 +37,40 @@\n           + \" as there are cores you want to use, as each instance is single threaded.\";\n \n   public static final String LISTEN_HOST = propertyName(\"listen.host\");\n-  public static final String DEFAULT_LISTEN_HOST = \"0.0.0.0\";\n+  public static final String DEFAULT_LISTEN_HOST = \"localhost\";\n   public static final String LISTEN_HOST_DOC =\n       \"The hostname to listen on\";\n \n   public static final String LISTEN_PORT = propertyName(\"listen.port\");\n-  public static final int DEFAULT_LISTEN_PORT = 8089;\n+  public static final int DEFAULT_LISTEN_PORT = 8088;\n   public static final String LISTEN_PORT_DOC =\n       \"The port to listen on\";\n \n-  public static final String KEY_PATH = propertyName(\"key.path\");\n-  public static final String KEY_PATH_DOC =\n-      \"Path to key file\";\n+  public static final String TLS_ENABLED = propertyName(\"tls.enabled\");\n+  public static final boolean DEFAULT_TLS_ENABLED = false;\n+  public static final String TLS_ENABLED_DOC =\n+      \"Is TLS enabled?\";\n \n-  public static final String CERT_PATH = propertyName(\"cert.path\");\n-  public static final String CERT_PATH_DOC =\n-      \"Path to cert file\";\n+  public static final String TLS_KEY_STORE_PATH = propertyName(\"tls.keystore.path\");\n+  public static final String TLS_KEY_STORE_PATH_DOC =\n+      \"Path to server key store\";\n+\n+  public static final String TLS_KEY_STORE_PASSWORD = propertyName(\"tls.keystore.password\");\n+  public static final String TLS_KEY_STORE_PASSWORD_DOC =\n+      \"Password for server key store\";\n+\n+  public static final String TLS_TRUST_STORE_PATH = propertyName(\"tls.truststore.path\");\n+  public static final String TLS_TRUST_STORE_PATH_DOC =\n+      \"Path to client trust store\";\n+\n+  public static final String TLS_TRUST_STORE_PASSWORD = propertyName(\"tls.truststore.password\");\n+  public static final String TLS_TRUST_STORE_PASSWORD_DOC =\n+      \"Password for client trust store\";\n+\n+  public static final String TLS_CLIENT_AUTH_REQUIRED = propertyName(\"tls.client.auth.required\");\n+  public static final boolean DEFAULT_TLS_CLIENT_AUTH_REQUIRED = false;", "originalCommit": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkxOTg1MQ==", "url": "https://github.com/confluentinc/ksql/pull/4580#discussion_r380919851", "bodyText": "This follows the current KSQL client auth config which is binary, aiui.", "author": "purplefox", "createdAt": "2020-02-18T20:35:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1NzQwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1OTA5NQ==", "url": "https://github.com/confluentinc/ksql/pull/4580#discussion_r380859095", "bodyText": "Do we want to run all the tests in ApiTest with Tls enabled?  I would of thought that's a bit heavy weight given the number of tests in there will likely increase over time.  Is it not sufficient to test that a single pull query works, a single push query works, etc?", "author": "big-andy-coates", "createdAt": "2020-02-18T18:36:31Z", "path": "ksql-api/src/test/java/io/confluent/ksql/api/TlsTest.java", "diffHunk": "@@ -0,0 +1,62 @@\n+/*\n+ * Copyright 2020 Confluent Inc.\n+ *\n+ * Licensed under the Confluent Community License (the \"License\"); you may not use\n+ * this file except in compliance with the License.  You may obtain a copy of the\n+ * License at\n+ *\n+ * http://www.confluent.io/confluent-community-license\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\n+ * WARRANTIES OF ANY KIND, either express or implied.  See the License for the\n+ * specific language governing permissions and limitations under the License.\n+ */\n+\n+package io.confluent.ksql.api;\n+\n+import io.confluent.ksql.api.server.ApiServerConfig;\n+import io.confluent.ksql.test.util.secure.ServerKeyStore;\n+import io.vertx.core.http.HttpVersion;\n+import io.vertx.ext.web.client.WebClientOptions;\n+import java.util.HashMap;\n+import java.util.Map;\n+import org.apache.kafka.common.config.SslConfigs;\n+\n+public class TlsTest extends ApiTest {", "originalCommit": "6965db8c78dfa3c242fbbbc7a36c4b627b8e2c96", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDkyMTAwMQ==", "url": "https://github.com/confluentinc/ksql/pull/4580#discussion_r380921001", "bodyText": "I caught a bug during development which only caused one of those tests to fail using TLS so I think there is value in running all of them. They run quite quickly currently and certainly compared to the integration tests run time is not significant, but if it becomes a problem we can revisit.", "author": "purplefox", "createdAt": "2020-02-18T20:37:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDg1OTA5NQ=="}], "type": "inlineReview"}]}