{"pr_number": 6256, "pr_title": "chore: finish wiring up unwrapped keys", "pr_createdAt": "2020-09-18T13:38:28Z", "pr_url": "https://github.com/confluentinc/ksql/pull/6256", "timeline": [{"oid": "19321cfae6d50aa1d73845825d51d18f1de82d27", "url": "https://github.com/confluentinc/ksql/commit/19321cfae6d50aa1d73845825d51d18f1de82d27", "message": "chore: finish wiring up unwrapped keys\n\nfixes: https://github.com/confluentinc/ksql/issues/6209\n\nThis finishes the wiring of the `WRAP_SINGLE_KEYS` option up.", "committedDate": "2020-09-18T13:37:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk1NTkwOA==", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r490955908", "bodyText": "Dropped these in favour of findAny, which is more generic.", "author": "big-andy-coates", "createdAt": "2020-09-18T13:39:31Z", "path": "ksqldb-common/src/main/java/io/confluent/ksql/serde/SerdeOptions.java", "diffHunk": "@@ -60,33 +59,22 @@ private SerdeOptions(final ImmutableSet<SerdeOption> options) {\n     validate(this.options);\n   }\n \n-  @SuppressWarnings(\"MethodMayBeStatic\")\n   public EnabledSerdeFeatures keyFeatures() {\n-    // Currently there are no key features:\n-    return EnabledSerdeFeatures.of();\n+    return features(true);\n   }\n \n   public EnabledSerdeFeatures valueFeatures() {\n-    // Currently there are no key features, so all are value features:\n-    return EnabledSerdeFeatures.from(options.stream()\n-        .map(SerdeOption::requiredFeature)\n-        .collect(Collectors.toSet()));\n+    return features(false);\n   }\n \n   public Set<SerdeOption> all() {\n     return options;\n   }\n \n-  public Optional<SerdeOption> keyWrapping() {\n-    return Optional.ofNullable(\n-        Iterables.getFirst(Sets.intersection(options, KEY_WRAPPING_OPTIONS), null)\n-    );\n-  }\n-\n-  public Optional<SerdeOption> valueWrapping() {\n-    return Optional.ofNullable(\n-        Iterables.getFirst(Sets.intersection(options, VALUE_WRAPPING_OPTIONS), null)\n-    );", "originalCommit": "19321cfae6d50aa1d73845825d51d18f1de82d27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDk1NjI3Ng==", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r490956276", "bodyText": "key features are now returned as key features, not value features!", "author": "big-andy-coates", "createdAt": "2020-09-18T13:40:07Z", "path": "ksqldb-common/src/main/java/io/confluent/ksql/serde/SerdeOptions.java", "diffHunk": "@@ -111,6 +99,13 @@ public String toString() {\n     return options.toString();\n   }\n \n+  private EnabledSerdeFeatures features(final boolean key) {\n+    return EnabledSerdeFeatures.from(options.stream()\n+        .filter(option -> option.isKeyOption() == key)\n+        .map(SerdeOption::requiredFeature)\n+        .collect(Collectors.toSet()));\n+  }", "originalCommit": "19321cfae6d50aa1d73845825d51d18f1de82d27", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE2MDgwMg==", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r491160802", "bodyText": "Does it make sense to assume all serde options will always be either key- or value-specific, never both nor neither? Can't think of why this wouldn't be true in the future but seemed worth double-checking.", "author": "vcrfxia", "createdAt": "2020-09-18T19:55:23Z", "path": "ksqldb-common/src/main/java/io/confluent/ksql/serde/SerdeOption.java", "diffHunk": "@@ -38,19 +38,25 @@\n    *\n    * @see SerdeOption#WRAP_SINGLE_VALUES\n    */\n-  UNWRAP_SINGLE_VALUES(SerdeFeature.UNWRAP_SINGLES),\n+  UNWRAP_SINGLE_VALUES(SerdeFeature.UNWRAP_SINGLES, false),\n \n   /**\n    * Key version of {@link #UNWRAP_SINGLE_VALUES}.\n    */\n-  UNWRAP_SINGLE_KEYS(SerdeFeature.UNWRAP_SINGLES);\n+  UNWRAP_SINGLE_KEYS(SerdeFeature.UNWRAP_SINGLES, true);\n \n+  private final boolean isKey;\n   private final SerdeFeature requiredFeature;\n \n-  SerdeOption(final SerdeFeature requiredFeature) {\n+  SerdeOption(final SerdeFeature requiredFeature, final boolean isKey) {", "originalCommit": "19321cfae6d50aa1d73845825d51d18f1de82d27", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE4MzA5Mw==", "url": "https://github.com/confluentinc/ksql/pull/6256#discussion_r491183093", "bodyText": "That's the assumption at the moment.  If that changes... we change the code! ;)\nIdeally, we'd ditch SerdeOption and just keep SerdeFeature, but that's a bigger change.", "author": "big-andy-coates", "createdAt": "2020-09-18T20:47:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MTE2MDgwMg=="}], "type": "inlineReview"}, {"oid": "a8f1ccdc1ada8d41e708aa4a3b8e72eb51db5ab8", "url": "https://github.com/confluentinc/ksql/commit/a8f1ccdc1ada8d41e708aa4a3b8e72eb51db5ab8", "message": "Merge branch 'master' into serde_options_wiring", "committedDate": "2020-09-21T10:15:17Z", "type": "commit"}]}