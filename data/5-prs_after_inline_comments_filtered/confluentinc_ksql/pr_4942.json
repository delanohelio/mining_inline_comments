{"pr_number": 4942, "pr_title": "fix: do not allow grouping sets", "pr_createdAt": "2020-03-30T20:32:02Z", "pr_url": "https://github.com/confluentinc/ksql/pull/4942", "timeline": [{"oid": "fd35b13a468dea2bf8876bfeb5c4de5c02b55f23", "url": "https://github.com/confluentinc/ksql/commit/fd35b13a468dea2bf8876bfeb5c4de5c02b55f23", "message": "fix: do not allow GROUP BY and PARTITION BY on boolean expressions\n\nfixes: https://github.com/confluentinc/ksql/issues/4939\n\nChange to SQL syntax to not allow GROUP BY and PARTITION BY on boolean expressions. Only value expressions will be allowed.", "committedDate": "2020-03-30T19:52:42Z", "type": "commit"}, {"oid": "17833d2da49e320c29a97819fd34c4c0d153483c", "url": "https://github.com/confluentinc/ksql/commit/17833d2da49e320c29a97819fd34c4c0d153483c", "message": "fix: do not allow grouping sets\n\nfixes: https://github.com/confluentinc/ksql/issues/4941\n\nChange the ksqlDB syntax to now allow grouping sets, which aren't supported yet.", "committedDate": "2020-03-30T20:30:38Z", "type": "commit"}, {"oid": "27ca851e19c656ea8906e7b2aee398b3968cb15c", "url": "https://github.com/confluentinc/ksql/commit/27ca851e19c656ea8906e7b2aee398b3968cb15c", "message": "chore: merge from master\n\nConflicting files\nksqldb-parser/src/main/antlr4/io/confluent/ksql/parser/SqlBase.g4\nksqldb-parser/src/main/java/io/confluent/ksql/parser/AstBuilder.java", "committedDate": "2020-03-30T23:27:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcxMzgzMA==", "url": "https://github.com/confluentinc/ksql/pull/4942#discussion_r400713830", "bodyText": "shouldn't grouping expressions be a unique set though ? what does it mean to group by a,a,b,a ?  it's possible i'm entirely misunderstanding what this piece of code does though, rusty on this stuff ;)   Comment applies regardless of whether the groupingExpression is retained (per Almog's suggestion) or not - i think....", "author": "blueedgenick", "createdAt": "2020-03-31T07:57:57Z", "path": "ksqldb-engine/src/main/java/io/confluent/ksql/analyzer/Analysis.java", "diffHunk": "@@ -129,7 +129,7 @@ void setWhereExpression(final Expression whereExpression) {\n     return ImmutableList.copyOf(groupByExpressions);\n   }\n \n-  void addGroupByExpressions(final Set<Expression> expressions) {\n+  void addGroupByExpressions(final Collection<Expression> expressions) {", "originalCommit": "27ca851e19c656ea8906e7b2aee398b3968cb15c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDc4NjM0NA==", "url": "https://github.com/confluentinc/ksql/pull/4942#discussion_r400786344", "bodyText": "That's a good point Nick. The old code didn't actually enforce this as addGroupByExpressions was called multiple times.\nI've corrected the code and added tests to cover this.  Now:\nCREATE TABLE OUTPUT AS SELECT COUNT(*) FROM TEST GROUP BY DATA, DATA;\nResults in an error:\nDuplicate GROUP BY expression: TEST.DATA\n\nThe old code was also not maintaining the order of the GROUP BY expressions. This has also been fixed in this PR.", "author": "big-andy-coates", "createdAt": "2020-03-31T09:55:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcxMzgzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDk5MzU5MA==", "url": "https://github.com/confluentinc/ksql/pull/4942#discussion_r400993590", "bodyText": "nice!", "author": "blueedgenick", "createdAt": "2020-03-31T15:12:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDcxMzgzMA=="}], "type": "inlineReview"}, {"oid": "45476674d85cda61e2af1080c37c5dac5ced43ff", "url": "https://github.com/confluentinc/ksql/commit/45476674d85cda61e2af1080c37c5dac5ced43ff", "message": "chore: changes requested by Nick", "committedDate": "2020-03-31T09:56:20Z", "type": "commit"}]}