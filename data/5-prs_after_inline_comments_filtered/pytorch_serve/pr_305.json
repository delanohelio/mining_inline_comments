{"pr_number": 305, "pr_title": "Fixed response status message for inferencing on model with zero workers", "pr_createdAt": "2020-05-06T11:17:11Z", "pr_url": "https://github.com/pytorch/serve/pull/305", "timeline": [{"oid": "02442339a708d90607a85d0d81d58181dedfa1c7", "url": "https://github.com/pytorch/serve/commit/02442339a708d90607a85d0d81d58181dedfa1c7", "message": "Changes for issue_29", "committedDate": "2020-05-06T09:44:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMDUxNA==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r420720514", "bodyText": "Add model version as well in response.", "author": "harshbafna", "createdAt": "2020-05-06T11:31:33Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -238,8 +238,11 @@ private void handleRegisterModel(\n \n         modelName = archive.getModelName();\n \n-        final String msg = \"Model \\\"\" + modelName + \"\\\" registered\";\n         if (initialWorkers <= 0) {\n+            final String msg =\n+                    \"Model \\\"\"", "originalCommit": "02442339a708d90607a85d0d81d58181dedfa1c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMDgzNQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r420720835", "bodyText": "Add model version as well in response.", "author": "harshbafna", "createdAt": "2020-05-06T11:32:15Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/InferenceRequestHandler.java", "diffHunk": "@@ -179,7 +179,9 @@ private void predict(\n         Job job = new Job(ctx, modelName, modelVersion, WorkerCommands.PREDICT, input);\n         if (!ModelManager.getInstance().addJob(job)) {\n             throw new ServiceUnavailableException(\n-                    \"No worker is available to serve request: \" + modelName);\n+                    \"No worker is available to serve request: \"", "originalCommit": "02442339a708d90607a85d0d81d58181dedfa1c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMzA4OQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r421223089", "bodyText": "Can we say here 'Model {} has no worker to serve inference request'?", "author": "dhaniram-kshirsagar", "createdAt": "2020-05-07T03:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMDgzNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMTYxOQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r420721619", "bodyText": "create message string in the if else block and use a common statement to return the response. Add model version as well in response for model registration call.", "author": "harshbafna", "createdAt": "2020-05-06T11:33:54Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -329,8 +335,19 @@ private void updateModelWorkers(\n                                     modelManager.scaleRequestStatus(modelName, modelVersion);\n                             if (HttpResponseStatus.OK.equals(v)) {\n                                 if (status) {\n-                                    NettyUtils.sendJsonResponse(\n-                                            ctx, new StatusResponse(\"Workers scaled\"), v);\n+                                    if (isRegistration) {\n+                                        String msg =\n+                                                \"Model \\\"\"\n+                                                        + modelName\n+                                                        + \"\\\" registered with \"\n+                                                        + minWorkers\n+                                                        + \" initial workers\";\n+                                        NettyUtils.sendJsonResponse(\n+                                                ctx, new StatusResponse(msg), v);\n+                                    } else {\n+                                        NettyUtils.sendJsonResponse(", "originalCommit": "02442339a708d90607a85d0d81d58181dedfa1c7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMjMwNA==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r420722304", "bodyText": "rename as initWorkers", "author": "harshbafna", "createdAt": "2020-05-06T11:35:11Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -311,7 +316,8 @@ private void updateModelWorkers(\n             int minWorkers,\n             int maxWorkers,\n             boolean synchronous,\n-            final Function<Void, Void> onError) {\n+            final Function<Void, Void> onError,\n+            boolean isRegistration) {", "originalCommit": "02442339a708d90607a85d0d81d58181dedfa1c7", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMzgwNQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r420723805", "bodyText": "move this argument before onError.", "author": "harshbafna", "createdAt": "2020-05-06T11:38:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDcyMjMwNA=="}], "type": "inlineReview"}, {"oid": "2bbea577e8c92f624e8db3848ad63706f8a6e265", "url": "https://github.com/pytorch/serve/commit/2bbea577e8c92f624e8db3848ad63706f8a6e265", "message": "Merge branch 'staging_0_1_1' into Issue_29", "committedDate": "2020-05-07T03:11:12Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTI1ODM3Nw==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r421258377", "bodyText": "Improve message to contain number of workers, model name and version.", "author": "harshbafna", "createdAt": "2020-05-07T06:03:08Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -329,8 +335,19 @@ private void updateModelWorkers(\n                                     modelManager.scaleRequestStatus(modelName, modelVersion);\n                             if (HttpResponseStatus.OK.equals(v)) {\n                                 if (status) {\n-                                    NettyUtils.sendJsonResponse(\n-                                            ctx, new StatusResponse(\"Workers scaled\"), v);\n+                                    if (isRegistration) {\n+                                        String msg =\n+                                                \"Model \\\"\"\n+                                                        + modelName\n+                                                        + \"\\\" registered with \"\n+                                                        + minWorkers\n+                                                        + \" initial workers\";\n+                                        NettyUtils.sendJsonResponse(\n+                                                ctx, new StatusResponse(msg), v);\n+                                    } else {\n+                                        NettyUtils.sendJsonResponse(\n+                                                ctx, new StatusResponse(\"Workers scaled\"), v);", "originalCommit": "2bbea577e8c92f624e8db3848ad63706f8a6e265", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f4b3cc89a3b3c39df1cc667c3e575c3c43e99e0a", "url": "https://github.com/pytorch/serve/commit/f4b3cc89a3b3c39df1cc667c3e575c3c43e99e0a", "message": "Changed error Messages", "committedDate": "2020-05-07T07:52:39Z", "type": "commit"}, {"oid": "2acfb62e50f057fb18e0588e88e26eeec0f9b2d4", "url": "https://github.com/pytorch/serve/commit/2acfb62e50f057fb18e0588e88e26eeec0f9b2d4", "message": "changed message for scalling request", "committedDate": "2020-05-07T09:23:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQyNTMxOQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r421425319", "bodyText": "Add a null check for modelVersion and return default version in that case.", "author": "harshbafna", "createdAt": "2020-05-07T11:13:04Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/InferenceRequestHandler.java", "diffHunk": "@@ -179,7 +179,12 @@ private void predict(\n         Job job = new Job(ctx, modelName, modelVersion, WorkerCommands.PREDICT, input);\n         if (!ModelManager.getInstance().addJob(job)) {\n             throw new ServiceUnavailableException(\n-                    \"No worker is available to serve request: \" + modelName);\n+                    \"Model \\\"\"\n+                            + modelName\n+                            + \"\\\" Version \"\n+                            + modelVersion", "originalCommit": "2acfb62e50f057fb18e0588e88e26eeec0f9b2d4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTUyNjQwNg==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r421526406", "bodyText": "Now instead of null, it will show defaultVersion", "author": "mjpsl", "createdAt": "2020-05-07T13:59:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTQyNTMxOQ=="}], "type": "inlineReview"}, {"oid": "91966a7482f2c71b35383183a7ce797442cf28d8", "url": "https://github.com/pytorch/serve/commit/91966a7482f2c71b35383183a7ce797442cf28d8", "message": "changed defaultVersion string", "committedDate": "2020-05-07T13:57:50Z", "type": "commit"}, {"oid": "7ac26fbf312d37076674e5066ec5dca5f13569b6", "url": "https://github.com/pytorch/serve/commit/7ac26fbf312d37076674e5066ec5dca5f13569b6", "message": "Corrected error message", "committedDate": "2020-05-07T14:28:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1MTc3NQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r421651775", "bodyText": "I am curious to understand if this message needs modification. Can't this be a generic message of how many workers are we scaling this to? If we elaborate on this message, then customers who maintain logs will know that POST /models, which is register model,  was updated with n number of workers. Adding a flag to determine the code path, ie., if this is coming from register-model or from scale model, seems a little hacky.", "author": "vdantu", "createdAt": "2020-05-07T16:54:30Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -329,8 +337,19 @@ private void updateModelWorkers(\n                                     modelManager.scaleRequestStatus(modelName, modelVersion);\n                             if (HttpResponseStatus.OK.equals(v)) {\n                                 if (status) {\n-                                    NettyUtils.sendJsonResponse(\n-                                            ctx, new StatusResponse(\"Workers scaled\"), v);\n+                                    String msg =", "originalCommit": "7ac26fbf312d37076674e5066ec5dca5f13569b6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3Mzk3Mw==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r421673973", "bodyText": "The idea is to keep the response message consistent for registration request with/without initial workers. I agree its a bit hacky.", "author": "dhaniram-kshirsagar", "createdAt": "2020-05-07T17:31:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1MTc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMjEzMjg2Mw==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r422132863", "bodyText": "Keeping these changes as message give clear information.", "author": "mjpsl", "createdAt": "2020-05-08T13:09:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1MTc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTU2ODY0NQ==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r429568645", "bodyText": "@vdantu Let me know if this LGTY", "author": "maaquib", "createdAt": "2020-05-23T18:39:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1MTc3NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMTI4NzE3Nw==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r431287177", "bodyText": "I am still not convinced that passing a boolean flag to determine the error message is the the only option. But, this is is not a blocker for the PR. We can look into how to refactor this code in the future (may be return the future to the method above and populate the error message there or some such).", "author": "vdantu", "createdAt": "2020-05-27T16:41:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1MTc3NQ=="}], "type": "inlineReview"}, {"oid": "17b41413a7e6d068972bac7606933b1c39875c4e", "url": "https://github.com/pytorch/serve/commit/17b41413a7e6d068972bac7606933b1c39875c4e", "message": "changed the code for best practice", "committedDate": "2020-05-08T04:54:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ2NzIwNg==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r423467206", "bodyText": "Remove duplication for common string in both the responses.", "author": "harshbafna", "createdAt": "2020-05-12T05:17:12Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/InferenceRequestHandler.java", "diffHunk": "@@ -178,8 +178,23 @@ private void predict(\n \n         Job job = new Job(ctx, modelName, modelVersion, WorkerCommands.PREDICT, input);\n         if (!ModelManager.getInstance().addJob(job)) {\n-            throw new ServiceUnavailableException(\n-                    \"No worker is available to serve request: \" + modelName);\n+            String responseMessage =\n+                    \"Model \\\"\"", "originalCommit": "17b41413a7e6d068972bac7606933b1c39875c4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzQ2Nzc0Mw==", "url": "https://github.com/pytorch/serve/pull/305#discussion_r423467743", "bodyText": "Add version in response.", "author": "harshbafna", "createdAt": "2020-05-12T05:19:15Z", "path": "frontend/server/src/main/java/org/pytorch/serve/http/ManagementRequestHandler.java", "diffHunk": "@@ -329,8 +337,19 @@ private void updateModelWorkers(\n                                     modelManager.scaleRequestStatus(modelName, modelVersion);\n                             if (HttpResponseStatus.OK.equals(v)) {\n                                 if (status) {\n-                                    NettyUtils.sendJsonResponse(\n-                                            ctx, new StatusResponse(\"Workers scaled\"), v);\n+                                    String msg =\n+                                            minWorkers + \" Workers scaled for model \" + modelName;", "originalCommit": "17b41413a7e6d068972bac7606933b1c39875c4e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "281f814a422148512933e5beac5db525584a2f14", "url": "https://github.com/pytorch/serve/commit/281f814a422148512933e5beac5db525584a2f14", "message": "resolved review comment for version", "committedDate": "2020-05-15T07:01:19Z", "type": "commit"}, {"oid": "3b2f0d26da0653d79cb417f9a6c64ab2e3218470", "url": "https://github.com/pytorch/serve/commit/3b2f0d26da0653d79cb417f9a6c64ab2e3218470", "message": "Merge branch 'staging_0_1_1' into Issue_29", "committedDate": "2020-05-16T00:56:44Z", "type": "commit"}, {"oid": "4ed14e662c1102b9bf2fddc08b480ae078c8824a", "url": "https://github.com/pytorch/serve/commit/4ed14e662c1102b9bf2fddc08b480ae078c8824a", "message": "resolved merge conflicts, added test case", "committedDate": "2020-05-21T12:59:38Z", "type": "commit"}, {"oid": "8c138d46bd9c6416e1e8b5f7f4bc825459d37d65", "url": "https://github.com/pytorch/serve/commit/8c138d46bd9c6416e1e8b5f7f4bc825459d37d65", "message": "Merge branch 'staging_0_1_1' of https://github.com/pytorch/serve into Issue_29\n\n# Conflicts:\n#\tfrontend/server/src/test/java/org/pytorch/serve/ModelServerTest.java\n\n- updated scale workers msg", "committedDate": "2020-05-22T14:50:56Z", "type": "commit"}, {"oid": "b9cf127a39773d89f2ab75e674a7315ec372b02b", "url": "https://github.com/pytorch/serve/commit/b9cf127a39773d89f2ab75e674a7315ec372b02b", "message": "updated management api doc as per new responses in worker scale api", "committedDate": "2020-05-22T15:27:50Z", "type": "commit"}, {"oid": "6932c5985dcddd9302637cc9e4f0da2671bc5c4f", "url": "https://github.com/pytorch/serve/commit/6932c5985dcddd9302637cc9e4f0da2671bc5c4f", "message": "Merge branch 'staging_0_1_1' into Issue_29", "committedDate": "2020-05-22T18:06:34Z", "type": "commit"}, {"oid": "15d4ed01ae6d87d8df52b1506951deb8d464c459", "url": "https://github.com/pytorch/serve/commit/15d4ed01ae6d87d8df52b1506951deb8d464c459", "message": "Merge branch 'staging_0_1_1' into Issue_29", "committedDate": "2020-05-22T21:05:38Z", "type": "commit"}, {"oid": "257e524f37b4a30b44e366617af1ba2ab7dffda2", "url": "https://github.com/pytorch/serve/commit/257e524f37b4a30b44e366617af1ba2ab7dffda2", "message": "Merge branch 'staging_0_1_1' into Issue_29", "committedDate": "2020-05-23T18:39:10Z", "type": "commit"}, {"oid": "4abff564dd180529010481e0a4bd1d35ba40f302", "url": "https://github.com/pytorch/serve/commit/4abff564dd180529010481e0a4bd1d35ba40f302", "message": "Merge branch 'staging_0_1_1' into Issue_29", "committedDate": "2020-05-27T17:00:15Z", "type": "commit"}]}