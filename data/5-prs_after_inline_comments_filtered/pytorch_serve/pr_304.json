{"pr_number": 304, "pr_title": "Corrected port number validation range", "pr_createdAt": "2020-05-06T09:33:21Z", "pr_url": "https://github.com/pytorch/serve/pull/304", "timeline": [{"oid": "368910cd2115c7adff111a54bc91b7c9b69c0585", "url": "https://github.com/pytorch/serve/commit/368910cd2115c7adff111a54bc91b7c9b69c0585", "message": "Corrected port number validation range", "committedDate": "2020-05-06T09:26:11Z", "type": "commit"}, {"oid": "da29522352592f3401d17d5470e4533610fc3a94", "url": "https://github.com/pytorch/serve/commit/da29522352592f3401d17d5470e4533610fc3a94", "message": "added UT for issue 291", "committedDate": "2020-05-06T16:06:15Z", "type": "commit"}, {"oid": "f1f1fb1420adeda898e7ea5224abf855bed25f1e", "url": "https://github.com/pytorch/serve/commit/f1f1fb1420adeda898e7ea5224abf855bed25f1e", "message": "added ut dependency file formatting", "committedDate": "2020-05-06T16:32:40Z", "type": "commit"}, {"oid": "2eeea607a0018484b54851b09150f5aebc7bbc76", "url": "https://github.com/pytorch/serve/commit/2eeea607a0018484b54851b09150f5aebc7bbc76", "message": "correct param in config_test_env.properties", "committedDate": "2020-05-06T16:35:45Z", "type": "commit"}, {"oid": "18d67158d820a6d56920a48f150cfb06ebec4386", "url": "https://github.com/pytorch/serve/commit/18d67158d820a6d56920a48f150cfb06ebec4386", "message": "removed incorrect flags from test case config files", "committedDate": "2020-05-06T16:39:31Z", "type": "commit"}, {"oid": "fef31270fe70b3a1439660c206895c2621d6bc71", "url": "https://github.com/pytorch/serve/commit/fef31270fe70b3a1439660c206895c2621d6bc71", "message": "Merge branch 'staging_0_1_1' into issue_291", "committedDate": "2020-05-07T02:52:52Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTIyMTQwNQ==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421221405", "bodyText": "Can we add negative and edge cases for this?", "author": "dhaniram-kshirsagar", "createdAt": "2020-05-07T03:44:04Z", "path": "frontend/server/src/test/java/org/pytorch/serve/ModelServerTest.java", "diffHunk": "@@ -1244,4 +1247,43 @@ private void testMetricManager() throws JsonParseException, InterruptedException\n             }\n         }\n     }\n+\n+    private void testTSPortRange()", "originalCommit": "fef31270fe70b3a1439660c206895c2621d6bc71", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ce70699e087f67e6c6ba79d2dd3edd2c994e46f5", "url": "https://github.com/pytorch/serve/commit/ce70699e087f67e6c6ba79d2dd3edd2c994e46f5", "message": "added negative test cases", "committedDate": "2020-05-07T15:56:07Z", "type": "commit"}, {"oid": "ecfd86c51295db13cb461828f6c50c70b3a9447d", "url": "https://github.com/pytorch/serve/commit/ecfd86c51295db13cb461828f6c50c70b3a9447d", "message": "Merge branch 'issue_291' of https://github.com/pytorch/serve into issue_291", "committedDate": "2020-05-07T15:56:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0MDg3Mw==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421640873", "bodyText": "I am curious to know what this file is, that we are deleting.", "author": "vdantu", "createdAt": "2020-05-07T16:36:59Z", "path": "frontend/server/src/test/java/org/pytorch/serve/ModelServerTest.java", "diffHunk": "@@ -1244,4 +1248,65 @@ private void testMetricManager() throws JsonParseException, InterruptedException\n             }\n         }\n     }\n+\n+    private void testTSValidPort()\n+            throws InterruptedException, GeneralSecurityException, InvalidSnapshotException,\n+                    IOException {\n+        //  test case for verifying port range refer https://github.com/pytorch/serve/issues/291\n+        server.stop();\n+        System.setProperty(\"tsConfigFile\", \"src/test/resources/config_port.properties\");\n+        FileUtils.deleteQuietly(new File(System.getProperty(\"LOG_LOCATION\"), \"config\"));", "originalCommit": "ecfd86c51295db13cb461828f6c50c70b3a9447d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY1MTg1NA==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421651854", "bodyText": "Due to snapshot feature, the first preference will be given to last available snapshot file instead of the properties file set in the system properties. Thus cleaning up the generated snapshot before restart.", "author": "harshbafna", "createdAt": "2020-05-07T16:54:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0MDg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3Mzg1Ng==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421673856", "bodyText": "Why is snapshot given a preference over the runtime configuration? Whats the order of preference for this?", "author": "vdantu", "createdAt": "2020-05-07T17:31:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0MDg3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3OTYxOQ==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421679619", "bodyText": "The preference order for properties file is as follows :\n\nSystem environment\nCommand line argument\nLast snapshot\nJava System Property.", "author": "harshbafna", "createdAt": "2020-05-07T17:41:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY0MDg3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NTMwMw==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421675303", "bodyText": "I was thinking about this test a little more. Since this test is only testing hte JAVA code path, couldn't we simply modify the TS_INFERENCE_ADDRESS property in ConfigManager and restart the server? Do we need this additional config.properties file?", "author": "vdantu", "createdAt": "2020-05-07T17:33:56Z", "path": "frontend/server/src/test/java/org/pytorch/serve/ModelServerTest.java", "diffHunk": "@@ -1244,4 +1248,65 @@ private void testMetricManager() throws JsonParseException, InterruptedException\n             }\n         }\n     }\n+\n+    private void testTSValidPort()\n+            throws InterruptedException, GeneralSecurityException, InvalidSnapshotException,\n+                    IOException {\n+        //  test case for verifying port range refer https://github.com/pytorch/serve/issues/291\n+        server.stop();\n+        System.setProperty(\"tsConfigFile\", \"src/test/resources/config_port.properties\");\n+        FileUtils.deleteQuietly(new File(System.getProperty(\"LOG_LOCATION\"), \"config\"));\n+        ConfigManager.init(new ConfigManager.Arguments());\n+        configManager = ConfigManager.getInstance();\n+        PluginsManager.getInstance().initialize();\n+\n+        InternalLoggerFactory.setDefaultFactory(Slf4JLoggerFactory.INSTANCE);\n+        server = new ModelServer(configManager);\n+        server.start();\n+\n+        Channel channel = null;\n+        Channel managementChannel = null;\n+        for (int i = 0; i < 5; ++i) {\n+            channel = TestUtils.connect(false, configManager);\n+            if (channel != null) {\n+                break;\n+            }\n+            Thread.sleep(100);\n+        }\n+\n+        for (int i = 0; i < 5; ++i) {\n+            managementChannel = TestUtils.connect(true, configManager);\n+            if (managementChannel != null) {\n+                break;\n+            }\n+            Thread.sleep(100);\n+        }\n+\n+        Assert.assertNotNull(channel, \"Failed to connect to inference port.\");\n+        Assert.assertNotNull(managementChannel, \"Failed to connect to management port.\");\n+\n+        testPing(channel);\n+    }\n+\n+    private void testTSInvalidPort()\n+            throws InterruptedException, GeneralSecurityException, InvalidSnapshotException,\n+                    IOException {\n+        //  test case for verifying port range refer https://github.com/pytorch/serve/issues/291\n+        //  invalid port test\n+        server.stop();\n+        System.setProperty(\"tsConfigFile\", \"src/test/resources/config_invalid_port.properties\");", "originalCommit": "ecfd86c51295db13cb461828f6c50c70b3a9447d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY4MjA4NA==", "url": "https://github.com/pytorch/serve/pull/304#discussion_r421682084", "bodyText": "+1\nThis is a much simpler approach. Thanks.", "author": "harshbafna", "createdAt": "2020-05-07T17:45:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMTY3NTMwMw=="}], "type": "inlineReview"}, {"oid": "1c09831396ddccfa6afe7cbcc6e4067ee305c40a", "url": "https://github.com/pytorch/serve/commit/1c09831396ddccfa6afe7cbcc6e4067ee305c40a", "message": "removed properties file and changes in test case", "committedDate": "2020-05-08T09:39:52Z", "type": "commit"}, {"oid": "3a9fa73b7c2096adf3daf9caa6d225782a3807d1", "url": "https://github.com/pytorch/serve/commit/3a9fa73b7c2096adf3daf9caa6d225782a3807d1", "message": "resolved merge conflicts", "committedDate": "2020-05-21T10:55:23Z", "type": "commit"}]}