{"pr_number": 543, "pr_title": "use UUID as the name of model directory", "pr_createdAt": "2020-07-20T02:36:54Z", "pr_url": "https://github.com/pytorch/serve/pull/543", "timeline": [{"oid": "7fdb331eef23a8e347dbab9a681617af9d286182", "url": "https://github.com/pytorch/serve/commit/7fdb331eef23a8e347dbab9a681617af9d286182", "message": "use UUID as the name of model directory", "committedDate": "2020-07-20T02:17:43Z", "type": "commit"}, {"oid": "50e57c2813be378df3121bdafb4a9ed1ddadd903", "url": "https://github.com/pytorch/serve/commit/50e57c2813be378df3121bdafb4a9ed1ddadd903", "message": "fit", "committedDate": "2020-07-20T09:28:02Z", "type": "commit"}, {"oid": "16fee7b7e21630d9bf90260df2b84997d025ecc6", "url": "https://github.com/pytorch/serve/commit/16fee7b7e21630d9bf90260df2b84997d025ecc6", "message": "fit", "committedDate": "2020-07-20T09:28:27Z", "type": "commit"}, {"oid": "6eb1e6a5e9bfee2f43c3a50c4797978282e04839", "url": "https://github.com/pytorch/serve/commit/6eb1e6a5e9bfee2f43c3a50c4797978282e04839", "message": "fit", "committedDate": "2020-07-20T09:32:27Z", "type": "commit"}, {"oid": "998fd0a5cf491dde23865d387385ff2cee430af3", "url": "https://github.com/pytorch/serve/commit/998fd0a5cf491dde23865d387385ff2cee430af3", "message": "fit", "committedDate": "2020-07-20T10:03:30Z", "type": "commit"}, {"oid": "b6133488dbb6a65892ce742fd59b00f6e5065868", "url": "https://github.com/pytorch/serve/commit/b6133488dbb6a65892ce742fd59b00f6e5065868", "message": "fit", "committedDate": "2020-07-20T10:13:45Z", "type": "commit"}, {"oid": "27fe8d20df583442429322bbd84e1de526523aa0", "url": "https://github.com/pytorch/serve/commit/27fe8d20df583442429322bbd84e1de526523aa0", "message": "fit", "committedDate": "2020-07-21T01:21:46Z", "type": "commit"}, {"oid": "b7df01f64c949dd95be9eb09ca529e407893a729", "url": "https://github.com/pytorch/serve/commit/b7df01f64c949dd95be9eb09ca529e407893a729", "message": "fit", "committedDate": "2020-07-21T01:34:22Z", "type": "commit"}, {"oid": "e4647637c6f129625aacbe1dcefdd23e180bc78a", "url": "https://github.com/pytorch/serve/commit/e4647637c6f129625aacbe1dcefdd23e180bc78a", "message": "fit", "committedDate": "2020-07-21T01:37:19Z", "type": "commit"}, {"oid": "ee6600fe3d4c1c247c66236002d8b64b90a2eea9", "url": "https://github.com/pytorch/serve/commit/ee6600fe3d4c1c247c66236002d8b64b90a2eea9", "message": "fit", "committedDate": "2020-07-21T02:01:29Z", "type": "commit"}, {"oid": "34a4058027693065e8515a0833f76067b572509d", "url": "https://github.com/pytorch/serve/commit/34a4058027693065e8515a0833f76067b572509d", "message": "fit", "committedDate": "2020-07-21T02:08:42Z", "type": "commit"}, {"oid": "34116b90d171d25cb0de12e5cbcd593ace3b7b59", "url": "https://github.com/pytorch/serve/commit/34116b90d171d25cb0de12e5cbcd593ace3b7b59", "message": "fit", "committedDate": "2020-07-21T02:14:03Z", "type": "commit"}, {"oid": "ddf72d5ec394bee13f1de4952e3c567919b83d5b", "url": "https://github.com/pytorch/serve/commit/ddf72d5ec394bee13f1de4952e3c567919b83d5b", "message": "fit", "committedDate": "2020-07-21T02:22:06Z", "type": "commit"}, {"oid": "9c508c60f53401c824a64829e23b23850da86f8d", "url": "https://github.com/pytorch/serve/commit/9c508c60f53401c824a64829e23b23850da86f8d", "message": "fit", "committedDate": "2020-07-21T02:25:20Z", "type": "commit"}, {"oid": "a27f976d09d9fa29e3b6aaa3e7757a65afa30dca", "url": "https://github.com/pytorch/serve/commit/a27f976d09d9fa29e3b6aaa3e7757a65afa30dca", "message": "fit", "committedDate": "2020-07-21T02:45:41Z", "type": "commit"}, {"oid": "62f94003db6cbb1a7d4179134e3333d541af5b00", "url": "https://github.com/pytorch/serve/commit/62f94003db6cbb1a7d4179134e3333d541af5b00", "message": "fit", "committedDate": "2020-07-21T02:48:12Z", "type": "commit"}, {"oid": "735f1568d8470b6a07c432db5dfb4229b52f1581", "url": "https://github.com/pytorch/serve/commit/735f1568d8470b6a07c432db5dfb4229b52f1581", "message": "fit", "committedDate": "2020-07-21T02:55:32Z", "type": "commit"}, {"oid": "ad3a1f92e3bea303dad6b6b9ea22569ad041d7dd", "url": "https://github.com/pytorch/serve/commit/ad3a1f92e3bea303dad6b6b9ea22569ad041d7dd", "message": "fit", "committedDate": "2020-07-21T03:04:42Z", "type": "commit"}, {"oid": "e7d1d88d16b34e5585bca5dcb82e8f72c8f575f7", "url": "https://github.com/pytorch/serve/commit/e7d1d88d16b34e5585bca5dcb82e8f72c8f575f7", "message": "fit", "committedDate": "2020-07-21T03:14:41Z", "type": "commit"}, {"oid": "0b9fae276fecbe56763eb4423e5e6e5ca833df42", "url": "https://github.com/pytorch/serve/commit/0b9fae276fecbe56763eb4423e5e6e5ca833df42", "message": "fit", "committedDate": "2020-07-21T03:18:56Z", "type": "commit"}, {"oid": "3151b3e6e8c482dedd9afe21bdaa779425671b95", "url": "https://github.com/pytorch/serve/commit/3151b3e6e8c482dedd9afe21bdaa779425671b95", "message": "fit", "committedDate": "2020-07-21T03:22:06Z", "type": "commit"}, {"oid": "6aa27c2ad0e274adb86f0118a15edbc76dcd8b7c", "url": "https://github.com/pytorch/serve/commit/6aa27c2ad0e274adb86f0118a15edbc76dcd8b7c", "message": "fit", "committedDate": "2020-07-21T03:25:51Z", "type": "commit"}, {"oid": "7022173e47e53981bff64c75e2a2f15e61e8b2a5", "url": "https://github.com/pytorch/serve/commit/7022173e47e53981bff64c75e2a2f15e61e8b2a5", "message": "fit", "committedDate": "2020-07-21T03:28:53Z", "type": "commit"}, {"oid": "cf0844519f6a3e14e61067f44454b935cd7bfce2", "url": "https://github.com/pytorch/serve/commit/cf0844519f6a3e14e61067f44454b935cd7bfce2", "message": "fit:", "committedDate": "2020-07-21T03:33:26Z", "type": "commit"}, {"oid": "0d3461c31e54f9c983c559e38904c25b195c9e68", "url": "https://github.com/pytorch/serve/commit/0d3461c31e54f9c983c559e38904c25b195c9e68", "message": "Name the model file with UUID", "committedDate": "2020-07-21T03:49:03Z", "type": "commit"}, {"oid": "582b7ce729b3decf1637c4ea7e4c585fc115bb4d", "url": "https://github.com/pytorch/serve/commit/582b7ce729b3decf1637c4ea7e4c585fc115bb4d", "message": "Name model files whith UUID", "committedDate": "2020-07-21T06:18:18Z", "type": "commit"}, {"oid": "6f64c575d757511d5cf3665dd0dfe6394ecf6212", "url": "https://github.com/pytorch/serve/commit/6f64c575d757511d5cf3665dd0dfe6394ecf6212", "message": "fix", "committedDate": "2020-07-21T08:50:47Z", "type": "commit"}, {"oid": "43e334428b7e9bbca1b47951eaee910343f46810", "url": "https://github.com/pytorch/serve/commit/43e334428b7e9bbca1b47951eaee910343f46810", "message": "remove .idea files", "committedDate": "2020-07-21T09:15:40Z", "type": "commit"}, {"oid": "ca0912a3c40aee70b2452d68ba05dcd5c7229715", "url": "https://github.com/pytorch/serve/commit/ca0912a3c40aee70b2452d68ba05dcd5c7229715", "message": "delete .idea files", "committedDate": "2020-07-21T09:26:30Z", "type": "commit"}, {"oid": "3a669ce2de7294979d07ba8eaf2643232e95ead6", "url": "https://github.com/pytorch/serve/commit/3a669ce2de7294979d07ba8eaf2643232e95ead6", "message": "delete .gitignore", "committedDate": "2020-07-21T09:28:10Z", "type": "commit"}, {"oid": "f39ca7c6740f08baa65c3e3a497710fc2fc7bd79", "url": "https://github.com/pytorch/serve/commit/f39ca7c6740f08baa65c3e3a497710fc2fc7bd79", "message": "fit", "committedDate": "2020-07-21T13:41:32Z", "type": "commit"}, {"oid": "a89b2fbcb0b2ec1232705bbf34f7fd8772fbba60", "url": "https://github.com/pytorch/serve/commit/a89b2fbcb0b2ec1232705bbf34f7fd8772fbba60", "message": "fit", "committedDate": "2020-07-21T13:43:28Z", "type": "commit"}, {"oid": "33b046c3f5b4d318cfc59e24eeb884a4e2e078ff", "url": "https://github.com/pytorch/serve/commit/33b046c3f5b4d318cfc59e24eeb884a4e2e078ff", "message": "Merge branch 'master' into master", "committedDate": "2020-07-28T04:49:15Z", "type": "commit"}, {"oid": "3ff22d3172f457beeda19c9c454b819249220bf5", "url": "https://github.com/pytorch/serve/commit/3ff22d3172f457beeda19c9c454b819249220bf5", "message": "Merge branch 'master' into master", "committedDate": "2020-07-30T03:23:41Z", "type": "commit"}, {"oid": "a770a9dd10de10c4f53386e734c44f17b8845b4f", "url": "https://github.com/pytorch/serve/commit/a770a9dd10de10c4f53386e734c44f17b8845b4f", "message": "Merge branch 'master' into master", "committedDate": "2020-07-31T23:48:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1MDM5NQ==", "url": "https://github.com/pytorch/serve/pull/543#discussion_r464550395", "bodyText": "NIT: log message is not descriptive. We should probably add the model name to go along with the etag", "author": "maaquib", "createdAt": "2020-08-03T17:18:14Z", "path": "frontend/modelarchive/src/main/java/org/pytorch/serve/archive/ModelArchive.java", "diffHunk": "@@ -133,14 +133,10 @@ public static File unzip(InputStream is, String eTag) throws IOException {\n         }\n         ZipUtils.unzip(new DigestInputStream(is, md), tmp);\n         if (eTag == null) {\n-            eTag = HexUtils.toHexString(md.digest());\n+            eTag = UUID.randomUUID().toString().replaceAll(\"-\", \"\");\n         }\n+        logger.info(\"eTag {}\", eTag);", "originalCommit": "a770a9dd10de10c4f53386e734c44f17b8845b4f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDc1NDk5Nw==", "url": "https://github.com/pytorch/serve/pull/543#discussion_r464754997", "bodyText": "I printed the model name and this is the log.\nTorchServeSuite > TorchServe > org.pytorch.serve.ModelServerTest > testLoadModelWithInitialWorkersWithJSONReqBody STANDARD_OUT\n2020-08-04 01:41:03,788 [DEBUG] nioEventLoopGroup-3-4 org.pytorch.serve.wlm.ModelVersionedRefs - Removed model: noop version: 1.11\n2020-08-04 01:41:03,794 [INFO ] nioEventLoopGroup-3-4 org.pytorch.serve.wlm.ModelManager - Model noop unregistered.\n2020-08-04 01:41:03,795 [INFO ] nioEventLoopGroup-3-4 ACCESS_LOG - /127.0.0.1:63658 \"DELETE /models/noop HTTP/1.1\" 200 7\n2020-08-04 01:41:03,795 [INFO ] nioEventLoopGroup-3-4 TS_METRICS - Requests2XX.Count:1|#Level:Host|#hostname:czhong03,timestamp:null\n2020-08-04 01:41:03,799 [INFO ] nioEventLoopGroup-3-4 org.pytorch.serve.wlm.ModelManager - modelName : noop\n2020-08-04 01:41:03,799 [INFO ] nioEventLoopGroup-3-4 org.pytorch.serve.archive.ModelArchive - marFileName : noop.mar\n2020-08-04 01:41:03,805 [INFO ] nioEventLoopGroup-3-4 org.pytorch.serve.archive.ModelArchive - model folder already exists: 29385dfc880480adb4ff8a26d9461d72539fb887\n2020-08-04 01:41:03,806 [INFO ] nioEventLoopGroup-3-4 ACCESS_LOG - /127.0.0.1:63658 \"POST /models HTTP/1.1\" 400 8\n2020-08-04 01:41:03,806 [INFO ] nioEventLoopGroup-3-4 TS_METRICS - Requests4XX.Count:1|#Level:Host|#hostname:czhong03,timestamp:null\nTorchServeSuite > TorchServe > org.pytorch.serve.ModelServerTest > testLoadModelWithInitialWorkersWithJSONReqBody FAILED\njava.lang.AssertionError at ModelServerTest.java:317", "author": "MengMeng96", "createdAt": "2020-08-04T02:01:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1MDM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIxODgzNQ==", "url": "https://github.com/pytorch/serve/pull/543#discussion_r465218835", "bodyText": "./torchserve_sanity.sh | grep --line-buffered eTag\n+ source scripts/install_utils\n++ set -euo pipefail\n+ set +u\n+ install_torch_deps\n+ '[' is_gpu_instance ']'\n+ '[' '' == cuda101 ']'\n+ pip install -U -r requirements.txt\n+ set -u\n+ install_pytest_suite_deps\n+ pip install -U -r requirements/developer.txt\n+ install_bert_dependencies\n+ pip install transformers\n+ run_backend_pytest\n+ python -m pytest --cov-report html:htmlcov --cov=ts/ ts/tests/unit_tests/\n+ echo 'Backend test suite execution successful'\n+ build_frontend\n+ frontend/gradlew -p frontend clean build\n    2020-08-04 17:38:35,334 [INFO ] Test worker org.pytorch.serve.archive.ModelArchive - eTag 8652c3fcf1494865a7fb5126afc74e4a\n    2020-08-04 17:38:36,527 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag cd453c8393b2476db54af1f3d544ec39\n    2020-08-04 17:38:36,650 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag a9cf7eae14db4aa99da3e3238287adb6\n    2020-08-04 17:38:36,748 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag 254257fef1704f879291a0383bf132e0\n    2020-08-04 17:38:36,844 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag fbd18c2405d24ea18e188f4ffef89909\n    2020-08-04 17:38:36,971 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag eb7bba80a9394835b36a31d0e70fe5bc\n    2020-08-04 17:38:37,080 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag fd300918ceb14fddbc29358aad5db14d\n    2020-08-04 17:38:37,180 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag 3d5f0fcf085e4934bed16e8bda5f6b7c\n    2020-08-04 17:38:37,975 [INFO ] epollEventLoopGroup-3-2 org.pytorch.serve.archive.ModelArchive - eTag 23c3f2c81fd74e13b698e786be192b92", "author": "maaquib", "createdAt": "2020-08-04T17:39:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1MDM5NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTU1MjUyNw==", "url": "https://github.com/pytorch/serve/pull/543#discussion_r465552527", "bodyText": "NIT: log message is not descriptive. We should probably add the model name to go along with the etag\n\nmodel name doesn't passed to function ModelArchive.unzip() nor function ModelArchive.downloadModel(String modelStore, String url), so add the model name to go along with the etag need to change all the functions that us them. And use UUID is an easier and better way to distinguish these files.\nWhen I run frontend/gradlew.bat -p frontend clean build on Windows 10, there are 3 test cases using the same eTag 29385dfc880480adb4ff8a26d9461d72539fb887, here is the log https://paste.ubuntu.com/p/sBjJmnWDSv/", "author": "MengMeng96", "createdAt": "2020-08-05T08:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDU1MDM5NQ=="}], "type": "inlineReview"}, {"oid": "1a47ecef9170b43119ff1f34c024bfb0ee0f41ea", "url": "https://github.com/pytorch/serve/commit/1a47ecef9170b43119ff1f34c024bfb0ee0f41ea", "message": "Merge branch 'master' into master", "committedDate": "2020-08-04T02:06:23Z", "type": "commit"}, {"oid": "6d4197690a735b704452b54a58674565b626155f", "url": "https://github.com/pytorch/serve/commit/6d4197690a735b704452b54a58674565b626155f", "message": "Merge branch 'master' into master", "committedDate": "2020-08-06T15:49:58Z", "type": "commit"}]}