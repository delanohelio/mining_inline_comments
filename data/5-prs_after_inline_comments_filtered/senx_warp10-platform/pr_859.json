{"pr_number": 859, "pr_title": "Improve log management", "pr_createdAt": "2020-10-09T16:37:42Z", "pr_url": "https://github.com/senx/warp10-platform/pull/859", "timeline": [{"oid": "57838bac07d064ee4e53d78e5734d2f02165a167", "url": "https://github.com/senx/warp10-platform/commit/57838bac07d064ee4e53d78e5734d2f02165a167", "message": "Improve log management", "committedDate": "2020-10-09T16:36:15Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MjUxMw==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r502882513", "bodyText": "Not sure this is a good idea, there might be many failures which could clog the logs.", "author": "hbs", "createdAt": "2020-10-11T08:13:46Z", "path": "warp10/src/main/java/io/warp10/standalone/StandaloneScriptRunner.java", "diffHunk": "@@ -226,7 +226,8 @@ public void run() {\n             m.appendTail(mc2WithReplacement);\n               \n             stack.execMulti(mc2WithReplacement.toString());\n-          } catch (Exception e) {                \n+          } catch (Exception e) {\n+            e.printStackTrace(System.err);", "originalCommit": "57838bac07d064ee4e53d78e5734d2f02165a167", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxOTk4Mg==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r503319982", "bodyText": "Yes, It could generate a lot of logs but we don't have any info on a failed runner. Is there a better way?", "author": "steven-gueguen", "createdAt": "2020-10-12T14:05:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MjUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzQ4NDg3NQ==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r503484875", "bodyText": "The metrics warp.script.run.failures is there to track the number of failures per script", "author": "hbs", "createdAt": "2020-10-12T19:14:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MjUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MjkyOA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r502882928", "bodyText": "indent should be 2 not 4", "author": "hbs", "createdAt": "2020-10-11T08:17:55Z", "path": "warp10/src/main/java/io/warp10/standalone/Warp.java", "diffHunk": "@@ -76,81 +76,80 @@\n \n public class Warp extends WarpDist implements Runnable {\n \n+  private static final Logger LOG = LoggerFactory.getLogger(Warp.class);\n+\n   private static final String DEFAULT_THREADPOOL_SIZE = \"200\";\n-  \n+\n   private static final String DEFAULT_HTTP_ACCEPTORS = \"2\";\n   private static final String DEFAULT_HTTP_SELECTORS = \"4\";\n-  \n+\n   private static final String NULL = \"null\";\n-        \n+\n   private static WarpDB db;\n-  \n+\n   private static boolean standaloneMode = false;\n-  \n+\n   private static int port;\n-  \n+\n   private static String host;\n-  \n-  private static Set<Path> datalogSrcDirs = Collections.unmodifiableSet(new HashSet<Path>()); \n-  \n+\n+  private static Set<Path> datalogSrcDirs = Collections.unmodifiableSet(new HashSet<Path>());\n+\n   private static final String[] REQUIRED_PROPERTIES = {\n-    Configuration.INGRESS_WEBSOCKET_MAXMESSAGESIZE,\n-    Configuration.PLASMA_FRONTEND_WEBSOCKET_MAXMESSAGESIZE,\n-    Configuration.WARP_HASH_CLASS,\n-    Configuration.WARP_HASH_LABELS,\n-    Configuration.WARP_HASH_TOKEN,\n-    Configuration.WARP_HASH_APP,\n-    Configuration.WARP_AES_TOKEN,\n-    Configuration.WARP_AES_SCRIPTS,\n-    Configuration.CONFIG_WARPSCRIPT_UPDATE_ENDPOINT,\n-    Configuration.CONFIG_WARPSCRIPT_META_ENDPOINT,\n-    Configuration.WARP_TIME_UNITS,\n+      Configuration.INGRESS_WEBSOCKET_MAXMESSAGESIZE,", "originalCommit": "57838bac07d064ee4e53d78e5734d2f02165a167", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxOTc4OQ==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r503319789", "bodyText": "Done", "author": "steven-gueguen", "createdAt": "2020-10-12T14:05:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MjkyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MzAxMA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r502883010", "bodyText": "The banner is not intended to be a log message, it should be output to stdout no matter what. Add an info message with the revision and a simple text.", "author": "hbs", "createdAt": "2020-10-11T08:19:04Z", "path": "warp10/src/main/java/io/warp10/standalone/Warp.java", "diffHunk": "@@ -76,81 +76,80 @@\n \n public class Warp extends WarpDist implements Runnable {\n \n+  private static final Logger LOG = LoggerFactory.getLogger(Warp.class);\n+\n   private static final String DEFAULT_THREADPOOL_SIZE = \"200\";\n-  \n+\n   private static final String DEFAULT_HTTP_ACCEPTORS = \"2\";\n   private static final String DEFAULT_HTTP_SELECTORS = \"4\";\n-  \n+\n   private static final String NULL = \"null\";\n-        \n+\n   private static WarpDB db;\n-  \n+\n   private static boolean standaloneMode = false;\n-  \n+\n   private static int port;\n-  \n+\n   private static String host;\n-  \n-  private static Set<Path> datalogSrcDirs = Collections.unmodifiableSet(new HashSet<Path>()); \n-  \n+\n+  private static Set<Path> datalogSrcDirs = Collections.unmodifiableSet(new HashSet<Path>());\n+\n   private static final String[] REQUIRED_PROPERTIES = {\n-    Configuration.INGRESS_WEBSOCKET_MAXMESSAGESIZE,\n-    Configuration.PLASMA_FRONTEND_WEBSOCKET_MAXMESSAGESIZE,\n-    Configuration.WARP_HASH_CLASS,\n-    Configuration.WARP_HASH_LABELS,\n-    Configuration.WARP_HASH_TOKEN,\n-    Configuration.WARP_HASH_APP,\n-    Configuration.WARP_AES_TOKEN,\n-    Configuration.WARP_AES_SCRIPTS,\n-    Configuration.CONFIG_WARPSCRIPT_UPDATE_ENDPOINT,\n-    Configuration.CONFIG_WARPSCRIPT_META_ENDPOINT,\n-    Configuration.WARP_TIME_UNITS,\n+      Configuration.INGRESS_WEBSOCKET_MAXMESSAGESIZE,\n+      Configuration.PLASMA_FRONTEND_WEBSOCKET_MAXMESSAGESIZE,\n+      Configuration.WARP_HASH_CLASS,\n+      Configuration.WARP_HASH_LABELS,\n+      Configuration.WARP_HASH_TOKEN,\n+      Configuration.WARP_HASH_APP,\n+      Configuration.WARP_AES_TOKEN,\n+      Configuration.WARP_AES_SCRIPTS,\n+      Configuration.CONFIG_WARPSCRIPT_UPDATE_ENDPOINT,\n+      Configuration.CONFIG_WARPSCRIPT_META_ENDPOINT,\n+      Configuration.WARP_TIME_UNITS,\n   };\n-  \n+\n   public Warp() {\n     // TODO Auto-generated constructor stub\n   }\n-  \n+\n   public static void main(String[] args) throws Exception {\n     // Indicate standalone mode is on\n     standaloneMode = true;\n \n     System.setProperty(\"java.awt.headless\", \"true\");\n-    \n-    System.out.println();\n-    System.out.println(Constants.WARP10_BANNER);\n-    System.out.println(\"  Revision \" + Revision.REVISION);\n-    System.out.println();\n+\n+    LOG.info(\"\\n\" + Constants.WARP10_BANNER + \"\\n\" + \"  Revision \" + Revision.REVISION + \"\\n\");", "originalCommit": "57838bac07d064ee4e53d78e5734d2f02165a167", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzMxOTc1MA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r503319750", "bodyText": "Ok, revert it.\nAs stdout is redirected to the log file, it will be present is the warp10.log", "author": "steven-gueguen", "createdAt": "2020-10-12T14:05:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjg4MzAxMA=="}], "type": "inlineReview"}, {"oid": "d3b84c7ad1c8bf78113ae131d1b95c2905e1696f", "url": "https://github.com/senx/warp10-platform/commit/d3b84c7ad1c8bf78113ae131d1b95c2905e1696f", "message": "Address PR comments", "committedDate": "2020-10-13T08:57:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1OTA2NQ==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504459065", "bodyText": "Why is this in this PR?", "author": "hbs", "createdAt": "2020-10-14T07:28:12Z", "path": "token/src/test/java/io/warp10/token/test/TestWriteToken.java", "diffHunk": "@@ -115,7 +115,7 @@ public void testTokenExpired() throws TException, InterruptedException {\n \n     final QuasarTokenFilter tokenFilter = new QuasarTokenFilter(getConfig(), getKeyStore());\n \n-    Thread.sleep(1);\n+    Thread.sleep(2);", "originalCommit": "d3b84c7ad1c8bf78113ae131d1b95c2905e1696f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUxODIzNA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504518234", "bodyText": "The test no longer passed. Now it's ok -> revert", "author": "steven-gueguen", "createdAt": "2020-10-14T09:02:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1OTA2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1OTU0MA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504459540", "bodyText": "Change copyright notice to 2018-2020", "author": "hbs", "createdAt": "2020-10-14T07:28:59Z", "path": "warp10/src/main/java/io/warp10/plugins/tcp/TCPWarp10Plugin.java", "diffHunk": "@@ -175,7 +175,7 @@ public void init(Properties properties) {\n       @Override\n       public void run() {\n         done = true;\n-        System.out.println(\"TCP Plugin shutting down all managers.\");\n+        LOG.info(\"TCP Plugin shutting down all managers.\");", "originalCommit": "d3b84c7ad1c8bf78113ae131d1b95c2905e1696f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUxODM1Ng==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504518356", "bodyText": "done", "author": "steven-gueguen", "createdAt": "2020-10-14T09:02:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1OTU0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1OTY4Mg==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504459682", "bodyText": "Change copyright notice to 2018-2020", "author": "hbs", "createdAt": "2020-10-14T07:29:13Z", "path": "warp10/src/main/java/io/warp10/plugins/udp/UDPWarp10Plugin.java", "diffHunk": "@@ -16,6 +16,7 @@\n package io.warp10.plugins.udp;\n \n import io.warp10.warp.sdk.AbstractWarp10Plugin;\n+", "originalCommit": "d3b84c7ad1c8bf78113ae131d1b95c2905e1696f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUxODQzMA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504518430", "bodyText": "done", "author": "steven-gueguen", "createdAt": "2020-10-14T09:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ1OTY4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ2MDI3Ng==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504460276", "bodyText": "Change copyright notice to 2018-2020", "author": "hbs", "createdAt": "2020-10-14T07:30:13Z", "path": "warp10/src/main/java/io/warp10/standalone/StandaloneScriptRunner.java", "diffHunk": "@@ -25,14 +25,14 @@\n import java.util.HashMap;\n import java.util.Map;\n import java.util.Properties;\n-import java.util.Random;\n import java.util.UUID;\n import java.util.concurrent.RejectedExecutionException;\n import java.util.concurrent.atomic.AtomicLong;\n import java.util.regex.Matcher;\n import java.util.regex.Pattern;\n \n import com.geoxp.oss.CryptoHelper;\n+", "originalCommit": "d3b84c7ad1c8bf78113ae131d1b95c2905e1696f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDUxODYyNA==", "url": "https://github.com/senx/warp10-platform/pull/859#discussion_r504518624", "bodyText": "done", "author": "steven-gueguen", "createdAt": "2020-10-14T09:03:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDQ2MDI3Ng=="}], "type": "inlineReview"}, {"oid": "198b072fbf1f3851e6bd3ce34a80f0cfc09c0ab5", "url": "https://github.com/senx/warp10-platform/commit/198b072fbf1f3851e6bd3ce34a80f0cfc09c0ab5", "message": "Merge branch 'master' of github.com:senx/warp10-platform into manage-logs", "committedDate": "2020-10-14T08:48:24Z", "type": "commit"}, {"oid": "2abd63237baa19ec614949630565400e0f1c988d", "url": "https://github.com/senx/warp10-platform/commit/2abd63237baa19ec614949630565400e0f1c988d", "message": "Change copyright", "committedDate": "2020-10-14T09:03:12Z", "type": "commit"}]}