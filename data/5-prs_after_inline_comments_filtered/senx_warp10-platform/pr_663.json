{"pr_number": 663, "pr_title": "GEO.UNION and GEO.INTESERCTION to take a list of shapes.", "pr_createdAt": "2020-02-10T15:08:46Z", "pr_url": "https://github.com/senx/warp10-platform/pull/663", "timeline": [{"oid": "92033386b6c2ca836321969ebb5de8225c5fa161", "url": "https://github.com/senx/warp10-platform/commit/92033386b6c2ca836321969ebb5de8225c5fa161", "message": "GEO.UNION and GEO.INTESERCTION to take a list of shapes.", "committedDate": "2020-02-10T15:07:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUyNDg0Nw==", "url": "https://github.com/senx/warp10-platform/pull/663#discussion_r377524847", "bodyText": "simply cast element", "author": "hbs", "createdAt": "2020-02-11T09:39:46Z", "path": "warp10/src/main/java/io/warp10/script/functions/GeoIntersection.java", "diffHunk": "@@ -35,19 +37,40 @@ public GeoIntersection(String name) {\n   \n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n-    Object a = stack.pop();\n-    Object b = stack.pop();\n-    \n-    if (!(a instanceof GeoXPShape) || !(b instanceof GeoXPShape)) {\n-      throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack.\");\n+    Object top = stack.pop();\n+\n+    if (top instanceof List) {\n+      List list = (List) top;\n+      if (list.isEmpty()) {\n+        stack.push(GeoXPLib.fromCells(new long[] {}, false));\n+      } else {\n+        Object element = list.get(0);\n+        if (!(element instanceof GeoXPShape)) {\n+          throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+        }\n+        GeoXPShape shape = (GeoXPShape) element;\n+        for (int i = 1; i < list.size(); i++) {\n+          element = list.get(i);\n+          if (!(element instanceof GeoXPShape)) {\n+            throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+          }\n+          shape = GeoXPLib.intersection(shape, (GeoXPShape) list.get(i));", "originalCommit": "92033386b6c2ca836321969ebb5de8225c5fa161", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NzUyNTI0Mw==", "url": "https://github.com/senx/warp10-platform/pull/663#discussion_r377525243", "bodyText": "simply cast element", "author": "hbs", "createdAt": "2020-02-11T09:40:32Z", "path": "warp10/src/main/java/io/warp10/script/functions/GeoUnion.java", "diffHunk": "@@ -16,38 +16,60 @@\n \n package io.warp10.script.functions;\n \n+import com.geoxp.GeoXPLib;\n+import com.geoxp.GeoXPLib.GeoXPShape;\n import io.warp10.script.NamedWarpScriptFunction;\n-import io.warp10.script.WarpScriptStackFunction;\n import io.warp10.script.WarpScriptException;\n import io.warp10.script.WarpScriptStack;\n+import io.warp10.script.WarpScriptStackFunction;\n \n-import com.geoxp.GeoXPLib;\n-import com.geoxp.GeoXPLib.GeoXPShape;\n+import java.util.List;\n \n /**\n  * Computes the union of two GeoXPShape\n  */\n public class GeoUnion extends NamedWarpScriptFunction implements WarpScriptStackFunction {\n-  \n+\n   public GeoUnion(String name) {\n     super(name);\n   }\n-  \n+\n   @Override\n   public Object apply(WarpScriptStack stack) throws WarpScriptException {\n-    Object a = stack.pop();\n-    Object b = stack.pop();\n-    \n-    if (!(a instanceof GeoXPShape) || !(b instanceof GeoXPShape)) {\n-      throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack.\");\n+    Object top = stack.pop();\n+\n+    if (top instanceof List) {\n+      List list = (List) top;\n+      if (list.isEmpty()) {\n+        stack.push(GeoXPLib.fromCells(new long[] {}, false));\n+      } else {\n+        Object element = list.get(0);\n+        if (!(element instanceof GeoXPShape)) {\n+          throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+        }\n+        GeoXPShape shape = (GeoXPShape) element;\n+        for (int i = 1; i < list.size(); i++) {\n+          element = list.get(i);\n+          if (!(element instanceof GeoXPShape)) {\n+            throw new WarpScriptException(getName() + \" expects two GeoShape instances as the top 2 elements of the stack or a list of GeoShape instances.\");\n+          }\n+          shape = GeoXPLib.union(shape, (GeoXPShape) list.get(i));", "originalCommit": "92033386b6c2ca836321969ebb5de8225c5fa161", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "53908d49204e2c32ef485033841a854185eaa03e", "url": "https://github.com/senx/warp10-platform/commit/53908d49204e2c32ef485033841a854185eaa03e", "message": "Use already existing var instead of getting the value again in the list", "committedDate": "2020-02-11T10:05:36Z", "type": "commit"}]}