{"pr_number": 773, "pr_title": "Initial commit of GEO.BUFFER", "pr_createdAt": "2020-06-06T14:32:46Z", "pr_url": "https://github.com/senx/warp10-platform/pull/773", "timeline": [{"oid": "bad1184e6dd9246524079806e58e98ea66c2422c", "url": "https://github.com/senx/warp10-platform/commit/bad1184e6dd9246524079806e58e98ea66c2422c", "message": "Initial commit of GEO.BUFFER", "committedDate": "2020-06-06T14:32:16Z", "type": "commit"}, {"oid": "d0d71ab32be1bf7551354debec4902996d9b853e", "url": "https://github.com/senx/warp10-platform/commit/d0d71ab32be1bf7551354debec4902996d9b853e", "message": "Added support for expressing distance in meters", "committedDate": "2020-06-07T06:31:53Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU5MzI2Nw==", "url": "https://github.com/senx/warp10-platform/pull/773#discussion_r436593267", "bodyText": "If find this kind of hacky, I'd prefer to have a dedicated function to apply the buffer and output a WKT.\nOther solution: I was planning to modify ->GEOJSON and introduce ->WKT as well as ->WKB to convert between formats, maybe it would be a good place to add this logic?", "author": "ftence", "createdAt": "2020-06-08T10:16:30Z", "path": "warp10/src/main/java/io/warp10/script/functions/GeoJSON.java", "diffHunk": "@@ -67,6 +72,23 @@ public Object apply(WarpScriptStack stack) throws WarpScriptException {\n       throw new WarpScriptException(uoe);\n     }\n \n+    //\n+    // Apply buffer if defined\n+    //\n+    Map<Object,Object> buffer = (Map<Object,Object>) stack.getAttribute(GEOBUFFER.ATTR_GEOBUFFER);\n+    \n+    if (null != buffer) {\n+      // Clear the buffer\n+      stack.setAttribute(GEOBUFFER.ATTR_GEOBUFFER, null);\n+      // Apply the buffer operation\n+      BufferOp bop = new BufferOp(geometry, (BufferParameters) buffer.get(GEOBUFFER.KEY_PARAMS));\n+      geometry = bop.getResultGeometry(((Double) buffer.get(GEOBUFFER.KEY_DIST)).doubleValue());\n+      if (Boolean.TRUE.equals(buffer.get(GEOBUFFER.KEY_WKT))) {\n+        stack.push(geometry.toText());\n+        return stack;\n+      }", "originalCommit": "d0d71ab32be1bf7551354debec4902996d9b853e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjYzMzU5Mw==", "url": "https://github.com/senx/warp10-platform/pull/773#discussion_r436633593", "bodyText": "Hackyness is a way of life :-)\nHow about we change the behavior of GEO.BUFFER so if the 'wkt', 'wkb' or 'geojson' key is present in its input parameters then the buffer is added to the value associated with the key and output instead of configuring the buffer for the next GEO.WKT/GEO.WKB/GEO.GEOJSON call?", "author": "hbs", "createdAt": "2020-06-08T11:42:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU5MzI2Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjkxNzk2MA==", "url": "https://github.com/senx/warp10-platform/pull/773#discussion_r436917960", "bodyText": "Good idea!", "author": "ftence", "createdAt": "2020-06-08T18:45:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNjU5MzI2Nw=="}], "type": "inlineReview"}, {"oid": "185c67032c654ca1631301ba4bb20c03674ef196", "url": "https://github.com/senx/warp10-platform/commit/185c67032c654ca1631301ba4bb20c03674ef196", "message": "Addressed PR comments", "committedDate": "2020-06-08T20:08:22Z", "type": "commit"}]}