{"pr_number": 690, "pr_title": "Adds activeafter/quietafter params to /delete requests and a metaonly option", "pr_createdAt": "2020-03-10T09:25:26Z", "pr_url": "https://github.com/senx/warp10-platform/pull/690", "timeline": [{"oid": "b5d0f9b05bd5fcb3686a7f70517964c9f2e1e18d", "url": "https://github.com/senx/warp10-platform/commit/b5d0f9b05bd5fcb3686a7f70517964c9f2e1e18d", "message": "Initial commit. Delete options initially for Warp 10 Accelerator, extended for all deletes", "committedDate": "2020-03-07T17:29:38Z", "type": "commit"}, {"oid": "628e0237367f3e7e32d072d099fc96e5e2f54ff8", "url": "https://github.com/senx/warp10-platform/commit/628e0237367f3e7e32d072d099fc96e5e2f54ff8", "message": "Disabled data deletes when nodata is true", "committedDate": "2020-03-08T09:52:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI4ODUwMA==", "url": "https://github.com/senx/warp10-platform/pull/690#discussion_r390288500", "bodyText": "I would propose deletemeta as HTTP parameter here instead of \"nodata\". IMO, this would made more sence for a user", "author": "aurrelhebert", "createdAt": "2020-03-10T12:49:07Z", "path": "warp10/src/main/java/io/warp10/continuum/store/Constants.java", "diffHunk": "@@ -376,6 +376,7 @@\n   public static final String HTTP_PARAM_SAMPLE = \"sample\";\n   public static final String HTTP_PARAM_PREBOUNDARY = \"boundary.pre\";\n   public static final String HTTP_PARAM_POSTBOUNDARY = \"boundary.post\";\n+  public static final String HTTP_PARAM_NODATA = \"nodata\";", "originalCommit": "628e0237367f3e7e32d072d099fc96e5e2f54ff8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDQ0NjU2OA==", "url": "https://github.com/senx/warp10-platform/pull/690#discussion_r390446568", "bodyText": "Renamed 'metaonly', 'deletemeta' could incorrectly lead users to think that 'deleteall' is related.", "author": "hbs", "createdAt": "2020-03-10T16:29:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI4ODUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDI4OTk4MQ==", "url": "https://github.com/senx/warp10-platform/pull/690#discussion_r390289981", "bodyText": "When the nodata (or deletemeta) option is set, we should consider it's correspond to a deleteallcall and not throw this error.", "author": "aurrelhebert", "createdAt": "2020-03-10T12:51:44Z", "path": "warp10/src/main/java/io/warp10/continuum/ingress/Ingress.java", "diffHunk": "@@ -1545,6 +1545,22 @@ public void handleDelete(String target, Request baseRequest, HttpServletRequest\n         throw new IOException(\"Parameter \" + Constants.HTTP_PARAM_DELETEALL + \" should be set when deleting a full range.\");", "originalCommit": "628e0237367f3e7e32d072d099fc96e5e2f54ff8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "437de51fcd1bfe57c27d344106f1e1aa9da9d582", "url": "https://github.com/senx/warp10-platform/commit/437de51fcd1bfe57c27d344106f1e1aa9da9d582", "message": "Addressed PR comments", "committedDate": "2020-03-10T16:31:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY1MTQ5Mg==", "url": "https://github.com/senx/warp10-platform/pull/690#discussion_r395651492", "bodyText": "Not related to these lines but does the same test has to be applied in the finally?\nAlso in the finally, if metaonly, completeDeletion should not be checked.", "author": "ftence", "createdAt": "2020-03-20T13:54:38Z", "path": "warp10/src/main/java/io/warp10/continuum/ingress/Ingress.java", "diffHunk": "@@ -1772,7 +1807,10 @@ public void close() throws Exception {\n                   continue;\n                 }\n               }\n-              pushDeleteMessage(start, end, minage, metadata);\n+              \n+              if (!metaonly) {\n+                pushDeleteMessage(start, end, minage, metadata);\n+              }", "originalCommit": "437de51fcd1bfe57c27d344106f1e1aa9da9d582", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY3OTYzNQ==", "url": "https://github.com/senx/warp10-platform/pull/690#discussion_r395679635", "bodyText": "It does not change much as the pushDeleteMessages in the finally clause simply flushes unsent messages, but I added a conditional. For completeDeletion, it will be set to true when metaonly is specified so the code within the conditional will be called.", "author": "hbs", "createdAt": "2020-03-20T14:37:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTY1MTQ5Mg=="}], "type": "inlineReview"}, {"oid": "ca17be5959a7da75ee4986d3ac39e8d61f396bd4", "url": "https://github.com/senx/warp10-platform/commit/ca17be5959a7da75ee4986d3ac39e8d61f396bd4", "message": "Avoid calling pushDeleteMessage when metaonly is set", "committedDate": "2020-03-20T14:34:00Z", "type": "commit"}]}