{"pr_number": 7765, "pr_title": "warcraft air transport issue", "pr_createdAt": "2020-09-26T00:52:02Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7765", "timeline": [{"oid": "211729d3ac69fa49c97d8341ce4c5ae8d5495dfe", "url": "https://github.com/triplea-game/triplea/commit/211729d3ac69fa49c97d8341ce4c5ae8d5495dfe", "message": "Inline deprecated method and remove commented lines", "committedDate": "2020-09-26T00:47:10Z", "type": "commit"}, {"oid": "0c07f34a3975e9c54dd7465100cd3c6e1e8840b1", "url": "https://github.com/triplea-game/triplea/commit/0c07f34a3975e9c54dd7465100cd3c6e1e8840b1", "message": "Remove old getTransporting check that now does the same thing as getTransportedBy", "committedDate": "2020-09-26T00:47:10Z", "type": "commit"}, {"oid": "f8c784cb2667afa78702c8716ed582416572bbb0", "url": "https://github.com/triplea-game/triplea/commit/f8c784cb2667afa78702c8716ed582416572bbb0", "message": "Remove transported units from AA fire", "committedDate": "2020-09-26T00:47:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM1MTU2Mw==", "url": "https://github.com/triplea-game/triplea/pull/7765#discussion_r495351563", "bodyText": "This method was only used in one place so I just inlined it.", "author": "trevan", "createdAt": "2020-09-26T00:52:27Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/TransportTracker.java", "diffHunk": "@@ -48,16 +48,6 @@ private static void assertTransport(final Unit u) {\n     return transport.getTransporting();\n   }\n \n-  /**\n-   * @return Unmodifiable collection of units that the given transport is transporting.\n-   * @deprecated Invoke unit.getTransporting(Collection) directly\n-   */\n-  @Deprecated\n-  public static List<Unit> transporting(", "originalCommit": "f8c784cb2667afa78702c8716ed582416572bbb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM1MTY2NA==", "url": "https://github.com/triplea-game/triplea/pull/7765#discussion_r495351664", "bodyText": "This is the actual fix.", "author": "trevan", "createdAt": "2020-09-26T00:52:39Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/FireAa.java", "diffHunk": "@@ -78,7 +78,9 @@\n       final List<Unit> allEnemyUnitsAliveOrWaitingToDie,\n       final List<String> aaTypes) {\n     this.attackableUnits =\n-        CollectionUtils.getMatches(attackableUnits, Matches.unitIsNotInfrastructure());\n+        CollectionUtils.getMatches(\n+            attackableUnits,\n+            Matches.unitIsNotInfrastructure().and(Matches.unitIsBeingTransported().negate()));", "originalCommit": "f8c784cb2667afa78702c8716ed582416572bbb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTM1Mzk0NA==", "url": "https://github.com/triplea-game/triplea/pull/7765#discussion_r495353944", "bodyText": "This is the exception being thrown.  I removed it because it really is red-herring.  The code transport.getTransporting() goes through all the territories on the map to find the one territory that has the transport.  It then loops through all of the units in that territory and finds all the units that have Unit#getTransportedBy equal to the transport.  And then, this method just checks if the unit is in that list.\nBut if you look a few lines up (line 127), it grabbed the transport by calling Unit#getTransportedBy.  So transport.getTransporting().contains(unit) will always return true except for the odd situation of when the unit and its transporter are in different territories.  And in this case, the unit wasn't in any territory because it had been removed.\nThis check was originally added when transports kept a list of the units they were transporting and back then this check made sense.  But transports have changed and it now is redundant.", "author": "trevan", "createdAt": "2020-09-26T00:58:15Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/TransportTracker.java", "diffHunk": "@@ -139,17 +129,10 @@ public static Change unloadAirTransportChange(\n       return change;\n     }\n     assertTransport(transport);\n-    if (!transport.getTransporting().contains(unit)) {\n-      throw new IllegalStateException(\n-          \"Not being carried, unit:\" + unit + \" transport:\" + transport);", "originalCommit": "f8c784cb2667afa78702c8716ed582416572bbb0", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}