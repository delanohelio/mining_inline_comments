{"pr_number": 8349, "pr_title": "Add a clear casualty step for naval bombardment", "pr_createdAt": "2020-12-05T16:01:59Z", "pr_url": "https://github.com/triplea-game/triplea/pull/8349", "timeline": [{"oid": "2213f5866e8c5359202995cf490e3f06c5164b6a", "url": "https://github.com/triplea-game/triplea/commit/2213f5866e8c5359202995cf490e3f06c5164b6a", "message": "Add a clear casualty step for naval bombardment\n\nAll of the other battle parts (aa, sub, other) use a casualty removal\nstep to remove casualties that have been hit. This updates the\nbombardment to also have its own casualty removal step for the case\nwhere the map doesn't allow naval bombardment casualties to fire back.", "committedDate": "2020-12-05T15:57:48Z", "type": "commit"}, {"oid": "c5637446fc28c683fc6555b5bd515de0787ef5da", "url": "https://github.com/triplea-game/triplea/commit/c5637446fc28c683fc6555b5bd515de0787ef5da", "message": "Only add the clear bombardment step if bombarding is happening", "committedDate": "2020-12-05T16:14:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk3MDI4OQ==", "url": "https://github.com/triplea-game/triplea/pull/8349#discussion_r536970289", "bodyText": "nit, valid could be more descriptive. When reading the usage, I wondered \"what is valid?\"\nSome rename suggestions:\n\n\"isBombardmentRound\"\n\"bombardmentOccurred\"\n\"bombardUnitsWillFire\"\n\nSide-note, I wonder if it would make sense to create a BombardmentRules object so we can centralize logic like this, where we have one source  to detect, when/how/if bombardment should occur.", "author": "DanVanAtta", "createdAt": "2020-12-06T06:39:04Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/steps/change/ClearBombardmentCasualties.java", "diffHunk": "@@ -0,0 +1,49 @@\n+package games.strategy.triplea.delegate.battle.steps.change;\n+\n+import static games.strategy.triplea.delegate.battle.BattleStepStrings.REMOVE_BOMBARDMENT_CASUALTIES;\n+\n+import games.strategy.engine.delegate.IDelegateBridge;\n+import games.strategy.triplea.Properties;\n+import games.strategy.triplea.delegate.ExecutionStack;\n+import games.strategy.triplea.delegate.battle.BattleActions;\n+import games.strategy.triplea.delegate.battle.BattleState;\n+import games.strategy.triplea.delegate.battle.steps.BattleStep;\n+import java.util.List;\n+import lombok.AllArgsConstructor;\n+\n+@AllArgsConstructor\n+public class ClearBombardmentCasualties implements BattleStep {\n+  private static final long serialVersionUID = -5723287846470464298L;\n+\n+  private final BattleState battleState;\n+\n+  private final BattleActions battleActions;\n+\n+  @Override\n+  public List<String> getNames() {\n+    return valid() && clearCasualties() ? List.of(REMOVE_BOMBARDMENT_CASUALTIES) : List.of();\n+  }\n+\n+  @Override\n+  public BattleStep.Order getOrder() {\n+    return Order.NAVAL_BOMBARDMENT_REMOVE_CASUALTIES;\n+  }\n+\n+  @Override\n+  public void execute(final ExecutionStack stack, final IDelegateBridge bridge) {\n+    if (valid() && clearCasualties()) {\n+      battleActions.clearWaitingToDieAndDamagedChangesInto(bridge);\n+    }\n+  }\n+\n+  private boolean clearCasualties() {\n+    return !Properties.getNavalBombardCasualtiesReturnFire(\n+        battleState.getGameData().getProperties());\n+  }\n+\n+  private boolean valid() {", "originalCommit": "c5637446fc28c683fc6555b5bd515de0787ef5da", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzEyNTMxNA==", "url": "https://github.com/triplea-game/triplea/pull/8349#discussion_r537125314", "bodyText": "I just wrote my thoughts on how to centralize the logic using the game XML in the forum.  You can see my thoughts at https://forums.triplea-game.org/topic/2481/custom-battle-phases.  That forum post encompasses more than just centralizing bombardment logic.", "author": "trevan", "createdAt": "2020-12-06T21:16:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk3MDI4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNjk3MDUwNQ==", "url": "https://github.com/triplea-game/triplea/pull/8349#discussion_r536970505", "bodyText": "side comment, just realized the existing comment does not quite make sense.\nSpecifically \"ALL for everything\" reads odd, without context it does not really make sense.\nIf ALL is an enum or a constant defined somewhere, perhaps fully qualifying it would remove any confusion.", "author": "DanVanAtta", "createdAt": "2020-12-06T06:40:33Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/battle/steps/fire/MarkCasualties.java", "diffHunk": "@@ -45,9 +44,7 @@\n \n   private final FireRoundState fireRoundState;\n \n-  @ChangeOnNextMajorRelease(\n-      \"returnFire is ALL for everything except NavalBombardment and old saves.\"\n-          + \"Rework so that returnFire isn't needed at all.\")\n+  @RemoveOnNextMajorRelease(\"returnFire is ALL for everything except old saves\")", "originalCommit": "c5637446fc28c683fc6555b5bd515de0787ef5da", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2ebe6ac5b6e590abe5715da4f83b18ea6d51075b", "url": "https://github.com/triplea-game/triplea/commit/2ebe6ac5b6e590abe5715da4f83b18ea6d51075b", "message": "Improve comment and method name", "committedDate": "2020-12-06T19:17:13Z", "type": "commit"}]}