{"pr_number": 7871, "pr_title": "Re-add warning about save from a newer compatible version", "pr_createdAt": "2020-10-10T16:36:37Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7871", "timeline": [{"oid": "279f75bee9d76f95c7bfd817d9bf1aa0e43c0b4f", "url": "https://github.com/triplea-game/triplea/commit/279f75bee9d76f95c7bfd817d9bf1aa0e43c0b4f", "message": "Re-add warning about save from a newer compatible version\n\nThis was removed in 030cb1f61d574a2d87fc4eb6777f953fec642496 because\nof a swing deadlock issue and was also considered to be redundant.\n\nIt is needed because newer compatible versions might use new saved data\nto add or change functionality. When an older version opens the saved\ngame, the new saved data will be removed and the functionality might end\nup broken.", "committedDate": "2020-10-10T16:56:33Z", "type": "commit"}, {"oid": "279f75bee9d76f95c7bfd817d9bf1aa0e43c0b4f", "url": "https://github.com/triplea-game/triplea/commit/279f75bee9d76f95c7bfd817d9bf1aa0e43c0b4f", "message": "Re-add warning about save from a newer compatible version\n\nThis was removed in 030cb1f61d574a2d87fc4eb6777f953fec642496 because\nof a swing deadlock issue and was also considered to be redundant.\n\nIt is needed because newer compatible versions might use new saved data\nto add or change functionality. When an older version opens the saved\ngame, the new saved data will be removed and the functionality might end\nup broken.", "committedDate": "2020-10-10T16:56:33Z", "type": "forcePushed"}, {"oid": "32daa88dc830697cb047fcd66892d2bd0c2ae73f", "url": "https://github.com/triplea-game/triplea/commit/32daa88dc830697cb047fcd66892d2bd0c2ae73f", "message": "Add more comments and improve the message", "committedDate": "2020-10-10T17:51:10Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyNDk2NA==", "url": "https://github.com/triplea-game/triplea/pull/7871#discussion_r502824964", "bodyText": "This comment does not seem to belong in this method. The comment is describing why we can load a newer save game, but the method is all about prompting and warning the user.", "author": "DanVanAtta", "createdAt": "2020-10-10T19:40:51Z", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -102,6 +107,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n     }\n   }\n \n+  private static void promptToLoadNewerSaveGame(final Version version) throws IOException {\n+    // we can still load it because our engine is compatible, however this save was made by a", "originalCommit": "32daa88dc830697cb047fcd66892d2bd0c2ae73f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk0NTYxMw==", "url": "https://github.com/triplea-game/triplea/pull/7871#discussion_r502945613", "bodyText": "I moved the comment to the caller.", "author": "trevan", "createdAt": "2020-10-11T17:50:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyNDk2NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyNTA1Nw==", "url": "https://github.com/triplea-game/triplea/pull/7871#discussion_r502825057", "bodyText": "nHowever, because the first version number is the same as your current version, \"\n+ \"we can still open the savegame.\n\nThis is a level of detail that we can probably omit. The fact that the game is offering to load the save at all already implies this level of compatibility.", "author": "DanVanAtta", "createdAt": "2020-10-10T19:41:47Z", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -102,6 +107,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n     }\n   }\n \n+  private static void promptToLoadNewerSaveGame(final Version version) throws IOException {\n+    // we can still load it because our engine is compatible, however this save was made by a\n+    // newer engine, so prompt the user to upgrade\n+    // this is needed because a newer client might depend on variables that are part of the new\n+    // save but will be stripped by the old client. When the old client re-saves the data, the\n+    // new client will load the save game and be in odd state.\n+    final String messageString =\n+        \"This save was made by a newer version of TripleA.\"\n+            + \"\\nHowever, because the first version number is the same as your current version, \"", "originalCommit": "32daa88dc830697cb047fcd66892d2bd0c2ae73f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyNTMwMQ==", "url": "https://github.com/triplea-game/triplea/pull/7871#discussion_r502825301", "bodyText": "There is a possibility that if you save this game \"\n+ \"and then open it up in the version that created it, the game will be in an \"\n+ \"incorrect state.\n\nWe can probably state this more simply. Perhaps something like:\nPlaying newer saves with an older engine can lead to unpredictable problems. It is recommended that you upgrade to the latest version of TripleA before playing this save game. To download the latest version of TripleA, Please visit UrlConstants.DOWNLOAD_WEBSITE\"\n+ \\n\\nDo you wish to continue and open this save with your current 'old' version?\";\n\nI think there might be a usability problem here as well because the URL cannot be copy/pasted and a user has to type it in manually. We can make the link clickable, I suspect that would be the best UX. @trevan is that something you would be willing to do?\n\"JEditorPaneWithClickableLinks\" is the class that enables messages with clickable links.", "author": "DanVanAtta", "createdAt": "2020-10-10T19:44:58Z", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -102,6 +107,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n     }\n   }\n \n+  private static void promptToLoadNewerSaveGame(final Version version) throws IOException {\n+    // we can still load it because our engine is compatible, however this save was made by a\n+    // newer engine, so prompt the user to upgrade\n+    // this is needed because a newer client might depend on variables that are part of the new\n+    // save but will be stripped by the old client. When the old client re-saves the data, the\n+    // new client will load the save game and be in odd state.\n+    final String messageString =\n+        \"This save was made by a newer version of TripleA.\"\n+            + \"\\nHowever, because the first version number is the same as your current version, \"\n+            + \"we can still open the savegame. There is a possibility that if you save this game \"", "originalCommit": "32daa88dc830697cb047fcd66892d2bd0c2ae73f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjk0NTYwNA==", "url": "https://github.com/triplea-game/triplea/pull/7871#discussion_r502945604", "bodyText": "I've updated the text with what you wrote.  I haven't made the link clickable, though.", "author": "trevan", "createdAt": "2020-10-11T17:50:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyNTMwMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyNTQzMw==", "url": "https://github.com/triplea-game/triplea/pull/7871#discussion_r502825433", "bodyText": "It's sad this is how we abort save games, control-flow-by-exception handling. We are also masking other, legitimate causes of IOException as well, for example a permission denied trying to read the save game file. I\"m not sure if there is much to do about this problem now, but it's certainly not ideal.", "author": "DanVanAtta", "createdAt": "2020-10-10T19:46:04Z", "path": "game-core/src/main/java/games/strategy/engine/framework/GameDataManager.java", "diffHunk": "@@ -102,6 +107,35 @@ public static GameData loadGame(final InputStream is) throws IOException {\n     }\n   }\n \n+  private static void promptToLoadNewerSaveGame(final Version version) throws IOException {\n+    // we can still load it because our engine is compatible, however this save was made by a\n+    // newer engine, so prompt the user to upgrade\n+    // this is needed because a newer client might depend on variables that are part of the new\n+    // save but will be stripped by the old client. When the old client re-saves the data, the\n+    // new client will load the save game and be in odd state.\n+    final String messageString =\n+        \"This save was made by a newer version of TripleA.\"\n+            + \"\\nHowever, because the first version number is the same as your current version, \"\n+            + \"we can still open the savegame. There is a possibility that if you save this game \"\n+            + \"and then open it up in the version that created it, the game will be in an \"\n+            + \"incorrect state.\"\n+            + \"\\n\\nThis TripleA engine is version \"\n+            + ClientContext.engineVersion().toString()\n+            + \" and you are trying to open a save game made with version \"\n+            + version.toString()\n+            + \"\\n\\nTo download the latest version of TripleA, Please visit \"\n+            + UrlConstants.DOWNLOAD_WEBSITE\n+            + \"\\n\\nIt is recommended that you upgrade to the latest version of TripleA before \"\n+            + \"playing this save game.\"\n+            + \"\\n\\nDo you wish to continue and open this save with your current 'old' version?\";\n+    final int answer =\n+        JOptionPane.showConfirmDialog(\n+            null, messageString, \"Open Newer Save Game?\", JOptionPane.YES_NO_OPTION);\n+    if (answer != JOptionPane.YES_OPTION) {\n+      throw new IOException(\"Loading the save game was aborted\");", "originalCommit": "32daa88dc830697cb047fcd66892d2bd0c2ae73f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "130b79f03e4dae9eb726554019a02ae08a062e75", "url": "https://github.com/triplea-game/triplea/commit/130b79f03e4dae9eb726554019a02ae08a062e75", "message": "Change the text", "committedDate": "2020-10-11T17:49:13Z", "type": "commit"}, {"oid": "4f0a47e74cc76cd04d1e3a1866925f42aa0a0e31", "url": "https://github.com/triplea-game/triplea/commit/4f0a47e74cc76cd04d1e3a1866925f42aa0a0e31", "message": "Remove unused method param (fixes PMD violation)", "committedDate": "2020-10-11T18:16:27Z", "type": "commit"}]}