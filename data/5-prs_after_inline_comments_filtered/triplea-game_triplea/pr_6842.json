{"pr_number": 6842, "pr_title": "Indicate if the missing image is for a damaged or disabled unit", "pr_createdAt": "2020-06-25T15:48:09Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6842", "timeline": [{"oid": "3396483266a8e13ddd4567b17c9045846b82a7bb", "url": "https://github.com/triplea-game/triplea/commit/3396483266a8e13ddd4567b17c9045846b82a7bb", "message": "Indicate if the missing image is for a damaged or disabled unit", "committedDate": "2020-06-25T15:43:19Z", "type": "commit"}, {"oid": "ae927f36595d3ba218af66b638815b8e5a657c71", "url": "https://github.com/triplea-game/triplea/commit/ae927f36595d3ba218af66b638815b8e5a657c71", "message": "Use String.join instead of StringBuilder", "committedDate": "2020-06-25T15:51:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2MjYwOA==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r445962608", "bodyText": "nit, what's the motivation to re-assign disabled to a new variable?", "author": "DanVanAtta", "createdAt": "2020-06-26T04:35:48Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/screen/UnitsDrawer.java", "diffHunk": "@@ -110,14 +111,22 @@ public void draw(\n       throw new IllegalStateException(\"Type not found:\" + unitType);\n     }\n     final GamePlayer owner = data.getPlayerList().getPlayerId(playerName);\n+    final boolean damagedImage = damaged > 0 || bombingUnitDamage > 0;\n+    final boolean disabledImage = disabled;", "originalCommit": "ae927f36595d3ba218af66b638815b8e5a657c71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2MzUyOQ==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r445963529", "bodyText": "Attempt to ensure that the same values passed in the getImage call would be used in the log message.", "author": "trevan", "createdAt": "2020-06-26T04:40:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2MjYwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk4NDk4OQ==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r445984989", "bodyText": "Is it not thread safe?\nIf we're trying to protect against concurrency, what's to keep the value from changing before this line? (in which case, unless I'm mistaken, the log message is also incorrect)", "author": "DanVanAtta", "createdAt": "2020-06-26T06:06:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2MjYwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjIxMTI2OQ==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r446211269", "bodyText": "It should be thread safe.\nThis was to protect a developer from changing the condition for the call and not changing the condition for the log call.  But I've removed the disabledImage variable and now just use disabled.", "author": "trevan", "createdAt": "2020-06-26T14:15:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2MjYwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2Mjg1Mg==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r445962852", "bodyText": "We can have, or even require sometimes a disabled & damaged image? I kinda thought they were mutually exclusive. If not, it implies a pretty large number of image permutations that is probably not typically included (which would be kinda bad news).", "author": "DanVanAtta", "createdAt": "2020-06-26T04:36:58Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/screen/UnitsDrawer.java", "diffHunk": "@@ -110,14 +111,22 @@ public void draw(\n       throw new IllegalStateException(\"Type not found:\" + unitType);\n     }\n     final GamePlayer owner = data.getPlayerList().getPlayerId(playerName);\n+    final boolean damagedImage = damaged > 0 || bombingUnitDamage > 0;\n+    final boolean disabledImage = disabled;\n     final Optional<Image> img =\n-        uiContext\n-            .getUnitImageFactory()\n-            .getImage(type, owner, damaged > 0 || bombingUnitDamage > 0, disabled);\n+        uiContext.getUnitImageFactory().getImage(type, owner, damagedImage, disabledImage);\n \n     if (img.isEmpty() && !uiContext.isShutDown()) {\n+      final List<String> imageQualifiers = new ArrayList<>();\n+      if (damagedImage) {\n+        imageQualifiers.add(\"damaged \");\n+      }\n+      if (disabledImage) {\n+        imageQualifiers.add(\"disabled \");", "originalCommit": "ae927f36595d3ba218af66b638815b8e5a657c71", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2NDExMg==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r445964112", "bodyText": "Ah, looks like I missed the \"else\" in the UnitImageFactory.  I somehow misread it as two if statements instead of a if else if.", "author": "trevan", "createdAt": "2020-06-26T04:42:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTk2Mjg1Mg=="}], "type": "inlineReview"}, {"oid": "ae656e3cfe049751ccc6c76947d1a5867c72858d", "url": "https://github.com/triplea-game/triplea/commit/ae656e3cfe049751ccc6c76947d1a5867c72858d", "message": "Fix calculation of the image qualifier", "committedDate": "2020-06-26T04:45:22Z", "type": "commit"}, {"oid": "e5dd55ed30b315f09c82a47bda6afee21764eabf", "url": "https://github.com/triplea-game/triplea/commit/e5dd55ed30b315f09c82a47bda6afee21764eabf", "message": "Auto-Formatting", "committedDate": "2020-06-26T04:47:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjI0Njk4Mw==", "url": "https://github.com/triplea-game/triplea/pull/6842#discussion_r446246983", "bodyText": "I think this error message shouldn't be all caps tbh", "author": "RoiEXLab", "createdAt": "2020-06-26T15:16:25Z", "path": "game-core/src/main/java/games/strategy/triplea/ui/screen/UnitsDrawer.java", "diffHunk": "@@ -110,14 +110,22 @@ public void draw(\n       throw new IllegalStateException(\"Type not found:\" + unitType);\n     }\n     final GamePlayer owner = data.getPlayerList().getPlayerId(playerName);\n+    final boolean damagedImage = damaged > 0 || bombingUnitDamage > 0;\n     final Optional<Image> img =\n-        uiContext\n-            .getUnitImageFactory()\n-            .getImage(type, owner, damaged > 0 || bombingUnitDamage > 0, disabled);\n+        uiContext.getUnitImageFactory().getImage(type, owner, damagedImage, disabled);\n \n     if (img.isEmpty() && !uiContext.isShutDown()) {\n+      final String imageQualifier;\n+      if (disabled) {\n+        imageQualifier = \"disabled \";\n+      } else if (damagedImage) {\n+        imageQualifier = \"damaged \";\n+      } else {\n+        imageQualifier = \"\";\n+      }\n       log.severe(\n           \"MISSING UNIT IMAGE (won't be displayed): \"", "originalCommit": "e5dd55ed30b315f09c82a47bda6afee21764eabf", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}