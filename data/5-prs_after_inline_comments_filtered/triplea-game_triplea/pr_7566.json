{"pr_number": 7566, "pr_title": "Simplify map loading responsibility", "pr_createdAt": "2020-09-07T04:30:05Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7566", "timeline": [{"oid": "76b918d0a5bdcca8bef3c07f02bafd436df01db5", "url": "https://github.com/triplea-game/triplea/commit/76b918d0a5bdcca8bef3c07f02bafd436df01db5", "message": "Simplify, consolidate error handling for game parse exception when building game notes (for select map window)", "committedDate": "2020-09-07T01:45:56Z", "type": "commit"}, {"oid": "a1d7e935697675e4331b7f60da88720b51970d92", "url": "https://github.com/triplea-game/triplea/commit/a1d7e935697675e4331b7f60da88720b51970d92", "message": "Simplify, push map parsing error handling to GameParser and game loading to GameChooserModel\n\nThe push of responsibility offloads responsibility and simplifies clients.\nWe also relax the error handling to not do things like reset the default game\non parse error.", "committedDate": "2020-09-07T04:26:28Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4NDE3Nzk3NA==", "url": "https://github.com/triplea-game/triplea/pull/7566#discussion_r484177974", "bodyText": "Avoid too many return statements within this method.", "author": "codeclimate", "createdAt": "2020-09-07T04:34:38Z", "path": "game-core/src/main/java/games/strategy/engine/data/gameparser/GameParser.java", "diffHunk": "@@ -99,10 +103,25 @@ private GameParser(\n    *\n    * @return A complete {@link GameData} instance that can be used to play the game.\n    */\n-  @Nonnull\n-  public static GameData parse(final String mapName, final InputStream stream)\n-      throws GameParseException, EngineVersionException {\n-    return parse(mapName, stream, new XmlGameElementMapper());\n+  public static Optional<GameData> parse(final URI mapUri) {\n+\n+    final Optional<InputStream> inputStream = UrlStreams.openStream(mapUri);\n+    if (inputStream.isEmpty()) {\n+      return Optional.empty();\n+    }\n+\n+    try (InputStream input = inputStream.get()) {\n+      return Optional.of(parse(mapUri.toString(), input, new XmlGameElementMapper()));\n+    } catch (final EngineVersionException e) {\n+      log.log(Level.WARNING, \"Game engine not compatible with: \" + mapUri, e);\n+      return Optional.empty();\n+    } catch (final GameParseException e) {\n+      log.log(Level.WARNING, \"Could not parse:\" + mapUri, e);\n+      return Optional.empty();\n+    } catch (final IOException e) {\n+      log.log(Level.SEVERE, \"Error opening file: \" + mapUri + \", \" + e.getMessage(), e);\n+      return Optional.empty();", "originalCommit": "a1d7e935697675e4331b7f60da88720b51970d92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "922b1624e8b76ba05c439efd87a04fbb6414900b", "url": "https://github.com/triplea-game/triplea/commit/922b1624e8b76ba05c439efd87a04fbb6414900b", "message": "Remove unused @Log", "committedDate": "2020-09-07T04:38:57Z", "type": "commit"}, {"oid": "c178f0d90d5b3cb01e80282b61ef9f08e82a385d", "url": "https://github.com/triplea-game/triplea/commit/c178f0d90d5b3cb01e80282b61ef9f08e82a385d", "message": "Merge remote-tracking branch 'origin/master' into simplify-map-loading-responsibility", "committedDate": "2020-09-07T19:07:09Z", "type": "commit"}, {"oid": "02df22ac020348a6e06120157b5b0a528604eab8", "url": "https://github.com/triplea-game/triplea/commit/02df22ac020348a6e06120157b5b0a528604eab8", "message": "Use 'openStream(uri, function)' API to simplify GameParser (reduce number of return statements)", "committedDate": "2020-09-07T19:08:52Z", "type": "commit"}, {"oid": "098adff6eedb0e057b3c6f9059c30ace69ec5ac4", "url": "https://github.com/triplea-game/triplea/commit/098adff6eedb0e057b3c6f9059c30ace69ec5ac4", "message": "Fix catch, EngineVersionException no longer thrown.", "committedDate": "2020-09-07T19:33:44Z", "type": "commit"}, {"oid": "803571e84929df38d0c24f231301257e1ade7524", "url": "https://github.com/triplea-game/triplea/commit/803571e84929df38d0c24f231301257e1ade7524", "message": "Formatting, remove unused import", "committedDate": "2020-09-07T19:35:07Z", "type": "commit"}, {"oid": "803571e84929df38d0c24f231301257e1ade7524", "url": "https://github.com/triplea-game/triplea/commit/803571e84929df38d0c24f231301257e1ade7524", "message": "Formatting, remove unused import", "committedDate": "2020-09-07T19:35:07Z", "type": "forcePushed"}]}