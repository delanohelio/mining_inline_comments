{"pr_number": 7227, "pr_title": "Track the isSub/isSuicide combo properties separately from the individual props", "pr_createdAt": "2020-07-23T05:33:56Z", "pr_url": "https://github.com/triplea-game/triplea/pull/7227", "timeline": [{"oid": "6910739558e941a7df988065fff95c85766aa26f", "url": "https://github.com/triplea-game/triplea/commit/6910739558e941a7df988065fff95c85766aa26f", "message": "Track the isSub/isSuicide combo properties separately from the individual props", "committedDate": "2020-07-23T05:27:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTIyMzc4Mg==", "url": "https://github.com/triplea-game/triplea/pull/7227#discussion_r459223782", "bodyText": "Codacy found an issue: Assigning an Object to null is a code smell.  Consider refactoring.", "author": "DanVanAtta", "createdAt": "2020-07-23T05:37:59Z", "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -629,13 +633,10 @@ private void setIsSub(final String s) {\n   }\n \n   private void setIsSub(final Boolean s) {\n-    setCanEvade(s);\n-    setIsFirstStrike(s);\n-    setCanMoveThroughEnemies(s && Properties.getSubmersibleSubs(getData()));\n-    setCanBeMovedThroughByEnemies(s && Properties.getIgnoreSubInMovement(getData()));\n+    isSub = true;\n     if (s) {\n       canNotTarget = null;\n-      canNotBeTargetedBy = Properties.getAirAttackSubRestricted(getData()) ? null : new HashSet<>();\n+      canNotBeTargetedBy = null;", "originalCommit": "6910739558e941a7df988065fff95c85766aa26f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyMjI0MQ==", "url": "https://github.com/triplea-game/triplea/pull/7227#discussion_r463922241", "bodyText": "A 'combo' property is not well defined, what does this mean? Is this comment adding more than the questions it raises? I would suggest either explaining this more or just omitting the comment.", "author": "DanVanAtta", "createdAt": "2020-08-01T04:49:54Z", "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -226,6 +226,10 @@\n   // Manually set TUV\n   private int tuv = -1;\n \n+  // combo properties", "originalCommit": "6910739558e941a7df988065fff95c85766aa26f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyMjQ4Ng==", "url": "https://github.com/triplea-game/triplea/pull/7227#discussion_r463922486", "bodyText": "This is sad to see of course as options become super complex. What happens when I set 'isFirstStrike = false' and 'isSub = true' (well, it is first strike even though the option is set to off). I think that examples shows we lack flexibility, you cannot have a non-first strike sub unit or non-first strike suicide unit.\nIs the other option for us instead of the 'combo' property would be to update all maps? I'm not sure if there is really a good alternative to the code update proposed, I'm more thinking out loud and wondering what other options we might have.", "author": "DanVanAtta", "createdAt": "2020-08-01T04:52:29Z", "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -647,31 +648,31 @@ private void setCanEvade(final Boolean s) {\n   }\n \n   public boolean getCanEvade() {\n-    return canEvade;\n+    return canEvade || isSub;\n   }\n \n   private void setIsFirstStrike(final Boolean s) {\n     isFirstStrike = s;\n   }\n \n   public boolean getIsFirstStrike() {\n-    return isFirstStrike;\n+    return isFirstStrike || isSub || isSuicide;", "originalCommit": "6910739558e941a7df988065fff95c85766aa26f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk4MDI3Ng==", "url": "https://github.com/triplea-game/triplea/pull/7227#discussion_r463980276", "bodyText": "Yes, the \"combo\" attributes are going to cause problems.  Before this code change, if you had\n      <option name=\"isFirstStrike\" value=\"false\"/>\n      <option name=\"isSub\" value=\"true\"/>\n\nthen your unit would have isFirstStrike == true.\nBut if you had\n      <option name=\"isSub\" value=\"true\"/>\n      <option name=\"isFirstStrike\" value=\"false\"/>\n\nthen your unit would have isFirstStrike == false.\nWith this change, at least the order doesn't matter anymore.  isFirstStrike will always be true.\nIf you want a non-first strike sub unit, you can make that.  You just can't use isSub.  You have to set the atomic properties yourself.  Same with a non-first strike suicide unit.\nAnother option, I think, is to add to the documentation that the individual atomic properties of the combo properties can't be overridden.  If they want to have custom units, then they need to use the atomic properties instead.  The combo properties are there just to simplify the creation of basic units.\nIf we want atomic properties to be able to override combo properties, then we'll need some sort of flag to indicate that the atomic property is actually set.  Because setting a property to false is currently the same thing as not setting the property at all.  But I think we should focus the documentation on moving towards atomic properties only and just mark all of the combo properties as deprecated.  Then, somehow, indicate to the map maker that the property shouldn't be used.", "author": "trevan", "createdAt": "2020-08-01T16:58:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzkyMjQ4Ng=="}], "type": "inlineReview"}]}