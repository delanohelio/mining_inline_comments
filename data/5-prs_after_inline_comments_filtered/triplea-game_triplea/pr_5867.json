{"pr_number": 5867, "pr_title": "Improve unit support tooltip", "pr_createdAt": "2020-01-22T01:30:53Z", "pr_url": "https://github.com/triplea-game/triplea/pull/5867", "timeline": [{"oid": "6c3f31caabc3869ee56e402d5570f9a320cfa48c", "url": "https://github.com/triplea-game/triplea/commit/6c3f31caabc3869ee56e402d5570f9a320cfa48c", "message": "Add new formatting method to add line breaks and indents", "committedDate": "2020-01-22T01:26:27Z", "type": "commit"}, {"oid": "a860d3857b13ced9d55dc847c0afa5dee188a7f0", "url": "https://github.com/triplea-game/triplea/commit/a860d3857b13ced9d55dc847c0afa5dee188a7f0", "message": "Update unit tooltip to use new line break method", "committedDate": "2020-01-22T01:26:57Z", "type": "commit"}, {"oid": "283859034bb14a0a25f9e05215a4bb14248e1936", "url": "https://github.com/triplea-game/triplea/commit/283859034bb14a0a25f9e05215a4bb14248e1936", "message": "Refactor a few method calls to reduce parameters", "committedDate": "2020-01-22T01:27:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTQyMQ==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331421", "bodyText": "Increase unit type cap to 25.", "author": "ron-murhammer", "createdAt": "2020-01-22T01:31:39Z", "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -3267,9 +3267,9 @@ public String toStringShortAndOnlyImportantDifferences(final GamePlayer player)\n                 + (support.getAllied() && support.getEnemy()\n                     ? \" Allied & Enemy \"\n                     : (support.getAllied() ? \" Allied \" : \" Enemy \"))\n-                + (support.getUnitType().size() > 4\n+                + (support.getUnitType().size() > 25", "originalCommit": "283859034bb14a0a25f9e05215a4bb14248e1936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTUwOA==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331508", "bodyText": "Change unit delimiter to comma instead of slash as it works better with line breaks.", "author": "ron-murhammer", "createdAt": "2020-01-22T01:32:03Z", "path": "game-core/src/main/java/games/strategy/triplea/attachments/UnitAttachment.java", "diffHunk": "@@ -3267,9 +3267,9 @@ public String toStringShortAndOnlyImportantDifferences(final GamePlayer player)\n                 + (support.getAllied() && support.getEnemy()\n                     ? \" Allied & Enemy \"\n                     : (support.getAllied() ? \" Allied \" : \" Enemy \"))\n-                + (support.getUnitType().size() > 4\n+                + (support.getUnitType().size() > 25\n                     ? \"Units\"\n-                    : MyFormatter.defaultNamedToTextList(support.getUnitType(), \"/\", false));\n+                    : MyFormatter.defaultNamedToTextList(support.getUnitType()));", "originalCommit": "283859034bb14a0a25f9e05215a4bb14248e1936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTY0Mw==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331643", "bodyText": "Remove unnecessary parameters.", "author": "ron-murhammer", "createdAt": "2020-01-22T01:32:41Z", "path": "game-core/src/main/java/games/strategy/triplea/delegate/EndRoundDelegate.java", "diffHunk": "@@ -303,9 +303,7 @@ public void signalGameOver(\n       // end round delegate)\n       final String title =\n           \"Victory Achieved\"\n-              + (winners.isEmpty()\n-                  ? \"\"\n-                  : \" by \" + MyFormatter.defaultNamedToTextList(winners, \", \", false));\n+              + (winners.isEmpty() ? \"\" : \" by \" + MyFormatter.defaultNamedToTextList(winners));", "originalCommit": "283859034bb14a0a25f9e05215a4bb14248e1936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTMzMTczOQ==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369331739", "bodyText": "Change to use default delimiter and method call.", "author": "ron-murhammer", "createdAt": "2020-01-22T01:33:04Z", "path": "game-core/src/main/java/games/strategy/triplea/TripleAPlayer.java", "diffHunk": "@@ -694,7 +694,7 @@ public Territory selectTerritoryForAirToLand(\n   public boolean confirmMoveInFaceOfAa(final Collection<Territory> aaFiringTerritories) {\n     final String question =\n         \"Your units will be fired on in: \"\n-            + MyFormatter.defaultNamedToTextList(aaFiringTerritories, \" and \", false)\n+            + MyFormatter.defaultNamedToTextList(aaFiringTerritories)", "originalCommit": "283859034bb14a0a25f9e05215a4bb14248e1936", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "74e38f1549dd0fbdf966b207d7f28ba324ff0430", "url": "https://github.com/triplea-game/triplea/commit/74e38f1549dd0fbdf966b207d7f28ba324ff0430", "message": "Add javadoc", "committedDate": "2020-01-22T01:38:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzc2Mg==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369437762", "bodyText": "I really have no clue what exact rules the logic here follows.\nThe Javadoc helps a bit, but the word wrapping makes stuff a little confusing.\nWould you mind adding a few unit tests that test the behavior of this method an test edge cases with very long words?", "author": "RoiEXLab", "createdAt": "2020-01-22T09:04:11Z", "path": "game-core/src/main/java/games/strategy/triplea/formatter/MyFormatter.java", "diffHunk": "@@ -407,4 +408,38 @@ public static String integerUnitMapToString(\n     }\n     return buf.toString().replaceFirst(separator, \"\");\n   }\n+\n+  /**\n+   * Adds HTML line breaks and indentation to a string so it wraps for things like long tooltips.\n+   *\n+   * <pre>\n+   * string part 1\n+   *           string part 2\n+   *           ...\n+   *           string part X\n+   * </pre>\n+   */\n+  public static String addHtmlBreaksAndIndents(\n+      final String target, final int firstLineMaxLength, final int maxLength) {\n+    final StringBuilder sb = new StringBuilder();\n+    final BreakIterator breakIterator = BreakIterator.getLineInstance();\n+    breakIterator.setText(target);\n+    int start = breakIterator.first();\n+    int end = breakIterator.next();\n+    int lineLength = 0;\n+    int currentMaxLength = firstLineMaxLength;\n+    while (end != BreakIterator.DONE) {\n+      final String word = target.substring(start, end);\n+      lineLength = lineLength + word.length();\n+      if (lineLength >= currentMaxLength) {\n+        sb.append(\"<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\");\n+        lineLength = word.length() + 5; // Add 5 for the indent\n+        currentMaxLength = maxLength;\n+      }\n+      sb.append(word);\n+      start = end;\n+      end = breakIterator.next();\n+    }\n+    return sb.toString();\n+  }", "originalCommit": "74e38f1549dd0fbdf966b207d7f28ba324ff0430", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyMDA1OA==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369920058", "bodyText": "Yeah, I'll add a quick unit test though it follows the line breaks functionality provided by Java BreakIterator:\nhttps://docs.oracle.com/javase/8/docs/api/java/text/BreakIterator.html#getLineInstance--\nhttps://docs.oracle.com/javase/tutorial/i18n/text/line.html", "author": "ron-murhammer", "createdAt": "2020-01-23T03:45:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzc2Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTkyMTk2NA==", "url": "https://github.com/triplea-game/triplea/pull/5867#discussion_r369921964", "bodyText": "Added.", "author": "ron-murhammer", "createdAt": "2020-01-23T03:56:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTQzNzc2Mg=="}], "type": "inlineReview"}, {"oid": "bb869b8a32ef8a28bfa8778b2b349dbe748e7b5e", "url": "https://github.com/triplea-game/triplea/commit/bb869b8a32ef8a28bfa8778b2b349dbe748e7b5e", "message": "Add unit tests for new formatting method", "committedDate": "2020-01-23T03:56:37Z", "type": "commit"}, {"oid": "935874d002a51ced5aab900003d9bec56d9aff47", "url": "https://github.com/triplea-game/triplea/commit/935874d002a51ced5aab900003d9bec56d9aff47", "message": "Wrap long lines", "committedDate": "2020-01-28T19:41:53Z", "type": "commit"}]}