{"pr_number": 6879, "pr_title": "Fix dice RegEx", "pr_createdAt": "2020-06-26T20:38:02Z", "pr_url": "https://github.com/triplea-game/triplea/pull/6879", "timeline": [{"oid": "35953f31185b4576e3443e6ef0e84013a01e94b5", "url": "https://github.com/triplea-game/triplea/commit/35953f31185b4576e3443e6ef0e84013a01e94b5", "message": "Fix regular expression", "committedDate": "2020-06-26T20:35:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTQ1OA==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r446695458", "bodyText": "This comment probably could use elaboration and give a number more examples of what we are supposed to match.", "author": "DanVanAtta", "createdAt": "2020-06-28T20:38:17Z", "path": "game-core/src/main/java/games/strategy/engine/random/MartiDiceRoller.java", "diffHunk": "@@ -43,7 +43,7 @@\n   // Matches a comma separated list of integers like this:\n   // your dice are: 1,2,3 <p>", "originalCommit": "35953f31185b4576e3443e6ef0e84013a01e94b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzOTE0OA==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r447039148", "bodyText": "bump, this comment is out of date and/or inadequate since the regex matches far more than just the above example. Expecting single digits is part of the problem of the original regex, this comment is misleading (arguably greatly contributed to this bug)", "author": "DanVanAtta", "createdAt": "2020-06-29T15:01:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTQ1OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTUyMA==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r446695520", "bodyText": "Good to see test case updated, though should we perhaps still have the original test data be tested as well for more coverage? Would this be better as a new & additional test rather than updating the existing test?", "author": "DanVanAtta", "createdAt": "2020-06-28T20:39:00Z", "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -13,7 +13,7 @@\n \n public class MartiDiceRollerTest {\n   private static final String successMessage =\n-      \"Some text before<br>your dice are: 2,5,1<p><p>\\t</body>\\nsome text after\";\n+      \"Some text before<br>your dice are: 22,5,100<p><p>\\t</body>\\nsome text after\";", "originalCommit": "35953f31185b4576e3443e6ef0e84013a01e94b5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcwNjk1MQ==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r446706951", "bodyText": "See my explanation. Basically the first number can now have multiple digits as well", "author": "RoiEXLab", "createdAt": "2020-06-28T22:37:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjcxMzMwMw==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r446713303", "bodyText": "Again, would it be more comprehensive to have additional test cases rather just this one?\nFor example, can we have 'zero's', all ones, what if we have just one dice roll, how about more than just three?", "author": "DanVanAtta", "createdAt": "2020-06-28T23:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0Njg4MTA2OA==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r446881068", "bodyText": "Ah, you mean in general?\nYes that would of course make sense.\nI just don't think adding in an additional case for this hotfix is really needed", "author": "RoiEXLab", "createdAt": "2020-06-29T09:47:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTUyMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzAzODE4Nw==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r447038187", "bodyText": "The original tests passed, yet a 'hotfix' is still needed. By changing the existing test cases, we are losing some data variations. I would suggest that one of the root causes of this problem was insufficient test cases, we did not model in test the actual data set and there was a data set that caused a problem. Generally, bug fixes will receive brand new test cases to reveal the bug before the problem is fixed. That would mean to leave existing test cases along so you can be sure you are not regressing and that you are finding the new problem. As-is, the test coverage seems to be somewhat focused on relatively happy case testing and is lacking potentially interesting test cases.", "author": "DanVanAtta", "createdAt": "2020-06-29T15:00:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NjY5NTUyMA=="}], "type": "inlineReview"}, {"oid": "1be7e13e57396c2a24d49b35e2f798f3a254e5a3", "url": "https://github.com/triplea-game/triplea/commit/1be7e13e57396c2a24d49b35e2f798f3a254e5a3", "message": "Add additional test cases", "committedDate": "2020-06-29T23:24:45Z", "type": "commit"}, {"oid": "9e212dca12864801de88238efd0c4fa821c758fb", "url": "https://github.com/triplea-game/triplea/commit/9e212dca12864801de88238efd0c4fa821c758fb", "message": "Add final keyword", "committedDate": "2020-06-29T23:58:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NzMzOTk2Nw==", "url": "https://github.com/triplea-game/triplea/pull/6879#discussion_r447339967", "bodyText": "Looking at this, realizing we translate dice rolls to be zero-based \ud83e\udd26", "author": "DanVanAtta", "createdAt": "2020-06-30T00:41:09Z", "path": "game-core/src/test/java/games/strategy/engine/random/MartiDiceRollerTest.java", "diffHunk": "@@ -26,15 +27,79 @@\n           .gameId(\"\")\n           .build();\n \n+  @Nested\n+  class SuccessPatterns {\n+\n+    @Test\n+    @SuppressWarnings(\"unchecked\")\n+    void singleDieSingleDigit() throws Exception {\n+      final Integer[] dice = boxedArray(martiDiceRoller.getDice(\"your dice are: 1<p>\", 0));\n+\n+      assertThat(dice, is(array(equalTo(0))));\n+    }\n+\n+    @Test\n+    @SuppressWarnings(\"unchecked\")\n+    void singleDieMultipleDigit() throws Exception {\n+      final Integer[] dice = boxedArray(martiDiceRoller.getDice(\"your dice are: 1337<p>\", 0));\n+\n+      assertThat(dice, is(array(equalTo(1336))));", "originalCommit": "1be7e13e57396c2a24d49b35e2f798f3a254e5a3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}