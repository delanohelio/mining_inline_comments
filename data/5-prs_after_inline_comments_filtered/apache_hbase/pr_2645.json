{"pr_number": 2645, "pr_title": "HBASE-25272 Support scan on a specific replica", "pr_createdAt": "2020-11-11T04:07:35Z", "pr_url": "https://github.com/apache/hbase/pull/2645", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODk1NQ==", "url": "https://github.com/apache/hbase/pull/2645#discussion_r521488955", "bodyText": "More changes are needed in ScannerCallableWithReplicas. It is hard to copy the diff in the right format, so I post the patch in the jira. Put the link here.\ncode diff", "author": "huaxiangsun", "createdAt": "2020-11-11T16:40:09Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/ScannerCallableWithReplicas.java", "diffHunk": "@@ -209,13 +209,13 @@ public MoreResults moreResultsForScan() {\n         LOG.debug(\"Scan with primary region returns \" + e.getCause());\n       }\n \n-      // If rl's size is 1 or scan's consitency is strong, it needs to throw\n-      // out the exception from the primary replica\n-      if ((regionReplication == 1) || (scan.getConsistency() == Consistency.STRONG)) {\n+      // If rl's size is 1 or scan's consistency is strong or a specific replica id has been\n+      // specified, it needs to throw out the exception from the first tried replica\n+      if (regionReplication == 1 || scan.getConsistency() == Consistency.STRONG ||\n+        scan.getReplicaId() >= 0) {", "originalCommit": "d545591849ec4403aa9d1c88c54703f23fafe073", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTc2NzA5OA==", "url": "https://github.com/apache/hbase/pull/2645#discussion_r521767098", "bodyText": "The logic is strange. If scan is strong we set endIndex to 1, and startIndex is also, so when calling cs.pollForFirstSuccessfullyCompletedTask we will get a null and then we will throw the exception out. But in pollForFirstSuccessfullyCompletedTask, we have this\n    // impossible to reach\n    return null;\n\nWhich is really confusing...\nAnyway, we all know that after years of patching on the sync client, the code is totally a mess so I will follow your approach to make the code safer... It is good that we do not need to maintain the code on master...", "author": "Apache9", "createdAt": "2020-11-12T01:51:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODk1NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTgzMTcxNA==", "url": "https://github.com/apache/hbase/pull/2645#discussion_r521831714", "bodyText": "The comment is incorrect, I removed it in my patch.", "author": "huaxiangsun", "createdAt": "2020-11-12T04:26:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyMTQ4ODk1NQ=="}], "type": "inlineReview"}, {"oid": "cb8e8d4f313914a87914f12304a3b9a28e44c32f", "url": "https://github.com/apache/hbase/commit/cb8e8d4f313914a87914f12304a3b9a28e44c32f", "message": "HBASE-25272 Support scan on a specific replica", "committedDate": "2020-11-12T03:51:20Z", "type": "commit"}, {"oid": "cb8e8d4f313914a87914f12304a3b9a28e44c32f", "url": "https://github.com/apache/hbase/commit/cb8e8d4f313914a87914f12304a3b9a28e44c32f", "message": "HBASE-25272 Support scan on a specific replica", "committedDate": "2020-11-12T03:51:20Z", "type": "forcePushed"}, {"oid": "a1976f613f6ae90b52cf29ce0c2bde62bd4fbbc5", "url": "https://github.com/apache/hbase/commit/a1976f613f6ae90b52cf29ce0c2bde62bd4fbbc5", "message": "fix checkstyle issue", "committedDate": "2020-11-12T08:13:57Z", "type": "commit"}]}