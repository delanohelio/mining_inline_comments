{"pr_number": 1500, "pr_title": "HBASE-24164 Retain the ReadRequests and WriteRequests of region on we\u2026", "pr_createdAt": "2020-04-13T06:29:16Z", "pr_url": "https://github.com/apache/hbase/pull/1500", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDI0Mw==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416144243", "bodyText": "If the Region went to another server and was over there for a week before coming to this server, then these metrics would be incorrect? Thats ok?", "author": "saintstack", "createdAt": "2020-04-27T20:59:09Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -877,6 +877,19 @@ public HRegion(final HRegionFileSystem fs, final WAL wal, final Configuration co\n     this.maxCellSize = conf.getLong(HBASE_MAX_CELL_SIZE_KEY, DEFAULT_MAX_CELL_SIZE);\n     this.miniBatchSize = conf.getInt(HBASE_REGIONSERVER_MINIBATCH_SIZE,\n         DEFAULT_HBASE_REGIONSERVER_MINIBATCH_SIZE);\n+\n+    // recover the metrics of read and write requests count if they were retained\n+    if (rsServices != null) {", "originalCommit": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI4MzcyOA==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416283728", "bodyText": "In this case, the metrics would be zero, i think it is correct.\nBTW, there are three type of statistical calibers on region r/w count:\n\ncumulative by all regionserver\ncumulative by independent regionserver\ncumulative by independent regionserver in continuous time range\n\nIMO, the third one is more clear to users.", "author": "bsglz", "createdAt": "2020-04-28T02:38:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDI0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416144508", "bodyText": "Has to be public? Can't be private or package private?", "author": "saintstack", "createdAt": "2020-04-27T20:59:34Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -8964,4 +8977,12 @@ static void decorateRegionConfiguration(Configuration conf) {\n       }\n     }\n   }\n+\n+  public void setReadRequestsCount(long readRequestsCount) {", "originalCommit": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI4NDY2Mg==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416284662", "bodyText": "It could be private, will fix.", "author": "bsglz", "createdAt": "2020-04-28T02:41:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEyNzU2MQ==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423127561", "bodyText": "Were you going to make these private?", "author": "saintstack", "createdAt": "2020-05-11T15:33:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzNzcyMA==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423137720", "bodyText": "I found it used by ut, so changed to public and marked VisableForTesting.", "author": "bsglz", "createdAt": "2020-05-11T15:47:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NDUwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NTE0OA==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416145148", "bodyText": "Has to be public? Can't be package private?", "author": "saintstack", "createdAt": "2020-04-27T21:00:35Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -123,6 +127,13 @@ public long getGlobalMemStoreOffHeapSize() {\n     return this.globalMemStoreOffHeapSize.sum();\n   }\n \n+  /**\n+   * @return the retained metrics of region's read and write requests count\n+   */\n+  public ConcurrentMap<String, Pair<Long, Long>> getRetainedRegionRWRequestsCnt() {", "originalCommit": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI4NTk1OQ==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416285959", "bodyText": "It could be protected, will fix.", "author": "bsglz", "createdAt": "2020-04-28T02:46:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NTE0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416146136", "bodyText": "This data structure can grow w/o bound?\nThis data structure needs a comment on how it is used and life cycle of items. They items should age out I'd think.", "author": "saintstack", "createdAt": "2020-04-27T21:02:04Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/RegionServerAccounting.java", "diffHunk": "@@ -67,6 +70,7 @@ public RegionServerAccounting(Configuration conf) {\n     this.globalOnHeapMemstoreLimit = MemorySizeUtil.getOnheapGlobalMemStoreSize(conf);\n     this.globalOnHeapMemstoreLimitLowMark =\n         (long) (this.globalOnHeapMemstoreLimit * this.globalMemStoreLimitLowMarkPercent);\n+    this.retainedRegionRWRequestsCnt = new ConcurrentHashMap<>();", "originalCommit": "9b61ab26bbbf2f98b6ca9c0cede5bcc362f56c14", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjI5Mzg0Mw==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r416293843", "bodyText": "This data structure can grow w/o bound?\n\nThe entry of it will be removed in time, so will not grow too big.\n\nThis data structure needs a comment on how it is used and life cycle of items. They items should age out I'd think.\n\nAdded some comment.", "author": "bsglz", "createdAt": "2020-04-28T03:10:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMDY5Mw==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423130693", "bodyText": "So, this data structure will get an entry when we close a region that we are to reopen on this server? On open, the entry is removed?\ns/reigon/region/", "author": "saintstack", "createdAt": "2020-05-11T15:37:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzMTA4Ng==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423131086", "bodyText": "Does the reopen of regions on same server happen often?", "author": "saintstack", "createdAt": "2020-05-11T15:38:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzEzODYyNA==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423138624", "bodyText": "So, this data structure will get an entry when we close a region that we are to reopen on this server? On open, the entry is removed?\ns/reigon/region/\n\nYeah.", "author": "bsglz", "createdAt": "2020-05-11T15:49:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMzE0MDY1OQ==", "url": "https://github.com/apache/hbase/pull/1500#discussion_r423140659", "bodyText": "Does the reopen of regions on same server happen often?\n\nIt will happen when alter table.", "author": "bsglz", "createdAt": "2020-05-11T15:52:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjE0NjEzNg=="}], "type": "inlineReview"}, {"oid": "f19c393f22d11135b7360334574abc5771acea3c", "url": "https://github.com/apache/hbase/commit/f19c393f22d11135b7360334574abc5771acea3c", "message": "fix review issues", "committedDate": "2020-05-05T10:30:50Z", "type": "forcePushed"}, {"oid": "315e7a6e5a9eff15e4f131f3c85e617c77e3d6fb", "url": "https://github.com/apache/hbase/commit/315e7a6e5a9eff15e4f131f3c85e617c77e3d6fb", "message": "HBASE-24164 Retain the ReadRequests and WriteRequests of region on web UI after alter table", "committedDate": "2020-05-13T05:56:02Z", "type": "commit"}, {"oid": "315e7a6e5a9eff15e4f131f3c85e617c77e3d6fb", "url": "https://github.com/apache/hbase/commit/315e7a6e5a9eff15e4f131f3c85e617c77e3d6fb", "message": "HBASE-24164 Retain the ReadRequests and WriteRequests of region on web UI after alter table", "committedDate": "2020-05-13T05:56:02Z", "type": "forcePushed"}, {"oid": "4bc040cc8f8462b4b00cafcd4f40f14fa0537d12", "url": "https://github.com/apache/hbase/commit/4bc040cc8f8462b4b00cafcd4f40f14fa0537d12", "message": "fix ut issue.", "committedDate": "2020-05-13T07:10:02Z", "type": "commit"}]}