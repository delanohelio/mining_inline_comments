{"pr_number": 1315, "pr_title": "HBASE-24030 Add necessary validations to HRegion.checkAndMutate() and\u2026", "pr_createdAt": "2020-03-21T08:44:43Z", "pr_url": "https://github.com/apache/hbase/pull/1315", "timeline": [{"oid": "7f8dc9814f304d5bc95b74387230b45cbf6f83af", "url": "https://github.com/apache/hbase/commit/7f8dc9814f304d5bc95b74387230b45cbf6f83af", "message": "HBASE-24030 Add necessary validations to HRegion.checkAndMutate() and HRegion.checkAndRowMutate()", "committedDate": "2020-03-21T09:41:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3OTkxOQ==", "url": "https://github.com/apache/hbase/pull/1315#discussion_r395979919", "bodyText": "would it be better to put checkMutationType() and checkRow() in doCheckAndRowMutate() method?", "author": "virajjasani", "createdAt": "2020-03-21T10:09:15Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java", "diffHunk": "@@ -4207,26 +4208,31 @@ protected Durability getEffectiveDurability(Durability d) {\n   @Override\n   public boolean checkAndMutate(byte[] row, byte[] family, byte[] qualifier, CompareOperator op,\n     ByteArrayComparable comparator, TimeRange timeRange, Mutation mutation) throws IOException {\n-    checkMutationType(mutation, row);\n+    checkMutationType(mutation);\n+    checkRow(mutation, row);\n     return doCheckAndRowMutate(row, family, qualifier, op, comparator, null, timeRange, null,", "originalCommit": "7f8dc9814f304d5bc95b74387230b45cbf6f83af", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk4NTQ0Nw==", "url": "https://github.com/apache/hbase/pull/1315#discussion_r395985447", "bodyText": "@virajjasani Thank you for reviewing this.\nSure. I'll do that.", "author": "brfrn169", "createdAt": "2020-03-21T11:38:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk3OTkxOQ=="}], "type": "inlineReview"}, {"oid": "95dbd19b7ca237d3fc4f19cc9a95d2710526324d", "url": "https://github.com/apache/hbase/commit/95dbd19b7ca237d3fc4f19cc9a95d2710526324d", "message": "HBASE-24030 Add necessary validations to HRegion.checkAndMutate() and HRegion.checkAndRowMutate()", "committedDate": "2020-03-21T11:40:32Z", "type": "commit"}, {"oid": "95dbd19b7ca237d3fc4f19cc9a95d2710526324d", "url": "https://github.com/apache/hbase/commit/95dbd19b7ca237d3fc4f19cc9a95d2710526324d", "message": "HBASE-24030 Add necessary validations to HRegion.checkAndMutate() and HRegion.checkAndRowMutate()", "committedDate": "2020-03-21T11:40:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk5Nzg5Ng==", "url": "https://github.com/apache/hbase/pull/1315#discussion_r395997896", "bodyText": "Are there also positive test cases? The new one's only seem to catch exceptions?", "author": "HorizonNet", "createdAt": "2020-03-21T14:38:07Z", "path": "hbase-server/src/test/java/org/apache/hadoop/hbase/regionserver/TestHRegion.java", "diffHunk": "@@ -2268,6 +2269,78 @@ public void testCheckAndMutate_WithFiltersAndTimeRange() throws Throwable {\n     assertTrue(region.get(new Get(row).addColumn(FAMILY, Bytes.toBytes(\"A\"))).isEmpty());\n   }\n \n+  @Test\n+  public void testCheckAndMutate_wrongMutationType() throws Throwable {", "originalCommit": "95dbd19b7ca237d3fc4f19cc9a95d2710526324d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NjAyNDIzOA==", "url": "https://github.com/apache/hbase/pull/1315#discussion_r396024238", "bodyText": "Thank you for reviewing this.\nYes, the new tests I added only catch exceptions, but I think we already have positive test cases for HRegion.checkAndMutate() and HRegion.checkAndRowMutate() originally.", "author": "brfrn169", "createdAt": "2020-03-21T20:00:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NTk5Nzg5Ng=="}], "type": "inlineReview"}]}