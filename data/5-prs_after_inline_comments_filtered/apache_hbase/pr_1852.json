{"pr_number": 1852, "pr_title": "HBASE-24505 Reimplement Hbck.setRegionStateInMeta", "pr_createdAt": "2020-06-04T13:04:17Z", "pr_url": "https://github.com/apache/hbase/pull/1852", "timeline": [{"oid": "6b6f67bcd68729eb27c6ca93c707826eeeb66a5f", "url": "https://github.com/apache/hbase/commit/6b6f67bcd68729eb27c6ca93c707826eeeb66a5f", "message": "HBASE-24505 Reimplement Hbck.setRegionStateInMeta", "committedDate": "2020-06-04T13:02:06Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMzNjkzMQ==", "url": "https://github.com/apache/hbase/pull/1852#discussion_r435336931", "bodyText": "Agreed. If we have how to resolve a full region name from only the encoded name. The motivation to allow only region encoded name is because that's what's easily available for operators, and normally reported on hbck/hbck2.", "author": "wchevreuil", "createdAt": "2020-06-04T15:13:59Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MasterRpcServices.java", "diffHunk": "@@ -2500,31 +2502,39 @@ public GetTableStateResponse setTableStateInMeta(RpcController controller,\n    * @return previous states of the regions\n    */\n   @Override\n-  public GetRegionStateInMetaResponse setRegionStateInMeta(RpcController controller,\n+  public SetRegionStateInMetaResponse setRegionStateInMeta(RpcController controller,\n     SetRegionStateInMetaRequest request) throws ServiceException {\n-    final GetRegionStateInMetaResponse.Builder builder = GetRegionStateInMetaResponse.newBuilder();\n-    for(ClusterStatusProtos.RegionState s : request.getStatesList()) {\n-      try {\n-        RegionInfo info = this.master.getAssignmentManager().\n-          loadRegionFromMeta(s.getRegionInfo().getRegionEncodedName());\n+    SetRegionStateInMetaResponse.Builder builder = SetRegionStateInMetaResponse.newBuilder();\n+    try {\n+      for (RegionSpecifierAndState s : request.getStatesList()) {\n+        RegionSpecifier spec = s.getRegionSpecifier();\n+        String encodedName;\n+        if (spec.getType() == RegionSpecifierType.ENCODED_REGION_NAME) {\n+          encodedName = spec.getValue().toStringUtf8();\n+        } else {\n+          // TODO: actually, a full region name can save a lot on meta scan, improve later.\n+          encodedName = RegionInfo.encodeRegionName(spec.getValue().toByteArray());", "originalCommit": "6b6f67bcd68729eb27c6ca93c707826eeeb66a5f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6de7a2120368aa77045f53993f1f4f10a38c6ceb", "url": "https://github.com/apache/hbase/commit/6de7a2120368aa77045f53993f1f4f10a38c6ceb", "message": "remove unused imports", "committedDate": "2020-06-04T15:26:00Z", "type": "commit"}]}