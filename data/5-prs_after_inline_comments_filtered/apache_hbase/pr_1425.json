{"pr_number": 1425, "pr_title": "HBASE-24105 [Flakey Test] regionserver.TestRegionReplicas", "pr_createdAt": "2020-04-03T00:53:20Z", "pr_url": "https://github.com/apache/hbase/pull/1425", "timeline": [{"oid": "07caef4c6e4ab8569fadfb7634c3efef34b1388e", "url": "https://github.com/apache/hbase/commit/07caef4c6e4ab8569fadfb7634c3efef34b1388e", "message": "HBASE-24105 [Flakey Test] regionserver.TestRegionReplicas", "committedDate": "2020-04-03T00:44:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4OTc3NA==", "url": "https://github.com/apache/hbase/pull/1425#discussion_r402689774", "bodyText": "Hmm.. Is it the finally that is wrong?\nHere we remove only if value matches FALSE. The finally removes whatever the value.\nBut I suppose no one else can add an entry while there is one in the map so the finally remove should be fine?", "author": "saintstack", "createdAt": "2020-04-03T01:38:43Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/handler/CloseRegionHandler.java", "diffHunk": "@@ -117,9 +117,7 @@ public void process() throws IOException {\n         HConstants.NO_SEQNUM, Procedure.NO_PROC_ID, -1, regionInfo));\n \n       // Done!  Region is closed on this RS\n-      this.rsServices.getRegionsInTransitionInRS().\n-        remove(this.regionInfo.getEncodedNameAsBytes(), Boolean.FALSE);\n-      LOG.debug(\"Closed {}\" + region.getRegionInfo().getRegionNameAsString());", "originalCommit": "07caef4c6e4ab8569fadfb7634c3efef34b1388e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzIyNzM2Nw==", "url": "https://github.com/apache/hbase/pull/1425#discussion_r403227367", "bodyText": "I think the state always messed up so you added this remove in the final branch. Need to dig out why this messes up.", "author": "huaxiangsun", "createdAt": "2020-04-03T18:31:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4OTc3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4NzI1OQ==", "url": "https://github.com/apache/hbase/pull/1425#discussion_r403387259", "bodyText": "@saintstack In this specific context, remove only if value matches FALSE or remove anyway is same. It enters in the loop with value FALSE and it wont be changed to TRUE(going through the code).", "author": "huaxiangsun", "createdAt": "2020-04-03T23:49:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4OTc3NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzM4NzQ1MA==", "url": "https://github.com/apache/hbase/pull/1425#discussion_r403387450", "bodyText": "Test failures are all due to timeout, I run the failed test cases locally with adhoc_run_tests.sh locally, it passed for me.", "author": "huaxiangsun", "createdAt": "2020-04-03T23:50:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjY4OTc3NA=="}], "type": "inlineReview"}]}