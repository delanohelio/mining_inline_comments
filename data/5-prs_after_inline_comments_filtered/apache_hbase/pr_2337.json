{"pr_number": 2337, "pr_title": "HBASE-24973 Remove read point parameter in method StoreFlush#performFlush and StoreFlush#createScanner", "pr_createdAt": "2020-09-01T02:20:21Z", "pr_url": "https://github.com/apache/hbase/pull/2337", "timeline": [{"oid": "bcef190636370bd82dd7415e703c7b86ebbcf530", "url": "https://github.com/apache/hbase/commit/bcef190636370bd82dd7415e703c7b86ebbcf530", "message": "HBASE-24973 Remove read point parameter in StoreFlush#performFlush", "committedDate": "2020-09-01T02:14:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA2OTI3Ng==", "url": "https://github.com/apache/hbase/pull/2337#discussion_r481069276", "bodyText": "Any reason for doing this?", "author": "virajjasani", "createdAt": "2020-09-01T11:31:45Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFlusher.java", "diffHunk": "@@ -73,20 +73,20 @@ protected void finalizeWriter(StoreFileWriter writer, long cacheFlushSeqNum,\n   /**\n    * Creates the scanner for flushing snapshot. Also calls coprocessors.\n    * @param snapshotScanners\n-   * @param smallestReadPoint\n    * @return The scanner; null if coprocessor is canceling the flush.\n    */\n   protected final InternalScanner createScanner(List<KeyValueScanner> snapshotScanners,\n-      long smallestReadPoint, FlushLifeCycleTracker tracker) throws IOException {\n+    FlushLifeCycleTracker tracker) throws IOException {\n     ScanInfo scanInfo;\n     if (store.getCoprocessorHost() != null) {\n       scanInfo = store.getCoprocessorHost().preFlushScannerOpen(store, tracker);\n     } else {\n       scanInfo = store.getScanInfo();\n     }\n+    final long smallestReadPoint = store.getSmallestReadPoint();\n     InternalScanner scanner = new StoreScanner(store, scanInfo, snapshotScanners,\n         ScanType.COMPACT_RETAIN_DELETES, smallestReadPoint, HConstants.OLDEST_TIMESTAMP);\n-    assert scanner != null;", "originalCommit": "bcef190636370bd82dd7415e703c7b86ebbcf530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTEzNzcxNQ==", "url": "https://github.com/apache/hbase/pull/2337#discussion_r481137715", "bodyText": "As far as I can see,\u00a0scanner can't be null here as it's a local variance, see below\nscanner = new StoreScanner(store, scanInfo, snapshotScanners,\n        ScanType.COMPACT_RETAIN_DELETES, smallestReadPoint, HConstants.OLDEST_TIMESTAMP);\n\nso i remove the assert logic here", "author": "yuqi1129", "createdAt": "2020-09-01T13:29:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA2OTI3Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE5MjMwMg==", "url": "https://github.com/apache/hbase/pull/2337#discussion_r481192302", "bodyText": "Perfect.", "author": "virajjasani", "createdAt": "2020-09-01T14:44:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTA2OTI3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0NzU1Ng==", "url": "https://github.com/apache/hbase/pull/2337#discussion_r481147556", "bodyText": "This remove the smallestReadPoint parameter from createScanner method, too? Change the issue title to talk about this?", "author": "infraio", "createdAt": "2020-09-01T13:43:25Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/StoreFlusher.java", "diffHunk": "@@ -73,20 +73,20 @@ protected void finalizeWriter(StoreFileWriter writer, long cacheFlushSeqNum,\n   /**\n    * Creates the scanner for flushing snapshot. Also calls coprocessors.\n    * @param snapshotScanners\n-   * @param smallestReadPoint\n    * @return The scanner; null if coprocessor is canceling the flush.\n    */\n   protected final InternalScanner createScanner(List<KeyValueScanner> snapshotScanners,\n-      long smallestReadPoint, FlushLifeCycleTracker tracker) throws IOException {", "originalCommit": "bcef190636370bd82dd7415e703c7b86ebbcf530", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE3NzIwNQ==", "url": "https://github.com/apache/hbase/pull/2337#discussion_r481177205", "bodyText": "OK, thanks a lot~", "author": "yuqi1129", "createdAt": "2020-09-01T14:24:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MTE0NzU1Ng=="}], "type": "inlineReview"}]}