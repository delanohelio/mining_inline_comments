{"pr_number": 1572, "pr_title": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logg\u2026", "pr_createdAt": "2020-04-23T22:32:16Z", "pr_url": "https://github.com/apache/hbase/pull/1572", "timeline": [{"oid": "a3bc430280cef2d4054647c3ed30776b281b9731", "url": "https://github.com/apache/hbase/commit/a3bc430280cef2d4054647c3ed30776b281b9731", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.", "committedDate": "2020-04-23T23:23:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDY4NQ==", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414190685", "bodyText": "If you like, ri -> ri.getShortNameToLog() can be replaced with method reference RegionInfo::getShortNameToLog. Same other places. Good to have class type before method so I personally prefer that.", "author": "liuml07", "createdAt": "2020-04-23T23:29:33Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/RegionInfo.java", "diffHunk": "@@ -304,12 +304,11 @@ static String getShortNameToLog(RegionInfo...hris) {\n   }\n \n   /**\n-   * @return Return a String of short, printable names for <code>hris</code>\n-   * (usually encoded name) for us logging.\n+   * @return Return a String of short, printable names for <code>hris</code> (usually encoded name)\n+   *   for us logging.\n    */\n   static String getShortNameToLog(final List<RegionInfo> ris) {\n-    return ris.stream().map(ri -> ri.getShortNameToLog()).\n-    collect(Collectors.toList()).toString();\n+    return ris.stream().map(ri -> ri.getShortNameToLog()).collect(Collectors.toList()).toString();", "originalCommit": "a3bc430280cef2d4054647c3ed30776b281b9731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMDQ1Mw==", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414200453", "bodyText": "Yes. Thats better. Let me fix.", "author": "saintstack", "createdAt": "2020-04-23T23:55:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDY4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDk1NQ==", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414190955", "bodyText": "Is currentMergeSet.size() also worth in the log message?", "author": "liuml07", "createdAt": "2020-04-23T23:30:24Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java", "diffHunk": "@@ -247,6 +247,10 @@ void fixOverlaps(CatalogJanitor.Report report) throws IOException {\n       if (regionInfoWithlargestEndKey != null) {\n         if (!isOverlap(regionInfoWithlargestEndKey, pair) ||\n             currentMergeSet.size() >= maxMergeCount) {\n+          // Log when we cut-off-merge because we hit the configured maximum merge limit.\n+          if (currentMergeSet.size() >= maxMergeCount) {\n+            LOG.warn(\"Ran into maximum-at-a-time merges limit={}\", maxMergeCount);", "originalCommit": "a3bc430280cef2d4054647c3ed30776b281b9731", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDIwMTUxMQ==", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414201511", "bodyText": "Not here.", "author": "saintstack", "createdAt": "2020-04-23T23:58:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MDk1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNDE5MTE4OQ==", "url": "https://github.com/apache/hbase/pull/1572#discussion_r414191189", "bodyText": "Not sure if you like String.format.", "author": "liuml07", "createdAt": "2020-04-23T23:30:59Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -134,8 +132,8 @@ private static void checkRegionsToMerge(MasterProcedureEnv env, final RegionInfo\n           throw new MergeRegionException(msg);\n         }\n         if (!force && !ri.isAdjacent(previous) && !ri.isOverlap(previous)) {\n-          String msg = \"Unable to merge non-adjacent or non-overlapping regions \" +\n-              previous.getShortNameToLog() + \", \" + ri.getShortNameToLog() + \" when force=false\";\n+          String msg = \"Unable to merge non-adjacent or non-overlapping regions '\" +", "originalCommit": "a3bc430280cef2d4054647c3ed30776b281b9731", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6edff7c49f08558bf2989b930edabaff2c7819d8", "url": "https://github.com/apache/hbase/commit/6edff7c49f08558bf2989b930edabaff2c7819d8", "message": "Address Mingliang Liu liuml07 feedback", "committedDate": "2020-04-28T20:49:18Z", "type": "forcePushed"}, {"oid": "cf23bea1b34b9109db5a100b210eecaa5b508111", "url": "https://github.com/apache/hbase/commit/cf23bea1b34b9109db5a100b210eecaa5b508111", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback", "committedDate": "2020-04-29T00:29:13Z", "type": "forcePushed"}, {"oid": "1a5924a540808642125db5ab9c37472c15738ac0", "url": "https://github.com/apache/hbase/commit/1a5924a540808642125db5ab9c37472c15738ac0", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback", "committedDate": "2020-04-29T22:25:33Z", "type": "commit"}, {"oid": "1a5924a540808642125db5ab9c37472c15738ac0", "url": "https://github.com/apache/hbase/commit/1a5924a540808642125db5ab9c37472c15738ac0", "message": "HBASE-24246 Miscellaneous hbck2 fixMeta bulk merge fixes: better logging around merges/overlap-fixing, 'HBCK Report' overlap listing, and configuration\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java\n Fix weird brackets around each region name when logging.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/MetaFixer.java\n  Log when we hit the max merge limit. Also up limit to 64.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java\n Make logs make more sense to operator.\n\nhbase-server/src/main/resources/hbase-webapps/master/hbck.jsp\n Make RegionName show when you mouseover so long names don't mess up\n display of holes and overlaps.\n\nAddress Mingliang Liu liuml07 feedback", "committedDate": "2020-04-29T22:25:33Z", "type": "forcePushed"}]}