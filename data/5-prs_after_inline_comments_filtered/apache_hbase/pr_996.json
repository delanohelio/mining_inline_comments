{"pr_number": 996, "pr_title": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish", "pr_createdAt": "2020-01-07T12:22:45Z", "pr_url": "https://github.com/apache/hbase/pull/996", "timeline": [{"oid": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "url": "https://github.com/apache/hbase/commit/21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish", "committedDate": "2020-01-08T00:06:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDU5Ng==", "url": "https://github.com/apache/hbase/pull/996#discussion_r364034596", "bodyText": "Does this method work for meta table? I'm not sure, just asking. As lots of the methods in HBTU just read the meta table so can not be used to test meta table itself...", "author": "Apache9", "createdAt": "2020-01-08T01:54:55Z", "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupsKillRS.java", "diffHunk": "@@ -237,12 +238,12 @@ public void testLowerMetaGroupVersion() throws Exception{\n     addGroup(groupName, groupRSCount);\n \n     // move hbase:meta to meta_group\n-    tableName = TableName.META_TABLE_NAME;\n     Set<TableName> toAddTables = new HashSet<>();\n-    toAddTables.add(tableName);\n+    toAddTables.add(TableName.META_TABLE_NAME);\n     rsGroupAdmin.moveTables(toAddTables, groupName);\n-    assertTrue(rsGroupAdmin.getRSGroupInfo(groupName).getTables().contains(tableName));\n-    TEST_UTIL.waitTableAvailable(tableName, 30000);\n+    assertTrue(\n+        rsGroupAdmin.getRSGroupInfo(groupName).getTables().contains(TableName.META_TABLE_NAME));\n+    TEST_UTIL.waitUntilAllRegionsAssigned(TableName.META_TABLE_NAME, 30000);", "originalCommit": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDY4Ng==", "url": "https://github.com/apache/hbase/pull/996#discussion_r364034686", "bodyText": "So this is the root cause.", "author": "Apache9", "createdAt": "2020-01-08T01:55:22Z", "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupsKillRS.java", "diffHunk": "@@ -268,7 +269,9 @@ public void testLowerMetaGroupVersion() throws Exception{\n     assertTrue(VersionInfo.compareVersion(originVersion,\n         master.getRegionServerVersion(getServerName(servers.iterator().next()))) > 0);\n     LOG.debug(\"wait for META assigned...\");\n-    TEST_UTIL.waitTableAvailable(tableName, 30000);\n+    TEST_UTIL.waitFor(60000, () -> !TEST_UTIL.getHBaseCluster().getMaster().getProcedures().stream()", "originalCommit": "21ebfb9e6c2b51f7eca2041f2b26ab3386948216", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDA0MDc0Ng==", "url": "https://github.com/apache/hbase/pull/996#discussion_r364040746", "bodyText": "Yes. This is the root cause. In my test, the waitUntilAllRegionsAssigned and waitTableAvailable not worked for meta table...", "author": "infraio", "createdAt": "2020-01-08T02:28:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDAzNDY4Ng=="}], "type": "inlineReview"}, {"oid": "78226d32688de3d8eb0a3160aa7e60992bd55aca", "url": "https://github.com/apache/hbase/commit/78226d32688de3d8eb0a3160aa7e60992bd55aca", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish", "committedDate": "2020-01-08T04:01:28Z", "type": "commit"}, {"oid": "78226d32688de3d8eb0a3160aa7e60992bd55aca", "url": "https://github.com/apache/hbase/commit/78226d32688de3d8eb0a3160aa7e60992bd55aca", "message": "HBASE-23655 Fix flaky TestRSGroupsKillRS: should wait the SCP to finish", "committedDate": "2020-01-08T04:01:28Z", "type": "forcePushed"}]}