{"pr_number": 1165, "pr_title": "HBASE-22514 Move rsgroup feature into core of HBase", "pr_createdAt": "2020-02-12T02:54:12Z", "pr_url": "https://github.com/apache/hbase/pull/1165", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQzODk3MQ==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378438971", "bodyText": "Do we still need 'RS'? Should this be addGroup or addRegionServerGroup?", "author": "saintstack", "createdAt": "2020-02-12T18:39:35Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -2262,4 +2265,104 @@ boolean snapshotCleanupSwitch(final boolean on, final boolean synchronous)\n    */\n   boolean isSnapshotCleanupEnabled() throws IOException;\n \n+  /**\n+   * Creates a new RegionServer group with the given name\n+   * @param groupName the name of the group\n+   * @throws IOException if a remote or network exception occurs\n+   */\n+  void addRSGroup(String groupName) throws IOException;", "originalCommit": "d8273b8910a17095f34df446bc1d43676f032812", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQzOTYxNw==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378439617", "bodyText": "Hmm... Yeah, Group is too generic so s/RS/RegionGroup/ ? Big change I suppose.", "author": "saintstack", "createdAt": "2020-02-12T18:40:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQzODk3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYwMTczMA==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378601730", "bodyText": "The IA.Public data structure is call RSGroupInfo so...", "author": "Apache9", "createdAt": "2020-02-13T01:09:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQzODk3MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4Njg4Mw==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r383986883", "bodyText": "Ok. So, your argument is that folks using current data structures and methods will have an easier time if the names of methods, etc., have same basic pattern in the new context.\nOk.", "author": "saintstack", "createdAt": "2020-02-25T16:20:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQzODk3MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0MDE4Nw==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378440187", "bodyText": "Purge 'Configured' from this method name?", "author": "saintstack", "createdAt": "2020-02-12T18:41:52Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/client/Admin.java", "diffHunk": "@@ -2262,4 +2265,104 @@ boolean snapshotCleanupSwitch(final boolean on, final boolean synchronous)\n    */\n   boolean isSnapshotCleanupEnabled() throws IOException;\n \n+  /**\n+   * Creates a new RegionServer group with the given name\n+   * @param groupName the name of the group\n+   * @throws IOException if a remote or network exception occurs\n+   */\n+  void addRSGroup(String groupName) throws IOException;\n+\n+  /**\n+   * Get group info for the given group name\n+   * @param groupName the group name\n+   * @return group info\n+   * @throws IOException if a remote or network exception occurs\n+   */\n+  RSGroupInfo getRSGroup(String groupName) throws IOException;\n+\n+  /**\n+   * Get group info for the given hostPort\n+   * @param hostPort HostPort to get RSGroupInfo for\n+   * @throws IOException if a remote or network exception occurs\n+   */\n+  RSGroupInfo getRSGroup(Address hostPort) throws IOException;\n+\n+  /**\n+   * Get group info for the given table\n+   * @param tableName table name to get RSGroupInfo for\n+   * @throws IOException if a remote or network exception occurs\n+   */\n+  RSGroupInfo getRSGroup(TableName tableName) throws IOException;\n+\n+  /**\n+   * Lists current set of RegionServer groups\n+   * @throws IOException if a remote or network exception occurs\n+   */\n+  List<RSGroupInfo> listRSGroups() throws IOException;\n+\n+  /**\n+   * Get all tables in this RegionServer group.\n+   * @param groupName the group name\n+   * @throws IOException if a remote or network exception occurs\n+   * @see #getConfiguredNamespacesAndTablesInRSGroup(String)\n+   */\n+  List<TableName> listTablesInRSGroup(String groupName) throws IOException;\n+\n+  /**\n+   * Get the namespaces and tables which have this RegionServer group in descriptor.\n+   * <p/>\n+   * The difference between this method and {@link #listTablesInRSGroup(String)} is that, this\n+   * method will not include the table which is actually in this RegionServr group but without the\n+   * RegionServer group configuration in its {@link TableDescriptor}. For example, we have a group\n+   * 'A', and we make namespace 'nsA' in this group, then all the tables under this namespace will\n+   * in the group 'A', but this method will not return these tables but only the namespace 'nsA',\n+   * while the {@link #listTablesInRSGroup(String)} will return all these tables.\n+   * @param groupName the group name\n+   * @throws IOException if a remote or network exception occurs\n+   * @see #listTablesInRSGroup(String)\n+   */\n+  Pair<List<String>, List<TableName>> getConfiguredNamespacesAndTablesInRSGroup(String groupName)", "originalCommit": "d8273b8910a17095f34df446bc1d43676f032812", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODYwMTU3Mg==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378601572", "bodyText": "But it is the 'configured' namespaces and tables. For example, you have namespace 'N' under rs group 'R', this method will only return namespace 'N', and will not return the tables under namespace 'N'...", "author": "Apache9", "createdAt": "2020-02-13T01:09:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0MDE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzk4ODM4OA==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r383988388", "bodyText": "The 'Configure' seems redundant to me given the suffix on method name is 'InRSGroup'.", "author": "saintstack", "createdAt": "2020-02-25T16:22:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0MDE4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM4MDk4Nw==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r384380987", "bodyText": "There is a listTablesInRSGroup method above, which will all the tables in the rs group, including the tables which are included becasue of their namespace is configued to be in the rs group...", "author": "Apache9", "createdAt": "2020-02-26T09:49:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0MDE4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0NzM0Mg==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378447342", "bodyText": "This balancer acts like old balancer when RSGroups is off? If so, just rename RSGroupBasedLB as LB?", "author": "saintstack", "createdAt": "2020-02-12T18:55:18Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -382,7 +386,7 @@ public void run() {\n \n   private final LockManager lockManager = new LockManager(this);\n \n-  private LoadBalancer balancer;\n+  private RSGroupBasedLoadBalancer balancer;", "originalCommit": "d8273b8910a17095f34df446bc1d43676f032812", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODQ0ODE2Nw==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r378448167", "bodyText": "Yeah, can't just return 'LoadBalancer' only now LB handles RSGroups too? (Maybe not possible for RSGroupLB...)", "author": "saintstack", "createdAt": "2020-02-12T18:56:44Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3498,13 +3511,13 @@ public SplitOrMergeTracker getSplitOrMergeTracker() {\n   }\n \n   @Override\n-  public LoadBalancer getLoadBalancer() {\n+  public RSGroupBasedLoadBalancer getLoadBalancer() {", "originalCommit": "d8273b8910a17095f34df446bc1d43676f032812", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "22af74e46b42fda16cddde4c4653e42e6aa9177f", "url": "https://github.com/apache/hbase/commit/22af74e46b42fda16cddde4c4653e42e6aa9177f", "message": "HBASE-23818 Cleanup the remaining RSGroupInfo.getTables call in the code base (#1152)\n\nSigned-off-by: stack <stack@apache.org>\r\nSigned-off-by: Viraj Jasani <vjasani@apache.org>", "committedDate": "2020-02-20T09:31:30Z", "type": "forcePushed"}, {"oid": "4e724329aaab955832da313fc7be14b9db94bbb2", "url": "https://github.com/apache/hbase/commit/4e724329aaab955832da313fc7be14b9db94bbb2", "message": "HBASE-23818 Cleanup the remaining RSGroupInfo.getTables call in the code base (#1152)\n\nSigned-off-by: stack <stack@apache.org>\r\nSigned-off-by: Viraj Jasani <vjasani@apache.org>", "committedDate": "2020-02-22T12:25:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxODI5OQ==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r382918299", "bodyText": "Can we avoid changing the method signature on this IA.Public method?", "author": "busbey", "createdAt": "2020-02-22T14:59:08Z", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/rsgroup/RSGroupInfo.java", "diffHunk": "@@ -87,7 +102,7 @@ public boolean containsServer(Address hostPort) {\n   /**\n    * Get list of servers.\n    */\n-  public Set<Address> getServers() {\n+  public SortedSet<Address> getServers() {", "originalCommit": "4e724329aaab955832da313fc7be14b9db94bbb2", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDM3NzQ5Mg==", "url": "https://github.com/apache/hbase/pull/1165#discussion_r384377492", "bodyText": "I think this one is fine? SortedSet is Set, and this is a new major release", "author": "Apache9", "createdAt": "2020-02-26T09:43:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjkxODI5OQ=="}], "type": "inlineReview"}, {"oid": "77b24fd007a583cd37082edde94dbf6b67c6e0c6", "url": "https://github.com/apache/hbase/commit/77b24fd007a583cd37082edde94dbf6b67c6e0c6", "message": "HBASE-23818 Cleanup the remaining RSGroupInfo.getTables call in the code base (#1152)\n\nSigned-off-by: stack <stack@apache.org>\r\nSigned-off-by: Viraj Jasani <vjasani@apache.org>", "committedDate": "2020-02-25T08:28:16Z", "type": "forcePushed"}, {"oid": "1d8e3b70328f4720ff5f44a42a6b7392dd5408a3", "url": "https://github.com/apache/hbase/commit/1d8e3b70328f4720ff5f44a42a6b7392dd5408a3", "message": "HBASE-23818 Cleanup the remaining RSGroupInfo.getTables call in the code base (#1152)\n\nSigned-off-by: stack <stack@apache.org>\r\nSigned-off-by: Viraj Jasani <vjasani@apache.org>", "committedDate": "2020-02-26T11:11:26Z", "type": "forcePushed"}, {"oid": "1a3f4470b9ae2f909def02ba1543419865f76ce7", "url": "https://github.com/apache/hbase/commit/1a3f4470b9ae2f909def02ba1543419865f76ce7", "message": "HBASE-22664 Move protobuf stuff in hbase-rsgroup to hbase-protocol-shaded (#362)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "522a981dfe109b942b22976c5a97a5b389e7f1e2", "url": "https://github.com/apache/hbase/commit/522a981dfe109b942b22976c5a97a5b389e7f1e2", "message": "HBASE-22662 Move RSGroupInfoManager to hbase-server (#368)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "0927140279705e8115e7d55df8fe2ba981d3b176", "url": "https://github.com/apache/hbase/commit/0927140279705e8115e7d55df8fe2ba981d3b176", "message": "HBASE-22676 Move all the code in hbase-rsgroup to hbase-server and remove hbase-rsgroup module (#399)\n\nSigned-off-by: Zheng Hu <openinx@gmail.com>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "508b12f7d858659912d9862f6675a64988e6a01f", "url": "https://github.com/apache/hbase/commit/508b12f7d858659912d9862f6675a64988e6a01f", "message": "HBASE-22695 Store the rsgroup of a table in table configuration (#426)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "5d507888ee55761033e8ff3f4534e2d2d2e7c00e", "url": "https://github.com/apache/hbase/commit/5d507888ee55761033e8ff3f4534e2d2d2e7c00e", "message": "HBASE-22809 Allow creating table in group when rs group contains no live servers (#464)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "3f576c621dcfbd293dab93097184e791ee2bf625", "url": "https://github.com/apache/hbase/commit/3f576c621dcfbd293dab93097184e791ee2bf625", "message": "HBASE-22820 Do not need to persist default rs group now (#482)\n\nSigned-off-by: Duo Zhang <zhangduo@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "7512445aa62ec57a06e07836de8a05426e35b2e1", "url": "https://github.com/apache/hbase/commit/7512445aa62ec57a06e07836de8a05426e35b2e1", "message": "HBASE-22819 Automatically migrate the rs group config for table after HBASE-22695 (#498)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "036cf2738a4a17fa449d30ccf5fd09f7101da1de", "url": "https://github.com/apache/hbase/commit/036cf2738a4a17fa449d30ccf5fd09f7101da1de", "message": "HBASE-22729 Start RSGroupInfoManager as default (#555)\n\nAmending-Author: Duo Zhang <zhangduo@apache.org>\nSigned-off-by: stack <stack@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "79aa5061087f403d9f88391e3f1293d7e579a33c", "url": "https://github.com/apache/hbase/commit/79aa5061087f403d9f88391e3f1293d7e579a33c", "message": "HBASE-22987 Calculate the region servers in default group in foreground (#599)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "009bba8d7c65a1280b1a120a6395200a8df3a6c2", "url": "https://github.com/apache/hbase/commit/009bba8d7c65a1280b1a120a6395200a8df3a6c2", "message": "HBASE-22971 Deprecated RSGroupAdminEndpoint and make RSGroup feature always enabled (#595)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "3fdfa44ab919c9d82d9f947c7e31a7023e34f391", "url": "https://github.com/apache/hbase/commit/3fdfa44ab919c9d82d9f947c7e31a7023e34f391", "message": "HBASE-23081 Add an option to enable/disable rs group feature (#691)\n\nSigned-off-by: Peter Somogyi <psomogyi@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "8b134514c73ded230958858da2559e1ac03ec893", "url": "https://github.com/apache/hbase/commit/8b134514c73ded230958858da2559e1ac03ec893", "message": "HBASE-23232 Remove rsgroup profile from pom.xml of hbase-assembly (#779)", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "8a63133b90170a69828432f64b98178cf3dc681d", "url": "https://github.com/apache/hbase/commit/8a63133b90170a69828432f64b98178cf3dc681d", "message": "HBASE-23050 Use RSGroupInfoManager to get rsgroups in master UI's rsgroup part (#776)\n\nSigned-off-by: Duo Zhang <zhangduo@apache.org>", "committedDate": "2020-02-29T01:25:35Z", "type": "commit"}, {"oid": "99427c63953f6f0888bc5e1ed38635546235aafe", "url": "https://github.com/apache/hbase/commit/99427c63953f6f0888bc5e1ed38635546235aafe", "message": "HBASE-22932 Add rs group management methods in Admin and AsyncAdmin (#657)\n\nSigned-off-by: Duo Zhang <zhangduo@apache.org>", "committedDate": "2020-02-29T01:42:19Z", "type": "commit"}, {"oid": "ae5ae3788242ed48c9882a8df13e5261ea675398", "url": "https://github.com/apache/hbase/commit/ae5ae3788242ed48c9882a8df13e5261ea675398", "message": "HBASE-23253 Rewrite rsgroup related UTs with the new methods introduced in HBASE-22932 (#813)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:53:42Z", "type": "commit"}, {"oid": "898e44ca0c81d96b3b1b8476cf863f051a5b845a", "url": "https://github.com/apache/hbase/commit/898e44ca0c81d96b3b1b8476cf863f051a5b845a", "message": "HBASE-23235 Re-enable TestRSGroupsKillRS.testLowerMetaGroupVersion (#1117)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T01:53:42Z", "type": "commit"}, {"oid": "91ab4e2d7358441dc6243bfef6ee1a07a7304475", "url": "https://github.com/apache/hbase/commit/91ab4e2d7358441dc6243bfef6ee1a07a7304475", "message": "HBASE-23276 Add admin methods to get tables within a group (#1118)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T02:14:55Z", "type": "commit"}, {"oid": "3441f993f9297330d4f4b17ebb2215ea46420e99", "url": "https://github.com/apache/hbase/commit/3441f993f9297330d4f4b17ebb2215ea46420e99", "message": "HBASE-23807 Make rsgroup related shell command to use the new admin methods (#1148)\n\nSigned-off-by: stack <stack@apache.org>", "committedDate": "2020-02-29T02:15:01Z", "type": "commit"}, {"oid": "d643d8a631417df2d930eaf483eef030cfb218dc", "url": "https://github.com/apache/hbase/commit/d643d8a631417df2d930eaf483eef030cfb218dc", "message": "HBASE-23818 Cleanup the remaining RSGroupInfo.getTables call in the code base (#1152)\n\nSigned-off-by: stack <stack@apache.org>\r\nSigned-off-by: Viraj Jasani <vjasani@apache.org>", "committedDate": "2020-02-29T02:15:01Z", "type": "commit"}, {"oid": "e088ef652170aaaa112c95623f3f6f77165b9fa2", "url": "https://github.com/apache/hbase/commit/e088ef652170aaaa112c95623f3f6f77165b9fa2", "message": "HBASE-23890 Update the rsgroup section in our ref guide (#1206)\n\nSigned-off-by: Sean Busbey <busbey@apache.org>", "committedDate": "2020-02-29T02:15:01Z", "type": "commit"}, {"oid": "e088ef652170aaaa112c95623f3f6f77165b9fa2", "url": "https://github.com/apache/hbase/commit/e088ef652170aaaa112c95623f3f6f77165b9fa2", "message": "HBASE-23890 Update the rsgroup section in our ref guide (#1206)\n\nSigned-off-by: Sean Busbey <busbey@apache.org>", "committedDate": "2020-02-29T02:15:01Z", "type": "forcePushed"}, {"oid": "b0d048e82b00e454673f02010bd76807bcacc658", "url": "https://github.com/apache/hbase/commit/b0d048e82b00e454673f02010bd76807bcacc658", "message": "HBASE-23911 Attach the new rsgroup implementation design doc to our code base (#1224)\n\nSigned-off-by: Guanghao Zhang <zghao@apache.org>", "committedDate": "2020-02-29T02:38:32Z", "type": "commit"}]}