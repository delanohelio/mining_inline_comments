{"pr_number": 1182, "pr_title": "HBASE-23864 No need to submit SplitTableRegionProcedure/MergeTableReg\u2026", "pr_createdAt": "2020-02-18T08:05:32Z", "pr_url": "https://github.com/apache/hbase/pull/1182", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw==", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380521047", "bodyText": "You can add extra checks before scheduling the procedure to make the request fail fast, but I do not think we should remove the checks in the procedure? There could be race, that when scheduling, split and merge are enabled but when you actually execute the procedure, the flags are turned to disabled...", "author": "Apache9", "createdAt": "2020-02-18T08:32:08Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/assignment/MergeTableRegionsProcedure.java", "diffHunk": "@@ -453,13 +453,6 @@ private boolean prepareMergeRegion(final MasterProcedureEnv env) throws IOExcept\n       throw new MergeRegionException(\"Skip merging regions \" +\n           RegionInfo.getShortNameToLog(regionsToMerge) + \", because we are snapshotting \" + tn);\n     }\n-    if (!env.getMasterServices().isSplitOrMergeEnabled(MasterSwitchType.MERGE)) {", "originalCommit": "950d0d7c7596eb984dfe37593765652fbe550f55", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyNDEzOA==", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380524138", "bodyText": "Agree with Duo, others are good.", "author": "binlijin", "createdAt": "2020-02-18T08:38:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUzMDgwMg==", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380530802", "bodyText": "I thought the race is not a big deal? And our admin client never have this guarantee: interrupt the schduled Split/Merge after split/merge is disabled.", "author": "infraio", "createdAt": "2020-02-18T08:52:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUzMjMxMw==", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380532313", "bodyText": "But split and merge can be scheduled by background task? And also, if you remove the checks here, then you need to add the check everywhere...", "author": "Apache9", "createdAt": "2020-02-18T08:55:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUzNDAxMQ==", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380534011", "bodyText": "Yes. I checked this. Now only two place can schedule split/merge task. One is the rpc request of master. Another one is from RS's report.", "author": "infraio", "createdAt": "2020-02-18T08:58:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDU2NDU0NA==", "url": "https://github.com/apache/hbase/pull/1182#discussion_r380564544", "bodyText": "But if in the future we schedule these procedures in other places, we need to add the check there...", "author": "Apache9", "createdAt": "2020-02-18T09:52:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDUyMTA0Nw=="}], "type": "inlineReview"}, {"oid": "76d1db861716d9185b72a57033369a4caa4344ed", "url": "https://github.com/apache/hbase/commit/76d1db861716d9185b72a57033369a4caa4344ed", "message": "HBASE-23864 No need to submit SplitTableRegionProcedure/MergeTableRegionsProcedure when split/merge is disabled", "committedDate": "2020-02-18T13:34:01Z", "type": "forcePushed"}, {"oid": "719550bf605e34da128b8258a7fc5947f42891db", "url": "https://github.com/apache/hbase/commit/719550bf605e34da128b8258a7fc5947f42891db", "message": "HBASE-23864 No need to submit SplitTableRegionProcedure/MergeTableRegionsProcedure when split/merge is disabled", "committedDate": "2020-02-18T23:37:33Z", "type": "forcePushed"}, {"oid": "ab99ea6332b786b05acae01c0f484cb79e1db310", "url": "https://github.com/apache/hbase/commit/ab99ea6332b786b05acae01c0f484cb79e1db310", "message": "HBASE-23864 No need to submit SplitTableRegionProcedure/MergeTableRegionsProcedure when split/merge is disabled", "committedDate": "2020-02-18T23:40:08Z", "type": "commit"}, {"oid": "ab99ea6332b786b05acae01c0f484cb79e1db310", "url": "https://github.com/apache/hbase/commit/ab99ea6332b786b05acae01c0f484cb79e1db310", "message": "HBASE-23864 No need to submit SplitTableRegionProcedure/MergeTableRegionsProcedure when split/merge is disabled", "committedDate": "2020-02-18T23:40:08Z", "type": "forcePushed"}]}