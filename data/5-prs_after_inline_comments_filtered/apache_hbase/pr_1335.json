{"pr_number": 1335, "pr_title": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0", "pr_createdAt": "2020-03-24T03:23:39Z", "pr_url": "https://github.com/apache/hbase/pull/1335", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyNTYyMQ==", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397525621", "bodyText": "nit: path is not an instance of String, so auto-type-conversion means this will call path.toString() even when debug is not enabled. That method looks entirely too complicated, with lots of branching, but I guess nothing too hateful. Just and FYI.", "author": "ndimiduk", "createdAt": "2020-03-24T23:36:44Z", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -525,10 +518,7 @@ private static void invokeSetStoragePolicy(final FileSystem fs, final Path path,\n \n     try {\n       fs.setStoragePolicy(path, storagePolicy);\n-\n-      if (LOG.isDebugEnabled()) {\n-        LOG.debug(\"Set storagePolicy={} for path={}\", storagePolicy, path);\n-      }\n+      LOG.debug(\"Set storagePolicy={} for path={}\", storagePolicy, path);", "originalCommit": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyODg3NA==", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397528874", "bodyText": "DistributedFileSystem appears to exist since 2.10, so can this string be built from a class reference? For example,\nString buildName = DistributedFileSystem.class.getName() + \"$HdfsDataOutputStreamBuilder\";\nLooks like hbase-common module doesn't depend on hadoop-hdfs-client jar, so maybe this gets too weird for a \"cleanup\" patch. Would be nice though, to use whatever static references we can...", "author": "ndimiduk", "createdAt": "2020-03-24T23:46:37Z", "path": "hbase-common/src/main/java/org/apache/hadoop/hbase/util/CommonFSUtils.java", "diffHunk": "@@ -759,200 +739,75 @@ public static void checkShortCircuitReadBufferSize(final Configuration conf) {\n     conf.setIfUnset(dfsKey, Integer.toString(hbaseSize));\n   }\n \n-  private static class DfsBuilderUtility {\n-    static Class<?> dfsClass = null;\n-    static Method createMethod;\n-    static Method overwriteMethod;\n-    static Method bufferSizeMethod;\n-    static Method blockSizeMethod;\n-    static Method recursiveMethod;\n-    static Method replicateMethod;\n-    static Method replicationMethod;\n-    static Method buildMethod;\n-    static boolean allMethodsPresent = false;\n+  private static final class DfsBuilderUtility {\n+    private static final Class<?> BUILDER;\n+    private static final Method REPLICATE;\n \n     static {\n-      String dfsName = \"org.apache.hadoop.hdfs.DistributedFileSystem\";\n-      String builderName = dfsName + \"$HdfsDataOutputStreamBuilder\";\n+      String builderName = \"org.apache.hadoop.hdfs.DistributedFileSystem$HdfsDataOutputStreamBuilder\";", "originalCommit": "142cc8f83886e0b27a15fc9bddf9e4fbe4a823a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzU4ODY1Mw==", "url": "https://github.com/apache/hbase/pull/1335#discussion_r397588653", "bodyText": "Yes, hbase-common only depends on hadoop-common so we can only access FileSystem, not DistributedFileSystem. I tried to move this method to hbase-server but then I realized that we also use this method in hbase-procedure, so leave it as is for now. The WALProcedureStore is supposed to be removed in 4.0.0, let's revive this again at that time...", "author": "Apache9", "createdAt": "2020-03-25T03:22:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NzUyODg3NA=="}], "type": "inlineReview"}, {"oid": "500142824de58eb4f7b81a55fba0f3fc4f56c383", "url": "https://github.com/apache/hbase/commit/500142824de58eb4f7b81a55fba0f3fc4f56c383", "message": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0", "committedDate": "2020-03-26T02:37:33Z", "type": "commit"}, {"oid": "500142824de58eb4f7b81a55fba0f3fc4f56c383", "url": "https://github.com/apache/hbase/commit/500142824de58eb4f7b81a55fba0f3fc4f56c383", "message": "HBASE-24000 Simplify CommonFSUtils after upgrading to hadoop 2.10.0", "committedDate": "2020-03-26T02:37:33Z", "type": "forcePushed"}]}