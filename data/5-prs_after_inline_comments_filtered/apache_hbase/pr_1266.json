{"pr_number": 1266, "pr_title": "HBASE-23956 Use less resources running tests", "pr_createdAt": "2020-03-10T16:56:41Z", "pr_url": "https://github.com/apache/hbase/pull/1266", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3NjM3NQ==", "url": "https://github.com/apache/hbase/pull/1266#discussion_r390676375", "bodyText": "This is not the design...\nThe design is to create a new EventLoop and make the code use it.\nChange a configuration to change the 'default' instance and then make the code use the 'default' instance seems strange...\nAnd also another anti pattern is that, we even do not have a Configuration instance here...", "author": "Apache9", "createdAt": "2020-03-10T23:54:31Z", "path": "hbase-client/src/main/java/org/apache/hadoop/hbase/ipc/DefaultNettyEventLoopConfig.java", "diffHunk": "@@ -31,10 +30,16 @@\n  */\n @InterfaceAudience.Private\n class DefaultNettyEventLoopConfig {", "originalCommit": "2073d240679dade6036d031e021646ff7113d2a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3OTg0MQ==", "url": "https://github.com/apache/hbase/pull/1266#discussion_r390679841", "bodyText": "Or let's just remove this class. Move the creation of event loop into the NettyRpcClientConfigHelper directly and honor the hbase.netty.worker.count configuration when creating? Though a bit strange is that the Configuration passed in may change but at least it can avoid reading the configuration from system property...", "author": "Apache9", "createdAt": "2020-03-11T00:06:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3NjM3NQ=="}], "type": "inlineReview"}, {"oid": "b7ebaae98978699b7789669e8ad604ab588e0ba1", "url": "https://github.com/apache/hbase/commit/b7ebaae98978699b7789669e8ad604ab588e0ba1", "message": "HBASE-23956 Use less resources running tests\n\nAdd being able to configure netty thread counts. Enable socket reuse\n(should not have any impact).\n\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/BlockingRpcConnection.java\n Rename the threads we create in here so they are NOT named same was\n threads created by Hadoop RPC.\n\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/DefaultNettyEventLoopConfig.java\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcClient.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AsyncFSWAL.java\n Allow configuring eventloopgroup thread count (so can override for\n tests)\n\nhbase-examples/src/main/java/org/apache/hadoop/hbase/client/example/HttpProxyExample.java\n Enable socket resuse.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcServer.java\n Enable socket resuse and config for how many threads to use.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/util/ModifyRegionUtils.java\n Thread name edit; drop the redundant 'Thread' suffix.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HFileReplicator.java\n Make closeable and shutdown executor when called.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java\n Call close on HFileReplicator\n\nhbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationBase.java\n HDFS creates lots of threads. Use less of it so less threads overall.\n\nhbase-server/src/test/resources/hbase-site.xml\nhbase-server/src/test/resources/hdfs-site.xml\n Constrain resources when running in test context.\n\nhbase-server/src/test/resources/log4j.properties\n Enable debug on netty to see netty configs in our log\n\npom.xml\n Add system properties when we launch JVMs to constrain thread counts in\n tests", "committedDate": "2020-03-11T05:53:44Z", "type": "forcePushed"}, {"oid": "c12d53fa4b36ae9f64ea55eaacfe0dcc05545832", "url": "https://github.com/apache/hbase/commit/c12d53fa4b36ae9f64ea55eaacfe0dcc05545832", "message": "HBASE-23956 Use less resources running tests\n\nAdd being able to configure netty thread counts. Enable socket reuse\n(should not have any impact).\n\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/BlockingRpcConnection.java\n Rename the threads we create in here so they are NOT named same was\n threads created by Hadoop RPC.\n\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/DefaultNettyEventLoopConfig.java\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcClient.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AsyncFSWAL.java\n Allow configuring eventloopgroup thread count (so can override for\n tests)\n\nhbase-examples/src/main/java/org/apache/hadoop/hbase/client/example/HttpProxyExample.java\n Enable socket resuse.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcServer.java\n Enable socket resuse and config for how many threads to use.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/util/ModifyRegionUtils.java\n Thread name edit; drop the redundant 'Thread' suffix.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HFileReplicator.java\n Make closeable and shutdown executor when called.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java\n Call close on HFileReplicator\n\nhbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationBase.java\n HDFS creates lots of threads. Use less of it so less threads overall.\n\nhbase-server/src/test/resources/hbase-site.xml\nhbase-server/src/test/resources/hdfs-site.xml\n Constrain resources when running in test context.\n\nhbase-server/src/test/resources/log4j.properties\n Enable debug on netty to see netty configs in our log\n\npom.xml\n Add system properties when we launch JVMs to constrain thread counts in\n tests", "committedDate": "2020-03-11T15:07:36Z", "type": "commit"}, {"oid": "c12d53fa4b36ae9f64ea55eaacfe0dcc05545832", "url": "https://github.com/apache/hbase/commit/c12d53fa4b36ae9f64ea55eaacfe0dcc05545832", "message": "HBASE-23956 Use less resources running tests\n\nAdd being able to configure netty thread counts. Enable socket reuse\n(should not have any impact).\n\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/BlockingRpcConnection.java\n Rename the threads we create in here so they are NOT named same was\n threads created by Hadoop RPC.\n\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/DefaultNettyEventLoopConfig.java\nhbase-client/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcClient.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/wal/AsyncFSWAL.java\n Allow configuring eventloopgroup thread count (so can override for\n tests)\n\nhbase-examples/src/main/java/org/apache/hadoop/hbase/client/example/HttpProxyExample.java\n Enable socket resuse.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/ipc/NettyRpcServer.java\n Enable socket resuse and config for how many threads to use.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HStore.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/regionserver/HRegion.java\nhbase-server/src/main/java/org/apache/hadoop/hbase/util/ModifyRegionUtils.java\n Thread name edit; drop the redundant 'Thread' suffix.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/HFileReplicator.java\n Make closeable and shutdown executor when called.\n\nhbase-server/src/main/java/org/apache/hadoop/hbase/replication/regionserver/ReplicationSink.java\n Call close on HFileReplicator\n\nhbase-server/src/test/java/org/apache/hadoop/hbase/replication/TestReplicationBase.java\n HDFS creates lots of threads. Use less of it so less threads overall.\n\nhbase-server/src/test/resources/hbase-site.xml\nhbase-server/src/test/resources/hdfs-site.xml\n Constrain resources when running in test context.\n\nhbase-server/src/test/resources/log4j.properties\n Enable debug on netty to see netty configs in our log\n\npom.xml\n Add system properties when we launch JVMs to constrain thread counts in\n tests", "committedDate": "2020-03-11T15:07:36Z", "type": "forcePushed"}]}