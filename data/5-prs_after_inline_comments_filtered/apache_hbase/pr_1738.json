{"pr_number": 1738, "pr_title": "HBASE-24399 [Flakey Tests] Some UTs about RSGroup should wait RSGroup\u2026", "pr_createdAt": "2020-05-19T13:35:16Z", "pr_url": "https://github.com/apache/hbase/pull/1738", "timeline": [{"oid": "5aeefbedb315185211f73d8433c827c1d6ae3567", "url": "https://github.com/apache/hbase/commit/5aeefbedb315185211f73d8433c827c1d6ae3567", "message": "HBASE-24399 [Flakey Tests] Some UTs about RSGroup should wait RSGroupInfoManager to be online", "committedDate": "2020-05-20T01:52:57Z", "type": "commit"}, {"oid": "5aeefbedb315185211f73d8433c827c1d6ae3567", "url": "https://github.com/apache/hbase/commit/5aeefbedb315185211f73d8433c827c1d6ae3567", "message": "HBASE-24399 [Flakey Tests] Some UTs about RSGroup should wait RSGroupInfoManager to be online", "committedDate": "2020-05-20T01:52:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxMzIxOA==", "url": "https://github.com/apache/hbase/pull/1738#discussion_r427713218", "bodyText": "Why this removed?", "author": "infraio", "createdAt": "2020-05-20T02:54:35Z", "path": "hbase-rsgroup/src/test/java/org/apache/hadoop/hbase/rsgroup/TestRSGroupUtil.java", "diffHunk": "@@ -57,39 +68,40 @@ public static void setUp() throws Exception {\n       RSGroupAdminEndpoint.class.getName());\n     UTIL.startMiniCluster(5);\n     master = UTIL.getMiniHBaseCluster().getMaster();\n-    admin = UTIL.getAdmin();\n-    rsGroupAdminClient = new RSGroupAdminClient(UTIL.getConnection());\n \n-    HRegionServer rs = UTIL.getHBaseCluster().getRegionServer(0);\n-    rsGroupAdminClient.addRSGroup(GROUP_NAME);\n-    rsGroupAdminClient.moveServers(Collections.singleton(rs.getServerName().getAddress()), GROUP_NAME);\n-    admin.createNamespace(NamespaceDescriptor.create(NAMESPACE_NAME)\n-      .addConfiguration(RSGroupInfo.NAMESPACE_DESC_PROP_GROUP, GROUP_NAME)\n-      .build());\n+    UTIL.waitFor(60000, (Predicate<Exception>) () ->\n+        master.isInitialized() && ((RSGroupBasedLoadBalancer) master.getLoadBalancer()).isOnline());\n \n-    rsGroupInfoManager = RSGroupInfoManagerImpl.getInstance(master);\n-    rsGroupInfoManager.start();\n+    rsGroupAdminClient = new RSGroupAdminClient(UTIL.getConnection());\n+\n+    List<RSGroupAdminEndpoint> cps =\n+        master.getMasterCoprocessorHost().findCoprocessors(RSGroupAdminEndpoint.class);\n+    assertTrue(cps.size() > 0);\n+    rsGroupInfoManager = cps.get(0).getGroupInfoManager();\n   }\n \n   @AfterClass\n-  public static void tearDown() throws IOException {\n-    admin.deleteNamespace(NAMESPACE_NAME);", "originalCommit": "5aeefbedb315185211f73d8433c827c1d6ae3567", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxNzg5OA==", "url": "https://github.com/apache/hbase/pull/1738#discussion_r427717898", "bodyText": "namespace creation is redundant in this UT, so I removed the code related namespace", "author": "ddupg", "createdAt": "2020-05-20T03:14:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzcxMzIxOA=="}], "type": "inlineReview"}]}