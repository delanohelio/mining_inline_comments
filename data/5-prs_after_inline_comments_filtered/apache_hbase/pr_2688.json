{"pr_number": 2688, "pr_title": "HBASE-25311 UI throws NPE", "pr_createdAt": "2020-11-21T07:22:22Z", "pr_url": "https://github.com/apache/hbase/pull/2688", "timeline": [{"oid": "02368d95378df7d4fd6132f35c47079d86c2ae3e", "url": "https://github.com/apache/hbase/commit/02368d95378df7d4fd6132f35c47079d86c2ae3e", "message": "HBASE-25311 UI throws NPE", "committedDate": "2020-11-21T07:25:42Z", "type": "commit"}, {"oid": "02368d95378df7d4fd6132f35c47079d86c2ae3e", "url": "https://github.com/apache/hbase/commit/02368d95378df7d4fd6132f35c47079d86c2ae3e", "message": "HBASE-25311 UI throws NPE", "committedDate": "2020-11-21T07:25:42Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyMzk1Mg==", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528223952", "bodyText": "nit: if debug log is not that imp, this could be replaced with few lines of code using for-each and lambda:\n      replicationLoadSources.forEach(replicationLoadSource -> Optional\n        .ofNullable(replicationLoadSourceMap.get(replicationLoadSource.getPeerID()))\n        .ifPresent(pairs -> pairs.add(new Pair<>(serverName, replicationLoadSource))));\n\nHowever, if debug log is imp, feel free to ignore this nit.", "author": "virajjasani", "createdAt": "2020-11-21T17:56:41Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3621,8 +3621,15 @@ public ReplicationPeerManager getReplicationPeerManager() {\n       List<ReplicationLoadSource> replicationLoadSources =\n           getServerManager().getLoad(serverName).getReplicationLoadSourceList();\n       for (ReplicationLoadSource replicationLoadSource : replicationLoadSources) {\n-        replicationLoadSourceMap.get(replicationLoadSource.getPeerID())\n-            .add(new Pair<>(serverName, replicationLoadSource));\n+        List<Pair<ServerName, ReplicationLoadSource>> replicationLoadSourceList =", "originalCommit": "02368d95378df7d4fd6132f35c47079d86c2ae3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODI2NDg3OQ==", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528264879", "bodyText": "yes, but i think log help understand the current code logic\nIf lambda is necessary, I can update the code", "author": "cuibo01", "createdAt": "2020-11-22T01:12:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyMzk1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODMwNDI1Nw==", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528304257", "bodyText": "Sounds good.\nThanks", "author": "virajjasani", "createdAt": "2020-11-22T08:57:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyMzk1Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODIyNDI0NQ==", "url": "https://github.com/apache/hbase/pull/2688#discussion_r528224245", "bodyText": "Please use placeholder in log with argument: LOG.debug(\"{} does not exist,.....\", replicationLoadSource.getPeerID());", "author": "virajjasani", "createdAt": "2020-11-21T17:59:52Z", "path": "hbase-server/src/main/java/org/apache/hadoop/hbase/master/HMaster.java", "diffHunk": "@@ -3621,8 +3621,15 @@ public ReplicationPeerManager getReplicationPeerManager() {\n       List<ReplicationLoadSource> replicationLoadSources =\n           getServerManager().getLoad(serverName).getReplicationLoadSourceList();\n       for (ReplicationLoadSource replicationLoadSource : replicationLoadSources) {\n-        replicationLoadSourceMap.get(replicationLoadSource.getPeerID())\n-            .add(new Pair<>(serverName, replicationLoadSource));\n+        List<Pair<ServerName, ReplicationLoadSource>> replicationLoadSourceList =\n+          replicationLoadSourceMap.get(replicationLoadSource.getPeerID());\n+        if (replicationLoadSourceList == null) {\n+          LOG.debug(replicationLoadSource.getPeerID() + \" does not exist, but it exists \"\n+            + \"in znode(/hbase/replication/rs). when the rs restarts, peerId is deleted, so \"\n+            + \"we just need to ignore it\");", "originalCommit": "02368d95378df7d4fd6132f35c47079d86c2ae3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "d37cb0b2ae346f8f6d6a82740cd95b3853baa09c", "url": "https://github.com/apache/hbase/commit/d37cb0b2ae346f8f6d6a82740cd95b3853baa09c", "message": "HBASE-25311 UI throws NPE", "committedDate": "2020-11-22T01:06:03Z", "type": "commit"}]}