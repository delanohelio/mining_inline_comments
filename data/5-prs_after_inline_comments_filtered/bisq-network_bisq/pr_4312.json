{"pr_number": 4312, "pr_title": "Factor duplicate unlocked wallet checks into new method ", "pr_createdAt": "2020-06-16T15:57:10Z", "pr_url": "https://github.com/bisq-network/bisq/pull/4312", "timeline": [{"oid": "b1146fdd12ad89e94e38a8853e316f964824d67c", "url": "https://github.com/bisq-network/bisq/commit/b1146fdd12ad89e94e38a8853e316f964824d67c", "message": "Rename CoreWalletService -> CoreWalletsService\n\nThis change fixes the ambiguity in the original class name, which\nimplied it was a btc wallet service, not a bsq and btc wallets service.", "committedDate": "2020-06-12T18:24:01Z", "type": "commit"}, {"oid": "ec66b14986bb0a9f3369009aafc541add4e65f03", "url": "https://github.com/bisq-network/bisq/commit/ec66b14986bb0a9f3369009aafc541add4e65f03", "message": "Add rpc wallet(s) protection tests\n\nThis commit includes the following changes:\n\n * New tests for methods `lockwallet`, `unlockwallet`,\n   `removewalletpassword`, and `setwalletpassword`.\n\n * New `getbalance` method error handing tests to verify\n   error message correctness when wallet is locked.\n\n * Update to `getversion` method test -- now expects `1.3.4`.\n\n * Check for new `[params]` column header in help text.", "committedDate": "2020-06-12T18:56:19Z", "type": "commit"}, {"oid": "85c96764fb3adaa25e8366d547be9d05e635f1bc", "url": "https://github.com/bisq-network/bisq/commit/85c96764fb3adaa25e8366d547be9d05e635f1bc", "message": "Add rpc method 'getfundingaddresses'\n\nThis addresses task #1 in issue https://github.com/bisq-network/bisq/issues/4257.\n\nThis new gRPC WalletService method displays the BTC wallet's list of\nreceiving addresses.  The balance and number of confirmations\nfor the most recent transaction is displayed to the right of each\naddress.  Instead of returning a gRPC data structure to the client,\nthe service method returns a formatted String.\n\nIf the BTC wallet has no unused addresses, one will be created and\nincluded in the returned list, and it can be used to fund the wallet.\n\nThe new method required injection of the BtcWalletService into CoreWalletsService,\nand the usual boilerplate changes to grpc.proto, CliMain, and GrpcWalletService.\n\nSome of the next PRs (for #4257) will require some common functionality within\nCoreWalletsService, so these additional changes were included:\n\n  * a private, class level formatSatoshis function\n  * a public getNumConfirmationsForMostRecentTransaction method\n  * a public getAddressBalance method\n  * a private getAddressEntry method\n\nA unit test that verifies a successful return status was added to cli/test.sh.", "committedDate": "2020-06-13T22:59:45Z", "type": "commit"}, {"oid": "2e415de4adaf54a9f9c926fa4557af95e6fdfbe4", "url": "https://github.com/bisq-network/bisq/commit/2e415de4adaf54a9f9c926fa4557af95e6fdfbe4", "message": "Replace duplicate code in getFundingAddresses\n\nCleaned up the method body and improved the returned string's\nformatting.  Also added a line for this method in the CLI help text.", "committedDate": "2020-06-14T16:05:37Z", "type": "commit"}, {"oid": "b1228e5ea72211c9010943db1aa8bf46675417a6", "url": "https://github.com/bisq-network/bisq/commit/b1228e5ea72211c9010943db1aa8bf46675417a6", "message": "Add rpc method 'getaddressbalance'\n\nThis addresses task 2 in issue 4257\n\thttps://github.com/bisq-network/bisq/issues/4257\n\nThis new gRPC Wallet service method displays the balance and number\nof confimirmations of the most recent transaction for the given BTC\nwallet address.\n\nThe new method required the usual boilerplate changes to grpc.proto,\nCliMain, and GrpcWalletService.\n\nTwo unit tests to check error msgs was added to cli/test.sh.", "committedDate": "2020-06-14T17:23:47Z", "type": "commit"}, {"oid": "a7542e98bf62d86bc3486e1d4d925a9a0a64d8c6", "url": "https://github.com/bisq-network/bisq/commit/a7542e98bf62d86bc3486e1d4d925a9a0a64d8c6", "message": "Add rpc method 'createpaymentacct'\n\nThis addresses task 4 in issue 4257.\n    https://github.com/bisq-network/bisq/issues/4257\n\nThis PR should be reviewed/merged after PR 4304.\n    https://github.com/bisq-network/bisq/pull/4304\n\nThis new gRPC PaymentAccounts service method creates a dummy\nPerfectMoney payment account for the given name, number and fiat\ncurrency code, as part of the required \"simplest possible trading\nAPI\" (for demo).   An implementation supporting all payment\nmethods is not in the scope.\n\nChanges specific to the new rpc method implementation follow:\n\n* New createpaymentacct method + help text was added to CliMain.\n  Help text formatting was also changed to make room for larger\n  method names and argument lists.\n\n* The PaymentAccount proto service def was renamed PaymentAccounts\n  to avoid a name collision, and the new rpc CreatePaymentAccount\n  was made part of the newly named PaymentAccounts service def.\n\n* New GrpcPaymentAccountsService (gRPC boilerplate) and\n  CorePaymentAccountsService (method implementations) classes were\n  added.\n\n* The gRPC GetPaymentAccountsService stub was moved from GrpcServer\n  to the new GrpcPaymentAccountsService class, and\n  GrpcPaymentAccountsService is injected into GrpcServer.\n\n* A new createpaymentacct unit test was added to the bats test\n  suite (checks for successful return status code).\n\nMaybe bit out of scope, some small changes were made towards making\nsure the entire API is defined in CoreApi, which is used as a\npass-through object to the new CorePaymentAccountsService.  In the\nnext PR, similar refactoring will be done to make CoreApi the\npass-through object for all of the existing CoreWalletsService\nmethods.  (CoreWalletsService will be injected into CoreApi.)\nIn the future, all Grpc*Service implementations will call core\nservices through CoreApi, for the sake of consistency.", "committedDate": "2020-06-15T17:32:14Z", "type": "commit"}, {"oid": "bac3ed5697b4b854bb6c12128cee5aca1f64d09f", "url": "https://github.com/bisq-network/bisq/commit/bac3ed5697b4b854bb6c12128cee5aca1f64d09f", "message": "Call core wallets service methods from CoreApi\n\nThis change is a refactoring of the gRPC Wallets service\nfor the purpose of making CoreApi the entry point to\nall core implementations.  These changes should have been\nmade in PR 4295.\nSee https://github.com/bisq-network/bisq/pull/4295\n\nThe gRPC Wallet proto def name was changed to Wallets because\nthis service manages BSQ and BTC wallets, and GrpcWalletService\nwas changed to GrpcWalletsService for the same reason.\n\nThis PR should be reviewed/merged after PR 4308.\nSee https://github.com/bisq-network/bisq/pull/4308\n\nThis PR's branch was created from the PR 4308 branch.", "committedDate": "2020-06-15T19:43:26Z", "type": "commit"}, {"oid": "258d1801d2d5cecd06c60e60e31fa8b2ede744e0", "url": "https://github.com/bisq-network/bisq/commit/258d1801d2d5cecd06c60e60e31fa8b2ede744e0", "message": "Factor duplicate unlocked wallet checks into new method\n\nResponse to comment in PR 4299:\nhttps://github.com/bisq-network/bisq/pull/4299#discussion_r440769032\n\nThis PR should be reviewed/merged after PR 4309.\nhttps://github.com/bisq-network/bisq/pull/4309", "committedDate": "2020-06-16T15:48:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDEzMDc1Mg==", "url": "https://github.com/bisq-network/bisq/pull/4312#discussion_r444130752", "bodyText": "Following the same rationale, verifyWalletsAreAvailable should be created.", "author": "dmos62", "createdAt": "2020-06-23T10:42:36Z", "path": "core/src/main/java/bisq/core/grpc/CoreWalletsService.java", "diffHunk": "@@ -65,8 +65,7 @@ public long getAvailableBalance() {\n         if (!walletsManager.areWalletsAvailable())\n             throw new IllegalStateException(\"wallet is not yet available\");", "originalCommit": "258d1801d2d5cecd06c60e60e31fa8b2ede744e0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDI4MzU3NQ==", "url": "https://github.com/bisq-network/bisq/pull/4312#discussion_r444283575", "bodyText": "Makes sense, this change will be added to the latest PR in the current (and long) chain of PRs: 4329.", "author": "ghubstan", "createdAt": "2020-06-23T14:48:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDEzMDc1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDM0NTY2NA==", "url": "https://github.com/bisq-network/bisq/pull/4312#discussion_r444345664", "bodyText": "The requested change is in commit e1fddfa, as part of PR 4329.", "author": "ghubstan", "createdAt": "2020-06-23T16:15:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDEzMDc1Mg=="}], "type": "inlineReview"}]}