{"pr_number": 3811, "pr_title": "[Upbit] Implements getTickers()", "pr_createdAt": "2020-11-16T15:49:58Z", "pr_url": "https://github.com/knowm/XChange/pull/3811", "timeline": [{"oid": "a4b86c3e6c0508c7936be59749b736967f4fdcb9", "url": "https://github.com/knowm/XChange/commit/a4b86c3e6c0508c7936be59749b736967f4fdcb9", "message": "[Upbit] Added Upbit util class", "committedDate": "2020-11-16T22:26:45Z", "type": "commit"}, {"oid": "c0b35397e028acdbd97cd69122c658f140a614db", "url": "https://github.com/knowm/XChange/commit/c0b35397e028acdbd97cd69122c658f140a614db", "message": "[Upbit] Fixed correct exchange class", "committedDate": "2020-11-16T22:26:45Z", "type": "commit"}, {"oid": "cae89c10faf94570966784cf4f2615e65ce53403", "url": "https://github.com/knowm/XChange/commit/cae89c10faf94570966784cf4f2615e65ce53403", "message": "[Upbit] Implements getTickers and metadata", "committedDate": "2020-11-16T22:26:45Z", "type": "commit"}, {"oid": "556f12e51d2fc8a2283739b0b49c04fa96180123", "url": "https://github.com/knowm/XChange/commit/556f12e51d2fc8a2283739b0b49c04fa96180123", "message": "Bump pubnub-gson from 4.31.3 to 4.33.3\n\nBumps [pubnub-gson](https://github.com/pubnub/java) from 4.31.3 to 4.33.3.\n- [Release notes](https://github.com/pubnub/java/releases)\n- [Changelog](https://github.com/pubnub/java/blob/master/CHANGELOG.md)\n- [Commits](https://github.com/pubnub/java/compare/v4.31.3...v4.33.3)\n\nSigned-off-by: dependabot-preview[bot] <support@dependabot.com>", "committedDate": "2020-11-16T22:26:45Z", "type": "forcePushed"}, {"oid": "cae89c10faf94570966784cf4f2615e65ce53403", "url": "https://github.com/knowm/XChange/commit/cae89c10faf94570966784cf4f2615e65ce53403", "message": "[Upbit] Implements getTickers and metadata", "committedDate": "2020-11-16T22:26:45Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTM4Nw==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r525345387", "bodyText": "This isn't needed", "author": "earce", "createdAt": "2020-11-17T17:23:33Z", "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitUtils.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.knowm.xchange.upbit;\n+\n+import org.knowm.xchange.currency.CurrencyPair;\n+\n+public class UpbitUtils {\n+\n+  public static final String MARKET_NAME_SEPARATOR = \"-\";\n+\n+  private UpbitUtils() {", "originalCommit": "cae89c10faf94570966784cf4f2615e65ce53403", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI5Mzg2Ng==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526293866", "bodyText": "Do you mean that private constructor is not neseccery?", "author": "aaron-jang", "createdAt": "2020-11-18T17:41:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwMzA1Mw==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526303053", "bodyText": "Yes, it's really about enforcing so that static classes can't be sub classed, final on the class should accomplish the same thing, but neither is necessary.", "author": "earce", "createdAt": "2020-11-18T17:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTM4Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMzMDI4OQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526330289", "bodyText": "Removed.", "author": "aaron-jang", "createdAt": "2020-11-18T18:36:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTM4Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTg0Mg==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r525345842", "bodyText": "is this index order correct (1 then 0)? Seems to be the opposite of what I am seeing in public static OrderBook adaptOrderBook(UpbitOrderBooks upbitOrderBooks)", "author": "earce", "createdAt": "2020-11-17T17:24:15Z", "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitUtils.java", "diffHunk": "@@ -0,0 +1,26 @@\n+package org.knowm.xchange.upbit;\n+\n+import org.knowm.xchange.currency.CurrencyPair;\n+\n+public class UpbitUtils {\n+\n+  public static final String MARKET_NAME_SEPARATOR = \"-\";\n+\n+  private UpbitUtils() {\n+    // not called\n+  }\n+\n+  public static String toPairString(CurrencyPair currencyPair) {\n+    if (currencyPair == null) return null;\n+    return currencyPair.counter.getCurrencyCode().toUpperCase()\n+        + MARKET_NAME_SEPARATOR\n+        + currencyPair.base.getCurrencyCode().toUpperCase();\n+  }\n+\n+  public static CurrencyPair toCurrencyPair(String pairString) {\n+    if (pairString == null) return null;\n+    String[] pairStringSplit = pairString.split(MARKET_NAME_SEPARATOR);\n+    if (pairStringSplit.length != 2) return null;\n+    return new CurrencyPair(pairStringSplit[1], pairStringSplit[0]);", "originalCommit": "cae89c10faf94570966784cf4f2615e65ce53403", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI5MDQxNA==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526290414", "bodyText": "There was a bug in the previous code.\nCheck out the api below.\n\nhttps://api.upbit.com/v1/trades/ticks?market=BTC-ETH (success)\nhttps://api.upbit.com/v1/trades/ticks?market=ETH-BTC (fail)\n\nbase: ETH (index 1)\ncounter: BTH(index 0)", "author": "aaron-jang", "createdAt": "2020-11-18T17:39:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0NTg0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0ODE5MA==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r525348190", "bodyText": "put the ask on the left side for NPE protection", "author": "earce", "createdAt": "2020-11-17T17:27:47Z", "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -131,27 +138,27 @@ public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n     } else if (upbitOrderResponse.getState().equalsIgnoreCase(\"done\")) {\n       status = Order.OrderStatus.FILLED;\n     }\n-    OrderType type = upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID;\n-    BigDecimal originalAmount = upbitOrderResponse.getVolume();\n-    String[] markets = upbitOrderResponse.getMarket().split(\"-\");\n-    CurrencyPair currencyPair =\n-        new CurrencyPair(new Currency(markets[1]), new Currency(markets[0]));\n-    String orderId = upbitOrderResponse.getUuid();\n-    BigDecimal cumulativeAmount = upbitOrderResponse.getExecutedVolume();\n-    BigDecimal price = upbitOrderResponse.getAvgPrice();\n-    ZonedDateTime dateTime = ZonedDateTime.parse(upbitOrderResponse.getCreatedAt());\n-    LimitOrder order =\n-        new LimitOrder(\n-            type,\n-            originalAmount,\n-            currencyPair,\n-            orderId,\n-            Date.from(dateTime.toInstant()),\n-            price,\n-            price,\n-            cumulativeAmount,\n-            upbitOrderResponse.getPaidFee(),\n-            status);\n-    return order;\n+    return new LimitOrder(\n+        upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID,", "originalCommit": "cae89c10faf94570966784cf4f2615e65ce53403", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjI3Nzc3NQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526277775", "bodyText": "fixed.", "author": "aaron-jang", "createdAt": "2020-11-18T17:32:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNTM0ODE5MA=="}], "type": "inlineReview"}, {"oid": "c3d60f02b3e8178db7708767d171ca1104d21439", "url": "https://github.com/knowm/XChange/commit/c3d60f02b3e8178db7708767d171ca1104d21439", "message": "[Upbit] Fixed NPE in adaptOrderInfo", "committedDate": "2020-11-18T16:34:34Z", "type": "commit"}, {"oid": "9c9a30894491da0a381f37c5cbe79164061d8e5b", "url": "https://github.com/knowm/XChange/commit/9c9a30894491da0a381f37c5cbe79164061d8e5b", "message": "[Upbit] Removed unnecessary code", "committedDate": "2020-11-18T16:51:36Z", "type": "commit"}, {"oid": "84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c", "url": "https://github.com/knowm/XChange/commit/84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c", "message": "[Upbit] Added getOrder, cancelOrder support to TradeService", "committedDate": "2020-11-18T17:30:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNzA3Mg==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526307072", "bodyText": "also sorry missed this but can you use the builder class that limit order has to do this", "author": "earce", "createdAt": "2020-11-18T17:59:46Z", "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -130,28 +137,30 @@ public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n       status = Order.OrderStatus.PARTIALLY_FILLED;\n     } else if (upbitOrderResponse.getState().equalsIgnoreCase(\"done\")) {\n       status = Order.OrderStatus.FILLED;\n+    } else {\n+      status = Order.OrderStatus.NEW;\n     }\n-    OrderType type = upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID;\n-    BigDecimal originalAmount = upbitOrderResponse.getVolume();\n-    String[] markets = upbitOrderResponse.getMarket().split(\"-\");\n-    CurrencyPair currencyPair =\n-        new CurrencyPair(new Currency(markets[1]), new Currency(markets[0]));\n-    String orderId = upbitOrderResponse.getUuid();\n-    BigDecimal cumulativeAmount = upbitOrderResponse.getExecutedVolume();\n-    BigDecimal price = upbitOrderResponse.getAvgPrice();\n-    ZonedDateTime dateTime = ZonedDateTime.parse(upbitOrderResponse.getCreatedAt());\n-    LimitOrder order =\n-        new LimitOrder(\n-            type,\n-            originalAmount,\n-            currencyPair,\n-            orderId,\n-            Date.from(dateTime.toInstant()),\n-            price,\n-            price,\n-            cumulativeAmount,\n-            upbitOrderResponse.getPaidFee(),\n-            status);\n-    return order;\n+    return new LimitOrder(", "originalCommit": "84fa9f0255cf4fc20bd542dc7ef5ee2907fc289c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMzMDQzNQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526330435", "bodyText": "Fixed.", "author": "aaron-jang", "createdAt": "2020-11-18T18:36:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjMwNzA3Mg=="}], "type": "inlineReview"}, {"oid": "5d73cb1e91fcdfd58e029b0f42ea622509d5ff83", "url": "https://github.com/knowm/XChange/commit/5d73cb1e91fcdfd58e029b0f42ea622509d5ff83", "message": "[Upbit] Removed private constructor", "committedDate": "2020-11-18T18:04:24Z", "type": "commit"}, {"oid": "3ad817e7ccd567c372ab8670af978d9b44f11214", "url": "https://github.com/knowm/XChange/commit/3ad817e7ccd567c372ab8670af978d9b44f11214", "message": "[Upbit] Convert LimitOrder from constructor to Builder creation", "committedDate": "2020-11-18T18:35:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNDY2NQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526404665", "bodyText": "is there a reason why you aren't using cp here?", "author": "earce", "createdAt": "2020-11-18T20:37:37Z", "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -130,28 +136,32 @@ public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n       status = Order.OrderStatus.PARTIALLY_FILLED;\n     } else if (upbitOrderResponse.getState().equalsIgnoreCase(\"done\")) {\n       status = Order.OrderStatus.FILLED;\n+    } else {\n+      status = Order.OrderStatus.NEW;\n     }\n-    OrderType type = upbitOrderResponse.getSide().equals(\"ask\") ? OrderType.ASK : OrderType.BID;\n-    BigDecimal originalAmount = upbitOrderResponse.getVolume();\n-    String[] markets = upbitOrderResponse.getMarket().split(\"-\");\n-    CurrencyPair currencyPair =\n-        new CurrencyPair(new Currency(markets[1]), new Currency(markets[0]));\n-    String orderId = upbitOrderResponse.getUuid();\n-    BigDecimal cumulativeAmount = upbitOrderResponse.getExecutedVolume();\n-    BigDecimal price = upbitOrderResponse.getAvgPrice();\n-    ZonedDateTime dateTime = ZonedDateTime.parse(upbitOrderResponse.getCreatedAt());\n-    LimitOrder order =\n-        new LimitOrder(\n-            type,\n-            originalAmount,\n-            currencyPair,\n-            orderId,\n-            Date.from(dateTime.toInstant()),\n-            price,\n-            price,\n-            cumulativeAmount,\n-            upbitOrderResponse.getPaidFee(),\n-            status);\n-    return order;\n+\n+    final OrderType orderType = UpbitUtils.fromSide(upbitOrderResponse.getSide());\n+    final CurrencyPair currencyPair = UpbitUtils.toCurrencyPair(upbitOrderResponse.getMarket());\n+    return new LimitOrder.Builder(orderType, currencyPair)\n+        .originalAmount(upbitOrderResponse.getVolume())\n+        .id(upbitOrderResponse.getUuid())\n+        .timestamp(Date.from(ZonedDateTime.parse(upbitOrderResponse.getCreatedAt()).toInstant()))\n+        .limitPrice(upbitOrderResponse.getAvgPrice())\n+        .averagePrice(upbitOrderResponse.getAvgPrice())\n+        .cumulativeAmount(upbitOrderResponse.getExecutedVolume())\n+        .fee(upbitOrderResponse.getPaidFee())\n+        .orderStatus(status)\n+        .build();\n+  }\n+\n+  public static ExchangeMetaData adaptMetadata(List<UpbitMarket> markets) {\n+    Map<CurrencyPair, CurrencyPairMetaData> pairMeta =\n+        markets.stream()\n+            .map(UpbitMarket::getMarket)\n+            .map(UpbitUtils::toCurrencyPair)\n+            .collect(\n+                Collectors.toMap(\n+                    Function.identity(), cp -> new CurrencyPairMetaData.Builder().build()));", "originalCommit": "3ad817e7ccd567c372ab8670af978d9b44f11214", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg2NDE3MQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526864171", "bodyText": "The second argument of tomap is a function parameter, so I used cp only to receive an argument.\nIs there any way to recommend it?", "author": "aaron-jang", "createdAt": "2020-11-19T13:04:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNDY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NTAxMQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r527055011", "bodyText": "I was wondering more like why did you not pass in anything to the CurrencyPairMetaData Builders like .set(currencyPair) before building it, otherwise it doesn't have any data. Is that intentional? If yes that is fine leave it as is.", "author": "earce", "createdAt": "2020-11-19T17:09:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNDY2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI4MTM1NA==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r527281354", "bodyText": "Yes, it was intended.\nCurrencyPairMetaData has no CurrencyPair field and no more values to fill in.", "author": "aaron-jang", "createdAt": "2020-11-19T23:54:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNDY2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNjU2MA==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526406560", "bodyText": "the compare to == 0 implies executed volume == 0 which would be unfilled, wouldn't partially filled be a number > 0?", "author": "earce", "createdAt": "2020-11-18T20:41:00Z", "path": "xchange-upbit/src/main/java/org/knowm/xchange/upbit/UpbitAdapters.java", "diffHunk": "@@ -121,7 +127,7 @@ public static Wallet adaptWallet(UpbitBalances wallets) {\n   }\n \n   public static Order adaptOrderInfo(UpbitOrderResponse upbitOrderResponse) {\n-    Order.OrderStatus status = Order.OrderStatus.NEW;\n+    Order.OrderStatus status;\n     if (upbitOrderResponse.getState().equalsIgnoreCase(\"cancel\")) {\n       status = Order.OrderStatus.CANCELED;\n     } else if (upbitOrderResponse.getExecutedVolume().compareTo(BigDecimal.ZERO) == 0) {", "originalCommit": "3ad817e7ccd567c372ab8670af978d9b44f11214", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjg3NjAxMQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r526876011", "bodyText": "Does unfilled mean that the executed value can be null?\nIn the demo tests, there was no case where the executed value was null.\nIt was 0.0 when the transaction was not executed.", "author": "aaron-jang", "createdAt": "2020-11-19T13:23:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNjU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzA1NzE2NQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r527057165", "bodyText": "Unfilled means executed value == 0, but in this case you are saying if executedVolume == 0 that it's partially filled, which I don't think is right?\n } else if (upbitOrderResponse.getExecutedVolume().compareTo(BigDecimal.ZERO) == 0) { status = Order.OrderStatus.PARTIALLY_FILLED;\nI don't think executed volume of 0 is partially filled?", "author": "earce", "createdAt": "2020-11-19T17:12:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNjU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzI5Njg3Mw==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r527296873", "bodyText": "Didn't you see the folded code?\nFull code\n     } else if (upbitOrderResponse.getExecutedVolume().compareTo(BigDecimal.ZERO) == 0) {\n       status = Order.OrderStatus.NEW;\n     } else if (upbitOrderResponse.getRemainingVolume().compareTo(BigDecimal.ZERO)> 0) {\n       status = Order.OrderStatus.PARTIALLY_FILLED;\nhttps://github.com/knowm/XChange/pull/3811/files/3ad817e7ccd567c372ab8670af978d9b44f11214#diff-a07acc5ce0d340e36689164bcc4d69b8382ff6f6b174210b9d6a11bdcdd977c1R133-L131", "author": "aaron-jang", "createdAt": "2020-11-20T00:23:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNjU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzMwMDk4MQ==", "url": "https://github.com/knowm/XChange/pull/3811#discussion_r527300981", "bodyText": "Ah, that's what I was missing, thanks for clarifying.", "author": "earce", "createdAt": "2020-11-20T00:28:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNjQwNjU2MA=="}], "type": "inlineReview"}]}