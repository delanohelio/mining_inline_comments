{"pr_number": 9078, "pr_title": "MULE-17709: Add `error-mapping` information into operations model", "pr_createdAt": "2020-07-20T13:56:22Z", "pr_url": "https://github.com/mulesoft/mule/pull/9078", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyNjUzMg==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458226532", "bodyText": "delete?", "author": "marianogonzalez", "createdAt": "2020-07-21T16:23:14Z", "path": "core/src/main/java/org/mule/runtime/core/internal/exception/DefaultErrorMapping.java", "diffHunk": "@@ -0,0 +1,35 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.exception;\n+\n+import org.mule.runtime.api.meta.model.operation.ErrorMapping;\n+\n+public final class DefaultErrorMapping implements ErrorMapping {", "originalCommit": "5b0600763791afb32ce4e2e202decdf571419a6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc4ODM2NQ==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458788365", "bodyText": "still no delete?", "author": "marianogonzalez", "createdAt": "2020-07-22T13:24:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyNjUzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyOTEyMg==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458229122", "bodyText": "Weird:\na) added but never used\nb) shoudln't this use the extension's classlaoder?", "author": "marianogonzalez", "createdAt": "2020-07-21T16:27:14Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/java/OperationModelLoaderDelegate.java", "diffHunk": "@@ -55,6 +58,8 @@\n final class OperationModelLoaderDelegate extends AbstractModelLoaderDelegate {\n \n   private static final String OPERATION = \"Operation\";\n+  private static final ClassTypeLoader TYPE_LOADER = ExtensionsTypeLoaderFactory.getDefault()", "originalCommit": "5b0600763791afb32ce4e2e202decdf571419a6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5MTA2NA==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458791064", "bodyText": "no action?", "author": "marianogonzalez", "createdAt": "2020-07-22T13:28:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyOTEyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyOTczNg==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458229736", "bodyText": "shouldn't this be forEachErrorMapping ?", "author": "marianogonzalez", "createdAt": "2020-07-21T16:28:11Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/exception/ErrorMappingUtils.java", "diffHunk": "@@ -0,0 +1,44 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.runtime.exception;\n+\n+import static org.mule.runtime.extension.api.ExtensionConstants.ERROR_MAPPINGS_PARAMETER_NAME;\n+\n+import org.mule.runtime.api.meta.model.operation.ErrorMapping;\n+import org.mule.runtime.api.meta.model.operation.OperationModel;\n+import org.mule.runtime.ast.api.ComponentAst;\n+import org.mule.runtime.ast.api.ComponentParameterAst;\n+\n+import java.util.List;\n+import java.util.function.Consumer;\n+\n+/**\n+ * Utilities for dealing with {@code error-mapping} in operations.\n+ *\n+ * @since 4.4\n+ */\n+public final class ErrorMappingUtils {\n+\n+  private ErrorMappingUtils() {\n+    // Nothing to do\n+  }\n+\n+  /**\n+   * For the given AST node representing an operation, execute the given {@code action} for each error mapping it has.\n+   * \n+   * @param operation the operation from which to iterate the error mappings.\n+   * @param action what is executed for every error mapping.\n+   */\n+  public static void doForErrorMappings(ComponentAst operation, Consumer<List<ErrorMapping>> action) {", "originalCommit": "5b0600763791afb32ce4e2e202decdf571419a6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc5MTMyNQ==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458791325", "bodyText": "no action", "author": "marianogonzalez", "createdAt": "2020-07-22T13:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODIyOTczNg=="}], "type": "inlineReview"}, {"oid": "5c130d3c47e4480d9965135e886f070ff89de067", "url": "https://github.com/mulesoft/mule/commit/5c130d3c47e4480d9965135e886f070ff89de067", "message": "MULE-17709: Add `error-mapping` information into operations model", "committedDate": "2020-07-21T21:32:15Z", "type": "commit"}, {"oid": "3b52a36ab75ad54ff3c0b1e4f6e7b82c7b119ee6", "url": "https://github.com/mulesoft/mule/commit/3b52a36ab75ad54ff3c0b1e4f6e7b82c7b119ee6", "message": "utils", "committedDate": "2020-07-21T21:32:16Z", "type": "commit"}, {"oid": "df9467c699cc9041afd84ceb8c746ce46c92b1cd", "url": "https://github.com/mulesoft/mule/commit/df9467c699cc9041afd84ceb8c746ce46c92b1cd", "message": "lalal!", "committedDate": "2020-07-21T21:32:18Z", "type": "commit"}, {"oid": "4519b0a91065b074cff87dc6724b6ecd1c247912", "url": "https://github.com/mulesoft/mule/commit/4519b0a91065b074cff87dc6724b6ecd1c247912", "message": "adfsad", "committedDate": "2020-07-21T21:32:20Z", "type": "commit"}, {"oid": "2572e30e9dfc33646ff1586281b5ef09618acaeb", "url": "https://github.com/mulesoft/mule/commit/2572e30e9dfc33646ff1586281b5ef09618acaeb", "message": "adgaergqwe", "committedDate": "2020-07-21T21:32:21Z", "type": "commit"}, {"oid": "548f06e10053074260445693c3b9b300f02a6e7d", "url": "https://github.com/mulesoft/mule/commit/548f06e10053074260445693c3b9b300f02a6e7d", "message": "wrapping up", "committedDate": "2020-07-21T21:32:23Z", "type": "commit"}, {"oid": "dbd93cb7db641f7230c75ccf4e918e27a6caa1e0", "url": "https://github.com/mulesoft/mule/commit/dbd93cb7db641f7230c75ccf4e918e27a6caa1e0", "message": "jd", "committedDate": "2020-07-21T21:32:24Z", "type": "commit"}, {"oid": "48f6b220a07e6f848ba2440e7a34271a4592f977", "url": "https://github.com/mulesoft/mule/commit/48f6b220a07e6f848ba2440e7a34271a4592f977", "message": "fix", "committedDate": "2020-07-21T21:32:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc4OTM4OA==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458789388", "bodyText": "this part I still don't underestand... so nobody was paying attention to this in 4.3?", "author": "marianogonzalez", "createdAt": "2020-07-22T13:25:54Z", "path": "modules/extensions-spring-support/src/main/java/org/mule/runtime/module/extension/internal/AbstractComponentDefinitionParser.java", "diffHunk": "@@ -81,6 +80,7 @@ protected Builder doParse(Builder definitionBuilder)\n                                        fromSimpleParameter(TARGET_VALUE_PARAMETER_NAME).build())\n         .withSetterParameterDefinition(CURSOR_PROVIDER_FACTORY_FIELD_NAME,\n                                        fromChildConfiguration(CursorProviderFactory.class).build())\n+        .withSetterParameterDefinition(\"errorMappings\", fromChildCollectionConfiguration(EnrichedErrorMapping.class).build())", "originalCommit": "5b0600763791afb32ce4e2e202decdf571419a6e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1OTA3MTE0MQ==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r459071141", "bodyText": "it was set by custom code in the parser, passing it through the annotations of the componet :ugly:", "author": "elrodro83", "createdAt": "2020-07-22T20:43:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODc4OTM4OA=="}], "type": "inlineReview"}, {"oid": "69e7eeaecf57283e33fec073d81fcc2e5a53b23a", "url": "https://github.com/mulesoft/mule/commit/69e7eeaecf57283e33fec073d81fcc2e5a53b23a", "message": "review + fixes", "committedDate": "2020-07-22T13:54:32Z", "type": "commit"}, {"oid": "69e7eeaecf57283e33fec073d81fcc2e5a53b23a", "url": "https://github.com/mulesoft/mule/commit/69e7eeaecf57283e33fec073d81fcc2e5a53b23a", "message": "review + fixes", "committedDate": "2020-07-22T13:54:32Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1ODg2ODIxOQ==", "url": "https://github.com/mulesoft/mule/pull/9078#discussion_r458868219", "bodyText": "4.0?", "author": "marianogonzalez", "createdAt": "2020-07-22T15:12:37Z", "path": "core/src/main/java/org/mule/runtime/core/internal/exception/EnrichedErrorMapping.java", "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.core.internal.exception;\n+\n+import org.mule.runtime.api.component.AbstractComponent;\n+import org.mule.runtime.api.message.ErrorType;\n+import org.mule.runtime.core.api.exception.ErrorTypeMatcher;\n+\n+/**\n+ * Represents a mapping between source and target {@link ErrorType}s, indicating that if\n+ * the first or a match for it is found then the other should be propagated instead.\n+ *\n+ * @since 4.0", "originalCommit": "69e7eeaecf57283e33fec073d81fcc2e5a53b23a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4264c5f4ade5afb0689b21240fb02dbcfd1fa78f", "url": "https://github.com/mulesoft/mule/commit/4264c5f4ade5afb0689b21240fb02dbcfd1fa78f", "message": "another review", "committedDate": "2020-07-22T20:41:11Z", "type": "commit"}, {"oid": "ff1c61b6ecc7ba23742f5b48aa69a7fa1291f4b7", "url": "https://github.com/mulesoft/mule/commit/ff1c61b6ecc7ba23742f5b48aa69a7fa1291f4b7", "message": "properly revert xsd changes", "committedDate": "2020-07-23T14:25:43Z", "type": "commit"}]}