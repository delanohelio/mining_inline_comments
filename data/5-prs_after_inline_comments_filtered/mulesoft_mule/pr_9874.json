{"pr_number": 9874, "pr_title": "MULE-18920: Support new SDK API Sources annotation", "pr_createdAt": "2020-12-21T21:31:14Z", "pr_url": "https://github.com/mulesoft/mule/pull/9874", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI3Nzc2OA==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547277768", "bodyText": "remove import and fix javadocs", "author": "SebaElizalde", "createdAt": "2020-12-22T13:28:46Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/SourceCallbackContextArgumentResolver.java", "diffHunk": "@@ -6,6 +6,7 @@\n  */\n package org.mule.runtime.module.extension.internal.runtime.resolver;\n \n+import static org.mule.runtime.module.extension.internal.ExtensionProperties.LEGACY_SOURCE_CALLBACK_CONTEXT_PARAM;\n import static org.mule.runtime.module.extension.internal.ExtensionProperties.SOURCE_CALLBACK_CONTEXT_PARAM;", "originalCommit": "320578246a90b992d5379c45d6c2929b81210299", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxODM4Mw==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547318383", "bodyText": "\ud83d\udc4d  changed", "author": "ndinu", "createdAt": "2020-12-22T14:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI3Nzc2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI5MTc2Mw==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547291763", "bodyText": "Why was it renamed?", "author": "gabrieldalborgo", "createdAt": "2020-12-22T13:57:24Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/loader/java/property/SdkSourceFactoryModelProperty.java", "diffHunk": "@@ -16,32 +17,32 @@\n  *\n  * @since 4.0\n  */\n-public final class SourceFactoryModelProperty implements ModelProperty {\n+public final class SdkSourceFactoryModelProperty implements ModelProperty {", "originalCommit": "320578246a90b992d5379c45d6c2929b81210299", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI5Mzk5Mw==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547293993", "bodyText": "It was renamed because it now holds an SdkSourceFactory, which is a new interface defined here https://github.com/mulesoft/mule-extensions-api/pull/758/files .", "author": "ndinu", "createdAt": "2020-12-22T14:01:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI5MTc2Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4MjM4Mg==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547282382", "bodyText": "is this just removing the qualification or are you actually changing the result type?", "author": "marianogonzalez", "createdAt": "2020-12-22T13:38:37Z", "path": "core-tests/src/test/java/org/mule/runtime/core/internal/management/stats/PayloadStatisticsTestCase.java", "diffHunk": "@@ -786,7 +786,7 @@ public void flowProcessMediatorCollectionItems() throws Exception {\n     // set the result to a collection of something other that Result to manifest the bug\n     FlowProcessTemplate template = mock(FlowProcessTemplate.class);\n     SourceResultAdapter resultAdapter = mock(SourceResultAdapter.class);\n-    when(resultAdapter.getResult()).thenReturn(org.mule.runtime.extension.api.runtime.operation.Result.builder()\n+    when(resultAdapter.getResult()).thenReturn(Result.builder()", "originalCommit": "320578246a90b992d5379c45d6c2929b81210299", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMwNzE0NA==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547307144", "bodyText": "This is actually changing the result type. The SourceResultAdapter now returns an org.mule.sdk.api.runtime.operation.Result .", "author": "ndinu", "createdAt": "2020-12-22T14:26:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4MjM4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4MzY5NQ==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547283695", "bodyText": "where is the ReconnectableHeisenbergSource being readded? Aren't you missing  the new @Sources annotation here?", "author": "marianogonzalez", "createdAt": "2020-12-22T13:41:21Z", "path": "modules/extensions-spring-support/src/test/java/org/mule/test/module/extension/config/ConfigurationInjectionLifecycleTestCase.java", "diffHunk": "@@ -111,7 +111,7 @@ public void start() throws MuleException {\n       KillingOperations.class, HeisenbergScopes.class, HeisenbergRouters.class})\n   @OnException(HeisenbergConnectionExceptionEnricher.class)\n   @ConnectionProviders({HeisenbergConnectionProvider.class, SecureHeisenbergConnectionProvider.class})\n-  @Sources({HeisenbergSource.class, DEARadioSource.class, AsyncHeisenbergSource.class, ReconnectableHeisenbergSource.class})", "originalCommit": "320578246a90b992d5379c45d6c2929b81210299", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxODI1MQ==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547318251", "bodyText": "I think it was the same for the test having it or not, but I am adding it back with the new @Sources annotation.", "author": "ndinu", "createdAt": "2020-12-22T14:47:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4MzY5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NzY5NA==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547287694", "bodyText": "why do you need a different key for the legacy callback? Shouldn't the adapters allow you to handle eveything as one unique code flow?", "author": "marianogonzalez", "createdAt": "2020-12-22T13:49:32Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/SourceCallbackContextArgumentResolver.java", "diffHunk": "@@ -26,6 +27,6 @@\n \n   @Override\n   public SourceCallbackContext resolve(ExecutionContext executionContext) {\n-    return ((ExecutionContextAdapter<ComponentModel>) executionContext).getVariable(SOURCE_CALLBACK_CONTEXT_PARAM);\n+    return ((ExecutionContextAdapter<ComponentModel>) executionContext).getVariable(LEGACY_SOURCE_CALLBACK_CONTEXT_PARAM);", "originalCommit": "320578246a90b992d5379c45d6c2929b81210299", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMxOTkzMw==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547319933", "bodyText": "What I did is to add a variable to the context that is the source callback context adapted to the legacy one, I could instead have only the new implementation, get it, and adapt it here. Do you think that is better?", "author": "ndinu", "createdAt": "2020-12-22T14:50:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NzY5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzMzMDM4OQ==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547330389", "bodyText": "I will make the Argument resolver wrap the callback context with the adapter, and have only the org.mule.sdk variable in the context.", "author": "ndinu", "createdAt": "2020-12-22T15:08:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI4NzY5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzI5ODY1Nw==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547298657", "bodyText": "this is taking an \"all or nothing\" approach, meaning that you either have sources fully defined with the legacy API or fully defined with the new API. Add cases for sources that mix both.", "author": "marianogonzalez", "createdAt": "2020-12-22T14:10:53Z", "path": "tests/test-extensions/petstore-extension/src/main/java/org/mule/test/petstore/extension/PetStoreConnector.java", "diffHunk": "@@ -28,9 +28,9 @@\n     PooledPetStoreConnectionProviderWithValidConnection.class})\n @ErrorTypes(PetstoreErrorTypeDefinition.class)\n @Sources({PetStoreSource.class, FailingPetStoreSource.class, SentientSource.class, PetAdoptionSource.class,\n-    PetStoreStreamSource.class, PetStoreListSource.class, PartialPetAdoptionSource.class, NumberPetAdoptionSource.class,\n-    ConnectedPetAdoptionSource.class, PetFailingPollingSource.class, WatermarkingPetAdoptionSource.class,\n-    PetAdoptionLimitingSource.class})\n+    PetStoreStreamSource.class, PartialPetAdoptionSource.class, ConnectedPetAdoptionSource.class, PetFailingPollingSource.class,})\n+@org.mule.sdk.api.annotation.Sources({NumberPetAdoptionSource.class, WatermarkingPetAdoptionSource.class,", "originalCommit": "320578246a90b992d5379c45d6c2929b81210299", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6e25a8961b56454900c0c9ffc2d5207a7801a7c3", "url": "https://github.com/mulesoft/mule/commit/6e25a8961b56454900c0c9ffc2d5207a7801a7c3", "message": "start doodling", "committedDate": "2020-12-22T17:32:55Z", "type": "commit"}, {"oid": "42a2a0f951b6d466e0128d2e06d7cb1d48ea4045", "url": "https://github.com/mulesoft/mule/commit/42a2a0f951b6d466e0128d2e06d7cb1d48ea4045", "message": "keep doodling", "committedDate": "2020-12-22T17:32:55Z", "type": "commit"}, {"oid": "73c15bb260da2086b10fdeec9763f5b8e833f0d8", "url": "https://github.com/mulesoft/mule/commit/73c15bb260da2086b10fdeec9763f5b8e833f0d8", "message": "progress", "committedDate": "2020-12-22T17:41:18Z", "type": "commit"}, {"oid": "3d0a54abf82f8b329a0d9d24aafb837ae354cdcc", "url": "https://github.com/mulesoft/mule/commit/3d0a54abf82f8b329a0d9d24aafb837ae354cdcc", "message": "progress", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "252ba6f60509045dbf81cb2ab7cd9997e5cfd206", "url": "https://github.com/mulesoft/mule/commit/252ba6f60509045dbf81cb2ab7cd9997e5cfd206", "message": "fix test", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "a570acead20c67c388284eb35e96e286f1f8007f", "url": "https://github.com/mulesoft/mule/commit/a570acead20c67c388284eb35e96e286f1f8007f", "message": "fixes", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "a2f7d1bf1846e2b2b9311696c45f260c7f7cc05e", "url": "https://github.com/mulesoft/mule/commit/a2f7d1bf1846e2b2b9311696c45f260c7f7cc05e", "message": "fix test", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "70609f884202bb0a2dbe9a7ab8611c6fe598995c", "url": "https://github.com/mulesoft/mule/commit/70609f884202bb0a2dbe9a7ab8611c6fe598995c", "message": "refact", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "8f2937792f0dd8338772fd1ae0fb57b8e9986c4f", "url": "https://github.com/mulesoft/mule/commit/8f2937792f0dd8338772fd1ae0fb57b8e9986c4f", "message": "more changes", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "097039888c4a6c2e3b4d28d291be89d2ed79063c", "url": "https://github.com/mulesoft/mule/commit/097039888c4a6c2e3b4d28d291be89d2ed79063c", "message": "Adds requested changes", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"oid": "aed0bc35e953e93974d1e189508909fcf2a45345", "url": "https://github.com/mulesoft/mule/commit/aed0bc35e953e93974d1e189508909fcf2a45345", "message": "Adds requested changes", "committedDate": "2020-12-22T17:57:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQyNjI5Nw==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547426297", "bodyText": "LegacySourceCallbackContextAdapterAdapter -> Class has double Adapter suffix.", "author": "marianogonzalez", "createdAt": "2020-12-22T18:14:16Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/SourceCallbackContextArgumentResolver.java", "diffHunk": "@@ -27,6 +28,7 @@\n \n   @Override\n   public SourceCallbackContext resolve(ExecutionContext executionContext) {\n-    return ((ExecutionContextAdapter<ComponentModel>) executionContext).getVariable(LEGACY_SOURCE_CALLBACK_CONTEXT_PARAM);\n+    return new LegacySourceCallbackContextAdapterAdapter(((ExecutionContextAdapter<ComponentModel>) executionContext)", "originalCommit": "b492052e73715adedefa3530d85ed2a2dca10747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQyOTUzMQ==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547429531", "bodyText": "This is assuming that a legacy callback will always be obtained and should always be adapted. Leave this read to function when the new API so that we don't have to touch it again when the time comes", "author": "marianogonzalez", "createdAt": "2020-12-22T18:17:24Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/resolver/SourceCallbackContextArgumentResolver.java", "diffHunk": "@@ -27,6 +28,7 @@\n \n   @Override\n   public SourceCallbackContext resolve(ExecutionContext executionContext) {\n-    return ((ExecutionContextAdapter<ComponentModel>) executionContext).getVariable(LEGACY_SOURCE_CALLBACK_CONTEXT_PARAM);\n+    return new LegacySourceCallbackContextAdapterAdapter(((ExecutionContextAdapter<ComponentModel>) executionContext)", "originalCommit": "b492052e73715adedefa3530d85ed2a2dca10747", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NzQzMDY3NQ==", "url": "https://github.com/mulesoft/mule/pull/9874#discussion_r547430675", "bodyText": "add a comment explaining that you're intentionally mixing annotations in order to test all code flows", "author": "marianogonzalez", "createdAt": "2020-12-22T18:18:30Z", "path": "tests/test-extensions/heisenberg-extension/src/main/java/org/mule/test/heisenberg/extension/HeisenbergSource.java", "diffHunk": "@@ -135,7 +135,7 @@\n   @NullSafe\n   private Map<String, Object> debtProperties;\n \n-  @Parameter\n+  @org.mule.sdk.api.annotation.param.Parameter", "originalCommit": "cfebbbbdf4221cb825ed4e8e9840562a7632d547", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aed0bc35e953e93974d1e189508909fcf2a45345", "url": "https://github.com/mulesoft/mule/commit/aed0bc35e953e93974d1e189508909fcf2a45345", "message": "Adds requested changes", "committedDate": "2020-12-22T17:57:26Z", "type": "forcePushed"}, {"oid": "d1b05b8ad53f23a0d28f6a76f5e7d50302b1443e", "url": "https://github.com/mulesoft/mule/commit/d1b05b8ad53f23a0d28f6a76f5e7d50302b1443e", "message": "Adds requested changes", "committedDate": "2020-12-22T18:59:18Z", "type": "commit"}, {"oid": "97b09fa639e7a5e904d8c6e8f3e2f2dd5676f5d7", "url": "https://github.com/mulesoft/mule/commit/97b09fa639e7a5e904d8c6e8f3e2f2dd5676f5d7", "message": "Fix problem with rebase", "committedDate": "2020-12-22T21:19:29Z", "type": "commit"}]}