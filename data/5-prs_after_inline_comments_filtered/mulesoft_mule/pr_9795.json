{"pr_number": 9795, "pr_title": "MULE-18765: Dynamic Configurations are expired even though a paginated operation is still using it.", "pr_createdAt": "2020-11-26T18:37:00Z", "pr_url": "https://github.com/mulesoft/mule/pull/9795", "timeline": [{"oid": "b1f93b572e1f7d04c126fa63f5d649bb9953fc76", "url": "https://github.com/mulesoft/mule/commit/b1f93b572e1f7d04c126fa63f5d649bb9953fc76", "message": "fix and tests", "committedDate": "2020-11-26T18:36:04Z", "type": "commit"}, {"oid": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "url": "https://github.com/mulesoft/mule/commit/0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "message": "fixed test", "committedDate": "2020-11-27T12:59:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzMjU0Mw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532632543", "bodyText": "I would implement these deprecated methods as, for example:\naddActiveComponent();\nreturn runningSources.incrementAndGet();", "author": "ndinu", "createdAt": "2020-11-30T14:22:49Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/DefaultMutableConfigurationStats.java", "diffHunk": "@@ -89,6 +100,7 @@ public int discountInflightOperation() {\n   @Override\n   public int addRunningSource() {", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQwOTM1Mg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533409352", "bodyText": "sure", "author": "SebaElizalde", "createdAt": "2020-12-01T13:33:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzMjU0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzMzI1OA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532633258", "bodyText": "addActiveComponent instead of discount", "author": "ndinu", "createdAt": "2020-11-30T14:23:56Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/MutableConfigurationStats.java", "diffHunk": "@@ -26,29 +26,57 @@\n    * Increments the return value of {@link #getInflightOperations()} by one\n    *\n    * @return the new value\n+   *\n+   * @deprecated Use {@link #discountActiveComponent()} instead.\n    */\n+  @Deprecated\n   int addInflightOperation();\n \n   /**\n    * Decrements the return value of {@link #getInflightOperations()} by one\n    *\n    * @return the new value\n+   *\n+   * @deprecated Use {@link #discountActiveComponent()} instead.\n    */\n+  @Deprecated\n   int discountInflightOperation();\n \n   /**\n    * Increments the return value of {@link #getRunningSources()} by one\n    *\n    * @return the new value\n    * @since 4.1.6 4.2.2 4.3.0\n+   *\n+   * @deprecated Use {@link #discountActiveComponent()} instead.", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzMzUzNw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532633537", "bodyText": "addActiveComponent instead of discount", "author": "ndinu", "createdAt": "2020-11-30T14:24:17Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/MutableConfigurationStats.java", "diffHunk": "@@ -26,29 +26,57 @@\n    * Increments the return value of {@link #getInflightOperations()} by one\n    *\n    * @return the new value\n+   *\n+   * @deprecated Use {@link #discountActiveComponent()} instead.", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzNjU4NQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532636585", "bodyText": "Why do we remove the old operation?", "author": "ndinu", "createdAt": "2020-11-30T14:28:40Z", "path": "tests/test-extensions/heisenberg-extension/src/main/java/org/mule/test/heisenberg/extension/HeisenbergOperations.java", "diffHunk": "@@ -611,10 +609,25 @@ public void close(HeisenbergConnection connection) throws MuleException {\n     };\n   }\n \n-  public HeisenbergExtension getConfig(@Config HeisenbergExtension config, @Optional(defaultValue = \"false\") boolean fail) {\n-    if (fail) {\n-      throw new MuleRuntimeException(createStaticMessage(\"Failed returning the config\"));\n-    }\n-    return config;\n+  @MediaType(value = TEXT_PLAIN, strict = false)", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQxODE4NA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533418184", "bodyText": "I added to test https://www.mulesoft.org/jira/browse/MULE-18984 and get the config used. But this cannot be done for a streamed operation and also I found another way of getting the config during the tests config = (HeisenbergExtension) muleContext.getExtensionManager().getConfiguration(\"heisenbergWithShortExpiration\", event).getValue(); making this operation unnecessary. So I removed it to prevent the connector from getting even more bloated with operations and stuff.", "author": "SebaElizalde", "createdAt": "2020-12-01T13:47:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzNjU4NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzNzk5MA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532637990", "bodyText": "We have to be careful with this, are we sure we are not impacting other tests?", "author": "ndinu", "createdAt": "2020-11-30T14:30:34Z", "path": "tests/test-extensions/heisenberg-extension/src/main/java/org/mule/test/heisenberg/extension/MoneyLaunderingOperation.java", "diffHunk": "@@ -232,7 +234,7 @@ public void close(HeisenbergConnection heisenbergConnection) throws MuleExceptio\n         if (getPageCalls == failOn) {\n           throw new ModuleException(CONNECTIVITY, new ConnectionException(\"Failed to retrieve Page\"));\n         }\n-        if (getPageCalls > 2) {\n+        if (getPageCalls > 3) {", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQxODQ3OQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533418479", "bodyText": "yeah checked it", "author": "SebaElizalde", "createdAt": "2020-12-01T13:47:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjYzNzk5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0Mzc3Nw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532643777", "bodyText": "Can we make the tests run faster? it seems unnecessary for them to take more than 20 seconds.", "author": "ndinu", "createdAt": "2020-11-30T14:38:38Z", "path": "modules/extensions-spring-support/src/test/java/org/mule/test/module/extension/DynamicConfigExpirationTestCase.java", "diffHunk": "@@ -31,7 +35,7 @@\n \n public class DynamicConfigExpirationTestCase extends AbstractExtensionFunctionalTestCase {\n \n-  private static final int PROBER_TIMEOUT = 20000;\n+  private static final int PROBER_TIMEOUT = 30000;", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQyNjAwMg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533426002", "bodyText": "sure", "author": "SebaElizalde", "createdAt": "2020-12-01T13:58:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0Mzc3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0NjIzNA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532646234", "bodyText": "By changing the old operation, you had to change all the tests that used it, why not create a new one?", "author": "ndinu", "createdAt": "2020-11-30T14:41:49Z", "path": "tests/test-extensions/heisenberg-extension/src/main/java/org/mule/test/heisenberg/extension/MoneyLaunderingOperation.java", "diffHunk": "@@ -223,7 +223,9 @@ public void close(HeisenbergConnection heisenbergConnection) throws MuleExceptio\n     };\n   }\n \n-  public PagingProvider<HeisenbergConnection, Integer> failAtClosePagedOperation(Integer failOn) {\n+  public PagingProvider<HeisenbergConnection, Integer> failingConnectivityPagedOperation(Integer failOn,", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQyMzU4Nw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533423587", "bodyText": "For reuse because the new operation I needed was almost identical to this one and I was trying to reduce the bloat on the heisenberg connector, and it was easy to change the tests that used it.", "author": "SebaElizalde", "createdAt": "2020-12-01T13:54:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0NjIzNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3MTQyNw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533571427", "bodyText": "revert this change. You're adding tests at the expense of others. These are not the same scenario", "author": "marianogonzalez", "createdAt": "2020-12-01T16:58:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY0NjIzNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1MTY1MQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r532651651", "bodyText": "This still needs to be decorated by the componentDecoratorFactory", "author": "ndinu", "createdAt": "2020-11-30T14:48:53Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -145,10 +149,10 @@ protected Message toMessage(Object value, ExecutionContextAdapter operationConte\n       if (resultValue.getOutput() instanceof InputStream) {\n         ConnectionHandler connectionHandler = (ConnectionHandler) operationContext.getVariable(CONNECTION_PARAM);\n         if (connectionHandler != null && supportsStreaming(operationContext.getComponentModel())) {\n-          resultValue = resultValue.copy()\n-              .output(componentDecoratorFactory\n-                  .decorateOutput(new ConnectedInputStreamWrapper((InputStream) resultValue.getOutput(), connectionHandler),\n-                                  event.getCorrelationId()))\n+          resultValue = resultValue\n+              .copy().output(new ConnectedInputStreamWrapper((InputStream) resultValue.getOutput(), connectionHandler,", "originalCommit": "0a94680aa854e7ffa4768bb4e18ebc5e1e9fd608", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQyNTc3NQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533425775", "bodyText": "right, my bad", "author": "SebaElizalde", "createdAt": "2020-12-01T13:57:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMjY1MTY1MQ=="}], "type": "inlineReview"}, {"oid": "2cda0b35badaf19764513051264b2388f6a11415", "url": "https://github.com/mulesoft/mule/commit/2cda0b35badaf19764513051264b2388f6a11415", "message": "pr review", "committedDate": "2020-12-01T14:36:46Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3NTcwNQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533475705", "bodyText": "There is no need to call the \"updateLastUsed\" method on all the deprecated methods, since the add/discount activeComponente will end up updating it anyway.", "author": "ndinu", "createdAt": "2020-12-01T14:56:25Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/DefaultMutableConfigurationStats.java", "diffHunk": "@@ -80,7 +80,7 @@ public int getActiveComponents() {\n   @Override\n   public int addInflightOperation() {\n     updateLastUsed();", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3MDQzMA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533570430", "bodyText": "I thought the intention behind calling the add/discount method directly was to abstract from its implementation, but here we are using the knowledge that it also calls updateLastUsed. Also if I delete the line updateLastUsed it will be just like before de PR review only that we shifted some code around.", "author": "SebaElizalde", "createdAt": "2020-12-01T16:57:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3NTcwNQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzNjI5NQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534336295", "bodyText": "I don't understand what you mean. This method needs to delegate to addActiveComponent() which will update the timestamp. I see no reason why updateLastUsed() should be called from here", "author": "marianogonzalez", "createdAt": "2020-12-02T17:09:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzQ3NTcwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1NzM4Ng==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533557386", "bodyText": "static import", "author": "marianogonzalez", "createdAt": "2020-12-01T16:39:50Z", "path": "modules/extensions-spring-support/src/test/java/org/mule/test/module/extension/DynamicConfigExpirationTestCase.java", "diffHunk": "@@ -127,14 +132,38 @@ public void expirationWorksAfterRestartingSource() throws Exception {\n \n   @Test\n   public void dynamicConfigIsExpiredBeforeFlowEnds() throws Exception {\n-    flowRunner(\"dynamicConfigIsExpiredBeforeFlowEnds\").withPayload(\"Walter Blanco\").run();\n-    assertDisposedStatuses();\n+    flowRunner(\"dynamicConfigIsExpiredBeforeFlowEnds\").run();\n+    assertDisposedStatuses(Arrays.asList(0, 1));", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1ODQ5MQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533558491", "bodyText": "why this change? Weird that no other assertion changed", "author": "marianogonzalez", "createdAt": "2020-12-01T16:41:15Z", "path": "modules/extensions-spring-support/src/test/java/org/mule/test/module/extension/PagedOperationExecutionTestCase.java", "diffHunk": "@@ -121,7 +121,7 @@ public void pagingProviderIsClosedSafelyDuringExceptionOnFirstPage() throws Exce\n   @Test\n   public void pagingProviderIsClosedSafelyAfterDataSourceIsFullyConsumed() throws Exception {\n     resetCounters();\n-    flowRunner(\"consumeFailAtClosePagedOperation\").withPayload(4).run();\n+    flowRunner(\"consumeFailAtClosePagedOperation\").withPayload(-1).run();", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU5MjE1Nw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533592157", "bodyText": "The 4 is a parameter indicating that on the 4th page it would fail, but on the 3rd page everything is consumed and there are no more pages, thus it does not fail. I think the -1 is more explicit of the intention \"to never fail\". I can revert it tho", "author": "SebaElizalde", "createdAt": "2020-12-01T17:28:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU1ODQ5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2NTMxMg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533565312", "bodyText": "what's changed here? if it's only formatting then revert", "author": "marianogonzalez", "createdAt": "2020-12-01T16:50:32Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -255,7 +263,10 @@ private Object streamingContent(Object value,\n       ConnectionHandler connectionHandler = (ConnectionHandler) operationContext.getVariable(CONNECTION_PARAM);\n       if (connectionHandler != null && supportsStreaming(operationContext.getComponentModel())) {\n         value = componentDecoratorFactory\n-            .decorateOutput(new ConnectedInputStreamWrapper((InputStream) value, connectionHandler), correlationId);\n+            .decorateOutput(new ConnectedInputStreamWrapper((InputStream) value, connectionHandler,", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDEyOTk3Ng==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534129976", "bodyText": "there is change", "author": "SebaElizalde", "createdAt": "2020-12-02T12:29:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2NTMxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2NjQwNQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533566405", "bodyText": "refactor per comments in ConnectedInputStreamWrapper", "author": "marianogonzalez", "createdAt": "2020-12-01T16:51:58Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -293,13 +304,36 @@ protected MediaType resolveMediaType(Object value, MediaType contextMimeType, Ch\n     return contextMimeType.withCharset(contextEncoding);\n   }\n \n+  private Runnable getIncrementActiveComponent(ExecutionContextAdapter executionContext) {", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2NjU5Mg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533566592", "bodyText": "rename: getDecrementActiveComponentTask", "author": "marianogonzalez", "createdAt": "2020-12-01T16:52:13Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -293,13 +304,36 @@ protected MediaType resolveMediaType(Object value, MediaType contextMimeType, Ch\n     return contextMimeType.withCharset(contextEncoding);\n   }\n \n+  private Runnable getIncrementActiveComponent(ExecutionContextAdapter executionContext) {\n+    Optional<ConfigurationInstance> config = executionContext.getConfiguration();\n+    if (config.isPresent()) {\n+      return () -> tryToMutateConfigurationStats(config.get(), (MutableConfigurationStats::addActiveComponent));\n+    }\n+    return null;\n+  }\n+\n+  private Runnable getDecrementActiveComponent(ExecutionContextAdapter executionContext) {", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2NzYzNA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533567634", "bodyText": "this doesn't make sense. If you want this task executed when the instance is created, then call it after doing the new... This should not be the constructor's responsibility", "author": "marianogonzalez", "createdAt": "2020-12-01T16:53:48Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -293,13 +304,36 @@ protected MediaType resolveMediaType(Object value, MediaType contextMimeType, Ch\n     return contextMimeType.withCharset(contextEncoding);\n   }\n \n+  private Runnable getIncrementActiveComponent(ExecutionContextAdapter executionContext) {\n+    Optional<ConfigurationInstance> config = executionContext.getConfiguration();\n+    if (config.isPresent()) {\n+      return () -> tryToMutateConfigurationStats(config.get(), (MutableConfigurationStats::addActiveComponent));\n+    }\n+    return null;\n+  }\n+\n+  private Runnable getDecrementActiveComponent(ExecutionContextAdapter executionContext) {\n+    Optional<ConfigurationInstance> config = executionContext.getConfiguration();\n+    if (config.isPresent()) {\n+      return () -> tryToMutateConfigurationStats(config.get(), (MutableConfigurationStats::discountActiveComponent));\n+    }\n+    return null;\n+  }\n+\n   protected class ConnectedInputStreamWrapper extends ProxyInputStream {\n \n     private final ConnectionHandler<?> connectionHandler;\n+    private final Runnable onClose;\n+    private AtomicBoolean alreadyClosed = new AtomicBoolean(false);\n \n-    private ConnectedInputStreamWrapper(InputStream delegate, ConnectionHandler<?> connectionHandler) {\n+    private ConnectedInputStreamWrapper(InputStream delegate, ConnectionHandler<?> connectionHandler, Runnable onCreate,\n+                                        Runnable onClose) {\n       super(delegate);\n       this.connectionHandler = connectionHandler;\n+      this.onClose = onClose;\n+      if (onCreate != null) {", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2ODQ4MQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533568481", "bodyText": "this should be a try.finally of it's own.. .this needs to happen even if connectionHandler.release() fails", "author": "marianogonzalez", "createdAt": "2020-12-01T16:54:53Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -322,6 +356,9 @@ public void close() throws IOException {\n         in = new ClosedInputStream();\n       } finally {\n         connectionHandler.release();\n+        if (onClose != null && alreadyClosed.compareAndSet(false, true)) {", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2OTQ3Mg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533569472", "bodyText": "this tryToMutateConfigurationStats is overkill. Just extract the the stats object in the constructor and make sure it's mutable there. No need to extract it, test it and instantiate a lamba every time", "author": "marianogonzalez", "createdAt": "2020-12-01T16:56:14Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/streaming/PagingProviderProducer.java", "diffHunk": "@@ -83,6 +88,7 @@ public PagingProviderProducer(PagingProvider<Object, T> delegate,\n     this.supportsOAuth = supportsOAuth;\n     retryPolicy = (RetryPolicyTemplate) executionContext.getRetryPolicyTemplate().orElseGet(NoRetryPolicyTemplate::new);\n     connectionSupplierFactory = createConnectionSupplierFactory();\n+    tryToMutateConfigurationStats(config, (MutableConfigurationStats::addActiveComponent));", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU2OTU3Mw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533569573", "bodyText": "delete", "author": "marianogonzalez", "createdAt": "2020-12-01T16:56:21Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/util/MuleExtensionUtils.java", "diffHunk": "@@ -550,4 +553,20 @@ public static MutableConfigurationStats getMutableConfigurationStats(ExecutionCo\n       return null;\n     }\n   }\n+\n+  /**\n+   * Calls a consumer of the {@link MutableConfigurationStats} for a given {@link ConfigurationInstance}\n+   *\n+   * @param configurationInstance the {@link ConfigurationInstance} from where to extract the stats\n+   * @param mutableConfigurationStatsConsumer the {@link MutableConfigurationStats} consumer\n+   *\n+   * @since 4.2.3 4.3.1 4.4.0\n+   */\n+  public static void tryToMutateConfigurationStats(ConfigurationInstance configurationInstance,", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3MDg3Mg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533570872", "bodyText": "timesRead -> bytesRead", "author": "marianogonzalez", "createdAt": "2020-12-01T16:58:10Z", "path": "tests/test-extensions/heisenberg-extension/src/main/java/org/mule/test/heisenberg/extension/HeisenbergOperations.java", "diffHunk": "@@ -611,10 +609,25 @@ public void close(HeisenbergConnection connection) throws MuleException {\n     };\n   }\n \n-  public HeisenbergExtension getConfig(@Config HeisenbergExtension config, @Optional(defaultValue = \"false\") boolean fail) {\n-    if (fail) {\n-      throw new MuleRuntimeException(createStaticMessage(\"Failed returning the config\"));\n-    }\n-    return config;\n+  @MediaType(value = TEXT_PLAIN, strict = false)\n+  public InputStream nameAsStreamConnected(@Config HeisenbergExtension config, @Connection HeisenbergConnection connection) {\n+    return new InputStream() {\n+\n+      private int timesRead = 0;", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzU3MTczNQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r533571735", "bodyText": "why from 2 to 3?", "author": "marianogonzalez", "createdAt": "2020-12-01T16:59:13Z", "path": "tests/test-extensions/heisenberg-extension/src/main/java/org/mule/test/heisenberg/extension/MoneyLaunderingOperation.java", "diffHunk": "@@ -232,7 +234,7 @@ public void close(HeisenbergConnection heisenbergConnection) throws MuleExceptio\n         if (getPageCalls == failOn) {\n           throw new ModuleException(CONNECTIVITY, new ConnectionException(\"Failed to retrieve Page\"));\n         }\n-        if (getPageCalls > 2) {\n+        if (getPageCalls > 3) {", "originalCommit": "2cda0b35badaf19764513051264b2388f6a11415", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "be4e39b623e4195387b4819a2ee1305d3bd8ba76", "url": "https://github.com/mulesoft/mule/commit/be4e39b623e4195387b4819a2ee1305d3bd8ba76", "message": "PR review", "committedDate": "2020-12-02T16:48:38Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzNjU0NQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534336545", "bodyText": "remove", "author": "marianogonzalez", "createdAt": "2020-12-02T17:09:38Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/DefaultMutableConfigurationStats.java", "diffHunk": "@@ -80,6 +90,7 @@ public int addInflightOperation() {\n   @Override\n   public int discountInflightOperation() {\n     updateLastUsed();", "originalCommit": "be4e39b623e4195387b4819a2ee1305d3bd8ba76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzNjYzNg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534336636", "bodyText": "remove", "author": "marianogonzalez", "createdAt": "2020-12-02T17:09:48Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/DefaultMutableConfigurationStats.java", "diffHunk": "@@ -89,6 +100,7 @@ public int discountInflightOperation() {\n   @Override\n   public int addRunningSource() {\n     updateLastUsed();", "originalCommit": "be4e39b623e4195387b4819a2ee1305d3bd8ba76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzNjcwNw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534336707", "bodyText": "remove", "author": "marianogonzalez", "createdAt": "2020-12-02T17:09:54Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/config/DefaultMutableConfigurationStats.java", "diffHunk": "@@ -98,6 +110,25 @@ public int addRunningSource() {\n   @Override\n   public int discountRunningSource() {\n     updateLastUsed();", "originalCommit": "be4e39b623e4195387b4819a2ee1305d3bd8ba76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f04309d6bf70e0e60a32237bb4a5b927174148fb", "url": "https://github.com/mulesoft/mule/commit/f04309d6bf70e0e60a32237bb4a5b927174148fb", "message": "more review", "committedDate": "2020-12-02T17:40:03Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODk3Mw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534338973", "bodyText": "static import", "author": "marianogonzalez", "createdAt": "2020-12-02T17:13:16Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -228,13 +226,13 @@ protected Message toMessage(Object value, ExecutionContextAdapter operationConte\n       if (result.getOutput() instanceof InputStream) {\n         ConnectionHandler connectionHandler = (ConnectionHandler) operationContext.getVariable(CONNECTION_PARAM);\n         if (connectionHandler != null && supportsStreaming(operationContext.getComponentModel())) {\n-          result = result.copy()\n-              .output(StreamingUtils.streamingContent(new ConnectedInputStreamWrapper(componentDecoratorFactory\n-                  .decorateOutput((InputStream) result.getOutput(), event.getCorrelationId()), connectionHandler,\n-                                                                                      getIncrementActiveComponent(operationContext),\n-                                                                                      getDecrementActiveComponent(operationContext)),\n-                                                      cursorProviderFactory, event,\n-                                                      operationContext.getComponent().getLocation()))\n+          ConnectedInputStreamWrapper streamWrapper =\n+              new ConnectedInputStreamWrapper(componentDecoratorFactory.decorateOutput((InputStream) result.getOutput(),\n+                                                                                       event.getCorrelationId()),\n+                                              connectionHandler, getDecrementActiveComponentTask(operationContext));\n+          incrementActiveComponent(operationContext);\n+          result = result.copy().output(StreamingUtils.streamingContent(streamWrapper, cursorProviderFactory, event,", "originalCommit": "be4e39b623e4195387b4819a2ee1305d3bd8ba76", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM4NTYxMw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534385613", "bodyText": "there is another streamingContent method in this class.", "author": "SebaElizalde", "createdAt": "2020-12-02T18:22:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDMzODk3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNDM3MzQ1Mw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r534373453", "bodyText": "incrementing this is not the return delegate's responsibility:\n\nthis class is used in other context to transform results to messages, and those shouldn't mess with the counters\nIf something fails AFTER the return delegate execution, nobody decrements it\n\nThe incrementing needs to happen in some other place, probably an interceptor which decrements it if the operation fails.", "author": "marianogonzalez", "createdAt": "2020-12-02T18:03:31Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/result/AbstractReturnDelegate.java", "diffHunk": "@@ -149,13 +148,12 @@ protected Message toMessage(Object value, ExecutionContextAdapter operationConte\n       if (resultValue.getOutput() instanceof InputStream) {\n         ConnectionHandler connectionHandler = (ConnectionHandler) operationContext.getVariable(CONNECTION_PARAM);\n         if (connectionHandler != null && supportsStreaming(operationContext.getComponentModel())) {\n-          resultValue = resultValue\n-              .copy().output(componentDecoratorFactory\n-                  .decorateOutput(new ConnectedInputStreamWrapper((InputStream) resultValue.getOutput(), connectionHandler,\n-                                                                  getIncrementActiveComponent(operationContext),\n-                                                                  getDecrementActiveComponent(operationContext)),\n-                                  event.getCorrelationId()))\n-              .build();\n+          ConnectedInputStreamWrapper streamWrapper =\n+              new ConnectedInputStreamWrapper((InputStream) resultValue.getOutput(), connectionHandler,\n+                                              getDecrementActiveComponentTask(operationContext));\n+          incrementActiveComponent(operationContext);", "originalCommit": "be4e39b623e4195387b4819a2ee1305d3bd8ba76", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c5bbee2408f463c89a6e9067b3bd2ef7263191bb", "url": "https://github.com/mulesoft/mule/commit/c5bbee2408f463c89a6e9067b3bd2ef7263191bb", "message": "added more test cases, moved counter increment to default execution mediator", "committedDate": "2020-12-11T18:43:44Z", "type": "commit"}, {"oid": "76e35a2c621b1df880a8134972d69a5dc7a9848a", "url": "https://github.com/mulesoft/mule/commit/76e35a2c621b1df880a8134972d69a5dc7a9848a", "message": "moved counter to component message processor", "committedDate": "2020-12-11T22:54:45Z", "type": "commit"}, {"oid": "a1b4540ef6e9e9972f2f98c5623bd4035770da91", "url": "https://github.com/mulesoft/mule/commit/a1b4540ef6e9e9972f2f98c5623bd4035770da91", "message": "re added test", "committedDate": "2020-12-12T00:00:53Z", "type": "commit"}, {"oid": "e8bddeee82b298933a39d04cc558deae2e173dc7", "url": "https://github.com/mulesoft/mule/commit/e8bddeee82b298933a39d04cc558deae2e173dc7", "message": "@test", "committedDate": "2020-12-12T13:29:51Z", "type": "commit"}, {"oid": "e6296fb4c05f642643ebfadd508a6a54ea8654c3", "url": "https://github.com/mulesoft/mule/commit/e6296fb4c05f642643ebfadd508a6a54ea8654c3", "message": "removed unsused imports", "committedDate": "2020-12-14T12:43:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyNzUyMg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r543627522", "bodyText": "feels like all of this should be happening inside the mediator. Actually, if you look at the mediators implementation, it will obtain the stats again and call addInfightOperation. That should not happen anymore. Move this into the mediator implementation and avoid unnecesary interactions with the stats object", "author": "marianogonzalez", "createdAt": "2020-12-15T19:29:53Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java", "diffHunk": "@@ -569,7 +574,42 @@ private boolean shouldUsePrecalculatedContext(CoreEvent event) {\n   }\n \n   protected void executeOperation(ExecutionContextAdapter<T> operationContext, ExecutorCallback callback) {\n-    executionMediator.execute(componentExecutor, operationContext, callback);\n+    final MutableConfigurationStats stats = getMutableConfigurationStats(operationContext);", "originalCommit": "e6296fb4c05f642643ebfadd508a6a54ea8654c3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDI2NzY4Nw==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r544267687", "bodyText": "Moved it to the mediator, but the call to addInfightOperation is still necessary there to avoid breaking the api.", "author": "SebaElizalde", "createdAt": "2020-12-16T12:42:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYyNzUyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzYzMDQwMA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r543630400", "bodyText": "move this to org.mule.runtime.module.extension.internal.util.MuleExtensionUtils", "author": "marianogonzalez", "createdAt": "2020-12-15T19:34:23Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/ComponentMessageProcessor.java", "diffHunk": "@@ -569,7 +574,42 @@ private boolean shouldUsePrecalculatedContext(CoreEvent event) {\n   }\n \n   protected void executeOperation(ExecutionContextAdapter<T> operationContext, ExecutorCallback callback) {\n-    executionMediator.execute(componentExecutor, operationContext, callback);\n+    final MutableConfigurationStats stats = getMutableConfigurationStats(operationContext);\n+    if (stats != null) {\n+      stats.addActiveComponent();\n+      executionMediator.execute(componentExecutor, operationContext, trackable(callback, stats));\n+    } else {\n+      executionMediator.execute(componentExecutor, operationContext, callback);\n+    }\n+  }\n+\n+  private ExecutorCallback trackable(ExecutorCallback callback, MutableConfigurationStats stats) {\n+    return new ExecutorCallback() {\n+\n+      @Override\n+      public void complete(Object value) {\n+        if (!isConnectedStreamingOperation()) {\n+          stats.discountActiveComponent();\n+        }\n+        callback.complete(value);\n+      }\n+\n+      @Override\n+      public void error(Throwable e) {\n+        stats.discountActiveComponent();\n+        callback.error(e);\n+      }\n+    };\n+  }\n+\n+  private Boolean isConnectedStreamingOperation() {", "originalCommit": "e6296fb4c05f642643ebfadd508a6a54ea8654c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzY0NjA4Ng==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r543646086", "bodyText": "this ternary (or something very similar) is showing up in a lot of places. Extract to org.mule.runtime.module.extension.internal.util.MuleExtensionUtils", "author": "marianogonzalez", "createdAt": "2020-12-15T19:58:31Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/streaming/PagingProviderProducer.java", "diffHunk": "@@ -83,6 +88,9 @@ public PagingProviderProducer(PagingProvider<Object, T> delegate,\n     this.supportsOAuth = supportsOAuth;\n     retryPolicy = (RetryPolicyTemplate) executionContext.getRetryPolicyTemplate().orElseGet(NoRetryPolicyTemplate::new);\n     connectionSupplierFactory = createConnectionSupplierFactory();\n+    ConfigurationStats configurationStats = config.getStatistics();\n+    mutableStats =", "originalCommit": "e6296fb4c05f642643ebfadd508a6a54ea8654c3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "192ce0a5bba43b2307f2129fbd5060d0ecf4e5cc", "url": "https://github.com/mulesoft/mule/commit/192ce0a5bba43b2307f2129fbd5060d0ecf4e5cc", "message": "review", "committedDate": "2020-12-16T12:37:28Z", "type": "commit"}, {"oid": "ac64e5f2de22f361b4f5708c4c815b34d3ee28a6", "url": "https://github.com/mulesoft/mule/commit/ac64e5f2de22f361b4f5708c4c815b34d3ee28a6", "message": "cleanup", "committedDate": "2020-12-16T12:56:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQyNjM4OQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r544426389", "bodyText": "Shouldn't this be removed? You already counted the active component. Why count twice?", "author": "marianogonzalez", "createdAt": "2020-12-16T16:10:56Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/DefaultExecutionMediator.java", "diffHunk": "@@ -101,6 +103,7 @@ public void execute(CompletableComponentExecutor<M> executor,\n \n     final MutableConfigurationStats stats = getMutableConfigurationStats(context);\n     if (stats != null) {\n+      stats.addActiveComponent();\n       stats.addInflightOperation();", "originalCommit": "ac64e5f2de22f361b4f5708c4c815b34d3ee28a6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQzMjczNg==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r544432736", "bodyText": "They count different things, I left the old one to preserve the ConfigurationStats api which states:\n/**\n\n@return How many currently executing operations are making use of the referenced configuration\n\n@deprecated Use {@link #getActiveComponents()} instead.\n*/\n@deprecated\nint getInflightOperations();", "author": "SebaElizalde", "createdAt": "2020-12-16T16:18:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQyNjM4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQyNjUzMA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r544426530", "bodyText": "same here. This line should go", "author": "marianogonzalez", "createdAt": "2020-12-16T16:11:08Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/DefaultExecutionMediator.java", "diffHunk": "@@ -152,6 +155,9 @@ public void complete(Object value) {\n         // after() method cannot be invoked in the finally. Needs to be explicitly called before completing the callback.\n         // Race conditions appear otherwise, specially in connection pooling scenarios.\n         if (stats != null) {\n+          if (!isConnectedStreamingOperation(operationModel)) {\n+            stats.discountActiveComponent();\n+          }\n           stats.discountInflightOperation();", "originalCommit": "ac64e5f2de22f361b4f5708c4c815b34d3ee28a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQyNjYxOQ==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r544426619", "bodyText": "same", "author": "marianogonzalez", "createdAt": "2020-12-16T16:11:14Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/operation/DefaultExecutionMediator.java", "diffHunk": "@@ -173,6 +179,7 @@ public void error(Throwable t) {\n         } finally {\n           if (stats != null) {\n             stats.discountInflightOperation();", "originalCommit": "ac64e5f2de22f361b4f5708c4c815b34d3ee28a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDQyNjk0NA==", "url": "https://github.com/mulesoft/mule/pull/9795#discussion_r544426944", "bodyText": "don't use boxed boolean", "author": "marianogonzalez", "createdAt": "2020-12-16T16:11:38Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/util/MuleExtensionUtils.java", "diffHunk": "@@ -550,4 +554,19 @@ public static MutableConfigurationStats getMutableConfigurationStats(ExecutionCo\n       return null;\n     }\n   }\n+\n+  /**\n+   * @return whether the {@link ComponentModel} defines a streaming operation that uses a connection.\n+   *\n+   * @since 4.2.3 - 4.3.0\n+   */\n+  public static Boolean isConnectedStreamingOperation(ComponentModel componentModel) {", "originalCommit": "ac64e5f2de22f361b4f5708c4c815b34d3ee28a6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c170f019a9a552b841c94e59a02ad2e761905208", "url": "https://github.com/mulesoft/mule/commit/c170f019a9a552b841c94e59a02ad2e761905208", "message": "boolean", "committedDate": "2020-12-16T17:35:33Z", "type": "commit"}]}