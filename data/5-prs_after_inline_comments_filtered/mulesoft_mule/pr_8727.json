{"pr_number": 8727, "pr_title": "OCS add system property for setting platfotm authentication url suffix", "pr_createdAt": "2020-03-11T19:32:17Z", "pr_url": "https://github.com/mulesoft/mule/pull/8727", "timeline": [{"oid": "1f429e5a299e62b587737ee7286b6823051ddfe7", "url": "https://github.com/mulesoft/mule/commit/1f429e5a299e62b587737ee7286b6823051ddfe7", "message": "Fix imports", "committedDate": "2020-03-12T17:27:43Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDE5NQ==", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391890195", "bodyText": "this already exists at com.mulesoft.service.oauth.internal.platform.OCSSettings#sanitizeUrl. Move to a shared Utils class that both classes can reuse", "author": "marianogonzalez", "createdAt": "2020-03-12T20:58:29Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfig.java", "diffHunk": "@@ -142,4 +156,13 @@ public PlatformManagedOAuthGrantType getGrantType() {\n   public ExtensionModel getExtensionModel() {\n     return extensionModel;\n   }\n+\n+  private static String sanitizeUrl(String url) {", "originalCommit": "1f429e5a299e62b587737ee7286b6823051ddfe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDQ0MA==", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391890440", "bodyText": "this method should only receive the entire configurationProperties object and encapsulate all the inner resolution", "author": "marianogonzalez", "createdAt": "2020-03-12T20:59:01Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfig.java", "diffHunk": "@@ -71,6 +77,14 @@ private static String getProperty(ConfigurationProperties configurationPropertie\n         .orElseThrow(() -> new IllegalArgumentException(format(\"OCS property '%s' has not been set\", key)));\n   }\n \n+  private static String getProperty(ConfigurationProperties configurationProperties, String key, String def) {\n+    return configurationProperties.resolveStringProperty(key).orElse(def);\n+  }\n+\n+  private static String resolvePlatformAuthUrl(String url, String suffix) {", "originalCommit": "1f429e5a299e62b587737ee7286b6823051ddfe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MDk3Nw==", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391890977", "bodyText": "PLATFORM_URL -> PLATFORM_AUTH_URL", "author": "marianogonzalez", "createdAt": "2020-03-12T21:00:12Z", "path": "modules/extensions-support/src/test/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfigTestCase.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright (c) MuleSoft, Inc.  All rights reserved.  http://www.mulesoft.com\n+ * The software in this package is published under the terms of the CPAL v1.0\n+ * license, a copy of which has been included with this distribution in the\n+ * LICENSE.txt file.\n+ */\n+package org.mule.runtime.module.extension.internal.runtime.connectivity.oauth.ocs;\n+\n+import static java.util.Optional.of;\n+import static org.hamcrest.CoreMatchers.*;\n+import static org.junit.Assert.assertThat;\n+import static org.mockito.Mockito.mock;\n+import static org.mockito.Mockito.when;\n+import static org.mule.runtime.extension.internal.ocs.OCSConstants.*;\n+\n+import org.junit.Before;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.mockito.junit.MockitoJUnitRunner;\n+import org.mule.runtime.api.component.ConfigurationProperties;\n+import org.mule.tck.junit4.AbstractMuleTestCase;\n+import org.mule.tck.size.SmallTest;\n+\n+@SmallTest\n+@RunWith(MockitoJUnitRunner.class)\n+public class PlatformManagedOAuthConfigTestCase extends AbstractMuleTestCase {\n+\n+  private static final String CLIENT_ID = \"a\";\n+  private static final String SECRET_ID = \"b\";\n+  private static final String ORG_ID = \"b\";\n+  private static final String SERVICE_URL = \"c\";\n+  private static final String PLATFORM_URL = \"http://localhost/accounts\";", "originalCommit": "1f429e5a299e62b587737ee7286b6823051ddfe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MTg5MTM1MQ==", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r391891351", "bodyText": "should be defined in the same place as OCS_PLATFORM_AUTH_URL is", "author": "marianogonzalez", "createdAt": "2020-03-12T21:01:05Z", "path": "modules/extensions-support/src/main/java/org/mule/runtime/module/extension/internal/runtime/connectivity/oauth/ocs/PlatformManagedOAuthConfig.java", "diffHunk": "@@ -33,6 +34,8 @@\n  */\n public class PlatformManagedOAuthConfig extends OAuthConfig<PlatformManagedOAuthGrantType> {\n \n+  private static final String DEFAULT_PLATFORM_AUTH_URL_SUFFIX = \"/oauth2/token\";", "originalCommit": "1f429e5a299e62b587737ee7286b6823051ddfe7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "9c37b9179d8e66fd4c8e118f398ad7955f4cce42", "url": "https://github.com/mulesoft/mule/commit/9c37b9179d8e66fd4c8e118f398ad7955f4cce42", "message": "Move sanitizeUrl method to shared utils", "committedDate": "2020-03-13T12:53:23Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MjMzODY1Mw==", "url": "https://github.com/mulesoft/mule/pull/8727#discussion_r392338653", "bodyText": "add @since 4.3.0", "author": "marianogonzalez", "createdAt": "2020-03-13T16:32:47Z", "path": "core/src/main/java/org/mule/runtime/core/api/util/StringUtils.java", "diffHunk": "@@ -169,5 +169,17 @@ public static String trim(String str) {\n     return org.apache.commons.lang3.StringUtils.trim(str);\n   }\n \n+  /**\n+   * Remove trailing slash from {@code url}\n+   *\n+   * @param url    an url", "originalCommit": "9c37b9179d8e66fd4c8e118f398ad7955f4cce42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3346d110ccb09d117f3fb6b4b614e092dd63bd8b", "url": "https://github.com/mulesoft/mule/commit/3346d110ccb09d117f3fb6b4b614e092dd63bd8b", "message": "Add system ppropery for platform auth url suffix", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "d61f266a7831789bf9af82c0dc4a8d89fe1a7277", "url": "https://github.com/mulesoft/mule/commit/d61f266a7831789bf9af82c0dc4a8d89fe1a7277", "message": "Add tests", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "b9e51337f2ba8e2429b8de65513bade702b8d063", "url": "https://github.com/mulesoft/mule/commit/b9e51337f2ba8e2429b8de65513bade702b8d063", "message": "Refactor tests", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "6c2d7742c07baaa54ed5c2052f913780858f2f92", "url": "https://github.com/mulesoft/mule/commit/6c2d7742c07baaa54ed5c2052f913780858f2f92", "message": "Fix imports", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "fd2b37c888d1bbd4be0d5d4f59e56053e49f4613", "url": "https://github.com/mulesoft/mule/commit/fd2b37c888d1bbd4be0d5d4f59e56053e49f4613", "message": "Rename ocs constant", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "81442e424bcd734a89703bad8b2fd9576e91cf89", "url": "https://github.com/mulesoft/mule/commit/81442e424bcd734a89703bad8b2fd9576e91cf89", "message": "Refactor tests", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "9fbd8a58822e222723450def9fe88ba31626e003", "url": "https://github.com/mulesoft/mule/commit/9fbd8a58822e222723450def9fe88ba31626e003", "message": "Refactor for using new ocs constant", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "ec4acc8753c71d38d7f70358acb096400f8433d4", "url": "https://github.com/mulesoft/mule/commit/ec4acc8753c71d38d7f70358acb096400f8433d4", "message": "Refactor resolvePlatformAuthUrl method", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "c27280d0e34dda090a88c7b77204c915b07c6da1", "url": "https://github.com/mulesoft/mule/commit/c27280d0e34dda090a88c7b77204c915b07c6da1", "message": "Move sanitizeUrl method to shared utils", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "url": "https://github.com/mulesoft/mule/commit/6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "message": "Fixes", "committedDate": "2020-03-13T17:06:06Z", "type": "commit"}, {"oid": "6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "url": "https://github.com/mulesoft/mule/commit/6e069dae705c6f09f66fec5d7a1b57e2e0513d93", "message": "Fixes", "committedDate": "2020-03-13T17:06:06Z", "type": "forcePushed"}]}