{"pr_number": 6813, "pr_title": "[KEYCLOAK-12794] - Missing id token checks in oidc broker", "pr_createdAt": "2020-02-20T20:56:20Z", "pr_url": "https://github.com/keycloak/keycloak/pull/6813", "timeline": [{"oid": "26bb96b220bf43ecac8b3cf13bab3de5e4707223", "url": "https://github.com/keycloak/keycloak/commit/26bb96b220bf43ecac8b3cf13bab3de5e4707223", "message": "[KEYCLOAK-12794] - Missing id token checks in oidc broker", "committedDate": "2020-02-21T14:33:42Z", "type": "forcePushed"}, {"oid": "0f69c51b665150756efc5fab26d9bc95c3ceb2d6", "url": "https://github.com/keycloak/keycloak/commit/0f69c51b665150756efc5fab26d9bc95c3ceb2d6", "message": "[KEYCLOAK-12794] - Missing id token checks in oidc broker", "committedDate": "2020-02-21T19:19:06Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg5Mjc5Mg==", "url": "https://github.com/keycloak/keycloak/pull/6813#discussion_r383892792", "bodyText": "Since azp is optional I would imagine some IdPs don't set it. So this should only check if token.getIssuedFor is not empty.", "author": "stianst", "createdAt": "2020-02-25T13:56:27Z", "path": "services/src/main/java/org/keycloak/broker/oidc/OIDCIdentityProvider.java", "diffHunk": "@@ -541,6 +541,10 @@ protected JsonWebToken validateToken(String encodedToken, boolean ignoreAudience\n         if (!ignoreAudience && !token.hasAudience(getConfig().getClientId())) {\n             throw new IdentityBrokerException(\"Wrong audience from token.\");\n         }\n+        \n+        if (!ignoreAudience && !getConfig().getClientId().equals(token.getIssuedFor())) {", "originalCommit": "0f69c51b665150756efc5fab26d9bc95c3ceb2d6", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDQ4NzIxOA==", "url": "https://github.com/keycloak/keycloak/pull/6813#discussion_r384487218", "bodyText": "Good point.", "author": "pedroigor", "createdAt": "2020-02-26T13:22:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Mzg5Mjc5Mg=="}], "type": "inlineReview"}, {"oid": "607c4fdd8348e3bc407d3ac70b64a6e266a23a9b", "url": "https://github.com/keycloak/keycloak/commit/607c4fdd8348e3bc407d3ac70b64a6e266a23a9b", "message": "[KEYCLOAK-12794] - Missing id token checks in oidc broker", "committedDate": "2020-02-26T13:27:57Z", "type": "commit"}, {"oid": "607c4fdd8348e3bc407d3ac70b64a6e266a23a9b", "url": "https://github.com/keycloak/keycloak/commit/607c4fdd8348e3bc407d3ac70b64a6e266a23a9b", "message": "[KEYCLOAK-12794] - Missing id token checks in oidc broker", "committedDate": "2020-02-26T13:27:57Z", "type": "forcePushed"}, {"oid": "09ab74c3d5ea8bea2c13c0e5fb5bc088b8ebba17", "url": "https://github.com/keycloak/keycloak/commit/09ab74c3d5ea8bea2c13c0e5fb5bc088b8ebba17", "message": "Update OIDCIdentityProvider.java", "committedDate": "2020-02-27T07:25:57Z", "type": "commit"}]}