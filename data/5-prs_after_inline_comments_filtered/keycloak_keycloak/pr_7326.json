{"pr_number": 7326, "pr_title": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "pr_createdAt": "2020-08-09T17:07:54Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7326", "timeline": [{"oid": "165fe9ae3b0047a380d569a33d55e37fceff216c", "url": "https://github.com/keycloak/keycloak/commit/165fe9ae3b0047a380d569a33d55e37fceff216c", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-09T18:50:02Z", "type": "forcePushed"}, {"oid": "03352bea50b97b48bcd1e26271206f9a3dfa40e1", "url": "https://github.com/keycloak/keycloak/commit/03352bea50b97b48bcd1e26271206f9a3dfa40e1", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-09T19:03:38Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTkyNTQwNw==", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r469925407", "bodyText": "Isn't better computIfAbsent? I mean, the way you did you still have the call to newRealm.getClientById.", "author": "pedroigor", "createdAt": "2020-08-13T12:48:32Z", "path": "server-spi-private/src/main/java/org/keycloak/models/utils/RepresentationToModel.java", "diffHunk": "@@ -342,20 +343,19 @@ public static void importRealm(KeycloakSession session, RealmRepresentation rep,\n         if (rep.getClients() != null) {\n             for (ClientRepresentation resourceRep : rep.getClients()) {\n                 if (resourceRep.getDefaultRoles() != null) {\n-                    ClientModel clientModel = newRealm.getClientByClientId(resourceRep.getClientId());\n+                    ClientModel clientModel = createdClients.getOrDefault(resourceRep.getClientId(), newRealm.getClientByClientId(resourceRep.getClientId()));", "originalCommit": "03352bea50b97b48bcd1e26271206f9a3dfa40e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MTE3NQ==", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r470281175", "bodyText": "Thanks for the review. You are right. changed it to computeIfAbsent", "author": "pratiksomangoudar", "createdAt": "2020-08-13T22:21:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2OTkyNTQwNw=="}], "type": "inlineReview"}, {"oid": "42c874ac86d7b52408672dbc78d1bec01d26d2bc", "url": "https://github.com/keycloak/keycloak/commit/42c874ac86d7b52408672dbc78d1bec01d26d2bc", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-13T22:16:03Z", "type": "forcePushed"}, {"oid": "c0aa920253697c98de6583690ea3f3f19ee1c81e", "url": "https://github.com/keycloak/keycloak/commit/c0aa920253697c98de6583690ea3f3f19ee1c81e", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-14T12:57:36Z", "type": "forcePushed"}, {"oid": "c1e22c6833af0aad559fd324ccc988683014a22e", "url": "https://github.com/keycloak/keycloak/commit/c1e22c6833af0aad559fd324ccc988683014a22e", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-14T12:59:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE4MDMxNg==", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r472180316", "bodyText": "I think you can use here Function.identity() to avoid the roleModel -> roleModel.", "author": "pedroigor", "createdAt": "2020-08-18T13:12:52Z", "path": "server-spi-private/src/main/java/org/keycloak/models/utils/RepresentationToModel.java", "diffHunk": "@@ -364,17 +363,19 @@ public static void importRealm(KeycloakSession session, RealmRepresentation rep,\n         }\n \n         if (rep.getScopeMappings() != null) {\n+            Map<String, RoleModel> roleModelMap = newRealm.getRolesStream().collect(Collectors.toMap(RoleModel::getId, roleModel -> roleModel));", "originalCommit": "c1e22c6833af0aad559fd324ccc988683014a22e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1NDI3OA==", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r472554278", "bodyText": "Thanks. I will update and rebase", "author": "pratiksomangoudar", "createdAt": "2020-08-18T23:46:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE4MDMxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjU1OTU1Nw==", "url": "https://github.com/keycloak/keycloak/pull/7326#discussion_r472559557", "bodyText": "Done", "author": "pratiksomangoudar", "createdAt": "2020-08-19T00:05:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MjE4MDMxNg=="}], "type": "inlineReview"}, {"oid": "ffbd1086cda0f0218d0918783ab394a0e0191d96", "url": "https://github.com/keycloak/keycloak/commit/ffbd1086cda0f0218d0918783ab394a0e0191d96", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-19T00:02:09Z", "type": "commit"}, {"oid": "ffbd1086cda0f0218d0918783ab394a0e0191d96", "url": "https://github.com/keycloak/keycloak/commit/ffbd1086cda0f0218d0918783ab394a0e0191d96", "message": "KEYCLOAK-15087 : Reduce get client and get roles calls in realm create", "committedDate": "2020-08-19T00:02:09Z", "type": "forcePushed"}]}