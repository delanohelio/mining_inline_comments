{"pr_number": 7067, "pr_title": "KEYCLOAK-14140 added more test cases", "pr_createdAt": "2020-05-13T10:05:30Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7067", "timeline": [{"oid": "e62e3d085b0dc7212e43a7a83f7457d16b73b1dc", "url": "https://github.com/keycloak/keycloak/commit/e62e3d085b0dc7212e43a7a83f7457d16b73b1dc", "message": "KEYCLOAK-14140 added more test cases", "committedDate": "2020-05-13T10:06:47Z", "type": "forcePushed"}, {"oid": "42a584cc3daa0e76c7a28a71d46ae15844499739", "url": "https://github.com/keycloak/keycloak/commit/42a584cc3daa0e76c7a28a71d46ae15844499739", "message": "KEYCLOAK-14140 added more test cases\n\nUse BaseAccountPageTest\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>\n\nfix merge errors", "committedDate": "2020-05-13T12:13:17Z", "type": "forcePushed"}, {"oid": "943a9df5669b406dc9889051ce92d5612dcbc33a", "url": "https://github.com/keycloak/keycloak/commit/943a9df5669b406dc9889051ce92d5612dcbc33a", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-05-13T12:17:54Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUxNDA4OQ==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424514089", "bodyText": "We should check expand actually works. Let's say there's a bug and it's constantly expanded. Then it won't be discovered by the tests.", "author": "vmuzikar", "createdAt": "2020-05-13T15:08:44Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -154,11 +166,23 @@ public void shouldShowMyResourcesAndUpdatePermissions() {\n     }\n \n     @Test\n-    public void shouldShowMyResourcesAndShare() {\n-        myResourcesPage.navigateTo();\n-        loginPage.form().login(createUser(\"jdoe\"));\n-        myResourcesPage.assertCurrent();\n+    public void shouldShowMyResourcesAndRemoveShares() {\n+        final int row = 2;\n+        myResourcesPage.clickExpandButton(row);", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUxNzU0Ng==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424517546", "bodyText": "Could we move the explicit pauses into the Page Object? Or maybe even better, don't wait for a specific amount of time but rather for the box to be expanded. ;)", "author": "vmuzikar", "createdAt": "2020-05-13T15:13:22Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -131,19 +142,20 @@ public void setup() throws Exception {\n         }\n     }\n \n+    @Override\n+    public void addTestUser() {\n+        testUser = createUser(\"jdoe\");\n+    }\n+\n     @Test\n     public void shouldShowMyResourcesAndUpdatePermissions() {\n-        myResourcesPage.navigateTo();\n-        loginPage.form().login(createUser(\"jdoe\"));\n-        myResourcesPage.assertCurrent();\n-\n         assertEquals(6, myResourcesPage.getResourcesListCount());\n \n-        final int row = 2;\n+        final int row = 1;\n         myResourcesPage.clickExpandButton(row);\n         pause(2000);", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUxODYzOA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424518638", "bodyText": "Please add some tests for adding and removing scopes.", "author": "vmuzikar", "createdAt": "2020-05-13T15:14:47Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -30,18 +30,20 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n import static java.util.Collections.singletonList;\n import static org.hamcrest.core.StringEndsWith.endsWith;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n import static org.keycloak.representations.idm.CredentialRepresentation.PASSWORD;\n import static org.keycloak.testsuite.auth.page.AuthRealm.TEST;\n import static org.keycloak.testsuite.util.WaitUtils.pause;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeIn;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeOut;\n \n-public class MyResourcesTest extends AbstractAccountTest {\n+public class MyResourcesTest extends BaseAccountPageTest {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkxNzQ5Nw==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424917497", "bodyText": "There is a test to remove scopes and there is a test to add scopes. So I'm not sure what you mean", "author": "edewit", "createdAt": "2020-05-14T07:12:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUxODYzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzNjI0NA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424936244", "bodyText": "Yes, and also to test the Scopes are displayed properly (if it displayes everything that should be displayed).", "author": "vmuzikar", "createdAt": "2020-05-14T07:48:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUxODYzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3ODc2Ng==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r428578766", "bodyText": "I believe this one is still valid. We're missing some test for adding scopes as well as checking that scopes are displayed properly (everything that's ought to be displayed, is displayed).", "author": "vmuzikar", "createdAt": "2020-05-21T10:45:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUxODYzOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyNDczMA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424524730", "bodyText": "waitForModalFadeIn and waitForModalFadeOut is meant to be used only by Admin Console. I'm sorry it's not apparent at the first sight, the Admin Console testsuite is a mess. It's a coincidence it works here as well but I wouldn't rely on that. Consider using testModalDialog as we discussed.", "author": "vmuzikar", "createdAt": "2020-05-13T15:22:50Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -173,6 +197,23 @@ public void shouldShowMyResourcesAndShare() {\n         assertThat(myResourcesPage.getSharedWith(row), endsWith(\"and 1 other users.\"));\n     }\n \n+    @Test\n+    public void shouldAllowRequestToShare() {\n+        final String resourceName = \"Resource 12\";\n+        myResourcesPage.clickPendingRequest(resourceName);\n+        waitForModalFadeIn();", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDkzODM3OA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424938378", "bodyText": "testModalDialog is meant for simple \"Are you sure you want to do this\" kind of dialog. On these dialog users will have to do more then just press the confirm or cancel buttons.", "author": "edewit", "createdAt": "2020-05-14T07:52:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyNDczMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDk0NjcxNg==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424946716", "bodyText": "Yes, I agree. But we should use a similar approach to test this more complex dialogs. Like try to close them, check that they are (not) displayed, etc.", "author": "vmuzikar", "createdAt": "2020-05-14T08:06:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyNDczMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUyNzkyOQ==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424527929", "bodyText": "Please add a test for the scenario when user rejects the request.", "author": "vmuzikar", "createdAt": "2020-05-13T15:27:10Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -173,6 +197,23 @@ public void shouldShowMyResourcesAndShare() {\n         assertThat(myResourcesPage.getSharedWith(row), endsWith(\"and 1 other users.\"));\n     }\n \n+    @Test\n+    public void shouldAllowRequestToShare() {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUzNTE3OQ==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424535179", "bodyText": "Please add some check to verify the tab was really switched, that the content changed.", "author": "vmuzikar", "createdAt": "2020-05-13T15:36:40Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -173,6 +197,23 @@ public void shouldShowMyResourcesAndShare() {\n         assertThat(myResourcesPage.getSharedWith(row), endsWith(\"and 1 other users.\"));\n     }\n \n+    @Test\n+    public void shouldAllowRequestToShare() {\n+        final String resourceName = \"Resource 12\";\n+        myResourcesPage.clickPendingRequest(resourceName);\n+        waitForModalFadeIn();\n+        myResourcesPage.acceptRequest(resourceName, 0);\n+        waitForModalFadeOut();\n+\n+        myResourcesPage.clickSignOut();\n+        myResourcesPage.navigateTo();\n+        loginPage.form().login(createUser(\"alice\"));\n+\n+        myResourcesPage.clickSharedWithMeTab();\n+\n+        assertTrue(myResourcesPage.containsResource(resourceName));", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUzNzE3Mw==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424537173", "bodyText": "Please add a test for the Refresh button.", "author": "vmuzikar", "createdAt": "2020-05-13T15:39:08Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -30,18 +30,20 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n import static java.util.Collections.singletonList;\n import static org.hamcrest.core.StringEndsWith.endsWith;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n import static org.keycloak.representations.idm.CredentialRepresentation.PASSWORD;\n import static org.keycloak.testsuite.auth.page.AuthRealm.TEST;\n import static org.keycloak.testsuite.util.WaitUtils.pause;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeIn;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeOut;\n \n-public class MyResourcesTest extends AbstractAccountTest {\n+public class MyResourcesTest extends BaseAccountPageTest {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU0MTM2MQ==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424541361", "bodyText": "Please add a test for the icon to check it shows correct number of pending requests.", "author": "vmuzikar", "createdAt": "2020-05-13T15:44:43Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -173,6 +197,23 @@ public void shouldShowMyResourcesAndShare() {\n         assertThat(myResourcesPage.getSharedWith(row), endsWith(\"and 1 other users.\"));\n     }\n \n+    @Test\n+    public void shouldAllowRequestToShare() {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU4MDcwMw==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r428580703", "bodyText": "Please add a test for the icon to check it shows correct number of pending requests.\n\nI believe this one is still unresolved.", "author": "vmuzikar", "createdAt": "2020-05-21T10:50:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU0MTM2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU1NDQ2Mg==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424554462", "bodyText": "Please add some simple notifications checks to all test scenarios, similarly to e.g. DeviceActivityTest.", "author": "vmuzikar", "createdAt": "2020-05-13T16:02:21Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -30,18 +30,20 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n import static java.util.Collections.singletonList;\n import static org.hamcrest.core.StringEndsWith.endsWith;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n import static org.keycloak.representations.idm.CredentialRepresentation.PASSWORD;\n import static org.keycloak.testsuite.auth.page.AuthRealm.TEST;\n import static org.keycloak.testsuite.util.WaitUtils.pause;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeIn;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeOut;\n \n-public class MyResourcesTest extends AbstractAccountTest {\n+public class MyResourcesTest extends BaseAccountPageTest {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU1NjA2NQ==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424556065", "bodyText": "Please add a test for the \"Application\" column \u2013 if it's displayed, links are present, etc.", "author": "vmuzikar", "createdAt": "2020-05-13T16:04:40Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -30,18 +30,20 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n import static java.util.Collections.singletonList;\n import static org.hamcrest.core.StringEndsWith.endsWith;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n import static org.keycloak.representations.idm.CredentialRepresentation.PASSWORD;\n import static org.keycloak.testsuite.auth.page.AuthRealm.TEST;\n import static org.keycloak.testsuite.util.WaitUtils.pause;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeIn;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeOut;\n \n-public class MyResourcesTest extends AbstractAccountTest {\n+public class MyResourcesTest extends BaseAccountPageTest {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDU2Njk0Ng==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r424566946", "bodyText": "Please add a test for the Pending requests dialog and Edit resource dialog to check if it displays all the users it is supposed to.", "author": "vmuzikar", "createdAt": "2020-05-13T16:20:51Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -30,18 +30,20 @@\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n+import java.util.stream.Collectors;\n \n import static java.util.Collections.singletonList;\n import static org.hamcrest.core.StringEndsWith.endsWith;\n import static org.junit.Assert.assertEquals;\n import static org.junit.Assert.assertThat;\n+import static org.junit.Assert.assertTrue;\n import static org.keycloak.representations.idm.CredentialRepresentation.PASSWORD;\n import static org.keycloak.testsuite.auth.page.AuthRealm.TEST;\n import static org.keycloak.testsuite.util.WaitUtils.pause;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeIn;\n import static org.keycloak.testsuite.util.WaitUtils.waitForModalFadeOut;\n \n-public class MyResourcesTest extends AbstractAccountTest {\n+public class MyResourcesTest extends BaseAccountPageTest {", "originalCommit": "943a9df5669b406dc9889051ce92d5612dcbc33a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "a1a39d218a74b8a4da079f607abe7d1f074aeb61", "url": "https://github.com/keycloak/keycloak/commit/a1a39d218a74b8a4da079f607abe7d1f074aeb61", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-05-14T11:49:02Z", "type": "forcePushed"}, {"oid": "0b75961986ccb625fb55a9777fac29dc0315d729", "url": "https://github.com/keycloak/keycloak/commit/0b75961986ccb625fb55a9777fac29dc0315d729", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-05-15T09:34:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MDU3OA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r428570578", "bodyText": "Please add a simple assert to verify that link is also present here.\nI believe there is some scenario when a link is not present at all, right? We should test that too.", "author": "vmuzikar", "createdAt": "2020-05-21T10:25:52Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -131,48 +121,133 @@ public void setup() throws Exception {\n         }\n     }\n \n+    private ResourceRepresentation createResource(AuthzClient authzClient, AuthorizationResource authorization, int i) {\n+        ResourceRepresentation resource = new ResourceRepresentation();\n+\n+        resource.setOwnerManagedAccess(true);\n+\n+        try {\n+            final byte[] content = new JWSInput(authzClient.obtainAccessToken(\"jdoe\", PASSWORD).getToken()).getContent();\n+            final AccessToken accessToken = JsonSerialization.readValue(content, AccessToken.class);\n+            resource.setOwner(accessToken.getSubject());\n+        }\n+        catch (Exception e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        resource.setName(\"Resource \" + i);\n+        resource.setDisplayName(\"Display Name \" + i);\n+        resource.setIconUri(\"Icon Uri \" + i);\n+        resource.addScope(\"Scope A\", \"Scope B\", \"Scope C\", \"Scope D\");\n+        resource.setUri(\"http://resourceServer.com/resources/\" + i);\n+\n+        try (Response response1 = authorization.resources().create(resource)) {\n+            resource.setId(response1.readEntity(ResourceRepresentation.class).getId());\n+        }\n+        return resource;\n+    }\n+\n+    @Override\n+    public void addTestUser() {\n+        testUser = createUser(\"jdoe\");\n+    }\n+\n+    @Test\n+    public void shouldDisplayTheResources() {\n+        assertEquals(6, myResourcesPage.getResourcesListCount());\n+\n+        assertEquals(\"Resource 0\", myResourcesPage.getCellText(\"name\", 0));\n+        assertEquals(\"Resource 1\", myResourcesPage.getCellText(\"name\", 1));\n+        assertEquals(\"My Resource Server\", myResourcesPage.getCellText(\"client\", 0));", "originalCommit": "0b75961986ccb625fb55a9777fac29dc0315d729", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0MjQwNw==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r429742407", "bodyText": "there should always be a link: \n  \n    \n      keycloak/themes/src/main/resources/theme/keycloak-preview/account/resources/app/content/my-resources-page/ResourcesTable.tsx\n    \n    \n         Line 130\n      in\n      0b75961\n    \n    \n    \n    \n\n        \n          \n           <a href={resource.client.baseUrl}>{this.getClientName(resource.client)}</a>", "author": "edewit", "createdAt": "2020-05-25T05:53:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MDU3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc1NzY0Ng==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r429757646", "bodyText": "What if the client doesn't have Base URL? ;)", "author": "vmuzikar", "createdAt": "2020-05-25T06:45:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MDU3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3MTQyNA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r428571424", "bodyText": "Could we test that collapsing works as well?", "author": "vmuzikar", "createdAt": "2020-05-21T10:27:42Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/MyResourcesTest.java", "diffHunk": "@@ -131,48 +121,133 @@ public void setup() throws Exception {\n         }\n     }\n \n+    private ResourceRepresentation createResource(AuthzClient authzClient, AuthorizationResource authorization, int i) {\n+        ResourceRepresentation resource = new ResourceRepresentation();\n+\n+        resource.setOwnerManagedAccess(true);\n+\n+        try {\n+            final byte[] content = new JWSInput(authzClient.obtainAccessToken(\"jdoe\", PASSWORD).getToken()).getContent();\n+            final AccessToken accessToken = JsonSerialization.readValue(content, AccessToken.class);\n+            resource.setOwner(accessToken.getSubject());\n+        }\n+        catch (Exception e) {\n+            throw new RuntimeException(e);\n+        }\n+\n+        resource.setName(\"Resource \" + i);\n+        resource.setDisplayName(\"Display Name \" + i);\n+        resource.setIconUri(\"Icon Uri \" + i);\n+        resource.addScope(\"Scope A\", \"Scope B\", \"Scope C\", \"Scope D\");\n+        resource.setUri(\"http://resourceServer.com/resources/\" + i);\n+\n+        try (Response response1 = authorization.resources().create(resource)) {\n+            resource.setId(response1.readEntity(ResourceRepresentation.class).getId());\n+        }\n+        return resource;\n+    }\n+\n+    @Override\n+    public void addTestUser() {\n+        testUser = createUser(\"jdoe\");\n+    }\n+\n+    @Test\n+    public void shouldDisplayTheResources() {\n+        assertEquals(6, myResourcesPage.getResourcesListCount());\n+\n+        assertEquals(\"Resource 0\", myResourcesPage.getCellText(\"name\", 0));\n+        assertEquals(\"Resource 1\", myResourcesPage.getCellText(\"name\", 1));\n+        assertEquals(\"My Resource Server\", myResourcesPage.getCellText(\"client\", 0));\n+    }\n+\n     @Test\n     public void shouldShowMyResourcesAndUpdatePermissions() {\n-        myResourcesPage.navigateTo();\n-        loginPage.form().login(createUser(\"jdoe\"));\n-        myResourcesPage.assertCurrent();\n+        final int row = 1;\n+        myResourcesPage.clickExpandButton(row);", "originalCommit": "0b75961986ccb625fb55a9777fac29dc0315d729", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjM5MA==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r428576390", "bodyText": "Why to override this method? It seems identical (the alert field as well) to the parent.", "author": "vmuzikar", "createdAt": "2020-05-21T10:39:52Z", "path": "testsuite/integration-arquillian/tests/other/base-ui/src/test/java/org/keycloak/testsuite/ui/account2/page/MyResourcesPage.java", "diffHunk": "@@ -34,25 +55,99 @@ public void clickShareButton(int row) {\n \n         //first button is share\n         webElement.findElements(By.tagName(\"button\")).get(0).click();\n+        waitForModalFadeIn();\n     }\n \n     public void clickEditButton(int row) {\n         final WebElement webElement = driver.findElement(By.id(\"ex-expand\" + row));\n \n         //first button share 2rd is the edit button\n         webElement.findElements(By.tagName(\"button\")).get(1).click();\n+        waitForModalFadeIn();\n+    }\n+\n+    public String getEditDialogUsername(int row) {\n+        return driver.findElement(By.id(\"userName-\" + row)).getText();\n+    }\n+\n+    private void waitForModalFadeIn() {\n+        waitGui().until().element(By.className(\"pf-c-modal-box\")).is().present();\n+    }\n+\n+    public void clickRemoveButton(int row) {\n+        final WebElement webElement = driver.findElement(By.id(\"ex-expand\" + row));\n+\n+        //first button share 2rd is the edit button and 3rd is remove\n+        webElement.findElements(By.tagName(\"button\")).get(2).click();\n+    }\n+\n+    public void clickPendingRequest(String resourceName) {\n+        final WebElement pendingRequestButton = driver.findElement(By.id(\"shareRequest-\" + resourceNameToId(resourceName)));\n+        assertEquals(\"1\", pendingRequestButton.getText());\n+        pendingRequestButton.click();\n+    }\n+\n+    public void acceptRequest(String resourceName, int row) {\n+        clickApproveDenyButton(resourceName, row, true);\n+    }\n+\n+    public void denyRequest(String resourceName, int row) {\n+        clickApproveDenyButton(resourceName, row, false);\n+    }\n+\n+    private void clickApproveDenyButton(String resourceName, int row, boolean approve) {\n+        final By id = By.id(String.format(\"%s-%d-shareRequest-%s\", approve ? \"accept\" : \"deny\", row, resourceNameToId(resourceName)));\n+        driver.findElement(id).click();\n+        waitForModalFadeOut();\n+    }\n+\n+    private String resourceNameToId(String resourceName) {\n+        return resourceName.replace(\" \", \"-\");\n+    }\n+\n+    public void clickSignOut() {\n+        driver.findElement(By.id(\"signOutButton\")).click();\n+    }\n+\n+    public void clickNextPage() {\n+        final WebElement webElement = driver.findElements(By.className(\"pf-m-primary\")).get(1);\n+        assertEquals(\"Next>\", webElement.getText());\n+        webElement.click();\n+    }\n+\n+    public void clickSharedWithMeTab() {\n+        final WebElement sharedWithMe = driver.findElement(By.id(\"pf-tab-1-sharedwithMe\"));\n+        sharedWithMe.click();\n+\n+        final WebElement tab = sharedWithMe.findElement(By.xpath(\"./..\"));\n+        //test to see that the tab is really clicked\n+        assertEquals(\"pf-c-tabs__item pf-m-current\", tab.getAttribute(\"class\"));\n+    }\n+\n+    public boolean containsResource(String resourceName) {\n+        return driver.findElement(By.id(\"sharedResourcesList\")).getText().contains(resourceName);\n     }\n \n     public void createShare(String userName) {\n         driver.findElement(By.id(\"username\")).sendKeys(userName);\n         driver.findElement(By.id(\"add\")).click();\n         driver.findElement(By.id(\"remove_pf-random-id-1\")).click();\n         driver.findElement(By.id(\"done\")).click();\n+        waitForModalFadeOut();\n     }\n \n     public void removeAllPermissions() {\n         driver.findElement(By.id(\"remove_pf-random-id-1\")).click();\n         driver.findElement(By.id(\"remove_pf-random-id-2\")).click();\n         driver.findElement(By.id(\"done\")).click();\n+        waitForModalFadeOut();\n+    }\n+\n+    public ContentAlert alert() {\n+        return alert;\n+    }", "originalCommit": "0b75961986ccb625fb55a9777fac29dc0315d729", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTc0NzgzNg==", "url": "https://github.com/keycloak/keycloak/pull/7067#discussion_r429747836", "bodyText": "oops", "author": "edewit", "createdAt": "2020-05-25T06:12:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODU3NjM5MA=="}], "type": "inlineReview"}, {"oid": "7d482bd96585f0cbf16b1e553baa337aa82a71b1", "url": "https://github.com/keycloak/keycloak/commit/7d482bd96585f0cbf16b1e553baa337aa82a71b1", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-05-25T07:57:27Z", "type": "forcePushed"}, {"oid": "73b901eceb579f30ca5244f34132adea15fbea50", "url": "https://github.com/keycloak/keycloak/commit/73b901eceb579f30ca5244f34132adea15fbea50", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-05-28T07:19:31Z", "type": "forcePushed"}, {"oid": "3f73b9ba6432ab661cffda16fb1725e4f9036f63", "url": "https://github.com/keycloak/keycloak/commit/3f73b9ba6432ab661cffda16fb1725e4f9036f63", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-08T11:43:41Z", "type": "forcePushed"}, {"oid": "22146622a2ffaeb2dc45c6e52d6e7866a20e7efb", "url": "https://github.com/keycloak/keycloak/commit/22146622a2ffaeb2dc45c6e52d6e7866a20e7efb", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-09T13:53:48Z", "type": "forcePushed"}, {"oid": "413ecd97dc465780e52e21e50b409f15b3fc1cf7", "url": "https://github.com/keycloak/keycloak/commit/413ecd97dc465780e52e21e50b409f15b3fc1cf7", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-10T11:35:06Z", "type": "forcePushed"}, {"oid": "e9741b2f090fae87d05cb77bb617c2f4cf91914f", "url": "https://github.com/keycloak/keycloak/commit/e9741b2f090fae87d05cb77bb617c2f4cf91914f", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-11T13:16:29Z", "type": "forcePushed"}, {"oid": "869dfc5cc525ee2246fcad9d9dc7fcf35a6bb8c5", "url": "https://github.com/keycloak/keycloak/commit/869dfc5cc525ee2246fcad9d9dc7fcf35a6bb8c5", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-15T06:06:47Z", "type": "forcePushed"}, {"oid": "c66444e8c96ff67ea5adc89b432ecc6f56ebe8db", "url": "https://github.com/keycloak/keycloak/commit/c66444e8c96ff67ea5adc89b432ecc6f56ebe8db", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-15T06:38:52Z", "type": "forcePushed"}, {"oid": "3ca37e2926bc7cea6888e35438379304682e1cc9", "url": "https://github.com/keycloak/keycloak/commit/3ca37e2926bc7cea6888e35438379304682e1cc9", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-16T08:58:10Z", "type": "forcePushed"}, {"oid": "fd50d6a0c3a3a73373e2b3473c1ef50f595116bd", "url": "https://github.com/keycloak/keycloak/commit/fd50d6a0c3a3a73373e2b3473c1ef50f595116bd", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-17T14:47:18Z", "type": "commit"}, {"oid": "fd50d6a0c3a3a73373e2b3473c1ef50f595116bd", "url": "https://github.com/keycloak/keycloak/commit/fd50d6a0c3a3a73373e2b3473c1ef50f595116bd", "message": "KEYCLOAK-14140 added more test cases\n\nCo-authored-by: vmuzikar <vmuzikar@redhat.com>", "committedDate": "2020-06-17T14:47:18Z", "type": "forcePushed"}]}