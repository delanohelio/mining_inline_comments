{"pr_number": 7438, "pr_title": "[KEYCLOAK-14221] - Allow to map subject to userinfo response", "pr_createdAt": "2020-09-22T14:58:24Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7438", "timeline": [{"oid": "f486a46cba18efa7563de1fe0744c3ee650a44c5", "url": "https://github.com/keycloak/keycloak/commit/f486a46cba18efa7563de1fe0744c3ee650a44c5", "message": "[KEYCLOAK-14221] - Allow to map subject to userinfo response", "committedDate": "2020-09-22T14:56:39Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw==", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493234473", "bodyText": "Not sure I understand the reason behind this change", "author": "stianst", "createdAt": "2020-09-23T06:45:27Z", "path": "services/src/main/java/org/keycloak/protocol/oidc/mappers/AbstractPairwiseSubMapper.java", "diffHunk": "@@ -90,7 +90,7 @@ protected void setAccessTokenSubject(IDToken token, String pairwiseSub) {\n     }\n \n     protected void setUserInfoTokenSubject(IDToken token, String pairwiseSub) {\n-        token.setSubject(pairwiseSub);\n+        token.getOtherClaims().put(\"sub\", pairwiseSub);", "originalCommit": "f486a46cba18efa7563de1fe0744c3ee650a44c5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQyMTAyOQ==", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493421029", "bodyText": "Only reverted the change I did in the previous PR.", "author": "pedroigor", "createdAt": "2020-09-23T10:25:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQzNDY2MA==", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493434660", "bodyText": "Seems like the change you made here was valid, but not sure tbh, as this stuff really is a bit odd.", "author": "stianst", "createdAt": "2020-09-23T10:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzQ0MjcwOA==", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493442708", "bodyText": "Yes, but I would prefer reverting it as it was before. It was not really related to the original issue.", "author": "pedroigor", "createdAt": "2020-09-23T10:49:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzUxNzA1Mg==", "url": "https://github.com/keycloak/keycloak/pull/7438#discussion_r493517052", "bodyText": "I agree that this is strange workaround, however it seems as the safest what can be done IMO.\nThe problem is one bigger issue that UserInfoTokenMapper class accepts \"AccessToken\" as an argument for some reason. This doesn't makes sense to me as it should instead accept \"UserInfo\" representation as an argument. This will allow to cleanup these workarounds and the strange code in UserInfoEndpoint, which need to manually convert token into the \"claims\" map. I've created JIRA for this few days ago https://issues.redhat.com/browse/KEYCLOAK-15537 . I suggest to address that one as a follow-up to remove workarounds. For now, I am just accepting the PR as it seems as the safest way for the backport to z-stream.", "author": "mposolda", "createdAt": "2020-09-23T12:14:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzIzNDQ3Mw=="}], "type": "inlineReview"}]}