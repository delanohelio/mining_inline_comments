{"pr_number": 7220, "pr_title": "KEYCLOAK-13983 Include algorithm parameters", "pr_createdAt": "2020-07-01T08:35:08Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7220", "timeline": [{"oid": "7127ffa48bbf7bccf447d38861bfea6159e0440c", "url": "https://github.com/keycloak/keycloak/commit/7127ffa48bbf7bccf447d38861bfea6159e0440c", "message": "KEYCLOAK-13983 Include algorithm parameters\n\nAdds the capacity to add both public and secret algorithm\nspecific data to a PasswordCredentialModel. The default\nway to create the models in maintained to minimize the change\nimpact for the default hash infrastructure.\n\nPublishes the PasswordCredentialModel constructor to\nease in building such extended credential models.", "committedDate": "2020-07-01T08:32:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA3MzMwOA==", "url": "https://github.com/keycloak/keycloak/pull/7220#discussion_r462073308", "bodyText": "Just for the sake of compatibility with other implementations, could we keep the constructor private and instead introduce other static method like for example:\npublic static PasswordCredentialModel createFromValues(String algorithm, byte[] salt, int hashIterations, String \nencodedPassword, MultivaluedHashMap<String, String> otherCredentialData,, MultivaluedHashMap<String, String> otherSecretData)\n\nThe current method signature \"createFromValues\" needs to be kept as well for the backwards compatibility, but it can just call the new method. Something like:\npublic static PasswordCredentialModel createFromValues(String algorithm, byte[] salt, int hashIterations, String encodedPassword) {\n    createFromValues(algorithm, salt, hashIterations, encodedPassword, Collections.emptyMap(), Collections.emptyMap());\n}", "author": "mposolda", "createdAt": "2020-07-29T06:44:00Z", "path": "server-spi/src/main/java/org/keycloak/models/credential/PasswordCredentialModel.java", "diffHunk": "@@ -15,7 +15,7 @@\n     private final PasswordCredentialData credentialData;\n     private final PasswordSecretData secretData;\n \n-    private PasswordCredentialModel(PasswordCredentialData credentialData, PasswordSecretData secretData) {\n+    public PasswordCredentialModel(PasswordCredentialData credentialData, PasswordSecretData secretData) {", "originalCommit": "7127ffa48bbf7bccf447d38861bfea6159e0440c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjI1Nzg1NQ==", "url": "https://github.com/keycloak/keycloak/pull/7220#discussion_r462257855", "bodyText": "@mposolda Yeah, you're right about the credential data. I was thinking about a separated and more general-purpose thing like what you mentioned before in regards to something like \"otherClaims\". And possibly avoid migration, etc.\nBut if you think we can reuse that column, that is fine.", "author": "pedroigor", "createdAt": "2020-07-29T12:24:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA3MzMwOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzc5MzAwNA==", "url": "https://github.com/keycloak/keycloak/pull/7220#discussion_r463793004", "bodyText": "I agree, we can move to a static factory + private constructor. The rename is also okay.\nI am not completely onboard that using multi-value hashmaps is a useful feature here, but if you strongly prefer it, it will serve the purpose I had envisioned. So yeah, I will add that as well.\nI think I will be able to do the updates either this weekend or early next week. :)", "author": "Norwae", "createdAt": "2020-07-31T19:29:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjA3MzMwOA=="}], "type": "inlineReview"}, {"oid": "04c267537b41902e3cad8f11b7068eb6603ead51", "url": "https://github.com/keycloak/keycloak/commit/04c267537b41902e3cad8f11b7068eb6603ead51", "message": "KEYCLOAK-13983 Include algorithm parameters\n\nInclude suggestions made by @mposolda to enable more generic\nusage", "committedDate": "2020-08-04T08:13:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjQ3Mg==", "url": "https://github.com/keycloak/keycloak/pull/7220#discussion_r464992472", "bodyText": "Could you lazily create the instance on the getter method and avoid creating this instance every time an instance is created? We are working on reducing footprint and small changes like will help.", "author": "pedroigor", "createdAt": "2020-08-04T11:49:23Z", "path": "server-spi/src/main/java/org/keycloak/models/credential/dto/PasswordSecretData.java", "diffHunk": "@@ -26,9 +40,15 @@ public PasswordSecretData(@JsonProperty(\"value\") String value, @JsonProperty(\"sa\n         }\n     }\n \n+    /**\n+     * Default creator (Secret consists only of a value and a single salt)\n+     * @param value hash value\n+     * @param salt salt\n+     */\n     public PasswordSecretData(String value, byte[] salt) {\n         this.value = value;\n         this.salt = salt;\n+        this.additionalParameters = new MultivaluedHashMap<>();", "originalCommit": "04c267537b41902e3cad8f11b7068eb6603ead51", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTA0OTc4MQ==", "url": "https://github.com/keycloak/keycloak/pull/7220#discussion_r465049781", "bodyText": "Doing so would require me to give up the final modifier on the fields (lazy creation), or alternatively allow the field to be null. Since all the explicitly-modeled fields are final in these types, I would prefer to not break this pattern (principle of least surprise).\nAgain, I will defer to your judgement here, but I at least wanted to raise the point.", "author": "Norwae", "createdAt": "2020-08-04T13:28:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjQ3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NTIwOTM0Nw==", "url": "https://github.com/keycloak/keycloak/pull/7220#discussion_r465209347", "bodyText": "I prefer the lazy creation or maybe you can just initialize as an empty collection when the instance is created using this constructor?", "author": "pedroigor", "createdAt": "2020-08-04T17:22:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDk5MjQ3Mg=="}], "type": "inlineReview"}, {"oid": "7e178af1213bc99277dddd8d23a97062e01bf926", "url": "https://github.com/keycloak/keycloak/commit/7e178af1213bc99277dddd8d23a97062e01bf926", "message": "KEYCLOAK-13983 Include algorithm parameters\n\nRestore accidental change", "committedDate": "2020-08-04T13:25:41Z", "type": "commit"}, {"oid": "a9a03510e57adaeae1d725a100630f3a6a098ba2", "url": "https://github.com/keycloak/keycloak/commit/a9a03510e57adaeae1d725a100630f3a6a098ba2", "message": "KEYCLOAK-13983 Include algorithm parameters\n\nLazy initialization of additional parameters", "committedDate": "2020-08-07T09:27:10Z", "type": "commit"}]}