{"pr_number": 7358, "pr_title": "[KEYCLOAK-14432] Unhandled NPE in identity broker auth response", "pr_createdAt": "2020-08-19T15:46:08Z", "pr_url": "https://github.com/keycloak/keycloak/pull/7358", "timeline": [{"oid": "11a01d204a6a60ede1203d8b3bd1851cc822d842", "url": "https://github.com/keycloak/keycloak/commit/11a01d204a6a60ede1203d8b3bd1851cc822d842", "message": "[KEYCLOAK-14432] Unhandled NPE in identity broker auth response", "committedDate": "2020-08-20T18:20:57Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3NTEwOA==", "url": "https://github.com/keycloak/keycloak/pull/7358#discussion_r474675108", "bodyText": "Is it possible to move the test to some test under package \"org.keycloak.testsuite.broker\" ? For example KcOidcBrokerTest? The IdentityProviderTest is used rather for testing admin REST API related to IdentityProvider CRUD rather than for testing identity brokering logic itself.", "author": "mposolda", "createdAt": "2020-08-21T12:48:46Z", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/IdentityProviderTest.java", "diffHunk": "@@ -850,6 +856,28 @@ public void testInstalledIdentityProviders() {\n         Assert.assertEquals(\"Status\", 400, response.getStatus());\n     }\n \n+    @Test\n+    public void testMissingStateParameter() throws IOException {", "originalCommit": "11a01d204a6a60ede1203d8b3bd1851cc822d842", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc1NTkzMQ==", "url": "https://github.com/keycloak/keycloak/pull/7358#discussion_r474755931", "bodyText": "Ok, thanks.", "author": "mabartos", "createdAt": "2020-08-21T15:03:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3NTEwOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3NjI1OQ==", "url": "https://github.com/keycloak/keycloak/pull/7358#discussion_r474676259", "bodyText": "Is it possible to just visit the URL with webDriver instead of using Apache HTTP client? Something like \"driver.navigate().to(LINK)\" . I am not sure if you use Apache HTTP Clinet due some issues with using WebDriver, but it will be ideal to use it, as normally this functionality is also tested by users in the \"browser\" itself.", "author": "mposolda", "createdAt": "2020-08-21T12:50:59Z", "path": "testsuite/integration-arquillian/tests/base/src/test/java/org/keycloak/testsuite/admin/IdentityProviderTest.java", "diffHunk": "@@ -850,6 +856,28 @@ public void testInstalledIdentityProviders() {\n         Assert.assertEquals(\"Status\", 400, response.getStatus());\n     }\n \n+    @Test\n+    public void testMissingStateParameter() throws IOException {\n+        final String IDP_NAME = \"github\";\n+        final String LINK = oauth.AUTH_SERVER_ROOT + \"/realms/\" + REALM_NAME + \"/broker/\" + IDP_NAME + \"/endpoint?code=foo123\";\n+\n+        create(createRep(IDP_NAME, IDP_NAME));\n+        IdentityProviderResource provider = realm.identityProviders().get(IDP_NAME);\n+        assertNotNull(provider);\n+\n+        try (CloseableHttpClient client = HttpClientBuilder.create().build();", "originalCommit": "11a01d204a6a60ede1203d8b3bd1851cc822d842", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDc1NjA3MQ==", "url": "https://github.com/keycloak/keycloak/pull/7358#discussion_r474756071", "bodyText": "Ok", "author": "mabartos", "createdAt": "2020-08-21T15:04:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NDY3NjI1OQ=="}], "type": "inlineReview"}, {"oid": "49b1a131d3dd01beedb9e3045e05eada3a80bb3d", "url": "https://github.com/keycloak/keycloak/commit/49b1a131d3dd01beedb9e3045e05eada3a80bb3d", "message": "[KEYCLOAK-14432] Unhandled NPE in identity broker auth response", "committedDate": "2020-08-21T15:58:39Z", "type": "commit"}, {"oid": "49b1a131d3dd01beedb9e3045e05eada3a80bb3d", "url": "https://github.com/keycloak/keycloak/commit/49b1a131d3dd01beedb9e3045e05eada3a80bb3d", "message": "[KEYCLOAK-14432] Unhandled NPE in identity broker auth response", "committedDate": "2020-08-21T15:58:39Z", "type": "forcePushed"}]}