{"pr_number": 511, "pr_title": "Garbage collection adjustments", "pr_createdAt": "2020-05-05T14:35:39Z", "pr_url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511", "timeline": [{"oid": "b6191c267d123541da32c35e334ddb12dbae5fb5", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/b6191c267d123541da32c35e334ddb12dbae5fb5", "message": "garbage collection adjustments", "committedDate": "2020-05-05T14:30:50Z", "type": "commit"}, {"oid": "c3d80c14bef5b8f557684e67adf7a03c0bd8fbec", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/c3d80c14bef5b8f557684e67adf7a03c0bd8fbec", "message": "revert listenable future class variables", "committedDate": "2020-05-06T15:52:54Z", "type": "commit"}, {"oid": "4fdffdcd21852553fa46ccdf1cd68f9c759f1353", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/4fdffdcd21852553fa46ccdf1cd68f9c759f1353", "message": "remove unused imports", "committedDate": "2020-05-06T15:55:22Z", "type": "commit"}, {"oid": "7e3f833e089536df00b367f9943bf7e8bba163a2", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/7e3f833e089536df00b367f9943bf7e8bba163a2", "message": "revert to original", "committedDate": "2020-05-06T15:59:05Z", "type": "commit"}, {"oid": "80b5a777ac9abf0f6bce6775b3881acd60a8702d", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/80b5a777ac9abf0f6bce6775b3881acd60a8702d", "message": "Merge branch 'master' into review_member_variables", "committedDate": "2020-05-11T09:48:34Z", "type": "commit"}, {"oid": "5188af58bbcc58eb23ed989d7a97790168fcef6b", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/5188af58bbcc58eb23ed989d7a97790168fcef6b", "message": "raster category", "committedDate": "2020-05-11T09:58:44Z", "type": "commit"}, {"oid": "d7c8f35331997b7907951a92f1bba2f2733d33bb", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/d7c8f35331997b7907951a92f1bba2f2733d33bb", "message": "scene category", "committedDate": "2020-05-11T10:01:16Z", "type": "commit"}, {"oid": "d8019f4f531f738615f758d32ea30d8b1c39ba00", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/d8019f4f531f738615f758d32ea30d8b1c39ba00", "message": "symbology category", "committedDate": "2020-05-11T10:09:56Z", "type": "commit"}, {"oid": "e50992969ffe81050e85a4fc81c55bf63cb08172", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/e50992969ffe81050e85a4fc81c55bf63cb08172", "message": "tiled layers category", "committedDate": "2020-05-11T10:14:33Z", "type": "commit"}, {"oid": "ae7e4d8dfae61cb31bf0c0366b431cdc1a36a15c", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/ae7e4d8dfae61cb31bf0c0366b431cdc1a36a15c", "message": "analysis category", "committedDate": "2020-05-11T10:20:15Z", "type": "commit"}, {"oid": "4425b3955842df666865e06d2d1841850e884c22", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/4425b3955842df666865e06d2d1841850e884c22", "message": "display info category", "committedDate": "2020-05-11T10:22:39Z", "type": "commit"}, {"oid": "403087daf3621e47be4d5fdd4c62ff0f9c46deee", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/403087daf3621e47be4d5fdd4c62ff0f9c46deee", "message": "editing category", "committedDate": "2020-05-11T10:26:58Z", "type": "commit"}, {"oid": "e440578a472f7007f5d189ec4649031637759c12", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/e440578a472f7007f5d189ec4649031637759c12", "message": "feature layers category", "committedDate": "2020-05-11T11:22:09Z", "type": "commit"}, {"oid": "872531fbb4b1264fa536924c30317927fc9911ed", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/872531fbb4b1264fa536924c30317927fc9911ed", "message": "geometry category", "committedDate": "2020-05-11T11:24:10Z", "type": "commit"}, {"oid": "057f0db3a2bf3ef9a30a4f6750760dff77bc5142", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/057f0db3a2bf3ef9a30a4f6750760dff77bc5142", "message": "group layers category", "committedDate": "2020-05-11T11:48:23Z", "type": "commit"}, {"oid": "68952dcc2174e1cf603ee4c7615c2c623ab4d44c", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/68952dcc2174e1cf603ee4c7615c2c623ab4d44c", "message": "hydrography category", "committedDate": "2020-05-11T11:59:51Z", "type": "commit"}, {"oid": "4c4c731e6e20a983547b04c7c445ab6ca145bbba", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/4c4c731e6e20a983547b04c7c445ab6ca145bbba", "message": "image layers category", "committedDate": "2020-05-11T12:05:31Z", "type": "commit"}, {"oid": "f9d6ba7708df2acf797c9dbbd78bfbea7143b4a9", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/f9d6ba7708df2acf797c9dbbd78bfbea7143b4a9", "message": "kml category", "committedDate": "2020-05-11T13:31:52Z", "type": "commit"}, {"oid": "b283dddda519e64b7bfb736de377541b67401644", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/b283dddda519e64b7bfb736de377541b67401644", "message": "local server category", "committedDate": "2020-05-11T13:37:24Z", "type": "commit"}, {"oid": "9d96ec1b88bbdc55032a77997506a79e7e220d43", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/9d96ec1b88bbdc55032a77997506a79e7e220d43", "message": "map category", "committedDate": "2020-05-11T13:58:38Z", "type": "commit"}, {"oid": "e99e21f73539425ee947cb84348699e3f8bb67f7", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/e99e21f73539425ee947cb84348699e3f8bb67f7", "message": "map view category", "committedDate": "2020-05-11T14:06:51Z", "type": "commit"}, {"oid": "127d4216492ecdafa75c67f74965d61af0473fb5", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/127d4216492ecdafa75c67f74965d61af0473fb5", "message": "network analysis category", "committedDate": "2020-05-11T14:43:59Z", "type": "commit"}, {"oid": "c62360d974489d60ca8e756622913770186a3318", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/c62360d974489d60ca8e756622913770186a3318", "message": "self review", "committedDate": "2020-05-11T15:30:08Z", "type": "commit"}, {"oid": "6540c71b35c694db14f7e5a6f10c969835d091a9", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/6540c71b35c694db14f7e5a6f10c969835d091a9", "message": "revert variables that are added to operational layers", "committedDate": "2020-05-12T15:01:16Z", "type": "commit"}, {"oid": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "message": "remove unneeded platform runlater", "committedDate": "2020-05-12T15:08:00Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NjY0Ng==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424276646", "bodyText": "Not entirely related: do we actually have a character limit for lines?\nI think in some samples we're just keeping the URL on one long line. Would be nice to keep it consistent :)", "author": "JonLavi", "createdAt": "2020-05-13T08:49:54Z", "path": "analysis/viewshed-geoprocessing/src/main/java/com/esri/samples/viewshed_geoprocessing/ViewshedGeoprocessingSample.java", "diffHunk": "@@ -103,7 +106,7 @@ public void start(Stage stage) {\n       progress.setMaxWidth(30);\n \n       // create the geoprocessing task with the service URL and load it\n-      GeoprocessingTask geoprocessingTask = new GeoprocessingTask(\"https://sampleserver6.arcgisonline\" +\n+      geoprocessingTask = new GeoprocessingTask(\"https://sampleserver6.arcgisonline\" +", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMwMDIwNQ==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424300205", "bodyText": "the character limit should be roughly 120 (if you haven't got it already there's a setting in IntelliJ you can use to show you the limit (File -> Settings -> Editor -> Code Style -> Hard wrap at: 120). This would be a good thing for us to doc in a Java sample contribution guide!  For this particular example,bit's way off the 120 line even when moving \"new GeoprocessingTask\" to a new line. So for examples like this it's fine to split for readability.", "author": "Rachael-E", "createdAt": "2020-05-13T09:27:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NjY0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDMyMDY4NA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424320684", "bodyText": "Yep, I have this set up already. However the Java API repo and the samples repo don't necessarily have the same code style convention. Was just trying to point out the inconsistency I've been seeing between samples", "author": "JonLavi", "createdAt": "2020-05-13T10:01:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NjY0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NzkyMg==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424277922", "bodyText": "Just for my own understanding: we need map as a member variable even if we're not using that object within it's own DoneLoadingListener?\nI'm asking because in other cases we usually use the object itself inside the listener, but we don't do that here. The only actions are on the UI elements.\nIn other words: if we add a DoneLoadingListener to an Object, that Object needs to be a member var?", "author": "JonLavi", "createdAt": "2020-05-13T08:52:02Z", "path": "display_information/update-graphics/src/main/java/com/esri/samples/update_graphics/UpdateGraphicsSample.java", "diffHunk": "@@ -152,7 +153,7 @@ public void start(Stage stage) {\n       selectedGraphic = new Graphic();\n \n       // create a ArcGISMap with basemap light gray canvas\n-      ArcGISMap map = new ArcGISMap(Basemap.Type.LIGHT_GRAY_CANVAS, 56.075844, -2.681572, 13);\n+      map = new ArcGISMap(Basemap.Type.LIGHT_GRAY_CANVAS, 56.075844, -2.681572, 13);\n \n       // enable buttons when map view is done loading\n       map.addDoneLoadingListener(() -> {", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM0NDgyNw==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424344827", "bodyText": "@colinanderson could you comment on this please? I think I was under the impression we would still need it so that there isn't potentially a reference lost for the addDoneLoadingListener, but perhaps it is just for cases when the loadable is called again within the done loading listener.", "author": "Rachael-E", "createdAt": "2020-05-13T10:47:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NzkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM5Njk5NQ==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424396995", "bodyText": "Just for my own understanding: we need map as a member variable even if we're not using that object within it's own DoneLoadingListener?\n\n@Rachael-E @JonLavi\nYes, the garbage collection issue is that the object  can get garbage collected because it is unreferenced and the done listener never runs. Referencing the loadable inside the done listener doesn't stop it being garbage collected - I assume it becomes a circular reference to a local variable and the variable isn't referenced anymore in the method so can be garbage collected. I'd have to do some revision to get the exact facts though!", "author": "colinanderson", "createdAt": "2020-05-13T12:28:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NzkyMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDQ0NzA4MA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424447080", "bodyText": "great, thanks Colin!", "author": "Rachael-E", "createdAt": "2020-05-13T13:42:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3NzkyMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3OTk1MA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424279950", "bodyText": "Could we use this opportunity to rename the variable to selectedFeature? We've generally been doing that in samples, and I find it's clearer for users (although a lot more verbose).", "author": "JonLavi", "createdAt": "2020-05-13T08:55:08Z", "path": "editing/update-geometries/src/main/java/com/esri/samples/update_geometries/UpdateGeometriesSample.java", "diffHunk": "@@ -112,7 +113,7 @@ public void start(Stage stage) {\n                     Iterator<Feature> features = selectedQueryResult.iterator();\n                     if (features.hasNext()) {\n                       // move selected feature to clicked location\n-                      ArcGISFeature selected = (ArcGISFeature) features.next();\n+                      selected = (ArcGISFeature) features.next();", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM0ODcxNg==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424348716", "bodyText": "sure!", "author": "Rachael-E", "createdAt": "2020-05-13T10:55:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI3OTk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4Mzc0MA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424283740", "bodyText": "Two sneaky spaces here are not needed\n\n  \n    \n      \n        Suggested change", "author": "JonLavi", "createdAt": "2020-05-13T09:01:10Z", "path": "image_layers/change-sublayer-renderer/src/main/java/com/esri/samples/change_sublayer_renderer/ChangeSublayerRendererSample.java", "diffHunk": "@@ -42,9 +42,10 @@\n import com.esri.arcgisruntime.symbology.SimpleLineSymbol;\n \n public class ChangeSublayerRendererSample extends Application {\n-\n-  private MapView mapView;\n+  ", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4NDAyNQ==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424284025", "bodyText": "More sneaky spaces\n\n  \n    \n      \n        Suggested change", "author": "JonLavi", "createdAt": "2020-05-13T09:01:37Z", "path": "kml/display-kml/src/main/java/com/esri/samples/display_kml/DisplayKMLSample.java", "diffHunk": "@@ -42,7 +42,7 @@\n public class DisplayKMLSample extends Application {\n \n   private MapView mapView;\n-\n+  ", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4NDkyMg==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424284922", "bodyText": "Suggested change", "author": "JonLavi", "createdAt": "2020-05-13T09:02:59Z", "path": "map_view/identify-layers/src/main/java/com/esri/samples/identify_layers/IdentifyLayersSample.java", "diffHunk": "@@ -42,8 +42,11 @@\n import com.esri.arcgisruntime.mapping.view.MapView;\n \n public class IdentifyLayersSample extends Application {\n-\n+  ", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4NjE4OA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424286188", "bodyText": "I've just learnt that PictureMarkerSymbol are Loadable! Every day is a school day!\nAre they affected by this problem as well, even though we don't add a DoneLoadingListener?", "author": "JonLavi", "createdAt": "2020-05-13T09:05:14Z", "path": "symbology/picture-marker-symbol/src/main/java/com/esri/samples/picture_marker_symbol/PictureMarkerSymbolSample.java", "diffHunk": "@@ -46,6 +45,12 @@\n   private File orangeSymbolPath;\n   private GraphicsOverlay graphicsOverlay;\n \n+  // keeps loadables in scope to avoid garbage collection\n+  private ArcGISMap map;\n+  private PictureMarkerSymbol campsiteSymbol;", "originalCommit": "f6723093f47e23e86f3cb0706a6eaaae9a19bc34", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM1MTIwOA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424351208", "bodyText": "yes, an addDoneLoadingListener is used later in the method placePictureMarkerSymbol where a picture marker symbol is a parameter :)", "author": "Rachael-E", "createdAt": "2020-05-13T11:00:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4NjE4OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDM5NDE3NA==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424394174", "bodyText": "Woops, I obviously completely missed that! Trying to do too many things at once, and failing a bit.", "author": "JonLavi", "createdAt": "2020-05-13T12:23:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDI4NjE4OA=="}], "type": "inlineReview"}, {"oid": "3c250410aeec7342202bdfdf42aae5d51d044af8", "url": "https://github.com/Esri/arcgis-runtime-samples-java/commit/3c250410aeec7342202bdfdf42aae5d51d044af8", "message": "address review comments", "committedDate": "2020-05-13T11:32:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNDUwNDU4Mg==", "url": "https://github.com/Esri/arcgis-runtime-samples-java/pull/511#discussion_r424504582", "bodyText": "@Rachael-E this looks like a listenable future which won't get garbage collected.", "author": "mbcoder", "createdAt": "2020-05-13T14:56:31Z", "path": "map/download-preplanned-map/src/main/java/com/esri/samples/download_preplanned_map/DownloadPreplannedMapController.java", "diffHunk": "@@ -101,7 +102,7 @@ private void initialize() {\n       preplannedMapAreasFuture.addDoneListener(() -> {\n         try {\n           // get the preplanned areas and add them to the list view\n-          List<PreplannedMapArea> preplannedMapAreas = preplannedMapAreasFuture.get();\n+          preplannedMapAreas = preplannedMapAreasFuture.get();\n           preplannedAreasListView.getItems().addAll(preplannedMapAreas);", "originalCommit": "3c250410aeec7342202bdfdf42aae5d51d044af8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}