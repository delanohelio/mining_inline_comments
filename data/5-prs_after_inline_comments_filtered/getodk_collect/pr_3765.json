{"pr_number": 3765, "pr_title": "Friendly error message when submissions closed.", "pr_createdAt": "2020-04-06T08:08:15Z", "pr_url": "https://github.com/getodk/collect/pull/3765", "timeline": [{"oid": "0fa5eb83b255423f2ae67b2815041a19de8dd233", "url": "https://github.com/getodk/collect/commit/0fa5eb83b255423f2ae67b2815041a19de8dd233", "message": "Friendly error message when submissions closed. Fixes #3428\n\nSigned-off-by: Rajkumar S <rajkumaar2304@icloud.com>", "committedDate": "2020-04-06T07:48:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404070390", "bodyText": "I'd imagine there are other errors that can happen here. Would you be able to investigate and see if you can find how to \"detect\" that we are seeing a \"submission closed\" error? Potentially the HTTP response code is a way for us to make that decision. Once we have that I think we'd want to have a test that for the decision in place. Happy to chat about the best way to do that \ud83d\ude01", "author": "seadowg", "createdAt": "2020-04-06T12:59:46Z", "path": "collect_app/src/main/java/org/odk/collect/android/upload/InstanceServerUploader.java", "diffHunk": "@@ -205,8 +205,8 @@ public String uploadOneSubmission(Instance instance, String urlString) throws Up\n                     if (messageParser.isValid()) {\n                         exception = new UploadException(FAIL + messageParser.getMessageResponse());\n                     } else {\n-                        exception = new UploadException(FAIL + postResult.getReasonPhrase()\n-                                + \" (\" + responseCode + \") at \" + urlString);\n+                        Timber.i(FAIL + postResult.getReasonPhrase() + \" (\" + responseCode + \") at \" + urlString);\n+                        exception = new UploadException(\"Failed to upload. Please make sure the form is configured to accept submissions on the server\");", "originalCommit": "0fa5eb83b255423f2ae67b2815041a19de8dd233", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MjA5Nw==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404072097", "bodyText": "Well, so a 400 always tells us submission closed in this case ?", "author": "rajkumaar23", "createdAt": "2020-04-06T13:02:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MzcxNg==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404073716", "bodyText": "Hmm I don't think so as it's just the generic Bad Request status. Maybe something more interesting comes back in the response body?", "author": "seadowg", "createdAt": "2020-04-06T13:04:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3NTcwMQ==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404075701", "bodyText": "Will check that! \ud83d\udc4d", "author": "rajkumaar23", "createdAt": "2020-04-06T13:07:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE4Njc3NQ==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404186775", "bodyText": "So, this is what is coming in the body :\n<body>\n    <h1>HTTP Status 400 \u2013 Bad Request</h1>\n    <hr class=\"line\" />\n    <p><b>Type</b> Status Report</p>\n    <p><b>Message</b> Submissions have been disallowed on this form</p>\n    <p><b>Description</b> The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).</p>\n    <hr class=\"line\" />\n    <h3>Apache Tomcat/8.5.39 (Ubuntu)</h3>\n</body>\nWe can use the Message to identify. But how do I check that ?", "author": "rajkumaar23", "createdAt": "2020-04-06T15:34:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDE5ODcyMA==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404198720", "bodyText": "What way would you suggest other than this?", "author": "rajkumaar23", "createdAt": "2020-04-06T15:50:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3MjgwOQ==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r404672809", "bodyText": "Hmmm it's surprising to me that Aggregate errors don't come back in an OpenRosaResponse format (Open Rosa is the standard for the different servers that Collect can speak to) but looking at the docs I'm not sure that's actually expected.\n@lognaturel are you able to chime in here? Has there been previous though about how to support errors coming back from Open Rosa servers that are more specific than HTTP status codes or is it generally uncharted waters? If so maybe we should be using a more specific response code in Aggregate here (401/403 for example) and then have Collect have error messages closer to the errors here.", "author": "seadowg", "createdAt": "2020-04-07T09:36:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTkzMDAwMw==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r405930003", "bodyText": "What can I possibly do now ?", "author": "rajkumaar23", "createdAt": "2020-04-09T03:04:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjA5ODU4Mw==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r406098583", "bodyText": "Sorry @rajkumaar23. There's a very small team of people working on all the ODK tools and we're mostly in different timezones so discussions can move pretty slowly! If you'd like to look at some other issues to contribute to I'd check the \"good first issue\" tag. If you do want to look at something else let me know and we can close this PR for the moment and move discussion to the issue.", "author": "seadowg", "createdAt": "2020-04-09T10:07:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNjA5OTg0Mw==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r406099843", "bodyText": "@seadowg No problem. Let's wait for @lognaturel to reply :)", "author": "rajkumaar23", "createdAt": "2020-04-09T10:09:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxMTgyOTA1OA==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r411829058", "bodyText": "@lognaturel Could you please help?", "author": "rajkumaar23", "createdAt": "2020-04-21T02:49:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxOTgwMzc0OQ==", "url": "https://github.com/getodk/collect/pull/3765#discussion_r419803749", "bodyText": "Thanks for taking this on and apologies for the delay in getting back to you, @rajkumaar23.\nThe first part of the if on line 205 displays an OpenRosa response if there is one. I wasn't completely sure that was done here but it is and it's just that Aggregate doesn't send a helpful response. Since Aggregate is no longer in active development (https://github.com/getodk/central is the replacement), I think we should handle it here.\nI propose that we use the message you put in, @rajkumaar23, but that we do it in a branch just for 400. That is, if there's a custom message, show the custom message (existing behavior), else if the response code is 400, use the special text you've added, for any other response code, use the reason phrase (existing behavior).", "author": "lognaturel", "createdAt": "2020-05-05T00:25:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDA3MDM5MA=="}], "type": "inlineReview"}, {"oid": "15f42698d84e4feb99a4cb7816a86dc8839b8f04", "url": "https://github.com/getodk/collect/commit/15f42698d84e4feb99a4cb7816a86dc8839b8f04", "message": "Minor tweaks\n\nSigned-off-by: Rajkumar S <rajkumaar2304@icloud.com>", "committedDate": "2020-05-05T04:46:02Z", "type": "commit"}, {"oid": "b921f29cdb8be50bd0d468380c09282884eeeeae", "url": "https://github.com/getodk/collect/commit/b921f29cdb8be50bd0d468380c09282884eeeeae", "message": "Code style fixes\n\nSigned-off-by: Rajkumar S <rajkumaar2304@icloud.com>", "committedDate": "2020-05-05T10:31:05Z", "type": "commit"}]}