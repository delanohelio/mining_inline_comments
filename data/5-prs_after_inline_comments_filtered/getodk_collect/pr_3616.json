{"pr_number": 3616, "pr_title": "Fix how change tracking works with save button", "pr_createdAt": "2020-01-30T15:10:33Z", "pr_url": "https://github.com/getodk/collect/pull/3616", "timeline": [{"oid": "56142da4797dc4da1198f9374af15d884a094be5", "url": "https://github.com/getodk/collect/commit/56142da4797dc4da1198f9374af15d884a094be5", "message": "Create saving package", "committedDate": "2020-01-30T14:03:36Z", "type": "forcePushed"}, {"oid": "156d68eeb32575e7c975d313db330eb6311b2a3f", "url": "https://github.com/getodk/collect/commit/156d68eeb32575e7c975d313db330eb6311b2a3f", "message": "Flush audit event log when saving form", "committedDate": "2020-02-06T14:37:17Z", "type": "commit"}, {"oid": "484d2279464d0b7d565c3f04a279115248620ec9", "url": "https://github.com/getodk/collect/commit/484d2279464d0b7d565c3f04a279115248620ec9", "message": "Log question event after form save that doesn't exit", "committedDate": "2020-02-06T14:42:43Z", "type": "commit"}, {"oid": "23fd99491c9bec92a1e38a6a4c69a17ea55958a0", "url": "https://github.com/getodk/collect/commit/23fd99491c9bec92a1e38a6a4c69a17ea55958a0", "message": "Make logging tests more consistent", "committedDate": "2020-02-06T14:42:43Z", "type": "commit"}, {"oid": "9eefd630f6b02ca875ffa5ea9a112056ae6d5864", "url": "https://github.com/getodk/collect/commit/9eefd630f6b02ca875ffa5ea9a112056ae6d5864", "message": "Create saving package", "committedDate": "2020-02-06T14:55:22Z", "type": "commit"}, {"oid": "9eefd630f6b02ca875ffa5ea9a112056ae6d5864", "url": "https://github.com/getodk/collect/commit/9eefd630f6b02ca875ffa5ea9a112056ae6d5864", "message": "Create saving package", "committedDate": "2020-02-06T14:55:22Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0NjcwMg==", "url": "https://github.com/getodk/collect/pull/3616#discussion_r378646702", "bodyText": "Ah yes, good name!", "author": "lognaturel", "createdAt": "2020-02-13T04:34:15Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/audit/AuditEventLogger.java", "diffHunk": "@@ -97,6 +97,16 @@ public void logEvent(AuditEvent.AuditEventType eventType, FormIndex formIndex,\n         }\n     }\n \n+    /*\n+     * Finalizes and writes events\n+     */\n+    public void flush() {", "originalCommit": "156d68eeb32575e7c975d313db330eb6311b2a3f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODczNjg0MQ==", "url": "https://github.com/getodk/collect/pull/3616#discussion_r378736841", "bodyText": "Heh finally!", "author": "seadowg", "createdAt": "2020-02-13T09:19:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0NjcwMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0NzA3MQ==", "url": "https://github.com/getodk/collect/pull/3616#discussion_r378647071", "bodyText": "This is a small thing but I'd keep the Uri first since that's what you're saving.", "author": "lognaturel", "createdAt": "2020-02-13T04:36:16Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/DiskFormSaver.java", "diffHunk": "@@ -2,14 +2,15 @@\n \n import android.net.Uri;\n \n+import org.odk.collect.android.logic.FormController;\n import org.odk.collect.android.tasks.SaveFormToDisk;\n import org.odk.collect.android.tasks.SaveToDiskResult;\n \n public class DiskFormSaver implements FormSaver {\n \n     @Override\n-    public SaveToDiskResult save(Uri instanceContentURI, boolean shouldFinalize, String updatedSaveName, boolean exitAfter, ProgressListener progressListener) {\n-        SaveFormToDisk saveFormToDisk = new SaveFormToDisk(instanceContentURI, exitAfter, shouldFinalize, updatedSaveName);\n+    public SaveToDiskResult save(FormController formController, boolean shouldFinalize, String updatedSaveName, boolean exitAfter, ProgressListener progressListener, Uri instanceContentURI) {", "originalCommit": "484d2279464d0b7d565c3f04a279115248620ec9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0NzI0Mw==", "url": "https://github.com/getodk/collect/pull/3616#discussion_r378647243", "bodyText": "This is more like logCurrentScreen or logCurrentEvents, I think?", "author": "lognaturel", "createdAt": "2020-02-13T04:37:18Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/audit/AuditUtils.java", "diffHunk": "@@ -0,0 +1,27 @@\n+package org.odk.collect.android.formentry.audit;\n+\n+import org.javarosa.form.api.FormEntryPrompt;\n+import org.odk.collect.android.logic.FormController;\n+\n+import static org.javarosa.form.api.FormEntryController.EVENT_GROUP;\n+import static org.javarosa.form.api.FormEntryController.EVENT_QUESTION;\n+import static org.javarosa.form.api.FormEntryController.EVENT_REPEAT;\n+\n+public class AuditUtils {\n+\n+    private AuditUtils() {\n+\n+    }\n+\n+    public static void logCurrentEvent(FormController formController, AuditEventLogger auditEventLogger, long currentTime) {", "originalCommit": "484d2279464d0b7d565c3f04a279115248620ec9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODczNzc3Mg==", "url": "https://github.com/getodk/collect/pull/3616#discussion_r378737772", "bodyText": "In my head it's logging the \"current event\" of the FormController but I see  now that is confusing. I'll make that explicit.", "author": "seadowg", "createdAt": "2020-02-13T09:21:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODY0NzI0Mw=="}], "type": "inlineReview"}, {"oid": "e160aaf283644eefc79bd5fde28bba6f58315009", "url": "https://github.com/getodk/collect/commit/e160aaf283644eefc79bd5fde28bba6f58315009", "message": "Rename to make method clearer", "committedDate": "2020-02-13T09:28:21Z", "type": "commit"}]}