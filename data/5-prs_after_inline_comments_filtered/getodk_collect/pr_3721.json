{"pr_number": 3721, "pr_title": "Factored out NetworkStateProvider class", "pr_createdAt": "2020-03-17T12:45:23Z", "pr_url": "https://github.com/getodk/collect/pull/3721", "timeline": [{"oid": "540aee17ed4353a736d30fda65dbcf0bc2114cc6", "url": "https://github.com/getodk/collect/commit/540aee17ed4353a736d30fda65dbcf0bc2114cc6", "message": "Created NetworkStateProvider class", "committedDate": "2020-03-16T09:27:15Z", "type": "commit"}, {"oid": "b09bbbbed23778da6b3c761c264e0ec3d5e2ee5e", "url": "https://github.com/getodk/collect/commit/b09bbbbed23778da6b3c761c264e0ec3d5e2ee5e", "message": "Use NetworkStateProvider in FormDownloadList", "committedDate": "2020-03-16T09:27:51Z", "type": "commit"}, {"oid": "71483f5893f97f3ca2934f2ba7b2d1cdc9436241", "url": "https://github.com/getodk/collect/commit/71483f5893f97f3ca2934f2ba7b2d1cdc9436241", "message": "Use NetworkStateProvider in ServerPollingJob", "committedDate": "2020-03-16T09:29:29Z", "type": "commit"}, {"oid": "53a9815d1a51535e8e388b3ac3eb833e539e1c53", "url": "https://github.com/getodk/collect/commit/53a9815d1a51535e8e388b3ac3eb833e539e1c53", "message": "Use NetworkStateProvider in InstanceUploaderListActivity", "committedDate": "2020-03-16T09:30:48Z", "type": "commit"}, {"oid": "921b621eb29dae827a6c32b2e2af3f7758c39408", "url": "https://github.com/getodk/collect/commit/921b621eb29dae827a6c32b2e2af3f7758c39408", "message": "Use NetworkStateProvider in GoogleSheetsUploaderActivity", "committedDate": "2020-03-16T09:32:04Z", "type": "commit"}, {"oid": "cac94c88ee3bf324f9c865742f9a85231db54e5a", "url": "https://github.com/getodk/collect/commit/cac94c88ee3bf324f9c865742f9a85231db54e5a", "message": "Use NetworkStateProvider in GoogleDriveActivity", "committedDate": "2020-03-16T09:33:52Z", "type": "commit"}, {"oid": "d697581ad155c4f66ca88fcd65f0669cbe23fcec", "url": "https://github.com/getodk/collect/commit/d697581ad155c4f66ca88fcd65f0669cbe23fcec", "message": "Allow injecting NetworkStateProvider", "committedDate": "2020-03-16T09:34:43Z", "type": "commit"}, {"oid": "6e5ada22437c7e788d1534515ccbfa5db683ef87", "url": "https://github.com/getodk/collect/commit/6e5ada22437c7e788d1534515ccbfa5db683ef87", "message": "Removed isNetworkAvailable method from Collect class", "committedDate": "2020-03-16T10:16:58Z", "type": "commit"}, {"oid": "61df6b0f3aa599e614ec6c80e9cbec1ae1eb178b", "url": "https://github.com/getodk/collect/commit/61df6b0f3aa599e614ec6c80e9cbec1ae1eb178b", "message": "Code improvements in NetworkStateProvider class", "committedDate": "2020-03-16T10:20:47Z", "type": "commit"}, {"oid": "bf614cd7cbc87aa85afd474bd448231b5295751a", "url": "https://github.com/getodk/collect/commit/bf614cd7cbc87aa85afd474bd448231b5295751a", "message": "Use NetworkStateProvider in AutoSendWorker", "committedDate": "2020-03-16T10:23:54Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzE3Mw==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393723173", "bodyText": "While we're here could you rename the class to FormDownloadListActivity? Confuses me every time!", "author": "seadowg", "createdAt": "2020-03-17T14:32:18Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadList.java", "diffHunk": "@@ -126,6 +124,9 @@\n     @Inject\n     FormListDownloader formListDownloader;\n \n+    @Inject\n+    NetworkStateProvider networkStateProvider;", "originalCommit": "bf614cd7cbc87aa85afd474bd448231b5295751a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNTAzMQ==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394205031", "bodyText": "Done.", "author": "grzesiek2010", "createdAt": "2020-03-18T09:22:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzE3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyMzYxNQ==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393723615", "bodyText": "Probably don't need this anymore right?", "author": "seadowg", "createdAt": "2020-03-17T14:32:54Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -2900,5 +2904,9 @@ private void updateFieldListQuestions(FormIndex lastChangedIndex) {\n             return null;\n         }\n     }\n+\n+    public NetworkStateProvider getNetworkStateProvider() {", "originalCommit": "bf614cd7cbc87aa85afd474bd448231b5295751a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNjA4Nw==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393726087", "bodyText": "Yes! Another method killed \ud83e\udd73", "author": "seadowg", "createdAt": "2020-03-17T14:36:09Z", "path": "collect_app/src/main/java/org/odk/collect/android/application/Collect.java", "diffHunk": "@@ -161,20 +159,6 @@ public void setExternalDataManager(ExternalDataManager externalDataManager) {\n         this.externalDataManager = externalDataManager;\n     }\n \n-    /**\n-     * Get a User-Agent string that provides the platform details followed by the application ID\n-     * and application version name: {@code Dalvik/<version> (platform info) org.odk.collect.android/v<version>}.\n-     *\n-     * This deviates from the recommended format as described in https://github.com/opendatakit/collect/issues/3253.\n-     */\n-\n-    public boolean isNetworkAvailable() {", "originalCommit": "bf614cd7cbc87aa85afd474bd448231b5295751a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzg0Ng==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393727846", "bodyText": "I think we could pass the NetworkStateProvider in here as a constructor arg rather than needing to have the getter (which I know understand) on FormEntryActivity.", "author": "seadowg", "createdAt": "2020-03-17T14:38:37Z", "path": "collect_app/src/main/java/org/odk/collect/android/tasks/MediaLoadingTask.java", "diffHunk": "@@ -56,7 +56,7 @@ protected File doInBackground(Uri... uris) {\n                 String destMediaPath = instanceFolder + File.separator + System.currentTimeMillis() + extension;\n \n                 try {\n-                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA);\n+                    File chosenFile = MediaUtils.getFileFromUri(formEntryActivity.get(), uris[0], MediaStore.Images.Media.DATA, formEntryActivity.get().getNetworkStateProvider());", "originalCommit": "bf614cd7cbc87aa85afd474bd448231b5295751a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIwNTE3MQ==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394205171", "bodyText": "Done.", "author": "grzesiek2010", "createdAt": "2020-03-18T09:23:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzcyNzg0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMDY3Mw==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r393730673", "bodyText": "This would be a nice opportunity for pulling out an interface I think. We could have an interface NetworkStateProvider and a class ConnectivityProvider. Means in tests we can fake without extending from a real implementation.", "author": "seadowg", "createdAt": "2020-03-17T14:42:31Z", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/NetworkStateProvider.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.odk.collect.android.utilities;\n+\n+import android.content.Context;\n+import android.net.ConnectivityManager;\n+import android.net.NetworkInfo;\n+\n+import org.odk.collect.android.application.Collect;\n+\n+public class NetworkStateProvider {", "originalCommit": "bf614cd7cbc87aa85afd474bd448231b5295751a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDIxMjk3Nw==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394212977", "bodyText": "Done.", "author": "grzesiek2010", "createdAt": "2020-03-18T09:35:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzczMDY3Mw=="}], "type": "inlineReview"}, {"oid": "023e7a5486f6e877baa6a9f1e3aa991478d83837", "url": "https://github.com/getodk/collect/commit/023e7a5486f6e877baa6a9f1e3aa991478d83837", "message": "Renamed FormDownloadList to FormDownloadListActivity", "committedDate": "2020-03-18T08:58:12Z", "type": "commit"}, {"oid": "9483682f863a2f0617c17b27bb38e5b071c4ef91", "url": "https://github.com/getodk/collect/commit/9483682f863a2f0617c17b27bb38e5b071c4ef91", "message": "Pass NetworkStateProvider to MediaLoadingTask via constructor", "committedDate": "2020-03-18T09:22:01Z", "type": "commit"}, {"oid": "9483682f863a2f0617c17b27bb38e5b071c4ef91", "url": "https://github.com/getodk/collect/commit/9483682f863a2f0617c17b27bb38e5b071c4ef91", "message": "Pass NetworkStateProvider to MediaLoadingTask via constructor", "committedDate": "2020-03-18T09:22:01Z", "type": "forcePushed"}, {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898", "url": "https://github.com/getodk/collect/commit/c0f02f762bb59931a44fa819f781abb48dc3a898", "message": "Pulled out NetworkStateProvider interface", "committedDate": "2020-03-18T09:34:27Z", "type": "commit"}, {"oid": "c0f02f762bb59931a44fa819f781abb48dc3a898", "url": "https://github.com/getodk/collect/commit/c0f02f762bb59931a44fa819f781abb48dc3a898", "message": "Pulled out NetworkStateProvider interface", "committedDate": "2020-03-18T09:34:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyNTAwMA==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394325000", "bodyText": "Here I'd expect Dagger to provide the interface (NetworkStateProvider) rather that the implementation. For me the goal of that is that the objects that use it don't need to care about the implementation object at all - just the interface.", "author": "seadowg", "createdAt": "2020-03-18T12:56:50Z", "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -258,4 +259,9 @@ public CollectJobCreator providesCollectJobCreator() {\n     public BackgroundWorkManager providesBackgroundWorkManager() {\n         return new CollectBackgroundWorkManager();\n     }\n+\n+    @Provides\n+    public ConnectivityProvider providesConnectivityProvider() {", "originalCommit": "c0f02f762bb59931a44fa819f781abb48dc3a898", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDg4NzQyOQ==", "url": "https://github.com/getodk/collect/pull/3721#discussion_r394887429", "bodyText": "Done.", "author": "grzesiek2010", "createdAt": "2020-03-19T09:21:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDMyNTAwMA=="}], "type": "inlineReview"}, {"oid": "244a9853a4d04c544308b6c31f781225de619d3d", "url": "https://github.com/getodk/collect/commit/244a9853a4d04c544308b6c31f781225de619d3d", "message": "Provide interface NetworkStateProvider in AppDependencyModule", "committedDate": "2020-03-19T09:32:17Z", "type": "commit"}, {"oid": "244a9853a4d04c544308b6c31f781225de619d3d", "url": "https://github.com/getodk/collect/commit/244a9853a4d04c544308b6c31f781225de619d3d", "message": "Provide interface NetworkStateProvider in AppDependencyModule", "committedDate": "2020-03-19T09:32:17Z", "type": "forcePushed"}]}