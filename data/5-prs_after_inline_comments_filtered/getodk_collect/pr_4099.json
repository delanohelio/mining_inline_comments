{"pr_number": 4099, "pr_title": "Stop server list being cleared on import", "pr_createdAt": "2020-09-17T15:47:01Z", "pr_url": "https://github.com/getodk/collect/pull/4099", "timeline": [{"oid": "1469df3726ef83ac0756759771c44c7b61b36bb9", "url": "https://github.com/getodk/collect/commit/1469df3726ef83ac0756759771c44c7b61b36bb9", "message": "Move test to correct package", "committedDate": "2020-09-17T10:59:30Z", "type": "commit"}, {"oid": "76bc5cccc71100e8c8ec8986c6b5ce9461871bb2", "url": "https://github.com/getodk/collect/commit/76bc5cccc71100e8c8ec8986c6b5ce9461871bb2", "message": "Remove test we no longer need", "committedDate": "2020-09-17T12:01:01Z", "type": "commit"}, {"oid": "b888b3b9d7eb9ef9d53d44f25627549da25799a8", "url": "https://github.com/getodk/collect/commit/b888b3b9d7eb9ef9d53d44f25627549da25799a8", "message": "Save server list in meta preferences so they aren't cleared on import", "committedDate": "2020-09-17T15:45:25Z", "type": "commit"}, {"oid": "a67801d55d866094161029cc4ae47eeb43807639", "url": "https://github.com/getodk/collect/commit/a67801d55d866094161029cc4ae47eeb43807639", "message": "Add migration for server list", "committedDate": "2020-09-17T15:53:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2MjUzOA==", "url": "https://github.com/getodk/collect/pull/4099#discussion_r490362538", "bodyText": "We can follow up with an actual tested implementation (replacing ChangingServerUrlUtils)", "author": "seadowg", "createdAt": "2020-09-17T15:55:17Z", "path": "collect_app/src/main/java/org/odk/collect/android/injection/config/AppDependencyModule.java", "diffHunk": "@@ -355,8 +358,23 @@ public PropertyManager providesPropertyManager(Application application, RxEventB\n     }\n \n     @Provides\n-    public SettingsChangeHandler providesSettingsChangeHandler(PropertyManager propertyManager, FormUpdateManager formUpdateManager) {\n-        return new CollectSettingsChangeHandler(propertyManager, formUpdateManager);\n+    public ServerRepository providesServerRepository() {\n+        return new ServerRepository() {", "originalCommit": "a67801d55d866094161029cc4ae47eeb43807639", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM2Mjg5Nw==", "url": "https://github.com/getodk/collect/pull/4099#discussion_r490362897", "bodyText": "This is now taken care of by our shared preference change listeners.", "author": "seadowg", "createdAt": "2020-09-17T15:55:47Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ServerPreferencesFragment.java", "diffHunk": "@@ -280,7 +283,6 @@ public boolean onTouch(View v, MotionEvent event) {\n                         sendAnalyticsEvent(url);\n \n                         preference.setSummary(newValue.toString());\n-                        ChangingServerUrlUtils.addUrlToList(url);", "originalCommit": "a67801d55d866094161029cc4ae47eeb43807639", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDM3MDU5OQ==", "url": "https://github.com/getodk/collect/pull/4099#discussion_r490370599", "bodyText": "This is covered by the regression tests put in place when we found a bunch of broken edge cases. It's really hard to test here and get much value (other than we get from the normal import test).", "author": "seadowg", "createdAt": "2020-09-17T16:05:52Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/feature/settings/ConfigureWithQRCodeTest.java", "diffHunk": "@@ -113,23 +113,6 @@ public void clickConfigureQRCode_opensScanner_andThenScanning_importsSettings()\n                 .assertText(\"http://gallops.example\");\n     }\n \n-    @Test\n-    public void clickConfigureQRCode_opensScanner_andThenScanning_whenUsingOldQR_importsSettingsAndMigrates() {", "originalCommit": "a67801d55d866094161029cc4ae47eeb43807639", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e2733e6072f1d4494221633df33a19a15bb33969", "url": "https://github.com/getodk/collect/commit/e2733e6072f1d4494221633df33a19a15bb33969", "message": "Reset servers when resetting settings", "committedDate": "2020-09-21T09:46:15Z", "type": "commit"}, {"oid": "50b544e60a9dceed57c9f8d06403240bd894a0b7", "url": "https://github.com/getodk/collect/commit/50b544e60a9dceed57c9f8d06403240bd894a0b7", "message": "Move tests for ChangingServerUrlUtils to cover ServerRepository implementation", "committedDate": "2020-09-21T10:00:18Z", "type": "commit"}, {"oid": "f6fdb24ba0f429cb3956cb0a3ea2f3cb53da9e3d", "url": "https://github.com/getodk/collect/commit/f6fdb24ba0f429cb3956cb0a3ea2f3cb53da9e3d", "message": "Remove ChangingServerUrlUtils", "committedDate": "2020-09-21T10:05:06Z", "type": "commit"}, {"oid": "ddb5101cbac4d34b4e9db51513d079d724906f2b", "url": "https://github.com/getodk/collect/commit/ddb5101cbac4d34b4e9db51513d079d724906f2b", "message": "Pull dependencies out of SharedPreferencesServerRepository", "committedDate": "2020-09-21T10:15:30Z", "type": "commit"}]}