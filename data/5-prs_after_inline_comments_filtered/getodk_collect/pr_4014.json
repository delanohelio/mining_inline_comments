{"pr_number": 4014, "pr_title": "Fixed enabling/disabling preferences", "pr_createdAt": "2020-08-05T18:34:31Z", "pr_url": "https://github.com/getodk/collect/pull/4014", "timeline": [{"oid": "d43ce240f0f0d8798b4262ef72a9a65e242e4d69", "url": "https://github.com/getodk/collect/commit/d43ce240f0f0d8798b4262ef72a9a65e242e4d69", "message": "Code improvements", "committedDate": "2020-08-06T09:06:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI4NjQ3MA==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466286470", "bodyText": "Ah nice. These were left over from when they were androidx. and everything else was just android.", "author": "seadowg", "createdAt": "2020-08-06T09:35:21Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ExperimentalPreferencesFragment.java", "diffHunk": "@@ -6,13 +6,12 @@\n import androidx.annotation.NonNull;\n import androidx.annotation.Nullable;\n import androidx.fragment.app.FragmentActivity;\n-import androidx.preference.PreferenceFragmentCompat;\n \n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.CollectAbstractActivity;\n import org.odk.collect.android.injection.DaggerUtils;\n \n-public class ExperimentalPreferencesFragment extends PreferenceFragmentCompat {\n+public class ExperimentalPreferencesFragment extends BasePreferenceFragment {", "originalCommit": "64323d1dd8a3b0112b5fa162890208555a72e127", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NDQzMw==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466294433", "bodyText": "Are we not losing the adminMode argument here?", "author": "seadowg", "createdAt": "2020-08-06T09:43:34Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/GeneralPreferencesFragment.java", "diffHunk": "@@ -82,22 +82,21 @@ public void onCreate(final Bundle savedInstanceState) {\n     public boolean onPreferenceClick(Preference preference) {\n         if (MultiClickGuard.allowClick(getClass().getName())) {\n             PreferenceFragmentCompat basePreferenceFragment = null;\n-            boolean adminMode = getArguments().getBoolean(INTENT_KEY_ADMIN_MODE, false);\n             switch (preference.getKey()) {\n                 case \"protocol\":\n-                    basePreferenceFragment = ServerPreferencesFragment.newInstance(adminMode);\n+                    basePreferenceFragment = new ServerPreferencesFragment();", "originalCommit": "2cfcdf83c3221ac7ede2fb434ef7e7ba28d8dbbe", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM1Njk1OA==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466356958", "bodyText": "No I just pass arguments from activity to fragments https://github.com/getodk/collect/pull/4014/files#diff-fc03fbca20bb6f86edfdee031f3509a4R74", "author": "grzesiek2010", "createdAt": "2020-08-06T11:50:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NDQzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NTg2MQ==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466295861", "bodyText": "Can we do a conditional cast here like in BasePreferencesFragment?", "author": "seadowg", "createdAt": "2020-08-06T09:46:07Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesFragment.java", "diffHunk": "@@ -45,17 +47,15 @@\n import static org.odk.collect.android.preferences.GeneralKeys.CONSTRAINT_BEHAVIOR_ON_SWIPE;\n import static org.odk.collect.android.preferences.PreferencesActivity.INTENT_KEY_ADMIN_MODE;\n \n-public class AdminPreferencesFragment extends BasePreferenceFragment implements Preference.OnPreferenceClickListener {\n+public class AdminPreferencesFragment extends PreferenceFragmentCompat implements Preference.OnPreferenceClickListener {\n \n     public static final String ADMIN_PREFERENCES = \"admin_prefs\";\n \n     @Override\n     public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n-        super.onCreatePreferences(savedInstanceState, rootKey);\n-\n         getPreferenceManager().setSharedPreferencesName(ADMIN_PREFERENCES);\n-\n         setPreferencesFromResource(R.xml.admin_preferences, rootKey);\n+        ((CollectAbstractActivity) getActivity()).initToolbar(getPreferenceScreen().getTitle());", "originalCommit": "d395d59aeae2abdcb740baae8b8ea7a4a5cf5289", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM1NTI5Mw==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466355293", "bodyText": "Now it doesn't exist there and we set title only in BasePreferenceFragment which works for every screen.", "author": "grzesiek2010", "createdAt": "2020-08-06T11:47:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NTg2MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NjE1Ng==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466296156", "bodyText": "Conditional cast for the child Fragments as well.", "author": "seadowg", "createdAt": "2020-08-06T09:46:40Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/AdminPreferencesFragment.java", "diffHunk": "@@ -144,36 +144,31 @@ public boolean onPreferenceClick(Preference preference) {\n         return false;\n     }\n \n-    public static class MainMenuAccessPreferences extends BasePreferenceFragment {\n-\n+    public static class MainMenuAccessPreferences extends PreferenceFragmentCompat {\n         @Override\n-        public void onCreate(Bundle savedInstanceState) {\n-            super.onCreate(savedInstanceState);\n+        public void onCreatePreferences(Bundle savedInstanceState, String rootKey) {\n             getPreferenceManager().setSharedPreferencesName(ADMIN_PREFERENCES);\n-\n-            addPreferencesFromResource(R.xml.main_menu_access_preferences);\n+            setPreferencesFromResource(R.xml.main_menu_access_preferences, rootKey);\n+            ((CollectAbstractActivity) getActivity()).initToolbar(getPreferenceScreen().getTitle());", "originalCommit": "d395d59aeae2abdcb740baae8b8ea7a4a5cf5289", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjM1NTMzOQ==", "url": "https://github.com/getodk/collect/pull/4014#discussion_r466355339", "bodyText": "Now it doesn't exist there and we set title only in BasePreferenceFragment which works for every screen.", "author": "grzesiek2010", "createdAt": "2020-08-06T11:47:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NjI5NjE1Ng=="}], "type": "inlineReview"}, {"oid": "289bb20e6bb4e8b8b95052f3310197f719107eec", "url": "https://github.com/getodk/collect/commit/289bb20e6bb4e8b8b95052f3310197f719107eec", "message": "Removed duplicated tests", "committedDate": "2020-08-11T23:01:46Z", "type": "forcePushed"}, {"oid": "ba856215b2d3b57ef832aba7fa04ee40948b4d20", "url": "https://github.com/getodk/collect/commit/ba856215b2d3b57ef832aba7fa04ee40948b4d20", "message": "All preference fragments should extend BasePreferenceFragment", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "28b63a8fcafe68784d83efba237ee2ea537529cf", "url": "https://github.com/getodk/collect/commit/28b63a8fcafe68784d83efba237ee2ea537529cf", "message": "Code improvements", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "88f6fd2f70f7c1d4793fcccd31e6568219d43f7b", "url": "https://github.com/getodk/collect/commit/88f6fd2f70f7c1d4793fcccd31e6568219d43f7b", "message": "Factored out isInAdminMode() method", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "ceb275d6c26469aab9b49081024b6ba93dae81af", "url": "https://github.com/getodk/collect/commit/ceb275d6c26469aab9b49081024b6ba93dae81af", "message": "Removed redundant code", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "4723274f0fb377461acffb407e54a81694f68d69", "url": "https://github.com/getodk/collect/commit/4723274f0fb377461acffb407e54a81694f68d69", "message": "Code improvements", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "52c42c9ce1807184b9fdd0fe48f4b2461ff4bfbe", "url": "https://github.com/getodk/collect/commit/52c42c9ce1807184b9fdd0fe48f4b2461ff4bfbe", "message": "Removed doubled adminMode check", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "d9a309d3d247554a765a8e4236fc4502bfa2e14a", "url": "https://github.com/getodk/collect/commit/d9a309d3d247554a765a8e4236fc4502bfa2e14a", "message": "Removed redundant code", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "a1702a667e7e45c7e65610deea25b4e5f21275a0", "url": "https://github.com/getodk/collect/commit/a1702a667e7e45c7e65610deea25b4e5f21275a0", "message": "Factore out getPreferenceFragment() method", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "b5f58a6881e2e30b51e56138baa6fe5f7c944320", "url": "https://github.com/getodk/collect/commit/b5f58a6881e2e30b51e56138baa6fe5f7c944320", "message": "Code improvements", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "bf1c25215c9d8034ba413589e5d5152df4870199", "url": "https://github.com/getodk/collect/commit/bf1c25215c9d8034ba413589e5d5152df4870199", "message": "Removed redundant code", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "58cd015959d3feed88661376d35771b0ca26c01f", "url": "https://github.com/getodk/collect/commit/58cd015959d3feed88661376d35771b0ca26c01f", "message": "Added UserInterfacePreferencesFragmentTest", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "e39f7681a050996cc82c7f9f5af6abc3aee3ab09", "url": "https://github.com/getodk/collect/commit/e39f7681a050996cc82c7f9f5af6abc3aee3ab09", "message": "Added tests to FormManagementPreferencesTest", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "038d3d5e57bc5823aab583f508bbe49c83c26335", "url": "https://github.com/getodk/collect/commit/038d3d5e57bc5823aab583f508bbe49c83c26335", "message": "Added IdentityPreferencesFragmentTest", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "93d2ba692fc3f145fa36dd0a1de896f585ae3192", "url": "https://github.com/getodk/collect/commit/93d2ba692fc3f145fa36dd0a1de896f585ae3192", "message": "Added GeneralPreferencesFragmentTest", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "74f5cfa5f560c19ce24a908e8dc3af961f33135c", "url": "https://github.com/getodk/collect/commit/74f5cfa5f560c19ce24a908e8dc3af961f33135c", "message": "Code improvements", "committedDate": "2020-08-18T21:58:08Z", "type": "commit"}, {"oid": "7e8cc4a62ebbf2381c08cd04e78bd8ea4f3f2009", "url": "https://github.com/getodk/collect/commit/7e8cc4a62ebbf2381c08cd04e78bd8ea4f3f2009", "message": "Removed redundant code", "committedDate": "2020-08-18T21:58:34Z", "type": "commit"}, {"oid": "9b5f41417c443812df207ed646ae8ec44f970cca", "url": "https://github.com/getodk/collect/commit/9b5f41417c443812df207ed646ae8ec44f970cca", "message": "Code improvements", "committedDate": "2020-08-18T21:58:34Z", "type": "commit"}, {"oid": "c2885133b0b5c7ad6490eaecebbf4c943dd31eda", "url": "https://github.com/getodk/collect/commit/c2885133b0b5c7ad6490eaecebbf4c943dd31eda", "message": "Fixed identyfying AdminPrefernces", "committedDate": "2020-08-18T21:58:34Z", "type": "commit"}, {"oid": "4943ce89a2382bcae96ade6d03ebaf248a28c61f", "url": "https://github.com/getodk/collect/commit/4943ce89a2382bcae96ade6d03ebaf248a28c61f", "message": "Removed duplicated tests", "committedDate": "2020-08-18T21:58:34Z", "type": "commit"}, {"oid": "4943ce89a2382bcae96ade6d03ebaf248a28c61f", "url": "https://github.com/getodk/collect/commit/4943ce89a2382bcae96ade6d03ebaf248a28c61f", "message": "Removed duplicated tests", "committedDate": "2020-08-18T21:58:34Z", "type": "forcePushed"}, {"oid": "3efbf464cb2f1f876f31554809efdd9edf3a0dbe", "url": "https://github.com/getodk/collect/commit/3efbf464cb2f1f876f31554809efdd9edf3a0dbe", "message": "Fixed bug with disappearing preferences in admin settings", "committedDate": "2020-08-19T21:42:54Z", "type": "commit"}, {"oid": "b7bf13b130b2c41b3227ae36905a939774b03638", "url": "https://github.com/getodk/collect/commit/b7bf13b130b2c41b3227ae36905a939774b03638", "message": "Code improvements", "committedDate": "2020-08-19T23:02:22Z", "type": "commit"}, {"oid": "3955ce964bdeaf083a82c0d9384a3cfbfbff0d90", "url": "https://github.com/getodk/collect/commit/3955ce964bdeaf083a82c0d9384a3cfbfbff0d90", "message": "Added tests to AdminPreferencesActivityTest", "committedDate": "2020-08-20T00:29:37Z", "type": "commit"}, {"oid": "4be50867144f63470ad61cf30a1a41af17431752", "url": "https://github.com/getodk/collect/commit/4be50867144f63470ad61cf30a1a41af17431752", "message": "Added PreferencesActivityTest", "committedDate": "2020-08-20T00:55:07Z", "type": "commit"}, {"oid": "ce62c5007a06fb2d2efdc2b3223e5b3e13e5d859", "url": "https://github.com/getodk/collect/commit/ce62c5007a06fb2d2efdc2b3223e5b3e13e5d859", "message": "Code improvements", "committedDate": "2020-08-20T01:00:14Z", "type": "commit"}]}