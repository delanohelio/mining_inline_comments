{"pr_number": 4275, "pr_title": "Add error handling for audio recording", "pr_createdAt": "2020-12-07T18:19:26Z", "pr_url": "https://github.com/getodk/collect/pull/4275", "timeline": [{"oid": "747068c8e1fde90cec118acda36b50acfb8a17c1", "url": "https://github.com/getodk/collect/commit/747068c8e1fde90cec118acda36b50acfb8a17c1", "message": "Use Result type", "committedDate": "2020-12-07T18:21:50Z", "type": "forcePushed"}, {"oid": "93779860c4c6de8421ef6ec071f031dc71950323", "url": "https://github.com/getodk/collect/commit/93779860c4c6de8421ef6ec071f031dc71950323", "message": "Use Result type", "committedDate": "2020-12-07T18:25:51Z", "type": "forcePushed"}, {"oid": "ff2823998a0818f06438359307e16f734426c7df", "url": "https://github.com/getodk/collect/commit/ff2823998a0818f06438359307e16f734426c7df", "message": "Pull out media recorder config", "committedDate": "2020-12-08T10:56:20Z", "type": "commit"}, {"oid": "415804deccdab0cfddb21aac5c7476c1b5d9efd0", "url": "https://github.com/getodk/collect/commit/415804deccdab0cfddb21aac5c7476c1b5d9efd0", "message": "Add exception annotation to method that can explode", "committedDate": "2020-12-08T10:56:24Z", "type": "commit"}, {"oid": "eda7841c181d90ebb460942ecfe9abf3797aaf32", "url": "https://github.com/getodk/collect/commit/eda7841c181d90ebb460942ecfe9abf3797aaf32", "message": "Add exception handling to Recorder", "committedDate": "2020-12-08T10:56:24Z", "type": "commit"}, {"oid": "4944d43713c6c504ebd481b74123d74b8e3fdaa6", "url": "https://github.com/getodk/collect/commit/4944d43713c6c504ebd481b74123d74b8e3fdaa6", "message": "Catch recording start error and expose through viewmodel", "committedDate": "2020-12-08T10:56:24Z", "type": "commit"}, {"oid": "20a351b1f93c78fffb5bbbca9d8f45c1c4b267bc", "url": "https://github.com/getodk/collect/commit/20a351b1f93c78fffb5bbbca9d8f45c1c4b267bc", "message": "Make sure recording error stops service", "committedDate": "2020-12-08T10:56:25Z", "type": "commit"}, {"oid": "7ce04d8dca79a30c772e18f0300d745f170b4a52", "url": "https://github.com/getodk/collect/commit/7ce04d8dca79a30c772e18f0300d745f170b4a52", "message": "Show error message when recording fails to start", "committedDate": "2020-12-08T11:06:59Z", "type": "commit"}, {"oid": "ee4296f8246da0cea49fe256526ece9ae02e6114", "url": "https://github.com/getodk/collect/commit/ee4296f8246da0cea49fe256526ece9ae02e6114", "message": "Log error to Timber", "committedDate": "2020-12-08T11:07:01Z", "type": "commit"}, {"oid": "f6c4b507ad697f5ced2ab6562c056e7daf746e22", "url": "https://github.com/getodk/collect/commit/f6c4b507ad697f5ced2ab6562c056e7daf746e22", "message": "Use recording directory in ODK dir rather than cache", "committedDate": "2020-12-08T11:07:01Z", "type": "commit"}, {"oid": "ee79b6b47b693211d81428bb202805d2f1a09ab9", "url": "https://github.com/getodk/collect/commit/ee79b6b47b693211d81428bb202805d2f1a09ab9", "message": "Make sure filename isn't returned if file not copied", "committedDate": "2020-12-08T11:07:01Z", "type": "commit"}, {"oid": "1d33ffc61d023258c86b010bf37615c96cc4a918", "url": "https://github.com/getodk/collect/commit/1d33ffc61d023258c86b010bf37615c96cc4a918", "message": "Make sure app doesn't crash if copying recording fails", "committedDate": "2020-12-08T11:07:01Z", "type": "commit"}, {"oid": "6dfaa53627439c504e939656ec937fd6260239e6", "url": "https://github.com/getodk/collect/commit/6dfaa53627439c504e939656ec937fd6260239e6", "message": "Log answer file copy error to Timber", "committedDate": "2020-12-08T11:07:02Z", "type": "commit"}, {"oid": "05ad0a005182ab82f3fcca87c856b48f7e472eb0", "url": "https://github.com/getodk/collect/commit/05ad0a005182ab82f3fcca87c856b48f7e472eb0", "message": "Expose answer file copy errors on ViewModel", "committedDate": "2020-12-08T11:07:02Z", "type": "commit"}, {"oid": "35b0251056387dc9a01916ef2604a8374a7ddcb4", "url": "https://github.com/getodk/collect/commit/35b0251056387dc9a01916ef2604a8374a7ddcb4", "message": "Use factory injection for FormSaveViewModel", "committedDate": "2020-12-08T11:07:02Z", "type": "commit"}, {"oid": "007a1c0edcaf93935cd623f6e123367744fe9518", "url": "https://github.com/getodk/collect/commit/007a1c0edcaf93935cd623f6e123367744fe9518", "message": "Show error when answer file copying fails", "committedDate": "2020-12-08T11:10:59Z", "type": "commit"}, {"oid": "b8d4d6612538b45a77e2fceef7df6d8005bbd709", "url": "https://github.com/getodk/collect/commit/b8d4d6612538b45a77e2fceef7df6d8005bbd709", "message": "Don't delete file on clean up so it can be retrieved if there is an error", "committedDate": "2020-12-08T11:11:01Z", "type": "commit"}, {"oid": "4d330b20976199c914d774c2d019550a38ebf525", "url": "https://github.com/getodk/collect/commit/4d330b20976199c914d774c2d019550a38ebf525", "message": "Delete recordings after they've been copied to the instance folder", "committedDate": "2020-12-08T11:11:01Z", "type": "commit"}, {"oid": "e1a8beddd2d4fd4c017bfb5e81ca267e8302728e", "url": "https://github.com/getodk/collect/commit/e1a8beddd2d4fd4c017bfb5e81ca267e8302728e", "message": "Use Result type", "committedDate": "2020-12-08T11:11:01Z", "type": "commit"}, {"oid": "c65831cc725e22fdc26ac5fc87ebb6965d75592a", "url": "https://github.com/getodk/collect/commit/c65831cc725e22fdc26ac5fc87ebb6965d75592a", "message": "Update test", "committedDate": "2020-12-08T12:13:03Z", "type": "commit"}, {"oid": "c65831cc725e22fdc26ac5fc87ebb6965d75592a", "url": "https://github.com/getodk/collect/commit/c65831cc725e22fdc26ac5fc87ebb6965d75592a", "message": "Update test", "committedDate": "2020-12-08T12:13:03Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMwNzgxMw==", "url": "https://github.com/getodk/collect/pull/4275#discussion_r538307813", "bodyText": "This isn't tested at the moment. I've added a note to the \"Current Release\" project to come back and look at how DialogFragment classes are tested and try and backfill this. It seems like the options we have from Android's test tooling is a horrid mess of Robolectric and the new scenario stuff.", "author": "seadowg", "createdAt": "2020-12-08T12:24:31Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/saving/SaveAnswerFileErrorDialogFragment.java", "diffHunk": "@@ -0,0 +1,50 @@\n+package org.odk.collect.android.formentry.saving;\n+\n+import android.app.Dialog;\n+import android.content.Context;\n+import android.content.DialogInterface;\n+import android.os.Bundle;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.fragment.app.DialogFragment;\n+import androidx.lifecycle.ViewModelProvider;\n+\n+import com.google.android.material.dialog.MaterialAlertDialogBuilder;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.injection.DaggerUtils;\n+\n+import javax.inject.Inject;\n+\n+public class SaveAnswerFileErrorDialogFragment extends DialogFragment {", "originalCommit": "c65831cc725e22fdc26ac5fc87ebb6965d75592a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzODMwODc5OA==", "url": "https://github.com/getodk/collect/pull/4275#discussion_r538308798", "bodyText": "I wanted this error to be handled here rather than in the audio specific code as I think we can start using it in other places (rather than just for audio).", "author": "seadowg", "createdAt": "2020-12-08T12:26:00Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/saving/FormSaveViewModel.java", "diffHunk": "@@ -372,6 +385,14 @@ private void clearMediaFiles() {\n         recentFiles.clear();\n     }\n \n+    public LiveData<String> getAnswerFileError() {", "originalCommit": "c65831cc725e22fdc26ac5fc87ebb6965d75592a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "707fb2c893136530f49cdd3497be1a5feb794441", "url": "https://github.com/getodk/collect/commit/707fb2c893136530f49cdd3497be1a5feb794441", "message": "Update strings", "committedDate": "2020-12-08T17:11:32Z", "type": "commit"}, {"oid": "707fb2c893136530f49cdd3497be1a5feb794441", "url": "https://github.com/getodk/collect/commit/707fb2c893136530f49cdd3497be1a5feb794441", "message": "Update strings", "committedDate": "2020-12-08T17:11:32Z", "type": "forcePushed"}]}