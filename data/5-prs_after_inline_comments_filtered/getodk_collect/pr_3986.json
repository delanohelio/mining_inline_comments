{"pr_number": 3986, "pr_title": "Match exactly errors", "pr_createdAt": "2020-07-24T16:22:18Z", "pr_url": "https://github.com/getodk/collect/pull/3986", "timeline": [{"oid": "018b0f5c34492754773c5b2448d3bbb7eac25846", "url": "https://github.com/getodk/collect/commit/018b0f5c34492754773c5b2448d3bbb7eac25846", "message": "Add docs for networkDeferred", "committedDate": "2020-07-24T16:24:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE1ODk4NQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460158985", "bodyText": "The positive test case for this is currently in GetAndSubmitFormsTest", "author": "seadowg", "createdAt": "2020-07-24T16:27:10Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/feature/formmanagement/GetBlankFormsTest.java", "diffHunk": "@@ -0,0 +1,51 @@\n+package org.odk.collect.android.feature.formmanagement;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.RuleChain;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.support.CollectTestRule;\n+import org.odk.collect.android.support.TestDependencies;\n+import org.odk.collect.android.support.TestRuleChain;\n+import org.odk.collect.android.support.pages.GetBlankFormPage;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class GetBlankFormsTest {\n+\n+    public CollectTestRule rule = new CollectTestRule();\n+\n+    final TestDependencies testDependencies = new TestDependencies();\n+\n+    @Rule\n+    public RuleChain copyFormChain = TestRuleChain.chain(testDependencies)\n+            .around(rule);\n+\n+    @Test\n+    public void whenThereIsAnAuthenticationErrorFetchingFormList_allowsUserToReenterCredentials() {", "originalCommit": "e2c0baa905b5c61e8448ca60e9b311adaf5da28f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2MDU0OQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460160549", "bodyText": "We could also use the new less granular/more human errors for form download as well, but we'd need to discuss how that works. Collect is currently really verbose and outputs the failure/success status for each form so it's not as simple as just switching out the text.\nI think writing up an issue/feature for how errors should look on Get Blank Form would be ideal.", "author": "seadowg", "createdAt": "2020-07-24T16:30:14Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadListActivity.java", "diffHunk": "@@ -597,33 +572,55 @@ public void formListDownloadingComplete(HashMap<String, ServerFormDetails> resul\n             toggleButtonLabel(toggleButton, listView);\n \n             if (viewModel.isDownloadOnlyMode()) {\n-                //1. First check if all form IDS could be found on the server - Register forms that could not be found\n+                performDownloadModeDownload();\n+            }\n+        } else {\n+            switch (exception.getType()) {\n+                case FETCH_ERROR:", "originalCommit": "e2c0baa905b5c61e8448ca60e9b311adaf5da28f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2MzAyNA==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460163024", "bodyText": "I think there are still a few strings in both the auto send and auto download flows that may end up not translated. This is an existing issue however, so I didn't want to dedicate too much time to restructuring everything to fix it. I reckon we just create an issue for this?", "author": "seadowg", "createdAt": "2020-07-24T16:34:55Z", "path": "collect_app/src/main/java/org/odk/collect/android/notifications/NotificationManagerNotifier.java", "diffHunk": "@@ -73,4 +128,13 @@ private boolean allFormsDownloadedSuccessfully(Context context, HashMap<ServerFo\n         }\n         return true;\n     }\n+\n+    // The application context will give us the system's locale\n+    private Resources getLocalizedResources(Context context) {", "originalCommit": "e2c0baa905b5c61e8448ca60e9b311adaf5da28f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDc1ODEyMQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460758121", "bodyText": "Issue at #3988", "author": "seadowg", "createdAt": "2020-07-27T09:19:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2MzAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2NDA4OQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460164089", "bodyText": "fetchForm and fetchMediaFile happen to have the same implementation but it felt keeping the separate was the right thing to do\u2122\ufe0f as the call sites don't really know or care that they involve the same work.", "author": "seadowg", "createdAt": "2020-07-24T16:36:58Z", "path": "collect_app/src/main/java/org/odk/collect/android/openrosa/api/FormListApi.java", "diffHunk": "@@ -1,10 +1,15 @@\n package org.odk.collect.android.openrosa.api;\n \n+import java.io.InputStream;\n import java.util.List;\n \n public interface FormListApi {\n \n     List<FormListItem> fetchFormList() throws FormApiException;\n \n     ManifestFile fetchManifest(String manifestURL) throws FormApiException;\n+\n+    InputStream fetchForm(String formURL) throws FormApiException;", "originalCommit": "e2c0baa905b5c61e8448ca60e9b311adaf5da28f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2NTQ1OQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460165459", "bodyText": "I had a good go at chipping away at this but there is far more to be done. I think we need to get to a point where we're not calling this anywhere but ServerFormDownloader to really start tearing it apart. There is a lot of logic around task cancellation in here that needs to get the hell out.", "author": "seadowg", "createdAt": "2020-07-24T16:39:27Z", "path": "collect_app/src/main/java/org/odk/collect/android/utilities/MultiFormDownloader.java", "diffHunk": "@@ -44,42 +44,29 @@\n import java.io.OutputStream;\n import java.net.URISyntaxException;\n import java.nio.charset.Charset;\n-import java.util.ArrayList;\n-import java.util.Collections;\n import java.util.HashMap;\n import java.util.List;\n import java.util.Map;\n \n-import javax.inject.Inject;\n-\n import timber.log.Timber;\n \n import static org.odk.collect.android.utilities.FileUtils.LAST_SAVED_FILENAME;\n import static org.odk.collect.android.utilities.FileUtils.STUB_XML;\n import static org.odk.collect.android.utilities.FileUtils.write;\n \n-public class MultiFormDownloader implements FormDownloader {\n+@Deprecated\n+public class MultiFormDownloader {", "originalCommit": "e2c0baa905b5c61e8448ca60e9b311adaf5da28f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2NzU4Mg==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r460167582", "bodyText": "I killed all the error messages coming out of here and pretty much all the error logging. Most of it isn't needed to show the errors we're trying to show. Good to check and see if any of it feels like something we'd need to keep.", "author": "seadowg", "createdAt": "2020-07-24T16:43:13Z", "path": "collect_app/src/main/java/org/odk/collect/android/openrosa/api/OpenRosaFormListApi.java", "diffHunk": "@@ -27,23 +30,43 @@\n     private final String serverURL;\n     private final String formListPath;\n \n-    public OpenRosaFormListApi(OpenRosaXmlFetcher openRosaXMLFetcher, String serverURL, String formListPath) {\n-        this.openRosaXMLFetcher = openRosaXMLFetcher;\n+    public OpenRosaFormListApi(String serverURL, String formListPath, OpenRosaHttpInterface openRosaHttpInterface, WebCredentialsUtils webCredentialsUtils) {", "originalCommit": "e2c0baa905b5c61e8448ca60e9b311adaf5da28f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4NzU5OQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r461787599", "bodyText": "Yup, looks good to me.", "author": "lognaturel", "createdAt": "2020-07-28T18:31:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MDE2NzU4Mg=="}], "type": "inlineReview"}, {"oid": "8ead2041da08ae1e4f02be2c7b4ff0da091e9a20", "url": "https://github.com/getodk/collect/commit/8ead2041da08ae1e4f02be2c7b4ff0da091e9a20", "message": "Make view model test not rely on repo implementation", "committedDate": "2020-07-27T13:03:14Z", "type": "commit"}, {"oid": "763e4e5b7890c3e2c13d8dcf8e7b7068bfa53b21", "url": "https://github.com/getodk/collect/commit/763e4e5b7890c3e2c13d8dcf8e7b7068bfa53b21", "message": "Change sync icon when syncing fails", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "e1da725ed5550343e32d90ef481fdcedb34c4eaa", "url": "https://github.com/getodk/collect/commit/e1da725ed5550343e32d90ef481fdcedb34c4eaa", "message": "Avoid using LiveData#getValue in delegate", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "2c7b496a17fe8984b5047340921997e768fdd4c8", "url": "https://github.com/getodk/collect/commit/2c7b496a17fe8984b5047340921997e768fdd4c8", "message": "Show notification when there is an error syncing forms", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "85248174923f5d065144c1b0ac54d103a88b8d42", "url": "https://github.com/getodk/collect/commit/85248174923f5d065144c1b0ac54d103a88b8d42", "message": "Optimize imports", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "372c9d0f12d896b09248a80e5e9e8b4edcf3b112", "url": "https://github.com/getodk/collect/commit/372c9d0f12d896b09248a80e5e9e8b4edcf3b112", "message": "Clicking on sync error notification navigates to fill blank form", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "7f69118e154c32775ecc334872ab1407d29cd7d7", "url": "https://github.com/getodk/collect/commit/7f69118e154c32775ecc334872ab1407d29cd7d7", "message": "Give form synchronizer use case its own error type", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "0b0a589c04e0223498e2aaf8d5d076d7790cbc7f", "url": "https://github.com/getodk/collect/commit/0b0a589c04e0223498e2aaf8d5d076d7790cbc7f", "message": "Bubble up unknown host error from FormListApi\n\nThis removes some test to avoid dealing with compile failures. Will come back for coverage of these.", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "4fab3192135a7d61fdf29f0261fdb8fbe6ea4d85", "url": "https://github.com/getodk/collect/commit/4fab3192135a7d61fdf29f0261fdb8fbe6ea4d85", "message": "Add coverage previously in FormListDownloaderTest", "committedDate": "2020-07-27T13:03:36Z", "type": "commit"}, {"oid": "188772961210b0a52a4a8a551287dd5b3537ae77", "url": "https://github.com/getodk/collect/commit/188772961210b0a52a4a8a551287dd5b3537ae77", "message": "Add test for auth error in Get Blank Forms\n\nThis also changes the auth dialog so it is easier to test. This also improves the accessbility of the flow as hints were missing before.", "committedDate": "2020-07-27T13:03:37Z", "type": "commit"}, {"oid": "8de4a52195bb81ce2af993e92623dceab0f2d412", "url": "https://github.com/getodk/collect/commit/8de4a52195bb81ce2af993e92623dceab0f2d412", "message": "Add tests for Get Blank Form error flows", "committedDate": "2020-07-27T13:03:37Z", "type": "commit"}, {"oid": "2500b578bdc436243f1cb564e276297c2a208159", "url": "https://github.com/getodk/collect/commit/2500b578bdc436243f1cb564e276297c2a208159", "message": "Revise FormApiException granularity and use instead of SyncException", "committedDate": "2020-07-27T13:03:37Z", "type": "commit"}, {"oid": "b286bdc71afb1db2c284c6ed84b3c3e7cc43a1a5", "url": "https://github.com/getodk/collect/commit/b286bdc71afb1db2c284c6ed84b3c3e7cc43a1a5", "message": "Delete FormListDownloader", "committedDate": "2020-07-27T13:03:37Z", "type": "commit"}, {"oid": "fe04cc690e3860cb219b1a090ab3683d802a9056", "url": "https://github.com/getodk/collect/commit/fe04cc690e3860cb219b1a090ab3683d802a9056", "message": "Add specific message for unknown host error", "committedDate": "2020-07-27T13:03:37Z", "type": "commit"}, {"oid": "25ded5f460aee4d98a7de7514580ec0ac3f11a36", "url": "https://github.com/getodk/collect/commit/25ded5f460aee4d98a7de7514580ec0ac3f11a36", "message": "Remove message from FormApiException", "committedDate": "2020-07-27T13:03:37Z", "type": "commit"}, {"oid": "b92e2a9c0d39fabe783784e916b7d5867e13751b", "url": "https://github.com/getodk/collect/commit/b92e2a9c0d39fabe783784e916b7d5867e13751b", "message": "Include URL in unknown host error", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "5751dbdc42e20d1caab45487a63913353bc96cd2", "url": "https://github.com/getodk/collect/commit/5751dbdc42e20d1caab45487a63913353bc96cd2", "message": "Add download mode code back into FormDownloadListActivity", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "5ba30a426f5fd0a2f9690a5478045f574e7f3281", "url": "https://github.com/getodk/collect/commit/5ba30a426f5fd0a2f9690a5478045f574e7f3281", "message": "Prompt user for credentials when match exactly sync fails", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "97d044d1b474f4bc25a2b6882adb34c1350f842d", "url": "https://github.com/getodk/collect/commit/97d044d1b474f4bc25a2b6882adb34c1350f842d", "message": "Simpify ServerAuthDialogFragment", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "56ef7f3df04cbeadec73c1a0f94ae44879d1d195", "url": "https://github.com/getodk/collect/commit/56ef7f3df04cbeadec73c1a0f94ae44879d1d195", "message": "Deprecate AuthDialogUtility", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "0716428a0374d2f08947e6d40dd717f8d8130398", "url": "https://github.com/getodk/collect/commit/0716428a0374d2f08947e6d40dd717f8d8130398", "message": "Prefill username and password in new server auth dialog", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "21d4b25dae2073f1aee322151be4ecee8bec6d20", "url": "https://github.com/getodk/collect/commit/21d4b25dae2073f1aee322151be4ecee8bec6d20", "message": "Make sure NotificationManagerNotifier uses correct locale", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "eb71fe8ad5c2ed2b4ca3f4c2fc84e82aea9d89c1", "url": "https://github.com/getodk/collect/commit/eb71fe8ad5c2ed2b4ca3f4c2fc84e82aea9d89c1", "message": "Add test for autosend", "committedDate": "2020-07-27T13:03:38Z", "type": "commit"}, {"oid": "42a66c33c40b4098f019dd83e51860b8355af634", "url": "https://github.com/getodk/collect/commit/42a66c33c40b4098f019dd83e51860b8355af634", "message": "Move auto send to using scheduler", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "e5ae64810adccf2d451558ea71c348be0f31aaf5", "url": "https://github.com/getodk/collect/commit/e5ae64810adccf2d451558ea71c348be0f31aaf5", "message": "Move auto send notification to Notifier", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "5c959a4f583a198a44bde26b4640b77e6d377cca", "url": "https://github.com/getodk/collect/commit/5c959a4f583a198a44bde26b4640b77e6d377cca", "message": "Make sure form synchronizer keeps downloading forms when one fails", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "fd8a1845f9168b578bcd2883a177780d35ca122d", "url": "https://github.com/getodk/collect/commit/fd8a1845f9168b578bcd2883a177780d35ca122d", "message": "Bring back FormDownloaderTest", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "28db0f770554ec1b821d6b7e7d837bb4a52d0b00", "url": "https://github.com/getodk/collect/commit/28db0f770554ec1b821d6b7e7d837bb4a52d0b00", "message": "Wrap MultiFormDownloader so download failures will bubble up error in match exactly", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "a9a167711436045f50f9967e5de323875725d015", "url": "https://github.com/getodk/collect/commit/a9a167711436045f50f9967e5de323875725d015", "message": "Use FormRepository in MultiFormDownloader", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "2e03c20d87e981a4c1ce4ee0c88661f98b05b2f4", "url": "https://github.com/getodk/collect/commit/2e03c20d87e981a4c1ce4ee0c88661f98b05b2f4", "message": "Use FormListApi in MultiFormDownloader", "committedDate": "2020-07-27T13:03:39Z", "type": "commit"}, {"oid": "4a3be489906164e90d393d74bc6ee3e16d2cdcc8", "url": "https://github.com/getodk/collect/commit/4a3be489906164e90d393d74bc6ee3e16d2cdcc8", "message": "Add docs for networkDeferred", "committedDate": "2020-07-27T13:03:40Z", "type": "commit"}, {"oid": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "url": "https://github.com/getodk/collect/commit/46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "message": "Correct typo", "committedDate": "2020-07-27T13:03:40Z", "type": "commit"}, {"oid": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "url": "https://github.com/getodk/collect/commit/46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "message": "Correct typo", "committedDate": "2020-07-27T13:03:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc1Njk4MA==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r461756980", "bodyText": "Seems better to use AUTO_SEND_TAG?", "author": "lognaturel", "createdAt": "2020-07-28T17:39:11Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/InstanceUploaderListActivity.java", "diffHunk": "@@ -207,8 +206,7 @@ void init() {\n      * Updates whether an auto-send job is ongoing.\n      */\n     private void updateAutoSendStatus() {\n-        LiveData<List<WorkInfo>> statuses = WorkManager.getInstance().getWorkInfosForUniqueWorkLiveData(AutoSendWorker.TAG);\n-\n+        LiveData<List<WorkInfo>> statuses = WorkManager.getInstance().getWorkInfosForUniqueWorkLiveData(\"AutoSendWorker\");", "originalCommit": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4NDYxMQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r461784611", "bodyText": "Like for the manual update case, this should also include the string server_auth_credentials because that indicates what server needs credentials.", "author": "lognaturel", "createdAt": "2020-07-28T18:25:48Z", "path": "collect_app/src/main/java/org/odk/collect/android/preferences/ServerAuthDialogFragment.java", "diffHunk": "@@ -0,0 +1,59 @@\n+package org.odk.collect.android.preferences;\n+\n+import android.app.Dialog;\n+import android.content.Context;\n+import android.content.SharedPreferences;\n+import android.os.Bundle;\n+import android.view.View;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.appcompat.app.AlertDialog;\n+import androidx.fragment.app.DialogFragment;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.databinding.ServerAuthDialogBinding;\n+import org.odk.collect.android.injection.DaggerUtils;\n+\n+import javax.inject.Inject;\n+\n+public class ServerAuthDialogFragment extends DialogFragment {\n+\n+    @Inject\n+    PreferencesProvider preferencesProvider;\n+\n+    private View dialogView;\n+\n+    @Override\n+    public void onAttach(@NonNull Context context) {\n+        super.onAttach(context);\n+        DaggerUtils.getComponent(context).inject(this);\n+    }\n+\n+    @NonNull\n+    @Override\n+    public Dialog onCreateDialog(@Nullable Bundle savedInstanceState) {\n+        ServerAuthDialogBinding binding = ServerAuthDialogBinding.inflate(requireActivity().getLayoutInflater());\n+        dialogView = binding.getRoot();\n+\n+        SharedPreferences generalSharedPreferences = preferencesProvider.getGeneralSharedPreferences();\n+        binding.usernameEdit.setText(generalSharedPreferences.getString(GeneralKeys.KEY_USERNAME, \"\"));\n+        binding.passwordEdit.setText(generalSharedPreferences.getString(GeneralKeys.KEY_PASSWORD, \"\"));\n+\n+\n+        return new AlertDialog.Builder(requireContext())\n+                .setTitle(R.string.server_requires_auth)", "originalCommit": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0NjU5OQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r462146599", "bodyText": "Done!", "author": "seadowg", "createdAt": "2020-07-29T08:57:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4NDYxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4ODkyMA==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r461788920", "bodyText": "Hah. Never seen sarcophagus used that way but it makes so much sense.", "author": "lognaturel", "createdAt": "2020-07-28T18:33:15Z", "path": "collect_app/src/main/java/org/odk/collect/android/formmanagement/ServerFormDownloader.java", "diffHunk": "@@ -0,0 +1,30 @@\n+package org.odk.collect.android.formmanagement;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.application.Collect;\n+import org.odk.collect.android.utilities.MultiFormDownloader;\n+\n+import java.util.Collections;\n+import java.util.HashMap;\n+\n+/**\n+ * Provides a sarcophagus for {@link org.odk.collect.android.utilities.MultiFormDownloader} so it", "originalCommit": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0ODg3OA==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r462148878", "bodyText": "It's great terminology. I like that it implies it is protecting both the thing in the \"sarcophagus\" and the things outside.", "author": "seadowg", "createdAt": "2020-07-29T09:01:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc4ODkyMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MDAwNg==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r461790006", "bodyText": "In this case we ALSO want to include the \"if it keeps happening, talk to the person who asked you to collect data\" message. I think just concatenating the two with a space would be fine (and concat does the right thing with LTR languages, I believe)", "author": "lognaturel", "createdAt": "2020-07-28T18:35:04Z", "path": "collect_app/src/main/java/org/odk/collect/android/formmanagement/FormApiExceptionMapper.java", "diffHunk": "@@ -0,0 +1,23 @@\n+package org.odk.collect.android.formmanagement;\n+\n+import android.content.res.Resources;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.openrosa.api.FormApiException;\n+\n+public class FormApiExceptionMapper {\n+\n+    private final Resources resources;\n+\n+    public FormApiExceptionMapper(Resources resources) {\n+        this.resources = resources;\n+    }\n+\n+    public String getMessage(FormApiException exception) {\n+        if (exception.getType() == FormApiException.Type.UNKNOWN_HOST) {\n+            return resources.getString(R.string.unknown_host_error, exception.getServerUrl());", "originalCommit": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE1MTAxNw==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r462151017", "bodyText": "Right that makes sense.", "author": "seadowg", "createdAt": "2020-07-29T09:04:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MDAwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MDk5OA==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r461790998", "bodyText": "Why not dialogMessage? That seems a lot more useful.", "author": "lognaturel", "createdAt": "2020-07-28T18:36:46Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormDownloadListActivity.java", "diffHunk": "@@ -597,33 +572,55 @@ public void formListDownloadingComplete(HashMap<String, ServerFormDetails> resul\n             toggleButtonLabel(toggleButton, listView);\n \n             if (viewModel.isDownloadOnlyMode()) {\n-                //1. First check if all form IDS could be found on the server - Register forms that could not be found\n+                performDownloadModeDownload();\n+            }\n+        } else {\n+            switch (exception.getType()) {\n+                case FETCH_ERROR:\n+                case UNKNOWN_HOST:\n+                    String dialogMessage = new FormApiExceptionMapper(getResources()).getMessage(exception);\n+                    String dialogTitle = getString(R.string.load_remote_form_error);\n+\n+                    if (viewModel.isDownloadOnlyMode()) {\n+                        setReturnResult(false, getString(R.string.load_remote_form_error), viewModel.getFormResults());", "originalCommit": "46a2b8b2969754c2fcb37e1ad8bb469c17ca17cc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjE0Nzg0Mw==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r462147843", "bodyText": "Good point. Will change.", "author": "seadowg", "createdAt": "2020-07-29T08:59:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MTc5MDk5OA=="}], "type": "inlineReview"}, {"oid": "372ee3cbc0a9283de09964bf2eec1b64ada27702", "url": "https://github.com/getodk/collect/commit/372ee3cbc0a9283de09964bf2eec1b64ada27702", "message": "Move overloaded methods together", "committedDate": "2020-07-29T08:23:21Z", "type": "commit"}, {"oid": "c24fead2405c0e59464eebfd1d4bc06bbea86a48", "url": "https://github.com/getodk/collect/commit/c24fead2405c0e59464eebfd1d4bc06bbea86a48", "message": "Replace hard coded string with constant", "committedDate": "2020-07-29T08:24:36Z", "type": "commit"}, {"oid": "fcaf757b1032cd90451d4f70f73a0e4ce6284dcf", "url": "https://github.com/getodk/collect/commit/fcaf757b1032cd90451d4f70f73a0e4ce6284dcf", "message": "Rename string", "committedDate": "2020-07-29T08:26:26Z", "type": "commit"}, {"oid": "adced4df352c0759aa6bc3ac6380df37692305f6", "url": "https://github.com/getodk/collect/commit/adced4df352c0759aa6bc3ac6380df37692305f6", "message": "Add server url to auth dialog", "committedDate": "2020-07-29T08:56:11Z", "type": "commit"}, {"oid": "2b2aa62333646d8ac5490655e1def2621d28e5c3", "url": "https://github.com/getodk/collect/commit/2b2aa62333646d8ac5490655e1def2621d28e5c3", "message": "Use new error messages for dowload mode only", "committedDate": "2020-07-29T09:00:04Z", "type": "commit"}, {"oid": "53d9100f6a915110fd68e7b979bde3c2b59da552", "url": "https://github.com/getodk/collect/commit/53d9100f6a915110fd68e7b979bde3c2b59da552", "message": "Improve unknown host message", "committedDate": "2020-07-29T09:06:44Z", "type": "commit"}, {"oid": "e0dceabf39e0714da5eb077b043b9973c3721427", "url": "https://github.com/getodk/collect/commit/e0dceabf39e0714da5eb077b043b9973c3721427", "message": "Fix spacing on prefs", "committedDate": "2020-07-29T13:07:31Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MjcyNzcyNQ==", "url": "https://github.com/getodk/collect/pull/3986#discussion_r462727725", "bodyText": "This needs to be reverted.", "author": "lognaturel", "createdAt": "2020-07-30T04:29:36Z", "path": "collect_app/src/main/java/org/odk/collect/android/notifications/NotificationManagerNotifier.java", "diffHunk": "@@ -84,10 +84,11 @@ public void onUpdatesDownloaded(HashMap<ServerFormDetails, String> result) {\n     @Override\n     public void onSyncFailure(FormApiException exception) {\n         Intent intent = new Intent(application, FillBlankFormActivity.class);\n+        intent.putExtra(FillBlankFormActivity.EXTRA_AUTH_REQUIRED, true);", "originalCommit": "372ee3cbc0a9283de09964bf2eec1b64ada27702", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}