{"pr_number": 4042, "pr_title": "Rework Bearing Widget", "pr_createdAt": "2020-08-25T12:36:50Z", "pr_url": "https://github.com/getodk/collect/pull/4042", "timeline": [{"oid": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "url": "https://github.com/getodk/collect/commit/fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "message": "create bearing_widgte_answer.xml and code refactor", "committedDate": "2020-08-25T15:03:33Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Njk3Mw==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477096973", "bodyText": "As I remember in other widgets you have refactored you set answer in onCreateAnswerView(), am I right? If so please be consequent.", "author": "grzesiek2010", "createdAt": "2020-08-26T07:39:49Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIwMjcyNg==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477202726", "bodyText": "Oh right! I will change that. I might have set the answer in the constructor in some others too. I'll change them", "author": "SaumiaSinghal", "createdAt": "2020-08-26T10:35:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzA5Njk3Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwMzAxMg==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477103012", "bodyText": "There is something wrong with the button text. You set it to default here but it's not set to R.string.replace_bearing when we record bearing (only if we create the widget from scratch and there is an answer).", "author": "grzesiek2010", "createdAt": "2020-08-26T07:50:10Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIwNDkyOA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477204928", "bodyText": "I need to update the button label in setBinaryData(). I will add a unit test too.", "author": "SaumiaSinghal", "createdAt": "2020-08-26T10:40:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwMzAxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEwOTc1OQ==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477109759", "bodyText": "I would call the filed and the method areSensorsAvailable.", "author": "grzesiek2010", "createdAt": "2020-08-26T08:01:08Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMDQ0OQ==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477110449", "bodyText": "I think this method is unnecessarily big can we just have:\n        return sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER) != null \n                && sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD) != null;", "author": "grzesiek2010", "createdAt": "2020-08-26T08:02:20Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));\n         widgetValueChanged();\n     }\n \n     @Override\n     public IAnswerData getAnswer() {\n-        String s = answer.getText().toString();\n-\n-        if (s.equals(\"\")) {\n-            return null;\n-        } else {\n-            return new StringData(s);\n-        }\n+        String answerText = binding.answerText.getText().toString();\n+        return answerText.isEmpty() ? null : new StringData(answerText);\n     }\n \n     @Override\n     public void setBinaryData(Object answer) {\n-        this.answer.setText((String) answer);\n+        binding.answerText.setText((String) answer);\n         widgetValueChanged();\n     }\n \n     @Override\n     public void setOnLongClickListener(OnLongClickListener l) {\n         if (isSensorAvailable) {\n-            getBearingButton.setOnLongClickListener(l);\n+            binding.bearingButton.setOnLongClickListener(l);\n         }\n-        answer.setOnLongClickListener(l);\n+        binding.answerText.setOnLongClickListener(l);\n     }\n \n     @Override\n     public void cancelLongPress() {\n         super.cancelLongPress();\n         if (isSensorAvailable) {\n-            getBearingButton.cancelLongPress();\n+            binding.bearingButton.cancelLongPress();\n         }\n-        answer.cancelLongPress();\n+        binding.answerText.cancelLongPress();\n     }\n \n     private boolean checkForRequiredSensors() {", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMTQ1NA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477111454", "bodyText": "I don't like mixing things here I mean showing the toast i the middle of other stuff. It should be at the begging or at the end.", "author": "grzesiek2010", "createdAt": "2020-08-26T08:04:09Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));\n         widgetValueChanged();\n     }\n \n     @Override\n     public IAnswerData getAnswer() {\n-        String s = answer.getText().toString();\n-\n-        if (s.equals(\"\")) {\n-            return null;\n-        } else {\n-            return new StringData(s);\n-        }\n+        String answerText = binding.answerText.getText().toString();\n+        return answerText.isEmpty() ? null : new StringData(answerText);\n     }\n \n     @Override\n     public void setBinaryData(Object answer) {\n-        this.answer.setText((String) answer);\n+        binding.answerText.setText((String) answer);\n         widgetValueChanged();\n     }\n \n     @Override\n     public void setOnLongClickListener(OnLongClickListener l) {\n         if (isSensorAvailable) {\n-            getBearingButton.setOnLongClickListener(l);\n+            binding.bearingButton.setOnLongClickListener(l);\n         }\n-        answer.setOnLongClickListener(l);\n+        binding.answerText.setOnLongClickListener(l);\n     }\n \n     @Override\n     public void cancelLongPress() {\n         super.cancelLongPress();\n         if (isSensorAvailable) {\n-            getBearingButton.cancelLongPress();\n+            binding.bearingButton.cancelLongPress();\n         }\n-        answer.cancelLongPress();\n+        binding.answerText.cancelLongPress();\n     }\n \n     private boolean checkForRequiredSensors() {\n-\n         boolean isAccelerometerSensorAvailable = false;\n         boolean isMagneticFieldSensorAvailable = false;\n \n-        SensorManager sensorManager = (SensorManager) getContext().getSystemService(Context.SENSOR_SERVICE);\n         if (sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER) != null) {\n             isAccelerometerSensorAvailable = true;\n         }\n         if (sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD) != null) {\n             isMagneticFieldSensorAvailable = true;\n         }\n-\n         return isAccelerometerSensorAvailable && isMagneticFieldSensorAvailable;\n     }\n \n-    private EditText getEditText() {\n-        final EditText manualData = new EditText(getContext());\n-        manualData.setPadding(20, 20, 20, 20);\n-        manualData.setTextSize(TypedValue.COMPLEX_UNIT_DIP, getAnswerFontSize());\n-        manualData.setInputType(InputType.TYPE_NUMBER_FLAG_DECIMAL);\n-        manualData.setKeyListener(new DigitsKeyListener(true, true));\n-        manualData.setFocusable(false);\n-        manualData.setFocusableInTouchMode(false);\n-        TableLayout.LayoutParams params = new TableLayout.LayoutParams();\n-        params.setMargins(7, 5, 7, 5);\n-        manualData.setLayoutParams(params);\n-\n-        manualData.addTextChangedListener(new TextWatcher() {\n-            @Override\n-            public void beforeTextChanged(CharSequence s, int start, int count, int after) {\n-\n-            }\n-\n-            @Override\n-            public void onTextChanged(CharSequence s, int start, int before, int count) {\n-\n-            }\n-\n-            @Override\n-            public void afterTextChanged(Editable s) {\n-                widgetValueChanged();\n-            }\n-        });\n-\n-        return manualData;\n-    }\n-\n-    @Override\n-    public void onButtonClick(int buttonId) {\n+    private void onButtonClick() {\n         if (isSensorAvailable) {\n-            Intent i = new Intent(getContext(), BearingActivity.class);\n+            Intent intent = new Intent(getContext(), BearingActivity.class);\n             waitingForDataRegistry.waitForData(getFormEntryPrompt().getIndex());\n-            ((Activity) getContext()).startActivityForResult(i,\n-                    RequestCodes.BEARING_CAPTURE);\n+            ((Activity) getContext()).startActivityForResult(intent, RequestCodes.BEARING_CAPTURE);\n         } else {\n-            getBearingButton.setEnabled(false);\n+            binding.bearingButton.setEnabled(false);", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMTk2OA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477111968", "bodyText": "Could you move it one line down? The reason is like below (mixing stuff).", "author": "grzesiek2010", "createdAt": "2020-08-26T08:05:04Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));\n         widgetValueChanged();\n     }\n \n     @Override\n     public IAnswerData getAnswer() {\n-        String s = answer.getText().toString();\n-\n-        if (s.equals(\"\")) {\n-            return null;\n-        } else {\n-            return new StringData(s);\n-        }\n+        String answerText = binding.answerText.getText().toString();\n+        return answerText.isEmpty() ? null : new StringData(answerText);\n     }\n \n     @Override\n     public void setBinaryData(Object answer) {\n-        this.answer.setText((String) answer);\n+        binding.answerText.setText((String) answer);\n         widgetValueChanged();\n     }\n \n     @Override\n     public void setOnLongClickListener(OnLongClickListener l) {\n         if (isSensorAvailable) {\n-            getBearingButton.setOnLongClickListener(l);\n+            binding.bearingButton.setOnLongClickListener(l);\n         }\n-        answer.setOnLongClickListener(l);\n+        binding.answerText.setOnLongClickListener(l);\n     }\n \n     @Override\n     public void cancelLongPress() {\n         super.cancelLongPress();\n         if (isSensorAvailable) {\n-            getBearingButton.cancelLongPress();\n+            binding.bearingButton.cancelLongPress();\n         }\n-        answer.cancelLongPress();\n+        binding.answerText.cancelLongPress();\n     }\n \n     private boolean checkForRequiredSensors() {\n-\n         boolean isAccelerometerSensorAvailable = false;\n         boolean isMagneticFieldSensorAvailable = false;\n \n-        SensorManager sensorManager = (SensorManager) getContext().getSystemService(Context.SENSOR_SERVICE);\n         if (sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER) != null) {\n             isAccelerometerSensorAvailable = true;\n         }\n         if (sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD) != null) {\n             isMagneticFieldSensorAvailable = true;\n         }\n-\n         return isAccelerometerSensorAvailable && isMagneticFieldSensorAvailable;\n     }\n \n-    private EditText getEditText() {\n-        final EditText manualData = new EditText(getContext());\n-        manualData.setPadding(20, 20, 20, 20);\n-        manualData.setTextSize(TypedValue.COMPLEX_UNIT_DIP, getAnswerFontSize());\n-        manualData.setInputType(InputType.TYPE_NUMBER_FLAG_DECIMAL);\n-        manualData.setKeyListener(new DigitsKeyListener(true, true));\n-        manualData.setFocusable(false);\n-        manualData.setFocusableInTouchMode(false);\n-        TableLayout.LayoutParams params = new TableLayout.LayoutParams();\n-        params.setMargins(7, 5, 7, 5);\n-        manualData.setLayoutParams(params);\n-\n-        manualData.addTextChangedListener(new TextWatcher() {\n-            @Override\n-            public void beforeTextChanged(CharSequence s, int start, int count, int after) {\n-\n-            }\n-\n-            @Override\n-            public void onTextChanged(CharSequence s, int start, int before, int count) {\n-\n-            }\n-\n-            @Override\n-            public void afterTextChanged(Editable s) {\n-                widgetValueChanged();\n-            }\n-        });\n-\n-        return manualData;\n-    }\n-\n-    @Override\n-    public void onButtonClick(int buttonId) {\n+    private void onButtonClick() {\n         if (isSensorAvailable) {\n-            Intent i = new Intent(getContext(), BearingActivity.class);\n+            Intent intent = new Intent(getContext(), BearingActivity.class);\n             waitingForDataRegistry.waitForData(getFormEntryPrompt().getIndex());", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ3NzU2NA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477477564", "bodyText": "Something went wrong here because you just added and empty line instead of moving the line I mentioned down.", "author": "grzesiek2010", "createdAt": "2020-08-26T17:44:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMTk2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMzQ3Mw==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477113473", "bodyText": "Do we really need this check? I think it's redundant.", "author": "grzesiek2010", "createdAt": "2020-08-26T08:07:42Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));\n         widgetValueChanged();\n     }\n \n     @Override\n     public IAnswerData getAnswer() {\n-        String s = answer.getText().toString();\n-\n-        if (s.equals(\"\")) {\n-            return null;\n-        } else {\n-            return new StringData(s);\n-        }\n+        String answerText = binding.answerText.getText().toString();\n+        return answerText.isEmpty() ? null : new StringData(answerText);\n     }\n \n     @Override\n     public void setBinaryData(Object answer) {\n-        this.answer.setText((String) answer);\n+        binding.answerText.setText((String) answer);\n         widgetValueChanged();\n     }\n \n     @Override\n     public void setOnLongClickListener(OnLongClickListener l) {\n         if (isSensorAvailable) {\n-            getBearingButton.setOnLongClickListener(l);\n+            binding.bearingButton.setOnLongClickListener(l);\n         }\n-        answer.setOnLongClickListener(l);\n+        binding.answerText.setOnLongClickListener(l);\n     }\n \n     @Override\n     public void cancelLongPress() {\n         super.cancelLongPress();\n         if (isSensorAvailable) {", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMzUzMQ==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477113531", "bodyText": "Do we really need this check? I think it's redundant.", "author": "grzesiek2010", "createdAt": "2020-08-26T08:07:48Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));\n         widgetValueChanged();\n     }\n \n     @Override\n     public IAnswerData getAnswer() {\n-        String s = answer.getText().toString();\n-\n-        if (s.equals(\"\")) {\n-            return null;\n-        } else {\n-            return new StringData(s);\n-        }\n+        String answerText = binding.answerText.getText().toString();\n+        return answerText.isEmpty() ? null : new StringData(answerText);\n     }\n \n     @Override\n     public void setBinaryData(Object answer) {\n-        this.answer.setText((String) answer);\n+        binding.answerText.setText((String) answer);\n         widgetValueChanged();\n     }\n \n     @Override\n     public void setOnLongClickListener(OnLongClickListener l) {\n         if (isSensorAvailable) {", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzIyMTQ5NA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477221494", "bodyText": "In case the button is disabled, the listener will not listen to any click events, so yes, it is redundant.", "author": "SaumiaSinghal", "createdAt": "2020-08-26T11:13:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExMzUzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzExNDI0MQ==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477114241", "bodyText": "isEmpty() would be better here instead of equals(\"\")", "author": "grzesiek2010", "createdAt": "2020-08-26T08:09:07Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzEyMDQ4OA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477120488", "bodyText": "Can we get rid of textBackground field and for example call here:\nbinding.answerText.setBackground(new EditText(getContext()).getBackground());", "author": "grzesiek2010", "createdAt": "2020-08-26T08:19:14Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -21,176 +21,126 @@\n import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n-import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n+import android.view.View;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n     private final boolean isSensorAvailable;\n-    final EditText answer;\n     private final Drawable textBackground;\n     private final WaitingForDataRegistry waitingForDataRegistry;\n+    private final SensorManager sensorManager;\n \n-    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry) {\n+    public BearingWidget(Context context, QuestionDetails questionDetails, WaitingForDataRegistry waitingForDataRegistry, SensorManager sensorManager) {\n         super(context, questionDetails);\n         this.waitingForDataRegistry = waitingForDataRegistry;\n+        this.sensorManager = sensorManager;\n \n         isSensorAvailable = checkForRequiredSensors();\n+        textBackground = binding.answerText.getBackground();\n+        binding.answerText.setBackground(null);\n \n-        LinearLayout answerLayout = new LinearLayout(getContext());\n-        answerLayout.setOrientation(LinearLayout.VERTICAL);\n-\n-        answer = getEditText();\n-        textBackground = answer.getBackground();\n-        answer.setBackground(null);\n-\n-        getBearingButton = createSimpleButton(getContext(), getFormEntryPrompt().isReadOnly(), getContext().getString(R.string.get_bearing), getAnswerFontSize(), this);\n+        String answerText = questionDetails.getPrompt().getAnswerText();\n+        if (answerText != null && !answerText.equals(\"\")) {\n+            binding.bearingButton.setText(getContext().getString(R.string.replace_bearing));\n+            binding.answerText.setText(answerText);\n+        }\n+    }\n \n-        answerLayout.addView(getBearingButton);\n-        answerLayout.addView(answer);\n+    @Override\n+    protected View onCreateAnswerView(Context context, FormEntryPrompt prompt, int answerFontSize) {\n+        binding = BearingWidgetAnswerBinding.inflate(((Activity) context).getLayoutInflater());\n \n-        String s = questionDetails.getPrompt().getAnswerText();\n-        if (s != null && !s.equals(\"\")) {\n-            getBearingButton.setText(getContext().getString(R.string.replace_bearing));\n-            if (!isSensorAvailable) {\n-                answer.setText(s);\n-            }\n-            setBinaryData(s);\n+        if (prompt.isReadOnly()) {\n+            binding.bearingButton.setVisibility(GONE);\n+        } else {\n+            binding.bearingButton.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+            binding.bearingButton.setOnClickListener(v -> onButtonClick());\n         }\n-        addAnswerView(answerLayout, WidgetViewUtils.getStandardMargin(context));\n+        binding.answerText.setTextSize(TypedValue.COMPLEX_UNIT_DIP, answerFontSize);\n+\n+        return binding.getRoot();\n     }\n \n     @Override\n     public void clearAnswer() {\n-        answer.setText(null);\n-        getBearingButton.setText(getContext().getString(R.string.get_bearing));\n-\n+        binding.answerText.setText(null);\n+        binding.bearingButton.setText(getContext().getString(R.string.get_bearing));\n         widgetValueChanged();\n     }\n \n     @Override\n     public IAnswerData getAnswer() {\n-        String s = answer.getText().toString();\n-\n-        if (s.equals(\"\")) {\n-            return null;\n-        } else {\n-            return new StringData(s);\n-        }\n+        String answerText = binding.answerText.getText().toString();\n+        return answerText.isEmpty() ? null : new StringData(answerText);\n     }\n \n     @Override\n     public void setBinaryData(Object answer) {\n-        this.answer.setText((String) answer);\n+        binding.answerText.setText((String) answer);\n         widgetValueChanged();\n     }\n \n     @Override\n     public void setOnLongClickListener(OnLongClickListener l) {\n         if (isSensorAvailable) {\n-            getBearingButton.setOnLongClickListener(l);\n+            binding.bearingButton.setOnLongClickListener(l);\n         }\n-        answer.setOnLongClickListener(l);\n+        binding.answerText.setOnLongClickListener(l);\n     }\n \n     @Override\n     public void cancelLongPress() {\n         super.cancelLongPress();\n         if (isSensorAvailable) {\n-            getBearingButton.cancelLongPress();\n+            binding.bearingButton.cancelLongPress();\n         }\n-        answer.cancelLongPress();\n+        binding.answerText.cancelLongPress();\n     }\n \n     private boolean checkForRequiredSensors() {\n-\n         boolean isAccelerometerSensorAvailable = false;\n         boolean isMagneticFieldSensorAvailable = false;\n \n-        SensorManager sensorManager = (SensorManager) getContext().getSystemService(Context.SENSOR_SERVICE);\n         if (sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER) != null) {\n             isAccelerometerSensorAvailable = true;\n         }\n         if (sensorManager.getDefaultSensor(Sensor.TYPE_MAGNETIC_FIELD) != null) {\n             isMagneticFieldSensorAvailable = true;\n         }\n-\n         return isAccelerometerSensorAvailable && isMagneticFieldSensorAvailable;\n     }\n \n-    private EditText getEditText() {\n-        final EditText manualData = new EditText(getContext());\n-        manualData.setPadding(20, 20, 20, 20);\n-        manualData.setTextSize(TypedValue.COMPLEX_UNIT_DIP, getAnswerFontSize());\n-        manualData.setInputType(InputType.TYPE_NUMBER_FLAG_DECIMAL);\n-        manualData.setKeyListener(new DigitsKeyListener(true, true));\n-        manualData.setFocusable(false);\n-        manualData.setFocusableInTouchMode(false);\n-        TableLayout.LayoutParams params = new TableLayout.LayoutParams();\n-        params.setMargins(7, 5, 7, 5);\n-        manualData.setLayoutParams(params);\n-\n-        manualData.addTextChangedListener(new TextWatcher() {\n-            @Override\n-            public void beforeTextChanged(CharSequence s, int start, int count, int after) {\n-\n-            }\n-\n-            @Override\n-            public void onTextChanged(CharSequence s, int start, int before, int count) {\n-\n-            }\n-\n-            @Override\n-            public void afterTextChanged(Editable s) {\n-                widgetValueChanged();\n-            }\n-        });\n-\n-        return manualData;\n-    }\n-\n-    @Override\n-    public void onButtonClick(int buttonId) {\n+    private void onButtonClick() {\n         if (isSensorAvailable) {\n-            Intent i = new Intent(getContext(), BearingActivity.class);\n+            Intent intent = new Intent(getContext(), BearingActivity.class);\n             waitingForDataRegistry.waitForData(getFormEntryPrompt().getIndex());\n-            ((Activity) getContext()).startActivityForResult(i,\n-                    RequestCodes.BEARING_CAPTURE);\n+            ((Activity) getContext()).startActivityForResult(intent, RequestCodes.BEARING_CAPTURE);\n         } else {\n-            getBearingButton.setEnabled(false);\n+            binding.bearingButton.setEnabled(false);\n             ToastUtils.showLongToast(R.string.bearing_lack_of_sensors);\n-            answer.setBackground(textBackground);\n-            answer.setFocusable(true);\n-            answer.setFocusableInTouchMode(true);\n-            answer.requestFocus();\n+            binding.answerText.setBackground(textBackground);", "originalCommit": "fe470d714ef9ea95aac4ad67ca86d9a9840ebd3e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ4MDExMw==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477480113", "bodyText": "Now we use this only in one place so it doesn't make sense to keep the field we can just use the method which initializes it (areSensorsAvailable()).", "author": "grzesiek2010", "createdAt": "2020-08-26T17:48:54Z", "path": "collect_app/src/main/java/org/odk/collect/android/widgets/BearingWidget.java", "diffHunk": "@@ -18,179 +18,125 @@\n import android.app.Activity;\n import android.content.Context;\n import android.content.Intent;\n-import android.graphics.drawable.Drawable;\n import android.hardware.Sensor;\n import android.hardware.SensorManager;\n-import android.text.Editable;\n-import android.text.InputType;\n-import android.text.TextWatcher;\n-import android.text.method.DigitsKeyListener;\n import android.util.TypedValue;\n-import android.widget.Button;\n+import android.view.View;\n import android.widget.EditText;\n-import android.widget.LinearLayout;\n-import android.widget.TableLayout;\n \n import org.javarosa.core.model.data.IAnswerData;\n import org.javarosa.core.model.data.StringData;\n+import org.javarosa.form.api.FormEntryPrompt;\n import org.odk.collect.android.R;\n import org.odk.collect.android.activities.BearingActivity;\n+import org.odk.collect.android.databinding.BearingWidgetAnswerBinding;\n import org.odk.collect.android.formentry.questions.QuestionDetails;\n-import org.odk.collect.android.formentry.questions.WidgetViewUtils;\n import org.odk.collect.android.utilities.ToastUtils;\n+import org.odk.collect.android.utilities.UiUtils;\n import org.odk.collect.android.widgets.interfaces.BinaryDataReceiver;\n-import org.odk.collect.android.widgets.interfaces.ButtonClickListener;\n import org.odk.collect.android.widgets.utilities.WaitingForDataRegistry;\n \n-import static org.odk.collect.android.formentry.questions.WidgetViewUtils.createSimpleButton;\n import static org.odk.collect.android.utilities.ApplicationConstants.RequestCodes;\n \n /**\n  * BearingWidget is the widget that allows the user to get a compass heading.\n- *\n- * @author Carl Hartung (chartung@nafundi.com)\n  */\n @SuppressLint(\"ViewConstructor\")\n-public class BearingWidget extends QuestionWidget implements BinaryDataReceiver, ButtonClickListener {\n-    final Button getBearingButton;\n-    private final boolean isSensorAvailable;\n-    final EditText answer;\n-    private final Drawable textBackground;\n+public class BearingWidget extends QuestionWidget implements BinaryDataReceiver {\n+    BearingWidgetAnswerBinding binding;\n+\n+    private final boolean areSensorsAvailable;", "originalCommit": "6c0aec9def09139713ec283d371300c65d6e772e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ4NDM4OA==", "url": "https://github.com/getodk/collect/pull/4042#discussion_r477484388", "bodyText": "Oh sorry right", "author": "SaumiaSinghal", "createdAt": "2020-08-26T17:56:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3NzQ4MDExMw=="}], "type": "inlineReview"}, {"oid": "7574c72b0d1af3584cb5b16adc3ec6209ffb686c", "url": "https://github.com/getodk/collect/commit/7574c72b0d1af3584cb5b16adc3ec6209ffb686c", "message": "update widget button and answerText style", "committedDate": "2020-09-08T06:19:29Z", "type": "forcePushed"}, {"oid": "76349deee697ac68626f2f20e56ebfed4635bd93", "url": "https://github.com/getodk/collect/commit/76349deee697ac68626f2f20e56ebfed4635bd93", "message": "add unit tests", "committedDate": "2020-09-30T17:36:46Z", "type": "commit"}, {"oid": "e2d60d12a48938dcb0bd8e688bf71a0fdf0aa60e", "url": "https://github.com/getodk/collect/commit/e2d60d12a48938dcb0bd8e688bf71a0fdf0aa60e", "message": "create bearing_widgte_answer.xml and code refactor", "committedDate": "2020-09-30T17:38:18Z", "type": "commit"}, {"oid": "ab107cd916f231513295f954ee7b680bda73e0b6", "url": "https://github.com/getodk/collect/commit/ab107cd916f231513295f954ee7b680bda73e0b6", "message": "code refactor", "committedDate": "2020-09-30T17:38:24Z", "type": "commit"}, {"oid": "45d16279b152c0562be2ae4f27488a0d276be4a1", "url": "https://github.com/getodk/collect/commit/45d16279b152c0562be2ae4f27488a0d276be4a1", "message": "minor refactor", "committedDate": "2020-09-30T17:38:24Z", "type": "commit"}, {"oid": "674cff0cf33124cf8f64df54d750479147e66dd6", "url": "https://github.com/getodk/collect/commit/674cff0cf33124cf8f64df54d750479147e66dd6", "message": "update widget button and answerText style", "committedDate": "2020-09-30T17:38:24Z", "type": "commit"}, {"oid": "674cff0cf33124cf8f64df54d750479147e66dd6", "url": "https://github.com/getodk/collect/commit/674cff0cf33124cf8f64df54d750479147e66dd6", "message": "update widget button and answerText style", "committedDate": "2020-09-30T17:38:24Z", "type": "forcePushed"}]}