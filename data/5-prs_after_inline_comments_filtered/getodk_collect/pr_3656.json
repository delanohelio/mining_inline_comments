{"pr_number": 3656, "pr_title": "Add button for creating inline repeat", "pr_createdAt": "2020-02-27T17:18:55Z", "pr_url": "https://github.com/getodk/collect/pull/3656", "timeline": [{"oid": "547382d5f7be10f580e143e614798d081fb823ba", "url": "https://github.com/getodk/collect/commit/547382d5f7be10f580e143e614798d081fb823ba", "message": "Make sure options menu is always up to date", "committedDate": "2020-02-29T17:30:52Z", "type": "forcePushed"}, {"oid": "30f4fc799fd4cea1ae27ad5d3e46788521809b0f", "url": "https://github.com/getodk/collect/commit/30f4fc799fd4cea1ae27ad5d3e46788521809b0f", "message": "Handle JavaRosaException when stepping to next event", "committedDate": "2020-03-05T17:15:55Z", "type": "forcePushed"}, {"oid": "aad9b5ea6c8e5ae062d2acfb8648b849872fd4c2", "url": "https://github.com/getodk/collect/commit/aad9b5ea6c8e5ae062d2acfb8648b849872fd4c2", "message": "Remove unused import", "committedDate": "2020-03-13T11:33:56Z", "type": "forcePushed"}, {"oid": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "url": "https://github.com/getodk/collect/commit/d7b547a592512d4ed2ed5462c35573df3ef3a58a", "message": "Handle JavaRosaException when stepping to next event", "committedDate": "2020-03-26T10:02:00Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIzMjE3OQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398232179", "bodyText": "This is an exceptionally bad name. I guess we just leave it for now since it's not really related to the current changes?", "author": "lognaturel", "createdAt": "2020-03-25T23:29:50Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormEntryMenuDelegate.java", "diffHunk": "@@ -0,0 +1,78 @@\n+package org.odk.collect.android.formentry;\n+\n+import android.content.Context;\n+import android.view.Menu;\n+import android.view.MenuInflater;\n+import android.view.MenuItem;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.logic.FormController;\n+import org.odk.collect.android.preferences.AdminKeys;\n+import org.odk.collect.android.preferences.AdminSharedPreferences;\n+import org.odk.collect.android.preferences.GeneralSharedPreferences;\n+import org.odk.collect.android.utilities.PlayServicesUtil;\n+\n+import static org.odk.collect.android.analytics.AnalyticsEvents.LAUNCH_FORM_WITH_BG_LOCATION;\n+import static org.odk.collect.android.preferences.GeneralKeys.KEY_BACKGROUND_LOCATION;\n+\n+public class FormEntryMenuDelegate {\n+\n+    private final Context context;\n+    private final FormControllerProvider formControllerProvider;\n+\n+    public FormEntryMenuDelegate(Context context, FormControllerProvider formControllerProvider) {\n+        this.context = context;\n+        this.formControllerProvider = formControllerProvider;\n+    }\n+\n+    public void onCreate(MenuInflater menuInflater, Menu menu) {\n+        menuInflater.inflate(R.menu.form_menu, menu);\n+    }\n+\n+    public void onPrepare(Menu menu) {\n+        FormController formController = formControllerProvider.getFormController();\n+\n+        boolean useability;", "originalCommit": "51a3a903bc136087404336db3b035711986ba3d3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTEyNDAxOQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399124019", "bodyText": "haha yeah", "author": "seadowg", "createdAt": "2020-03-27T09:09:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODIzMjE3OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MjA4OA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398242088", "bodyText": "I'm ok with a javarosawrapper package but I'm not sure it belongs in formentry since FormController is also used for form discovery. Maybe the package should be top-level? Or maybe it's fine in formentry since that's the bulk of what it's for?\n@grzesiek2010?", "author": "lognaturel", "createdAt": "2020-03-26T00:00:19Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/FormNavigationTestCase.java", "diffHunk": "@@ -22,7 +22,7 @@\n import org.junit.runners.Parameterized;\n import org.junit.runners.Parameterized.Parameters;\n import org.odk.collect.android.listeners.FormLoaderListener;\n-import org.odk.collect.android.logic.FormController;\n+import org.odk.collect.android.formentry.javarosawrapper.FormController;", "originalCommit": "99e8c59cc75a53d07f5220cdc7a0b8cfe9db44bd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MDg0Nw==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399260847", "bodyText": "I'm happy with top level if everyone agrees?", "author": "seadowg", "createdAt": "2020-03-27T13:24:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MjA4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MzU5NQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398243595", "bodyText": "It'd be great to get a comment here saying that the implementation and tests really should move to JavaRosa.\nI really don't like that these tests are based on the toString. Maybe we can discuss alternatives when we make the move. I'm thinking we can add test-only functionality to build a FormIndex from a string representation (similar to Scenario.getRef) and do the comparison with that.", "author": "lognaturel", "createdAt": "2020-03-26T00:05:25Z", "path": "collect_app/src/test/java/org/odk/collect/android/formentry/javarosawrapper/FormControllerTest.java", "diffHunk": "@@ -0,0 +1,157 @@\n+package org.odk.collect.android.formentry.javarosawrapper;\n+\n+import com.google.common.io.Files;\n+\n+import org.javarosa.form.api.FormEntryController;\n+import org.javarosa.form.api.FormEntryModel;\n+import org.javarosa.xform.util.XFormUtils;\n+import org.junit.Test;\n+\n+import java.io.ByteArrayInputStream;\n+import java.io.File;\n+\n+import static org.hamcrest.MatcherAssert.assertThat;\n+import static org.hamcrest.Matchers.equalTo;\n+\n+public class FormControllerTest {", "originalCommit": "edc993f95014c818056c639cbdfcea254558fbae", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MTMzNg==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399261336", "bodyText": "I could create an issue instead?", "author": "seadowg", "createdAt": "2020-03-27T13:25:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI0MzU5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODI1MDA0NA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398250044", "bodyText": "While improving this comment, your -> you're and lose the last ;", "author": "lognaturel", "createdAt": "2020-03-26T00:27:30Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/javarosawrapper/FormIndexUtils.java", "diffHunk": "@@ -11,7 +14,7 @@ private FormIndexUtils() {\n     }\n \n     /**\n-     * used to go up one level in the formIndex. That is, if you're at 5_0, 1 (the second question\n+     * Used to find one level up from the formIndex. That is, if you're at 5_0, 1 (the second question\n      * in a repeating group), this method will return a FormIndex of 5_0 (the start of the repeating\n      * group). If your at index 16 or 5_0, this will return null;", "originalCommit": "063a5d4788a993700aea7f11a73522a7a71d988f", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY1OTMxMA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398659310", "bodyText": "Would be better not to use toString here. Can you compare actual references?", "author": "lognaturel", "createdAt": "2020-03-26T15:22:47Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/javarosawrapper/FormController.java", "diffHunk": "@@ -892,6 +879,21 @@ public int jumpToIndex(FormIndex index) {\n         return formEntryController.jumpToIndex(index);\n     }\n \n+    /**\n+     * Jumps to the next prompt for a repeated instance of the group referenced by the current FormIndex.\n+     */\n+    public void jumpToNewRepeatPrompt() {\n+        FormIndex repeatGroupIndex = getRepeatGroupIndex(getFormIndex(), getFormDef());\n+        String repeatRef = repeatGroupIndex.getReference().toString(false);", "originalCommit": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MTYyNQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399261625", "bodyText": "Will give this a try", "author": "seadowg", "createdAt": "2020-03-27T13:26:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY1OTMxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM0NDA5Ng==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r400344096", "bodyText": "Hmm couldn't get it working with references but worked out a solution using depth that passed all the tests. Makes sense to me but maybe there is an edge case I haven't though of...", "author": "seadowg", "createdAt": "2020-03-30T16:52:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODY1OTMxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NDUzMA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398784530", "bodyText": "Why lose the null check here? It shouldn't be possible for the form controller to be null here, is that why? I think it may still somehow happen and it seems better to fail by nothing happening than by crashing?", "author": "lognaturel", "createdAt": "2020-03-26T18:07:16Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -1446,38 +1444,42 @@ private void showNextView() {\n                 return;\n             }\n \n-            formController.getAuditEventLogger().flush();    // Close events waiting for an end time\n-\n-            switch (event) {\n-                case FormEntryController.EVENT_QUESTION:\n-                case FormEntryController.EVENT_GROUP:\n-                    // create a savepoint\n-                    nonblockingCreateSavePointData();\n-                    next = createView(event, true);\n-                    showView(next, AnimationType.RIGHT);\n-                    break;\n-                case FormEntryController.EVENT_END_OF_FORM:\n-                case FormEntryController.EVENT_REPEAT:\n-                case EVENT_PROMPT_NEW_REPEAT:\n-                    next = createView(event, true);\n-                    showView(next, AnimationType.RIGHT);\n-                    break;\n-                case FormEntryController.EVENT_REPEAT_JUNCTURE:\n-                    Timber.i(\"Repeat juncture: %s\", formController.getFormIndex().getReference());\n-                    // skip repeat junctures until we implement them\n-                    break;\n-                default:\n-                    Timber.w(\"JavaRosa added a new EVENT type and didn't tell us... shame on them.\");\n-                    break;\n-            }\n+            animateToNextView();\n         } catch (JavaRosaException e) {\n             Timber.d(e);\n             createErrorDialog(e.getCause().getMessage(), DO_NOT_EXIT);\n         }\n     }\n \n-    private boolean saveBeforeMovingForward(FormController formController) {\n-        if (formController != null && formController.currentPromptIsQuestion()) {\n+    private void animateToNextView() {\n+        int event = getFormController().getEvent();\n+\n+        switch (event) {\n+            case FormEntryController.EVENT_QUESTION:\n+            case FormEntryController.EVENT_GROUP:\n+                // create a savepoint\n+                nonblockingCreateSavePointData();\n+                showView(createView(event, true), AnimationType.RIGHT);\n+                break;\n+            case FormEntryController.EVENT_END_OF_FORM:\n+            case FormEntryController.EVENT_REPEAT:\n+            case EVENT_PROMPT_NEW_REPEAT:\n+                showView(createView(event, true), AnimationType.RIGHT);\n+                break;\n+            case FormEntryController.EVENT_REPEAT_JUNCTURE:\n+                Timber.i(\"Repeat juncture: %s\", getFormController().getFormIndex().getReference());\n+                // skip repeat junctures until we implement them\n+                break;\n+            default:\n+                Timber.w(\"JavaRosa added a new EVENT type and didn't tell us... shame on them.\");\n+                break;\n+        }\n+    }\n+\n+    private boolean saveBeforeNextView(FormController formController) {\n+        formController.getAuditEventLogger().flush();    // Close events waiting for an end time\n+\n+        if (formController.currentPromptIsQuestion()) {", "originalCommit": "ca889168166064bfc4b2eeb2abd803d776f118ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2Mjg1NA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399262854", "bodyText": "Yeah I think I need to have a look through these. I really don't like that so many of these methods have to deal with the nullability though. What I might do is try and push that decision as early as I can and use @nonnull and @nullable to make sure it's clear when we have to check.", "author": "seadowg", "createdAt": "2020-03-27T13:28:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NDUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTUxOTcyMw==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399519723", "bodyText": "Yes, I agree with that general approach. Perhaps it doesn't need to be done here but then I might suggest keeping the existing null checks. It would be really ideal if after the form is expected to be loaded there was no way for the form controller to be null. Even better, as we've previously discussed, would be if the form controller could never be null and instead its functionality changed whether or not a form was active but that's further out.", "author": "lognaturel", "createdAt": "2020-03-27T20:24:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NDUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTQ4ODk5NA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r401488994", "bodyText": "So for the moment I'm just going to go with the FormController being @Nullable in all the ViewModel classes that depend on it and have null check guards on all the actions. There is definitely something better on the tip of my tongue - maybe the ViewModels shouldn't be created until after the FormController is available or maybe all the ViewModels should talk to some loader/repo that gives access to the FormController as a Future. I think the right\u2122\ufe0f solution is going to need us to move \"form loading\" away from the FormEntryActivity so best to leave it right now.\nThe @Nullable annotation gives us some safety here but ideally we'd write tests for ALL the null cases. I'm very tempted to jump to Kotlin here if I'm being frank as we'd get compile checks and also much nicer sugar for dealing with the nulls here. That would definitely be a different PR but I think it's worth bringing up to get the discussion going.", "author": "seadowg", "createdAt": "2020-04-01T09:46:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NDUzMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk2MzQwNw==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r401963407", "bodyText": "All sound good.", "author": "lognaturel", "createdAt": "2020-04-01T23:13:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NDUzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NzA2MA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398787060", "bodyText": "Why lose the null checks here?", "author": "lognaturel", "createdAt": "2020-03-26T18:10:07Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/saving/FormSaveViewModel.java", "diffHunk": "@@ -50,9 +50,7 @@ public void formLoaded(FormController formController) {\n     }\n \n     public void editingForm() {\n-        if (formController.getAuditEventLogger() != null) {\n-            formController.getAuditEventLogger().setEditing(true);\n-        }\n+        formController.getAuditEventLogger().setEditing(true);", "originalCommit": "c4a938f324be9da6e90b4d1fb5e56daaf71fab8d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2MzQxNA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399263414", "bodyText": "Same as the comment before. I don't think this method should be able to be called before the formController is set but I'll look into it.", "author": "seadowg", "createdAt": "2020-03-27T13:28:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc4NzA2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5MDg3OA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398790878", "bodyText": "This is a little overly paranoid but did you do a quick check that compareTo does what you want/expect? It would be its first time being used. I just opened it and looked and it seems fine but I think it would be good for one of us to do a slightly deeper think-through.", "author": "lognaturel", "createdAt": "2020-03-26T18:16:06Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormIndexAnimationHandler.java", "diffHunk": "@@ -0,0 +1,41 @@\n+package org.odk.collect.android.formentry;\n+\n+import org.javarosa.core.model.FormIndex;\n+\n+public class FormIndexAnimationHandler {\n+\n+    private final Listener listener;\n+    private FormIndex lastIndex;\n+\n+    public FormIndexAnimationHandler(Listener listener) {\n+        this.listener = listener;\n+    }\n+\n+    public void handle(FormIndex index) {\n+        if (lastIndex == null) {\n+            listener.refreshCurrentView();\n+        } else {\n+            if (index.compareTo(lastIndex) > 0) {", "originalCommit": "be5170564da7e498c39db694b2c421bc0c7de89f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2NDAwMA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399264000", "bodyText": "I mean it seems like it works given all the things I've thrown at it but I think we should play around with it in QA a bunch.", "author": "seadowg", "createdAt": "2020-03-27T13:29:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5MDg3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODc5MzY0Mw==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398793643", "bodyText": "groupLabel?", "author": "lognaturel", "createdAt": "2020-03-26T18:20:37Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/repeats/AddRepeatDialog.java", "diffHunk": "@@ -15,21 +14,21 @@\n \n     private AddRepeatDialog() {}\n \n-    public static void show(Context context, FormController formController, Listener listener) {\n+    public static void show(Context context, String groupName, Listener listener) {", "originalCommit": "59281fa94d10da0a5e543fd530ac7c046385a7d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwOTM5Nw==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398809397", "bodyText": "How about making the form have a question before the repeat and testing that there's no button on that first question and that it appears on swipe? Or do you think the Robolectric test with mock that sets whether or not the current question is a repeat is sufficient for that?", "author": "lognaturel", "createdAt": "2020-03-26T18:44:44Z", "path": "collect_app/src/androidTest/java/org/odk/collect/android/formentry/AddRepeatTest.java", "diffHunk": "@@ -0,0 +1,97 @@\n+package org.odk.collect.android.formentry;\n+\n+import android.Manifest;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+import androidx.test.rule.ActivityTestRule;\n+import androidx.test.rule.GrantPermissionRule;\n+\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.rules.RuleChain;\n+import org.junit.runner.RunWith;\n+import org.odk.collect.android.activities.MainMenuActivity;\n+import org.odk.collect.android.support.CopyFormRule;\n+import org.odk.collect.android.support.ResetStateRule;\n+import org.odk.collect.android.support.pages.EndOfFormPage;\n+import org.odk.collect.android.support.pages.FormEntryPage;\n+import org.odk.collect.android.support.pages.MainMenuPage;\n+\n+@RunWith(AndroidJUnit4.class)\n+public class AddRepeatTest {\n+\n+    private static final String FORM = \"one-question-repeat.xml\";", "originalCommit": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2NDkxOQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399264919", "bodyText": "Might see if I can get that into the FormController tests instead as I'd like to avoid setting up anything other than the simplest cases in the \"feature tests\". I'll review the coverage here for sure.", "author": "seadowg", "createdAt": "2020-03-27T13:30:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwOTM5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDkxMzc1MA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r400913750", "bodyText": "Sorry I completely misinterpreted this when I read it on Friday. Basically you're suggesting a test for checking the options menu is setup correctly (and whether invalidateOptionsMenu is getting called in the right places). I'll review the coverage and maybe do some mutation testing to see if we're got some blind spots.", "author": "seadowg", "createdAt": "2020-03-31T13:29:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwOTM5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTA0OTY2OA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r401049668", "bodyText": "Yeah after playing around with it feels like we're pretty well covered. I've realised looking at it that we had extra calls to invalidateOptionsMenu as we really should just call it every time we call showView.\nAlso looking at this made me realize it would be nice to pull out some a view (holder) that can encapsulate createView and showView as it would remove a lot of logic from FormEntryAcitivty and would let us test things like \"every time we should a view we do X\". I'll add this to the list of follow ups that I'll make issues for.", "author": "seadowg", "createdAt": "2020-03-31T16:28:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgwOTM5Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxMTg5NQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398811895", "bodyText": "File a good first issue?", "author": "lognaturel", "createdAt": "2020-03-26T18:48:46Z", "path": "collect_app/src/main/java/org/odk/collect/android/activities/FormEntryActivity.java", "diffHunk": "@@ -965,72 +988,52 @@ private void saveFileAnswer(Object media) {\n      * out of sync due to dialogs and restarts caused by screen orientation\n      * changes, so they're resynchronized here.\n      */\n+    @Override\n     public void refreshCurrentView() {\n         int event = getFormController().getEvent();\n \n         View current = createView(event, false);\n         showView(current, AnimationType.FADE);\n+\n+        formIndexAnimationHandler.setLastIndex(getFormController().getFormIndex());\n     }\n \n     @Override\n     public boolean onCreateOptionsMenu(Menu menu) {\n-        getMenuInflater().inflate(R.menu.form_menu, menu);\n+        optionsMenuDelegate.onCreateOptionsMenu(getMenuInflater(), menu);\n         return super.onCreateOptionsMenu(menu);\n     }\n \n     @Override\n     public boolean onPrepareOptionsMenu(Menu menu) {\n         super.onPrepareOptionsMenu(menu);\n-\n-        boolean useability;\n-\n-        useability = (boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_SAVE_MID);\n-\n-        menu.findItem(R.id.menu_save).setVisible(useability).setEnabled(useability);\n-\n-        useability = (boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_JUMP_TO);\n-\n-        menu.findItem(R.id.menu_goto).setVisible(useability)\n-                .setEnabled(useability);\n-\n-        FormController formController = getFormController();\n-\n-        useability = (boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_CHANGE_LANGUAGE)\n-                && (formController != null)\n-                && formController.getLanguages() != null\n-                && formController.getLanguages().length > 1;\n-\n-        menu.findItem(R.id.menu_languages).setVisible(useability)\n-                .setEnabled(useability);\n-\n-        useability = (boolean) AdminSharedPreferences.getInstance().get(AdminKeys.KEY_ACCESS_SETTINGS);\n-\n-        menu.findItem(R.id.menu_preferences).setVisible(useability)\n-                .setEnabled(useability);\n+        optionsMenuDelegate.onPrepareOptionsMenu(menu);\n \n         if (getFormController() != null && getFormController().currentFormCollectsBackgroundLocation()\n                 && PlayServicesUtil.isGooglePlayServicesAvailable(this)) {\n-            MenuItem backgroundLocation = menu.findItem(R.id.track_location);\n-            backgroundLocation.setVisible(true);\n-            backgroundLocation.setChecked(GeneralSharedPreferences.getInstance().getBoolean(KEY_BACKGROUND_LOCATION, true));\n-\n             analytics.logEvent(LAUNCH_FORM_WITH_BG_LOCATION, getFormController().getCurrentFormIdentifierHash());\n         }\n-\n         return true;\n     }\n \n     @Override\n     public boolean onOptionsItemSelected(MenuItem item) {\n+        if (optionsMenuDelegate.onOptionsItemSelected(item)) {\n+            return true;\n+        }\n+\n+        // These actions should move into the `FormEntryMenuDelegate`", "originalCommit": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2NTU0Mg==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399265542", "bodyText": "Yeah I'll follow up with issues. I put a list in the description.", "author": "seadowg", "createdAt": "2020-03-27T13:31:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxMTg5NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNDUyMQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398814521", "bodyText": "How about also logging a form hash so we can differentiate between one organization training staff to use the button vs. lots of people trying it out.", "author": "lognaturel", "createdAt": "2020-03-26T18:52:46Z", "path": "collect_app/src/main/java/org/odk/collect/android/analytics/AnalyticsEvents.java", "diffHunk": "@@ -1,9 +1,17 @@\n package org.odk.collect.android.analytics;\n \n public class AnalyticsEvents {\n+\n     private AnalyticsEvents() {\n+\n     }\n \n+    /**\n+     * Used to measure how popular different methods of adding repeats are. The \"action\" should\n+     * describe the way the repeat was added.", "originalCommit": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNjAyNA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398816024", "bodyText": "You need this indirection here because the controller may not be set when this is instantiated?", "author": "lognaturel", "createdAt": "2020-03-26T18:54:23Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormEntryMenuDelegate.java", "diffHunk": "@@ -0,0 +1,125 @@\n+package org.odk.collect.android.formentry;\n+\n+import android.content.Intent;\n+import android.view.Menu;\n+import android.view.MenuInflater;\n+import android.view.MenuItem;\n+\n+import androidx.appcompat.app.AppCompatActivity;\n+import androidx.lifecycle.ViewModelProviders;\n+\n+import org.odk.collect.android.R;\n+import org.odk.collect.android.formentry.backgroundlocation.BackgroundLocationViewModel;\n+import org.odk.collect.android.formentry.javarosawrapper.FormController;\n+import org.odk.collect.android.formentry.questions.AnswersProvider;\n+import org.odk.collect.android.formentry.saving.FormSaveViewModel;\n+import org.odk.collect.android.preferences.AdminKeys;\n+import org.odk.collect.android.preferences.AdminSharedPreferences;\n+import org.odk.collect.android.preferences.GeneralSharedPreferences;\n+import org.odk.collect.android.preferences.PreferencesActivity;\n+import org.odk.collect.android.utilities.MenuDelegate;\n+import org.odk.collect.android.utilities.PlayServicesUtil;\n+\n+import static org.odk.collect.android.preferences.GeneralKeys.KEY_BACKGROUND_LOCATION;\n+\n+public class FormEntryMenuDelegate implements MenuDelegate {\n+\n+    private final AppCompatActivity context;\n+    private final FormControllerProvider formControllerProvider;", "originalCommit": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2NTkyMA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399265920", "bodyText": "Yup!", "author": "seadowg", "createdAt": "2020-03-27T13:32:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNjAyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNzMzMQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r398817331", "bodyText": "I see you have Robolectric tests around a repeat being a field list. Did you try it with a real form? I can't even remember what the intended behavior is. Does the current behavior make sense? How about adding a connected test with a real form for this one. It's the kind of thing that's not super common and that I think we could easily break and not notice.", "author": "lognaturel", "createdAt": "2020-03-26T18:56:38Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormEntryViewModel.java", "diffHunk": "@@ -0,0 +1,110 @@\n+package org.odk.collect.android.formentry;\n+\n+import androidx.annotation.NonNull;\n+import androidx.annotation.Nullable;\n+import androidx.lifecycle.LiveData;\n+import androidx.lifecycle.MutableLiveData;\n+import androidx.lifecycle.ViewModel;\n+import androidx.lifecycle.ViewModelProvider;\n+\n+import org.javarosa.core.model.FormIndex;\n+import org.odk.collect.android.analytics.Analytics;\n+import org.odk.collect.android.exception.JavaRosaException;\n+import org.odk.collect.android.formentry.javarosawrapper.FormController;\n+\n+import static org.odk.collect.android.analytics.AnalyticsEvents.ADD_REPEAT;\n+\n+public class FormEntryViewModel extends ViewModel {\n+\n+    private FormController formController;\n+\n+    private final Analytics analytics;\n+    private final MutableLiveData<String> error = new MutableLiveData<>(null);\n+\n+    @Nullable\n+    private FormIndex jumpBackIndex;\n+\n+    public FormEntryViewModel(Analytics analytics) {\n+        this.analytics = analytics;\n+    }\n+\n+    public void formLoaded(FormController formController) {\n+        this.formController = formController;\n+    }\n+\n+    public FormIndex getCurrentIndex() {\n+        return getFormController().getFormIndex();\n+    }\n+\n+    public LiveData<String> getError() {\n+        return error;\n+    }\n+\n+    public void promptForNewRepeat() {\n+        FormIndex index = getFormController().getFormIndex();\n+        jumpBackIndex = index;\n+\n+        getFormController().jumpToNewRepeatPrompt();\n+    }\n+\n+    public void addRepeat(boolean fromPrompt) {\n+        if (jumpBackIndex != null) {\n+            jumpBackIndex = null;\n+            analytics.logEvent(ADD_REPEAT, \"Inline\");\n+        } else if (fromPrompt) {\n+            analytics.logEvent(ADD_REPEAT, \"Prompt\");\n+        } else {\n+            analytics.logEvent(ADD_REPEAT, \"Hierarchy\");\n+        }\n+\n+        getFormController().newRepeat();\n+\n+        if (!getFormController().indexIsInFieldList()) {", "originalCommit": "d7b547a592512d4ed2ed5462c35573df3ef3a58a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5OTI2NjQ2NA==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r399266464", "bodyText": "Yeah that might be worth a connected test. Again, I'll review the coverage and see how I feel.", "author": "seadowg", "createdAt": "2020-03-27T13:33:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5ODgxNzMzMQ=="}], "type": "inlineReview"}, {"oid": "a0c78be65e91b44d719f09adef722b3211576d17", "url": "https://github.com/getodk/collect/commit/a0c78be65e91b44d719f09adef722b3211576d17", "message": "Make sure RequiresFormController classes have nullable FormController", "committedDate": "2020-04-01T12:07:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3MDI4Mg==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r401970282", "bodyText": "I like the use of depth here! I can really visualize how you go into a deeper part of the form within the repeat, maybe even deeper into nested repeats and then you reach the same depth at the new repeat event.", "author": "lognaturel", "createdAt": "2020-04-01T23:35:04Z", "path": "collect_app/src/main/java/org/odk/collect/android/javarosawrapper/FormController.java", "diffHunk": "@@ -884,13 +884,12 @@ public int jumpToIndex(FormIndex index) {\n      */\n     public void jumpToNewRepeatPrompt() {\n         FormIndex repeatGroupIndex = getRepeatGroupIndex(getFormIndex(), getFormDef());\n-        String repeatRef = repeatGroupIndex.getReference().toString(false);\n-        String testRef = \"\";\n+        Integer depth = repeatGroupIndex.getDepth();", "originalCommit": "f80801f868b423fae5ccaf7a2c53d14a1aac81e6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3MDYxOQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r401970619", "bodyText": "Not necessary?", "author": "lognaturel", "createdAt": "2020-04-01T23:36:17Z", "path": "collect_app/src/main/java/org/odk/collect/android/formentry/FormEntryViewModel.java", "diffHunk": "@@ -71,14 +71,14 @@ public void addRepeat(boolean fromPrompt) {\n     public void cancelRepeatPrompt() {\n         analytics.logEvent(ADD_REPEAT, \"InlineDecline\");\n \n-        FormController formController = getFormController();\n+        FormController formController = this.formController;", "originalCommit": "767801ef77d0e783adeba4a4aa9cafd35113d0a5", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjEyODE0NQ==", "url": "https://github.com/getodk/collect/pull/3656#discussion_r402128145", "bodyText": "haha yeah. I'd imagine AS probably flagged that to me as well!", "author": "seadowg", "createdAt": "2020-04-02T08:10:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTk3MDYxOQ=="}], "type": "inlineReview"}, {"oid": "af286fac69e88e2f5be0a5f59e9be17b3daf5f02", "url": "https://github.com/getodk/collect/commit/af286fac69e88e2f5be0a5f59e9be17b3daf5f02", "message": "Fix field-list repeat test", "committedDate": "2020-04-08T18:23:07Z", "type": "forcePushed"}, {"oid": "b57953f1bd75b55e2d138d607f6b86aa33fb45b4", "url": "https://github.com/getodk/collect/commit/b57953f1bd75b55e2d138d607f6b86aa33fb45b4", "message": "Add plus button for adding repeat inline", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "1bf1d86cd6af92ee67bb1a5ce882592c9d9bf356", "url": "https://github.com/getodk/collect/commit/1bf1d86cd6af92ee67bb1a5ce882592c9d9bf356", "message": "Only show add repeat button in repeat groups", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "fd8b0d1b93d5af6c36d8c87b51aebdcefa8ed617", "url": "https://github.com/getodk/collect/commit/fd8b0d1b93d5af6c36d8c87b51aebdcefa8ed617", "message": "Make sure new repeat button always adds a new repeat to end of the series", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "83f01db68e6897426a088c9b8adb45f17b4e41ab", "url": "https://github.com/getodk/collect/commit/83f01db68e6897426a088c9b8adb45f17b4e41ab", "message": "Use FormControllerProvider in FormSaveViewModel", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "84fa7fad34b2bf643c24ab1ac5d87377c3a4e563", "url": "https://github.com/getodk/collect/commit/84fa7fad34b2bf643c24ab1ac5d87377c3a4e563", "message": "Move add repeat button logic to viewmodel", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "a319ba9ca65714733ca7fdac6f9aec0ee84096e8", "url": "https://github.com/getodk/collect/commit/a319ba9ca65714733ca7fdac6f9aec0ee84096e8", "message": "Move jump to repeat prompt logic to formcontroller", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "c7a0cadcc396c89e4207d6bf0e04026a066e4091", "url": "https://github.com/getodk/collect/commit/c7a0cadcc396c89e4207d6bf0e04026a066e4091", "message": "Use getPreviousLevel instead of stepIndexOut", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "d1e08804b0e13fc5e7268143d3576ff9c773bd20", "url": "https://github.com/getodk/collect/commit/d1e08804b0e13fc5e7268143d3576ff9c773bd20", "message": "Move FormController to javarosa package", "committedDate": "2020-04-08T21:34:44Z", "type": "commit"}, {"oid": "90fd3f27b09dfb54cf9c764989b7fc2441ee97c5", "url": "https://github.com/getodk/collect/commit/90fd3f27b09dfb54cf9c764989b7fc2441ee97c5", "message": "Add test for jumpToNewRepeatPrompt", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "d1e336a603c5784c9c05687ea270c745769edcbd", "url": "https://github.com/getodk/collect/commit/d1e336a603c5784c9c05687ea270c745769edcbd", "message": "Add analytics for form entry repeat creation", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "24f914e0d806f2f8da78599ce161fcf07e8e2d46", "url": "https://github.com/getodk/collect/commit/24f914e0d806f2f8da78599ce161fcf07e8e2d46", "message": "Remove prompt from hierarchy add repeat flow", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "a13f13ee76d88ebbaf9b1117723704034592299d", "url": "https://github.com/getodk/collect/commit/a13f13ee76d88ebbaf9b1117723704034592299d", "message": "Add hierarchy add repeat analytics event", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "67777095c46ba181d035df109c67fa3c321b211c", "url": "https://github.com/getodk/collect/commit/67777095c46ba181d035df109c67fa3c321b211c", "message": "Add screen update to addRepeat", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "3c6abd2620549694699a66e9b7314f3a2e260835", "url": "https://github.com/getodk/collect/commit/3c6abd2620549694699a66e9b7314f3a2e260835", "message": "Make sure to not to call showNextView when resuming activity", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "6d04ac12fc49a95a4d53edaeadde1c01a9f5c4e1", "url": "https://github.com/getodk/collect/commit/6d04ac12fc49a95a4d53edaeadde1c01a9f5c4e1", "message": "Handle nested repeats properly", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "f973799867552c2aa004b575de487cb15c86cec5", "url": "https://github.com/getodk/collect/commit/f973799867552c2aa004b575de487cb15c86cec5", "message": "Move addRepeat call to FormEntryMenuDelegate", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "939efc1a2ec795d3ee839a31a763a2716670ba11", "url": "https://github.com/getodk/collect/commit/939efc1a2ec795d3ee839a31a763a2716670ba11", "message": "Save answers before adding repeat inline", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "572d66c497c4467372583c6c20cf84e516212a39", "url": "https://github.com/getodk/collect/commit/572d66c497c4467372583c6c20cf84e516212a39", "message": "Stop using FormControllerProvider in ViewModels to avoidn potential memory leaks", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "8e4e93bfc74cb9c8a234a59da4742693571d1a62", "url": "https://github.com/getodk/collect/commit/8e4e93bfc74cb9c8a234a59da4742693571d1a62", "message": "Stop using LiveData to call `refreshCurrentView` for the moment\n\nIt feels like this introduces too much risk into this changeset. I'm leaving\nthe mechanism in so we can expand on it.", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "1cb25deef55940e373330243868135652b14ca34", "url": "https://github.com/getodk/collect/commit/1cb25deef55940e373330243868135652b14ca34", "message": "Add correct animations for repeat actions back in", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "ad01d3c6a4256eff35d31de3ffd2abac7e0363fd", "url": "https://github.com/getodk/collect/commit/ad01d3c6a4256eff35d31de3ffd2abac7e0363fd", "message": "Fix order of audit flushing breaking track changes reason", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "7cf041add4b0b14fef66979aaf94068173527736", "url": "https://github.com/getodk/collect/commit/7cf041add4b0b14fef66979aaf94068173527736", "message": "Pull out add repeat analytics event as constant", "committedDate": "2020-04-08T21:34:45Z", "type": "commit"}, {"oid": "210e1d5299999d141dc3a4675b632c0d9f8f422f", "url": "https://github.com/getodk/collect/commit/210e1d5299999d141dc3a4675b632c0d9f8f422f", "message": "Make sure options menu is always up to date", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "5b3cb818515d3526c45b0f3cf70f0aa8ae155ae5", "url": "https://github.com/getodk/collect/commit/5b3cb818515d3526c45b0f3cf70f0aa8ae155ae5", "message": "Use handler to deal with form entry swipe animations", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "2593850fa1492a6ec0a74dfff37c6e8f7ab25145", "url": "https://github.com/getodk/collect/commit/2593850fa1492a6ec0a74dfff37c6e8f7ab25145", "message": "Remove unneeded return value", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "11b5f5c494b52b6f0b0105cf84bd9647d7dcc860", "url": "https://github.com/getodk/collect/commit/11b5f5c494b52b6f0b0105cf84bd9647d7dcc860", "message": "Fix broken test setup", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "8208e4e4b2fd8b377a95b5c76a3fd10cf3d4a52c", "url": "https://github.com/getodk/collect/commit/8208e4e4b2fd8b377a95b5c76a3fd10cf3d4a52c", "message": "Use jumpToNewRepeatPrompt in FormHierarchyActivity", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "7a57dc4114718ba060b831716cf828cfd575f0eb", "url": "https://github.com/getodk/collect/commit/7a57dc4114718ba060b831716cf828cfd575f0eb", "message": "Add comments to weirder objects", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "ea38871636de0ce5ca21d0e00e37eba095a74042", "url": "https://github.com/getodk/collect/commit/ea38871636de0ce5ca21d0e00e37eba095a74042", "message": "Revise AddRepeatDialog interface", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "5e4b19c8d534a8721d0f67e3f03d22c615c0e772", "url": "https://github.com/getodk/collect/commit/5e4b19c8d534a8721d0f67e3f03d22c615c0e772", "message": "Move location tracking menu logic to menu delegate", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "170d3848742df3e8fc2aa4d5150a0af786ee5711", "url": "https://github.com/getodk/collect/commit/170d3848742df3e8fc2aa4d5150a0af786ee5711", "message": "Add not about refactoring options item selected", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "174ae82d46c8543ec002ef6c2cfe4dd394ddf9eb", "url": "https://github.com/getodk/collect/commit/174ae82d46c8543ec002ef6c2cfe4dd394ddf9eb", "message": "Handle JavaRosaException when stepping to next event", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "1d25dbcca1967f7eadb60968c036f25e8fea26c7", "url": "https://github.com/getodk/collect/commit/1d25dbcca1967f7eadb60968c036f25e8fea26c7", "message": "Move javarosawrapper", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "54591a0d225834af8f39a0670fa7dceb75083feb", "url": "https://github.com/getodk/collect/commit/54591a0d225834af8f39a0670fa7dceb75083feb", "message": "Improve comment", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "18f5d33641156172e24859df7e5a7132d3ed9ea9", "url": "https://github.com/getodk/collect/commit/18f5d33641156172e24859df7e5a7132d3ed9ea9", "message": "Use depth instead of reference strings for jumpToNewRepeatPrompt", "committedDate": "2020-04-08T21:34:46Z", "type": "commit"}, {"oid": "93f075e03325306295fb5c910b28b40615f21c8a", "url": "https://github.com/getodk/collect/commit/93f075e03325306295fb5c910b28b40615f21c8a", "message": "Improve parameter name", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "3c1e3153d2d41dc4832d00645d7a41cc7ecbb5d7", "url": "https://github.com/getodk/collect/commit/3c1e3153d2d41dc4832d00645d7a41cc7ecbb5d7", "message": "Log form hash id for add repeat event", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "ccaa82861748e0a7437212e1c577949030cefe7a", "url": "https://github.com/getodk/collect/commit/ccaa82861748e0a7437212e1c577949030cefe7a", "message": "Add missing analytics call", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "456274d0f0e9a1b4765e4a501cd6b382935278de", "url": "https://github.com/getodk/collect/commit/456274d0f0e9a1b4765e4a501cd6b382935278de", "message": "Suppres warnings we don't want", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "154858694af5c4d11e4157250f5213815da75bd0", "url": "https://github.com/getodk/collect/commit/154858694af5c4d11e4157250f5213815da75bd0", "message": "Invalidate options menu whenever a new view is shown", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "14519c363d8844a18f57522b852bd84f88b946bb", "url": "https://github.com/getodk/collect/commit/14519c363d8844a18f57522b852bd84f88b946bb", "message": "Make sure field list repeats work", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "4b68ab8c69ab9950bf225d8bc4684e06eb0f679a", "url": "https://github.com/getodk/collect/commit/4b68ab8c69ab9950bf225d8bc4684e06eb0f679a", "message": "Make method of fetching FormController consistent", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "2d15088b9927cc96ae793722899168478ae41356", "url": "https://github.com/getodk/collect/commit/2d15088b9927cc96ae793722899168478ae41356", "message": "Make sure RequiresFormController classes have nullable FormController", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "65df13f5bd1dd0d4a3de8260d3c7c74986f76c6f", "url": "https://github.com/getodk/collect/commit/65df13f5bd1dd0d4a3de8260d3c7c74986f76c6f", "message": "Remove unneeded assignment", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "a39529066a209a0ab1f03445a4a5d168be0e9789", "url": "https://github.com/getodk/collect/commit/a39529066a209a0ab1f03445a4a5d168be0e9789", "message": "Fix field-list repeat test", "committedDate": "2020-04-08T21:34:47Z", "type": "commit"}, {"oid": "a39529066a209a0ab1f03445a4a5d168be0e9789", "url": "https://github.com/getodk/collect/commit/a39529066a209a0ab1f03445a4a5d168be0e9789", "message": "Fix field-list repeat test", "committedDate": "2020-04-08T21:34:47Z", "type": "forcePushed"}, {"oid": "7fc6002226593d4aeb79323a15720e32dd82aece", "url": "https://github.com/getodk/collect/commit/7fc6002226593d4aeb79323a15720e32dd82aece", "message": "Make sure SaveProgressDialogFragment can construct ViewModel", "committedDate": "2020-04-08T21:37:29Z", "type": "commit"}, {"oid": "3a73188c6c4a301edd0cf1f5a324a199096a8ee2", "url": "https://github.com/getodk/collect/commit/3a73188c6c4a301edd0cf1f5a324a199096a8ee2", "message": "Don't show add button when in fixed count repeat", "committedDate": "2020-04-21T14:21:06Z", "type": "commit"}]}