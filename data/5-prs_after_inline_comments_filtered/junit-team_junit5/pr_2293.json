{"pr_number": 2293, "pr_title": "Ignore implicit config params in EngineTestKit by default", "pr_createdAt": "2020-05-10T18:01:39Z", "pr_url": "https://github.com/junit-team/junit5/pull/2293", "timeline": [{"oid": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "url": "https://github.com/junit-team/junit5/commit/c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "message": "Make EngineTestKit ignore implicit config params by default\n\nResolves #2285.", "committedDate": "2020-05-10T18:00:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwNzMxNg==", "url": "https://github.com/junit-team/junit5/pull/2293#discussion_r425707316", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tpublic LauncherDiscoveryRequestBuilder withImplicitConfigurationParameters(\n          \n          \n            \n            \tpublic LauncherDiscoveryRequestBuilder enableImplicitConfigurationParameters(", "author": "marcphilipp", "createdAt": "2020-05-15T10:20:44Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/LauncherDiscoveryRequestBuilder.java", "diffHunk": "@@ -225,18 +226,31 @@ else if (filter instanceof DiscoveryFilter<?>) {\n \t\t}\n \t}\n \n+\t@API(status = API.Status.EXPERIMENTAL, since = \"1.7\")\n+\tpublic LauncherDiscoveryRequestBuilder withImplicitConfigurationParameters(", "originalCommit": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwNzgwNg==", "url": "https://github.com/junit-team/junit5/pull/2293#discussion_r425707806", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tpublic Builder withImplicitConfigurationParameters(boolean useImplicitConfigurationParameters) {\n          \n          \n            \n            \t\tpublic Builder enableImplicitConfigurationParameters(boolean enabled) {", "author": "marcphilipp", "createdAt": "2020-05-15T10:21:40Z", "path": "junit-platform-testkit/src/main/java/org/junit/platform/testkit/engine/EngineTestKit.java", "diffHunk": "@@ -438,6 +439,12 @@ public Builder configurationParameters(Map<String, String> configurationParamete\n \t\t\treturn this;\n \t\t}\n \n+\t\t@API(status = API.Status.EXPERIMENTAL, since = \"1.7\")\n+\t\tpublic Builder withImplicitConfigurationParameters(boolean useImplicitConfigurationParameters) {", "originalCommit": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwODExMA==", "url": "https://github.com/junit-team/junit5/pull/2293#discussion_r425708110", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tBuilder withImplicitLookups(boolean useImplicitLookups) {\n          \n          \n            \n            \t\tBuilder enableImplicitLookups(boolean enabled) {", "author": "marcphilipp", "createdAt": "2020-05-15T10:22:10Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/LauncherConfigurationParameters.java", "diffHunk": "@@ -36,25 +38,157 @@\n \n \tprivate static final Logger logger = LoggerFactory.getLogger(LauncherConfigurationParameters.class);\n \n-\tprivate final Map<String, String> explicitConfigParams;\n-\tprivate final Properties configParamsFromFile;\n+\tstatic Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\tprivate final List<Lookup> lookups;\n \n-\tLauncherConfigurationParameters() {\n-\t\tthis(emptyMap(), ConfigurationParameters.CONFIG_FILE_NAME);\n+\tprivate LauncherConfigurationParameters(List<Lookup> lookups) {\n+\t\tthis.lookups = lookups;\n+\t}\n+\n+\t@Override\n+\tpublic Optional<String> get(String key) {\n+\t\treturn Optional.ofNullable(getProperty(key));\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams) {\n-\t\tthis(configParams, ConfigurationParameters.CONFIG_FILE_NAME);\n+\t@Override\n+\tpublic Optional<Boolean> getBoolean(String key) {\n+\t\treturn get(key).map(Boolean::parseBoolean);\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams, String configFileName) {\n-\t\tPreconditions.notNull(configParams, \"configuration parameters must not be null\");\n-\t\tPreconditions.notBlank(configFileName, \"configFileName must not be null or blank\");\n-\t\tthis.explicitConfigParams = configParams;\n-\t\tthis.configParamsFromFile = fromClasspathResource(configFileName.trim());\n+\t@Override\n+\tpublic int size() {\n+\t\treturn lookups.stream() //\n+\t\t\t\t.mapToInt(Lookup::size) //\n+\t\t\t\t.sum();\n+\t}\n+\n+\tprivate String getProperty(String key) {\n+\t\tPreconditions.notBlank(key, \"key must not be null or blank\");\n+\t\treturn lookups.stream() //\n+\t\t\t\t.map(lookup -> lookup.getValue(key)) //\n+\t\t\t\t.filter(Objects::nonNull) //\n+\t\t\t\t.findFirst() //\n+\t\t\t\t.orElse(null);\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn new ToStringBuilder(this) //\n+\t\t\t\t.append(\"lookups\", lookups) //\n+\t\t\t\t.toString();\n+\t}\n+\n+\tstatic final class Builder {\n+\n+\t\tprivate final Map<String, String> explicitParameters = new HashMap<>();\n+\t\tprivate boolean useImplicitLookups = true;\n+\t\tprivate String configFileName = ConfigurationParameters.CONFIG_FILE_NAME;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\tBuilder withExplicitParameters(Map<String, String> parameters) {\n+\t\t\tPreconditions.notNull(parameters, \"configuration parameters must not be null\");\n+\t\t\texplicitParameters.putAll(parameters);\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\tBuilder withImplicitLookups(boolean useImplicitLookups) {", "originalCommit": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwODUxOA==", "url": "https://github.com/junit-team/junit5/pull/2293#discussion_r425708518", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tBuilder withExplicitParameters(Map<String, String> parameters) {\n          \n          \n            \n            \t\tBuilder explicitParameters(Map<String, String> parameters) {", "author": "marcphilipp", "createdAt": "2020-05-15T10:22:58Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/LauncherConfigurationParameters.java", "diffHunk": "@@ -36,25 +38,157 @@\n \n \tprivate static final Logger logger = LoggerFactory.getLogger(LauncherConfigurationParameters.class);\n \n-\tprivate final Map<String, String> explicitConfigParams;\n-\tprivate final Properties configParamsFromFile;\n+\tstatic Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\tprivate final List<Lookup> lookups;\n \n-\tLauncherConfigurationParameters() {\n-\t\tthis(emptyMap(), ConfigurationParameters.CONFIG_FILE_NAME);\n+\tprivate LauncherConfigurationParameters(List<Lookup> lookups) {\n+\t\tthis.lookups = lookups;\n+\t}\n+\n+\t@Override\n+\tpublic Optional<String> get(String key) {\n+\t\treturn Optional.ofNullable(getProperty(key));\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams) {\n-\t\tthis(configParams, ConfigurationParameters.CONFIG_FILE_NAME);\n+\t@Override\n+\tpublic Optional<Boolean> getBoolean(String key) {\n+\t\treturn get(key).map(Boolean::parseBoolean);\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams, String configFileName) {\n-\t\tPreconditions.notNull(configParams, \"configuration parameters must not be null\");\n-\t\tPreconditions.notBlank(configFileName, \"configFileName must not be null or blank\");\n-\t\tthis.explicitConfigParams = configParams;\n-\t\tthis.configParamsFromFile = fromClasspathResource(configFileName.trim());\n+\t@Override\n+\tpublic int size() {\n+\t\treturn lookups.stream() //\n+\t\t\t\t.mapToInt(Lookup::size) //\n+\t\t\t\t.sum();\n+\t}\n+\n+\tprivate String getProperty(String key) {\n+\t\tPreconditions.notBlank(key, \"key must not be null or blank\");\n+\t\treturn lookups.stream() //\n+\t\t\t\t.map(lookup -> lookup.getValue(key)) //\n+\t\t\t\t.filter(Objects::nonNull) //\n+\t\t\t\t.findFirst() //\n+\t\t\t\t.orElse(null);\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn new ToStringBuilder(this) //\n+\t\t\t\t.append(\"lookups\", lookups) //\n+\t\t\t\t.toString();\n+\t}\n+\n+\tstatic final class Builder {\n+\n+\t\tprivate final Map<String, String> explicitParameters = new HashMap<>();\n+\t\tprivate boolean useImplicitLookups = true;\n+\t\tprivate String configFileName = ConfigurationParameters.CONFIG_FILE_NAME;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\tBuilder withExplicitParameters(Map<String, String> parameters) {", "originalCommit": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwODY5NA==", "url": "https://github.com/junit-team/junit5/pull/2293#discussion_r425708694", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tBuilder withConfigFileName(String configFileName) {\n          \n          \n            \n            \t\tBuilder configFileName(String configFileName) {", "author": "marcphilipp", "createdAt": "2020-05-15T10:23:12Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/LauncherConfigurationParameters.java", "diffHunk": "@@ -36,25 +38,157 @@\n \n \tprivate static final Logger logger = LoggerFactory.getLogger(LauncherConfigurationParameters.class);\n \n-\tprivate final Map<String, String> explicitConfigParams;\n-\tprivate final Properties configParamsFromFile;\n+\tstatic Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\tprivate final List<Lookup> lookups;\n \n-\tLauncherConfigurationParameters() {\n-\t\tthis(emptyMap(), ConfigurationParameters.CONFIG_FILE_NAME);\n+\tprivate LauncherConfigurationParameters(List<Lookup> lookups) {\n+\t\tthis.lookups = lookups;\n+\t}\n+\n+\t@Override\n+\tpublic Optional<String> get(String key) {\n+\t\treturn Optional.ofNullable(getProperty(key));\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams) {\n-\t\tthis(configParams, ConfigurationParameters.CONFIG_FILE_NAME);\n+\t@Override\n+\tpublic Optional<Boolean> getBoolean(String key) {\n+\t\treturn get(key).map(Boolean::parseBoolean);\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams, String configFileName) {\n-\t\tPreconditions.notNull(configParams, \"configuration parameters must not be null\");\n-\t\tPreconditions.notBlank(configFileName, \"configFileName must not be null or blank\");\n-\t\tthis.explicitConfigParams = configParams;\n-\t\tthis.configParamsFromFile = fromClasspathResource(configFileName.trim());\n+\t@Override\n+\tpublic int size() {\n+\t\treturn lookups.stream() //\n+\t\t\t\t.mapToInt(Lookup::size) //\n+\t\t\t\t.sum();\n+\t}\n+\n+\tprivate String getProperty(String key) {\n+\t\tPreconditions.notBlank(key, \"key must not be null or blank\");\n+\t\treturn lookups.stream() //\n+\t\t\t\t.map(lookup -> lookup.getValue(key)) //\n+\t\t\t\t.filter(Objects::nonNull) //\n+\t\t\t\t.findFirst() //\n+\t\t\t\t.orElse(null);\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn new ToStringBuilder(this) //\n+\t\t\t\t.append(\"lookups\", lookups) //\n+\t\t\t\t.toString();\n+\t}\n+\n+\tstatic final class Builder {\n+\n+\t\tprivate final Map<String, String> explicitParameters = new HashMap<>();\n+\t\tprivate boolean useImplicitLookups = true;\n+\t\tprivate String configFileName = ConfigurationParameters.CONFIG_FILE_NAME;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\tBuilder withExplicitParameters(Map<String, String> parameters) {\n+\t\t\tPreconditions.notNull(parameters, \"configuration parameters must not be null\");\n+\t\t\texplicitParameters.putAll(parameters);\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\tBuilder withImplicitLookups(boolean useImplicitLookups) {\n+\t\t\tthis.useImplicitLookups = useImplicitLookups;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\tBuilder withConfigFileName(String configFileName) {", "originalCommit": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNTcwOTM2OQ==", "url": "https://github.com/junit-team/junit5/pull/2293#discussion_r425709369", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \tprivate interface Lookup {\n          \n          \n            \n            \tprivate interface PropertyProvider {", "author": "marcphilipp", "createdAt": "2020-05-15T10:24:29Z", "path": "junit-platform-launcher/src/main/java/org/junit/platform/launcher/core/LauncherConfigurationParameters.java", "diffHunk": "@@ -36,25 +38,157 @@\n \n \tprivate static final Logger logger = LoggerFactory.getLogger(LauncherConfigurationParameters.class);\n \n-\tprivate final Map<String, String> explicitConfigParams;\n-\tprivate final Properties configParamsFromFile;\n+\tstatic Builder builder() {\n+\t\treturn new Builder();\n+\t}\n+\n+\tprivate final List<Lookup> lookups;\n \n-\tLauncherConfigurationParameters() {\n-\t\tthis(emptyMap(), ConfigurationParameters.CONFIG_FILE_NAME);\n+\tprivate LauncherConfigurationParameters(List<Lookup> lookups) {\n+\t\tthis.lookups = lookups;\n+\t}\n+\n+\t@Override\n+\tpublic Optional<String> get(String key) {\n+\t\treturn Optional.ofNullable(getProperty(key));\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams) {\n-\t\tthis(configParams, ConfigurationParameters.CONFIG_FILE_NAME);\n+\t@Override\n+\tpublic Optional<Boolean> getBoolean(String key) {\n+\t\treturn get(key).map(Boolean::parseBoolean);\n \t}\n \n-\tLauncherConfigurationParameters(Map<String, String> configParams, String configFileName) {\n-\t\tPreconditions.notNull(configParams, \"configuration parameters must not be null\");\n-\t\tPreconditions.notBlank(configFileName, \"configFileName must not be null or blank\");\n-\t\tthis.explicitConfigParams = configParams;\n-\t\tthis.configParamsFromFile = fromClasspathResource(configFileName.trim());\n+\t@Override\n+\tpublic int size() {\n+\t\treturn lookups.stream() //\n+\t\t\t\t.mapToInt(Lookup::size) //\n+\t\t\t\t.sum();\n+\t}\n+\n+\tprivate String getProperty(String key) {\n+\t\tPreconditions.notBlank(key, \"key must not be null or blank\");\n+\t\treturn lookups.stream() //\n+\t\t\t\t.map(lookup -> lookup.getValue(key)) //\n+\t\t\t\t.filter(Objects::nonNull) //\n+\t\t\t\t.findFirst() //\n+\t\t\t\t.orElse(null);\n+\t}\n+\n+\t@Override\n+\tpublic String toString() {\n+\t\treturn new ToStringBuilder(this) //\n+\t\t\t\t.append(\"lookups\", lookups) //\n+\t\t\t\t.toString();\n+\t}\n+\n+\tstatic final class Builder {\n+\n+\t\tprivate final Map<String, String> explicitParameters = new HashMap<>();\n+\t\tprivate boolean useImplicitLookups = true;\n+\t\tprivate String configFileName = ConfigurationParameters.CONFIG_FILE_NAME;\n+\n+\t\tprivate Builder() {\n+\t\t}\n+\n+\t\tBuilder withExplicitParameters(Map<String, String> parameters) {\n+\t\t\tPreconditions.notNull(parameters, \"configuration parameters must not be null\");\n+\t\t\texplicitParameters.putAll(parameters);\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\tBuilder withImplicitLookups(boolean useImplicitLookups) {\n+\t\t\tthis.useImplicitLookups = useImplicitLookups;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\tBuilder withConfigFileName(String configFileName) {\n+\t\t\tPreconditions.notBlank(configFileName, \"configFileName must not be null or blank\");\n+\t\t\tthis.configFileName = configFileName;\n+\t\t\treturn this;\n+\t\t}\n+\n+\t\tLauncherConfigurationParameters build() {\n+\t\t\tList<Lookup> lookups = new ArrayList<>();\n+\t\t\tif (!explicitParameters.isEmpty()) {\n+\t\t\t\tlookups.add(Lookup.explicit(explicitParameters));\n+\t\t\t}\n+\t\t\tif (useImplicitLookups) {\n+\t\t\t\tlookups.add(Lookup.systemProperties());\n+\t\t\t\tlookups.add(Lookup.propertiesFile(configFileName));\n+\t\t\t}\n+\t\t\treturn new LauncherConfigurationParameters(lookups);\n+\t\t}\n \t}\n \n-\tprivate static Properties fromClasspathResource(String configFileName) {\n+\tprivate interface Lookup {", "originalCommit": "c43f39a54de1b5c8ba27dd84fb936f8fca3baae6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b46135f656c180c883f183b5647ec53ca4308ab", "url": "https://github.com/junit-team/junit5/commit/3b46135f656c180c883f183b5647ec53ca4308ab", "message": "Rename all the things", "committedDate": "2020-06-01T11:42:00Z", "type": "commit"}, {"oid": "60e07c0282be26f2a9987469f4431fd834266ea6", "url": "https://github.com/junit-team/junit5/commit/60e07c0282be26f2a9987469f4431fd834266ea6", "message": "Document all the things", "committedDate": "2020-06-01T12:03:52Z", "type": "commit"}]}