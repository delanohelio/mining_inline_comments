{"pr_number": 355, "pr_title": "Add support for Web Services artifact types #256", "pr_createdAt": "2020-03-31T20:22:32Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/355", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402282012", "bodyText": "Use java.nio.charset.StandardCharsets.UTF_8 here instead of the string.", "author": "EricWittmann", "createdAt": "2020-04-02T12:42:04Z", "path": "app/src/main/java/io/apicurio/registry/content/canon/XsdContentCanonicalizer.java", "diffHunk": "@@ -0,0 +1,53 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.content.canon;\n+\n+import java.io.IOException;\n+\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.apache.xml.security.Init;\n+import org.apache.xml.security.c14n.CanonicalizationException;\n+import org.apache.xml.security.c14n.Canonicalizer;\n+import org.apache.xml.security.c14n.InvalidCanonicalizerException;\n+import org.xml.sax.SAXException;\n+\n+import io.apicurio.registry.content.ContentCanonicalizer;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+public class XsdContentCanonicalizer implements ContentCanonicalizer {\n+\n+    /**\n+     * @see io.apicurio.registry.content.ContentCanonicalizer#canonicalize(io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public ContentHandle canonicalize(ContentHandle content) {\n+        Init.init(); // this library needs to be initialized using the static init()\n+        try {\n+            Canonicalizer canon = Canonicalizer.getInstance(Canonicalizer.ALGO_ID_C14N_OMIT_COMMENTS);\n+            byte[] canonXmlBytes = canon.canonicalize(content.bytes());\n+            String canonicalized = new String(canonXmlBytes, \"UTF-8\"); // for UTF-8 encoding", "originalCommit": "3d3f45c16e2d4ed280ae16f8ab172d75f1d1de4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4Njg2MQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402286861", "bodyText": "\ud83d\udc4d", "author": "cfoskin", "createdAt": "2020-04-02T12:50:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU2ODI2Ng==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402568266", "bodyText": "No, use IoUtil ... so we have bytes <--> string all in one single place!", "author": "alesj", "createdAt": "2020-04-02T19:45:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc3OTc2MA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402779760", "bodyText": "@EricWittmann @alesj I can use String canonicalized = IOUtils.toString(canon.canonicalize(content.bytes()), \"UTF-8\");  but I cant use the StandardCharsets.UTF_8 then? it either takes a byte[], String or InputStream, Charset   wdyt?", "author": "cfoskin", "createdAt": "2020-04-03T07:14:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3ODYxOA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r403078618", "bodyText": "I think Ales is suggesting you use IoUtil which is a registry class.  No the one from apache commons.", "author": "EricWittmann", "createdAt": "2020-04-03T15:16:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3ODk1OA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r403078958", "bodyText": "https://github.com/Apicurio/apicurio-registry/blob/master/common/src/main/java/io/apicurio/registry/utils/IoUtil.java#L109-L111", "author": "EricWittmann", "createdAt": "2020-04-03T15:17:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA3OTc5OA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r403079798", "bodyText": "ah.. will update", "author": "cfoskin", "createdAt": "2020-04-03T15:18:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjAxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjY3Nw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402282677", "bodyText": "Looks good!", "author": "EricWittmann", "createdAt": "2020-04-02T12:43:10Z", "path": "app/src/main/java/io/apicurio/registry/rules/validity/XsdContentValidator.java", "diffHunk": "@@ -0,0 +1,59 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.transform.Source;\n+import javax.xml.transform.stream.StreamSource;\n+import javax.xml.validation.SchemaFactory;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+@ApplicationScoped\n+public class XsdContentValidator implements ContentValidator {\n+\n+    /**\n+     * @see io.apicurio.registry.rules.validity.ContentValidator#validate(io.apicurio.registry.rules.validity.ValidityLevel,\n+     *      io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public void validate(ValidityLevel level, ContentHandle artifactContent) throws InvalidContentException {\n+        if (level == ValidityLevel.SYNTAX_ONLY || level == ValidityLevel.FULL) {\n+            try {\n+                // try to parse it\n+                DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+                DocumentBuilder builder = factory.newDocumentBuilder();\n+                builder.parse(artifactContent.stream());\n+\n+                if (level == ValidityLevel.FULL) {\n+                    // validate that its a valid schema\n+                    Source source = new StreamSource(artifactContent.stream());\n+                    SchemaFactory schemaFactory = SchemaFactory\n+                            .newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n+                    schemaFactory.newSchema(source);\n+                }\n+            } catch (Exception e) {\n+                throw new InvalidContentException(\"Syntax violation for XSD Schema artifact.\", e);\n+            }", "originalCommit": "3d3f45c16e2d4ed280ae16f8ab172d75f1d1de4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjU2ODk0Mw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402568943", "bodyText": "Shouldn't Source's stream be closed ?", "author": "alesj", "createdAt": "2020-04-02T19:46:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzA4MDcxOQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r403080719", "bodyText": "It's a ByteArrayInputStream coming from the content handle, so actually I think it doesn't need to be.  However, it would probably be best practice to close it.\n@cfoskin Can you make sure to close the input stream you're getting on line 45 and also the one on line 49?", "author": "EricWittmann", "createdAt": "2020-04-03T15:19:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzQ0MzkwNA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r403443904", "bodyText": "Well, you don't know what kind of stream you might get -- it depends on the actual ContentHandle impl.\nAs per contract -- which we probably need to add :-) -- you should close it.\ne.g. see that our extension of BufferedInputStream, where in close() we copy buffered bytes.", "author": "alesj", "createdAt": "2020-04-04T08:40:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjY3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDAzNzYwNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404037607", "bodyText": "Yep - I showed Colum the try-with-resources java syntax, so this is in progress.", "author": "EricWittmann", "createdAt": "2020-04-06T12:03:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MjY3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MzI0Mg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402283242", "bodyText": "Can you externalize these two files to test resources?", "author": "EricWittmann", "createdAt": "2020-04-02T12:44:06Z", "path": "app/src/test/java/io/apicurio/registry/content/ContentCanonicalizerFactoryTest.java", "diffHunk": "@@ -171,5 +171,44 @@ void testKafkaConnect() {\n         Assertions.assertEquals(expected, actual);\n     }\n \n+    /**\n+    * Test method for {@link io.apicurio.registry.content.ContentCanonicalizerFactory#create(io.apicurio.registry.types.ArtifactType)}.\n+    */\n+    @Test\n+    void testXsd() {\n+       ContentCanonicalizerFactory factory = new ContentCanonicalizerFactory();\n+       ContentCanonicalizer canonicalizer = factory.create(ArtifactType.XSD);\n+       String before = \"<xs:schema xmlns:xs=\\\"http://www.w3.org/2001/XMLSchema\\\">\\n\"\n+               + \"<xs:element             name=\\\"shiporder\\\">\\n\" + \"  <xs:complexType>\\n\"\n+               + \"    <xs:sequence>\\n\"\n+               + \"      <xs:element            name=\\\"orderperson\\\" type=\\\"xs:string\\\"/>\\n\"\n+               + \"      <xs:element       name=\\\"shipto\\\">\\n\" + \"        <xs:complexType>\\n\"\n+               + \"          <xs:sequence>\\n\"\n+               + \"            <xs:element          type=\\\"xs:string\\\"  name=\\\"name\\\" />\\n\"\n+               + \"            <xs:element               type=\\\"xs:string\\\" name=\\\"address\\\"/>\\n\"\n+               + \"            <xs:element      type=\\\"xs:string\\\"  name=\\\"city\\\"/>\\n\"\n+               + \"            <xs:element    type=\\\"xs:string\\\" name=\\\"country\\\"/>\\n\"\n+               + \"          </xs:sequence>\\n\" + \"        </xs:complexType>\\n\" + \"      </xs:element>\\n\"\n+               + \"    </xs:sequence>\\n\"\n+               + \"    <xs:attribute use=\\\"required\\\" type=\\\"xs:string\\\" name=\\\"orderid\\\"/>\\n\"\n+               + \"  </xs:complexType>\\n\" + \"</xs:element>\\n\" + \"</xs:schema>\";\n \n+       String expected = \"<xs:schema xmlns:xs=\\\"http://www.w3.org/2001/XMLSchema\\\">\\n\"\n+               + \"<xs:element name=\\\"shiporder\\\">\\n\" + \"  <xs:complexType>\\n\" + \"    <xs:sequence>\\n\"\n+               + \"      <xs:element name=\\\"orderperson\\\" type=\\\"xs:string\\\"></xs:element>\\n\"\n+               + \"      <xs:element name=\\\"shipto\\\">\\n\" + \"        <xs:complexType>\\n\"\n+               + \"          <xs:sequence>\\n\"\n+               + \"            <xs:element name=\\\"name\\\" type=\\\"xs:string\\\"></xs:element>\\n\"\n+               + \"            <xs:element name=\\\"address\\\" type=\\\"xs:string\\\"></xs:element>\\n\"\n+               + \"            <xs:element name=\\\"city\\\" type=\\\"xs:string\\\"></xs:element>\\n\"\n+               + \"            <xs:element name=\\\"country\\\" type=\\\"xs:string\\\"></xs:element>\\n\"\n+               + \"          </xs:sequence>\\n\" + \"        </xs:complexType>\\n\" + \"      </xs:element>\\n\"\n+               + \"    </xs:sequence>\\n\"\n+               + \"    <xs:attribute name=\\\"orderid\\\" type=\\\"xs:string\\\" use=\\\"required\\\"></xs:attribute>\\n\"\n+               + \"  </xs:complexType>\\n\" + \"</xs:element>\\n\" + \"</xs:schema>\";", "originalCommit": "3d3f45c16e2d4ed280ae16f8ab172d75f1d1de4a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4NzU1NQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402287555", "bodyText": "\ud83d\udc4d", "author": "cfoskin", "createdAt": "2020-04-02T12:51:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MzI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjMxNDY1MQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402314651", "bodyText": "Is it ok to extend AbstractRegistryTestBase to utilise the methods there?", "author": "cfoskin", "createdAt": "2020-04-02T13:31:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MzI0Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ0NjkyNQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r402446925", "bodyText": "Yes I think so.", "author": "EricWittmann", "createdAt": "2020-04-02T16:28:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjI4MzI0Mg=="}], "type": "inlineReview"}, {"oid": "f3cb160f92930f2cae49d39fe2b649fb5edc1127", "url": "https://github.com/Apicurio/apicurio-registry/commit/f3cb160f92930f2cae49d39fe2b649fb5edc1127", "message": "feedback", "committedDate": "2020-04-03T15:48:07Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1NDUyNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404254527", "bodyText": "Good.", "author": "EricWittmann", "createdAt": "2020-04-06T17:12:20Z", "path": "app/src/main/java/io/apicurio/registry/content/ContentCanonicalizerFactory.java", "diffHunk": "@@ -37,7 +38,10 @@\n     private ContentCanonicalizer kconnect = new KafkaConnectContentCanonicalizer();\n     private ContentCanonicalizer json = new JsonContentCanonicalizer();\n     private ContentCanonicalizer graphql = new GraphQLContentCanonicalizer();\n-    \n+    private ContentCanonicalizer xsd = new XmlContentCanonicalizer();\n+    private ContentCanonicalizer wsdl = new XmlContentCanonicalizer();\n+    private ContentCanonicalizer xml = new XmlContentCanonicalizer();", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1NDgyNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404254827", "bodyText": "Good - just fix the indentation of line 72 - the return xml; is not properly indented.", "author": "EricWittmann", "createdAt": "2020-04-06T17:12:50Z", "path": "app/src/main/java/io/apicurio/registry/content/ContentCanonicalizerFactory.java", "diffHunk": "@@ -60,8 +64,12 @@ public ContentCanonicalizer create(ArtifactType type) {\n                 return noop;\n             case GRAPHQL:\n                 return graphql;\n-            default:\n-                break;\n+            case XSD:\n+                return xsd;\n+            case WSDL:\n+                return wsdl;\n+            case XML:\n+             return xml;", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1NjAyMQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404256021", "bodyText": "How often does this need to be initialized?  Check the javadoc for that init() method to find out.  Is it something that needs to be called every time you get an instance of a Canonicalizer?  I hope not but do not know offhand.\nIt's possible/likely this only needs to be done once, in which case we could put it in a static initializer.", "author": "EricWittmann", "createdAt": "2020-04-06T17:14:38Z", "path": "app/src/main/java/io/apicurio/registry/content/canon/XmlContentCanonicalizer.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.content.canon;\n+\n+import java.io.IOException;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.xml.security.Init;\n+import io.apicurio.registry.utils.IoUtil;\n+import org.apache.xml.security.c14n.CanonicalizationException;\n+import org.apache.xml.security.c14n.Canonicalizer;\n+import org.apache.xml.security.c14n.InvalidCanonicalizerException;\n+import org.xml.sax.SAXException;\n+import io.apicurio.registry.content.ContentCanonicalizer;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+\n+public class XmlContentCanonicalizer implements ContentCanonicalizer {\n+\n+    /**\n+     * @see io.apicurio.registry.content.ContentCanonicalizer#canonicalize(io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public ContentHandle canonicalize(ContentHandle content) {\n+        Init.init(); // this library needs to be initialized using the static init()", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDYxMzExMg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404613112", "bodyText": "\ud83d\udc4d", "author": "cfoskin", "createdAt": "2020-04-07T08:01:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1NjAyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1NjcxMQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404256711", "bodyText": "Check the javadoc for Canonicalizer and see if it is threadsafe.  If it is, then we can create just one of these and re-use it each time this method is called.", "author": "EricWittmann", "createdAt": "2020-04-06T17:15:40Z", "path": "app/src/main/java/io/apicurio/registry/content/canon/XmlContentCanonicalizer.java", "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.content.canon;\n+\n+import java.io.IOException;\n+import javax.xml.parsers.ParserConfigurationException;\n+import org.apache.xml.security.Init;\n+import io.apicurio.registry.utils.IoUtil;\n+import org.apache.xml.security.c14n.CanonicalizationException;\n+import org.apache.xml.security.c14n.Canonicalizer;\n+import org.apache.xml.security.c14n.InvalidCanonicalizerException;\n+import org.xml.sax.SAXException;\n+import io.apicurio.registry.content.ContentCanonicalizer;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+\n+public class XmlContentCanonicalizer implements ContentCanonicalizer {\n+\n+    /**\n+     * @see io.apicurio.registry.content.ContentCanonicalizer#canonicalize(io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public ContentHandle canonicalize(ContentHandle content) {\n+        Init.init(); // this library needs to be initialized using the static init()\n+        try {\n+            Canonicalizer canon = Canonicalizer.getInstance(Canonicalizer.ALGO_ID_C14N_OMIT_COMMENTS);", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1Njg3Ng==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404256876", "bodyText": "Correct.", "author": "EricWittmann", "createdAt": "2020-04-06T17:15:58Z", "path": "app/src/main/java/io/apicurio/registry/rules/compatibility/ArtifactTypeAdapterFactory.java", "diffHunk": "@@ -39,6 +39,10 @@\n         ADAPTERS.put(ArtifactType.OPENAPI, NoopArtifactTypeAdapter.INSTANCE);\n         ADAPTERS.put(ArtifactType.ASYNCAPI, NoopArtifactTypeAdapter.INSTANCE);\n         ADAPTERS.put(ArtifactType.GRAPHQL, NoopArtifactTypeAdapter.INSTANCE);\n+        ADAPTERS.put(ArtifactType.XSD, NoopArtifactTypeAdapter.INSTANCE);\n+        ADAPTERS.put(ArtifactType.WSDL, NoopArtifactTypeAdapter.INSTANCE);\n+        ADAPTERS.put(ArtifactType.XML, NoopArtifactTypeAdapter.INSTANCE);", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1NzAxOA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404257018", "bodyText": "+1", "author": "EricWittmann", "createdAt": "2020-04-06T17:16:15Z", "path": "app/src/main/java/io/apicurio/registry/rules/validity/ContentValidatorFactory.java", "diffHunk": "@@ -63,8 +70,12 @@ public ContentValidator createValidator(ArtifactType artifactType) {\n                 return protofdValidator;\n             case GRAPHQL:\n                 return graphqlValidator;\n-            default:\n-                break;\n+            case XSD:\n+                return xsdValidator;\n+            case WSDL:\n+                return wsdlValidator;\n+            case XML:\n+                return xmlValidator;", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1ODMyMw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404258323", "bodyText": "The logic looks great here.  The only thing to check is which of these objects you're using are threadsafe and can be re-used.  You'll need to check the javadoc for each:\n\nDocumentBuilderFactory\nDocumentBuilder\nWSDLFactory\nWSDLReader\n\nI'm guessing the factories can be cached and re-used, but you'll need to confirm by reading the javadocs for all those classes.", "author": "EricWittmann", "createdAt": "2020-04-06T17:18:23Z", "path": "app/src/main/java/io/apicurio/registry/rules/validity/WsdlContentValidator.java", "diffHunk": "@@ -0,0 +1,60 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import java.io.InputStream;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.wsdl.factory.WSDLFactory;\n+import javax.wsdl.xml.WSDLReader;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import org.w3c.dom.Document;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+@ApplicationScoped\n+public class WsdlContentValidator implements ContentValidator {\n+\n+    /**\n+     * @see io.apicurio.registry.rules.validity.ContentValidator#validate(io.apicurio.registry.rules.validity.ValidityLevel,\n+     *      io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public void validate(ValidityLevel level, ContentHandle artifactContent) throws InvalidContentException {\n+        if (level == ValidityLevel.SYNTAX_ONLY || level == ValidityLevel.FULL) {\n+            try (InputStream stream = artifactContent.stream()) {\n+                DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+                factory.setNamespaceAware(true);\n+                DocumentBuilder builder = factory.newDocumentBuilder();\n+                // just try to parse it\n+                Document wsdlDoc = builder.parse(stream);\n+                \n+                if (level == ValidityLevel.FULL) {\n+                    // validate that its a valid schema\n+                    WSDLFactory wsdlFactory = WSDLFactory.newInstance();\n+                    WSDLReader wsdlReader = wsdlFactory.newWSDLReader();\n+                    wsdlReader.readWSDL(null, wsdlDoc);\n+                }", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1ODkzNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404258937", "bodyText": "Looks good!  Same note as before - check which of these things (if any) can be cached and re-used.", "author": "EricWittmann", "createdAt": "2020-04-06T17:19:22Z", "path": "app/src/main/java/io/apicurio/registry/rules/validity/XmlContentValidator.java", "diffHunk": "@@ -0,0 +1,50 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import java.io.InputStream;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com This class can be used to validate plain XML and only does syntax validation\n+ */\n+@ApplicationScoped\n+public class XmlContentValidator implements ContentValidator {\n+\n+    /**\n+     * @see io.apicurio.registry.rules.validity.ContentValidator#validate(io.apicurio.registry.rules.validity.ValidityLevel,\n+     *      io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public void validate(ValidityLevel level, ContentHandle artifactContent) throws InvalidContentException {\n+        if (level == ValidityLevel.SYNTAX_ONLY || level == ValidityLevel.FULL) {\n+            try (InputStream stream = artifactContent.stream()) {\n+                DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+                DocumentBuilder builder = factory.newDocumentBuilder();\n+                // just try to parse it\n+                builder.parse(stream);\n+            } catch (Exception e) {\n+                throw new InvalidContentException(\"Syntax violation for XML Schema artifact.\", e);\n+            }", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI1OTQ5MA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404259490", "bodyText": "This logic looks perfect now.  But again, we need to figure out which of these resources can be cached/re-used.  See previous comments. :)", "author": "EricWittmann", "createdAt": "2020-04-06T17:20:18Z", "path": "app/src/main/java/io/apicurio/registry/rules/validity/XsdContentValidator.java", "diffHunk": "@@ -0,0 +1,63 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import java.io.InputStream;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.xml.XMLConstants;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.transform.Source;\n+import javax.xml.transform.stream.StreamSource;\n+import javax.xml.validation.SchemaFactory;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+@ApplicationScoped\n+public class XsdContentValidator implements ContentValidator {\n+\n+    /**\n+     * @see io.apicurio.registry.rules.validity.ContentValidator#validate(io.apicurio.registry.rules.validity.ValidityLevel,\n+     *      io.apicurio.registry.content.ContentHandle)\n+     */\n+    @Override\n+    public void validate(ValidityLevel level, ContentHandle artifactContent) throws InvalidContentException {\n+        if (level == ValidityLevel.SYNTAX_ONLY || level == ValidityLevel.FULL) {\n+            try (InputStream stream = artifactContent.stream()) {\n+                // try to parse it\n+                DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+                DocumentBuilder builder = factory.newDocumentBuilder();\n+                builder.parse(stream);\n+\n+                if (level == ValidityLevel.FULL) {\n+                    try (InputStream semanticStream = artifactContent.stream()) {\n+                        // validate that its a valid schema\n+                        Source source = new StreamSource(semanticStream);\n+                        SchemaFactory schemaFactory = SchemaFactory\n+                                .newInstance(XMLConstants.W3C_XML_SCHEMA_NS_URI);\n+                        schemaFactory.newSchema(source);\n+                    }\n+                }\n+            } catch (Exception e) {\n+                throw new InvalidContentException(\"Syntax violation for XSD Schema artifact.\", e);\n+            }", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MDIzMQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404260231", "bodyText": "Logic is good but please rename the test files to:\n\nwsdl-before.wsdl\nwsdl-expected.wsdl\n\nThey are not wsdl-schemas, just wsdl. :)", "author": "EricWittmann", "createdAt": "2020-04-06T17:21:32Z", "path": "app/src/test/java/io/apicurio/registry/content/ContentCanonicalizerFactoryTest.java", "diffHunk": "@@ -171,5 +172,48 @@ void testKafkaConnect() {\n         Assertions.assertEquals(expected, actual);\n     }\n \n+    /**\n+    * Test method for {@link io.apicurio.registry.content.ContentCanonicalizerFactory#create(io.apicurio.registry.types.ArtifactType)}.\n+    */\n+    @Test\n+    void testXsd() {\n+       ContentCanonicalizerFactory factory = new ContentCanonicalizerFactory();\n+       ContentCanonicalizer canonicalizer = factory.create(ArtifactType.XSD);\n+\n+       ContentHandle content = resourceToContentHandle(\"xml-schema-before.xsd\");\n+       String expected = resourceToString(\"xml-schema-expected.xsd\");\n+       \n+       String actual = canonicalizer.canonicalize(content).content();\n+       Assertions.assertEquals(expected, actual);\n+    }\n+    \n+    /**\n+     * Test method for {@link io.apicurio.registry.content.ContentCanonicalizerFactory#create(io.apicurio.registry.types.ArtifactType)}.\n+     */\n+     @Test\n+     void testWsdl() {\n+        ContentCanonicalizerFactory factory = new ContentCanonicalizerFactory();\n+        ContentCanonicalizer canonicalizer = factory.create(ArtifactType.WSDL);\n+\n+        ContentHandle content = resourceToContentHandle(\"wsdl-schema-before.wsdl\");\n+        String expected = resourceToString(\"wsdl-schema-expected.wsdl\");", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MDgxMw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404260813", "bodyText": "For each of these wsdl test resources, please drop the \"-schema\" from the filenames.", "author": "EricWittmann", "createdAt": "2020-04-06T17:22:28Z", "path": "app/src/test/java/io/apicurio/registry/rules/validity/WsdlContentValidatorTest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import io.apicurio.registry.AbstractRegistryTestBase;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+public class WsdlContentValidatorTest extends AbstractRegistryTestBase {\n+    @Test\n+    public void testValidSyntax() throws Exception {\n+        ContentHandle content = resourceToContentHandle(\"wsdl-schema-valid.wsdl\");", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY2NDU2MA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404664560", "bodyText": "\ud83d\udc4d", "author": "cfoskin", "createdAt": "2020-04-07T09:23:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MDgxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MTk4Mg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404261982", "bodyText": "I think we should perhaps have a separate file for this where the syntax is valid but the semantics are invalid.  Your test uses the same valid WSDL file for both the syntax and the semantic validity check.  That's fine, but we should also have a test where the syntax is valid (and therefore passes here) but the semantics are invalid.  In fact you could just re-use the wsdl-schema-invalid-semantics.wsdl test file I think.", "author": "EricWittmann", "createdAt": "2020-04-06T17:24:19Z", "path": "app/src/test/java/io/apicurio/registry/rules/validity/WsdlContentValidatorTest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import io.apicurio.registry.AbstractRegistryTestBase;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+public class WsdlContentValidatorTest extends AbstractRegistryTestBase {\n+    @Test\n+    public void testValidSyntax() throws Exception {\n+        ContentHandle content = resourceToContentHandle(\"wsdl-schema-valid.wsdl\");\n+        WsdlContentValidator validator = new WsdlContentValidator();\n+        validator.validate(ValidityLevel.SYNTAX_ONLY, content);", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NTIzNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404675237", "bodyText": "\ud83d\udc4d", "author": "cfoskin", "createdAt": "2020-04-07T09:40:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MTk4Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MzIxOQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404263219", "bodyText": "Same note here as in the WSDL content validator test.  You can add another test within this method to also run the SYNTAX_ONLY validity against the xml-schema-invalid-semantics.xsd test file and it should be valid.", "author": "EricWittmann", "createdAt": "2020-04-06T17:26:21Z", "path": "app/src/test/java/io/apicurio/registry/rules/validity/XsdContentValidatorTest.java", "diffHunk": "@@ -0,0 +1,61 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import org.junit.jupiter.api.Assertions;\n+import org.junit.jupiter.api.Test;\n+\n+import io.apicurio.registry.AbstractRegistryTestBase;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+public class XsdContentValidatorTest extends AbstractRegistryTestBase {\n+    @Test\n+    public void testValidSyntax() throws Exception {\n+        ContentHandle content = resourceToContentHandle(\"xml-schema-valid.xsd\");\n+        XsdContentValidator validator = new XsdContentValidator();\n+        validator.validate(ValidityLevel.SYNTAX_ONLY, content);", "originalCommit": "52a83f4808c21d1ae1e03b14dc0c8b2a09f4f21e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDY3NDYxMQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r404674611", "bodyText": "\ud83d\udc4d", "author": "cfoskin", "createdAt": "2020-04-07T09:39:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDI2MzIxOQ=="}], "type": "inlineReview"}, {"oid": "5cff6f2f114cfc2336e3c71bf656d5f586c4bef1", "url": "https://github.com/Apicurio/apicurio-registry/commit/5cff6f2f114cfc2336e3c71bf656d5f586c4bef1", "message": "feedback applied minus Factories checks", "committedDate": "2020-04-07T15:06:25Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTcwODQyOA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/355#discussion_r405708428", "bodyText": "Looks good!", "author": "EricWittmann", "createdAt": "2020-04-08T17:55:23Z", "path": "app/src/main/java/io/apicurio/registry/rules/validity/WsdlContentValidator.java", "diffHunk": "@@ -0,0 +1,95 @@\n+/*\n+ * Copyright 2020 JBoss Inc\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ *      http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package io.apicurio.registry.rules.validity;\n+\n+import java.io.InputStream;\n+\n+import javax.enterprise.context.ApplicationScoped;\n+import javax.wsdl.WSDLException;\n+import javax.wsdl.factory.WSDLFactory;\n+import javax.wsdl.xml.WSDLReader;\n+import javax.xml.parsers.DocumentBuilder;\n+import javax.xml.parsers.DocumentBuilderFactory;\n+import javax.xml.parsers.ParserConfigurationException;\n+\n+import org.w3c.dom.Document;\n+import io.apicurio.registry.content.ContentHandle;\n+\n+/**\n+ * @author cfoskin@redhat.com\n+ */\n+@ApplicationScoped\n+public class WsdlContentValidator implements ContentValidator {\n+\n+    private static ThreadLocal<DocumentBuilder> threadLocaldocBuilder = new ThreadLocal<DocumentBuilder>() {\n+        @Override\n+        protected DocumentBuilder initialValue() {\n+            DocumentBuilder builder = null;\n+            try {\n+                DocumentBuilderFactory factory = DocumentBuilderFactory.newInstance();\n+                factory.setNamespaceAware(true);\n+                builder = factory.newDocumentBuilder();\n+            } catch (ParserConfigurationException e) {\n+                throw new RuntimeException(e);\n+            }\n+            return builder;\n+        }\n+\n+        public DocumentBuilder get() {\n+            return super.get();\n+        }\n+    };\n+\n+    private static ThreadLocal<WSDLReader> threadLocalWsdlReader = new ThreadLocal<WSDLReader>() {\n+        @Override\n+        protected WSDLReader initialValue() {\n+            WSDLReader wsdlReader = null;\n+            try {\n+                WSDLFactory wsdlFactory = WSDLFactory.newInstance();\n+                wsdlReader = wsdlFactory.newWSDLReader();\n+            } catch (WSDLException e) {\n+                throw new RuntimeException(e);\n+            }\n+            return wsdlReader;\n+\n+        }\n+\n+        public WSDLReader get() {\n+            return super.get();\n+        }\n+    };", "originalCommit": "293c29b78669e06b35a7fc2206f0ee5839872faa", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "fd54deed7b1bfaf46844bcca59a45f0846b74770", "url": "https://github.com/Apicurio/apicurio-registry/commit/fd54deed7b1bfaf46844bcca59a45f0846b74770", "message": "refactor to extend AbstractArtifactTypeUtilProvider", "committedDate": "2020-04-14T13:50:55Z", "type": "forcePushed"}, {"oid": "93e8a6a13dd06bd3ffefbc5144e071f506f423d6", "url": "https://github.com/Apicurio/apicurio-registry/commit/93e8a6a13dd06bd3ffefbc5144e071f506f423d6", "message": "xsd validation structure", "committedDate": "2020-04-15T12:51:12Z", "type": "commit"}, {"oid": "ab02522430bdf729a217791e359313d16ec2da89", "url": "https://github.com/Apicurio/apicurio-registry/commit/ab02522430bdf729a217791e359313d16ec2da89", "message": "addressed feedback & add more tests", "committedDate": "2020-04-15T12:51:12Z", "type": "commit"}, {"oid": "8c14fcc1fdb706ee37a4672924362000291f3f83", "url": "https://github.com/Apicurio/apicurio-registry/commit/8c14fcc1fdb706ee37a4672924362000291f3f83", "message": "added canonicalization for xsd", "committedDate": "2020-04-15T12:51:12Z", "type": "commit"}, {"oid": "400c6203f1de34ac97080623aff932861695cfce", "url": "https://github.com/Apicurio/apicurio-registry/commit/400c6203f1de34ac97080623aff932861695cfce", "message": "added wsdl validator", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "a0a0ca3051ec3e795ac7430a7b5937eedb7d1d85", "url": "https://github.com/Apicurio/apicurio-registry/commit/a0a0ca3051ec3e795ac7430a7b5937eedb7d1d85", "message": "wsdl canonicalisation", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "05dd49f097ec8fd40d6b6a40743a3723cca4aa9f", "url": "https://github.com/Apicurio/apicurio-registry/commit/05dd49f097ec8fd40d6b6a40743a3723cca4aa9f", "message": "use xml canonicaliser for both", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "9eeed5a009cefdfc93ffd273c77114e83f8cf737", "url": "https://github.com/Apicurio/apicurio-registry/commit/9eeed5a009cefdfc93ffd273c77114e83f8cf737", "message": "added xml validation", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "518c6ba86e7f7c26ae17cd885f1911087e0794b6", "url": "https://github.com/Apicurio/apicurio-registry/commit/518c6ba86e7f7c26ae17cd885f1911087e0794b6", "message": "use ThreadLocal for factories", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "334f69c3a79ad1eec1e7086ff1e385d16ad882c2", "url": "https://github.com/Apicurio/apicurio-registry/commit/334f69c3a79ad1eec1e7086ff1e385d16ad882c2", "message": "refactor to extend xml validator", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "1f53418214e63763b32f77e59f0fac8faf89f1c9", "url": "https://github.com/Apicurio/apicurio-registry/commit/1f53418214e63763b32f77e59f0fac8faf89f1c9", "message": "extend XmlContentValidator", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "75863594691ceea363f107a79ef7a7b7fd3ca0a0", "url": "https://github.com/Apicurio/apicurio-registry/commit/75863594691ceea363f107a79ef7a7b7fd3ca0a0", "message": "refactor to extend AbstractArtifactTypeUtilProvider", "committedDate": "2020-04-15T12:51:13Z", "type": "commit"}, {"oid": "75863594691ceea363f107a79ef7a7b7fd3ca0a0", "url": "https://github.com/Apicurio/apicurio-registry/commit/75863594691ceea363f107a79ef7a7b7fd3ca0a0", "message": "refactor to extend AbstractArtifactTypeUtilProvider", "committedDate": "2020-04-15T12:51:13Z", "type": "forcePushed"}, {"oid": "63bded44234111a201b7f02c8a7d6265ed134305", "url": "https://github.com/Apicurio/apicurio-registry/commit/63bded44234111a201b7f02c8a7d6265ed134305", "message": "Some pom.xml fixes\n\nRestored some missing properties and removed some duplicates.", "committedDate": "2020-04-15T17:47:17Z", "type": "commit"}, {"oid": "06e25c03f409a8d88e4a76626db8be1c33faa0df", "url": "https://github.com/Apicurio/apicurio-registry/commit/06e25c03f409a8d88e4a76626db8be1c33faa0df", "message": "Reverted the pom.xml file to base and re-added deps\n\nShould be no changes other than adding wsdl4j and xmlsec dependencies.", "committedDate": "2020-04-15T17:51:05Z", "type": "commit"}]}