{"pr_number": 772, "pr_title": "Add create/updateArtifactWithMetadata methods to storage interface", "pr_createdAt": "2020-08-18T21:03:25Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/772", "timeline": [{"oid": "cdc49ca2310556788142e00a1851bbb3b8059aa6", "url": "https://github.com/Apicurio/apicurio-registry/commit/cdc49ca2310556788142e00a1851bbb3b8059aa6", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-08-18T21:03:49Z", "type": "forcePushed"}, {"oid": "012ffa0a8c147eeceeab9a5e3a272c37218110d3", "url": "https://github.com/Apicurio/apicurio-registry/commit/012ffa0a8c147eeceeab9a5e3a272c37218110d3", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-08-19T11:44:24Z", "type": "forcePushed"}, {"oid": "8d61bcb8f8cea13a2d55ed94c7c9b1b7ccefd768", "url": "https://github.com/Apicurio/apicurio-registry/commit/8d61bcb8f8cea13a2d55ed94c7c9b1b7ccefd768", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-08-19T12:11:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA0OTEwMA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473049100", "bodyText": "Perhaps extract these Submitter::submitMetadata calls into new method -- so we have this (cryptic parameters :-)) in one place.\n(same for Kafka storage)", "author": "alesj", "createdAt": "2020-08-19T13:56:29Z", "path": "storage/streams/src/main/java/io/apicurio/registry/streams/StreamsRegistryStorage.java", "diffHunk": "@@ -411,6 +435,15 @@ public StoredArtifact getArtifact(String artifactId) throws ArtifactNotFoundExce\n                        });\n     }\n \n+\n+    @Override\n+    public CompletionStage<ArtifactMetaDataDto> updateArtifactWithMetadata(String artifactId, ArtifactType artifactType, ContentHandle content, EditableArtifactMetaDataDto metaData) throws ArtifactAlreadyExistsException, RegistryStorageException {\n+        return updateArtifact(artifactId, artifactType, content)\n+            .thenCompose(amdd -> submitter.submitMetadata(Str.ActionType.UPDATE, artifactId, -1, metaData.getName(), metaData.getDescription(), metaData.getLabels())", "originalCommit": "a167486080e1d75213fc5826a0149f29a00d5da3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MDEzNw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473050137", "bodyText": "Otoh, it won't fix the cryptic params stuff or add any extra value ... so you can leave it.", "author": "alesj", "createdAt": "2020-08-19T13:57:51Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA0OTEwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTA1Mg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473051052", "bodyText": "I just got bitten by this :-)\nSo I know why it is set to 200 ... but I have a better fix. ;-)", "author": "alesj", "createdAt": "2020-08-19T13:59:05Z", "path": "app/src/test/java/io/apicurio/registry/ibmcompat/IBMCompatApiTest.java", "diffHunk": "@@ -89,6 +89,7 @@ public void testGetSchemas() throws Exception {\n         // Get the list of artifacts via ibmcompat API\n         List<SchemaListItem> schemas = given()\n             .when()\n+                .param(\"per_page\", 200)", "originalCommit": "a167486080e1d75213fc5826a0149f29a00d5da3", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1NjA4NQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473056085", "bodyText": "I definitely prefer your fix \ud83d\ude42 thanks for sorting that out.", "author": "ajborley", "createdAt": "2020-08-19T14:06:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTA1Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1ODkyNQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/772#discussion_r473058925", "bodyText": "I found it running with -Pinfinispan, where -Pstreams didn't fail for me ... go figure :-)", "author": "alesj", "createdAt": "2020-08-19T14:10:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzA1MTA1Mg=="}], "type": "inlineReview"}, {"oid": "9b44e1b23bda58586a30b1ff60a93bedf10c838e", "url": "https://github.com/Apicurio/apicurio-registry/commit/9b44e1b23bda58586a30b1ff60a93bedf10c838e", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-08-20T11:08:20Z", "type": "commit"}, {"oid": "9b44e1b23bda58586a30b1ff60a93bedf10c838e", "url": "https://github.com/Apicurio/apicurio-registry/commit/9b44e1b23bda58586a30b1ff60a93bedf10c838e", "message": "Add create/updateArtifactWithMetadata methods to storage interface\n\n - This commit updates the RegistryStorage interface to add two new\nmethods allowing metadata to be set on artifact and version creation.\nThis fixes the metadata issues with the ibmcompat POST /schemas and\nPOST /schemas/{id}/versions endpoints.\n\nSigned-off-by: Andrew Borley <borley@uk.ibm.com>", "committedDate": "2020-08-20T11:08:20Z", "type": "forcePushed"}, {"oid": "93c69ab3f84c5a9acdff5abaf261d645d17fd9f5", "url": "https://github.com/Apicurio/apicurio-registry/commit/93c69ab3f84c5a9acdff5abaf261d645d17fd9f5", "message": "Merge branch 'master' into create-with-metadata", "committedDate": "2020-08-20T13:24:34Z", "type": "commit"}]}