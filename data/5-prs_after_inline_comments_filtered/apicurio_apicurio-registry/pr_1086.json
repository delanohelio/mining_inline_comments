{"pr_number": 1086, "pr_title": "special characters handling - % and non ASCII characters are now forbidden", "pr_createdAt": "2020-12-15T17:42:20Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/1086", "timeline": [{"oid": "e130e17c3ab3c106ada9a18c5a45d06770b6859c", "url": "https://github.com/Apicurio/apicurio-registry/commit/e130e17c3ab3c106ada9a18c5a45d06770b6859c", "message": "special characters handling - % and non ASCII characters are now forbidden", "committedDate": "2020-12-15T17:20:20Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODk5OQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1086#discussion_r544108999", "bodyText": "Since UTF-8 legacily supports ASCII, for me, +1 to UTF-8. That said if we end up using only US-ASCII characters (no accents etc) and I think that's the case here, then it shouldn't matter.", "author": "carlesarnal", "createdAt": "2020-12-16T08:37:47Z", "path": "rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClientImpl.java", "diffHunk": "@@ -438,4 +447,13 @@ public void setNextRequestHeaders(Map<String, String> headers) {\n     public Map<String, String> getHeaders() {\n         return requestHeaders.get();\n     }\n+\n+    private String encodeURIComponent(String value) {\n+        try {\n+            //TODO what to use here ASCII or UTF_8 ??", "originalCommit": "e130e17c3ab3c106ada9a18c5a45d06770b6859c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA1OTQyNA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1086#discussion_r545059424", "bodyText": "+1 to UTF-8 for me as well.  That's generally considered the right default to use in most situations.", "author": "EricWittmann", "createdAt": "2020-12-17T12:40:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDEwODk5OQ=="}], "type": "inlineReview"}, {"oid": "215cddb8f590bacd7bc9e7097e7fa1e1b9733a24", "url": "https://github.com/Apicurio/apicurio-registry/commit/215cddb8f590bacd7bc9e7097e7fa1e1b9733a24", "message": "Update ArtifactIdValidator.java", "committedDate": "2020-12-17T12:42:29Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA2MTA1Ng==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1086#discussion_r545061056", "bodyText": "Check it in the client to fail-fast, smart.", "author": "EricWittmann", "createdAt": "2020-12-17T12:43:09Z", "path": "rest-client/src/main/java/io/apicurio/registry/client/RegistryRestClientImpl.java", "diffHunk": "@@ -231,133 +237,136 @@ public ArtifactMetaData createArtifact(String artifactId, ArtifactType artifactT\n     @Override\n     public ArtifactMetaData createArtifact(String artifactId, ArtifactType artifactType, InputStream data,\n                                            IfExistsType ifExists, Boolean canonical) {\n+        if (artifactId != null && !ArtifactIdValidator.isArtifactIdAllowed(artifactId)) {\n+            throw new InvalidArtifactIdException();\n+        }", "originalCommit": "e130e17c3ab3c106ada9a18c5a45d06770b6859c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTE4MzkwNQ==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1086#discussion_r545183905", "bodyText": "not so smart, non-ASCII chars are forbidden because of okhttp which don't allow those chars in http headers", "author": "famartinrh", "createdAt": "2020-12-17T15:35:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA2MTA1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA2MjQyNg==", "url": "https://github.com/Apicurio/apicurio-registry/pull/1086#discussion_r545062426", "bodyText": "UTF8 here too I guess.", "author": "EricWittmann", "createdAt": "2020-12-17T12:45:33Z", "path": "tests/src/main/java/io/apicurio/tests/utils/subUtils/ArtifactUtils.java", "diffHunk": "@@ -206,4 +214,13 @@ public static Response createSchema(String schemeDefinition, String schemaName,\n     public static Response updateSchemaMetadata(String schemaName, String metadata, int returnCode) {\n         return putRequest(RestConstants.JSON, metadata, \"/ccompat/subjects/\" + schemaName + \"/meta\", returnCode);\n     }\n+\n+    private static String encodeURIComponent(String value) {\n+        try {\n+            //TODO what to use here ASCII or UTF_8 ??\n+            return URLEncoder.encode(value, StandardCharsets.US_ASCII.name());", "originalCommit": "e130e17c3ab3c106ada9a18c5a45d06770b6859c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f93c96a6e6db7c75530e948f27a4a99de9ea554f", "url": "https://github.com/Apicurio/apicurio-registry/commit/f93c96a6e6db7c75530e948f27a4a99de9ea554f", "message": "fix TODOs", "committedDate": "2020-12-17T16:31:41Z", "type": "commit"}]}