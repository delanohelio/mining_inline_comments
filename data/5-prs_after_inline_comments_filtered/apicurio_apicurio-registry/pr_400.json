{"pr_number": 400, "pr_title": "WIP - Support Artifact state in CCompat API", "pr_createdAt": "2020-04-28T15:31:46Z", "pr_url": "https://github.com/Apicurio/apicurio-registry/pull/400", "timeline": [{"oid": "428df615556f7cb273154219a5315f115c394c92", "url": "https://github.com/Apicurio/apicurio-registry/commit/428df615556f7cb273154219a5315f115c394c92", "message": "added checks for artifact state", "committedDate": "2020-04-28T15:33:40Z", "type": "commit"}, {"oid": "428df615556f7cb273154219a5315f115c394c92", "url": "https://github.com/Apicurio/apicurio-registry/commit/428df615556f7cb273154219a5315f115c394c92", "message": "added checks for artifact state", "committedDate": "2020-04-28T15:33:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE4Mzc5MA==", "url": "https://github.com/Apicurio/apicurio-registry/pull/400#discussion_r417183790", "bodyText": "Do we really need this check here?\nImo, this should be in Storage itself / already.\ne.g. so that storage never returns deleted or disabled artifact", "author": "alesj", "createdAt": "2020-04-29T09:30:02Z", "path": "app/src/main/java/io/apicurio/registry/ccompat/store/RegistryStorageFacadeImpl.java", "diffHunk": "@@ -82,8 +82,15 @@ public SchemaContent getSchemaContent(int globalId) throws ArtifactNotFoundExcep\n \n     @Override\n     public Schema getSchema(String subject, String versionString) throws ArtifactNotFoundException, VersionNotFoundException, RegistryStorageException {\n-        return parseVersionString(subject, versionString,\n+        Schema schema = parseVersionString(subject, versionString,\n                 version -> FacadeConverter.convert(subject, storage.getArtifactVersion(subject, version)));\n+        \n+        ArtifactMetaDataDto amd = storage.getArtifactMetaData(subject, ContentHandle.create(schema.getSchema()));\n+        if(amd.getState().equals(ArtifactState.DELETED) || amd.getState().equals(ArtifactState.DISABLED)) {", "originalCommit": "428df615556f7cb273154219a5315f115c394c92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNzE4NDA2Nw==", "url": "https://github.com/Apicurio/apicurio-registry/pull/400#discussion_r417184067", "bodyText": "Same as above.", "author": "alesj", "createdAt": "2020-04-29T09:30:31Z", "path": "app/src/main/java/io/apicurio/registry/ccompat/store/RegistryStorageFacadeImpl.java", "diffHunk": "@@ -96,10 +103,13 @@ public Schema getSchema(String subject, String versionString) throws ArtifactNot\n \n     @Override\n     public Schema getSchema(String subject, SchemaContent schema) throws ArtifactNotFoundException, RegistryStorageException {\n-        // TODO -- handle deleted?\n         ArtifactMetaDataDto amd = storage.getArtifactMetaData(subject, ContentHandle.create(schema.getSchema()));\n-        StoredArtifact storedArtifact = storage.getArtifactVersion(subject, amd.getVersion());\n-        return FacadeConverter.convert(subject, storedArtifact);\n+        if(amd.getState().equals(ArtifactState.DELETED) || amd.getState().equals(ArtifactState.DISABLED)) {", "originalCommit": "428df615556f7cb273154219a5315f115c394c92", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "bbcacf6622b217b9806716b82c4182ff062323dc", "url": "https://github.com/Apicurio/apicurio-registry/commit/bbcacf6622b217b9806716b82c4182ff062323dc", "message": "revert change", "committedDate": "2020-04-30T19:15:39Z", "type": "commit"}, {"oid": "9472a99fd60ebc3a1d11c3d34222b17759dd7f31", "url": "https://github.com/Apicurio/apicurio-registry/commit/9472a99fd60ebc3a1d11c3d34222b17759dd7f31", "message": "Merge branch 'master' into apicurio-registry-issue370", "committedDate": "2020-05-08T12:57:44Z", "type": "commit"}, {"oid": "1e92861844b07dee773585f98cf557e5e6ab064e", "url": "https://github.com/Apicurio/apicurio-registry/commit/1e92861844b07dee773585f98cf557e5e6ab064e", "message": "Merge branch 'master' into apicurio-registry-issue370", "committedDate": "2020-05-12T12:18:07Z", "type": "commit"}, {"oid": "58e70cf7c4c7efe5002ad2c6fd3bbae374495255", "url": "https://github.com/Apicurio/apicurio-registry/commit/58e70cf7c4c7efe5002ad2c6fd3bbae374495255", "message": "Merge branch 'master' into apicurio-registry-issue370", "committedDate": "2020-05-12T15:08:25Z", "type": "commit"}]}