{"pr_number": 2160, "pr_title": "Do not reference units by ID if an object reference will do", "pr_createdAt": "2020-10-22T19:09:46Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2160", "timeline": [{"oid": "0637c9d04376fbc5378a09826bdd58e1092b97f0", "url": "https://github.com/MegaMek/mekhq/commit/0637c9d04376fbc5378a09826bdd58e1092b97f0", "message": "Use Units rather than their IDs", "committedDate": "2020-10-22T19:07:25Z", "type": "commit"}, {"oid": "d25f391110cab3b64118d5963e321c379f8ab3ec", "url": "https://github.com/MegaMek/mekhq/commit/d25f391110cab3b64118d5963e321c379f8ab3ec", "message": "Do not use Unit IDs in Refits", "committedDate": "2020-10-22T19:07:25Z", "type": "commit"}, {"oid": "0e7a859495a3f7fcb179b9877dca6bc6613843d6", "url": "https://github.com/MegaMek/mekhq/commit/0e7a859495a3f7fcb179b9877dca6bc6613843d6", "message": "Only compare units by ID", "committedDate": "2020-10-22T19:07:25Z", "type": "commit"}, {"oid": "8e1ff2499e69ae54242c160c64db140bc2a9248c", "url": "https://github.com/MegaMek/mekhq/commit/8e1ff2499e69ae54242c160c64db140bc2a9248c", "message": "Add test coverage for person+unit related methods", "committedDate": "2020-10-22T19:07:25Z", "type": "commit"}, {"oid": "299d9185f7dc9a16d7d98448b065f809579a5c15", "url": "https://github.com/MegaMek/mekhq/commit/299d9185f7dc9a16d7d98448b065f809579a5c15", "message": "Add more tests for a person based on their unit", "committedDate": "2020-10-22T19:07:25Z", "type": "commit"}, {"oid": "5a214273498198797a4351c407aa82cc2a05d63e", "url": "https://github.com/MegaMek/mekhq/commit/5a214273498198797a4351c407aa82cc2a05d63e", "message": "Update UnitPersonTests", "committedDate": "2020-10-22T19:07:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNTAxNg==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510425016", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        if (ship.isSalvage() || ship.getCommander() == null) {\n          \n          \n            \n                                        if (ship.isSalvage() || (ship.getCommander() == null)) {", "author": "Windchild292", "createdAt": "2020-10-22T20:05:45Z", "path": "MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java", "diffHunk": "@@ -1365,11 +1365,12 @@ private void maybeShowPopup(MouseEvent e) {\n                         //is in a basic state that can accept units. Capacity gets checked once the action\n                         //is submitted.\n                         menu = new JMenu(\"Assign Unit to Transport Ship\");\n-                        for (UUID id : gui.getCampaign().getTransportShips()) {\n-                            Unit ship = gui.getCampaign().getUnit(id);\n-                            if (ship == null || ship.isSalvage() || ship.getCommander() == null) {\n+                        for (Unit ship : gui.getCampaign().getTransportShips()) {\n+                            if (ship.isSalvage() || ship.getCommander() == null) {", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNTIwNA==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510425204", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                        if (ship.isSalvage() || ship.getCommander() == null) {\n          \n          \n            \n                                        if (ship.isSalvage() || (ship.getCommander() == null)) {", "author": "Windchild292", "createdAt": "2020-10-22T20:06:07Z", "path": "MekHQ/src/mekhq/gui/adapter/TOEMouseAdapter.java", "diffHunk": "@@ -1011,12 +1011,12 @@ private void maybeShowPopup(MouseEvent e) {\n                     //Only display the Assign to Ship command if your command has at least 1 valid transport\n                     //and if your selection does not include a transport\n                     if (!shipInSelection && !gui.getCampaign().getTransportShips().isEmpty()) {\n-                        for (UUID id : gui.getCampaign().getTransportShips()) {\n-                            Unit ship = gui.getCampaign().getUnit(id);\n-                            if (ship == null || ship.isSalvage() || ship.getCommander() == null) {\n+                        for (Unit ship : gui.getCampaign().getTransportShips()) {\n+                            if (ship.isSalvage() || ship.getCommander() == null) {", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNjcxOQ==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510426719", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            && (((BaArmor)part).getType() == getType());\n          \n          \n            \n                            && (((BaArmor) part).getType() == getType());", "author": "Windchild292", "createdAt": "2020-10-22T20:09:03Z", "path": "MekHQ/src/mekhq/campaign/parts/BaArmor.java", "diffHunk": "@@ -90,50 +88,50 @@ public Money getPointCost() {\n             return Money.of(10000);\n         }\n     }\n-    \n+\n     private double getPointsPerTon() {\n         return getPointsPerTon(type, clan);\n     }\n-    \n+\n     @Override\n     public int getType() {\n         return type;\n     }\n-    \n+\n     @Override\n     public Money getCurrentValue() {\n         return getPointCost().multipliedBy(amount);\n     }\n-    \n+\n     @Override\n     public double getTonnageNeeded() {\n         return amountNeeded / getPointsPerTon();\n     }\n-    \n+\n     @Override\n     public Money getValueNeeded() {\n         return adjustCostsForCampaignOptions(getPointCost().multipliedBy(amountNeeded));\n     }\n-    \n+\n     @Override\n     public Money getStickerPrice() {\n         //always in 5-ton increments\n         return getPointCost().multipliedBy(5).multipliedBy(getPointsPerTon());\n     }\n-    \n+\n     @Override\n     public Money getBuyCost() {\n         return getStickerPrice();\n     }\n-    \n+\n     @Override\n     public boolean isSamePartType(Part part) {\n-        return part instanceof BaArmor\n-                && isClanTechBase() == part.isClanTechBase()\n-                && Objects.equals(getRefitId(), part.getRefitId())\n-                && ((BaArmor)part).getType() == getType();\n+        return (part instanceof BaArmor)\n+                && (isClanTechBase() == part.isClanTechBase())\n+                && (getRefitUnit() == part.getRefitUnit())\n+                && (((BaArmor)part).getType() == getType());", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyNzk5MA==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510427990", "bodyText": "I love this variable name", "author": "Windchild292", "createdAt": "2020-10-22T20:11:07Z", "path": "MekHQ/src/mekhq/campaign/personnel/Person.java", "diffHunk": "@@ -947,15 +943,13 @@ public void changeStatus(Campaign campaign, PersonnelStatus status) {\n         if (!status.isActive()) {\n             setDoctorId(null, campaign.getCampaignOptions().getNaturalHealingWaitingPeriod());\n             // If we're assigned to a unit, remove us from it\n-            Unit unit = campaign.getUnit(getUnitId());\n-            if (unit != null) {\n-                unit.remove(this, true);\n+            if (getUnit() != null) {\n+                getUnit().remove(this, true);\n             }\n \n             // If we're assigned as a tech for any unit, remove us from it/them\n-            for (UUID techUnitId : new ArrayList<>(getTechUnitIDs())) {\n-                unit = campaign.getUnit(techUnitId);\n-                unit.remove(this, true);\n+            for (Unit unitWeTech : new ArrayList<>(getTechUnits())) {\n+                unitWeTech.remove(this, true);", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyODg3NQ==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510428875", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (driver.getStatus().isActive() && driver.getUnit() == null) {\n          \n          \n            \n                        if (driver.getStatus().isActive() && (driver.getUnit() == null)) {", "author": "Windchild292", "createdAt": "2020-10-22T20:12:53Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -85,7 +85,7 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n         }\n \n         for (Person driver : drivers) {\n-            if (driver.getStatus().isActive() && (driver.getUnitId() == null)) {\n+            if (driver.getStatus().isActive() && driver.getUnit() == null) {", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyOTA3NQ==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510429075", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (crew.getStatus().isActive() && crew.getUnit() == null) {\n          \n          \n            \n                        if (crew.getStatus().isActive() && (crew.getUnit() == null)) {", "author": "Windchild292", "createdAt": "2020-10-22T20:13:14Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -94,22 +94,22 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n             // add the gunner if they exist, aren't dead/retired/etc and aren't already assigned to some\n             // other unit. Caveat: single-person units have the same driver and gunner.\n             if (gunner.getStatus().isActive() &&\n-                    ((gunner.getUnitId() == null) || (gunner.getUnitId() == unit.getId()))) {\n+                    ((gunner.getUnit() == null) || (gunner.getUnit() == unit))) {\n                 unit.addGunner(gunner);\n             }\n         }\n \n         for (Person crew : vesselCrew) {\n-            if (crew.getStatus().isActive() && (crew.getUnitId() == null)) {\n+            if (crew.getStatus().isActive() && crew.getUnit() == null) {", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyOTI4OA==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510429288", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (techOfficer != null && techOfficer.getStatus().isActive() && techOfficer.getUnit() == null) {\n          \n          \n            \n                    if ((techOfficer != null) && (techOfficer.getStatus().isActive()) && (techOfficer.getUnit() == null)) {", "author": "Windchild292", "createdAt": "2020-10-22T20:13:34Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -94,22 +94,22 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n             // add the gunner if they exist, aren't dead/retired/etc and aren't already assigned to some\n             // other unit. Caveat: single-person units have the same driver and gunner.\n             if (gunner.getStatus().isActive() &&\n-                    ((gunner.getUnitId() == null) || (gunner.getUnitId() == unit.getId()))) {\n+                    ((gunner.getUnit() == null) || (gunner.getUnit() == unit))) {\n                 unit.addGunner(gunner);\n             }\n         }\n \n         for (Person crew : vesselCrew) {\n-            if (crew.getStatus().isActive() && (crew.getUnitId() == null)) {\n+            if (crew.getStatus().isActive() && crew.getUnit() == null) {\n                 unit.addVesselCrew(crew);\n             }\n         }\n \n-        if (techOfficer != null && techOfficer.getStatus().isActive() && techOfficer.getUnitId() == null) {\n+        if (techOfficer != null && techOfficer.getStatus().isActive() && techOfficer.getUnit() == null) {", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDQyOTUyMQ==", "url": "https://github.com/MegaMek/mekhq/pull/2160#discussion_r510429521", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    if (navigator != null && navigator.getStatus().isActive() && navigator.getUnit() == null) {\n          \n          \n            \n                    if ((navigator != null) && (navigator.getStatus().isActive()) && (navigator.getUnit() == null)) {", "author": "Windchild292", "createdAt": "2020-10-22T20:13:52Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -94,22 +94,22 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n             // add the gunner if they exist, aren't dead/retired/etc and aren't already assigned to some\n             // other unit. Caveat: single-person units have the same driver and gunner.\n             if (gunner.getStatus().isActive() &&\n-                    ((gunner.getUnitId() == null) || (gunner.getUnitId() == unit.getId()))) {\n+                    ((gunner.getUnit() == null) || (gunner.getUnit() == unit))) {\n                 unit.addGunner(gunner);\n             }\n         }\n \n         for (Person crew : vesselCrew) {\n-            if (crew.getStatus().isActive() && (crew.getUnitId() == null)) {\n+            if (crew.getStatus().isActive() && crew.getUnit() == null) {\n                 unit.addVesselCrew(crew);\n             }\n         }\n \n-        if (techOfficer != null && techOfficer.getStatus().isActive() && techOfficer.getUnitId() == null) {\n+        if (techOfficer != null && techOfficer.getStatus().isActive() && techOfficer.getUnit() == null) {\n             unit.setTechOfficer(techOfficer);\n         }\n \n-        if (navigator != null && navigator.getStatus().isActive() && navigator.getUnitId() == null) {\n+        if (navigator != null && navigator.getStatus().isActive() && navigator.getUnit() == null) {", "originalCommit": "5a214273498198797a4351c407aa82cc2a05d63e", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f7c4a6e53f06195cc441463176d994c0e53633cc", "url": "https://github.com/MegaMek/mekhq/commit/f7c4a6e53f06195cc441463176d994c0e53633cc", "message": "Apply suggestions from code review\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-10-24T17:48:24Z", "type": "commit"}, {"oid": "002f5f78f3930db9401a34018d4a0d6f3a4efbaa", "url": "https://github.com/MegaMek/mekhq/commit/002f5f78f3930db9401a34018d4a0d6f3a4efbaa", "message": "Address previous review comments", "committedDate": "2020-10-24T18:22:27Z", "type": "commit"}, {"oid": "599b0a3158d94a3eea50fe8314c55177a344c2a9", "url": "https://github.com/MegaMek/mekhq/commit/599b0a3158d94a3eea50fe8314c55177a344c2a9", "message": "Merge remote-tracking branch 'upstream/master' into use-units-not-ids", "committedDate": "2020-10-24T18:22:32Z", "type": "commit"}, {"oid": "1d9b9a6ee2a71f128d65bb7754463be3ca9a71bc", "url": "https://github.com/MegaMek/mekhq/commit/1d9b9a6ee2a71f128d65bb7754463be3ca9a71bc", "message": "Address LGTM issues", "committedDate": "2020-10-24T18:26:31Z", "type": "commit"}, {"oid": "9f22e79abf71f3d8cf935d5d83d4790af02b32ce", "url": "https://github.com/MegaMek/mekhq/commit/9f22e79abf71f3d8cf935d5d83d4790af02b32ce", "message": "Add tests for transport unit sets", "committedDate": "2020-10-24T18:48:29Z", "type": "commit"}]}