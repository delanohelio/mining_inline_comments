{"pr_number": 2123, "pr_title": "Split Unit duties into a Hangar class", "pr_createdAt": "2020-10-05T20:43:49Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2123", "timeline": [{"oid": "e145018d37220795b2c41652acca0ebf724a1770", "url": "https://github.com/MegaMek/mekhq/commit/e145018d37220795b2c41652acca0ebf724a1770", "message": "Add a Hangar class to handle unit related actions", "committedDate": "2020-10-06T19:13:39Z", "type": "commit"}, {"oid": "c830304a7dc1c67a19f9a76be2f76e290c33953a", "url": "https://github.com/MegaMek/mekhq/commit/c830304a7dc1c67a19f9a76be2f76e290c33953a", "message": "Move the Campaign to use the new Hangar", "committedDate": "2020-10-06T19:13:39Z", "type": "commit"}, {"oid": "0fbf6ddf6ab8334212a53acc4413373866a0b70b", "url": "https://github.com/MegaMek/mekhq/commit/0fbf6ddf6ab8334212a53acc4413373866a0b70b", "message": "Rename Campaign::addUnit to addNewUnit", "committedDate": "2020-10-06T19:13:39Z", "type": "commit"}, {"oid": "211a0bb678070803c080859b84d42ddfc9c385c2", "url": "https://github.com/MegaMek/mekhq/commit/211a0bb678070803c080859b84d42ddfc9c385c2", "message": "Split out sorted views of the hangar into HangarSorter", "committedDate": "2020-10-06T19:13:40Z", "type": "commit"}, {"oid": "8a8709b596b25c291adb76fdb772eaa1f503729f", "url": "https://github.com/MegaMek/mekhq/commit/8a8709b596b25c291adb76fdb772eaa1f503729f", "message": "Move specialized requirements on getUnits to callers", "committedDate": "2020-10-06T19:13:40Z", "type": "commit"}, {"oid": "eb461f07fa33a6b4ea2ca65fa5de5b7ebafce619", "url": "https://github.com/MegaMek/mekhq/commit/eb461f07fa33a6b4ea2ca65fa5de5b7ebafce619", "message": "Transition away from Campaign::getUnits", "committedDate": "2020-10-06T19:14:26Z", "type": "commit"}, {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "url": "https://github.com/MegaMek/mekhq/commit/02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "message": "Remove unnecessary import", "committedDate": "2020-10-06T19:14:28Z", "type": "commit"}, {"oid": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "url": "https://github.com/MegaMek/mekhq/commit/02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "message": "Remove unnecessary import", "committedDate": "2020-10-06T19:14:28Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0ODA4NA==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500548084", "bodyText": "Tab spacing", "author": "Windchild292", "createdAt": "2020-10-06T19:35:50Z", "path": "MekHQ/src/mekhq/gui/dialog/PersonnelMarketDialog.java", "diffHunk": "@@ -365,14 +365,7 @@ private void addUnit(Entity en, boolean pay) {\n \t\t\t\tcampaign.getLocalDate())) {\n \t\t\treturn;\n \t\t}\n-\t\tcampaign.addUnit(en, false, 0);\n-\t\tUnit unit = null;\n-\t\tfor (Unit u : campaign.getUnits()) {\n-\t\t\tif (u.getEntity() == en) {\n-\t\t\t\tunit = u;\n-\t\t\t\tbreak;\n-\t\t\t}\n-        }\n+\t\tUnit unit = campaign.addNewUnit(en, false, 0);\n         if (unit == null) {\n             // No such unit matching the entity.\n             return;", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NjA1NA==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500566054", "bodyText": "Swore I got all of these, may not have pushed the change.", "author": "sixlettervariables", "createdAt": "2020-10-06T20:09:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU0ODA4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MDAwNg==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500550006", "bodyText": "We should never have a null unit, so we probably want to fix the backend reason for this check if it still exists", "author": "Windchild292", "createdAt": "2020-10-06T19:39:36Z", "path": "MekHQ/src/mekhq/campaign/rating/CampaignOpsReputation.java", "diffHunk": "@@ -248,8 +247,7 @@ private int getTotalForceUnits() {\n         // Count total units for transport\n         getTotalCombatUnits();\n \n-        List<Unit> unitList = getCampaign().getCopyOfUnits();\n-        for (Unit u : unitList) {\n+        for (Unit u : getCampaign().getHangar().getUnits()) {\n             if (u == null) {\n                 continue;\n             }", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1MjY0Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500552647", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if(j == units.size()) {\n          \n          \n            \n                        if (j == units.size()) {", "author": "Windchild292", "createdAt": "2020-10-06T19:44:38Z", "path": "MekHQ/src/mekhq/gui/dialog/PayCollateralDialog.java", "diffHunk": "@@ -137,7 +137,7 @@ private void initComponents() {\n             gridBagConstraints.anchor = java.awt.GridBagConstraints.NORTHWEST;\n             gridBagConstraints.fill = GridBagConstraints.HORIZONTAL;\n             gridBagConstraints.weightx = 1.0;\n-            if(j == (units.size())) {\n+            if(j == units.size()) {", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NDYwMw==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500554603", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    UUID id = unit.getId();\n          \n          \n            \n                    if (id == null) {\n          \n          \n            \n                        id = UUID.randomUUID();\n          \n          \n            \n                        unit.setId(id);\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    units.put(id, unit);\n          \n          \n            \n                    if (unit.getId() == null) {\n          \n          \n            \n                        unit.setId(UUID.randomUUID());\n          \n          \n            \n                    }\n          \n          \n            \n            \n          \n          \n            \n                    units.put(unit.getId(), unit);", "author": "Windchild292", "createdAt": "2020-10-06T19:48:27Z", "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NTU3OQ==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500555579", "bodyText": "Just an idea, because this is a default getter it should be fine", "author": "Windchild292", "createdAt": "2020-10-06T19:50:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NDYwMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1NzU4Mw==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500557583", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent) + \"<\" + tag + \">\");\n          \n          \n            \n                    MekHqXmlUtil.writeSimpleXMLOpenIndentedLine(pw1, indent, tag);", "author": "Windchild292", "createdAt": "2020-10-06T19:54:06Z", "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);\n+    }\n+\n+    /**\n+     * Gets a unit by a given ID.\n+     * @param id The unique identifier of a unit.\n+     * @return The unit matching the unique identifier,\n+     *         otherwise null if that unit does not exist.\n+     */\n+    public Unit getUnit(UUID id) {\n+        return units.get(id);\n+    }\n+\n+    /**\n+     * Gets a collection of units in the hangar.\n+     * @return A collection of units in the hangar.\n+     */\n+    public Collection<Unit> getUnits() {\n+        return units.values();\n+    }\n+\n+    /**\n+     * Gets a Stream of units in the hangar.\n+     * @return A Stream of units in the hangar.\n+     */\n+    public Stream<Unit> getUnitsStream() {\n+        return units.values().stream();\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units in the hangar.\n+     * @param getCosts A function which returns a cost for a unit.\n+     * @return The total costs for the units.\n+     */\n+    public Money getUnitCosts(Function<Unit, Money> getCosts) {\n+        return getUnitsStream().map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units matching a predicate\n+     * in the hangar.\n+     * @param predicate A function to use to select a unit.\n+     * @param getCosts A function which returns a cost for a selected unit.\n+     * @return The total costs for the units selected by the predicate.\n+     */\n+    public Money getUnitCosts(Predicate<Unit> predicate, Function<Unit, Money> getCosts) {\n+        return getUnitsStream().filter(predicate).map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each unit.\n+     */\n+    public void forEachUnit(Consumer<Unit> consumer) {\n+        units.forEach((id, unit) -> consumer.accept(unit));\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each ID-unit pair.\n+     */\n+    public void forEachUnit(BiConsumer<UUID, Unit> consumer) {\n+        units.forEach(consumer);\n+    }\n+\n+    /**\n+     * Searches for a specific unit using the given predicate.\n+     * @param predicate A function to use to select a given unit.\n+     * @return The first unit found which matches the predicate,\n+     *         otherwise null if no unit was found.\n+     */\n+    public Unit findUnit(Predicate<Unit> predicate) {\n+        if (predicate == null) {\n+            return null;\n+        }\n+\n+        for (Unit unit : units.values()) {\n+            if (predicate.test(unit)) {\n+                return unit;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Removes a unit from the hangar.\n+     * @param id The unit ID.\n+     * @return true if the unit was removed, otherwise false.\n+     */\n+    public boolean removeUnit(UUID id) {\n+        return null != units.remove(id);\n+    }\n+\n+\tpublic void writeToXml(PrintWriter pw1, int indent, String tag) {\n+        pw1.println(MekHqXmlUtil.indentStr(indent) + \"<\" + tag + \">\");", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU1ODAyNQ==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500558025", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent) + \"</\" + tag + \">\");\n          \n          \n            \n                    MekHqXmlUtil.writeSimpleXMLCloseIndentedLine(pw1, indent, tag);", "author": "Windchild292", "createdAt": "2020-10-06T19:54:57Z", "path": "MekHQ/src/mekhq/campaign/Hangar.java", "diffHunk": "@@ -0,0 +1,166 @@\n+/*\n+ * Hangar.java\n+ *\n+ * Copyright (c) 2020 - The MegaMek Team. All Rights Reserved.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ. If not, see <http://www.gnu.org/licenses/>.\n+ */\n+\n+package mekhq.campaign;\n+\n+import java.io.PrintWriter;\n+import java.util.Collection;\n+import java.util.LinkedHashMap;\n+import java.util.Map;\n+import java.util.UUID;\n+import java.util.function.BiConsumer;\n+import java.util.function.Consumer;\n+import java.util.function.Function;\n+import java.util.function.Predicate;\n+import java.util.stream.Stream;\n+\n+import mekhq.MekHqXmlUtil;\n+import mekhq.campaign.finances.Money;\n+import mekhq.campaign.unit.Unit;\n+\n+/**\n+ * Represents a hangar which contains zero or more units.\n+ */\n+public class Hangar {\n+    private Map<UUID, Unit> units = new LinkedHashMap<>();\n+\n+    /**\n+     * Adds a unit to the hangar.\n+     *\n+     * If the unit does not have an ID, one is\n+     * assigned to it.\n+     *\n+     * @param unit The unit to add to the hangar.\n+     */\n+    public void addUnit(Unit unit) {\n+        if (unit == null) {\n+            return;\n+        }\n+\n+        UUID id = unit.getId();\n+        if (id == null) {\n+            id = UUID.randomUUID();\n+            unit.setId(id);\n+        }\n+\n+        units.put(id, unit);\n+    }\n+\n+    /**\n+     * Gets a unit by a given ID.\n+     * @param id The unique identifier of a unit.\n+     * @return The unit matching the unique identifier,\n+     *         otherwise null if that unit does not exist.\n+     */\n+    public Unit getUnit(UUID id) {\n+        return units.get(id);\n+    }\n+\n+    /**\n+     * Gets a collection of units in the hangar.\n+     * @return A collection of units in the hangar.\n+     */\n+    public Collection<Unit> getUnits() {\n+        return units.values();\n+    }\n+\n+    /**\n+     * Gets a Stream of units in the hangar.\n+     * @return A Stream of units in the hangar.\n+     */\n+    public Stream<Unit> getUnitsStream() {\n+        return units.values().stream();\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units in the hangar.\n+     * @param getCosts A function which returns a cost for a unit.\n+     * @return The total costs for the units.\n+     */\n+    public Money getUnitCosts(Function<Unit, Money> getCosts) {\n+        return getUnitsStream().map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Calculates the total costs for the units matching a predicate\n+     * in the hangar.\n+     * @param predicate A function to use to select a unit.\n+     * @param getCosts A function which returns a cost for a selected unit.\n+     * @return The total costs for the units selected by the predicate.\n+     */\n+    public Money getUnitCosts(Predicate<Unit> predicate, Function<Unit, Money> getCosts) {\n+        return getUnitsStream().filter(predicate).map(getCosts).reduce(Money.zero(), Money::plus);\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each unit.\n+     */\n+    public void forEachUnit(Consumer<Unit> consumer) {\n+        units.forEach((id, unit) -> consumer.accept(unit));\n+    }\n+\n+    /**\n+     * Executes a function for each unit in the hangar.\n+     * @param consumer A function to apply to each ID-unit pair.\n+     */\n+    public void forEachUnit(BiConsumer<UUID, Unit> consumer) {\n+        units.forEach(consumer);\n+    }\n+\n+    /**\n+     * Searches for a specific unit using the given predicate.\n+     * @param predicate A function to use to select a given unit.\n+     * @return The first unit found which matches the predicate,\n+     *         otherwise null if no unit was found.\n+     */\n+    public Unit findUnit(Predicate<Unit> predicate) {\n+        if (predicate == null) {\n+            return null;\n+        }\n+\n+        for (Unit unit : units.values()) {\n+            if (predicate.test(unit)) {\n+                return unit;\n+            }\n+        }\n+        return null;\n+    }\n+\n+    /**\n+     * Removes a unit from the hangar.\n+     * @param id The unit ID.\n+     * @return true if the unit was removed, otherwise false.\n+     */\n+    public boolean removeUnit(UUID id) {\n+        return null != units.remove(id);\n+    }\n+\n+\tpublic void writeToXml(PrintWriter pw1, int indent, String tag) {\n+        pw1.println(MekHqXmlUtil.indentStr(indent) + \"<\" + tag + \">\");\n+\n+        forEachUnit(unit -> {\n+            unit.writeToXml(pw1, indent + 1);\n+        });\n+\n+        pw1.println(MekHqXmlUtil.indentStr(indent) + \"</\" + tag + \">\");", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MDg3Ng==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500560876", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            .filter(u -> u.requiresMaintenance() && null != u.getTech())\n          \n          \n            \n                            .filter(u -> u.requiresMaintenance() && (null != u.getTech()))", "author": "Windchild292", "createdAt": "2020-10-06T20:00:17Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3676,24 +3617,19 @@ private Money getTheoreticalPayroll(boolean noInfantry) {\n     }\n \n     public Money getMaintenanceCosts() {\n-        Money costs = Money.zero();\n         if (campaignOptions.payForMaintain()) {\n-            for (Map.Entry<UUID, Unit> mu : units.entrySet()) {\n-                Unit u = mu.getValue();\n-                if (u.requiresMaintenance() && null != u.getTech()) {\n-                    costs = costs.plus(u.getMaintenanceCost());\n-                }\n-            }\n+            return getHangar().getUnitsStream()\n+                .filter(u -> u.requiresMaintenance() && null != u.getTech())", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzMxMg==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563312", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:04:38Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzQzNQ==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563435", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:04:50Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzUyMg==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563522", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:04:57Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2MzU5Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500563597", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:05:02Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDA0Mw==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564043", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:05:48Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getInfantryCapacity)\n+            .sum());\n     }\n \n     public int getTotalHeavyVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getHeavyVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getHeavyVehicleCapacity)\n+            .sum());\n     }\n \n     public int getTotalLightVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getLightVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDA4NA==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564084", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:05:54Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getInfantryCapacity)\n+            .sum());\n     }\n \n     public int getTotalHeavyVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getHeavyVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDEzNA==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564134", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:06:00Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NDMwOQ==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500564309", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    return (int)Math.round(getHangar().getUnitsStream()\n          \n          \n            \n                    return (int) Math.round(getHangar().getUnitsStream()", "author": "Windchild292", "createdAt": "2020-10-06T20:06:23Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -7236,117 +7172,88 @@ public void setHealingTimeOptions(int newHeal, int newNaturalHeal) {\n     }\n \n     public int getTotalMechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getMechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getMechCapacity)\n+            .sum());\n     }\n \n     public int getTotalASFBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getASFCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getASFCapacity)\n+            .sum());\n     }\n \n     public int getTotalSmallCraftBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getSmallCraftCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getSmallCraftCapacity)\n+            .sum());\n     }\n \n     public int getTotalBattleArmorBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getBattleArmorCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getBattleArmorCapacity)\n+            .sum());\n     }\n \n     public int getTotalInfantryBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getInfantryCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getInfantryCapacity)\n+            .sum());\n     }\n \n     public int getTotalHeavyVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getHeavyVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getHeavyVehicleCapacity)\n+            .sum());\n     }\n \n     public int getTotalLightVehicleBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getLightVehicleCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()\n+            .mapToDouble(Unit::getLightVehicleCapacity)\n+            .sum());\n     }\n \n     public int getTotalProtomechBays() {\n-        double bays = 0;\n-        for (Unit u : getUnits()) {\n-            bays += u.getProtomechCapacity();\n-        }\n-        return (int)Math.round(bays);\n+        return (int)Math.round(getHangar().getUnitsStream()", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDU2NTE4OA==", "url": "https://github.com/MegaMek/mekhq/pull/2123#discussion_r500565188", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                                            if (null != p.getUnitId() && null != getHangar().getUnit(p.getUnitId())\n          \n          \n            \n                                            if ((null != p.getUnitId()) && (null != getHangar().getUnit(p.getUnitId()))", "author": "Windchild292", "createdAt": "2020-10-06T20:08:06Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -8194,8 +8101,8 @@ public void initAtB(boolean newCampaign) {\n                                     // TODO : Fix this so we aren't using a hack that just assumes IS2\n                                     p.setOriginalUnitTech(Person.TECH_IS2);\n                                 }\n-                                if (null != p.getUnitId() && null != units.get(p.getUnitId())\n-                                        && ms.getName().equals(units.get(p.getUnitId()).getEntity().getShortNameRaw())) {\n+                                if (null != p.getUnitId() && null != getHangar().getUnit(p.getUnitId())", "originalCommit": "02cf732d561f245a8a8d39a2b8a819cb45ac94ca", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cb64714e6e2b7d03de487c72eb18c3c09948b6c6", "url": "https://github.com/MegaMek/mekhq/commit/cb64714e6e2b7d03de487c72eb18c3c09948b6c6", "message": "Apply suggestions from code review\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-10-07T03:24:27Z", "type": "commit"}, {"oid": "6017ea3690ecd5a4a3fa881bc208359bfe7d2d61", "url": "https://github.com/MegaMek/mekhq/commit/6017ea3690ecd5a4a3fa881bc208359bfe7d2d61", "message": "Address PR feedback", "committedDate": "2020-10-07T18:17:15Z", "type": "commit"}]}