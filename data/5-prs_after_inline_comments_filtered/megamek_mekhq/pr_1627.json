{"pr_number": 1627, "pr_title": "PersonnelTableModel: GM Menu Only Shows for GMs", "pr_createdAt": "2020-04-03T19:18:01Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1627", "timeline": [{"oid": "dd227f4f4514819807fd919a437c933792bc587f", "url": "https://github.com/MegaMek/mekhq/commit/dd227f4f4514819807fd919a437c933792bc587f", "message": "Creating a proper GM menu in PersonnelTableMouseAdapter", "committedDate": "2020-04-03T18:18:23Z", "type": "commit"}, {"oid": "b6b34d0906f0d29b8d9117aef96180c889050b67", "url": "https://github.com/MegaMek/mekhq/commit/b6b34d0906f0d29b8d9117aef96180c889050b67", "message": "Adding canProcreate function", "committedDate": "2020-04-03T18:18:50Z", "type": "commit"}, {"oid": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "url": "https://github.com/MegaMek/mekhq/commit/e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "message": "Fixing the menu that add/remove pregnancy are on", "committedDate": "2020-04-03T18:28:09Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwNjk0Nw==", "url": "https://github.com/MegaMek/mekhq/pull/1627#discussion_r403306947", "bodyText": "Change: removed pregnancy from here", "author": "Windchild292", "createdAt": "2020-04-03T20:25:27Z", "path": "MekHQ/src/mekhq/gui/adapter/PersonnelTableMouseAdapter.java", "diffHunk": "@@ -1671,22 +1671,7 @@ private void maybeShowPopup(MouseEvent e) {\n             cbMenuItem.setActionCommand(makeCommand(CMD_REMOVE_UNIT, \"-1\")); //$NON-NLS-1$\n             cbMenuItem.addActionListener(this);\n             menu.add(cbMenuItem);\n-            if (oneSelected) {\n-                if (!person.isChild() && (person.isFemale()) && !person.isPregnant()) {\n-                    menuItem = new JMenuItem(resourceMap.getString(\"addPregnancy.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_ADD_PREGNANCY);\n-                    menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n-                    popup.add(menuItem);\n-                }\n-                if (person.isPregnant()) {\n-                    menuItem = new JMenuItem(resourceMap.getString(\"removePregnancy.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_REMOVE_PREGNANCY);\n-                    menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n-                    popup.add(menuItem);\n-                }\n-            }", "originalCommit": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwNzU3Nw==", "url": "https://github.com/MegaMek/mekhq/pull/1627#discussion_r403307577", "bodyText": "Change, only add the GM menu if you are a GM", "author": "Windchild292", "createdAt": "2020-04-03T20:26:17Z", "path": "MekHQ/src/mekhq/gui/adapter/PersonnelTableMouseAdapter.java", "diffHunk": "@@ -2492,108 +2501,125 @@ private void maybeShowPopup(MouseEvent e) {\n             menuItem.addActionListener(ev -> gui.miExportPersonActionPerformed(ev));\n             menuItem.setEnabled(true);\n             popup.add(menuItem);\n+\n             if (gui.getCampaign().getCampaignOptions().getUseAtB()\n                     && StaticChecks.areAllActive(selected)) {\n                 menuItem = new JMenuItem(resourceMap.getString(\"sack.text\")); //$NON-NLS-1$\n                 menuItem.setActionCommand(CMD_SACK);\n                 menuItem.addActionListener(this);\n                 popup.add(menuItem);\n             }\n-            menu = new JMenu(resourceMap.getString(\"gmMode.text\")); //$NON-NLS-1$\n-\n-            menuItem = new JMenu(resourceMap.getString(\"changePrisonerStatus.text\")); //$NON-NLS-1$\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_NOT),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_FREE),\n-                    person.getPrisonerStatus() == Person.PRISONER_NOT));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_YES),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && !person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    resourceMap.getString(\"prisonerWillingToDefect.text\"), //$NON-NLS-1$\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED_DEFECTING),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_BONDSMAN),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_BONDSMAN),\n-                    person.getPrisonerStatus() == Person.PRISONER_BONDSMAN));\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-\n-            menuItem = new JMenuItem(resourceMap.getString(\"removePerson.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_REMOVE);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            if (!gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"editHits.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_EDIT_HITS);\n+\n+            //region GM Menu\n+            if (gui.getCampaign().isGM()) {\n+                popup.addSeparator();", "originalCommit": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzMwODMzOA==", "url": "https://github.com/MegaMek/mekhq/pull/1627#discussion_r403308338", "bodyText": "Moved procreation to here", "author": "Windchild292", "createdAt": "2020-04-03T20:27:15Z", "path": "MekHQ/src/mekhq/gui/adapter/PersonnelTableMouseAdapter.java", "diffHunk": "@@ -2492,108 +2501,125 @@ private void maybeShowPopup(MouseEvent e) {\n             menuItem.addActionListener(ev -> gui.miExportPersonActionPerformed(ev));\n             menuItem.setEnabled(true);\n             popup.add(menuItem);\n+\n             if (gui.getCampaign().getCampaignOptions().getUseAtB()\n                     && StaticChecks.areAllActive(selected)) {\n                 menuItem = new JMenuItem(resourceMap.getString(\"sack.text\")); //$NON-NLS-1$\n                 menuItem.setActionCommand(CMD_SACK);\n                 menuItem.addActionListener(this);\n                 popup.add(menuItem);\n             }\n-            menu = new JMenu(resourceMap.getString(\"gmMode.text\")); //$NON-NLS-1$\n-\n-            menuItem = new JMenu(resourceMap.getString(\"changePrisonerStatus.text\")); //$NON-NLS-1$\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_NOT),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_FREE),\n-                    person.getPrisonerStatus() == Person.PRISONER_NOT));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_YES),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && !person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    resourceMap.getString(\"prisonerWillingToDefect.text\"), //$NON-NLS-1$\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED_DEFECTING),\n-                    (person.getPrisonerStatus() == Person.PRISONER_YES) && person.isWillingToDefect()));\n-            menuItem.add(newCheckboxMenu(\n-                    Person.getPrisonerStatusName(Person.PRISONER_BONDSMAN),\n-                    makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_BONDSMAN),\n-                    person.getPrisonerStatus() == Person.PRISONER_BONDSMAN));\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-\n-            menuItem = new JMenuItem(resourceMap.getString(\"removePerson.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_REMOVE);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            if (!gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"editHits.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_EDIT_HITS);\n+\n+            //region GM Menu\n+            if (gui.getCampaign().isGM()) {\n+                popup.addSeparator();\n+\n+                menu = new JMenu(resourceMap.getString(\"gmMode.text\")); //$NON-NLS-1$\n+\n+                menuItem = new JMenu(resourceMap.getString(\"changePrisonerStatus.text\")); //$NON-NLS-1$\n+                menuItem.add(newCheckboxMenu(\n+                        Person.getPrisonerStatusName(Person.PRISONER_NOT),\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_FREE),\n+                        person.getPrisonerStatus() == Person.PRISONER_NOT));\n+                menuItem.add(newCheckboxMenu(\n+                        Person.getPrisonerStatusName(Person.PRISONER_YES),\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED),\n+                        (person.getPrisonerStatus() == Person.PRISONER_YES) && !person.isWillingToDefect()));\n+                menuItem.add(newCheckboxMenu(\n+                        resourceMap.getString(\"prisonerWillingToDefect.text\"), //$NON-NLS-1$\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_IMPRISONED_DEFECTING),\n+                        (person.getPrisonerStatus() == Person.PRISONER_YES) && person.isWillingToDefect()));\n+                menuItem.add(newCheckboxMenu(\n+                        Person.getPrisonerStatusName(Person.PRISONER_BONDSMAN),\n+                        makeCommand(CMD_CHANGE_PRISONER_STATUS, OPT_PRISONER_BONDSMAN),\n+                        person.getPrisonerStatus() == Person.PRISONER_BONDSMAN));\n+                menu.add(menuItem);\n+\n+                menuItem = new JMenuItem(resourceMap.getString(\"removePerson.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_REMOVE);\n                 menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n                 menu.add(menuItem);\n-            }\n-            menuItem = new JMenuItem(resourceMap.getString(\"add1XP.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_ADD_1_XP);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            menuItem = new JMenuItem(resourceMap.getString(\"addXP.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_ADD_XP);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            menuItem = new JMenuItem(resourceMap.getString(\"setXP.text\")); //$NON-NLS-1$\n-            menuItem.setActionCommand(CMD_SET_XP);\n-            menuItem.addActionListener(this);\n-            menuItem.setEnabled(gui.getCampaign().isGM());\n-            menu.add(menuItem);\n-            if (gui.getCampaign().getCampaignOptions().useEdge()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"setEdge.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_SET_EDGE);\n+\n+                if (!gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n+                    menuItem = new JMenuItem(resourceMap.getString(\"editHits.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_EDIT_HITS);\n+                    menuItem.addActionListener(this);\n+                    menu.add(menuItem);\n+                }\n+\n+                menuItem = new JMenuItem(resourceMap.getString(\"add1XP.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_ADD_1_XP);\n                 menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n                 menu.add(menuItem);\n-            }\n-            if (oneSelected) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"edit.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_EDIT);\n+\n+                menuItem = new JMenuItem(resourceMap.getString(\"addXP.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_ADD_XP);\n                 menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n                 menu.add(menuItem);\n \n-                if (null == person.getUnitId()) {\n-                    menuItem = new JMenuItem(resourceMap.getString(\"rollForUnit.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_ROLL_MECH);\n+                menuItem = new JMenuItem(resourceMap.getString(\"setXP.text\")); //$NON-NLS-1$\n+                menuItem.setActionCommand(CMD_SET_XP);\n+                menuItem.addActionListener(this);\n+                menu.add(menuItem);\n+\n+                if (gui.getCampaign().getCampaignOptions().useEdge()) {\n+                    menuItem = new JMenuItem(resourceMap.getString(\"setEdge.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_SET_EDGE);\n                     menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n                     menu.add(menuItem);\n                 }\n-            }\n-            if (gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n-                menuItem = new JMenuItem(resourceMap.getString(\"removeAllInjuries.text\")); //$NON-NLS-1$\n-                menuItem.setActionCommand(CMD_CLEAR_INJURIES);\n-                menuItem.addActionListener(this);\n-                menuItem.setEnabled(gui.getCampaign().isGM());\n-                menu.add(menuItem);\n+\n                 if (oneSelected) {\n-                    for (Injury i : person.getInjuries()) {\n-                        menuItem = new JMenuItem(String.format(resourceMap.getString(\"removeInjury.format\"), i.getName())); //$NON-NLS-1$\n-                        menuItem.setActionCommand(makeCommand(CMD_REMOVE_INJURY, i.getUUID().toString()));\n+                    menuItem = new JMenuItem(resourceMap.getString(\"edit.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_EDIT);\n+                    menuItem.addActionListener(this);\n+                    menu.add(menuItem);\n+\n+                    if (person.getUnitId() == null) {\n+                        menuItem = new JMenuItem(resourceMap.getString(\"rollForUnit.text\")); //$NON-NLS-1$\n+                        menuItem.setActionCommand(CMD_ROLL_MECH);\n                         menuItem.addActionListener(this);\n-                        menuItem.setEnabled(gui.getCampaign().isGM());\n                         menu.add(menuItem);\n                     }\n-\n-                    menuItem = new JMenuItem(resourceMap.getString(\"editInjuries.text\")); //$NON-NLS-1$\n-                    menuItem.setActionCommand(CMD_EDIT_INJURIES);\n+                }\n+                if (gui.getCampaign().getCampaignOptions().useAdvancedMedical()) {\n+                    menuItem = new JMenuItem(resourceMap.getString(\"removeAllInjuries.text\")); //$NON-NLS-1$\n+                    menuItem.setActionCommand(CMD_CLEAR_INJURIES);\n                     menuItem.addActionListener(this);\n-                    menuItem.setEnabled(gui.getCampaign().isGM());\n                     menu.add(menuItem);\n+\n+                    if (oneSelected) {\n+                        for (Injury i : person.getInjuries()) {\n+                            menuItem = new JMenuItem(String.format(resourceMap.getString(\"removeInjury.format\"), i.getName())); //$NON-NLS-1$\n+                            menuItem.setActionCommand(makeCommand(CMD_REMOVE_INJURY, i.getUUID().toString()));\n+                            menuItem.addActionListener(this);\n+                            menu.add(menuItem);\n+                        }\n+\n+                        menuItem = new JMenuItem(resourceMap.getString(\"editInjuries.text\")); //$NON-NLS-1$\n+                        menuItem.setActionCommand(CMD_EDIT_INJURIES);\n+                        menuItem.addActionListener(this);\n+                        menu.add(menuItem);\n+                    }\n                 }\n+\n+                if (oneSelected) {\n+                    if (person.canProcreate()) {\n+                        menuItem = new JMenuItem(resourceMap.getString(\"addPregnancy.text\"));\n+                        menuItem.setActionCommand(CMD_ADD_PREGNANCY);\n+                        menuItem.addActionListener(this);\n+                        menu.add(menuItem);\n+                    } else if (person.isPregnant()) {\n+                        menuItem = new JMenuItem(resourceMap.getString(\"removePregnancy.text\"));\n+                        menuItem.setActionCommand(CMD_REMOVE_PREGNANCY);\n+                        menuItem.addActionListener(this);\n+                        menu.add(menuItem);\n+                    }\n+                }", "originalCommit": "e8db6cc0a6bd0a1e3d2b15bdb467a4530162a2d3", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}