{"pr_number": 2232, "pr_title": "Issue #2231: Don't give back free parts when fixing a missing part", "pr_createdAt": "2020-11-15T20:09:31Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2232", "timeline": [{"oid": "aa59e47ee67a276b3a415ab3cb761291fa2d1593", "url": "https://github.com/MegaMek/mekhq/commit/aa59e47ee67a276b3a415ab3cb761291fa2d1593", "message": "Only return non-zero quantities of parts, fixing #2231", "committedDate": "2020-11-15T21:10:53Z", "type": "commit"}, {"oid": "9e07445c5e112f902589f521e5b6da283ce9809b", "url": "https://github.com/MegaMek/mekhq/commit/9e07445c5e112f902589f521e5b6da283ce9809b", "message": "Add tests covering #2231", "committedDate": "2020-11-15T21:10:53Z", "type": "commit"}, {"oid": "9e07445c5e112f902589f521e5b6da283ce9809b", "url": "https://github.com/MegaMek/mekhq/commit/9e07445c5e112f902589f521e5b6da283ce9809b", "message": "Add tests covering #2231", "committedDate": "2020-11-15T21:10:53Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg0NTE1Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2232#discussion_r533845157", "bodyText": "Remind me, what's the second argument here?", "author": "NickAragua", "createdAt": "2020-12-02T02:00:08Z", "path": "MekHQ/src/mekhq/campaign/parts/MissingPart.java", "diffHunk": "@@ -419,18 +421,19 @@ public void reservePart() {\n \n     @Override\n     public void cancelReservation() {\n-        Part replacement = findReplacement(false);\n-        if (hasReplacementPart() && (null != replacement)) {\n-            setReplacementPart(null);\n-            replacement.setReservedBy(null);\n-            if (replacement.isSpare()) {\n-                Part spare = campaign.getWarehouse().checkForExistingSparePart(replacement);\n-                if (null != spare) {\n-                    spare.incrementQuantity();\n-                    campaign.getWarehouse().removePart(replacement);\n+        if (hasReplacementPart()) {\n+            Part replacement = getReplacementPart();\n+            if (replacement != null) {\n+                replacement.setReservedBy(null);\n+\n+                // Only return the replacement part to the campaign if we have one\n+                if (replacement.getQuantity() > 0) {\n+                    campaign.getQuartermaster().addPart(replacement, 0);", "originalCommit": "9e07445c5e112f902589f521e5b6da283ce9809b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg2ODU5OQ==", "url": "https://github.com/MegaMek/mekhq/pull/2232#discussion_r533868599", "bodyText": "transitDays, should probably name the method better and add an immediate version.\nSomething like:\nquartermaster.addInTransitPart(part, transitDays);\nquartermaster.addPart(part);", "author": "sixlettervariables", "createdAt": "2020-12-02T03:16:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzg0NTE1Nw=="}], "type": "inlineReview"}]}