{"pr_number": 1419, "pr_title": "Improve performance of purchasing parts and fix refit bug", "pr_createdAt": "2020-01-22T03:28:04Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1419", "timeline": [{"oid": "25bed25f847a4dffadc86c92d6c87e133e5eac1e", "url": "https://github.com/MegaMek/mekhq/commit/25bed25f847a4dffadc86c92d6c87e133e5eac1e", "message": "Cache default currency lookups per day", "committedDate": "2020-01-22T01:53:00Z", "type": "commit"}, {"oid": "21d2f0fc924d78794285eb22c9bc4d799b9b8f08", "url": "https://github.com/MegaMek/mekhq/commit/21d2f0fc924d78794285eb22c9bc4d799b9b8f08", "message": "Don't use expensive regexes to screen silly text", "committedDate": "2020-01-22T01:54:50Z", "type": "commit"}, {"oid": "51ffcd3796fce7bdab5884b41932b4a3426465bc", "url": "https://github.com/MegaMek/mekhq/commit/51ffcd3796fce7bdab5884b41932b4a3426465bc", "message": "Stream spare parts to speed up calculations", "committedDate": "2020-01-22T01:55:32Z", "type": "commit"}, {"oid": "e8b06529b96c6f7a733bf88b8fea274585b95222", "url": "https://github.com/MegaMek/mekhq/commit/e8b06529b96c6f7a733bf88b8fea274585b95222", "message": "Add findSparePart utility to Campaign", "committedDate": "2020-01-22T03:01:44Z", "type": "commit"}, {"oid": "43da701c39ce3d6d85befaeca38244fa2a87e348", "url": "https://github.com/MegaMek/mekhq/commit/43da701c39ce3d6d85befaeca38244fa2a87e348", "message": "Use findSparePart in AmmoStorage::changeAmountAvailable", "committedDate": "2020-01-22T03:03:41Z", "type": "commit"}, {"oid": "72ce2f34b2aaa4fd87e656f3b932ef071e96c738", "url": "https://github.com/MegaMek/mekhq/commit/72ce2f34b2aaa4fd87e656f3b932ef071e96c738", "message": "Use findSparePart in Armor", "committedDate": "2020-01-22T03:05:09Z", "type": "commit"}, {"oid": "b1c5751cca8a867ec7be65b965918727ad97ab34", "url": "https://github.com/MegaMek/mekhq/commit/b1c5751cca8a867ec7be65b965918727ad97ab34", "message": "Use findSparePart in BaArmor", "committedDate": "2020-01-22T03:06:19Z", "type": "commit"}, {"oid": "c9fc5c5ca898770a035030757e8baf5329b32323", "url": "https://github.com/MegaMek/mekhq/commit/c9fc5c5ca898770a035030757e8baf5329b32323", "message": "Use findSparePart in ProtomekArmor", "committedDate": "2020-01-22T03:07:08Z", "type": "commit"}, {"oid": "a0ab2215187faf9790824a6b14760fac3018484f", "url": "https://github.com/MegaMek/mekhq/commit/a0ab2215187faf9790824a6b14760fac3018484f", "message": "Use findSparePart in SVArmor", "committedDate": "2020-01-22T03:07:32Z", "type": "commit"}, {"oid": "18a608a389edbd640afc20366e7125fe1fc187d0", "url": "https://github.com/MegaMek/mekhq/commit/18a608a389edbd640afc20366e7125fe1fc187d0", "message": "Use findSparePart and streamSpareParts in AmmoBin", "committedDate": "2020-01-22T03:08:42Z", "type": "commit"}, {"oid": "a90d59b4c68d4044ebbd2e025a4d8eb894f03d5c", "url": "https://github.com/MegaMek/mekhq/commit/a90d59b4c68d4044ebbd2e025a4d8eb894f03d5c", "message": "Fix comparisons of refit ID in armor and refits", "committedDate": "2020-01-22T03:12:05Z", "type": "commit"}, {"oid": "bc100adad5646cef4d05a1dccacd692b4f30636a", "url": "https://github.com/MegaMek/mekhq/commit/bc100adad5646cef4d05a1dccacd692b4f30636a", "message": "Add missing check to SVArmor::changeAmountAvailable", "committedDate": "2020-01-22T03:19:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM2NzQwNA==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r369367404", "bodyText": "Nice idea saving the currency for the day!", "author": "VicenteCartas", "createdAt": "2020-01-22T04:41:00Z", "path": "MekHQ/src/mekhq/campaign/finances/CurrencyManager.java", "diffHunk": "@@ -116,17 +120,26 @@ MoneyFormatter getUiAmountAndNamePrinter() {\n         return this.uiAmountAndNamePrinter;\n     }\n \n-    Currency getDefaultCurrency() {\n-        if (campaign != null) {\n-            HashMap<String, Currency> possibleCurrencies = new HashMap<>();\n+    synchronized Currency getDefaultCurrency() {", "originalCommit": "bc100adad5646cef4d05a1dccacd692b4f30636a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwMzUzMw==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370203533", "bodyText": "What happens if the user moves around between systems (e.g. using gm move?) We probably want to invalidate the cached value in that case as well.", "author": "NickAragua", "createdAt": "2020-01-23T15:56:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM2NzQwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIzMzU0OQ==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370233549", "bodyText": "I'll invalidate the cache for that too, good catch.", "author": "sixlettervariables", "createdAt": "2020-01-23T16:47:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2OTM2NzQwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNDUxNA==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370204514", "bodyText": "lol", "author": "NickAragua", "createdAt": "2020-01-23T15:57:53Z", "path": "MekHQ/src/mekhq/campaign/parts/PartInUse.java", "diffHunk": "@@ -1,17 +1,13 @@\n package mekhq.campaign.parts;\n \n import java.util.Objects;\n-import java.util.regex.Pattern;\n \n import megamek.common.AmmoType;\n import mekhq.campaign.finances.Money;\n import mekhq.campaign.unit.Unit;\n import mekhq.campaign.work.IAcquisitionWork;\n \n public class PartInUse {\n-    private static final Pattern cleanUp1 = Pattern.compile(\"\\\\d+\\\\shit\\\\(s\\\\),\\\\s\"); //$NON-NLS-1$", "originalCommit": "bc100adad5646cef4d05a1dccacd692b4f30636a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIyODcxNg==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370228716", "bodyText": "The purpose of this is to keep the parts overview from being cluttered by showing number of hits the part has taken.", "author": "neoancient", "createdAt": "2020-01-23T16:38:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNDUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIzMzAxNw==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370233017", "bodyText": "Woops, late night editing missed the Java regex difference. .NET regex that'd be an escaped \\ followed by shit. I'll find a better way than regex to remove those.", "author": "sixlettervariables", "createdAt": "2020-01-23T16:46:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNDUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIzNDYyMg==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370234622", "bodyText": "I'm not going to pretend I've never snickered at it. My initial thought is a boolean parameter to getDetails() that would determine whether to include the hit data.", "author": "neoancient", "createdAt": "2020-01-23T16:49:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNDUxNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDQ4MTQ2Mg==", "url": "https://github.com/MegaMek/mekhq/pull/1419#discussion_r370481462", "bodyText": "I've added an overload to handle that situation. One interesting find is that PodSpace seems to do something a bit different; but ultimately it isn't affected by this change.", "author": "sixlettervariables", "createdAt": "2020-01-24T05:45:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MDIwNDUxNA=="}], "type": "inlineReview"}, {"oid": "8e0d633ac94f78f5b0c16cd949acf2e42abbc02c", "url": "https://github.com/MegaMek/mekhq/commit/8e0d633ac94f78f5b0c16cd949acf2e42abbc02c", "message": "Invalidate default currency if campaign system changes", "committedDate": "2020-01-24T05:36:32Z", "type": "commit"}, {"oid": "284a7434f2f2e6d82ac47645080f2c53ac82453b", "url": "https://github.com/MegaMek/mekhq/commit/284a7434f2f2e6d82ac47645080f2c53ac82453b", "message": "Omit repair details from PartInUse\n\n- Add new overload for IPartWork::getDetails to\noptionally include repair details.", "committedDate": "2020-01-24T05:45:47Z", "type": "commit"}]}