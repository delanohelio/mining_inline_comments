{"pr_number": 1538, "pr_title": "Groundwork for distributed MekHQ", "pr_createdAt": "2020-03-01T16:34:25Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/1538", "timeline": [{"oid": "6f33b3e9fc63bf61e3ba9759f2a359137ee8e485", "url": "https://github.com/MegaMek/mekhq/commit/6f33b3e9fc63bf61e3ba9759f2a359137ee8e485", "message": "Add a CampaignController to handle the timeline\n\n- Moves CampaignGUI day ending and new day actions to event handlers\n- Makes a local campaign always the host", "committedDate": "2020-03-01T15:31:21Z", "type": "commit"}, {"oid": "76061831a31861f4d80dd9e52d1cce0266883d7b", "url": "https://github.com/MegaMek/mekhq/commit/76061831a31861f4d80dd9e52d1cce0266883d7b", "message": "Consolidate setGMMode", "committedDate": "2020-03-01T16:03:15Z", "type": "commit"}, {"oid": "c801eb56fa46db494b8b04c9bc1da994f89fba89", "url": "https://github.com/MegaMek/mekhq/commit/c801eb56fa46db494b8b04c9bc1da994f89fba89", "message": "Restrict advancing multiple days to the session host", "committedDate": "2020-03-01T16:09:54Z", "type": "commit"}, {"oid": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "url": "https://github.com/MegaMek/mekhq/commit/3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "message": "Put GM moving current location directly into Campaign\n\n- Use eventing to notify CampaignGUI", "committedDate": "2020-03-01T16:31:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjQ0MQ==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122441", "bodyText": "Spacing issues with the if statement and the first two calls.", "author": "Windchild292", "createdAt": "2020-03-01T16:45:38Z", "path": "MekHQ/src/mekhq/gui/dialog/DataLoadingDialog.java", "diffHunk": "@@ -304,7 +303,8 @@ public Void doInBackground() {\n         public void done() {\n         \tsetVisible(false);\n         \tif(!cancelled) {\n-        \t\tapp.setCampaign(campaign);\n+                app.setCampaign(campaign);\n+                app.getCampaignController().setHost(campaign.getId());\n         \t\tframe.setVisible(false);", "originalCommit": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjQ4Mw==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122483", "bodyText": "Do we need this anymore?", "author": "Windchild292", "createdAt": "2020-03-01T16:45:54Z", "path": "MekHQ/src/mekhq/gui/dialog/MedicalViewDialog.java", "diffHunk": "@@ -116,16 +116,14 @@\n     private transient Font handwritingFont;\n     private transient Color labelColor;\n     private transient ImageIcon healImageIcon;\n-    \n-    private boolean gmMode;\n \n     public MedicalViewDialog(Window parent, Campaign c, Person p, IconPackage ip) {\n         super();\n         this.campaign = Objects.requireNonNull(c);\n         this.person = Objects.requireNonNull(p);\n         //this.iconPackage = Objects.requireNonNull(ip);", "originalCommit": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjQ4MQ==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386136481", "bodyText": "I don't know. Outside the scope of this PR.", "author": "sixlettervariables", "createdAt": "2020-03-01T20:07:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjQ4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjUwNA==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122504", "bodyText": "Spacing", "author": "Windchild292", "createdAt": "2020-03-01T16:46:14Z", "path": "MekHQ/src/mekhq/gui/dialog/MedicalViewDialog.java", "diffHunk": "@@ -326,30 +324,30 @@ private JPanel fillDoll(JPanel panel, Campaign c, Person p) {\n                         default:\n                             col = Color.WHITE;\n                             break;\n-                        \n+\n                     }\n                     doll.setLocColor(bl, col);\n                 }\n             });\n-        if(isGMMode()) {\n+        if(campaign.isGM()) {", "originalCommit": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjM3OQ==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386136379", "bodyText": "This is at the appropriate indentation level.", "author": "sixlettervariables", "createdAt": "2020-03-01T20:06:07Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjQ0NQ==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386136445", "bodyText": "Sorry, space between the if and the (", "author": "Windchild292", "createdAt": "2020-03-01T20:07:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjU0OA==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386136548", "bodyText": "The file (for whatever reason) omits a space between the if and the (. To avoid cluttering the PR with whitespace only changes I maintained the original style.", "author": "sixlettervariables", "createdAt": "2020-03-01T20:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjUwNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjU0NA==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386122544", "bodyText": "spacing", "author": "Windchild292", "createdAt": "2020-03-01T16:46:39Z", "path": "MekHQ/src/mekhq/gui/dialog/MedicalViewDialog.java", "diffHunk": "@@ -499,30 +497,30 @@ private JPanel fillInjuries(JPanel panel, Campaign c, Person p) {\n                         injLabel = genWrittenText(String.format(resourceMap.getString(\"injuriesTextAndDuration.format\"), //$NON-NLS-1$\n                             inj.getType().getSimpleName(), inj.getStart().toString(DATE_FORMATTER), genTimePeriod(inj.getTime())));\n                     }\n-                    if(isGMMode()) {\n+                    if(campaign.isGM()) {", "originalCommit": "3be8e64d8f1357a7eafdf1afa2cde08d67fa1c21", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEzNjQxOQ==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386136419", "bodyText": "This is at the appropriate indentation level.", "author": "sixlettervariables", "createdAt": "2020-03-01T20:06:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjEyMjU0NA=="}], "type": "inlineReview"}, {"oid": "0bc829e20283299a1e1a9e656022f9df7bc2b8d0", "url": "https://github.com/MegaMek/mekhq/commit/0bc829e20283299a1e1a9e656022f9df7bc2b8d0", "message": "Fix mixed tabs and spaces", "committedDate": "2020-03-01T20:08:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE0MzUyMg==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386143522", "bodyText": "I assume these TODOs are about notifying the other campaigns when the day is forwarded.", "author": "neoancient", "createdAt": "2020-03-01T21:43:27Z", "path": "MekHQ/src/mekhq/campaign/CampaignController.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * Copyright (c) 2020 The MegaMek Team.\n+ *\n+ * This file is part of MekHQ.\n+ *\n+ * MekHQ is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as published by\n+ * the Free Software Foundation, either version 3 of the License, or\n+ * (at your option) any later version.\n+ *\n+ * MekHQ is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public License\n+ * along with MekHQ.  If not, see <http://www.gnu.org/licenses/>.\n+ */\n+package mekhq.campaign;\n+\n+import java.util.UUID;\n+\n+/**\n+ * Manages the timeline of a {@link Campaign}.\n+ */\n+public class CampaignController {\n+    private final Campaign localCampaign;\n+    private boolean isHost;\n+    private UUID host;\n+\n+    /**\n+     * Creates a new {@code CampaignController} for\n+     * the given {@link Campaign}\n+     * @param c The {@link Campaign} being used locally.\n+     */\n+    public CampaignController(Campaign c) {\n+        localCampaign = c;\n+    }\n+\n+    /**\n+     * Gets the local {@link Campaign}.\n+     * @return The local {@link Campaign}.\n+     */\n+    public Campaign getLocalCampaign() {\n+        return localCampaign;\n+    }\n+\n+    /**\n+     * Gets the unique identifier of the campaign hosting\n+     * this session.\n+     * @return The unique identifier of the host campaign.\n+     */\n+    public UUID getHost() {\n+        return host;\n+    }\n+\n+    /**\n+     * Sets the unique identifier of the campaign hosting\n+     * this session.\n+     * @param id The unique identifier of the host compaign.\n+     */\n+    public void setHost(UUID id) {\n+        host = id;\n+        isHost = getLocalCampaign().getId().equals(id);\n+    }\n+\n+    /**\n+     * Gets a value indicating whether or not the local Campaign\n+     * is hosting this session.\n+     * @return {@code true} if the local campaign is hosting\n+     *         this session, otherwise {@code false}.\n+     */\n+    public boolean isHost() {\n+        return isHost;\n+    }\n+\n+    /**\n+     * Advances the local {@link Campaign} to the next day.\n+     */\n+    public void advanceDay() {\n+        if (isHost) {\n+            if (getLocalCampaign().newDay()) {\n+                // TODO: notifyDayChangedEvent();\n+            }\n+        } else {\n+            // TODO: requestNewDay();", "originalCommit": "0bc829e20283299a1e1a9e656022f9df7bc2b8d0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE1NDI1Ng==", "url": "https://github.com/MegaMek/mekhq/pull/1538#discussion_r386154256", "bodyText": "Correct. Working on the service flow diagram before I stub everything out for regular (offline) play.", "author": "sixlettervariables", "createdAt": "2020-03-01T23:55:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjE0MzUyMg=="}], "type": "inlineReview"}]}