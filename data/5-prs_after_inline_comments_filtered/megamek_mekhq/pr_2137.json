{"pr_number": 2137, "pr_title": "Units, Parts, and Refits hold actual Person instances", "pr_createdAt": "2020-10-10T19:45:20Z", "pr_url": "https://github.com/MegaMek/mekhq/pull/2137", "timeline": [{"oid": "13de948b34166d73f4f7a2e5a8982c9f693b12bc", "url": "https://github.com/MegaMek/mekhq/commit/13de948b34166d73f4f7a2e5a8982c9f693b12bc", "message": "Use Person directly instead of IDs in Unit", "committedDate": "2020-10-10T19:15:00Z", "type": "commit"}, {"oid": "923a477ddb1060c2a48c13cca7c5900a40c0f82a", "url": "https://github.com/MegaMek/mekhq/commit/923a477ddb1060c2a48c13cca7c5900a40c0f82a", "message": "Use Person instead of an ID", "committedDate": "2020-10-10T19:15:00Z", "type": "commit"}, {"oid": "2a0bf95eb1bd02bc135eda57ab5ab299b0cb9cb0", "url": "https://github.com/MegaMek/mekhq/commit/2a0bf95eb1bd02bc135eda57ab5ab299b0cb9cb0", "message": "Add tests for spare part invariants", "committedDate": "2020-10-10T19:15:00Z", "type": "commit"}, {"oid": "58291b29acbe7cc24a4491f3d3ab911f0468a7dc", "url": "https://github.com/MegaMek/mekhq/commit/58291b29acbe7cc24a4491f3d3ab911f0468a7dc", "message": "Fix logic to check for Already Being Worked On", "committedDate": "2020-10-10T19:41:57Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTE0Mg==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r502829142", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                            } else if (u.getTech() != null && !tech.getId().equals(u.getTech().getId())) {\n          \n          \n            \n                            } else if (!tech.equals(u.getTech())) {", "author": "Windchild292", "createdAt": "2020-10-10T20:28:38Z", "path": "MekHQ/src/mekhq/campaign/io/CampaignXmlParser.java", "diffHunk": "@@ -741,20 +729,20 @@ private void fixupUnitTechProblems(Campaign retVal) {\n                 if (null == u) {\n                     reason = \"referenced missing unit\";\n                     tech.removeTechUnitId(id);\n-                } else if (null == u.getTechId()) {\n+                } else if (null == u.getTech()) {\n                     reason = \"was not referenced by unit\";\n                     u.setTech(tech);\n                 } else if (u.isMothballed()) {\n                     reason = \"referenced mothballed unit\";\n                     unitDesc = u.getName();\n                     tech.removeTechUnitId(id);\n-                } else if (!tech.getId().equals(u.getTechId())) {\n+                } else if (u.getTech() != null && !tech.getId().equals(u.getTech().getId())) {", "originalCommit": "58291b29acbe7cc24a4491f3d3ab911f0468a7dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzMDAwMQ==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r502830001", "bodyText": "These are true reference equality.", "author": "sixlettervariables", "createdAt": "2020-10-10T20:39:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTE0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTQzMw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r502829433", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (tech == u.getTech()) {\n          \n          \n            \n                        if (tech.equals(u.getTech())) {", "author": "Windchild292", "createdAt": "2020-10-10T20:31:48Z", "path": "MekHQ/src/mekhq/campaign/Campaign.java", "diffHunk": "@@ -3747,16 +3689,16 @@ public void removeAllTechJobsFor(Person tech) {\n             return;\n         }\n         getHangar().forEachUnit(u -> {\n-            if (tech.getId().equals(u.getTechId())) {\n+            if (tech == u.getTech()) {", "originalCommit": "58291b29acbe7cc24a4491f3d3ab911f0468a7dc", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgzMDAyNA==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r502830024", "bodyText": "These are true reference equality.", "author": "sixlettervariables", "createdAt": "2020-10-10T20:39:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMjgyOTQzMw=="}], "type": "inlineReview"}, {"oid": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "url": "https://github.com/MegaMek/mekhq/commit/9f8fe3ab3ac23c3c2302ca817551a455b5951724", "message": "Fix exception thrown when PersonTechAssignmentEvent has null person", "committedDate": "2020-10-10T21:03:02Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTEyMQ==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789121", "bodyText": "Why is this still using the Id?", "author": "Windchild292", "createdAt": "2020-10-17T03:42:40Z", "path": "MekHQ/src/mekhq/campaign/unit/actions/ActivateUnitAction.java", "diffHunk": "@@ -57,7 +57,7 @@ public void Execute(Campaign campaign, Unit unit) {\n                 return;\n             }\n \n-            unit.startActivating(techId);\n+            unit.startActivating(campaign.getPerson(techId));", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTEyNg==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789126", "bodyText": "Why is this still using the Id?", "author": "Windchild292", "createdAt": "2020-10-17T03:42:51Z", "path": "MekHQ/src/mekhq/campaign/unit/actions/MothballUnitAction.java", "diffHunk": "@@ -54,7 +54,7 @@ public void Execute(Campaign campaign, Unit unit) {\n                 return;\n             }\n \n-            unit.startMothballing(techId);\n+            unit.startMothballing(campaign.getPerson(techId));", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTczMg==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789732", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (driver.getStatus().isActive() && driver.getUnitId() == null) {\n          \n          \n            \n                        if (driver.getStatus().isActive() && (driver.getUnitId() == null)) {", "author": "Windchild292", "createdAt": "2020-10-17T03:51:46Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -79,44 +80,35 @@ public MothballInfo(Unit unit) {\n      * @param campaign The campaign in which this is happening\n      */\n     public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n-        Person tech = campaign.getPerson(techID);\n         if (tech != null) {\n             unit.setTech(tech);\n         }\n \n-        for (UUID driverID : driverIDs) {\n-            Person driver = campaign.getPerson(driverID);\n-\n-            if (driver != null && driver.getStatus().isActive() && driver.getUnitId() == null) {\n+        for (Person driver : drivers) {\n+            if (driver.getStatus().isActive() && driver.getUnitId() == null) {", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTc4Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789787", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        if (crew.getStatus().isActive() && crew.getUnitId() == null) {\n          \n          \n            \n                        if (crew.getStatus().isActive() && (crew.getUnitId() == null)) {", "author": "Windchild292", "createdAt": "2020-10-17T03:52:11Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -79,44 +80,35 @@ public MothballInfo(Unit unit) {\n      * @param campaign The campaign in which this is happening\n      */\n     public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n-        Person tech = campaign.getPerson(techID);\n         if (tech != null) {\n             unit.setTech(tech);\n         }\n \n-        for (UUID driverID : driverIDs) {\n-            Person driver = campaign.getPerson(driverID);\n-\n-            if (driver != null && driver.getStatus().isActive() && driver.getUnitId() == null) {\n+        for (Person driver : drivers) {\n+            if (driver.getStatus().isActive() && driver.getUnitId() == null) {\n                 unit.addDriver(driver);\n             }\n         }\n \n-        for (UUID gunnerID : gunnerIDs) {\n-            Person gunner = campaign.getPerson(gunnerID);\n-\n+        for (Person gunner : gunners) {\n             // add the gunner if they exist, aren't dead/retired/etc and aren't already assigned to some\n             // other unit. Caveat: single-person units have the same driver and gunner.\n-            if (gunner != null && gunner.getStatus().isActive() &&\n+            if (gunner.getStatus().isActive() &&\n                     ((gunner.getUnitId() == null) || (gunner.getUnitId() == unit.getId()))) {\n                 unit.addGunner(gunner);\n             }\n         }\n \n-        for (UUID vesselCrewID : vesselCrewIDs) {\n-            Person vesselCrew = campaign.getPerson(vesselCrewID);\n-\n-            if (vesselCrew != null && vesselCrew.getStatus().isActive() && vesselCrew.getUnitId() == null) {\n-                unit.addVesselCrew(vesselCrew);\n+        for (Person crew : vesselCrew) {\n+            if (crew.getStatus().isActive() && crew.getUnitId() == null) {", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTgyOQ==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789829", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                        MekHqXmlUtil.writeSimpleXmlTag(pw1, indent,  \"forceID\", forceID);\n          \n          \n            \n                        MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"forceID\", forceID);", "author": "Windchild292", "createdAt": "2020-10-17T03:52:44Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -135,38 +127,32 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n     public void writeToXml(PrintWriter pw1, int indent) {\n         pw1.println(MekHqXmlUtil.indentStr(indent) + \"<mothballInfo>\");\n \n-        if (techID != null) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<techID>\" + techID.toString() + \"</techID>\");\n+        if (tech != null) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"techId\", tech.getId());\n         }\n \n         if (forceID > 0) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<forceID>\" + forceID + \"</forceID>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent,  \"forceID\", forceID);", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTg0NA==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789844", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent) + \"<mothballInfo>\");\n          \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent++) + \"<mothballInfo>\");", "author": "Windchild292", "createdAt": "2020-10-17T03:52:56Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -135,38 +127,32 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n     public void writeToXml(PrintWriter pw1, int indent) {\n         pw1.println(MekHqXmlUtil.indentStr(indent) + \"<mothballInfo>\");", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc4OTg3Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506789877", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(indent) + \"</mothballInfo>\");\n          \n          \n            \n                    pw1.println(MekHqXmlUtil.indentStr(--indent) + \"</mothballInfo>\");", "author": "Windchild292", "createdAt": "2020-10-17T03:53:36Z", "path": "MekHQ/src/mekhq/campaign/unit/MothballInfo.java", "diffHunk": "@@ -135,38 +127,32 @@ public void restorePreMothballInfo(Unit unit, Campaign campaign) {\n     public void writeToXml(PrintWriter pw1, int indent) {\n         pw1.println(MekHqXmlUtil.indentStr(indent) + \"<mothballInfo>\");\n \n-        if (techID != null) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<techID>\" + techID.toString() + \"</techID>\");\n+        if (tech != null) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"techId\", tech.getId());\n         }\n \n         if (forceID > 0) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<forceID>\" + forceID + \"</forceID>\");\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent,  \"forceID\", forceID);\n         }\n \n-        if (driverIDs.size() > 0) {\n-            for (UUID driverID : driverIDs) {\n-                pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<driverID>\" + driverID.toString() + \"</driverID>\");\n-            }\n+        for (Person driver : drivers) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"driverId\", driver.getId());\n         }\n \n-        if (gunnerIDs.size() > 0) {\n-            for (UUID gunnerID : gunnerIDs) {\n-                pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<gunnerID>\" + gunnerID.toString() + \"</gunnerID>\");\n-            }\n+        for (Person gunner : gunners) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"gunnerId\", gunner.getId());\n         }\n \n-        if (vesselCrewIDs.size() > 0) {\n-            for (UUID vesselCrewID : vesselCrewIDs) {\n-                pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<vesselCrewID>\" + vesselCrewID.toString() + \"</vesselCrewID>\");\n-            }\n+        for (Person crew : vesselCrew) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"vesselCrewId\", crew.getId());\n         }\n \n-        if (techOfficerID != null) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<techOfficerID>\" + techOfficerID.toString() + \"</techOfficerID>\");\n+        if (navigator != null) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"navigatorId\", navigator.getId());\n         }\n \n-        if (navigatorID != null) {\n-            pw1.println(MekHqXmlUtil.indentStr(indent + 1) + \"<navigatorID>\" + navigatorID.toString() + \"</navigatorID>\");\n+        if (techOfficer != null) {\n+            MekHqXmlUtil.writeSimpleXmlTag(pw1, indent, \"techOfficerId\", techOfficer.getId());\n         }\n \n         pw1.println(MekHqXmlUtil.indentStr(indent) + \"</mothballInfo>\");", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc5MDE4Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506790187", "bodyText": "Can these two be combined?", "author": "Windchild292", "createdAt": "2020-10-17T03:57:47Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -3342,37 +3308,24 @@ public String getCamoFileName() {\n \n         Person commander = null;\n \n-        for (UUID pid : vesselCrew) {\n-            if (pid == null) {\n-                continue;\n-            }\n-            Person p = getCampaign().getPerson(pid);\n-            if ((p != null) && p.outRanks(commander)) {\n+        for (Person p : vesselCrew) {\n+            if (p.outRanks(commander)) {\n                 commander = p;\n             }\n         }\n-        for (UUID pid : gunners) {\n-            if (pid == null) {\n-                continue;\n-            }\n-            Person p = getCampaign().getPerson(pid);\n-            if ((p != null) && p.outRanks(commander)) {\n+        for (Person p : gunners) {\n+            if (p.outRanks(commander)) {\n                 commander = p;\n             }\n         }\n-        for (UUID pid : drivers) {\n-            if (pid == null) {\n-                continue;\n-            }\n-            Person p = getCampaign().getPerson(pid);\n-            if ((p != null) && p.outRanks(commander)) {\n+        for (Person p : drivers) {\n+            if (p.outRanks(commander)) {\n                 commander = p;\n             }\n         }\n         if (navigator != null) {\n-            Person p = getCampaign().getPerson(navigator);\n-            if ((p != null) && p.outRanks(commander)) {\n-                commander = p;\n+            if (navigator.outRanks(commander)) {", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc5MDIxOA==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506790218", "bodyText": "Can these two be combined", "author": "Windchild292", "createdAt": "2020-10-17T03:58:19Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -3697,15 +3643,13 @@ private void calcCompositeCrew() {\n             }\n         }\n \n-        for (UUID pid : vesselCrew) {\n-            Person p = getCampaign().getPerson(pid);\n-            if (null !=p && p.getHits() == 0) {\n+        for (Person p : vesselCrew) {\n+            if (p.getHits() == 0) {\n                 nCrew++;\n             }\n         }\n         if (null != navigator) {\n-            Person p = getCampaign().getPerson(navigator);\n-            if (null !=p && p.getHits() == 0) {\n+            if (navigator.getHits() == 0) {", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc5MDMwNQ==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506790305", "bodyText": "Can this be made into a ternary?", "author": "Windchild292", "createdAt": "2020-10-17T03:59:33Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4326,69 +4261,51 @@ public void setScenarioId(int i) {\n \n     public ArrayList<Person> getCrew() {\n         ArrayList<Person> crew = new ArrayList<>();\n-        for (UUID id : drivers) {\n-            Person p = getCampaign().getPerson(id);\n-            if (null != p) {\n-                crew.add(p);\n-            }\n+        for (Person p : drivers) {\n+            crew.add(p);\n         }\n         if (!usesSoloPilot() && !usesSoldiers()) {\n-            for (UUID id : gunners) {\n-                Person p = getCampaign().getPerson(id);\n-                if (null != p) {\n-                    crew.add(p);\n-                }\n-            }\n-        }\n-        for (UUID id : vesselCrew) {\n-            Person p = getCampaign().getPerson(id);\n-            if (null != p) {\n+            for (Person p : gunners) {\n                 crew.add(p);\n             }\n         }\n+        for (Person p : vesselCrew) {\n+            crew.add(p);\n+        }\n         if (navigator != null) {\n-            Person p = getCampaign().getPerson(navigator);\n-            if (null != p) {\n-                crew.add(p);\n-            }\n+            crew.add(navigator);\n         }\n         if (techOfficer != null) {\n-            Person p = getCampaign().getPerson(techOfficer);\n-            if (null != p) {\n-                crew.add(p);\n-            }\n+            crew.add(techOfficer);\n         }\n         return crew;\n     }\n \n-    public ArrayList<UUID> getDriverIDs() {\n-        return drivers;\n+    public List<Person> getDrivers() {\n+        return Collections.unmodifiableList(drivers);\n     }\n \n-    public ArrayList<UUID> getGunnerIDs() {\n-        return gunners;\n+    public List<Person> getGunners() {\n+        return Collections.unmodifiableList(gunners);\n     }\n \n-    public ArrayList<UUID> getVesselCrewIDs() {\n-        return vesselCrew;\n+    public List<Person> getVesselCrew() {\n+        return Collections.unmodifiableList(vesselCrew);\n     }\n \n-    public UUID getTechOfficerID() {\n+    public Person getTechOfficer() {\n         return techOfficer;\n     }\n \n-    public UUID getNavigatorID() {\n+    public Person getNavigator() {\n         return navigator;\n     }\n \n     public Person getTech() {\n         if (null != engineer) {\n             return engineer;\n         }\n-        if (null != tech) {\n-            return getCampaign().getPerson(tech);\n-        }\n-        return null;\n+        return tech;", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODc1MTQ3MA==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508751470", "bodyText": "Sure, just trying for the smallest footprint diff.", "author": "sixlettervariables", "createdAt": "2020-10-20T18:35:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc5MDMwNQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNjc5MDM1Ng==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r506790356", "bodyText": "Formatting here is odd", "author": "Windchild292", "createdAt": "2020-10-17T04:00:16Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4602,43 +4515,28 @@ public void cancelMothballOrActivation() {\n \n     public ArrayList<Person> getActiveCrew() {\n         ArrayList<Person> crew = new ArrayList<>();\n-        for (UUID id : drivers) {\n-            Person p = getCampaign().getPerson(id);\n-            if (null != p) {\n-                if (p.getHits() > 0 && (entity instanceof Tank || entity instanceof Infantry)) {\n-                    continue;\n-                }\n-                crew.add(p);\n+        for (Person p : drivers) {\n+            if (p.getHits() > 0 && (entity instanceof Tank || entity instanceof Infantry)) {\n+                continue;\n             }\n+            crew.add(p);\n         }\n         if (!usesSoloPilot() && !usesSoldiers()) {\n-            for (UUID id : gunners) {\n-                Person p = getCampaign().getPerson(id);\n-                if (null != p) {\n-                    if (p.getHits() > 0 && (entity instanceof Tank || entity instanceof Infantry)) {\n-                        continue;\n-                    }\n-                    crew.add(p);\n+            for (Person p : gunners) {\n+                if (p.getHits() > 0 && (entity instanceof Tank || entity instanceof Infantry)) {\n+                    continue;\n                 }\n-            }\n-        }\n-        for (UUID id : vesselCrew) {\n-            Person p = getCampaign().getPerson(id);\n-            if (null != p) {\n                 crew.add(p);\n             }\n         }\n-        if (null != navigator) {\n-            Person p = getCampaign().getPerson(navigator);\n-            if (null != p) {\n-                crew.add(p);\n-            }\n+        for (Person p : vesselCrew) {\n+            crew.add(p);\n+        }\n+        if (navigator != null) {\n+            crew.add(navigator);\n         }\n         if (techOfficer != null) {\n-            Person p = getCampaign().getPerson(techOfficer);\n-            if (null != p) {\n-                crew.add(p);\n-            }\n+                crew.add(techOfficer);", "originalCommit": "9f8fe3ab3ac23c3c2302ca817551a455b5951724", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8259fdbe865fb089917ad4b909e743c08d5c54b9", "url": "https://github.com/MegaMek/mekhq/commit/8259fdbe865fb089917ad4b909e743c08d5c54b9", "message": "Apply suggestions from code review\n\nCo-authored-by: Justin Bowen <39067288+Windchild292@users.noreply.github.com>", "committedDate": "2020-10-20T18:10:16Z", "type": "commit"}, {"oid": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "url": "https://github.com/MegaMek/mekhq/commit/9c1a47e2e6268b362edd3d6eb2e39018b5802179", "message": "Address PR feedback", "committedDate": "2020-10-20T18:49:01Z", "type": "commit"}, {"oid": "b5d38e8af270f50fc091db05cf882ea8380fe3a7", "url": "https://github.com/MegaMek/mekhq/commit/b5d38e8af270f50fc091db05cf882ea8380fe3a7", "message": "Merge remote-tracking branch 'upstream/master' into units-hold-actual-persons", "committedDate": "2020-10-20T18:49:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNjg0MA==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508926840", "bodyText": "Doesn't this duplicate the nonNull check?", "author": "Windchild292", "createdAt": "2020-10-21T00:56:59Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4093,10 +4093,12 @@ public void addDriver(Person p, boolean useTransfers) {\n     }\n \n     public void addGunner(Person p) {\n-        addGunner(p, false);\n+        addGunner(Objects.requireNonNull(p), false);", "originalCommit": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwOTYxMTA5Mg==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r509611092", "bodyText": "Personal preference for error call stacks, but I'll simplify.", "author": "sixlettervariables", "createdAt": "2020-10-21T19:32:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNjg0MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNjg0NQ==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508926845", "bodyText": "Doesn't this duplicate the nonNull check?", "author": "Windchild292", "createdAt": "2020-10-21T00:57:01Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4076,10 +4074,12 @@ public boolean usesSoldiers() {\n     }\n \n     public void addDriver(Person p) {\n-        addDriver(p, false);\n+        addDriver(Objects.requireNonNull(p), false);", "originalCommit": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNjg2Mw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508926863", "bodyText": "Doesn't this duplicate the nonNull check?", "author": "Windchild292", "createdAt": "2020-10-21T00:57:07Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4110,10 +4112,12 @@ public void addGunner(Person p, boolean useTransfers) {\n     }\n \n     public void addVesselCrew(Person p) {\n-        addVesselCrew(p, false);\n+        addVesselCrew(Objects.requireNonNull(p), false);", "originalCommit": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNjg3Nw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508926877", "bodyText": "Doesn't this duplicate the nonNull check?", "author": "Windchild292", "createdAt": "2020-10-21T00:57:10Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4127,10 +4131,12 @@ public void addVesselCrew(Person p, boolean useTransfers) {\n     }\n \n     public void setNavigator(Person p) {\n-        setNavigator(p, false);\n+        setNavigator(Objects.requireNonNull(p), false);", "originalCommit": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNjk0NA==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508926944", "bodyText": "Doesn't this duplicate the nonNull check?", "author": "Windchild292", "createdAt": "2020-10-21T00:57:25Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4143,15 +4149,17 @@ public void setNavigator(Person p, boolean useTransfers) {\n         MekHQ.triggerEvent(new PersonCrewAssignmentEvent(p, this));\n     }\n \n-    public boolean isTechOfficer(Person p) {\n-        return Objects.equals(techOfficer, p);\n+    public boolean isTechOfficer(@Nullable Person p) {\n+        return (techOfficer != null) && techOfficer.equals(p);\n     }\n \n     public void setTechOfficer(Person p) {\n-        setTechOfficer(p, false);\n+        setTechOfficer(Objects.requireNonNull(p), false);", "originalCommit": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwODkyNzAxMw==", "url": "https://github.com/MegaMek/mekhq/pull/2137#discussion_r508927013", "bodyText": "Doesn't this duplicate the nonNull check?", "author": "Windchild292", "createdAt": "2020-10-21T00:57:41Z", "path": "MekHQ/src/mekhq/campaign/unit/Unit.java", "diffHunk": "@@ -4193,10 +4203,12 @@ private void ensurePersonIsRegistered(Person p) {\n     }\n \n     public void addPilotOrSoldier(Person p) {\n-        addPilotOrSoldier(p, false);\n+        addPilotOrSoldier(Objects.requireNonNull(p), false);", "originalCommit": "9c1a47e2e6268b362edd3d6eb2e39018b5802179", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "2a2c5a7771668182f3f4e407617fdc68cbbf4df1", "url": "https://github.com/MegaMek/mekhq/commit/2a2c5a7771668182f3f4e407617fdc68cbbf4df1", "message": "Address PR feedback", "committedDate": "2020-10-21T19:31:25Z", "type": "commit"}, {"oid": "8458e5eb964cf9bdf6415185bb81bb174cdde412", "url": "https://github.com/MegaMek/mekhq/commit/8458e5eb964cf9bdf6415185bb81bb174cdde412", "message": "Add unit tests for various unit methods related to actual persons", "committedDate": "2020-10-22T18:42:03Z", "type": "commit"}]}