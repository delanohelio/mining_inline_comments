{"pr_number": 305, "pr_title": "Improvements to Pioneer assertions", "pr_createdAt": "2020-07-31T19:20:25Z", "pr_url": "https://github.com/junit-pioneer/junit-pioneer/pull/305", "timeline": [{"oid": "3f2439a3f883e3961193b97dd14b47e0ae2c8531", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/3f2439a3f883e3961193b97dd14b47e0ae2c8531", "message": "WIP commit\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-07-17T13:21:11Z", "type": "commit"}, {"oid": "f5d4fd5a5010b3aeeed400a5d14cccdeeebf1460", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/f5d4fd5a5010b3aeeed400a5d14cccdeeebf1460", "message": "WIP commit\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-07-17T18:22:23Z", "type": "commit"}, {"oid": "cd617d4e4384f51c28bcee73cf70ceb5407112ad", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/cd617d4e4384f51c28bcee73cf70ceb5407112ad", "message": "Added open-ended methods for writing custom assertions.\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-07-30T12:22:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MDg2NQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r463990865", "bodyText": "I don't like this new assertions. In my opinion it's much more complicated and less readable. The user is now forced to write an additional lamba expression and another assertion.\nI think it would be more readable with something like .hasNumberOfReportEntries(3).andTheyAre(\"suddenly..\", \"As...\", \"rapping...\")ore something like this.", "author": "Bukama", "createdAt": "2020-08-01T19:09:35Z", "path": "src/test/java/org/junitpioneer/jupiter/ReportEntryExtensionTests.java", "diffHunk": "@@ -78,8 +79,9 @@ void repeatedAnnotation_logEachKeyValuePairAsIndividualEntry() {\n \n \t\tassertThat(results)\n \t\t\t\t.hasNumberOfReportEntries(3)\n-\t\t\t\t.withValues(\"suddenly there came a tapping\", \"As if some one gently rapping\",\n-\t\t\t\t\t\"rapping at my chamber door\");\n+\t\t\t\t.andThen(entry -> assertThat(entry.getValue())\n+\t\t\t\t\t\t.isIn(\"suddenly there came a tapping\", \"As if some one gently rapping\",\n+\t\t\t\t\t\t\t\"rapping at my chamber door\"));", "originalCommit": "cd617d4e4384f51c28bcee73cf70ceb5407112ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDAwMTg4MA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r464001880", "bodyText": "This is an open-ended method that lets you chain your own assertions at the end of the 'common' ones.\nFor example: Stopwatch extension publishes entries with \"Test took X ms to run\". You can't test for that, because you can only test for exact values (right now). But with the andThen method, you can write:\nassertThat(results)\n    .hasSingleReportEntry()\n    .andThen(entry ->\n        assertThat(entry.getValue()).matches(\"Test took [0-9]+ ms to run\")\n    );", "author": "Michael1993", "createdAt": "2020-08-01T21:26:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MDg2NQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkzMTc5NA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r464931794", "bodyText": "We can keep adding new assertion methods for new test-cases when a feature needs it (like StopwatchExtension) or have a generic method \"exposing\" the things we want to assert (exceptions, report entries).\nOr we can do both.", "author": "Michael1993", "createdAt": "2020-08-04T09:45:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MDg2NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MTE3MQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r463991171", "bodyText": "I really like those assertion-method names!", "author": "Bukama", "createdAt": "2020-08-01T19:12:53Z", "path": "src/test/java/org/junitpioneer/testkit/assertion/reportentry/ReportEntryAssert.java", "diffHunk": "@@ -0,0 +1,36 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.testkit.assertion.reportentry;\n+\n+/**\n+ * Assertions for asserting how many report entries were published.\n+ */\n+public interface ReportEntryAssert {\n+\n+\t/**\n+\t * Asserts that the expected number of report entries were published across all executed tests.\n+\t * @param expected the number of report entries expected to be published\n+\t * @return a {@link ReportEntryValueAssert} for further assertions.\n+\t */\n+\tReportEntryValueAssert hasNumberOfReportEntries(int expected);\n+\n+\t/**\n+\t * Asserts that exactly one report entry was published across all executed tests or containers.\n+\t * @return a {@link ReportEntryValueAssert} for further assertions.\n+\t */\n+\tReportEntryValueAssert hasSingleReportEntry();\n+\n+\t/**\n+\t * Asserts that no report entries were published across all executed tests or containers.\n+\t */\n+\tvoid hasNoReportEntries();", "originalCommit": "cd617d4e4384f51c28bcee73cf70ceb5407112ad", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MTE5NA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r463991194", "bodyText": "Javadoc missing", "author": "Bukama", "createdAt": "2020-08-01T19:13:16Z", "path": "src/test/java/org/junitpioneer/testkit/assertion/reportentry/ReportEntryValueAssert.java", "diffHunk": "@@ -0,0 +1,55 @@\n+/*\n+ * Copyright 2015-2020 the original author or authors.\n+ *\n+ * All rights reserved. This program and the accompanying materials are\n+ * made available under the terms of the Eclipse Public License v2.0 which\n+ * accompanies this distribution and is available at\n+ *\n+ * http://www.eclipse.org/legal/epl-v20.html\n+ */\n+\n+package org.junitpioneer.testkit.assertion.reportentry;\n+\n+import java.util.Map;\n+import java.util.function.Consumer;\n+import java.util.function.Predicate;\n+\n+/**\n+ * Assertions for asserting the content of the published report entries.\n+ */\n+public interface ReportEntryValueAssert {\n+\n+\t/**\n+\t * Asserts that the report entry has a specified key and value.\n+\t * Fails if there are multiple report entries.\n+\t *\n+\t * @param key   the key of the expected report entry\n+\t * @param value the value of the expected report entry\n+\t */\n+\tvoid withKeyAndValue(String key, String value);\n+\n+\t/**\n+\t * Asserts that the report entries contain exactly the specified values (in any order).\n+\t *\n+\t * @param expected the expected values of the report entries\n+\t */\n+\tvoid withValues(String... expected);\n+\n+\t/**\n+\t * Asserts that the report entries contain the specified key-value pairs (in any order).\n+\t * Fails if there are odd number of supplied strings.\n+\t *\n+\t * @param keyAndValuePairs the expected key-value pairs of the report entries\n+\t */\n+\tvoid withKeyValuePairs(String... keyAndValuePairs);\n+\n+\t/**\n+\t * Asserts that the supplied predicate returns true for the report entries.\n+\t *\n+\t * @param predicate the condition we want to fulfill\n+\t */\n+\tvoid asserting(Predicate<Map.Entry<String, String>> predicate);\n+\n+\tvoid andThen(Consumer<Map.Entry<String, String>> testFunction);", "originalCommit": "cd617d4e4384f51c28bcee73cf70ceb5407112ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA5Mjg0NQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r464092845", "bodyText": "Javadoc added", "author": "Michael1993", "createdAt": "2020-08-02T15:45:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MTE5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MTcwMg==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r463991702", "bodyText": "I really have difficulty to imagine how to use this. I think it will quite be complicated and not easy to use - what's a thing I expect of an assertion lib (or method).", "author": "Bukama", "createdAt": "2020-08-01T19:19:54Z", "path": "src/test/java/org/junitpioneer/testkit/assertion/single/TestCaseFailureAssert.java", "diffHunk": "@@ -30,4 +33,16 @@\n \t */\n \tAbstractThrowableAssert<?, ? extends Throwable> withException();\n \n+\t/**\n+\t * Asserts that the test/container threw an exception that fulfills the supplied predicate.\n+\t * @param predicate the condition the thrown exception must fulfill\n+\t */\n+\tvoid withExceptionFulfilling(Predicate<Throwable> predicate);\n+\n+\t/**\n+\t * Applies the supplied consumer to the exception thrown by the test/container.\n+\t * @param testFunction a consumer, for writing more flexible tests\n+\t */\n+\tvoid andThenCheckException(Consumer<Throwable> testFunction);", "originalCommit": "cd617d4e4384f51c28bcee73cf70ceb5407112ad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDA4MTcxMw==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r464081713", "bodyText": "This is for cases that can not be covered by the other asserting methods.", "author": "Michael1993", "createdAt": "2020-08-02T14:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Mzk5MTcwMg=="}], "type": "inlineReview"}, {"oid": "b8f39f7afac8c076c26749997f936eca68e85a1f", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/b8f39f7afac8c076c26749997f936eca68e85a1f", "message": "WIP\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-08-02T15:41:19Z", "type": "commit"}, {"oid": "db1a9a3ad5e63c3f7989f14aa882bd609cdfca58", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/db1a9a3ad5e63c3f7989f14aa882bd609cdfca58", "message": "Modifying basic assertion calls to tell you what went wrong.\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-08-04T09:10:25Z", "type": "commit"}, {"oid": "b89cc1b1ea84815b2619ff4ff9900ba110348c0d", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/b89cc1b1ea84815b2619ff4ff9900ba110348c0d", "message": "Revert unnecessary rewrite in ReportEntryExtensionTests\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-08-04T09:15:41Z", "type": "commit"}, {"oid": "55339e8c7477199e269e22a60c74ee8ed83b5333", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/55339e8c7477199e269e22a60c74ee8ed83b5333", "message": "My code is now spotless (I think)\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-08-04T09:37:01Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzU3NzY4Mg==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r493577682", "bodyText": "This should behave the same way as asserting in ReportEntryAssertBase:\nassertThat(predicate.test(thrown)).isTrue();", "author": "Michael1993", "createdAt": "2020-09-23T13:18:45Z", "path": "src/test/java/org/junitpioneer/testkit/assertion/TestCaseAssertBase.java", "diffHunk": "@@ -66,4 +60,31 @@ public void whichAborted() {\n \t\tassertThat(actual.aborted().count()).isEqualTo(1);\n \t}\n \n+\t@Override\n+\tpublic void withExceptionFulfilling(Predicate<Throwable> predicate) {\n+\t\tThrowable thrown = getRequiredThrowable();\n+\t\tpredicate.test(thrown);", "originalCommit": "55339e8c7477199e269e22a60c74ee8ed83b5333", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "db884c5b852e3ff33ff52bad1cb52d5f0359b60f", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/db884c5b852e3ff33ff52bad1cb52d5f0359b60f", "message": "Fix bad method call\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-09-26T07:16:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU4Njk5Mw==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r495586993", "bodyText": "How about:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t\tassertThat(predicate.test(thrown)).isTrue();\n          \n          \n            \n            \t\tassertThat(predicate).accepts(thrown);\n          \n      \n    \n    \n  \n\nReference: https://joel-costigliola.github.io/assertj/core-8/api/org/assertj/core/api/PredicateAssert.html", "author": "beatngu13", "createdAt": "2020-09-27T15:58:24Z", "path": "src/test/java/org/junitpioneer/testkit/assertion/TestCaseAssertBase.java", "diffHunk": "@@ -63,7 +63,7 @@ public void whichAborted() {\n \t@Override\n \tpublic void withExceptionFulfilling(Predicate<Throwable> predicate) {\n \t\tThrowable thrown = getRequiredThrowable();\n-\t\tpredicate.test(thrown);\n+\t\tassertThat(predicate.test(thrown)).isTrue();", "originalCommit": "db884c5b852e3ff33ff52bad1cb52d5f0359b60f", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU5NjcwNg==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r495596706", "bodyText": "Sounds good, thank you \ud83d\ude04 . Done.", "author": "Michael1993", "createdAt": "2020-09-27T17:41:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NTU4Njk5Mw=="}], "type": "inlineReview"}, {"oid": "871c5020d243639b119aeeae757dc6b5b4ff1f5b", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/871c5020d243639b119aeeae757dc6b5b4ff1f5b", "message": "Use predicate assert instead of predicate.test isTrue assertion", "committedDate": "2020-09-27T17:40:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxMzM5OQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r513013399", "bodyText": "Should it be only or exactly? (I.e. is it ok if exceptionTypes is a superset of actual exceptions?) Whatever makes sense (maybe both?) should probably be reflected in the method name.", "author": "nipafx", "createdAt": "2020-10-27T20:35:57Z", "path": "src/test/java/org/junitpioneer/testkit/assertion/PioneerAssert.java", "diffHunk": "@@ -212,4 +264,58 @@ public ExecutionResultAssert hasNumberOfDynamicallyRegisteredContainers(int expe\n \t\t\t\t.collect(toList());\n \t}\n \n+\t@SafeVarargs\n+\t@Override\n+\tpublic final ListAssert<String> withExceptionInstancesOf(Class<? extends Throwable>... exceptionTypes) {\n+\t\treturn assertExceptions(events -> {\n+\t\t\tStream<Class<? extends Throwable>> classStream = getAllExceptions(events).map(Throwable::getClass);\n+\t\t\tAssertions.assertThat(classStream).containsOnly(exceptionTypes);", "originalCommit": "871c5020d243639b119aeeae757dc6b5b4ff1f5b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAyOTczOA==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r513029738", "bodyText": "It's only, not exactly => instanceOf(X) should work like instanceof so superset should work.", "author": "Michael1993", "createdAt": "2020-10-27T21:03:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxMzM5OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAzNDY3NQ==", "url": "https://github.com/junit-pioneer/junit-pioneer/pull/305#discussion_r513034675", "bodyText": "Ok, that makes sense. If we need \"exactly\", the new method could be called withExceptionInstancesExactlyOf.", "author": "nipafx", "createdAt": "2020-10-27T21:10:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMzAxMzM5OQ=="}], "type": "inlineReview"}, {"oid": "2ec58b6f95fef83babab9ea89d7f24b36e88de65", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/2ec58b6f95fef83babab9ea89d7f24b36e88de65", "message": "Merge branch 'master' into issue/298-pioneer-assert-improvements", "committedDate": "2020-10-28T22:08:29Z", "type": "commit"}, {"oid": "ea170a7783ecd79d238afde63678588dcbd2d23c", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/ea170a7783ecd79d238afde63678588dcbd2d23c", "message": "Added contribution to README.md\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-10-28T22:30:53Z", "type": "commit"}, {"oid": "406845f02f014c83a8da932737cba95a64e3b54f", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/406845f02f014c83a8da932737cba95a64e3b54f", "message": "Update tests to use the new assertion styles\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-10-28T22:57:50Z", "type": "commit"}, {"oid": "2b0900d5fc8f85c2f3b1ceca7600bfb7861d15a3", "url": "https://github.com/junit-pioneer/junit-pioneer/commit/2b0900d5fc8f85c2f3b1ceca7600bfb7861d15a3", "message": "Spotless\n\nSigned-off-by: Mihaly Verhas <misi.verhas@gmail.com>", "committedDate": "2020-10-28T22:58:52Z", "type": "commit"}]}