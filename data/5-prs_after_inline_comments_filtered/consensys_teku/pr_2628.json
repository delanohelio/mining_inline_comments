{"pr_number": 2628, "pr_title": "Add CacheableTaskQueue and use it to manage checkpoint state generation", "pr_createdAt": "2020-08-20T05:09:43Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2628", "timeline": [{"oid": "dd8a7c0b6242c4aa93a6a95e6b5eccef51075c9d", "url": "https://github.com/ConsenSys/teku/commit/dd8a7c0b6242c4aa93a6a95e6b5eccef51075c9d", "message": "Add CacheableTaskQueue and use it to avoid duplicate checkpoint state generation.", "committedDate": "2020-08-20T05:05:29Z", "type": "commit"}, {"oid": "d009276d3bac8cc01fa1de45ec0360de57307aaa", "url": "https://github.com/ConsenSys/teku/commit/d009276d3bac8cc01fa1de45ec0360de57307aaa", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into task-queue", "committedDate": "2020-08-20T05:05:45Z", "type": "commit"}, {"oid": "e9fd53724ff6ee13e9c7ffc07ca06ed0d917ab2e", "url": "https://github.com/ConsenSys/teku/commit/e9fd53724ff6ee13e9c7ffc07ca06ed0d917ab2e", "message": "Make errorprone happy.", "committedDate": "2020-08-20T05:26:42Z", "type": "commit"}, {"oid": "2d21d745bde72c5cbfba2ef6d1a2e5402ede8657", "url": "https://github.com/ConsenSys/teku/commit/2d21d745bde72c5cbfba2ef6d1a2e5402ede8657", "message": "Remove tests for what is now just a test fixture.", "committedDate": "2020-08-20T05:39:28Z", "type": "commit"}, {"oid": "e529ab7ee9ee2a6d7374d3b4641b320aae4e288e", "url": "https://github.com/ConsenSys/teku/commit/e529ab7ee9ee2a6d7374d3b4641b320aae4e288e", "message": "ofNullable.", "committedDate": "2020-08-20T08:21:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgyMzUzNw==", "url": "https://github.com/ConsenSys/teku/pull/2628#discussion_r473823537", "bodyText": "I'm a bit confused with how you accomplish this:", "author": "cemozerr", "createdAt": "2020-08-20T09:43:43Z", "path": "storage/src/main/java/tech/pegasys/teku/storage/store/Store.java", "diffHunk": "@@ -915,16 +832,20 @@ public boolean containsBlock(final Bytes32 blockRoot) {\n     public SafeFuture<Optional<BeaconState>> retrieveCheckpointState(Checkpoint checkpoint) {\n       BeaconState inMemoryCheckpointBlockState = block_states.get(checkpoint.getRoot());\n       if (inMemoryCheckpointBlockState != null) {\n-        return SafeFuture.completedFuture(\n-            Optional.of(regenerateCheckpointState(checkpoint, inMemoryCheckpointBlockState)));\n+        // Not executing the task via the task queue to avoid caching the result before the tx is", "originalCommit": "e529ab7ee9ee2a6d7374d3b4641b320aae4e288e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgzMDI1Nw==", "url": "https://github.com/ConsenSys/teku/pull/2628#discussion_r473830257", "bodyText": "Hmm you just don't use the task queue and you just don't cache it as a result. Makes sense.", "author": "cemozerr", "createdAt": "2020-08-20T09:50:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MzgyMzUzNw=="}], "type": "inlineReview"}, {"oid": "b343e4ec962df6502c9d478847f1a7b1d363833a", "url": "https://github.com/ConsenSys/teku/commit/b343e4ec962df6502c9d478847f1a7b1d363833a", "message": "Merge branch 'master' into task-queue", "committedDate": "2020-08-20T23:19:15Z", "type": "commit"}]}