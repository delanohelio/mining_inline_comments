{"pr_number": 1680, "pr_title": "[BC-371] Set up Gossip options and a bit more", "pr_createdAt": "2020-04-27T18:30:10Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1680", "timeline": [{"oid": "8085d77f0616c240dc46b99f99b152d19a52a416", "url": "https://github.com/ConsenSys/teku/commit/8085d77f0616c240dc46b99f99b152d19a52a416", "message": "Add Gossip options to the NetworkConfig", "committedDate": "2020-04-27T18:17:14Z", "type": "commit"}, {"oid": "967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "url": "https://github.com/ConsenSys/teku/commit/967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "message": "Make wire logging options configurable", "committedDate": "2020-04-27T18:17:58Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIwOTU1Mw==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416209553", "bodyText": "Can we make this X prefixed options with the hidden flag set?  They're useful to have for debugging but likely to be overly confusing for users and are quite implementation dependent so may change in the future.  The flags in InteropOptions are examples of this approach.  They don't show up in the normal help output (we need to make them show up if you run teku -X at some point).\nAlso, sorry I just created a lot of conflicts for you on this..", "author": "ajsutton", "createdAt": "2020-04-27T23:07:59Z", "path": "artemis/src/main/java/tech/pegasys/artemis/cli/options/LoggingOptions.java", "diffHunk": "@@ -28,6 +28,10 @@\n   public static final String LOG_DESTINATION_OPTION_NAME = \"--log-destination\";\n   public static final String LOG_FILE_OPTION_NAME = \"--log-file\";\n   public static final String LOG_FILE_NAME_PATTERN_OPTION_NAME = \"--log-file-name-pattern\";\n+  public static final String LOG_WIRE_CIPHER_ENABLED_OPTION_NAME = \"--log-wire-cipher-enabled\";\n+  public static final String LOG_WIRE_PLAIN_ENABLED_OPTION_NAME = \"--log-wire-plain-enabled\";\n+  public static final String LOG_WIRE_MUX_ENABLED_OPTION_NAME = \"--log-wire-mux-enabled\";\n+  public static final String LOG_WIRE_GOSSIP_ENABLED_OPTION_NAME = \"--log-wire-gossip-enabled\";", "originalCommit": "967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjQ3NjgxOQ==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416476819", "bodyText": "Done\n\nAlso, sorry I just created a lot of conflicts for you on this..\n\nNo worries, it merged automatically :)", "author": "Nashatyrev", "createdAt": "2020-04-28T09:43:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIwOTU1Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNTU1OQ==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416215559", "bodyText": "Given these come from the spec I'd be tempted to just make them constants.  Unless there's some value in making them configurable?\nI kind of like having them still come from the NetworkConfig object though.", "author": "ajsutton", "createdAt": "2020-04-27T23:22:47Z", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/network/NetworkConfig.java", "diffHunk": "@@ -31,9 +32,22 @@\n   private final boolean isDiscoveryEnabled;\n   private final List<String> bootnodes;\n   private final TargetPeerRange targetPeerRange;\n-  private final boolean logWireCipher;\n-  private final boolean logWirePlain;\n-  private final boolean logMuxFrames;\n+\n+  // Gossip options\n+  // https://github.com/ethereum/eth2.0-specs/blob/v0.11.1/specs/phase0/p2p-interface.md#the-gossip-domain-gossipsub\n+  private int gossipD = 6;\n+  private int gossipDLow = 4;\n+  private int gossipDHigh = 12;\n+  private int gossipDLazy = 6;\n+  private Duration gossipFanoutTTL = Duration.ofSeconds(60);\n+  private int gossipAdvertise = 3;\n+  private int gossipHistory = 5;\n+  private Duration gossipHeartbeatInterval = Duration.ofSeconds(1);", "originalCommit": "967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUxMTcwOQ==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416511709", "bodyText": "I kind of like having them still come from the NetworkConfig object though.\n\n@ajsutton not sure what do you mean exactly here, please check if the latest update looks better", "author": "Nashatyrev", "createdAt": "2020-04-28T10:40:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNTU1OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg3NTcxNw==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416875717", "bodyText": "Yep that change is exactly what I meant. :)", "author": "ajsutton", "createdAt": "2020-04-28T19:43:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNTU1OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNjQ3Nw==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416216477", "bodyText": "We've been trying to move more towards objects being immutable so would be good to just inject anything configurable into the constructor rather than having setters.", "author": "ajsutton", "createdAt": "2020-04-27T23:25:03Z", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/network/NetworkConfig.java", "diffHunk": "@@ -114,7 +155,71 @@ public boolean isLogWirePlain() {\n     return logWirePlain;\n   }\n \n-  public boolean isLogMuxFrames() {\n-    return logMuxFrames;\n+  public boolean isLogWireMuxFrames() {\n+    return logWireMuxFrames;\n+  }\n+\n+  public boolean isLogWireGossip() {\n+    return logWireGossip;\n+  }\n+\n+  public NetworkConfig setGossipD(int gossipD) {", "originalCommit": "967fa4c6d1d09bb4e0fbee97378ce92b95fc1caf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjUxMjQ4Mw==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416512483", "bodyText": "Made all immutable, but also made separate classes to inject defaults in a more convenient way.", "author": "Nashatyrev", "createdAt": "2020-04-28T10:41:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNjQ3Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjg3NTgwMA==", "url": "https://github.com/ConsenSys/teku/pull/1680#discussion_r416875800", "bodyText": "The extra config classes are a great idea.", "author": "ajsutton", "createdAt": "2020-04-28T19:43:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQxNjIxNjQ3Nw=="}], "type": "inlineReview"}, {"oid": "951c81a55c213b32111d8464016358bef20cb144", "url": "https://github.com/ConsenSys/teku/commit/951c81a55c213b32111d8464016358bef20cb144", "message": "Inline option names and default values. Make wire log options hidden", "committedDate": "2020-04-28T09:41:25Z", "type": "commit"}, {"oid": "cfb16a9657aa4980e8b7b38dc751a552b96e443e", "url": "https://github.com/ConsenSys/teku/commit/cfb16a9657aa4980e8b7b38dc751a552b96e443e", "message": "Merge remote-tracking branch 'pegasys/master' into feature-gossip-options", "committedDate": "2020-04-28T09:41:34Z", "type": "commit"}, {"oid": "f2c92947a4d47982e6e3ce9fe828b1ee6554cf9f", "url": "https://github.com/ConsenSys/teku/commit/f2c92947a4d47982e6e3ce9fe828b1ee6554cf9f", "message": "Move Gossip and WireLogs configs to a separate classes with default instances. Make all the classes back immutable", "committedDate": "2020-04-28T10:39:31Z", "type": "commit"}, {"oid": "8d7da373f833e5f9911c72146289bfa883e16b89", "url": "https://github.com/ConsenSys/teku/commit/8d7da373f833e5f9911c72146289bfa883e16b89", "message": "Revert accidentally committed change", "committedDate": "2020-04-28T10:42:57Z", "type": "commit"}, {"oid": "92b7f060cd57fc86dd3ad6833eb31e2f2695c465", "url": "https://github.com/ConsenSys/teku/commit/92b7f060cd57fc86dd3ad6833eb31e2f2695c465", "message": "Fix the unit test", "committedDate": "2020-04-28T11:10:04Z", "type": "commit"}, {"oid": "004d1f02e817682634b92dcf2088be65365cc71b", "url": "https://github.com/ConsenSys/teku/commit/004d1f02e817682634b92dcf2088be65365cc71b", "message": "Merge branch 'master' into feature-gossip-options", "committedDate": "2020-04-28T20:39:47Z", "type": "commit"}]}