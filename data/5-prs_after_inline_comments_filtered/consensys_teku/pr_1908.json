{"pr_number": 1908, "pr_title": "Store pending subnet subscriptions to be activated once the network starts", "pr_createdAt": "2020-05-26T02:02:03Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1908", "timeline": [{"oid": "04d838b6ab49b2373025178acc2bacacbb30dcd6", "url": "https://github.com/ConsenSys/teku/commit/04d838b6ab49b2373025178acc2bacacbb30dcd6", "message": "Store pending subnet subscriptions to be activated once the network has started and the attestation manager is available.\nFixes a race condition while handling the genesis event.", "committedDate": "2020-05-26T02:00:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3ODkzOQ==", "url": "https://github.com/ConsenSys/teku/pull/1908#discussion_r430178939", "bodyText": "System.out", "author": "macfarla", "createdAt": "2020-05-26T06:20:00Z", "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -149,21 +155,23 @@ public BeaconChainMethods getBeaconChainMethods() {\n   }\n \n   @Override\n-  public void subscribeToAttestationSubnetId(final int subnetId) {\n-    if (aggregateGossipManager == null) {\n-      throw new IllegalStateException(\n-          \"Attestation committee can not be subscribed due to gossip manager not being initialized\");\n+  public synchronized void subscribeToAttestationSubnetId(final int subnetId) {\n+    if (attestationGossipManager == null) {\n+      System.out.println(\"Adding pending subscription to \" + subnetId);", "originalCommit": "04d838b6ab49b2373025178acc2bacacbb30dcd6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMDE3ODk5MA==", "url": "https://github.com/ConsenSys/teku/pull/1908#discussion_r430178990", "bodyText": "System.out", "author": "macfarla", "createdAt": "2020-05-26T06:20:07Z", "path": "networking/eth2/src/main/java/tech/pegasys/teku/networking/eth2/ActiveEth2Network.java", "diffHunk": "@@ -149,21 +155,23 @@ public BeaconChainMethods getBeaconChainMethods() {\n   }\n \n   @Override\n-  public void subscribeToAttestationSubnetId(final int subnetId) {\n-    if (aggregateGossipManager == null) {\n-      throw new IllegalStateException(\n-          \"Attestation committee can not be subscribed due to gossip manager not being initialized\");\n+  public synchronized void subscribeToAttestationSubnetId(final int subnetId) {\n+    if (attestationGossipManager == null) {\n+      System.out.println(\"Adding pending subscription to \" + subnetId);\n+      pendingSubnetSubscriptions.add(subnetId);\n+    } else {\n+      System.out.println(\"Subscribing to \" + subnetId);", "originalCommit": "04d838b6ab49b2373025178acc2bacacbb30dcd6", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "271d9278cbe7c9c80cb84bfa7bbc15ee4ae29106", "url": "https://github.com/ConsenSys/teku/commit/271d9278cbe7c9c80cb84bfa7bbc15ee4ae29106", "message": "Remove System.out.", "committedDate": "2020-05-26T08:55:50Z", "type": "commit"}, {"oid": "f270fd9e30d1f8a3d8fff011c42436d1bf2d841d", "url": "https://github.com/ConsenSys/teku/commit/f270fd9e30d1f8a3d8fff011c42436d1bf2d841d", "message": "Merge branch 'master' into pending-subscriptions", "committedDate": "2020-05-26T20:55:27Z", "type": "commit"}]}