{"pr_number": 1225, "pr_title": "[BC-275] Prune in memory store", "pr_createdAt": "2020-02-25T17:36:26Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1225", "timeline": [{"oid": "3ae6c6dce12cb267baeaf2ce8891747d8806a243", "url": "https://github.com/ConsenSys/teku/commit/3ae6c6dce12cb267baeaf2ce8891747d8806a243", "message": "Rework database commit processing to propagate pruning information", "committedDate": "2020-02-25T16:30:55Z", "type": "commit"}, {"oid": "9c90498823aed8463cca68fb7b1dff4f690eb5a4", "url": "https://github.com/ConsenSys/teku/commit/9c90498823aed8463cca68fb7b1dff4f690eb5a4", "message": "Add tests, fix bug", "committedDate": "2020-02-25T17:26:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0NTkyNA==", "url": "https://github.com/ConsenSys/teku/pull/1225#discussion_r384145924", "bodyText": "It might be a good idea to switch to EventChannels here", "author": "cemozerr", "createdAt": "2020-02-25T21:47:09Z", "path": "storage/src/main/java/tech/pegasys/artemis/storage/ChainStorageServer.java", "diffHunk": "@@ -47,14 +44,8 @@ public ChainStorageServer(EventBus eventBus, ArtemisConfiguration config) {\n \n   @Subscribe\n   public void onStoreDiskUpdate(final StoreDiskUpdateEvent event) {\n-    try {\n-      database.insert(event);\n-\n-      eventBus.post(new StoreDiskUpdateCompleteEvent(event.getTransactionId(), Optional.empty()));\n-    } catch (final RuntimeException e) {\n-      LOG.debug(\"Transaction \" + event.getTransactionId() + \" failed\", e);\n-      eventBus.post(new StoreDiskUpdateCompleteEvent(event.getTransactionId(), Optional.of(e)));\n-    }\n+    final DatabaseUpdateResult result = database.update(event);\n+    eventBus.post(new StoreDiskUpdateCompleteEvent(event.getTransactionId(), result));", "originalCommit": "9c90498823aed8463cca68fb7b1dff4f690eb5a4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE1Njk1MQ==", "url": "https://github.com/ConsenSys/teku/pull/1225#discussion_r384156951", "bodyText": "\ud83d\udc4dWe've got a ticket logged to do that conversion, so we can follow up with that refactor in a separate PR", "author": "mbaxter", "createdAt": "2020-02-25T22:09:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NDE0NTkyNA=="}], "type": "inlineReview"}, {"oid": "ba4a1edbf7feb123bcc89d3b4b9086ce4dff3e59", "url": "https://github.com/ConsenSys/teku/commit/ba4a1edbf7feb123bcc89d3b4b9086ce4dff3e59", "message": "Merge branch 'master' into bc-275/prune-in-memory-store", "committedDate": "2020-02-25T22:09:47Z", "type": "commit"}]}