{"pr_number": 2053, "pr_title": "Fix rollback failure when commit fails", "pr_createdAt": "2020-06-04T06:56:32Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2053", "timeline": [{"oid": "92398428e76a23af12b6b09a7d24af248cafa43d", "url": "https://github.com/ConsenSys/teku/commit/92398428e76a23af12b6b09a7d24af248cafa43d", "message": "Remove old, incorrect, unused epoch metrics.", "committedDate": "2020-06-04T06:25:09Z", "type": "commit"}, {"oid": "aafa05f0e0ba4ae3e3dc109a14fd865c0bf595c9", "url": "https://github.com/ConsenSys/teku/commit/aafa05f0e0ba4ae3e3dc109a14fd865c0bf595c9", "message": "Don't attempt to rollback when commit fails.", "committedDate": "2020-06-04T06:53:11Z", "type": "commit"}, {"oid": "c9045150306e42cd6a8383040d8d13430071b4df", "url": "https://github.com/ConsenSys/teku/commit/c9045150306e42cd6a8383040d8d13430071b4df", "message": "Revert \"Remove old, incorrect, unused epoch metrics.\"\n\nThis reverts commit 92398428e76a23af12b6b09a7d24af248cafa43d.", "committedDate": "2020-06-04T06:56:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMxOTcxMw==", "url": "https://github.com/ConsenSys/teku/pull/2053#discussion_r435319713", "bodyText": "We're sure there's no way the commit could partially succeed and need to be rolled back?  Should we have a private tryRollback method that doesn't throw?", "author": "mbaxter", "createdAt": "2020-06-04T14:51:04Z", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/core/RocksDbInstance.java", "diffHunk": "@@ -215,10 +215,10 @@ public void commit() {\n       assertOpen();\n       try {\n         this.rocksDbTx.commit();\n-        close();\n       } catch (RocksDBException e) {\n-        rollback();", "originalCommit": "c9045150306e42cd6a8383040d8d13430071b4df", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTU0MTk2Ng==", "url": "https://github.com/ConsenSys/teku/pull/2053#discussion_r435541966", "bodyText": "Definitely sure - transactions are specifically designed so that they either commit everything or fail to commit and never anything in between.", "author": "ajsutton", "createdAt": "2020-06-04T20:52:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzNTMxOTcxMw=="}], "type": "inlineReview"}, {"oid": "da199acf3be62c50338b3968bc3166e40b8d8360", "url": "https://github.com/ConsenSys/teku/commit/da199acf3be62c50338b3968bc3166e40b8d8360", "message": "Merge branch 'master' into rocksdb-rollback", "committedDate": "2020-06-04T20:51:37Z", "type": "commit"}]}