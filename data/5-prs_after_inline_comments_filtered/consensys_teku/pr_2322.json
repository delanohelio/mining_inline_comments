{"pr_number": 2322, "pr_title": "Access genesis data through genesis event rather than Store", "pr_createdAt": "2020-07-06T20:52:37Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2322", "timeline": [{"oid": "fe9833889cd7bc6c4971bcedcee6494d9640ac76", "url": "https://github.com/ConsenSys/teku/commit/fe9833889cd7bc6c4971bcedcee6494d9640ac76", "message": "Access genesis data through GenesisEvent rather than Store", "committedDate": "2020-07-06T20:49:35Z", "type": "commit"}, {"oid": "cba4245303a664045495392c30bb5f4381cf9b46", "url": "https://github.com/ConsenSys/teku/commit/cba4245303a664045495392c30bb5f4381cf9b46", "message": "Merge branch 'master' into issue-2291/add-genesis-event", "committedDate": "2020-07-06T20:53:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNjk0Mw==", "url": "https://github.com/ConsenSys/teku/pull/2322#discussion_r450506943", "bodyText": "Would it be difficult to switch this over to using the EventChannel interface to get this event rather than the EventBus while you're here?  Don't worry if it takes more than a couple of minutes but it would be nice to get rid of one more usage of EventBus.", "author": "ajsutton", "createdAt": "2020-07-06T22:13:48Z", "path": "data/recorder/src/main/java/tech/pegasys/teku/data/recorder/SSZTransitionRecorder.java", "diffHunk": "@@ -41,13 +40,12 @@ public SSZTransitionRecorder(final Path outputDirectory) {\n   }\n \n   @Subscribe\n-  public void onGenesis(final UpdatableStore store) {\n-    final Checkpoint finalizedCheckpoint = store.getFinalizedCheckpoint();\n+  public void onGenesis(final GenesisEvent genesis) {\n+    final Checkpoint finalizedCheckpoint = genesis.getCheckpoint();", "originalCommit": "cba4245303a664045495392c30bb5f4381cf9b46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2NDAxOA==", "url": "https://github.com/ConsenSys/teku/pull/2322#discussion_r450964018", "bodyText": "Started looking into this, but I wanted to make a generic ChainUpdates channel to consolidate various chain events and decided it was too much to put into this PR.", "author": "mbaxter", "createdAt": "2020-07-07T15:45:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNjk0Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNzczMg==", "url": "https://github.com/ConsenSys/teku/pull/2322#discussion_r450507732", "bodyText": "anchorState is the more correct term (and possibly we should update a lot of places that refer to Genesis).  We might be starting from a state that isn't slot 0.", "author": "ajsutton", "createdAt": "2020-07-06T22:15:57Z", "path": "storage/src/main/java/tech/pegasys/teku/storage/store/StoreBuilder.java", "diffHunk": "@@ -54,40 +51,49 @@ public static StoreBuilder create() {\n   public static UpdatableStore buildForkChoiceStore(\n       final MetricsSystem metricsSystem,\n       final BlockProvider blockProvider,\n-      final BeaconState anchorState) {\n-    return forkChoiceStoreBuilder(metricsSystem, blockProvider, anchorState).build();\n+      final BeaconState genesisState) {", "originalCommit": "cba4245303a664045495392c30bb5f4381cf9b46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDk2Mjg2Mw==", "url": "https://github.com/ConsenSys/teku/pull/2322#discussion_r450962863", "bodyText": "When we process the genesis state, we construct an empty block from the state and apply an empty signature - which I don't think we want to do for non-genesis anchors.  But, I went ahead and changed GenesisEvent to AnchorPoint so that we have a more generic object to work with, and changed this builder to just work with AnchorPoint's.", "author": "mbaxter", "createdAt": "2020-07-07T15:43:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MDUwNzczMg=="}], "type": "inlineReview"}, {"oid": "4333f359f50cfd2340cb31a828e0946fd1da4c51", "url": "https://github.com/ConsenSys/teku/commit/4333f359f50cfd2340cb31a828e0946fd1da4c51", "message": "Merge branch 'master' into issue-2291/add-genesis-event", "committedDate": "2020-07-07T14:37:35Z", "type": "commit"}, {"oid": "6aafc7db58bff4e61771897f1f6e410e601d0b5b", "url": "https://github.com/ConsenSys/teku/commit/6aafc7db58bff4e61771897f1f6e410e601d0b5b", "message": "Use more generic anchor event in place of genesis event", "committedDate": "2020-07-07T15:16:55Z", "type": "commit"}, {"oid": "19fb989e537ce5f595b97018f74ac8bd57d8a775", "url": "https://github.com/ConsenSys/teku/commit/19fb989e537ce5f595b97018f74ac8bd57d8a775", "message": "Check that genesis state argument is valid, rename variables", "committedDate": "2020-07-07T15:33:45Z", "type": "commit"}, {"oid": "f4e378138c40dbd164ed9736590c50295e6d33aa", "url": "https://github.com/ConsenSys/teku/commit/f4e378138c40dbd164ed9736590c50295e6d33aa", "message": "Fix tests", "committedDate": "2020-07-07T16:03:54Z", "type": "commit"}, {"oid": "6da08a3a5601fd584f3d4f60bd3cf333dc974560", "url": "https://github.com/ConsenSys/teku/commit/6da08a3a5601fd584f3d4f60bd3cf333dc974560", "message": "Fix ChainDataProviderTest - use valid genesis state", "committedDate": "2020-07-07T17:23:07Z", "type": "commit"}, {"oid": "34575c2b5683b024f18ff2bb4eb782e15b0d7bf8", "url": "https://github.com/ConsenSys/teku/commit/34575c2b5683b024f18ff2bb4eb782e15b0d7bf8", "message": "Fix SlotProcessorTest", "committedDate": "2020-07-07T17:34:39Z", "type": "commit"}]}