{"pr_number": 1265, "pr_title": "Beacon validators: pagination of results", "pr_createdAt": "2020-03-03T06:33:48Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1265", "timeline": [{"oid": "34b9b318a3dfded2e5c8d6cd4c4d613bc68180bf", "url": "https://github.com/ConsenSys/teku/commit/34b9b318a3dfded2e5c8d6cd4c4d613bc68180bf", "message": "added page token and page size params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-03T04:22:48Z", "type": "commit"}, {"oid": "5a30c70e55a24bbc9b7bfcf8239e07d8268effd1", "url": "https://github.com/ConsenSys/teku/commit/5a30c70e55a24bbc9b7bfcf8239e07d8268effd1", "message": "pass page params through\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-03T05:30:44Z", "type": "commit"}, {"oid": "a98047e7bb1b870c2cb0b51a53a19a8a4e0ce1ac", "url": "https://github.com/ConsenSys/teku/commit/a98047e7bb1b870c2cb0b51a53a19a8a4e0ce1ac", "message": "added next page token to result\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-03T06:27:08Z", "type": "commit"}, {"oid": "4961eb588312376f93f16de1820fd81703c67bae", "url": "https://github.com/ConsenSys/teku/commit/4961eb588312376f93f16de1820fd81703c67bae", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination", "committedDate": "2020-03-03T06:29:14Z", "type": "commit"}, {"oid": "05376670b0edc46abaf5fe4bc8a24e2ba527badb", "url": "https://github.com/ConsenSys/teku/commit/05376670b0edc46abaf5fe4bc8a24e2ba527badb", "message": "stay within the bounds of the list\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-03T06:33:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNjA4OA==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r386906088", "bodyText": "prysm defaults this to 250, i think we should do the same. even if we went as high as 500, just want to make sure that we get that middle ground of 'not too much' data.", "author": "rolfyone", "createdAt": "2020-03-03T09:51:06Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/RestApiConstants.java", "diffHunk": "@@ -18,6 +18,10 @@\n   public static final String SLOT = \"slot\";\n   public static final String EPOCH = \"epoch\";\n   public static final String ACTIVE = \"active\";\n+  public static final String PAGE_SIZE = \"pageSize\";\n+  public static final String PAGE_TOKEN = \"pageToken\";\n+  public static final int PAGE_SIZE_DEFAULT = 20;", "originalCommit": "05376670b0edc46abaf5fe4bc8a24e2ba527badb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0ODUwMg==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387448502", "bodyText": "done", "author": "macfarla", "createdAt": "2020-03-04T04:54:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNjA4OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNjYyNA==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r386906624", "bodyText": "should comment here that the default pagination is X (ideally reference the variable).", "author": "rolfyone", "createdAt": "2020-03-03T09:52:07Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconValidatorsHandler.java", "diffHunk": "@@ -69,7 +74,13 @@ public BeaconValidatorsHandler(\n         @OpenApiParam(\n             name = ACTIVE,\n             description =\n-                \"If specified, return only validators which are active in the specified epoch\")\n+                \"If specified, return only validators which are active in the specified epoch.\"),\n+        @OpenApiParam(\n+            name = PAGE_SIZE,\n+            description = \"If specified, return only this many results.\"),", "originalCommit": "05376670b0edc46abaf5fe4bc8a24e2ba527badb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzMyODIwNA==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387328204", "bodyText": "done", "author": "macfarla", "createdAt": "2020-03-03T22:17:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkwNjYyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkyMTk2NQ==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r386921965", "bodyText": "i'm not sure in the response we want to be using SSZList unless we've got a good reason. we can just use ArrayList and not have the baggage... they serialize the same way\nWe might find this logic to be a useful utility function, passing in a list (I'd probably make it a List, as both SSZVector and SSZList come from Arraylist from memory) and getting a page of data...\nsince it's a list, we could possibly just use list.sublist, and pass it the start and end and return the result of that... also can just return List.of() for empty...", "author": "rolfyone", "createdAt": "2020-03-03T10:19:30Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/schema/BeaconValidatorsResponse.java", "diffHunk": "@@ -18,8 +18,43 @@\n \n public class BeaconValidatorsResponse {\n   public final SSZList<Validator> validatorList;\n+  private int totalSize;\n+  private int nextPageToken;\n \n   public BeaconValidatorsResponse(SSZList<Validator> validatorList) {\n-    this.validatorList = validatorList;\n+    this(validatorList, 20, 0);\n+  }\n+\n+  public BeaconValidatorsResponse(\n+      SSZList<Validator> validatorList, final int pageSize, final int pageToken) {\n+    // first page is pageToken = 0\n+    if (pageSize > 0 && pageToken >= 0) {\n+      int offset = pageToken * pageSize;\n+      SSZList<Validator> pageOfValidators = new SSZList<>(Validator.class, pageSize);", "originalCommit": "05376670b0edc46abaf5fe4bc8a24e2ba527badb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ0NDgwNg==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387444806", "bodyText": "as per discussion, can't simply use List.sublist because of the indexing. Other suggestions taken on board. SSZList is gone from Response and now using List.of() for empty", "author": "macfarla", "createdAt": "2020-03-04T04:36:08Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NjkyMTk2NQ=="}], "type": "inlineReview"}, {"oid": "c90d6899dee03d3a02619e4a183ad18bb0b4eac7", "url": "https://github.com/ConsenSys/teku/commit/c90d6899dee03d3a02619e4a183ad18bb0b4eac7", "message": "descriptions of params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-03T23:07:49Z", "type": "commit"}, {"oid": "15cce3860ee4b1809060758c6e1ff1877f799f28", "url": "https://github.com/ConsenSys/teku/commit/15cce3860ee4b1809060758c6e1ff1877f799f28", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination", "committedDate": "2020-03-03T23:07:56Z", "type": "commit"}, {"oid": "1ef4b4a3111c07b51c80ab90b87feb346ed32fbd", "url": "https://github.com/ConsenSys/teku/commit/1ef4b4a3111c07b51c80ab90b87feb346ed32fbd", "message": "open api descriptions\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-03T23:18:01Z", "type": "commit"}, {"oid": "9b6577ff0094473ca5305b9550171af5dc47bf72", "url": "https://github.com/ConsenSys/teku/commit/9b6577ff0094473ca5305b9550171af5dc47bf72", "message": "remove SSZList from response obj\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T00:28:35Z", "type": "commit"}, {"oid": "a41962078ddba389ebb183cfb5713f62eff27c91", "url": "https://github.com/ConsenSys/teku/commit/a41962078ddba389ebb183cfb5713f62eff27c91", "message": "added test for out of bounds page params\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T00:41:38Z", "type": "commit"}, {"oid": "f06ab2a26f887b56a098a431608ec40ab557bee7", "url": "https://github.com/ConsenSys/teku/commit/f06ab2a26f887b56a098a431608ec40ab557bee7", "message": "more test cases\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T01:01:33Z", "type": "commit"}, {"oid": "7cf0b0e241e3ac5bb307bcb2e55cb709acd06c90", "url": "https://github.com/ConsenSys/teku/commit/7cf0b0e241e3ac5bb307bcb2e55cb709acd06c90", "message": "more test cases\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T01:06:24Z", "type": "commit"}, {"oid": "afc7449fa1d7b407e9cfb5da0feba0c1025581bb", "url": "https://github.com/ConsenSys/teku/commit/afc7449fa1d7b407e9cfb5da0feba0c1025581bb", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination", "committedDate": "2020-03-04T01:06:36Z", "type": "commit"}, {"oid": "66ae4c2e7dbd8befa7af1b090c32ecd1e7f9b790", "url": "https://github.com/ConsenSys/teku/commit/66ae4c2e7dbd8befa7af1b090c32ecd1e7f9b790", "message": "generalise\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T01:09:31Z", "type": "commit"}, {"oid": "37a7fd78e8ef40b35d2f0a64b7c7719e0218a445", "url": "https://github.com/ConsenSys/teku/commit/37a7fd78e8ef40b35d2f0a64b7c7719e0218a445", "message": "use utils\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T03:12:00Z", "type": "commit"}, {"oid": "59925052bfc6e6eaf8443c084382439b2373bc6d", "url": "https://github.com/ConsenSys/teku/commit/59925052bfc6e6eaf8443c084382439b2373bc6d", "message": "added index to validator response\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T03:34:10Z", "type": "commit"}, {"oid": "c5d5c09c75f70fc338f3765877c5be0222431d5c", "url": "https://github.com/ConsenSys/teku/commit/c5d5c09c75f70fc338f3765877c5be0222431d5c", "message": "pass active and epoch params through to reponse creator\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T04:29:53Z", "type": "commit"}, {"oid": "3bee2ecbd82aa740d44ac692e4afc84942606a24", "url": "https://github.com/ConsenSys/teku/commit/3bee2ecbd82aa740d44ac692e4afc84942606a24", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination", "committedDate": "2020-03-04T04:29:58Z", "type": "commit"}, {"oid": "993a8a76a9aa7478bcfa8efa6ab5cda0d4036ea4", "url": "https://github.com/ConsenSys/teku/commit/993a8a76a9aa7478bcfa8efa6ab5cda0d4036ea4", "message": "merge", "committedDate": "2020-03-04T04:33:31Z", "type": "commit"}, {"oid": "bb46acb7e1334746ba1dc40b92f25527bd76ad11", "url": "https://github.com/ConsenSys/teku/commit/bb46acb7e1334746ba1dc40b92f25527bd76ad11", "message": "changed page size default to 250\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T04:36:43Z", "type": "commit"}, {"oid": "e4c340a9c7a7598fb9bd3c7e25054274ffe4fb41", "url": "https://github.com/ConsenSys/teku/commit/e4c340a9c7a7598fb9bd3c7e25054274ffe4fb41", "message": "changed page size default to 250\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T05:01:54Z", "type": "commit"}, {"oid": "5ae15ee3f22e6caa44dd2a33e6afd15a06d2433c", "url": "https://github.com/ConsenSys/teku/commit/5ae15ee3f22e6caa44dd2a33e6afd15a06d2433c", "message": "Merge branch 'beacon-validators-pagination' of github.com:macfarla/teku into beacon-validators-pagination", "committedDate": "2020-03-04T05:02:28Z", "type": "commit"}, {"oid": "874c90f84d0140b98e41b74ebbf845b71a6a330d", "url": "https://github.com/ConsenSys/teku/commit/874c90f84d0140b98e41b74ebbf845b71a6a330d", "message": "Merge branch 'beacon-validators-pagination' of github.com:macfarla/teku into beacon-validators-pagination", "committedDate": "2020-03-04T05:04:08Z", "type": "commit"}, {"oid": "714e01d159831866e30869c49e73f29e07bf4674", "url": "https://github.com/ConsenSys/teku/commit/714e01d159831866e30869c49e73f29e07bf4674", "message": "Merge branch 'beacon-validators-pagination' of github.com:macfarla/teku into beacon-validators-pagination", "committedDate": "2020-03-04T05:04:30Z", "type": "commit"}, {"oid": "bbcaf814c09c6ca05cba84dec49ab47816769772", "url": "https://github.com/ConsenSys/teku/commit/bbcaf814c09c6ca05cba84dec49ab47816769772", "message": "make tests fail more helpfully if page size is wrong\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T05:14:04Z", "type": "commit"}, {"oid": "29f3fabb96b900defab10f0a402fb5ff51d15b61", "url": "https://github.com/ConsenSys/teku/commit/29f3fabb96b900defab10f0a402fb5ff51d15b61", "message": "fix test\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T05:25:45Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MDQxMQ==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387490411", "bodyText": "should probably say 'active' if that's what we're referring to by 'current'?", "author": "rolfyone", "createdAt": "2020-03-04T07:34:14Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconValidatorsHandler.java", "diffHunk": "@@ -65,22 +63,30 @@ public BeaconValidatorsHandler(\n   @OpenApi(\n       path = ROUTE,\n       method = HttpMethod.GET,\n-      summary = \"Get validators from the running beacon node that match the specified query.\",\n+      summary = \"Returns validators that match the specified query.\",\n       tags = {TAG_BEACON},\n       description =\n-          \"Requests validator information. If no parameters specified, all current validators are returned.\",\n+          \"Returns validator information. If no parameters specified, the first page of current validators are returned.\",", "originalCommit": "29f3fabb96b900defab10f0a402fb5ff51d15b61", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzUxMDgyOA==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387510828", "bodyText": "no it's current as in \"as of the current epoch\"", "author": "macfarla", "createdAt": "2020-03-04T08:26:25Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MDQxMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4Nzk4MDc4Mw==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r387980783", "bodyText": "hopefully clearer now", "author": "macfarla", "createdAt": "2020-03-04T22:47:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4NzQ5MDQxMQ=="}], "type": "inlineReview"}, {"oid": "efb0012435520a82a4c034c8608347180a1bdfee", "url": "https://github.com/ConsenSys/teku/commit/efb0012435520a82a4c034c8608347180a1bdfee", "message": "updated description\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T21:26:59Z", "type": "commit"}, {"oid": "4db750d20ec59d10ccbecb8a6e848b4a27ab24f9", "url": "https://github.com/ConsenSys/teku/commit/4db750d20ec59d10ccbecb8a6e848b4a27ab24f9", "message": "merge\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T22:12:24Z", "type": "commit"}, {"oid": "f71d08ba34ea5ecffeb9200f31a953e5e039d16b", "url": "https://github.com/ConsenSys/teku/commit/f71d08ba34ea5ecffeb9200f31a953e5e039d16b", "message": "refactoring - move get_active_validator_count to BeaconStateUtil\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T22:45:12Z", "type": "commit"}, {"oid": "2c437f3f010629fbe2f33dabac1a47d122ee7cec", "url": "https://github.com/ConsenSys/teku/commit/2c437f3f010629fbe2f33dabac1a47d122ee7cec", "message": "total size for active=true\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T23:05:30Z", "type": "commit"}, {"oid": "a3041ee271e1f5d19126916adeec50d396110dc7", "url": "https://github.com/ConsenSys/teku/commit/a3041ee271e1f5d19126916adeec50d396110dc7", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into beacon-validators-pagination", "committedDate": "2020-03-04T23:05:42Z", "type": "commit"}, {"oid": "e31c7ebaf06482d521ecc19b1863a51afc2fb815", "url": "https://github.com/ConsenSys/teku/commit/e31c7ebaf06482d521ecc19b1863a51afc2fb815", "message": "formatting\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T23:08:08Z", "type": "commit"}, {"oid": "96c505da6edc9fe872c70e3298caef644ceb62ea", "url": "https://github.com/ConsenSys/teku/commit/96c505da6edc9fe872c70e3298caef644ceb62ea", "message": "bad request if illegalArg\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T23:19:44Z", "type": "commit"}, {"oid": "79db18c6462e3135ad91d0e4aeefe1ceee364456", "url": "https://github.com/ConsenSys/teku/commit/79db18c6462e3135ad91d0e4aeefe1ceee364456", "message": "formatting\n\nSigned-off-by: Sally MacFarlane <sally.macfarlane@consensys.net>", "committedDate": "2020-03-04T23:46:42Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODAwMjYxMQ==", "url": "https://github.com/ConsenSys/teku/pull/1265#discussion_r388002611", "bodyText": "@tapanshah21", "author": "macfarla", "createdAt": "2020-03-04T23:48:51Z", "path": "data/beaconrestapi/src/test/java/tech/pegasys/artemis/beaconrestapi/beaconhandlers/BeaconValidatorsHandlerTest.java", "diffHunk": "@@ -186,45 +205,105 @@ public void shouldReturnActiveValidatorsWhenQueryByActiveOnly() throws Exception\n     assertEquals(data.get(), jsonProvider.objectToJSON(beaconActiveValidators));\n   }\n \n-  private BeaconState addActiveValidator(final BeaconState beaconState) {\n-    MutableBeaconState beaconStateW = beaconState.createWritableCopy();\n+  @Test\n+  public void shouldReturnSubsetOfValidatorsWhenQueryByEpochAndPageSize() throws Exception {\n+    BeaconValidatorsHandler handler = new BeaconValidatorsHandler(combinedClient, jsonProvider);\n+    final int suppliedPageSizeParam = 10;\n+    when(context.queryParamMap())\n+        .thenReturn(\n+            Map.of(\n+                EPOCH,\n+                List.of(epoch.toString()),\n+                PAGE_SIZE,\n+                List.of(String.valueOf(suppliedPageSizeParam))));\n+    final UnsignedLong slot = BeaconStateUtil.compute_start_slot_at_epoch(epoch);\n \n-    // create an ACTIVE validator and add it to the list\n-    MutableValidator v = DataStructureUtil.randomValidator(88).createWritableCopy();\n-    v.setActivation_eligibility_epoch(UnsignedLong.ZERO);\n-    v.setActivation_epoch(beaconState.getFinalized_checkpoint().getEpoch());\n-    beaconStateW.getValidators().add(v);\n-    return beaconStateW.commitChanges();\n+    when(combinedClient.getBestBlockRoot()).thenReturn(Optional.of(blockRoot));\n+\n+    BeaconValidatorsResponse beaconValidators =\n+        new BeaconValidatorsResponse(\n+            beaconState.getValidators(), false, epoch, suppliedPageSizeParam, PAGE_TOKEN_DEFAULT);\n+\n+    when(combinedClient.getStateAtSlot(slot, blockRoot))\n+        .thenReturn(SafeFuture.completedFuture(Optional.of(beaconState)));\n+\n+    handler.handle(context);\n+\n+    verify(combinedClient).getBestBlockRoot();\n+    verify(combinedClient).getStateAtSlot(slot, blockRoot);\n+    verify(context).result(args.capture());\n+\n+    SafeFuture<String> data = args.getValue();\n+    assertEquals(data.get(), jsonProvider.objectToJSON(beaconValidators));\n   }\n \n   @Test\n-  public void getActiveValidators() {\n-    BeaconState beaconState = DataStructureUtil.randomBeaconState(23);\n-    MutableBeaconState beaconStateW = beaconState.createWritableCopy();\n+  public void shouldReturnSubsetOfValidatorsWhenQueryByEpochAndPageSizeAndPageToken()\n+      throws Exception {\n+    BeaconValidatorsHandler handler = new BeaconValidatorsHandler(combinedClient, jsonProvider);\n+    final int suppliedPageSizeParam = 10;\n+    final int suppliedPageTokenParam = 1;\n+    when(context.queryParamMap())\n+        .thenReturn(\n+            Map.of(\n+                EPOCH,\n+                List.of(epoch.toString()),\n+                PAGE_SIZE,\n+                List.of(String.valueOf(suppliedPageSizeParam)),\n+                PAGE_TOKEN,\n+                List.of(String.valueOf(suppliedPageTokenParam))));\n+    final UnsignedLong slot = BeaconStateUtil.compute_start_slot_at_epoch(epoch);\n \n-    SSZList<Validator> allValidators = beaconState.getValidators();\n-    SSZList<Validator> activeValidators = BeaconValidatorsHandler.getActiveValidators(beaconStateW);\n-    int originalValidatorCount = allValidators.size();\n+    when(combinedClient.getBestBlockRoot()).thenReturn(Optional.of(blockRoot));\n \n-    assertThat(activeValidators.size()).isLessThanOrEqualTo(beaconStateW.getValidators().size());\n+    BeaconValidatorsResponse beaconValidators =\n+        new BeaconValidatorsResponse(\n+            beaconState.getValidators(),\n+            false,\n+            epoch,\n+            suppliedPageSizeParam,\n+            suppliedPageTokenParam);\n+\n+    when(combinedClient.getStateAtSlot(slot, blockRoot))\n+        .thenReturn(SafeFuture.completedFuture(Optional.of(beaconState)));\n+\n+    handler.handle(context);\n+\n+    verify(combinedClient).getBestBlockRoot();\n+    verify(combinedClient).getStateAtSlot(slot, blockRoot);\n+    verify(context).result(args.capture());\n+\n+    SafeFuture<String> data = args.getValue();\n+    assertEquals(data.get(), jsonProvider.objectToJSON(beaconValidators));\n+  }\n+\n+  @Test\n+  public void shouldReturnBadRequestWhenBadEpochParameterSpecified() throws Exception {", "originalCommit": "79db18c6462e3135ad91d0e4aeefe1ceee364456", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}