{"pr_number": 1386, "pr_title": "Fail startup as soon as any service fails to start", "pr_createdAt": "2020-03-17T00:44:13Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1386", "timeline": [{"oid": "7831543382b45a30750b36a2042e846142e48be8", "url": "https://github.com/ConsenSys/teku/commit/7831543382b45a30750b36a2042e846142e48be8", "message": "Fail startup as soon as any service fails to start.  Avoids deadlocks where services can't complete startup until some other one does, and that dependency fails to start.", "committedDate": "2020-03-17T00:39:44Z", "type": "commit"}, {"oid": "8395431975ace88e19f0ec98dd1bed09af87b500", "url": "https://github.com/ConsenSys/teku/commit/8395431975ace88e19f0ec98dd1bed09af87b500", "message": "Spotless.", "committedDate": "2020-03-17T00:51:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzODI1Mw==", "url": "https://github.com/ConsenSys/teku/pull/1386#discussion_r393438253", "bodyText": "Would it be worth using a parallel stream rather than a sequential stream?\nStream.of(futures). parallel().forEach(future -> future.finish(() -> {}, complete::completeExceptionally));", "author": "CjHare", "createdAt": "2020-03-17T04:25:32Z", "path": "util/src/main/java/tech/pegasys/artemis/util/async/SafeFuture.java", "diffHunk": "@@ -96,6 +97,27 @@ public static void reportExceptions(final CompletionStage<?> future) {\n     return of(CompletableFuture.allOf(futures));\n   }\n \n+  /**\n+   * Returns a new SafeFuture that is completed when all of the given SafeFutures complete\n+   * successfully or completes exceptionally immediately when any of the SafeFutures complete\n+   * exceptionally. The results, if any, of the given SafeFutures are not reflected in the returned\n+   * SafeFuture, but may be obtained by inspecting them individually. If no SafeFutures are\n+   * provided, returns a SafeFuture completed with the value {@code null}.\n+   *\n+   * <p>Among the applications of this method is to await completion of a set of independent\n+   * SafeFutures before continuing a program, as in: {@code SafeFuture.allOf(c1, c2, c3).join();}.\n+   *\n+   * @param futures the SafeFutures\n+   * @return a new SafeFuture that is completed when all of the given SafeFutures complete\n+   * @throws NullPointerException if the array or any of its elements are {@code null}\n+   */\n+  public static <U> SafeFuture<Void> allOfFailFast(final SafeFuture<?>... futures) {\n+    final SafeFuture<Void> complete = new SafeFuture<>();\n+    Stream.of(futures).forEach(future -> future.finish(() -> {}, complete::completeExceptionally));", "originalCommit": "8395431975ace88e19f0ec98dd1bed09af87b500", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzOTI1NA==", "url": "https://github.com/ConsenSys/teku/pull/1386#discussion_r393439254", "bodyText": "No definitely not.  It adds a lot of complexity to reason about and the overhead of cross-thread communication is not going to be close to worth it for what is always a very small number of futures (and calling finish on each is a very cheap operation).\nIt's very rare that Stream.parallel is a good idea. :)", "author": "ajsutton", "createdAt": "2020-03-17T04:30:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzODI1Mw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQ0MzAyMA==", "url": "https://github.com/ConsenSys/teku/pull/1386#discussion_r393443020", "bodyText": "Fair enough", "author": "CjHare", "createdAt": "2020-03-17T04:48:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzQzODI1Mw=="}], "type": "inlineReview"}, {"oid": "c15d34a9e6479f208bd08b597ecb4bc65a7600f1", "url": "https://github.com/ConsenSys/teku/commit/c15d34a9e6479f208bd08b597ecb4bc65a7600f1", "message": "Merge branch 'master' into report-startup-failures", "committedDate": "2020-03-17T05:02:29Z", "type": "commit"}, {"oid": "d5d2036db64b467003bb33fcc41ee81cea6c3a58", "url": "https://github.com/ConsenSys/teku/commit/d5d2036db64b467003bb33fcc41ee81cea6c3a58", "message": "Merge branch 'master' into report-startup-failures", "committedDate": "2020-03-17T11:17:17Z", "type": "commit"}, {"oid": "fb7bf7548e54dc7b0db9a60473ef6ca0fc88e546", "url": "https://github.com/ConsenSys/teku/commit/fb7bf7548e54dc7b0db9a60473ef6ca0fc88e546", "message": "Merge branch 'master' into report-startup-failures", "committedDate": "2020-03-17T21:22:08Z", "type": "commit"}]}