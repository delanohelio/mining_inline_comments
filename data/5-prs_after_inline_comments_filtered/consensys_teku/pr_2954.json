{"pr_number": 2954, "pr_title": "Improve REST API error reporting", "pr_createdAt": "2020-10-12T23:55:49Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2954", "timeline": [{"oid": "3d07a4b0def522697d8925141a402abc4f3e71b2", "url": "https://github.com/ConsenSys/teku/commit/3d07a4b0def522697d8925141a402abc4f3e71b2", "message": "Report internal server errors correctly.\nHandle NodeSyncingException and report as 503 status.", "committedDate": "2020-10-12T23:43:00Z", "type": "commit"}, {"oid": "53cd4feb7dada1adc82390f4b1f51c546d981f07", "url": "https://github.com/ConsenSys/teku/commit/53cd4feb7dada1adc82390f4b1f51c546d981f07", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into report-internal-server-errors", "committedDate": "2020-10-12T23:56:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU5ODYxNw==", "url": "https://github.com/ConsenSys/teku/pull/2954#discussion_r503598617", "bodyText": "this breaks a lot of the old api's if we care about that?", "author": "rolfyone", "createdAt": "2020-10-13T00:13:24Z", "path": "data/beaconrestapi/src/main/java/tech/pegasys/teku/beaconrestapi/BeaconRestApi.java", "diffHunk": "@@ -161,19 +166,32 @@ private String readResource(final String fileName, Charset charset) throws IOExc\n   }\n \n   private void addExceptionHandlers() {\n+    app.exception(ChainDataUnavailableException.class, (e, ctx) -> ctx.status(SC_NO_CONTENT));\n     app.exception(\n-        ChainDataUnavailableException.class,\n+        NodeSyncingException.class,\n         (e, ctx) -> {\n-          ctx.status(SC_NO_CONTENT);\n+          ctx.status(SC_SERVICE_UNAVAILABLE);\n+          setErrorBody(ctx, () -> BadRequest.serviceUnavailable(jsonProvider));", "originalCommit": "53cd4feb7dada1adc82390f4b1f51c546d981f07", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU5OTA1NQ==", "url": "https://github.com/ConsenSys/teku/pull/2954#discussion_r503599055", "bodyText": "The diff makes it look a bit confusing.  ChainDataUnavailableException still returns SC_NO_CONTENT as always.  NodeSyncingException previously return 500 internal server error but now returns SC_SERVICE_UNAVAILABLE.", "author": "ajsutton", "createdAt": "2020-10-13T00:15:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU5ODYxNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzYwNDM3OQ==", "url": "https://github.com/ConsenSys/teku/pull/2954#discussion_r503604379", "bodyText": "ah ok", "author": "rolfyone", "createdAt": "2020-10-13T00:36:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMzU5ODYxNw=="}], "type": "inlineReview"}]}