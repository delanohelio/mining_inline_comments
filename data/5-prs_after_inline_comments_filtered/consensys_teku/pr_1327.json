{"pr_number": 1327, "pr_title": "StatusLogger controls output colour", "pr_createdAt": "2020-03-09T05:21:21Z", "pr_url": "https://github.com/ConsenSys/teku/pull/1327", "timeline": [{"oid": "299fc2ed18264166d5dee50c1c99b7ca51cd5fb6", "url": "https://github.com/ConsenSys/teku/commit/299fc2ed18264166d5dee50c1c99b7ca51cd5fb6", "message": "Partial cherry picking", "committedDate": "2020-03-09T05:07:26Z", "type": "commit"}, {"oid": "95471decf32321a88c436e2bf915fc9fb89f1a52", "url": "https://github.com/ConsenSys/teku/commit/95471decf32321a88c436e2bf915fc9fb89f1a52", "message": "Fixing", "committedDate": "2020-03-09T05:09:29Z", "type": "commit"}, {"oid": "5cd067b9c58824a3b5d504346e6e7368005c67f3", "url": "https://github.com/ConsenSys/teku/commit/5cd067b9c58824a3b5d504346e6e7368005c67f3", "message": "Next cherry picked", "committedDate": "2020-03-09T05:14:37Z", "type": "commit"}, {"oid": "dfbeacd0fba331dac98c083d932c126a5f7e3e97", "url": "https://github.com/ConsenSys/teku/commit/dfbeacd0fba331dac98c083d932c126a5f7e3e97", "message": "final changeset", "committedDate": "2020-03-09T05:17:39Z", "type": "commit"}, {"oid": "9869f9cd5ab985003c336c840e0db3b27435e430", "url": "https://github.com/ConsenSys/teku/commit/9869f9cd5ab985003c336c840e0db3b27435e430", "message": "Fixing", "committedDate": "2020-03-09T05:35:32Z", "type": "commit"}, {"oid": "a4a136425b5f85fb21133a839b312b5f7eef5210", "url": "https://github.com/ConsenSys/teku/commit/a4a136425b5f85fb21133a839b312b5f7eef5210", "message": "Fixing", "committedDate": "2020-03-09T05:36:03Z", "type": "commit"}, {"oid": "d6ebe4425b436cfc2f44042724fb4f9927de1389", "url": "https://github.com/ConsenSys/teku/commit/d6ebe4425b436cfc2f44042724fb4f9927de1389", "message": "Fixing", "committedDate": "2020-03-09T05:37:14Z", "type": "commit"}, {"oid": "bee0361e072c7667eb842b4207a0434401543469", "url": "https://github.com/ConsenSys/teku/commit/bee0361e072c7667eb842b4207a0434401543469", "message": "SpotlessApply", "committedDate": "2020-03-09T05:39:03Z", "type": "commit"}, {"oid": "c20a18352ce01988e7d59b0cb066a463ac175388", "url": "https://github.com/ConsenSys/teku/commit/c20a18352ce01988e7d59b0cb066a463ac175388", "message": "Fixing", "committedDate": "2020-03-09T05:40:29Z", "type": "commit"}, {"oid": "9e730b4001a6efc0d7ebe2f9a6262e4a3e707ecb", "url": "https://github.com/ConsenSys/teku/commit/9e730b4001a6efc0d7ebe2f9a6262e4a3e707ecb", "message": "Fixing", "committedDate": "2020-03-09T05:41:28Z", "type": "commit"}, {"oid": "79f75f5ba7651e4ca1ec6cd35dceb7c8ef65f060", "url": "https://github.com/ConsenSys/teku/commit/79f75f5ba7651e4ca1ec6cd35dceb7c8ef65f060", "message": "Fixing", "committedDate": "2020-03-09T05:42:28Z", "type": "commit"}, {"oid": "f39255a000323a001647432d8996539172e93e88", "url": "https://github.com/ConsenSys/teku/commit/f39255a000323a001647432d8996539172e93e88", "message": "Fixing", "committedDate": "2020-03-09T05:43:25Z", "type": "commit"}, {"oid": "c5b91dd0e8f594a03bd3fa4e7555e637ee19e6f3", "url": "https://github.com/ConsenSys/teku/commit/c5b91dd0e8f594a03bd3fa4e7555e637ee19e6f3", "message": "Fixing", "committedDate": "2020-03-09T05:44:23Z", "type": "commit"}, {"oid": "8ecb92279a676452f4cfd3b69e0d7a73d14abfe5", "url": "https://github.com/ConsenSys/teku/commit/8ecb92279a676452f4cfd3b69e0d7a73d14abfe5", "message": "Fixing", "committedDate": "2020-03-09T05:45:21Z", "type": "commit"}, {"oid": "e3dd8773dc96f96bc4d87cab19323a2853bbd1cb", "url": "https://github.com/ConsenSys/teku/commit/e3dd8773dc96f96bc4d87cab19323a2853bbd1cb", "message": "Fixing", "committedDate": "2020-03-09T05:46:16Z", "type": "commit"}, {"oid": "7dd7e402b3c6cfbe600623e2328ab8f52c047ab9", "url": "https://github.com/ConsenSys/teku/commit/7dd7e402b3c6cfbe600623e2328ab8f52c047ab9", "message": "Fixing", "committedDate": "2020-03-09T05:47:15Z", "type": "commit"}, {"oid": "ea0b78df228d47b046c501a97c8623e0895f0a1c", "url": "https://github.com/ConsenSys/teku/commit/ea0b78df228d47b046c501a97c8623e0895f0a1c", "message": "Fixing", "committedDate": "2020-03-09T05:51:14Z", "type": "commit"}, {"oid": "e0f142217e0863cab2d269951c9e7e770d71fe2c", "url": "https://github.com/ConsenSys/teku/commit/e0f142217e0863cab2d269951c9e7e770d71fe2c", "message": "Fixing", "committedDate": "2020-03-09T05:52:21Z", "type": "commit"}, {"oid": "3a0b6cd1e46a0f951445cbe03c8aa8678ab2d594", "url": "https://github.com/ConsenSys/teku/commit/3a0b6cd1e46a0f951445cbe03c8aa8678ab2d594", "message": "Mockito to test path", "committedDate": "2020-03-09T06:00:30Z", "type": "commit"}, {"oid": "784001f7607b08db7dc18673172833ac2f75e643", "url": "https://github.com/ConsenSys/teku/commit/784001f7607b08db7dc18673172833ac2f75e643", "message": "Static mockito", "committedDate": "2020-03-09T06:08:03Z", "type": "commit"}, {"oid": "93c4646fd0084dd6b7ed9aa2a3289b09928cefbe", "url": "https://github.com/ConsenSys/teku/commit/93c4646fd0084dd6b7ed9aa2a3289b09928cefbe", "message": "Adding deposit exceptions back to status logger", "committedDate": "2020-03-09T06:19:01Z", "type": "commit"}, {"oid": "7e87f65e1670e30ce26646b30a68eb46902b151b", "url": "https://github.com/ConsenSys/teku/commit/7e87f65e1670e30ce26646b30a68eb46902b151b", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into context-logging", "committedDate": "2020-03-09T06:19:11Z", "type": "commit"}, {"oid": "1e1bedf22aa5275882167b473575e4d9602bc24f", "url": "https://github.com/ConsenSys/teku/commit/1e1bedf22aa5275882167b473575e4d9602bc24f", "message": "Storing geneisis to Stdout", "committedDate": "2020-03-09T06:27:23Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3OTk1MA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389479950", "bodyText": "Since we're touching this anyway we should fix them to include the full stack trace.  So probably:\n} catch (fail CompletionException | IllegalArgumentException e) {\n    LOG.fatal(\"Startup failed\", e);\n}", "author": "ajsutton", "createdAt": "2020-03-09T06:23:45Z", "path": "artemis/src/main/java/tech/pegasys/artemis/BeaconNode.java", "diffHunk": "@@ -101,9 +100,9 @@ public void start() {\n       serviceController.startAll();\n \n     } catch (final CompletionException e) {\n-      STATUS_LOG.log(Level.FATAL, e.toString());\n+      LOG.fatal(e.toString());\n     } catch (final IllegalArgumentException e) {\n-      STATUS_LOG.log(Level.FATAL, e.getMessage());\n+      LOG.fatal(e.getMessage());", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ5NDMwMQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389494301", "bodyText": "Actioned", "author": "CjHare", "createdAt": "2020-03-09T07:22:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ3OTk1MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4MDUwMA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389480500", "bodyText": "These are the kinds of messages we almost certainly want going to STDOUT when in \"interactive\" mode rather than being hidden in a log file.  The spec failure suggests a block or attestation failed to process and the unexpected error definitely needs to be brought to the users attention.\nIs there a plan for how to display this kind of output which isn't the routine status updates, but should still go to the \"UI\"?", "author": "ajsutton", "createdAt": "2020-03-09T06:26:18Z", "path": "artemis/src/main/java/tech/pegasys/artemis/BeaconNode.java", "diffHunk": "@@ -118,10 +117,10 @@ public void stop() {\n final class EventBusExceptionHandler\n     implements SubscriberExceptionHandler, ChannelExceptionHandler {\n \n-  private final StatusLogger logger;\n+  private final Logger log;", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ5NjQ1MA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389496450", "bodyText": "Thanks for the additional context, I'll switch it back \ud83d\udc4d\n\nIs there a plan for how to display this kind of output which isn't the routine status updates, but should still go to the \"UI\"?\n\nNot yet, the need for that extra bucket was only slowly dawning on me. It suggests the StatusLogger may need splitting into two classes (one handling status updates and the other this kind UI feedback), as that would allow for alternative behaviours/config for them \ud83e\udd14", "author": "CjHare", "createdAt": "2020-03-09T07:29:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4MDUwMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4MDkzOA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389480938", "bodyText": "We use the static methods, not the annotations.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n              @Mock private Logger log;\n          \n          \n            \n              private Logger log = Mockito.mock(Logger.class);\n          \n      \n    \n    \n  \n\ntypically with mock as a static import.", "author": "ajsutton", "createdAt": "2020-03-09T06:28:19Z", "path": "artemis/src/test/java/tech/pegasys/artemis/EventBusExceptionHandlerTest.java", "diffHunk": "@@ -41,6 +46,8 @@\n   private final SafeFuture<Throwable> handledException = new SafeFuture<>();\n   private final SafeFuture<Throwable> unhandledExceptionFuture = new SafeFuture<>();\n \n+  @Mock private Logger log;", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4MzUxNA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389483514", "bodyText": "This is likely to trigger too often - there are multiple places in the codebase that will call process_slots but they aren't necessarily moving the canonical view of the chain forward.  Previously printEnabled appears to have always been false so this never printed. I suspect printEnabled should have been true some times but got broken somewhere along the way.  We probably want to print epoch events from BeaconChainController.processSlot where the slot events are currently printing as that is the canonical view moving forward.", "author": "ajsutton", "createdAt": "2020-03-09T06:39:45Z", "path": "ethereum/statetransition/src/main/java/tech/pegasys/artemis/statetransition/StateTransition.java", "diffHunk": "@@ -226,15 +224,14 @@ public void process_slots(MutableBeaconState state, UnsignedLong slot, boolean p\n             .plus(UnsignedLong.ONE)\n             .mod(UnsignedLong.valueOf(SLOTS_PER_EPOCH))\n             .equals(UnsignedLong.ZERO)) {\n-          STATUS_LOG.log(\n-              Level.INFO, \"******* Epoch Event *******\", printEnabled, StatusLogger.Color.BLUE);\n+          STATUS_LOG.epochEvent();", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAxMjEyMQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390012121", "bodyText": "Yes, I'd noticed that printEnabled was always false ..which did look suspect. This input saves me from working backwards to figure out where to remove the unnecessary calls from  \ud83d\ude42", "author": "CjHare", "createdAt": "2020-03-09T23:15:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4MzUxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4MzY5Mg==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389483692", "bodyText": "We should include full stack traces whenever we move to a normal log4j logger.  Just make sure to include a string as the first arg and not just use LOG.warn(e) which will only print the message.", "author": "ajsutton", "createdAt": "2020-03-09T06:40:33Z", "path": "ethereum/statetransition/src/main/java/tech/pegasys/artemis/statetransition/StateTransition.java", "diffHunk": "@@ -226,15 +224,14 @@ public void process_slots(MutableBeaconState state, UnsignedLong slot, boolean p\n             .plus(UnsignedLong.ONE)\n             .mod(UnsignedLong.valueOf(SLOTS_PER_EPOCH))\n             .equals(UnsignedLong.ZERO)) {\n-          STATUS_LOG.log(\n-              Level.INFO, \"******* Epoch Event *******\", printEnabled, StatusLogger.Color.BLUE);\n+          STATUS_LOG.epochEvent();\n           process_epoch(state);\n           reportExceptions(CompletableFuture.runAsync(() -> recordMetrics(state)));\n         }\n         state.setSlot(state.getSlot().plus(UnsignedLong.ONE));\n       }\n     } catch (IllegalArgumentException e) {\n-      STATUS_LOG.log(Level.WARN, e.getMessage());\n+      LOG.warn(e.getMessage());", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NDA3Nw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389484077", "bodyText": "These are both really important messages that should go to STDOUT. I'd probably keep the colours too.", "author": "ajsutton", "createdAt": "2020-03-09T06:42:18Z", "path": "ethereum/statetransition/src/main/java/tech/pegasys/artemis/statetransition/util/StartupUtil.java", "diffHunk": "@@ -91,21 +92,19 @@ public static void setupInitialState(\n     BeaconState initialState;\n     if (startState != null) {\n       try {\n-        STATUS_LOG.log(\n-            Level.INFO, \"Loading initial state from \" + startState, StatusLogger.Color.GREEN);\n+        LOG.log(Level.INFO, \"Loading initial state from \" + startState);\n         initialState = StartupUtil.loadBeaconStateFromFile(startState);\n       } catch (final IOException e) {\n         throw new IllegalStateException(\"Failed to load initial state\", e);\n       }\n     } else {\n-      STATUS_LOG.log(\n+      LOG.log(\n           Level.INFO,\n           \"Starting with mocked start interoperability mode with genesis time \"\n               + genesisTime\n               + \" and \"\n               + validatorKeyPairs.size()\n-              + \" validators\",\n-          Color.GREEN);\n+              + \" validators\");", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwNjQ2Ng==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390706466", "bodyText": "I'd still prefer these to go to stdout.  Where genesis comes from is a really important piece of information.", "author": "ajsutton", "createdAt": "2020-03-11T01:57:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NDA3Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NDc1Nw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389484757", "bodyText": "I'm not a huge fan of making this singleton mutable.  Why is this needed?\nIf it is needed, it would need to be thread safe which it isn't currently.", "author": "ajsutton", "createdAt": "2020-03-09T06:45:23Z", "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -13,84 +13,85 @@\n \n package tech.pegasys.teku.logging;\n \n-import org.apache.logging.log4j.Level;\n+import static tech.pegasys.teku.logging.ColorConsolePrinter.print;\n+\n+import com.google.common.primitives.UnsignedLong;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n+import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.teku.logging.ColorConsolePrinter.Color;\n \n public class StatusLogger {\n \n   public static final StatusLogger STATUS_LOG = new StatusLogger(\"stdout\");\n \n-  public enum Color {\n-    RED,\n-    BLUE,\n-    PURPLE,\n-    WHITE,\n-    GREEN\n-  }\n+  private final Logger logger;\n+  private boolean enabled;\n \n-  private static final String resetCode = \"\\u001B[0m\";\n+  private StatusLogger(final String name) {\n+    this.logger = LogManager.getLogger(name);\n+  }\n \n-  private final Logger logger;\n+  public void setEnabled(final boolean enabled) {\n+    this.enabled = enabled;\n+  }", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NTE5OA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389485198", "bodyText": "nit: Worth being consistent in whether or not the constant strings have a concatenation break in them so the spacing lines up.\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                info(\"Node slot:                             \" + nodeSlot);\n          \n          \n            \n                info(\"Head block slot:\" + \"                       \" + bestSlot);\n          \n          \n            \n                info(\"Justified epoch:\" + \"                       \" + justifiedEpoch);\n          \n          \n            \n                info(\"Finalized epoch:\" + \"                       \" + finalizedEpoch);\n          \n          \n            \n                info(\"Node slot:                             \" + nodeSlot);\n          \n          \n            \n                info(\"Head block slot:                       \" + bestSlot);\n          \n          \n            \n                info(\"Justified epoch:                       \" + justifiedEpoch);\n          \n          \n            \n                info(\"Finalized epoch:                       \" + finalizedEpoch);", "author": "ajsutton", "createdAt": "2020-03-09T06:46:59Z", "path": "logging/src/main/java/tech/pegasys/teku/logging/StatusLogger.java", "diffHunk": "@@ -13,84 +13,85 @@\n \n package tech.pegasys.teku.logging;\n \n-import org.apache.logging.log4j.Level;\n+import static tech.pegasys.teku.logging.ColorConsolePrinter.print;\n+\n+import com.google.common.primitives.UnsignedLong;\n import org.apache.logging.log4j.LogManager;\n import org.apache.logging.log4j.Logger;\n+import org.apache.tuweni.bytes.Bytes32;\n+import tech.pegasys.teku.logging.ColorConsolePrinter.Color;\n \n public class StatusLogger {\n \n   public static final StatusLogger STATUS_LOG = new StatusLogger(\"stdout\");\n \n-  public enum Color {\n-    RED,\n-    BLUE,\n-    PURPLE,\n-    WHITE,\n-    GREEN\n-  }\n+  private final Logger logger;\n+  private boolean enabled;\n \n-  private static final String resetCode = \"\\u001B[0m\";\n+  private StatusLogger(final String name) {\n+    this.logger = LogManager.getLogger(name);\n+  }\n \n-  private final Logger logger;\n+  public void setEnabled(final boolean enabled) {\n+    this.enabled = enabled;\n+  }\n \n-  protected StatusLogger(String className) {\n-    this.logger = LogManager.getLogger(className);\n+  public void genesisEvent(final Bytes32 hashTreeRoot, final Bytes32 genesisBlockRoot) {\n+    info(\"******* Eth2Genesis Event*******\", Color.WHITE);\n+    info(\"Initial state root is \" + hashTreeRoot.toHexString());\n+    info(\"Genesis block root is \" + genesisBlockRoot.toHexString());\n   }\n \n-  public void log(Level level, String message) {\n-    this.logger.log(level, message);\n+  public void epochEvent() {\n+    info(\"******* Epoch Event *******\", Color.PURPLE);\n   }\n \n-  public void log(Level level, String message, boolean printEnabled) {\n-    if (printEnabled) {\n-      this.logger.log(level, message);\n-    }\n+  public void slotEvent(\n+      final UnsignedLong nodeSlot,\n+      final UnsignedLong bestSlot,\n+      final UnsignedLong justifiedEpoch,\n+      final UnsignedLong finalizedEpoch) {\n+    info(\"******* Slot Event *******\", Color.WHITE);\n+    info(\"Node slot:                             \" + nodeSlot);\n+    info(\"Head block slot:\" + \"                       \" + bestSlot);\n+    info(\"Justified epoch:\" + \"                       \" + justifiedEpoch);\n+    info(\"Finalized epoch:\" + \"                       \" + finalizedEpoch);", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDAxODE0NQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390018145", "bodyText": "Consistency is good. The StatusLogger has yet to reach it's final iteration (hence these kind of inconsistencies) ...but I'll tidy 'em up for this PR \ud83d\udc4d", "author": "CjHare", "createdAt": "2020-03-09T23:35:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NTE5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NTU5NA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389485594", "bodyText": "This is a really, really useful thing to have printed to stdout.", "author": "ajsutton", "createdAt": "2020-03-09T06:48:39Z", "path": "networking/p2p/src/main/java/tech/pegasys/artemis/networking/p2p/libp2p/LibP2PNetwork.java", "diffHunk": "@@ -149,11 +151,11 @@ public LibP2PNetwork(\n     if (!state.compareAndSet(State.IDLE, State.RUNNING)) {\n       return SafeFuture.failedFuture(new IllegalStateException(\"Network already started\"));\n     }\n-    STATUS_LOG.log(Level.INFO, \"Starting libp2p network...\");\n+    LOG.info(\"Starting libp2p network...\");\n     return SafeFuture.of(host.start())\n         .thenApply(\n             i -> {\n-              STATUS_LOG.log(Level.INFO, \"Listening for connections on: \" + getNodeAddress());\n+              LOG.info(\"Listening for connections on: {}\", getNodeAddress());", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA2MDQ0Mw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390060443", "bodyText": "Actioned", "author": "CjHare", "createdAt": "2020-03-10T02:21:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NTU5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjQxMw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389486413", "bodyText": "Fatal error probably should go to stdout.  The user would want to know that we won't be running their validator so they will be losing money.", "author": "ajsutton", "createdAt": "2020-03-09T06:51:54Z", "path": "validator/coordinator/src/main/java/tech/pegasys/artemis/validator/coordinator/KeystoresValidatorKeyProvider.java", "diffHunk": "@@ -82,7 +84,7 @@ private String loadPassword(final Path passwordFile) {\n           format(\n               \"Unexpected IO error while reading keystore password file [%s]: %s\",\n               passwordFile, e.getMessage());\n-      STATUS_LOG.log(Level.FATAL, errorMessage);\n+      LOG.fatal(errorMessage);", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3MTQ1Mg==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390671452", "bodyText": "The error message makes its way into the stdout, by virtue of being converted to a RuntimeException subclass and caught by the BeaconNode.start() catch block.\nPerhaps this log line is not required here (as it causes duplicate logging), without any additional information?", "author": "CjHare", "createdAt": "2020-03-10T23:37:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3MjEyMg==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390672122", "bodyText": "Yes, we should either catch and log, or rethrow but not both (unless we can provide some extra unique information at this level that will be lost higher up).", "author": "ajsutton", "createdAt": "2020-03-10T23:39:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY3OTk1Nw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390679957", "bodyText": "Thinking about this after finishing my first coffee of the day ...I should be deleting this duplicate logging,. Even if the message needs to be displayed in two seperate places that is probably best achieved with logging configuration, rather then programatically,", "author": "CjHare", "createdAt": "2020-03-11T00:07:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjQxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDY4MDQ5Mw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390680493", "bodyText": "Yep, all messages that go to stdout should also go to the log file so you have a complete record in the log file.", "author": "ajsutton", "createdAt": "2020-03-11T00:09:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjQxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389486547", "bodyText": "Probably should be noted on stdout.  The user will lose money as a result of failing to perform their validator duties.", "author": "ajsutton", "createdAt": "2020-03-09T06:52:29Z", "path": "validator/coordinator/src/main/java/tech/pegasys/artemis/validator/coordinator/ValidatorCoordinator.java", "diffHunk": "@@ -212,7 +214,7 @@ public void onAttestationEvent(BroadcastAttestationEvent event) throws IllegalAr\n       // Save headState to check for slashings\n       //      this.headState = headState;\n     } catch (IllegalArgumentException e) {\n-      STATUS_LOG.log(Level.WARN, \"Can not produce attestations or create a block\" + e.toString());\n+      LOG.warn(\"Can not produce attestations or create a block\" + e.toString());", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA2MTI1Mw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390061253", "bodyText": "Would an error message output also be warranted for the other two flows that produce IllegalArgumentException?", "author": "CjHare", "createdAt": "2020-03-10T02:24:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA2MjM1NQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390062355", "bodyText": "Not sure what other two flows you mean.  The basic rule I'm applying is that if it's going to cost me money, I want it to go to STDOUT.  Failing create attestations and blocks will do that.  Failing to process them may not (it may actually be an invalid block), but it's a bit border line because if there's a bug that caused a consensus failure then I'll drop out of sync and no longer be attesting to the right chain (and thus stop being rewarded).", "author": "ajsutton", "createdAt": "2020-03-10T02:29:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA2NTU5OA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390065598", "bodyText": "Sorry, I meant that for the above comment (on KeystoresValidatorKeyProvider.java), as that has the two IllegalArgumentException lines prior to the log case.\nAll three flows result in the same outcome, namely a runtime subclass.", "author": "CjHare", "createdAt": "2020-03-10T02:43:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA2NjU1MA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390066550", "bodyText": "Applying the principle of reporting things that would cause you to lose money to stdout, then yes anything that causes us to not load validator keys should be reported.  Probably should cause startup to fail entirely actually - not quite sure where the scope boundary for this work is in that mix though. :)", "author": "ajsutton", "createdAt": "2020-03-10T02:46:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3OTE0MA==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390079140", "bodyText": "Once you begin pulling at a thread ...I suppose \ud83d\ude44\nWhen a RuntimeException is thrown during those flows (or any time during startup, it seems), Teku stops loading with the Exception logged (to the log file, not the console).", "author": "CjHare", "createdAt": "2020-03-10T03:39:42Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA3OTcxMw==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390079713", "bodyText": "BeaconNode.start() is the line that I'll change to console logging, as that'll catch the validator password keyfile too", "author": "CjHare", "createdAt": "2020-03-10T03:42:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjY0OQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r389486649", "bodyText": "Should go to std out, this will cause the user to lose money.", "author": "ajsutton", "createdAt": "2020-03-09T06:52:52Z", "path": "validator/coordinator/src/main/java/tech/pegasys/artemis/validator/coordinator/ValidatorCoordinator.java", "diffHunk": "@@ -283,9 +285,9 @@ private void createBlockIfNecessary(\n               deposits);\n \n       this.eventBus.post(new ProposedBlockEvent(newBlock));\n-      STATUS_LOG.log(Level.DEBUG, \"Local validator produced a new block\");\n+      LOG.debug(\"Local validator produced a new block\");\n     } catch (SlotProcessingException | EpochProcessingException | StateTransitionException e) {\n-      STATUS_LOG.log(Level.ERROR, \"Error during block creation \" + e.toString());\n+      LOG.error(\"Error during block creation \" + e.toString());", "originalCommit": "7e87f65e1670e30ce26646b30a68eb46902b151b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDA2NDU4Ng==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390064586", "bodyText": "Done \ud83d\udc4d", "author": "CjHare", "createdAt": "2020-03-10T02:39:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4OTQ4NjY0OQ=="}], "type": "inlineReview"}, {"oid": "70bd9ee8c9d9d0bd11a16b7f6fea92eea72cf342", "url": "https://github.com/ConsenSys/teku/commit/70bd9ee8c9d9d0bd11a16b7f6fea92eea72cf342", "message": "Full exception message", "committedDate": "2020-03-09T07:21:58Z", "type": "commit"}, {"oid": "e8fe6cf955e39d791fc26b51874f008253d8f859", "url": "https://github.com/ConsenSys/teku/commit/e8fe6cf955e39d791fc26b51874f008253d8f859", "message": "Update artemis/src/test/java/tech/pegasys/artemis/EventBusExceptionHandlerTest.java\n\nCo-Authored-By: Adrian Sutton <adrian@symphonious.net>", "committedDate": "2020-03-09T07:24:49Z", "type": "commit"}, {"oid": "0ae63037225ff9e8d132dfcd16ff6c028ba45ef2", "url": "https://github.com/ConsenSys/teku/commit/0ae63037225ff9e8d132dfcd16ff6c028ba45ef2", "message": "Mocking", "committedDate": "2020-03-09T07:25:59Z", "type": "commit"}, {"oid": "8da6cd751974078fe244f3b5eb3bee198fccf839", "url": "https://github.com/ConsenSys/teku/commit/8da6cd751974078fe244f3b5eb3bee198fccf839", "message": "Becon node exception logged to console", "committedDate": "2020-03-09T23:11:21Z", "type": "commit"}, {"oid": "2755070a7ed60908dfa2ed6f08e9e561fd1f04f2", "url": "https://github.com/ConsenSys/teku/commit/2755070a7ed60908dfa2ed6f08e9e561fd1f04f2", "message": "Moving Epoch printing", "committedDate": "2020-03-09T23:32:22Z", "type": "commit"}, {"oid": "d26cbc6920fb6d0d6747c36f757809f0928d603e", "url": "https://github.com/ConsenSys/teku/commit/d26cbc6920fb6d0d6747c36f757809f0928d603e", "message": "Logging stacktrace on warn", "committedDate": "2020-03-09T23:34:40Z", "type": "commit"}, {"oid": "0be1a8a0e80cd0437600e1e8b7212535e37f6f91", "url": "https://github.com/ConsenSys/teku/commit/0be1a8a0e80cd0437600e1e8b7212535e37f6f91", "message": "Removing currently unused enabled flag", "committedDate": "2020-03-10T00:53:38Z", "type": "commit"}, {"oid": "6934bb9e3e737324d37dd315c5b189fb61506c36", "url": "https://github.com/ConsenSys/teku/commit/6934bb9e3e737324d37dd315c5b189fb61506c36", "message": "LibP2P listening address to console", "committedDate": "2020-03-10T02:21:23Z", "type": "commit"}, {"oid": "9f85f3b47d10143021544e16a3727f7f2632c610", "url": "https://github.com/ConsenSys/teku/commit/9f85f3b47d10143021544e16a3727f7f2632c610", "message": "Block creation failure to console", "committedDate": "2020-03-10T02:33:26Z", "type": "commit"}, {"oid": "e74c04f857d1c62e46c93a1e3cc31c3c11411209", "url": "https://github.com/ConsenSys/teku/commit/e74c04f857d1c62e46c93a1e3cc31c3c11411209", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into context-logging", "committedDate": "2020-03-10T02:43:26Z", "type": "commit"}, {"oid": "f0e1758295a87b598912295ef85669681e48c236", "url": "https://github.com/ConsenSys/teku/commit/f0e1758295a87b598912295ef85669681e48c236", "message": "Fixing test", "committedDate": "2020-03-10T02:54:56Z", "type": "commit"}, {"oid": "e7ee7207c815118a512968b3c34de1bcf5baaa6c", "url": "https://github.com/ConsenSys/teku/commit/e7ee7207c815118a512968b3c34de1bcf5baaa6c", "message": "Attestation faliure to console", "committedDate": "2020-03-10T03:03:04Z", "type": "commit"}, {"oid": "c8087539ba786dd2ad945470b285580abac6c2cc", "url": "https://github.com/ConsenSys/teku/commit/c8087539ba786dd2ad945470b285580abac6c2cc", "message": "Startup failures to console", "committedDate": "2020-03-10T03:44:40Z", "type": "commit"}, {"oid": "692a630395a319adb630c79dfc2cfe626a9e4ad5", "url": "https://github.com/ConsenSys/teku/commit/692a630395a319adb630c79dfc2cfe626a9e4ad5", "message": "Consistent method names", "committedDate": "2020-03-10T03:47:15Z", "type": "commit"}, {"oid": "a74001c70c5525e22e4b015f38eb33c0e56706d0", "url": "https://github.com/ConsenSys/teku/commit/a74001c70c5525e22e4b015f38eb33c0e56706d0", "message": "Removing unused field", "committedDate": "2020-03-10T03:47:58Z", "type": "commit"}, {"oid": "f016b61e59f9a16957279a2735a66678f4244e8e", "url": "https://github.com/ConsenSys/teku/commit/f016b61e59f9a16957279a2735a66678f4244e8e", "message": "Typos", "committedDate": "2020-03-10T04:23:53Z", "type": "commit"}, {"oid": "4acc636a5923b9a97bc6f660bc91a6150ad6aafc", "url": "https://github.com/ConsenSys/teku/commit/4acc636a5923b9a97bc6f660bc91a6150ad6aafc", "message": "EventLogger", "committedDate": "2020-03-10T04:40:17Z", "type": "commit"}, {"oid": "2c226b159c9ed800b75e6ddbb875ed5bcdfd371d", "url": "https://github.com/ConsenSys/teku/commit/2c226b159c9ed800b75e6ddbb875ed5bcdfd371d", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into context-logging", "committedDate": "2020-03-10T04:40:25Z", "type": "commit"}, {"oid": "1faf0ad757c288ffb6ec058259864964960dd8df", "url": "https://github.com/ConsenSys/teku/commit/1faf0ad757c288ffb6ec058259864964960dd8df", "message": "Supplier", "committedDate": "2020-03-10T04:54:03Z", "type": "commit"}, {"oid": "fe91e8280061ae8ae42e8896c5f0714de3fd6d3b", "url": "https://github.com/ConsenSys/teku/commit/fe91e8280061ae8ae42e8896c5f0714de3fd6d3b", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into context-logging", "committedDate": "2020-03-10T23:27:29Z", "type": "commit"}, {"oid": "bf790f16e8d6385421fdcb27c60a3970b00a6288", "url": "https://github.com/ConsenSys/teku/commit/bf790f16e8d6385421fdcb27c60a3970b00a6288", "message": "Removing duplicate logging", "committedDate": "2020-03-10T23:55:23Z", "type": "commit"}, {"oid": "fe5353f64927c78121d42b382d3405e956ebf554", "url": "https://github.com/ConsenSys/teku/commit/fe5353f64927c78121d42b382d3405e956ebf554", "message": "Merge branch 'master' of github.com:PegaSysEng/teku into context-logging", "committedDate": "2020-03-11T00:56:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwNTY1Ng==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390705656", "bodyText": "We should include the full stack trace here:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.error(\"Failed to record data to {} : {}\", file, e.getMessage());\n          \n          \n            \n                  LOG.error(\"Failed to record data to \" + file, e);", "author": "ajsutton", "createdAt": "2020-03-11T01:53:32Z", "path": "data/recorder/src/main/java/tech/pegasys/artemis/data/recorder/SSZTransitionRecorder.java", "diffHunk": "@@ -69,14 +71,13 @@ private void store(final Path file, SimpleOffsetSerializable data) {\n     try {\n       Files.write(file, serialize(data).toArrayUnsafe());\n     } catch (final IOException e) {\n-      STATUS_LOG.log(Level.ERROR, \"Failed to record data to \" + file + \": \" + e.getMessage());\n+      LOG.error(\"Failed to record data to {} : {}\", file, e.getMessage());", "originalCommit": "fe5353f64927c78121d42b382d3405e956ebf554", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwNjAyMQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390706021", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.warn(e.getMessage(), e);\n          \n          \n            \n                  LOG.warn(\"Failed to process slots\"), e);\n          \n      \n    \n    \n  \n\nJust to provide context rather than repeating the exception message.", "author": "ajsutton", "createdAt": "2020-03-11T01:55:12Z", "path": "ethereum/statetransition/src/main/java/tech/pegasys/artemis/statetransition/StateTransition.java", "diffHunk": "@@ -226,15 +223,13 @@ public void process_slots(MutableBeaconState state, UnsignedLong slot, boolean p\n             .plus(UnsignedLong.ONE)\n             .mod(UnsignedLong.valueOf(SLOTS_PER_EPOCH))\n             .equals(UnsignedLong.ZERO)) {\n-          STATUS_LOG.log(\n-              Level.INFO, \"******* Epoch Event *******\", printEnabled, StatusLogger.Color.BLUE);\n           process_epoch(state);\n           reportExceptions(CompletableFuture.runAsync(() -> recordMetrics(state)));\n         }\n         state.setSlot(state.getSlot().plus(UnsignedLong.ONE));\n       }\n     } catch (IllegalArgumentException e) {\n-      STATUS_LOG.log(Level.WARN, e.getMessage());\n+      LOG.warn(e.getMessage(), e);", "originalCommit": "fe5353f64927c78121d42b382d3405e956ebf554", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MDcwNzQwNQ==", "url": "https://github.com/ConsenSys/teku/pull/1327#discussion_r390707405", "bodyText": "Need to include the exception\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                  LOG.error(\"Failed to clear old database\");\n          \n          \n            \n                  LOG.error(\"Failed to clear old database\", e);", "author": "ajsutton", "createdAt": "2020-03-11T02:00:30Z", "path": "storage/src/main/java/tech/pegasys/artemis/storage/MapDbDatabase.java", "diffHunk": "@@ -77,7 +74,7 @@ public static Database createOnDisk(final File directory, final boolean startFro\n         Files.deleteIfExists(databaseFile.toPath());\n       }\n     } catch (IOException e) {\n-      STATUS_LOG.log(Level.ERROR, \"Failed to clear old database\");\n+      LOG.error(\"Failed to clear old database\");", "originalCommit": "fe5353f64927c78121d42b382d3405e956ebf554", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f76c647ed3617fd120cd6cebcc2128e95111b166", "url": "https://github.com/ConsenSys/teku/commit/f76c647ed3617fd120cd6cebcc2128e95111b166", "message": "Update data/recorder/src/main/java/tech/pegasys/artemis/data/recorder/SSZTransitionRecorder.java\n\nCo-Authored-By: Adrian Sutton <adrian@symphonious.net>", "committedDate": "2020-03-11T02:27:31Z", "type": "commit"}]}