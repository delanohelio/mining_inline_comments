{"pr_number": 2186, "pr_title": "Use separate transactions when updating finalized state vs hot state", "pr_createdAt": "2020-06-22T00:09:46Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2186", "timeline": [{"oid": "5fbd295b316a065ff0c68da3488e7d9ee3c22004", "url": "https://github.com/ConsenSys/teku/commit/5fbd295b316a065ff0c68da3488e7d9ee3c22004", "message": "Use separate transactions when updating finalized state vs hot state.", "committedDate": "2020-06-22T00:06:46Z", "type": "commit"}, {"oid": "0d3cf770a2977e295f40b08c39df9b0028490cac", "url": "https://github.com/ConsenSys/teku/commit/0d3cf770a2977e295f40b08c39df9b0028490cac", "message": "Split RocksDbDao into separate interfaces for hot, finalized and eth1 data.", "committedDate": "2020-06-22T00:34:38Z", "type": "commit"}, {"oid": "18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838", "url": "https://github.com/ConsenSys/teku/commit/18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838", "message": "Move latest finalized state to hot dao so it's in sync with finalized checkpoint.\nAdd some comments.", "committedDate": "2020-06-22T01:13:26Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3ODI1Mg==", "url": "https://github.com/ConsenSys/teku/pull/2186#discussion_r443278252", "bodyText": "would commit failure here cause unhandled exceptions?", "author": "rolfyone", "createdAt": "2020-06-22T01:17:24Z", "path": "storage/src/main/java/tech/pegasys/teku/storage/server/rocksdb/RocksDbDatabase.java", "diffHunk": "@@ -98,13 +109,14 @@ public void storeGenesis(final UpdatableStore store) {\n         // We need to store the genesis block in both hot and cold storage so that on restart\n         // we're guaranteed to have at least one block / state to load into RecentChainData.\n         // Save to hot storage\n-        updater.addHotBlock(block);\n+        hotUpdater.addHotBlock(block);\n         // Save to cold storage\n-        updater.addFinalizedBlock(block);\n-        putFinalizedState(updater, root, state);\n+        finalizedUpdater.addFinalizedBlock(block);\n+        putFinalizedState(finalizedUpdater, root, state);\n       }\n \n-      updater.commit();\n+      finalizedUpdater.commit();", "originalCommit": "18ea9af6fd3a5d9ed0e758a1c6b91df8bafa4838", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3OTA0Nw==", "url": "https://github.com/ConsenSys/teku/pull/2186#discussion_r443279047", "bodyText": "It gets handled in ChainStorage.onStorageUpdate and even that isn't actually necessary as the event channel would have packaged it back up into the returned SafeFuture rather than leaving it unhandled.", "author": "ajsutton", "createdAt": "2020-06-22T01:23:27Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzI3ODI1Mg=="}], "type": "inlineReview"}]}