{"pr_number": 2865, "pr_title": "Add more constraints around Store.time", "pr_createdAt": "2020-09-29T13:58:59Z", "pr_url": "https://github.com/ConsenSys/teku/pull/2865", "timeline": [{"oid": "9ca8dcd420765bba94554ab25b8f9d154421a64f", "url": "https://github.com/ConsenSys/teku/commit/9ca8dcd420765bba94554ab25b8f9d154421a64f", "message": "Set time based on the latest finalized state", "committedDate": "2020-09-29T13:57:24Z", "type": "commit"}, {"oid": "14a7ba006ef9e7bf8fc4dfc369886eaa03669b39", "url": "https://github.com/ConsenSys/teku/commit/14a7ba006ef9e7bf8fc4dfc369886eaa03669b39", "message": "Add more checks around initializing and setting Store.time", "committedDate": "2020-09-29T15:08:44Z", "type": "commit"}, {"oid": "19c92f76a11cc85b9a40c434af0c36d4ad20c3c4", "url": "https://github.com/ConsenSys/teku/commit/19c92f76a11cc85b9a40c434af0c36d4ad20c3c4", "message": "Add test that retrieves Store from genesis prior to genesis time", "committedDate": "2020-09-29T15:32:14Z", "type": "commit"}, {"oid": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d", "url": "https://github.com/ConsenSys/teku/commit/618aac3e0e26adabdcfd97dc0667b6ac9698c40d", "message": "Update ForkChoiceUtil tests", "committedDate": "2020-09-29T15:43:41Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0NTAzNg==", "url": "https://github.com/ConsenSys/teku/pull/2865#discussion_r496845036", "bodyText": "Should we still not keep the property of not executing on_tick before genesis time?", "author": "cemozerr", "createdAt": "2020-09-29T15:56:51Z", "path": "ethereum/core/src/main/java/tech/pegasys/teku/core/ForkChoiceUtil.java", "diffHunk": "@@ -193,7 +193,7 @@ private static boolean should_update_justified_checkpoint(\n    *     <a>https://github.com/ethereum/eth2.0-specs/blob/v0.8.1/specs/core/0_fork-choice.md#on_tick</a>\n    */\n   public static void on_tick(MutableStore store, UInt64 time) {\n-    if (store.getGenesisTime().isGreaterThan(time)) {", "originalCommit": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg1MzYwMw==", "url": "https://github.com/ConsenSys/teku/pull/2865#discussion_r496853603", "bodyText": "Feels a bit defensive since time should be >= genesisTime, but added this back in for good measure", "author": "mbaxter", "createdAt": "2020-09-29T16:05:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0NTAzNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njg0NjAxOA==", "url": "https://github.com/ConsenSys/teku/pull/2865#discussion_r496846018", "bodyText": "This test seems to be redundant & a bit misleading.", "author": "cemozerr", "createdAt": "2020-09-29T15:57:48Z", "path": "ethereum/core/src/test/java/tech/pegasys/teku/core/ForkChoiceUtilTest.java", "diffHunk": "@@ -159,12 +159,22 @@ public void getSlotStartTime_shouldGetCorrectTimePastGenesis() {\n   void on_tick_shouldExitImmediatelyWhenCurrentTimeIsBeforeGenesisTime() {\n     final MutableStore store = mock(MutableStore.class);\n     when(store.getGenesisTime()).thenReturn(UInt64.valueOf(3000));\n-    when(store.getTime()).thenReturn(UInt64.ZERO);\n+    when(store.getTime()).thenReturn(UInt64.valueOf(3000));", "originalCommit": "618aac3e0e26adabdcfd97dc0667b6ac9698c40d", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "aa3cb6367ee04046802197a85d2ffb335b4aa2ea", "url": "https://github.com/ConsenSys/teku/commit/aa3cb6367ee04046802197a85d2ffb335b4aa2ea", "message": "Check both time and genesisTime in on_tick", "committedDate": "2020-09-29T16:03:53Z", "type": "commit"}]}