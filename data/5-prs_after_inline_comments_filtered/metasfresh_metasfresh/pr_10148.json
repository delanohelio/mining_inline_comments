{"pr_number": 10148, "pr_title": "Gh10127 export all shipment schedules for order", "pr_createdAt": "2020-10-22T15:46:45Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/10148", "timeline": [{"oid": "d69815ac25b3760f6d41cadf12ee37153cff8be4", "url": "https://github.com/metasfresh/metasfresh/commit/d69815ac25b3760f6d41cadf12ee37153cff8be4", "message": "#10127 shipment schedule export - whole orders (WIP)\n\nhttps://github.com/metasfresh/metasfresh/issues/10127", "committedDate": "2020-10-16T14:53:19Z", "type": "commit"}, {"oid": "2bdcd86e1eac030f5be02cbf786d5b39f828db93", "url": "https://github.com/metasfresh/metasfresh/commit/2bdcd86e1eac030f5be02cbf786d5b39f828db93", "message": "#10127 refactoring\n\nhttps://github.com/metasfresh/metasfresh/issues/10127", "committedDate": "2020-10-19T11:55:17Z", "type": "commit"}, {"oid": "6443ca25cae85e4138ea6891230357fde65c8361", "url": "https://github.com/metasfresh/metasfresh/commit/6443ca25cae85e4138ea6891230357fde65c8361", "message": "#10127 no future export for order's shipment schedules\n\nhttps://github.com/metasfresh/metasfresh/issues/10127", "committedDate": "2020-10-20T10:53:38Z", "type": "commit"}, {"oid": "16ec1652d0dd73a866f6d3bcf335e5d1a84d6d80", "url": "https://github.com/metasfresh/metasfresh/commit/16ec1652d0dd73a866f6d3bcf335e5d1a84d6d80", "message": "#10127 shipment schedule export tests\n\nhttps://github.com/metasfresh/metasfresh/issues/10127", "committedDate": "2020-10-22T15:06:35Z", "type": "commit"}, {"oid": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb", "url": "https://github.com/metasfresh/metasfresh/commit/a6064cc806ca40fc564d9a5539d4d87d50bb35fb", "message": "#10127 small cleanup\n\nhttps://github.com/metasfresh/metasfresh/issues/10127", "committedDate": "2020-10-22T15:51:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3NTQwNw==", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510275407", "bodyText": "if i get it right, you can break if the limit is reached, and don't have to iterate the remaining schedules", "author": "metas-ts", "createdAt": "2020-10-22T15:55:34Z", "path": "backend/de.metas.business.rest-api-impl/src/main/java/de/metas/rest_api/shipping/ShipmentCandidateAPIService.java", "diffHunk": "@@ -636,13 +640,51 @@ private IdsRegistry buildIdsRegistry(@NonNull final List<ShipmentSchedule> sched\n \tprivate List<ShipmentSchedule> loadShipmentSchedulesToExport(@NonNull final QueryLimit limit)\n \t{\n \t\tfinal ShipmentScheduleQuery shipmentScheduleQuery = ShipmentScheduleQuery.builder()\n-\t\t\t\t.limit(limit)\n \t\t\t\t.canBeExportedFrom(SystemTime.asInstant())\n+\t\t\t\t.noFutureExportOfOrder(true)\n \t\t\t\t.exportStatus(APIExportStatus.Pending)\n \t\t\t\t.includeWithQtyToDeliverZero(true)\n+\t\t\t\t.fromCompleteOrderOrNullOrder(true)\n+\t\t\t\t.orderByOrderId(true)\n \t\t\t\t.build();\n \n-\t\treturn shipmentScheduleRepository.getBy(shipmentScheduleQuery);\n+\t\tfinal List<ShipmentSchedule> shipmentSchedulesOrderedByOrderId = shipmentScheduleRepository.getBy(shipmentScheduleQuery);\n+\t\tList<ShipmentSchedule> schedulesToBeExported = new ArrayList<>();\n+\n+\t\tint counter = 0;\n+\t\tfor (ShipmentSchedule schedule : shipmentSchedulesOrderedByOrderId)\n+\t\t{\n+\t\t\tif (schedule.getOrderAndLineId() == null && counter < limit.toInt() - 1)", "originalCommit": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3OTk5NA==", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510279994", "bodyText": "i could understand noFutureExportOfOrder only after looking at the code in ShipmentScheduleRepository..\npls add a javadoc-comment to it, oooor think of a better name...like..maybe sth like onlyIfAllFromOrderExportable?", "author": "metas-ts", "createdAt": "2020-10-22T16:01:42Z", "path": "backend/de.metas.swat/de.metas.swat.base/src/main/java/de/metas/inoutcandidate/ShipmentScheduleRepository.java", "diffHunk": "@@ -227,5 +273,14 @@ private void save(@NonNull final ShipmentSchedule shipmentSchedule)\n \n \t\t@Builder.Default\n \t\tboolean includeProcessed = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean fromCompleteOrderOrNullOrder = false;\n+\n+\t\t@Builder.Default\n+\t\tboolean orderByOrderId = false;\n+\t\t@Builder.Default\n+\t\tboolean noFutureExportOfOrder = false;", "originalCommit": "a6064cc806ca40fc564d9a5539d4d87d50bb35fb", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI4ODMxNQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10148#discussion_r510288315", "bodyText": "Why not both? :)\nDone", "author": "metas-rc", "createdAt": "2020-10-22T16:13:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxMDI3OTk5NA=="}], "type": "inlineReview"}, {"oid": "b48e9c20082186bbadbf4772599979f61540bcba", "url": "https://github.com/metasfresh/metasfresh/commit/b48e9c20082186bbadbf4772599979f61540bcba", "message": "#10127 improvements and javadoc\n\nhttps://github.com/metasfresh/metasfresh/issues/10127", "committedDate": "2020-10-22T16:12:55Z", "type": "commit"}]}