{"pr_number": 6357, "pr_title": "OLCand-REST-EP shall use BPartner-REST-EP", "pr_createdAt": "2020-03-16T23:18:29Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6357", "timeline": [{"oid": "8156012755b259f76c0839c93d24885b203d7cf9", "url": "https://github.com/metasfresh/metasfresh/commit/8156012755b259f76c0839c93d24885b203d7cf9", "message": "OLCand-REST-EP shall use BPartner-REST-EP\n\n* remove BPartnerMasterDataProvider; instead, invoke BpartnerRestController\n* BpartnerRestController now returns detailed information wrt which entities (bpartner, contact, location) were created or updated\nhttps://github.com/metasfresh/metasfresh/issues/6356", "committedDate": "2020-03-16T23:17:14Z", "type": "commit"}, {"oid": "ff96f8e8e2da8f9574818aff894ceea19706a323", "url": "https://github.com/metasfresh/metasfresh/commit/ff96f8e8e2da8f9574818aff894ceea19706a323", "message": "OLCand-REST-EP shall use BPartner-REST-EP\n\n* fix unit test(s)\nhttps://github.com/metasfresh/metasfresh/issues/6356", "committedDate": "2020-03-17T18:19:08Z", "type": "commit"}, {"oid": "445e0d1f181aa0cde5eb9e2a9631f84398371473", "url": "https://github.com/metasfresh/metasfresh/commit/445e0d1f181aa0cde5eb9e2a9631f84398371473", "message": "OLCand-REST-EP shall use BPartner-REST-EP\n\n* fix unit test(s)\nhttps://github.com/metasfresh/metasfresh/issues/6356", "committedDate": "2020-03-17T21:36:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDExODAyMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6357#discussion_r394118021", "bodyText": "make sure the billTo parameter becomes clearer", "author": "metas-ts", "createdAt": "2020-03-18T05:46:51Z", "path": "de.metas.business.rest-api-impl/src/main/java/de/metas/rest_api/ordercandidates/impl/JsonConverters.java", "diffHunk": "@@ -144,10 +144,10 @@ public final OLCandCreateRequestBuilder fromJson(\n \t\t\t\t.externalLineId(request.getExternalLineId())\n \t\t\t\t.externalHeaderId(request.getExternalHeaderId())\n \t\t\t\t//\n-\t\t\t\t.bpartner(masterdataProvider.getCreateBPartnerInfo(request.getBpartner(), orgId))\n-\t\t\t\t.billBPartner(masterdataProvider.getCreateBPartnerInfo(request.getBillBPartner(), orgId))\n-\t\t\t\t.dropShipBPartner(masterdataProvider.getCreateBPartnerInfo(request.getDropShipBPartner(), orgId))\n-\t\t\t\t.handOverBPartner(masterdataProvider.getCreateBPartnerInfo(request.getHandOverBPartner(), orgId))\n+\t\t\t\t.bpartner(masterdataProvider.getCreateBPartnerInfo(request.getBpartner(), true/* billTo */, orgId))", "originalCommit": "445e0d1f181aa0cde5eb9e2a9631f84398371473", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDExODI4Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6357#discussion_r394118282", "bodyText": "make sure the billTo parameter becomes clearer", "author": "metas-ts", "createdAt": "2020-03-18T05:47:56Z", "path": "de.metas.business.rest-api-impl/src/main/java/de/metas/rest_api/ordercandidates/impl/OrderCandidatesRestControllerImpl.java", "diffHunk": "@@ -213,10 +218,10 @@ private void createOrUpdateMasterdata0(\n \t{\n \t\tfinal OrgId orgId = masterdataProvider.getCreateOrgId(json.getOrg());\n \n-\t\tfinal BPartnerInfo bpartnerInfo = masterdataProvider.getCreateBPartnerInfo(json.getBpartner(), orgId);\n-\t\tfinal BPartnerInfo billBPartnerInfo = masterdataProvider.getCreateBPartnerInfo(json.getBillBPartner(), orgId);\n-\t\tmasterdataProvider.getCreateBPartnerInfo(json.getDropShipBPartner(), orgId);\n-\t\tmasterdataProvider.getCreateBPartnerInfo(json.getHandOverBPartner(), orgId);\n+\t\tfinal BPartnerInfo bpartnerInfo = masterdataProvider.getCreateBPartnerInfo(json.getBpartner(), true/* billTo */, orgId);", "originalCommit": "445e0d1f181aa0cde5eb9e2a9631f84398371473", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5NDE1NDA0Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6357#discussion_r394154043", "bodyText": "TODO check mock-based solution in master-branch", "author": "metas-ts", "createdAt": "2020-03-18T07:41:54Z", "path": "de.metas.business/src/main/java/de/metas/bpartner/composite/repository/BPartnerCompositeSaver.java", "diffHunk": "@@ -395,11 +403,24 @@ private void saveBPartnerBankAccount(\n \t\trecord.setC_Currency_ID(bankAccount.getCurrencyId().getRepoId());\n \t\trecord.setIsActive(bankAccount.isActive());\n \n+\t\tassertCanCreateOrUpdate(record);\n \t\tsaveRecord(record);\n \n \t\tfinal BPartnerBankAccountId id = BPartnerBankAccountId.ofRepoId(bpartnerId, record.getC_BP_BankAccount_ID());\n \n \t\tbankAccount.setId(id);\n \t}\n \n+\tprivate void assertCanCreateOrUpdate(@NonNull final Object record)\n+\t{\n+\t\tif (Adempiere.isUnitTestMode())", "originalCommit": "445e0d1f181aa0cde5eb9e2a9631f84398371473", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}