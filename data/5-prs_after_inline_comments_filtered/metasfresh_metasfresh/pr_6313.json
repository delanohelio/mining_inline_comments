{"pr_number": 6313, "pr_title": "ESR: Read Payment String -> Payment Selection, Bancaccount not automatically selected for Reference", "pr_createdAt": "2020-03-05T15:35:37Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6313", "timeline": [{"oid": "a4574e3f6dde15385096d7542e406b11e1b2ca1d", "url": "https://github.com/metasfresh/metasfresh/commit/a4574e3f6dde15385096d7542e406b11e1b2ca1d", "message": "Change column types to Dictionary\n\nhttps://github.com/metasfresh/metasfresh/issues/6310", "committedDate": "2020-03-05T14:23:29Z", "type": "commit"}, {"oid": "78364d23a7ce9f31932255e624f3a5aa8f45c618", "url": "https://github.com/metasfresh/metasfresh/commit/78364d23a7ce9f31932255e624f3a5aa8f45c618", "message": "Save BP Bank Account name when creating a new one from ESR\n\nhttps://github.com/metasfresh/metasfresh/issues/6310", "committedDate": "2020-03-05T14:23:54Z", "type": "commit"}, {"oid": "5a596ebcf078d6f079331446ba6e462f3d69ef4c", "url": "https://github.com/metasfresh/metasfresh/commit/5a596ebcf078d6f079331446ba6e462f3d69ef4c", "message": "Search for multiple variants of ESR Account Names when searcihng for BP Bank Account\n\nhttps://github.com/metasfresh/metasfresh/issues/6310", "committedDate": "2020-03-05T14:26:06Z", "type": "commit"}, {"oid": "a8f0ec5e1211b0883ee8eba4f62d293f6c5f79e9", "url": "https://github.com/metasfresh/metasfresh/commit/a8f0ec5e1211b0883ee8eba4f62d293f6c5f79e9", "message": "Small bugfix/refactoring\n\nhttps://github.com/metasfresh/metasfresh/issues/6310", "committedDate": "2020-03-05T15:34:34Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NDk1NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388394954", "bodyText": "Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n            \t * Formatting done according to https://www.gkb.ch/de/Documents/DC/Beratung-Produkte/Factsheets-Flyers/Handbuch-ESR/ESR-Handbuch-Postfinance-DE.pdf\n          \n          \n            \n            \t * Explode the given {@code esrString} into a number of syntactically equivalent strings that can be matched against {@code C_BP_BankAccount.ESR_RenderedAccountNo}.\n          \n          \n            \n            \t * Formatting done according to https://www.gkb.ch/de/Documents/DC/Beratung-Produkte/Factsheets-Flyers/Handbuch-ESR/ESR-Handbuch-Postfinance-DE.pdf", "author": "metas-ts", "createdAt": "2020-03-05T16:06:38Z", "path": "de.metas.payment.esr/src/main/java/de/metas/payment/esr/api/impl/ESRBPBankAccountDAO.java", "diffHunk": "@@ -64,6 +69,57 @@\n \t\t\t\t.list();\n \t}\n \n+\t/**\n+\t * Formatting done according to https://www.gkb.ch/de/Documents/DC/Beratung-Produkte/Factsheets-Flyers/Handbuch-ESR/ESR-Handbuch-Postfinance-DE.pdf", "originalCommit": "a8f0ec5e1211b0883ee8eba4f62d293f6c5f79e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyMzUxNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388723516", "bodyText": "added the explanation. now that i've read yours it makes so much sense what you wrote, but yesterday i totally couldn't figure out a good explanation.", "author": "TheBestPessimist", "createdAt": "2020-03-06T05:48:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NDk1NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTc5NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388395794", "bodyText": "how to fix what in particular; anyways, this hardcoded stuff needs fixing, sooner or later. an additional unsolved TODO is therefore not a big deal for me", "author": "metas-ts", "createdAt": "2020-03-05T16:07:52Z", "path": "de.metas.banking/de.metas.banking.base/src/main/java/de/metas/banking/exception/BankingException.java", "diffHunk": "@@ -95,8 +95,9 @@ protected ITranslatableString buildMessage()\n \t\tif (targetAcct != null)\n \t\t{\n \t\t\tsb.append(\"Zielkonto:\\n\");\n-\t\t\tsb.append(\"\\tEmpfaenger: \")\n-\t\t\t\t\t.append(targetAcct.getC_BPartner().getName());\n+\t\t\t // TODO tbp: how to fix this?", "originalCommit": "a8f0ec5e1211b0883ee8eba4f62d293f6c5f79e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyMjkyMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388722920", "bodyText": "how to referred to getting the bpartner name. there's no more C_BP_BankAccount.getC_BPartner(), only C_BP_BankAccount.getC_BPartner_ID(), and i dont think loading the bpdao service and reading the name each time is a good idea.", "author": "TheBestPessimist", "createdAt": "2020-03-06T05:45:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTc5NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyNDgxNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388724814", "bodyText": "Generally, i think it's not a terrible idea bc the record is cached if you load it outside of any particular transaction, which the DAO-methods usually do.\nAnd besides: make an educated guess as to what C_BP_BankAccount.getC_BPartner() did under the hood \ud83e\udd13", "author": "metas-ts", "createdAt": "2020-03-06T05:54:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NTc5NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjQ3OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388396478", "bodyText": "there are nice AssertJ things for this; pls let me know next time you write unit tests, I can show you examples", "author": "metas-ts", "createdAt": "2020-03-05T16:08:48Z", "path": "de.metas.payment.esr/src/test/java/de/metas/payment/esr/api/impl/ESRBPBankAccountDAOTest.java", "diffHunk": "@@ -0,0 +1,65 @@\n+/*\n+ * #%L\n+ * de.metas.payment.esr\n+ * %%\n+ * Copyright (C) 2019 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.payment.esr.api.impl;\n+\n+import com.google.common.collect.ImmutableSet;\n+import org.assertj.core.api.Assertions;\n+import org.junit.jupiter.api.Nested;\n+import org.junit.jupiter.api.Test;\n+\n+import java.util.Arrays;\n+\n+import static de.metas.payment.esr.api.impl.ESRBPBankAccountDAO.createMatchingESRAccountNumbers;\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class ESRBPBankAccountDAOTest\n+{\n+\t@Nested\n+\tclass MatchingESRAccountNumbersTest\n+\t{\n+\t\t@Test\n+\t\tvoid esrHas9Digits()\n+\t\t{\n+\t\t\tfinal ImmutableSet<String> esrs = createMatchingESRAccountNumbers(\"01-1067-4\");\n+\t\t\tesrs.forEach(s -> assertEquals(9, s.length()));", "originalCommit": "a8f0ec5e1211b0883ee8eba4f62d293f6c5f79e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODcyMzgxNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6313#discussion_r388723816", "bodyText": "i keep telling to myself i have to learn assertj, but then a new urgent task comes...", "author": "TheBestPessimist", "createdAt": "2020-03-06T05:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4ODM5NjQ3OA=="}], "type": "inlineReview"}]}