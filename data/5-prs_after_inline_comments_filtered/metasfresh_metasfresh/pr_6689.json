{"pr_number": 6689, "pr_title": "Accounting Transactions adjustments", "pr_createdAt": "2020-05-19T13:20:08Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/6689", "timeline": [{"oid": "d23d6f3ed9f51ebc88e1196f1a13351b0465c026", "url": "https://github.com/metasfresh/metasfresh/commit/d23d6f3ed9f51ebc88e1196f1a13351b0465c026", "message": "Add `Accounting Transactions.DocStatus` to grid view and filters\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T08:31:08Z", "type": "commit"}, {"oid": "8b2f33bc7a2c4cf554cd3fd38b24a5218dd0f277", "url": "https://github.com/metasfresh/metasfresh/commit/8b2f33bc7a2c4cf554cd3fd38b24a5218dd0f277", "message": "Update copyright\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T12:05:56Z", "type": "commit"}, {"oid": "5f909ebd42ec310e67280cca05474f620a225c93", "url": "https://github.com/metasfresh/metasfresh/commit/5f909ebd42ec310e67280cca05474f620a225c93", "message": "Move ElementValueId to make it more accessible\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T12:08:26Z", "type": "commit"}, {"oid": "1f59dd08df4fd1f51a11b4e6c5aa206c91b0561e", "url": "https://github.com/metasfresh/metasfresh/commit/1f59dd08df4fd1f51a11b4e6c5aa206c91b0561e", "message": "Fix warning\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T12:08:38Z", "type": "commit"}, {"oid": "558819e934fd7197de300cae3f9f7885ace7259c", "url": "https://github.com/metasfresh/metasfresh/commit/558819e934fd7197de300cae3f9f7885ace7259c", "message": "Add Fact Acct Filter\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T12:10:37Z", "type": "commit"}, {"oid": "e691f9d09be3352bd890a955e71b13783447ae6a", "url": "https://github.com/metasfresh/metasfresh/commit/e691f9d09be3352bd890a955e71b13783447ae6a", "message": "Fix warnings/add nullability for `IQueryFilterModifier`s\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T13:04:20Z", "type": "commit"}, {"oid": "53416445961b270bf9688bd53d69a21a4fb082e4", "url": "https://github.com/metasfresh/metasfresh/commit/53416445961b270bf9688bd53d69a21a4fb082e4", "message": "Bugfix\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T13:04:54Z", "type": "commit"}, {"oid": "197dbc35c8a5a56b0b37eeb4d8cc8160995d54a6", "url": "https://github.com/metasfresh/metasfresh/commit/197dbc35c8a5a56b0b37eeb4d8cc8160995d54a6", "message": "Add RPad Query Filter Modifier\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T13:05:30Z", "type": "commit"}, {"oid": "5fedf8771669e6dcff60c2f203fb6168c7d6a4f6", "url": "https://github.com/metasfresh/metasfresh/commit/5fedf8771669e6dcff60c2f203fb6168c7d6a4f6", "message": "Add IElementValueDAO.getElementValueIdsBetween\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T13:06:31Z", "type": "commit"}, {"oid": "aa3bb6fbb4cae9afd5a1b1528da2639c1a228917", "url": "https://github.com/metasfresh/metasfresh/commit/aa3bb6fbb4cae9afd5a1b1528da2639c1a228917", "message": "Allow empty string padding\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-19T13:17:17Z", "type": "commit"}, {"oid": "fcec8caf09e95903b0b29a99be49a857e8eea6c2", "url": "https://github.com/metasfresh/metasfresh/commit/fcec8caf09e95903b0b29a99be49a857e8eea6c2", "message": "Update trls\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T09:05:58Z", "type": "commit"}, {"oid": "bfee651cf80b43d21bee99c42a512fd1113613a1", "url": "https://github.com/metasfresh/metasfresh/commit/bfee651cf80b43d21bee99c42a512fd1113613a1", "message": "Update trls\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T09:25:05Z", "type": "commit"}, {"oid": "1b555573662dab77b9548a237ee8f55769d9f94a", "url": "https://github.com/metasfresh/metasfresh/commit/1b555573662dab77b9548a237ee8f55769d9f94a", "message": "Bugfix\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T09:50:59Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MDQzMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427880433", "bodyText": "pls clarify this before asking for a final review", "author": "teosarca", "createdAt": "2020-05-20T09:45:45Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/acct/api/impl/ElementValueDAO.java", "diffHunk": "@@ -45,4 +48,19 @@ public I_C_ElementValue retrieveById(@CacheCtx final Properties ctx, final int e\n \t\t}\n \t\treturn InterfaceWrapperHelper.create(ctx, elementValueId, I_C_ElementValue.class, ITrx.TRXNAME_None);\n \t}\n+\n+\t@Override\n+\tpublic @NonNull ImmutableSet<ElementValueId> getElementValueIdsBetween(@NonNull final String valueFrom, @NonNull final String valueTo)\n+\t{\n+\t\t// TODO @tbp @teo: this query needs to be refined and its test updated after a discussion with mark", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1OTA2Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429059062", "bodyText": "clarified", "author": "TheBestPessimist", "createdAt": "2020-05-22T06:07:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MDQzMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MDY0NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427880644", "bodyText": "declare queryBL as a class field", "author": "teosarca", "createdAt": "2020-05-20T09:46:05Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/acct/api/impl/ElementValueDAO.java", "diffHunk": "@@ -45,4 +48,19 @@ public I_C_ElementValue retrieveById(@CacheCtx final Properties ctx, final int e\n \t\t}\n \t\treturn InterfaceWrapperHelper.create(ctx, elementValueId, I_C_ElementValue.class, ITrx.TRXNAME_None);\n \t}\n+\n+\t@Override\n+\tpublic @NonNull ImmutableSet<ElementValueId> getElementValueIdsBetween(@NonNull final String valueFrom, @NonNull final String valueTo)\n+\t{\n+\t\t// TODO @tbp @teo: this query needs to be refined and its test updated after a discussion with mark\n+\n+\t\tfinal RPadQueryFilterModifier lpadModifier = new RPadQueryFilterModifier(20, \" \");\n+\n+\t\tfinal IQueryBL queryBL = Services.get(IQueryBL.class);", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkyMTY3NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427921675", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T11:00:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MDY0NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MTc1Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427881756", "bodyText": "what's the reason for this change?", "author": "teosarca", "createdAt": "2020-05-20T09:47:55Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/dao/impl/LpadQueryFilterModifier.java", "diffHunk": "@@ -42,7 +45,7 @@ public LpadQueryFilterModifier(final int size, final String padStr)\n \t\tCheck.assume(size > 0, \"size > 0\");\n \t\tthis.size = size;\n \n-\t\tCheck.assumeNotEmpty(padStr, \"padStr not empty\");\n+\t\tCheck.errorUnless(!padStr.isEmpty(), \"padStr not empty\");", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NDE0OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427894149", "bodyText": "Check.assumeNotEmpty trims, and we don't want to trim (since we want to use space as padding)", "author": "TheBestPessimist", "createdAt": "2020-05-20T10:08:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MTc1Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MjIzMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427882230", "bodyText": "I think this is some dev testing garbage.", "author": "teosarca", "createdAt": "2020-05-20T09:48:43Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/dao/impl/LpadQueryFilterModifier.java", "diffHunk": "@@ -91,6 +95,6 @@ public Object convertValue(final String columnName, final Object value, final Ob\n \n \t\tfinal String str = (String)value;\n \n-\t\treturn StringUtils.leftPad(str.trim(), size, padStr);\n+\t\treturn StringUtils.leftPad(str.trim(), size, padStr).subSequence(0,10);", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NDQ5Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427894496", "bodyText": "fixed, was supposed to be size not 10", "author": "TheBestPessimist", "createdAt": "2020-05-20T10:08:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MjIzMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MzMyMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427883321", "bodyText": "why .subSequence(0, 10); ?", "author": "teosarca", "createdAt": "2020-05-20T09:50:24Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/dao/impl/RPadQueryFilterModifier.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package org.adempiere.ad.dao.impl;\n+\n+import de.metas.util.Check;\n+import lombok.EqualsAndHashCode;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryFilterModifier;\n+import org.apache.commons.lang3.StringUtils;\n+import org.compiere.util.DB;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@EqualsAndHashCode\n+public class RPadQueryFilterModifier implements IQueryFilterModifier\n+{\n+\tprivate final int size;\n+\tprivate final String padStr;\n+\n+\tpublic RPadQueryFilterModifier(final int size, @NonNull final String padStr)\n+\t{\n+\t\tCheck.assume(size > 0, \"size > 0\");\n+\t\tthis.size = size;\n+\n+\t\tCheck.errorUnless(!padStr.isEmpty(), \"padStr not empty\");\n+\t\tthis.padStr = padStr;\n+\t}\n+\n+\t@Override\n+\tpublic @NonNull String getColumnSql(final @NonNull String columnName)\n+\t{\n+\t\treturn buildSql(columnName);\n+\t}\n+\n+\t@Override\n+\tpublic String getValueSql(final Object value, final List<Object> params)\n+\t{\n+\t\tfinal String valueSql;\n+\t\tif (value instanceof ModelColumnNameValue<?>)\n+\t\t{\n+\t\t\tfinal ModelColumnNameValue<?> modelValue = (ModelColumnNameValue<?>)value;\n+\t\t\tvalueSql = modelValue.getColumnName();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tvalueSql = \"?\";\n+\t\t\tparams.add(value);\n+\t\t}\n+\n+\t\treturn buildSql(valueSql);\n+\t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic Object convertValue(@Nullable final String columnName, @Nullable final Object value, final @Nullable Object model)\n+\t{\n+\t\tif (value == null)\n+\t\t{\n+\t\t\treturn null;\n+\t\t}\n+\n+\t\tfinal String str = (String)value;\n+\n+\t\treturn StringUtils.rightPad(str.trim(), size, padStr).subSequence(0, 10);", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5NDUyMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427894523", "bodyText": "fixed, was supposed to be size not 10", "author": "TheBestPessimist", "createdAt": "2020-05-20T10:09:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4MzMyMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4NDc5Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427884796", "bodyText": "no tests provided\nin case you have unit tests, pls rename this class to ElementValueDAOTest and move it to impl package. Basically, u are testing the implementation and not the interface.", "author": "teosarca", "createdAt": "2020-05-20T09:52:51Z", "path": "backend/de.metas.adempiere.adempiere/base/src/test/java/de/metas/acct/api/IElementValueDAOTest.java", "diffHunk": "@@ -0,0 +1,94 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.acct.api;\n+\n+import de.metas.util.Services;\n+import org.junit.jupiter.api.Test;\n+\n+import static org.junit.jupiter.api.Assertions.*;\n+\n+class IElementValueDAOTest", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4NzIwNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427887206", "bodyText": "rename it to FactAcctFilterDescriptorsProviderFactory\nmove it to de.metas.ui.web.accounting.filters", "author": "teosarca", "createdAt": "2020-05-20T09:56:53Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/document/filter/provider/fact_acct/FactAcctDocumentService.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.document.filter.provider.fact_acct;\n+\n+import de.metas.i18n.IMsgBL;\n+import de.metas.ui.web.document.filter.DocumentFilterDescriptor;\n+import de.metas.ui.web.document.filter.DocumentFilterParamDescriptor;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsConstants;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProviderFactory;\n+import de.metas.ui.web.document.filter.provider.ImmutableDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.NullDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.window.descriptor.DocumentFieldDescriptor;\n+import de.metas.ui.web.window.descriptor.DocumentFieldWidgetType;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.element.api.AdTabId;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+\n+@Component\n+public class FactAcctDocumentService implements DocumentFilterDescriptorsProviderFactory", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkyNDUxOQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427924519", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T11:05:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4NzIwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4Nzg1NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427887855", "bodyText": "move it to de.metas.ui.web.accounting.filters", "author": "teosarca", "createdAt": "2020-05-20T09:57:56Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/document/filter/provider/fact_acct/FactAcctFilterConverter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.document.filter.provider.fact_acct;\n+\n+import com.google.common.collect.ImmutableSet;\n+import com.jgoodies.common.base.Objects;\n+import de.metas.acct.api.IElementValueDAO;\n+import de.metas.acct.api.impl.ElementValueId;\n+import de.metas.ui.web.document.filter.DocumentFilter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverterContext;\n+import de.metas.ui.web.document.filter.sql.SqlParamsCollector;\n+import de.metas.ui.web.window.model.sql.SqlOptions;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.compiere.model.I_Fact_Acct;\n+import org.compiere.util.DB;\n+\n+public class FactAcctFilterConverter implements SqlDocumentFilterConverter", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkyNDk3Mg==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427924972", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T11:06:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4Nzg1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4ODIyMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427888223", "bodyText": "IMHO, u can hook it to Fact_Acct table too", "author": "teosarca", "createdAt": "2020-05-20T09:58:32Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/document/filter/provider/fact_acct/FactAcctDocumentService.java", "diffHunk": "@@ -0,0 +1,85 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.document.filter.provider.fact_acct;\n+\n+import de.metas.i18n.IMsgBL;\n+import de.metas.ui.web.document.filter.DocumentFilterDescriptor;\n+import de.metas.ui.web.document.filter.DocumentFilterParamDescriptor;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsConstants;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProviderFactory;\n+import de.metas.ui.web.document.filter.provider.ImmutableDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.NullDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.window.descriptor.DocumentFieldDescriptor;\n+import de.metas.ui.web.window.descriptor.DocumentFieldWidgetType;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.element.api.AdTabId;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+\n+@Component\n+public class FactAcctDocumentService implements DocumentFilterDescriptorsProviderFactory\n+{\n+\tpublic static final String FACT_ACCT_TRANSACTIONS_VIEW = \"Fact_Acct_Transactions_View\";\n+\tprivate final transient IMsgBL msgBL = Services.get(IMsgBL.class);\n+\n+\tpublic FactAcctDocumentService()\n+\t{\n+\t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic DocumentFilterDescriptorsProvider createFiltersProvider(\n+\t\t\t@Nullable final AdTabId ignored,\n+\t\t\t@Nullable final String tableName,\n+\t\t\t@Nullable final Collection<DocumentFieldDescriptor> fields)\n+\t{\n+\t\tif (!FACT_ACCT_TRANSACTIONS_VIEW.equals(tableName))", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4OTU2Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427889567", "bodyText": "also,\n\ncheck if fields collection contains a field with \"Account_ID\" field name.\ndefine \"Account_ID\" as a class constant. Use it in converter too, instead of I_Fact_Acct.COLUMNNAME_Account_ID", "author": "teosarca", "createdAt": "2020-05-20T10:00:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4ODIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkxOTIwNQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427919205", "bodyText": "check if fields collection contains a field with \"Account_ID\" field name.\ndefine \"Account_ID\" as a class constant. Use it in converter too, instead of I_Fact_Acct.COLUMNNAME_Account_ID\n\ndiscussed with teo: no longer needed\n\nIMHO, u can hook it to Fact_Acct table too\n\nThis is still needed", "author": "TheBestPessimist", "createdAt": "2020-05-20T10:55:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4ODIyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkyNjk4OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427926988", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T11:10:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg4ODIyMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MDI0OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427890249", "bodyText": "pls handle the case when ids is empty.", "author": "teosarca", "createdAt": "2020-05-20T10:01:37Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/document/filter/provider/fact_acct/FactAcctFilterConverter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.document.filter.provider.fact_acct;\n+\n+import com.google.common.collect.ImmutableSet;\n+import com.jgoodies.common.base.Objects;\n+import de.metas.acct.api.IElementValueDAO;\n+import de.metas.acct.api.impl.ElementValueId;\n+import de.metas.ui.web.document.filter.DocumentFilter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverterContext;\n+import de.metas.ui.web.document.filter.sql.SqlParamsCollector;\n+import de.metas.ui.web.window.model.sql.SqlOptions;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.compiere.model.I_Fact_Acct;\n+import org.compiere.util.DB;\n+\n+public class FactAcctFilterConverter implements SqlDocumentFilterConverter\n+{\n+\tpublic static final transient FactAcctFilterConverter instance = new FactAcctFilterConverter();\n+\n+\tstatic final String FILTER_ID = \"fact-acct\";\n+\n+\tpublic static final String PARAM_ACCOUNT_VALUE_FROM = \"AccountValueFrom\";\n+\tpublic static final String PARAM_ACCOUNT_VALUE_TO = \"AccountValueTo\";\n+\n+\tprivate FactAcctFilterConverter()\n+\t{\n+\t}\n+\n+\t@Override\n+\tpublic boolean canConvert(final String filterId)\n+\t{\n+\t\treturn Objects.equals(filterId, FILTER_ID);\n+\t}\n+\n+\t@Override\n+\tpublic String getSql(\n+\t\t\t@NonNull final SqlParamsCollector ignored_sqlParamsOut,\n+\t\t\t@NonNull final DocumentFilter filter,\n+\t\t\t@NonNull final SqlOptions sqlOpts,\n+\t\t\tfinal SqlDocumentFilterConverterContext ignored)\n+\t{\n+\t\tfinal String accountValueFrom = filter.getParameterValueAsString(PARAM_ACCOUNT_VALUE_FROM, \"-1\");\n+\t\tfinal String accountValueTo = filter.getParameterValueAsString(PARAM_ACCOUNT_VALUE_TO, \"-1\");\n+\n+\t\tfinal IElementValueDAO elementValueDAO = Services.get(IElementValueDAO.class);\n+\t\tfinal ImmutableSet<ElementValueId> ids = elementValueDAO.getElementValueIdsBetween(accountValueFrom, accountValueTo);", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzkyOTc5OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427929798", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T11:16:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MDI0OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MDU2MA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427890560", "bodyText": "not sure, but i guess u shall use null as default value instead of \"-1\".", "author": "teosarca", "createdAt": "2020-05-20T10:02:09Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/document/filter/provider/fact_acct/FactAcctFilterConverter.java", "diffHunk": "@@ -0,0 +1,74 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.document.filter.provider.fact_acct;\n+\n+import com.google.common.collect.ImmutableSet;\n+import com.jgoodies.common.base.Objects;\n+import de.metas.acct.api.IElementValueDAO;\n+import de.metas.acct.api.impl.ElementValueId;\n+import de.metas.ui.web.document.filter.DocumentFilter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverterContext;\n+import de.metas.ui.web.document.filter.sql.SqlParamsCollector;\n+import de.metas.ui.web.window.model.sql.SqlOptions;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.compiere.model.I_Fact_Acct;\n+import org.compiere.util.DB;\n+\n+public class FactAcctFilterConverter implements SqlDocumentFilterConverter\n+{\n+\tpublic static final transient FactAcctFilterConverter instance = new FactAcctFilterConverter();\n+\n+\tstatic final String FILTER_ID = \"fact-acct\";\n+\n+\tpublic static final String PARAM_ACCOUNT_VALUE_FROM = \"AccountValueFrom\";\n+\tpublic static final String PARAM_ACCOUNT_VALUE_TO = \"AccountValueTo\";\n+\n+\tprivate FactAcctFilterConverter()\n+\t{\n+\t}\n+\n+\t@Override\n+\tpublic boolean canConvert(final String filterId)\n+\t{\n+\t\treturn Objects.equals(filterId, FILTER_ID);\n+\t}\n+\n+\t@Override\n+\tpublic String getSql(\n+\t\t\t@NonNull final SqlParamsCollector ignored_sqlParamsOut,\n+\t\t\t@NonNull final DocumentFilter filter,\n+\t\t\t@NonNull final SqlOptions sqlOpts,\n+\t\t\tfinal SqlDocumentFilterConverterContext ignored)\n+\t{\n+\t\tfinal String accountValueFrom = filter.getParameterValueAsString(PARAM_ACCOUNT_VALUE_FROM, \"-1\");\n+\t\tfinal String accountValueTo = filter.getParameterValueAsString(PARAM_ACCOUNT_VALUE_TO, \"-1\");", "originalCommit": "bfee651cf80b43d21bee99c42a512fd1113613a1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MTMzNA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427891334", "bodyText": "also, make sure you are handling the null case or elementValueDAO.getElementValueIdsBetween is handling it.\ne.g. accountValueFrom=null, accountValueTo=2000 means all accounts until 2000", "author": "teosarca", "createdAt": "2020-05-20T10:03:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MDU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MTYyMg==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427891622", "bodyText": "e.g. accountValueFrom=2000, accountValueTo=null means all accounts from 2000 until the last one.", "author": "teosarca", "createdAt": "2020-05-20T10:03:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MDU2MA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzk0MTkxNw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427941917", "bodyText": "I would like that elementValueDAO.getElementValueIdsBetween to not receive nulls, so i will error out in case any of the fields is missing.", "author": "TheBestPessimist", "createdAt": "2020-05-20T11:40:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MDU2MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MjY4Mw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427892683", "bodyText": "pls document that we do subSequence because we want to have the same behaviour like Postgresql's LPAD.\nsame for the RPAD.", "author": "teosarca", "createdAt": "2020-05-20T10:05:45Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/dao/impl/LpadQueryFilterModifier.java", "diffHunk": "@@ -91,6 +95,6 @@ public Object convertValue(final String columnName, final Object value, final Ob\n \n \t\tfinal String str = (String)value;\n \n-\t\treturn StringUtils.leftPad(str.trim(), size, padStr);\n+\t\treturn StringUtils.leftPad(str.trim(), size, padStr).subSequence(0,size);", "originalCommit": "1b555573662dab77b9548a237ee8f55769d9f94a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5Njk3Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427896977", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T10:13:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MjY4Mw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MzA1NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427893054", "bodyText": "pls document that we  do subSequence because we want to have the same behaviour like PG.", "author": "teosarca", "createdAt": "2020-05-20T10:06:22Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/org/adempiere/ad/dao/impl/RPadQueryFilterModifier.java", "diffHunk": "@@ -0,0 +1,99 @@\n+/*\n+ * #%L\n+ * de.metas.adempiere.adempiere.base\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package org.adempiere.ad.dao.impl;\n+\n+import de.metas.util.Check;\n+import lombok.EqualsAndHashCode;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryFilterModifier;\n+import org.apache.commons.lang3.StringUtils;\n+import org.compiere.util.DB;\n+\n+import javax.annotation.Nullable;\n+import java.util.List;\n+\n+@EqualsAndHashCode\n+public class RPadQueryFilterModifier implements IQueryFilterModifier\n+{\n+\tprivate final int size;\n+\tprivate final String padStr;\n+\n+\tpublic RPadQueryFilterModifier(final int size, @NonNull final String padStr)\n+\t{\n+\t\tCheck.assume(size > 0, \"size > 0\");\n+\t\tthis.size = size;\n+\n+\t\tCheck.errorUnless(!padStr.isEmpty(), \"padStr not empty\");\n+\t\tthis.padStr = padStr;\n+\t}\n+\n+\t@Override\n+\tpublic @NonNull String getColumnSql(final @NonNull String columnName)\n+\t{\n+\t\treturn buildSql(columnName);\n+\t}\n+\n+\t@Override\n+\tpublic String getValueSql(final Object value, final List<Object> params)\n+\t{\n+\t\tfinal String valueSql;\n+\t\tif (value instanceof ModelColumnNameValue<?>)\n+\t\t{\n+\t\t\tfinal ModelColumnNameValue<?> modelValue = (ModelColumnNameValue<?>)value;\n+\t\t\tvalueSql = modelValue.getColumnName();\n+\t\t}\n+\t\telse\n+\t\t{\n+\t\t\tvalueSql = \"?\";\n+\t\t\tparams.add(value);\n+\t\t}\n+\n+\t\treturn buildSql(valueSql);\n+\t}\n+\n+\t@Nullable\n+\t@Override\n+\tpublic Object convertValue(@Nullable final String columnName, @Nullable final Object value, final @Nullable Object model)\n+\t{\n+\t\tif (value == null)\n+\t\t{\n+\t\t\treturn null;\n+\t\t}\n+\n+\t\tfinal String str = (String)value;\n+\n+\t\treturn StringUtils.rightPad(str.trim(), size, padStr).subSequence(0, size);", "originalCommit": "1b555573662dab77b9548a237ee8f55769d9f94a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5Njk0NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r427896945", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-20T10:13:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyNzg5MzA1NA=="}], "type": "inlineReview"}, {"oid": "25813905c4a1cc8a810b80f055fce10fc95a5c60", "url": "https://github.com/metasfresh/metasfresh/commit/25813905c4a1cc8a810b80f055fce10fc95a5c60", "message": "Document the use of `.subsequence` on RPAD and LPAD: to match Postgres implementatoin\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T10:14:09Z", "type": "commit"}, {"oid": "6dad75cf360105a3c8496d82bc48f45a6e322aac", "url": "https://github.com/metasfresh/metasfresh/commit/6dad75cf360105a3c8496d82bc48f45a6e322aac", "message": "Document the use of `Check.errorIf` on RPAD and LPAD: we want to allow padding with space\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T11:02:59Z", "type": "commit"}, {"oid": "f8bcf2150e180f924056bcd43169bd5d4476571b", "url": "https://github.com/metasfresh/metasfresh/commit/f8bcf2150e180f924056bcd43169bd5d4476571b", "message": "Small refactor\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T11:03:12Z", "type": "commit"}, {"oid": "5b8868bd769cfc44769e3810952bf201187345c1", "url": "https://github.com/metasfresh/metasfresh/commit/5b8868bd769cfc44769e3810952bf201187345c1", "message": "Refactor: Move filter to different package\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T11:11:30Z", "type": "commit"}, {"oid": "fc304120c30146987b7ad2de8cdb2b28b6b1bc06", "url": "https://github.com/metasfresh/metasfresh/commit/fc304120c30146987b7ad2de8cdb2b28b6b1bc06", "message": "FactAcctFilterDescriptor: `Fact_Acct` table is also valid\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T11:12:54Z", "type": "commit"}, {"oid": "ba34b67d6e7e961cbda0a0dce3dc36966d3c8ed9", "url": "https://github.com/metasfresh/metasfresh/commit/ba34b67d6e7e961cbda0a0dce3dc36966d3c8ed9", "message": "Handle missing params or no ElementValueIds found\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T11:43:07Z", "type": "commit"}, {"oid": "96a9b418066e5aa5dad62c5ff966707728a1f659", "url": "https://github.com/metasfresh/metasfresh/commit/96a9b418066e5aa5dad62c5ff966707728a1f659", "message": "Add nullability info\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T11:43:20Z", "type": "commit"}, {"oid": "9c303314cce31525a14966ee03ea63628f2b668c", "url": "https://github.com/metasfresh/metasfresh/commit/9c303314cce31525a14966ee03ea63628f2b668c", "message": "Mark FilterDescriptor as Frequently used, so that it appears outside of the default filters button\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-20T12:44:31Z", "type": "commit"}, {"oid": "158496c73ce5c97f8fb3fa51780c4ce40e5ebbe7", "url": "https://github.com/metasfresh/metasfresh/commit/158496c73ce5c97f8fb3fa51780c4ce40e5ebbe7", "message": "More trl\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-21T10:32:18Z", "type": "commit"}, {"oid": "840b4e57a18e49e9b78aba37681d3b4e749bf9da", "url": "https://github.com/metasfresh/metasfresh/commit/840b4e57a18e49e9b78aba37681d3b4e749bf9da", "message": "Update `ElementValueDAO.getElementValueIdsBetween`\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-21T11:07:19Z", "type": "commit"}, {"oid": "2084b879ff0459b1406190634da8ba4c46cafcad", "url": "https://github.com/metasfresh/metasfresh/commit/2084b879ff0459b1406190634da8ba4c46cafcad", "message": "Warnings cleanup\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-21T11:08:37Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MTMzMQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428641331", "bodyText": "IMHO the whole comment intoduces more noise and FUD than helps. pls remove it", "author": "teosarca", "createdAt": "2020-05-21T13:11:08Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/acct/api/impl/ElementValueDAO.java", "diffHunk": "@@ -45,4 +51,76 @@ public I_C_ElementValue retrieveById(@CacheCtx final Properties ctx, final int e\n \t\t}\n \t\treturn InterfaceWrapperHelper.create(ctx, elementValueId, I_C_ElementValue.class, ITrx.TRXNAME_None);\n \t}\n+\n+\t@Override\n+\tpublic @NonNull ImmutableSet<ElementValueId> getElementValueIdsBetween(@NonNull final String valueFrom, @NonNull final String valueTo)\n+\t{\n+\t\t/*\n+Implementation detail: Similar to: org.compiere.apps.search.Info.Worker.loadData, which is called from org.compiere.acct.AcctViewer.actionButton, when searching from an account.\n+\n+ValueFrom sql:\n+SELECT ev.c_elementvalue_id, ev.value, ev.name\n+FROM c_elementvalue ev\n+WHERE TRUE\n+  AND IsActive = 'Y'\n+  AND (IsSummary = 'N' OR IsSummary IS NULL)\n+  AND C_Element_ID = 1000000\n+  AND Value LIKE '10%'\n+ORDER BY value Asc\n+LIMIT 1\n+;\n+\n+\n+ValueTo sql:\n+SELECT ev.c_elementvalue_id, ev.value, ev.name\n+FROM c_elementvalue ev\n+WHERE TRUE\n+  AND IsActive = 'Y'\n+  AND (IsSummary = 'N' OR IsSummary IS NULL)\n+  AND C_Element_ID = 1000000\n+  AND Value LIKE '11%'\n+ORDER BY value DESC\n+LIMIT 1\n+;\n+\n+\n+Query similar to org.compiere.acct.AcctViewerData.appendAccountWhereClause:\n+SELECT ce.c_elementvalue_id\n+FROM c_elementvalue ce\n+WHERE (\n+          LPAD(trim(ce.Value), 20, '0')\n+              BETWEEN\n+             \t (SELECT LPAD(trim(ev.Value), 20, '0') FROM C_ElementValue ev WHERE ev.C_ElementValue_ID = $idFrom)\n+              AND\n+             \t (SELECT LPAD(trim(ev.Value), 20, '0') FROM C_ElementValue ev WHERE ev.C_ElementValue_ID = $idTo)\n+          )\n+;\n+\n+Observation, even if the original query uses LPAD, RPAD gives better results from my testing", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzNjUxNQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429036515", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:27:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MTMzMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1OTEzNg==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429059136", "bodyText": "removed comment", "author": "TheBestPessimist", "createdAt": "2020-05-22T06:08:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MTMzMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MzU0Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428643546", "bodyText": "private", "author": "teosarca", "createdAt": "2020-05-21T13:15:25Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/acct/api/impl/ElementValueDAO.java", "diffHunk": "@@ -1,40 +1,46 @@\n-package de.metas.acct.api.impl;\n-\n /*\n  * #%L\n  * de.metas.adempiere.adempiere.base\n  * %%\n- * Copyright (C) 2015 metas GmbH\n+ * Copyright (C) 2020 metas GmbH\n  * %%\n  * This program is free software: you can redistribute it and/or modify\n  * it under the terms of the GNU General Public License as\n  * published by the Free Software Foundation, either version 2 of the\n  * License, or (at your option) any later version.\n- * \n+ *\n  * This program is distributed in the hope that it will be useful,\n  * but WITHOUT ANY WARRANTY; without even the implied warranty of\n- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n  * GNU General Public License for more details.\n- * \n+ *\n  * You should have received a copy of the GNU General Public\n- * License along with this program.  If not, see\n+ * License along with this program. If not, see\n  * <http://www.gnu.org/licenses/gpl-2.0.html>.\n  * #L%\n  */\n \n+package de.metas.acct.api.impl;\n \n-import java.util.Properties;\n-\n+import com.google.common.collect.ImmutableSet;\n+import de.metas.acct.api.IElementValueDAO;\n+import de.metas.cache.annotation.CacheCtx;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.dao.IQueryBL;\n+import org.adempiere.ad.dao.impl.CompareQueryFilter;\n+import org.adempiere.ad.dao.impl.RPadQueryFilterModifier;\n import org.adempiere.ad.trx.api.ITrx;\n import org.adempiere.model.InterfaceWrapperHelper;\n import org.adempiere.util.proxy.Cached;\n import org.compiere.model.I_C_ElementValue;\n \n-import de.metas.acct.api.IElementValueDAO;\n-import de.metas.cache.annotation.CacheCtx;\n+import java.util.Properties;\n \n public class ElementValueDAO implements IElementValueDAO\n {\n+\tfinal IQueryBL queryBL = Services.get(IQueryBL.class);", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzNjU4NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429036585", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:28:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MzU0Ng=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1OTE2NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429059165", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T06:08:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0MzU0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0NzcxMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428647710", "bodyText": "i would use accountId instead of  fact-acct.", "author": "teosarca", "createdAt": "2020-05-21T13:23:06Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/accounting/filters/FactAcctFilterConverter.java", "diffHunk": "@@ -0,0 +1,89 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.accounting.filters;\n+\n+import com.google.common.collect.ImmutableSet;\n+import com.jgoodies.common.base.Objects;\n+import de.metas.acct.api.IElementValueDAO;\n+import de.metas.acct.api.impl.ElementValueId;\n+import de.metas.ui.web.document.filter.DocumentFilter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverter;\n+import de.metas.ui.web.document.filter.sql.SqlDocumentFilterConverterContext;\n+import de.metas.ui.web.document.filter.sql.SqlParamsCollector;\n+import de.metas.ui.web.window.model.sql.SqlOptions;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.exceptions.FillMandatoryException;\n+import org.compiere.model.I_Fact_Acct;\n+import org.compiere.util.DB;\n+\n+public class FactAcctFilterConverter implements SqlDocumentFilterConverter\n+{\n+\tpublic static final transient FactAcctFilterConverter instance = new FactAcctFilterConverter();\n+\n+\tstatic final String FILTER_ID = \"fact-acct\";", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzNjA3Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429036076", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:26:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0NzcxMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTA1OTE5NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429059195", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T06:08:11Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0NzcxMA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0ODUxMw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428648513", "bodyText": "pls avoid \"reverse\"  logic.", "author": "teosarca", "createdAt": "2020-05-21T13:24:38Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/accounting/filters/FactAcctFilterDescriptorsProviderFactory.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.accounting.filters;\n+\n+import de.metas.i18n.IMsgBL;\n+import de.metas.ui.web.document.filter.DocumentFilterDescriptor;\n+import de.metas.ui.web.document.filter.DocumentFilterParamDescriptor;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsConstants;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProviderFactory;\n+import de.metas.ui.web.document.filter.provider.ImmutableDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.NullDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.window.descriptor.DocumentFieldDescriptor;\n+import de.metas.ui.web.window.descriptor.DocumentFieldWidgetType;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.element.api.AdTabId;\n+import org.compiere.model.I_Fact_Acct;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+\n+@Component\n+public class FactAcctFilterDescriptorsProviderFactory implements DocumentFilterDescriptorsProviderFactory\n+{\n+\tpublic static final String FACT_ACCT_TRANSACTIONS_VIEW = \"Fact_Acct_Transactions_View\";\n+\tpublic static final String FACT_ACCT_TABLE = I_Fact_Acct.Table_Name;\n+\tprivate final transient IMsgBL msgBL = Services.get(IMsgBL.class);\n+\n+\tpublic FactAcctFilterDescriptorsProviderFactory()\n+\t{\n+\t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic DocumentFilterDescriptorsProvider createFiltersProvider(\n+\t\t\t@Nullable final AdTabId ignored,\n+\t\t\t@Nullable final String tableName,\n+\t\t\t@Nullable final Collection<DocumentFieldDescriptor> fields)\n+\t{\n+\t\tif (isWrongTable(tableName))\n+\t\t{\n+\t\t\treturn NullDocumentFilterDescriptorsProvider.instance;\n+\t\t}\n+\n+\t\treturn ImmutableDocumentFilterDescriptorsProvider.of(\n+\t\t\t\tDocumentFilterDescriptor.builder()\n+\t\t\t\t\t\t.setFilterId(FactAcctFilterConverter.FILTER_ID)\n+\t\t\t\t\t\t.setSortNo(DocumentFilterDescriptorsConstants.SORT_NO_FACT_ACCT)\n+\t\t\t\t\t\t.setFrequentUsed(true)\n+\t\t\t\t\t\t.setDisplayName(msgBL.translatable(\"AccountNumber\"))\n+\t\t\t\t\t\t//\n+\t\t\t\t\t\t.addParameter(DocumentFilterParamDescriptor.builder()\n+\t\t\t\t\t\t\t\t.setFieldName(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_FROM)\n+\t\t\t\t\t\t\t\t.setDisplayName(msgBL.translatable(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_FROM))\n+\t\t\t\t\t\t\t\t.setWidgetType(DocumentFieldWidgetType.Text)\n+\t\t\t\t\t\t)\n+\t\t\t\t\t\t.addParameter(DocumentFilterParamDescriptor.builder()\n+\t\t\t\t\t\t\t\t.setFieldName(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_TO)\n+\t\t\t\t\t\t\t\t.setDisplayName(msgBL.translatable(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_TO))\n+\t\t\t\t\t\t\t\t.setWidgetType(DocumentFieldWidgetType.Text)\n+\t\t\t\t\t\t)\n+\t\t\t\t\t\t//\n+\t\t\t\t\t\t.build()\n+\t\t);\n+\t}\n+\n+\tprivate boolean isWrongTable(@Nullable final String tableName)", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY1MDA5OA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428650098", "bodyText": "also, i would not refactor this logic since is just checking if a string matches 2 allowed values...", "author": "teosarca", "createdAt": "2020-05-21T13:27:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0ODUxMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzNzkyMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429037920", "bodyText": "I renamed the method to isValidTable and updated the if: if (!isValidTable(tableName)) to match the desired style.\ni won't inline the function though as making the if bigger would make the code harder to read.", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:35:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0ODUxMw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0OTU1NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428649555", "bodyText": "i saw that u are throwing FillMandatoryException in case the field is not set.\nWhy not calling setMandatory(true) here then?", "author": "teosarca", "createdAt": "2020-05-21T13:26:34Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/accounting/filters/FactAcctFilterDescriptorsProviderFactory.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.accounting.filters;\n+\n+import de.metas.i18n.IMsgBL;\n+import de.metas.ui.web.document.filter.DocumentFilterDescriptor;\n+import de.metas.ui.web.document.filter.DocumentFilterParamDescriptor;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsConstants;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProviderFactory;\n+import de.metas.ui.web.document.filter.provider.ImmutableDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.NullDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.window.descriptor.DocumentFieldDescriptor;\n+import de.metas.ui.web.window.descriptor.DocumentFieldWidgetType;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.element.api.AdTabId;\n+import org.compiere.model.I_Fact_Acct;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+\n+@Component\n+public class FactAcctFilterDescriptorsProviderFactory implements DocumentFilterDescriptorsProviderFactory\n+{\n+\tpublic static final String FACT_ACCT_TRANSACTIONS_VIEW = \"Fact_Acct_Transactions_View\";\n+\tpublic static final String FACT_ACCT_TABLE = I_Fact_Acct.Table_Name;\n+\tprivate final transient IMsgBL msgBL = Services.get(IMsgBL.class);\n+\n+\tpublic FactAcctFilterDescriptorsProviderFactory()\n+\t{\n+\t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic DocumentFilterDescriptorsProvider createFiltersProvider(\n+\t\t\t@Nullable final AdTabId ignored,\n+\t\t\t@Nullable final String tableName,\n+\t\t\t@Nullable final Collection<DocumentFieldDescriptor> fields)\n+\t{\n+\t\tif (isWrongTable(tableName))\n+\t\t{\n+\t\t\treturn NullDocumentFilterDescriptorsProvider.instance;\n+\t\t}\n+\n+\t\treturn ImmutableDocumentFilterDescriptorsProvider.of(\n+\t\t\t\tDocumentFilterDescriptor.builder()\n+\t\t\t\t\t\t.setFilterId(FactAcctFilterConverter.FILTER_ID)\n+\t\t\t\t\t\t.setSortNo(DocumentFilterDescriptorsConstants.SORT_NO_FACT_ACCT)\n+\t\t\t\t\t\t.setFrequentUsed(true)\n+\t\t\t\t\t\t.setDisplayName(msgBL.translatable(\"AccountNumber\"))\n+\t\t\t\t\t\t//\n+\t\t\t\t\t\t.addParameter(DocumentFilterParamDescriptor.builder()\n+\t\t\t\t\t\t\t\t.setFieldName(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_FROM)\n+\t\t\t\t\t\t\t\t.setDisplayName(msgBL.translatable(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_FROM))\n+\t\t\t\t\t\t\t\t.setWidgetType(DocumentFieldWidgetType.Text)", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzMzg3Nw==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429033877", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:15:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0OTU1NQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0OTY3Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428649676", "bodyText": "i saw that u are throwing FillMandatoryException in case the field is not set.\nWhy not calling setMandatory(true) here then?", "author": "teosarca", "createdAt": "2020-05-21T13:26:46Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/accounting/filters/FactAcctFilterDescriptorsProviderFactory.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.accounting.filters;\n+\n+import de.metas.i18n.IMsgBL;\n+import de.metas.ui.web.document.filter.DocumentFilterDescriptor;\n+import de.metas.ui.web.document.filter.DocumentFilterParamDescriptor;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsConstants;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProviderFactory;\n+import de.metas.ui.web.document.filter.provider.ImmutableDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.NullDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.window.descriptor.DocumentFieldDescriptor;\n+import de.metas.ui.web.window.descriptor.DocumentFieldWidgetType;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.element.api.AdTabId;\n+import org.compiere.model.I_Fact_Acct;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+\n+@Component\n+public class FactAcctFilterDescriptorsProviderFactory implements DocumentFilterDescriptorsProviderFactory\n+{\n+\tpublic static final String FACT_ACCT_TRANSACTIONS_VIEW = \"Fact_Acct_Transactions_View\";\n+\tpublic static final String FACT_ACCT_TABLE = I_Fact_Acct.Table_Name;\n+\tprivate final transient IMsgBL msgBL = Services.get(IMsgBL.class);\n+\n+\tpublic FactAcctFilterDescriptorsProviderFactory()\n+\t{\n+\t}\n+\n+\t@Override\n+\t@NonNull\n+\tpublic DocumentFilterDescriptorsProvider createFiltersProvider(\n+\t\t\t@Nullable final AdTabId ignored,\n+\t\t\t@Nullable final String tableName,\n+\t\t\t@Nullable final Collection<DocumentFieldDescriptor> fields)\n+\t{\n+\t\tif (isWrongTable(tableName))\n+\t\t{\n+\t\t\treturn NullDocumentFilterDescriptorsProvider.instance;\n+\t\t}\n+\n+\t\treturn ImmutableDocumentFilterDescriptorsProvider.of(\n+\t\t\t\tDocumentFilterDescriptor.builder()\n+\t\t\t\t\t\t.setFilterId(FactAcctFilterConverter.FILTER_ID)\n+\t\t\t\t\t\t.setSortNo(DocumentFilterDescriptorsConstants.SORT_NO_FACT_ACCT)\n+\t\t\t\t\t\t.setFrequentUsed(true)\n+\t\t\t\t\t\t.setDisplayName(msgBL.translatable(\"AccountNumber\"))\n+\t\t\t\t\t\t//\n+\t\t\t\t\t\t.addParameter(DocumentFilterParamDescriptor.builder()\n+\t\t\t\t\t\t\t\t.setFieldName(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_FROM)\n+\t\t\t\t\t\t\t\t.setDisplayName(msgBL.translatable(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_FROM))\n+\t\t\t\t\t\t\t\t.setWidgetType(DocumentFieldWidgetType.Text)\n+\t\t\t\t\t\t)\n+\t\t\t\t\t\t.addParameter(DocumentFilterParamDescriptor.builder()\n+\t\t\t\t\t\t\t\t.setFieldName(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_TO)\n+\t\t\t\t\t\t\t\t.setDisplayName(msgBL.translatable(FactAcctFilterConverter.PARAM_ACCOUNT_VALUE_TO))\n+\t\t\t\t\t\t\t\t.setWidgetType(DocumentFieldWidgetType.Text)\n+\t\t\t\t\t\t)", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzMzg2NA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429033864", "bodyText": "done", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:15:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY0OTY3Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY1MDUwMA==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r428650500", "bodyText": "any reason for making those 2 constants public?", "author": "teosarca", "createdAt": "2020-05-21T13:28:20Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/accounting/filters/FactAcctFilterDescriptorsProviderFactory.java", "diffHunk": "@@ -0,0 +1,93 @@\n+/*\n+ * #%L\n+ * metasfresh-webui-api\n+ * %%\n+ * Copyright (C) 2020 metas GmbH\n+ * %%\n+ * This program is free software: you can redistribute it and/or modify\n+ * it under the terms of the GNU General Public License as\n+ * published by the Free Software Foundation, either version 2 of the\n+ * License, or (at your option) any later version.\n+ *\n+ * This program is distributed in the hope that it will be useful,\n+ * but WITHOUT ANY WARRANTY; without even the implied warranty of\n+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the\n+ * GNU General Public License for more details.\n+ *\n+ * You should have received a copy of the GNU General Public\n+ * License along with this program. If not, see\n+ * <http://www.gnu.org/licenses/gpl-2.0.html>.\n+ * #L%\n+ */\n+\n+package de.metas.ui.web.accounting.filters;\n+\n+import de.metas.i18n.IMsgBL;\n+import de.metas.ui.web.document.filter.DocumentFilterDescriptor;\n+import de.metas.ui.web.document.filter.DocumentFilterParamDescriptor;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsConstants;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.DocumentFilterDescriptorsProviderFactory;\n+import de.metas.ui.web.document.filter.provider.ImmutableDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.document.filter.provider.NullDocumentFilterDescriptorsProvider;\n+import de.metas.ui.web.window.descriptor.DocumentFieldDescriptor;\n+import de.metas.ui.web.window.descriptor.DocumentFieldWidgetType;\n+import de.metas.util.Services;\n+import lombok.NonNull;\n+import org.adempiere.ad.element.api.AdTabId;\n+import org.compiere.model.I_Fact_Acct;\n+import org.springframework.stereotype.Component;\n+\n+import javax.annotation.Nullable;\n+import java.util.Collection;\n+\n+@Component\n+public class FactAcctFilterDescriptorsProviderFactory implements DocumentFilterDescriptorsProviderFactory\n+{\n+\tpublic static final String FACT_ACCT_TRANSACTIONS_VIEW = \"Fact_Acct_Transactions_View\";\n+\tpublic static final String FACT_ACCT_TABLE = I_Fact_Acct.Table_Name;", "originalCommit": "2084b879ff0459b1406190634da8ba4c46cafcad", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyOTAzMzc3NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/6689#discussion_r429033775", "bodyText": "missed that after 2 rounds of self review. damn. they shouldn't be public.", "author": "TheBestPessimist", "createdAt": "2020-05-22T04:14:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODY1MDUwMA=="}], "type": "inlineReview"}, {"oid": "1e78c16949150d0e102d05b3bebaa80dd7de0152", "url": "https://github.com/metasfresh/metasfresh/commit/1e78c16949150d0e102d05b3bebaa80dd7de0152", "message": "Cleanup code\n\nhttps://github.com/metasfresh/metasfresh/issues/6682", "committedDate": "2020-05-22T04:50:26Z", "type": "commit"}]}