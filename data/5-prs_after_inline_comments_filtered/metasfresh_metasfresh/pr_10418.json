{"pr_number": 10418, "pr_title": "Gh10393", "pr_createdAt": "2020-12-11T12:01:33Z", "pr_url": "https://github.com/metasfresh/metasfresh/pull/10418", "timeline": [{"oid": "9c6912efc6cc3396892d4b7fc96c470437eadfdd", "url": "https://github.com/metasfresh/metasfresh/commit/9c6912efc6cc3396892d4b7fc96c470437eadfdd", "message": "#10393\n - Initial commit", "committedDate": "2020-12-17T11:24:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTM0MQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545039341", "bodyText": "not really sure what the point of this method is..", "author": "metas-ts", "createdAt": "2020-12-17T12:06:04Z", "path": "backend/de.metas.business/src/main/java/de/metas/order/impl/OrderLineBL.java", "diffHunk": "@@ -328,6 +328,12 @@ public void updateLineNetAmtFromQtyEntered(@NonNull final org.compiere.model.I_C\n \t\tupdateLineNetAmtFromQtyInPriceUOM(orderLine, qtyInPriceUOM);\n \t}\n \n+\t@Override\n+\tpublic void updateMHuPiItemProduct(final I_C_OrderLine orderLine, final int huPiItemProductId)", "originalCommit": "3879dd71e6029b22b1c1e71f5062f5ccaf130522", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYzNjA4OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545636089", "bodyText": "Me neither, removed.", "author": "adi-stefan", "createdAt": "2020-12-18T08:08:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTM0MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTg2OA==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545039868", "bodyText": "we already have this, in de.metas.handlingunits.model.I_C_Order", "author": "metas-ts", "createdAt": "2020-12-17T12:06:56Z", "path": "backend/de.metas.adempiere.adempiere/base/src/main/java/de/metas/interfaces/I_C_OrderLine.java", "diffHunk": "@@ -43,4 +43,8 @@\n \tvoid setHandOver_Location_ID(int handoverLocationId);\n \tint getHandOver_Location_ID();\n \t// @formatter:on\n+\n+\tString COLUMNNAME_M_HU_PI_Item_Product_ID = \"M_HU_PI_Item_Product_ID\";", "originalCommit": "3879dd71e6029b22b1c1e71f5062f5ccaf130522", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYzNjE0OQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545636149", "bodyText": "Removed.", "author": "adi-stefan", "createdAt": "2020-12-18T08:08:34Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTAzOTg2OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzgxNA==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545043814", "bodyText": "1 i think it would be better to do this in a ModelInterceptor..i believe it make sense to do this also if e.g. the order line is created via scheduler from an C_OLCand\n2 if the new product has no M_HU_PI_Item_Product_ID, then i think C_OrderLine.M_HU_PI_Item_Product_ID should be set to -1\n3 please add a method Optional<HUPIItemProductId> retrieveDefaultIdForProduct to IHUPIItemProductDAO`\n\nrationale: try to avoid throwing around data records. we like to grow in the general direction of DDD.\nalso, we don't need (to load) the record for this", "author": "metas-ts", "createdAt": "2020-12-17T12:13:53Z", "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/callout/C_OrderLine.java", "diffHunk": "@@ -47,6 +55,17 @@ public void updateQtyCU(final I_C_OrderLine orderLine, final ICalloutField field\n \t\tServices.get(IOrderLineBL.class).updateLineNetAmtFromQtyEntered(orderLine);\n \t}\n \n+\t@CalloutMethod(columnNames = de.metas.interfaces.I_C_OrderLine.COLUMNNAME_M_Product_ID)\n+\tpublic void onProductSetOrChanged(final de.metas.interfaces.I_C_OrderLine orderLine)\n+\t{\n+\t\tfinal Optional<I_M_HU_PI_Item_Product> huPiItemProduct = hupiItemProductDAO.retrieveDefaultForProduct(ProductId.ofRepoId(orderLine.getM_Product_ID()),", "originalCommit": "3879dd71e6029b22b1c1e71f5062f5ccaf130522", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTYzNzM3MA==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545637370", "bodyText": "Moved to ModelInterceptor\nHUPIItemProductId.toRepoId(null) will return -1, used that.\nAdded, though I've only used it for our particular case. There are other places which still call retrieveDefaultForProduct, but we'd need to test those changes....", "author": "adi-stefan", "createdAt": "2020-12-18T08:11:16Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0MzgxNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTA0NTU1Ng==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545045556", "bodyText": "i didn't understand in the concept, why this was supposed to be changed..so i guess it's fine that it effectively was not changed at all", "author": "metas-ts", "createdAt": "2020-12-17T12:16:45Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/orderline/OrderLineQuickInputDescriptorFactory.java", "diffHunk": "@@ -175,7 +175,7 @@ private ProductLookupDescriptor createProductLookupDescriptor(@NonNull final Opt\n \t\t\t\t\t\t.setCtxTableName(null) // ctxTableName\n \t\t\t\t\t\t.setCtxColumnName(IOrderLineQuickInput.COLUMNNAME_M_HU_PI_Item_Product_ID)\n \t\t\t\t\t\t.setDisplayType(DisplayType.TableDir)\n-\t\t\t\t\t\t.setAD_Val_Rule_ID(540365) // FIXME: hardcoded \"M_HU_PI_Item_Product_For_Org_and_Product_and_DatePromised\"\n+\t\t\t\t\t\t.setAD_Val_Rule_ID(540365)// FIXME: hardcoded \"M_HU_PI_Item_Product_For_Org_and_Product_and_DatePromised\"", "originalCommit": "3879dd71e6029b22b1c1e71f5062f5ccaf130522", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "url": "https://github.com/metasfresh/metasfresh/commit/c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "message": "#gh10393 CR fixes", "committedDate": "2020-12-18T08:04:48Z", "type": "commit"}, {"oid": "c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "url": "https://github.com/metasfresh/metasfresh/commit/c95b8aea41c182b518d6c363f1c3b1a83dc559c9", "message": "#gh10393 CR fixes", "committedDate": "2020-12-18T08:04:48Z", "type": "forcePushed"}, {"oid": "935224947e7e63007f10ec7d6120ff58140a15d8", "url": "https://github.com/metasfresh/metasfresh/commit/935224947e7e63007f10ec7d6120ff58140a15d8", "message": "#gh10393 cleanup", "committedDate": "2020-12-18T08:14:49Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTcxMzg0NQ==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545713845", "bodyText": "This was missing from Dragos's changes, but was necessary (at least for the batch add)", "author": "adi-stefan", "createdAt": "2020-12-18T09:38:52Z", "path": "backend/de.metas.handlingunits.base/src/main/java/de/metas/handlingunits/impl/HUPIItemProductDAO.java", "diffHunk": "@@ -487,6 +488,7 @@ public I_M_HU_PI_Item_Product retrieveMaterialItemProduct(\n \t\t\t\t// Get specific Product first\n \t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_IsAllowAnyProduct, Direction.Descending, Nulls.Last) // Y first, N second\n \t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_M_Product_ID, Direction.Descending, Nulls.Last)\n+\t\t\t\t.addColumn(I_M_HU_PI_Item_Product.COLUMNNAME_IsDefaultForProduct, Direction.Descending, Nulls.Last)", "originalCommit": "935224947e7e63007f10ec7d6120ff58140a15d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NTc3NjYyNg==", "url": "https://github.com/metasfresh/metasfresh/pull/10418#discussion_r545776626", "bodyText": "please make sure we don't run into an NPE here", "author": "metas-ts", "createdAt": "2020-12-18T11:38:27Z", "path": "backend/metasfresh-webui-api/src/main/java/de/metas/ui/web/quickinput/ddorderline/DDOrderLineQuickInputCallout.java", "diffHunk": "@@ -72,7 +73,7 @@ public void onProductChange(@NonNull final ICalloutField calloutField)\n \t\t}\n \t\tfinal I_DD_Order ddOrder = quickInput.getRootDocumentAs(I_DD_Order.class);\n \n-\t\tddOrderLineQuickInput.setM_HU_PI_Item_Product(getDefaultPI(ddOrder, productId));\n+\t\tddOrderLineQuickInput.setM_HU_PI_Item_Product_ID(getDefaultPI(ddOrder, productId).getM_HU_PI_Item_Product_ID());", "originalCommit": "935224947e7e63007f10ec7d6120ff58140a15d8", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "f0ac6dafaa51c38a2da165007a882d1b32451ade", "url": "https://github.com/metasfresh/metasfresh/commit/f0ac6dafaa51c38a2da165007a882d1b32451ade", "message": "#gh10393 CR fixes", "committedDate": "2020-12-18T11:43:58Z", "type": "commit"}]}