{"pr_number": 5810, "pr_title": "Make the name collision policy for auto uploads selectable", "pr_createdAt": "2020-04-05T17:46:50Z", "pr_url": "https://github.com/nextcloud/android/pull/5810", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NjQ0Mg==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r403776442", "bodyText": "I know the previous arguments is also a magic number, but I would argue that they should both be replaced by their corresponding constants.\nFileUploader.LOCAL_BEHAVIOUR_MOVE\nFileUploader.NameCollisionPolicy.ASK_USER.serialize()", "author": "ashpieboop", "createdAt": "2020-04-05T23:59:42Z", "path": "src/test/java/com/owncloud/android/ui/activity/SyncedFoldersActivityTest.java", "diffHunk": "@@ -167,6 +167,7 @@ private SyncedFolderDisplayItem create(String folderName, boolean enabled) {\n                                            true,\n                                            \"test@nextcloud.com\",\n                                            1,\n+                                           3,", "originalCommit": "7df28bc9a084067692b54c809dc7a40c20b41710", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzkxNzExMg==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r403917112", "bodyText": "Fixed.", "author": "fodinabor", "createdAt": "2020-04-06T08:33:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMzc3NjQ0Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc0NzI1NQ==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404747255", "bodyText": "Maybe move this as default in switch?", "author": "tobiasKaminsky", "createdAt": "2020-04-07T11:49:19Z", "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDc0NzMzNw==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404747337", "bodyText": "\"this,\" is unneeded", "author": "tobiasKaminsky", "createdAt": "2020-04-07T11:49:31Z", "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {\n+        switch (nameCollisionPolicy) {\n+            case \"NAME_COLLISION_POLICY_ASK\":\n+                this.nameCollisionPolicy = FileUploader.NameCollisionPolicy.ASK_USER;", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyNDc1Mg==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404824752", "bodyText": "Ther should be 1 statement per line. Please break it into separate statements. Coalescing complex code into gigantic nested statements make it very difficult to read and debug.", "author": "ezaquarii", "createdAt": "2020-04-07T13:50:52Z", "path": "src/main/java/com/owncloud/android/ui/dialog/SyncedFolderPreferencesDialogFragment.java", "diffHunk": "@@ -454,6 +470,36 @@ public void onCancel(DialogInterface dialog) {\n         behaviourDialog.show();\n     }\n \n+    private void showNameCollisionPolicyDialog() {\n+        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());\n+        builder.setTitle(ThemeUtils.getColoredTitle(\n+            getResources().getString(R.string.pref_instant_name_collision_policy_dialogTitle),\n+            ThemeUtils.primaryAccentColor(getContext())))\n+            .setSingleChoiceItems(getResources().getTextArray(R.array.pref_name_collision_policy_entries),\n+                                  mSyncedFolder.getNameCollisionPolicyInteger(),\n+                                  new\n+                                      DialogInterface.OnClickListener() {\n+                                          public void onClick(DialogInterface dialog, int which) {\n+                                              mSyncedFolder.setNameCollisionPolicy(", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyNjE4NQ==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404826185", "bodyText": "Please consider extractin this interface into a fragment member. Those callbacks are de facto piece of fragment logic and here are mixed with construction logic.\nAlternatively we could create 2 methods in fragment and link them here.", "author": "ezaquarii", "createdAt": "2020-04-07T13:52:48Z", "path": "src/main/java/com/owncloud/android/ui/dialog/SyncedFolderPreferencesDialogFragment.java", "diffHunk": "@@ -454,6 +470,36 @@ public void onCancel(DialogInterface dialog) {\n         behaviourDialog.show();\n     }\n \n+    private void showNameCollisionPolicyDialog() {\n+        AlertDialog.Builder builder = new AlertDialog.Builder(getActivity());\n+        builder.setTitle(ThemeUtils.getColoredTitle(\n+            getResources().getString(R.string.pref_instant_name_collision_policy_dialogTitle),\n+            ThemeUtils.primaryAccentColor(getContext())))\n+            .setSingleChoiceItems(getResources().getTextArray(R.array.pref_name_collision_policy_entries),\n+                                  mSyncedFolder.getNameCollisionPolicyInteger(),\n+                                  new\n+                                      DialogInterface.OnClickListener() {", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgyOTgwOA==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404829808", "bodyText": "Did you mean setCollisionPolicyByName(String collisionPolicyName)? This function name does not make sense - it says that someobdy chooses a name for a collision policy.\nI think it refers to the unfornately named NameCollisionPolicy type.\n@tobiasKaminsky  what do you think? can we fix it?", "author": "ezaquarii", "createdAt": "2020-04-07T13:57:32Z", "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzMDAxMQ==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404830011", "bodyText": "Please consider eliminating magic values and moveing them to documented constants.", "author": "ezaquarii", "createdAt": "2020-04-07T13:57:50Z", "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {\n+        switch (nameCollisionPolicy) {\n+            case \"NAME_COLLISION_POLICY_ASK\":\n+                this.nameCollisionPolicy = FileUploader.NameCollisionPolicy.ASK_USER;\n+                break;\n+            case \"NAME_COLLISION_POLICY_OVERWRITE\":", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNTQ0MzE1NQ==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r405443155", "bodyText": "Those are the values from the resource array.. I'm not sure whether it's considered bad practice to use getResources().getTextArray(R.array.pref_name_collision_policy_entryValues) in non-UI classes", "author": "fodinabor", "createdAt": "2020-04-08T11:08:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzMDAxMQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNDkxOQ==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404834919", "bodyText": "No sure why do we pass a primitive type instead of strongly typed enum here?", "author": "ezaquarii", "createdAt": "2020-04-07T14:04:22Z", "path": "src/main/java/com/owncloud/android/datamodel/SyncedFolderDisplayItem.java", "diffHunk": "@@ -60,6 +60,7 @@ public SyncedFolderDisplayItem(long id,\n                                    boolean subfolderByDate,\n                                    String account,\n                                    int uploadAction,\n+                                   int nameCollisionPolicy,", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDgzNjk3MQ==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404836971", "bodyText": "Please provide a javadoc for this method. The name does not tell the story. Why do we convert it to int? What is the meaning of this int? Constraints?\nPlease consider using primitive type instead of boxed type.", "author": "ezaquarii", "createdAt": "2020-04-07T14:07:20Z", "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwNDg0MTAzMw==", "url": "https://github.com/nextcloud/android/pull/5810#discussion_r404841033", "bodyText": "This conversion could be folded into enum NameCollisionPolicy:\npublic static NameCollisionPolicy fromName(String policyName) { ... }\n@tobiasKaminsky I think the name choosen for this concept is invalid. While here, we could rename it into CollisionPolicyName, so it respects english grammar rules. As it is now - it's just confusing.", "author": "ezaquarii", "createdAt": "2020-04-07T14:12:49Z", "path": "src/main/java/com/owncloud/android/ui/dialog/parcel/SyncedFolderParcelable.java", "diffHunk": "@@ -146,6 +151,33 @@ public void setUploadAction(String uploadAction) {\n         }\n     }\n \n+\n+    public Integer getNameCollisionPolicyInteger() {\n+        switch (nameCollisionPolicy) {\n+            case ASK_USER:\n+                return 0;\n+            case OVERWRITE:\n+                return 1;\n+            case RENAME:\n+                return 2;\n+        }\n+        return 0;\n+    }\n+\n+    public void setNameCollisionPolicy(String nameCollisionPolicy) {\n+        switch (nameCollisionPolicy) {", "originalCommit": "7354e468a41f6d8f3b66af84136f38ad62ed6628", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "32da47d6a31503d885ffa3a0acebb1cfbd697f71", "url": "https://github.com/nextcloud/android/commit/32da47d6a31503d885ffa3a0acebb1cfbd697f71", "message": "Make the name collision policy for auto uploads selectable, fixes #5599.\n\nSigned-off-by: Joachim Meyer <joachim@joameyer.de>", "committedDate": "2020-04-15T17:12:06Z", "type": "commit"}, {"oid": "db3bd029ca6c4d673f477624c6fb1f746d666525", "url": "https://github.com/nextcloud/android/commit/db3bd029ca6c4d673f477624c6fb1f746d666525", "message": "code formatting\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-04-15T17:12:16Z", "type": "commit"}, {"oid": "464aaded14903525948ce555940582f39676234e", "url": "https://github.com/nextcloud/android/commit/464aaded14903525948ce555940582f39676234e", "message": "increase spotbugs\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-04-15T17:12:43Z", "type": "commit"}]}