{"pr_number": 5775, "pr_title": "if no offline editor is available, use OO/Cool/Text", "pr_createdAt": "2020-03-30T14:13:43Z", "pr_url": "https://github.com/nextcloud/android/pull/5775", "timeline": [{"oid": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9", "url": "https://github.com/nextcloud/android/commit/d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9", "message": "if no offline editor is available, use OO/Cool/Text\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-03-30T14:12:16Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw==", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400273927", "bodyText": "the return calls aren't needed", "author": "AndyScherzinger", "createdAt": "2020-03-30T15:16:00Z", "path": "src/main/java/com/owncloud/android/ui/helpers/FileOperationsHelper.java", "diffHunk": "@@ -278,16 +280,25 @@ public void openFile(OCFile file) {\n                     queryIntentActivities(openFileWithIntent, PackageManager.GET_RESOLVED_FILTER);\n \n             if (launchables.isEmpty()) {\n-                Account account = fileActivity.getAccount();\n-                OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n-                if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n-                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n-                    capability.getRichDocumentsDirectEditing().isTrue()) {\n-                    openFileAsRichDocument(file, fileActivity);\n-                    return;\n+                Optional<User> optionalUser = fileActivity.getUser();\n+\n+                if (optionalUser.isPresent() && FileMenuFilter.isEditorAvailable(fileActivity.getContentResolver(),\n+                                                                                 optionalUser.get(),\n+                                                                                 file.getMimeType()) &&\n+                    android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP) {\n+                    openFileWithTextEditor(file, fileActivity);\n                 } else {\n-                    DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n-                    return;\n+                    Account account = fileActivity.getAccount();\n+                    OCCapability capability = fileActivity.getStorageManager().getCapability(account.name);\n+                    if (capability.getRichDocumentsMimeTypeList().contains(file.getMimeType()) &&\n+                        android.os.Build.VERSION.SDK_INT >= Build.VERSION_CODES.LOLLIPOP &&\n+                        capability.getRichDocumentsDirectEditing().isTrue()) {\n+                        openFileAsRichDocument(file, fileActivity);\n+                        return;\n+                    } else {\n+                        DisplayUtils.showSnackMessage(fileActivity, R.string.file_list_no_app_for_file_type);\n+                        return;", "originalCommit": "d3f3b98be0c89dfb14a7d7b645fa113c9a140ac9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM4MTc3NQ==", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400381775", "bodyText": "They are, otherwise the next block starting at Line 305 will be executed.", "author": "tobiasKaminsky", "createdAt": "2020-03-30T17:51:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDM5MDMzMA==", "url": "https://github.com/nextcloud/android/pull/5775#discussion_r400390330", "bodyText": "\ud83d\udc4d", "author": "AndyScherzinger", "createdAt": "2020-03-30T18:05:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMDI3MzkyNw=="}], "type": "inlineReview"}]}