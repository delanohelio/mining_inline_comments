{"pr_number": 6997, "pr_title": "Re-use the existing foreground notification for FileUploader progress notifications", "pr_createdAt": "2020-09-23T14:24:14Z", "pr_url": "https://github.com/nextcloud/android/pull/6997", "timeline": [{"oid": "7717318c8a30b8bc497f119251718f5349e26a1a", "url": "https://github.com/nextcloud/android/commit/7717318c8a30b8bc497f119251718f5349e26a1a", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>", "committedDate": "2020-09-23T14:24:24Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzNzQzMg==", "url": "https://github.com/nextcloud/android/pull/6997#discussion_r493637432", "bodyText": "This does not seem to be necessary anymore as we now cancel the notification when the service is destroyed.\nWas this maybe a relic from before using a foreground service or did you still see that the service was killed without calling onDestroy()?", "author": "grote", "createdAt": "2020-09-23T14:26:26Z", "path": "src/main/java/com/owncloud/android/files/services/FileUploader.java", "diffHunk": "@@ -240,24 +240,13 @@ public void onCreate() {\n         mNotification = builder.build();\n \n         // TODO Add UploadResult.KILLED?\n-        int failedCounter = mUploadsStorageManager.failInProgressUploads(UploadResult.SERVICE_INTERRUPTED);\n-        if (failedCounter > 0) {\n-            resurrection();\n-        }\n+        mUploadsStorageManager.failInProgressUploads(UploadResult.SERVICE_INTERRUPTED);\n \n         // add AccountsUpdatedListener\n         AccountManager am = AccountManager.get(getApplicationContext());\n         am.addOnAccountsUpdatedListener(this, null, false);\n     }\n \n-    /**\n-     * Service clean-up when restarted after being killed\n-     */\n-    private void resurrection() {\n-        // remove stucked notification\n-        mNotificationManager.cancel(R.string.uploader_upload_in_progress_ticker);\n-    }\n-", "originalCommit": "7717318c8a30b8bc497f119251718f5349e26a1a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDA4NjE2Ng==", "url": "https://github.com/nextcloud/android/pull/6997#discussion_r494086166", "bodyText": "I think this is to prevent edge cases like\n\nupload ongoing, notification is shown\napp is killed\nnotification is still shown\n\nAt least I remember something like that. Maybe it is already better handled by newer Android versions\u2026", "author": "tobiasKaminsky", "createdAt": "2020-09-24T07:09:19Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzNzQzMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDI4MDM0NQ==", "url": "https://github.com/nextcloud/android/pull/6997#discussion_r494280345", "bodyText": "Probably safer to leave it in then. I re-added it back.", "author": "grote", "createdAt": "2020-09-24T12:35:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzNzQzMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzYzODYzMw==", "url": "https://github.com/nextcloud/android/pull/6997#discussion_r493638633", "bodyText": "First, I was replacing the progress notification with the general foreground service notification here (mNotification), but that doesn't seem to be necessary as we either cancel it when the service gets destroyed or replace it with a new notification when starting the next upload.", "author": "grote", "createdAt": "2020-09-23T14:27:49Z", "path": "src/main/java/com/owncloud/android/files/services/FileUploader.java", "diffHunk": "@@ -748,8 +740,6 @@ private void notifyUploadResult(UploadFileOperation upload, RemoteOperationResul\n             mNotificationManager = (NotificationManager) getSystemService(NOTIFICATION_SERVICE);\n         }\n \n-        mNotificationManager.cancel(R.string.uploader_upload_in_progress_ticker);\n-", "originalCommit": "7717318c8a30b8bc497f119251718f5349e26a1a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "715b21420eb0ad9a904930c67361968fe18bfadb", "url": "https://github.com/nextcloud/android/commit/715b21420eb0ad9a904930c67361968fe18bfadb", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>", "committedDate": "2020-09-24T07:32:24Z", "type": "forcePushed"}, {"oid": "6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "url": "https://github.com/nextcloud/android/commit/6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>", "committedDate": "2020-09-24T12:35:12Z", "type": "commit"}, {"oid": "6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "url": "https://github.com/nextcloud/android/commit/6dc30d88ba29d670791bcbe4dc2f0eb7014c00a0", "message": "Re-use the existing foreground notification for FileUploader progress\n\nnotifications\n\nSigned-off-by: Torsten Grote <t@grobox.de>", "committedDate": "2020-09-24T12:35:12Z", "type": "forcePushed"}]}