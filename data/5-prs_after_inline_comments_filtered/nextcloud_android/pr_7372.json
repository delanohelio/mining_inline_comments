{"pr_number": 7372, "pr_title": "Closed the app when press back button from App passcode screen", "pr_createdAt": "2020-11-19T10:25:58Z", "pr_url": "https://github.com/nextcloud/android/pull/7372", "timeline": [{"oid": "ddc3db038c0c6992ee30cc916b71e2fec659d2e8", "url": "https://github.com/nextcloud/android/commit/ddc3db038c0c6992ee30cc916b71e2fec659d2e8", "message": "Closed the screen when press back button from App passcode screen\n\nSigned-off-by: Kuuuna98 <yunaghgh@naver.com>", "committedDate": "2020-11-19T10:22:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU1NDU3Nw==", "url": "https://github.com/nextcloud/android/pull/7372#discussion_r527554577", "bodyText": "This is only available in API >= 21, but not on 19, which we still support.\nIf there is no fitting function that also works on 19, I suggest to have a version check, so that on <21 it simply does not work, but works with >=21.", "author": "tobiasKaminsky", "createdAt": "2020-11-20T09:17:37Z", "path": "src/main/java/com/owncloud/android/ui/activity/PassCodeActivity.java", "diffHunk": "@@ -365,10 +365,13 @@ protected void clearBoxes(){\n     @Override\n     public boolean onKeyDown(int keyCode, KeyEvent event){\n         if (keyCode == KeyEvent.KEYCODE_BACK && event.getRepeatCount()== 0){\n-            if (ACTION_REQUEST_WITH_RESULT.equals(getIntent().getAction()) ||\n-                    ACTION_CHECK_WITH_RESULT.equals(getIntent().getAction())) {\n+            if(ACTION_CHECK.equals(getIntent().getAction())){\n+                moveTaskToBack(true);\n+                finishAndRemoveTask();", "originalCommit": "ddc3db038c0c6992ee30cc916b71e2fec659d2e8", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzkzODcyNg==", "url": "https://github.com/nextcloud/android/pull/7372#discussion_r527938726", "bodyText": "@Kuuuna98 could you rather put in a version check and support 21+ and <21 because according to our Android version support guideline we will drop 4.4 with the next feature release. So since you are targeting master this way would could then easily find this part in the code.\ncc @tobiasKaminsky, I already out this in the 3.15. Overview issue.", "author": "AndyScherzinger", "createdAt": "2020-11-20T19:56:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyNzU1NDU3Nw=="}], "type": "inlineReview"}, {"oid": "02d12b803c4d7f4c48886bb6b664b8686f0189ce", "url": "https://github.com/nextcloud/android/commit/02d12b803c4d7f4c48886bb6b664b8686f0189ce", "message": "Modified code in consideration of API\n\nIt has been modified from finishAndRemoveTask() to finish() in consideration of API  < 21.", "committedDate": "2020-11-20T15:54:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU5MzUzOA==", "url": "https://github.com/nextcloud/android/pull/7372#discussion_r528593538", "bodyText": "Have you tried this?\nI think this will just close the PassCodeActivity, but not the app and thus lets the user allow to go into the app without entering correct pin code.", "author": "tobiasKaminsky", "createdAt": "2020-11-23T10:13:27Z", "path": "src/main/java/com/owncloud/android/ui/activity/PassCodeActivity.java", "diffHunk": "@@ -367,7 +367,7 @@ public boolean onKeyDown(int keyCode, KeyEvent event){\n         if (keyCode == KeyEvent.KEYCODE_BACK && event.getRepeatCount()== 0){\n             if(ACTION_CHECK.equals(getIntent().getAction())){\n                 moveTaskToBack(true);\n-                finishAndRemoveTask();\n+                finish();", "originalCommit": "02d12b803c4d7f4c48886bb6b664b8686f0189ce", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODYwNDI0Ng==", "url": "https://github.com/nextcloud/android/pull/7372#discussion_r528604246", "bodyText": "I thought so, but it wasn't the result.\nAs a result, the app closed well.\nCan you see the main screen as a result from other versions of Android?\nIf so, I will modify it to check the version in the first code.\nBelow is a test video.\nhttps://drive.google.com/file/d/1e7D9w7HeiOg74xRNwr2AzndOLJAfEVR8/view?usp=sharing\nAndroid version: 5\nDevice model: Samsung Galaxy S9", "author": "Kuuuna98", "createdAt": "2020-11-23T10:31:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU5MzUzOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODg4MjMzNQ==", "url": "https://github.com/nextcloud/android/pull/7372#discussion_r528882335", "bodyText": "@Kuuuna98 you can/should also try the \"wack-up\" scenario:\n\nopen the app\nput in PIN\nnavigate a bit through the app\nswitch to another app\nbring the app back to the front (not having killed the app in between!)\n\nThis way you do have a filled \"back-stack\" within the app and not just a single activity, so finish() should just kill the last one and with this change you should have access to the app (which is what @tobiasKaminsky suggested will happen with this change).\nOther than that, again: It is fine to implement this for API >= 21 only which will be the minimum Android version anyways for the next release.", "author": "AndyScherzinger", "createdAt": "2020-11-23T17:38:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyODU5MzUzOA=="}], "type": "inlineReview"}, {"oid": "babf64f5e91eb28e5bb0435d5eca1b9158eadc09", "url": "https://github.com/nextcloud/android/commit/babf64f5e91eb28e5bb0435d5eca1b9158eadc09", "message": "Modified code to close the app after checking API >= 21\n\nIf API >= 21, Closed the app when press back button from App passcode screen", "committedDate": "2020-11-24T04:16:33Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUyOTI5NDE3MA==", "url": "https://github.com/nextcloud/android/pull/7372#discussion_r529294170", "bodyText": "Please change this to proper name (Lollipop).", "author": "tobiasKaminsky", "createdAt": "2020-11-24T08:39:35Z", "path": "src/main/java/com/owncloud/android/ui/activity/PassCodeActivity.java", "diffHunk": "@@ -365,10 +366,13 @@ protected void clearBoxes(){\n     @Override\n     public boolean onKeyDown(int keyCode, KeyEvent event){\n         if (keyCode == KeyEvent.KEYCODE_BACK && event.getRepeatCount()== 0){\n-            if (ACTION_REQUEST_WITH_RESULT.equals(getIntent().getAction()) ||\n-                    ACTION_CHECK_WITH_RESULT.equals(getIntent().getAction())) {\n+            if(ACTION_CHECK.equals(getIntent().getAction()) && Build.VERSION.SDK_INT>=21){", "originalCommit": "babf64f5e91eb28e5bb0435d5eca1b9158eadc09", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "830e84df3889599b2df136ac85f1414a761ef584", "url": "https://github.com/nextcloud/android/commit/830e84df3889599b2df136ac85f1414a761ef584", "message": "replaced \"21\" with \"Build.VERSION_CODES.LOLLIPOP\"", "committedDate": "2020-11-24T09:39:52Z", "type": "commit"}]}