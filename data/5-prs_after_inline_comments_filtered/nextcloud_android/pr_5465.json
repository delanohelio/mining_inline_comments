{"pr_number": 5465, "pr_title": "Fixed crash during folder creation (autosync)", "pr_createdAt": "2020-02-13T11:55:49Z", "pr_url": "https://github.com/nextcloud/android/pull/5465", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1NzY3Mg==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378857672", "bodyText": "@Shagequi can you add the license header please :)", "author": "AndyScherzinger", "createdAt": "2020-02-13T13:27:09Z", "path": "src/androidTest/java/com/owncloud/android/ui/activity/FolderPickerActivityTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.owncloud.android.ui.activity;", "originalCommit": "5d8b84525cb01b5b8a4e05ec7c7fa552f46b965c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MzE1OQ==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378893159", "bodyText": "Sure, will be done", "author": "Kilian-Perisset", "createdAt": "2020-02-13T14:27:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1NzY3Mg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1ODE5MQ==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378858191", "bodyText": "no need to split this into two statements, could be reverted (or did I miss a detail here?)", "author": "AndyScherzinger", "createdAt": "2020-02-13T13:28:11Z", "path": "src/main/java/com/owncloud/android/ui/activity/FolderPickerActivity.java", "diffHunk": "@@ -302,7 +299,8 @@ public boolean onOptionsItemSelected(MenuItem item) {\n         boolean retval = true;\n         switch (item.getItemId()) {\n             case R.id.action_create_dir: {\n-                CreateFolderDialogFragment dialog = CreateFolderDialogFragment.newInstance(getCurrentFolder());\n+                OCFile currentFolder = getCurrentFolder();\n+                CreateFolderDialogFragment dialog = CreateFolderDialogFragment.newInstance(currentFolder);", "originalCommit": "5d8b84525cb01b5b8a4e05ec7c7fa552f46b965c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MDU2MQ==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378890561", "bodyText": "I guess this was just for debugging, but true, this can be reverted.", "author": "tobiasKaminsky", "createdAt": "2020-02-13T14:23:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1ODE5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MjczMQ==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378892731", "bodyText": "Yup it was for debugging.\nI'm glad it's this name, I sometimes have an excess of imagination in my development (for naming variables or logs \ud83d\ude05)...\nI'll fix it ASAP, am working on another project", "author": "Kilian-Perisset", "createdAt": "2020-02-13T14:27:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1ODE5MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODk4NzgxNg==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378987816", "bodyText": "Wo worries, no hurries :)", "author": "AndyScherzinger", "createdAt": "2020-02-13T16:52:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg1ODE5MQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378891728", "bodyText": "I would use new File(currentFile.getRemotePath()).getParent() for this.", "author": "tobiasKaminsky", "createdAt": "2020-02-13T14:25:27Z", "path": "src/main/java/com/owncloud/android/ui/activity/FolderPickerActivity.java", "diffHunk": "@@ -333,16 +331,24 @@ public boolean onOptionsItemSelected(MenuItem item) {\n     }\n \n     protected OCFile getCurrentFolder() {\n-        OCFile file = getFile();\n-        if (file != null) {\n-            if (file.isFolder()) {\n-                return file;\n-            } else if (getStorageManager() != null) {\n-                String parentPath = file.getRemotePath().substring(0, file.getRemotePath().lastIndexOf(file.getFileName()));\n-                return getStorageManager().getFileByPath(parentPath);\n+        OCFile currentFile = getFile();\n+        OCFile finalFolder = null;\n+\n+        // If the file is null, take the root folder to avoid any error in functions depending on this one\n+        if (currentFile != null) {\n+            if (currentFile.isFolder()) {\n+                finalFolder = currentFile;\n+            } else if(currentFile.getRemotePath() != null) {\n+                String parentPath = currentFile", "originalCommit": "5d8b84525cb01b5b8a4e05ec7c7fa552f46b965c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MzAzNA==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378893034", "bodyText": "Yeah, I forgot this point too,\nwill be fixed asap too", "author": "Kilian-Perisset", "createdAt": "2020-02-13T14:27:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODkwNjUwNA==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r378906504", "bodyText": "\"asap\" -> do not hurry too much :-)", "author": "tobiasKaminsky", "createdAt": "2020-02-13T14:48:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM2NDE1MQ==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r379364151", "bodyText": "This method doesn't work, we need to use the FileStorageManager in all cases, I stay with this solution for now", "author": "Kilian-Perisset", "createdAt": "2020-02-14T10:44:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM5NjIyMA==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r379396220", "bodyText": "String parentPath = new File(currentFile.getRemotePath()).getParent();\n\n                String parentPath1 = currentFile\n                        .getRemotePath()\n                        .substring(0, currentFile.getRemotePath()\n                        .lastIndexOf(currentFile.getFileName()));\n\nShould be exactly the same, and is not error prone :-)", "author": "tobiasKaminsky", "createdAt": "2020-02-14T12:04:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTM5NjYwMw==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r379396603", "bodyText": "But, why create a File object, if we're expecting an OCFile object ?", "author": "Kilian-Perisset", "createdAt": "2020-02-14T12:05:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDA0ODEzMg==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r380048132", "bodyText": "This is just for handling the path part.\nI think, using File, is more error prone than trying to to it by our selves.", "author": "tobiasKaminsky", "createdAt": "2020-02-17T08:49:23Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3ODg5MTcyOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2Mzc5OA==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r379263798", "bodyText": "I appreciate that we try to document he test. If we're writing a geherkin-style test scenarios, can we please use recognized way for this?\nhttps://support.smartbear.com/cucumberstudio/docs/bdd/write-gherkin-scenarios.html", "author": "ezaquarii", "createdAt": "2020-02-14T06:06:35Z", "path": "src/androidTest/java/com/owncloud/android/ui/activity/FolderPickerActivityTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.owncloud.android.ui.activity;\n+\n+import com.owncloud.android.datamodel.OCFile;\n+\n+import org.junit.Assert;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+import androidx.test.filters.LargeTest;\n+import androidx.test.rule.ActivityTestRule;\n+\n+@RunWith(AndroidJUnit4.class)\n+@LargeTest\n+public class FolderPickerActivityTest {\n+    @Rule\n+    public ActivityTestRule<FolderPickerActivity> activityRule =\n+        new ActivityTestRule<>(FolderPickerActivity.class);\n+\n+    @Test\n+    public void getFile_NoDifferenceTest() {\n+        // Arrange", "originalCommit": "5d8b84525cb01b5b8a4e05ec7c7fa552f46b965c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MDIwMDA0OQ==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r380200049", "bodyText": "To be honest, I also do not follow this, and we did not agreed on a common pattern.\nAs I also now those three steps, we can keep it this way and discuss in separate issue, which way(s) we do want to follow", "author": "tobiasKaminsky", "createdAt": "2020-02-17T14:04:58Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2Mzc5OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2Mzk3Nw==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r379263977", "bodyText": "test suffix is not needed;\nit was needed in Junit3, bacause it was looking for a particularly named methods, but since JUnit4 uses annotations, we don't need it.", "author": "ezaquarii", "createdAt": "2020-02-14T06:07:24Z", "path": "src/androidTest/java/com/owncloud/android/ui/activity/FolderPickerActivityTest.java", "diffHunk": "@@ -0,0 +1,71 @@\n+package com.owncloud.android.ui.activity;\n+\n+import com.owncloud.android.datamodel.OCFile;\n+\n+import org.junit.Assert;\n+import org.junit.Rule;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+\n+import androidx.test.ext.junit.runners.AndroidJUnit4;\n+import androidx.test.filters.LargeTest;\n+import androidx.test.rule.ActivityTestRule;\n+\n+@RunWith(AndroidJUnit4.class)\n+@LargeTest\n+public class FolderPickerActivityTest {\n+    @Rule\n+    public ActivityTestRule<FolderPickerActivity> activityRule =\n+        new ActivityTestRule<>(FolderPickerActivity.class);\n+\n+    @Test\n+    public void getFile_NoDifferenceTest() {", "originalCommit": "5d8b84525cb01b5b8a4e05ec7c7fa552f46b965c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTI2NDQ3Mg==", "url": "https://github.com/nextcloud/android/pull/5465#discussion_r379264472", "bodyText": "Can we break those multiple statements? Readers generally expect 1 statement per line of code. Here we have 4.", "author": "ezaquarii", "createdAt": "2020-02-14T06:09:45Z", "path": "src/main/java/com/owncloud/android/ui/activity/FolderPickerActivity.java", "diffHunk": "@@ -333,16 +331,24 @@ public boolean onOptionsItemSelected(MenuItem item) {\n     }\n \n     protected OCFile getCurrentFolder() {\n-        OCFile file = getFile();\n-        if (file != null) {\n-            if (file.isFolder()) {\n-                return file;\n-            } else if (getStorageManager() != null) {\n-                String parentPath = file.getRemotePath().substring(0, file.getRemotePath().lastIndexOf(file.getFileName()));\n-                return getStorageManager().getFileByPath(parentPath);\n+        OCFile currentFile = getFile();\n+        OCFile finalFolder = null;\n+\n+        // If the file is null, take the root folder to avoid any error in functions depending on this one\n+        if (currentFile != null) {\n+            if (currentFile.isFolder()) {\n+                finalFolder = currentFile;\n+            } else if(currentFile.getRemotePath() != null) {\n+                String parentPath = currentFile\n+                        .getRemotePath()\n+                        .substring(0, currentFile.getRemotePath()", "originalCommit": "5d8b84525cb01b5b8a4e05ec7c7fa552f46b965c", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "511a16612d11b94152a2fd2be549be33c0864f42", "url": "https://github.com/nextcloud/android/commit/511a16612d11b94152a2fd2be549be33c0864f42", "message": "Fixed bug relative to null folder in FolderPicker", "committedDate": "2020-02-17T13:45:07Z", "type": "commit"}, {"oid": "389090d3e89d2a080abc813d3d52f22254c9bf5c", "url": "https://github.com/nextcloud/android/commit/389090d3e89d2a080abc813d3d52f22254c9bf5c", "message": "Implemented tests for FolderPickerActivity", "committedDate": "2020-02-17T13:45:07Z", "type": "commit"}, {"oid": "c821f192d66628d33fe5f95fcba30c8f3f495b36", "url": "https://github.com/nextcloud/android/commit/c821f192d66628d33fe5f95fcba30c8f3f495b36", "message": "Formated the code (removed useless spaces)", "committedDate": "2020-02-17T13:45:07Z", "type": "commit"}, {"oid": "c59f9c0b913b5da2a5b5c1a9960c3542b63a13fa", "url": "https://github.com/nextcloud/android/commit/c59f9c0b913b5da2a5b5c1a9960c3542b63a13fa", "message": "Formated the code + added header", "committedDate": "2020-02-17T13:45:07Z", "type": "commit"}, {"oid": "467104c4551caab9c768f9dcfcf47dc1dfa6671b", "url": "https://github.com/nextcloud/android/commit/467104c4551caab9c768f9dcfcf47dc1dfa6671b", "message": "Replaced OCFile by File in getFolder() method", "committedDate": "2020-02-17T13:45:14Z", "type": "commit"}, {"oid": "a93313ca19ca97ef03bd3cee4a97314e95192e9a", "url": "https://github.com/nextcloud/android/commit/a93313ca19ca97ef03bd3cee4a97314e95192e9a", "message": "added tests\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-02-17T14:05:14Z", "type": "commit"}, {"oid": "a93313ca19ca97ef03bd3cee4a97314e95192e9a", "url": "https://github.com/nextcloud/android/commit/a93313ca19ca97ef03bd3cee4a97314e95192e9a", "message": "added tests\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-02-17T14:05:14Z", "type": "forcePushed"}]}