{"pr_number": 7481, "pr_title": "Fix edge case when app is restored during backup and storage path does not exist", "pr_createdAt": "2020-11-25T07:02:41Z", "pr_url": "https://github.com/nextcloud/android/pull/7481", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTYxMg==", "url": "https://github.com/nextcloud/android/pull/7481#discussion_r530155612", "bodyText": "do we need some negative button tinting here (needs to be done after show() else negativeButton will return as null)?", "author": "AndyScherzinger", "createdAt": "2020-11-25T07:26:20Z", "path": "src/main/java/com/owncloud/android/ui/activity/FileDisplayActivity.java", "diffHunk": "@@ -272,14 +274,38 @@ protected void onCreate(Bundle savedInstanceState) {\n         if (taskRetainerFragment == null) {\n             taskRetainerFragment = new TaskRetainerFragment();\n             fm.beginTransaction()\n-                    .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n+                .add(taskRetainerFragment, TaskRetainerFragment.FTAG_TASK_RETAINER_FRAGMENT).commit();\n         }   // else, Fragment already created and retained across configuration change\n \n         if (Intent.ACTION_VIEW.equals(getIntent().getAction())) {\n             handleOpenFileViaIntent(getIntent());\n         }\n \n         mPlayerConnection = new PlayerServiceConnection(this);\n+\n+        checkStoragePath();\n+    }\n+\n+    private void checkStoragePath() {\n+        String newStorage = Environment.getExternalStorageDirectory().getAbsolutePath();\n+        String storagePath = preferences.getStoragePath(newStorage);\n+        if (!preferences.isStoragePathValid() && !new File(storagePath).exists()) {\n+            // falling back to default\n+            preferences.setStoragePath(newStorage);\n+            preferences.setStoragePathValid();\n+            MainApp.setStoragePath(newStorage);\n+\n+            try {\n+                new AlertDialog.Builder(this, R.style.Theme_ownCloud_Dialog)\n+                    .setTitle(R.string.wrong_storage_path)\n+                    .setMessage(R.string.wrong_storage_path_desc)\n+                    .setNegativeButton(R.string.dialog_close, (dialog, which) -> dialog.dismiss())\n+                    .setIcon(R.drawable.ic_settings)\n+                    .show();", "originalCommit": "85ba950ea1af4d2816120b711ad5350fa014483c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzNzQxNTE4Mw==", "url": "https://github.com/nextcloud/android/pull/7481#discussion_r537415183", "bodyText": "DONE: 9ffe679", "author": "AndyScherzinger", "createdAt": "2020-12-07T10:59:55Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMDE1NTYxMg=="}], "type": "inlineReview"}, {"oid": "9ffe67931fa2e6084096249992afec79ba6836cb", "url": "https://github.com/nextcloud/android/commit/9ffe67931fa2e6084096249992afec79ba6836cb", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-12-07T10:59:24Z", "type": "forcePushed"}, {"oid": "975841735b4d2c5e46d92d48f2923a36bce2ffaa", "url": "https://github.com/nextcloud/android/commit/975841735b4d2c5e46d92d48f2923a36bce2ffaa", "message": "Fix edge case when app is restored during backup and storage path does not exist\nFix #4151\n\nSigned-off-by: tobiasKaminsky <tobias@kaminsky.me>", "committedDate": "2020-12-07T14:17:39Z", "type": "commit"}, {"oid": "1d35868f514f14605831b7dee824c5cf3960a5fe", "url": "https://github.com/nextcloud/android/commit/1d35868f514f14605831b7dee824c5cf3960a5fe", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-12-07T14:17:50Z", "type": "commit"}, {"oid": "1d35868f514f14605831b7dee824c5cf3960a5fe", "url": "https://github.com/nextcloud/android/commit/1d35868f514f14605831b7dee824c5cf3960a5fe", "message": "add button tinting\n\nSigned-off-by: Andy Scherzinger <info@andy-scherzinger.de>", "committedDate": "2020-12-07T14:17:50Z", "type": "forcePushed"}]}