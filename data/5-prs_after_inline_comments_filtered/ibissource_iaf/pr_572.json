{"pr_number": 572, "pr_title": "XML Query Output Transformer", "pr_createdAt": "2020-04-02T12:56:26Z", "pr_url": "https://github.com/ibissource/iaf/pull/572", "timeline": [{"oid": "a65b71cd901fc035f5afd25aa81984f2d5d92c9f", "url": "https://github.com/ibissource/iaf/commit/a65b71cd901fc035f5afd25aa81984f2d5d92c9f", "message": "Add tests for transofmer.", "committedDate": "2020-04-02T12:52:26Z", "type": "commit"}, {"oid": "494169c4dc5ee184a10b39e0aae524c3d7dd6893", "url": "https://github.com/ibissource/iaf/commit/494169c4dc5ee184a10b39e0aae524c3d7dd6893", "message": "Create xml query output to csv transformer.", "committedDate": "2020-04-02T12:52:48Z", "type": "commit"}, {"oid": "ea566939cbabaece14aed50cea1d12848993ac7a", "url": "https://github.com/ibissource/iaf/commit/ea566939cbabaece14aed50cea1d12848993ac7a", "message": "Debug transformer.", "committedDate": "2020-04-02T13:02:05Z", "type": "commit"}, {"oid": "0283d16d972583b4c7c8c3058c51b64d4a8572a4", "url": "https://github.com/ibissource/iaf/commit/0283d16d972583b4c7c8c3058c51b64d4a8572a4", "message": "Create query output to json transformer.", "committedDate": "2020-04-02T14:07:55Z", "type": "commit"}, {"oid": "0755c70ec388a8f6e98b8b5cec5fe3962740735a", "url": "https://github.com/ibissource/iaf/commit/0755c70ec388a8f6e98b8b5cec5fe3962740735a", "message": "Cleanup and debug query output transformers.", "committedDate": "2020-04-02T14:08:17Z", "type": "commit"}, {"oid": "43823060fe4eeacc745120b5706b28cb9909b505", "url": "https://github.com/ibissource/iaf/commit/43823060fe4eeacc745120b5706b28cb9909b505", "message": "Use new transformers for query output.", "committedDate": "2020-04-02T14:08:58Z", "type": "commit"}, {"oid": "7c6b1c4d20469369fed7887de68f18bd438ecd25", "url": "https://github.com/ibissource/iaf/commit/7c6b1c4d20469369fed7887de68f18bd438ecd25", "message": "Create tests for xml query output transformers.", "committedDate": "2020-04-02T14:09:19Z", "type": "commit"}, {"oid": "fea62a659e992f55ab26569ceae1db082ae39e3b", "url": "https://github.com/ibissource/iaf/commit/fea62a659e992f55ab26569ceae1db082ae39e3b", "message": "Add test case for xml query output transformer.", "committedDate": "2020-04-02T14:31:24Z", "type": "commit"}, {"oid": "044f6716d637382bb3efc20a68ddc17582e6b5a7", "url": "https://github.com/ibissource/iaf/commit/044f6716d637382bb3efc20a68ddc17582e6b5a7", "message": "Debug QueryOutputToJson.", "committedDate": "2020-04-02T14:31:40Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4MzM5Mw==", "url": "https://github.com/ibissource/iaf/pull/572#discussion_r402483393", "bodyText": "Could you turn the resultType in an if else case and if none matches do asString?", "author": "nielsm5", "createdAt": "2020-04-02T17:25:08Z", "path": "core/src/main/java/nl/nn/adapterframework/webcontrol/api/ExecuteJdbcQuery.java", "diffHunk": "@@ -130,30 +129,23 @@ public Response execute(LinkedHashMap<String, Object> json) throws ApiException\n \t\t\tqs.setBlobSmartGet(true);\n \t\t\tqs.configure(true);\n \t\t\tqs.open();\n-\t\t\tresult = qs.sendMessage(new Message(query), null).asString();\n+\t\t\tMessage message = qs.sendMessage(new Message(query), null);\n+\t\t\tresult = message.asString();", "originalCommit": "044f6716d637382bb3efc20a68ddc17582e6b5a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjQ4Mzk4Mg==", "url": "https://github.com/ibissource/iaf/pull/572#discussion_r402483982", "bodyText": "We have also made a helper class for this: TestFileUtils.getTestFile(URL)", "author": "nielsm5", "createdAt": "2020-04-02T17:26:04Z", "path": "core/src/test/java/nl/nn/adapterframework/jdbc/transformer/toJson.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package nl.nn.adapterframework.jdbc.transformer;\n+\n+import nl.nn.adapterframework.stream.Message;\n+import org.junit.Assert;\n+import org.junit.Test;\n+import org.junit.runner.RunWith;\n+import org.junit.runners.Parameterized;\n+import org.xml.sax.SAXException;\n+\n+import java.io.File;\n+import java.io.IOException;\n+import java.nio.file.Files;\n+import java.nio.file.Paths;\n+import java.util.ArrayList;\n+import java.util.Collection;\n+import java.util.List;\n+\n+@RunWith(Parameterized.class)\n+public class toJson {\n+\tprivate final static String FOLDER = \"src/test/resources/Jdbc.transformer\";\n+\tprivate File xmlFile, expectedFile;\n+\n+\tpublic toJson(File xmlFile, File expectedFile) {\n+\t\tthis.xmlFile = xmlFile;\n+\t\tthis.expectedFile = expectedFile;\n+\t}\n+\n+\t@Parameterized.Parameters\n+\tpublic static Collection<Object[]> data() {\n+\t\tList<Object[]> files = new ArrayList<>();\n+\t\tint i = 0;\n+\t\tFile xml = new File(FOLDER, i + \".xml\");\n+\t\tFile json = new File(FOLDER, i + \".json\");\n+\t\tSystem.out.println(xml.getAbsolutePath());\n+\t\twhile (xml.exists() && json.exists()) {\n+\t\t\tSystem.out.println(String.format(\"Added [%s] and [%s]\", xml.getName(), json.getName()));\n+\t\t\tfiles.add(new File[] {xml, json});\n+\t\t\ti++;\n+\t\t\txml = new File(FOLDER, i + \".xml\");\n+\t\t\tjson = new File(FOLDER, i + \".json\");\n+\t\t}\n+\n+\t\treturn files;\n+\t}\n+\n+\t@Test\n+\tpublic void doTest() throws IOException, SAXException {\n+\t\tString expected = new String(Files.readAllBytes(Paths.get(expectedFile.getAbsolutePath())));", "originalCommit": "044f6716d637382bb3efc20a68ddc17582e6b5a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMjc1NTA5Ng==", "url": "https://github.com/ibissource/iaf/pull/572#discussion_r402755096", "bodyText": "I suggest you use org.apache.commons.lang.StringEscapeUtils.escapeCSV() here.", "author": "gvanbrakel", "createdAt": "2020-04-03T06:07:45Z", "path": "core/src/main/java/nl/nn/adapterframework/jdbc/transformer/QueryOutputToCSV.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package nl.nn.adapterframework.jdbc.transformer;\n+\n+import org.xml.sax.Attributes;\n+import org.xml.sax.SAXException;\n+import org.xml.sax.XMLReader;\n+\n+public class QueryOutputToCSV extends AbstractQueryOutputTransformer {\n+\tpublic QueryOutputToCSV() throws SAXException {\n+\t\tsuper();\n+\t}\n+\n+\tpublic QueryOutputToCSV(XMLReader parent) {\n+\t\tsuper(parent);\n+\t}\n+\n+\t@Override\n+\tprotected void startRow() {\n+\t\toutput.append(\"\\n\");\n+\t}\n+\n+\t@Override\n+\tprotected void endRow() {\n+\t\t// Delete last comma\n+\t\toutput.deleteCharAt(output.length() - 1);\n+\t}\n+\n+\t@Override\n+\tprotected void addFieldDefinition(Attributes atts) {\n+\t\toutput.append(\"\\\"\").append(atts.getValue(\"name\")).append(\"\\\",\");\n+\t}\n+\n+\t@Override\n+\tprotected void addField(String fieldName, String value) {\n+\t\toutput.append(\"\\\"\").append(value).append(\"\\\",\");", "originalCommit": "044f6716d637382bb3efc20a68ddc17582e6b5a7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "de0f925d170d2cc70b64e5c321da610204885b34", "url": "https://github.com/ibissource/iaf/commit/de0f925d170d2cc70b64e5c321da610204885b34", "message": "Escape characters in their formats.", "committedDate": "2020-04-03T08:47:28Z", "type": "commit"}, {"oid": "ed199d39f3e5c5f8dac1c4171c8d7c70ebc7fee9", "url": "https://github.com/ibissource/iaf/commit/ed199d39f3e5c5f8dac1c4171c8d7c70ebc7fee9", "message": "Change class names.", "committedDate": "2020-04-03T11:37:31Z", "type": "commit"}, {"oid": "3085e8ed97f046988f9482efc60885b21ff3b8de", "url": "https://github.com/ibissource/iaf/commit/3085e8ed97f046988f9482efc60885b21ff3b8de", "message": "Create XMLFilter implementation to transform to map.", "committedDate": "2020-04-03T11:38:39Z", "type": "commit"}, {"oid": "4dea45a077e298f97ec2f349c807737971e4ab47", "url": "https://github.com/ibissource/iaf/commit/4dea45a077e298f97ec2f349c807737971e4ab47", "message": "Small changes and improvements to transformers.", "committedDate": "2020-04-03T11:49:12Z", "type": "commit"}, {"oid": "7835548d0da5c81cf98cb23557c2b348398a8d8d", "url": "https://github.com/ibissource/iaf/commit/7835548d0da5c81cf98cb23557c2b348398a8d8d", "message": "Adapt tests.", "committedDate": "2020-04-03T11:49:30Z", "type": "commit"}, {"oid": "206c9d3ca3ee539b51abfd1948ea5101afa72d5b", "url": "https://github.com/ibissource/iaf/commit/206c9d3ca3ee539b51abfd1948ea5101afa72d5b", "message": "Add tests for toMap transofmer.", "committedDate": "2020-04-03T11:59:06Z", "type": "commit"}, {"oid": "c77a3860a81ecaadbc410c682dda3e74663d5a43", "url": "https://github.com/ibissource/iaf/commit/c77a3860a81ecaadbc410c682dda3e74663d5a43", "message": "Remove unused function.", "committedDate": "2020-04-03T12:04:44Z", "type": "commit"}, {"oid": "fa8de7bfc9aa7881a9f2a786833b3dbc1886a1e7", "url": "https://github.com/ibissource/iaf/commit/fa8de7bfc9aa7881a9f2a786833b3dbc1886a1e7", "message": "Add try/catch to throw ApiException.", "committedDate": "2020-04-03T12:17:35Z", "type": "commit"}]}