{"pr_number": 1339, "pr_title": "Imp #1215 soap wrapper using message", "pr_createdAt": "2020-12-15T07:34:59Z", "pr_url": "https://github.com/ibissource/iaf/pull/1339", "timeline": [{"oid": "074f47945d126d51d5a59003d643d9fdbfd94a1f", "url": "https://github.com/ibissource/iaf/commit/074f47945d126d51d5a59003d643d9fdbfd94a1f", "message": "Use Message for SoapWrapper unwrap", "committedDate": "2020-12-14T15:09:43Z", "type": "commit"}, {"oid": "bacc60ebebcdb8097d55e71cddb40e6dbc506c95", "url": "https://github.com/ibissource/iaf/commit/bacc60ebebcdb8097d55e71cddb40e6dbc506c95", "message": "SenderPipe fixes", "committedDate": "2020-12-14T22:01:52Z", "type": "commit"}, {"oid": "2b8100db4d2afc84955b041d045c881020e285f8", "url": "https://github.com/ibissource/iaf/commit/2b8100db4d2afc84955b041d045c881020e285f8", "message": "SoapWrapper using Message for direction wrap", "committedDate": "2020-12-15T07:25:03Z", "type": "commit"}, {"oid": "b735bcf66cd3850632520319992ba76f0127ab77", "url": "https://github.com/ibissource/iaf/commit/b735bcf66cd3850632520319992ba76f0127ab77", "message": "more updates", "committedDate": "2020-12-15T07:34:24Z", "type": "commit"}, {"oid": "81237fa8316f081c5cd95f83f39e9b2e2da2c8e9", "url": "https://github.com/ibissource/iaf/commit/81237fa8316f081c5cd95f83f39e9b2e2da2c8e9", "message": "Fix issues", "committedDate": "2020-12-15T07:50:24Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyMTA2MQ==", "url": "https://github.com/ibissource/iaf/pull/1339#discussion_r543221061", "bodyText": "Gaat dit wel goed? getResponseBody kan een java.io.IOException: Stream closed exceptie gooien bij het lezen van een foutive response.\nIn getResponseBodyAsString zit hiervoor een try/catch die silent null terug geeft. Nu krijg je een exceptie in een exceptie", "author": "nielsm5", "createdAt": "2020-12-15T10:23:00Z", "path": "core/src/main/java/nl/nn/adapterframework/http/WebServiceSender.java", "diffHunk": "@@ -132,19 +132,20 @@ protected HttpRequestBase getMethod(URI uri, Message message, ParameterValueList\n \t\t}\n \t\tif (log.isDebugEnabled()) log.debug(getLogPrefix()+\"SOAPMSG [\" + soapmsg + \"]\");\n \n-\t\tHttpRequestBase method = super.getMethod(uri, new Message(soapmsg), parameters, session);\n+\t\tHttpRequestBase method = super.getMethod(uri, soapmsg, parameters, session);\n \t\tlog.debug(getLogPrefix()+\"setting SOAPAction header [\"+soapActionURI+\"]\");\n \t\tmethod.setHeader(\"SOAPAction\", soapActionURI);\n \t\treturn method;\n \t}\n \n \t@Override\n \tprotected Message extractResult(HttpResponseHandler responseHandler, IPipeLineSession session) throws SenderException, IOException {\n-\t\tString httpResult = null;\n+\t\tMessage httpResult = null;\n \t\ttry {\n-\t\t\thttpResult = super.extractResult(responseHandler, session).asString();\n+\t\t\thttpResult = super.extractResult(responseHandler, session);\n+\t\t\thttpResult.preserve();\n \t\t} catch (SenderException e) {\n-\t\t\tsoapWrapper.checkForSoapFault(getResponseBodyAsString(responseHandler), e);\n+\t\t\tsoapWrapper.checkForSoapFault(getResponseBody(responseHandler), e);", "originalCommit": "81237fa8316f081c5cd95f83f39e9b2e2da2c8e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzIyMjY3OQ==", "url": "https://github.com/ibissource/iaf/pull/1339#discussion_r543222679", "bodyText": "de responseBody moet hier persistent zijn, anders gaan hier fouten ontstaan. Misschien is het handig de tests aan te passen, aangezien dit niet getest wordt!", "author": "nielsm5", "createdAt": "2020-12-15T10:25:10Z", "path": "core/src/main/java/nl/nn/adapterframework/soap/SoapWrapper.java", "diffHunk": "@@ -101,7 +97,7 @@ public static SoapWrapper getInstance() throws ConfigurationException {\n \t\treturn self;\n \t}\n \n-\tpublic void checkForSoapFault(String responseBody, Throwable nested) throws SenderException {\n+\tpublic void checkForSoapFault(Message responseBody, Throwable nested) throws SenderException {\n \t\tString faultString = null;", "originalCommit": "81237fa8316f081c5cd95f83f39e9b2e2da2c8e9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3b92cc91d371d38321076f269ef22ec108ff2f8e", "url": "https://github.com/ibissource/iaf/commit/3b92cc91d371d38321076f269ef22ec108ff2f8e", "message": "Fix problems", "committedDate": "2020-12-15T14:09:22Z", "type": "commit"}, {"oid": "4841815a015201f057a2c7c1dda876043fded905", "url": "https://github.com/ibissource/iaf/commit/4841815a015201f057a2c7c1dda876043fded905", "message": "Fix cmis module", "committedDate": "2020-12-15T15:30:16Z", "type": "commit"}, {"oid": "7112cd7fbf325361f574523752214881eae1f0b1", "url": "https://github.com/ibissource/iaf/commit/7112cd7fbf325361f574523752214881eae1f0b1", "message": "Fix WSS SoapFault exception", "committedDate": "2020-12-15T15:37:19Z", "type": "commit"}, {"oid": "9cb8b35a67cd4aaacc7ecacce5df8deb80d29599", "url": "https://github.com/ibissource/iaf/commit/9cb8b35a67cd4aaacc7ecacce5df8deb80d29599", "message": "Fix NPE", "committedDate": "2020-12-15T15:39:28Z", "type": "commit"}, {"oid": "92700d23fd1f53efdcd18ef2c3e10b9c719ea0e0", "url": "https://github.com/ibissource/iaf/commit/92700d23fd1f53efdcd18ef2c3e10b9c719ea0e0", "message": "Remove getResponseBodyAsString", "committedDate": "2020-12-15T16:58:40Z", "type": "commit"}]}