{"pr_number": 1581, "pr_title": "Fixed a bug in MergeBamAlignment", "pr_createdAt": "2020-09-23T21:30:42Z", "pr_url": "https://github.com/broadinstitute/picard/pull/1581", "timeline": [{"oid": "ed3b1981827a31e9b929dcdaae4b6da7d1f7b372", "url": "https://github.com/broadinstitute/picard/commit/ed3b1981827a31e9b929dcdaae4b6da7d1f7b372", "message": "Fixed yet another bug in MergeBamAlignment: when there's a deletion in the base just beyond the 5' end of the mate, the code for clipping overhanging reads got confused and didn't clip anything. This commit fixes that.\n\nAdded tests that specifically cover this case.", "committedDate": "2020-09-23T21:28:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MzkwOTcxNg==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r493909716", "bodyText": "this is to protect from a stupidly aligned read that has a deletion at the end somehow, so there are no bases following that base.", "author": "yfarjoun", "createdAt": "2020-09-23T21:37:10Z", "path": "src/main/java/picard/sam/AbstractAlignmentMerger.java", "diffHunk": "@@ -861,10 +860,21 @@ static int getReadPositionAtReferencePositionIgnoreSoftClips(final SAMRecord rec\n         rec.setCigar(newCigar);\n         // Since the read effectively got shifted forward by turning the clips into matches, the query position needs\n         // also to be moved forward bye posShift so that it's still querying the same base.\n-        readPosition = SAMRecord.getReadPositionAtReferencePosition(rec, pos + posShift, false);\n+        final int readPosition = SAMRecord.getReadPositionAtReferencePosition(rec, pos + posShift, true);\n+\n         rec.setCigar(oldCigar);\n \n-        return readPosition;\n+        // if this returns zero, it means that there's a deletion at the position of the desired base,\n+        // if the read is on the positive strand readPosition should be incremented by one to get the\n+        // base __following__ the deletion rather than the one preceding it (which is what returnLastBaseIfDeleted argument in\n+        // getReadPositionAtReferencePosition will do)\n+        final int readPositionZeroOnDeletion = SAMRecord.getReadPositionAtReferencePosition(rec, pos + posShift, false);\n+        final boolean increamentReadPosition = readPositionZeroOnDeletion == 0 &&\n+                !rec.getReadNegativeStrandFlag() &&\n+                readPosition < rec.getReadLength() - 1;", "originalCommit": "ed3b1981827a31e9b929dcdaae4b6da7d1f7b372", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "cba7e24ba46eed6e57c6aef082910b887bb30356", "url": "https://github.com/broadinstitute/picard/commit/cba7e24ba46eed6e57c6aef082910b887bb30356", "message": "- fix last minute bug\n- many more tests", "committedDate": "2020-09-24T16:22:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU1Mzc3MA==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494553770", "bodyText": "These are super helpful figures.\nThe \"-\" at the end of MMMMMMMMMMMMMMMMMMsssssssss-> should be removed because it looks like a deletion, and for the reverse reads you use \"<\".\nThis occurs in a few other places.", "author": "fleharty", "createdAt": "2020-09-24T19:15:42Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU3MjEwNg==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494572106", "bodyText": "I suggest adding another test:\n// 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n//                  MMMMMMMMMMMMMMMMMMsssssssss->\n//     <ssssssssMMM--MMMMMMMMMMMMMMMM\n//          should become\n// 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n//                  MMMMMMMMMMMMMMMMMSsssssssss->\n//       <ssssssssSSSMMMMMMMMMMMMMMMM\n            {27, 18, 14, \"18M9S\", \"8S3M2D16M\", false, true, 18, 19, \"17M10S\", \"11S1D16M\", false,\n                    default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n                    default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities, null, null},", "author": "fleharty", "createdAt": "2020-09-24T19:50:54Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MzcyMQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494593721", "bodyText": "could you also add a similar test with an insertion that spans the region to be clipped?", "author": "fleharty", "createdAt": "2020-09-24T20:32:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU3MjEwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxMTIyMw==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494611223", "bodyText": "you mean a deletion? I'm not sure how to interpret this in the case of an insertion....", "author": "yfarjoun", "createdAt": "2020-09-24T21:07:54Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU3MjEwNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDYxMzYwMQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494613601", "bodyText": "I added the two-deletion test in line 290", "author": "yfarjoun", "createdAt": "2020-09-24T21:12:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU3MjEwNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4NDA1MQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494584051", "bodyText": "MMMMMMMMMMMMMMMMMssssssssss>\nshould be:\nMMMMMMMMMMMMMMMMMSsssssssss>", "author": "fleharty", "createdAt": "2020-09-24T20:14:13Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4ODMxNg==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494588316", "bodyText": "The cigar for the second read is 16M2I2M7S so there should be two \"i\"s in the second read.", "author": "fleharty", "createdAt": "2020-09-24T20:22:29Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>\n+                //                          <sssssSSSSSMMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 15, \"18M9S\", \"5S2M2I18M\", false, true, 18, 18, \"17M10S\", \"10S17M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiiMsssssss>\n+                //                                         /\\\n+                //         with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"17M2I1M7S\", true, false, 18, 18,\"11S16M\",\"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiiMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"16M2I2M7S\", true, false, 18, 18, \"11S16M\", \"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities, default27LongR1Qualities, default27LongR2Qualities, null, null},\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiMMMsssssss>", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU4OTMwMA==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494589300", "bodyText": "<ssssssSSSSSMMMMMMMMMMMMMMMM\nshould be\n<sssssssSSSSMMMMMMMMMMMMMMMM", "author": "fleharty", "createdAt": "2020-09-24T20:24:31Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>\n+                //                          <sssssSSSSSMMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 15, \"18M9S\", \"5S2M2I18M\", false, true, 18, 18, \"17M10S\", \"10S17M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiiMsssssss>\n+                //                                         /\\\n+                //         with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"17M2I1M7S\", true, false, 18, 18,\"11S16M\",\"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiiMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"16M2I2M7S\", true, false, 18, 18, \"11S16M\", \"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities, default27LongR1Qualities, default27LongR2Qualities, null, null},\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiMMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of one bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"16M1I3M7S\", true, false, 18, 18, \"11S16M\", \"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities, default27LongR1Qualities, default27LongR2Qualities, null, null},\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiMMsssssss>\n+                //                                         /\\\n+                //         with an insertion of one bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MDU1NQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494590555", "bodyText": "123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\nshould be\n123456789.123456789.123456789.1234-56789.123456789.123456789.123456789.123456789", "author": "fleharty", "createdAt": "2020-09-24T20:27:01Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>\n+                //                          <sssssSSSSSMMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 15, \"18M9S\", \"5S2M2I18M\", false, true, 18, 18, \"17M10S\", \"10S17M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiiMsssssss>\n+                //                                         /\\\n+                //         with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"17M2I1M7S\", true, false, 18, 18,\"11S16M\",\"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiiMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"16M2I2M7S\", true, false, 18, 18, \"11S16M\", \"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities, default27LongR1Qualities, default27LongR2Qualities, null, null},\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiMMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of one bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"16M1I3M7S\", true, false, 18, 18, \"11S16M\", \"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities, default27LongR1Qualities, default27LongR2Qualities, null, null},\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MTAxNA==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494591014", "bodyText": "123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\nshould be\n123456789.123456789.123456789.1234-56789.123456789.123456789.123456789.123456789", "author": "fleharty", "createdAt": "2020-09-24T20:27:51Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>\n+                //                          <sssssSSSSSMMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 15, \"18M9S\", \"5S2M2I18M\", false, true, 18, 18, \"17M10S\", \"10S17M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiiMsssssss>\n+                //                                         /\\\n+                //         with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"17M2I1M7S\", true, false, 18, 18,\"11S16M\",\"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiiMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"16M2I2M7S\", true, false, 18, 18, \"11S16M\", \"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities, default27LongR1Qualities, default27LongR2Qualities, null, null},\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MTc3OQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494591779", "bodyText": "//            <ssssssSSSSSMMMMMMMMMMMMMMMM\n\nshould be\n//            <sssssssSSSSMMMMMMMMMMMMMMMM", "author": "fleharty", "createdAt": "2020-09-24T20:29:18Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>\n+                //                          <sssssSSSSSMMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 15, \"18M9S\", \"5S2M2I18M\", false, true, 18, 18, \"17M10S\", \"10S17M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiiMsssssss>\n+                //                                         /\\\n+                //         with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMSSSSsssssss>\n+\n+\n+                {27, 14, 18, \"7S20M\", \"17M2I1M7S\", true, false, 18, 18,\"11S16M\",\"16M11S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMiiMMsssssss>\n+                //                                        /\\\n+                //        with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NDU5MjI1OQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r494592259", "bodyText": "//            <ssssssSSSSSMMMMMMMMMMMMMMMM\n\nshould be\n//            <sssssssSSSSMMMMMMMMMMMMMMMM", "author": "fleharty", "createdAt": "2020-09-24T20:30:14Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -199,6 +200,136 @@\n                 {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss->\n+                //   <ssssssssMMM---MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss->\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 12, \"18M9S\", \"8S3M3D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM-MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M1D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssMMMMMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMM---MMMsssssssss>\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //     <ssssssssSSSSMMMMMMMMMMMMMMM\n+                //                  MMMMMMMMMMMMMMMSSSsssssssss>\n+\n+\n+                {27, 14, 18, \"8S19M\", \"15M3D3M9S\", true, false, 18, 18, \"12S15M\", \"15M12S\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+\n+                //                  123456789.123456--789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMMsssssssss>\n+                //                          <sssssMMiiMMMMMMMMMMMMMMMMMM\n+                //                                  /\\\n+                //   with an insertion of two bases here should become\n+                //                    123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                                     MMMMMMMMMMMMMMMMMssssssssss>\n+                //                          <sssssSSSSSMMMMMMMMMMMMMMMMM\n+\n+\n+                {27, 18, 15, \"18M9S\", \"5S2M2I18M\", false, true, 18, 18, \"17M10S\", \"10S17M\", false,\n+                        default27LongR1Bases, default27LongR2Bases, default27LongR1Bases, default27LongR2Bases, null, null,\n+                        default27LongR1Qualities, default27LongR2Qualities,default27LongR1Qualities, default27LongR2Qualities , null,null },\n+\n+\n+                //       123456789.123456789.123456789.1234--56789.123456789.123456789.123456789.123456789\n+                //            <sssssssMMMMMMMMMMMMMMMMMMMM\n+                //                        MMMMMMMMMMMMMMMMMiiMsssssss>\n+                //                                         /\\\n+                //         with an insertion of two bases here should become\n+                //       123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //            <ssssssSSSSSMMMMMMMMMMMMMMMM", "originalCommit": "cba7e24ba46eed6e57c6aef082910b887bb30356", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "ba1cf02743400a78571e4d24d20ce20ca4789d3e", "url": "https://github.com/broadinstitute/picard/commit/ba1cf02743400a78571e4d24d20ce20ca4789d3e", "message": "- clarify some comments\n- more tests!", "committedDate": "2020-09-24T20:59:35Z", "type": "commit"}, {"oid": "5fac6395c6cf8ffa2f8d06c3b0cc3f6253f194f4", "url": "https://github.com/broadinstitute/picard/commit/5fac6395c6cf8ffa2f8d06c3b0cc3f6253f194f4", "message": "-comment fixups", "committedDate": "2020-09-24T21:09:12Z", "type": "commit"}, {"oid": "ac9d9d976473be423d9b7ca022a7ae9bde179f93", "url": "https://github.com/broadinstitute/picard/commit/ac9d9d976473be423d9b7ca022a7ae9bde179f93", "message": "optimize imports", "committedDate": "2020-09-24T21:11:44Z", "type": "commit"}, {"oid": "091ae8c06009ffd903932bbade53ba6bc0e25959", "url": "https://github.com/broadinstitute/picard/commit/091ae8c06009ffd903932bbade53ba6bc0e25959", "message": "- fixup comments", "committedDate": "2020-09-24T21:15:14Z", "type": "commit"}, {"oid": "0173e89a693e5412a35ba9eafcaa915d07822aae", "url": "https://github.com/broadinstitute/picard/commit/0173e89a693e5412a35ba9eafcaa915d07822aae", "message": "- refactored test", "committedDate": "2020-09-25T19:31:19Z", "type": "commit"}, {"oid": "e43f3f760fb0717616025279726504af64b9fd0d", "url": "https://github.com/broadinstitute/picard/commit/e43f3f760fb0717616025279726504af64b9fd0d", "message": "- removed comment", "committedDate": "2020-09-25T19:57:13Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIzMzE3NQ==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r496233175", "bodyText": "Could you add tests for the hardclipping case for these examples involving insertions and deletions as well?  Based on following the code and a simple test I tried out it seems to give an answer that I would considered \"correct\", but it gets there in a pretty unsafe round-about sort of way.  I suspect if it's not well tested the harclipping behavior in these cases could easily be unintentionally and unknowingly changed as a side effect of some future pr.", "author": "kachulis", "createdAt": "2020-09-28T21:07:42Z", "path": "src/test/java/picard/sam/AbstractAlignmentMergerTest.java", "diffHunk": "@@ -192,24 +228,198 @@\n \n                  */\n \n-                {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M18S\", \"22S88M\", false,\n+                {110, false, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M18S\", \"22S88M\",\n                         default110LongR1Bases, default110LongR2Bases, default110LongR1Bases, default110LongR2Bases, null, null,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, default110LongR1BaseQualities, default110LongR2BaseQualities, null, null},\n \n-                {110, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\", true,\n+                {110, true, 105, 96, \"12S80M18S\", \"13S97M\", false, true, 105, 105, \"12S80M8S10H\", \"10H12S88M\",\n                         default110LongR1Bases, default110LongR2Bases, sharedBases, sharedBases, default110LongR1ClippedBases, default110LongR2ClippedBases,\n                         default110LongR1BaseQualities, default110LongR2BaseQualities, sharedQualities, sharedQualities, r1ClippedQualities10, r2ClippedQualities10},\n+\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMMMsssssssss>\n+                //     <ssssssssMMM-MMMMMMMMMMMMMMMM\n+                //          should become\n+                // 123456789.123456789.123456789.123456789.123456789.123456789.123456789.123456789\n+                //                  MMMMMMMMMMMMMMMMSSsssssssss>\n+                //      <ssssssssSSSMMMMMMMMMMMMMMMM\n+\n+\n+                {27, false, 18, 14, \"18M9S\", \"8S3M1D16M\", false, true, 18, 18, \"16M11S\", \"11S16M\",", "originalCommit": "e43f3f760fb0717616025279726504af64b9fd0d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5Njk2MDEwMw==", "url": "https://github.com/broadinstitute/picard/pull/1581#discussion_r496960103", "bodyText": "added.", "author": "yfarjoun", "createdAt": "2020-09-29T18:44:40Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5NjIzMzE3NQ=="}], "type": "inlineReview"}, {"oid": "a61000a5b0ab4bc6aea3aaf2c957d6094cac80fa", "url": "https://github.com/broadinstitute/picard/commit/a61000a5b0ab4bc6aea3aaf2c957d6094cac80fa", "message": "- added MOAR tests", "committedDate": "2020-09-29T18:43:01Z", "type": "commit"}, {"oid": "c355bd227a7941a82a5ccdc31c3d8a3bc8b5e74e", "url": "https://github.com/broadinstitute/picard/commit/c355bd227a7941a82a5ccdc31c3d8a3bc8b5e74e", "message": "Merge branch 'master' into yf_add_MBA_test", "committedDate": "2020-09-29T20:56:46Z", "type": "commit"}]}