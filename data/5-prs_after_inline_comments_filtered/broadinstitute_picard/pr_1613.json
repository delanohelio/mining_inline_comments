{"pr_number": 1613, "pr_title": "Fast fail if R is not installed in tools that use R", "pr_createdAt": "2020-11-25T21:48:16Z", "pr_url": "https://github.com/broadinstitute/picard/pull/1613", "timeline": [{"oid": "e3c00722d23207c5c91cf6dabb509445ef2ad451", "url": "https://github.com/broadinstitute/picard/commit/e3c00722d23207c5c91cf6dabb509445ef2ad451", "message": "Check if R is installed if a tool outputs a chart", "committedDate": "2020-11-25T21:24:05Z", "type": "commit"}, {"oid": "5b16648a9ba443b136449f6e2bd1a7c2df978d88", "url": "https://github.com/broadinstitute/picard/commit/5b16648a9ba443b136449f6e2bd1a7c2df978d88", "message": "Merge branch 'master' into sc_gl-1290_check_R_installed", "committedDate": "2020-11-25T21:53:32Z", "type": "commit"}, {"oid": "230cbe0376fff4c947feeeb8350b29f334bb1f3a", "url": "https://github.com/broadinstitute/picard/commit/230cbe0376fff4c947feeeb8350b29f334bb1f3a", "message": "Create a simple R script to check R is installed", "committedDate": "2020-11-30T19:59:19Z", "type": "commit"}, {"oid": "405abceb7b7d60e9b5c3b72902b043601aa42fdd", "url": "https://github.com/broadinstitute/picard/commit/405abceb7b7d60e9b5c3b72902b043601aa42fdd", "message": "Merge remote-tracking branch 'origin/sc_gl-1290_check_R_installed' into sc_gl-1290_check_R_installed", "committedDate": "2020-11-30T19:59:51Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDU0Nw==", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533704547", "bodyText": "Why is this true?", "author": "khajoue2", "createdAt": "2020-12-01T20:35:25Z", "path": "src/main/java/picard/analysis/CollectMultipleMetrics.java", "diffHunk": "@@ -669,6 +669,8 @@ public String getHelpDoc() {\n         }\n         programsToRun = new LinkedHashSet<>(PROGRAM);\n \n+        checkRInstallation(true);", "originalCommit": "405abceb7b7d60e9b5c3b72902b043601aa42fdd", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzc3NTg3NQ==", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533775875", "bodyText": "Almost all of the metrics within CollectMultipleMetrics are given a CHART_OUTPUT/Histogram_FILE which means the rscript will be run. CollectMultipleMetrics itself doesn't have those as an argument. Since those metrics will run the rscript anyways, I just put true.", "author": "sophiacrennan", "createdAt": "2020-12-01T22:52:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNDU0Nw=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcwNzc2MA==", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533707760", "bodyText": "space between if and (", "author": "gbggrant", "createdAt": "2020-12-01T20:41:23Z", "path": "src/main/java/picard/cmdline/CommandLineProgram.java", "diffHunk": "@@ -497,4 +498,18 @@ public static boolean hasWebDocumentation(final Class<?> clazz){\n     public static String getFaqLink() {\n         return \"To get help, see http://broadinstitute.github.io/picard/index.html#GettingHelp\";\n     }\n+\n+    /**\n+     * Check if R is installed\n+     * @param has_chart_output\n+     */\n+    public static void checkRInstallation(final boolean has_chart_output) {\n+        if(has_chart_output) {", "originalCommit": "405abceb7b7d60e9b5c3b72902b043601aa42fdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzMzcxMjE5Mw==", "url": "https://github.com/broadinstitute/picard/pull/1613#discussion_r533712193", "bodyText": "Rather than throwing an exception here, could you return the error string (or just a true / false) from this class if R is not installed?\nAnd then in the calling program's CustomCommandLineValidator code you could just check if checkRInstallation failed and return a string array like:\n         if (!checkRInstallation(CHART_OUTPUT != null)) { return new String[]{\"R is not installed on this machine. It is required for creating the chart.\"}; }\nThis is more in line with how CustomCommandLine validation should work.\nI think the usage in CollectInsertSizeMetrics.java is more correct than that in CollectRnaSeqMetrics.java", "author": "gbggrant", "createdAt": "2020-12-01T20:49:30Z", "path": "src/main/java/picard/cmdline/CommandLineProgram.java", "diffHunk": "@@ -497,4 +498,18 @@ public static boolean hasWebDocumentation(final Class<?> clazz){\n     public static String getFaqLink() {\n         return \"To get help, see http://broadinstitute.github.io/picard/index.html#GettingHelp\";\n     }\n+\n+    /**\n+     * Check if R is installed\n+     * @param has_chart_output\n+     */\n+    public static void checkRInstallation(final boolean has_chart_output) {\n+        if(has_chart_output) {\n+            try {\n+                RExecutor.executeFromClasspath(\"picard/analysis/checkRInstallation.R\");\n+            } catch (htsjdk.samtools.SAMException e) {\n+                throw new PicardException(\"R is not installed on this machine. It is required for creating the chart.\");", "originalCommit": "405abceb7b7d60e9b5c3b72902b043601aa42fdd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0c8cd2626ea47eb65d656b4621f1d3f3289e6769", "url": "https://github.com/broadinstitute/picard/commit/0c8cd2626ea47eb65d656b4621f1d3f3289e6769", "message": "instead of throwing an exception, return an error string", "committedDate": "2020-12-01T22:32:56Z", "type": "commit"}, {"oid": "3578fc05b4e079bcf2e34ecc6f42e75b57bcddbb", "url": "https://github.com/broadinstitute/picard/commit/3578fc05b4e079bcf2e34ecc6f42e75b57bcddbb", "message": "fix a few if statements", "committedDate": "2020-12-01T22:42:15Z", "type": "commit"}, {"oid": "46342e997326247ad6b91f88a41e0af459a4551e", "url": "https://github.com/broadinstitute/picard/commit/46342e997326247ad6b91f88a41e0af459a4551e", "message": "Merge branch 'master' into sc_gl-1290_check_R_installed", "committedDate": "2020-12-02T15:05:02Z", "type": "commit"}]}