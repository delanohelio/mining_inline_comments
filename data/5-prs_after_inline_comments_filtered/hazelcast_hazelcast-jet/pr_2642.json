{"pr_number": 2642, "pr_title": "Require OR REPLACE for CREATE SNAPSHOT", "pr_createdAt": "2020-11-05T15:04:53Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2642", "timeline": [{"oid": "83b0413da238abc887ecf755b31225efdd1b400e", "url": "https://github.com/hazelcast/hazelcast-jet/commit/83b0413da238abc887ecf755b31225efdd1b400e", "message": "Require OR REPLACE for CREATE SNAPSHOT", "committedDate": "2020-11-05T15:04:07Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMDgxNg==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2642#discussion_r518130816", "bodyText": "Throw SqlValidatorException (see ParserResource)?", "author": "gierlachg", "createdAt": "2020-11-05T15:19:07Z", "path": "hazelcast-jet-sql/src/main/java/com/hazelcast/jet/sql/impl/parse/SqlCreateSnapshot.java", "diffHunk": "@@ -45,10 +46,15 @@\n     public SqlCreateSnapshot(\n             SqlIdentifier snapshotName,\n             SqlIdentifier jobName,\n+            boolean replace,\n             SqlParserPos pos\n     ) {\n         super(OPERATOR, pos, true, false);\n \n+        if (!replace) {\n+            throw QueryException.error(\"The OR REPLACE option is required for CREATE SNAPSHOT\");", "originalCommit": "83b0413da238abc887ecf755b31225efdd1b400e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU4NTM0Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2642#discussion_r518585346", "bodyText": "I don't like the indirection much, I don't see a benefit to it. It technically isn't a validator exception, but parsing exc: the parser fails to create a SqlNode.\nWe do this style already, for example here: \n  \n    \n      hazelcast-jet/hazelcast-jet-sql/src/main/java/com/hazelcast/jet/sql/impl/parse/SqlCreateJob.java\n    \n    \n         Line 117\n      in\n      4ec1e18\n    \n    \n    \n    \n\n        \n          \n           throw QueryException.error(\"Unknown job option: \" + key); \n        \n    \n  \n\n\nThe user will receive HazelcastSqlException with code=PARSING anyway.", "author": "viliam-durina", "createdAt": "2020-11-06T08:12:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMDgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODU4NzM0Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2642#discussion_r518587346", "bodyText": "Exactly, if it's a parsing one maybe we should throw a parsing exception, giving user position etc., QueryException does not seem to be fitted to that.", "author": "gierlachg", "createdAt": "2020-11-06T08:17:00Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMDgxNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODc2MTgzMw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2642#discussion_r518761833", "bodyText": "Got it, fixed. But the exception marks the whole command...", "author": "viliam-durina", "createdAt": "2020-11-06T13:48:35Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUxODEzMDgxNg=="}], "type": "inlineReview"}, {"oid": "810d2829b39c8813dca6c4ee6b90cdadc92beff1", "url": "https://github.com/hazelcast/hazelcast-jet/commit/810d2829b39c8813dca6c4ee6b90cdadc92beff1", "message": "Fix unrelated typo", "committedDate": "2020-11-05T15:25:10Z", "type": "commit"}, {"oid": "bb9223a82c0926879dea05999a1bedab4d2b6571", "url": "https://github.com/hazelcast/hazelcast-jet/commit/bb9223a82c0926879dea05999a1bedab4d2b6571", "message": "Use SqlValidationException", "committedDate": "2020-11-06T13:47:29Z", "type": "commit"}, {"oid": "46f90deb491cf968f712fa8625b0b6efb2f88d1c", "url": "https://github.com/hazelcast/hazelcast-jet/commit/46f90deb491cf968f712fa8625b0b6efb2f88d1c", "message": "Use SqlValidatorException everywhere", "committedDate": "2020-11-06T15:09:53Z", "type": "commit"}, {"oid": "0d03c6f015f4b5402411f8fd5f6a50fc0e9a87b0", "url": "https://github.com/hazelcast/hazelcast-jet/commit/0d03c6f015f4b5402411f8fd5f6a50fc0e9a87b0", "message": "Fix unparse", "committedDate": "2020-11-06T15:24:30Z", "type": "commit"}, {"oid": "6b6a6ab61525b39c33d3f1e718b82094dd1318ca", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6b6a6ab61525b39c33d3f1e718b82094dd1318ca", "message": "Merge remote-tracking branch 'remotes/hazelcast/master' into sql-snapshot-replace", "committedDate": "2020-11-06T15:37:23Z", "type": "commit"}, {"oid": "1634f2bf4a40b4bea7488990cd65c7640ac6e3bc", "url": "https://github.com/hazelcast/hazelcast-jet/commit/1634f2bf4a40b4bea7488990cd65c7640ac6e3bc", "message": "Fix compilation", "committedDate": "2020-11-06T16:06:44Z", "type": "commit"}]}