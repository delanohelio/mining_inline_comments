{"pr_number": 2247, "pr_title": "[005] - Productionize Postgres CDC source", "pr_createdAt": "2020-05-11T13:40:57Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2247", "timeline": [{"oid": "200a8be5e8c20b14d3821d7e42e630ea40156a16", "url": "https://github.com/hazelcast/hazelcast-jet/commit/200a8be5e8c20b14d3821d7e42e630ea40156a16", "message": "Put back CDC code for Postgres", "committedDate": "2020-05-26T10:43:45Z", "type": "forcePushed"}, {"oid": "f06b00ef4c44c7582ebb9c80504887a017dc5f62", "url": "https://github.com/hazelcast/hazelcast-jet/commit/f06b00ef4c44c7582ebb9c80504887a017dc5f62", "message": "Reword CDC related statements, fix links", "committedDate": "2020-06-02T07:28:51Z", "type": "commit"}, {"oid": "10669f70e4dcbd8392d53bb580026ff46c0e9e7f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/10669f70e4dcbd8392d53bb580026ff46c0e9e7f", "message": "Put back CDC code for Postgres", "committedDate": "2020-06-02T07:47:26Z", "type": "commit"}, {"oid": "db818d0d7b81eedaf860b5577a6fd3338a1c215b", "url": "https://github.com/hazelcast/hazelcast-jet/commit/db818d0d7b81eedaf860b5577a6fd3338a1c215b", "message": "Sync with MySQL on master", "committedDate": "2020-06-02T07:48:23Z", "type": "commit"}, {"oid": "60f0d7f5bc54efc32002ca334edf1eb01b1bf78a", "url": "https://github.com/hazelcast/hazelcast-jet/commit/60f0d7f5bc54efc32002ca334edf1eb01b1bf78a", "message": "Handle license issue", "committedDate": "2020-06-02T07:48:26Z", "type": "commit"}, {"oid": "33aef0c27e21b8689f43ab8d6b10a80e889b1237", "url": "https://github.com/hazelcast/hazelcast-jet/commit/33aef0c27e21b8689f43ab8d6b10a80e889b1237", "message": "Move slow tests (with a few exceptions) to nightly run", "committedDate": "2020-06-02T07:48:27Z", "type": "commit"}, {"oid": "c4662b021785a04c0df339f15030ef252c29de39", "url": "https://github.com/hazelcast/hazelcast-jet/commit/c4662b021785a04c0df339f15030ef252c29de39", "message": "Add sequence extractor and tests", "committedDate": "2020-06-02T10:07:20Z", "type": "commit"}, {"oid": "25a8e5f754182e93fbf379f3a073c05bc5f24b2f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/25a8e5f754182e93fbf379f3a073c05bc5f24b2f", "message": "Remove copy-paste TODO", "committedDate": "2020-06-02T10:40:33Z", "type": "commit"}, {"oid": "25a8e5f754182e93fbf379f3a073c05bc5f24b2f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/25a8e5f754182e93fbf379f3a073c05bc5f24b2f", "message": "Remove copy-paste TODO", "committedDate": "2020-06-02T10:40:33Z", "type": "forcePushed"}, {"oid": "17c581fcab40b79738cefd19130714941e41d1dc", "url": "https://github.com/hazelcast/hazelcast-jet/commit/17c581fcab40b79738cefd19130714941e41d1dc", "message": "Add tutorial for Postgres CDC", "committedDate": "2020-06-03T06:45:55Z", "type": "commit"}, {"oid": "ea71084c3c8b6b28796eb201ceb4c407f623cbf3", "url": "https://github.com/hazelcast/hazelcast-jet/commit/ea71084c3c8b6b28796eb201ceb4c407f623cbf3", "message": "Address review concerns", "committedDate": "2020-06-03T06:52:59Z", "type": "commit"}, {"oid": "34b92fe141e65c9ec5f7cc0d92f473a4a2e4e111", "url": "https://github.com/hazelcast/hazelcast-jet/commit/34b92fe141e65c9ec5f7cc0d92f473a4a2e4e111", "message": "Merge branch 'cdc-wording' into cdc-postgres", "committedDate": "2020-06-03T06:53:26Z", "type": "commit"}, {"oid": "b7c09d149f7f7b5df3fe62205f35b7f2090cd222", "url": "https://github.com/hazelcast/hazelcast-jet/commit/b7c09d149f7f7b5df3fe62205f35b7f2090cd222", "message": "Update design document", "committedDate": "2020-06-03T07:17:15Z", "type": "commit"}, {"oid": "3abc523804fc25aa150e6f8d50df418beea0c476", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3abc523804fc25aa150e6f8d50df418beea0c476", "message": "Add logical replication related source properties", "committedDate": "2020-06-04T11:18:32Z", "type": "commit"}, {"oid": "8341732ef2de29596da97f2da32edbf928b4c0c2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/8341732ef2de29596da97f2da32edbf928b4c0c2", "message": "Fix sidebar", "committedDate": "2020-06-05T06:58:20Z", "type": "commit"}, {"oid": "964e8cfab89cd36985867d555be573ef182354e9", "url": "https://github.com/hazelcast/hazelcast-jet/commit/964e8cfab89cd36985867d555be573ef182354e9", "message": "Remove comment", "committedDate": "2020-06-05T07:11:47Z", "type": "commit"}, {"oid": "d841799b15aa46f451004f9aaa61bb53be6e69dc", "url": "https://github.com/hazelcast/hazelcast-jet/commit/d841799b15aa46f451004f9aaa61bb53be6e69dc", "message": "Add source table name to ChangeRecord", "committedDate": "2020-06-05T09:22:14Z", "type": "commit"}, {"oid": "3b83d65ddb06b81c60d4bd96257e5ef59afbf178", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3b83d65ddb06b81c60d4bd96257e5ef59afbf178", "message": "Make checkstyle happy", "committedDate": "2020-06-05T11:14:53Z", "type": "commit"}, {"oid": "08c625e9073995b95048b3e7a7af4e1d8b4c6250", "url": "https://github.com/hazelcast/hazelcast-jet/commit/08c625e9073995b95048b3e7a7af4e1d8b4c6250", "message": "Add \"db\" & \"schema\" fields", "committedDate": "2020-06-12T07:15:14Z", "type": "commit"}, {"oid": "bbc16606d3607c164816cf1c9ee60516f5d3bbfe", "url": "https://github.com/hazelcast/hazelcast-jet/commit/bbc16606d3607c164816cf1c9ee60516f5d3bbfe", "message": "Add \"db\" & \"schema\" fields", "committedDate": "2020-06-12T08:36:50Z", "type": "commit"}, {"oid": "492687e209e32667946412701b35d8498d94111f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/492687e209e32667946412701b35d8498d94111f", "message": "Add \"db\" & \"schema\" fields", "committedDate": "2020-06-12T08:49:00Z", "type": "commit"}, {"oid": "c992b84ad1740bd22b2ee550384fb64f40bc4631", "url": "https://github.com/hazelcast/hazelcast-jet/commit/c992b84ad1740bd22b2ee550384fb64f40bc4631", "message": "Simplify previous changes", "committedDate": "2020-06-12T10:03:54Z", "type": "commit"}, {"oid": "3de327666b901550e3ec18b5aa2ace961489c06a", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3de327666b901550e3ec18b5aa2ace961489c06a", "message": "Write deployment guide", "committedDate": "2020-06-15T11:00:07Z", "type": "commit"}, {"oid": "6bcc9d2f43eb8e0ae4253131f9837daef1777309", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6bcc9d2f43eb8e0ae4253131f9837daef1777309", "message": "Document parsing workaround", "committedDate": "2020-06-15T12:23:01Z", "type": "commit"}, {"oid": "7b725cefaf91e68c4ffc6be77f4b3a48fd5814a0", "url": "https://github.com/hazelcast/hazelcast-jet/commit/7b725cefaf91e68c4ffc6be77f4b3a48fd5814a0", "message": "Document sequence numbers a bit better", "committedDate": "2020-06-16T06:25:42Z", "type": "commit"}, {"oid": "e91fd52b37f94068aad38070ebe92f0c72dfa6c7", "url": "https://github.com/hazelcast/hazelcast-jet/commit/e91fd52b37f94068aad38070ebe92f0c72dfa6c7", "message": "Merge branch 'master' into cdc-postgres", "committedDate": "2020-06-16T06:31:47Z", "type": "commit"}, {"oid": "9bc455112b211bb64882d32a1a1e3b853432bf51", "url": "https://github.com/hazelcast/hazelcast-jet/commit/9bc455112b211bb64882d32a1a1e3b853432bf51", "message": "Rename test", "committedDate": "2020-06-16T07:07:50Z", "type": "commit"}, {"oid": "75eaee356474e64ecc76c2ee36631cb4457a3678", "url": "https://github.com/hazelcast/hazelcast-jet/commit/75eaee356474e64ecc76c2ee36631cb4457a3678", "message": "Refactor minor things", "committedDate": "2020-06-16T07:12:35Z", "type": "commit"}, {"oid": "dda4c6792945deff4a4e6ce50bf18d072c4480a4", "url": "https://github.com/hazelcast/hazelcast-jet/commit/dda4c6792945deff4a4e6ce50bf18d072c4480a4", "message": "Fix dependency versions", "committedDate": "2020-06-16T07:49:18Z", "type": "commit"}, {"oid": "caf77381194522c816d756f76b9a256d5f44243b", "url": "https://github.com/hazelcast/hazelcast-jet/commit/caf77381194522c816d756f76b9a256d5f44243b", "message": "Add more integration tests", "committedDate": "2020-06-18T08:02:05Z", "type": "commit"}, {"oid": "d5042713a53e8580671d50680b4b07695725d1b1", "url": "https://github.com/hazelcast/hazelcast-jet/commit/d5042713a53e8580671d50680b4b07695725d1b1", "message": "Merge branch 'master' into cdc-postgres", "committedDate": "2020-06-18T08:47:12Z", "type": "commit"}, {"oid": "7c947285748540521f6857a5995cf534e708005b", "url": "https://github.com/hazelcast/hazelcast-jet/commit/7c947285748540521f6857a5995cf534e708005b", "message": "Define raw debezium source", "committedDate": "2020-06-18T10:55:54Z", "type": "commit"}, {"oid": "1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "url": "https://github.com/hazelcast/hazelcast-jet/commit/1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "message": "Remove nonsensical tests and some that are more trouble than they are worth", "committedDate": "2020-06-18T11:08:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA0NjMzOQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442046339", "bodyText": "we can drop the ...", "author": "cangencer", "createdAt": "2020-06-18T08:11:03Z", "path": "extensions/cdc-debezium/src/main/java/com/hazelcast/jet/cdc/RecordPart.java", "diffHunk": "@@ -40,6 +40,32 @@\n      * Jackson jr</a> with <a\n      * href=\"https://github.com/FasterXML/jackson-jr/tree/master/jr-annotation-support\">\n      * annotation support</a>, so the supplied class can be annotated accordingly.\n+     * <p>\n+     * Note: there is a bug in jackson-jr's object mapping, where it doesn't\n+     * handle fields of type {@code Data} properly, if they are nullable.\n+     * The null values trigger exceptions and failure in the object mapping code...", "originalCommit": "caf77381194522c816d756f76b9a256d5f44243b", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjE5MA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442176190", "bodyText": "I wonder if this is relevant to us, since in Debezium it only affect the Kafka topic name? Can we just use a random name?", "author": "cangencer", "createdAt": "2020-06-18T12:06:36Z", "path": "extensions/cdc-postgres/src/main/java/com/hazelcast/jet/cdc/postgres/PostgresCdcSources.java", "diffHunk": "@@ -0,0 +1,325 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.cdc.postgres;\n+\n+import com.hazelcast.jet.annotation.EvolvingApi;\n+import com.hazelcast.jet.cdc.ChangeRecord;\n+import com.hazelcast.jet.cdc.impl.CdcSource;\n+import com.hazelcast.jet.cdc.impl.DebeziumConfig;\n+import com.hazelcast.jet.cdc.impl.PropertyRules;\n+import com.hazelcast.jet.cdc.postgres.impl.PostgresSequenceExtractor;\n+import com.hazelcast.jet.pipeline.StreamSource;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Objects;\n+\n+/**\n+ * Contains factory methods for creating change data capture sources\n+ * based on PostgreSQL databases.\n+ *\n+ * @since 4.2\n+ */\n+@EvolvingApi\n+public final class PostgresCdcSources {\n+\n+    private PostgresCdcSources() {\n+    }\n+\n+    /**\n+     * Creates a CDC source that streams change data from a PostgreSQL\n+     * database to Hazelcast Jet.\n+     *\n+     * @param name name of this source, needs to be unique, will be\n+     *             passed to the underlying Kafka Connect source\n+     * @return builder that can be used to set source properties and also\n+     * to construct the source once configuration is done\n+     */\n+    @Nonnull\n+    public static Builder postgres(@Nonnull String name) {\n+        return new Builder(name);\n+    }\n+\n+    /**\n+     * Builder for configuring a CDC source that streams change data\n+     * from a PostgreSQL database to Hazelcast Jet.\n+     */\n+    public static final class Builder {\n+\n+        private static final PropertyRules RULES = new PropertyRules()\n+                .required(\"database.hostname\")\n+                .required(\"database.user\")\n+                .required(\"database.password\")\n+                .required(\"database.dbname\")\n+                .required(\"database.server.name\")\n+                .exclusive(\"schema.whitelist\", \"schema.blacklist\")\n+                .exclusive(\"table.whitelist\", \"table.blacklist\");\n+\n+        private final DebeziumConfig config;\n+\n+        /**\n+         * @param name name of the source, needs to be unique,\n+         *             will be passed to the underlying Kafka\n+         *             Connect source\n+         */\n+        private Builder(String name) {\n+            Objects.requireNonNull(name, \"name\");\n+\n+            config = new DebeziumConfig(name, \"io.debezium.connector.postgresql.PostgresConnector\");\n+            config.setProperty(CdcSource.SEQUENCE_EXTRACTOR_CLASS_PROPERTY, PostgresSequenceExtractor.class.getName());\n+            config.setProperty(CdcSource.DB_SPECIFIC_EXTRA_FIELDS_PROPERTY, \"schema\");\n+        }\n+\n+        /**\n+         * IP address or hostname of the database server, has to be\n+         * specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseAddress(@Nonnull String address) {\n+            config.setProperty(\"database.hostname\", address);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional port number of the database server, if unspecified\n+         * defaults to the database specific default port (5432).\n+         */\n+        @Nonnull\n+        public Builder setDatabasePort(int port) {\n+            config.setProperty(\"database.port\", Integer.toString(port));\n+            return this;\n+        }\n+\n+        /**\n+         * Database user for connecting to the database server. Has to\n+         * be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseUser(@Nonnull String user) {\n+            config.setProperty(\"database.user\", user);\n+            return this;\n+        }\n+\n+        /**\n+         * Database user password for connecting to the database server.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabasePassword(@Nonnull String password) {\n+            config.setProperty(\"database.password\", password);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the PostgreSQL database from which to stream the\n+         * changes. Has to be set.\n+         * <p>\n+         * Currently this source is not capable of monitoring multiple\n+         * databases, only multiple schemas and/or tables. See white-\n+         * and black-listing configuration options for those.\n+         */\n+        public Builder setDatabaseName(String dbName) {\n+            config.setProperty(\"database.dbname\", dbName);\n+            return this;\n+        }\n+\n+        /**\n+         * Logical name that identifies and provides a namespace for the\n+         * particular database server/cluster being monitored. The\n+         * logical name should be unique across all other connectors.\n+         * Only alphanumeric characters and underscores should be used.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setClusterName(@Nonnull String cluster) {", "originalCommit": "1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjY2NzM2NQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442667365", "bodyText": "Yes, seems like we can.", "author": "jbartok", "createdAt": "2020-06-19T07:03:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjE5MA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjI3Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442176276", "bodyText": "missing annotations", "author": "cangencer", "createdAt": "2020-06-18T12:06:46Z", "path": "extensions/cdc-postgres/src/main/java/com/hazelcast/jet/cdc/postgres/PostgresCdcSources.java", "diffHunk": "@@ -0,0 +1,325 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.cdc.postgres;\n+\n+import com.hazelcast.jet.annotation.EvolvingApi;\n+import com.hazelcast.jet.cdc.ChangeRecord;\n+import com.hazelcast.jet.cdc.impl.CdcSource;\n+import com.hazelcast.jet.cdc.impl.DebeziumConfig;\n+import com.hazelcast.jet.cdc.impl.PropertyRules;\n+import com.hazelcast.jet.cdc.postgres.impl.PostgresSequenceExtractor;\n+import com.hazelcast.jet.pipeline.StreamSource;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Objects;\n+\n+/**\n+ * Contains factory methods for creating change data capture sources\n+ * based on PostgreSQL databases.\n+ *\n+ * @since 4.2\n+ */\n+@EvolvingApi\n+public final class PostgresCdcSources {\n+\n+    private PostgresCdcSources() {\n+    }\n+\n+    /**\n+     * Creates a CDC source that streams change data from a PostgreSQL\n+     * database to Hazelcast Jet.\n+     *\n+     * @param name name of this source, needs to be unique, will be\n+     *             passed to the underlying Kafka Connect source\n+     * @return builder that can be used to set source properties and also\n+     * to construct the source once configuration is done\n+     */\n+    @Nonnull\n+    public static Builder postgres(@Nonnull String name) {\n+        return new Builder(name);\n+    }\n+\n+    /**\n+     * Builder for configuring a CDC source that streams change data\n+     * from a PostgreSQL database to Hazelcast Jet.\n+     */\n+    public static final class Builder {\n+\n+        private static final PropertyRules RULES = new PropertyRules()\n+                .required(\"database.hostname\")\n+                .required(\"database.user\")\n+                .required(\"database.password\")\n+                .required(\"database.dbname\")\n+                .required(\"database.server.name\")\n+                .exclusive(\"schema.whitelist\", \"schema.blacklist\")\n+                .exclusive(\"table.whitelist\", \"table.blacklist\");\n+\n+        private final DebeziumConfig config;\n+\n+        /**\n+         * @param name name of the source, needs to be unique,\n+         *             will be passed to the underlying Kafka\n+         *             Connect source\n+         */\n+        private Builder(String name) {\n+            Objects.requireNonNull(name, \"name\");\n+\n+            config = new DebeziumConfig(name, \"io.debezium.connector.postgresql.PostgresConnector\");\n+            config.setProperty(CdcSource.SEQUENCE_EXTRACTOR_CLASS_PROPERTY, PostgresSequenceExtractor.class.getName());\n+            config.setProperty(CdcSource.DB_SPECIFIC_EXTRA_FIELDS_PROPERTY, \"schema\");\n+        }\n+\n+        /**\n+         * IP address or hostname of the database server, has to be\n+         * specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseAddress(@Nonnull String address) {\n+            config.setProperty(\"database.hostname\", address);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional port number of the database server, if unspecified\n+         * defaults to the database specific default port (5432).\n+         */\n+        @Nonnull\n+        public Builder setDatabasePort(int port) {\n+            config.setProperty(\"database.port\", Integer.toString(port));\n+            return this;\n+        }\n+\n+        /**\n+         * Database user for connecting to the database server. Has to\n+         * be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseUser(@Nonnull String user) {\n+            config.setProperty(\"database.user\", user);\n+            return this;\n+        }\n+\n+        /**\n+         * Database user password for connecting to the database server.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabasePassword(@Nonnull String password) {\n+            config.setProperty(\"database.password\", password);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the PostgreSQL database from which to stream the\n+         * changes. Has to be set.\n+         * <p>\n+         * Currently this source is not capable of monitoring multiple\n+         * databases, only multiple schemas and/or tables. See white-\n+         * and black-listing configuration options for those.\n+         */\n+        public Builder setDatabaseName(String dbName) {\n+            config.setProperty(\"database.dbname\", dbName);\n+            return this;\n+        }\n+\n+        /**\n+         * Logical name that identifies and provides a namespace for the\n+         * particular database server/cluster being monitored. The\n+         * logical name should be unique across all other connectors.\n+         * Only alphanumeric characters and underscores should be used.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setClusterName(@Nonnull String cluster) {\n+            config.setProperty(\"database.server.name\", cluster);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match schema names to be\n+         * monitored (\"schema\" is used here to denote logical groups of\n+         * tables). Any schema name not included in the whitelist will\n+         * be excluded from monitoring. By default all non-system schemas\n+         * will be monitored. May not be used with\n+         * {@link #setSchemaBlacklist(String...) schema blacklist}.\n+         */\n+        public Builder setSchemaWhitelist(String... schemaNameRegExps) {", "originalCommit": "1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjM4OQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442176389", "bodyText": "missing annotations (check other places too)", "author": "cangencer", "createdAt": "2020-06-18T12:06:55Z", "path": "extensions/cdc-postgres/src/main/java/com/hazelcast/jet/cdc/postgres/PostgresCdcSources.java", "diffHunk": "@@ -0,0 +1,325 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.cdc.postgres;\n+\n+import com.hazelcast.jet.annotation.EvolvingApi;\n+import com.hazelcast.jet.cdc.ChangeRecord;\n+import com.hazelcast.jet.cdc.impl.CdcSource;\n+import com.hazelcast.jet.cdc.impl.DebeziumConfig;\n+import com.hazelcast.jet.cdc.impl.PropertyRules;\n+import com.hazelcast.jet.cdc.postgres.impl.PostgresSequenceExtractor;\n+import com.hazelcast.jet.pipeline.StreamSource;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Objects;\n+\n+/**\n+ * Contains factory methods for creating change data capture sources\n+ * based on PostgreSQL databases.\n+ *\n+ * @since 4.2\n+ */\n+@EvolvingApi\n+public final class PostgresCdcSources {\n+\n+    private PostgresCdcSources() {\n+    }\n+\n+    /**\n+     * Creates a CDC source that streams change data from a PostgreSQL\n+     * database to Hazelcast Jet.\n+     *\n+     * @param name name of this source, needs to be unique, will be\n+     *             passed to the underlying Kafka Connect source\n+     * @return builder that can be used to set source properties and also\n+     * to construct the source once configuration is done\n+     */\n+    @Nonnull\n+    public static Builder postgres(@Nonnull String name) {\n+        return new Builder(name);\n+    }\n+\n+    /**\n+     * Builder for configuring a CDC source that streams change data\n+     * from a PostgreSQL database to Hazelcast Jet.\n+     */\n+    public static final class Builder {\n+\n+        private static final PropertyRules RULES = new PropertyRules()\n+                .required(\"database.hostname\")\n+                .required(\"database.user\")\n+                .required(\"database.password\")\n+                .required(\"database.dbname\")\n+                .required(\"database.server.name\")\n+                .exclusive(\"schema.whitelist\", \"schema.blacklist\")\n+                .exclusive(\"table.whitelist\", \"table.blacklist\");\n+\n+        private final DebeziumConfig config;\n+\n+        /**\n+         * @param name name of the source, needs to be unique,\n+         *             will be passed to the underlying Kafka\n+         *             Connect source\n+         */\n+        private Builder(String name) {\n+            Objects.requireNonNull(name, \"name\");\n+\n+            config = new DebeziumConfig(name, \"io.debezium.connector.postgresql.PostgresConnector\");\n+            config.setProperty(CdcSource.SEQUENCE_EXTRACTOR_CLASS_PROPERTY, PostgresSequenceExtractor.class.getName());\n+            config.setProperty(CdcSource.DB_SPECIFIC_EXTRA_FIELDS_PROPERTY, \"schema\");\n+        }\n+\n+        /**\n+         * IP address or hostname of the database server, has to be\n+         * specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseAddress(@Nonnull String address) {\n+            config.setProperty(\"database.hostname\", address);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional port number of the database server, if unspecified\n+         * defaults to the database specific default port (5432).\n+         */\n+        @Nonnull\n+        public Builder setDatabasePort(int port) {\n+            config.setProperty(\"database.port\", Integer.toString(port));\n+            return this;\n+        }\n+\n+        /**\n+         * Database user for connecting to the database server. Has to\n+         * be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseUser(@Nonnull String user) {\n+            config.setProperty(\"database.user\", user);\n+            return this;\n+        }\n+\n+        /**\n+         * Database user password for connecting to the database server.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabasePassword(@Nonnull String password) {\n+            config.setProperty(\"database.password\", password);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the PostgreSQL database from which to stream the\n+         * changes. Has to be set.\n+         * <p>\n+         * Currently this source is not capable of monitoring multiple\n+         * databases, only multiple schemas and/or tables. See white-\n+         * and black-listing configuration options for those.\n+         */\n+        public Builder setDatabaseName(String dbName) {", "originalCommit": "1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY3MDM2Nw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r444670367", "bodyText": "still missing annotations", "author": "cangencer", "createdAt": "2020-06-24T06:24:31Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjM4OQ=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjU3Mg==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442176572", "bodyText": "returns the source..", "author": "cangencer", "createdAt": "2020-06-18T12:07:19Z", "path": "extensions/cdc-postgres/src/main/java/com/hazelcast/jet/cdc/postgres/PostgresCdcSources.java", "diffHunk": "@@ -0,0 +1,325 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.cdc.postgres;\n+\n+import com.hazelcast.jet.annotation.EvolvingApi;\n+import com.hazelcast.jet.cdc.ChangeRecord;\n+import com.hazelcast.jet.cdc.impl.CdcSource;\n+import com.hazelcast.jet.cdc.impl.DebeziumConfig;\n+import com.hazelcast.jet.cdc.impl.PropertyRules;\n+import com.hazelcast.jet.cdc.postgres.impl.PostgresSequenceExtractor;\n+import com.hazelcast.jet.pipeline.StreamSource;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Objects;\n+\n+/**\n+ * Contains factory methods for creating change data capture sources\n+ * based on PostgreSQL databases.\n+ *\n+ * @since 4.2\n+ */\n+@EvolvingApi\n+public final class PostgresCdcSources {\n+\n+    private PostgresCdcSources() {\n+    }\n+\n+    /**\n+     * Creates a CDC source that streams change data from a PostgreSQL\n+     * database to Hazelcast Jet.\n+     *\n+     * @param name name of this source, needs to be unique, will be\n+     *             passed to the underlying Kafka Connect source\n+     * @return builder that can be used to set source properties and also\n+     * to construct the source once configuration is done\n+     */\n+    @Nonnull\n+    public static Builder postgres(@Nonnull String name) {\n+        return new Builder(name);\n+    }\n+\n+    /**\n+     * Builder for configuring a CDC source that streams change data\n+     * from a PostgreSQL database to Hazelcast Jet.\n+     */\n+    public static final class Builder {\n+\n+        private static final PropertyRules RULES = new PropertyRules()\n+                .required(\"database.hostname\")\n+                .required(\"database.user\")\n+                .required(\"database.password\")\n+                .required(\"database.dbname\")\n+                .required(\"database.server.name\")\n+                .exclusive(\"schema.whitelist\", \"schema.blacklist\")\n+                .exclusive(\"table.whitelist\", \"table.blacklist\");\n+\n+        private final DebeziumConfig config;\n+\n+        /**\n+         * @param name name of the source, needs to be unique,\n+         *             will be passed to the underlying Kafka\n+         *             Connect source\n+         */\n+        private Builder(String name) {\n+            Objects.requireNonNull(name, \"name\");\n+\n+            config = new DebeziumConfig(name, \"io.debezium.connector.postgresql.PostgresConnector\");\n+            config.setProperty(CdcSource.SEQUENCE_EXTRACTOR_CLASS_PROPERTY, PostgresSequenceExtractor.class.getName());\n+            config.setProperty(CdcSource.DB_SPECIFIC_EXTRA_FIELDS_PROPERTY, \"schema\");\n+        }\n+\n+        /**\n+         * IP address or hostname of the database server, has to be\n+         * specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseAddress(@Nonnull String address) {\n+            config.setProperty(\"database.hostname\", address);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional port number of the database server, if unspecified\n+         * defaults to the database specific default port (5432).\n+         */\n+        @Nonnull\n+        public Builder setDatabasePort(int port) {\n+            config.setProperty(\"database.port\", Integer.toString(port));\n+            return this;\n+        }\n+\n+        /**\n+         * Database user for connecting to the database server. Has to\n+         * be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseUser(@Nonnull String user) {\n+            config.setProperty(\"database.user\", user);\n+            return this;\n+        }\n+\n+        /**\n+         * Database user password for connecting to the database server.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabasePassword(@Nonnull String password) {\n+            config.setProperty(\"database.password\", password);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the PostgreSQL database from which to stream the\n+         * changes. Has to be set.\n+         * <p>\n+         * Currently this source is not capable of monitoring multiple\n+         * databases, only multiple schemas and/or tables. See white-\n+         * and black-listing configuration options for those.\n+         */\n+        public Builder setDatabaseName(String dbName) {\n+            config.setProperty(\"database.dbname\", dbName);\n+            return this;\n+        }\n+\n+        /**\n+         * Logical name that identifies and provides a namespace for the\n+         * particular database server/cluster being monitored. The\n+         * logical name should be unique across all other connectors.\n+         * Only alphanumeric characters and underscores should be used.\n+         * Has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setClusterName(@Nonnull String cluster) {\n+            config.setProperty(\"database.server.name\", cluster);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match schema names to be\n+         * monitored (\"schema\" is used here to denote logical groups of\n+         * tables). Any schema name not included in the whitelist will\n+         * be excluded from monitoring. By default all non-system schemas\n+         * will be monitored. May not be used with\n+         * {@link #setSchemaBlacklist(String...) schema blacklist}.\n+         */\n+        public Builder setSchemaWhitelist(String... schemaNameRegExps) {\n+            config.setProperty(\"schema.whitelist\", schemaNameRegExps);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match schema names to be\n+         * excluded from monitoring (\"schema\" is used here to denote\n+         * logical groups of tables). Any schema name not included in\n+         * the blacklist will be monitored, with the exception of system\n+         * schemas. May not be used with\n+         * {@link #setSchemaWhitelist(String...) schema whitelist}.\n+         */\n+        public Builder setSchemaBlacklist(String... schemaNameRegExps) {\n+            config.setProperty(\"schema.blacklist\", schemaNameRegExps);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match fully-qualified table\n+         * identifiers for tables to be monitored; any table not\n+         * included in the whitelist will be excluded from monitoring.\n+         * Each identifier is of the form <i>schemaName.tableName</i>.\n+         * By default the connector will monitor every non-system table\n+         * in each monitored database. May not be used with\n+         * {@link #setTableBlacklist(String...) table blacklist}.\n+         */\n+        @Nonnull\n+        public Builder setTableWhitelist(@Nonnull String... tableNameRegExps) {\n+            config.setProperty(\"table.whitelist\", tableNameRegExps);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match fully-qualified table\n+         * identifiers for tables to be excluded from monitoring; any\n+         * table not included in the blacklist will be monitored. Each\n+         * identifier is of the form <i>schemaName.tableName</i>. May\n+         * not be used with\n+         * {@link #setTableWhitelist(String...) table whitelist}.\n+         */\n+        @Nonnull\n+        public Builder setTableBlacklist(@Nonnull String... tableNameRegExps) {\n+            config.setProperty(\"table.blacklist\", tableNameRegExps);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match the fully-qualified\n+         * names of columns that should be excluded from change event\n+         * message values. Fully-qualified names for columns are of the\n+         * form <i>schemaName.tableName.columnName</i>.\n+         */\n+        @Nonnull\n+        public Builder setColumnBlacklist(@Nonnull String... columnNameRegExps) {\n+            config.setProperty(\"column.blacklist\", columnNameRegExps);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the @see <a href=\"https://www.postgresql.org/docs/10/logicaldecoding.html\">\n+         * Postgres logical decoding plug-in</a> installed on the server.\n+         * Supported values are <i>decoderbufs</i>, <i>wal2json</i>,\n+         * <i>wal2json_rds</i>, <i>wal2json_streaming</i>,\n+         * <i>wal2json_rds_streaming</i> and <i>pgoutput</i>.\n+         * <p>\n+         * If not explicitly set, the property defaults to <i>decoderbufs</i>.\n+         * <p>\n+         * When the processed transactions are very large it is possible\n+         * that the JSON batch event with all changes in the transaction\n+         * will not fit into the hard-coded memory buffer of size 1 GB.\n+         * In such cases it is possible to switch to so-called streaming\n+         * mode when every change in transactions is sent as a separate\n+         * message from PostgreSQL.\n+         */\n+        @Nonnull\n+        public Builder setLogicalDecodingPlugIn(@Nonnull String pluginName) {\n+            config.setProperty(\"plugin.name\", pluginName);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the @see <a href=\"https://www.postgresql.org/docs/10/logicaldecoding-explanation.html\">\n+         * Postgres logical decoding slot</a> (also called \"replication\n+         * slot\") created for streaming changes from a plug-in and\n+         * database instance.\n+         * <p>\n+         * Values must conform to Postgres replication slot naming rules\n+         * which state: \"Each replication slot has a name, which can\n+         * contain lower-case letters, numbers, and the underscore\n+         * character.\"\n+         * <p>\n+         * Replication slots have to have an identifier that is unique\n+         * across all databases in a PostgreSQL cluster.\n+         * <p>\n+         * If not explicitly set, the property defaults to <i>debezium</i>.\n+         */\n+        @Nonnull\n+        public Builder setReplicationSlotName(@Nonnull String slotName) {\n+            config.setProperty(\"slot.name\", slotName);\n+            return this;\n+        }\n+\n+        /**\n+         * Whether or not to drop the logical replication slot when the\n+         * connector disconnects cleanly.\n+         * <p>\n+         * Defaults to <i>false</i>\n+         * <p>\n+         * Should only be set to <i>true</i> in testing or development\n+         * environments. Dropping the slot allows WAL segments to be\n+         * discarded by the database, so it may happen that after a\n+         * restart the connector cannot resume from the WAL position\n+         * where it left off before.\n+         */\n+        @Nonnull\n+        public Builder setReplicationSlotDropOnStop(boolean dropOnStop) {\n+            config.setProperty(\"slot.drop.on.stop\", dropOnStop);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the <a href=\"https://www.postgresql.org/docs/10/logical-replication-publication.html\">\n+         * Postgres publication</a> that will be used for CDC purposes.\n+         * <p>\n+         * If the publication does not exist when this source starts up,\n+         * then the source will create it (note: the database user of the\n+         * source must have superuser permissions to be able to do so).\n+         * If created this way the publication will include all tables\n+         * and the source itself must filter the data based on its\n+         * white-/blacklist configs. This is not efficient because the\n+         * database will still send all data to the connector, before\n+         * filtering is applied.\n+         * <p>\n+         * It's best to use a pre-defined publication (via the <code>CREATE\n+         * PUBLICATION</code> SQL command, specified via its name.\n+         * <p>\n+         * If not explicitly set, the property defaults to <i>dbz_publication</i>.\n+         */\n+        @Nonnull\n+        public Builder setPublicationName(@Nonnull String publicationName) {\n+            config.setProperty(\"publication.name\", publicationName);\n+            return this;\n+        }\n+\n+        /**\n+         * Can be used to set any property not explicitly covered by\n+         * other methods or to override properties we have hidden.\n+         */\n+        @Nonnull\n+        public Builder setCustomProperty(@Nonnull String key, @Nonnull String value) {\n+            config.setProperty(key, value);\n+            return this;\n+        }\n+\n+        /**\n+         * Returns an actual source based on the properties set so far.", "originalCommit": "1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjE3NjcxMQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r442176711", "bodyText": "missing @since tag", "author": "cangencer", "createdAt": "2020-06-18T12:07:38Z", "path": "extensions/cdc-postgres/src/main/java/com/hazelcast/jet/cdc/postgres/package-info.java", "diffHunk": "@@ -0,0 +1,21 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+/**\n+ * Contains connectors for change data capture events from PostgreSQL\n+ * databases.\n+ */\n+package com.hazelcast.jet.cdc.postgres;", "originalCommit": "1cfd2a9b2b9dfb379ae7ffa9df989185c7da8f93", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "6950623b2e2b9f8db49ab5106163c81e8d60dba4", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6950623b2e2b9f8db49ab5106163c81e8d60dba4", "message": "Make Checkstyle happy", "committedDate": "2020-06-18T12:10:53Z", "type": "commit"}, {"oid": "273a4934cceab1c367eb90890104bc2d551fe5c0", "url": "https://github.com/hazelcast/hazelcast-jet/commit/273a4934cceab1c367eb90890104bc2d551fe5c0", "message": "Address review concerns", "committedDate": "2020-06-19T04:00:10Z", "type": "commit"}, {"oid": "6e3a7d1740490a1abf4146e261ba69f289b23ffe", "url": "https://github.com/hazelcast/hazelcast-jet/commit/6e3a7d1740490a1abf4146e261ba69f289b23ffe", "message": "Address review comments", "committedDate": "2020-06-19T07:14:05Z", "type": "commit"}, {"oid": "3d713021c3faeb6136e5da422ecad0147c7dcf56", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3d713021c3faeb6136e5da422ecad0147c7dcf56", "message": "Add sidebar subcategories for cdc pages", "committedDate": "2020-06-19T08:02:42Z", "type": "commit"}, {"oid": "43debc34899425312dd2b33fbe7413ef5e907d6f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/43debc34899425312dd2b33fbe7413ef5e907d6f", "message": "Merge branch 'raw-debezium' into cdc-postgres", "committedDate": "2020-06-19T08:52:22Z", "type": "commit"}, {"oid": "9b3590de28a34b41739ab9261e95cda6edbd08af", "url": "https://github.com/hazelcast/hazelcast-jet/commit/9b3590de28a34b41739ab9261e95cda6edbd08af", "message": "Add Postgres tests for generic sources", "committedDate": "2020-06-19T09:28:53Z", "type": "commit"}, {"oid": "929146ad07c2e5060ae52a9f31e7c5a6d7c17aea", "url": "https://github.com/hazelcast/hazelcast-jet/commit/929146ad07c2e5060ae52a9f31e7c5a6d7c17aea", "message": "Merge branch 'master' into cdc-postgres", "committedDate": "2020-06-19T11:56:58Z", "type": "commit"}, {"oid": "49db6a215f77c9c57edbb5c428cfc394fb567d95", "url": "https://github.com/hazelcast/hazelcast-jet/commit/49db6a215f77c9c57edbb5c428cfc394fb567d95", "message": "Add SSL related config options", "committedDate": "2020-06-22T08:19:12Z", "type": "commit"}, {"oid": "f95bd403d9cd5b8e750144ca6a201c4aed14ff55", "url": "https://github.com/hazelcast/hazelcast-jet/commit/f95bd403d9cd5b8e750144ca6a201c4aed14ff55", "message": "Document behaviour when connection to DB is lost", "committedDate": "2020-06-22T10:26:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0MTcxNA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r443541714", "bodyText": "@{code Date}", "author": "mtopolnik", "createdAt": "2020-06-22T13:03:01Z", "path": "extensions/cdc-debezium/src/main/java/com/hazelcast/jet/cdc/RecordPart.java", "diffHunk": "@@ -40,6 +40,32 @@\n      * Jackson jr</a> with <a\n      * href=\"https://github.com/FasterXML/jackson-jr/tree/master/jr-annotation-support\">\n      * annotation support</a>, so the supplied class can be annotated accordingly.\n+     * <p>\n+     * Note: there is a bug in jackson-jr's object mapping, where it doesn't\n+     * handle fields of type {@code Data} properly, if they are nullable.", "originalCommit": "f95bd403d9cd5b8e750144ca6a201c4aed14ff55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0Mjc0Mw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r443542743", "bodyText": "This would be better in active voice.", "author": "mtopolnik", "createdAt": "2020-06-22T13:04:41Z", "path": "extensions/cdc-mysql/src/main/java/com/hazelcast/jet/cdc/mysql/MySqlCdcSources.java", "diffHunk": "@@ -43,6 +44,14 @@ private MySqlCdcSources() {\n     /**\n      * Creates a CDC source that streams change data from a MySQL\n      * database to Hazelcast Jet.\n+     * <p>\n+     * If the database is unreachable when this source is started by a", "originalCommit": "f95bd403d9cd5b8e750144ca6a201c4aed14ff55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0MzcxNw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r443543717", "bodyText": "Use <em> for emphasized text instead of <i>.", "author": "mtopolnik", "createdAt": "2020-06-22T13:06:14Z", "path": "extensions/cdc-mysql/src/main/java/com/hazelcast/jet/cdc/mysql/MySqlCdcSources.java", "diffHunk": "@@ -215,6 +226,88 @@ public Builder setColumnBlacklist(@Nonnull String... columnNameRegExps) {\n             return this;\n         }\n \n+        /**\n+         * Specifies whether to use an encrypted connection to the\n+         * database. The default is <i>disabled</i>, and specifies to", "originalCommit": "f95bd403d9cd5b8e750144ca6a201c4aed14ff55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MzU0NDgwMA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r443544800", "bodyText": "These lines are too short, should be 72 chars after the initial * .", "author": "mtopolnik", "createdAt": "2020-06-22T13:08:05Z", "path": "extensions/cdc-mysql/src/main/java/com/hazelcast/jet/cdc/mysql/MySqlCdcSources.java", "diffHunk": "@@ -215,6 +226,88 @@ public Builder setColumnBlacklist(@Nonnull String... columnNameRegExps) {\n             return this;\n         }\n \n+        /**\n+         * Specifies whether to use an encrypted connection to the\n+         * database. The default is <i>disabled</i>, and specifies to\n+         * use an unencrypted connection.\n+         * <p>\n+         * The <i>preferred</i> option establishes an encrypted", "originalCommit": "f95bd403d9cd5b8e750144ca6a201c4aed14ff55", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "143e495020b3db86eaaf410a6c7bc636d8b650a2", "url": "https://github.com/hazelcast/hazelcast-jet/commit/143e495020b3db86eaaf410a6c7bc636d8b650a2", "message": "Address review concerns", "committedDate": "2020-06-23T07:49:48Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NDY3MDQ0OQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2247#discussion_r444670449", "bodyText": "missing annotations", "author": "cangencer", "createdAt": "2020-06-24T06:24:45Z", "path": "extensions/cdc-postgres/src/main/java/com/hazelcast/jet/cdc/postgres/PostgresCdcSources.java", "diffHunk": "@@ -0,0 +1,382 @@\n+/*\n+ * Copyright (c) 2008-2020, Hazelcast, Inc. All Rights Reserved.\n+ *\n+ * Licensed under the Apache License, Version 2.0 (the \"License\");\n+ * you may not use this file except in compliance with the License.\n+ * You may obtain a copy of the License at\n+ *\n+ * http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package com.hazelcast.jet.cdc.postgres;\n+\n+import com.hazelcast.internal.util.UuidUtil;\n+import com.hazelcast.jet.annotation.EvolvingApi;\n+import com.hazelcast.jet.cdc.ChangeRecord;\n+import com.hazelcast.jet.cdc.impl.CdcSource;\n+import com.hazelcast.jet.cdc.impl.ChangeRecordCdcSource;\n+import com.hazelcast.jet.cdc.impl.DebeziumConfig;\n+import com.hazelcast.jet.cdc.impl.PropertyRules;\n+import com.hazelcast.jet.cdc.postgres.impl.PostgresSequenceExtractor;\n+import com.hazelcast.jet.pipeline.StreamSource;\n+\n+import javax.annotation.Nonnull;\n+import java.util.Objects;\n+import java.util.Properties;\n+\n+/**\n+ * Contains factory methods for creating change data capture sources\n+ * based on PostgreSQL databases.\n+ *\n+ * @since 4.2\n+ */\n+@EvolvingApi\n+public final class PostgresCdcSources {\n+\n+    private PostgresCdcSources() {\n+    }\n+\n+    /**\n+     * Creates a CDC source that streams change data from a PostgreSQL database\n+     * to Hazelcast Jet.\n+     * <p>\n+     * If Jet can't reach the database when it attempts to start the source or\n+     * if it looses the connection to the database from an already running\n+     * source, it throws an exception and terminate the execution of the job.\n+     * This behaviour is not ideal, would be much better to try to reconnect,\n+     * at least for a certain amount of time. Future versions will address the\n+     * problem.\n+     *\n+     * @param name name of this source, needs to be unique, will be passed to\n+     *             the underlying Kafka Connect source\n+     * @return builder that can be used to set source properties and also to\n+     * construct the source once configuration is done\n+     */\n+    @Nonnull\n+    public static Builder postgres(@Nonnull String name) {\n+        return new Builder(name);\n+    }\n+\n+    /**\n+     * Builder for configuring a CDC source that streams change data\n+     * from a PostgreSQL database to Hazelcast Jet.\n+     */\n+    public static final class Builder {\n+\n+        private static final PropertyRules RULES = new PropertyRules()\n+                .required(\"database.hostname\")\n+                .required(\"database.user\")\n+                .required(\"database.password\")\n+                .required(\"database.dbname\")\n+                .inclusive(\"database.sslkey\", \"database.sslpassword\")\n+                .exclusive(\"schema.whitelist\", \"schema.blacklist\")\n+                .exclusive(\"table.whitelist\", \"table.blacklist\");\n+\n+        private final DebeziumConfig config;\n+\n+        /**\n+         * @param name name of the source, needs to be unique, will be passed to\n+         *             the underlying Kafka Connect source\n+         */\n+        private Builder(String name) {\n+            Objects.requireNonNull(name, \"name\");\n+\n+            config = new DebeziumConfig(name, \"io.debezium.connector.postgresql.PostgresConnector\");\n+            config.setProperty(CdcSource.SEQUENCE_EXTRACTOR_CLASS_PROPERTY, PostgresSequenceExtractor.class.getName());\n+            config.setProperty(ChangeRecordCdcSource.DB_SPECIFIC_EXTRA_FIELDS_PROPERTY, \"schema\");\n+            config.setProperty(\"database.server.name\", UuidUtil.newUnsecureUuidString());\n+        }\n+\n+        /**\n+         * IP address or hostname of the database server, has to be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseAddress(@Nonnull String address) {\n+            config.setProperty(\"database.hostname\", address);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional port number of the database server, if unspecified defaults\n+         * to the database specific default port (5432).\n+         */\n+        @Nonnull\n+        public Builder setDatabasePort(int port) {\n+            config.setProperty(\"database.port\", Integer.toString(port));\n+            return this;\n+        }\n+\n+        /**\n+         * Database user for connecting to the database server. Has to be\n+         * specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseUser(@Nonnull String user) {\n+            config.setProperty(\"database.user\", user);\n+            return this;\n+        }\n+\n+        /**\n+         * Database user password for connecting to the database server. Has to\n+         * be specified.\n+         */\n+        @Nonnull\n+        public Builder setDatabasePassword(@Nonnull String password) {\n+            config.setProperty(\"database.password\", password);\n+            return this;\n+        }\n+\n+        /**\n+         * The name of the PostgreSQL database from which to stream the changes.\n+         * Has to be set.\n+         * <p>\n+         * Currently this source is not capable of monitoring multiple\n+         * databases, only multiple schemas and/or tables. See white- and\n+         * black-listing configuration options for those.\n+         */\n+        @Nonnull\n+        public Builder setDatabaseName(String dbName) {\n+            config.setProperty(\"database.dbname\", dbName);\n+            return this;\n+        }\n+\n+        /**\n+         * Optional regular expressions that match schema names to be monitored\n+         * (\"schema\" is used here to denote logical groups of tables). Any\n+         * schema name not included in the whitelist will be excluded from\n+         * monitoring. By default all non-system schemas will be monitored. May\n+         * not be used with\n+         * {@link #setSchemaBlacklist(String...) schema blacklist}.\n+         */\n+        @Nonnull\n+        public Builder setSchemaWhitelist(String... schemaNameRegExps) {", "originalCommit": "143e495020b3db86eaaf410a6c7bc636d8b650a2", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "13d5b887a18167e5f6903558d6b2b3d96285eda0", "url": "https://github.com/hazelcast/hazelcast-jet/commit/13d5b887a18167e5f6903558d6b2b3d96285eda0", "message": "Add missing annotations", "committedDate": "2020-06-24T06:34:11Z", "type": "commit"}]}