{"pr_number": 2332, "pr_title": "Limit in-flight async operations to 1 in Processors using IMap.submitToKeys", "pr_createdAt": "2020-06-16T09:56:46Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/2332", "timeline": [{"oid": "36cf878e7bd042a8fe861eec6fa68950370a055e", "url": "https://github.com/hazelcast/hazelcast-jet/commit/36cf878e7bd042a8fe861eec6fa68950370a055e", "message": "Limit in-flight async operations to 1", "committedDate": "2020-06-16T09:53:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY0OTkwOQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2332#discussion_r441649909", "bodyText": "this will decrease performance for existing UpdateMapP, we should only do this for the CDCSink.", "author": "cangencer", "createdAt": "2020-06-17T15:50:33Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/connector/AbstractUpdateMapP.java", "diffHunk": "@@ -54,6 +55,15 @@\n  */\n public abstract class AbstractUpdateMapP<T, K, V> extends AsyncHazelcastWriterP {\n \n+    /**\n+     * This processor uses {@link IMap#submitToKeys(Set, EntryProcessor)}, which\n+     * if used from multiple parallel async operations can end up reordering\n+     * the changes done to the map and this in turn can result in unforseen\n+     * consequences. For this reason we need to limit ourselves to a single\n+     * in-flight operation at a time.\n+     */\n+    private static final int MAX_PARALLEL_ASYNC_OPS = 1;", "originalCommit": "36cf878e7bd042a8fe861eec6fa68950370a055e", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjAyMjI2Nw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2332#discussion_r442022267", "bodyText": "Ok, I can change that, but aren't  we worried about correctness in that processor too?", "author": "jbartok", "createdAt": "2020-06-18T07:27:50Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY0OTkwOQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MjA1NDIyOQ==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/2332#discussion_r442054229", "bodyText": "The other processor doesn't expect ordered items, so it's fine to keep as it is.", "author": "cangencer", "createdAt": "2020-06-18T08:24:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0MTY0OTkwOQ=="}], "type": "inlineReview"}, {"oid": "ab6efbd501fd2fc2fbb59e13277cbbbf9ef2451f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/ab6efbd501fd2fc2fbb59e13277cbbbf9ef2451f", "message": "Limit previous changes to CDC processor", "committedDate": "2020-06-18T08:06:18Z", "type": "commit"}]}