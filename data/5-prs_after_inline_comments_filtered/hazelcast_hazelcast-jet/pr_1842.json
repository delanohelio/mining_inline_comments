{"pr_number": 1842, "pr_title": "Adapt to IMDG using UUID instead of Address for Invocations", "pr_createdAt": "2020-01-08T13:17:25Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/1842", "timeline": [{"oid": "40d3de0f8087c385ff7710a5d72aea770db2ec46", "url": "https://github.com/hazelcast/hazelcast-jet/commit/40d3de0f8087c385ff7710a5d72aea770db2ec46", "message": "Adapt to IMDG changes", "committedDate": "2020-01-08T13:15:52Z", "type": "commit"}, {"oid": "eb1cc70ff37fb5920b207bf30747613775234b42", "url": "https://github.com/hazelcast/hazelcast-jet/commit/eb1cc70ff37fb5920b207bf30747613775234b42", "message": "Adapt to IMDG changes", "committedDate": "2020-01-08T13:27:21Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDIzNzM0Ng==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1842#discussion_r364237346", "bodyText": "can you make this a Util method? it's repeated several times.", "author": "cangencer", "createdAt": "2020-01-08T13:44:52Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/JetClientInstanceImpl.java", "diffHunk": "@@ -151,9 +151,9 @@ public ILogger getLogger() {\n         }\n     }\n \n-    private static Address masterAddress(Cluster cluster) {\n+    private static UUID masterUUID(Cluster cluster) {", "originalCommit": "eb1cc70ff37fb5920b207bf30747613775234b42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI1NTY3Mg==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1842#discussion_r364255672", "bodyText": "We have a getMasterMember method on the ClusterService.", "author": "sancar", "createdAt": "2020-01-08T14:24:40Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/JobProxy.java", "diffHunk": "@@ -142,6 +145,11 @@ protected JobConfig doGetJobConfig() {\n     }\n \n     @Override\n+    protected UUID masterUuid() {\n+        Optional<Member> first = container().getClusterService().getMembers().stream().findFirst();", "originalCommit": "eb1cc70ff37fb5920b207bf30747613775234b42", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3624c51949c576d3b64daacfe0b225512ab9eb87", "url": "https://github.com/hazelcast/hazelcast-jet/commit/3624c51949c576d3b64daacfe0b225512ab9eb87", "message": "Extract utility method for obtaining Master from Cluster", "committedDate": "2020-01-08T14:40:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI2NDc4MA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1842#discussion_r364264780", "bodyText": "you can use use clientClusterService.getMaster() here and inline the Util method", "author": "cangencer", "createdAt": "2020-01-08T14:42:47Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/impl/ClientJobProxy.java", "diffHunk": "@@ -156,16 +155,15 @@ protected long doGetJobSubmissionTime() {\n     protected JobConfig doGetJobConfig() {\n         return callAndRetryIfTargetNotFound(() -> {\n             ClientMessage request = JetGetJobConfigCodec.encodeRequest(getId());\n-            ClientMessage response = invocation(request, masterAddress()).invoke().get();\n+            ClientMessage response = invocation(request, masterUuid()).invoke().get();\n             Data data = JetGetJobConfigCodec.decodeResponse(response).response;\n             return serializationService().toObject(data);\n         });\n     }\n \n     @Override\n-    protected Address masterAddress() {\n-        Optional<Member> first = container().getCluster().getMembers().stream().findFirst();\n-        return first.orElseThrow(() -> new IllegalStateException(\"No members found in cluster\")).getAddress();\n+    protected UUID masterUuid() {\n+        return Util.getMaster(container().getCluster()).getUuid();", "originalCommit": "3624c51949c576d3b64daacfe0b225512ab9eb87", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI3NzE1MA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1842#discussion_r364277150", "bodyText": "Ok, but we should be aware that we are changing behaviour, not just adapting (ie. no more exception). Is that ok?", "author": "jbartok", "createdAt": "2020-01-08T15:05:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDI2NDc4MA=="}], "type": "inlineReview"}, {"oid": "01808ed2f2dd6d973811f6a804eb27c97460dbd8", "url": "https://github.com/hazelcast/hazelcast-jet/commit/01808ed2f2dd6d973811f6a804eb27c97460dbd8", "message": "Further change", "committedDate": "2020-01-08T15:04:46Z", "type": "commit"}, {"oid": "1bad252efff8fc482f0cd18b2ee6c0782fc31dbb", "url": "https://github.com/hazelcast/hazelcast-jet/commit/1bad252efff8fc482f0cd18b2ee6c0782fc31dbb", "message": "refactoring/cleanup", "committedDate": "2020-01-08T17:01:05Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDU5ODY4Nw==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1842#discussion_r364598687", "bodyText": "To get master member, we get the master member and get its uuid and then get the master member again ?\n@jbartok", "author": "sancar", "createdAt": "2020-01-09T07:57:32Z", "path": "hazelcast-jet-all/src/main/java/com/hazelcast/jet/server/JetCommandLine.java", "diffHunk": "@@ -406,7 +406,7 @@ public void cluster(\n             JetClientInstanceImpl client = (JetClientInstanceImpl) jet;\n             HazelcastClientInstanceImpl hazelcastClient = client.getHazelcastClient();\n             ClientClusterService clientClusterService = hazelcastClient.getClientClusterService();\n-            Member masterMember = clientClusterService.getMember(clientClusterService.getMasterAddress());\n+            Member masterMember = clientClusterService.getMember(clientClusterService.getMasterMember().getUuid());", "originalCommit": "1bad252efff8fc482f0cd18b2ee6c0782fc31dbb", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}