{"pr_number": 1971, "pr_title": "Don't interrupt blocking threads when terminating", "pr_createdAt": "2020-02-12T12:34:44Z", "pr_url": "https://github.com/hazelcast/hazelcast-jet/pull/1971", "timeline": [{"oid": "778c90bae73a0e19ec86a44a2b0b66a678998db1", "url": "https://github.com/hazelcast/hazelcast-jet/commit/778c90bae73a0e19ec86a44a2b0b66a678998db1", "message": "Don't interrupt blocking threads when terminating\n\nAll processors are required to not block for extended time, the\ninterrupt isn't needed. It can make the execution termination faster,\nbut we've had issues with interrupted threads in the past. The latest\ninstance is in #1946 where the ApacheMQ client, when interrupted during\na commit, subsequently failed at `Connection.close()` which then leaked\nthe connection. And in the case of a durable subscriber the job couldn't\nstart again because the client ID was duplicate.\n\nFixes #1946", "committedDate": "2020-02-12T12:33:47Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM4MjUwOTI5OA==", "url": "https://github.com/hazelcast/hazelcast-jet/pull/1971#discussion_r382509298", "bodyText": "can you fix the formatting here? looks weird? See for example on Jet.bootstrappedInstance", "author": "cangencer", "createdAt": "2020-02-21T10:32:51Z", "path": "hazelcast-jet-core/src/main/java/com/hazelcast/jet/core/Processor.java", "diffHunk": "@@ -99,24 +99,34 @@\n \n     /**\n      * Tells whether this processor is able to participate in cooperative\n-     * multithreading. This means that each invocation of a <em>processing\n-     * method</em> in this class will take a reasonably small amount of time\n-     * (up to a millisecond). Violations will manifest themselves as increased\n-     * latency due to slower switching of processors.\n-     * <p>\n-     * A cooperative processor should also not attempt any blocking operations,\n-     * such as I/O operations, waiting for locks/semaphores or sleep\n-     * operations. Violations of this rule will manifest as less than 100% CPU\n-     * usage under maximum load (note that this is possible for other reasons too,\n-     * for example if the network is the bottleneck or if {@linkplain\n-     * JetProperties#JET_IDLE_COOPERATIVE_MAX_MICROSECONDS parking time} is too high).\n-     * The processor must also return as soon as the outbox rejects an item\n-     * (that is when the {@link Outbox#offer(Object) offer()} method returns\n-     * {@code false}).\n-     * <p>\n-     * If this processor declares itself cooperative, it will share a thread\n-     * with other cooperative processors. Otherwise it will run in a dedicated\n-     * Java thread.\n+     * multithreading. If this processor declares itself cooperative, it will\n+     * share a thread with other cooperative processors. Otherwise it will run\n+     * in a dedicated Java thread.\n+     * <p>\n+     * There are specific requirements that all <em>processing methods</em> of\n+     * a cooperative processor must follow:<ul>", "originalCommit": "778c90bae73a0e19ec86a44a2b0b66a678998db1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "74a654b6bcab271728b981e0a457e7498416135f", "url": "https://github.com/hazelcast/hazelcast-jet/commit/74a654b6bcab271728b981e0a457e7498416135f", "message": "Merge branch 'master' into dont-interrupt", "committedDate": "2020-02-24T10:15:06Z", "type": "commit"}, {"oid": "a8c62741e0f80ed2e85300764639510e5488dc55", "url": "https://github.com/hazelcast/hazelcast-jet/commit/a8c62741e0f80ed2e85300764639510e5488dc55", "message": "Address review", "committedDate": "2020-02-24T10:18:49Z", "type": "commit"}]}