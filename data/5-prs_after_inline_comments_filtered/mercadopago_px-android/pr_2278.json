{"pr_number": 2278, "pr_title": "[Feature] Added postpayment driver to support back_urls and more from preference", "pr_createdAt": "2020-08-10T18:56:12Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2278", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2ODEzNjg5Ng==", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r468136896", "bodyText": "No es algo innecesario hacer esto?", "author": "jorGonzalez291292", "createdAt": "2020-08-10T19:37:51Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/checkout/CheckoutActivity.java", "diffHunk": "@@ -412,81 +413,56 @@ public boolean isActive() {\n         return !isFinishing();\n     }\n \n-    @Override\n-    public void finishWithPaymentResult() {\n-        presenter.exitWithCode(RESULT_OK);\n-    }\n-\n     @Override\n     public void onOneTapCanceled() {\n         cancelCheckout();\n     }\n \n-    //TODO UNIFY\n     @Override\n     public void cancelCheckout(final Integer resultCode, final Boolean paymentMethodEdited) {\n-        overrideTransitionOut();\n         final Intent intent = new Intent();\n         intent.putExtra(EXTRA_PAYMENT_METHOD_CHANGED, paymentMethodEdited);\n         setResult(resultCode, intent);\n         finish();\n+        overrideTransitionOut();\n     }\n \n-    //TODO UNIFY\n     @Override\n-    public void finishWithPaymentResult(final Payment payment) {\n-        final Intent data = new Intent();\n-        data.putExtra(EXTRA_PAYMENT_RESULT, payment);\n-        setResult(PAYMENT_RESULT_CODE, data);\n-        finish();\n+    public void goToLink(@NonNull final String url) {\n+        final Intent intent = MercadoPagoUtil.getBrowserIntent(url);\n+        startActivity(intent);\n     }\n \n-    //TODO UNIFY\n     @Override\n-    public void finishWithPaymentResult(final Integer paymentResultCode) {\n+    public void finishWithPaymentResult(@Nullable final Integer resultCode, @Nullable final Payment payment) {\n+        int defaultResultCode = RESULT_OK;", "originalCommit": "5d0db7d1af26340a2c1af3efdef4702fcf23f872", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "20e0eda1f098b6f7a1bf2bd22fa0d64989898169", "url": "https://github.com/mercadopago/px-android/commit/20e0eda1f098b6f7a1bf2bd22fa0d64989898169", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-10T23:04:19Z", "type": "forcePushed"}, {"oid": "467996c2949f5508828f0f7e01f8286a8c09d722", "url": "https://github.com/mercadopago/px-android/commit/467996c2949f5508828f0f7e01f8286a8c09d722", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-10T23:19:45Z", "type": "forcePushed"}, {"oid": "e2268f64344467324618e6bc9bd544e9ae26cddc", "url": "https://github.com/mercadopago/px-android/commit/e2268f64344467324618e6bc9bd544e9ae26cddc", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-10T23:22:57Z", "type": "forcePushed"}, {"oid": "5f0f1b4bf8ab8b53d8112e3aa9d8f4528904f470", "url": "https://github.com/mercadopago/px-android/commit/5f0f1b4bf8ab8b53d8112e3aa9d8f4528904f470", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-10T23:27:14Z", "type": "forcePushed"}, {"oid": "7479528588a5b2fd2ca598442b1c0b0c3d19e920", "url": "https://github.com/mercadopago/px-android/commit/7479528588a5b2fd2ca598442b1c0b0c3d19e920", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-10T23:38:12Z", "type": "forcePushed"}, {"oid": "2e465e725cb4853f1b77ae7e6fb4128a2a2666d8", "url": "https://github.com/mercadopago/px-android/commit/2e465e725cb4853f1b77ae7e6fb4128a2a2666d8", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-11T20:01:36Z", "type": "forcePushed"}, {"oid": "6dcf64710d096583b58495557f378515b5824909", "url": "https://github.com/mercadopago/px-android/commit/6dcf64710d096583b58495557f378515b5824909", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-11T20:51:06Z", "type": "forcePushed"}, {"oid": "f0ec713e1ced8e2bb0c0286f51d97a0c1b02c872", "url": "https://github.com/mercadopago/px-android/commit/f0ec713e1ced8e2bb0c0286f51d97a0c1b02c872", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-11T21:42:44Z", "type": "forcePushed"}, {"oid": "525e5c1965a42fe5e4ff4fcd618743e1262d6311", "url": "https://github.com/mercadopago/px-android/commit/525e5c1965a42fe5e4ff4fcd618743e1262d6311", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-12T17:57:18Z", "type": "forcePushed"}, {"oid": "79950e363bac80d858e65ebb1583ab3689b26209", "url": "https://github.com/mercadopago/px-android/commit/79950e363bac80d858e65ebb1583ab3689b26209", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-12T18:43:18Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI2Njg5Mg==", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470266892", "bodyText": "esto iria fuera del metodo map probablemente", "author": "cgaggino", "createdAt": "2020-08-13T21:45:35Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/business_result/BusinessPaymentResultPresenter.java", "diffHunk": "@@ -76,9 +95,17 @@ public void dispatch(final Action action) {\n     }\n \n     private void mapPaymentModel() {\n-        final BusinessPaymentResultViewModel viewModel = new BusinessPaymentResultMapper().map(model);\n+        final BusinessPaymentResultViewModel viewModel = new BusinessPaymentResultMapper(\n+            paymentSettings.getCheckoutPreference().getAutoReturn()).map(model);\n         getView().configureViews(viewModel, this);\n         getView().setStatusBarColor(viewModel.headerModel.getBackgroundColor());\n+        if (viewModel.shouldAutoReturn) {", "originalCommit": "79950e363bac80d858e65ebb1583ab3689b26209", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4Mjc1NQ==", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470282755", "bodyText": "hace falta chequear null si el return es nullable?", "author": "cgaggino", "createdAt": "2020-08-13T22:26:02Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/util/MercadoPagoUtil.java", "diffHunk": "@@ -115,7 +118,29 @@ public static Intent getSafeIntent(@NonNull final Context context, @NonNull fina\n         return getSafeIntent(context).setData(uri);\n     }\n \n-    public static Intent getSafeIntent(@NonNull final Context context) {\n+    private static Intent getSafeIntent(@NonNull final Context context) {\n         return new Intent(Intent.ACTION_VIEW).setPackage(context.getPackageName()).putExtra(INTERNAL, true);\n     }\n+\n+    @Nullable\n+    public static Intent getIntent(@NonNull final Context context, @NonNull final String link) {\n+        final Intent intent = new Intent(Intent.ACTION_VIEW).setData(Uri.parse(link));\n+        if (context.getPackageManager().queryIntentActivities(intent, 0).isEmpty()) {\n+            return null;\n+        } else {\n+            return intent;\n+        }\n+    }\n+\n+    @Nullable\n+    public static Intent getNativeOrWebViewIntent(@NonNull final Context context, @NonNull final String link) {\n+        if (link.startsWith(\"http\")) {\n+            final String webViewPath = isMP(context) ? MP_WEBVIEW_DEEPLINK : ML_WEBVIEW_DEEPLINK;\n+            final Intent intent = getIntent(context, webViewPath + link);\n+            if (intent != null) {", "originalCommit": "79950e363bac80d858e65ebb1583ab3689b26209", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4MzkzNg==", "url": "https://github.com/mercadopago/px-android/pull/2278#discussion_r470283936", "bodyText": "ahi vi que lo ultimo lo haces siempre", "author": "cgaggino", "createdAt": "2020-08-13T22:29:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3MDI4Mjc1NQ=="}], "type": "inlineReview"}, {"oid": "fafefbe7c745fec0ae9f1659a568f1c75ea05171", "url": "https://github.com/mercadopago/px-android/commit/fafefbe7c745fec0ae9f1659a568f1c75ea05171", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T14:37:13Z", "type": "forcePushed"}, {"oid": "c6e607d9ab63645ab58f2b9bcf8bd46fb9c29d20", "url": "https://github.com/mercadopago/px-android/commit/c6e607d9ab63645ab58f2b9bcf8bd46fb9c29d20", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T14:52:59Z", "type": "forcePushed"}, {"oid": "02ad54d82cb241ca089bb051f20132e93337f1b3", "url": "https://github.com/mercadopago/px-android/commit/02ad54d82cb241ca089bb051f20132e93337f1b3", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T15:02:32Z", "type": "forcePushed"}, {"oid": "cdc407a045f104b67b2a3bf163823e35ac9986b9", "url": "https://github.com/mercadopago/px-android/commit/cdc407a045f104b67b2a3bf163823e35ac9986b9", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T15:07:58Z", "type": "forcePushed"}, {"oid": "48e10f38c7d8b9260b8a177ec22709e2efcb362d", "url": "https://github.com/mercadopago/px-android/commit/48e10f38c7d8b9260b8a177ec22709e2efcb362d", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T15:13:53Z", "type": "forcePushed"}, {"oid": "11dbe1dac3610b63283fc83932183b111e446a69", "url": "https://github.com/mercadopago/px-android/commit/11dbe1dac3610b63283fc83932183b111e446a69", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T17:15:18Z", "type": "forcePushed"}, {"oid": "599c74b5f1c1433e5303e80725610fca2b939ab8", "url": "https://github.com/mercadopago/px-android/commit/599c74b5f1c1433e5303e80725610fca2b939ab8", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T19:08:13Z", "type": "forcePushed"}, {"oid": "912528cac62e87135d3227f8efa6cf5a787e9622", "url": "https://github.com/mercadopago/px-android/commit/912528cac62e87135d3227f8efa6cf5a787e9622", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-19T19:11:54Z", "type": "forcePushed"}, {"oid": "e383f20da01d60d75f62c817a01d9cd2365dfe51", "url": "https://github.com/mercadopago/px-android/commit/e383f20da01d60d75f62c817a01d9cd2365dfe51", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-20T15:35:26Z", "type": "forcePushed"}, {"oid": "7b75f44876392be17eb3526714db565eada8e87f", "url": "https://github.com/mercadopago/px-android/commit/7b75f44876392be17eb3526714db565eada8e87f", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-20T15:39:34Z", "type": "commit"}, {"oid": "7b75f44876392be17eb3526714db565eada8e87f", "url": "https://github.com/mercadopago/px-android/commit/7b75f44876392be17eb3526714db565eada8e87f", "message": "Added postpayment driver to support back_urls and more from preference", "committedDate": "2020-08-20T15:39:34Z", "type": "forcePushed"}]}