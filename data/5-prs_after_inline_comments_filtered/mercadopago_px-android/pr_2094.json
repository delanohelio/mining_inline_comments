{"pr_number": 2094, "pr_title": "[Feature] Accessibility", "pr_createdAt": "2020-04-01T15:40:00Z", "pr_url": "https://github.com/mercadopago/px-android/pull/2094", "timeline": [{"oid": "b20f4370ff3ec268a2ff404b8d81d4adbe1de7eb", "url": "https://github.com/mercadopago/px-android/commit/b20f4370ff3ec268a2ff404b8d81d4adbe1de7eb", "message": "init accessibility", "committedDate": "2020-03-14T17:23:07Z", "type": "commit"}, {"oid": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "url": "https://github.com/mercadopago/px-android/commit/bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "message": "accessibility feature added", "committedDate": "2020-04-01T15:31:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczMTQxMw==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401731413", "bodyText": "Remplazar por TextUtil.SPACE", "author": "jorGonzalez291292", "createdAt": "2020-04-01T16:04:43Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/installments/InstallmentRowHolder.java", "diffHunk": "@@ -82,10 +87,19 @@ private void setInstallmentsText(@NonNull final Currency currency, @NonNull fina\n \n         final String text = installmentsText.getContext().getString(R.string.px_installments_by);\n \n-        installmentsText.setText(\n-            new SpannableStringBuilder(String.format(Locale.getDefault(), \"%d\", payerCost.getInstallments()))\n-                .append(text).append(\" \")\n-                .append(spannedInstallmentsText));\n+        final String installmentText = String.format(Locale.getDefault(), \"%d\", payerCost.getInstallments());\n+        final Context context = itemView.getContext();\n+\n+        installmentsText.setText(new SpannableStringBuilder(installmentText)\n+            .append(text)\n+            .append(\" \")", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczMjg2MA==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401732860", "bodyText": "Revisar escenarios con decimales", "author": "cgaggino", "createdAt": "2020-04-01T16:06:45Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/add_new_card/OfflineMethodsFragment.java", "diffHunk": "@@ -172,13 +172,23 @@ public void onScrolled(@NonNull final RecyclerView recyclerView, final int dx, f\n     @Override\n     public void updateTotalView(@NonNull final AmountLocalized amountLocalized) {\n         final Editable editable = new SpannableStringBuilder();\n-        editable.append(getContext().getString(R.string.px_review_summary_total));\n+        final Editable editableDescription = new SpannableStringBuilder();\n+        final String totalText = getString(R.string.px_review_summary_total);\n+        editable.append(totalText);\n         editable.append(TextUtil.SPACE);\n         editable.append(amountLocalized.get(getContext()));\n \n         ViewUtils.setFontInSpannable(getContext(), PxFont.SEMI_BOLD, editable);\n \n         totalAmountTextView.setText(editable);\n+\n+        editableDescription\n+            .append(totalText)\n+            .append(TextUtil.SPACE)\n+            .append(String.valueOf(amountLocalized.getAmount().intValue()))", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTczNTYxMg==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401735612", "bodyText": "La asignacion de parent = view.getParent se puede hacer afuera del if, se va hacer de todas formas y acorta la lectura de la condici\u00f3n, podria ser:\nparent = view != null ? view.getParent() : null\ny en el if te ahorras chequear view != null", "author": "cgaggino", "createdAt": "2020-04-01T16:10:45Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/add_new_card/OtherPaymentMethodFragment.java", "diffHunk": "@@ -111,6 +112,20 @@ private void configureViews(@NonNull final View view, @DrawableRes final int ima\n         view.setOnClickListener(listener);\n     }\n \n+    @Override\n+    public void setUserVisibleHint(final boolean isVisibleToUser) {\n+        super.setUserVisibleHint(isVisibleToUser);\n+        final View view = getView();\n+        final ViewGroup parent;\n+        if (presenter != null && view != null && (parent = (ViewGroup) view.getParent()) != null) {", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0MzQ0OA==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401743448", "bodyText": "Borrar imports", "author": "guchito9", "createdAt": "2020-04-01T16:22:16Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/ExpressPaymentFragment.java", "diffHunk": "@@ -20,6 +20,8 @@\n import android.view.LayoutInflater;\n import android.view.View;\n import android.view.ViewGroup;\n+import android.view.accessibility.AccessibilityEvent;\n+import android.view.accessibility.AccessibilityNodeInfo;", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc0OTc0OQ==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401749749", "bodyText": "Ac\u00e1 no hay que chequear por null?", "author": "guchito9", "createdAt": "2020-04-01T16:31:34Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/express/slider/PaymentMethodFragment.java", "diffHunk": "@@ -98,9 +119,45 @@ public void onFocusOut() {\n         focused = false;\n         if (presenter != null) {\n             presenter.onFocusOut();\n+            executeIfAccessibilityTalkBackEnable(getContext(), () -> {\n+                clearForAccessibility();\n+                return null;\n+            });\n         }\n     }\n \n+    private void updateForAccessibility() {\n+        final String description = getAccessibilityContentDescription();\n+\n+        if (TextUtil.isNotEmpty(description)) {\n+            setDescriptionForAccessibility(description);\n+        } else if (isDisableMethod()) {\n+            String statusMessage = model.getStatus().getMainMessage().getMessage();\n+            statusMessage = TextUtil.isNotEmpty(statusMessage) ? statusMessage : TextUtil.EMPTY;\n+            if (TextUtil.isNotEmpty(statusMessage)) {\n+                setDescriptionForAccessibility(statusMessage);\n+            }\n+        }\n+    }\n+\n+    private void setDescriptionForAccessibility(@NonNull final String description) {\n+        final View rootView = getView();\n+        final DynamicHeightViewPager parent;\n+        if (rootView != null && (parent = (DynamicHeightViewPager) rootView.getParent()) != null &&\n+            parent.hasAccessibilityFocus()) {\n+            parent.announceForAccessibility(description);\n+        }\n+        if (handler != null) {\n+            handler.postDelayed(() -> card.setContentDescription(description), 800);\n+        }\n+    }\n+\n+    private void clearForAccessibility() {\n+        card.sendAccessibilityEvent(AccessibilityEvent.TYPE_VIEW_ACCESSIBILITY_FOCUS_CLEARED);\n+        card.setContentDescription(TextUtil.SPACE);\n+        handler.removeCallbacksAndMessages(null);", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1MDY1OA==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401750658", "bodyText": "Sacar import", "author": "guchito9", "createdAt": "2020-04-01T16:32:53Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/features/payment_result/PaymentResultActivity.java", "diffHunk": "@@ -14,6 +14,7 @@\n import android.support.design.widget.Snackbar;\n import android.support.v4.content.ContextCompat;\n import android.view.View;\n+import android.view.ViewGroup;", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc1OTcxNw==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401759717", "bodyText": "podriamos preguntar directamente sobre descriptionAccountMoney, no? para no acceder de vuelta al dato si ya lo tenemos. Podria quedar medio rara la condicion con ese nombre de variable igual, quizas la variable sea simplemente sliderTitle, ya que accountMoney en el nombre es medio redundante dentro de la clase de account money", "author": "cgaggino", "createdAt": "2020-04-01T16:47:06Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/AccountMoneyDescriptorModel.java", "diffHunk": "@@ -31,13 +32,21 @@ public void updateLeftSpannable(@NonNull final SpannableStringBuilder spannableS\n \n         final Context context = textView.getContext();\n \n-        if (TextUtil.isEmpty(accountMoneyMetadata.displayInfo.sliderTitle)) {\n-            spannableStringBuilder.append(TextUtil.SPACE);\n-        } else {\n-            final AmountLabeledFormatter amountLabeledFormatter =\n-                new AmountLabeledFormatter(spannableStringBuilder, context)\n-                    .withTextColor(ContextCompat.getColor(context, R.color.ui_meli_grey));\n-            amountLabeledFormatter.apply(accountMoneyMetadata.displayInfo.sliderTitle);\n+        if (accountMoneyMetadata.displayInfo != null) {\n+            descriptionAccountMoney = accountMoneyMetadata.displayInfo.sliderTitle;\n+            if (TextUtil.isEmpty(accountMoneyMetadata.displayInfo.sliderTitle)) {", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc3Mzk1Nw==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401773957", "bodyText": "Ac\u00e1 se est\u00e1 chequeando dos veces lo mismo", "author": "cgaggino", "createdAt": "2020-04-01T17:08:25Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/PaymentMethodDrawableItemMapper.java", "diffHunk": "@@ -47,14 +66,24 @@ public DrawableFragmentItem map(@NonNull final ExpressMetadata expressMetadata)\n     @NonNull\n     private DrawableFragmentItem.Parameters getParameters(@NonNull final ExpressMetadata expressMetadata) {\n         final PaymentTypeChargeRule charge = chargeRepository.getChargeRule(expressMetadata.getPaymentTypeId());\n+\n         final String customOptionId = expressMetadata.getCustomOptionId();\n+        String description = TextUtil.EMPTY;\n+        String issuerName = TextUtil.EMPTY;\n+        CustomSearchItem item;\n+        if((item = getCustomSearchItemById(expressMetadata.getCustomOptionId())) != null) {\n+            description = item.getDescription();\n+            if (item.getIssuer() != null && item.getIssuer() != null) {", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQwMTc3ODkwNw==", "url": "https://github.com/mercadopago/px-android/pull/2094#discussion_r401778907", "bodyText": "podria fallar algo si viene null este value? se lo estamos pasando a un non null", "author": "cgaggino", "createdAt": "2020-04-01T17:16:02Z", "path": "px-checkout/src/main/java/com/mercadopago/android/px/internal/viewmodel/drawables/PaymentMethodDrawableItemMapper.java", "diffHunk": "@@ -47,14 +66,24 @@ public DrawableFragmentItem map(@NonNull final ExpressMetadata expressMetadata)\n     @NonNull\n     private DrawableFragmentItem.Parameters getParameters(@NonNull final ExpressMetadata expressMetadata) {\n         final PaymentTypeChargeRule charge = chargeRepository.getChargeRule(expressMetadata.getPaymentTypeId());\n+\n         final String customOptionId = expressMetadata.getCustomOptionId();\n+        String description = TextUtil.EMPTY;\n+        String issuerName = TextUtil.EMPTY;\n+        CustomSearchItem item;\n+        if((item = getCustomSearchItemById(expressMetadata.getCustomOptionId())) != null) {\n+            description = item.getDescription();", "originalCommit": "bc688bf161fe58b1fb1b4bf452135a59ac394e9a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "4d394ef451d422cad6d970eed6ab11f34dd4079d", "url": "https://github.com/mercadopago/px-android/commit/4d394ef451d422cad6d970eed6ab11f34dd4079d", "message": "review changes", "committedDate": "2020-04-01T17:31:50Z", "type": "commit"}, {"oid": "1088699cf4a315db46b9c1afb3c84737baafb47e", "url": "https://github.com/mercadopago/px-android/commit/1088699cf4a315db46b9c1afb3c84737baafb47e", "message": "merge master", "committedDate": "2020-04-01T19:29:13Z", "type": "commit"}, {"oid": "61f3e35ebe82a82d47046bcc5bfb912b261afb25", "url": "https://github.com/mercadopago/px-android/commit/61f3e35ebe82a82d47046bcc5bfb912b261afb25", "message": "add new keys, changes in startup focus", "committedDate": "2020-04-01T23:06:17Z", "type": "commit"}, {"oid": "43b449ae549dc6778ac1fa407f8492ff476a0d0f", "url": "https://github.com/mercadopago/px-android/commit/43b449ae549dc6778ac1fa407f8492ff476a0d0f", "message": "Tags are added in the manifest not to say the app name whenever an activity is opened", "committedDate": "2020-04-02T11:44:24Z", "type": "commit"}, {"oid": "291587f5dded6e317c3b299813053c5f75c1f3bb", "url": "https://github.com/mercadopago/px-android/commit/291587f5dded6e317c3b299813053c5f75c1f3bb", "message": "amounts are rounded to two decimal places", "committedDate": "2020-04-02T13:13:06Z", "type": "commit"}, {"oid": "5556c2fb8fb04eb49648d3559e56e6b1f0e3d733", "url": "https://github.com/mercadopago/px-android/commit/5556c2fb8fb04eb49648d3559e56e6b1f0e3d733", "message": "float value added in off-methods", "committedDate": "2020-04-02T16:24:14Z", "type": "commit"}]}