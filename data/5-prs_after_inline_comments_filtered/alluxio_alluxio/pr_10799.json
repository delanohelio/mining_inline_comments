{"pr_number": 10799, "pr_title": "Fix directory index after disk failure", "pr_createdAt": "2020-01-25T00:20:05Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10799", "timeline": [{"oid": "78168458ddf7a8a74b847c64ac17b2530656d6b9", "url": "https://github.com/Alluxio/alluxio/commit/78168458ddf7a8a74b847c64ac17b2530656d6b9", "message": "Fix tier index after deletion", "committedDate": "2020-01-25T00:12:58Z", "type": "commit"}, {"oid": "dbbd74049fb1911223c99c1646654dced721bb31", "url": "https://github.com/Alluxio/alluxio/commit/dbbd74049fb1911223c99c1646654dced721bb31", "message": "fix tests", "committedDate": "2020-01-25T01:20:15Z", "type": "commit"}, {"oid": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540", "url": "https://github.com/Alluxio/alluxio/commit/5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540", "message": "fix index issue", "committedDate": "2020-01-27T22:04:44Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw==", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371557797", "bodyText": "Does this List need to be modifiable now?", "author": "yuzhu", "createdAt": "2020-01-28T00:31:59Z", "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTierView.java", "diffHunk": "@@ -41,7 +42,7 @@ public StorageTierView(StorageTier tier) {\n    * @return a list of directory views in this storage tier view\n    */\n   public List<StorageDirView> getDirViews() {\n-    return Collections.unmodifiableList(mDirViews);\n+    return new ArrayList<>(mDirViews.values());", "originalCommit": "5cbde21ad4dbf3bfac8ff2a8a98fb0122cde5540", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2MDgyMQ==", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371560821", "bodyText": "No. it's only changed because we now need to convert the value set of the map to a list. It is equivalent to the old unmodifiable list in the sense that user of this API won't be able to change the underlying directory collection stored in this view.", "author": "bf8086", "createdAt": "2020-01-28T00:43:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU2NjQ0NA==", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371566444", "bodyText": "but the user of this API will not get an error if they try to modify this list. In fact they will successfully modify the returned list right?", "author": "yuzhu", "createdAt": "2020-01-28T01:06:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU3MDU1NA==", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371570554", "bodyText": "yeah I think the original purpose of wrapping the collection with unmodifiableList is to prevent mutation of the view rather than prevent the mutation of the return value after method returns. I don't feel it is necessary to add an unmodifiable wrapper on top of the list now that we already create a copy of the collection. Let me know if you think there is a strong reason for an additional wrapper otherwise.", "author": "bf8086", "createdAt": "2020-01-28T01:23:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTYxNDU0OQ==", "url": "https://github.com/Alluxio/alluxio/pull/10799#discussion_r371614549", "bodyText": "sounds good", "author": "yuzhu", "createdAt": "2020-01-28T05:22:06Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3MTU1Nzc5Nw=="}], "type": "inlineReview"}]}