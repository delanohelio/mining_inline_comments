{"pr_number": 12628, "pr_title": "Add support for handling 'remove_table' journal entry", "pr_createdAt": "2020-12-11T20:21:56Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/12628", "timeline": [{"oid": "517fac3e1317d5dc35a14e554b9dc89ef30c030a", "url": "https://github.com/Alluxio/alluxio/commit/517fac3e1317d5dc35a14e554b9dc89ef30c030a", "message": "Add support for handling 'remove_table' journal entry", "committedDate": "2020-12-11T20:07:13Z", "type": "commit"}, {"oid": "f0639144efe56cc6137a0c6cc47ed1730ffafa49", "url": "https://github.com/Alluxio/alluxio/commit/f0639144efe56cc6137a0c6cc47ed1730ffafa49", "message": "Add drop table operation to involve remove_table journal entry in the journal sync test", "committedDate": "2020-12-14T08:28:11Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAyMTkzMQ==", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543021931", "bodyText": "This line resyncs the database.. that's why the test is passing without your change. @hycsam", "author": "yuzhu", "createdAt": "2020-12-15T03:40:11Z", "path": "tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java", "diffHunk": "@@ -117,7 +122,7 @@ public void journalSync() throws Exception {\n     checkDb(tableMasterRestart, DB_NAME, oldInfo);\n     tableMasterRestart.syncDatabase(DB_NAME);", "originalCommit": "f0639144efe56cc6137a0c6cc47ed1730ffafa49", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ==", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543030801", "bodyText": "@yuzhu I was expecting the old code to throw an exception (Unrecognized journal entry something) during restart, which doesn't happen. Does it run asynchronously?", "author": "hycsam", "createdAt": "2020-12-15T04:08:24Z", "path": "tests/src/test/java/alluxio/server/ft/journal/TableMasterJournalIntegrationTest.java", "diffHunk": "@@ -109,6 +109,11 @@ public void journalSync() throws Exception {\n     tableMaster.syncDatabase(DB_NAME);\n     checkTable(tableMaster, DB_NAME, 2, 3);\n \n+    // Drop a table to create a 'remove_table' entry\n+    genTable(1, 3, true);\n+    tableMaster.syncDatabase(DB_NAME);\n+    checkTable(tableMaster, DB_NAME, 1, 3);\n+\n     restartMaster();", "originalCommit": "f0639144efe56cc6137a0c6cc47ed1730ffafa49", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzOTE2Nw==", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543039167", "bodyText": "I remember seeing an exception being shown when running in intellij.  I am guessing it is a server side exception, which might not cause the test (client) to fail.. it might also get masked somehow.", "author": "yuzhu", "createdAt": "2020-12-15T04:34:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA5MzgyNg==", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543093826", "bodyText": "I see, thanks! I guess that means the PR is ready to merge?", "author": "hycsam", "createdAt": "2020-12-15T07:01:01Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU0OTQ4NA==", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543549484", "bodyText": "i am ok with this PR. @gpang do you want to take another look? also, do you know why a Journal replay error does not fail the test?  I don't want this issue to happen else where and not be caught.", "author": "yuzhu", "createdAt": "2020-12-15T17:38:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzU2MzMzMg==", "url": "https://github.com/Alluxio/alluxio/pull/12628#discussion_r543563332", "bodyText": "Yeah, that is strange. I don't know why that error doesn't fail the test. In any case, we can change that part of it in a different PR.", "author": "gpang", "createdAt": "2020-12-15T17:57:46Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzAzMDgwMQ=="}], "type": "inlineReview"}]}