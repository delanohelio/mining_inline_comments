{"pr_number": 11491, "pr_title": "Clear temp file if Object Store upload failed", "pr_createdAt": "2020-06-01T05:50:21Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/11491", "timeline": [{"oid": "3801eb4a16eacf4d3f75b48461c7211dd542c489", "url": "https://github.com/Alluxio/alluxio/commit/3801eb4a16eacf4d3f75b48461c7211dd542c489", "message": "clear temp file if upload failed", "committedDate": "2020-06-01T05:48:24Z", "type": "commit"}, {"oid": "be948dcfd5723ecc4adf99483fa5cbf9c4f6da15", "url": "https://github.com/Alluxio/alluxio/commit/be948dcfd5723ecc4adf99483fa5cbf9c4f6da15", "message": "add other object stores", "committedDate": "2020-06-01T08:05:25Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzM3Mzk2NA==", "url": "https://github.com/Alluxio/alluxio/pull/11491#discussion_r433373964", "bodyText": "Since we delete in the finally, we should change the error message above (the temp file will no longer be available)", "author": "calvinjia", "createdAt": "2020-06-01T17:17:36Z", "path": "underfs/cos/src/main/java/alluxio/underfs/cos/COSOutputStream.java", "diffHunk": "@@ -158,10 +158,15 @@ public void close() throws IOException {\n         meta.setContentMD5(new String(Base64.encodeBase64(hashBytes)));\n       }\n       mCosClient.putObject(mBucketName, mKey, in, meta);\n-      mFile.delete();\n     } catch (CosClientException e) {\n       LOG.error(\"Failed to upload {}. Temporary file @ {}\", mKey, mFile.getPath());\n       throw new IOException(e);\n+    } finally {\n+      // Delete the temporary file on the local machine if the transfer manager completed the", "originalCommit": "be948dcfd5723ecc4adf99483fa5cbf9c4f6da15", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "3eda34bc8ac4e3390685bd8778cee200209c8106", "url": "https://github.com/Alluxio/alluxio/commit/3eda34bc8ac4e3390685bd8778cee200209c8106", "message": "improve comment", "committedDate": "2020-06-02T02:39:12Z", "type": "commit"}]}