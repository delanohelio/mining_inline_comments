{"pr_number": 10821, "pr_title": "Skip logging error on worker tmp folder", "pr_createdAt": "2020-01-31T21:34:06Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10821", "timeline": [{"oid": "6506a197a3bfb1c03124a84374d3ba0cebf0827c", "url": "https://github.com/Alluxio/alluxio/commit/6506a197a3bfb1c03124a84374d3ba0cebf0827c", "message": "Skip ERROR on tmp folder", "committedDate": "2020-01-31T21:07:36Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374955423", "bodyText": "Is the intention to only filter out this tmp folder, or any blocks within it? Because as it, won't this only filter out just that single folder?", "author": "ZacBlanco", "createdAt": "2020-02-04T22:19:13Z", "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageDir.java", "diffHunk": "@@ -125,7 +125,9 @@ private void initializeMeta() throws BlockAlreadyExistsException, IOException,\n     }\n     for (File path : paths) {\n       if (!path.isFile()) {\n-        LOG.error(\"{} in StorageDir is not a file\", path.getAbsolutePath());\n+        if (!path.getName().equals(ServerConfiguration.get(PropertyKey.WORKER_DATA_TMP_FOLDER))) {", "originalCommit": "6506a197a3bfb1c03124a84374d3ba0cebf0827c", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NjQ0Mw==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374956443", "bodyText": "There should really only be one object in that directory that isn't a file which is the .tmp_blocks directory. Listing the objects underneath is not needed since this directory will get deleted anyways. The main point is to avoid logging the ERROR since it has/will alarm certain users.", "author": "ns1123", "createdAt": "2020-02-04T22:21:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk2NzQzMA==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374967430", "bodyText": "My last comment is how the value of the WORKER_DATA_TMP_FOLDER might match path.getName() - can the user specify a relative path? will it still match path.getName() if the config specifies a relative or absolute?", "author": "ZacBlanco", "createdAt": "2020-02-04T22:47:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3NDcyMQ==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374974721", "bodyText": "WORKER_DATA_TMP_FOLDER must be a relative path. We don't allow an absolute path for this property. Path.getName() will also only get the last index of the path so this match should be correct.", "author": "ns1123", "createdAt": "2020-02-04T23:06:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3NjI4Mw==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374976283", "bodyText": "couldn't someone specify path1/path2 - configuration would return that, but then the path.getName() would only have path2?", "author": "ZacBlanco", "createdAt": "2020-02-04T23:10:26Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTEwMw==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374979103", "bodyText": "I think path.getName() would only have path1, but I see your concern. Is this something we reasonably see happening?", "author": "ns1123", "createdAt": "2020-02-04T23:17:57Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk3OTQ5Nw==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r374979497", "bodyText": "If the goal is to remove the message we need to account for the property being configured to something other than the default. Otherwise is there a point in looking up the configuration?", "author": "ZacBlanco", "createdAt": "2020-02-04T23:19:04Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NDk1NTQyMw=="}], "type": "inlineReview"}, {"oid": "b8b0d3504977e77173bc01797d1c6b7710d9582a", "url": "https://github.com/Alluxio/alluxio/commit/b8b0d3504977e77173bc01797d1c6b7710d9582a", "message": "Handle multi-level tmp dir", "committedDate": "2020-02-07T00:32:08Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3NTA4Mg==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r376175082", "bodyText": "can we use a method from PathUtils instead?", "author": "ZacBlanco", "createdAt": "2020-02-07T01:38:07Z", "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageDir.java", "diffHunk": "@@ -109,11 +111,11 @@ public static StorageDir newStorageDir(StorageTier tier, int dirIndex, long capa\n    * @throws WorkerOutOfSpaceException when metadata can not be added due to limited left space\n    */\n   private void initializeMeta() throws BlockAlreadyExistsException, IOException,\n-      WorkerOutOfSpaceException {\n+      WorkerOutOfSpaceException, InvalidPathException {\n     // Create the storage directory path\n     boolean isDirectoryNewlyCreated = FileUtils.createStorageDirPath(mDirPath,\n         ServerConfiguration.get(PropertyKey.WORKER_DATA_FOLDER_PERMISSIONS));\n-\n+    String tmpDir = ServerConfiguration.get(PropertyKey.WORKER_DATA_TMP_FOLDER).split(\"/\")[0];", "originalCommit": "b8b0d3504977e77173bc01797d1c6b7710d9582a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3OTQxMA==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r376179410", "bodyText": "Done as per your suggestion.", "author": "ns1123", "createdAt": "2020-02-07T01:56:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE3NTA4Mg=="}], "type": "inlineReview"}, {"oid": "4ba082d1acbd78eb858a49857614dda513a78c84", "url": "https://github.com/Alluxio/alluxio/commit/4ba082d1acbd78eb858a49857614dda513a78c84", "message": "Modified to use Paths instead of String.split", "committedDate": "2020-02-07T01:56:27Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjE4MDA1MQ==", "url": "https://github.com/Alluxio/alluxio/pull/10821#discussion_r376180051", "bodyText": "is this still necessary? it is", "author": "ZacBlanco", "createdAt": "2020-02-07T01:59:31Z", "path": "core/server/worker/src/main/java/alluxio/worker/block/meta/StorageTier.java", "diffHunk": "@@ -100,7 +100,7 @@ private void initStorageTier()\n             dirMedium[mediumTypeindex]);\n         totalCapacity += capacity;\n         mDirs.put(i, dir);\n-      } catch (IOException e) {\n+      } catch (IOException | InvalidPathException e) {", "originalCommit": "4ba082d1acbd78eb858a49857614dda513a78c84", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}