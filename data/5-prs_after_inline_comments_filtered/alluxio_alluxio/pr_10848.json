{"pr_number": 10848, "pr_title": "Refactor leftover metric keys", "pr_createdAt": "2020-02-05T21:15:24Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10848", "timeline": [{"oid": "7ea96e1b8f37b52ffa0823f3b921ad59527b1dac", "url": "https://github.com/Alluxio/alluxio/commit/7ea96e1b8f37b52ffa0823f3b921ad59527b1dac", "message": "Refactor leftover metric keys", "committedDate": "2020-02-05T21:14:46Z", "type": "commit"}, {"oid": "27ff209417d320cf31fbfaacd62b6cf693746aaa", "url": "https://github.com/Alluxio/alluxio/commit/27ff209417d320cf31fbfaacd62b6cf693746aaa", "message": "Add back MetricsSystem.getClusterMetricName", "committedDate": "2020-02-06T00:01:19Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAyMDYwMA==", "url": "https://github.com/Alluxio/alluxio/pull/10848#discussion_r376020600", "bodyText": "Aggreagated is spelled like Aggregated. not related to this PR, but feel free to rename the method", "author": "madanadit", "createdAt": "2020-02-06T18:56:51Z", "path": "core/common/src/main/java/alluxio/metrics/MetricKey.java", "diffHunk": "@@ -533,12 +533,85 @@ public MetricKey build() {\n           .build();\n \n   // Worker metrics\n+  public static final MetricKey WORKER_ASYNC_CACHE_DUPLICATE_REQUESTS =\n+      new Builder(Name.WORKER_ASYNC_CACHE_DUPLICATE_REQUESTS)\n+          .setDescription(\"Total number of duplicated async cache request received by this worker\")\n+          .setMetricType(MetricType.COUNTER)\n+          .setIsClusterAggreagated(false)", "originalCommit": "27ff209417d320cf31fbfaacd62b6cf693746aaa", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAyMTg1Ng==", "url": "https://github.com/Alluxio/alluxio/pull/10848#discussion_r376021856", "bodyText": "how is IsClusterAggregated used? I'm not quiet sure how to set this to true/false", "author": "madanadit", "createdAt": "2020-02-06T18:59:20Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAyMDYwMA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAyODkyNg==", "url": "https://github.com/Alluxio/alluxio/pull/10848#discussion_r376028926", "bodyText": "Oh!!! Thanks for finding it!\nThis is used when worker/client report metrics. They only report the isClusterAggregated == true metrics. This is helpful to reduce the metrics client sent and leading master stored.\nNow I only define those metrics that are actually aggregated to cluster metrics in DefaultMetricsMaster with isClusterAggregated == true. In the future, maybe all the metrics that we think can be aggregated at cluster level can set it to true.", "author": "LuQQiu", "createdAt": "2020-02-06T19:13:36Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3NjAyMDYwMA=="}], "type": "inlineReview"}, {"oid": "ebfdc6f59760f90f19d78465d1a10e497e4350ba", "url": "https://github.com/Alluxio/alluxio/commit/ebfdc6f59760f90f19d78465d1a10e497e4350ba", "message": "Change from Aggreagated to aggregated", "committedDate": "2020-02-06T19:17:38Z", "type": "commit"}]}