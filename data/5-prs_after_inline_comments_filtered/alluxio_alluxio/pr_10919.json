{"pr_number": 10919, "pr_title": "Allow superuser to stopActiveSync w/o a lock", "pr_createdAt": "2020-02-14T19:34:55Z", "pr_url": "https://github.com/Alluxio/alluxio/pull/10919", "timeline": [{"oid": "3ce238f8ca08f2dd8822e950b867e9229e9f59b9", "url": "https://github.com/Alluxio/alluxio/commit/3ce238f8ca08f2dd8822e950b867e9229e9f59b9", "message": "Alloq super user to stopSync w/o a lock", "committedDate": "2020-02-14T19:25:46Z", "type": "commit"}, {"oid": "17b608b592ba6c0362313812f2b0d007804e5836", "url": "https://github.com/Alluxio/alluxio/commit/17b608b592ba6c0362313812f2b0d007804e5836", "message": "Cleanup logging", "committedDate": "2020-02-14T19:30:12Z", "type": "commit"}, {"oid": "b1f59e01a01fe7c9a5d4c4ac7c67ff60abe1ed7d", "url": "https://github.com/Alluxio/alluxio/commit/b1f59e01a01fe7c9a5d4c4ac7c67ff60abe1ed7d", "message": "Remove newline", "committedDate": "2020-02-14T19:31:14Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYzMzA1NQ==", "url": "https://github.com/Alluxio/alluxio/pull/10919#discussion_r379633055", "bodyText": "can we add a TODO saying we can remove this once a sync doesn't require a write lock during the sync?", "author": "gpang", "createdAt": "2020-02-14T20:36:11Z", "path": "core/server/master/src/main/java/alluxio/master/file/DefaultFileSystemMaster.java", "diffHunk": "@@ -3817,21 +3817,35 @@ public void startSync(AlluxioURI syncPoint)\n   @Override\n   public void stopSync(AlluxioURI syncPoint)\n       throws IOException, InvalidPathException, AccessControlException {\n-    LockingScheme lockingScheme = new LockingScheme(syncPoint, LockPattern.WRITE_EDGE, false);\n-    try (RpcContext rpcContext = createRpcContext();\n-        LockedInodePath inodePath =\n-            mInodeTree.lockInodePath(lockingScheme.getPath(), lockingScheme.getPattern());\n-        FileSystemMasterAuditContext auditContext =\n-             createAuditContext(\"stopSync\", syncPoint, null,\n-                 inodePath.getParentInodeOrNull())) {\n+    try (RpcContext rpcContext = createRpcContext()) {\n+      boolean isSuperUser = true;\n       try {\n-        mPermissionChecker.checkParentPermission(Mode.Bits.WRITE, inodePath);\n+        mPermissionChecker.checkSuperUser();\n       } catch (AccessControlException e) {\n-        auditContext.setAllowed(false);\n-        throw e;\n+        isSuperUser = false;\n+      }\n+      if (isSuperUser) {\n+        // Stop sync w/o acquiring an inode lock to terminate an initial full scan (if running)", "originalCommit": "b1f59e01a01fe7c9a5d4c4ac7c67ff60abe1ed7d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTY0MDU3Nw==", "url": "https://github.com/Alluxio/alluxio/pull/10919#discussion_r379640577", "bodyText": "done", "author": "madanadit", "createdAt": "2020-02-14T20:55:52Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM3OTYzMzA1NQ=="}], "type": "inlineReview"}, {"oid": "1138329e47f98ec92251db735c903b8d24575b0e", "url": "https://github.com/Alluxio/alluxio/commit/1138329e47f98ec92251db735c903b8d24575b0e", "message": "Add TODO", "committedDate": "2020-02-14T20:55:34Z", "type": "commit"}, {"oid": "3a181d5045e363e017db6b83a0dc979b1d706c94", "url": "https://github.com/Alluxio/alluxio/commit/3a181d5045e363e017db6b83a0dc979b1d706c94", "message": "Add docs", "committedDate": "2020-02-15T00:31:48Z", "type": "commit"}, {"oid": "a5bf032ee0d00af276eaaf04c40860d29c72b645", "url": "https://github.com/Alluxio/alluxio/commit/a5bf032ee0d00af276eaaf04c40860d29c72b645", "message": "be consistent", "committedDate": "2020-02-15T00:33:11Z", "type": "commit"}]}