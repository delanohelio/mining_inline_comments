{"pr_number": 5053, "pr_title": "DHFPROD-6385: Optimize top-level value retrieval for matching", "pr_createdAt": "2020-12-29T23:44:19Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/5053", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MDI4MDQyMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/5053#discussion_r550280422", "bodyText": "This test, and testMasterStep, are failing locally for me, and also in Jenkins - https://jenkins.marklogic.com/blue/organizations/jenkins/Datahub_CI/detail/PR-5053/1/tests .\nIt's very difficult to debug these tests. The assertion messages below only restate what the assertions state. Before the mastering step is run, there are 239 docs in the \"mapping\" collection. Why are 7 match results expected?\nI recommend trying to rework this test as part of this PR. The scope appears to be just verifying that the match endpoint works. If so, I think all we need is a test that inserts two documents (one that will match and one that won't), one flow with a mastering step, and then uses a test document to verify that one match is returned. The assertion messages should explain why the match is expected, and why the test doc doesn't match the other document. That way, when the test fails in the future, it'll be much easier to debug. Right now, it's nearly impossible to debug because a developer is faced with a ton of analysis work to figure out why 7 matches are expected, and which ones those are. Instead of trying to document all of that, I think it'd be easier and better in the long term to just replace this test.\nI recommend replacing testMasterStep for the same reason - it's failing with a message of \"At least 10 merges are expected\", which doesn't inspire much confidence in how accurate merging is (i.e. is it okay if there are 10 merges, or 50 merges? If so, why?).", "author": "rjrudin", "createdAt": "2020-12-30T18:05:41Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/master/MasterTest.java", "diffHunk": "@@ -62,7 +62,12 @@ public void testMatchEndpoint() {\n         makeInputFilePathsAbsoluteInFlow(\"myNewFlow\");\n \n         runAsDataHubOperator();\n-        runFlow(new FlowInputs(\"myNewFlow\", \"1\", \"2\"));\n+        RunFlowResponse flowResponse = runFlow(new FlowInputs(\"myNewFlow\", \"1\", \"2\"));", "originalCommit": "9e632e5e4cbd2eac4050be56fc3fa1eb92bd5e22", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e1d60f8a0a249af8ce9acfa6f6afcdb27299ecb4", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e1d60f8a0a249af8ce9acfa6f6afcdb27299ecb4", "message": "DHFPROD-6385: Optimize top-level value retrieval for matching", "committedDate": "2020-12-31T16:41:44Z", "type": "forcePushed"}, {"oid": "e9ac8408d694f8cfd6fb61922eae656d4cb31d36", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9ac8408d694f8cfd6fb61922eae656d4cb31d36", "message": "DHFPROD-6385: Optimize top-level value retrieval for matching", "committedDate": "2021-01-05T21:12:30Z", "type": "commit"}, {"oid": "e9ac8408d694f8cfd6fb61922eae656d4cb31d36", "url": "https://github.com/marklogic/marklogic-data-hub/commit/e9ac8408d694f8cfd6fb61922eae656d4cb31d36", "message": "DHFPROD-6385: Optimize top-level value retrieval for matching", "committedDate": "2021-01-05T21:12:30Z", "type": "forcePushed"}]}