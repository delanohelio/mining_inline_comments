{"pr_number": 3915, "pr_title": "DHFPROD-4804: Added hubVersion Gradle task", "pr_createdAt": "2020-05-05T03:27:12Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3915", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMzE4Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#discussion_r420213182", "bodyText": "Can we add this file to the updateVersion task that's in root build.gradle?\nThe updateVersion task keeps track of all the hardcoded version locations.", "author": "akshaysonvane", "createdAt": "2020-05-05T15:47:43Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/VersionInfo.java", "diffHunk": "@@ -0,0 +1,55 @@\n+package com.marklogic.hub.impl;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.marklogic.hub.HubClient;\n+import com.marklogic.hub.dataservices.SystemService;\n+\n+import java.io.IOException;\n+import java.io.InputStream;\n+import java.util.Properties;\n+\n+/**\n+ * This is intended to replace some of the Versions class with a HubClient-friendly and non-Spring-dependent way of\n+ * accessing version data.\n+ */\n+public class VersionInfo {\n+\n+    private String hubVersion;\n+    private String markLogicVersion;\n+\n+    public static VersionInfo newVersionInfo(HubClient hubClient) {\n+        JsonNode json = SystemService.on(hubClient.getStagingClient()).getVersions();\n+        return new VersionInfo(\n+            json.get(\"hubVersion\").asText(),\n+            json.get(\"markLogicVersion\").asText()\n+        );\n+    }\n+\n+    private VersionInfo(String hubVersion, String markLogicVersion) {\n+        this.hubVersion = hubVersion;\n+        this.markLogicVersion = markLogicVersion;\n+    }\n+\n+    public String getHubVersion() {\n+        return hubVersion;\n+    }\n+\n+    public String getMarkLogicVersion() {\n+        return markLogicVersion;\n+    }\n+\n+    /**\n+     * @return the version of the build containing this class\n+     */\n+    public static String getBuildVersion() {\n+        Properties properties = new Properties();\n+        try (InputStream inputStream = VersionInfo.class.getClassLoader().getResourceAsStream(\"version.properties\")) {\n+            properties.load(inputStream);\n+        } catch (IOException e) {\n+            throw new RuntimeException(\"Unable to get library version from version.properties, cause: \" + e.getMessage(), e);\n+        }\n+\n+        String version = properties.getProperty(\"version\");\n+        return \"${project.version}\".equals(version) ? \"5.3-SNAPSHOT\" : version;", "originalCommit": "71dc89019b4eae7facf4308b4c597b5b476f0a72", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDQ5ODE3Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3915#discussion_r420498173", "bodyText": "Good idea, done", "author": "rjrudin", "createdAt": "2020-05-06T01:22:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyMDIxMzE4Mg=="}], "type": "inlineReview"}, {"oid": "1905a5375a865da3f373ee713a5b36fb0d0b838c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1905a5375a865da3f373ee713a5b36fb0d0b838c", "message": "DHFPROD-4804: Added hubVersion Gradle task", "committedDate": "2020-05-06T01:22:01Z", "type": "forcePushed"}, {"oid": "ec2ca2e23d427b4545bfed50a31f20a33bad7222", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ec2ca2e23d427b4545bfed50a31f20a33bad7222", "message": "DHFPROD-4804: Added hubVersion Gradle task", "committedDate": "2020-05-06T18:15:47Z", "type": "commit"}, {"oid": "ec2ca2e23d427b4545bfed50a31f20a33bad7222", "url": "https://github.com/marklogic/marklogic-data-hub/commit/ec2ca2e23d427b4545bfed50a31f20a33bad7222", "message": "DHFPROD-4804: Added hubVersion Gradle task", "committedDate": "2020-05-06T18:15:47Z", "type": "forcePushed"}]}