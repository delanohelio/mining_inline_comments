{"pr_number": 3984, "pr_title": "DHFPROD-4671: Add hub-central-load-reader role", "pr_createdAt": "2020-05-21T20:54:27Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3984", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk4OTY3Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3984#discussion_r428989676", "bodyText": "No need to change, but just for future reference, you can do loginAsTestUserWithRoles(\"hub-central-load-reader\")", "author": "rjrudin", "createdAt": "2020-05-22T00:53:59Z", "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/steps/IngestionStepControllerTest.java", "diffHunk": "@@ -46,4 +53,39 @@ void getIngestionSteps() throws Exception {\n                 assertEquals(\"secondStep\", array.get(1).get(\"name\").asText());\n             });\n     }\n+\n+    @Test\n+    void permittedReadUser() throws Exception {\n+        installReferenceModelProject();\n+        postJson(PATH + \"/firstStep\", newDefaultIngestionStep(\"firstStep\"));\n+\n+        setTestUserRoles(\"hub-central-load-reader\");\n+\n+        loginAsTestUser();", "originalCommit": "b3c8ddbd97a125c9dd41ba3761a387e32c7892bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MjEwNw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3984#discussion_r428992107", "bodyText": "I think you can just do getJson here?", "author": "rjrudin", "createdAt": "2020-05-22T01:04:08Z", "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/steps/IngestionStepControllerTest.java", "diffHunk": "@@ -46,4 +53,39 @@ void getIngestionSteps() throws Exception {\n                 assertEquals(\"secondStep\", array.get(1).get(\"name\").asText());\n             });\n     }\n+\n+    @Test\n+    void permittedReadUser() throws Exception {\n+        installReferenceModelProject();\n+        postJson(PATH + \"/firstStep\", newDefaultIngestionStep(\"firstStep\"));\n+\n+        setTestUserRoles(\"hub-central-load-reader\");\n+\n+        loginAsTestUser();\n+\n+        mockMvc.perform(get(PATH + \"/{stepName}\", \"firstStep\")", "originalCommit": "b3c8ddbd97a125c9dd41ba3761a387e32c7892bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MjY1Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3984#discussion_r428992652", "bodyText": "Just an FYI, there's a verifyRequestIsForbidden helper method coming in the 4820 PR. I'll see if I can get that merged into develop tomorrow so you can use it.", "author": "rjrudin", "createdAt": "2020-05-22T01:06:33Z", "path": "marklogic-data-hub-central/src/test/java/com/marklogic/hub/central/controllers/steps/IngestionStepControllerTest.java", "diffHunk": "@@ -46,4 +53,39 @@ void getIngestionSteps() throws Exception {\n                 assertEquals(\"secondStep\", array.get(1).get(\"name\").asText());\n             });\n     }\n+\n+    @Test\n+    void permittedReadUser() throws Exception {\n+        installReferenceModelProject();\n+        postJson(PATH + \"/firstStep\", newDefaultIngestionStep(\"firstStep\"));\n+\n+        setTestUserRoles(\"hub-central-load-reader\");\n+\n+        loginAsTestUser();\n+\n+        mockMvc.perform(get(PATH + \"/{stepName}\", \"firstStep\")\n+                .contentType(MediaType.APPLICATION_JSON)\n+                .session(mockHttpSession))\n+                .andDo(result -> {\n+                    MockHttpServletResponse response = result.getResponse();\n+                    assertEquals(HttpStatus.OK.value(), response.getStatus());\n+                });\n+    }\n+\n+    @Test\n+    void forbiddenReadUser() throws Exception {", "originalCommit": "b3c8ddbd97a125c9dd41ba3761a387e32c7892bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQyODk5MjgzMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3984#discussion_r428992831", "bodyText": "The 4820 PR will also do this automatically for you.", "author": "rjrudin", "createdAt": "2020-05-22T01:07:23Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/impl/HubProjectImpl.java", "diffHunk": "@@ -369,15 +367,16 @@ public Path getCustomMappingFunctionsDir() {\n         writeRoleFile(rolesDir, \"data-hub-common.json\");\n         writeRoleFile(rolesDir, \"data-hub-common-writer.json\");\n         writeRoleFile(rolesDir, \"data-hub-security-internal.json\");\n-        writeRoleFile(rolesDir, \"data-hub-load-data-reader.json\");\n-        writeRoleFile(rolesDir, \"data-hub-load-data-writer.json\");\n+        writeRoleFile(rolesDir, \"data-hub-load-reader.json\");", "originalCommit": "b3c8ddbd97a125c9dd41ba3761a387e32c7892bd", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "1a06dafa3532db6e74d93e5e1f8626712ad8551f", "url": "https://github.com/marklogic/marklogic-data-hub/commit/1a06dafa3532db6e74d93e5e1f8626712ad8551f", "message": "DHFPROD-4671: Add hub-central-load-reader role", "committedDate": "2020-05-26T17:29:39Z", "type": "forcePushed"}, {"oid": "fd5b9dc7c5db7b0edfc7dd114ff294bf7ccee5c8", "url": "https://github.com/marklogic/marklogic-data-hub/commit/fd5b9dc7c5db7b0edfc7dd114ff294bf7ccee5c8", "message": "DHFPROD-4671: Add hub-central-load-reader role", "committedDate": "2020-05-26T19:02:24Z", "type": "forcePushed"}, {"oid": "9689021f3ee50254dcd0930bd66d59682ac5ed2b", "url": "https://github.com/marklogic/marklogic-data-hub/commit/9689021f3ee50254dcd0930bd66d59682ac5ed2b", "message": "DHFPROD-4671: Add hub-central-load-reader role", "committedDate": "2020-05-26T19:43:27Z", "type": "forcePushed"}, {"oid": "dae0f38d865ccaa14bac8858862d50f15b600db0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/dae0f38d865ccaa14bac8858862d50f15b600db0", "message": "DHFPROD-4671: Add hub-central-load-reader role", "committedDate": "2020-05-26T22:05:46Z", "type": "commit"}, {"oid": "dae0f38d865ccaa14bac8858862d50f15b600db0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/dae0f38d865ccaa14bac8858862d50f15b600db0", "message": "DHFPROD-4671: Add hub-central-load-reader role", "committedDate": "2020-05-26T22:05:46Z", "type": "forcePushed"}]}