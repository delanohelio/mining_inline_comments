{"pr_number": 4194, "pr_title": "DHFPROD-5047: Endpoint for list of all steps", "pr_createdAt": "2020-07-09T17:53:24Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4194", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNzAxMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452407012", "bodyText": "Pinging @bsrikan and @srinathgit  about this - the issue with our use of \"name\" on a step document will impact an entity \"name\" property with a range index on it (flow documents do the same).\nI am thinking we could kill two birds with one stone here - I think it's very common to need the ID and name from a set of documents, and thus it's common to add range indexes to those. \"stepId\" is a good name, but \"name\" of course is not for a range index.\nHow about if - as part of migration for 5.3 - we use \"stepName\" instead of \"name\" in step documents and add range indexes for stepId and stepName to the staging and final databases? I think that's a good use of indexes. We'd then just do a new DS endpoint that retrieves the ID and name properties for all steps (it looks like \"false\" is always the 3rd parameter, so that's not really needed?).", "author": "rjrudin", "createdAt": "2020-07-09T18:22:19Z", "path": "marklogic-data-hub-central/src/main/java/com/marklogic/hub/central/controllers/steps/StepController.java", "diffHunk": "@@ -0,0 +1,46 @@\n+package com.marklogic.hub.central.controllers.steps;\n+\n+import com.fasterxml.jackson.databind.JsonNode;\n+import com.fasterxml.jackson.databind.ObjectMapper;\n+import com.fasterxml.jackson.databind.node.ObjectNode;\n+import com.marklogic.hub.central.controllers.BaseController;\n+import com.marklogic.hub.dataservices.ArtifactService;\n+import io.swagger.annotations.ApiOperation;\n+import org.springframework.http.ResponseEntity;\n+import org.springframework.security.access.annotation.Secured;\n+import org.springframework.stereotype.Controller;\n+import org.springframework.web.bind.annotation.RequestMapping;\n+import org.springframework.web.bind.annotation.RequestMethod;\n+\n+import java.util.List;\n+import java.util.stream.Stream;\n+\n+@Controller\n+@RequestMapping(\"/api/steps\")\n+public class StepController extends BaseController {\n+    @RequestMapping(method = RequestMethod.GET)\n+    @ApiOperation(value = \"Get all steps grouped by type\", response = Steps.class)\n+    @Secured(\"ROLE_readFlow\")\n+    public ResponseEntity<JsonNode> get() {\n+        ObjectNode response = new ObjectMapper().createObjectNode();\n+        ArtifactService service = newArtifactService();\n+        response.set(\"ingestionSteps\", service.getList(\"ingestion\", Stream.of(\"stepId\", \"name\"), false));", "originalCommit": "127a4c9221a8651b83569357f5b27f2b6b7670e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3MTA0MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452471040", "bodyText": "@rjrudin ,\nI am ok with changing \"name\" to \"stepName\" and having range index on \"stepName\" and \"stepId\". In addition to flow migration, we will also have to change it back to \"name\" in getFullFlow() method  (in core.sjs)", "author": "srinathgit", "createdAt": "2020-07-09T20:28:05Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNzAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ3Nzc0MA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452477740", "bodyText": "Is this something to cover in this PR?", "author": "ryanjdew", "createdAt": "2020-07-09T20:41:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNzAxMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ4MDE5OA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452480198", "bodyText": "I think it would be a separate JIRA ticket so we could fully think through it. It does seem worthwhile to change \"name\" to \"stepName\" as part of 5.3.0.", "author": "rjrudin", "createdAt": "2020-07-09T20:46:41Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQwNzAxMg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQzNzI3Mg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452437272", "bodyText": "Rather than changing the getList() method here, will it be easier to add a DS endpoint to StepService (something like getAllSteps.sjs), where we can get all ingestion, mapping (custom in the future) steps and return them ?", "author": "srinathgit", "createdAt": "2020-07-09T19:19:34Z", "path": "marklogic-data-hub/src/main/java/com/marklogic/hub/dataservices/ArtifactService.java", "diffHunk": "@@ -301,9 +302,11 @@ private ArtifactServiceImpl(DatabaseClient dbClient, JSONWriteHandle servDecl) {\n    * Invokes the getList operation on the database server\n    *\n    * @param artifactType\tprovides input\n+   * @param propertiesToReturn\tList of properties to return. Default behavior returns all properties\n+   * @param groupByEntityType\tIf true, artifacts are grouped by Entity Type; default varies by artifact. Artifact types with entity type relationships default to true.\n    * @return\tas output\n    */\n-    com.fasterxml.jackson.databind.JsonNode getList(String artifactType);\n+    com.fasterxml.jackson.databind.JsonNode getList(String artifactType, Stream<String> propertiesToReturn, Boolean groupByEntityType);", "originalCommit": "127a4c9221a8651b83569357f5b27f2b6b7670e9", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQ0MTM5MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452441391", "bodyText": "I agree with that - I think the artifact library is useful for reuse below the service level, but at the service level, life is generally easier with lots of fine-grained endpoints as opposed to fewer coarse-grained ones.", "author": "rjrudin", "createdAt": "2020-07-09T19:27:37Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQzNzI3Mg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjUwMzg2Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4194#discussion_r452503866", "bodyText": "Moved to separate DS endpoint.", "author": "ryanjdew", "createdAt": "2020-07-09T21:35:56Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ1MjQzNzI3Mg=="}], "type": "inlineReview"}, {"oid": "aab7f1f0956deb3aa4622e4aa62f673ebe8c6365", "url": "https://github.com/marklogic/marklogic-data-hub/commit/aab7f1f0956deb3aa4622e4aa62f673ebe8c6365", "message": "DHFPROD-5047: Endpoint for list of all steps", "committedDate": "2020-07-09T21:15:49Z", "type": "forcePushed"}, {"oid": "168ac32b477694e710be90e4242c26cb4d13e8e0", "url": "https://github.com/marklogic/marklogic-data-hub/commit/168ac32b477694e710be90e4242c26cb4d13e8e0", "message": "DHFPROD-5047: Endpoint for list of all steps", "committedDate": "2020-07-10T18:37:08Z", "type": "forcePushed"}, {"oid": "5d3c8e16d8cf347d0b6162af8c93514929c105aa", "url": "https://github.com/marklogic/marklogic-data-hub/commit/5d3c8e16d8cf347d0b6162af8c93514929c105aa", "message": "DHFPROD-5047: Endpoint for list of all steps", "committedDate": "2020-07-13T19:25:00Z", "type": "forcePushed"}, {"oid": "b0543058e3309a3dcdfd73393d8d505775f74293", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b0543058e3309a3dcdfd73393d8d505775f74293", "message": "DHFPROD-5047: Endpoint for list of all steps", "committedDate": "2020-07-13T19:42:04Z", "type": "commit"}, {"oid": "b0543058e3309a3dcdfd73393d8d505775f74293", "url": "https://github.com/marklogic/marklogic-data-hub/commit/b0543058e3309a3dcdfd73393d8d505775f74293", "message": "DHFPROD-5047: Endpoint for list of all steps", "committedDate": "2020-07-13T19:42:04Z", "type": "forcePushed"}]}