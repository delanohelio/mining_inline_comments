{"pr_number": 4654, "pr_title": "DHFPROD-5865: Generate explorer search options w/o conflicting with entity-type name", "pr_createdAt": "2020-10-01T17:50:01Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/4654", "timeline": [{"oid": "d5ad9b99446cd5fad5f1b80d883e115a50a69f66", "url": "https://github.com/marklogic/marklogic-data-hub/commit/d5ad9b99446cd5fad5f1b80d883e115a50a69f66", "message": "DHFPROD-5865: Generate explorer search options w/o conflicting with entity-type name\nAlso removed exp-default.xml staging and final options that arent used anymore", "committedDate": "2020-10-05T18:11:58Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc4OTUzOA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4654#discussion_r499789538", "bodyText": "This is good, but the test needs to assert two more things - that the \"default\" options were written to src/main/entity-config in the project directory, and that they are not in the modules database because of the conflict between Collection constraints.", "author": "rjrudin", "createdAt": "2020-10-05T18:26:05Z", "path": "marklogic-data-hub/src/test/java/com/marklogic/hub/entity/EntityManagerTest.java", "diffHunk": "@@ -191,6 +194,33 @@ public void overrideExistingExplorerOptions() {\n         assertTrue(newStagingOptionsTimeStamp > oldStagingOptionsTimeStamp);\n     }\n \n+    @Test\n+    public void deployExplorerOptionsWithoutContainerConstraint() {\n+        Path entitiesDir = getHubProject().getHubEntitiesDir();\n+        if (!entitiesDir.toFile().exists()) {\n+            entitiesDir.toFile().mkdirs();\n+        }\n+        FileUtil.copy(getResourceStream(\"scaffolding-test/Collection.entity.json\"),\n+                entitiesDir.resolve(\"Collection.entity.json\").toFile());\n+\n+        runAsDataHubDeveloper();\n+        entityManager.deployQueryOptions();\n+\n+        runAsAdmin();\n+        Stream.of(HubConfig.DEFAULT_STAGING_NAME, HubConfig.DEFAULT_FINAL_NAME)\n+                .forEach(dbName -> assertNull(getModulesFile(\"/Default/\" + dbName + \"/rest-api/options/exp-default.xml\"), \"Did not expect exp-default.xml options file in \" + dbName + \"since we dont use it anymore.\"));\n+\n+        String stagingExplorerOptions = getModulesFile(\"/Default/\" + HubConfig.DEFAULT_STAGING_NAME + \"/rest-api/options/\" + HubConfig.EXP_STAGING_ENTITY_QUERY_OPTIONS_FILE);\n+        String finalExplorerOptions = getModulesFile(\"/Default/\" + HubConfig.DEFAULT_FINAL_NAME + \"/rest-api/options/\" + HubConfig.EXP_FINAL_ENTITY_QUERY_OPTIONS_FILE);\n+\n+        Stream.of(stagingExplorerOptions, finalExplorerOptions).forEach(option -> {", "originalCommit": "d5ad9b99446cd5fad5f1b80d883e115a50a69f66", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTgxOTA3Ng==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/4654#discussion_r499819076", "bodyText": "Updated the tests.", "author": "akshaysonvane", "createdAt": "2020-10-05T19:22:14Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5OTc4OTUzOA=="}], "type": "inlineReview"}, {"oid": "a7b5309be26f457770a2b2f168cce55363911a07", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a7b5309be26f457770a2b2f168cce55363911a07", "message": "DHFPROD-5865: Generate explorer search options w/o conflicting with entity-type name\nAlso removed exp-default.xml staging and final options that arent used anymore", "committedDate": "2020-10-05T19:20:02Z", "type": "commit"}, {"oid": "a7b5309be26f457770a2b2f168cce55363911a07", "url": "https://github.com/marklogic/marklogic-data-hub/commit/a7b5309be26f457770a2b2f168cce55363911a07", "message": "DHFPROD-5865: Generate explorer search options w/o conflicting with entity-type name\nAlso removed exp-default.xml staging and final options that arent used anymore", "committedDate": "2020-10-05T19:20:02Z", "type": "forcePushed"}]}