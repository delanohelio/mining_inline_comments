{"pr_number": 3706, "pr_title": "DHFPROD-4519: Inherit from \"data-hub-module-reader\" role ", "pr_createdAt": "2020-03-16T21:19:00Z", "pr_url": "https://github.com/marklogic/marklogic-data-hub/pull/3706", "timeline": [{"oid": "2245169212d6f17458e4242d07cff74d41f0cb57", "url": "https://github.com/marklogic/marklogic-data-hub/commit/2245169212d6f17458e4242d07cff74d41f0cb57", "message": "DHFPROD-4519: Inherit from \"data-hub-module-reader\" role to access data service", "committedDate": "2020-03-16T21:11:55Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NTYyNg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393365626", "bodyText": "Do we have test for this in place?", "author": "bsrikan", "createdAt": "2020-03-16T23:25:25Z", "path": "one-ui/src/main/java/com/marklogic/hub/oneui/managers/ModelManager.java", "diffHunk": "@@ -182,18 +182,6 @@ public JsonNode getLatestJobInfo(String modelName) {\n     }\n \n     JsonNode getJobInfoFromDB(DatabaseClient dbClient, String modelName) {\n-        JsonNode node = null;\n-        try {\n-            node = JobInfo.on(dbClient).getLatestJobData(modelName);\n-        }\n-        catch (MarkLogicServerException e) {\n-            /*\n-             * As MarkLogic server throws a FailedRequestException for both data-service module not found\n-             * and if the user is unauthorized to access the module; we need to fail silently and log the\n-             * issue.\n-             */\n-            logger.error(e.getMessage());\n-        }\n-        return node;\n+        return JobInfo.on(dbClient).getLatestJobData(modelName);\n     }", "originalCommit": "2245169212d6f17458e4242d07cff74d41f0cb57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3NDYyMQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393374621", "bodyText": "Yes, the data service is tested via ml-unit-test", "author": "akshaysonvane", "createdAt": "2020-03-16T23:57:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NTYyNg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM3NDcyMg==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393374722", "bodyText": "This PR just removes the try/catch block surrounding the code.", "author": "akshaysonvane", "createdAt": "2020-03-16T23:58:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzM2NTYyNg=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNTQ2MQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393635461", "bodyText": "I think the client should just call JobInfo then - there's no point in having this additional layer to go through. If we did keep it, I think we'd want the method names to be the same - i.e. the Manager method should be getLatestJobData.", "author": "rjrudin", "createdAt": "2020-03-17T12:15:33Z", "path": "one-ui/src/main/java/com/marklogic/hub/oneui/managers/ModelManager.java", "diffHunk": "@@ -182,18 +182,6 @@ public JsonNode getLatestJobInfo(String modelName) {\n     }\n \n     JsonNode getJobInfoFromDB(DatabaseClient dbClient, String modelName) {\n-        JsonNode node = null;\n-        try {\n-            node = JobInfo.on(dbClient).getLatestJobData(modelName);\n-        }\n-        catch (MarkLogicServerException e) {\n-            /*\n-             * As MarkLogic server throws a FailedRequestException for both data-service module not found\n-             * and if the user is unauthorized to access the module; we need to fail silently and log the\n-             * issue.\n-             */\n-            logger.error(e.getMessage());\n-        }\n-        return node;\n+        return JobInfo.on(dbClient).getLatestJobData(modelName);", "originalCommit": "2245169212d6f17458e4242d07cff74d41f0cb57", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgwNDQzOQ==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393804439", "bodyText": "The separate method is used for mocking the database call in the ModelManagerTest class\ndoReturn(expectedNode).when(modelManager).getJobInfoFromDB(dataServiceClient, modelName);\n\nI'll change the method name to getLatestJobData", "author": "akshaysonvane", "createdAt": "2020-03-17T16:22:02Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNTQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzgzMDM4Mw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393830383", "bodyText": "Can you mock ArtifactsService instead? That's supposed to be one of the benefits of data services - that there's an interface class that can be mocked for testing purposes.", "author": "rjrudin", "createdAt": "2020-03-17T16:59:28Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNTQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5Mzg0MDMyMA==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393840320", "bodyText": "But - if it's easier to just mock a single thing - i.e. ModelManager - that's fine too.", "author": "rjrudin", "createdAt": "2020-03-17T17:14:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNTQ2MQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzkyNjAyMw==", "url": "https://github.com/marklogic/marklogic-data-hub/pull/3706#discussion_r393926023", "bodyText": "Can you mock ArtifactsService instead? That's supposed to be one of the benefits of data services - that there's an interface class that can be mocked for testing purposes.\n\nBy ArtifactsService I am guessing you mean the JobInfo interface that was generated by the data service.\nJobInfo has a static on method which we call as\nJobInfo.on(finalDataServiceClient).getLatestJobData(s)\n\nI believe mockito does not support mocking static stuff and would require us to use a testing framework like powermockito.\nHence, in this case, it's simpler to just mock the getLatestJobData  method of ModelManager.", "author": "akshaysonvane", "createdAt": "2020-03-17T19:42:53Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM5MzYzNTQ2MQ=="}], "type": "inlineReview"}, {"oid": "48cbd141d10bdad23be700f88599f402b46a2c6c", "url": "https://github.com/marklogic/marklogic-data-hub/commit/48cbd141d10bdad23be700f88599f402b46a2c6c", "message": "DHFPROD-4519: Refactor method name", "committedDate": "2020-03-17T16:24:39Z", "type": "commit"}]}