{"pr_number": 2200, "pr_title": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "pr_createdAt": "2020-10-05T07:54:51Z", "pr_url": "https://github.com/zkoss/zk/pull/2200", "timeline": [{"oid": "05b03be30db67b0046562dda92f1091121307ca9", "url": "https://github.com/zkoss/zk/commit/05b03be30db67b0046562dda92f1091121307ca9", "message": "refine ZK-4552: ignore null value in positional command params", "committedDate": "2020-10-05T08:25:47Z", "type": "forcePushed"}, {"oid": "b36e200b6320ac1757d59fe542c3472e3d072cb8", "url": "https://github.com/zkoss/zk/commit/b36e200b6320ac1757d59fe542c3472e3d072cb8", "message": "refine ZK-4552: ignore null value in positional command params", "committedDate": "2020-10-05T09:35:14Z", "type": "forcePushed"}, {"oid": "1d5226216b9483289c84a9042426809d7bbaf5b7", "url": "https://github.com/zkoss/zk/commit/1d5226216b9483289c84a9042426809d7bbaf5b7", "message": "refine ZK-4552: ignore null value in positional command params", "committedDate": "2020-10-05T10:13:47Z", "type": "forcePushed"}, {"oid": "f81cbd04c6c95cbc97059dfb5b7094c505cdbeb2", "url": "https://github.com/zkoss/zk/commit/f81cbd04c6c95cbc97059dfb5b7094c505cdbeb2", "message": "refine ZK-4552: ignore null value in positional command params", "committedDate": "2020-10-06T01:45:21Z", "type": "forcePushed"}, {"oid": "b29966223320fd077190710d4b593997e7070389", "url": "https://github.com/zkoss/zk/commit/b29966223320fd077190710d4b593997e7070389", "message": "refine ZK-4552: ignore null value in positional command params", "committedDate": "2020-10-06T02:16:17Z", "type": "forcePushed"}, {"oid": "fc85a80ee863eb11a936e2c0fb1d8998f653ab75", "url": "https://github.com/zkoss/zk/commit/fc85a80ee863eb11a936e2c0fb1d8998f653ab75", "message": "refine ZK-4552: ignore null value in positional command params", "committedDate": "2020-10-06T02:16:41Z", "type": "forcePushed"}, {"oid": "f67d791278e712e8cf358fa9de1b8d7829b2b20e", "url": "https://github.com/zkoss/zk/commit/f67d791278e712e8cf358fa9de1b8d7829b2b20e", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T02:17:49Z", "type": "forcePushed"}, {"oid": "57e4383e58fa1f58564b10efe5862c9324d64757", "url": "https://github.com/zkoss/zk/commit/57e4383e58fa1f58564b10efe5862c9324d64757", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T02:19:00Z", "type": "forcePushed"}, {"oid": "c95e1bafd83d3cbecaf65c2023521118e2a394f9", "url": "https://github.com/zkoss/zk/commit/c95e1bafd83d3cbecaf65c2023521118e2a394f9", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T02:28:27Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyODAxNw==", "url": "https://github.com/zkoss/zk/pull/2200#discussion_r500128017", "bodyText": "move to resolvePositionalParameter", "author": "scribetw", "createdAt": "2020-10-06T09:17:42Z", "path": "zkbind/src/org/zkoss/bind/impl/ParamCall.java", "diffHunk": "@@ -208,8 +209,16 @@ private Object resolveParameter(Annotation[] parmAnnos, Class<?> paramType, Stri\n \t\t\t\t}\n \t\t\t}\n \t\t}\n-\t\tif (val == null)\n+\t\tif (val == null && _bindingArgs != null && index < _bindingArgs.size()) {\n+\t\t\tint argIndex = 0;\n+\t\t\tfor (Map.Entry<String, Object> entry : _bindingArgs.entrySet()) {\n+\t\t\t\t// skip using positional if the param key is not auto-generated\n+\t\t\t\tif (argIndex == index && !entry.getKey().startsWith(Parser.SIMPLIFIED_COMMAND_PARAM_PREFIX))\n+\t\t\t\t\treturn null;\n+\t\t\t\targIndex++;\n+\t\t\t}\n \t\t\tval = resolvePositionalParameter(paramType, index);", "originalCommit": "c95e1bafd83d3cbecaf65c2023521118e2a394f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEyOTgxNg==", "url": "https://github.com/zkoss/zk/pull/2200#discussion_r500129816", "bodyText": "add \",\"", "author": "scribetw", "createdAt": "2020-10-06T09:20:31Z", "path": "zktest/src/org/zkoss/zktest/test2/B95_ZK_4688VM.java", "diffHunk": "@@ -0,0 +1,44 @@\n+package org.zkoss.zktest.test2;\r\n+\r\n+import java.util.Calendar;\r\n+import java.util.Date;\r\n+import java.util.HashMap;\r\n+import java.util.Locale;\r\n+import java.util.Map;\r\n+\r\n+import org.zkoss.bind.BindUtils;\r\n+import org.zkoss.bind.annotation.BindingParam;\r\n+import org.zkoss.bind.annotation.Command;\r\n+import org.zkoss.bind.annotation.GlobalCommand;\r\n+import org.zkoss.bind.annotation.NotifyChange;\r\n+\r\n+public class B95_ZK_4688VM {\r\n+\r\n+\tprivate String result = \"\";\r\n+\r\n+\t@GlobalCommand\r\n+\t@NotifyChange(\"result\")\r\n+\tpublic void stopSetup(@BindingParam(\"finishDate\") Date when, @BindingParam(\"setupQty\") int setupQty,\r\n+\t\t\t@BindingParam(\"reason\") Locale reason) {\r\n+\t\tresult = when + \",\" + setupQty + reason;\r", "originalCommit": "c95e1bafd83d3cbecaf65c2023521118e2a394f9", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "0d127af923bfdfd74f40e6100f7670e9d3591f53", "url": "https://github.com/zkoss/zk/commit/0d127af923bfdfd74f40e6100f7670e9d3591f53", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T09:23:47Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwMDEzMzYzOA==", "url": "https://github.com/zkoss/zk/pull/2200#discussion_r500133638", "bodyText": "++", "author": "scribetw", "createdAt": "2020-10-06T09:26:41Z", "path": "zkbind/src/org/zkoss/bind/impl/ParamCall.java", "diffHunk": "@@ -218,14 +219,14 @@ private Object resolveParameter(Annotation[] parmAnnos, Class<?> paramType, Stri\n \tprivate Object resolvePositionalParameter(Class<?> returnType, int index) {\n \t\tObject val = null;\n \t\tif (_bindingArgs != null) {\n-\t\t\tCollection<Object> values = _bindingArgs.values();\n-\t\t\tint i = 0;\n-\t\t\tfor (Object v : values) {\n-\t\t\t\tif (index == i) {\n-\t\t\t\t\tval = v;\n+\t\t\tint argIndex = 0;\n+\t\t\tfor (Map.Entry<String, Object> entry : _bindingArgs.entrySet()) {\n+\t\t\t\t// skip using positional if the param key is not auto-generated\n+\t\t\t\tif (argIndex == index) {\n+\t\t\t\t\tif (entry.getKey().startsWith(Parser.SIMPLIFIED_COMMAND_PARAM_PREFIX))\n+\t\t\t\t\t\tval = entry.getValue();\n \t\t\t\t\tbreak;\n \t\t\t\t}\n-\t\t\t\ti++;", "originalCommit": "0d127af923bfdfd74f40e6100f7670e9d3591f53", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "855170ee9e0cad917b5d2ceec4f5563ada756896", "url": "https://github.com/zkoss/zk/commit/855170ee9e0cad917b5d2ceec4f5563ada756896", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T09:30:07Z", "type": "forcePushed"}, {"oid": "26452b418b66b1a682be06274842b86849e5f9cf", "url": "https://github.com/zkoss/zk/commit/26452b418b66b1a682be06274842b86849e5f9cf", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T10:05:55Z", "type": "forcePushed"}, {"oid": "0b43214faae70273a0622425f84f88d9b34b5849", "url": "https://github.com/zkoss/zk/commit/0b43214faae70273a0622425f84f88d9b34b5849", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T10:09:31Z", "type": "commit"}, {"oid": "0b43214faae70273a0622425f84f88d9b34b5849", "url": "https://github.com/zkoss/zk/commit/0b43214faae70273a0622425f84f88d9b34b5849", "message": "ZK-4688: A null parameter passed to a global command causes ClassCastException", "committedDate": "2020-10-06T10:09:31Z", "type": "forcePushed"}]}