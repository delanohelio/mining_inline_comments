{"pr_number": 6331, "pr_title": "Reduce average query size sent to Solr", "pr_createdAt": "2020-09-17T21:53:37Z", "pr_url": "https://github.com/codice/ddf/pull/6331", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU5NDI3OA==", "url": "https://github.com/codice/ddf/pull/6331#discussion_r490594278", "bodyText": "\u2753  Should we filter blank strings to account for redundant commas in the system property?", "author": "Lambeaux", "createdAt": "2020-09-17T22:21:36Z", "path": "catalog/solr/catalog-solr-core/src/main/java/ddf/catalog/source/solr/DynamicSchemaResolver.java", "diffHunk": "@@ -906,7 +834,24 @@ String getSortKey(String field) {\n   }\n \n   Stream<String> anyTextFields() {\n-    return filteredAnyTextFieldsCache.stream();\n+    return anyTextFields.stream();\n+  }\n+\n+  private Set<String> getAnyTextFields() {\n+    String property =\n+        AccessController.doPrivileged(\n+            (PrivilegedAction<String>) () -> System.getProperty(SOLR_ANYTEXT_FIELDS, \"\"));\n+\n+    List<String> fields;\n+    if (property.isEmpty()) {\n+      fields = Arrays.asList(Metacard.METADATA, Metacard.TITLE, Metacard.DESCRIPTION);\n+    } else {\n+      fields = Arrays.asList(property.split(\",\"));\n+    }\n+\n+    return fields.stream()", "originalCommit": "b51eee03961016b9b0d74ce2182a2955bf423fc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU5NzU5Mg==", "url": "https://github.com/codice/ddf/pull/6331#discussion_r490597592", "bodyText": "\u2753 Would it be worth adding a test for that case as well?", "author": "Lambeaux", "createdAt": "2020-09-17T22:30:39Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU5NDI3OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwMzAwMA==", "url": "https://github.com/codice/ddf/pull/6331#discussion_r490603000", "bodyText": "Probably not a bad idea.  I can also look at removing whitespace padding too if it is present.", "author": "pklinef", "createdAt": "2020-09-17T22:45:15Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU5NDI3OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU5NzI1Nw==", "url": "https://github.com/codice/ddf/pull/6331#discussion_r490597257", "bodyText": "\u2753  Not sure how meaningful the implications are of not sending the spell check option to Solr. Worth writing a test for it?", "author": "Lambeaux", "createdAt": "2020-09-17T22:29:49Z", "path": "catalog/solr/catalog-solr-core/src/test/java/ddf/catalog/source/solr/provider/SolrProviderQuery.java", "diffHunk": "@@ -766,37 +763,6 @@ public void testContextualAnyText() throws Exception {\n         1, getFilterBuilder().attribute(Metacard.ANY_TEXT).is().like().text(soughtWord), provider);\n   }\n \n-  @Test\n-  public void testQueryExcludedAttributes() throws Exception {", "originalCommit": "b51eee03961016b9b0d74ce2182a2955bf423fc0", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDYwMjM5NQ==", "url": "https://github.com/codice/ddf/pull/6331#discussion_r490602395", "bodyText": "Not sending it is the default.  It is what we were doing before the spell check PR.\nhttps://lucene.apache.org/solr/guide/8_6/spell-checking.html#spell-check-parameters", "author": "pklinef", "createdAt": "2020-09-17T22:43:32Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ5MDU5NzI1Nw=="}], "type": "inlineReview"}, {"oid": "26c4ff6c75e58834351ff75a9116ab6e5fba0ad1", "url": "https://github.com/codice/ddf/commit/26c4ff6c75e58834351ff75a9116ab6e5fba0ad1", "message": "Reduce average query size sent to Solr\n\n- Removes the dynamic generation of AnyText fields. This creates poor\n  query performance when expanding to hundreds of fields.\n- Removes filtered attribute feature that generated large field lists\n  but failed to significantly reduce query time for majority of\n  queries.\n- Removes spellcheck parameter if spell check is not enabled for the\n  query.\n- Removes score from field list if not sorting by relevance.", "committedDate": "2020-09-17T22:41:35Z", "type": "forcePushed"}, {"oid": "1f9d39119bd19ed691d264ecd35008ef29147017", "url": "https://github.com/codice/ddf/commit/1f9d39119bd19ed691d264ecd35008ef29147017", "message": "Reduce average query size sent to Solr\n\n- Removes the dynamic generation of AnyText fields. This creates poor\n  query performance when expanding to hundreds of fields.\n- Removes filtered attribute feature that generated large field lists\n  but failed to significantly reduce query time for majority of\n  queries.\n- Removes spellcheck parameter if spell check is not enabled for the\n  query.\n- Removes score from field list if not sorting by relevance.", "committedDate": "2020-09-17T23:00:03Z", "type": "forcePushed"}, {"oid": "10a7b4585bac77908024fd95d84a96f02849ecc1", "url": "https://github.com/codice/ddf/commit/10a7b4585bac77908024fd95d84a96f02849ecc1", "message": "Reduce average query size sent to Solr\n\n- Removes the dynamic generation of AnyText fields. This creates poor\n  query performance when expanding to hundreds of fields.\n- Removes filtered attribute feature that generated large field lists\n  but failed to significantly reduce query time for majority of\n  queries.\n- Removes spellcheck parameter if spell check is not enabled for the\n  query.\n- Removes score from field list if not sorting by relevance.", "committedDate": "2020-09-17T23:19:32Z", "type": "forcePushed"}, {"oid": "7c76592c64dc444bcdd1af420934ce748ef0d2b6", "url": "https://github.com/codice/ddf/commit/7c76592c64dc444bcdd1af420934ce748ef0d2b6", "message": "Reduce average query size sent to Solr\n\n- Removes the dynamic generation of AnyText fields. This creates poor\n  query performance when expanding to hundreds of fields.\n- Removes filtered attribute feature that generated large field lists\n  but failed to significantly reduce query time for majority of\n  queries.\n- Removes spellcheck parameter if spell check is not enabled for the\n  query.\n- Removes score from field list if not sorting by relevance.", "committedDate": "2020-09-21T18:23:18Z", "type": "commit"}, {"oid": "7c76592c64dc444bcdd1af420934ce748ef0d2b6", "url": "https://github.com/codice/ddf/commit/7c76592c64dc444bcdd1af420934ce748ef0d2b6", "message": "Reduce average query size sent to Solr\n\n- Removes the dynamic generation of AnyText fields. This creates poor\n  query performance when expanding to hundreds of fields.\n- Removes filtered attribute feature that generated large field lists\n  but failed to significantly reduce query time for majority of\n  queries.\n- Removes spellcheck parameter if spell check is not enabled for the\n  query.\n- Removes score from field list if not sorting by relevance.", "committedDate": "2020-09-21T18:23:18Z", "type": "forcePushed"}]}