{"pr_number": 1783, "pr_title": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter", "pr_createdAt": "2020-12-15T13:43:42Z", "pr_url": "https://github.com/apache/hive/pull/1783", "timeline": [{"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469", "url": "https://github.com/apache/hive/commit/307c9ebe68f3b98035aa5ded5660e802bfcd5469", "message": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter\n\nChange-Id: I7009a15ac8c135633b516583428be2812ecd3574", "committedDate": "2020-12-15T16:47:40Z", "type": "commit"}, {"oid": "307c9ebe68f3b98035aa5ded5660e802bfcd5469", "url": "https://github.com/apache/hive/commit/307c9ebe68f3b98035aa5ded5660e802bfcd5469", "message": "HIVE-24539: OrcInputFormat schema generation should respect column delimiter\n\nChange-Id: I7009a15ac8c135633b516583428be2812ecd3574", "committedDate": "2020-12-15T16:47:40Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NTk2OQ==", "url": "https://github.com/apache/hive/pull/1783#discussion_r544085969", "bodyText": "this makes me think that in order to use commas in column names, you need to define another column name delimiter, otherwise those are cannot be distinguished from each other, right?\nI mean, could you please include an example where the configuration can be used for this purpose? I haven't seen that in q test, what's the valid use-case for multiple columns? what happens if you try to do something like:\ncreate table test_n4 (`x,y` int, z int);\nselect `x,y`, z from test_n4 where `x,y` >= 2 and z = 0;\n\nother than this, the patch is simple and neat, which I like :)", "author": "abstractdog", "createdAt": "2020-12-16T07:58:19Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/io/orc/OrcInputFormat.java", "diffHunk": "@@ -2675,12 +2676,13 @@ public static TypeDescription convertTypeInfo(TypeInfo info) {\n   public static TypeDescription getDesiredRowTypeDescr(Configuration conf,\n                                                        boolean isAcidRead,\n                                                        int dataColumns) {\n-\n     String columnNameProperty = null;\n     String columnTypeProperty = null;\n \n     ArrayList<String> schemaEvolutionColumnNames = null;\n     ArrayList<TypeDescription> schemaEvolutionTypeDescrs = null;\n+    // Make sure we split colNames using the right Delimiter\n+    final String columnNameDelimiter = conf.get(serdeConstants.COLUMN_NAME_DELIMITER, String.valueOf(SerDeUtils.COMMA));", "originalCommit": "307c9ebe68f3b98035aa5ded5660e802bfcd5469", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDIzMzQ4OA==", "url": "https://github.com/apache/hive/pull/1783#discussion_r544233488", "bodyText": "Hey @abstractdog  thanks for taking a look!\n\nthis makes me think that in order to use commas in column names, you need to define another column name delimiter, otherwise those are cannot be distinguished from each other, right?\n\nWe already check this corner case when creating the TableDesc \n  \n    \n      hive/ql/src/java/org/apache/hadoop/hive/ql/plan/PlanUtils.java\n    \n    \n         Line 562\n      in\n      95f3d65\n    \n    \n    \n    \n\n        \n          \n           serdeConstants.COLUMN_NAME_DELIMITER, MetaStoreUtils.getColumnNameDelimiter(fieldSchemas), \n        \n    \n  \n\n\nhttps://github.com/pgaref/hive/blob/0d2b39ac180d809788f662fbe3271482cd4d909d/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/utils/MetaStoreUtils.java#L1562\ngetColumnNameDelimiter method actually checks for commas in colNames and uses \\0 to split them instead.\nThis PR is just making use of the custom delimiter that was forgotten for OrcInputFormat but is done for others e.g., OrcOutputFormat\nIn your example above the DELIMITER will be \\0 to avoid colName splitting issues", "author": "pgaref", "createdAt": "2020-12-16T11:46:22Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NTk2OQ=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU1MzI1OTIzNA==", "url": "https://github.com/apache/hive/pull/1783#discussion_r553259234", "bodyText": "cool, thanks for clarifying, LGTM", "author": "abstractdog", "createdAt": "2021-01-07T11:02:49Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0NDA4NTk2OQ=="}], "type": "inlineReview"}]}