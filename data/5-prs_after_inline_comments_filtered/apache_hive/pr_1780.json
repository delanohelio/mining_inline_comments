{"pr_number": 1780, "pr_title": "HIVE-24534 HIVE-24646: Strict checks between decimal/characters & bigint/doubles", "pr_createdAt": "2020-12-14T21:31:43Z", "pr_url": "https://github.com/apache/hive/pull/1780", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3MTExOQ==", "url": "https://github.com/apache/hive/pull/1780#discussion_r543071119", "bodyText": "These rules are seem to be constant. Can you please extract them?\nprivate static final Set<Set<PrimitiveObjectInspector.PrimitiveCategory>> decimalCharacterComparisonRules =\n  Collections.unmodifiableSet(new HashSet<>() {{add(...)...}})", "author": "kasakrisz", "createdAt": "2020-12-15T06:06:24Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/parse/type/TypeCheckProcFactory.java", "diffHunk": "@@ -801,6 +797,22 @@ private boolean unSafeCompareWithBigInt(TypeInfo otherTypeInfo, TypeInfo bigintC\n       }\n       return false;\n     }\n+    \n+    private boolean isDecimalCharacterComparison(TypeInfo type1, TypeInfo type2) {\n+      if(type1 instanceof PrimitiveTypeInfo && type2 instanceof PrimitiveTypeInfo) {\n+        Set<Set<PrimitiveObjectInspector.PrimitiveCategory>> comparisons = new HashSet<>(3);\n+        comparisons.add(EnumSet.of(\n+            PrimitiveObjectInspector.PrimitiveCategory.DECIMAL, PrimitiveObjectInspector.PrimitiveCategory.CHAR));\n+        comparisons.add(EnumSet.of(\n+            PrimitiveObjectInspector.PrimitiveCategory.DECIMAL, PrimitiveObjectInspector.PrimitiveCategory.VARCHAR));\n+        comparisons.add(EnumSet.of(", "originalCommit": "0e32034d7236695f19e5663df7720d4f3d44a6c4", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzM4NDE2OA==", "url": "https://github.com/apache/hive/pull/1780#discussion_r543384168", "bodyText": "Fixed in ab7432b. Overall there is more refactoring to be done but I want to keep it in a separate issue.", "author": "zabetak", "createdAt": "2020-12-15T14:19:43Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MzA3MTExOQ=="}], "type": "inlineReview"}, {"oid": "394daf6924ef5580ea48a0d844f013b01ad6ccf4", "url": "https://github.com/apache/hive/commit/394daf6924ef5580ea48a0d844f013b01ad6ccf4", "message": "HIVE-24534: Prevent comparisons between character and decimals types when strict checks enabled", "committedDate": "2021-01-15T19:01:24Z", "type": "commit"}, {"oid": "a1797c1aa38f8cbd59cba2b1e5307763ff1945fc", "url": "https://github.com/apache/hive/commit/a1797c1aa38f8cbd59cba2b1e5307763ff1945fc", "message": "HIVE-24534: Add function call validation tests for chars and decimals", "committedDate": "2021-01-15T19:01:24Z", "type": "commit"}, {"oid": "453f684fe5cdcb2a771ca9e018300fc3a13493f3", "url": "https://github.com/apache/hive/commit/453f684fe5cdcb2a771ca9e018300fc3a13493f3", "message": "HIVE-24534: Minor formatting", "committedDate": "2021-01-15T19:01:24Z", "type": "commit"}, {"oid": "a5937841473755719e24e601991fc060f254b2ca", "url": "https://github.com/apache/hive/commit/a5937841473755719e24e601991fc060f254b2ca", "message": "HIVE-24534: Add qtest negative tests for comparisons between chars and decimals", "committedDate": "2021-01-15T19:01:44Z", "type": "commit"}, {"oid": "b0e5f2b71403e7244a0032c7082d6c62a06f1325", "url": "https://github.com/apache/hive/commit/b0e5f2b71403e7244a0032c7082d6c62a06f1325", "message": "HIVE-24534: Make decimal/character categories a class constant", "committedDate": "2021-01-15T19:01:47Z", "type": "commit"}, {"oid": "6ff5d3602e40b2dcfdc25f11e8fb3f50a7912317", "url": "https://github.com/apache/hive/commit/6ff5d3602e40b2dcfdc25f11e8fb3f50a7912317", "message": "Run LLAP tests with strict type checks enabled", "committedDate": "2021-01-15T19:01:47Z", "type": "commit"}, {"oid": "37e707705c6cc7c025bbe7fb1b67682062dc84c7", "url": "https://github.com/apache/hive/commit/37e707705c6cc7c025bbe7fb1b67682062dc84c7", "message": "HIVE-24534 HIVE-24646: Refactoring for readability and missing functionality\n\nBIG_INT and DOUBLE comparison should fail with strict checks on\naccording to the respective property.", "committedDate": "2021-01-16T00:10:35Z", "type": "commit"}, {"oid": "8714f35d8bd463bb3d67eb6e3bbe21a51ff6b563", "url": "https://github.com/apache/hive/commit/8714f35d8bd463bb3d67eb6e3bbe21a51ff6b563", "message": "HIVE-24534: Update warning messages of TestMiniLlapLocalCliDriver", "committedDate": "2021-01-16T00:10:35Z", "type": "commit"}, {"oid": "410069e7b5ad3930f3057bbea0126c5d4d2cccd9", "url": "https://github.com/apache/hive/commit/410069e7b5ad3930f3057bbea0126c5d4d2cccd9", "message": "HIVE-24534: Update tez_smb_reduce_side.q.out but not sure why it changed", "committedDate": "2021-01-16T00:10:35Z", "type": "commit"}, {"oid": "2692a9e0bb92c22b190668462db0c2efe3333bd5", "url": "https://github.com/apache/hive/commit/2692a9e0bb92c22b190668462db0c2efe3333bd5", "message": "HIVE-24534 HIVE-24646: Update failing LLAP driver tests\n\nDisable hive.strict.type.checks for the respective files.", "committedDate": "2021-01-16T00:11:00Z", "type": "commit"}, {"oid": "2692a9e0bb92c22b190668462db0c2efe3333bd5", "url": "https://github.com/apache/hive/commit/2692a9e0bb92c22b190668462db0c2efe3333bd5", "message": "HIVE-24534 HIVE-24646: Update failing LLAP driver tests\n\nDisable hive.strict.type.checks for the respective files.", "committedDate": "2021-01-16T00:11:00Z", "type": "forcePushed"}, {"oid": "e67a8c655aba72bd13ebb4efb4f537c5bca423fe", "url": "https://github.com/apache/hive/commit/e67a8c655aba72bd13ebb4efb4f537c5bca423fe", "message": "HIVE-24534: Update tez_smb_reduce_side.q.out file", "committedDate": "2021-01-18T08:58:43Z", "type": "commit"}]}