{"pr_number": 1580, "pr_title": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types b\u2026", "pr_createdAt": "2020-10-14T14:30:32Z", "pr_url": "https://github.com/apache/hive/pull/1580", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NjYwMg==", "url": "https://github.com/apache/hive/pull/1580#discussion_r504976602", "bodyText": "keyStoreAlgorithm looks unused? Might have to be used around line 153?", "author": "risdenk", "createdAt": "2020-10-14T21:15:51Z", "path": "service/src/java/org/apache/hive/service/cli/thrift/ThriftHttpCLIService.java", "diffHunk": "@@ -136,6 +136,12 @@ public void onClosed(Connection connection) {\n               ConfVars.HIVE_SERVER2_SSL_KEYSTORE_PATH.varname \n               + \" Not configured for SSL connection\");\n         }\n+        String keyStoreType = hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_TYPE).trim();\n+        if (keyStoreType.isEmpty()) {\n+          keyStoreType = KeyStore.getDefaultType();\n+        }\n+        String keyStoreAlgorithm = hiveConf.getVar(ConfVars.HIVE_SERVER2_SSL_KEYSTORE_ALGORITHM).trim();", "originalCommit": "f948a3ff27fb3a2ed2deeacc2ae9e50a3f4b704d", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTA4MjEzMw==", "url": "https://github.com/apache/hive/pull/1580#discussion_r505082133", "bodyText": "I will add", "author": "yongzhi", "createdAt": "2020-10-14T23:53:29Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NjYwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTEzMTY0MA==", "url": "https://github.com/apache/hive/pull/1580#discussion_r505131640", "bodyText": "For the MetastoreConf changes in testing because the previous HiveConf metastore related properties are all deprecated, I just switch to the corresponding properties in MetastoreConf", "author": "yongzhi", "createdAt": "2020-10-15T02:44:59Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNDk3NjYwMg=="}], "type": "inlineReview"}, {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b", "url": "https://github.com/apache/hive/commit/63316cb8fa4603a6da904b38ac9417c40ba4b31b", "message": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types besides JKS by config\n\nAdd following optional properties for SSL related configs:\nHiveServer2:\n Add new properties:\n  hive.server2.keystore.type\n  hive.server2.keymanagerfactory.algorithm\n JDBC:\n  Remove hard-coded SSL_TRUST_STORE_TYPE(JKS) from jdbc connection for HS2\n  Add trustStoreType param for jdbc connection\n  Add trustManagerFactoryAlgorithm\nHive MetaStore:\n  New properties for service and client:\n   metastore.keystore.type\n   metastore.keymanagerfactory.algorithm\n   metastore.truststore.type\n   metastore.trustmanagerfactory.algorithm\n  Add bcfks into metastore.dbaccess.ssl.truststore.type stringvalidator\nTests:\n Unit tests for HS2 and HMS", "committedDate": "2020-10-14T23:44:50Z", "type": "commit"}, {"oid": "63316cb8fa4603a6da904b38ac9417c40ba4b31b", "url": "https://github.com/apache/hive/commit/63316cb8fa4603a6da904b38ac9417c40ba4b31b", "message": "HIVE-24253: HMS and HS2 needs to support keystore/truststores types besides JKS by config\n\nAdd following optional properties for SSL related configs:\nHiveServer2:\n Add new properties:\n  hive.server2.keystore.type\n  hive.server2.keymanagerfactory.algorithm\n JDBC:\n  Remove hard-coded SSL_TRUST_STORE_TYPE(JKS) from jdbc connection for HS2\n  Add trustStoreType param for jdbc connection\n  Add trustManagerFactoryAlgorithm\nHive MetaStore:\n  New properties for service and client:\n   metastore.keystore.type\n   metastore.keymanagerfactory.algorithm\n   metastore.truststore.type\n   metastore.trustmanagerfactory.algorithm\n  Add bcfks into metastore.dbaccess.ssl.truststore.type stringvalidator\nTests:\n Unit tests for HS2 and HMS", "committedDate": "2020-10-14T23:44:50Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MTUzMA==", "url": "https://github.com/apache/hive/pull/1580#discussion_r505761530", "bodyText": "This import seems un-necessary. Can be removed.\nI did not like the idea of adding a dependency on this class into the Hive JDBC module but looks like its not needed.", "author": "nrg4878", "createdAt": "2020-10-15T18:40:29Z", "path": "jdbc/src/java/org/apache/hive/jdbc/HiveConnection.java", "diffHunk": "@@ -19,6 +19,7 @@\n package org.apache.hive.jdbc;\n \n import com.google.common.annotations.VisibleForTesting;\n+import org.apache.hadoop.hive.metastore.conf.MetastoreConf;", "originalCommit": "63316cb8fa4603a6da904b38ac9417c40ba4b31b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2NTc0OQ==", "url": "https://github.com/apache/hive/pull/1580#discussion_r505765749", "bodyText": "Weird, I did not remember do that. Maybe the editor help me? I will remove it.", "author": "yongzhi", "createdAt": "2020-10-15T18:47:48Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc2MTUzMA=="}], "type": "inlineReview"}, {"oid": "02c2ecb8c4d179f824d4332fa318404a5f2856be", "url": "https://github.com/apache/hive/commit/02c2ecb8c4d179f824d4332fa318404a5f2856be", "message": "Remove unused import", "committedDate": "2020-10-15T18:56:18Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc3NTAzMQ==", "url": "https://github.com/apache/hive/pull/1580#discussion_r505775031", "bodyText": "So now instead of defaulting to JKS, the client always has to provide \"trustStoreType=JKS\" in the connection params? Wouldnt this break backward compatibility with existing applications ?", "author": "nrg4878", "createdAt": "2020-10-15T19:04:36Z", "path": "jdbc/src/java/org/apache/hive/jdbc/Utils.java", "diffHunk": "@@ -105,6 +105,8 @@\n     public static final String USE_SSL = \"ssl\";\n     public static final String SSL_TRUST_STORE = \"sslTrustStore\";\n     public static final String SSL_TRUST_STORE_PASSWORD = \"trustStorePassword\";\n+    public static final String SSL_TRUST_STORE_TYPE = \"trustStoreType\";", "originalCommit": "63316cb8fa4603a6da904b38ac9417c40ba4b31b", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc5Nzg4NQ==", "url": "https://github.com/apache/hive/pull/1580#discussion_r505797885", "bodyText": "No, this param is optional, if it does not have value, KeyStore.getDefaultType() will be used.", "author": "yongzhi", "createdAt": "2020-10-15T19:47:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNTc3NTAzMQ=="}], "type": "inlineReview"}]}