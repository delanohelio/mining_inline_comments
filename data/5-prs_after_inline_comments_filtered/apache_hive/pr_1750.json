{"pr_number": 1750, "pr_title": "HIVE-24388: Enhance swo optimizations to merge EventOperators", "pr_createdAt": "2020-12-07T13:10:15Z", "pr_url": "https://github.com/apache/hive/pull/1750", "timeline": [{"oid": "7f3d10b974e9d58112911f1202ea10350867efe9", "url": "https://github.com/apache/hive/commit/7f3d10b974e9d58112911f1202ea10350867efe9", "message": "add test\n\n(cherry picked from commit fbfe28081700d701ea5e99463d3761bdae259d15)", "committedDate": "2020-11-16T13:18:08Z", "type": "commit"}, {"oid": "37e75a40232e3ff6cf4db1f9b274c4c0751c04f4", "url": "https://github.com/apache/hive/commit/37e75a40232e3ff6cf4db1f9b274c4c0751c04f4", "message": "add debug; q.out", "committedDate": "2020-11-16T15:04:01Z", "type": "commit"}, {"oid": "ebfcba96ca147156c9c3abc8fde4f5bbad1587cf", "url": "https://github.com/apache/hive/commit/ebfcba96ca147156c9c3abc8fde4f5bbad1587cf", "message": "en", "committedDate": "2020-11-16T16:02:22Z", "type": "commit"}, {"oid": "644f16fbada79af45ddecf66ef6987972afab26c", "url": "https://github.com/apache/hive/commit/644f16fbada79af45ddecf66ef6987972afab26c", "message": "accept", "committedDate": "2020-11-17T14:53:41Z", "type": "commit"}, {"oid": "751ad448d1a1891dedb75b073e3a20b3e5a1d717", "url": "https://github.com/apache/hive/commit/751ad448d1a1891dedb75b073e3a20b3e5a1d717", "message": "Merge remote-tracking branch 'apache/master' into HIVE-24388-event-merge", "committedDate": "2020-11-19T11:40:17Z", "type": "commit"}, {"oid": "5576d77bfae7f1c6b9222f2de865c4aa2be7ff91", "url": "https://github.com/apache/hive/commit/5576d77bfae7f1c6b9222f2de865c4aa2be7ff91", "message": "(X) HIVE-23965: Improve plan regression tests using TPCDS30TB metastore dump and custom configs\n\ncommit 7ad4c9d6af0e840213ad5da41f1b42ff3e83bfeb\nAuthor: Stamatis Zampetakis <zabetak@gmail.com>\nDate:   Mon Jun 15 21:09:14 2020 +0200\n\n    HIVE-23965: Improve plan regression tests using TPCDS30TB metastore dump and custom configs\n\n    1. Add new perf driver, TestTezTPCDS30TBCliDriver, relying on a dockerized metastore.\n    2. Use Dockerized postgres metastore with TPC-DS 30TB dump\n    3. Remove old drivers (with and without constraints), related classes\n    (e.g., MetastoreDumpUtility), and resources.\n\n    After discussion in the JIRA we decided that keeping the old drivers\n    is most likely useless.\n\n    4. Use Hive config properties obtained and curated from real-life usages\n    5. Allow AbstractCliConfig to override metastore DB type\n    6. Rework CorePerfCliDriver to allow pre-initialized metastores\n\n    Remove system property settings in the initialization of the driver and\n    leave in the configuration to set it up if needed. This is necessary to\n    be able to use the driver with a preinitialised metastore.\n\n    Remove redundant logs in System.err. Logging and throwing an exception\n    is an anti-pattern.\n\n    Replace assertions with exceptions and improve the messages.\n\n    7. Upgrade postgres JDBC driver to version 42.2.14 to be compatible\n    with the docker image used\n    8. Update path to new postgres version in TestBeelineArgParsing\n    9. Display plans using hive.explain.user set to false which seems\n    to be preferrable for performing a diff and checking regressions\n\n    10. Disable queries 14 (HIVE-24167), 30 (HIVE-23964)\n    11. Re-enable CBO plan tests for queries 44, 45, 67, 70, 86\n\n    The queries were disabled as part of HIVE-20718. They were supposed to\n    be fixed in Calcite 1.18.0 and currently Hive is in 1.21.0 so it is not\n    surprising that they pass.\n\n    12. Add missing queries: cbo_query41, cbo_query62, query62\n\ncommit 4ee53365d94f127131332f3e552c8cac3ce9938e\nAuthor: Stamatis Zampetakis <zabetak@gmail.com>\nDate:   Tue Nov 17 11:13:22 2020 +0100\n\n    HIVE-24395: Intermittent failures to initialize dockerized Postgres metastore in tests\n\n    Ensure the Postgres init process is complete the database port is open\n    and accepting connections before declaring the container ready.\n\ncommit a2815c2bf6152e7fd35612450f370fe5a5b10b8d\nAuthor: Stamatis Zampetakis <zabetak@gmail.com>\nDate:   Tue Jun 16 22:17:10 2020 +0200\n\n    HIVE-23742: Remove unintentional execution of TPC-DS query39 in qtests", "committedDate": "2020-11-19T11:41:05Z", "type": "commit"}, {"oid": "e100138eb48108d853ec0b30cb9a0dcd6cf1231f", "url": "https://github.com/apache/hive/commit/e100138eb48108d853ec0b30cb9a0dcd6cf1231f", "message": "Revert \"(X) HIVE-23965: Improve plan regression tests using TPCDS30TB metastore dump and custom configs\"\n\nThis reverts commit 5576d77bfae7f1c6b9222f2de865c4aa2be7ff91.", "committedDate": "2020-12-04T13:11:34Z", "type": "commit"}, {"oid": "7df746bf5055a89a7fec678340340f02d312f00b", "url": "https://github.com/apache/hive/commit/7df746bf5055a89a7fec678340340f02d312f00b", "message": "Merge remote-tracking branch 'apache/master' into HIVE-24388-event-merge", "committedDate": "2020-12-04T13:11:38Z", "type": "commit"}, {"oid": "cb66915b6a89b8a77f610062022374c078c6eeb2", "url": "https://github.com/apache/hive/commit/cb66915b6a89b8a77f610062022374c078c6eeb2", "message": "accept qouts", "committedDate": "2020-12-04T15:30:00Z", "type": "commit"}, {"oid": "80fa406b1a330bbbc297974128d0300bc0572475", "url": "https://github.com/apache/hive/commit/80fa406b1a330bbbc297974128d0300bc0572475", "message": "dont traverse event operators during valiudation", "committedDate": "2020-12-07T09:34:41Z", "type": "commit"}, {"oid": "3d74bb58db59b58f89a70a35aba0001ecd1cd10f", "url": "https://github.com/apache/hive/commit/3d74bb58db59b58f89a70a35aba0001ecd1cd10f", "message": "doesnt count eventop in parent/child relationg; optree vill filter out inbvalid cases", "committedDate": "2020-12-07T10:03:02Z", "type": "commit"}, {"oid": "9d0dd60f225aaeec8852d34c5bb8fe89d30a35d6", "url": "https://github.com/apache/hive/commit/9d0dd60f225aaeec8852d34c5bb8fe89d30a35d6", "message": "Revert \"doesnt count eventop in parent/child relationg; optree vill filter out inbvalid cases\"\n\nThis reverts commit 3d74bb58db59b58f89a70a35aba0001ecd1cd10f.", "committedDate": "2020-12-07T10:13:19Z", "type": "commit"}, {"oid": "bfaba51305e4f533f2571d58b8579ad9aeac3873", "url": "https://github.com/apache/hive/commit/bfaba51305e4f533f2571d58b8579ad9aeac3873", "message": "add mayRemoveInputs", "committedDate": "2020-12-07T11:18:28Z", "type": "commit"}, {"oid": "f74c516cad84c89310b4f1be1c04e28405089e7a", "url": "https://github.com/apache/hive/commit/f74c516cad84c89310b4f1be1c04e28405089e7a", "message": "Revert \"Revert \"doesnt count eventop in parent/child relationg; optree vill filter out inbvalid cases\"\"\n\nThis reverts commit 9d0dd60f225aaeec8852d34c5bb8fe89d30a35d6.", "committedDate": "2020-12-07T11:19:50Z", "type": "commit"}, {"oid": "2966843a31d895bd9a407e33cec90b0221516069", "url": "https://github.com/apache/hive/commit/2966843a31d895bd9a407e33cec90b0221516069", "message": "Revert \"dont traverse event operators during valiudation\"\n\nThis reverts commit 80fa406b1a330bbbc297974128d0300bc0572475.", "committedDate": "2020-12-07T11:20:00Z", "type": "commit"}, {"oid": "ea312679dbb3abe915c86a9bc74e666f461941ff", "url": "https://github.com/apache/hive/commit/ea312679dbb3abe915c86a9bc74e666f461941ff", "message": "re-patch/etc;", "committedDate": "2020-12-07T11:59:34Z", "type": "commit"}, {"oid": "eda0089e21f5f81833b4f020cfebe72774aa3c83", "url": "https://github.com/apache/hive/commit/eda0089e21f5f81833b4f020cfebe72774aa3c83", "message": "accept q2 - removed parallel edge!", "committedDate": "2020-12-07T13:09:31Z", "type": "commit"}, {"oid": "472b7e62535f72c5d56db812914a951dca57431d", "url": "https://github.com/apache/hive/commit/472b7e62535f72c5d56db812914a951dca57431d", "message": "Merge remote-tracking branch 'apache/master' into HIVE-24388-event-merge", "committedDate": "2020-12-07T15:04:30Z", "type": "commit"}, {"oid": "e6c44d152f729cb4d3ae4697e20ce7ffb2a4d3d9", "url": "https://github.com/apache/hive/commit/e6c44d152f729cb4d3ae4697e20ce7ffb2a4d3d9", "message": "fixup q75", "committedDate": "2020-12-07T15:45:20Z", "type": "commit"}, {"oid": "fd8cc61dc2b047585392cdf2aa2a829c11cc3caf", "url": "https://github.com/apache/hive/commit/fd8cc61dc2b047585392cdf2aa2a829c11cc3caf", "message": "remove file writes", "committedDate": "2020-12-07T15:46:04Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY5NzM1MA==", "url": "https://github.com/apache/hive/pull/1750#discussion_r539697350", "bodyText": "Needed?", "author": "jcamachor", "createdAt": "2020-12-09T22:30:48Z", "path": "ql/src/java/org/apache/hadoop/hive/ql/optimizer/SharedWorkOptimizer.java", "diffHunk": "@@ -17,6 +17,7 @@\n  */\n package org.apache.hadoop.hive.ql.optimizer;\n \n+import java.io.File;", "originalCommit": "fd8cc61dc2b047585392cdf2aa2a829c11cc3caf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDU0MDExODIwNQ==", "url": "https://github.com/apache/hive/pull/1750#discussion_r540118205", "bodyText": "yeah...I've some stuff which write out File-s for now...and I just remove it at the end of preparing the patch....\nit gives easier insights into what happened in the SWO.\nI would really like to build it into the system and expose it on the HS2 web interface - it would be very usefull...will get to that as well :)\nbut first I would like to finish this set of patches :)", "author": "kgyrtkirk", "createdAt": "2020-12-10T12:10:45Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUzOTY5NzM1MA=="}], "type": "inlineReview"}, {"oid": "eb1d52d71f71628bb0d7e338c889c679e662c8c6", "url": "https://github.com/apache/hive/commit/eb1d52d71f71628bb0d7e338c889c679e662c8c6", "message": "remove import", "committedDate": "2020-12-10T16:20:35Z", "type": "commit"}, {"oid": "1af5bb83b5749295eb1ecfe9843338d30dc80ac7", "url": "https://github.com/apache/hive/commit/1af5bb83b5749295eb1ecfe9843338d30dc80ac7", "message": "add config knob", "committedDate": "2020-12-10T16:24:49Z", "type": "commit"}]}