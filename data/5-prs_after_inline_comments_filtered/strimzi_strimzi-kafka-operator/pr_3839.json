{"pr_number": 3839, "pr_title": "[systemtest] Add tests with mounting secrets and CM as volumes to ConnectS2I and improve the base test with doted names", "pr_createdAt": "2020-10-19T11:07:45Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839", "timeline": [{"oid": "38bee2952228dd06d59fe152129d9809947375e1", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/38bee2952228dd06d59fe152129d9809947375e1", "message": "add test with volumes to connects2i, also add to the test volumes with doted names\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>", "committedDate": "2020-10-19T11:01:30Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODc4Nw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668787", "bodyText": "Maybe put name into var?", "author": "Frawless", "createdAt": "2020-10-19T11:22:17Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")", "originalCommit": "38bee2952228dd06d59fe152129d9809947375e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODg0Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668846", "bodyText": "Indent", "author": "Frawless", "createdAt": "2020-10-19T11:22:23Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")", "originalCommit": "38bee2952228dd06d59fe152129d9809947375e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2OTkwNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507669906", "bodyText": "It's in multiple places, I am list lazy mark every line :)", "author": "Frawless", "createdAt": "2020-10-19T11:24:30Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODg0Ng=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODkwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668904", "bodyText": "Maybe put name into var?", "author": "Frawless", "createdAt": "2020-10-19T11:22:31Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")\n+            .endMetadata()\n+            .withType(\"Opaque\")\n+            .addToData(secretKey, encodedPassword)\n+            .build();\n+\n+        ConfigMap configMap = new ConfigMapBuilder()\n+            .editOrNewMetadata()\n+            .withName(\"my-config-map\")", "originalCommit": "38bee2952228dd06d59fe152129d9809947375e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2ODk1NQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507668955", "bodyText": "Maybe put value into var?", "author": "Frawless", "createdAt": "2020-10-19T11:22:38Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java", "diffHunk": "@@ -739,6 +746,158 @@ void testHostAliases() {\n         assertThat(output, containsString(etcHostsData));\n     }\n \n+    @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n+    void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n+        String secretPassword = \"password\";\n+        String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n+\n+        String secretEnv = \"MY_CONNECTOR_SECRET\";\n+        String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n+\n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n+        String configMapVolumeName = \"connect-config-map\";\n+        String secretVolumeName = \"connect-secret\";\n+\n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+\n+        String configMapKey = \"my-key\";\n+        String secretKey = \"my-secret-key\";\n+\n+        Secret connectSecret = new SecretBuilder()\n+            .withNewMetadata()\n+            .withName(\"my-secret\")\n+            .endMetadata()\n+            .withType(\"Opaque\")\n+            .addToData(secretKey, encodedPassword)\n+            .build();\n+\n+        ConfigMap configMap = new ConfigMapBuilder()\n+            .editOrNewMetadata()\n+            .withName(\"my-config-map\")\n+            .endMetadata()\n+            .addToData(configMapKey, \"my-value\")", "originalCommit": "38bee2952228dd06d59fe152129d9809947375e1", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2OTUwNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507669504", "bodyText": "Maybe we should put this into some method? It's the same for ConnectST and ConnectS2IST. Same with creation of serets/cm", "author": "Frawless", "createdAt": "2020-10-19T11:23:43Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectST.java", "diffHunk": "@@ -1031,16 +1031,23 @@ void testScaleConnectAndConnectorSubresource() {\n     }\n \n     @Test\n+    @SuppressWarnings({\"checkstyle:MethodLength\"})\n     void testMountingSecretAndConfigMapAsVolumesAndEnvVars() {\n         String secretPassword = \"password\";\n         String encodedPassword = Base64.getEncoder().encodeToString(secretPassword.getBytes());\n \n         String secretEnv = \"MY_CONNECTOR_SECRET\";\n         String configMapEnv = \"MY_CONNECT_CONFIG_MAP\";\n \n+        String dotedSecretEnv = \"MY_DOTED_CONNECTOR_SECRET\";\n+        String dotedConfigMapEnv = \"MY_DOTED_CONNECT_CONFIG_MAP\";\n+\n         String configMapVolumeName = \"connect-config-map\";\n         String secretVolumeName = \"connect-secret\";\n \n+        String dotedConfigMapVolumeName = \"connect.config.map\";\n+        String dotedSecretVolumeName = \"connect.secret\";\n+", "originalCommit": "38bee2952228dd06d59fe152129d9809947375e1", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzcxOTI5NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507719294", "bodyText": "Well the tests are practically same, only difference is between the CRs -> I would like to make the tests \"more generic\" how we discussed offline. But for now, I guess, I can create some method in AbstractST and then just refactor it.\nWDYT @Frawless ?", "author": "im-konge", "createdAt": "2020-10-19T12:50:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2OTUwNA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzkyODc2MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3839#discussion_r507928761", "bodyText": "Discussed offline", "author": "Frawless", "createdAt": "2020-10-19T17:31:09Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDUwNzY2OTUwNA=="}], "type": "inlineReview"}, {"oid": "f18ff07d1e1cad4f98f6c443d2cd3ea3b26f953e", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/f18ff07d1e1cad4f98f6c443d2cd3ea3b26f953e", "message": "comment\n\nSigned-off-by: Lukas Kral <lukywill16@gmail.com>", "committedDate": "2020-10-19T18:26:37Z", "type": "commit"}]}