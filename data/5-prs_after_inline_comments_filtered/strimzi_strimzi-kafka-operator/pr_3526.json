{"pr_number": 3526, "pr_title": "[systemtest] Support changing the replica movement strategy", "pr_createdAt": "2020-08-19T11:55:39Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526", "timeline": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3NjM0MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r472976340", "bodyText": "How about remove the List<String> actualStrategies; and do it like this:\n\n  \n    \n      \n        Suggested change\n        \n          \n    \n\n        \n      \n    \n    \n      \n          \n            \n                    actualStrategies = KafkaRebalanceResource.kafkaRebalanceClient().inNamespace(NAMESPACE)\n          \n          \n            \n                    List<String> actualStrategies = KafkaRebalanceResource.kafkaRebalanceClient().inNamespace(NAMESPACE)", "author": "im-konge", "createdAt": "2020-08-19T12:02:55Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlIsolatedST.java", "diffHunk": "@@ -151,6 +155,33 @@ void testCruiseControlTopicExclusion() {\n         KafkaRebalanceUtils.waitForKafkaRebalanceCustomResourceState(CLUSTER_NAME, KafkaRebalanceState.Ready);\n     }\n \n+    @Test\n+    void testCruiseControlReplicaMovementStrategy() {\n+        List<String> actualStrategies;\n+        List<String> newReplicaMovementStrategies = Arrays.asList(\"PrioritizeSmallReplicaMovementStrategy\",\n+                                                                    \"PrioritizeLargeReplicaMovementStrategy\",\n+                                                                    \"PostponeUrpReplicaMovementStrategy\");\n+\n+        KafkaResource.kafkaWithCruiseControl(CLUSTER_NAME, 3, 3).done();\n+        KafkaRebalanceResource.kafkaRebalance(CLUSTER_NAME).done();\n+\n+        actualStrategies = KafkaRebalanceResource.kafkaRebalanceClient().inNamespace(NAMESPACE)", "originalCommit": "5659a39de7db5304115b09558df6a66cb1c6c4ec", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3OTA5MA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r472979090", "bodyText": "Yeah, I forgot to update it, as originally I was assigning two values to actualStrategies", "author": "michalxo", "createdAt": "2020-08-19T12:08:24Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ3Mjk3NjM0MA=="}], "type": "inlineReview"}, {"oid": "6972facbb9447fece37695d6ffac3ded845fe7ed", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6972facbb9447fece37695d6ffac3ded845fe7ed", "message": "NEW(Test) Support changing the replica movement strategy\n\nThis is additional work after pull/3368\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-19T12:09:54Z", "type": "forcePushed"}, {"oid": "315c658b79efc327f4af91558cbdc8b02870c721", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/315c658b79efc327f4af91558cbdc8b02870c721", "message": "NEW(Test) Support changing the replica movement strategy\n\nThis is additional work after pull/3368\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-08-26T14:22:44Z", "type": "forcePushed"}, {"oid": "a18d7586b93f1d6186976dc4fe49765a952d8bd7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/a18d7586b93f1d6186976dc4fe49765a952d8bd7", "message": "NEW(Test) Support changing the replica movement strategy\n\nThis is additional work after pull/3368\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-02T12:52:18Z", "type": "forcePushed"}, {"oid": "3368b122d564d05aacda502935737bffdc56b50c", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3368b122d564d05aacda502935737bffdc56b50c", "message": "NEW(Test) Support changing the replica movement strategy\n\nThis is additional work after pull/3368\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-03T15:54:20Z", "type": "forcePushed"}, {"oid": "666e0b45ea7bcc1184b3161c0428ab4186508d65", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/666e0b45ea7bcc1184b3161c0428ab4186508d65", "message": "NEW(Test) Support changing the replica movement strategy\n\nThis is additional work after pull/3368\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-03T15:55:59Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5MzUxOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r483493518", "bodyText": "Thinking if we should add these to some resource/utils class. WDYT @Frawless?", "author": "im-konge", "createdAt": "2020-09-04T09:12:46Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -87,6 +87,13 @@\n     protected static final String TLS_SIDECAR_EO_IMAGE = \"STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE\";\n     protected static final String TEST_TOPIC_NAME = \"test-topic\";\n \n+    protected static final String CRUISE_CONTROL_NAME = \"Cruise Control\";\n+    protected static final String CRUISE_CONTROL_POD_PREFIX = CLUSTER_NAME + \"-cruise-control-\";\n+    protected static final String CRUISE_CONTROL_CONTAINER_NAME = \"cruise-control\";\n+    protected static final String CRUISE_CONTROL_CONFIGURATION_ENV = \"CRUISE_CONTROL_CONFIGURATION\";\n+    protected static final String CRUISE_CONTROL_CAPACITY_FILE_PATH = \"/tmp/capacity.json\";\n+    protected static final String CRUISE_CONTROL_CONFIGURATION_FILE_PATH = \"/tmp/cruisecontrol.properties\";", "originalCommit": "666e0b45ea7bcc1184b3161c0428ab4186508d65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5NDI1MQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r483494251", "bodyText": "Or maybe to some constants \ud83d\ude04", "author": "im-konge", "createdAt": "2020-09-04T09:14:03Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5MzUxOA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5MTU5OA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r483491598", "bodyText": "Why it's in Abstract instead of in Constants?", "author": "Frawless", "createdAt": "2020-09-04T09:09:20Z", "path": "systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java", "diffHunk": "@@ -87,6 +87,13 @@\n     protected static final String TLS_SIDECAR_EO_IMAGE = \"STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE\";\n     protected static final String TEST_TOPIC_NAME = \"test-topic\";\n \n+    protected static final String CRUISE_CONTROL_NAME = \"Cruise Control\";\n+    protected static final String CRUISE_CONTROL_POD_PREFIX = CLUSTER_NAME + \"-cruise-control-\";\n+    protected static final String CRUISE_CONTROL_CONTAINER_NAME = \"cruise-control\";\n+    protected static final String CRUISE_CONTROL_CONFIGURATION_ENV = \"CRUISE_CONTROL_CONFIGURATION\";\n+    protected static final String CRUISE_CONTROL_CAPACITY_FILE_PATH = \"/tmp/capacity.json\";\n+    protected static final String CRUISE_CONTROL_CONFIGURATION_FILE_PATH = \"/tmp/cruisecontrol.properties\";\n+", "originalCommit": "666e0b45ea7bcc1184b3161c0428ab4186508d65", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU2NDYzNw==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r483564637", "bodyText": "There is more stuff I would propose to move from AbstractST to Constants. Not just my change.\nFor example all of this\n    protected static final String KAFKA_CLIENTS_NAME = CLUSTER_NAME + \"-\" + Constants.KAFKA_CLIENTS;\n    protected static final String KAFKA_IMAGE_MAP = \"STRIMZI_KAFKA_IMAGES\";\n    protected static final String KAFKA_CONNECT_IMAGE_MAP = \"STRIMZI_KAFKA_CONNECT_IMAGES\";\n    protected static final String KAFKA_MIRROR_MAKER_2_IMAGE_MAP = \"STRIMZI_KAFKA_MIRROR_MAKER_2_IMAGES\";\n    protected static final String TO_IMAGE = \"STRIMZI_DEFAULT_TOPIC_OPERATOR_IMAGE\";\n    protected static final String UO_IMAGE = \"STRIMZI_DEFAULT_USER_OPERATOR_IMAGE\";\n    protected static final String KAFKA_INIT_IMAGE = \"STRIMZI_DEFAULT_KAFKA_INIT_IMAGE\";\n    protected static final String TLS_SIDECAR_EO_IMAGE = \"STRIMZI_DEFAULT_TLS_SIDECAR_ENTITY_OPERATOR_IMAGE\";\n    protected static final String TEST_TOPIC_NAME = \"test-topic\";\n\n    protected static final String CRUISE_CONTROL_NAME = \"Cruise Control\";\n    protected static final String CRUISE_CONTROL_POD_PREFIX = CLUSTER_NAME + \"-cruise-control-\";\n    protected static final String CRUISE_CONTROL_CONTAINER_NAME = \"cruise-control\";\n    protected static final String CRUISE_CONTROL_CONFIGURATION_ENV = \"CRUISE_CONTROL_CONFIGURATION\";\n    protected static final String CRUISE_CONTROL_CAPACITY_FILE_PATH = \"/tmp/capacity.json\";\n    protected static final String CRUISE_CONTROL_CONFIGURATION_FILE_PATH = \"/tmp/cruisecontrol.properties\";\n\nWhich would change all of these files\ngit st\nOn branch mt_rebalance\nYour branch is up to date with 'origin/mt_rebalance'.\n\nChanges not staged for commit:\n  (use \"git add <file>...\" to update what will be committed)\n  (use \"git restore <file>...\" to discard changes in working directory)\n\tmodified:   systemtest/src/main/java/io/strimzi/systemtest/Constants.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/AbstractST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeAbstractST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeCorsST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeKafkaExternalListenersST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeScramShaST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/bridge/HttpBridgeTlsST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectS2IST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/connect/ConnectST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlApiST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlConfigurationST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/cruisecontrol/CruiseControlIsolatedST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/kafka/KafkaST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/kafka/ListenersST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/log/LogSettingST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/log/LoggingChangeST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/metrics/MetricsST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/mirrormaker/MirrorMaker2ST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/mirrormaker/MirrorMakerST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/operators/CustomResourceStatusST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/operators/RecoveryST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/operators/topic/TopicST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/operators/topic/TopicScalabilityST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/operators/user/UserST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/AlternativeReconcileTriggersST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/KafkaRollerST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/rollingupdate/RollingUpdateST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/security/OpaIntegrationST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/security/SecurityST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/security/oauth/OauthAbstractST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/security/oauth/OauthAuthorizationST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/security/oauth/OauthPlainST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/security/oauth/OauthTlsST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/specific/ClusterOperationST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/specific/SpecificST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/tracing/TracingST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/upgrade/StrimziUpgradeST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/upgrade/ZookeeperUpgradeST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/watcher/AbstractNamespaceST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/watcher/AllNamespaceST.java\n\tmodified:   systemtest/src/test/java/io/strimzi/systemtest/watcher/MultipleNamespaceST.java\n\nI would make it as a separate PR. WDYT?", "author": "michalxo", "createdAt": "2020-09-04T11:44:47Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5MTU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzU3NjE3Ng==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r483576176", "bodyText": "Moved to constants only CC for now.", "author": "michalxo", "createdAt": "2020-09-04T12:11:12Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5MTU5OA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzYwMTA1OQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/3526#discussion_r483601059", "bodyText": "Yes we can surely move them to Constants and it will need to be changed in all STs, but in separate PR.", "author": "im-konge", "createdAt": "2020-09-04T13:02:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ4MzQ5MTU5OA=="}], "type": "inlineReview"}, {"oid": "2ff95f3a86db4f6737da88d0ff8b02faa2443e56", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/2ff95f3a86db4f6737da88d0ff8b02faa2443e56", "message": "fixup! NEW(Test) Support changing the replica movement strategy\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-04T12:13:53Z", "type": "forcePushed"}, {"oid": "994c7bf32e37da0753756b4f44473e8c9ae14176", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/994c7bf32e37da0753756b4f44473e8c9ae14176", "message": "fixup! NEW(Test) Support changing the replica movement strategy\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-04T12:38:56Z", "type": "forcePushed"}, {"oid": "70fe70aad9aee6f30759a0a3e0e65b22918464fe", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/70fe70aad9aee6f30759a0a3e0e65b22918464fe", "message": "NEW(Test) Support changing the replica movement strategy\n\nThis is additional work after pull/3368\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-04T13:29:43Z", "type": "commit"}, {"oid": "5ed25765e5945d9176b56a51ecd23ff3fe4b3a77", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5ed25765e5945d9176b56a51ecd23ff3fe4b3a77", "message": "fixup! NEW(Test) Support changing the replica movement strategy\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-04T13:30:28Z", "type": "commit"}, {"oid": "5ed25765e5945d9176b56a51ecd23ff3fe4b3a77", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/5ed25765e5945d9176b56a51ecd23ff3fe4b3a77", "message": "fixup! NEW(Test) Support changing the replica movement strategy\n\nSigned-off-by: Michal T\u00f3th <mtoth@redhat.com>", "committedDate": "2020-09-04T13:30:28Z", "type": "forcePushed"}]}