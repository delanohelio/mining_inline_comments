{"pr_number": 2363, "pr_title": "KafkaConnector: Support connector pause/resume and status", "pr_createdAt": "2020-01-06T13:59:56Z", "pr_url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363", "timeline": [{"oid": "00c98bfd06439207f1606bbf4eff3ea89d45539a", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/00c98bfd06439207f1606bbf4eff3ea89d45539a", "message": "Update derived resources\n\nSigned-off-by: Tom Bentley <tbentley@redhat.com>", "committedDate": "2020-01-07T13:32:35Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTE4NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r363991184", "bodyText": "What are the usecases for pausing connectors? I'm wondering how well would this work with GitOps models etc. Whether the use case is to pause it in Git or whether it is operational thing in which case GitOps would again unpause it.", "author": "scholzj", "createdAt": "2020-01-07T22:53:13Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/KafkaConnectorSpec.java", "diffHunk": "@@ -32,6 +32,7 @@\n \n     private String className;\n     private Integer tasksMax;\n+    private Boolean pause;", "originalCommit": "00c98bfd06439207f1606bbf4eff3ea89d45539a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEyNjMwMA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364126300", "bodyText": "Pausing a connector stops its tasks without causing a rebalance. So it's less invasive to the cluster as a whole than deleting the connector and recreating it later. One use case would be, for example, pausing a connector while performing some upgrade on the external system (to avoid generating lots of errors).", "author": "tombentley", "createdAt": "2020-01-08T09:08:17Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTE4NA=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM0MTM2Mg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364341362", "bodyText": "So I guess it is across multiple reconciliations and for more than few minutes. I guess it makes sense to have it as field than. As annotation, it would be more as resume annotation and pause annotation and that would cause mess if we later start handling failed connectors etc. So I guess we can keep is more like this to describe a state and not an action.", "author": "scholzj", "createdAt": "2020-01-08T17:05:13Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTE4NA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTgwMg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r363991802", "bodyText": "Why do we use JsonNode here? Is it just to safe the APi modeling?", "author": "scholzj", "createdAt": "2020-01-07T22:55:07Z", "path": "api/src/main/java/io/strimzi/api/kafka/model/status/KafkaConnectorStatus.java", "diffHunk": "@@ -22,7 +25,19 @@\n @JsonPropertyOrder({ \"conditions\", \"observedGeneration\", \"url\" })\n @EqualsAndHashCode\n @ToString(callSuper = true)\n+@SuppressFBWarnings(\"SE_BAD_FIELD\")\n public class KafkaConnectorStatus extends Status {\n     private static final long serialVersionUID = 1L;\n \n+    private JsonNode connector;\n+\n+    @JsonInclude(JsonInclude.Include.NON_NULL)\n+    @Description(\"The connector status, as reported by the Kafka Connect REST API.\")\n+    public JsonNode getConnector() {", "originalCommit": "00c98bfd06439207f1606bbf4eff3ea89d45539a", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMDYwOA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364130608", "bodyText": "Originally I went to the trouble of writing classes to model the API response schema, but I decided that was probably a bad idea since we end up coupling our CRD schema to Connect's API response schema (which we don't control, thus creating compatibility problems for us if their response gains extra properties).\nSo I decided that our schema should basically have this property whose JSON type should be object. Usually we use a Map<String, Object> for that, I thought it wasn't trivial to get Jackson to do that. Looking again, maybe it's a lot easier than I thought... I'll take a look.", "author": "tombentley", "createdAt": "2020-01-08T09:18:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzMTQzNA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364131434", "bodyText": "Do you remember we had problem using JsonNode with the KafkaClusterRebalanceStatus.optimizationResult field so we moved to use Map<String, Object>. The optimization result is a JSON quite like the connector information you get from the Connect REST API.", "author": "ppatierno", "createdAt": "2020-01-08T09:20:44Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDEzNjUyNQ==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364136525", "bodyText": "I don't recall the problem, but I was prepared to \"fix\" the CrdGenerator and DocGenerator to make JsonNode work. But having said that, I'm going to try again to make Map work.", "author": "tombentley", "createdAt": "2020-01-08T09:32:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDMzOTU1NA==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364339554", "bodyText": "So I wonder if this is just shifting the Connect APi stability to the users when we do not model the classes. But I guess I can live with it.", "author": "scholzj", "createdAt": "2020-01-08T17:01:10Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTgwMg=="}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2NDM2MTgzNg==", "url": "https://github.com/strimzi/strimzi-kafka-operator/pull/2363#discussion_r364361836", "bodyText": "Indeed, but the alternative (us being in the loop to provide compatibility and/or needing to update a schema for it) seemed more attractive to me.", "author": "tombentley", "createdAt": "2020-01-08T17:51:38Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDM2Mzk5MTgwMg=="}], "type": "inlineReview"}, {"oid": "6a3440b9fef1f6419939d0f0364604d7db01ee34", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6a3440b9fef1f6419939d0f0364604d7db01ee34", "message": "    KafkaConnector: Support connector pause/resume\n\n    * Add a `pause` property to the `KafkaConnector.spec` to control pause/resume\n    * Add a `connector` property to the `KafkaConnector.status` to expose\n      connector status. This is the JSON result of the\n      GET /connectors/<connector>/status endpoint. With this change a\n      typical status looks like like this:\n        ```\n          status:\n            conditions:\n            - lastTransitionTime: \"2020-01-06T13:44:20.031Z\"\n              status: \"True\"\n              type: Ready\n            connector:\n              connector:\n                state: PAUSED\n                worker_id: 172.17.0.11:8083\n              name: my-source-connector\n              tasks:\n              - id: 0\n                state: RUNNING\n                worker_id: 172.17.0.11:8083\n              type: source\n            observedGeneration: 2\n        ```\n\nSigned-off-by: Tom Bentley <tbentley@redhat.com>", "committedDate": "2020-01-08T12:27:00Z", "type": "commit"}, {"oid": "6a3440b9fef1f6419939d0f0364604d7db01ee34", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/6a3440b9fef1f6419939d0f0364604d7db01ee34", "message": "    KafkaConnector: Support connector pause/resume\n\n    * Add a `pause` property to the `KafkaConnector.spec` to control pause/resume\n    * Add a `connector` property to the `KafkaConnector.status` to expose\n      connector status. This is the JSON result of the\n      GET /connectors/<connector>/status endpoint. With this change a\n      typical status looks like like this:\n        ```\n          status:\n            conditions:\n            - lastTransitionTime: \"2020-01-06T13:44:20.031Z\"\n              status: \"True\"\n              type: Ready\n            connector:\n              connector:\n                state: PAUSED\n                worker_id: 172.17.0.11:8083\n              name: my-source-connector\n              tasks:\n              - id: 0\n                state: RUNNING\n                worker_id: 172.17.0.11:8083\n              type: source\n            observedGeneration: 2\n        ```\n\nSigned-off-by: Tom Bentley <tbentley@redhat.com>", "committedDate": "2020-01-08T12:27:00Z", "type": "forcePushed"}, {"oid": "3fd8c231a765b5a307172cde3b4ebb35d9169bb6", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/3fd8c231a765b5a307172cde3b4ebb35d9169bb6", "message": "spotbugs\n\nSigned-off-by: Tom Bentley <tbentley@redhat.com>", "committedDate": "2020-01-08T13:16:46Z", "type": "commit"}, {"oid": "e6b063112a49bae6ecc22b12cf1888fb8ae766a7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e6b063112a49bae6ecc22b12cf1888fb8ae766a7", "message": "import\n\nSigned-off-by: Tom Bentley <tbentley@redhat.com>", "committedDate": "2020-01-08T14:03:18Z", "type": "commit"}, {"oid": "e6b063112a49bae6ecc22b12cf1888fb8ae766a7", "url": "https://github.com/strimzi/strimzi-kafka-operator/commit/e6b063112a49bae6ecc22b12cf1888fb8ae766a7", "message": "import\n\nSigned-off-by: Tom Bentley <tbentley@redhat.com>", "committedDate": "2020-01-08T14:03:18Z", "type": "forcePushed"}]}