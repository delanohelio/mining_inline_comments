{"pr_number": 244, "pr_title": "Diagram Title Block Preferences fixes", "pr_createdAt": "2020-05-28T16:05:06Z", "pr_url": "https://github.com/eclipse/capella/pull/244", "timeline": [{"oid": "9313f210b3e566bada353773a9a974d545221288", "url": "https://github.com/eclipse/capella/commit/9313f210b3e566bada353773a9a974d545221288", "message": "Remove error popup (for empty cells in TB preferences)\n\nSigned-off-by: MalinaStefaniaStoicanescu <malina.stoicanescu@thalesgroup.com>", "committedDate": "2020-06-01T07:40:22Z", "type": "commit"}, {"oid": "05b5170b224787083f5fb60c870f06b7c3e05439", "url": "https://github.com/eclipse/capella/commit/05b5170b224787083f5fb60c870f06b7c3e05439", "message": "[558032] Use preferences on initial Diagram Title Block\n\nBug: 558032\nChange-Id: I718d3569e46c24bed0030b6544cb903bd25144af\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T07:42:20Z", "type": "commit"}, {"oid": "1133bd0e7c852d17458bba7f1bdf6437e60afb99", "url": "https://github.com/eclipse/capella/commit/1133bd0e7c852d17458bba7f1bdf6437e60afb99", "message": "[558032] Improve preferences of Diagram Title Block\n\nBug: 558032\nChange-Id: I9d5b0f724117f1811422df97ea2bdda24abe14a4\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T07:42:36Z", "type": "commit"}, {"oid": "5e04cd7b66abed24af468cea72dd8c12d0010a54", "url": "https://github.com/eclipse/capella/commit/5e04cd7b66abed24af468cea72dd8c12d0010a54", "message": "[558032] Update icons of TitleBlocks\n\nRemove suffix _16 as they are located in obj16 folder\n\nBug: 558032\nChange-Id: I5bf8a0fcf4f8003b832725a2105a4d275060584e\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T07:42:58Z", "type": "commit"}, {"oid": "ac8a34960c7baa64d03c6efe4e98ffd9a9498a98", "url": "https://github.com/eclipse/capella/commit/ac8a34960c7baa64d03c6efe4e98ffd9a9498a98", "message": "[558032] Add TitleBlock properties on double click\n\nDouble Click properties are the same than the ProjectExplorer\n(org.polarsys.capella.core.data.capellamodeller.properties).\n\nie TitleBlock hadn't properties on Project Explorer\n\nBug: 558032\nChange-Id: Ic46a0519bfca09aae589b0d9bfc1ef3f23959474\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T07:43:14Z", "type": "commit"}, {"oid": "ac8a34960c7baa64d03c6efe4e98ffd9a9498a98", "url": "https://github.com/eclipse/capella/commit/ac8a34960c7baa64d03c6efe4e98ffd9a9498a98", "message": "[558032] Add TitleBlock properties on double click\n\nDouble Click properties are the same than the ProjectExplorer\n(org.polarsys.capella.core.data.capellamodeller.properties).\n\nie TitleBlock hadn't properties on Project Explorer\n\nBug: 558032\nChange-Id: Ic46a0519bfca09aae589b0d9bfc1ef3f23959474\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T07:43:14Z", "type": "forcePushed"}, {"oid": "30a308844847039eb0ebe5d6bc69b643c5e5205c", "url": "https://github.com/eclipse/capella/commit/30a308844847039eb0ebe5d6bc69b643c5e5205c", "message": "[558032] Allow editions of Diagram Title block from Property view\n\nBug: 558032\nChange-Id: Ic7aecc802d6b4cae022b3e4ca649a397fb3c7b95\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T08:04:20Z", "type": "commit"}, {"oid": "8567b245b828981ffc48ac37dce57c8d3f00fd00", "url": "https://github.com/eclipse/capella/commit/8567b245b828981ffc48ac37dce57c8d3f00fd00", "message": "Edit the empty page (Diagram) in capella properties\n\nSigned-off-by: MalinaStefaniaStoicanescu <malina.stoicanescu@thalesgroup.com>", "committedDate": "2020-06-01T08:25:09Z", "type": "commit"}, {"oid": "692aaf703b6168c926f808d6288b62ead6cc8bed", "url": "https://github.com/eclipse/capella/commit/692aaf703b6168c926f808d6288b62ead6cc8bed", "message": "[558032] Add Diagram Title Block preferences on Project properties\n\nBug: 558032\nChange-Id: I2e138eab0d804dab81498872835fb160f794d87c\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T10:11:46Z", "type": "commit"}, {"oid": "692aaf703b6168c926f808d6288b62ead6cc8bed", "url": "https://github.com/eclipse/capella/commit/692aaf703b6168c926f808d6288b62ead6cc8bed", "message": "[558032] Add Diagram Title Block preferences on Project properties\n\nBug: 558032\nChange-Id: I2e138eab0d804dab81498872835fb160f794d87c\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T10:11:46Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI1ODc0OA==", "url": "https://github.com/eclipse/capella/pull/244#discussion_r433258748", "bodyText": "The user can add a line or a column at any position, not only at the end.\n@MalinaStefaniaStoicanescu Why do we only check the last cell ?", "author": "sandupostaru", "createdAt": "2020-06-01T14:12:58Z", "path": "core/plugins/org.polarsys.capella.core.sirius.analysis/src/org/polarsys/capella/core/sirius/analysis/preferences/TitleBlockPreferencePage.java", "diffHunk": "@@ -255,19 +255,12 @@ public boolean performOk() {\n     for (int i = 0; i < linesNumber; i++) {\r\n       for (int j = 0; j < columnsNumber; j++) {\r\n         if (i == linesNumber - 1 && j == columnsNumber - 1) {\r\n-          if (tccMatrix.get(i).get(j).name.equals(EMPTY_STRING)\r\n-              || tccMatrix.get(i).get(j).content.equals(EMPTY_STRING)) {\r\n-            createMessageBox(EDIT_ALL_CELLS, ERROR);\r\n-            return false;\r\n+          if (tccMatrix.get(i).get(j).content.equals(EMPTY_STRING)) {\r\n+        \t  tccMatrix.get(i).get(j).content = \" \";\r\n           }\r\n           currentTableContent = currentTableContent + tccMatrix.get(i).get(j).name + SEPARATOR\r\n               + tccMatrix.get(i).get(j).content;\r\n-        } else {\r\n-          if (tccMatrix.get(i).get(j).name.equals(EMPTY_STRING)\r\n-              || tccMatrix.get(i).get(j).content.equals(EMPTY_STRING)) {\r\n-            createMessageBox(EDIT_ALL_CELLS, ERROR);\r\n-            return false;\r\n-          }\r\n+        } else {             \t \r", "originalCommit": "9313f210b3e566bada353773a9a974d545221288", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzcxMjYxMQ==", "url": "https://github.com/eclipse/capella/pull/244#discussion_r433712611", "bodyText": "If the last cell contains an empty content, when string is build, it will appear something like this: String s = \"...SEPARATORSEPARATOR\". When perform split on this string, it will create an array that will not contain the empty content of the last cell (and instead of 12 elements for example, it will contain only 11). Mostly for this is that check.", "author": "MalinaStefaniaStoicanescu", "createdAt": "2020-06-02T08:37:18Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI1ODc0OA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI2MDMyOA==", "url": "https://github.com/eclipse/capella/pull/244#discussion_r433260328", "bodyText": "Please use a StringBuilder for the currentTableContent.", "author": "sandupostaru", "createdAt": "2020-06-01T14:15:54Z", "path": "core/plugins/org.polarsys.capella.core.sirius.analysis/src/org/polarsys/capella/core/sirius/analysis/preferences/TitleBlockPreferencePage.java", "diffHunk": "@@ -255,19 +255,12 @@ public boolean performOk() {\n     for (int i = 0; i < linesNumber; i++) {\r\n       for (int j = 0; j < columnsNumber; j++) {\r\n         if (i == linesNumber - 1 && j == columnsNumber - 1) {\r\n-          if (tccMatrix.get(i).get(j).name.equals(EMPTY_STRING)\r\n-              || tccMatrix.get(i).get(j).content.equals(EMPTY_STRING)) {\r\n-            createMessageBox(EDIT_ALL_CELLS, ERROR);\r\n-            return false;\r\n+          if (tccMatrix.get(i).get(j).content.equals(EMPTY_STRING)) {\r\n+        \t  tccMatrix.get(i).get(j).content = \" \";\r\n           }\r\n           currentTableContent = currentTableContent + tccMatrix.get(i).get(j).name + SEPARATOR\r", "originalCommit": "9313f210b3e566bada353773a9a974d545221288", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzI2MjAxMg==", "url": "https://github.com/eclipse/capella/pull/244#discussion_r433262012", "bodyText": "Slight formatting issue ;)\nThere are others on this file so a global format should do the job.", "author": "sandupostaru", "createdAt": "2020-06-01T14:18:56Z", "path": "core/plugins/org.polarsys.capella.core.sirius.analysis/src/org/polarsys/capella/core/sirius/analysis/preferences/TitleBlockPreferencePage.java", "diffHunk": "@@ -66,7 +69,7 @@ public TitleBlockCell(String name, String content) {\n \r\n     @Override\r\n     public String toString() {\r\n-      return name;\r\n+      return name+\"\\n\"+content; //$NON-NLS-1$\r", "originalCommit": "1133bd0e7c852d17458bba7f1bdf6437e60afb99", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzMwMzkwMQ==", "url": "https://github.com/eclipse/capella/pull/244#discussion_r433303901", "bodyText": "fixed by 4f40ea4#diff-24254bdb436064c4b318f9508990f052R269", "author": "pdulth", "createdAt": "2020-06-01T15:28:24Z", "path": "core/plugins/org.polarsys.capella.core.sirius.analysis/src/org/polarsys/capella/core/sirius/analysis/preferences/TitleBlockPreferenceField.java", "diffHunk": "@@ -208,24 +201,21 @@ protected void doLoadDefault() {\n \r\n   @Override\r\n   protected void doStore() {\r\n-    String currentTableContent = EMPTY_STRING;\r\n+    StringBuilder table = new StringBuilder();\r\n+    \r\n     for (int i = 0; i < linesNumber; i++) {\r\n       for (int j = 0; j < columnsNumber; j++) {\r\n-        if (i == linesNumber - 1 && j == columnsNumber - 1) {\r\n-          if (tccMatrix.get(i).get(j).content.equals(EMPTY_STRING)) {\r\n-            tccMatrix.get(i).get(j).content = \" \";\r", "originalCommit": "4f40ea4c31f5a8c3fa5c6781922be87f240bf43a", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "e45cc0c440da29415ef8838ec8daac5fface18be", "url": "https://github.com/eclipse/capella/commit/e45cc0c440da29415ef8838ec8daac5fface18be", "message": "[558032] Fix preference storage\n\nBug: 558032\nChange-Id: I80714485acdb59931c61b3a00f6dd7524bd39340\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T15:54:10Z", "type": "commit"}, {"oid": "e45cc0c440da29415ef8838ec8daac5fface18be", "url": "https://github.com/eclipse/capella/commit/e45cc0c440da29415ef8838ec8daac5fface18be", "message": "[558032] Fix preference storage\n\nBug: 558032\nChange-Id: I80714485acdb59931c61b3a00f6dd7524bd39340\nSigned-off-by: Philippe DUL <philippe.dul@thalesgroup.com>", "committedDate": "2020-06-01T15:54:10Z", "type": "forcePushed"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQzMzMzNTM1MA==", "url": "https://github.com/eclipse/capella/pull/244#discussion_r433335350", "bodyText": "Just for reminder:\norg.polarsys.capella.core.commands.preferences.service.AbstractPreferencesInitializer are inconsistent and not working properly.\nputInt If the InstanceScope contains a value, at restart the default value will contains the previous instance value, not the one given in parameter. It will never set only the default value. always in instance scope.\nputBoolean and putString used in \n  \n    \n      capella/core/plugins/org.polarsys.capella.core.model.preferences/src/org/polarsys/capella/core/model/preferences/DeletePreferences.java\n    \n    \n         Line 35\n      in\n      6ef8e89\n    \n    \n    \n    \n\n        \n          \n           putBoolean(IDeletePreferences.PREFERENCE_CONFIRM_DELETE, true, DefaultScope.class); \n        \n    \n  \n\n do nothing if DefaultScope.\nIf ProjectScope, like used in initializer, as there is never a selected project at startup, its also weird.", "author": "pdulth", "createdAt": "2020-06-01T16:05:45Z", "path": "core/plugins/org.polarsys.capella.core.sirius.analysis/src/org/polarsys/capella/core/sirius/analysis/preferences/TitleBlockPreferencesInitializer.java", "diffHunk": "@@ -14,73 +14,53 @@\n \r\n import org.eclipse.jface.preference.IPreferenceStore;\r\n import org.polarsys.capella.core.commands.preferences.service.AbstractPreferencesInitializer;\r\n+import org.polarsys.capella.core.commands.preferences.service.ScopedCapellaPreferencesStore;\r\n import org.polarsys.capella.core.platform.sirius.ui.actions.CapellaActionsActivator;\r\n-import org.polarsys.capella.core.preferences.Activator;\r\n \r\n public class TitleBlockPreferencesInitializer extends AbstractPreferencesInitializer {\r\n \r\n-  public static final String TABEL_CONTENT_PREFERENCE_STORE = \"tableTitleBlock\";\r\n-  public static final String COLUMNS_NUMBER_PREFERENCE_STORE = \"columnsNumberTitleBlock\";\r\n-  public static final String LINES_NUMBER_PREFERENCE_STORE = \"linesNumberTitleBlock\";\r\n-  public static final String DEFAULT_TITLEBLOCK_PREFERENCE_STORE = \"defaultTitleBlock\";\r\n-  public static final String SEPARATOR = \"SEPARATOR\";\r\n-  public static final String DEFAULT_TABLE = \"Name\" + SEPARATOR + \"feature:name\" + SEPARATOR + \"Synchronized\" \r\n-  + SEPARATOR + \"aql:self.representation.synchronized\" + SEPARATOR + \"Summary\" + SEPARATOR + \"aql:self.target.summary\" + SEPARATOR\r\n-  + \"Description\" + SEPARATOR + \"feature:documentation\";\r\n-\r\n-  \r\n   public TitleBlockPreferencesInitializer() {\r\n     super(CapellaActionsActivator.PLUGIN_ID);\r\n   }\r\n \r\n   @Override\r\n   public void initializeDefaultPreferences() {\r\n-    IPreferenceStore preferenceStore = doGetPreferenceStore();\r\n-    preferenceStore.setDefault(COLUMNS_NUMBER_PREFERENCE_STORE, 2);\r\n-    preferenceStore.setDefault(LINES_NUMBER_PREFERENCE_STORE, 2);\r\n-    preferenceStore.setDefault(TABEL_CONTENT_PREFERENCE_STORE, DEFAULT_TABLE);\r\n-\r\n-    preferenceStore.setDefault(DEFAULT_TITLEBLOCK_PREFERENCE_STORE, false);\r\n-  }\r\n-  \r\n-  \r\n-  /**\r\n-   * @return IPreferenceStore the default preference store instance\r\n-   */\r\n-  public static IPreferenceStore doGetPreferenceStore() {\r\n-    return Activator.getDefault().getPreferenceStore();\r\n+    IPreferenceStore preferenceStore = ScopedCapellaPreferencesStore.getInstance(CapellaActionsActivator.PLUGIN_ID);\r\n+    preferenceStore.setDefault(TitleBlockPreferencePage.COLUMNS_NUMBER_PREFERENCE_STORE, 2);\r", "originalCommit": "e45cc0c440da29415ef8838ec8daac5fface18be", "replyToReviewId": null, "replies": null, "type": "inlineReview"}]}