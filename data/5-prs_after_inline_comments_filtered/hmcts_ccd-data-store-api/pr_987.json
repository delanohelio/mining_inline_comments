{"pr_number": 987, "pr_title": "RDM-8606 Implement Add Case-Assigned User and Role", "pr_createdAt": "2020-06-22T10:39:22Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/987", "timeline": [{"oid": "7b0fb8a485c6db005f4781264e3248bcfe3b934c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/7b0fb8a485c6db005f4781264e3248bcfe3b934c", "message": "RDM-8606 Implement Add Case-Assigned User and Role\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nFirst cut of code for draft PR without tests which are still in progress", "committedDate": "2020-06-12T10:32:43Z", "type": "commit"}, {"oid": "c54de6e29db42b5e4586a76216a1509f52abef3a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c54de6e29db42b5e4586a76216a1509f52abef3a", "message": "RDM-8606 Tests for Add Case-Assigned User and Role\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)", "committedDate": "2020-06-17T08:24:33Z", "type": "commit"}, {"oid": "1cb85986c305803c5f32b5060492afe3c1a788b0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1cb85986c305803c5f32b5060492afe3c1a788b0", "message": "Merge branch 'RDM-8606-from-8344' into RDM-8606\n\nConflicts:\n\tsrc/main/java/uk/gov/hmcts/ccd/v2/external/resource/CaseAssignedUserRolesResource.java\n\tsrc/main/resources/application.properties\n\tsrc/test/java/uk/gov/hmcts/ccd/v2/external/controller/CaseAssignedUserRolesControllerIT.java", "committedDate": "2020-06-18T08:41:07Z", "type": "commit"}, {"oid": "fabd5f0c85aa71bdea9ffca3c5cbf554428abfcd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fabd5f0c85aa71bdea9ffca3c5cbf554428abfcd", "message": "RDM-8606 accommodate OIDC changes to service name\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nChanges to retrieval of client service name after OIDC changes:-\n* Read service name directly from S2S Token,\n* Revert CaseAssignedUserRoleValidator code.", "committedDate": "2020-06-18T16:29:15Z", "type": "commit"}, {"oid": "d410656cec67ed1916d2e1aaa63fe468e531b3f9", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d410656cec67ed1916d2e1aaa63fe468e531b3f9", "message": "RDM-8606 lookup case ID when adding case-user-role\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nConvert case reference to case ID when adding a case-use-role.", "committedDate": "2020-06-19T15:44:50Z", "type": "commit"}, {"oid": "a54279da3957a493af09f8d1e69f355b2ab1a054", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a54279da3957a493af09f8d1e69f355b2ab1a054", "message": "RDM-8606 add Log Audit to get case-user-roles\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nAdd LogAudit config to getCaseUserRoles.", "committedDate": "2020-06-22T10:29:21Z", "type": "commit"}, {"oid": "2ac2e4f11598866c29782dd2231d1e7f7f1ccb41", "url": "https://github.com/hmcts/ccd-data-store-api/commit/2ac2e4f11598866c29782dd2231d1e7f7f1ccb41", "message": "RDM-8606 Minor updates for Sonar and Swagger\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\n* Address SonarCloud issues reported against tests.\n* Add NotFound scenario to add case-user-roles swagger config.", "committedDate": "2020-06-22T12:11:58Z", "type": "commit"}, {"oid": "8c9f56ec4e15054795932d06199bd5184493a79f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8c9f56ec4e15054795932d06199bd5184493a79f", "message": "RDM-8606 Minor updates for Sonar\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nAddress SonarCloud issues reported against tests.", "committedDate": "2020-06-22T13:15:17Z", "type": "commit"}, {"oid": "cbc4b85bc26047eeafe90d541b2f459799c3e74c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/cbc4b85bc26047eeafe90d541b2f459799c3e74c", "message": "RDM-8606 Minor updates for Swagger\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nAdd standard 401/403 scenarios to add case-user-roles swagger config.", "committedDate": "2020-06-25T10:39:25Z", "type": "commit"}, {"oid": "399fcd10c834d375f5a667e3f92935028f0b2ab7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/399fcd10c834d375f5a667e3f92935028f0b2ab7", "message": "Merge branch 'develop' into RDM-8606", "committedDate": "2020-06-25T12:25:22Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUyNDI3Mg==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#discussion_r445524272", "bodyText": "You made me find out https://www.quora.com/What-does-the-abbreviation-N-B-mean-and-why-do-people-use-it. :)", "author": "MSancaktutar", "createdAt": "2020-06-25T12:37:09Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/cauroles/AuthorisedCaseAssignedUserRolesOperation.java", "diffHunk": "@@ -23,6 +23,12 @@ public AuthorisedCaseAssignedUserRolesOperation(final @Qualifier(\"default\") Case\n         this.cauRoleValidator = cauRoleValidator;\n     }\n \n+    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+        // NB: Although there are no user based authorisation steps performed here ...", "originalCommit": "399fcd10c834d375f5a667e3f92935028f0b2ab7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ0NTUzMDI1Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/987#discussion_r445530253", "bodyText": "Calling caseDetailsRepository.findByReference again and again for every distinct case reference may not be performant enough in for a call sending case role assignments for many distinct cases, but as per the current non-functional requirements, we can still accept this.", "author": "MSancaktutar", "createdAt": "2020-06-25T12:47:21Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -104,6 +122,15 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n             .collect(Collectors.toCollection(ArrayList::new));\n     }\n \n+    private List<CaseDetails> getCaseDetailsList(List<Long> caseReferences) {\n+        return caseReferences.stream()\n+            .map(caseReference -> {\n+                Optional<CaseDetails> caseDetails = caseDetailsRepository.findByReference(null, caseReference);", "originalCommit": "399fcd10c834d375f5a667e3f92935028f0b2ab7", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "8c92fa7c215dda5853c4ec610fecd1cda7879660", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8c92fa7c215dda5853c4ec610fecd1cda7879660", "message": "RDM-8606 Change success API status to 201:CREATED\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nUse 201:CREATED HTTP status for success calls to add case-user-roles.", "committedDate": "2020-06-25T14:26:12Z", "type": "commit"}, {"oid": "01b1a890b2737528fb10563daf7af1bd8a88ccf0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/01b1a890b2737528fb10563daf7af1bd8a88ccf0", "message": "RDM-8806 FTA for 'Add Case-Assigned User and Role'\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)\n\nFTA for 'Add Case-Assigned User and Role' (Dev ticket is RDM-8606).", "committedDate": "2020-06-25T14:56:55Z", "type": "commit"}, {"oid": "fe78b62d90de97a87a95b530964fcb6d0017098b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fe78b62d90de97a87a95b530964fcb6d0017098b", "message": "use latest fw version", "committedDate": "2020-06-25T16:07:07Z", "type": "commit"}, {"oid": "effda29ab197cbca7c68d51fd0c5e757ac2e2dc4", "url": "https://github.com/hmcts/ccd-data-store-api/commit/effda29ab197cbca7c68d51fd0c5e757ac2e2dc4", "message": "Merge branch 'RDM-8606' into RDM-8806-from-8606\n\nConflicts:\n\tbuild.gradle", "committedDate": "2020-06-25T16:08:09Z", "type": "commit"}, {"oid": "a5289bb64f5d6594c5ac6850abeaa331b1f37365", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a5289bb64f5d6594c5ac6850abeaa331b1f37365", "message": "use empty string notation with fw prerelease", "committedDate": "2020-06-26T11:31:11Z", "type": "commit"}, {"oid": "5a43bbfc964e90cf7981b9130db78e531b9a2da1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5a43bbfc964e90cf7981b9130db78e531b9a2da1", "message": "correct empty string notations", "committedDate": "2020-06-26T12:06:21Z", "type": "commit"}, {"oid": "1308199e6370b8a6ee687a6515c30bedeb585731", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1308199e6370b8a6ee687a6515c30bedeb585731", "message": "correct use of empty string notations", "committedDate": "2020-06-26T12:12:32Z", "type": "commit"}, {"oid": "3123bc24294f5b9fb947f95fd7a7a48af9c7c02a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3123bc24294f5b9fb947f95fd7a7a48af9c7c02a", "message": "use corrected prerelease", "committedDate": "2020-06-26T12:41:26Z", "type": "commit"}, {"oid": "9ec153f01e0dc15d93f5bb52b79bccf24721dff3", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9ec153f01e0dc15d93f5bb52b79bccf24721dff3", "message": "cleanup", "committedDate": "2020-06-26T12:41:37Z", "type": "commit"}, {"oid": "c804a760482139be8a2e7085d8f982db2cc563b7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c804a760482139be8a2e7085d8f982db2cc563b7", "message": "fix copy paste mistake", "committedDate": "2020-06-26T13:05:28Z", "type": "commit"}, {"oid": "e7b426ffafddbf0de0289a4e5f0c1f5ba56f8828", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e7b426ffafddbf0de0289a4e5f0c1f5ba56f8828", "message": "use latest stable fw release", "committedDate": "2020-06-26T13:08:34Z", "type": "commit"}, {"oid": "2d216909ac6ee3857bd77d9a6d4f4b92cfbd368a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/2d216909ac6ee3857bd77d9a6d4f4b92cfbd368a", "message": "RDM-8806 dev review changes\n\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)", "committedDate": "2020-06-26T13:57:05Z", "type": "commit"}, {"oid": "b44ad73c64cde802e81e934e5720bdd809d72fe5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b44ad73c64cde802e81e934e5720bdd809d72fe5", "message": "improve data reuse from base objects", "committedDate": "2020-06-26T14:33:10Z", "type": "commit"}, {"oid": "9f2798d93dd30d70a03c0edf6019a0ed411b80af", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9f2798d93dd30d70a03c0edf6019a0ed411b80af", "message": "polish format", "committedDate": "2020-06-26T14:46:15Z", "type": "commit"}, {"oid": "f83138999395c3d21ee554dfc9d8fb965f5edc7d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f83138999395c3d21ee554dfc9d8fb965f5edc7d", "message": "correct the field name", "committedDate": "2020-06-26T14:59:09Z", "type": "commit"}, {"oid": "1a8d0db53ef5d068b766e84ef74e7cbf95ffc5a2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1a8d0db53ef5d068b766e84ef74e7cbf95ffc5a2", "message": "RDM-8606 Minor updates for Swagger\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n\nRemove default 200 repsonse status from add case-user-roles swagger.", "committedDate": "2020-06-26T15:12:57Z", "type": "commit"}, {"oid": "00355aab639f70af21345e401c487509c1ceb63c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/00355aab639f70af21345e401c487509c1ceb63c", "message": "correct product name", "committedDate": "2020-06-26T15:20:20Z", "type": "commit"}, {"oid": "a126034e307b12e089e4151827c65a00c488e4d6", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a126034e307b12e089e4151827c65a00c488e4d6", "message": "Merge branch 'RDM-8806-from-8606' of git@github.com:hmcts/ccd-data-store-api.git into RDM-8806-from-8606", "committedDate": "2020-06-26T15:21:08Z", "type": "commit"}, {"oid": "01aea69cc74db7c18732fdd09fb8391233b2cca3", "url": "https://github.com/hmcts/ccd-data-store-api/commit/01aea69cc74db7c18732fdd09fb8391233b2cca3", "message": "fix oper name", "committedDate": "2020-06-26T15:40:40Z", "type": "commit"}, {"oid": "cb408c8b71260ea1be925565869dd95f742fd977", "url": "https://github.com/hmcts/ccd-data-store-api/commit/cb408c8b71260ea1be925565869dd95f742fd977", "message": "Merge pull request #993 from hmcts/RDM-8806-from-8606\n\nRDM-8806 FTA for 'Add Case-Assigned User and Role'", "committedDate": "2020-06-26T16:35:28Z", "type": "commit"}]}