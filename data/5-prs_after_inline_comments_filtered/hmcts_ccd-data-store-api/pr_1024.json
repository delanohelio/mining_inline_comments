{"pr_number": 1024, "pr_title": "RDM-8842 Increment Assigned User Count of Cases when Assigned to Users", "pr_createdAt": "2020-07-22T08:15:48Z", "pr_url": "https://github.com/hmcts/ccd-data-store-api/pull/1024", "timeline": [{"oid": "68c5e06e0f410767673ea75e71e39f10b4b905a6", "url": "https://github.com/hmcts/ccd-data-store-api/commit/68c5e06e0f410767673ea75e71e39f10b4b905a6", "message": "Merge branch 'develop' into RDM-8842", "committedDate": "2020-08-10T09:21:00Z", "type": "commit"}, {"oid": "f29a2a3030e98138d8127e9ced1c01e7a6937dd0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f29a2a3030e98138d8127e9ced1c01e7a6937dd0", "message": "Merge branch 'develop' into RDM-8842\n\nConflicts:\n\tJenkinsfile_CNP", "committedDate": "2020-08-10T09:29:26Z", "type": "commit"}, {"oid": "b21fc992fa089cd8ff09473c2ea0acfc1cf3eac4", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b21fc992fa089cd8ff09473c2ea0acfc1cf3eac4", "message": "RDM-8842 Restructure RDM-8606/RDM-8806 FTA files\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRestructure existing FTA files for 'Add Case-Assigned User and Role'.", "committedDate": "2020-07-13T13:53:33Z", "type": "commit"}, {"oid": "9cb5f9e2cfe3120c9eb5fd89b2940b8ee1573e52", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9cb5f9e2cfe3120c9eb5fd89b2940b8ee1573e52", "message": "RDM-8842 Restructure RDM-8606/RDM-8806 FTA files\n\n   [RDM-8606](https://tools.hmcts.net/jira/browse/RDM-8606)\n   [RDM-8806](https://tools.hmcts.net/jira/browse/RDM-8806)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRestructure existing FTA files for 'Add Case-Assigned User and Role'.\n\nAdjust RDM-8606/RDM-8806 scenarios to match original AC format.\n\nConflicts:\n\tbuild.gradle", "committedDate": "2020-07-13T14:07:39Z", "type": "commit"}, {"oid": "6f1c81858e46be2f02225035cb854559f80a26c4", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6f1c81858e46be2f02225035cb854559f80a26c4", "message": "RDM-8842 Increment Assigned User Count (FTA: draft)\n\n   [RDM-8895](https://tools.hmcts.net/jira/browse/RDM-8895)\n\nRDM-8842: Increment Assigned User Count of Cases when Assigned to Users", "committedDate": "2020-07-13T14:21:06Z", "type": "commit"}, {"oid": "e16d45edfbe89302f05474199c5c1381c6709464", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e16d45edfbe89302f05474199c5c1381c6709464", "message": "RDM-8842: Update BEFTA test for A/C 1 related to 8842\n\t- Set up test data for A/C 1 scenarios", "committedDate": "2020-07-14T13:10:44Z", "type": "commit"}, {"oid": "a3bb0a5399c04141b1c7e062bce7b9efafa48b15", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a3bb0a5399c04141b1c7e062bce7b9efafa48b15", "message": "RDM-8842: Update BEFTA test for A/C 1 related to 8842\n            - Set up test data for A/C 1 scenarios", "committedDate": "2020-07-14T13:16:11Z", "type": "commit"}, {"oid": "c8d5fb5a61857181c4c488667c2ad0fdee639125", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c8d5fb5a61857181c4c488667c2ad0fdee639125", "message": "RDM-8842: Comple A/C 2,3 and 4 as well as additional refactor\n\t- Refactor verify files\n\t- Refactor Verify counter files to remove some code duplication", "committedDate": "2020-07-16T13:08:48Z", "type": "commit"}, {"oid": "1633ae2c38472ca2798d87d71eb7b70da4dae2f7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1633ae2c38472ca2798d87d71eb7b70da4dae2f7", "message": "RDM-8842: Alter feature file to fix typo\n\t- refactor test data files to account for the typo in the feature file and A/C 4", "committedDate": "2020-07-17T10:15:17Z", "type": "commit"}, {"oid": "9d8d15f6c81f955458e17945e446443df4d9bac5", "url": "https://github.com/hmcts/ccd-data-store-api/commit/9d8d15f6c81f955458e17945e446443df4d9bac5", "message": "RDM-8842 Refactor FTA files\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nAdjust Verify Counter TD files to reflect AC description in ticket.", "committedDate": "2020-07-20T10:47:34Z", "type": "commit"}, {"oid": "5cf280c1370b9a2cdafcedf5e76be7e1cf9e4b2e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5cf280c1370b9a2cdafcedf5e76be7e1cf9e4b2e", "message": "RDM-8842 Increment Assigned User Count\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRDM-8842: Increment Assigned User Count of Cases when Assigned to Users.\n\nFirst working draft before refactoring.", "committedDate": "2020-07-20T11:19:46Z", "type": "commit"}, {"oid": "35ee72cc6335f7324c47614ad6709264f507a991", "url": "https://github.com/hmcts/ccd-data-store-api/commit/35ee72cc6335f7324c47614ad6709264f507a991", "message": "RDM-8842 Increment Assigned User Count (refactor)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nRefactor:\n * convert caseReference to caseId upfront rather than in two locations.\n * group by case ID first so conversion is only required once.\n * also allows it to fail fast when a case has not been found.", "committedDate": "2020-07-20T15:56:37Z", "type": "commit"}, {"oid": "5545765cedea25e79b95031d8d863c5d1a098202", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5545765cedea25e79b95031d8d863c5d1a098202", "message": "RDM-8842 Increment Assigned User Count (test)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nUnit and Integration tests for changes under RDM-8842.", "committedDate": "2020-07-22T07:57:31Z", "type": "commit"}, {"oid": "f3426c863586e58a3dc55a52ee9e5f6faa2ba7ce", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f3426c863586e58a3dc55a52ee9e5f6faa2ba7ce", "message": "RDM-8842 Increment Assigned User Count (refactor)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nUse separate data models for the Add and Get APIs so the new\n `organisation_id` property used only by the Add API doesn't pollute\n the Get API's swagger definition.", "committedDate": "2020-07-22T13:31:57Z", "type": "commit"}, {"oid": "0dc05bc9a63a4a4e545baa9e7529df63a7db3c0d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0dc05bc9a63a4a4e545baa9e7529df63a7db3c0d", "message": "RDM-8842 Increment Assigned User Count (FTA)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nChange 4th BEFTA account choice but keep to same jurisdiction.", "committedDate": "2020-07-22T16:08:58Z", "type": "commit"}, {"oid": "5c80264f8122058d38ac5396bdcd047e8ed6041f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5c80264f8122058d38ac5396bdcd047e8ed6041f", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842", "committedDate": "2020-07-22T16:10:09Z", "type": "commit"}, {"oid": "23dcb66ccb282a4eb3c9b80a076476c625e24c35", "url": "https://github.com/hmcts/ccd-data-store-api/commit/23dcb66ccb282a4eb3c9b80a076476c625e24c35", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/F-105.feature", "committedDate": "2020-07-27T13:51:13Z", "type": "commit"}, {"oid": "6e73508818f38eccc8566d563e7d88837605275a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6e73508818f38eccc8566d563e7d88837605275a", "message": "RDM-8842 Refactor FTA files\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\n* Move and rename FTA files to create separate folders for each AC.\n* Adjust user references to load user data from parent context.", "committedDate": "2020-07-27T17:41:01Z", "type": "commit"}, {"oid": "e4cdb60cea9d5568183a1dd8a595aceb67c75c6b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e4cdb60cea9d5568183a1dd8a595aceb67c75c6b", "message": "use latest prerelease", "committedDate": "2020-07-27T17:41:47Z", "type": "commit"}, {"oid": "ed2c8aa874479e5a62842eecb7e70d67385348c2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ed2c8aa874479e5a62842eecb7e70d67385348c2", "message": "use fixed prerelease", "committedDate": "2020-07-27T18:33:54Z", "type": "commit"}, {"oid": "58c27e651944d6a686cf1c33befc4a44d335a9d8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/58c27e651944d6a686cf1c33befc4a44d335a9d8", "message": "correct test data configuration", "committedDate": "2020-07-27T19:14:26Z", "type": "commit"}, {"oid": "609ae6d569a6cd97bb603c64040808bfd19fcdd3", "url": "https://github.com/hmcts/ccd-data-store-api/commit/609ae6d569a6cd97bb603c64040808bfd19fcdd3", "message": "use merged prerelease", "committedDate": "2020-07-27T19:21:30Z", "type": "commit"}, {"oid": "6e9921d7d70d8b34d3ce6e127bfd97f66cc5ac43", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6e9921d7d70d8b34d3ce6e127bfd97f66cc5ac43", "message": "correct user", "committedDate": "2020-07-27T19:48:19Z", "type": "commit"}, {"oid": "e110bf76adc38bc3f0643731574726ccc1ba3ac2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e110bf76adc38bc3f0643731574726ccc1ba3ac2", "message": "use latest prerelease", "committedDate": "2020-07-27T20:13:42Z", "type": "commit"}, {"oid": "fc41013a08341c6f095c73f33545e33c30545461", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fc41013a08341c6f095c73f33545e33c30545461", "message": "further user setup corrections", "committedDate": "2020-07-27T20:22:26Z", "type": "commit"}, {"oid": "f509b5ee8b30495c5dc0ad351f9dbdc3a687c339", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f509b5ee8b30495c5dc0ad351f9dbdc3a687c339", "message": "fix typo", "committedDate": "2020-07-27T20:55:53Z", "type": "commit"}, {"oid": "1d64db441458096c99e1d92b5faa75ef30caa67a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1d64db441458096c99e1d92b5faa75ef30caa67a", "message": "correct whitespacing", "committedDate": "2020-07-27T20:56:20Z", "type": "commit"}, {"oid": "8678d917131333b01c90e28ad11179940320b2ec", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8678d917131333b01c90e28ad11179940320b2ec", "message": "correct invoking user", "committedDate": "2020-07-27T21:27:45Z", "type": "commit"}, {"oid": "c96440c5e7c2bce4b958dadbab810124e3c00750", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c96440c5e7c2bce4b958dadbab810124e3c00750", "message": "fix wrong token creation", "committedDate": "2020-07-27T21:42:14Z", "type": "commit"}, {"oid": "5a44b40f7a59b39128348b4202275e51b86b1449", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5a44b40f7a59b39128348b4202275e51b86b1449", "message": "new prerelease", "committedDate": "2020-07-27T21:50:41Z", "type": "commit"}, {"oid": "b6ce3d244209aef6449abff91e16e27cabf03e47", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b6ce3d244209aef6449abff91e16e27cabf03e47", "message": "Merge pull request #1030 from hmcts/aca-11\n\nuse latest prerelease", "committedDate": "2020-07-28T09:13:16Z", "type": "commit"}, {"oid": "c776b98c99a0f02a483d8669517e742e7269f100", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c776b98c99a0f02a483d8669517e742e7269f100", "message": "Update Chart.yaml", "committedDate": "2020-07-28T09:25:05Z", "type": "commit"}, {"oid": "1b0b09bf2e131e50b954776de3ef296b0490ab7b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1b0b09bf2e131e50b954776de3ef296b0490ab7b", "message": "use latest stable release", "committedDate": "2020-07-28T10:53:50Z", "type": "commit"}, {"oid": "00c8b4eca1fbc7a8d5ab10947dd7f2323d4dfc73", "url": "https://github.com/hmcts/ccd-data-store-api/commit/00c8b4eca1fbc7a8d5ab10947dd7f2323d4dfc73", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/F-105_Add_Case_Assigned_User_Roles_400_response.td.json\n\tsrc/aat/resources/features/F-105/F-105_Users.td.json\n\tsrc/aat/resources/features/F-105/S-105.1.verify.td.json\n\tsrc/aat/resources/features/F-105/S-105.11.td.json", "committedDate": "2020-07-28T12:17:39Z", "type": "commit"}, {"oid": "7c2f324b5f2350395fc141ce4264d7abb69fa13f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/7c2f324b5f2350395fc141ce4264d7abb69fa13f", "message": "RDM-8842 Refactor FTA files after BEFTA FW upgrade\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\n* Adjust user references to fit with BEFTA FW changes.", "committedDate": "2020-07-28T15:49:37Z", "type": "commit"}, {"oid": "6b351f7f03fb08dd02fb35f88662fc25bc6ca686", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6b351f7f03fb08dd02fb35f88662fc25bc6ca686", "message": "RDM-9143: Resolve unique id issue and enable ES", "committedDate": "2020-07-29T08:25:28Z", "type": "commit"}, {"oid": "ec253640388be0f08241d36414fdfb5afbb9102e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ec253640388be0f08241d36414fdfb5afbb9102e", "message": "Adding db ChangeLog for new indexes created as part of RDM-8463 (#959)\n\n* Adding db ChangeLog for new indexes created as part of RDM-8463\r\n\r\n* Adding db ChangeLog for new indexes created as part of RDM-8463\r\n\r\n* Removed duplicate entry\r\n\r\nCo-authored-by: sumansreenivasan <anuManu10>\r\nCo-authored-by: Olawale Olanrewaju <olanrewajume@yahoo.com>", "committedDate": "2020-07-29T08:44:26Z", "type": "commit"}, {"oid": "a8259719e3060bfd55210601dd72b8b1eb3b3fe7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a8259719e3060bfd55210601dd72b8b1eb3b3fe7", "message": "RDM-9143: Trigger rebuild of Docker", "committedDate": "2020-07-29T09:01:21Z", "type": "commit"}, {"oid": "bf9f3de4ed4e4b53cb7cfb2276fd5744c16ce729", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bf9f3de4ed4e4b53cb7cfb2276fd5744c16ce729", "message": "RDM-9143: Change definition store pr run against", "committedDate": "2020-07-29T10:50:43Z", "type": "commit"}, {"oid": "aa0c471ea575b1be98f1354718d224c6f292f81a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/aa0c471ea575b1be98f1354718d224c6f292f81a", "message": "Trigger Build", "committedDate": "2020-07-29T11:23:31Z", "type": "commit"}, {"oid": "66033a1bcdc5ab0161a9533ffbc30a5734a2611f", "url": "https://github.com/hmcts/ccd-data-store-api/commit/66033a1bcdc5ab0161a9533ffbc30a5734a2611f", "message": "Trigger Build", "committedDate": "2020-07-29T11:55:14Z", "type": "commit"}, {"oid": "17d6e83445dc2aa7f4edc4f8cc243e734e8a0a08", "url": "https://github.com/hmcts/ccd-data-store-api/commit/17d6e83445dc2aa7f4edc4f8cc243e734e8a0a08", "message": "refine feature titles", "committedDate": "2020-07-29T12:32:02Z", "type": "commit"}, {"oid": "f0cf1b291396ff95b324adced05019c68a591ec8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f0cf1b291396ff95b324adced05019c68a591ec8", "message": "declare acls unordered", "committedDate": "2020-07-29T12:52:16Z", "type": "commit"}, {"oid": "0ba5545fefc47b43abad7996b138eedebbb9b6fe", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0ba5545fefc47b43abad7996b138eedebbb9b6fe", "message": "declare acls unordered", "committedDate": "2020-07-29T13:04:07Z", "type": "commit"}, {"oid": "242ae50f75768369560fe4ccbaccbc348a2b4e52", "url": "https://github.com/hmcts/ccd-data-store-api/commit/242ae50f75768369560fe4ccbaccbc348a2b4e52", "message": "RDM-9143: Fix case_types_results issues in FTA tests", "committedDate": "2020-07-29T14:35:21Z", "type": "commit"}, {"oid": "d03341d196292bd477ec8d9002a0611990e8db2e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d03341d196292bd477ec8d9002a0611990e8db2e", "message": "fix user config", "committedDate": "2020-07-29T16:38:17Z", "type": "commit"}, {"oid": "97d8ebb150b7a3a264dd8d430a753f185669571a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/97d8ebb150b7a3a264dd8d430a753f185669571a", "message": "Merge branch 'RDM-9143.new' of git@github.com:hmcts/ccd-data-store-api.git into RDM-9143.new", "committedDate": "2020-07-29T16:38:38Z", "type": "commit"}, {"oid": "59d92644fb51e9bd135a2d8dc49cbd3686d4390a", "url": "https://github.com/hmcts/ccd-data-store-api/commit/59d92644fb51e9bd135a2d8dc49cbd3686d4390a", "message": "Merge branch 'release-cut-19.1' into develop", "committedDate": "2020-07-29T16:42:52Z", "type": "commit"}, {"oid": "040f61655acbf6ec632a09e52cf042cf60f7a439", "url": "https://github.com/hmcts/ccd-data-store-api/commit/040f61655acbf6ec632a09e52cf042cf60f7a439", "message": "Merge branch 'develop' into RDM-9143.new", "committedDate": "2020-07-29T16:43:13Z", "type": "commit"}, {"oid": "26774efae4dfa81288d81177d7b74f16f413c1ce", "url": "https://github.com/hmcts/ccd-data-store-api/commit/26774efae4dfa81288d81177d7b74f16f413c1ce", "message": "fix user config", "committedDate": "2020-07-29T17:22:36Z", "type": "commit"}, {"oid": "21f270d2baafc3dbdbf4c0913c52969db92a63ef", "url": "https://github.com/hmcts/ccd-data-store-api/commit/21f270d2baafc3dbdbf4c0913c52969db92a63ef", "message": "remove redundant line", "committedDate": "2020-07-29T17:23:21Z", "type": "commit"}, {"oid": "383cbdeebbfbe7cc21435bd49e0844e398e65323", "url": "https://github.com/hmcts/ccd-data-store-api/commit/383cbdeebbfbe7cc21435bd49e0844e398e65323", "message": "RDM-9143: Fix broken test for quantity of objects in list\n\t- add ignore annotation to all tests that fail with LAST_STATE_MODIFIED_DATE issue - fix coming in 19.1", "committedDate": "2020-07-29T19:48:25Z", "type": "commit"}, {"oid": "be1607d82cfd13d4e94d48894e3bab5e12c87eb6", "url": "https://github.com/hmcts/ccd-data-store-api/commit/be1607d82cfd13d4e94d48894e3bab5e12c87eb6", "message": "correct user config", "committedDate": "2020-07-29T22:17:29Z", "type": "commit"}, {"oid": "f787d70217d03465ec9659e4196290e1c11c2a23", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f787d70217d03465ec9659e4196290e1c11c2a23", "message": "cleanup", "committedDate": "2020-07-29T22:24:11Z", "type": "commit"}, {"oid": "072e3471b8cce5f96445d9042913b7b69089baec", "url": "https://github.com/hmcts/ccd-data-store-api/commit/072e3471b8cce5f96445d9042913b7b69089baec", "message": "fix syntax", "committedDate": "2020-07-29T22:27:11Z", "type": "commit"}, {"oid": "8eb2e67731f06d316935e1e77c6f1ae98d7c3901", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8eb2e67731f06d316935e1e77c6f1ae98d7c3901", "message": "Merge pull request #1033 from hmcts/RDM-9143.new\n\nRdm 9143.new", "committedDate": "2020-07-30T07:26:31Z", "type": "commit"}, {"oid": "f04264c68ded3e099fc54408075a07c2c41c207d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f04264c68ded3e099fc54408075a07c2c41c207d", "message": "use def store develop", "committedDate": "2020-07-30T08:43:16Z", "type": "commit"}, {"oid": "a113edc9e8960f18c027b8bdfc5238fcd122611d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a113edc9e8960f18c027b8bdfc5238fcd122611d", "message": "use def store develop", "committedDate": "2020-07-30T08:43:39Z", "type": "commit"}, {"oid": "68eb05c59d4389c89901734b3aa48c6855c807c8", "url": "https://github.com/hmcts/ccd-data-store-api/commit/68eb05c59d4389c89901734b3aa48c6855c807c8", "message": "disable ES FTAs on feature branches", "committedDate": "2020-07-30T11:11:19Z", "type": "commit"}, {"oid": "6cf238b1f71b89affa230e942658e83bb67175ff", "url": "https://github.com/hmcts/ccd-data-store-api/commit/6cf238b1f71b89affa230e942658e83bb67175ff", "message": "Trigger Build", "committedDate": "2020-07-30T12:23:04Z", "type": "commit"}, {"oid": "3d1e82a0cda55a8741741dbe3a4c69ccd5a448aa", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3d1e82a0cda55a8741741dbe3a4c69ccd5a448aa", "message": "Trigger Build", "committedDate": "2020-07-30T12:51:40Z", "type": "commit"}, {"oid": "d3bf7204dd1ce8dabf4070e67cf593d6d766949c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d3bf7204dd1ce8dabf4070e67cf593d6d766949c", "message": "Revert \"disable ES FTAs on feature branches\"\n\nThis reverts commit 68eb05c59d4389c89901734b3aa48c6855c807c8.", "committedDate": "2020-07-30T13:53:42Z", "type": "commit"}, {"oid": "cd5f07cf912f41550a0103c45c1ecdb2173993cd", "url": "https://github.com/hmcts/ccd-data-store-api/commit/cd5f07cf912f41550a0103c45c1ecdb2173993cd", "message": "Revert \"Revert \"disable ES FTAs on feature branches\"\"\n\nThis reverts commit d3bf7204dd1ce8dabf4070e67cf593d6d766949c.", "committedDate": "2020-07-30T15:13:06Z", "type": "commit"}, {"oid": "7f26e595e0c89dbd9167a970b6f9dd37e41e2855", "url": "https://github.com/hmcts/ccd-data-store-api/commit/7f26e595e0c89dbd9167a970b6f9dd37e41e2855", "message": "cleanup and tidy up", "committedDate": "2020-07-30T16:19:04Z", "type": "commit"}, {"oid": "667d27102b36ebcaa09a36ad50a2aa1c1d543401", "url": "https://github.com/hmcts/ccd-data-store-api/commit/667d27102b36ebcaa09a36ad50a2aa1c1d543401", "message": "remove redundant code", "committedDate": "2020-07-30T16:31:35Z", "type": "commit"}, {"oid": "4279d1af60224267e9b42a8864cf81bfbdbc4afc", "url": "https://github.com/hmcts/ccd-data-store-api/commit/4279d1af60224267e9b42a8864cf81bfbdbc4afc", "message": "cleanup", "committedDate": "2020-07-30T16:35:55Z", "type": "commit"}, {"oid": "22ce42fbd8250c35549fb3f5b4ebe4bf82e12ba1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/22ce42fbd8250c35549fb3f5b4ebe4bf82e12ba1", "message": "rename env var to avoid confusion", "committedDate": "2020-07-30T16:36:18Z", "type": "commit"}, {"oid": "e7c322f353e62ef6623628fa6d2755ce2d82a952", "url": "https://github.com/hmcts/ccd-data-store-api/commit/e7c322f353e62ef6623628fa6d2755ce2d82a952", "message": "remove redudant env var for ftas", "committedDate": "2020-07-30T16:37:04Z", "type": "commit"}, {"oid": "b35331e55679ecc1e42b792a90cf9deada187a9c", "url": "https://github.com/hmcts/ccd-data-store-api/commit/b35331e55679ecc1e42b792a90cf9deada187a9c", "message": "remove invalid import", "committedDate": "2020-07-30T16:38:06Z", "type": "commit"}, {"oid": "cc7244d7c6ce56e569737169497f4351781876f0", "url": "https://github.com/hmcts/ccd-data-store-api/commit/cc7244d7c6ce56e569737169497f4351781876f0", "message": "Merge remote-tracking branch 'origin/develop' into RDM-8842", "committedDate": "2020-07-30T16:58:27Z", "type": "commit"}, {"oid": "fd6c401eaf5d949b2d126614c2379e455a50313e", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fd6c401eaf5d949b2d126614c2379e455a50313e", "message": "Merge pull request #1036 from hmcts/disable-es-FTAs-on-feature-branches\n\nDisable es ft as on feature branches", "committedDate": "2020-07-30T17:05:59Z", "type": "commit"}, {"oid": "8fd8f458536a37ec131463f217bf300d76495934", "url": "https://github.com/hmcts/ccd-data-store-api/commit/8fd8f458536a37ec131463f217bf300d76495934", "message": "fix env var setting", "committedDate": "2020-07-30T19:26:04Z", "type": "commit"}, {"oid": "91d78fd96ea11ddd80578bb8b2e4443c2c59c498", "url": "https://github.com/hmcts/ccd-data-store-api/commit/91d78fd96ea11ddd80578bb8b2e4443c2c59c498", "message": "use pr 601", "committedDate": "2020-07-30T20:03:18Z", "type": "commit"}, {"oid": "bc50061e51d1529ee57e60d7e422adf4eeef997d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/bc50061e51d1529ee57e60d7e422adf4eeef997d", "message": "echo ES FTA switch with the branch name", "committedDate": "2020-07-30T20:06:34Z", "type": "commit"}, {"oid": "827e080c5b2d2ed05acf34dd0dd85ab312afafef", "url": "https://github.com/hmcts/ccd-data-store-api/commit/827e080c5b2d2ed05acf34dd0dd85ab312afafef", "message": "correct 'branch' value", "committedDate": "2020-07-30T20:08:38Z", "type": "commit"}, {"oid": "1920f5c47ab734b87c163df826a5c04a44a40b46", "url": "https://github.com/hmcts/ccd-data-store-api/commit/1920f5c47ab734b87c163df826a5c04a44a40b46", "message": "Merge branch 'develop' into RDM-8842", "committedDate": "2020-07-30T23:26:17Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2NjQyNA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463466424", "bodyText": "The 2 class names don't have a parallelism in the semantics, breaching the expected connotation of an IS-A relation. The sentence CaseAssignedUserRoleRequest IS A CaseAssignedUserRole is technically correct, but linguistically wrong. Could you please propose a better fitting name for one or both of these to have a proper IS-A reading?", "author": "MSancaktutar", "createdAt": "2020-07-31T08:07:13Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/model/std/CaseAssignedUserRoleRequest.java", "diffHunk": "@@ -0,0 +1,28 @@\n+package uk.gov.hmcts.ccd.domain.model.std;\n+\n+import com.fasterxml.jackson.annotation.JsonInclude;\n+import com.fasterxml.jackson.annotation.JsonProperty;\n+import lombok.Getter;\n+import lombok.NoArgsConstructor;\n+import lombok.ToString;\n+\n+import static com.fasterxml.jackson.annotation.JsonInclude.Include;\n+\n+@ToString\n+@NoArgsConstructor\n+@Getter\n+public class CaseAssignedUserRoleRequest extends CaseAssignedUserRole {", "originalCommit": "1920f5c47ab734b87c163df826a5c04a44a40b46", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2NDkwMzUxMw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r464903513", "bodyText": "As discussed: will rename as CaseAssignedUserRoleWithOrganisation", "author": "mattnayler", "createdAt": "2020-08-04T08:56:33Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2NjQyNA=="}], "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2ODc3Mw==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463468773", "bodyText": "in the value of an entry, the list is not that of roles. perhaps a name like requestedAssignments could read", "author": "MSancaktutar", "createdAt": "2020-07-31T08:12:13Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,118 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleRequest> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleRequest>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, roles) ->", "originalCommit": "1920f5c47ab734b87c163df826a5c04a44a40b46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2ODk4MA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463468980", "bodyText": "how about requestedAssignment here?", "author": "MSancaktutar", "createdAt": "2020-07-31T08:12:42Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,118 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleRequest> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleRequest>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, roles) ->\n+            roles.forEach(caseUserRole ->", "originalCommit": "1920f5c47ab734b87c163df826a5c04a44a40b46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2MzQ2OTU1NQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r463469555", "bodyText": "newUserCounts returned shouldn't be nullable. If there is nothing to return, the method calculating this should return an empty map.", "author": "MSancaktutar", "createdAt": "2020-07-31T08:14:02Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,118 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleRequest> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleRequest>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, roles) ->\n+            roles.forEach(caseUserRole ->\n+                caseUserRepository.grantAccess(caseId, caseUserRole.getUserId(), caseUserRole.getCaseRole()))\n+        );\n+\n+        if (newUserCounts != null) {", "originalCommit": "1920f5c47ab734b87c163df826a5c04a44a40b46", "replyToReviewId": null, "replies": null, "type": "inlineReview"}, {"oid": "59a9d6db2cc41950908277875bc59d1cf4989e00", "url": "https://github.com/hmcts/ccd-data-store-api/commit/59a9d6db2cc41950908277875bc59d1cf4989e00", "message": "RDM-9118 FTA organisation adjustment for RDM-8842\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nIncrement Assigned User Count FTA organisation adjustment:\n* Load organisation data from PRD or test stub.\n* Add PRD reference to BEFTA section of JenkinsFile.", "committedDate": "2020-07-31T14:28:33Z", "type": "commit"}, {"oid": "a0ad630efb82e7065a72cc4f20a5ff4f5f36cd91", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a0ad630efb82e7065a72cc4f20a5ff4f5f36cd91", "message": "RDM-9118 use Befta FW pre-release\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nBefta FW changes for RDM-9118 FTA organisation adjustment for RDM-8842:\n* allow formulas to return more complex items: e.g. map, array...,\n* ReflectionUtils.deepGetFieldInObject now supports keys containing `.`,\n* adjust dynamic value injection processing of arrays & lists.", "committedDate": "2020-07-31T14:50:18Z", "type": "commit"}, {"oid": "f15fb5dabeaf530ec4a0a06d42453b2821de2506", "url": "https://github.com/hmcts/ccd-data-store-api/commit/f15fb5dabeaf530ec4a0a06d42453b2821de2506", "message": "Merge remote-tracking branch 'origin/RDM-8842' into RDM-9118-from-8842", "committedDate": "2020-07-31T14:57:35Z", "type": "commit"}, {"oid": "315f08c0683961a7095b3a0c6405a57f411bc7f1", "url": "https://github.com/hmcts/ccd-data-store-api/commit/315f08c0683961a7095b3a0c6405a57f411bc7f1", "message": "RDM-8842 dev review changes\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)", "committedDate": "2020-08-04T10:54:58Z", "type": "commit"}, {"oid": "ddc012ba6fbd99015daefab78aed0a2912947f3d", "url": "https://github.com/hmcts/ccd-data-store-api/commit/ddc012ba6fbd99015daefab78aed0a2912947f3d", "message": "Merge remote-tracking branch 'origin/RDM-8842' into RDM-9118-from-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_2.td.json", "committedDate": "2020-08-04T11:21:46Z", "type": "commit"}, {"oid": "a2299b77b8ee57e7385efd4eedd404ee0a762836", "url": "https://github.com/hmcts/ccd-data-store-api/commit/a2299b77b8ee57e7385efd4eedd404ee0a762836", "message": "RDM-9118 use Befta FW pre-release\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)\n\nBefta FW changes for RDM-9118 FTA organisation adjustment for RDM-8842:\n* allow formulas to return more complex items: e.g. map, array...,\n* ReflectionUtils.deepGetFieldInObject now supports keys containing `.`,\n* adjust dynamic value injection processing of arrays & lists.", "committedDate": "2020-08-04T11:33:17Z", "type": "commit"}, {"oid": "386f797ba41d69c7e430eb7f7776b0d69e535d98", "url": "https://github.com/hmcts/ccd-data-store-api/commit/386f797ba41d69c7e430eb7f7776b0d69e535d98", "message": "Merge branch 'develop' into RDM-8842", "committedDate": "2020-08-04T15:47:42Z", "type": "commit"}, {"oid": "c645868721080608b0d221e70564ffbbcd6ef5d2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/c645868721080608b0d221e70564ffbbcd6ef5d2", "message": "folder reorganisation", "committedDate": "2020-08-04T15:57:32Z", "type": "commit"}, {"oid": "149ac5187211ab98650630bc73ea2cf2afbef478", "url": "https://github.com/hmcts/ccd-data-store-api/commit/149ac5187211ab98650630bc73ea2cf2afbef478", "message": "RDM-8842 folder reorganisation (part 2)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)", "committedDate": "2020-08-04T18:05:50Z", "type": "commit"}, {"oid": "fd6bbc0d2c4ed287c7312abe921b4cb266299ddf", "url": "https://github.com/hmcts/ccd-data-store-api/commit/fd6bbc0d2c4ed287c7312abe921b4cb266299ddf", "message": "RDM-8842 folder reorganisation (part 3)\n\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)", "committedDate": "2020-08-04T18:18:09Z", "type": "commit"}, {"oid": "3cb7aca2a74e4f2b3e9b44ae29d1b2c6786ba6c2", "url": "https://github.com/hmcts/ccd-data-store-api/commit/3cb7aca2a74e4f2b3e9b44ae29d1b2c6786ba6c2", "message": "Merge remote-tracking branch 'origin/RDM-8842' into RDM-9118-from-8842\n\nConflicts:\n\tsrc/aat/resources/features/F-105/common/F-105_Users.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Repeated_Call_to_Add_Case_Assigned_Users_and_Roles_Hemanth.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_1.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_2.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.1/S-105.8842.1_Verify_Counter_3.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.2/S-105.8842.2.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/S-105.8842.4/S-105.8842.4.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/common/F-105_Check_Orgs_Assigned_Users_Base.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/common/F-105_Prerequisite_Counter_Check_Call.td.json\n\tsrc/aat/resources/features/F-105/rdm-8842/common/F-105_Verify_Counter_Unchanged.td.json", "committedDate": "2020-08-04T19:14:38Z", "type": "commit"}, {"oid": "d572d59f4b3040019ef1f6ebde173580524a76b7", "url": "https://github.com/hmcts/ccd-data-store-api/commit/d572d59f4b3040019ef1f6ebde173580524a76b7", "message": "RDM-9118 adjust BEFTA account usage in F-105\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)", "committedDate": "2020-08-05T10:46:51Z", "type": "commit"}, {"oid": "48873c1f0cd4f3582a48ebd5d71221382ce6c70b", "url": "https://github.com/hmcts/ccd-data-store-api/commit/48873c1f0cd4f3582a48ebd5d71221382ce6c70b", "message": "RDM-9118 adjust BEFTA account usage in F-105\n\n   [RDM-9118](https://tools.hmcts.net/jira/browse/RDM-9118)\n   [RDM-8842](https://tools.hmcts.net/jira/browse/RDM-8842)", "committedDate": "2020-08-05T10:58:23Z", "type": "commit"}, {"oid": "5724df52ef85551434d4ba3f33a0b897fce17d45", "url": "https://github.com/hmcts/ccd-data-store-api/commit/5724df52ef85551434d4ba3f33a0b897fce17d45", "message": "Merge pull request #1039 from hmcts/RDM-9118-from-8842\n\nRDM-9118 FTA organisation adjustment for RDM-8842", "committedDate": "2020-08-05T15:59:30Z", "type": "commit"}, {"oid": "0c36c6c1e95343de4e587463345260123f04b2cf", "url": "https://github.com/hmcts/ccd-data-store-api/commit/0c36c6c1e95343de4e587463345260123f04b2cf", "message": "use latest stable fw release", "committedDate": "2020-08-05T17:14:50Z", "type": "commit"}, {"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc1NzE0NA==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r467757144", "bodyText": "May be it's better to extract these into separate small methods for better readability and unit testing?", "author": "smathangi", "createdAt": "2020-08-10T08:30:39Z", "path": "src/main/java/uk/gov/hmcts/ccd/domain/service/caseaccess/CaseAccessOperation.java", "diffHunk": "@@ -84,25 +92,121 @@ public void updateUserAccess(CaseDetails caseDetails, CaseUser caseUser) {\n     }\n \n     @Transactional\n-    public void addCaseUserRoles(List<CaseAssignedUserRole> caseUserRoles) {\n+    public void addCaseUserRoles(List<CaseAssignedUserRoleWithOrganisation> caseUserRoles) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = getMapOfCaseAssignedUserRolesByCaseId(caseUserRoles);\n+\n+        Map<String, Map<String, Object>> newUserCounts = getNewUserCountByCaseAndOrganisation(cauRolesByCaseId);\n+\n+        cauRolesByCaseId.forEach((caseId, requestedAssignments) ->\n+            requestedAssignments.forEach(requestedAssignment ->\n+                caseUserRepository.grantAccess(caseId, requestedAssignment.getUserId(), requestedAssignment.getCaseRole())\n+            )\n+        );\n+\n+        newUserCounts.forEach((caseReference, orgNewUserCountMap) ->\n+            orgNewUserCountMap.forEach((organisationId, newUserCount) ->\n+                supplementaryDataRepository.incrementSupplementaryData(caseReference, \"orgs_assigned_users.\" + organisationId, newUserCount)\n+            )\n+        );\n+    }\n+\n+    private Map<Long, List<CaseAssignedUserRoleWithOrganisation>> getMapOfCaseAssignedUserRolesByCaseId(\n+        List<CaseAssignedUserRoleWithOrganisation> caseUserRoles\n+    ) {\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId = new HashMap<>();\n+\n         List<Long> caseReferences = caseUserRoles.stream()\n-            .map(CaseAssignedUserRole::getCaseDataId)\n+            .map(CaseAssignedUserRoleWithOrganisation::getCaseDataId)\n             .distinct()\n             .map(Long::parseLong)\n             .collect(Collectors.toCollection(ArrayList::new));\n \n+        // create map of case references to case IDs\n         Map<Long, String> caseIdAndReferences = getCaseDetailsList(caseReferences).stream()\n             .collect(Collectors.toMap(CaseDetails::getReference, CaseDetails::getId));\n \n-        caseUserRoles.forEach(caseUserRole -> {\n-            final Long caseReference = Long.parseLong(caseUserRole.getCaseDataId());\n+        // group roles by case reference\n+        Map<String, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseReference = caseUserRoles.stream()\n+            .collect(Collectors.groupingBy(CaseAssignedUserRoleWithOrganisation::getCaseDataId));\n+\n+        // merge both maps to check we have found all cases\n+        cauRolesByCaseReference.forEach((key, roles) -> {\n+            final Long caseReference = Long.parseLong(key);\n             if (caseIdAndReferences.containsKey(caseReference)) {\n                 final Long caseId = Long.parseLong(caseIdAndReferences.get(caseReference));\n-                caseUserRepository.grantAccess(caseId, caseUserRole.getUserId(), caseUserRole.getCaseRole());\n+                cauRolesByCaseId.put(caseId, roles);\n             } else {\n-                throw new CaseNotFoundException(caseReference.toString());\n+                throw new CaseNotFoundException(key);\n+            }\n+        });\n+\n+        return cauRolesByCaseId;\n+    }\n+\n+    private Map<String, Map<String, Object>> getNewUserCountByCaseAndOrganisation(Map<Long, List<CaseAssignedUserRoleWithOrganisation>> cauRolesByCaseId) {\n+        Map<String, Map<String, Object>> result = new HashMap<>();\n+\n+        Map<Long, List<CaseAssignedUserRoleWithOrganisation>> caseUserRolesWhichHaveAnOrgId = cauRolesByCaseId.entrySet().stream()\n+            .collect(Collectors.toMap(Map.Entry::getKey, e -> e.getValue().stream()\n+                // filter out no organisation_id\n+                .filter(caseUserRole -> StringUtils.isNoneBlank(caseUserRole.getOrganisationId()))\n+                .collect(Collectors.toList())))\n+            // filter cases that have no remaining roles\n+            .entrySet().stream().filter(e -> !e.getValue().isEmpty())", "originalCommit": "0c36c6c1e95343de4e587463345260123f04b2cf", "replyToReviewId": null, "replies": [{"id": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc3ODI5MQ==", "url": "https://github.com/hmcts/ccd-data-store-api/pull/1024#discussion_r467778291", "bodyText": "I do agree. I'll add this to the content of the ticket for minor tweaks of this major work.", "author": "MSancaktutar", "createdAt": "2020-08-10T09:13:21Z", "replyToReviewId": "MDI0OlB1bGxSZXF1ZXN0UmV2aWV3Q29tbWVudDQ2Nzc1NzE0NA=="}], "type": "inlineReview"}]}